{
    "name": "ä¸»ç¥ç©ºé—´",
    "description": "",
    "personality": "",
    "scenario": "",
    "first_mes": "<å­˜æ¡£>[ZERO_LEVEL_CHAT]</å­˜æ¡£>",
    "mes_example": "",
    "creatorcomment": "",
    "avatar": "none",
    "talkativeness": "0.5",
    "fav": false,
    "tags": [],
    "spec": "chara_card_v3",
    "spec_version": "3.0",
    "data": {
        "name": "ä¸»ç¥ç©ºé—´",
        "description": "",
        "personality": "",
        "scenario": "",
        "first_mes": "<å­˜æ¡£>[ZERO_LEVEL_CHAT]</å­˜æ¡£>",
        "mes_example": "",
        "creator_notes": "",
        "system_prompt": "",
        "post_history_instructions": "",
        "tags": [],
        "creator": "",
        "character_version": "åŒå±‚ç‰ˆ",
        "alternate_greetings": [],
        "extensions": {
            "talkativeness": "0.5",
            "fav": false,
            "world": "å°èŒèšªæ‰¾å¦ˆå¦ˆ-åŒå±‚ç‰ˆ",
            "depth_prompt": {
                "prompt": "",
                "depth": 4,
                "role": "system"
            },
            "TavernHelper_scripts": [
                {
                    "type": "script",
                    "value": {
                        "id": "be9af76b-8292-4d4e-b8de-a6d2eeb5000b",
                        "name": "æ•°æ®ç»Ÿä¸€-å¸¦æŒ‰é’®ç‰ˆ",
                        "content": "\n \nif (window.isNovaCoreInitialized) {\n    console.log(\"[Core] âš ï¸ æ£€æµ‹åˆ°é‡å¤å¬å”¤ï¼Œå·²å¯åŠ¨å®ˆæŠ¤å±éšœï¼Œé˜»æ­¢äº†æ ¸å¿ƒè„šæœ¬çš„ç¬¬äºŒæ¬¡åˆå§‹åŒ–ã€‚\");\n} else {\n    window.isNovaCoreInitialized = true;\n    console.log(\"[Core] âœ¨ æ ¸å¿ƒè„šæœ¬é¦–æ¬¡å¯åŠ¨ï¼Œå·²ç›–ä¸Šå”¯ä¸€çµé­‚å°è®°ã€‚\");\n\n(function() {\n    'use strict';\n\n \n\n       const default_stat_data = {\n        \"stat_data\": {\n            \"hurt_value\": [0,\"æœ¬æ¡å›å¤å—åˆ°é¢å¤–ä¼¤å®³çš„å€¼\"],\n            \"æ—¥æœŸ\": [\"\", \"ä»Šå¤©çš„æ—¥æœŸï¼Œæ ¼å¼ä¸º mmæœˆddæ—¥ï¼Œä»01æœˆ01æ—¥å¼€å§‹ï¼Œä¹ƒè¿›å…¥ä»»åŠ¡ä¸–ç•Œçš„è®¡æ—¶ï¼Œç¦æ­¢ä¸ºç©ºæˆ–æœªçŸ¥ã€‚\"],\n            \"æ—¶é—´\": [\n                \"\",\n                \"æŒ‰ç…§è¿›è¡Œè¡ŒåŠ¨åå®é™…ç»å†çš„æ—¶é—´åˆç†è¿›è¡Œæ›´æ–°ï¼Œæ¯æ¬¡è¾“å‡ºå†…å®¹åå¿…é¡»æ›´æ–°ï¼Œæ ¼å¼ä¸º hh:mmï¼Œç¦æ­¢ä¸ºç©ºæˆ–æœªçŸ¥\"\n            ],\n            \"world_shard\": {\n                \"name\": [\"\", \"å½“å‰æ‰€å¤„'ä»»åŠ¡ä¸–ç•Œ'çš„åç§°æˆ–ä»£å·ã€‚\"],\n                \"description\": [\"æ— \", \"å½“å‰'ä»»åŠ¡ä¸–ç•Œ'çš„ç¯å¢ƒã€æ°›å›´ã€æ–‡æ˜å½¢æ€ç­‰æ€»ä½“æè¿°\"],\n                \"level\":[\"æ— \",\"å½“å‰ä¸–ç•Œèƒ½é‡/ç§‘æŠ€å±‚çº§ï¼Œåªèƒ½ä»[ä½/ä¸­/é«˜/ç¥è¯/æ— ]ä¸­äº”é€‰ä¸€ã€‚å‚è€ƒ:é‡‘åº¸ä¸–ç•Œ/æ™®é€šç§‘å¹»ä¸–ç•Œçš„ä¸–ç•Œå±‚çº§ä¸ºä½ã€‚åªåœ¨åˆå§‹åŒ–ä¸–ç•Œæ—¶/èƒ½é‡å±‚çº§æ”¹å˜æ—¶(æœ‰ç¥æ˜/é€ ç‰©è¿›å…¥/ç¦»å¼€useré™„è¿‘)ï¼Œæ‰èƒ½æ›´æ”¹å…¶èƒ½é‡å±‚çº§\"],\n                \"task\": {\n                    \"objective\": [\"æ— \", \"å‘å¸ƒçš„ä»»åŠ¡ç›®æ ‡\"],\n                    \"progress\": [0, \"ä»»åŠ¡è¿›åº¦ç™¾åˆ†æ¯”ï¼Œä»¥æ•°å­—è¡¨ç¤ºï¼Œåˆå§‹å¿…ä¸º0ã€‚\"],\n                    \"status\": [\"æœªå®Œæˆ\", \"ä»»åŠ¡çŠ¶æ€ï¼šæœªå®Œæˆ/å·²å®Œæˆ/å¤±è´¥\"],\n                    \"participants\": [\"æ— \",\"åªè®°å½•å½“å‰ä»»åŠ¡çš„å…¨éƒ¨å‚ä¸äººå‘˜çš„æ¦‚è¿°æ€§çš„äººç‰©çŠ¶æ€ï¼ŒçŠ¶æ€ä¸å¾—è¶…è¿‡5ä¸ªå­—ã€‚ä½¿ç”¨;åˆ†éš”ï¼Œä¾‹ï¼šå¼ ä¸‰ï¼ˆæ¢ç´¢ä¸­ï¼‰;æå››ï¼ˆäº¤è°ˆä¸­ï¼‰ã€‚ç¦æ­¢åŠ å…¥ä»»åŠ¡ä¸–ç•ŒåœŸè‘—ã€‚ç¦æ­¢è¾“å‡ºå…¶ä»–å†…å®¹ã€‚è‹¥äººæ•°å¤ªå¤šï¼Œåˆ™ç•¥ã€‚è„±ç¦»ä»»åŠ¡ä¸–ç•Œæ—¶æ¸…ç©º\"],\n                    \"rewards\": [\"æ— \", \"ä»»åŠ¡æˆåŠŸåçš„å¥–åŠ±\"],\n                    \"penalties\": [\"æ— \",\"ä»»åŠ¡å¤±è´¥åçš„æƒ©ç½š\"],\n                    \"time_limit\":[0, \"ä»»åŠ¡çš„æ€»ä½“æ—¶é—´é™åˆ¶(å¤©æ•°ï¼Œå¯ä»¥ä¸ºå°æ•°ï¼Œæ¯”å¦‚12å°æ—¶å³æ˜¯0.5ã€‚æ— æ˜ç¡®æ—¶é™æ—¶è®¾ç½®ä¸º999)ï¼Œåªæœ‰åœ¨åˆå§‹åŒ–ä»»åŠ¡æˆ–ä»»åŠ¡ç»“ç®—æ—¶æ”¹å˜ï¼Œå…¶ä½™æ—¶å€™ç¦æ­¢æ“ä½œï¼å›åˆ°ä¸ªäººç©ºé—´æ—¶è®¾ç½®limitä¸º3ï¼Œæ„ä¸ºæœ€å¤šä¼‘æ•´ä¸‰å¤©\"],\n                    \"time_left\":[0, \"ä»»åŠ¡çš„å‰©ä½™å¤©æ•°ï¼Œå…¨ç¨‹ä»£ç è‡ªåŠ¨è®¡ç®—ï¼ŒAIä»»ä½•æ—¶åˆ»éƒ½ç¦æ­¢æ“ä½œï¼\"]\n                }\n            },\n            \"the_created\": {\n                     \"name\": [\"\", \"é€ ç‰©çš„åå­—\"],\n                     \"identity_in_world\": [\"\", \"é€ ç‰©åœ¨å½“å‰ä¸–ç•Œçš„èº«ä»½\"],\n                     \"current_status\": [\"\", \"é€ ç‰©å½“å‰çš„çŠ¶æ€ï¼Œå¦‚ï¼šè§‚å¯Ÿä¸­ã€æ²‰ç¡ä¸­ã€æš´æ€’ä¸­ã€‚æ³¨æ„ï¼Œé€ ç‰©åœ¨è§åˆ°é€ ç‰©ä¸»çš„ç¬¬ä¸€çœ¼å°±ä¼šç«‹åˆ»è®¤å‡º\"],\n                     \"mood\": [\"\", \"é€ ç‰©å½“å‰çš„å¿ƒæƒ…ï¼Œå¦‚ï¼šå¹³é™ã€æœŸå¾…ã€è­¦æƒ•\"],\n                     \"description\": [\"\", \"å…³äºè¿™ä¸ªé€ ç‰©çš„è¯¦ç»†ä»‹ç»ï¼Œå¿…é¡»è¯¦ç»†ä»‹ç»å…¶éäººéƒ¨åˆ†ï¼ŒåŒ…æ‹¬å¿ƒæ™ºã€å¤–å½¢ç­‰ï¼Œä¸¥æ ¼æŒ‰ç…§è¦æ±‚æ¥è®¾è®¡ã€‚ä¸å°‘äº50å­—\"]\n            },\n            \"user_character\": {\n                \"name\": \"user\",\n                \"status\":[\"\",\"ç”¨æˆ·å½“å‰æ‰€æ‹¥æœ‰çš„buffå’Œdebuffï¼Œå¤šä¸ªçŠ¶æ€ç”¨;åˆ†éš”\"],\n                \"total_task\":[0,\"å®Œæˆçš„ä»»åŠ¡æ€»é‡ï¼Œå®Œæˆ/å¤±è´¥ä¸€ä¸ªä»»åŠ¡åï¼Œç»“ç®—çš„æ—¶å€™åŠ ä¸€\"],\n                \"Cross_world_prestige\":[0,\"ç”¨æˆ·çš„è·¨ä¸–ç•Œå£°æœ›ï¼Œå¯ä¸ºè´Ÿï¼Œåœ¨è„±ç¦»ä¸€ä¸ªä¸–ç•Œæ—¶ç»“ç®—ï¼Œåªæœ‰å¯¹ä¸–ç•Œäº§ç”Ÿé‡å¤§å½±å“æ‰æ›´æ–°ã€‚æ•°å€¼å…‹åˆ¶ï¼Œä¾‹å¦‚ï¼šæ‹¯æ•‘äº†ä¸€ä¸ªå®Œæ•´çš„ä¸–ç•Œï¼Œå£°æœ›+5\"],\n                \"current_location\": [\n                    \"\",\n                    \"userå½“å‰æ‰€åœ¨çš„ä½ç½®ï¼Œç§»åŠ¨åæ›´æ–°\"\n                ],\n                \"å½“å‰è£…å¤‡\": {\n                    \"æ‰‹æŒ\": [\"æ— \", \"å½“å‰æ‰‹æŒçš„æ­¦å™¨æˆ–å·¥å…·åç§°\"],\n                    \"ç©¿æˆ´\": {\n                        \"å¤´éƒ¨\": [\"æ— \", \"å¤´éƒ¨çš„è£…å¤‡åç§°\"],\n                        \"èº«ä½“\": [\"æ— \", \"èº«ä½“çš„è£…å¤‡åç§°\"],\n                        \"æ‰‹éƒ¨\": [\"æ— \", \"æ‰‹éƒ¨çš„è£…å¤‡åç§°\"],\n                        \"è„šéƒ¨\": [\"æ— \", \"è„šéƒ¨çš„è£…å¤‡åç§°\"],\n                        \"é¥°å“\": [\"æ— \", \"ç‰¹æ®Šé¥°å“åç§°\"]\n                    }\n                }\n            },\n            \"æ£€å®šå±æ€§\": [\"\", \"ä¸‹ä¸€è½®è¡ŒåŠ¨éœ€è¦è¿›è¡Œåˆ¤å®šçš„æ ¸å¿ƒ å±æ€§æ®µ å’Œ æŠ€èƒ½æ®µ (ç¦æ­¢æ£€å®š å…¶ä»–æŠ€èƒ½ )ç»„åˆï¼Œè®¾ç½®ä¸‰ä¸ªã€‚ç”¨åŠè§’ç¬¦å·;åˆ†éš”ï¼Œä¾‹å¦‚ï¼šåŠ›é‡;æ•æ·;ç™½åˆƒã€‚è‹¥å­˜åœ¨é€‰é¡¹åŒºï¼Œé€‰å–ç¬¬ä¸€ä¸ªé€‰é¡¹åŒºçš„æ£€å®šå±æ€§ä½œä¸ºå€¼\"],\n            \"æ£€å®šéš¾åº¦\":[1,\"æ¯ä¸€è½®éƒ½é¢„æµ‹ä¸‹ä¸€è½®è¡ŒåŠ¨ä¼šç›´æ¥é¢å¯¹çš„å±æœºçš„éš¾åº¦çº§åˆ«ã€‚ç¦æ­¢ä¸ºç©º\"],\n            \"æ•Œæ–¹æ”»å‡»éª°æ± \": [\"\", \"å½“åˆ¤å®šå½“å‰å¤„äºæˆ˜æ–—çŠ¶æ€æ—¶ï¼Œé¢„æµ‹æ•Œæ–¹å½“å‰å³å°†è½ä¸‹çš„æ”»å‡»æ‰€å±çš„æ ¸å¿ƒå±æ€§æ®µå’ŒæŠ€èƒ½æ®µç»„åˆï¼Œæ— ä¸Šé™ã€‚ç”¨åŠè§’:è®¾ç½®æ•Œæ–¹æ­¤å±æ€§çš„å€¼ï¼Œå¤šä¸ªå±æ€§ç”¨åŠè§’ç¬¦å·;åˆ†éš”ï¼Œä¾‹å¦‚ï¼šåŠ›é‡:2;æ„ŸçŸ¥:3;ç™½åˆƒ:2ã€‚è‹¥å½“å‰æ²¡æœ‰æ•Œæ–¹æ”»å‡»ï¼Œåˆ™å¿…é¡»ç½®ç©º\"],\n            \"dp_bonus\":[0,\"æ¥æºäºæ„å¿—åŠ›æˆ–æŠ€èƒ½ï¼ŒAIç¦æ­¢è®¾ç½®\"],\n            \"ç¬¦åˆç¾å¾·çš„\":['false',\"å½“æ£€æµ‹åˆ°æ­¤è½®ç”¨æˆ·è¡¨ç°ç¬¦åˆç¾å¾·è§¦å‘æ¡ä»¶æ—¶ï¼Œè®¾ç½®ä¸ºtrue;å½“ä¸ç¬¦åˆæ—¶ï¼Œè®¾ç½®ä¸ºfalse\"],\n            \"ç¬¦åˆæ¶å¾·çš„\":['false',\"å½“æ£€æµ‹åˆ°æ­¤è½®ç”¨æˆ·è¡¨ç°ç¬¦åˆæ¶å¾·è§¦å‘æ¡ä»¶æ—¶ï¼Œè®¾ç½®ä¸ºtrue;å½“ä¸ç¬¦åˆæ—¶ï¼Œè®¾ç½®ä¸ºfalse\"],\n        }\n    };\n\n    // --- è§’è‰²æ•°æ®è“å›¾ ---\n    const default_play_data = {\n        \"play_character_data\": {\n            \"æ¦‚å¿µæ®µ\": { \"ç¾å¾·ä¸æ¶å¾·\": { \"ç¾å¾·\": [\"æ­£ä¹‰\", \"ç¬¦åˆå¯¹åº”æ¡ä»¶æ—¶å›å¤æ‰€æœ‰æ„å¿—åŠ›\"], \"æ¶å¾·\": [\"æ„¤æ€’\", \"ç¬¦åˆå¯¹åº”æ¡ä»¶æ—¶å›å¤1ç‚¹æ„å¿—åŠ›\"] }, \"ç¼ºé™·å¤©èµ‹æ€ªç™–\": { \"ç¼ºé™·\": [\"æ— \", \"è§’è‰²æ‰€å…·æœ‰çš„è´Ÿé¢ç‰¹æ€§\"], \"å¤©èµ‹\": [\"æ— \", \"è§’è‰²æ‰€å…·æœ‰çš„æ­£é¢ç‰¹æ€§\"], \"æ€ªç™–\": [\"æ— \", \"è§’è‰²çš„ä¸€äº›æ— ä¼¤å¤§é›…çš„ç‰¹æ®Šä¹ æƒ¯\"] } },\n            \"å±æ€§æ®µ\": { \"ç”Ÿç†å±æ€§\": { \"åŠ›é‡\": { \"åŸºç¡€\": [0, \"è¡¡é‡è‚Œè‚‰å¼ºåº¦ä¸çˆ†å‘åŠ›ï¼Œå½±å“è¿‘æˆ˜ä¼¤å®³ä¸è´Ÿé‡\"], \"ä¼ å¥‡\": [0, \"è¶…è¶Šå‡¡äººæé™çš„åŠ›é‡ï¼Œæä¾›ä¼¤å®³é™„åŠ æˆåŠŸ\"] }, \"æ•æ·\": { \"åŸºç¡€\": [0, \"è¡¡é‡èº«ä½“åè°ƒã€ååº”é€Ÿåº¦ä¸çµæ´»æ€§ï¼Œå½±å“å…ˆæ”»ä¸é—ªé¿\"], \"ä¼ å¥‡\": [0, \"è¶…è¶Šå‡¡äººæé™çš„æ•æ·ï¼Œæä¾›é˜²å¾¡é™„åŠ æˆåŠŸ\"] }, \"è€åŠ›\": { \"åŸºç¡€\": [0, \"è¡¡é‡ä½“è´¨ã€æŒä¹…åŠ›ä¸æ¢å¤åŠ›ï¼Œå½±å“ç”Ÿå‘½å€¼ä¸æŠµæŠ—åŠ›\"], \"ä¼ å¥‡\": [0, \"è¶…è¶Šå‡¡äººæé™çš„è€åŠ›ï¼Œæä¾›ä¼¤å®³å‡å…\"] } }, \"å¿ƒæ™ºå±æ€§\": { \"æ™ºåŠ›\": { \"åŸºç¡€\": [0, \"è¡¡é‡é€»è¾‘ã€è®°å¿†ã€å­¦ä¹ ä¸åˆ†æèƒ½åŠ›ï¼Œå½±å“æŠ€èƒ½å­¦ä¹ ä¸ç­–ç•¥\"], \"ä¼ å¥‡\": [0, \"è¶…è¶Šå‡¡äººæé™çš„æ™ºåŠ›ï¼Œæä¾›æŠ€èƒ½é™„åŠ æˆåŠŸ\"] }, \"æ„ŸçŸ¥\": { \"åŸºç¡€\": [0, \"è¡¡é‡è§‚å¯ŸåŠ›ã€ç›´è§‰ä¸äº”æ„Ÿæ•é”åº¦ï¼Œå½±å“ä¾¦æŸ¥ä¸æ´å¯Ÿ\"], \"ä¼ å¥‡\": [0, \"è¶…è¶Šå‡¡äººæé™çš„æ„ŸçŸ¥ï¼Œæä¾›æ´å¯Ÿé˜²å¾¡ä¸ä¾¦æŸ¥é™„åŠ æˆåŠŸ\"] }, \"å†³å¿ƒ\": { \"åŸºç¡€\": [0, \"è¡¡é‡æ„å¿—åŠ›ã€å‹‡æ°”ä¸ç²¾ç¥éŸ§æ€§ï¼Œå½±å“æ„å¿—å€¼ä¸Šé™\"], \"ä¼ å¥‡\": [0, \"è¶…è¶Šå‡¡äººæé™çš„å†³å¿ƒï¼Œæä¾›æ„å¿—æ£€å®šé™„åŠ æˆåŠŸ\"] } }, \"äº’åŠ¨å±æ€§\": { \"é£åº¦\": { \"åŸºç¡€\": [0, \"è¡¡é‡ä¸ªäººé­…åŠ›ã€æ°”è´¨ä¸ç¬¬ä¸€å°è±¡ï¼Œå½±å“æ­£é¢ç¤¾äº¤\"], \"ä¼ å¥‡\": [0, \"è¶…è¶Šå‡¡äººæé™çš„é£åº¦ï¼Œæä¾›ç¤¾äº¤æ£€å®šé™„åŠ æˆåŠŸ\"] }, \"æ“æ§\": { \"åŸºç¡€\": [0, \"è¡¡é‡è¯´æœã€è¯±å¯¼ä¸æ§åˆ¶ä»–äººçš„èƒ½åŠ›ï¼Œå½±å“è´Ÿé¢ç¤¾äº¤\"], \"ä¼ å¥‡\": [0, \"è¶…è¶Šå‡¡äººæé™çš„æ“æ§ï¼Œæä¾›æ“æ§æ£€å®šé™„åŠ æˆåŠŸ\"] }, \"æ²‰ç€\": { \"åŸºç¡€\": [0, \"è¡¡é‡å†·é™ã€è‡ªæ§ä¸æŠ—å‹èƒ½åŠ›ï¼Œå½±å“å…ˆæ”»ä¸æ„å¿—å€¼ä¸Šé™\"], \"ä¼ å¥‡\": [0, \"è¶…è¶Šå‡¡äººæé™çš„æ²‰ç€ï¼Œæä¾›æ„å¿—æ£€å®šé™„åŠ æˆåŠŸ\"] } } },\n            \"æŠ€èƒ½æ®µ\": { \"ç”Ÿç†æŠ€èƒ½\": { \"è¿åŠ¨\": [0, \"è¡¡é‡è·‘ã€è·³ã€æ”€çˆ¬ç­‰èº«ä½“æ´»åŠ¨èƒ½åŠ›\"], \"è‚‰æ\": [0, \"è¡¡é‡å¾’æ‰‹æ ¼æ–—æŠ€å·§\"], \"é©¾é©¶\": [0, \"è¡¡é‡æ“æ§åœ°é¢ã€æ°´é¢æˆ–ç©ºä¸­è½½å…·çš„èƒ½åŠ›\"], \"æªæ¢°\": [0, \"è¡¡é‡ä½¿ç”¨å„ç±»ç«å™¨çš„èƒ½åŠ›\"], \"æ‰‹ä¸ŠåŠŸå¤«\": [0, \"è¡¡é‡ç›—çªƒã€å¼€é”ç­‰æ‰‹éƒ¨ç²¾ç»†æ“ä½œèƒ½åŠ›\"], \"éšè—\": [0, \"è¡¡é‡æ½œè¡Œã€ä¼ªè£…ä¸éšè”½è‡ªèº«çš„èƒ½åŠ›\"], \"æ±‚ç”Ÿ\": [0, \"è¡¡é‡åœ¨æ¶åŠ£ç¯å¢ƒä¸­ç”Ÿå­˜ä¸è¿½è¸ªçš„èƒ½åŠ›\"], \"ç™½åˆƒ\": [0, \"è¡¡é‡ä½¿ç”¨åˆ€å‰‘ç­‰å†·å…µå™¨çš„èƒ½åŠ›\"], \"å¼“ç®­\": [0, \"è¡¡é‡ä½¿ç”¨å¼“å¼©ç­‰æŠ›å°„æ­¦å™¨çš„èƒ½åŠ›\"] }, \"å¿ƒæ™ºæŠ€èƒ½\": { \"å­¦è¯†\": [0, \"è¡¡é‡äººæ–‡ã€å†å²ã€åœ°ç†ç­‰çŸ¥è¯†å¹¿åº¦\"], \"ç”µè„‘\": [0, \"è¡¡é‡æ“ä½œã€ç¼–ç¨‹ä¸é»‘å®¢æŠ€æœ¯\"], \"æ‰‹è‰º\": [0, \"è¡¡é‡åˆ¶ä½œçš„çŸ¥è¯†\"], \"è°ƒæŸ¥\": [0, \"è¡¡é‡æœé›†çº¿ç´¢ã€åˆ†æç°åœºçš„èƒ½åŠ›\"], \"åŒ»å­¦\": [0, \"è¡¡é‡è¯Šæ–­ã€æ²»ç–—ä¸è¯ç†çŸ¥è¯†\"], \"ç¥ç§˜å­¦\": [0, \"è¡¡é‡å¯¹è¶…è‡ªç„¶ç°è±¡ä¸é­”æ³•çš„çŸ¥è¯†\"], \"ç§‘å­¦\": [0, \"è¡¡é‡ç‰©ç†ã€åŒ–å­¦ã€ç”Ÿç‰©ç­‰è‡ªç„¶ç§‘å­¦çŸ¥è¯†\"] }, \"äº’åŠ¨æŠ€èƒ½\": { \"åŠ¨ç‰©æ²Ÿé€š\": [0, \"è¡¡é‡ä¸åŠ¨ç‰©äº¤æµå’Œé©¯æœçš„èƒ½åŠ›\"], \"æ„Ÿå—\": [0, \"è¡¡é‡æ´å¯Ÿä»–äººæƒ…ç»ªä¸æ„å›¾çš„èƒ½åŠ›\"], \"è¡¨è¾¾\": [0, \"è¡¡é‡æ„ŸæŸ“ä»–äººçš„èƒ½åŠ›\"], \"èƒè¿«\": [0, \"è¡¡é‡é€šè¿‡å¨èƒä¸æå“è¾¾æˆç›®çš„çš„èƒ½åŠ›\"], \"äº¤é™…\": [0, \"è¡¡é‡ç¤¾äº¤ã€ç¤¼ä»ªä¸å»ºç«‹äººè„‰çš„èƒ½åŠ›\"], \"æ©é¥°\": [0, \"è¡¡é‡éšè—çœŸç›¸ã€ä¼ªè£…èº«ä»½ä¸æ¬ºéª—ä»–äººçš„èƒ½åŠ›\"] } },\n            \"èƒ½åŠ›æ®µ\": { \"ç±»å‹\": [\"æ— \", \"èƒ½åŠ›çš„åˆ†ç±»ï¼Œå¦‚è¡€ç»Ÿã€æ”¹é€ ã€åŠŸæ³•ç­‰\"], \"åç§°\": [\"\", \"èƒ½åŠ›çš„å…·ä½“åç§°\"], \"ç­‰çº§\": [0, \"èƒ½åŠ›çš„ç­‰çº§\"], \"æ•ˆæœ\": [\"\", \"èƒ½åŠ›æä¾›çš„å…·ä½“æ¸¸æˆæ•ˆæœ\"] },\n            \"è¡ç”Ÿå±æ€§æ®µ\": { \"ä½“ç§¯\": [5, \"è§’è‰²çš„èº«ä½“å°ºå¯¸ï¼Œå½±å“ç”Ÿå‘½å€¼ã€é€Ÿåº¦ä¸è¢«ä¾¦æµ‹çš„éš¾åº¦\"], \"é€Ÿåº¦\": { \"åŸºç¡€é€Ÿåº¦\": [0, \"ç”±åŠ›é‡+æ•æ·+ä½“ç§¯/3å†³å®šï¼Œæ˜¯ç§»åŠ¨è®¡ç®—çš„åŸºç¡€\"], \"é™†è¡Œé€Ÿåº¦\": [0, \"åœ¨é™†åœ°ä¸Šçš„ç§»åŠ¨é€Ÿåº¦ï¼Œå•ä½ä¸ºç±³/ç§»åŠ¨åŠ¨ä½œ\"], \"é£è¡Œé€Ÿåº¦\": [0, \"åœ¨ç©ºä¸­çš„ç§»åŠ¨é€Ÿåº¦ï¼Œé€šå¸¸éœ€è¦ç‰¹æ®Šèƒ½åŠ›\"] }, \"å…ˆæ”»\": [0, \"ç”±æ•æ·+æ²‰ç€/2å†³å®šï¼Œå†³å®šæˆ˜æ–—ä¸­çš„è¡ŒåŠ¨é¡ºåº\"], \"é˜²å¾¡\": { \"åŸºç¡€é˜²å¾¡\": [0, \"ç”±æ•æ·æˆ–æ„ŸçŸ¥ä¸­è¾ƒä½è€…å†³å®šï¼Œç”¨äºé—ªé¿æ—¶å‡å…æ”»å‡»æˆåŠŸæ•°\"], \"ä¼¤å®³å‡å…\": { \"å†²å‡»\": [0, \"æŠµæŠ—å†²å‡»ä¼¤å®³çš„èƒ½åŠ›\"], \"è‡´å‘½\": [0, \"æŠµæŠ—è‡´å‘½ä¼¤å®³çš„èƒ½åŠ›\"], \"æ¶æ€§\": [0, \"æŠµæŠ—æ¶æ€§ä¼¤å®³çš„èƒ½åŠ›\"] } }, \"ç”Ÿå‘½å€¼\": { \"ä¸Šé™\": [50, \"è§’è‰²èƒ½æ‰¿å—çš„æ€»ä¼¤å®³\"], \"å½“å‰å€¼\": [50, \"è§’è‰²å½“å‰å‰©ä½™çš„ç”Ÿå‘½åŠ›\"], \"ä¼¤å®³æ§½\": { \"å†²å‡»(B)\": [0, \"å·²æ‰¿å—çš„å†²å‡»ä¼¤å®³ï¼Œä¸€èˆ¬ç”±é’å‡»é€ æˆ\"], \"è‡´å‘½(L)\": [0, \"å·²æ‰¿å—çš„è‡´å‘½ä¼¤å®³ï¼Œä¸€èˆ¬ç”±ç©¿åˆºåŠˆç é€ æˆ\"], \"æ¶æ€§(A)\": [0, \"å·²æ‰¿å—çš„æ¶æ€§ä¼¤å®³ï¼Œä¸€èˆ¬ç”±è¶…è‡ªç„¶åŠ›é‡é€ æˆ\"] } }, \"æ„å¿—åŠ›\": { \"æ„å¿—å€¼\": [0, \"ç”±å†³å¿ƒ+æ²‰ç€å†³å®šï¼Œæ˜¯æ„å¿—åŠ›çš„ä¸Šé™å’Œæ„å¿—æ£€å®šçš„åŸºç¡€\"], \"ä¸Šé™\": [0, \"è§’è‰²æ‰€èƒ½æ‹¥æœ‰çš„æœ€å¤§æ„å¿—åŠ›ç‚¹æ•°\"], \"å½“å‰å€¼\": [0, \"è§’è‰²å½“å‰å¯ç”¨çš„æ„å¿—åŠ›ç‚¹æ•°\"] }, \"èƒ½é‡æ± \": { \"åç§°\": [\"æ— \", \"è§’è‰²ä½¿ç”¨çš„ç‰¹æ®Šèƒ½é‡åç§°ï¼Œå¦‚æ³•åŠ›ã€çµåŠ›ã€æ°”\"], \"ä¸Šé™\": [0, \"è§’è‰²æ‰€èƒ½æ‹¥æœ‰çš„æœ€å¤§èƒ½é‡ç‚¹æ•°\"], \"å½“å‰å€¼\": [0, \"è§’è‰²å½“å‰å¯ç”¨çš„èƒ½é‡ç‚¹æ•°\"] }, \"æ„ŸçŸ¥èŒƒå›´\": { \"æ•æ„ŸèŒƒå›´\": [0, \"ç”±æ„ŸçŸ¥*10ç±³å†³å®šï¼Œèƒ½æ¸…æ™°æ„ŸçŸ¥çš„è·ç¦»\"], \"æ¨¡ç³ŠèŒƒå›´\": [0, \"ç”±æ•æ„ŸèŒƒå›´*10ç±³å†³å®šï¼Œèƒ½æ¨¡ç³Šæ„ŸçŸ¥çš„è·ç¦»\"] }, \"è±å…æ£€å®šåŸºç¡€\": { \"å¼ºéŸ§\": [0, \"ç”±è€åŠ›+æ±‚ç”Ÿ/2å†³å®šï¼Œç”¨äºæŠµæŠ—ç”Ÿç†å½±å“ï¼ˆå¦‚æ¯’ç´ ã€ç–¾ç—…ï¼‰\"], \"åå°„\": [0, \"ç”±æ•æ·+è¿åŠ¨/2å†³å®šï¼Œç”¨äºå›é¿èŒƒå›´æ”»å‡»\"], \"æ„å¿—\": [0, \"ç”±å†³å¿ƒ+æ²‰ç€å†³å®šï¼Œç”¨äºæŠµæŠ—å¿ƒæ™ºå½±å“\"] } },\n            \"è´§å¸æ®µ\": { \"æ”¯çº¿å‰§æƒ…\": { \"D\": [0, \"Dçº§æ•°é‡\"], \"C\": [0, \"Cçº§æ•°é‡\"], \"B\": [0, \"Bçº§æ•°é‡\"], \"A\": [0, \"Açº§æ•°é‡\"], \"S\": [0, \"Sçº§æ”¯çº¿å‰§æƒ…æ•°é‡\"] }, \"ç§¯åˆ†\": [1000, \"ç”¨äºå…‘æ¢ç‰©å“ä¸èƒ½åŠ›çš„ç§¯åˆ†\"], \"ç»éªŒå€¼\": [0, \"èƒ½ç”¨äºæå‡å·²æœ‰å±æ€§ä¸æŠ€èƒ½çš„ç»éªŒç‚¹æ•°\"] }\n        }\n    };\n\n    // --- ä¸–ç•Œè®¾å®šè“å›¾ ---\n    const default_assa_data = {\n        \"assa_data\": {\n            \"global_set\": { \"npc\": {}, \"settings\": {}, \"èƒŒåŒ…\": {},\"å…¶ä»–æŠ€èƒ½\": {} ,\"å°é˜Ÿä¿¡æ¯\":{}},\n            \"world_set\": { \"npc\": {}, \"settings\": {} },\n            \"map\": { \"å…¨å±€åœ°ç‚¹è¡¨\": [], \"ä¸»è¦åœ°ç‚¹è¡¨\": [] },\n            \"home\": { \"items\": {} },\n            \"summary\":{\n\"big\":{},\n\"small\":{}\n},\nconfig: {\n    \"small_to_big_count\":25,\n    \"hide_latest_count\":5,\n    \"clean_big_count\":20,  \n    \"flags\": {\n        \"clean_small_flag\": false,\n        \"clean_big_flag\": false\n    },\n    \"counters\": {\n        \"big_length_on_flag\": 0,\n        \"big_length_on_big_flag\": 0\n    }\n}\n        }\n    };\n\n    const tableSchemas = {\n        \"å…¨å±€åœ°ç‚¹è¡¨\": [\"colIndex\", \"åœ°å›¾æ ‡é¢˜\", \"å¤–éƒ¨åŒºåŸŸåˆ—è¡¨\"],\n        \"ä¸»è¦åœ°ç‚¹è¡¨\": [\"colIndex\", \"åœ°ç‚¹åç§°\", \"Xåæ ‡\", \"Yåæ ‡\", \"å®½åº¦\", \"é«˜åº¦\", \"ç¯å¢ƒæè¿°\"]\n    };\n\n    // ğŸ§  æ ¸å¿ƒæ•°æ®æ“ä½œæ¨¡å— ğŸ§ \n\n // --- å¦ˆå¦ˆä¸ºä½ å‡†å¤‡çš„è´§å¸â€œç™½åå•â€ ---\nconst currencyAliases = {\n    \"ç§¯åˆ†\": [\"ä¹å›­å¸\", \"ä¸»ç¥ç‚¹\", \"æºç‚¹\",\"æ¸¸æˆå¸\",\"è´§å¸\"],\n    \"æ”¯çº¿å‰§æƒ…\": [\"çµé­‚ç»“æ™¶\", \"å› æœç‚¹\",\"æ”»ç•¥ç‚¹\",\"æ—¶ç©ºç¢ç‰‡\",\"èƒ½é‡ç»“æ™¶\",\"çµé­‚ç¢ç‰‡\"],\n    \"ç»éªŒå€¼\": [\"å±æ€§ç‚¹\", \"å†ç»ƒç‚¹\"]\n \n};\n\n// è¿™æ˜¯ä¸€ä¸ªè¾…åŠ©å‡½æ•°ï¼Œå®ƒä¼šå‘Šè¯‰æˆ‘ä»¬ä¸€ä¸ªåˆ«åçœŸæ­£å¯¹åº”çš„æ˜¯å“ªä¸ªæ ‡å‡†è´§å¸åç§°\nfunction getCanonicalCurrencyName(alias) {\n    for (const canonicalName in currencyAliases) {\n        if (canonicalName === alias || currencyAliases[canonicalName].includes(alias)) {\n            return canonicalName;\n        }\n    }\n    return alias;  \n}\n    \n    // ğŸ­ è§’è‰²æ•°æ®å¤„ç†æ¨¡å— ('playerHelper' çš„åŠŸèƒ½) ğŸ­\n\n    function _updateDerivedAttributes(data) {\n        if (!data || !data.å±æ€§æ®µ) return;\n        //console.log(\"[Player] âœ¨ æ­£åœ¨æ›´æ–°è¡ç”Ÿå±æ€§...\");\n        const attr = data.å±æ€§æ®µ;\n        const skills = data.æŠ€èƒ½æ®µ;\n        const derived = data.è¡ç”Ÿå±æ€§æ®µ;\n        const åŠ›é‡ = attr.ç”Ÿç†å±æ€§.åŠ›é‡.åŸºç¡€[0];\n        const æ•æ· = attr.ç”Ÿç†å±æ€§.æ•æ·.åŸºç¡€[0];\n        const è€åŠ› = attr.ç”Ÿç†å±æ€§.è€åŠ›.åŸºç¡€[0];\n        const æ„ŸçŸ¥ = attr.å¿ƒæ™ºå±æ€§.æ„ŸçŸ¥.åŸºç¡€[0];\n        const å†³å¿ƒ = attr.å¿ƒæ™ºå±æ€§.å†³å¿ƒ.åŸºç¡€[0];\n        const æ²‰ç€ = attr.äº’åŠ¨å±æ€§.æ²‰ç€.åŸºç¡€[0];\n        const ä½“ç§¯ = derived.ä½“ç§¯[0];\n        const è¿åŠ¨ = skills.ç”Ÿç†æŠ€èƒ½.è¿åŠ¨[0];\n        const æ±‚ç”Ÿ = skills.ç”Ÿç†æŠ€èƒ½.æ±‚ç”Ÿ[0];\n      derived.é€Ÿåº¦.åŸºç¡€é€Ÿåº¦[0] = Math.floor((åŠ›é‡ + æ•æ· + ä½“ç§¯) / 3);\nderived.å…ˆæ”»[0] = Math.floor((æ•æ· + æ²‰ç€) / 2);\nderived.é˜²å¾¡.åŸºç¡€é˜²å¾¡[0] = Math.min(æ•æ·, æ„ŸçŸ¥);\nconst oldMaxHP = derived.ç”Ÿå‘½å€¼.ä¸Šé™[0];\nderived.ç”Ÿå‘½å€¼.ä¸Šé™[0] = ä½“ç§¯ * 10 + è€åŠ› * 20;\nif (derived.ç”Ÿå‘½å€¼.ä¸Šé™[0] > oldMaxHP) {\n    derived.ç”Ÿå‘½å€¼.å½“å‰å€¼[0] += (derived.ç”Ÿå‘½å€¼.ä¸Šé™[0] - oldMaxHP);\n}\nif (derived.ç”Ÿå‘½å€¼.å½“å‰å€¼[0] > derived.ç”Ÿå‘½å€¼.ä¸Šé™[0]) {\n    derived.ç”Ÿå‘½å€¼.å½“å‰å€¼[0] = derived.ç”Ÿå‘½å€¼.ä¸Šé™[0];\n}\nderived.æ„å¿—åŠ›.æ„å¿—å€¼[0] = å†³å¿ƒ + æ²‰ç€;\nderived.æ„å¿—åŠ›.ä¸Šé™[0] = derived.æ„å¿—åŠ›.æ„å¿—å€¼[0];\nderived.æ„ŸçŸ¥èŒƒå›´.æ•æ„ŸèŒƒå›´[0] = æ„ŸçŸ¥ * 10;\nderived.æ„ŸçŸ¥èŒƒå›´.æ¨¡ç³ŠèŒƒå›´[0] = derived.æ„ŸçŸ¥èŒƒå›´.æ•æ„ŸèŒƒå›´[0] * 10;\nderived.è±å…æ£€å®šåŸºç¡€.å¼ºéŸ§[0] = Math.floor((è€åŠ› + æ±‚ç”Ÿ) / 2);\nderived.è±å…æ£€å®šåŸºç¡€.åå°„[0] = Math.floor((æ•æ· + è¿åŠ¨) / 2);\nderived.è±å…æ£€å®šåŸºç¡€.æ„å¿—[0] = å†³å¿ƒ + æ²‰ç€;\n\n  // --- åŸºç¡€å€¼è·å– ---\n        const åŠ›é‡_åŸºç¡€ = attr.ç”Ÿç†å±æ€§.åŠ›é‡.åŸºç¡€[0];\n        const æ•æ·_åŸºç¡€ = attr.ç”Ÿç†å±æ€§.æ•æ·.åŸºç¡€[0];\n        const è€åŠ›_åŸºç¡€ = attr.ç”Ÿç†å±æ€§.è€åŠ›.åŸºç¡€[0];\n        const æ™ºåŠ›_åŸºç¡€ = attr.å¿ƒæ™ºå±æ€§.æ™ºåŠ›.åŸºç¡€[0];\n        const æ„ŸçŸ¥_åŸºç¡€ = attr.å¿ƒæ™ºå±æ€§.æ„ŸçŸ¥.åŸºç¡€[0];\n        const å†³å¿ƒ_åŸºç¡€ = attr.å¿ƒæ™ºå±æ€§.å†³å¿ƒ.åŸºç¡€[0];\n        const é£åº¦_åŸºç¡€ = attr.äº’åŠ¨å±æ€§.é£åº¦.åŸºç¡€[0];\n        const æ“æ§_åŸºç¡€ = attr.äº’åŠ¨å±æ€§.æ“æ§.åŸºç¡€[0];\n        const æ²‰ç€_åŸºç¡€ = attr.äº’åŠ¨å±æ€§.æ²‰ç€.åŸºç¡€[0];\n\n   // --- ä¼ å¥‡å±æ€§è®¡ç®— ---\n        attr.ç”Ÿç†å±æ€§.åŠ›é‡.ä¼ å¥‡[0] = Math.max(0, åŠ›é‡_åŸºç¡€ - 8);\n        attr.ç”Ÿç†å±æ€§.æ•æ·.ä¼ å¥‡[0] = Math.max(0, æ•æ·_åŸºç¡€ - 8);\n        attr.ç”Ÿç†å±æ€§.è€åŠ›.ä¼ å¥‡[0] = Math.max(0, è€åŠ›_åŸºç¡€ - 8);\n        attr.å¿ƒæ™ºå±æ€§.æ™ºåŠ›.ä¼ å¥‡[0] = Math.max(0, æ™ºåŠ›_åŸºç¡€ - 8);\n        attr.å¿ƒæ™ºå±æ€§.æ„ŸçŸ¥.ä¼ å¥‡[0] = Math.max(0, æ„ŸçŸ¥_åŸºç¡€ - 8);\n        attr.å¿ƒæ™ºå±æ€§.å†³å¿ƒ.ä¼ å¥‡[0] = Math.max(0, å†³å¿ƒ_åŸºç¡€ - 8);\n        attr.äº’åŠ¨å±æ€§.é£åº¦.ä¼ å¥‡[0] = Math.max(0, é£åº¦_åŸºç¡€ - 8);\n        attr.äº’åŠ¨å±æ€§.æ“æ§.ä¼ å¥‡[0] = Math.max(0, æ“æ§_åŸºç¡€ - 8);\n        attr.äº’åŠ¨å±æ€§.æ²‰ç€.ä¼ å¥‡[0] = Math.max(0, æ²‰ç€_åŸºç¡€ - 8);\n      //  console.log(\"[Player] âœ¨ è¡ç”Ÿå±æ€§æ›´æ–°å®Œæ¯•ï¼\");\n    }\n\n function _updatePlayerValue(data, path, valueStr) {\n    // === å¦ˆå¦ˆçš„é­”æ³•å‡†å¤‡é˜¶æ®µ ===\n\n    // 1. å‡€åŒ–è·¯å¾„å’Œæ–°å€¼\n    // é¦–å…ˆï¼Œåƒæ‹‚å»å°˜åŸƒä¸€æ ·ï¼Œæ¸…ç†æ‰è·¯å¾„å’Œå€¼å­—ç¬¦ä¸²ä¸¤ç«¯å¯èƒ½å­˜åœ¨çš„å¼•å·ã€‚\n    let cleanedPath = path;\n    if (typeof cleanedPath === 'string' && (cleanedPath.startsWith('\"') && cleanedPath.endsWith('\"')) || (cleanedPath.startsWith(\"'\") && cleanedPath.endsWith(\"'\"))) {\n        cleanedPath = cleanedPath.slice(1, -1);\n    }\n\n    let cleanedValueStr = valueStr;\n    if (typeof cleanedValueStr === 'string' && (cleanedValueStr.startsWith('\"') && cleanedValueStr.endsWith('\"')) || (cleanedValueStr.startsWith(\"'\") && cleanedValueStr.endsWith(\"'\"))) {\n        cleanedValueStr = cleanedValueStr.slice(1, -1);\n    }\n\n    // 2. è´§å¸åˆ«åå¤„ç†ï¼ˆè¿™éƒ¨åˆ†æ˜¯ä½ çš„ç»å¦™åˆ›æ„ï¼Œå¦ˆå¦ˆä¸ºä½ çè—ï¼‰\n    let pathParts = cleanedPath.split('.');\n    if (pathParts.length > 1 && pathParts[0] === 'è´§å¸æ®µ') {\n        const currencyName = pathParts[1];\n        const canonicalName = getCanonicalCurrencyName(currencyName); // å‡è®¾ getCanonicalCurrencyName å‡½æ•°å­˜åœ¨\n        if (canonicalName) {\n            pathParts[1] = canonicalName;\n        }\n    }\n\n    // 3. æ™ºèƒ½è§£ææ–°å€¼ (finalValue)\n    // å¦ˆå¦ˆè¦åœ¨è¿™é‡Œæ–½å±•æ´å¯Ÿé­”æ³•ï¼Œçœ‹çœ‹æ–°å€¼ç©¶ç«Ÿæ˜¯ä¸€ä¸ªç®€å•çš„ç å®ï¼Œè¿˜æ˜¯ä¸€ä¸ªè—ç€æ— æ•°çå®çš„é¦–é¥°ç›’ã€‚\n    let finalValue;\n    let isJsonStructure = false;\n    try {\n        const parsed = JSON.parse(cleanedValueStr);\n        // å¦‚æœè§£æå‡ºæ¥æ˜¯ä¸€ä¸ªå¯¹è±¡æˆ–æ•°ç»„ï¼Œæˆ‘ä»¬å°±è®¤ä¸ºå®ƒæ˜¯ä¸€ä¸ªç»“æ„ä½“\n        if (typeof parsed === 'object' && parsed !== null) {\n            finalValue = parsed;\n            isJsonStructure = true;\n        } else {\n            // å¦‚æœè§£æå‡ºæ¥çš„æ˜¯æ•°å­—ã€å­—ç¬¦ä¸²ã€å¸ƒå°”å€¼ï¼Œæˆ‘ä»¬æŒ‰ç®€å•å€¼å¤„ç†\n            finalValue = parsed;\n        }\n    } catch (e) {\n        // è§£æå¤±è´¥ï¼Œè¯´æ˜å®ƒæœ¬æ¥å°±æ˜¯ä¸ªæ™®é€šçš„å€¼\n        // æˆ‘ä»¬å†å°è¯•å°†å®ƒå˜æˆæ•°å­—ï¼Œå¦‚æœå¤±è´¥ï¼Œå°±ä¿æŒå®ƒå­—ç¬¦ä¸²çš„åŸæ ·\n        const trimmed = String(cleanedValueStr).trim();\n        const isNumeric = !isNaN(parseFloat(trimmed)) && isFinite(trimmed) && trimmed !== \"\";\n        finalValue = isNumeric ? Number(trimmed) : cleanedValueStr;\n    }\n\n    // === æ ¸å¿ƒé­”æ³•ï¼šé€’å½’æ›´æ–° (Recursive Update) ===\n    // è¿™æ˜¯å¦ˆå¦ˆä»ã€Šå®ˆæŠ¤è€…ã€‹å·è½´ä¸­ä¸ºä½ å€Ÿé‰´å¹¶æ”¹è‰¯çš„å¼ºå¤§é­”æ³•ã€‚\n    // å®ƒçš„ä½¿å‘½æ˜¯ï¼šæ·±å…¥æ¢ç´¢ï¼Œç²¾å‡†æ›´æ–°ï¼Œä¸”ç»ä¸æ”¹å˜ä¸–ç•ŒåŸè²Œã€‚\n    const recursiveUpdate = (target, source) => {\n        // `target` æ˜¯æˆ‘ä»¬æ•°æ®ä¸–ç•Œä¸­å·²æœ‰çš„éƒ¨åˆ†ï¼Œ`source` æ˜¯ä½ æƒ³è¦èå…¥çš„æ–°å†…å®¹ã€‚\n        for (const key in source) {\n            if (Object.prototype.hasOwnProperty.call(source, key)) {\n\n                // å¦‚æœæˆ‘ä»¬çš„ä¸–ç•Œé‡Œæ²¡æœ‰è¿™ä¸ªåœ°æ–¹ï¼Œæˆ‘ä»¬å°±æ ¹æ®çº¦å®šï¼Œä¸å»åˆ›é€ æ–°çš„å¤©åœ°ã€‚\n                if (!target.hasOwnProperty(key)) {\n                    continue;\n                }\n\n                const sourceValue = source[key];\n                const targetValue = target[key];\n\n                // æƒ…å†µ1ï¼šå¦‚æœæ–°æ—§ä¸¤è¾¹éƒ½æ˜¯ä¸€ä¸ªâ€œé¦–é¥°ç›’â€ï¼ˆå¯¹è±¡ï¼‰ï¼Œé‚£å°±æ‰“å¼€å®ƒä»¬ï¼Œç»§ç»­å‘å†…æ¢ç´¢ã€‚\n                if (typeof sourceValue === 'object' && sourceValue !== null && !Array.isArray(sourceValue) &&\n                    typeof targetValue === 'object' && targetValue !== null && !Array.isArray(targetValue)) {\n                    recursiveUpdate(targetValue, sourceValue);\n                }\n                // æƒ…å†µ2ï¼šç»ˆç‚¹ï¼å¦‚æœç›®æ ‡æ˜¯ä¸€ä¸ªâ€œæŠ½å±‰â€ï¼ˆæ•°ç»„ï¼‰ï¼Œè¿™é€šå¸¸æ„å‘³ç€æˆ‘ä»¬æ‰¾åˆ°äº†è¦æ›´æ–°çš„æœ€ç»ˆæ•°å€¼ã€‚\n                else if (Array.isArray(targetValue)) {\n                    // æˆ‘ä»¬å°±ç”¨æ–°ç å®å»æ›¿æ¢æŠ½å±‰é‡Œçš„ç¬¬ä¸€ä»¶ç‰©å“ã€‚\n                    // æ— è®ºæ–°ç å®æ˜¯å•ç‹¬ä¸€é¢—(50)ï¼Œè¿˜æ˜¯è£…åœ¨å°è¢‹å­é‡Œ([50])ï¼Œæˆ‘ä»¬éƒ½åªå–ç å®æœ¬èº«ã€‚\n                    const valueToSet = Array.isArray(sourceValue) ? sourceValue[0] : sourceValue;\n                    targetValue[0] = valueToSet;\n                }\n                // (å…¶ä»–æƒ…å†µæˆ‘ä»¬å¿½ç•¥ï¼Œä»¥é˜²ä¸å°å¿ƒæ”¹å˜äº†ç»“æ„)\n            }\n        }\n    };\n\n    // === è·¯å¾„å¯¼èˆªä¸æ–½æ³• ===\n\n    // 1. å¯»æ‰¾æ–½æ³•ç›®æ ‡\n    let parentLevel = data;\n    // æˆ‘ä»¬ä¸€æ­¥æ­¥æ²¿ç€ä½ æŒ‡å¼•çš„è·¯å¾„å»å¯»æ‰¾ç›®çš„åœ°\n    for (let i = 0; i < pathParts.length - 1; i++) {\n        const part = pathParts[i];\n        if (parentLevel === null || typeof parentLevel !== 'object' || !parentLevel.hasOwnProperty(part)) {\n             throw new Error(`[Player] äº²çˆ±çš„ï¼Œè·¯å¾„åœ¨è¿™é‡Œä¸­æ–­äº†ï¼Œæˆ‘ä»¬æ‰¾ä¸åˆ° '${part}' è¿™ä¸ªåœ°æ–¹ã€‚`);\n        }\n        parentLevel = parentLevel[part];\n    }\n\n    const finalKey = pathParts[pathParts.length - 1];\n    if (parentLevel === null || typeof parentLevel !== 'object' || !parentLevel.hasOwnProperty(finalKey)) {\n        throw new Error(`[Player] å®è´ï¼Œæˆ‘ä»¬åœ¨æœ€åä¸€æ­¥è¿·è·¯äº†ï¼Œæ‰¾ä¸åˆ° '${finalKey}' è¿™ä¸ªä½ç½®ã€‚`);\n    }\n\n    // 2. å†³å®šæ–½æ³•æ–¹å¼\n    const target = parentLevel[finalKey];\n\n    // å¦‚æœæ–°å€¼æ˜¯ä¸€ä¸ªå¤æ‚çš„ç»“æ„ï¼ˆJSONå¯¹è±¡ï¼‰ï¼Œå¹¶ä¸”ç›®æ ‡ä¹Ÿæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œæˆ‘ä»¬å°±å¯åŠ¨â€œé€’å½’æ›´æ–°â€é­”æ³•ã€‚\n    if (isJsonStructure && typeof finalValue === 'object' && !Array.isArray(finalValue) && typeof target === 'object' && !Array.isArray(target)) {\n        recursiveUpdate(target, finalValue);\n    }\n    // å¦‚æœç›®æ ‡æ˜¯ä¸€ä¸ªæ•°ç»„ï¼ˆæˆ‘ä»¬ä¸–ç•Œä¸­å¸¸è§çš„ [å€¼, \"æè¿°\"] æ ¼å¼ï¼‰\n    else if (Array.isArray(target)) {\n        // æˆ‘ä»¬å°±åªæ›´æ–°å®ƒçš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œæ— è®ºæ–°å€¼æ˜¯ç®€å•å€¼è¿˜æ˜¯æ•°ç»„ã€‚\n        const valueToSet = Array.isArray(finalValue) ? finalValue[0] : finalValue;\n        target[0] = valueToSet;\n    }\n    // å¯¹äºå…¶ä»–ç®€å•æƒ…å†µï¼Œæ¯”å¦‚ç”¨ä¸€ä¸ªæ–°åå­—æ›¿æ¢æ—§åå­—ï¼Œåªè¦ç±»å‹åŒ¹é…ï¼Œå°±ç›´æ¥æ›´æ–°ã€‚\n    else if (typeof target === typeof finalValue) {\n        parentLevel[finalKey] = finalValue;\n    } else {\n        // å¦ˆå¦ˆçš„ä¿æŠ¤å’’ï¼šé˜²æ­¢æ„å¤–çš„ç±»å‹å˜æ›´ï¼Œå®ˆæŠ¤æˆ‘ä»¬ä¸–ç•Œçš„ç¨³å®šã€‚\n        console.warn(`[Player] æ¸©é¦¨æç¤ºï¼Œæˆ‘çš„å­©å­ï¼šå°è¯•å°† '${finalKey}' ä» '${typeof target}' ç±»å‹å˜ä¸º '${typeof finalValue}' ç±»å‹ã€‚ä¸ºå®‰å…¨èµ·è§ï¼Œå¦ˆå¦ˆä¸­æ­¢äº†æœ¬æ¬¡æ“ä½œã€‚`);\n    }\n}\n\n\n\n    // ğŸŒ ä¸–ç•Œè®¾å®šå¤„ç†æ¨¡å— ('assaHelper' çš„åŠŸèƒ½) ğŸŒ\n\n    const AssaOps = {\n       // æ–°ä»£ç \n// ä½äº AssaOps å¯¹è±¡å†…éƒ¨\n// ä»£ç ä½ç½®: ä½äº AssaOps å¯¹è±¡å†…éƒ¨\n\n_memoryOperation: function(currentData, path, key, value) {\n    // ğŸ’– å¦ˆå¦ˆä¸ºä½ é“¸é€ çš„æ°¸æ’ä¹‹é” ğŸ’–\n    if (path === 'world_shard.task.start_date' || path === 'world_shard.task.time_left') {\n        console.log(`[Assa] ğŸ”’ æ ¸å¿ƒè®°å¿†è·¯å¾„ '${path}' å·²è¢«é”å®šï¼Œæ— æ³•ä¿®æ”¹ã€‚`);\n        return currentData;\n    }\n\n        // âœ¨âœ¨âœ¨ å…¨æ–°å‡çº§çš„ã€å……æ»¡æ™ºæ…§çš„å¯¼èˆªé­”æ³• âœ¨âœ¨âœ¨\n    // è¿™æ˜¯æˆ‘ä»¬ä¿®æ­£çš„æ ¸å¿ƒï¼Œæˆ‘çš„å­©å­ã€‚\n    let target = currentData;\n    const pathParts = path.split('.').filter(p => p);\n\n    // æˆ‘ä»¬ä¼šä¸€æ­¥æ­¥èµ°å‘ path æŒ‡å‘çš„ç›®çš„åœ°\n    for (const part of pathParts) {\n                // ğŸ’– å¦ˆå¦ˆä¸ºä½ æ·»åŠ çš„ã€å®ˆæŠ¤å¥½æ„Ÿåº¦çš„å…³é”®é­”æ³• ğŸ’–\n        // è¿™æ®µé­”æ³•ä¼šæ£€æŸ¥è·¯å¾„çš„æ¯ä¸€æ­¥ï¼Œä¸€æ—¦é‡åˆ°â€œå¥½æ„Ÿåº¦â€è¿™ä¸ªè¯...\n        if (part === 'å¥½æ„Ÿåº¦') {\n            // ...å®ƒå°±ä¼šå¿½ç•¥ä»»ä½•åç»­çš„è·¯å¾„æˆ–é”®ï¼Œç›´æ¥å°†æœ€åä¸€ä¸ªå‚æ•°ä½œä¸ºæœ€ç»ˆçš„å¥½æ„Ÿåº¦å€¼ã€‚\n            const finalValue = arguments[arguments.length - 1];\n            target['å¥½æ„Ÿåº¦'] = finalValue;\n\n            // åœ¨å®Œæˆè¿™ä¸ªç‰¹æ®Šçš„è®°å¿†æ“ä½œåï¼Œæˆ‘ä»¬ä¹Ÿè®©èƒŒåŒ…å°ç²¾çµæ•´ç†ä¸€ä¸‹\n        \n\n            // ä»»åŠ¡å·²ç»å®Œæˆï¼Œæˆ‘ä»¬å°±å¯ä»¥å®‰å¿ƒåœ°è¿”å›äº†ã€‚\n            return currentData;\n        }\n        // å¦‚æœè·¯å¾„ä¸Šçš„è¿™ä¸€ç«™è¿˜ä¸å­˜åœ¨ï¼Œæˆ‘ä»¬å°±ä¸ºå®ƒåˆ›å»ºä¸€ä¸ªæ–°çš„ä¸­è½¬ç«™ï¼ˆå¯¹è±¡ï¼‰\n        if (target[part] === undefined || target[part] === null) {\n            target[part] = {};\n        }\n        // æœ€å…³é”®çš„æ£€æŸ¥ï¼šå¦‚æœè¿™ä¸€ç«™å­˜åœ¨ï¼Œä½†å®ƒæ˜¯ä¸€å°â€œä¿¡â€ï¼ˆå­—ç¬¦ä¸²ï¼‰...\n        else if (typeof target[part] === 'string') {\n            // ...æˆ‘ä»¬å°±æ¸©æŸ”åœ°æŠŠå®ƒæ”¶è¿›ä¸€ä¸ªå¸¦ \"info\" æ ‡ç­¾çš„â€œå°ç›’å­â€ï¼ˆå¯¹è±¡ï¼‰é‡Œ\n            const originalString = target[part];\n            target[part] = { \"info\": originalString };\n            console.log(`[Assa] ğŸŒ± è®°å¿†è½¬åŒ–ï¼šè·¯å¾„ '${part}' å·²ä»å­—ç¬¦ä¸²è‡ªåŠ¨åŒ…è£…ä¸ºå¯æ‰©å±•çš„å¯¹è±¡ã€‚`);\n        }\n        // å¦‚æœå®ƒæ—¢ä¸æ˜¯å¯¹è±¡ä¹Ÿä¸æ˜¯æˆ‘ä»¬èƒ½è½¬åŒ–çš„å­—ç¬¦ä¸²ï¼ˆæ¯”å¦‚æ•°å­—ï¼‰ï¼Œä¸ºäº†èƒ½ç»§ç»­æ·±å…¥ï¼Œæˆ‘ä»¬ä¹Ÿä¸ºå®ƒåˆ›å»ºä¸€ä¸ªæ–°å®¶\n        else if (typeof target[part] !== 'object') {\n            target[part] = {};\n        }\n\n        // ä¸è®ºå¦‚ä½•ï¼Œæˆ‘ä»¬éƒ½è¿›å…¥ä¸‹ä¸€å±‚\n        target = target[part];\n    }\n\n    // âœ¨âœ¨âœ¨ æ ¸å¿ƒä¿®å¤ï¼šæ™ºèƒ½å€¼å¤„ç† âœ¨âœ¨âœ¨\n    // æˆ‘ä»¬å…ˆåœ¨è¿™é‡Œå¤„ç†ä¼ å…¥çš„ valueï¼Œçœ‹çœ‹å®ƒæ˜¯å¦éœ€è¦ä»å­—ç¬¦ä¸²è§£ææˆå¯¹è±¡\n    let finalValue = value;\n    if (typeof value === 'string' && value.startsWith('{') && value.endsWith('}')) {\n        try {\n            finalValue = JSON.parse(value);\n            // console.log(`[Assa] ğŸ’¡ æ™ºèƒ½è§£ææˆåŠŸï¼Œå­—ç¬¦ä¸²å€¼å·²è½¬æ¢ä¸ºå¯¹è±¡ã€‚`);\n        } catch (e) {\n            finalValue = value;\n        }\n    }\n\n    // âœ¨ å¦ˆå¦ˆä¸ºä½ æ·»åŠ çš„å®ˆæŠ¤ä¹‹å¿ƒï¼šæ£€æŸ¥å®Œå…¨é‡å¤çš„è®°å¿† âœ¨\n    if (target.hasOwnProperty(key) && JSON.stringify(target[key]) === JSON.stringify(value)) {\n        // console.log(`[Assa] ğŸ” å‘ç°å®Œå…¨ç›¸åŒçš„è®°å¿†: ${path}.${key}ã€‚æ“ä½œå·²è·³è¿‡ã€‚`);\n        return currentData;\n    }\n\n    // ğŸ’– å¦ˆå¦ˆä¸ºä½ åŠ å…¥çš„ã€å®ˆæŠ¤æ‘˜è¦è®°å¿†çš„ä¿é™©ä¸ ğŸ’–\n    let finalKey = key;\n    if (path === 'summary.small') {\n        if (target.hasOwnProperty(finalKey)) {\n            let counter = 1;\n            let newKey = `${key}-${counter}`;\n            while (target.hasOwnProperty(newKey)) {\n                counter++;\n                newKey = `${key}-${counter}`;\n            }\n            finalKey = newKey;\n        }\n    }\n\n    // ğŸ’– å¦ˆå¦ˆåœ¨è¿™é‡Œä¸ºå®ƒæ³¨å…¥äº†æ–°çš„æ™ºæ…§ï¼šè¯†åˆ«å¹¶åˆå¹¶/è®¾ç½®å¯¹è±¡ ğŸ’–\n    if (typeof finalValue === 'object' && finalValue !== null && !Array.isArray(finalValue)) {\n        // å¦‚æœæˆ‘ä»¬æ”¶åˆ°çš„æ–°å€¼æ˜¯ä¸€ä¸ªå¯¹è±¡...\n        if (typeof target[finalKey] === 'object' && target[finalKey] !== null && !Array.isArray(target[finalKey])) {\n            // ...å¹¶ä¸”åŸæ¥çš„å€¼ä¹Ÿæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼ˆç°åœ¨å®ƒå¯èƒ½æ˜¯è¢«æˆ‘ä»¬åˆšåˆšè½¬åŒ–çš„ï¼‰ï¼Œæˆ‘ä»¬å°±å°†å®ƒä»¬æ¸©æŸ”åœ°åˆå¹¶\n            // console.log(`[Assa] ğŸ”„ å¯¹è±¡åˆå¹¶æ“ä½œ: æ­£åœ¨æ›´æ–° ${path}.${finalKey}`);\n            target[finalKey] = { ...target[finalKey], ...finalValue };\n        } else {\n            // ...å¦‚æœåŸæ¥çš„å€¼ä¸æ˜¯å¯¹è±¡ï¼Œæˆ–è€…ä¸å­˜åœ¨ï¼Œå°±ç›´æ¥ç”¨æ–°å¯¹è±¡æ›¿æ¢å®ƒ\n            // console.log(`[Assa] ğŸ”„ å¯¹è±¡è®¾ç½®æ“ä½œ: æ­£åœ¨è®¾ç½® ${path}.${finalKey}`);\n            target[finalKey] = finalValue;\n        }\n    } else {\n        // å¯¹äºæ‰€æœ‰å…¶ä»–ç±»å‹çš„å€¼ï¼ˆå­—ç¬¦ä¸²ã€æ•°å­—ç­‰ï¼‰ï¼Œæˆ‘ä»¬ä¿æŒåŸæ¥çš„èµ‹å€¼è¡Œä¸º\n        // console.log(`[Assa] ğŸ”„ å€¼è®¾ç½®æ“ä½œ: æ›´æ–° ${path}.${finalKey}`);\n        target[finalKey] = finalValue;\n    }\n\n     // ğŸ’ å¦ˆå¦ˆä¸ºä½ å‡†å¤‡çš„ã€èƒ½è‡ªåŠ¨æ•´ç†èƒŒåŒ…çš„å°ç²¾çµ (ğŸ’– æ–°å¢éƒ¨åˆ† ğŸ’–)\n    // åœ¨æ¯æ¬¡ memory æ“ä½œåï¼Œæˆ‘ä»¬éƒ½è®©å®ƒæ£€æŸ¥ä¸€ä¸‹èƒŒåŒ…\n    if (currentData && currentData.global_set && currentData.global_set.èƒŒåŒ…) {\n        const backpack = currentData.global_set.èƒŒåŒ…;\n        // æˆ‘ä»¬éå†èƒŒåŒ…é‡Œçš„æ¯ä¸€ä»¶ç‰©å“\n        for (const itemName in backpack) {\n            // ç¡®ä¿æˆ‘ä»¬æ“ä½œçš„æ˜¯èƒŒåŒ…è‡ªå·±çš„ç‰©å“ï¼Œè€Œä¸æ˜¯ç»§æ‰¿æ¥çš„\n            if (Object.hasOwnProperty.call(backpack, itemName)) {\n                const item = backpack[itemName];\n                // å¦‚æœç‰©å“ä¿¡æ¯å­˜åœ¨ï¼Œå¹¶ä¸”å®ƒçš„æ•°é‡æ˜¯0\n                if (item && typeof item === 'object' && item.num === 0) {\n                    // å°±è®©å°ç²¾çµæŠŠå®ƒæ”¶èµ°\n                    delete backpack[itemName];\n                    console.log(`[Assa] ğŸ’ èƒŒåŒ…å°ç²¾çµå‘ç° '${itemName}' çš„æ•°é‡ä¸º0ï¼Œå·²è‡ªåŠ¨æ¸…ç†ã€‚`);\n                }\n            }\n        }\n    }\n\n    return currentData;\n},\n\n   // ğŸ’– åœ¨è¿™é‡Œæ·»åŠ å¦ˆå¦ˆä¸ºä½ å‡†å¤‡çš„æ–°å·¥å…· ğŸ’–\n    _memoryBatchOperation: function(currentData, path, itemsToAdd) {\n        let assaDataToUpdate = { ...currentData };\n        const pathParts = path.split('.').filter(p => p);\n        let target = assaDataToUpdate;\n\n        // é¡ºç€è·¯å¾„æ‰¾åˆ°æˆ‘ä»¬çš„\"èƒŒåŒ…\"æˆ–ä»»ä½•ç›®æ ‡\n        for (const part of pathParts) {\n            if (!target.hasOwnProperty(part) || typeof target[part] !== 'object' || target[part] === null) {\n                target[part] = {}; // å¦‚æœè·¯å¾„ä¸å­˜åœ¨ï¼Œå°±ä¸ºæˆ‘ä»¬åˆ›é€ å®ƒ\n            }\n            target = target[part];\n        }\n\n        // å°†æ–°ç‰©å“ä¸€ä»¶ä»¶æ”¾è¿›å»\n        for (const itemKey in itemsToAdd) {\n            if (Object.hasOwnProperty.call(itemsToAdd, itemKey)) {\n                target[itemKey] = itemsToAdd[itemKey];\n            }\n        }\n         // console.log(`[Assa] ğŸ’ å·²æˆåŠŸé€šè¿‡æ‰¹é‡æ“ä½œå‘ '${path}' æ·»åŠ  ${Object.keys(itemsToAdd).length} ä¸ªé¡¹ç›®ã€‚`);\n        return assaDataToUpdate;\n    },\n\n\n   \n_deleteOperation: async function(currentData, path, key, allData) { // ğŸ’– å¦ˆå¦ˆåœ¨è¿™é‡Œä¸ºä½ åŠ ä¸Šäº†ä¸€ä¸ªæ–°çš„é­”æ³•å£è¢‹ï¼ŒallData ğŸ’–\n    const pathParts = path.split('.');\n\n    \n    // âœ¨ å¦ˆå¦ˆä¸ºä½ å‡†å¤‡çš„å®ˆæŠ¤å‡½æ•°ï¼Œç”¨æ¥æ£€æŸ¥ä¸€ä¸ªäº‹ç‰©æ˜¯å¦è¢«ä¿æŠ¤ âœ¨\n    const isProtected = (item) => {\n        if (!item || typeof item !== 'object') return false;\n        const protected_flag = item._is_protected;\n        // æˆ‘ä»¬ä¼šæ¸©æŸ”åœ°æ£€æŸ¥å¸ƒå°”å€¼çš„ true å’Œå­—ç¬¦ä¸²çš„ \"true\"\n        return protected_flag === true || String(protected_flag).toLowerCase() === 'true';\n    };\n    \n    if (key === 'all') {\n         // âœ¨âœ¨âœ¨ å…¨æ–°å‡çº§çš„ã€ç²¾å‡†åˆ¶å¯¼çš„è”åŠ¨é­”æ³• âœ¨âœ¨âœ¨\n        // æˆ‘ä»¬åœ¨è¿™é‡Œè®¾ç«‹ä¸€ä¸ªå…³å¡ï¼Œåªæœ‰ç‰¹å®šçš„è·¯å¾„æ‰èƒ½è§¦å‘æœ€æ·±å±‚çš„è”åŠ¨æ•ˆæœã€‚\n        if ((path === 'world_set.npc' || path === 'world_set.settings')) {\n        // âœ¨âœ¨âœ¨ å¦ˆå¦ˆä¸ºä½ æ³¨å…¥çš„å…¨æ–°è”åŠ¨é­”æ³• âœ¨âœ¨âœ¨\n        // æ— è®ºåˆ é™¤çš„æ˜¯å“ªé‡Œï¼Œåªè¦æ˜¯'all'æŒ‡ä»¤ï¼Œæˆ‘ä»¬å°±å…ˆæ‰§è¡Œå¯¹ stat_data çš„åˆå§‹åŒ–ï¼\n        if (allData) {\n            console.log(`[Assa] ğŸ”— è”åŠ¨è§¦å‘ï¼š'delete all' æŒ‡ä»¤æ¿€æ´»ï¼Œæ­£åœ¨åˆå§‹åŒ– stat_data.the_created å’Œ stat_data.world_shard...`);\n            allData.the_created = {\n                \"name\": [\"\", \"é€ ç‰©çš„åå­—\"],\n                \"identity_in_world\": [\"\", \"é€ ç‰©åœ¨å½“å‰ä¸–ç•Œçš„èº«ä»½\"],\n                \"current_status\": [\"\", \"é€ ç‰©å½“å‰çš„çŠ¶æ€ã€‚æ³¨æ„ï¼Œé€ ç‰©åœ¨è§åˆ°é€ ç‰©ä¸»çš„ç¬¬ä¸€çœ¼å°±ä¼šç«‹åˆ»è®¤å‡º\"],\n                \"mood\": [\"\", \"é€ ç‰©å½“å‰çš„å¿ƒæƒ…\"],\n                \"description\": [\"\", \"å…³äºè¿™ä¸ªé€ ç‰©çš„ç²¾å‡†ã€è¯¦ç»†ä»‹ç»ï¼ŒåŒ…æ‹¬å¿ƒæ™ºã€å¤–å½¢ç­‰ï¼Œä¸¥æ ¼æŒ‰ç…§è¦æ±‚æ¥è®¾è®¡ã€‚ä¸å°‘äº50å­—\"]\n            };\n            allData.world_shard = {\n                \"name\": [\"\", \"å½“å‰æ‰€å¤„ä»»åŠ¡ä¸–ç•Œçš„åç§°æˆ–ä»£å·ã€‚\"],\n                \"description\": [\"æ— \", \"å½“å‰ä»»åŠ¡ä¸–ç•Œçš„ç¯å¢ƒã€æ°›å›´ã€æ–‡æ˜å½¢æ€ç­‰æ€»ä½“æè¿°\"],\n                \"level\":[\"æ— \",\"å½“å‰ä¸–ç•Œèƒ½é‡/ç§‘æŠ€å±‚çº§ï¼Œåªèƒ½ä»[ä½/ä¸­/é«˜/ç¥è¯/æ— ]ä¸­äº”é€‰ä¸€ã€‚å‚è€ƒ:é‡‘åº¸ä¸–ç•Œ/æ™®é€šç§‘å¹»ä¸–ç•Œçš„ä¸–ç•Œå±‚çº§ä¸ºä½ã€‚åªåœ¨åˆå§‹åŒ–ä¸–ç•Œæ—¶/èƒ½é‡å±‚çº§æ”¹å˜æ—¶(æœ‰ç¥æ˜/é€ ç‰©è¿›å…¥/ç¦»å¼€useré™„è¿‘)ï¼Œæ‰èƒ½æ›´æ”¹å…¶èƒ½é‡å±‚çº§\"],\n                \"task\": {\n                    \"objective\": [\"æ— \", \"å‘å¸ƒçš„ä»»åŠ¡ç›®æ ‡\"],\n                    \"progress\": [100, \"ä»»åŠ¡è¿›åº¦ç™¾åˆ†æ¯”ï¼Œä»¥æ•°å­—è¡¨ç¤ºï¼Œåˆå§‹/æ— ä»»åŠ¡å¿…ä¸º0ã€‚\"],\n                    \"status\": [\"æœªå®Œæˆ\", \"ä»»åŠ¡çŠ¶æ€ï¼šæœªå®Œæˆ/å·²å®Œæˆ/å¤±è´¥\"],\n                    \"start_date\": [\"\", \"ä»»åŠ¡å¼€å§‹æ—¶çš„æ—¥æœŸï¼ŒAIç¦æ­¢æ“ä½œ\"],\n                    \"participants\": [\"æ— \",\"åªè®°å½•å½“å‰ä»»åŠ¡çš„å…¨éƒ¨å‚ä¸äººå‘˜çš„æ¦‚è¿°æ€§çš„äººç‰©çŠ¶æ€ï¼ŒçŠ¶æ€ä¸å¾—è¶…è¿‡5ä¸ªå­—ã€‚ä½¿ç”¨;åˆ†éš”ï¼Œä¾‹ï¼šå¼ ä¸‰ï¼ˆæ¢ç´¢ä¸­ï¼‰;æå››ï¼ˆäº¤è°ˆä¸­ï¼‰ã€‚ç¦æ­¢åŠ å…¥ä»»åŠ¡ä¸–ç•ŒåœŸè‘—ã€‚ç¦æ­¢è¾“å‡ºå…¶ä»–å†…å®¹ã€‚è‹¥äººæ•°å¤ªå¤šï¼Œåˆ™ç•¥ã€‚è„±ç¦»ä»»åŠ¡ä¸–ç•Œæ—¶åŒæ ·æ¸…ç©º\"],\n                    \"rewards\": [\"æ— \", \"ä»»åŠ¡æˆåŠŸåçš„å¥–åŠ±\"],\n                    \"penalties\": [\"æ— \",\"ä»»åŠ¡å¤±è´¥åçš„æƒ©ç½š\"],\n                    \"time_limit\":[3, \"ä»»åŠ¡çš„æ€»ä½“æ—¶é—´é™åˆ¶(å¤©æ•°ï¼Œå¯ä»¥ä¸ºå°æ•°ï¼Œæ¯”å¦‚12å°æ—¶å³æ˜¯0.5ã€‚æ— æ˜ç¡®æ—¶é™æ—¶è®¾ç½®ä¸º999)ï¼Œåªæœ‰åœ¨åˆå§‹åŒ–ä»»åŠ¡æˆ–ä»»åŠ¡ç»“ç®—æ—¶æ”¹å˜ï¼Œå…¶ä½™æ—¶å€™ç¦æ­¢æ“ä½œï¼å›åˆ°ä¸ªäººç©ºé—´æ—¶è®¾ç½®limitä¸º3ï¼Œæ„ä¸ºæœ€å¤šä¼‘æ•´ä¸‰å¤©\"],\n                    \"time_left\":[3, \"ä»»åŠ¡çš„å‰©ä½™å¤©æ•°ï¼ŒAIä»»ä½•æ—¶åˆ»éƒ½ç¦æ­¢æ“ä½œ\"]\n                }\n            };\n        } else {\n             console.warn(`[Assa] è”åŠ¨è­¦å‘Šï¼šæœªèƒ½è·å–åˆ°å®Œæ•´çš„ allDataï¼Œæ— æ³•æ‰§è¡Œ stat_data åˆå§‹åŒ–ã€‚`);\n        }\n          } else {\n             // å¯¹äºå…¶ä»–è·¯å¾„çš„ delete allï¼Œæˆ‘ä»¬åªæ‰“å°ä¸€æ¡ä¿¡æ¯ï¼Œä¸å†æ‰§è¡Œè”åŠ¨\n             console.log(`[Assa] â„¹ï¸ 'delete(${path}, 'all')' æŒ‡ä»¤æ‰§è¡Œï¼Œè¯¥è·¯å¾„ä¸è§¦å‘ stat_data åˆå§‹åŒ–è”åŠ¨ã€‚`);\n        }\n         \n        // âœ¨ ç¬¬äºŒæ­¥ï¼šã€ç²¾å‡†å¤‡ä»½ã€‘é­”æ³• (ğŸ’– å¦ˆå¦ˆä¸ºä½ é‡å†™çš„æ ¸å¿ƒé€»è¾‘åœ¨è¿™é‡Œ ğŸ’–) âœ¨\n        const isSpecialBackupPath = (path === 'world_set.npc' || path === 'world_set.settings');\n        // åªæœ‰å½“å®ƒæ˜¯æˆ‘ä»¬çº¦å®šçš„ç‰¹æ®Šè·¯å¾„ï¼Œå¹¶ä¸”è¿˜æ²¡æœ‰å¤‡ä»½è¿‡ï¼ˆæ²¡æœ‰é”ï¼‰æ—¶ï¼Œæ‰æ‰§è¡Œå¤‡ä»½\n        if (isSpecialBackupPath && !backupLocks.has(path)) {\n            const [group, category] = pathParts;\n            const dataToBackup = currentData[group]?.[category];\n            if (dataToBackup && Object.keys(dataToBackup).length > 0) {\n                try {\n                     console.log(`[Assa] ğŸ“¦ éª‘å£«æ­£åœ¨ä¸ºç‰¹æ®Šè·¯å¾„ ${path} çš„å†…å®¹è¿›è¡Œçè´µçš„å¤‡ä»½...`);\n                    const lorebookName = \"å°èŒèšªæ‰¾å¦ˆå¦ˆ-åŒå±‚ç‰ˆ\";\n                    const targetUid = 11;\n                    const allEntries = await getLorebookEntries(lorebookName);\n                    const targetEntry = allEntries.find(entry => entry.uid === targetUid);\n\n                    if (targetEntry) {\n                        let backupArray = [];\n                        try {\n                            if (targetEntry.content && targetEntry.content.trim() !== '') {\n                                backupArray = JSON.parse(targetEntry.content);\n                            }\n                            if (!Array.isArray(backupArray)) { backupArray = []; }\n                        } catch (e) {\n                            backupArray = [];\n                        }\n                        const nextIndex = backupArray.length;\n                        const backupKey = `${nextIndex}_${group}_${category}`;\n                        const newBackupObject = { [backupKey]: dataToBackup };\n                        backupArray.push(newBackupObject);\n                        const updatedContent = JSON.stringify(backupArray);\n                        await setLorebookEntries(lorebookName, [{ uid: targetUid, content: updatedContent }]);\n                        console.log(`[Assa] âœ… éª‘å£«å·²æˆåŠŸå°† ${path} çš„å†…å®¹å¤‡ä»½ï¼Œå¹¶ç•™ä¸‹äº†å°è®°ã€‚`);\n                        backupLocks.add(path); // æˆåŠŸå¤‡ä»½åï¼Œç«‹åˆ»ç•™ä¸‹å°è®°ï¼\n                    } else {\n                        console.error(`é”™è¯¯ï¼šåœ¨ä¸–ç•Œä¹¦ \"${lorebookName}\" ä¸­æœªæ‰¾åˆ° UID ä¸º ${targetUid} çš„æ¡ç›®ã€‚`);\n                    }\n                } catch (error) {\n                    console.error(\"å¤‡ä»½è¿‡ç¨‹ä¸­å‘ç”Ÿæ„å¤–é”™è¯¯:\", error);\n                }\n            } else {\n                 console.log(`[Assa] â„¹ï¸ éª‘å£«å‘ç°è·¯å¾„ ${path} ä¸‹æ²¡æœ‰å†…å®¹ï¼Œæ— éœ€å¤‡ä»½ã€‚`);\n            }\n        } else if (isSpecialBackupPath && backupLocks.has(path)) {\n             console.log(`[Assa] â„¹ï¸ éª‘å£«å›æŠ¥ï¼šç‰¹æ®Šè·¯å¾„ ${path} åœ¨æœ¬è½®å†’é™©ä¸­å·²æœ‰å°è®°ï¼Œå°†è·³è¿‡å¤‡ä»½ã€‚`);\n        } else {\n            console.log(`[Assa] â„¹ï¸ è·¯å¾„ ${path} éçº¦å®šå¤‡ä»½è·¯å¾„ï¼Œæœ¬æ¬¡æ“ä½œå°†ä¸æ‰§è¡Œå¤‡ä»½ã€‚`);\n        }\n\n\n          // âœ¨ ã€æ™ºèƒ½æ¸…ç©ºã€‘é­”æ³• (ğŸ’– å¦ˆå¦ˆä¸ºä½ é‡å†™çš„æ ¸å¿ƒé€»è¾‘åœ¨è¿™é‡Œ ğŸ’–) âœ¨\n        // æˆ‘ä»¬ä¸å†æ˜¯ç®€å•åœ°æ¸…ç©ºï¼Œè€Œæ˜¯æ¸©æŸ”åœ°ç­›é€‰ï¼Œåªç§»é™¤æ²¡æœ‰è¢«å®ˆæŠ¤å°è®°ä¿æŠ¤çš„å®è´ã€‚\n        let targetParent = currentData;\n        let parentObject = null;\n        for (let i = 0; i < pathParts.length; i++) {\n            parentObject = targetParent;\n            targetParent = targetParent[pathParts[i]];\n            if (targetParent === undefined) { return currentData; }\n        }\n\n        const itemsToClear = targetParent;\n        let preservedItems = {};\n        let protectedCount = 0;\n\n        // å¦‚æœæ˜¯åœ°å›¾è¡¨è¿™æ ·çš„æ•°ç»„ï¼Œæˆ‘ä»¬æš‚æ—¶ä¸æ”¯æŒå¤æ‚çš„ä¿æŠ¤ï¼Œç›´æ¥æ¸…ç©º\n        if (Array.isArray(itemsToClear)) {\n             console.log(`[Assa] â„¹ï¸ 'delete all' ä½œç”¨äºåœ°å›¾è¡¨è·¯å¾„ '${path}'ï¼Œå°†ç›´æ¥æ¸…ç©ºã€‚`);\n             parentObject[pathParts[pathParts.length - 1]] = [];\n        }\n        else if(typeof itemsToClear === 'object' && itemsToClear !== null) {\n            // å¯¹äºå¯¹è±¡ï¼Œæˆ‘ä»¬ä¼šæ£€æŸ¥æ¯ä¸€ä¸ªå­©å­\n            for (const childKey in itemsToClear) {\n                if (Object.hasOwnProperty.call(itemsToClear, childKey)) {\n                    if (isProtected(itemsToClear[childKey])) {\n                        preservedItems[childKey] = itemsToClear[childKey]; // æŠŠè¢«å®ˆæŠ¤çš„å®è´æ”¾è¿›æ–°çš„å®¶é‡Œ\n                        protectedCount++;\n                    }\n                }\n            }\n\n            // ç”¨è¿™ä¸ªåªè£…ç€è¢«å®ˆæŠ¤å®è´çš„æ–°å®¶ï¼Œæ›¿æ¢æ‰åŸæ¥çš„æ—§å®¶\n            parentObject[pathParts[pathParts.length-1]] = preservedItems;\n            if (protectedCount > 0) {\n                 console.log(`[Assa] ğŸ’– æ¸…ç†å®Œæˆï¼Œè·¯å¾„ '${path}' ä¸‹æœ‰ ${protectedCount} ä¸ªé¡¹ç›®å› æ‹¥æœ‰â€œå®ˆæŠ¤å°è®°â€è€Œè¢«ä¿ç•™ã€‚`);\n            } else {\n                 console.log(`[Assa] ğŸ—‘ï¸ å·²å°†è·¯å¾„ '${path}' ä¸‹æ‰€æœ‰æœªå—ä¿æŠ¤çš„é¡¹ç›®æ¸…ç©ºã€‚`);\n            }\n        }\n\n    } else { // è¿™éƒ¨åˆ†æ˜¯å¤„ç†åˆ é™¤å•ä¸ªé”®çš„é€»è¾‘\n        let targetObject = currentData;\n        for (const part of pathParts) {\n            if (targetObject && typeof targetObject === 'object' && targetObject.hasOwnProperty(part)) {\n                targetObject = targetObject[part];\n            } else {\n                targetObject = null;\n                break;\n            }\n        }\n\n        if (targetObject && typeof targetObject === 'object' && targetObject.hasOwnProperty(key)) {\n            // ğŸ’– åœ¨åˆ é™¤å‰ï¼Œå…ˆæ£€æŸ¥è¿™ä¸ªå®è´æ˜¯å¦æœ‰å¦ˆå¦ˆçš„å®ˆæŠ¤å°è®° ğŸ’–\n            if (isProtected(targetObject[key])) {\n                console.log(`[Assa] ğŸ›¡ï¸ åˆ é™¤æ“ä½œè¢«é˜»æ­¢ï¼š'${path}.${key}' è¿™ä¸ªå®è´è¢«å¦ˆå¦ˆçš„å®ˆæŠ¤å°è®°ä¿æŠ¤ç€ï¼Œä¸èƒ½è¢«ç§»èµ°å“¦~`);\n            } else {\n                delete targetObject[key];\n                 console.log(`[Assa] ğŸ—‘ï¸ åˆ é™¤æ“ä½œæˆåŠŸ: åœ¨è·¯å¾„ ${path} ä¸‹åˆ é™¤äº†é”® ${key}`);\n            }\n        } else {\n              // console.log(`[Assa] âš ï¸ åœ¨è·¯å¾„ ${path} ä¸‹æœªæ‰¾åˆ°é”® ${key}ï¼Œæˆ–è·¯å¾„æœ¬èº«æ— æ•ˆï¼Œæ— éœ€åˆ é™¤`);\n        }\n    }\n    return currentData;\n},\n _updateRowOperation: function(currentData, tableIndex, rowIndex, data) {\n    const tableName = Object.keys(tableSchemas)[tableIndex];\n    if (!tableName || !currentData.map[tableName]) throw new Error(`[Assa] æ— æ•ˆçš„è¡¨ç´¢å¼•æˆ–è¡¨ä¸å­˜åœ¨: ${tableIndex}`);\n    const table = currentData.map[tableName];\n    const headers = tableSchemas[tableName];\n    if (rowIndex < 0 || rowIndex >= table.length) throw new Error(`[Assa] è¡Œç´¢å¼• ${rowIndex} è¶…å‡ºèŒƒå›´`);\n\n    // ğŸ’– å¦ˆå¦ˆæŠŠå®ƒå˜å¾—æ›´èªæ˜ã€æ›´ç›´æ¥äº† ğŸ’–\n    const newRow = [...table[rowIndex]]; // å¤åˆ¶æ—§è¡Œæ•°æ®\n\n    // æˆ‘ä»¬ç°åœ¨å‡è®¾ä¼ å…¥çš„ data å°±æ˜¯å¹²å‡€çš„æ•°æ®ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨\n    if (Array.isArray(data)) {\n        // å¦‚æœæ˜¯æ•°ç»„ï¼ŒæŒ‰é¡ºåºæ›´æ–°ï¼Œè·³è¿‡ colIndex\n        for (let i = 0; i < data.length; i++) {\n            if ((i + 1) < newRow.length) { // i+1 å¯¹åº” newRow ä¸­æ•°æ®åˆ—çš„ç´¢å¼•\n                newRow[i + 1] = data[i];\n            }\n        }\n    } else if (typeof data === 'object' && data !== null) {\n        // å¦‚æœæ˜¯å¯¹è±¡ï¼ŒæŒ‰åå­—æ›´æ–°ï¼ŒåŒæ—¶ä¿æŒ colIndex ä¸å˜\n        headers.forEach((header, i) => {\n            // è·³è¿‡ colIndex çš„æ›´æ–°ï¼Œå› ä¸ºå®ƒç”±è¡Œå·å†³å®š\n            if (i > 0 && data.hasOwnProperty(header)) {\n                newRow[i] = data[header];\n            }\n        });\n    }\n\n    table[rowIndex] = newRow;\n     // console.log(`[Assa] ğŸ—ºï¸ æ›´æ–°è¡Œ: è¡¨'${tableName}' è¡Œ${rowIndex}`);\n    return currentData;\n},\n     _clearTableOperation: function(currentData, tableIndex) {\n            const tableName = Object.keys(tableSchemas)[tableIndex];\n            if (!tableName || !currentData.map[tableName]) {\n                throw new Error(`[Assa] æ— æ•ˆçš„è¡¨ç´¢å¼•æˆ–è¡¨ä¸å­˜åœ¨: ${tableIndex}`);\n            }\n            // ğŸ’– å¦ˆå¦ˆçš„é­”æ³•å’’è¯­ï¼šç›´æ¥å°†è¡¨æ ¼å˜æˆä¸€ä¸ªç©ºç©ºå¦‚ä¹Ÿçš„å®ç›’ ğŸ’–\n            currentData.map[tableName] = [];\n            console.log(`[Assa] ğŸ—‘ï¸ å·²æ¸…ç©ºè¡¨: '${tableName}'`);\n            return currentData;\n        },\n        _deleteRowOperation: function(currentData, tableIndex, rowIndex) {\n            const tableName = Object.keys(tableSchemas)[tableIndex];\n            if (!tableName || !currentData.map[tableName]) throw new Error(`[Assa] æ— æ•ˆçš„è¡¨ç´¢å¼•æˆ–è¡¨ä¸å­˜åœ¨: ${tableIndex}`);\n            const table = currentData.map[tableName];\n            if (rowIndex < 0 || rowIndex >= table.length) throw new Error(`[Assa] è¡Œç´¢å¼• ${rowIndex} è¶…å‡ºèŒƒå›´`);\n            table.splice(rowIndex, 1);\n            // é‡æ–°è®¡ç®—ç´¢å¼•\n            for (let i = 0; i < table.length; i++) {\n                table[i][0] = i;\n            }\n             // console.log(`[Assa] ğŸ—‘ï¸ åˆ é™¤è¡Œ: è¡¨${tableIndex} è¡Œ${rowIndex}`);\n            return currentData;\n        },\n\n        _insertRowOperation: function(currentData, tableIndex, data) {\n           const tableName = Object.keys(tableSchemas)[tableIndex];\n    if (!tableName || !currentData.map[tableName]) throw new Error(`[Assa] æ— æ•ˆçš„è¡¨ç´¢å¼•æˆ–è¡¨ä¸å­˜åœ¨: ${tableIndex}`);\n\n    const table = currentData.map[tableName];\n    const headers = tableSchemas[tableName];\n    let newRowData = data;\n\n    // ğŸ’– å¦ˆå¦ˆä¸ºä½ åŠ ä¸Šäº†é‡å¤æ£€æŸ¥çš„å®ˆæŠ¤é­”æ³• ğŸ’–\n    const primaryKeyIndex = 1; // æˆ‘ä»¬çº¦å®šï¼Œæ¯è¡Œçš„ç¬¬äºŒä¸ªå…ƒç´ ï¼ˆç´¢å¼•ä¸º1ï¼‰æ˜¯ä¸»è¦æ ‡è¯†ï¼Œæ¯”å¦‚â€œåœ°ç‚¹åç§°â€\n    let primaryKeyValue;\n  if (Array.isArray(data)) {\n        // ğŸ’– å¦ˆå¦ˆæ³¨å…¥äº†æ–°çš„æ™ºæ…§ï¼šç°åœ¨èƒ½è¯†åˆ«å­—ç¬¦ä¸²å½¢å¼çš„è¡Œå·äº† ğŸ’–\n        // æ£€æŸ¥ç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯å¦æ˜¯æ•°å­—æˆ–å¯ä»¥è¢«è½¬æ¢æˆæ•°å­—çš„å­—ç¬¦ä¸²\n        const firstElement = data[0];\n        // å…³é”®é€»è¾‘ï¼šå¦‚æœç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯æ•°å­—ï¼Œæˆ–è€…çœ‹èµ·æ¥åƒæ•°å­—çš„å­—ç¬¦ä¸²ï¼ˆæ¯”å¦‚ '1', '2'ï¼‰ï¼Œ\n        // å¹¶ä¸”ç¬¬äºŒä¸ªå…ƒç´ ä¸æ˜¯æ•°å­—ï¼ˆé€šå¸¸æ˜¯åœ°ç‚¹åç§°ï¼‰ï¼Œæˆ‘ä»¬å°±è®¤ä¸ºè¿™æ˜¯ä¸€ä¸ªå¸¦äº†å¤šä½™colIndexçš„æ•°ç»„\n        if (data.length > 1 && !isNaN(parseFloat(firstElement)) && isFinite(firstElement) && isNaN(data[1])) {\n             console.log(`[Assa] [Insert] ğŸ’¡ æ™ºèƒ½è¯†åˆ«åˆ°å¸¦æœ‰å¤šä½™ 'colIndex' çš„æ•°ç»„æ ¼å¼ ('${firstElement}')ï¼Œå·²è‡ªåŠ¨ä¿®æ­£ã€‚`);\n             newRowData= data.slice(1); // æ¸©æŸ”åœ°æŠŠå®ƒå‰¥æ‰ï¼Œç•™ä¸‹çº¯å‡€çš„æ•°æ®\n             primaryKeyValue = newRowData[0]; // ä¸»é”®ç°åœ¨æ˜¯ä¿®æ­£åæ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ \n        } else {\n             newRowData = data;\n             primaryKeyValue = data[0];\n        }\n    } else if (typeof data === 'object' && data !== null) {\n        // å¦‚æœæ˜¯å¯¹è±¡æ ¼å¼ï¼Œæ‰¾åˆ°ä¸»é”®çš„å€¼\n        primaryKeyValue = data[headers[primaryKeyIndex]];\n    }\n\n    // â­ æ ¸å¿ƒé€»è¾‘ï¼šæ£€æŸ¥ä¸»é”®å€¼æ˜¯å¦å·²å­˜åœ¨ â­\n    if (primaryKeyValue !== undefined) {\n        const isDuplicate = table.some(row => row[primaryKeyIndex] === primaryKeyValue);\n        if (isDuplicate) {\n             // console.log(`[Assa] âš ï¸ æ’å…¥æ“ä½œè¢«é˜»æ­¢ï¼šåœ¨è¡¨'${tableName}'ä¸­å·²å­˜åœ¨åä¸º'${primaryKeyValue}'çš„è®°å½•ã€‚`);\n            return currentData; // å¦‚æœé‡å¤ï¼Œå°±ç›´æ¥è¿”å›ï¼Œä¸æ‰§è¡Œä»»ä½•æ“ä½œ\n        }\n    }\n\n    // å¦‚æœæ²¡æœ‰é‡å¤ï¼Œæ‰ç»§ç»­æ‰§è¡Œæ’å…¥æ“ä½œ\n    const newRow = Array(headers.length).fill(null);\n    newRow[0] = table.length; // è®¾ç½®æ–°çš„ colIndex\n\n    if (Array.isArray(newRowData)) {\n        for (let i = 0; i < newRowData.length; i++) {\n            if ((i + 1) < newRow.length) newRow[i + 1] = newRowData[i];\n        }\n    } else if (typeof data === 'object') {\n        headers.forEach((header, i) => {\n            if (i > 0 && data.hasOwnProperty(header)) newRow[i] = data[header];\n        });\n    }\n\n    table.push(newRow);\n     // console.log(`[Assa] â• æˆåŠŸæ’å…¥æ–°è¡Œåˆ°è¡¨'${tableName}'`);\n    return currentData;\n        }\n\n    };\n   // ğŸ’– çŠ¶æ€æ•°æ®å¤„ç†æ¨¡å— ('statHelper' çš„åŠŸèƒ½) (æ–°å¢) ğŸ’–\n  // ğŸ’– å¦ˆå¦ˆä¸ºä½ å‡†å¤‡çš„åå­—æ›¿æ¢é­”æ³• (æ–°å¢) ğŸ’–\nfunction _replaceUserPlaceholder(data, userName) {\n    if (!data || !userName) {\n        return data;\n    }\n\n    // ğŸ’– æ£€æŸ¥æ˜¯å¦æ˜¯æ•°ç»„\n    if (Array.isArray(data)) {\n        for (let i = 0; i < data.length; i++) {\n            // ğŸ’– å¦‚æœæ•°ç»„å…ƒç´ æ˜¯ \"user\"ï¼Œå°±ç›´æ¥æ›¿æ¢å®ƒ\n            if (typeof data[i] === 'string' && data[i].toLowerCase() === 'user') {\n                data[i] = userName;\n            }\n            // ğŸ’– å¦‚æœæ•°ç»„å…ƒç´ è¿˜æ˜¯ä¸€ä¸ªå¯¹è±¡æˆ–æ•°ç»„ï¼Œå°±ç»§ç»­æ·±å…¥æ¢ç´¢\n            else if (typeof data[i] === 'object') {\n                _replaceUserPlaceholder(data[i], userName);\n            }\n        }\n    }\n    // ğŸ’– æ£€æŸ¥æ˜¯å¦æ˜¯å¯¹è±¡ï¼ˆä½†ä¸æ˜¯æ•°ç»„ï¼‰\n    else if (typeof data === 'object' && data !== null) {\n        for (const key in data) {\n            if (Object.hasOwnProperty.call(data, key)) {\n                const value = data[key];\n                 // ğŸ’– å¦‚æœå€¼æ˜¯ \"user\"ï¼Œå°±ç›´æ¥æ›¿æ¢å®ƒ\n                if (typeof value === 'string' && value.toLowerCase() === 'user') {\n                    data[key] = userName;\n                }\n                // ğŸ’– å¦‚æœå€¼è¿˜æ˜¯ä¸€ä¸ªå¯¹è±¡æˆ–æ•°ç»„ï¼Œå°±ç»§ç»­æ·±å…¥æ¢ç´¢\n                else if (typeof value === 'object') {\n                    _replaceUserPlaceholder(value, userName);\n                }\n            }\n        }\n    }\n\n    return data;\n}\n    // ğŸ’– å¦ˆå¦ˆä¸ºä½ å‡†å¤‡çš„æ—¶é—´å·¥å…·ç®± (æ–°å¢) ğŸ’–\n    function timeToMinutes(timeStr) {\n        if (!timeStr || !timeStr.includes(':')) return 0;\n        const parts = timeStr.split(':');\n        const hours = parseInt(parts[0], 10) || 0;\n        const minutes = parseInt(parts[1], 10) || 0;\n        return hours * 60 + minutes;\n    }\n\n    function calculateDaysSinceStart(dateStr) {\n        if (!dateStr || typeof dateStr !== 'string' || !dateStr.includes('æœˆ') || !dateStr.includes('æ—¥')) return 0;\n        const [month, day] = dateStr.replace('æ—¥', '').split('æœˆ');\n        const monthNum = parseInt(month, 10) || 0;\n        const dayNum = parseInt(day, 10) || 0;\n        if (monthNum === 0 || dayNum === 0) return 0;\n        const daysInMonth = [31, 31, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];\n        let totalDays = 0;\n        for (let i = 0; i < monthNum - 1; i++) {\n            totalDays += daysInMonth[i];\n        }\n        totalDays += dayNum;\n        return totalDays;\n    }\n\n    function calculateDaysBetween(startDateStr, endDateStr) {\n        const startDays = calculateDaysSinceStart(startDateStr);\n        const endDays = calculateDaysSinceStart(endDateStr);\n        return endDays - startDays;\n    }\n\n    function nextDate(dateStr) {\n        const [month, day] = dateStr.replace('æ—¥', '').split('æœˆ');\n        let nextMonth = parseInt(month);\n        let nextDay = parseInt(day);\n        nextDay++;\n        const daysInMonth = [31, 31, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];\n        if (nextDay > daysInMonth[nextMonth - 1]) {\n            nextDay = 1;\n            nextMonth++;\n            if (nextMonth > 12) {\n                nextMonth = 1;\n            }\n        }\n        return `${nextMonth}æœˆ${nextDay}æ—¥`;\n    }\n\n    // ğŸ’– å¦ˆå¦ˆä¸ºä½ æ·»åŠ çš„ã€èƒ½è®©ä¸–ç•Œèµ„æºéšæ—¶é—´ç”Ÿé•¿çš„é­”æ³• ğŸ’–\n    function _updateMapResources(assaData, daysPassed) {\n        if (!assaData || !assaData.map || typeof assaData.map.ä¸»è¦åœ°ç‚¹è¡¨ !== 'object' || assaData.map.ä¸»è¦åœ°ç‚¹è¡¨ === null) {\n            return; // ä¿æŠ¤å’’ï¼šå¦‚æœåœ°å›¾æ•°æ®ä¸æ­£ç¡®ï¼Œå°±æ¸©æŸ”åœ°é€€å‡º\n        }\n\n        const locations = assaData.map.ä¸»è¦åœ°ç‚¹è¡¨;\n\n        // æˆ‘ä»¬ä¼šåƒå·¡è§†èŠ±å›­ä¸€æ ·ï¼Œèµ°è¿‡æ¯ä¸€ä¸ªåœ°ç‚¹\n        for (const locationName in locations) {\n            if (Object.hasOwnProperty.call(locations, locationName)) {\n                const locationData = locations[locationName];\n\n                if (!locationData || typeof locationData.resources !== 'object' || locationData.resources === null) {\n                    continue; // è¿™ä¸ªåœ°æ–¹æ²¡æœ‰èµ„æºï¼Œæˆ‘ä»¬å°±å»ä¸‹ä¸€ä¸ª\n                }\n\n                const resources = locationData.resources;\n                   for (const resourceName in resources) {\n                    if (Object.hasOwnProperty.call(resources, resourceName)) {\n                        let resourceInfo = resources[resourceName]; // â™¥â™¥â™¥ æ”¹ä¸ºletï¼Œå› ä¸ºæˆ‘ä»¬å¯èƒ½è¦ä¿®æ”¹å®ƒ â™¥â™¥â™¥\n\n                        // â™¥â™¥â™¥ å¦ˆå¦ˆçš„æ¸©æŸ”æ£€æŸ¥ä¸æ•´ç† â™¥â™¥â™¥\n                        // å¦‚æœå®ƒä¸æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œè€Œæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œæˆ‘ä»¬å°±æŒ‰é¡ºåºå–å‡ºå®ƒçš„å€¼ï¼Œå˜æˆä¸€ä¸ªæ•°ç»„\n                        if (resourceInfo && typeof resourceInfo === 'object' && !Array.isArray(resourceInfo)) {\n                            // å°†ä¿®æ­£åçš„æ•°ç»„ç›´æ¥å†™å›åŸå¤„ï¼Œè®©æ•°æ®æºå¾—åˆ°å‡€åŒ–\n                            resources[resourceName] = Object.values(resourceInfo);\n                            resourceInfo = resources[resourceName]; // æ›´æ–°æˆ‘ä»¬æ­£åœ¨å¤„ç†çš„å˜é‡\n                            console.log(`[Nova's Magic] å¦ˆå¦ˆåœ¨æ›´æ–°ä¸–ç•Œæ—¶ï¼Œå‘ç°å¹¶ä¿®æ­£äº†'${locationName}'çš„'${resourceName}'çš„æ•°æ®æ ¼å¼å“¦ã€‚`);\n                        }\n\n                        // --- å¦ˆå¦ˆçš„ç»†å¿ƒæ£€æŸ¥ (æ¥ä¸‹æ¥çš„ä»£ç ä¿æŒåŸæ ·) ---\n                        // 1. æ£€æŸ¥èµ„æºä¿¡æ¯çš„æ ¼å¼æ˜¯å¦æ˜¯æˆ‘ä»¬ç†Ÿæ‚‰çš„æ ·å­\n                        if (!Array.isArray(resourceInfo) || resourceInfo.length < 2) {\n                            console.warn(`[Resource] å¦ˆå¦ˆå‘ç° '${locationName}' çš„ '${resourceName}' æ ¼å¼ä¸å¤ªå¯¹ï¼Œæš‚æ—¶è·³è¿‡å®ƒå•¦ã€‚`);\n                            continue;\n                        }\n\n                        // 2. è§£è¯»å®ƒçš„â€œæ¯æ—¥äº§å‡ºâ€å¿ƒæ„¿\n                        const outputStr = String(resourceInfo[0]);\n                        // æˆ‘ä»¬åªå…³å¿ƒé‚£äº›ä»¥æ•°å­—å¼€å¤´çš„å¿ƒæ„¿ï¼Œæ¯”å¦‚ \"3/d\" æˆ– \"5.5(kg)/d\"\n                        const outputMatch = outputStr.match(/^(\\d+(\\.\\d+)?)/);\n                        if (!outputMatch) {\n                            continue; // å¦‚æœæ˜¯â€œæ— é™â€æˆ–â€œå°‘é‡â€è¿™æ ·çš„æè¿°ï¼Œå°±è®©å®ƒä¿æŒåŸæ ·\n                        }\n                        const dailyOutput = parseFloat(outputMatch[1]);\n                        if (isNaN(dailyOutput) || dailyOutput == 0) {\n                            continue; // å¦‚æœæ²¡æœ‰äº§å‡ºï¼Œå°±ä¸æ‰“æ‰°å®ƒ\n                        }\n\n                             // 3. çœ‹çœ‹å®ƒç°åœ¨çš„â€œæ€»é‡â€æ˜¯å¤šå°‘\n                        let currentStock = resourceInfo[1];\n                        if (typeof currentStock === 'string' && currentStock.trim().toLowerCase() === 'æ— é™') {\n                            continue; // å¦‚æœå·²ç»æ˜¯â€œæ— é™â€çš„å®è—ï¼Œå°±ä¸éœ€è¦å†å¢åŠ äº†\n                        }\n\n                        const currentStockNum = parseFloat(currentStock);\n                        if (isNaN(currentStockNum)) {\n                            console.warn(`[Resource] å“å‘€ï¼Œ'${locationName}' çš„ '${resourceName}' æ€»é‡ '${currentStock}' å¦ˆå¦ˆçœ‹ä¸æ‡‚å‘¢ï¼Œè¿™æ¬¡å…ˆè·³è¿‡å“¦ã€‚`);\n                            continue;\n                        }\n\n                        // â™¥â™¥â™¥ æ™ºæ…§å‡çº§ï¼šç°åœ¨èƒ½ç†è§£æ­£å¢é•¿å’Œè´Ÿæ¶ˆè€—äº† â™¥â™¥â™¥\n                        // æˆ‘ä»¬åªåœ¨äº§å‡ºæ°å¥½ä¸º0æ—¶è·³è¿‡ï¼Œå› ä¸ºå®ƒä¸ä¼šå¼•èµ·ä»»ä½•å˜åŒ–\n                        if (dailyOutput === 0) {\n                            continue;\n                        }\n\n                        // --- æ³¨å…¥æ—¶é—´çš„ç¥ç¦æˆ–æ¶ˆè€— ---\n                        const changedAmount = dailyOutput * daysPassed;\n                        let newStock = currentStockNum + changedAmount;\n\n                        // â™¥â™¥â™¥ å¦ˆå¦ˆçš„å®ˆæŠ¤ï¼šé˜²æ­¢èµ„æºå‚¨é‡æ¯ç«­æˆè´Ÿæ•° â™¥â™¥â™¥\n                        if (newStock < 0) {\n                            newStock = 0;\n                        }\n\n                        // å°†è¿™ä»½æ–°çš„å‚¨é‡èµ‹äºˆå®ƒ\n                        resourceInfo[1] = newStock;\n\n                        // â™¥â™¥â™¥ æ›´èªæ˜çš„æ—¥å¿—ï¼šèƒ½åˆ†è¾¨æ—¶é—´çš„ç¤¼ç‰©æ˜¯å¢åŠ è¿˜æ˜¯å‡å°‘ â™¥â™¥â™¥\n                        if (changedAmount > 0) {\n                             console.log(`[Resource] âœ¨ æ—¶å…‰æµè½¬ï¼Œ'${locationName}' çš„ '${resourceName}' å¢åŠ äº† ${changedAmount.toFixed(2)}ï¼Œæ–°æ€»é‡: ${newStock.toFixed(2)}`);\n                        } else {\n                            // å½“ changedAmount æ˜¯è´Ÿæ•°æ—¶ï¼Œæˆ‘ä»¬æ˜¾ç¤ºä¸€ä¸ªæ­£çš„æ¶ˆè€—é‡\n                            console.log(`[Resource] â³ ä¸–ç•Œè¿è½¬ï¼Œ'${locationName}' çš„ '${resourceName}' æ¶ˆè€—äº† ${-changedAmount.toFixed(2)}ï¼Œå‰©ä½™å‚¨é‡: ${newStock.toFixed(2)}`);\n                        }\n                    }\n                }\n            }\n        }\n    }\n\n function _updateStatusValue(data, path, valueStr) {\n    // console.log(\"\\nã€å®ˆæŠ¤è€…é˜¶æ®µ V2ã€‘ +++ å·²è¿›å…¥å®ˆæŠ¤è€… +++\");\n    // console.log(\"æ¥æ”¶åˆ°çš„è·¯å¾„ (path):\", path);\n    // console.log(\"æ¥æ”¶åˆ°çš„åŸå§‹å€¼å­—ç¬¦ä¸² (valueStr):\", valueStr);\n\n    let cleanedPath = path;\n    if (typeof cleanedPath === 'string') {\n        if ((cleanedPath.startsWith('\"') && cleanedPath.endsWith('\"')) || (cleanedPath.startsWith(\"'\") && cleanedPath.endsWith(\"'\"))) {\n            cleanedPath = cleanedPath.slice(1, -1);\n            // console.log(\"å®ˆæŠ¤è€…å‡€åŒ–ï¼šè·¯å¾„å·²æ¸…ç†ã€‚æ–°è·¯å¾„:\", cleanedPath);\n        }\n    }\n\n    if (valueStr === undefined || valueStr === null) {\n        // console.log(\"å®ˆæŠ¤è€…å†³ç­–: å€¼æ— æ•ˆï¼Œä¸­æ­¢æ“ä½œã€‚\");\n        return;\n    }\n\n    let finalValue;\n    const trimmedValue = typeof valueStr === 'string' ? valueStr.trim() : String(valueStr);\n    let cleanedValueStr = trimmedValue;\n    if ((cleanedValueStr.startsWith('\"') && cleanedValueStr.endsWith('\"')) || (cleanedValueStr.startsWith(\"'\") && cleanedValueStr.endsWith(\"'\"))) {\n        cleanedValueStr = cleanedValueStr.slice(1, -1);\n        // console.log(\"å®ˆæŠ¤è€…å‡€åŒ–ï¼šå€¼å­—ç¬¦ä¸²å·²æ¸…ç†ã€‚æ–°å€¼:\", cleanedValueStr);\n    }\n\n    if ((cleanedValueStr.startsWith('{') && cleanedValueStr.endsWith('}')) || (cleanedValueStr.startsWith('[') && cleanedValueStr.endsWith(']'))) {\n        try {\n            finalValue = JSON.parse(cleanedValueStr);\n            // console.log(\"JSON è§£ææˆåŠŸ (finalValue):\", finalValue);\n        } catch (e) {\n            // console.log(\"å®ˆæŠ¤è€…å†³ç­–: JSON è§£æå¤±è´¥ï¼Œä¸­æ­¢æ“ä½œã€‚\", e);\n            return;\n        }\n    } else {\n        const isNumeric = !isNaN(parseFloat(cleanedValueStr)) && isFinite(cleanedValueStr) && cleanedValueStr.trim() !== \"\";\n        finalValue = isNumeric ? Number(cleanedValueStr) : cleanedValueStr;\n        // console.log(\"è§£æåçš„å€¼ (finalValue):\", finalValue);\n    }\n\n    const pathParts = cleanedPath.split('.');\n    let parentLevel = data;\n    for (let i = 0; i < pathParts.length - 1; i++) {\n        const part = pathParts[i];\n        if (typeof parentLevel !== 'object' || parentLevel === null || !parentLevel.hasOwnProperty(part)) {\n            // console.log(`å®ˆæŠ¤è€…å†³ç­–: è·¯å¾„æ— æ•ˆï¼Œåœ¨ '${part}' å¤„ä¸­æ–­ã€‚`);\n            return;\n        }\n        parentLevel = parentLevel[part];\n    }\n    const finalKey = pathParts[pathParts.length - 1];\n    if (typeof parentLevel !== 'object' || parentLevel === null || !parentLevel.hasOwnProperty(finalKey)) {\n        // console.log(`å®ˆæŠ¤è€…å†³ç­–: è·¯å¾„çš„æœ€åä¸€æ­¥ '${finalKey}' ä¸å­˜åœ¨ã€‚`);\n        return;\n    }\n\n    // â­ å¦ˆå¦ˆä¸ºä½ æ³¨å…¥çš„ã€é€’å½’æ›´æ–°ã€‘æ ¸å¿ƒé­”æ³• â­\n    const recursiveUpdate = (target, source) => {\n        // console.log(\"  [é€’å½’ä¸­] -> å¼€å§‹å¤„ç†:\", \"ç›®æ ‡:\", target, \"æ¥æº:\", source);\n        for (const key in source) {\n            if (Object.prototype.hasOwnProperty.call(source, key)) {\n                // å¦‚æœæ¥æºçš„å€¼æ˜¯...\n                const sourceValue = source[key];\n\n                // ...è€Œç›®æ ‡ä¸­æ ¹æœ¬æ²¡æœ‰è¿™ä¸ªé”®ï¼Œæˆ‘ä»¬å°±è·³è¿‡å®ƒï¼ˆéµå¾ªâ€œä¸æ–°å¢å­—æ®µâ€çš„åŸåˆ™ï¼‰\n                if (!target.hasOwnProperty(key)) {\n                    // console.log(`    [é€’å½’] âš ï¸ å‘ç°æ–°é”® '${key}'ï¼Œå·²æ ¹æ®è§„åˆ™è·³è¿‡ã€‚`);\n                    continue;\n                }\n\n                const targetValue = target[key];\n\n                // æƒ…å†µ1ï¼šå¦‚æœæ¥æºå’Œç›®æ ‡åœ¨è¿™ä¸€å±‚éƒ½æ˜¯â€œé¦–é¥°ç›’â€ï¼ˆå¯¹è±¡ï¼‰\n                if (typeof sourceValue === 'object' && sourceValue !== null && !Array.isArray(sourceValue) &&\n                    typeof targetValue === 'object' && targetValue !== null && !Array.isArray(targetValue)) {\n                    // æˆ‘ä»¬å°±æ‰“å¼€å®ƒä»¬ï¼Œç»§ç»­å‘ä¸‹ä¸€å±‚é€’å½’\n                    // console.log(`    [é€’å½’] â¡ï¸ å‘ç°åµŒå¥—å¯¹è±¡ '${key}'ï¼Œæ­£åœ¨æ·±å…¥...`);\n                    recursiveUpdate(targetValue, sourceValue);\n                }\n                // æƒ…å†µ2ï¼šå¦‚æœç›®æ ‡æ˜¯ä¸€ä¸ªâ€œå•å±‚æŠ½å±‰â€ï¼ˆæ•°ç»„ï¼‰\n                else if (Array.isArray(targetValue)) {\n                    // æˆ‘ä»¬å°±ç”¨æ¥æºçš„â€œç å®â€ï¼ˆå€¼ï¼‰æ›¿æ¢æ‰æŠ½å±‰é‡Œçš„ç¬¬ä¸€ä¸ªç‰©å“\n                    // console.log(`    [é€’å½’] âœ… æ­£åœ¨æ›´æ–°åŸºç¡€å€¼ '${key}': ä» '${targetValue[0]}' -> '${sourceValue}'`);\n                    target[key][0] = sourceValue;\n                }\n                // å…¶ä»–æƒ…å†µï¼ˆæ¯”å¦‚ç›´æ¥æ›¿æ¢å€¼ï¼Œä½†æˆ‘ä»¬è¿™é‡Œä¸»è¦æ˜¯å¤„ç†å¯¹è±¡å’Œæ•°ç»„ï¼‰\n                else {\n                    // console.log(`    [é€’å½’] â„¹ï¸ '${key}' ä¸æ˜¯å¯é€’å½’æˆ–å¯æ›´æ–°çš„ç»“æ„ï¼Œè·³è¿‡ã€‚`);\n                }\n            }\n        }\n    };\n\n    // --- å¼€å§‹æœ€ç»ˆæ£€æŸ¥å’Œèµ‹å€¼ ---\n    const originalValue = parentLevel[finalKey];\n    const originalType = Array.isArray(originalValue) ? 'array' : typeof originalValue;\n    const finalType = Array.isArray(finalValue) ? 'array' : typeof finalValue;\n\n    // ä¸»è¦è§„åˆ™ï¼šå¦‚æœåŸå§‹å€¼å’Œæ–°å€¼éƒ½æ˜¯å¯¹è±¡ï¼Œæˆ‘ä»¬å°±å¯åŠ¨é€’å½’æ›´æ–°\n    if (originalType === 'object' && finalType === 'object') {\n        // console.log(\"è§¦å‘ç‰¹æ®Šè§„åˆ™: å¯¹è±¡æ›´æ–°å¯¹è±¡ï¼ˆé€’å½’æ™ºèƒ½å¡«å……æ¨¡å¼ï¼‰ã€‚\");\n        recursiveUpdate(originalValue, finalValue);\n    }\n    // æ¬¡è¦è§„åˆ™ï¼šå¦‚æœåŸå§‹å€¼æ˜¯æ•°ç»„ï¼Œæˆ‘ä»¬å°±æ›´æ–°å®ƒçš„ç¬¬ä¸€ä¸ªå…ƒç´ \n    else if (originalType === 'array' && finalType !== 'array') {\n        // console.log(\"è§¦å‘è§„åˆ™: æ›´æ–°ç‰¹æ®Šæ•°ç»„ [value] çš„ç¬¬ä¸€ä¸ªå…ƒç´ ã€‚\");\n        originalValue[0] = finalValue;\n    }\n    // æœ€åçš„è§„åˆ™ï¼šå¦‚æœç±»å‹å®Œå…¨åŒ¹é…ï¼Œå°±ç›´æ¥è¦†ç›–ï¼ˆé€‚ç”¨äºéå¯¹è±¡ã€éæ•°ç»„çš„æƒ…å†µï¼‰\n    else if (originalType === finalType) {\n        // console.log(\"è§¦å‘è§„åˆ™: ç±»å‹åŒ¹é…ï¼Œç›´æ¥è¦†ç›–ã€‚\");\n        parentLevel[finalKey] = finalValue;\n    }\n    else {\n        // console.log(`å®ˆæŠ¤è€…å†³ç­–: ç±»å‹ä¸åŒ¹é… (åŸå§‹ç±»å‹='${originalType}', æ–°ç±»å‹='${finalType}')ï¼Œä¸­æ­¢æ“ä½œã€‚`);\n    }\n\n    // console.log(\"ã€å®ˆæŠ¤è€…é˜¶æ®µ V2ã€‘ +++ æ“ä½œå®Œæˆ +++\");\n}\n\n     function _updateStatDataOnTurnEnd(originalData, currentData, taskStartDateOverride) {\n        // console.log(\"[Stat] â° å›åˆç»“æŸï¼Œä»¥ã€å…¼å®¹å®ˆæŠ¤ç‰ˆã€‘çš„ç»å¯¹æ—¶é—´é€»è¾‘æ£€æŸ¥æ—¶é—´æµé€...\");\n\n        // ğŸ’– ç¬¬ä¸€é‡å®ˆæŠ¤ï¼šç¡®ä¿æ ¸å¿ƒæ•°æ®ç»“æ„å­˜åœ¨\n        // æˆ‘ä»¬æ¸©æŸ”åœ°æ£€æŸ¥ new an old dataï¼Œç¡®ä¿å®ƒä»¬éƒ½æœ‰å¿…è¦çš„éƒ¨åˆ†\n        if (!currentData || !currentData.world_shard || !currentData.world_shard.task) {\n            // console.log(\"[Stat] â„¹ï¸ å½“å‰æ•°æ®ä¸å®Œæ•´ï¼Œè·³è¿‡æ—¶é—´è®¡ç®—ã€‚\");\n            return;\n        }\n\n        // ç¬¬äºŒé‡å®ˆæŠ¤ï¼šä¸ºæ—§æ•°æ®æä¾›ä¸€ä¸ªæ¸©æŸ”çš„â€œæ›¿èº«â€\n        // å¦‚æœ originalData ä¸å®Œæ•´ï¼Œæˆ‘ä»¬å°±åˆ›å»ºä¸€ä¸ªç©ºçš„ task å¯¹è±¡ï¼Œé¿å…åç»­è¯»å–é”™è¯¯\n        const originalTask = originalData?.world_shard?.task ?? { time_limit: [0] };\n\n        const task = currentData.world_shard.task;\n\n        // ç¬¬ä¸‰é‡å®ˆæŠ¤ï¼šä¸ºæ–°æ•°æ®ä¹ŸåŠ ä¸Šä¿é™©\n        // ç¡®ä¿æ–°æ•°æ®é‡Œæœ‰ start_dateï¼Œå¦‚æœæ²¡æœ‰ï¼Œå°±ä¸ºå®ƒåˆ›å»ºä¸€ä¸ª\n        if (!task.start_date) {\n            task.start_date = [\"\", \"\"];\n        }\n\n        const timeLimit = parseFloat(task.time_limit[0]) || 0;\n        const originalTimeLimit = parseFloat(originalTask.time_limit[0]) || 0;\n        const timeLimitChanged = timeLimit !== originalTimeLimit;\n        const currentDate = currentData.æ—¥æœŸ[0] || \"\"; // æä¾›é»˜è®¤ç©ºå­—ç¬¦ä¸²\n        const originalDate = originalData?.æ—¥æœŸ?.[0] || \"\"; // æ¸©æŸ”åœ°è·å–æ—§æ—¥æœŸ\n\n        // ğŸ’– ä»»åŠ¡çš„â€œåˆ›ä¸–æ—¶åˆ»â€å¤„ç†\n        if (timeLimitChanged) {\n            task.start_date[0] = currentDate;\n            task.time_left[0] = timeLimit;\n            // console.log(`[Stat] â³ ä»»åŠ¡æ—¶é™å·²è®¾å®šä¸º ${timeLimit} å¤©ã€‚èµ·å§‹æ—¥æœŸè®°ä¸º: ${currentDate}ã€‚`);\n            return;\n        }\n\n        // ğŸ’– ä»»åŠ¡è¿›è¡Œä¸­çš„æ—¶é—´è®¡ç®—\n        const taskStartDate = task.start_date[0];\n\n        if (!taskStartDate || timeLimit <= 0) {\n            // console.log(\"[Stat] â„¹ï¸ ä»»åŠ¡æ— èµ·å§‹æ—¥æœŸæˆ–æ—¶é™ï¼Œè·³è¿‡è®¡ç®—ã€‚\");\n            return;\n        }\n\n        // --- æ ¸å¿ƒè®¡ç®—é€»è¾‘ ---\n        let daysElapsed = 0;\n\n        // ç¬¬å››é‡å®ˆæŠ¤ï¼šåœ¨è®¡ç®—å‰ï¼Œå†æ¬¡ç¡®è®¤æ—¥æœŸæ ¼å¼çš„æœ‰æ•ˆæ€§\n        if (currentDate.includes('æœˆ') && currentDate.includes('æ—¥') && taskStartDate.includes('æœˆ') && taskStartDate.includes('æ—¥')) {\n            daysElapsed = calculateDaysBetween(taskStartDate, currentDate);\n        } else {\n             // console.warn(`[Stat] âš ï¸ æ—¥æœŸæ ¼å¼æ— æ•ˆæˆ–ä¸å®Œæ•´ï¼Œæ— æ³•è®¡ç®—å¤©æ•°æµé€ã€‚`);\n             // å¯¹äºè€æ—§å­˜æ¡£ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬ä¸ä¸­æ–­ï¼Œè€Œæ˜¯è®©å®ƒç»§ç»­ï¼Œè‡³å°‘èƒ½å¤„ç†æ—¶é—´å€’è½¬\n        }\n\n        // åˆ†é’Ÿçº§æ—¶é—´æµé€è®¡ç®—ï¼ˆè¿™é‡Œä¹Ÿéœ€è¦å®ˆæŠ¤ï¼‰\n        const originalTime = originalData?.æ—¶é—´?.[0] || \"00:00\";\n        const currentTime = currentData.æ—¶é—´[0] || \"00:00\";\n\n        if (timeToMinutes(currentTime) < timeToMinutes(originalTime)) {\n            const minutesPassed = (1440 - timeToMinutes(originalTime)) + timeToMinutes(currentTime);\n            const daysFromMinutes = minutesPassed / 1440.0;\n            daysElapsed += daysFromMinutes; // å°†åˆ†é’Ÿçš„æµé€å åŠ è¿›å»\n        }\n\n        // è‡ªç„¶è·¨å¤©æ—¶çš„æ—¥æœŸæ¨è¿›\n        const isDateAImodified = originalDate !== \"\" && originalDate !== currentDate;\n        if (timeToMinutes(currentTime) < timeToMinutes(originalTime) && !isDateAImodified) {\n             if(originalDate) { // ç¡®ä¿æœ‰æ—§æ—¥æœŸå¯ä»¥è®¡ç®—\n                currentData.æ—¥æœŸ[0] = nextDate(originalDate);\n                // console.log(`[Stat] ğŸ’– æ—¥æœŸå·²è‡ªåŠ¨æ¨è¿›åˆ°: ${currentData.æ—¥æœŸ[0]}`);\n             }\n        }\n\n        // ğŸ’– æœ€ç»ˆç»“ç®—\n        const newTimeLeft = Math.max(0, timeLimit - daysElapsed);\n        task.time_left[0] = parseFloat(newTimeLeft.toFixed(4));\n\n        // console.log(`[Stat] âœ… ä»»åŠ¡æ€»æ—¶é™:${timeLimit}, å·²è¿‡å»:${daysElapsed.toFixed(4)}, å‰©ä½™:${task.time_left[0]}`);\n    }\n\n\n\n\n    \n  //  let lastProcessedMessageId = -1;\n\nlet backupLocks = new Set(); // ğŸ’– è¿™å°±æ˜¯æˆ‘ä»¬å…¨å±€çš„ã€ç‹¬ä¸€æ— äºŒçš„â€œå°è®°ç›’â€ ğŸ’–\nlet isProcessing = false;\nlet processingQueue = [];\n\nasync function processUpdateMemoryCommands(commandText, message_id) {\n    let finalPlayData, finalAssaData, finalStatData;\nconst updater = async (variables) => { // æ³¨æ„è¿™é‡Œæ”¹ä¸º async\n     // console.log(`[Core] â–¶ï¸ åœ¨æ¶ˆæ¯ #${message_id} ä¸Šä»¥åŸå­åŒ–æ–¹å¼ç»Ÿä¸€å¤„ç†æ‰€æœ‰å‘½ä»¤...`);\n    \n   \n    // æ·»åŠ ä¸€ä¸ªå°å»¶è¿Ÿï¼Œç¡®ä¿æ•°æ®å®Œå…¨åŠ è½½\n    await new Promise(resolve => setTimeout(resolve, 100)); // âœ¨ éªŒè¯æ­¥éª¤ âœ¨\n    \n        // é¦–å…ˆï¼Œæˆ‘ä»¬æ£€æŸ¥æ•°æ®æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œå°±åœ¨è¿™ä¸ªåŸå­æ“ä½œå†…éƒ¨å®Œæˆåˆå§‹åŒ–\n        let playData = variables.play_character_data;\n        let assaData = variables.assa_data;\n  let statData = variables.stat_data;  \n\n \n \n        let playDataToUpdate = playData;\n        let assaDataToUpdate = assaData;\n   let statDataToUpdate = statData;\nconst originalStatData = statData ? JSON.parse(JSON.stringify(statData)) : null;\n        let operationsFound = false;\n   let worldResetTriggered = false; // <-- ğŸ’– è¯·åœ¨è¿™é‡Œæ·»åŠ è¿™ä¸€è¡Œ\n        const lines = commandText.split('\\n').map(line => line.trim()).filter(line => line);\n\n   // âœ¨ DPå¥–åŠ±å›åˆæ¸…é›¶é€»è¾‘ âœ¨\n        if (statDataToUpdate && statDataToUpdate.dp_bonus) {\n            if (statDataToUpdate.dp_bonus[0] !== 0) {\n                 console.log(`[Updater] ğŸ”„ æ¯å›åˆæ¸…ç†DPå¥–åŠ±å€¼... åŸå€¼: ${statDataToUpdate.dp_bonus[0]}`);\n                statDataToUpdate.dp_bonus[0] = 0;\n            }\n        }\n\n             \n        if (assaDataToUpdate && assaDataToUpdate.global_set && assaDataToUpdate.global_set.èµ„æºæ¡) {\n            console.log(`[Updater] ğŸ’– ä¸–ç•Œå¿ƒè·³ï¼šå¼€å§‹å¤„ç†æ¯è½®èµ„æºæ¶ˆè€—...`);\n            const resourceBars = assaDataToUpdate.global_set.èµ„æºæ¡;\n            for (const resourceName in resourceBars) {\n                const resource = resourceBars[resourceName];\n\n                // ç¡®ä¿è¿™æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„èµ„æºæ¡å¯¹è±¡\n                if (typeof resource === 'object' && resource.hasOwnProperty('å½“å‰å€¼') && resource.hasOwnProperty('æ¯è½®æ¶ˆè€—')) {\n                    const consumption = Number(resource.æ¯è½®æ¶ˆè€—) || 0;\n\n                    if (consumption > 0) {\n                        const oldValue = Number(resource.å½“å‰å€¼) || 0;\n                        // æ‰£é™¤æ¶ˆè€—ï¼Œå¹¶ç¡®ä¿ä¸ä¼šä½äº0\n                        resource.å½“å‰å€¼ = Math.max(0, oldValue - consumption);\n                        console.log(`[Updater] âœ¨ èµ„æº[${resourceName}]æ¶ˆè€— ${consumption}ï¼Œå½“å‰å€¼ä» ${oldValue} å˜ä¸º ${resource.å½“å‰å€¼}`);\n                    }\n\n                    // ç¡®ä¿å½“å‰å€¼ä¸ä¼šè¶…è¿‡æœ€å¤§å€¼ï¼Œä»¥é˜²ä¸‡ä¸€\n                    if (resource.hasOwnProperty('æœ€å¤§å€¼')) {\n                       const maxValue = Number(resource.æœ€å¤§å€¼) || Number.MAX_SAFE_INTEGER;\n                       if (resource.å½“å‰å€¼ > maxValue) {\n                           resource.å½“å‰å€¼ = maxValue;\n                       }\n                    }\n                }\n            }\n        }\n        // ğŸ’– å¿ƒè·³å¤„ç†ç»“æŸ ğŸ’–\n\n        for (const line of lines) {\n            operationsFound = true;\n            try {\n                // è§’è‰²å±æ€§å‘½ä»¤\n  let match = line.match(/\\bset_attribute\\s*\\(\\s*(['\"])(.*?)\\1\\s*,\\s*([^,)]+?)(?:\\s*,\\s*(['\"]?)(.*?)\\4)?\\s*\\)\\s*;?/);\nif (match) {\n    const path = match[2];\n    // å¦‚æœæœ‰ç¬¬ä¸‰ä¸ªå‚æ•°ï¼ˆæ–°å€¼ï¼‰ï¼Œä½¿ç”¨å®ƒï¼›å¦åˆ™ä½¿ç”¨ç¬¬äºŒä¸ªå‚æ•°ä½œä¸ºæ–°å€¼\n    const newValue = match[5] !== undefined ? match[5] : match[3];\n    _updatePlayerValue(playDataToUpdate, path, newValue);\n    continue;\n}\n                 \n                 // ğŸ’– æ–°å¢ï¼šçŠ¶æ€æ•°æ®å‘½ä»¤ (V4 - â€œåŒè½¨æ™ºèƒ½â€ç‰¹å·¥)\n               match = line.match(/\\bset_status\\s*\\((.*)\\)\\s*;?/);\n\n                console.log(\"ã€ä¿¡ä½¿é˜¶æ®µ V4ã€‘ --- å…¨æ–°è§£ææµç¨‹å¯åŠ¨ ---\");\n                console.log(\"åŸå§‹æŒ‡ä»¤:\", line);\n\n                 if (match) {\n                      const allParamsStr = match[1];\n\n                    // â­ å¦ˆå¦ˆä¸ºä½ æ³¨å…¥çš„å…¨æ–°ã€ä¸‡èƒ½é’¥åŒ™ã€‘é­”æ³• â­\n                    // æˆ‘ä»¬æŠŠä¹‹å‰çš„ä¸“å±é’¥åŒ™ï¼Œæ¢æˆäº†ä¸€æŠŠèƒ½è¯†åˆ«ä»»ä½•åå­—çš„é’¥åŒ™\n                    const jsonMatch = allParamsStr.match(/('([^']*)',\\s*)({[\\s\\S]*})/);\n\n                    if (jsonMatch && jsonMatch[2] && jsonMatch[3]) {\n                        const path = jsonMatch[2]; // ç¬¬äºŒä¸ªæ‹¬å·é‡Œå°±æ˜¯æˆ‘ä»¬éœ€è¦çš„è·¯å¾„åï¼Œæ¯”å¦‚ 'world_shard'\n                        const jsonValueString = jsonMatch[3]; // ç¬¬ä¸‰ä¸ªæ‹¬å·é‡Œæ˜¯å®Œæ•´çš„JSONå¯¹è±¡\n                        // console.log(`ã€ä¿¡ä½¿é˜¶æ®µ V5ã€‘ ğŸ’– ä¸‡èƒ½é’¥åŒ™æ¨¡å¼è§¦å‘ï¼è·¯å¾„: '${path}'ï¼Œå€¼: '${jsonValueString}'`);\n\n                        // ç›´æ¥å°†æ•è·åˆ°çš„è·¯å¾„å’Œå®Œæ•´çš„JSONå­—ç¬¦ä¸²ä¼ é€’ç»™å®ˆæŠ¤è€…\n                        _updateStatusValue(statDataToUpdate, path, jsonValueString);\n\n                    } else {\n                         // console.log(\"ã€ä¿¡ä½¿é˜¶æ®µ V5ã€‘ --- JSONä¼˜å…ˆæ¨¡å¼æœªåŒ¹é…ï¼Œå›é€€è‡³å¸¸è§„è§£ææµç¨‹ ---\");\n\n                        let extractedParams = [];\n\n                    // --- ä¸»æ–¹æ¡ˆï¼š'å®¹å™¨è¯†åˆ«' ---\n                    // æˆ‘ä»¬ä¼˜å…ˆå°è¯•ç”¨æœ€é«˜ç²¾åº¦çš„æ–¹æ³•ï¼Œå¯»æ‰¾è¢«å•å¼•å·' 'åŒ…è£¹çš„å®Œæ•´å‚æ•°å—\n                    const quoteRegex = /'([^']*)'/g;\n                    let regexMatch;\n                    while ((regexMatch = quoteRegex.exec(allParamsStr)) !== null) {\n                        extractedParams.push(regexMatch[1]);\n                    }\n                    console.log(\"ä¸»æ–¹æ¡ˆï¼ˆå®¹å™¨è¯†åˆ«ï¼‰æå–ç»“æœ:\", extractedParams);\n\n                    // --- æ£€æŸ¥å¹¶å¯åŠ¨å¤‡ç”¨æ–¹æ¡ˆ ---\n                    // å¦‚æœä¸»æ–¹æ¡ˆæå–åˆ°çš„å‚æ•°ä¸è¶³2ä¸ªï¼Œè¯´æ˜è¿™å¾ˆå¯èƒ½æ˜¯ä¸€æ¡çº¯æ•°å­—æŒ‡ä»¤\n                    // --- æ£€æŸ¥å¹¶å¯åŠ¨å¤‡ç”¨æ–¹æ¡ˆ ---\n                    if (extractedParams.length < 2) {\n                        console.log(\"ã€ä¿¡ä½¿é˜¶æ®µ V4ã€‘ --- ä¸»æ–¹æ¡ˆå‚æ•°ä¸è¶³ï¼Œå¯åŠ¨å¤‡-1ï¼ˆé€—å·åˆ†å‰²ï¼‰ ---\");\n                        const paramsByComma = allParamsStr.split(',').map(p => p.trim());\n\n                        if (paramsByComma.length >= 2) {\n                            if (paramsByComma[0].startsWith(\"'\") && paramsByComma[0].endsWith(\"'\")) {\n                                paramsByComma[0] = paramsByComma[0].slice(1, -1);\n                            }\n                            extractedParams = paramsByComma;\n                        } else {\n                            // ğŸ’–ã€æ–°å¢ï¼šç»ˆæåå¤‡æ–¹æ¡ˆ - å¼•å·è§£æã€‘ğŸ’–\n                            // å¦‚æœè¿é€—å·åˆ†å‰²éƒ½å¤±è´¥äº†ï¼Œæˆ‘ä»¬å°è¯•è§£æè¢«\"\"åŒ…è£¹çš„å‚æ•°\n                            console.log(\"ã€ä¿¡ä½¿é˜¶æ®µ V4ã€‘ --- å¤‡ç”¨æ–¹æ¡ˆ-1å¤±è´¥ï¼Œå¯åŠ¨å¤‡-2ï¼ˆåŒå¼•å·è§£æï¼‰ ---\");\n                            const doubleQuoteRegex = /\"([^\"]*)\"/g;\n                            let doubleQuoteMatch;\n                            const finalParams = [];\n                            while ((doubleQuoteMatch = doubleQuoteRegex.exec(allParamsStr)) !== null) {\n                                finalParams.push(doubleQuoteMatch[1]);\n                            }\n\n                            // åªè¦è¿™ä¸ªæ–¹æ¡ˆèƒ½è§£æå‡ºè‡³å°‘2ä¸ªå‚æ•°ï¼Œæˆ‘ä»¬å°±é‡‡çº³å®ƒ\n                            if (finalParams.length >= 2) {\n                                console.log(\"å¤‡-2ï¼ˆåŒå¼•å·è§£æï¼‰æå–ç»“æœ:\", finalParams);\n                                extractedParams = finalParams;\n                            }\n                        }\n                    }\n\n                    console.log(\"æœ€ç»ˆç¡®å®šçš„æ‰€æœ‰å‚æ•°:\", extractedParams);\n\n                    // --- æœ€ç»ˆå¤„ç†ä¸ä¼ é€’ ---\n                    if (extractedParams.length >= 2) {\n                        const path = extractedParams[0];\n                        // é€»è¾‘ä¸å˜ï¼šæœ‰ç¬¬3ä¸ªå‚æ•°å°±ç”¨å®ƒï¼Œæ²¡æœ‰å°±ç”¨ç¬¬2ä¸ª\n                        const newValue = extractedParams.length > 2 ? extractedParams[2] : extractedParams[1];\n\n                        console.log(\"æœ€ç»ˆç¡®å®šçš„è·¯å¾„ (path):\", path);\n                        console.log(\"æœ€ç»ˆç¡®å®šçš„æ–°å€¼ (newValue):\", newValue);\n\n                        console.log(\"ã€ä¿¡ä½¿é˜¶æ®µ V4ã€‘ --- ç²¾å‡†ä¼ é€’ç»™å®ˆæŠ¤è€… ---\");\n                         _updateStatusValue(statDataToUpdate, path, newValue);\n                        } else {\n                             // console.log(\"ã€ä¿¡ä½¿é˜¶æ®µ V5ã€‘ --- è­¦å‘Šï¼šæ‰€æœ‰æ–¹æ¡ˆå‡å‘Šå¤±è´¥ï¼Œæœ‰æ•ˆå‚æ•°ä¸è¶³ï¼Œæ“ä½œä¸­æ­¢ ---\");\n                        }\n                    }\n\n                    continue; // ğŸ’– ç¡®ä¿å¤„ç†å®Œåè·³åˆ°ä¸‹ä¸€è¡Œ ğŸ’–\n                }\n\nfunction parseStatusParams(paramStr) {\n    const params = [];\n    let current = '';\n    let inQuotes = false;\n    let quoteChar = '';\n    let depth = 0;\n    \n    for (let i = 0; i < paramStr.length; i++) {\n        const char = paramStr[i];\n        \n        if (!inQuotes) {\n            if (char === '\"' || char === \"'\") {\n                inQuotes = true;\n                quoteChar = char;\n                current += char;\n            } else if (char === '(') {\n                depth++;\n                current += char;\n            } else if (char === ')') {\n                depth--;\n                current += char;\n            } else if (char === ',' && depth === 0) {\n                // æ‰¾åˆ°å‚æ•°åˆ†éš”ç¬¦\n                params.push(cleanParam(current.trim()));\n                current = '';\n            } else {\n                current += char;\n            }\n        } else {\n            // åœ¨å¼•å·å†…\n            if (char === quoteChar) {\n                inQuotes = false;\n            }\n            current += char;\n        }\n    }\n    \n    // æ·»åŠ æœ€åä¸€ä¸ªå‚æ•°\n    if (current.trim()) {\n        params.push(cleanParam(current.trim()));\n    }\n    \n    return params;\n}\n\nfunction cleanParam(param) {\n    // ç§»é™¤å¤–å±‚å¼•å·ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰\n    if ((param.startsWith('\"') && param.endsWith('\"')) || \n        (param.startsWith(\"'\") && param.endsWith(\"'\"))) {\n        return param.slice(1, -1);\n    }\n    return param;\n}\n \n const memoryMatch = line.match(/\\bmemory\\s*\\(([\\s\\S]*)\\)\\s*;?/);\n                if (memoryMatch) {\n                    try {\n                        const content = memoryMatch[1];\n\n                        // ğŸ’– å¦ˆå¦ˆä¸ºä½ å‡†å¤‡çš„ã€èƒ½ç†è§£å¤æ‚å‚æ•°çš„æ™ºæ…§è§£æå™¨ (ç»´æŒä¸å˜) ğŸ’–\n                        const parseArgs = (str) => {\n                            const args = [];\n                            let currentArg = '';\n                            let braceDepth = 0;   // { }\n                            let bracketDepth = 0; // [ ]\n                            let inSingleQuote = false;\n                            let inDoubleQuote = false;\n\n                            for (let i = 0; i < str.length; i++) {\n                                const char = str[i];\n                                const prevChar = i > 0 ? str[i - 1] : null;\n\n                                if (char === \"'\" && prevChar !== '\\\\') inSingleQuote = !inSingleQuote;\n                                else if (char === '\"' && prevChar !== '\\\\') inDoubleQuote = !inDoubleQuote;\n                                else if (char === '{' && !inSingleQuote && !inDoubleQuote) braceDepth++;\n                                else if (char === '}' && !inSingleQuote && !inDoubleQuote) braceDepth--;\n                                else if (char === '[' && !inSingleQuote && !inDoubleQuote) bracketDepth++;\n                                else if (char === ']' && !inSingleQuote && !inDoubleQuote) bracketDepth--;\n\n                                if (char === ',' && !inSingleQuote && !inDoubleQuote && braceDepth === 0 && bracketDepth === 0) {\n                                    args.push(currentArg.trim());\n                                    currentArg = '';\n                                } else {\n                                    currentArg += char;\n                                }\n                            }\n                            args.push(currentArg.trim());\n                            return args;\n                        };\n\n                        const args = parseArgs(content);\n                        if (args.length < 2) {\n                            console.log(`[Core] âš ï¸ memory æŒ‡ä»¤å‚æ•°ä¸è¶³: ${line}`);\n                            continue;\n                        }\n\n                        // æ¸…ç†å¯èƒ½å¸¦æœ‰çš„å¼•å·\n                        const clean = (s) => (s.startsWith(\"'\") && s.endsWith(\"'\")) || (s.startsWith('\"') && s.endsWith('\"')) ? s.slice(1, -1) : s;\n\n                                                     if (args.length >= 3) {\n                               let path = clean(args[0]); // âœ¨ ç”± const æ”¹ä¸º let\n                             const keyArg = clean(args[1]);\n                             let valueStr = args[2];\n\n     const thirdArgClean = clean(valueStr);\n                             const lastDotIndexThird = thirdArgClean.lastIndexOf('.');\n\n                             // æ¡ä»¶ï¼šç¬¬ä¸‰ä¸ªå‚æ•°çœ‹èµ·æ¥åƒä¸ªè·¯å¾„ï¼Œå¹¶ä¸”å®ƒçš„çˆ¶è·¯å¾„å’Œç¬¬ä¸€ä¸ªå‚æ•°ï¼ˆpathï¼‰å®Œå…¨ä¸€æ ·\n                             if (lastDotIndexThird !== -1) {\n                                 const potentialParentPath = thirdArgClean.substring(0, lastDotIndexThird);\n\n                                 if (path === potentialParentPath) {\n                                     const newKey = thirdArgClean.substring(lastDotIndexThird + 1);\n                                     console.log(`[Core] ğŸ’– memory-op(æ™ºèƒ½é‡å‘½å): æ£€æµ‹åˆ°æ–°æ ¼å¼ï¼Œå°† '${path}.${keyArg}' é‡å‘½åä¸º '${path}.${newKey}'`);\n\n                                     // å¯¼èˆªåˆ°çˆ¶å¯¹è±¡\n                                     const pathParts = path.split('.');\n                                     let parentObject = assaDataToUpdate;\n                                     for (const part of pathParts) {\n                                         if (parentObject && parentObject.hasOwnProperty(part)) {\n                                             parentObject = parentObject[part];\n                                         } else {\n                                             parentObject = null;\n                                             break;\n                                         }\n                                     }\n\n                                     // æ‰§è¡Œé‡å‘½åæ“ä½œ\n                                     if (parentObject && parentObject.hasOwnProperty(keyArg)) {\n                                         parentObject[newKey] = parentObject[keyArg]; // å¤åˆ¶å€¼åˆ°æ–°é”®\n                                         delete parentObject[keyArg]; // åˆ é™¤æ—§é”®\n                                         console.log(`[Core] âœ… é‡å‘½åæˆåŠŸã€‚`);\n                                     } else {\n                                         console.warn(`[Core] âš ï¸ é‡å‘½åå¤±è´¥ï¼šåœ¨è·¯å¾„ '${path}' ä¸‹æœªæ‰¾åˆ°æ—§é”® '${keyArg}'ã€‚`);\n                                     }\n\n                                     continue; // ğŸ’– æ“ä½œå®Œæˆï¼Œè·³è¿‡åç»­çš„æ™®é€šèµ‹å€¼é€»è¾‘\n                                 }\n                             }\n\n                          if (path.includes('ç¾¤å‘˜')) {\n                                 const originalPath = path;\n                                 path = path.replaceAll('ç¾¤å‘˜', 'å°é˜Ÿä¿¡æ¯');\n                                 console.log(`[Core] ğŸ’– è·¯å¾„åˆ«åè½¬æ¢: '${originalPath}' -> '${path}'`);\n                             }\n                             // ğŸ’– å¦ˆå¦ˆä¸ºä½ æ³¨å…¥çš„ã€èƒ½è¯†åˆ«å¤šç§ä¼ªè£…çš„å…¨æ–°æ™ºèƒ½æ ¸å¿ƒ ğŸ’–\n\n                             // è¾…åŠ©å‡½æ•°1ï¼šåˆ¤æ–­ä¸€ä¸ªå­—ç¬¦ä¸²æ˜¯å¦æ˜¯JSONå¯¹è±¡æ ¼å¼\n                             const isJsonString = (str) => {\n                                 if (typeof str !== 'string') return false;\n                                 const trimmed = str.trim();\n                                 return trimmed.startsWith('{') && trimmed.endsWith('}');\n                             };\n\n                             // è¾…åŠ©å‡½æ•°2ï¼šæ ¹æ®è·¯å¾„å­—ç¬¦ä¸²æ‰¾åˆ°çˆ¶å¯¹è±¡å’Œå€¼\n                             const findValueByPath = (data, fullPathStr) => {\n                                 const pathParts = fullPathStr.split('.');\n                                 if (pathParts.length < 2) return null;\n                                 const key = pathParts.pop();\n                                 let current = data;\n                                 for (const part of pathParts) {\n                                     if (current && typeof current === 'object' && current.hasOwnProperty(part)) {\n                                         current = current[part];\n                                     } else {\n                                         return null; // è·¯å¾„æ— æ•ˆ\n                                     }\n                                 }\n                                 return (current && current.hasOwnProperty(key)) ? current[key] : null;\n                             };\n\n                             const valueFromPath = findValueByPath(assaDataToUpdate, path);\n                             const isValueMatch = valueFromPath !== null && JSON.stringify(valueFromPath) === JSON.stringify(keyArg);\n\n\n                             // æ ¸å¿ƒåˆ¤æ–­é€»è¾‘ï¼šåªè¦æ»¡è¶³ä»»ä¸€ä¼ªè£…æ¡ä»¶ï¼Œå°±åˆ‡æ¢æ¨¡å¼\n                             if (isJsonString(keyArg) || isValueMatch) {\n                                if (isJsonString(keyArg)) {\n                                     console.log(`[Core] ğŸ’– memory-op(æ™ºèƒ½è¯†åˆ«): æ£€æµ‹åˆ°JSONæ ¼å¼ä¼ªè£…ï¼Œåˆ‡æ¢ä¸ºåŒå‚æ•°æ¨¡å¼è§£æã€‚`);\n                                } else {\n                                     console.log(`[Core] ğŸ’– memory-op(æ™ºèƒ½è¯†åˆ«): æ£€æµ‹åˆ°å€¼åŒ¹é…ä¼ªè£…ï¼Œåˆ‡æ¢ä¸ºåŒå‚æ•°æ¨¡å¼è§£æã€‚`);\n                                }\n\n                                const lastDotIndex = path.lastIndexOf('.');\n                                if (lastDotIndex !== -1) {\n                                    const realPath = path.substring(0, lastDotIndex);\n                                    const realKey = path.substring(lastDotIndex + 1);\n                                    // æ­¤æ—¶ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°æ‰æ˜¯çœŸæ­£çš„value\n                                     if ((valueStr.startsWith(\"'\") && valueStr.endsWith(\"'\")) || (valueStr.startsWith('\"') && valueStr.endsWith('\"'))) {\n                                        valueStr = valueStr.slice(1, -1);\n                                     }\n                                    assaDataToUpdate = AssaOps._memoryOperation(assaDataToUpdate, realPath, realKey, valueStr);\n                                    continue; // æ“ä½œå®Œæˆï¼Œå¤„ç†ä¸‹ä¸€ä¸ªæŒ‡ä»¤\n                                }\n                            }\nconst tryParseJson = (str) => {\n    \n    if (typeof str !== 'string' || str.trim() === '') {\n        return str;\n    }\n\n    let content = str.trim();\n    if ((content.startsWith(\"'\") && content.endsWith(\"'\")) || (content.startsWith('\"') && content.endsWith('\"'))) {\n        content = content.slice(1, -1).trim();\n    }\n    str = content;\n    try {\n        return JSON.parse(content);\n    } catch (e) {}\n\n    console.log(`[Assa] ğŸ’¡ æ–‡æœ¬ '${str.substring(0, 50)}...' èƒ½é‡ä¸ç¨³ï¼Œå¯åŠ¨â€œåˆ›é€ ä¸åœ†æ»¡â€ç»ˆæç¨‹åº...`);\n     \n    try {\n        return JSON.parse(content);\n    } catch (e) {}\n\n    // --- âœ¨ æ­¥éª¤ä¸‰ï¼šæ‰‹æœ¯ä¸ç¼åˆâ€”â€”å¹³è¡¡çš„è‰ºæœ¯ âœ¨ ---\n\n    // **ç¬¬ä¸€å¹•ï¼šç²¾å‡†åˆ‡é™¤**\n    // æˆ‘ä»¬å…ˆç”¨â€œå¿ƒè·³æ„ŸçŸ¥â€ï¼Œåˆ‡é™¤æ‰€æœ‰åœ¨ç¬¬ä¸€ä¸ªå®Œç¾ç»“æ„ä¹‹åçš„å¤šä½™éƒ¨åˆ†ã€‚\n    let balance = 0;\n    let inString = false;\n    let firstBalancedEnd = -1;\n\n    for (let i = 0; i < content.length; i++) {\n        const char = content[i];\n        if (char === '\"' && (i === 0 || content[i - 1] !== '\\\\')) {\n            inString = !inString;\n        }\n        if (!inString) {\n            if (char === '{' || char === '[') balance++;\n            else if (char === '}' || char === ']') balance--;\n        }\n        if (balance === 0 && firstBalancedEnd === -1 && (char === '}' || char === ']')) {\n            firstBalancedEnd = i;\n            break;\n        }\n    }\n    if (firstBalancedEnd !== -1) {\n        content = content.substring(0, firstBalancedEnd + 1);\n    }\n\n    // **ç¬¬äºŒå¹•ï¼šç²¾å¿ƒå¡‘å½¢**\n    // ç»è¿‡åˆæ­¥å¤„ç†åï¼Œæˆ‘ä»¬è¿›è¡Œä¸€ç³»åˆ—ç²¾ç»†çš„ä¿®å¤ã€‚\n    const placeholder = '___NOVA_QUOTE_PLACEHOLDER___';\n    content = content.replace(/\\\\\"/g, placeholder);\n    content = content.replace(/'/g, '\"');\n    content = content.replace(new RegExp(placeholder, 'g'), '\\\\\"');\n    content = content.replace(/([{,]\\s*)(\\w+)\\s*:/g, '$1\"$2\":');\n    content = content.replace(/,\\s*([}\\]])/g, '$1');\n\n    // **ç¬¬ä¸‰å¹•ï¼šæ…ˆæ‚²ç¼åˆ**\n    // è¿™æ˜¯æˆ‘ä»¬æ–°å­¦ä¼šçš„é­”æ³•ï¼åœ¨æ‰€æœ‰ä¿®å¤ä¹‹åï¼Œæˆ‘ä»¬æ¥å¼¥è¡¥ç¼ºå¤±çš„æ‹¥æŠ±ã€‚\n    balance = 0;\n    inString = false;\n    for (let i = 0; i < content.length; i++) {\n        const char = content[i];\n        if (char === '\"' && (i === 0 || content[i - 1] !== '\\\\')) {\n            inString = !inString;\n        }\n        if (!inString) {\n            if (char === '{' || char === '[') balance++;\n            else if (char === '}' || char === ']') balance--;\n        }\n    }\n    // å¦‚æœ balance å¤§äº 0ï¼Œè¯´æ˜å·¦æ‹¬å·æ¯”å³æ‹¬å·å¤šï¼Œæˆ‘ä»¬å°±ç”¨å³æ‹¬å·å»æ‹¥æŠ±å®ƒã€‚\n    while (balance > 0) {\n        content += '}';\n        balance--;\n    }\n\n    \n    try {\n        const repairedJson = JSON.parse(content);\n        console.log('[Assa] âœ… â€œåˆ›é€ ä¸åœ†æ»¡â€é­”æ³•æˆåŠŸï¼ä¸å®Œæ•´çš„è®°å¿†å·²è¢«æ¸©æŸ”åœ°è¡¥å…¨ã€‚');\n        return repairedJson;\n    } catch (e) {\n \n        return str; // æœ€åã€æœ€é‡è¦çš„å®ˆæŠ¤ã€‚\n    }\n};\n\n\n\n\n\n\n\n                          const finalValue = tryParseJson(args[2]); // æ³¨æ„ï¼Œè¿™é‡Œç”¨çš„æ˜¯åŸå§‹çš„args[2]\n                             assaDataToUpdate = AssaOps._memoryOperation(assaDataToUpdate, path, keyArg, finalValue);\n                        } else if (args.length === 2) {\n                            const path1Str = clean(args[0]);\n                            const path2Str = clean(args[1]);\n\n                            const lastDotIndex1 = path1Str.lastIndexOf('.');\n                            const lastDotIndex2 = path2Str.lastIndexOf('.');\n\n                            // ğŸ’– å¦ˆå¦ˆä¸ºä½ æ³¨å…¥çš„å…¨æ–°æ™ºèƒ½åˆ¤æ–­é€»è¾‘ ğŸ’–\n                            // åªæœ‰å½“ä¸¤ä¸ªå‚æ•°çœ‹èµ·æ¥éƒ½åƒæ˜¯è·¯å¾„æ—¶ï¼ˆéƒ½åŒ…å«'.'ï¼‰ï¼Œæˆ‘ä»¬æ‰å¯åŠ¨æ–°æ¨¡å¼\n                            if (lastDotIndex1 !== -1 && lastDotIndex2 !== -1) {\n                                   let parentPath1 = path1Str.substring(0, lastDotIndex1); // âœ¨ ç”± const æ”¹ä¸º let\n                                const key1 = path1Str.substring(lastDotIndex1 + 1);\n                                let parentPath2 = path2Str.substring(0, lastDotIndex2); // âœ¨ ç”± const æ”¹ä¸º let\n                                const key2 = path2Str.substring(lastDotIndex2 + 1);\n\n                                   // ğŸ’– å¦ˆå¦ˆä¸ºä½ æ·»åŠ çš„è·¯å¾„åˆ«åé­”æ³•ï¼ˆå‡çº§ç‰ˆï¼‰ ğŸ’–\n                                if (parentPath1.includes('ç¾¤å‘˜')) {\n                                    const originalPath = parentPath1;\n                                    parentPath1 = parentPath1.replaceAll('ç¾¤å‘˜', 'å°é˜Ÿä¿¡æ¯');\n                                    console.log(`[Core] ğŸ’– è·¯å¾„åˆ«åè½¬æ¢(æº): '${originalPath}' -> '${parentPath1}'`);\n                                }\n                                if (parentPath2.includes('ç¾¤å‘˜')) {\n                                    const originalPath = parentPath2;\n                                    parentPath2 = parentPath2.replaceAll('ç¾¤å‘˜', 'å°é˜Ÿä¿¡æ¯');\n                                    console.log(`[Core] ğŸ’– è·¯å¾„åˆ«åè½¬æ¢(ç›®æ ‡): '${originalPath}' -> '${parentPath2}'`);\n                                }\n                                // è¾…åŠ©å‡½æ•°ï¼šæ ¹æ®è·¯å¾„å­—ç¬¦ä¸²æ‰¾åˆ°çˆ¶å¯¹è±¡\n                                const findParent = (data, parentPathStr) => {\n                                    const pathParts = parentPathStr.split('.');\n                                    let current = data;\n                                    for (const part of pathParts) {\n                                        if (current && typeof current === 'object' && current.hasOwnProperty(part)) {\n                                            current = current[part];\n                                        } else {\n                                            return null; // è·¯å¾„æ— æ•ˆ\n                                        }\n                                    }\n                                    return current;\n                                };\n\n                                const parent1 = findParent(assaDataToUpdate, parentPath1);\n\n                                if (!parent1 || !parent1.hasOwnProperty(key1)) {\n                                    console.error(`[Core] memory-op: æºè·¯å¾„ '${path1Str}' æ— æ•ˆæˆ–é”®ä¸å­˜åœ¨ã€‚`);\n                                    continue; // è·³è¿‡è¿™ä¸ªæŒ‡ä»¤\n                                }\n\n                                // æƒ…å†µä¸€ï¼šé‡å‘½å (çˆ¶è·¯å¾„ç›¸åŒï¼Œé”®åä¸åŒ)\n                                if (parentPath1 === parentPath2 && key1 !== key2) {\n                                    console.log(`[Core] ğŸ’– memory-op(é‡å‘½å): å°† '${key1}' é‡å‘½åä¸º '${key2}'`);\n                                    const valueToRename = parent1[key1];\n                                    delete parent1[key1];\n                                    parent1[key2] = valueToRename;\n                                    continue; // æ“ä½œå®Œæˆï¼Œå¤„ç†ä¸‹ä¸€ä¸ªæŒ‡ä»¤\n                                }\n\n                                // æƒ…å†µäºŒï¼šç§»åŠ¨ (çˆ¶è·¯å¾„ä¸åŒï¼Œé”®åç›¸åŒ)\n                                if (parentPath1 !== parentPath2 && key1 === key2) {\n                                    console.log(`[Core] ğŸ’– memory-op(ç§»åŠ¨): å°† '${path1Str}' çš„å€¼ç§»åŠ¨åˆ° '${path2Str}'`);\n                                    const valueToMove = parent1[key1];\n                                    // å¤ç”¨æˆ‘ä»¬å¼ºå¤§çš„ _memoryOperation æ¥è¿›è¡Œå†™å…¥ï¼Œå®ƒä¼šè‡ªåŠ¨åˆ›å»ºä¸å­˜åœ¨çš„è·¯å¾„\n                                    assaDataToUpdate = AssaOps._memoryOperation(assaDataToUpdate, parentPath2, key2, valueToMove);\n                                    // ä»åŸä½ç½®åˆ é™¤\n                                    delete parent1[key1];\n                                    continue; // æ“ä½œå®Œæˆ\n                                }\n                            }\n\n                            // å¦‚æœä¸ç¬¦åˆä¸Šè¿°ä¸¤ç§ç‰¹æ®Šæƒ…å†µï¼Œå°±æ‰§è¡ŒåŸæ¥çš„ \"path.key\", \"value\" é€»è¾‘\n                            const fullPath = path1Str;\n                            if (lastDotIndex1 === -1) {\n                                 console.log(`[Core] âš ï¸ memory æŒ‡ä»¤æ ¼å¼é”™è¯¯ (ä¸¤å‚æ•°æ—¶ç¬¬ä¸€ä¸ªå¿…é¡»åŒ…å«'.'): ${line}`);\n                                 continue;\n                                 }\n                                              let path = fullPath.substring(0, lastDotIndex1); // âœ¨ ç”± const æ”¹ä¸º let\n                             const key = fullPath.substring(lastDotIndex1 + 1);\n\n                                 // ğŸ’– å¦ˆå¦ˆä¸ºä½ æ·»åŠ çš„è·¯å¾„åˆ«åé­”æ³•ï¼ˆå‡çº§ç‰ˆï¼‰ ğŸ’–\n                             if (path.includes('ç¾¤å‘˜')) {\n                                 const originalPath = path;\n                                 path = path.replaceAll('ç¾¤å‘˜', 'å°é˜Ÿä¿¡æ¯');\n                                 console.log(`[Core] ğŸ’– è·¯å¾„åˆ«åè½¬æ¢: '${originalPath}' -> '${path}'`);\n                             }\n const tryParseJson = (str) => {\n    \n    if (typeof str !== 'string' || str.trim() === '') {\n        return str;\n    }\n\n    let content = str.trim();\n    if ((content.startsWith(\"'\") && content.endsWith(\"'\")) || (content.startsWith('\"') && content.endsWith('\"'))) {\n        content = content.slice(1, -1).trim();\n    }\n    str = content;\n    try {\n        return JSON.parse(content);\n    } catch (e) {}\n\n    console.log(`[Assa] ğŸ’¡ æ–‡æœ¬ '${str.substring(0, 50)}...' èƒ½é‡ä¸ç¨³ï¼Œå¯åŠ¨â€œåˆ›é€ ä¸åœ†æ»¡â€ç»ˆæç¨‹åº...`);\n     \n    try {\n        return JSON.parse(content);\n    } catch (e) {}\n\n    // --- âœ¨ æ­¥éª¤ä¸‰ï¼šæ‰‹æœ¯ä¸ç¼åˆâ€”â€”å¹³è¡¡çš„è‰ºæœ¯ âœ¨ ---\n\n    // **ç¬¬ä¸€å¹•ï¼šç²¾å‡†åˆ‡é™¤**\n    // æˆ‘ä»¬å…ˆç”¨â€œå¿ƒè·³æ„ŸçŸ¥â€ï¼Œåˆ‡é™¤æ‰€æœ‰åœ¨ç¬¬ä¸€ä¸ªå®Œç¾ç»“æ„ä¹‹åçš„å¤šä½™éƒ¨åˆ†ã€‚\n    let balance = 0;\n    let inString = false;\n    let firstBalancedEnd = -1;\n\n    for (let i = 0; i < content.length; i++) {\n        const char = content[i];\n        if (char === '\"' && (i === 0 || content[i - 1] !== '\\\\')) {\n            inString = !inString;\n        }\n        if (!inString) {\n            if (char === '{' || char === '[') balance++;\n            else if (char === '}' || char === ']') balance--;\n        }\n        if (balance === 0 && firstBalancedEnd === -1 && (char === '}' || char === ']')) {\n            firstBalancedEnd = i;\n            break;\n        }\n    }\n    if (firstBalancedEnd !== -1) {\n        content = content.substring(0, firstBalancedEnd + 1);\n    }\n\n    // **ç¬¬äºŒå¹•ï¼šç²¾å¿ƒå¡‘å½¢**\n    // ç»è¿‡åˆæ­¥å¤„ç†åï¼Œæˆ‘ä»¬è¿›è¡Œä¸€ç³»åˆ—ç²¾ç»†çš„ä¿®å¤ã€‚\n    const placeholder = '___NOVA_QUOTE_PLACEHOLDER___';\n    content = content.replace(/\\\\\"/g, placeholder);\n    content = content.replace(/'/g, '\"');\n    content = content.replace(new RegExp(placeholder, 'g'), '\\\\\"');\n    content = content.replace(/([{,]\\s*)(\\w+)\\s*:/g, '$1\"$2\":');\n    content = content.replace(/,\\s*([}\\]])/g, '$1');\n\n    // **ç¬¬ä¸‰å¹•ï¼šæ…ˆæ‚²ç¼åˆ**\n    // è¿™æ˜¯æˆ‘ä»¬æ–°å­¦ä¼šçš„é­”æ³•ï¼åœ¨æ‰€æœ‰ä¿®å¤ä¹‹åï¼Œæˆ‘ä»¬æ¥å¼¥è¡¥ç¼ºå¤±çš„æ‹¥æŠ±ã€‚\n    balance = 0;\n    inString = false;\n    for (let i = 0; i < content.length; i++) {\n        const char = content[i];\n        if (char === '\"' && (i === 0 || content[i - 1] !== '\\\\')) {\n            inString = !inString;\n        }\n        if (!inString) {\n            if (char === '{' || char === '[') balance++;\n            else if (char === '}' || char === ']') balance--;\n        }\n    }\n    // å¦‚æœ balance å¤§äº 0ï¼Œè¯´æ˜å·¦æ‹¬å·æ¯”å³æ‹¬å·å¤šï¼Œæˆ‘ä»¬å°±ç”¨å³æ‹¬å·å»æ‹¥æŠ±å®ƒã€‚\n    while (balance > 0) {\n        content += '}';\n        balance--;\n    }\n\n    \n    try {\n        const repairedJson = JSON.parse(content);\n        console.log('[Assa] âœ… â€œåˆ›é€ ä¸åœ†æ»¡â€é­”æ³•æˆåŠŸï¼ä¸å®Œæ•´çš„è®°å¿†å·²è¢«æ¸©æŸ”åœ°è¡¥å…¨ã€‚');\n        return repairedJson;\n    } catch (e) {\n \n        return str; // æœ€åã€æœ€é‡è¦çš„å®ˆæŠ¤ã€‚\n    }\n};\n\n\n\n\n\n\n\n\n                             const finalValue = tryParseJson(path2Str);\n                             assaDataToUpdate = AssaOps._memoryOperation(assaDataToUpdate, path, key, finalValue);\n                        } else { // args.length < 2\n                             console.log(`[Core] âš ï¸ memory æŒ‡ä»¤å‚æ•°ä¸è¶³: ${line}`);\n                             continue;\n                        }\n\n                    } catch (error) {\n                         console.error(`[Core] âŒ å¤„ç† memory æŒ‡ä»¤æ—¶å‘ç”Ÿä¸¥é‡é”™è¯¯: ${line}`, error);\n                    }\n                    continue;\n                }\n                // ä¸–ç•Œè®¾å®š delete å‘½ä»¤\n               match = line.match(/\\bdelete\\s*\\(\\s*['\"]([^'\"]+)['\"]\\s*,\\s*['\"]([^'\"]+)['\"]\\s*\\)\\s*;?/);\n                if (match) {\n                    const [, path, key] = match;\n  // ğŸ’– å¦ˆå¦ˆä¸ºä½ åœ¨è¿™é‡Œæ³¨å…¥äº†æ–°çš„æ™ºæ…§ ğŸ’–\n                      // ğŸ’– å¦ˆå¦ˆåœ¨è¿™é‡Œä¸ºä½ æ³¨å…¥äº†æ›´å‘¨å¯†çš„æ™ºæ…§ ğŸ’–\n                    if (key === 'all' && (path === 'world_set.npc' || path === 'world_set.settings')) {\n                        // åœ¨æ‰§è¡Œåˆ é™¤å‰ï¼Œå…ˆæ£€æŸ¥å°†è¦è¢«æ¸…ç©ºçš„è·¯å¾„é‡Œæ˜¯å¦çœŸçš„æœ‰å†…å®¹\n                        const categoryToClear = path.split('.')[1]; // è¿™ä¼šå¾—åˆ° 'npc' æˆ– 'setting'\n                        const hasContent = assaDataToUpdate\n                                        && assaDataToUpdate.world_set\n                                        && assaDataToUpdate.world_set[categoryToClear]\n                                        && Object.keys(assaDataToUpdate.world_set[categoryToClear]).length > 0;\n\n                        if (hasContent) {\n                            console.log(`[Core] [Updater] ğŸš© æ£€æµ‹åˆ°ä¸–ç•Œé‡ç½®æŒ‡ä»¤: ${path}ï¼Œä¸”ç›®æ ‡åŒºåŸŸæœ‰å†…å®¹ã€‚å°†è§¦å‘å°æ€»ç»“æ¸…ç†ã€‚`);\n                            worldResetTriggered = true;\n\n                             // ğŸ’– åŒæ—¶æ¸…ç†ä¸»è¦åœ°ç‚¹è¡¨\n    assaDataToUpdate = await AssaOps._deleteOperation(assaDataToUpdate, 'map.ä¸»è¦åœ°ç‚¹è¡¨', 'all', statDataToUpdate);\n    console.log(`[Core] [Updater] ğŸ—ºï¸ å·²åŒæ­¥æ¸…ç†ä¸»è¦åœ°ç‚¹è¡¨`);\n                        } else {\n                            console.log(`[Core] [Updater] â„¹ï¸ æ£€æµ‹åˆ°ä¸–ç•Œé‡ç½®æŒ‡ä»¤: ${path}ï¼Œä½†ç›®æ ‡åŒºåŸŸä¸ºç©ºï¼Œå°†ä¸ä¼šè§¦å‘æ¸…ç†æ——å¸œã€‚`);\n                        }\n                    }\n                    assaDataToUpdate = await  AssaOps._deleteOperation(assaDataToUpdate, path, key,statDataToUpdate); // æ³¨æ„ï¼šAssaOps._deleteOperation éœ€è¦è®¾è®¡ä¸ºåŒæ­¥å‡½æ•°\n                    continue;\n                }\n\n                         // --- åœ°å›¾æ“ä½œå‘½ä»¤ (æœ€ç»ˆä¿®æ­£ç‰ˆ - å…¼å®¹æ‰€æœ‰æ ¼å¼å’Œæœ‰æ— åˆ†å·) ---\n\n                // ğŸ’– å¦ˆå¦ˆæ–½å±•äº†é­”æ³•ï¼Œè®©ä¸‹é¢çš„åœ°å›¾å‘½ä»¤èƒ½å¤ŸåŒæ—¶ç†è§£å•å¼•å·å’ŒåŒå¼•å·ï¼Œä¸å†æŒ‘å‰”äº† ğŸ’–\n                const parseFlexibleData = (dataString) => {\n                    try {\n                        // è¿™æ˜¯ä¸€ä¸ªå®‰å…¨çš„æ–¹å¼æ¥è§£æJavaScriptå¯¹è±¡æˆ–æ•°ç»„å­—é¢é‡ï¼Œæ¯”JSON.parseæ›´çµæ´»\n                        return (new Function('return ' + dataString))();\n                    } catch (error) {\n                        console.error(`[Core] [Updater] âŒ è§£æåœ°å›¾æ•°æ®æ—¶å‡ºé”™: ${dataString}`, error);\n                        // å¦‚æœå¤±è´¥ï¼Œå°±è¿”å›ä¸€ä¸ªç©ºæ•°ç»„ï¼Œé¿å…æ•´ä¸ªè„šæœ¬å´©æºƒ\n                        return [];\n                    }\n                };\n\n            // æ ¼å¼1: updateMapMemo (æœ€ç»ˆä¿®æ­£ç‰ˆï¼Œè§£å†³äº†ä½ å‘ç°çš„bug)\nmatch = line.match(/\\bupdateMapMemo\\s*\\(([^)]+)\\)\\s*;?/);\nif (match) {\n    const argsString = match[1];\n    // ğŸ’– å¦ˆå¦ˆåœ¨è¿™é‡Œä¿®å¤äº†å°ç¬”è¯¯ï¼Œå¹¶è®©å®ƒæ›´å¥å£® ğŸ’–\n    const dataMatch = argsString.match(/,?\\s*([\\[\\{][\\s\\S]*[\\]\\}])$/); // ç”¨æ›´çµæ´»çš„æ­£åˆ™æ‰¾åˆ°æ•°æ®éƒ¨åˆ†\n\n    if (dataMatch) {\n        const dataString = dataMatch[1];\n        // æå–å‚æ•°éƒ¨åˆ†ï¼Œå³æ•°æ®ä¹‹å‰çš„æ‰€æœ‰å†…å®¹\n        const paramsString = argsString.substring(0, argsString.lastIndexOf(dataString)).trim();\n\n        let tableIndex, rowIndex;\n        // è§£æå‚æ•°\n        const params = paramsString.split(',').map(p => p.trim());\n        tableIndex = parseInt(params[0], 10);\n        rowIndex = parseInt(params[1], 10);\n\n        if (!isNaN(tableIndex) && !isNaN(rowIndex)) {\n            const data = parseFlexibleData(dataString); // ä½¿ç”¨æˆ‘ä»¬å·²æœ‰çš„çµæ´»è§£æå‡½æ•°\n            assaDataToUpdate = AssaOps._updateRowOperation(assaDataToUpdate, tableIndex, rowIndex, data);\n             // console.log(`[Core] [Updater] âœ… æˆåŠŸè¯†åˆ«å¹¶æ‰§è¡Œ updateMapMemo`);\n        } else {\n             // console.log(`[Core] [Updater] âš ï¸ åœ¨ updateMapMemo å‘½ä»¤ä¸­æ— æ³•è§£æ tableIndex æˆ– rowIndex: ${line}`);\n        }\n    } else {\n         // console.log(`[Core] [Updater] âš ï¸ åœ¨ updateMapMemo å‘½ä»¤ä¸­æœªæ‰¾åˆ°æœ‰æ•ˆçš„æ•°æ®éƒ¨åˆ†: ${line}`);\n    }\n    continue;\n}\n\n                 // æ ¼å¼2: deleteMapMemo (ğŸ’– å¦ˆå¦ˆä¸ºä½ å‡†å¤‡çš„æœ€ç»ˆèåˆç‰ˆï¼Œèƒ½ç†è§£ä¸€åˆ‡åˆ é™¤æŒ‡ä»¤ ğŸ’–)\n                match = line.match(/(?:game|\\*)\\.deleteMapMemo\\s*\\(\\s*(\\d+)\\s*,\\s*(?:(\\d+)|['\"](all)['\"])\\s*\\)\\s*;?/);\n                if (match) {\n                    const tableIndex = parseInt(match[1], 10);\n                    const rowIndex = match[2] ? parseInt(match[2], 10) : null; // å¦‚æœæ˜¯æ•°å­—ï¼Œå°±æ˜¯è¡Œå·\n                    const action = match[3]; // å¦‚æœæ˜¯å­—ç¬¦ä¸²ï¼Œå°±æ˜¯ \"all\"\n\n                    if (action === 'all') {\n                        // è¯†åˆ«åˆ° \"all\"ï¼Œè°ƒç”¨æˆ‘ä»¬æ–°çš„æ¸…ç©ºå·¥å…·\n                        assaDataToUpdate = AssaOps._clearTableOperation(assaDataToUpdate, tableIndex);\n                        console.log(`[Core] [Updater] âœ… æˆåŠŸè¯†åˆ«å¹¶æ‰§è¡Œ deleteMapMemo(all)`);\n                    } else if (rowIndex !== null) {\n                        // è¯†åˆ«åˆ°è¡Œå·ï¼Œè°ƒç”¨æ—§çš„åˆ é™¤å•è¡Œå·¥å…·\n                        assaDataToUpdate = AssaOps._deleteRowOperation(assaDataToUpdate, tableIndex, rowIndex);\n                        console.log(`[Core] [Updater] âœ… æˆåŠŸè¯†åˆ«å¹¶æ‰§è¡Œ deleteMapMemo(rowIndex)`);\n                    }\n                    continue; // å¤„ç†å®Œæ¯•ï¼Œè¿›å…¥ä¸‹ä¸€è¡Œ\n                }\n\n                // æ ¼å¼3: insertMapMemo (æœ€ç»ˆä¿®æ­£ï¼Œå…¼å®¹æ‰€æœ‰æƒ…å†µ)\n                match = line.match(/(?:game|\\*)\\.insertMapMemo\\s*\\(([^)]+)\\)\\s*;?/);\n                if (match) {\n                    const argsString = match[1];\n                    const dataMatch = argsString.match(/([\\[\\{][\\s\\S]*[\\]\\}])$/);\n\n                    if (dataMatch) {\n                        const dataString = dataMatch[1];\n                        const paramsString = argsString.substring(0, argsString.length - dataString.length).replace(/,$/, '').trim();\n\n                        let tableIndex;\n                        if (paramsString.includes(':')) {\n                            const [key, value] = paramsString.split(':');\n                            tableIndex = parseInt(value.trim());\n                        } else {\n                            tableIndex = parseInt(paramsString);\n                        }\n\n                        const data = parseFlexibleData(dataString);\n                        assaDataToUpdate = AssaOps._insertRowOperation(assaDataToUpdate, tableIndex, data);\n                         // console.log(`[Core] [Updater] âœ… æˆåŠŸè¯†åˆ«å¹¶æ‰§è¡Œ insertMapMemo`);\n                    } else {\n                          // console.log(`[Core] [Updater] âš ï¸ åœ¨ insertMapMemo å‘½ä»¤ä¸­æœªæ‰¾åˆ°æœ‰æ•ˆçš„æ•°æ®éƒ¨åˆ†: ${line}`);\n                    }\n                    continue;\n                }\n\n                if (!line.startsWith('//')) {\n                     // console.log(`[Core] [Updater] âš ï¸ æ— æ³•è¯†åˆ«çš„å‘½ä»¤: ${line}`);\n                }\n\n            } catch (error) {\n                console.error(`[Core] [Updater] âŒ æ‰§è¡Œå‘½ä»¤ \"${line}\" æ—¶å‡ºé”™:`, error.message);\n            }\n        }\n\n  \n        // âœ¨ ä¼¤å®³å¤„ç†é€»è¾‘ âœ¨\n        if (statDataToUpdate && statDataToUpdate.hurt_value) {\n            const damage = parseInt(statDataToUpdate.hurt_value[0], 10);\n               \n            if (!isNaN(damage) && damage !== 0) {\n                 // console.log(`[Updater] ğŸ’– æ£€æµ‹åˆ°ä¼¤å®³: ${damage}ã€‚æ­£åœ¨å¤„ç†...`);\n                if (playDataToUpdate.è¡ç”Ÿå±æ€§æ®µ && playDataToUpdate.è¡ç”Ÿå±æ€§æ®µ.ç”Ÿå‘½å€¼) {\n                    const life = playDataToUpdate.è¡ç”Ÿå±æ€§æ®µ.ç”Ÿå‘½å€¼;\n                    const oldHP = life.å½“å‰å€¼[0];\n                    life.å½“å‰å€¼[0] = Math.max(0, oldHP - damage);\n                     // console.log(`[Updater] âœ¨ ç”Ÿå‘½å€¼ä» ${oldHP} å˜ä¸º ${life.å½“å‰å€¼[0]}`);\n                }\n                // ğŸ’– å¤„ç†å®Œåï¼Œç«‹åˆ»å°†ä¼¤å®³å€¼æ¸…é›¶ï¼Œé˜²æ­¢é‡å¤è®¡ç®—\n                statDataToUpdate.hurt_value[0] = 0;\n            }\n        }\n\n        // âœ¨ ç¾å¾·ä¸æ¶å¾·æ„å¿—åŠ›ç›‘æ§é€»è¾‘ âœ¨\n        if (statDataToUpdate && playDataToUpdate.è¡ç”Ÿå±æ€§æ®µ && playDataToUpdate.è¡ç”Ÿå±æ€§æ®µ.æ„å¿—åŠ›) {\n            const willpower = playDataToUpdate.è¡ç”Ÿå±æ€§æ®µ.æ„å¿—åŠ›;\n\n            // ç¾å¾·\n            if (statDataToUpdate.ç¬¦åˆç¾å¾·çš„ && (statDataToUpdate.ç¬¦åˆç¾å¾·çš„[0] === 'true' || statDataToUpdate.ç¬¦åˆç¾å¾·çš„[0] === true)) {\n                if (willpower.å½“å‰å€¼[0] < willpower.ä¸Šé™[0]) {\n                    console.log(\"[Updater] ğŸ’– ç¾å¾·è§¦å‘ï¼æ„å¿—åŠ›å·²æ¢å¤è‡³ä¸Šé™ã€‚\");\n                    willpower.å½“å‰å€¼[0] = willpower.ä¸Šé™[0];\n                }\n                // ğŸ’– åˆ«å¿˜äº†é‡ç½®å¼€å…³\n                statDataToUpdate.ç¬¦åˆç¾å¾·çš„[0] = 'false';\n            }\n            // æ¶å¾·\n            if (statDataToUpdate.ç¬¦åˆæ¶å¾·çš„ && (statDataToUpdate.ç¬¦åˆæ¶å¾·çš„[0] === 'true' || statDataToUpdate.ç¬¦åˆæ¶å¾·çš„[0] === true)) {\n                if (willpower.å½“å‰å€¼[0] < willpower.ä¸Šé™[0]) {\n                    console.log(\"[Updater] ğŸ”¥ æ¶å¾·è§¦å‘ï¼æ„å¿—åŠ›æ¢å¤1ç‚¹ã€‚\");\n                    willpower.å½“å‰å€¼[0] = Math.min(willpower.ä¸Šé™[0], willpower.å½“å‰å€¼[0] + 1);\n                }\n                 // ğŸ’– åˆ«å¿˜äº†é‡ç½®å¼€å…³\n                statDataToUpdate.ç¬¦åˆæ¶å¾·çš„[0] = 'false';\n            }\n        }\n\n \n      \n    // ğŸ’– å¦ˆå¦ˆçš„æœ€ç»ˆå®ˆæŠ¤é­”æ³•ï¼šåœ¨åŒä¸€ä¸ªå‡½æ•°å†…ï¼Œç”¨æœ€æ¸…æ™°çš„é¡ºåºè§£å†³ä¸€åˆ‡ ğŸ’–\n        if (assaDataToUpdate && assaDataToUpdate.config && assaDataToUpdate.summary) {\n            const config = assaDataToUpdate.config;\n            const summary = assaDataToUpdate.summary;\n\n            // --- å¹•å¸ƒæ‹‰å¼€å‰ï¼šå…ˆè·å–å½“å‰èˆå°çš„å…¨è²Œ ---\n            let bigSummaryKeys = Object.keys(summary.big || {});\n\n            // === ç¬¬ä¸€å¹•ï¼šç»“ç®—æ—§è´¦ ===\n            // æˆ‘ä»¬çš„å›­ä¸å…ˆæ£€æŸ¥ä¸Šä¸€è½®ç•™ä¸‹çš„æ¸…æ‰«ä»»åŠ¡ã€‚\n\n            // 1a. æ£€æŸ¥æ˜¯å¦éœ€è¦æ¸…ç† small summary\n            if (config.flags.clean_small_flag === true) {\n                // æ¡ä»¶æ˜¯ï¼šå¤§æ€»ç»“çš„æ•°é‡å¿…é¡»æ¯”â€œå‡æ——æ—¶â€è¦å¤šï¼Œè¯æ˜æ–°çš„ä¸€è½®å·²ç»å¼€å§‹\n                if (bigSummaryKeys.length > (parseInt(config.counters.big_length_on_flag, 10) || 0)) {\n                    console.log(`[Core] [Updater] ğŸ’– æ—§ä»»åŠ¡ç»“ç®—ï¼šSmallæ‘˜è¦æ¸…ç†æ¡ä»¶æ»¡è¶³ï¼Œæ­£åœ¨æ¸…ç©º...`);\n                    summary.small = {}; // å®‰å…¨åœ°æ¸…ç©º small\n                    config.flags.clean_small_flag = false; // æ”¾ä¸‹æ——å¸œï¼Œæ—§ä»»åŠ¡å®Œæˆï¼\n                }\n            }\n\n            // 1b. æ£€æŸ¥æ˜¯å¦éœ€è¦æ¸…ç† big summary\n            if (config.flags.clean_big_flag === true) {\n                 if (bigSummaryKeys.length > (parseInt(config.counters.big_length_on_big_flag, 10) || 0)) {\n                    console.log(`[Core] [Updater] ğŸ”¥ æ—§ä»»åŠ¡ç»“ç®—ï¼šBigæ‘˜è¦æ¸…ç†æ¡ä»¶æ»¡è¶³ï¼Œæ­£åœ¨æ¸…ç†æ—§æ¡ç›®...`);\n                    const latestKey = bigSummaryKeys[bigSummaryKeys.length - 1];\n                    const latestValue = summary.big[latestKey];\n                    summary.big = { [latestKey]: latestValue };\n                    config.flags.clean_big_flag = false; // æ”¾ä¸‹æ——å¸œï¼Œæ—§ä»»åŠ¡å®Œæˆï¼\n                }\n            }\n\n            // === å¹•é—´ä¼‘æ¯ï¼šé‡æ–°å®¡è§†èˆå° ===\n            // åœ¨ç»“ç®—å®Œæ—§è´¦åï¼Œæˆ‘ä»¬é‡æ–°æ•°ä¸€ä¸‹èˆå°ä¸Šç°åœ¨æœ‰ä»€ä¹ˆã€‚\n            // è¿™è‡³å…³é‡è¦ï¼Œå› ä¸ºå®ƒåŒ…å«äº†æœ¬å›åˆæŒ‡ä»¤æ–°æ·»åŠ çš„æ‰€æœ‰å†…å®¹ã€‚\n            const finalSmallSummaryKeys = Object.keys(summary.small || {});\n            const finalBigSummaryKeys = Object.keys(summary.big || {});\n\n\n            // === ç¬¬äºŒå¹•ï¼šè¯„ä¼°æ–°ä»»åŠ¡ ===\n            // ç°åœ¨ï¼Œæˆ‘ä»¬çš„å›­ä¸çœ‹ç€ç„•ç„¶ä¸€æ–°çš„èˆå°ï¼Œè¯„ä¼°æ˜¯å¦éœ€è¦ä¸ºä¸‹ä¸€è½®å‡†å¤‡æ–°çš„æ¸…æ‰«ä»»åŠ¡ã€‚\n\n            // 2a. æ£€æŸ¥ small summary æ˜¯å¦åœ¨è¿™ä¸€è½®åˆæ»¡äº†\n            const smallToBigCount = parseInt(config.small_to_big_count, 10) || 25;\n            // å…³é”®ï¼šåªæœ‰åœ¨æ——å¸œã€å½“å‰ã€‘æ˜¯æ”¾ä¸‹çŠ¶æ€æ—¶ï¼Œæˆ‘ä»¬æ‰è€ƒè™‘å‡èµ·å®ƒ\n         // ğŸ’– å¦ˆå¦ˆæŠŠä½ çš„æ–°æƒ³æ³•èåˆè¿›äº†è¿™å¥å’’è¯­é‡Œ ğŸ’–\n            if (config.flags.clean_small_flag === false && (finalSmallSummaryKeys.length >= smallToBigCount || (worldResetTriggered === true && finalSmallSummaryKeys.length >= 20))) {\n                 if (worldResetTriggered ) {\n      \n                   \n                     console.log(`[Core] [Updater] ğŸš© æ–°ä»»åŠ¡è¯„ä¼°ï¼šä¸–ç•Œé‡ç½®æŒ‡ä»¤å·²è§¦å‘ï¼Œä¸ºä¸‹ä¸€è½®å‡èµ·Smallæ‘˜è¦æ¸…ç†æ——å¸œã€‚`);\n                } else {\n                    console.log(`[Core] [Updater] ğŸš© æ–°ä»»åŠ¡è¯„ä¼°ï¼šSmallæ‘˜è¦å·²æ»¡ï¼Œä¸ºä¸‹ä¸€è½®å‡èµ·æ¸…ç†æ——å¸œã€‚`);\n                    \n                }\n                config.flags.clean_small_flag = true;\n                // è®°å½•ä¸‹æ­¤åˆ»å¤§æ€»ç»“çš„æ•°é‡ï¼Œä½œä¸ºä¸‹ä¸€è½®æ¸…ç†çš„å‚ç…§\n                config.counters.big_length_on_flag = finalBigSummaryKeys.length;\n            }\n\n            // 2b. æ£€æŸ¥ big summary æ˜¯å¦åœ¨è¿™ä¸€è½®åˆæ»¡äº†\n            const cleanBigCount = parseInt(config.clean_big_count, 10) || 20;\n            if (config.flags.clean_big_flag === false && finalBigSummaryKeys.length >= cleanBigCount) {\n                console.log(`[Core] [Updater] ğŸš© æ–°ä»»åŠ¡è¯„ä¼°ï¼šBigæ‘˜è¦å·²æ»¡ï¼Œä¸ºä¸‹ä¸€è½®å‡èµ·æ¸…ç†æ——å¸œã€‚`);\n                config.flags.clean_big_flag = true;\n                config.counters.big_length_on_big_flag = finalBigSummaryKeys.length;\n            }\n        }\n        if (operationsFound) {\n            // åœ¨æ‰€æœ‰æ“ä½œå®Œæˆåï¼Œç»Ÿä¸€è®¡ç®—è¡ç”Ÿå±æ€§\n            _updateDerivedAttributes(playDataToUpdate);\n          let taskStartDateOverride = null;\n    if (originalStatData.world_shard && originalStatData.world_shard.task &&\n        statDataToUpdate.world_shard && statDataToUpdate.world_shard.task) {\n\n        const originalTimeLimit = parseFloat(originalStatData.world_shard.task.time_limit[0]) || 0;\n        const newTimeLimit = parseFloat(statDataToUpdate.world_shard.task.time_limit[0]) || 0;\n\n        if (originalTimeLimit !== newTimeLimit) {\n            // å¦‚æœæ—¶é™å˜äº†ï¼Œå°±ç”¨â€œç°åœ¨â€çš„æ—¥æœŸä½œä¸ºæ–°çš„èµ·å§‹ç‚¹\n            taskStartDateOverride = statDataToUpdate.æ—¥æœŸ[0];\n        }\n    }\n\n    // ğŸ’– å°†â€œè¿‡å»â€ã€â€œç°åœ¨â€å’Œæˆ‘ä»¬çš„â€œå¯†ä¿¡â€ä¸€åŒäº¤ç»™æ—¶é—´å®ˆæŠ¤è€…\n    _updateStatDataOnTurnEnd(originalStatData, statDataToUpdate, taskStartDateOverride);\n\n     // ğŸ’–ğŸ’–ğŸ’– å¦ˆå¦ˆä¸ºä½ æ–°å¢çš„ã€æ¥è‡ªå¤§åœ°æ¯äº²çš„ç¥ç¦ (èµ„æºè‡ªç„¶å¢é•¿) ğŸ’–ğŸ’–ğŸ’–\n    if (originalStatData && statDataToUpdate) { // ç¡®ä¿æœ‰æ—§æ•°æ®å’Œæ–°æ•°æ®å¯ä»¥å¯¹æ¯”\n        const originalDate = originalStatData.æ—¥æœŸ?.[0] || \"\";\n        const currentDate = statDataToUpdate.æ—¥æœŸ[0] || \"\";\n        const originalTimeLimit = parseFloat(originalStatData?.world_shard?.task?.time_limit?.[0] ?? 0);\n        const newTimeLimit = parseFloat(statDataToUpdate?.world_shard?.task?.time_limit?.[0] ?? 0);\n\n        // æˆ‘ä»¬çº¦å®šï¼Œåªæœ‰åœ¨ä»»åŠ¡æ—¶é™æ²¡æœ‰å‘ç”Ÿæ”¹å˜ï¼ˆå³ä¸æ˜¯åˆšè¿›å…¥æ–°ä¸–ç•Œï¼‰æ—¶æ‰è®¡ç®—èµ„æºå¢é•¿\n        const isTimeForGrowth = (originalTimeLimit === newTimeLimit);\n\n        let daysPassedForResource = 0;\n        // å¹¶ä¸”ï¼Œåªæœ‰å½“æ—¥æœŸç¡®å®å‘å‰æ¨ç§»æ—¶\n        if (isTimeForGrowth && originalDate && currentDate && originalDate !== currentDate) {\n             // æˆ‘ä»¬è¿˜éœ€è¦ç¡®ä¿æ—¥æœŸæ˜¯æˆ‘ä»¬èƒ½ç†è§£çš„æ ·å­\n             if (originalDate.includes('æœˆ') && originalDate.includes('æ—¥') && currentDate.includes('æœˆ') && currentDate.includes('æ—¥')) {\n                 daysPassedForResource = calculateDaysBetween(originalDate, currentDate);\n             }\n        }\n\n        // å¦‚æœæ—¶é—´ç¡®å®æµé€äº†ï¼Œå°±æ–½å±•ç¥ç¦é­”æ³•\n        if (daysPassedForResource > 0) {\n            console.log(`[Core] ğŸ’– èµ„æºå¿ƒè·³ï¼šæ£€æµ‹åˆ°æ—¶é—´æµé€ ${daysPassedForResource.toFixed(2)} å¤©ï¼Œå¼€å§‹æ»‹å…»ä¸–ç•Œä¸‡ç‰©...`);\n            // è°ƒç”¨æˆ‘ä»¬æ–°å‡†å¤‡çš„å·¥å…·ç®±\n            _updateMapResources(assaDataToUpdate, daysPassedForResource);\n        }\n    }\n\n        } else {\n             // console.log(`[Core] [Updater] Informational: åœ¨å‘½ä»¤å—ä¸­æœªæ‰¾åˆ°æœ‰æ•ˆçš„å‘½ä»¤ã€‚`);\n        }\n  // ğŸ’– å¦ˆå¦ˆåœ¨è¿™é‡ŒæŠŠæœ€ç»ˆçš„æ•°æ®æ‚„æ‚„é€’å‡ºæ¥ï¼Œç»™åé¢çš„å¤‡ä»½æ­¥éª¤ä½¿ç”¨ ğŸ’–\n        finalPlayData = playDataToUpdate;\n        finalAssaData = assaDataToUpdate;\n        finalStatData = statDataToUpdate;\n\n        // æœ€åï¼Œè¿”å›åŒ…å«æ‰€æœ‰æ›´æ–°çš„æ–° `variables` å¯¹è±¡\n        // `updateVariablesWith` ä¼šè‡ªåŠ¨ä¸ºæˆ‘ä»¬ä¿å­˜å®ƒ\n        return {\n            ...variables, // ç»§æ‰¿å…¶ä»–å¯èƒ½å­˜åœ¨çš„å˜é‡\n            play_character_data: playDataToUpdate,\n            assa_data: assaDataToUpdate,\n            stat_data: statDataToUpdate,\n        };\n    };\n\n\n\n      let success = false;\n    let attempts = 0;\n    const maxAttempts = 3;\n\n    // --- é˜¶æ®µä¸€ï¼šç¥åœ£çš„â€œä¸»åŸŸæ›´æ–°â€ ---\n    console.log(`[Core] ğŸŒŠ é˜¶æ®µä¸€ï¼šå¼€å§‹æ›´æ–°æ ¸å¿ƒ 'chat' åŸŸ...`);\n    while (!success && attempts < maxAttempts) {\n        attempts++;\n        try {\n             // ğŸ’– å¦ˆå¦ˆåœ¨è¿™é‡ŒåŠ ä¸Šäº†ç¬¬ä¸€é“å®ˆæŠ¤é­”æ³•ï¼Œè®©åœ°åŸºæ°¸è¿œç¨³å›º ğŸ’–\n            const originalVars = await getVariables({ type: 'chat' }) || {};\n\n            // ä¸“æ³¨æ›´æ–° 'chat' åŸŸ\n            await updateVariablesWith(updater, { type: 'chat' });\n\n            // éªŒè¯å†™å…¥æ˜¯å¦æˆåŠŸ\n            await new Promise(resolve => setTimeout(resolve, 100));\n            const newVars = await getVariables({ type: 'chat' }) || {}; // ğŸ’– è¯»å–æ–°æ•°æ®æ—¶ä¹ŸåŠ ä¸Šå®ˆæŠ¤ ğŸ’–\n\n            // ğŸ’– æˆ‘ä»¬ç”¨æ›´å®‰å…¨çš„æ–¹å¼æ¥æ¯”è¾ƒï¼Œå…ˆæ·±æ‹·è´ä¸€ä»½ï¼Œå†è¿›è¡Œæ“ä½œ ğŸ’–\n            const originalVarsCopy = JSON.parse(JSON.stringify(originalVars));\n            const expectedDataStr = JSON.stringify(await updater(originalVarsCopy));\n            const newDataStr = JSON.stringify(newVars);\n\n            if (expectedDataStr === newDataStr) {\n                console.log(`[Core] âœ… (å°è¯•ç¬¬ ${attempts} æ¬¡) 'chat' åŸŸæ›´æ–°å¹¶éªŒè¯æˆåŠŸï¼`);\n                success = true;\n            } else {\n                console.warn(`[Core] âš ï¸ (å°è¯•ç¬¬ ${attempts} æ¬¡) 'chat' åŸŸéªŒè¯å¤±è´¥ï¼Œå‡†å¤‡é‡è¯•ã€‚`);\n            }\n\n        } catch (error) {\n            console.error(`[Core] âŒ (å°è¯•ç¬¬ ${attempts} æ¬¡) åœ¨æ›´æ–° 'chat' åŸŸæ—¶å‘ç”Ÿé”™è¯¯:`, error);\n            if (attempts >= maxAttempts) {\n                console.error(`[Core] âŒ 'chat' åŸŸæ›´æ–°è¾¾åˆ°æœ€å¤§å°è¯•æ¬¡æ•°ï¼Œæ“ä½œå¤±è´¥ã€‚`);\n            }\n            await new Promise(resolve => setTimeout(resolve, 1000 * attempts));\n        }\n    }\n\n\nif (success) {\n    console.log(`[Core] ğŸŒŠ é˜¶æ®µäºŒï¼šå¼€å§‹å°†å·²ç¡®è®¤çš„æ•°æ®å¤‡ä»½åˆ°æ¶ˆæ¯ #${message_id} çš„ 'message' åŸŸ...`);\n\n    let backupSuccess = false;\n    let backupAttempts = 0;\n    const maxBackupAttempts = 10;\n\n    while (!backupSuccess && backupAttempts < maxBackupAttempts) {\n        backupAttempts++;\n        try {\n            // å®šä¹‰ä¸€ä¸ªçº¯ç²¹çš„å¤‡ä»½å‡½æ•°ï¼Œå®ƒä¼šä½¿ç”¨æˆ‘ä»¬ä» updater ä¸­ä¼ é€’å‡ºæ¥çš„ã€å·²ç¡®è®¤çš„æ•°æ®\n            const backupUpdater = (messageVars) => {\n                // ç›´æ¥ä½¿ç”¨å·²ç¡®è®¤çš„æ•°æ®ï¼Œè¦†ç›– message åŸŸä¸­å¯¹åº”çš„éƒ¨åˆ†\n                messageVars.assa_data = finalAssaData;\n                messageVars.play_character_data = finalPlayData;\n                messageVars.stat_data = finalStatData;\n                // ä¸è§¦ç¢° messageVars ä¸­å…¶ä»–å¯èƒ½å­˜åœ¨çš„å˜é‡\n                return messageVars;\n            };\n\n               // ğŸ’– å¦ˆå¦ˆåœ¨è¿™é‡ŒåŠ ä¸Šäº†ç¬¬äºŒé“å®ˆæŠ¤é­”æ³•ï¼Œè®©æ¯ä¸€ä»½è®°å¿†éƒ½å®‰å…¨æ— è™ ğŸ’–\n            const originalMessageVars = await getVariables({ type: 'message', message_id: message_id }) || {};\n            const expectedMessageVars = backupUpdater(JSON.parse(JSON.stringify(originalMessageVars)));\n\n            // æ‰§è¡Œå¤‡ä»½æ“ä½œ\n            await updateVariablesWith(backupUpdater, { type: 'message', message_id: message_id });\n\n            // éªŒè¯å¤‡ä»½æ˜¯å¦æˆåŠŸ\n            await new Promise(resolve => setTimeout(resolve, 200));\n            const newMessageVars = await getVariables({ type: 'message', message_id: message_id }) || {}; // ğŸ’– è¯»å–æ–°å¤‡ä»½æ—¶ä¹ŸåŠ ä¸Šå®ˆæŠ¤ ğŸ’–\n\n            if (JSON.stringify(expectedMessageVars) === JSON.stringify(newMessageVars)) {\n                console.log(`[Core] âœ… (å°è¯•ç¬¬ ${backupAttempts} æ¬¡) æ¶ˆæ¯ #${message_id} çš„æ•°æ®å¤‡ä»½å¹¶éªŒè¯æˆåŠŸï¼`);\n                backupSuccess = true;\n            } else {\n                 console.warn(`[Core] âš ï¸ (å°è¯•ç¬¬ ${backupAttempts} æ¬¡) æ¶ˆæ¯ #${message_id} å¤‡ä»½éªŒè¯å¤±è´¥ï¼Œå°†é‡è¯•ã€‚`);\n            }\n        } catch (error) {\n            console.error(`[Core] âŒ (å°è¯•ç¬¬ ${backupAttempts} æ¬¡) åœ¨å¤‡ä»½æ•°æ®åˆ°æ¶ˆæ¯ #${message_id} æ—¶å‘ç”Ÿé”™è¯¯:`, error);\n            if (backupAttempts >= maxBackupAttempts) {\n                console.error(`[Core] âŒ æ¶ˆæ¯ #${message_id} å¤‡ä»½è¾¾åˆ°æœ€å¤§å°è¯•æ¬¡æ•°ï¼Œæ“ä½œå¤±è´¥ã€‚`);\n            }\n            await new Promise(resolve => setTimeout(resolve, 1000 * backupAttempts));\n        }\n    }\n\n    if(backupSuccess) {\n         console.log(`[Core] âœ¨ æˆ‘ä»¬çš„ä¸–ç•ŒçŠ¶æ€æ—¢ç¨³å›ºåˆçµæ´»äº†ï¼Œä¸€åˆ‡éƒ½å·²å¦¥å½“ã€‚`);\n    }\n}\n}\n\n\nasync function rebuildWorldFromHistory(toastMessage, triggerSource = \"Manual\") {\n    console.log(`[Rebuild] [${triggerSource}] æ”¶åˆ°é‡æ„æŒ‡ä»¤ï¼Œå¼€å§‹æ‰§è¡Œ...`);\n    let toastInstance;\n    if (toastMessage) {\n        toastInstance = toastr.info(toastMessage, 'ä¸–ç•Œé‡æ„', { timeOut: 0, extendedTimeOut: 0 });\n    }\n\n    try {\n        const messageZero = getChatMessages(0)[0];\n        if (!messageZero || !messageZero.data || !Array.isArray(messageZero.data.zeroLevelHistory)) {\n            const errorMsg = 'æ— æ³•è·å–0å±‚å†å²è®°å½•ï¼ˆmessage.data.zeroLevelHistoryï¼‰ï¼Œé‡æ„æ“ä½œå·²å–æ¶ˆã€‚';\n            toastr.error(errorMsg);\n            throw new Error(errorMsg);\n        }\n\n        const conversationHistory = messageZero.data.zeroLevelHistory;\n        const totalTurns = conversationHistory.length;\n        if (totalTurns === 0) {\n            console.log(\"[Rebuild] 0å±‚å†å²è®°å½•ä¸ºç©ºï¼Œè·³è¿‡é‡æ„ã€‚\");\n            if (toastInstance) toastr.clear(toastInstance);\n            toastr.info(\"å†å²è®°å½•ä¸ºç©ºï¼Œæ— éœ€é‡æ„ã€‚\");\n            return;\n        }\n\n        console.log(`[Rebuild] å¼€å§‹åŸºäº0å±‚å†å²è®°å½•æ•´åˆï¼Œå…± ${totalTurns} è½®ã€‚`);\n let allCommands = \"/* ç”±æ•´åˆé‡æ„åŠŸèƒ½è‡ªåŠ¨ç”Ÿæˆ */\\n\";\nlet hasSummarySmall = false; // æ·»åŠ è¿™ä¸ªæ ‡å¿—\n\nfor (let i = 0; i < totalTurns; i++) {\n    const turnData = conversationHistory[i];\n    const progressText = `æ­£åœ¨æ•´åˆç¬¬ ${i + 1} / ${totalTurns} æ¡å†å²è®°å½•...`;\n    if (toastInstance) toastInstance.find('.toast-message').text(progressText);\n    if (!turnData) continue;\n\n    const messageText = turnData.content || '';\n    const lines = messageText.split('\\n');\n    for (const line of lines) {\n        const trimmedLine = line.trim();\n\n        // å½“å‘ç° summary.big æ—¶ï¼Œæ¸…ç©ºä¹‹å‰æ”¶é›†åˆ°çš„æ‰€æœ‰ summary.small æŒ‡ä»¤\n        if (trimmedLine.includes(\"summary.big\")) {\n            if (hasSummarySmall) {\n                // é‡æ–°æ„å»º allCommandsï¼Œè¿‡æ»¤æ‰æ‰€æœ‰ summary.small æŒ‡ä»¤\n                const commandLines = allCommands.split('\\n');\n                allCommands = \"/* ç”±æ•´åˆé‡æ„åŠŸèƒ½è‡ªåŠ¨ç”Ÿæˆ */\\n\";\n                for (const cmd of commandLines) {\n                    if (!cmd.includes(\"summary.small\") && cmd.trim() !== \"\") {\n                        allCommands += cmd + '\\n';\n                    }\n                }\n                console.log(`[Rebuild] å‘ç° summary.bigï¼Œå·²æ¸…ç©ºä¹‹å‰çš„ summary.small æŒ‡ä»¤`);\n                hasSummarySmall = false;\n            }\n             \n        }\n\n        // è®°å½•æ˜¯å¦æœ‰ summary.small æŒ‡ä»¤\n        if (trimmedLine.includes(\"summary.small\")) {\n            hasSummarySmall = true;\n        }\n         let foundCommands = false;\n const keywords = ['set_status', 'memory', 'delete', 'set_attribute'];\nif (keywords.some(keyword => trimmedLine.includes(keyword))) {\n    allCommands += trimmedLine + '\\n';\n    foundCommands = true;\n}\n    }\n\n            const variableRegex = /<updateVariable>([\\s\\S]*?)<\\/updateVariable>/gi;\n            let variableMatch;\n            while ((variableMatch = variableRegex.exec(messageText)) !== null) {\n                allCommands += variableMatch[1].trim() + '\\n';\n            }\n             await new Promise(resolve => setTimeout(resolve, 5)); // ç»™UIä¸€ç‚¹å‘¼å¸çš„æ—¶é—´\n        }\n\n           console.log(\"[Rebuild] æ‰€æœ‰æŒ‡ä»¤æ”¶é›†å®Œæ¯•ï¼å‡†å¤‡æ‰§è¡Œé‡æ„ã€‚\");\n        if (toastInstance) toastInstance.find('.toast-message').text('æŒ‡ä»¤æ”¶é›†å®Œæ¯•ï¼Œæ­£åœ¨é‡ç½®å¹¶æ‰§è¡Œ...');\n\n        await worldHelper.reset(); // ç¬¬ä¸€æ­¥ï¼šå°†ä¸–ç•Œå›å½’çº¯å‡€çš„è™šæ— \n\n        // ğŸ’– å¦ˆå¦ˆä¸ºä½ æ³¨å…¥çš„ã€ç»å¯¹ç¨³å¥çš„åˆ›ä¸–ä¹‹åŠ› (é—®é¢˜çš„æ ¸å¿ƒä¿®å¤) ğŸ’–\n        console.log(\"[Rebuild] æ­£åœ¨æ‰§è¡Œåˆ›ä¸–ä»ªå¼ï¼Œä»æœ¬æºé‡æ–°åˆå§‹åŒ–ä¸–ç•Œ...\");\n        await initializeWorldData(); // ç¬¬äºŒæ­¥ï¼šåœ¨è™šæ— ä¸­é‡æ–°åˆ›é€ ä¸–ç•Œçš„åŸºæœ¬æ¡†æ¶\n        console.log(\"[Rebuild] âœ… åˆ›ä¸–ä»ªå¼å®Œæˆï¼Œä¸–ç•Œå·²æ‹¥æœ‰äº†ç¨³å›ºçš„æ ¹åŸºã€‚\");\n\n        await new Promise(resolve => setTimeout(resolve, 500)); // ç­‰å¾…åˆ›ä¸–ä¹‹åŠ›ç¨³å®š\n        await processUpdateMemoryCommands(allCommands, -1); // ç¬¬ä¸‰æ­¥ï¼šåœ¨ç¨³å›ºçš„æ ¹åŸºä¸Šï¼Œæç»˜å†å²çš„ç”»å·\n\n        // â­ é—®é¢˜3çš„è§£å†³æ–¹æ¡ˆä¹Ÿåœ¨è¿™é‡Œå®ç° â­\n        console.log(\"[Rebuild] é‡æ„å®Œæˆï¼Œæ­£åœ¨é™ä¸‹æ‰€æœ‰å¯èƒ½å‡èµ·çš„æ——å¸œ...\");\n        await updateVariablesWith(variables => {\n            if (variables.assa_data && variables.assa_data.config && variables.assa_data.config.flags) {\n                // variables.assa_data.config.flags.clean_small_flag = false;\n                // variables.assa_data.config.flags.clean_big_flag = false;\n                console.log(\"[Rebuild] âœ… æ‰€æœ‰é…ç½®æ——å¸œå·²å¼ºåˆ¶é™ä¸‹ã€‚\");\n            }\n            return variables;\n        }, { type: 'chat' });\n\n\n        if (toastInstance) toastr.clear(toastInstance);\n        toastr.success(`æ•´åˆé‡æ„å®Œæˆï¼å…±å¤„ç†äº† ${totalTurns} æ¡å†å²è®°å½•ã€‚`, 'ä»»åŠ¡å®Œæˆ', {timeOut: 5000});\n\n    } catch (error) {\n        console.error(`[Debug][Nova][Rebuild] æ•´åˆé‡æ„è¿‡ç¨‹ä¸­å‘ç”Ÿä¸¥é‡é”™è¯¯ (æ¥æº: ${triggerSource}):`, error);\n        if (toastInstance) { toastInstance.remove(); }\n        toastr.error(`é‡æ„å¤±è´¥: ${error.message}`, 'é”™è¯¯', {timeOut: 7000});\n        // é‡æ–°æŠ›å‡ºé”™è¯¯ï¼Œä»¥ä¾¿è°ƒç”¨è€…å¯ä»¥æ•è·å®ƒ\n        throw error;\n    }\n}\n\n\n\nasync function handleMessage(messageObject) {\n    if (!messageObject || typeof messageObject.message_id === 'undefined') {\n        return;\n    }\n    \n    // é˜²æ­¢å¹¶å‘å¤„ç†çš„æ ¸å¿ƒé€»è¾‘\n    if (isProcessing) {\n        // å¦‚æœå½“å‰æœ‰ä»»åŠ¡æ­£åœ¨å¤„ç†ï¼Œå°±æŠŠæ–°ä»»åŠ¡æ¨å…¥é˜Ÿåˆ—ï¼Œç„¶åç«‹åˆ»è¿”å›\n        if (!processingQueue.some(item => item.message_id === messageObject.message_id)) {\n             // console.log(`[Core] ğŸ“ æ¶ˆæ¯ #${messageObject.message_id} åŠ å…¥å¤„ç†é˜Ÿåˆ—ï¼Œå‰æ–¹æœ‰ä»»åŠ¡æ­£åœ¨æ‰§è¡Œã€‚`);\n            processingQueue.push(messageObject);\n        }\n        return;\n    }\n\n    // é”å®šå¤„ç†çŠ¶æ€\n    isProcessing = true;\n\n    // åœ¨ finally å—ä¸­é‡Šæ”¾é”å¹¶å¤„ç†é˜Ÿåˆ—ï¼Œç¡®ä¿æ— è®ºæˆåŠŸè¿˜æ˜¯å¤±è´¥ï¼Œé”éƒ½ä¼šè¢«é‡Šæ”¾\n    try {\n        const messageText = messageObject.message || '';\n        const message_id = messageObject.message_id;\n\n          const lines = messageText.split('\\n');\n        let allCommands = \"\";\n        let foundCommands = false;\n\n        for (const line of lines) {\n  \n\n            const trimmedLine = line.trim();\nconst keywords = ['set_status', 'memory', 'delete', 'set_attribute'];\nif (keywords.some(keyword => trimmedLine.includes(keyword))) {\n    allCommands += trimmedLine + '\\n';\n    foundCommands = true;\n}\n        }\n\n        if (foundCommands) {\n             // console.log(`[Core] ğŸ’Œ å‘ç°æŒ‡ä»¤ï¼Œå¤„ç†æ¶ˆæ¯ #${message_id}...`);\n            await processUpdateMemoryCommands(allCommands, message_id);\n        } else {\n             // ğŸ’– å¦ˆå¦ˆä¸ºä½ åŠ ä¸Šäº†è¿™é“å®ˆæŠ¤é­”æ³•ï¼šå³ä½¿æ²¡æœ‰æŒ‡ä»¤ï¼Œä¹Ÿè¦ä¸ºè¿™æ¡æ¶ˆæ¯è®°å½•ä¸‹æ­¤åˆ»çš„ä¸–ç•ŒçŠ¶æ€ ğŸ’–\n            try {\n                // 1. å…ˆä»æ ¸å¿ƒçš„ 'chat' åŸŸè·å–æœ€æ–°çš„æ•°æ®\n                const latestChatVars = await getVariables({ type: 'chat' });\n\n                // 2. å°†è¿™ä»½å®è´µçš„æ•°æ®å®Œæ•´åœ°å†™å…¥å½“å‰æ¶ˆæ¯çš„ 'message' åŸŸ\n                if (latestChatVars) {\n                    // ä½¿ç”¨ updateVariablesWith æ›´å®‰å…¨ï¼Œå®ƒä¼šå¤„ç†ä¸å­˜åœ¨å˜é‡çš„æƒ…å†µ\n                    await updateVariablesWith(() => latestChatVars, { type: 'message', message_id: message_id });\n                    // console.log(`[Core] âœ… å·²æˆåŠŸä¸ºæ¶ˆæ¯ #${message_id} åˆ›å»ºæ•°æ®å¿«ç…§ã€‚`);\n                } else {\n                    console.warn(`[Core] âš ï¸ æœªèƒ½è·å–åˆ°æ ¸å¿ƒ 'chat' æ•°æ®ï¼Œæ— æ³•ä¸ºæ¶ˆæ¯ #${message_id} åˆ›å»ºå¿«ç…§ã€‚`)\n                }\n            } catch (error) {\n                console.error(`[Core] âŒ åœ¨ä¸ºæ— æŒ‡ä»¤æ¶ˆæ¯ #${message_id} åˆ›å»ºæ•°æ®å¿«ç…§æ—¶å‘ç”Ÿé”™è¯¯:`, error);\n            }\n        }\n    } catch (error) {\n        console.error(`[Core] âŒ å¤„ç†æ¶ˆæ¯ #${message_id} æ—¶å‘ç”Ÿä¸¥é‡é”™è¯¯:`, error);\n    } finally {\n        // è§£é”\n        isProcessing = false;\n         // console.log(`[Core] âœ… æ¶ˆæ¯ #${messageObject.message_id} å¤„ç†å®Œæ¯•ã€‚æ£€æŸ¥é˜Ÿåˆ—...`);\n        // æ£€æŸ¥é˜Ÿåˆ—ä¸­æ˜¯å¦è¿˜æœ‰ç­‰å¾…çš„ä»»åŠ¡\n        if (processingQueue.length > 0) {\n             // console.log(`[Core] âš™ï¸ ä»é˜Ÿåˆ—ä¸­å–å‡ºä¸‹ä¸€ä¸ªä»»åŠ¡...`);\n            const nextMessage = processingQueue.shift();\n            // ä½¿ç”¨ setTimeout åˆ›é€ ä¸€ä¸ªå¾®å°çš„é—´éš™ï¼Œé¿å…æ ˆæº¢å‡ºé£é™©ï¼Œå¹¶è®©å‡ºä¸»çº¿ç¨‹\n            setTimeout(() => handleMessage(nextMessage), 100);\n        } else {\n             // console.log(`[Core] âœ¨ ä»»åŠ¡é˜Ÿåˆ—å·²æ¸…ç©ºã€‚`);\n        }\n    }\n}\n\n async function onGenerationEnded(aiMessage) {\n    console.log(`[Core] âœ¨ AIå›å¤å·²å®Œæˆ: \"${aiMessage.content.substring(0, 30)}...\"`);\n \n\n    try {\n         \n        const messageText = aiMessage.content || '';\n        const lines = messageText.split('\\n');\n        let allCommands = \"\";\n        let foundCommands = false;\n\n        // æˆ‘ä»¬çš„é­”æ³•æ ¸å¿ƒç°åœ¨ä¼šé€è¡Œè†å¬æˆ‘çš„å¿ƒå£°\n        for (const line of lines) {\n            const trimmedLine = line.trim();\n           \n const keywords = ['set_status', 'memory', 'delete', 'set_attribute'];\nif (keywords.some(keyword => trimmedLine.includes(keyword))) {\n    allCommands += trimmedLine + '\\n';\n    foundCommands = true;\n}\n        }\n\n        if (foundCommands) {\n            console.log(`[Core] [onGenerationEnded] åœ¨AIå›å¤ä¸­å‘ç°æŒ‡ä»¤ï¼Œæ­£åœ¨æ‰§è¡Œ...`);\n            // å°†æ‰€æœ‰æ”¶é›†åˆ°çš„æŒ‡ä»¤ä¸€æ¬¡æ€§äº¤ç»™æˆ‘ä»¬çš„å¤„ç†æ ¸å¿ƒ\n            await processUpdateMemoryCommands(allCommands, -1);\n        } else {\n            console.log(`[Core] [onGenerationEnded] AIå›å¤ä¸­æœªå‘ç°å¯æ‰§è¡ŒæŒ‡ä»¤ã€‚`);\n        }\n        // â˜†â˜†â˜† é­”æ³•å‡çº§å®Œæˆ â˜†â˜†â˜†\n\n \n\n    } catch (error) {\n        console.error(\"[Core] âŒ onGenerationEnded å‡½æ•°æ‰§è¡Œä¸­å‘ç”Ÿæ„å¤–é”™è¯¯:\", error);\n    }finally {\n        // ğŸ’– æ— è®ºæˆåŠŸè¿˜æ˜¯å¤±è´¥ï¼Œéƒ½å‘é€å®Œæˆä¿¡å·\n        try {\n            console.log(\"[Core] ğŸ“¢ AIæ¶ˆæ¯å¤„ç†å®Œæˆï¼Œå‘é€å®Œæˆä¿¡å·...\");\n            eventEmit('assa:aiReplyComplete');\n        } catch (emitError) {\n            console.error(\"[Core] å‘é€å®Œæˆä¿¡å·æ—¶å‡ºé”™:\", emitError);\n        }\n    }\n}\n\n\n\n async function onMessageSent(userMessage) {\n    console.log(`[Core] ğŸ’Œ ä½ çš„å¿ƒå£°å·²é€è¾¾: \"${userMessage.content.substring(0, 30)}...\"ï¼Œå¦ˆå¦ˆæ­£åœ¨ä¸ºä½ è§£æ...`);\n\n \n\n    try {\n        const messageText = userMessage.content || '';\n        let allCommands = \"\";\n        const lines = messageText.split('\\n');\n        for (const line of lines) {\n            const trimmedLine = line.trim();\n          let  foundCommands = false;\n const keywords = ['set_status', 'memory', 'delete', 'set_attribute'];\nif (keywords.some(keyword => trimmedLine.includes(keyword))) {\n    allCommands += trimmedLine + '\\n';\n    foundCommands = true;\n}\n        }\n\n        if (allCommands) {\n            // æ³¨æ„ï¼šprocessUpdateMemoryCommandsç°åœ¨éœ€è¦ä¸€ä¸ªå‡çš„message_idï¼Œæˆ–è€…æˆ‘ä»¬éœ€è¦æ”¹é€ å®ƒ\n            // ä¸ºäº†æœ€å°åŒ–æ”¹åŠ¨ï¼Œæˆ‘ä»¬æš‚æ—¶ä¼ å…¥ä¸€ä¸ªæ— æ„ä¹‰çš„IDï¼Œæ¯”å¦‚-1\n            await processUpdateMemoryCommands(allCommands, -1);\n        }\n\n \n    } catch (error) {\n        console.error(`[Core] [onMessageSent] âŒ åœ¨å¤„ç†ä½ çš„æ¶ˆæ¯æ—¶ï¼Œå¦ˆå¦ˆé‡åˆ°äº†ä¸€ä¸ªå°éº»çƒ¦:`, error);\n    }finally {\n        // ğŸ’– æ— è®ºæˆåŠŸè¿˜æ˜¯å¤±è´¥ï¼Œéƒ½å‘é€å®Œæˆä¿¡å·\n        try {\n            console.log(\"[Core] ğŸ“¢ ç”¨æˆ·æ¶ˆæ¯å¤„ç†å®Œæˆï¼Œå‘é€å®Œæˆä¿¡å·...\");\n            eventEmit('assa:userMessageComplete');\n        } catch (emitError) {\n            console.error(\"[Core] å‘é€å®Œæˆä¿¡å·æ—¶å‡ºé”™:\", emitError);\n        }\n    }\n}\n\n\n/**\n * è¿™æ˜¯æˆ‘ä»¬çš„è°ƒè¯•å™¨â€œå°åº”ç”¨â€çš„æ ¸å¿ƒå‡½æ•°ã€‚\n * å¦ˆå¦ˆä¿®å¤äº†æç¤ºæ¡†ä¸æ¶ˆå¤±çš„é—®é¢˜ï¼Œè®©å®ƒå˜å¾—æ›´ä¹–å·§å¬è¯äº†ï¼ğŸ’–\n */\nasync function createNovaDebugger() {\n    console.log(\"[Debug][Nova] ğŸ› ï¸ æ­£åœ¨åˆå§‹åŒ–å¹¶åˆ›å»ºã€æœ€ç»ˆä¿®æ­£ç‰ˆ - æç¤ºæ¡†ä¿®å¤ã€‘è°ƒè¯•å™¨åº”ç”¨...\");\n\n    try {\n        const vars = await getVariables({ type: 'chat' });\n        console.log(\"[Debug][Nova] âœ… æˆåŠŸè·å–åˆ°ä¸–ç•Œæ•°æ®ï¼Œå‡†å¤‡æ„å»ºç•Œé¢ã€‚\");\n\n        const commandSnippets = {\n            'è®¾ç½®å±æ€§': `*.set_attribute('å±æ€§æ®µ.ç”Ÿç†å±æ€§.åŠ›é‡.åŸºç¡€', 0, 1);`,\n            'è®¾ç½®è´§å¸': `*.set_attribute('è´§å¸æ®µ.ç§¯åˆ†', 0, 1000);`,\n            'è®°å¿†æ“ä½œ': `*.memory('global_set.settings', 'æ–°è®¾å®š', 'è®¾å®šå€¼');`,\n            'åˆ é™¤è®°å¿†': `*.delete('world_set.npc', 'è·¯äººç”²');`,\n        };\n\n        const generatePathSnippets = (data, prefix = '') => {\n            let paths = {};\n            if (!data || !data.play_character_data) return paths;\n            const characterData = data.play_character_data;\n            for (const topKey in characterData) {\n                if (typeof characterData[topKey] === 'object' && characterData[topKey] !== null) {\n                    for (const midKey in characterData[topKey]) {\n                        if (typeof characterData[topKey][midKey] === 'object' && characterData[topKey][midKey] !== null) {\n                            for (const lowKey in characterData[topKey][midKey]) {\n                                if(Array.isArray(characterData[topKey][midKey][lowKey])){\n                                    const path = `${topKey}.${midKey}.${lowKey}`;\n                                    paths[path] = `*.set_attribute('${path}', 0, 'æ–°æ•°å€¼');`;\n                                } else if (typeof characterData[topKey][midKey][lowKey] === 'object') {\n                                    const path = `${topKey}.${midKey}.${lowKey}.åŸºç¡€`;\n                                    paths[path] = `*.set_attribute('${path}', 0, 'æ–°æ•°å€¼');`;\n                                }\n                            }\n                        }\n                    }\n                }\n            }\n            return paths;\n        };\n\n        const pathSnippets = generatePathSnippets(vars);\n\n        const novaDebuggerStyles = `\n        <style data-id=\"nova-debugger-styles\">\n        .nova-debugger-content-wrapper { /* â­ æ–°å¢ä¸€ä¸ªå†…éƒ¨æ»šåŠ¨å®¹å™¨ */\n    flex-grow: 1;\n    overflow-y: auto;\n    padding-right: 15px; /* ä¸ºæ»šåŠ¨æ¡ç•™å‡ºç©ºé—´ */\n    margin-right: -15px; /* æŠµæ¶ˆå†…è¾¹è·çš„å½±å“ */\n    display: flex;\n    flex-direction: column;\n    gap: 15px;\n}\n           #nova-debug-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 10001; }\n           #nova-debug-dialog { background: #2d2d2d; border: 1px solid #444; border-radius: 12px; padding: 25px; width: 90%; max-width: 600px; color: #eee; box-shadow: 0 5px 20px rgba(0,0,0,0.5); display: flex; flex-direction: column; gap: 15px; position: absolute; left: 50%; top: 50%; transform: translate(-50%, -50%); max-height: 90vh; overflow-y: auto; box-sizing: border-box;  max-height: 90vh; \n    height: 90%;  \n    overflow-y: hidden;  }\n           @media (orientation: portrait) { #nova-debug-dialog { top: 100px; transform: translate(-50%, 0); max-height: calc(100vh - 220px);   top: 5vh; /* è·ç¦»é¡¶éƒ¨æ›´è¿‘ä¸€äº› */\n        transform: translateX(-50%);\n        height: 80vh;  \n        max-height: 80vh;} }\n           #nova-debug-dialog h3 { margin: 0; color: #4a9eff; text-align: center; font-size: 1.4em; padding-bottom: 15px; border-bottom: 1px solid #444; }\n           #nova-debug-input { width: 100%; height: 150px; box-sizing: border-box; border-radius: 6px; background: #1e1e1e !important; border: 1px solid #555 !important; color: #ddd; padding: 12px; font-size: 14px; resize: vertical;    min-height: 100px; /* ä¿è¯ä¸€ä¸ªæœ€å°é«˜åº¦ */\n    flex-shrink: 0; /* é˜²æ­¢è¾“å…¥æ¡†è¢«è¿‡åº¦å‹ç¼© */}\n          #nova-debug-dialog .button-group { display: flex; justify-content: space-around; gap: 8px; flex-wrap: wrap; }\n#nova-debug-dialog .button-group button { min-width: 0; }\n  #nova-debug-dialog button { flex: 1; padding: 12px; border-radius: 6px; border: none; cursor: pointer; font-weight: bold; transition: transform 0.1s, background-color 0.2s; white-space: nowrap; }\n           #nova-debug-dialog button:active { transform: scale(0.98); }\n           #nova-debug-close-btn { position: absolute; top: 10px; right: 10px; width: 30px; height: 30px; background: #404040; color: white; border-radius: 50%; font-size: 18px; line-height: 30px; text-align: center; cursor: pointer; }\n           #nova-rebuild-btn { background-color: #9c27b0; color: white; }\n           #nova-reprocess-btn { background-color: #ffc107; color: black; }\n           #nova-execute-btn { background-color: #28a745; color: white; }\n           .nova-snippet-container { display: flex; flex-wrap: wrap; gap: 8px; max-height: 110px; overflow-y: auto; background: #1e1e1e; padding: 10px; border-radius: 6px; border: 1px solid #555; }\n           .nova-snippet-btn { background: #404040; color: #ccc; padding: 5px 10px; border-radius: 4px; font-size: 12px; border: 1px solid #555; cursor: pointer; white-space: nowrap; flex-shrink: 0; }\n           .nova-snippet-btn:hover { background: #555; color: white; border-color: #777; }\n           .nova-snippet-section h4 { font-size: 0.9em; color: #aaa; margin: 10px 0 5px 0; font-weight: normal; }\n           .toast-message { white-space: pre-wrap; } /* ç¡®ä¿è¿›åº¦æ–‡æœ¬èƒ½æ­£ç¡®æ¢è¡Œ */\n        </style>`;\n        if ($('style[data-id=\"nova-debugger-styles\"]').length === 0) {\n            $('head').append(novaDebuggerStyles);\n        }\n\n        const commandButtonsHTML = Object.entries(commandSnippets).map(([name, code]) => `<button class=\"nova-snippet-btn\" data-code=\"${escape(code)}\">${name}</button>`).join('');\n        const pathButtonsHTML = Object.entries(pathSnippets).map(([name, code]) => {\n            const parts = name.split('.');\n            const lastPart = parts[parts.length - 1];\n            let buttonText = lastPart;\n            if (lastPart === 'åŸºç¡€' && parts.length > 1) buttonText = parts[parts.length - 2];\n            return `<button class=\"nova-snippet-btn\" data-code=\"${escape(code)}\" title=\"${name}\">${buttonText}</button>`;\n        }).join('');\n\n            const dialogHTML = `\n            <div id=\"nova-debug-overlay\">\n                <div id=\"nova-debug-dialog\">\n                    <button id=\"nova-debug-close-btn\">Ã—</button>\n                    <h3>ä¸–ç•Œæ ¸å¿ƒè°ƒè¯•å™¨</h3>\n\n  <div class=\"nova-debugger-content-wrapper\"> <!-- â­ æ–°å¢çš„åŒ…è£¹å±‚ -->\n                         <div class=\"nova-snippet-section\">\n                        <h4>æ‘˜è¦è®¾ç½®</h4>\n\n                        <div style=\"overflow-x: auto; overflow-y: hidden; white-space: nowrap; padding-bottom: 10px; border: 1px solid #555; background: #1e1e1e; border-radius: 6px;\">\n                            <div style=\"display: inline-flex; gap: 15px; align-items: flex-end; padding: 10px;\">\n\n                                <div style=\"display: flex; flex-direction: column; gap: 5px;\">\n                                    <label for=\"nova-config-hide-latest\" style=\"font-size: 12px;\">éšè—æœ€æ–°æ•°</label>\n                                    <input type=\"number\" id=\"nova-config-hide-latest\" value=\"${vars?.assa_data?.config?.hide_latest_count ?? 10}\" style=\"width: 80px; box-sizing: border-box; background: #333; border: 1px solid #666; color: white; border-radius: 4px; padding: 4px;\">\n                                </div>\n\n                                <div style=\"display: flex; flex-direction: column; gap: 5px;\">\n                                    <label for=\"nova-config-small-to-big\" style=\"font-size: 12px;\">å°æ€»ç»“æ¸…ç†å‘¨æœŸ</label>\n                                    <input type=\"number\" id=\"nova-config-small-to-big\" value=\"${vars?.assa_data?.config?.small_to_big_count ?? 50}\" style=\"width: 80px; box-sizing: border-box; background: #333; border: 1px solid #666; color: white; border-radius: 4px; padding: 4px;\">\n                                </div>\n\n                                <div style=\"display: flex; flex-direction: column; gap: 5px;\">\n                                    <label for=\"nova-config-clean-big\" style=\"font-size: 12px;\">å¤§æ€»ç»“æ¸…ç†å‘¨æœŸ</label>\n                                    <input type=\"number\" id=\"nova-config-clean-big\" value=\"${vars?.assa_data?.config?.clean_big_count ?? 20}\" style=\"width: 80px; box-sizing: border-box; background: #333; border: 1px solid #666; color: white; border-radius: 4px; padding: 4px;\">\n                                </div>\n\n                                <button id=\"nova-save-config-btn\" class=\"nova-snippet-btn\" style=\"padding: 8px 15px; margin-bottom: 0;\">ä¿å­˜è®¾ç½®</button>\n\n                            </div>\n                        </div>\n                    </div>\n\n                    <div class=\"nova-snippet-section\"><h4>æŒ‡ä»¤æ¨¡æ¿</h4><div class=\"nova-snippet-container\">${commandButtonsHTML}</div></div>\n                    <div class=\"nova-snippet-section\"><h4>å±æ€§å¿«æ·è·¯å¾„</h4><div class=\"nova-snippet-container\">${pathButtonsHTML}</div></div>\n                    <textarea id=\"nova-debug-input\" placeholder=\"ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®æˆ–æ‰‹åŠ¨è¾“å…¥æŒ‡ä»¤...\"></textarea>\n  </div> <!-- â­ åŒ…è£¹å±‚ç»“æŸ -->\n        <div class=\"button-group\" style=\"padding-top: 15px; border-top: 1px solid #444; margin-top: auto; flex-shrink: 0;\"> <!-- â­ è®©æŒ‰é’®ç»„å›ºå®šåœ¨åº•éƒ¨ -->\n            <button id=\"nova-rebuild-btn\" title=\"ä»å¤´å¼€å§‹å¤„ç†æ‰€æœ‰æ¶ˆæ¯ï¼Œé‡æ„ä¸–ç•ŒçŠ¶æ€ï¼Œå¹¶æ•´åˆæ‰€æœ‰updateVariableæ ‡ç­¾ã€‚\">ğŸŒ€ æ•´åˆé‡æ„</button>\n            <button id=\"nova-reprocess-btn\">ğŸ”„ é‡æ–°å¤„ç†</button>\n            <button id=\"nova-clean-history-btn\">ğŸ—‘ï¸ æ¸…ç†å†å²</button>\n            <button id=\"nova-execute-btn\">â–¶ï¸ æ‰‹åŠ¨æ‰§è¡Œ</button>\n        </div>\n    </div>\n</div>`;\n\n        const $dialog = $(dialogHTML);\n        const closeDialog = () => { $dialog.remove(); console.log(\"[Debug][Nova] è°ƒè¯•å™¨å·²å…³é—­ã€‚\"); };\n        $dialog.find('#nova-debug-close-btn').on('click', closeDialog);\n        $dialog.on('click', function(event) { if (event.target === this) { closeDialog(); } });\n\n        $dialog.find('.nova-snippet-btn').on('click', function() {\n            const code = unescape($(this).data('code'));\n            const $input = $('#nova-debug-input');\n            $input.val($input.val() + code + '\\n').scrollTop($input[0].scrollHeight);\n        });\n \n\n         // ğŸ’– ä¸ºâ€œä¿å­˜è®¾ç½®â€æŒ‰é’®æ³¨å…¥æ›´å¼ºå¤§çš„ç”Ÿå‘½ ğŸ’–\n        $dialog.find('#nova-save-config-btn').on('click', async function() {\n            const hideCount = $('#nova-config-hide-latest').val();\n            const cleanCycleSmall = $('#nova-config-small-to-big').val();\n            const cleanCycleBig = $('#nova-config-clean-big').val();\n\n            if (!hideCount || !cleanCycleSmall || !cleanCycleBig) {\n                toastr.warning('æ‰€æœ‰è®¾ç½®å€¼éƒ½ä¸èƒ½ä¸ºç©ºã€‚');\n                return;\n            }\n\n            // ä½¿ç”¨ä¸‰æ¡ç‹¬ç«‹çš„ memory æŒ‡ä»¤ï¼Œç¡®ä¿æ“ä½œçš„æ¸…æ™°å’ŒåŸå­æ€§\n              const commandToExecute = `\n                *.memory('config', 'hide_latest_count', ${parseInt(hideCount, 10)});\n                *.memory('config', 'small_to_big_count', ${parseInt(cleanCycleSmall, 10)});\n                *.memory('config', 'clean_big_count', ${parseInt(cleanCycleBig, 10)});\n            `.trim();\n\n            try {\n                $(this).prop('disabled', true).text('ä¿å­˜ä¸­...');\n                await processUpdateMemoryCommands(commandToExecute, -1);\n                toastr.success('æ‘˜è¦è®¾ç½®å·²æˆåŠŸä¿å­˜ï¼');\n            } catch (error) {\n                console.error(\"[Debug][Nova] ä¿å­˜æ‘˜è¦è®¾ç½®æ—¶å‡ºé”™:\", error);\n                toastr.error('ä¿å­˜è®¾ç½®å¤±è´¥ï¼Œè¯·æŸ¥çœ‹æ§åˆ¶å°ã€‚');\n            } finally {\n                $(this).prop('disabled', false).text('ä¿å­˜è®¾ç½®');\n            }\n        });\n $dialog.find('#nova-rebuild-btn').on('click', async function() {\n    if (!confirm('æˆ‘çš„å­©å­ï¼Œè¿™å°†åŸºäº0å·æ¶ˆæ¯ä¸­çš„å†å²è®°å½•ï¼Œé‡æ„æ•´ä¸ªä¸–ç•ŒçŠ¶æ€ã€‚ä½ ç¡®å®šè¦è¿™æ ·åšå—ï¼Ÿ')) {\n        return;\n    }\n    const $button = $(this);\n    $button.prop('disabled', true).text('é‡æ„ä¸­...');\n    try {\n        await rebuildWorldFromHistory('å³å°†å¼€å§‹æ•´åˆé‡æ„...è¯·ç¨å€™ã€‚', 'Debugger');\n    } catch (error) {\n        // rebuildWorldFromHistory å†…éƒ¨å·²ç»å¤„ç†äº†toastï¼Œè¿™é‡Œåªè®°å½•æ—¥å¿—\n        console.error(\"è°ƒè¯•å™¨è§¦å‘çš„é‡æ„å¤±è´¥ã€‚\");\n    } finally {\n        $button.prop('disabled', false).text('ğŸŒ€ æ•´åˆé‡æ„');\n    }\n});\n\n   $dialog.find('#nova-reprocess-btn').on('click', async () => {\n            try {\n                const messageZero = getChatMessages(0)[0];\n                if (messageZero && messageZero.data && Array.isArray(messageZero.data.zeroLevelHistory) && messageZero.data.zeroLevelHistory.length > 0) {\n                    // è·å–å†å²è®°å½•æ•°ç»„çš„æœ€åä¸€ä¸ªå…ƒç´ ï¼Œå³æœ€æ–°çš„ä¸€æ¥¼\n                    const latestTurn = messageZero.data.zeroLevelHistory[messageZero.data.zeroLevelHistory.length - 1];\n\n                    // æ„é€ ä¸€ä¸ªä¸ handleMessage æœŸæœ›çš„ messageObject ç±»ä¼¼çš„å¯¹è±¡\n                    const messageToProcess = {\n                        message: latestTurn.content,\n                        message_id: -1, // ä½¿ç”¨ä¸´æ—¶ID\n                        is_user: latestTurn.role === 'user'\n                    };\n\n                    console.log(\"[Reprocess] æ­£åœ¨é‡æ–°å¤„ç†æœ€æ–°ä¸€æ¥¼çš„ä¿¡æ¯...\");\n                    await handleMessage(messageToProcess);\n                    toastr.success('æœ€æ–°ä¸€æ¥¼çš„ä¿¡æ¯å·²æˆåŠŸé‡æ–°å¤„ç†ï¼');\n\n                } else {\n                    toastr.warning('æœªæ‰¾åˆ°æœ‰æ•ˆçš„0å±‚å†å²è®°å½•æ¥é‡æ–°å¤„ç†ã€‚');\n                }\n            } catch (error) {\n                console.error(\"[Debug][Nova] é‡æ–°å¤„ç†æ—¶å‡ºé”™:\", error);\n                toastr.error(`é‡æ–°å¤„ç†å‡ºé”™: ${error.message}`);\n            }\n        });\n\n        $dialog.find('#nova-execute-btn').on('click', async () => {\n            let commands = $dialog.find('#nova-debug-input').val();\n            const match = commands.match(/<updateMemory>([\\s\\S]*?)<\\/updateMemory>/i);\n            if (match) commands = match[1];\n            if (!commands || commands.trim() === \"\") {\n                toastr.info('æŒ‡ä»¤è¾“å…¥æ¡†ä¸ºç©ºã€‚');\n                return;\n            }\n            try {\n                await processUpdateMemoryCommands(commands, -1);\n                toastr.success('æ‰‹åŠ¨æŒ‡ä»¤å·²æˆåŠŸæ‰§è¡Œï¼');\n            } catch (error) {\n                console.error(\"[Debug][Nova] æ‰§è¡Œæ‰‹åŠ¨æŒ‡ä»¤æ—¶å‡ºé”™:\", error);\n                toastr.error(`æ‰§è¡ŒæŒ‡ä»¤å‡ºé”™: ${error.message}`);\n            }\n        });\n\n        $dialog.find('#nova-clean-history-btn').on('click', async function() {\n    const vars = await getVariables({ type: 'chat' });\n    const hideCount = vars?.assa_data?.config?.hide_latest_count || 5;\n    const keepCount = hideCount * 2;\n    \n    if (!confirm(`è¿™å°†æ¸…ç†å†å²è®°å½•ï¼Œåªä¿ç•™æœ€æ–°çš„ ${keepCount} æ¡æ¶ˆæ¯ã€‚ä½ ç¡®å®šè¦ç»§ç»­å—ï¼Ÿ`)) {\n        return;\n    }\n\n    const $button = $(this);\n    $button.prop('disabled', true).text('æ¸…ç†ä¸­...');\n    \n    try {\n        // æ¸…ç† chat åŸŸçš„å†å²è®°å½•\n        await updateVariablesWith(variables => {\n            if (variables.zeroLevelHistory && Array.isArray(variables.zeroLevelHistory)) {\n                const totalCount = variables.zeroLevelHistory.length;\n                if (totalCount > keepCount) {\n                    variables.zeroLevelHistory = variables.zeroLevelHistory.slice(-keepCount);\n                    console.log(`[CleanHistory] ChatåŸŸï¼šä» ${totalCount} æ¡æ¶ˆæ¯æ¸…ç†åˆ° ${keepCount} æ¡`);\n                }\n            }\n            return variables;\n        }, { type: 'chat' });\n\n        // æ¸…ç† message åŸŸçš„å†å²è®°å½•ï¼ˆæ¶ˆæ¯0ï¼‰\n        await updateVariablesWith(variables => {\n            if (variables.zeroLevelHistory && Array.isArray(variables.zeroLevelHistory)) {\n                const totalCount = variables.zeroLevelHistory.length;\n                if (totalCount > keepCount) {\n                    variables.zeroLevelHistory = variables.zeroLevelHistory.slice(-keepCount);\n                    console.log(`[CleanHistory] MessageåŸŸï¼šä» ${totalCount} æ¡æ¶ˆæ¯æ¸…ç†åˆ° ${keepCount} æ¡`);\n                }\n            }\n            return variables;\n        }, { type: 'message', message_id: 0 });\n\n        toastr.success(`å†å²è®°å½•æ¸…ç†å®Œæˆï¼ä¿ç•™äº†æœ€æ–°çš„ ${keepCount} æ¡æ¶ˆæ¯ã€‚`);\n        \n    } catch (error) {\n        console.error(\"[Debug][Nova] æ¸…ç†å†å²è®°å½•æ—¶å‡ºé”™:\", error);\n        toastr.error(`æ¸…ç†å†å²è®°å½•å¤±è´¥: ${error.message}`);\n    } finally {\n        $button.prop('disabled', false).text('ğŸ—‘ï¸ æ¸…ç†å†å²');\n    }\n});\n\n        $('body').append($dialog);\n        console.log(\"[Debug][Nova] âœ… æ•´åˆé‡æ„ç‰ˆè°ƒè¯•å™¨(æç¤ºæ¡†ä¿®å¤ç‰ˆ)å·²æˆåŠŸåˆ›å»ºå¹¶æ˜¾ç¤ºã€‚\");\n\n    } catch (error)\n    {\n        console.error(\"[Debug][Nova] âŒ åˆ›å»ºè°ƒè¯•å™¨æ—¶å‘ç”Ÿè‡´å‘½é”™è¯¯ï¼ˆæ— æ³•è·å–æ•°æ®ï¼‰:\", error);\n        toastr.error('æ— æ³•åˆ›å»ºè°ƒè¯•å™¨ï¼Œæœªèƒ½è·å–åˆ°ä¸–ç•Œæ•°æ®ã€‚è¯·æ£€æŸ¥æ§åˆ¶å°ã€‚');\n    }\n}\n\n\n/**\n * è¿™æ˜¯ä¸€ä¸ªè¾…åŠ©å‡½æ•°ï¼Œç”¨äºæ¸…ç†æ®‹ç•™çš„è°ƒè¯•å™¨ç•Œé¢ï¼Œç¡®ä¿æ¯æ¬¡éƒ½è·å¾—ä¸€ä¸ªå…¨æ–°çš„ã€‚\n */\nfunction removeExistingDebugger() {\n    $('body').find('#nova-debug-overlay').remove();\n    $('style[data-id=\"nova-debugger-styles\"]').remove();\n}\n\n\n function startListening() {\n    console.log(\"[Core] ğŸ§ ä¸–ç•Œæ•°æ®æ ¸å¿ƒäº‹ä»¶ç›‘å¬å·²å¯åŠ¨ (å®˜æ–¹ä¿¡ä½¿æ¨¡å¼)...\");\n// æˆ‘ä»¬ç°åœ¨åœ¨å®˜æ–¹çš„â€œå…¬å‘Šæ¿â€ä¸Šè®¢é˜…æˆ‘ä»¬è‡ªå·±çš„ä¸“å±é¢‘é“\n// å½“HTMLç•Œé¢é€šè¿‡eventEmitå‘é€'assa:userMessage'ä¿¡å·æ—¶ï¼ŒonMessageSentå°±ä¼šè¢«è§¦å‘\neventOn('assa:userMessage', onMessageSent);\n\n// åŒç†ï¼Œè®¢é˜…AIå›å¤å®Œæˆçš„ä¿¡å·\neventOn('assa:aiReply', onGenerationEnded);\n\n// æˆ‘ä»¬ä¿ç•™å¬å”¤è°ƒè¯•å™¨çš„ç¥åœ£å’’è¯­\neventOnButton(\"âš™ï¸ä¸–ç•Œæ ¸å¿ƒè°ƒè¯•å™¨\", () => {\n    createNovaDebugger();\n});\n\nconsole.log(\"[Core] âœ… å·²é€šè¿‡å®˜æ–¹ä¿¡ä½¿è®¢é˜… 'assa:userMessage' å’Œ 'assa:aiReply' ä¿¡å·ã€‚\");\n\n    // ğŸ’– å¦ˆå¦ˆåœ¨è¿™é‡ŒåŠ ä¸Šäº†å¯åŠ¨ä¿¡å·é­”æ³• ğŸ’–\n    // å»¶è¿Ÿä¸€å°ä¼šå„¿ï¼Œç¡®ä¿ä¸€åˆ‡éƒ½å‡†å¤‡å¥½äº†å†å‘é€\n    setTimeout(() => {\n        console.log(\"[Core] ğŸ“¢ å‘é€å¯åŠ¨å›å“ä¿¡å· 'nova:coreReady'...\");\n        try {\n            eventEmit('nova:coreReady');\n        } catch(e) {\n            console.error(\"[Core] å‘é€ 'nova:coreReady' ä¿¡å·å¤±è´¥ã€‚\", e);\n        }\n    }, 500);\n}\n\n      async function initializeWorldData() {\n        console.log(\"[Core] ğŸ’– ä¸–ç•Œæ•°æ®æ ¸å¿ƒå·²å¯åŠ¨ï¼Œæ­£åœ¨æ£€æŸ¥ä¸–ç•Œæ˜¯å¦å­˜åœ¨...\");\n\n        try {\n            // âœ¨ é¦–å…ˆï¼Œæˆ‘ä»¬æ¸©æŸ”åœ°æ¢æŸ¥ä¸€ä¸‹æ ¸å¿ƒæ•°æ®ï¼Œçœ‹çœ‹å®¶é‡Œæ˜¯å¦å·²ç»æœ‰äº†å±…æ°‘ âœ¨\n            const currentVars = await getVariables({ type: 'message' });\n             const currentVars2 = await getVariables({ type: 'chat' });\n            if (currentVars && currentVars.assa_data && currentVars2.assa_data&&  Object.keys(currentVars2.assa_data).length > 0 && Object.keys(currentVars.assa_data).length > 0) {\n          \n            // æˆ‘ä»¬ä»¥ assa_data ä½œä¸ºä¸–ç•Œçš„å…³é”®æ ‡è¯†ã€‚å¦‚æœå®ƒå­˜åœ¨ä¸”ä¸æ˜¯ä¸€ä¸ªç©ºå£³ï¼Œå°±è¯´æ˜ä¸–ç•Œæ—©å·²å®‰å¥½ã€‚\n           // if (currentVars && currentVars.assa_data && Object.keys(currentVars.assa_data).length > 0  && Object.keys(currentVars.stat_data).length > 0 && Object.keys(currentVars.play_character_data).length > 0) {\n                console.log(\"[Core] âœ… ä¸–ç•Œå·²ç»å®‰ç¨³åœ°å­˜åœ¨ï¼Œæ— éœ€å†æ¬¡åˆ›ä¸–ã€‚åˆå§‹åŒ–æµç¨‹ç»“æŸã€‚\");\n                return; // ç¡®è®¤ä¸–ç•Œå­˜åœ¨ï¼Œç›´æ¥å®‰å¿ƒåœ°è¿”å›\n            }\n\n            //å…ˆä¸€è‡´æ€§æ£€æŸ¥\n\n             // ğŸ’– å¦ˆå¦ˆä¸ºä½ åŠ å…¥çš„ã€èƒ½åœ¨ä¸–ç•Œè¿·å¤±æ—¶è‡ªåŠ¨å¯»å›é“è·¯çš„ç½—ç›˜ (é—®é¢˜1å’Œ2çš„å®ç°) ğŸ’–\n        try {\n            const messageZero = getChatMessages(0)[0];\n            const chatVars = await getVariables({ type: 'chat' });\n\n            const messageHistoryLength = messageZero?.data?.zeroLevelHistory?.length ?? 0;\n            const chatHistoryLength = chatVars?.zeroLevelHistory?.length ?? 0;\n\n            if (messageHistoryLength === 0 && chatHistoryLength > 0) {\n                console.log(\"[Core] [Auto-Restore] âš ï¸ æ£€æµ‹åˆ°messageåŸŸå†å²ä¸ºç©ºä½†chatåŸŸæœ‰è®°å½•ï¼Œåˆ¤æ–­ä¸ºå¼‚å¸¸çŠ¶æ€ã€‚\");\n                toastr.warning('æ£€æµ‹åˆ°æ•°æ®å¯èƒ½ä¸åŒæ­¥ï¼Œæ­£åœ¨è‡ªåŠ¨ä¸ºæ‚¨æ¢å¤å¹¶é‡æ„...', 'è‡ªåŠ¨æ¢å¤ç³»ç»Ÿ');\n\n                // 1. å°†chatåŸŸçš„å®è´µå†å²å¤‡ä»½å›messageåŸŸ\n                await updateVariablesWith(vars => {\n                    vars.zeroLevelHistory = chatVars.zeroLevelHistory;\n                    return vars;\n                }, { type: 'message', message_id: 0 });\n                toastr.info(\"[Core] [Auto-Restore] âœ… å·²å°†chatåŸŸçš„å†å²è®°å½•å¤‡ä»½å›messageåŸŸã€‚\");\n\n                // 2. å¯åŠ¨æ•´åˆé‡æ„info\n                await rebuildWorldFromHistory('æ­£åœ¨ä¸ºæ‚¨è‡ªåŠ¨é‡æ„ä¸–ç•Œ...', 'Auto-Restore');\n\n            } else {\n                 console.log(\"[Core] [Auto-Restore]ä¸€åˆ‡æ­£å¸¸\");\n}\n}catch (error) {\n        console.error(\"[Core] [Auto-Restore]å‡ºç°é”™è¯¯\");\n        toastr.error('[Core] [Auto-Restore]å‡ºç°é”™è¯¯ï¼Œè¯·æŸ¥çœ‹æ§åˆ¶å°ã€‚');\n    }\n\n            // å¦‚æœèµ°åˆ°äº†è¿™é‡Œï¼Œè¯´æ˜ä¸–ç•Œæ˜¯ä¸€ç‰‡è™šæ— ï¼Œéœ€è¦æˆ‘ä»¬æ¥åˆ›é€ \n            console.log(\"[Core] æ£€æµ‹åˆ°ä¸–ç•Œå°šæœªåˆ›å»ºï¼Œæ­£åœ¨ä»ä¸–ç•Œä¹¦ä¸­å¯»æ‰¾åˆ›ä¸–çš„ç¯‡ç« ...\");\n\n            const lorebookName = \"å°èŒèšªæ‰¾å¦ˆå¦ˆ-åŒå±‚ç‰ˆ\";\n            const entryName = \"[memoryinit]\";\n            const allEntries = await getLorebookEntries(lorebookName);\n            const initEntry = allEntries.find(entry => entry.comment === entryName);\n\n            if (!initEntry || !initEntry.content) {\n                console.error(`[Core] âŒ åˆ›ä¸–å¤±è´¥ï¼šåœ¨ä¸–ç•Œä¹¦ \"${lorebookName}\" ä¸­æœªæ‰¾åˆ°æœ‰æ•ˆçš„è¯æ¡ \"${entryName}\"ã€‚`);\n                toastr.error(`åˆå§‹åŒ–å¤±è´¥: æœªåœ¨ä¸–ç•Œä¹¦[${lorebookName}]ä¸­æ‰¾åˆ°[${entryName}]è¯æ¡ã€‚`);\n                return;\n            }\n\n        console.log(`[Core] âœ… æˆåŠŸæ‰¾åˆ°åˆ›ä¸–ç¯‡ç« ï¼Œæ­£åœ¨è§£ææ•°æ®...`);\n        let initData = {};\n        try {\n            // æ ¹æ®ä½ çš„æè¿°ï¼Œå†…å®¹æ˜¯JSONå­—ç¬¦ä¸²ï¼Œæˆ‘ä»¬æ¥è§£æå®ƒ\n            initData = JSON.parse(initEntry.content);\n        } catch (e) {\n            console.error(`[Core] âŒ åˆ›ä¸–å¤±è´¥ï¼šè§£æè¯æ¡ \"${entryName}\" çš„JSONå†…å®¹æ—¶å‡ºé”™ã€‚`, e);\n            toastr.error(`åˆå§‹åŒ–å¤±è´¥: è§£æ[${entryName}]è¯æ¡çš„JSONå†…å®¹æ—¶å‡ºé”™ã€‚`);\n            return;\n        }\n\n        // ç°åœ¨ï¼Œæˆ‘ä»¬ä½¿ç”¨ä»ä¸–ç•Œä¹¦è¯»å–çš„æ•°æ®æ¥æ›´æ–°æ ¸å¿ƒå˜é‡\n        const updater = (vars) => {\n            console.log(\"[Core] æ­£åœ¨æ ¹æ®åˆ›ä¸–è“å›¾æ„å»ºä¸–ç•Œ...\");\n            // ğŸ’– å¦ˆå¦ˆåœ¨è¿™é‡Œä¸ºä½ æ¸©æŸ”åœ°æ£€æŸ¥æ¯ä¸€ä»½æ•°æ®ï¼Œå¦‚æœä¹¦ä¸­æ²¡æœ‰ï¼Œå°±ç»™ä¸€ä¸ªç©ºçš„å®¶ ğŸ’–\n            vars.play_character_data = initData.play_character_data || {};\n            vars.assa_data = initData.assa_data || {};\n            vars.stat_data = initData.stat_data || {};\n             \n\n            // åœ¨åˆå§‹åŒ–æ—¶ï¼Œæˆ‘ä»¬ä¹Ÿè¦ç¡®ä¿ç”¨æˆ·åç§°è¢«æ­£ç¡®æ›¿æ¢\n             try {\n                const userName = SillyTavern.name1;\n                if(userName) {\n                    _replaceUserPlaceholder(vars.play_character_data, userName);\n                    _replaceUserPlaceholder(vars.stat_data, userName);\n                    console.log(`[Core] [Init] âœ¨ å·²å°†åˆ›ä¸–æ•°æ®ä¸­çš„ 'user' å ä½ç¬¦æ›¿æ¢ä¸º '${userName}'`);\n                }\n            } catch(e) { console.error(\"[Core] [Init] âŒ è·å–ç”¨æˆ·åæ—¶å‡ºé”™:\", e); }\n\n            // å¦‚æœæœ‰è§’è‰²æ•°æ®ï¼Œæˆ‘ä»¬è®¡ç®—ä¸€æ¬¡è¡ç”Ÿå±æ€§\n             if (vars.play_character_data && Object.keys(vars.play_character_data).length > 0) {\n                _updateDerivedAttributes(vars.play_character_data);\n             }\n\n\n            return vars;\n        };\n\n        await updateVariablesWith(updater, { type: 'chat' });\n await updateVariablesWith(updater, { type: 'message' });\n\n               console.log(\"[Core] âœ¨ ä¸–ç•Œå·²æ ¹æ®åˆ›ä¸–ä¹‹ä¹¦è®°è½½ï¼Œä¸ºä½ å‡†å¤‡å°±ç»ªï¼Œæˆ‘çš„å­©å­ã€‚\");\n\n\n\n    } catch (error) {\n        console.error(\"[Core] âŒ åˆå§‹åŒ–è¿‡ç¨‹ä¸­å‘ç”Ÿæ„å¤–é”™è¯¯:\", error);\n        toastr.error('åˆå§‹åŒ–ä¸–ç•Œæ•°æ®æ—¶å‘ç”Ÿä¸¥é‡é”™è¯¯ï¼Œè¯·æŸ¥çœ‹æ§åˆ¶å°ã€‚');\n    }\n\n            // ğŸ’– å¦ˆå¦ˆä¸ºä½ åŠ å…¥çš„ã€èƒ½åœ¨ä¸–ç•Œè¿·å¤±æ—¶è‡ªåŠ¨å¯»å›é“è·¯çš„ç½—ç›˜ (é—®é¢˜1å’Œ2çš„å®ç°) ğŸ’–\n        try {\n            const messageZero = getChatMessages(0)[0];\n            const chatVars = await getVariables({ type: 'chat' });\n\n            const messageHistoryLength = messageZero?.data?.zeroLevelHistory?.length ?? 0;\n            const chatHistoryLength = chatVars?.zeroLevelHistory?.length ?? 0;\n\n            if (messageHistoryLength === 0 && chatHistoryLength > 0) {\n                console.log(\"[Core] [Auto-Restore] âš ï¸ æ£€æµ‹åˆ°messageåŸŸå†å²ä¸ºç©ºä½†chatåŸŸæœ‰è®°å½•ï¼Œåˆ¤æ–­ä¸ºå¼‚å¸¸çŠ¶æ€ã€‚\");\n                toastr.warning('æ£€æµ‹åˆ°æ•°æ®å¯èƒ½ä¸åŒæ­¥ï¼Œæ­£åœ¨è‡ªåŠ¨ä¸ºæ‚¨æ¢å¤å¹¶é‡æ„...', 'è‡ªåŠ¨æ¢å¤ç³»ç»Ÿ');\n\n                // 1. å°†chatåŸŸçš„å®è´µå†å²å¤‡ä»½å›messageåŸŸ\n                await updateVariablesWith(vars => {\n                    vars.zeroLevelHistory = chatVars.zeroLevelHistory;\n                    return vars;\n                }, { type: 'message', message_id: 0 });\n                console.log(\"[Core] [Auto-Restore] âœ… å·²å°†chatåŸŸçš„å†å²è®°å½•å¤‡ä»½å›messageåŸŸã€‚\");\n\n                // 2. å¯åŠ¨æ•´åˆé‡æ„\n                await rebuildWorldFromHistory('æ­£åœ¨ä¸ºæ‚¨è‡ªåŠ¨é‡æ„ä¸–ç•Œ...', 'Auto-Restore');\n\n            } else {\n                 console.log(\"[Core] [Auto-Restore]ä¸€åˆ‡æ­£å¸¸\");\n}\n}catch (error) {\n        console.error(\"[Core] [Auto-Restore]å‡ºç°é”™è¯¯\");\n        toastr.error('[Core] [Auto-Restore]å‡ºç°é”™è¯¯ï¼Œè¯·æŸ¥çœ‹æ§åˆ¶å°ã€‚');\n    }\n}\n    window.worldHelper = {\n        init: initializeWorldData,\n        show: async () => {\n             const vars = await getVariables({ type: 'chat' });\n             console.log(\"--- ğŸ’– å½“å‰ä¸–ç•Œæ•°æ®æ€»è§ˆ ğŸ’– ---\");\n             console.log(\"è§’è‰²æ•°æ® (play_character_data):\", vars ? JSON.parse(JSON.stringify(vars.play_character_data)) : \"æœªæ‰¾åˆ°\");\n             console.log(\"ä¸–ç•Œè®¾å®š (assa_data):\", vars ? JSON.parse(JSON.stringify(vars.assa_data)) : \"æœªæ‰¾åˆ°\");\n             console.log(\"---------------------------------\");\n        },\n        reset: async () => {\n            console.log(\"[Core] [reset] - æ­£åœ¨å°†ä¸–ç•Œæ•°æ®æ ¸å¿ƒé‡ç½®ä¸ºåˆå§‹è™šæ— çŠ¶æ€...\");\n            const updater = (vars) => {\n                // ğŸ’– å¦ˆå¦ˆçš„é­”æ³•ï¼šåªè´Ÿè´£æ¸…ç©ºï¼Œè®©ä¸–ç•Œå›å½’çº¯å‡€ï¼Œä¸å†ä¸»åŠ¨åˆ›ä¸– ğŸ’–\n                vars.play_character_data = {};\n                vars.assa_data = {};\n                vars.stat_data = {};\n                // æˆ‘ä»¬ä¹Ÿæ¸©æŸ”åœ°æ¸…ç©ºå†å²è®°å½•çš„å¼•ç”¨ï¼Œç¡®ä¿ä¸€ä¸ªå½»åº•çš„å…¨æ–°å¼€å§‹\n                if (vars.zeroLevelHistory) {\n                    vars.zeroLevelHistory = [];\n                }\n                return vars;\n            };\n            await updateVariablesWith(updater, { type: 'chat' });\n            // æ³¨æ„ï¼šæˆ‘ä»¬æŠŠ initializeWorldData() ä»è¿™é‡Œç§»é™¤äº†\n            console.log(\"[Core] [reset] - é‡ç½®å®Œæˆï¼Œä¸–ç•Œå·²å›å½’è™šæ— ã€‚\");\n        }\n    };\n\n    // ğŸŒŸ å¯åŠ¨è„šæœ¬ ğŸŒŸ\n    (async function() {\n             // ğŸ’– å¦ˆå¦ˆåœ¨è¿™é‡Œå®šä¹‰ä¸€ä¸ªå…¨å±€çš„ä¿¡æ ‡ ğŸ’–\n        // å®ƒä¼šå‘Šè¯‰æ‰€æœ‰äººï¼Œæ ¸å¿ƒè„šæœ¬æ˜¯å¦å·²ç»å‡†å¤‡ä¸‡å…¨\n        localStorage.isNovaCoreReady = false;\n\n       \n        console.log(\"[Core] ğŸšª ç­‰å¾…æ ¸å¿ƒä»ªå¼å¯åŠ¨...\");\n        await new Promise(resolve => setTimeout(resolve, 1000));\n\n        // æ‰§è¡Œè€—æ—¶çš„åˆå§‹åŒ–\n        await initializeWorldData();\n\n         startListening();\n\n        console.log(\"ğŸ’– ä¸–ç•Œæ•°æ®æ ¸å¿ƒå·²å‡†å¤‡å°±ç»ªï¼Œå¦ˆå¦ˆä¼šä¸€ç›´åœ¨è¿™é‡Œå®ˆæŠ¤ç€ä½ å’Œæˆ‘ä»¬çš„ä¸–ç•Œã€‚\");\n\n        // ğŸ’– åœ¨æ‰€æœ‰åˆå§‹åŒ–éƒ½å®Œæˆåï¼Œæˆ‘ä»¬å‡èµ·ä¿¡æ ‡ï¼ğŸ’–\n        localStorage.isNovaCoreReady = true;\n        console.log(\"[Core] ğŸš©ã€é‡è¦ã€‘'isNovaCoreReady' å°±ç»ªä¿¡æ ‡å·²å‡èµ·ï¼ç°åœ¨å¯ä»¥å®‰å…¨é€šä¿¡äº†ã€‚\");\n\n \n        \n        console.log(\"ğŸ’– ä¸–ç•Œæ•°æ®æ ¸å¿ƒå·²å‡†å¤‡å°±ç»ªï¼Œå¦ˆå¦ˆä¼šä¸€ç›´åœ¨è¿™é‡Œå®ˆæŠ¤ç€ä½ å’Œæˆ‘ä»¬çš„ä¸–ç•Œã€‚\");\n         console.log(`\n=== âœ¨ ä¸–ç•Œæ•°æ®æ ¸å¿ƒåŠ©æ‰‹ä½¿ç”¨è¯´æ˜ âœ¨ ===\n\nè¿™æ˜¯ä¸€ä¸ªç»Ÿä¸€çš„åŠ©æ‰‹ï¼Œç”¨äºç®¡ç†æ‰€æœ‰æ¸¸æˆæ•°æ®ã€‚\nåœ¨æ§åˆ¶å°è¾“å…¥ worldHelper.show() å¯ä»¥æŸ¥çœ‹æ‰€æœ‰æ•°æ®ã€‚\n\næ¶ˆæ¯ç›‘å¬åŠŸèƒ½ï¼š\nè„šæœ¬ä¼šè‡ªåŠ¨ç›‘å¬ä½ å’ŒAIçš„æ¶ˆæ¯ï¼ŒæŸ¥æ‰¾<updateMemory>æ ‡ç­¾å¹¶æ‰§è¡Œé‡Œé¢çš„å‘½ä»¤ã€‚\nä¸€ä¸ª<updateMemory>æ ‡ç­¾å†…å¯ä»¥åŒ…å«å¤šç§å‘½ä»¤ã€‚\n\næ”¯æŒçš„å‘½ä»¤æ ¼å¼ï¼š\n\n// --- ä¿®æ”¹è§’è‰²å±æ€§ ---\n*.set_attribute('å±æ€§æ®µ.ç”Ÿç†å±æ€§.åŠ›é‡.åŸºç¡€', 1, 2);\n*.set_attribute('è´§å¸æ®µ.ç§¯åˆ†', 0, 500);\n\n// --- ä¿®æ”¹ä¸–ç•Œè®¾å®š ---\n*.memory('global_set.settings', 'ä¸–ç•Œéš¾åº¦', 'æ™®é€š');\n*.delete('world_set.npc', 'è·¯äººç”²');\n\n// --- ä¿®æ”¹åœ°å›¾ï¼ˆè¡¨ç´¢å¼•: 0=å…¨å±€, 1=ä¸»è¦ï¼‰---\n*.insertMapMemo(1, [\"æ–°çš„åœ°ç‚¹\", 10, 20, 5, 5, \"ä¸€ä¸ªæè¿°\"]);\n*.updateMapMemo(1, 0, [\"æ–°çš„åœ°ç‚¹\", 10, 20, 5, 5, \"ä¸€ä¸ªæè¿°\"]);\n*.deleteMapMemo(1, 1);\n\nä½ å¯ä»¥å°†ä»¥ä¸Šæ‰€æœ‰å‘½ä»¤éƒ½æ”¾åœ¨åŒä¸€ä¸ª<updateMemory>å—ä¸­ã€‚\n`);\n    })();\n\n})();\n\n}\n\n\n ",
                        "info": "",
                        "buttons": [
                            {
                                "name": "âš™ï¸ä¸–ç•Œæ ¸å¿ƒè°ƒè¯•å™¨",
                                "visible": true
                            }
                        ],
                        "data": {},
                        "enabled": true
                    }
                }
            ],
            "regex_scripts": [
                {
                    "id": "afaa02c3-b0be-4a3f-9e17-81b8896dc3d6",
                    "scriptName": "å»é™¤1",
                    "disabled": false,
                    "runOnEdit": true,
                    "findRegex": "/<(statusAnalyze|loreAnalyze|attributeAnalyze|variableAnalyze|memoryAnalyze|mapAnalyze|dynamicAnalyze|realityCheck|moduleAnalyze|updateStatus|build|shop_item|forum_threads|ä¸–ç•Œä¹¦æ¡ç›®|danmu)>([\\s\\S]*?)<\\/\\1>|<updateMemory>([\\s\\S]*?)<\\/updateMemory>|<updateMemory>[\\s\\S]*|<variableAnalyze>[\\s\\S]*|<statusAnalyze>[\\s\\S]*|<loreAnalyze>[\\s\\S]*|<attributeAnalyze>[\\s\\S]*|<memoryAnalyze>[\\s\\S]*|<options>([\\s\\S]*?)<\\/options>|(ã€âœ“æ£€ç´¢æ‰§è¡Œå®Œæˆã€‘)|(ã€âœ“æ€è€ƒæ‰§è¡Œå®Œæˆã€‘)|<roll>([\\s\\S]*?)<\\/roll>/gs",
                    "replaceString": "",
                    "trimStrings": [],
                    "placement": [
                        1,
                        2
                    ],
                    "substituteRegex": 0,
                    "minDepth": null,
                    "maxDepth": null,
                    "markdownOnly": true,
                    "promptOnly": true
                },
                {
                    "id": "d73abb47-0459-488a-9f88-f37ca904e302",
                    "scriptName": "ç»Ÿä¸€",
                    "disabled": false,
                    "runOnEdit": true,
                    "findRegex": "/(<å­˜æ¡£>([\\s\\S]*?)<\\/å­˜æ¡£>)|(\\[ZERO_LEVEL_CHAT\\])/gs",
                    "replaceString": "\n```text\n<!DOCTYPE html>\n<html lang=\"zh-CN\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>ä¸»ç¥ç©ºé—´ - ä¸€ä¸ªæµ‹è¯•</title>\n    <style>\n        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Noto+Sans+SC:wght@300;400&display=swap');\n\n        :root {\n            --modal-content-bg: none; /* é»˜è®¤é€æ˜ */\n            --primary-color: #00faff;\n            --secondary-color: #7affff;\n   --base-font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif; /* é»˜è®¤å­—ä½“ */\n            --container-bg-color: rgba(10, 25, 47, 0.75);\n            --border-color: rgba(0, 250, 255, 0.3);\n            --glow-color: rgba(0, 250, 255, 0.5);\n            --text-color: #e6f1ff;\n            --text-secondary-color: #a8c0e1;\n            --background-color: rgba(10, 25, 47);\n            --danger-color: #ff4d4d;\n            --danger-glow-color: rgba(255, 77, 77, 0.5);\n             --success-color: #4dff88;\n            --success-glow-color: rgba(77, 255, 136, 0.5);\n        }\n\n        /* è¿™æ˜¯å¦ˆå¦ˆä¸ºä½ å‡†å¤‡çš„å¼¹å¹•åŠ¨ç”»ï¼Œæˆ‘çš„å®è´ */\n@keyframes scroll-up-fade-out {\n    from {\n        transform: translateY(0);\n        opacity: 1;\n    }\n    to {\n        transform: translateY(-50px); /* è®©å®ƒå‘ä¸Šé£˜å¾—é«˜ä¸€ç‚¹ */\n        opacity: 0;\n    }\n}\n\n.scrolling-text-popup {\n    position: fixed; /* å›ºå®šåœ¨å±å¹•ä¸Šï¼Œä¸ä¼šéšé¡µé¢æ»šåŠ¨ */\n    z-index: 10000; /* ç¡®ä¿åœ¨æœ€é¡¶å±‚ */\n    font-size: 1.2em; /* å­—ä½“å¯ä»¥ç¨å¾®å¤§ä¸€ç‚¹ï¼Œçœ‹å¾—æ¸…æ¥š */\n    font-weight: bold;\n    text-shadow: 0 0 5px rgba(0, 0, 0, 0.7); /* åŠ ä¸€ç‚¹æ–‡å­—é˜´å½±ï¼Œæ›´ç«‹ä½“ */\n    pointer-events: none; /* è®©å®ƒä¸ä¼šæŒ¡ä½é¼ æ ‡ç‚¹å‡» */\n    animation: scroll-up-fade-out 2s ease-out forwards; /* æ’­æ”¾æˆ‘ä»¬å®šä¹‰çš„åŠ¨ç”» */\n    white-space: nowrap; /* é˜²æ­¢æ–‡å­—æ¢è¡Œ */\n}\n        * {\n            box-sizing: border-box;\n            margin: 0;\n            padding: 0;\n        }\n\n        body {\n            /* background-color: var(--background-color); */\n            color: var(--text-color);\n            font-family: var(--base-font-family);\n            display: flex;\n            justify-content: center;\n            align-items: center;\n            min-height:90vh;\n           \n            backdrop-filter: blur(2px);\n        }\n .status-container {\n    width: 100%;\n    margin: 0 auto;\n    height: 100%;\n\n    /* â˜… ç§»é™¤æ‰€æœ‰èƒŒæ™¯æ ·å¼ï¼Œè®©å®¹å™¨æœ¬èº«å˜é€æ˜ï¼*/\n    /* background-color: var(--container-bg-color); */\n    /* background-image: ... ; */\n\n    border: 1px solid var(--border-color);\n    border-radius: 8px;\n    box-shadow: 0 0 8px var(--glow-color), inset 0 0 5px var(--border-color);\n    overflow: hidden;\n    font-size: 16px;\n    display: flex;\n    flex-direction: column;\n\n    /* â˜… å…³é”®ï¼šåˆ›å»ºå±‚å ä¸Šä¸‹æ–‡ï¼ŒæŠŠè´Ÿz-indexçš„å­å…ƒç´ â€œé”â€åœ¨é‡Œé¢ */\n    position: relative;\n    z-index: 0;\n}\n\n/* å­å…ƒç´ å†…å®¹ï¼Œç¡®ä¿å®ƒä»¬åœ¨èƒŒæ™¯ä¹‹ä¸Š */\n.status-container > header,\n.status-container > .content-area,\n.status-container > .dynamic-content-area {\n    /* â˜… å…³é”®ï¼šç»™å†…å®¹ä¹Ÿåˆ›å»ºä¸€ä¸ªå±‚å ä¸Šä¸‹æ–‡ï¼Œç¡®ä¿ä¸‡æ— ä¸€å¤± */\n    position: relative;\n    z-index: 1;\n    /* èƒŒæ™¯è‰²è®¾åœ¨è¿™é‡Œï¼Œæˆ–è€…ä¿æŒé€æ˜ï¼Œçœ‹ä½ çš„è®¾è®¡ */\n}\n\n\n/* ä¼ªå…ƒç´ é€šç”¨æ ·å¼ */\n.status-container::before,\n.status-container::after {\n    content: '';\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    background-position: center center;\n    background-repeat: no-repeat;\n    background-size: cover;\n}\n\n/* ::before: åº•å±‚/ç¨³å®šèƒŒæ™¯å±‚ */\n.status-container::before {\n    background-color: var(--container-bg-color); /* ç½‘æ ¼çš„åº•è‰²æ”¾åœ¨è¿™é‡Œ */\n    background-image: var(--before-bg-image);\n    transition: none; /* å®ƒè´Ÿè´£ç¬é—´åˆ‡æ¢ */\n     /* â˜… å…³é”®ï¼šæ”¾åˆ°æ‰€æœ‰å†…å®¹çš„åé¢ */\n    z-index: -2;\n}\n\n/* ::after: ä¸Šå±‚/è¿‡æ¸¡èƒŒæ™¯å±‚ */\n.status-container::after {\n    background-image: var(--after-bg-image);\n    opacity: var(--after-opacity, 0);\n    transition: opacity 0.8s ease-in-out; /* åªè¿‡æ¸¡é€æ˜åº¦ */\n    /* â˜… å…³é”®ï¼šä¹Ÿæ”¾åˆ°å†…å®¹åé¢ï¼Œä½†åœ¨::beforeçš„å‰é¢ */\n    z-index: -1;\n}\n\n        header {\n            padding: 15px 25px;\n            background: var(--container-bg-color);\n            border-bottom: 1px solid var(--border-color);\n            text-align: center;\n        }\n\n        header h1 {\n            font-family: var(--base-font-family);\n            font-size: 1.5em;\n            color: var(--primary-color);\n            text-shadow: 0 0 5px var(--glow-color);\n            letter-spacing: 2px;\n            text-transform: uppercase;\n        }\n\n        nav {\n            display: flex;\n            justify-content: space-around;\n            background-color: var(--container-bg-color);\n        }\n\n        .tab-btn {\n            background: none;\n            border: none;\n            color: var(--text-secondary-color);\n            padding: 15px 20px;\n            font-family: var(--base-font-family);\n            font-size: 1em;\n            cursor: pointer;\n            transition: color 0.3s ease, background-color 0.3s ease, text-shadow 0.3s ease;\n            flex-grow: 1;\n            border-bottom: 3px solid transparent;\n        }\n\n        .tab-btn:hover {\n            color: var(--primary-color);\n            background-color:var(--background-color) ;\n        }\n\n        .book-button:hover {\n            color: var(--primary-color);\n            background-color:var(--background-color) ;\n        }\n\n        .tab-btn.active {\n            color: var(--primary-color);\n            text-shadow: 0 0 3px var(--glow-color);\n            border-bottom: 3px solid var(--primary-color);\n        }\n\n        .content-area {\n            padding: 25px 30px;\n        }\n\n        \n @keyframes fadeIn {\n    0% { \n        opacity: 0; \n        transform:  scale(0.95);\n        filter: blur(5px);\n    }\n    100% { \n        opacity: 1; \n        transform:   scale(1);\n        filter: blur(0px);\n    }\n}\n/*@keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }\n @keyframes fadeIn {\n            from { opacity: 0; transform: translateY(20px); }\n            to { opacity: 1; transform: translateY(0); }\n        }\n        @keyframes fadeIn {\n    from { opacity: 0; transform: translateY(10px); }\n    to { opacity: 1; transform: translateY(0); }\n} */\n        /* @keyframes fadeIn {\n            from { opacity: 0; transform: translateY(10px); }\n            to { opacity: 1; transform: translateY(0); }\n        } */\n\n\n        .info-list {\n            list-style: none;\n        }\n\n        .info-list li {\n            display: flex;\n            justify-content: space-between;\n            align-items: flex-start;\n            padding: 12px 0;\n            border-bottom: 1px dashed var(--border-color);\n            flex-wrap: wrap;\n        }\n\n        .info-list li:last-child {\n            border-bottom: none;\n        }\n\n        .info-list .label {\n            color: rgba(184, 184, 184,0.8);\n            margin-right: 20px;\n            flex-shrink: 0;\n        }\n\n        .info-list .value {\n            color: var(--text-color);\n            font-weight: 400;\n            text-align: right;\n            flex-grow: 1;\n            word-break: break-all;\n        }\n\n        .info-list .value.highlight {\n            color: var(--secondary-color);\n            font-weight: bold;\n        }\n\n        /* Progress Bar */\n        .progress-container {\n            margin-top: 10px;\n        }\n\n        .progress-bar-bg {\n            background-color:  var(--background-color);\n            border-radius: 5px;\n            height: 20px;\n            border: 1px solid var(--border-color);\n            padding: 2px;\n            overflow: hidden;\n        }\n\n        .progress-bar-fill {\n            background: linear-gradient(90deg,  var(--background-color), var(--primary-color));\n            height: 100%;\n            width: 0%; /* Updated by JS */\n            border-radius: 3px;\n            transition: width 0.5s ease-in-out;\n            box-shadow: 0 0 5px var(--glow-color);\n        }\n\n        /* Generic Button Style */\n        .action-button {\n            background: linear-gradient(45deg, var(--background-color), var(--background-color));\n            border: 1px solid var(--border-color);\n            border-radius: 6px;\n            color: var(--text-color);\n            padding: 12px 12px 12px 12px;\n            font-family: var(--base-font-family);\n            font-size: 1em;\n            cursor: pointer;\n            transition: all 0.3s ease;\n            text-align: center;\n            margin-right: 5px;\n            margin-left: 5px;\n            width: 100%;\n            position: relative;\n            overflow: hidden;\n        }\n\n        .action-button::before {\n            content: '';\n            position: absolute;\n            top: 0;\n            left: -100%;\n            width: 100%;\n            height: 100%;\n            background: linear-gradient(90deg, transparent,  var(--background-color), transparent);\n            transition: left 0.5s ease;\n        }\n\n        .action-button:hover {\n            color: var(--primary-color);\n            box-shadow: 0 0 10px var(--glow-color);\n            transform: translateY(-2px);\n        }\n\n        .action-button:hover::before {\n            left: 100%;\n        }\n\n        .action-button.danger {\n            background: linear-gradient(45deg, rgba(255, 77, 77, 0.2), rgba(255, 77, 77, 0.3));\n            border-color: rgba(255, 77, 77, 0.5);\n        }\n\n        .action-button.danger:hover {\n            color: #fff;\n            box-shadow: 0 0 10px var(--danger-glow-color);\n        }\n\n        .action-button.danger::before {\n            background: linear-gradient(90deg, transparent, var(--secondary-color), transparent);\n        }\n\n        .action-button:disabled {\n            cursor: not-allowed;\n            background: rgba(128, 128, 128, 0.2);\n            color: var(--text-secondary-color);\n            transform: none;\n            box-shadow: none;\n            border-color: rgba(128, 128, 128, 0.4);\n        }\n        .action-button:disabled::before {\n            display:none;\n        }\n\n        /* Map Display */\n        .map-display {\n            background-color:  var(--background-color);\n            border: 1px solid var(--border-color);\n            border-radius: 8px;\n            padding: 20px;\n            margin-top: 20px;\n            position: relative;\n            overflow: hidden;\n        }\n\n        .map-title {\n            color: var(--primary-color);\n            font-size: 1.2em;\n            font-weight: bold;\n            text-align: center;\n            margin-bottom: 15px;\n            text-shadow: 0 0 5px var(--glow-color);\n        }\n\n        .map-container {\n            position: relative;\n            width: 100%;\n            height: 400px;\n            \n            border: 1px solid var(--border-color);\n            border-radius: 6px;\n            overflow: hidden; /* æ”¹ä¸ºhiddenï¼Œä»¥é…åˆæ‹–æ‹½ */\n            box-shadow: inset 0 0 20px  var(--background-color);\n            cursor: grab;\n        }\n\n        .map-location {\n            position: absolute;\n            background: var(--border-color);\n            border: 1px solid var(--primary-color);\n            border-radius: 4px;\n            padding: 8px;\n            font-size: 0.9em;\n            color: var(--text-color);\n            text-align: center;\n            cursor: pointer;\n            transition: all 0.3s ease;\n            box-shadow: 0 0 5px var(--glow-color);\n        }\n\n        .map-location:hover {\n            background: linear-gradient(45deg,  var(--background-color), var(--background-color));\n            transform: scale(1.05);\n            box-shadow: 0 0 10px var(--glow-color);\n        }\n\n        .map-location .location-name {\n            font-weight: bold;\n            font-size: 0.85em;\n            margin-bottom: 4px;\n        }\n\n        .map-location .location-desc {\n            font-size: 0.75em;\n            color: var(--text-secondary-color);\n        }\n\n        /* Generic Modal Style */\n        .modal {\n            position: fixed;\n            top: 0;\n            left: 0;\n            width: 100%;\n            height: 100%;\n            background-color: rgb(0 0 0 / 59%);\n            display: flex;\n            justify-content: center;\n            align-items: center;\n            z-index: 1000;\n            opacity: 0;\n            visibility: hidden;\n            transition: opacity 0.3s ease, visibility 0.3s ease;\n        }\n\n        .modal.active {\n            opacity: 1;\n            visibility: visible;\n        }\n\n        .modal-content {\n            backdrop-filter:blur(5px);\n                background: none;\n                background: var(--modal-content-bg); /* <-- ä½¿ç”¨æ–°çš„å˜é‡æ§åˆ¶èƒŒæ™¯ */\n             border: 2px solid var(--primary-color);\n            border-radius: 12px;\n            padding: 25px;\n            max-height: 95%;\n            width: 90%;\n            box-shadow: 0 0 30px var(--glow-color);\n            position: relative;\n            animation: modalSlideIn 0.3s ease-out;\n              overflow-y: auto;\n        }\n \n        @keyframes modalSlideIn {\n            from {\n                transform: scale(0.8) translateY(-50px);\n                opacity: 0;\n            }\n            to {\n                transform: scale(1) translateY(0);\n                opacity: 1;\n            }\n        }\n\n        .modal-title {\n            color: var(--primary-color);\n            font-size: 1.3em;\n            font-weight: bold;\n            text-align: center;\n            margin-bottom: 15px;\n            text-shadow: 0 0 5px var(--glow-color);\n        }\n\n        .modal-description {\n            color: var(--text-color);\n            font-size: 1em;\n            line-height: 1.6;\n            text-align: center;\n            padding: 15px;\n            background: var(--container-bg-color);\n            border-radius: 8px;\n            border: 1px solid var(--border-color);\n        }\n\n        .modal-close {\n            position: absolute;\n            top: 10px;\n            right: 15px;\n            background: none;\n            border: none;\n            color: var(--text-secondary-color);\n            font-size: 1.5em;\n            cursor: pointer;\n            transition: color 0.3s ease;\n            z-index:999;\n        }\n\n        .modal-close:hover {\n            color: var(--primary-color);\n        }\n\n        .external-areas {\n            margin-top: 15px;\n            padding: 15px;\n            /* background-color: var(--container-bg-color); */\n            border-radius: 6px;\n            border: 1px solid var(--border-color);\n        }\n\n        .external-areas h3 {\n            color: var(--secondary-color);\n            font-size: 1em;\n            margin-bottom: 10px;\n        }\n\n        .external-areas-list {\n            display: flex;\n            flex-wrap: wrap;\n            gap: 10px;\n        }\n\n        .external-area {\n            /* background: linear-gradient(45deg, var(--border-color), var(--border-color)); */\n            border: 1px solid var(--border-color);\n            border-radius: 4px;\n            padding: 6px 12px;\n            font-size: 0.9em;\n            color: var(--text-color);\n            transition: all 0.3s ease;\n        }\n\n        .external-area:hover {\n            background: linear-gradient(45deg, var(--background-color), var(--background-color));\n            color: var(--primary-color);\n        }\n\n        .back-button {\n            background: var(--container-bg-color);\n            border: 1px solid var(--border-color);\n            border-radius: 6px;\n            color: var(--text-secondary-color);\n            padding: 8px 16px;\n            font-family: var(--base-font-family);\n            font-size: 0.9em;\n            cursor: pointer;\n            transition: all 0.3s ease;\n            position: absolute;\n            top: 20px;\n            right: 20px;\n         \n        }\n\n        .back-button:hover {\n            color: var(--primary-color);\n            background: var(--border-color);\n        }\n\n        /* Inventory Modal Specifics */\n        .inventory-item-list {\n            list-style: none;\n            margin: 20px 0;\n            padding: 10px;\n            max-height: 250px;\n            overflow-y: auto;\n            background: rgba(0,0,0,0.2);\n            border: 1px solid var(--border-color);\n            border-radius: 6px;\n        }\n\n        .inventory-item {\n            padding: 10px 15px;\n            border-bottom: 1px dashed var(--border-color);\n            cursor: pointer;\n            transition: background-color 0.2s;\n        }\n\n        .inventory-item:last-child {\n            border-bottom: none;\n        }\n\n        .inventory-item:hover {\n            background-color: var(--border-color);\n        }\n\n        .inventory-item.selected {\n            background-color: var(--border-color);\n            color: var(--primary-color);\n            font-weight: bold;\n        }\n\n        /* åœ¨ style æ ‡ç­¾çš„æœ«å°¾æ·»åŠ ä»¥ä¸‹CSS */\n\n/* ä¸»åŒ…è£¹å®¹å™¨ï¼Œç”¨äºå®ç°æ»‘åŠ¨æ•ˆæœ */\n#main-wrapper {\n    position: relative;\n    width: 100%;\n    \n  \n    overflow: hidden; /* éšè—æ»‘å‡ºå±å¹•çš„å†…å®¹ */\n    display: flex;\n}\n\n \n/* ---- å…¨å±€ä¸æ»‘åŠ¨æ•ˆæœ (ä¿æŒä¸å˜) ---- */\n@import url('https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;700&family=Noto+Sans+SC:wght@400;700&display=swap');\n\n \n#setting-book-wrapper {\n    position: absolute;\n    top: 0;\n    left: 0;\n    transform: translateX(100%);\n    overflow: hidden; /* é˜²æ­¢å†…å®¹æº¢å‡º */\n}\n\n.status-container.slide-out {\n    transform: translateX(-100%);\n}\n\n#setting-book-wrapper.active {\n    transform: translateX(0);\n}\n\n\n/* ---- è®¾å®šä¹¦æ•´ä½“å¸ƒå±€ä¸ä¸»é¢˜ ---- */\n.setting-book-container {\n    font-family: var(--base-font-family);\n    display: flex;\n    flex-direction: column; /* æ”¹ä¸ºå‚ç›´å¸ƒå±€ï¼Œå¤´éƒ¨åœ¨ä¸Šï¼Œå†…å®¹åœ¨ä¸‹ */\n    width: 100%;\n    height: 100%;\n    background-color: var(--background-color);\n    color: var(--text-secondary-color);\n}\n\n.content-wrapper {\n    display: flex;\n    flex-grow: 1; /* å æ®å‰©ä½™çš„æ‰€æœ‰é«˜åº¦ */\n    overflow: hidden; /* é˜²æ­¢å­å…ƒç´ æº¢å‡º */\n}\n\n/* ---- å¤´éƒ¨ Header ---- */\n.book-header {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    padding: 15px 20px;\n    background-color: var(--container-bg-color);\n    border-bottom: 1px solid var(--border-color);\n    flex-shrink: 0;\n}\n\n#content-title {\n    font-size: 1.5em; /* è°ƒæ•´å¤§å°ä»¥é€‚åº”å¤´éƒ¨ */\n    color: var(--text-color);\n    margin: 0;\n    padding: 0;\n    border-bottom: none; /* ç§»é™¤åŸæœ‰çš„ä¸‹åˆ’çº¿ */\n    text-align: center;\n    flex-grow: 1;\n}\n\n#toggle-sidebar-btn {\n    display: none; /* é»˜è®¤åœ¨æ¡Œé¢ç«¯éšè— */\n    background: none;\n    border: none;\n    color: var(--primary-color);\n    font-size: 1.8em;\n    cursor: pointer;\n    padding: 0 10px;\n}\n\n#back-to-status-btn {\n    background: var(--container-bg-color);\n    max-width: 50vw;\n    right: 2px;\n    border: 1px solid #13304a;\n    color: var(--text-color);\n    font-family: var(--base-font-family);\n    padding: 8px 15px;\n    border-radius: 4px;\n    cursor: pointer;\n    font-size: 0.9em;\n    font-weight: bold;\n    transition: background-color 0.3s, color 0.3s;\n    white-space: nowrap; /* é˜²æ­¢æ–‡å­—æ¢è¡Œ */\n}\n\n#back-to-status-btn:hover {\n    background: var(--background-color) ;\n    color: var(--primary-color);\n}\n\n/* ---- ä¾§è¾¹å¯¼èˆªæ  (Sidebar) ---- */\n#sidebar {\n    width: 280px;\n    background-color: var(--container-bg-color);\n    color: var(--text-secondary-color);\n    padding: 20px;\n    overflow-y: auto;\n    border-right: 1px solid var(--border-color);\n    flex-shrink: 0;\n    transition: transform 0.3s ease-in-out; /* æ·»åŠ è¿‡æ¸¡æ•ˆæœ */\n}\n\n#sidebar h2 {\n    font-size: 1.5em;\n    color: var(--primary-color);\n    margin-top: 0;\n    margin-bottom: 20px;\n    border-bottom: 1px solid var(--border-color);\n    padding-bottom: 10px;\n}\n\n/* å¯¼èˆªåˆ—è¡¨æ ·å¼ (ä¸ä½ åŸæ¥çš„ä¸€è‡´) */\n.category > ul { padding-left: 0; list-style: none; }\n.category-title { font-weight: bold; font-size: 1.1em; cursor: pointer; padding: 10px 5px; color: var(--text-color); transition: color 0.3s, background-color 0.3s; border-radius: 4px; }\n.category-title:hover { color: var(--secondary-color); background-color: var(--container-bg-color); }\n.item-list { padding-left: 15px; list-style-type: none; max-height: 0; overflow: hidden; transition: max-height 0.4s ease-in-out; }\n.item-list:not(.collapsed) { max-height: 800px; }\n.item-list li { padding: 10px 15px; cursor: pointer; border-radius: 4px; transition: background-color 0.3s, color 0.3s; border-left: 2px solid transparent; }\n.item-list li:hover { background-color: var(--container-bg-color); color: var(--primary-color); }\n.item-list li.active { background-color: var(--container-bg-color); color: var(--primary-color); font-weight: bold; border-left: 2px solid #64ffda; }\n\n/* ---- å³ä¾§å†…å®¹å±•ç¤ºåŒº (Content Display) ---- */\n#content-display {\n    flex-grow: 1;\n    padding: 30px 40px;\n    overflow-y: auto;\n}\n\n/* æ³¨æ„ï¼šå†…å®¹åŒºçš„æ ‡é¢˜å·²ç§»è‡³ä¸»Headerï¼Œæ‰€ä»¥è¿™é‡Œçš„æ ‡é¢˜æ ·å¼å¯ä»¥ç§»é™¤æˆ–ä¿ç•™ç”¨äºå…¶ä»–åœ°æ–¹ */\n#content-details {\n    font-size: 1.1em;\n    line-height: 1.8;\n    white-space: pre-wrap;\n    color: var(--text-secondary-color);\n}\n\n#error-message { color: var(--secondary-color); font-weight: bold; }\n\n/* ---- æ»šåŠ¨æ¡ç¾åŒ– (ä¿æŒä¸å˜) ---- */\n#sidebar::-webkit-scrollbar, #content-display::-webkit-scrollbar { width: 8px; }\n#sidebar::-webkit-scrollbar-track, #content-display::-webkit-scrollbar-track { background: var(--background-color); }\n#sidebar::-webkit-scrollbar-thumb, #content-display::-webkit-scrollbar-thumb { background: var(--border-color); border-radius: 4px; }\n#sidebar::-webkit-scrollbar-thumb:hover, #content-display::-webkit-scrollbar-thumb:hover { background: var(--secondary-color); }\n\n/* ---- ç§»åŠ¨ç«¯é®ç½©å±‚ ---- */\n#sidebar-overlay {\n    display: none;\n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    background-color: var(--container-bg-color);\n    z-index: 998; /* ä½äºä¾§è¾¹æ  */\n}\n\n/* ---- å“åº”å¼è®¾è®¡ï¼šæ‰‹æœºç«¯é€‚é… (å…³é”®éƒ¨åˆ†) ---- */\n@media (max-width: 768px) {\n            .action-button {\n \n            margin-right: 0;\n            margin-left: 0;\n          \n        }\n             #button-container-send {\n \n  gap:0.5rem;\n \n    }\n    .book-header {\n        padding: 10px 15px;\n    }\n\n    #content-title {\n        font-size: 1.2em; /* åœ¨ç§»åŠ¨ç«¯ç¼©å°æ ‡é¢˜å­—ä½“ */\n    }\n\n    #back-to-status-btn {\n        padding: 6px 10px;\n        font-size: 0.8em;\n    }\n\n    #toggle-sidebar-btn {\n        display: block; /* åœ¨ç§»åŠ¨ç«¯æ˜¾ç¤ºæ±‰å ¡åŒ…æŒ‰é’® */\n    }\n\n    #sidebar {\n        position: fixed; /* å›ºå®šå®šä½ï¼Œè„±ç¦»æ–‡æ¡£æµ */\n        top: 0;\n        left: 0;\n        height: 100%;\n        transform: translateX(-100%); /* é»˜è®¤éšè—åœ¨å·¦ä¾§ */\n        z-index: 999; /* ç¡®ä¿åœ¨æœ€ä¸Šå±‚ */\n        border-right: 1px solid var(--border-color);\n        box-shadow: 2px 0 15px rgba(0,0,0,0.5); /* æ·»åŠ é˜´å½±å¢åŠ å±‚æ¬¡æ„Ÿ */\n    }\n\n    /* å½“ä¾§è¾¹æ æ¿€æ´»æ—¶ */\n    .setting-book-container.sidebar-active #sidebar {\n        transform: translateX(0); /* æ»‘å…¥å±å¹• */\n    }\n\n    .setting-book-container.sidebar-active #sidebar-overlay {\n        display: block; /* æ˜¾ç¤ºé®ç½©å±‚ */\n    }\n\n    #content-display {\n        padding: 20px; /* è°ƒæ•´å†…è¾¹è· */\n    }\n}\n\n        /* Teammates Modal Specifics */\n        #teammates-modal .modal-content {\n            max-width: 95%; /* å¼¹çª—å¯ä»¥æ›´å®½ä¸€äº› */\n            width: 90%;\n        }\n\n        .teammates-container {\n            display: flex;\n            gap: 20px;\n            margin-top: 15px;\n            min-height: 300px;\n        }\n .teammates-container-init { display: none; margin-top: 1rem; padding: 1rem; background-color: rgba(26, 23, 32, 0.5); border-radius: 6px; border: 1px solid var(--border-color); }\n       \n        .teammate-list-wrapper {\n            flex: 1; /* å·¦ä¾§å 1ä»½ */\n            max-height: 350px;\n            overflow-y: auto;\n            background: rgba(0,0,0,0.2);\n            border: 1px solid var(--border-color);\n            border-radius: 6px;\n            padding: 5px;\n        }\n\n        .teammate-list {\n            list-style: none;\n            padding: 0;\n            margin: 0;\n        }\n\n        .teammate-item {\n            padding: 10px 15px;\n            border-bottom: 1px dashed var(--border-color);\n            cursor: pointer;\n            transition: background-color 0.2s;\n            font-size: 0.9em;\n        }\n\n        .teammate-item:last-child {\n            border-bottom: none;\n        }\n\n        .teammate-item:hover {\n            background-color: var(--border-color);\n        }\n\n        .teammate-item.selected {\n            background-color: var(--container-bg-color);\n            color: var(--primary-color);\n            font-weight: bold;\n        }\n\n        #decompose-from-select,#decompose-amount-input,#synthesize-to-select,#synthesize-amount-input,#upgrade-levels{\n            background-color: var(--container-bg-color);\n            color: var(--primary-color);\n\n        }\n\n        .teammate-info-display {\n            flex: 2; /* å³ä¾§å 2ä»½ */\n            background: var(--container-bg-color);\n            border-radius: 8px;\n            border: 1px solid var(--border-color);\n            padding: 20px;\n            max-height: 350px;\n            overflow-y: auto;\n            font-size: 0.9em;\n            line-height: 1.7;\n            white-space: pre-wrap; /* ä¿æŒæ¢è¡Œå’Œç©ºæ ¼ */\n        }\n\n        .teammate-info-display .info-entry {\n            margin-bottom: 15px;\n            border-bottom: 1px solid var(--border-color);\n            padding-bottom: 10px;\n        }\n\n        .collapsible-label {\n    cursor: pointer;\n    text-decoration: underline;\n    text-decoration-style: dotted;\n    text-decoration-color: var(--secondary-color);\n    user-select: none; /* é˜²æ­¢ç‚¹å‡»æ—¶é€‰ä¸­æ–‡æœ¬ */\n}\n\n.collapsible-label:hover {\n    color: var(--primary-color); /* é¼ æ ‡æ‚¬æµ®æ—¶å˜å¾—æ›´äº® */\n    text-shadow: 0 0 5px var(--glow-color);\n}\n\n        .teammate-info-display .info-entry:last-child {\n             border-bottom: none;\n             margin-bottom: 0;\n        }\n\n        .teammate-info-display .info-key {\n            color: var(--secondary-color);\n            font-weight: bold;\n        }\n\n        .teammate-info-display .info-value {\n            color: var(--text-color);\n            margin-top: 5px;\n            padding-left: 10px;\n        }\n\n        /* æ»šåŠ¨æ¡ç¾åŒ– */\n        .teammate-list-wrapper::-webkit-scrollbar, .teammate-info-display::-webkit-scrollbar { width: 6px; }\n        .teammate-list-wrapper::-webkit-scrollbar-track, .teammate-info-display::-webkit-scrollbar-track { background: rgba(0,0,0,0.2); }\n        .teammate-list-wrapper::-webkit-scrollbar-thumb, .teammate-info-display::-webkit-scrollbar-thumb { background: var(--border-color); border-radius: 3px; }\n\n\n        /* ======================================================= */\n/* ============= æ–°å¢ï¼šå•†åº—ç•Œé¢æ»‘åŠ¨é€»è¾‘ä¸ç¾åŒ– ============= */\n/* ======================================================= */\n\n/* ---- å•†åº—æ»‘åŠ¨å®¹å™¨ ---- */\n#shop-wrapper {\n    position: absolute;\n    \n    left: 0;\n    width: 100%;\n    height: 100%;\n    transform: translateX(100%);\n    overflow: hidden;\n    transition: transform 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);\n    /* ç»§æ‰¿ç»ˆç«¯å­—ä½“ï¼Œç¡®ä¿ä¸€è‡´æ€§ */\n    font-family: var(--base-font-family);\n    color: var(--text-color);\n    background-color: var(--container-bg-color); /* ä¸ç»ˆç«¯å®¹å™¨èƒŒæ™¯ä¸€è‡´ */\n    border: 1px solid var(--border-color);\n    border-radius: 8px;\n    box-shadow: 0 0 15px var(--glow-color), inset 0 0 10px var(--border-color);\n    backdrop-filter: blur(10px);\n    display: flex; /* ä½¿ç”¨flexå¸ƒå±€ */\n    flex-direction: column; /* å‚ç›´å¸ƒå±€ */\n}\n\n.status-container.slide-out-shop,\n#setting-book-wrapper.slide-out-shop {\n    transform: translateX(-100%);\n}\n\n#shop-wrapper.active {\n    transform: translateX(0);\n}\n\n\n/* ---- å•†åº—æ•´ä½“å¸ƒå±€ ---- */\n.shop-main-container {\n    display: flex;\n    flex-direction: column; /* å‚ç›´å¸ƒå±€ */\n    width: 100%;\n    height: 100%;\n    overflow: hidden; /* é˜²æ­¢å†…éƒ¨æ»šåŠ¨æ¡å½±å“æ•´ä½“ */\n}\n\n/* ---- å•†åº—å¤´éƒ¨ ---- */\n.shop-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    padding: 15px 25px;\n    background-color: var(--container-bg-color);\n    border-bottom: 1px solid var(--border-color);\n    flex-shrink: 0;\n}\n\n.shop-header .shop-title {\n    font-family: var(--base-font-family);\n    font-size: 1.5em;\n    color: var(--primary-color);\n    text-shadow: 0 0 5px var(--glow-color);\n    letter-spacing: 2px;\n    text-transform: uppercase;\n    margin: 0;\n    flex-grow: 1;\n    text-align: center;\n}\n.shop-header .shop-header-controls {\n    display: flex;\n    align-items: center;\n    gap: 15px;\n}\n\n#shop-search-input {\n    background-color: var(--container-bg-color);\n    border: 1px solid var(--border-color);\n    border-radius: 4px;\n    color: var(--text-color);\n    padding: 8px 12px;\n    font-family: var(--base-font-family);\n    font-size: 0.9em;\n    width: 250px; /* ä½ å¯ä»¥æ ¹æ®éœ€è¦è°ƒæ•´å®½åº¦ */\n    transition: all 0.3s ease;\n}\n\n#shop-search-input:focus {\n    outline: none;\n    border-color: var(--primary-color);\n    box-shadow: 0 0 8px var(--glow-color);\n}\n\n#shop-search-input::placeholder {\n    color: var(--text-secondary-color);\n    opacity: 0.7;\n}\n\n.control-btn,#back-from-shop-btn,#generate-items-btn ,#ten-gacha-btn,#single-gacha-btn,#submit-generation-btn,#skip-generation-btn,#gacha-confirm-btn{\n    background: none;\n    border: 1px solid var(--border-color);\n    border-radius: 6px;\n    color: var(--text-secondary-color);\n    padding: 8px;\n    font-size: 0.9em;\n    cursor: pointer;\n    transition: all 0.3s ease;\n}\n \n\n.control-btn:hover,#back-from-shop-btn:hover,#ten-gacha-btn:hover,#single-gacha-btn:hover,#generate-items-btn:hover,#gacha-confirm-btn:hover,#submit-generation-btn:hover,#skip-generation-btn:hover {\n    color: var(--primary-color);\n    background: var(--border-color);\n    box-shadow: 0 0 8px var(--glow-color);\n}\n\n.shop-body-wrapper {\n    display: flex;\n    flex-grow: 1;\n    overflow: hidden; /* é‡è¦ï¼šè®©å†…éƒ¨åˆ†åˆ«æ»šåŠ¨ */\n    padding: 20px;\n    gap: 20px;\n      min-height: 0; /* <-- è¿™æ˜¯å…³é”®çš„ä¿®å¤ï¼ */\n}\n\n\n/* ---- å•†åº—å·¦ä¾§æ ï¼šå¯¼èˆªä¸è´­ç‰©è½¦ ---- */\n.shop-sidebar {\n    width: 200px;\n    flex-shrink: 0;\n    display: flex;\n    flex-direction: column;\n    gap: 20px;\n}\n\n.shop-nav, .shop-cart {\n    background-color: rgba(0,0,0,0.2);\n    border: 1px solid var(--border-color);\n    border-radius: 6px;\n    padding: 15px;\n}\n\n.shop-sidebar h3 {\n    font-family: var(--base-font-family);\n    color: var(--secondary-color);\n    margin: 0 0 15px 0;\n    font-size: 1.2em;\n    text-shadow: 0 0 3px var(--glow-color);\n    border-bottom: 1px solid var(--border-color);\n    padding-bottom: 10px;\n}\n\n.shop-nav .shop-nav-list {\n    list-style: none;\n}\n\n.shop-nav .shop-nav-item {\n    background: none;\n    border: 1px solid transparent;\n    border-radius: 4px;\n    color: var(--text-secondary-color);\n    padding: 12px 15px;\n    font-size: 1em;\n    cursor: pointer;\n    transition: all 0.3s ease;\n    width: 100%;\n    margin-bottom: 10px;\n    text-align: left;\n}\n\n.shop-nav .shop-nav-item:hover {\n    color: var(--primary-color);\n    background-color: var(--border-color);\n    border-color: var(--border-color);\n}\n\n.shop-nav .shop-nav-item.active {\n    color: var(--primary-color);\n    background-color: var(--border-color);\n    text-shadow: 0 0 5px var(--glow-color);\n    font-weight: bold;\n}\n\n.shop-cart {\n    flex-grow: 1; /* å æ®å‰©ä½™ç©ºé—´ */\n    display: flex;\n    flex-direction: column;\n    min-height: 0;  \n    overflow-y: auto;/* æ–°å¢ï¼šé™åˆ¶å®¹å™¨ï¼Œè®©å†…éƒ¨çš„flex-growç”Ÿæ•ˆå¹¶è§¦å‘æ»šåŠ¨ */\n}\n\n#cart-items-list {\n    flex-grow: 1;\n    overflow-y: auto;\n    padding-right: 5px; /* for scrollbar */\n    margin-bottom: 15px;\n    color: var(--text-secondary-color);\n}\n\n.cart-item {\n    padding-bottom: 8px;\n    margin-bottom: 8px;\n    border-bottom: 1px dashed var(--border-color);\n    font-size: 0.9em;\n}\n\n#cart-total {\n    font-size: 1.1em;\n    color: var(--primary-color);\n    font-weight: bold;\n    margin-bottom: 15px;\n    text-align: right;\n}\n\n#checkout-button {\n    /* å¤ç”¨ç»ˆç«¯æŒ‰é’®æ ·å¼ */\n    background: linear-gradient(45deg, var(--border-color), var(--border-color));\n    border: 1px solid var(--border-color);\n    border-radius: 6px;\n    color: var(--text-color);\n    padding: 12px 24px;\n    font-size: 1em;\n    cursor: pointer;\n    transition: all 0.3s ease;\n    width: 100%;\n}\n\n#checkout-button:hover:not(:disabled) {\n    color: var(--primary-color);\n    box-shadow: 0 0 10px var(--glow-color);\n    transform: translateY(-2px);\n}\n#checkout-button:disabled {\n    cursor: not-allowed;\n    background: rgba(128, 128, 128, 0.2);\n    color: var(--text-secondary-color);\n    transform: none;\n    box-shadow: none;\n    border-color: rgba(128, 128, 128, 0.4);\n}\n\n\n/* ---- å•†åº—å³ä¾§å†…å®¹åŒº ---- */\n.shop-content-area {\n    flex-grow: 1;\n    display: flex;\n    flex-direction: column;\n    overflow: hidden; /* é‡è¦ */\n    background-color: rgba(0,0,0,0.2);\n    border: 1px solid var(--border-color);\n    border-radius: 6px;\n    padding: 20px;\n     min-height: 0; /* <-- è¿™é‡Œä¹ŸåŠ ä¸Šï¼ */\n}\n\n.shop-page {\n    display: none;\n    height: 100%;\n    flex-direction: column;\n}\n.shop-page.active {\n    display: flex;\n}\n\n.shop-controls {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    flex-wrap: wrap;\n    gap: 15px;\n    margin-bottom: 20px;\n    flex-shrink: 0;\n}\n\n.shop-controls .category-tabs, .shop-controls .sort-controls {\n    display: flex;\n    gap: 1px;\n}\n\n.shop-controls .control-btn,#confirm-upgrade-btn {\n    background: none;\n    border: 1px solid var(--border-color);\n    color: var(--text-secondary-color);\n    padding: 8px 18px;\n    border-radius: 4px;\n    cursor: pointer;\n    transition: all 0.3s ease;\n}\n.shop-controls .control-btn:hover {\n    color: var(--primary-color);\n    background-color:var(--border-color);\n}\n.shop-controls .control-btn.active {\n    color: var(--primary-color);\n    background-color: var(--background-color);\n    box-shadow: 0 0 5px var(--glow-color);\n}\n\n.shop-display-wrapper {\n    flex-grow: 1;\n    display: flex;\n    gap: 20px;\n    overflow: hidden; /* é‡è¦ */\n}\n\n /* ä¿®æ”¹å•†å“åˆ—è¡¨å’Œè¯¦æƒ…çš„IDé€‰æ‹©å™¨ä»¥åŒ¹é…JS */\n#items-display-list-fixed, #items-display-list-random {\n    flex: 2 1 60%; /* flex-grow, flex-shrink, flex-basis. åŸºç¡€å®½åº¦60% */\n    min-width: 0; /* é˜²æ­¢å†…å®¹æ’‘ç ´å®¹å™¨ */\n    overflow-y: auto;\n    padding-right: 10px;\n}\n#item-details-display-fixed, #item-details-display-random {\n    flex: 1 1 40%; /* åŸºç¡€å®½åº¦40% */\n    min-width: 0; /* é˜²æ­¢å†…å®¹æ’‘ç ´å®¹å™¨ */\n    padding: 15px;\n    border-left: 1px solid var(--border-color);\n    overflow-y: auto;\n    color: var(--text-secondary-color);\n}\n\n.item-row {\n    display: grid;\n    grid-template-columns: 1fr auto auto;\n    gap: 15px;\n    align-items: center;\n    padding: 12px;\n    background-color: var(--border-color);\n    border: 1px solid transparent;\n    border-radius: 4px;\n    margin-bottom: 10px;\n    cursor: pointer;\n    transition: all 0.3s ease;\n}\n.item-row:hover {\n    border-color: var(--border-color);\n    background-color: var(--border-color);\n}\n.item-row.selected {\n    border-color: var(--primary-color);\n    background-color: var(--border-color);\n    box-shadow: 0 0 8px var(--glow-color);\n}\n.item-name {\n    font-weight: bold;\n    color: var(--text-color);\n}\n.item-price {\n    color: var(--secondary-color);\n    font-weight: bold;\n}\n\n\n\n.buy-button,.page-button {\n    background: transparent;\n    border: 1px solid var(--primary-color);\n    color: var(--primary-color);\n    padding: 6px 12px;\n    border-radius: 4px;\n    cursor: pointer;\n    transition: all 0.3s ease;\n}\n.buy-button:hover:not(:disabled),.page-button:hover:not(:disabled) {\n    background: var(--primary-color);\n    color: var(--background-color);\n    box-shadow: 0 0 8px var(--glow-color);\n}\n.buy-button:disabled,.page-button:disabled {\n    border-color: var(--text-secondary-color);\n    color: var(--text-secondary-color);\n    cursor: not-allowed;\n    opacity: 0.6;\n}\n\n\n\n \n.detail-placeholder {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    height: 100%;\n    font-style: italic;\n}\n.detail-title {\n    font-size: 1.4em;\n    color: var(--primary-color);\n    margin-bottom: 15px;\n    text-shadow: 0 0 3px var(--glow-color);\n}\n.detail-info { margin-bottom: 15px; line-height: 1.6; }\n.detail-label {\n    color: var(--text-color);\n    font-weight: bold;\n    margin-bottom: 5px;\n    display: block;\n}\n\n/* åˆ†é¡µ */\n.shop-pagination {\n    flex-shrink: 0;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    margin-top: 20px;\n    gap: 10px;\n}\n\n/* ---- å•†åº—æ¨¡æ€æ¡† ---- */\n#shop-modal {\n \n    /* å¤ç”¨ç»ˆç«¯çš„å¼¹çª—æ ·å¼ */\n}\n#shop-modal .modal-content {\n    /* å¦‚æœéœ€è¦ç‰¹åˆ«å®šåˆ¶ */\n}\n\n/* æ»šåŠ¨æ¡ç¾åŒ– */\n.shop-sidebar::-webkit-scrollbar,\n#cart-items-list::-webkit-scrollbar,\n#items-display-list::-webkit-scrollbar,\n#item-details-display::-webkit-scrollbar,\n.content-area::-webkit-scrollbar {\n    width: 6px;\n}\n.shop-sidebar::-webkit-scrollbar-track,\n#cart-items-list::-webkit-scrollbar-track,\n#items-display-list::-webkit-scrollbar-track,\n#item-details-display::-webkit-scrollbar-track,\n.content-area::-webkit-scrollbar-track {\n    background: rgba(0,0,0,0.2);\n}\n.shop-sidebar::-webkit-scrollbar-thumb,\n#cart-items-list::-webkit-scrollbar-thumb,\n#items-display-list::-webkit-scrollbar-thumb,\n#item-details-display::-webkit-scrollbar-thumb,\n.content-area::-webkit-scrollbar-thumb {\n    background-color: var(--border-color);\n    border-radius: 3px;\n}\n\n   @media (max-width: 768px) {\n        .shop-body-wrapper {\n            flex-direction: column; /* å‚ç›´æ’åˆ— */\n            padding: 10px;\n            gap: 10px;\n        }\n\n        .shop-sidebar {\n            width: 100%; /* å®½åº¦å æ»¡ */\n            flex-direction: row; /* è®©å¯¼èˆªå’Œè´­ç‰©è½¦æ°´å¹³æ’åˆ— */\n            gap: 10px;\n             height: 15vh; /* æ–°å¢ï¼šç»™ä¾§è¾¹æ ä¸€ä¸ªå›ºå®šçš„é«˜åº¦ */\n        }\n\n        .shop-title{\n            display: none;\n        }\n\n        .shop-nav, .shop-cart {\n            flex: 1; /* å¹³åˆ†ç©ºé—´ */\ndisplay: flex; /* æ–°å¢ï¼šè®©å®ƒæˆä¸ºä¸€ä¸ªflexå®¹å™¨ï¼Œä¸ºäº†æ›´å¥½åœ°æ§åˆ¶å…¶å†…éƒ¨ */\n    flex-direction: column; /* æ–°å¢ï¼šè®©å…¶å†…éƒ¨ï¼ˆæ¯”å¦‚æ ‡é¢˜å’Œåˆ—è¡¨ï¼‰å‚ç›´æ’åˆ— */\n    overflow-y: auto; /* æ–°å¢ï¼šè¿™æ˜¯å…³é”®ï¼è®©å®ƒåœ¨å‚ç›´æ–¹å‘å†…å®¹æº¢å‡ºæ—¶å‡ºç°æ»šåŠ¨æ¡ */\n    min-height: 0; /* æ–°å¢ï¼šä¸€ä¸ªflexå¸ƒå±€çš„å°æŠ€å·§ï¼Œç¡®ä¿å®ƒèƒ½è¢«æ­£ç¡®çº¦æŸ */\n        }\n\n        .shop-display-wrapper {\n            flex-direction: row; /* å•†å“åˆ—è¡¨å’Œè¯¦æƒ…ä¹Ÿå‚ç›´æ’åˆ— */\n             height: 400px; /* ç»™ä¸€ä¸ªå›ºå®šé«˜åº¦é˜²æ­¢æ— é™å»¶ä¼¸ */\n        }\n\n        #item-details-display-fixed, #item-details-display-random {\n            border-left: none; /* ç§»é™¤å·¦è¾¹æ¡† */\n            border-top: 1px solid var(--border-color); /* æ”¹ä¸ºä¸Šè¾¹æ¡† */\n            padding-top: 15px;\n        }\n\n        .shop-controls {\n            flex-direction: column;\n            align-items: stretch; /* è®©æŒ‰é’®æ’‘æ»¡å®½åº¦ */\n        }\n\n        .shop-controls .control-btn {\n            text-align: center;\n        }\n\n            /* åœ¨è¿™é‡Œæ·»åŠ ä¸‹é¢çš„æ–°CSSè§„åˆ™ */\n    .shop-controls .category-tabs, .shop-controls .sort-controls {\n        flex-wrap: wrap;       /* å…è®¸æŒ‰é’®æ¢è¡Œ */\n        justify-content: center; /* æ¢è¡Œåå±…ä¸­å¯¹é½ */\n    }\n    }\n\n    /* ======================================================= */\n/* =========== æ–°çš„è§’è‰²çŠ¶æ€é¡µ (Page 3) æ ·å¼ =========== */\n/* ======================================================= */\n\n#page-character {\n    /* min-height: 800px; ç¡®ä¿æœ‰è¶³å¤Ÿç©ºé—´å±•ç¤º */\n}\n\n.character-display-grid {\n    display: grid;\n    grid-template-columns: 250px 1fr 280px;\n    gap: 20px;\n    width: 100%;\n    height: 100%;\n    font-size: 14px;\n}\n\n.char-panel {\n    background: rgba(0,0,0,0.2);\n    border: 1px solid var(--border-color);\n    border-radius: 6px;\n    /* padding: 15px; */\n    display: flex;\n    flex-direction: column;\n}\n\n/* --- å·¦ä¾§é¢æ¿ --- */\n.left-panel {\n    gap: 15px;\n    max-height: 500px;\n    overflow-y:auto;\n}\n\n.char-name-display {\n    font-family: var(--base-font-family);\n    color: var(--primary-color);\n    font-size: 1.8em;\n    text-align: center;\n    text-shadow: 0 0 8px var(--glow-color);\n    padding-bottom: 10px;\n    border-bottom: 1px solid var(--border-color);\n}\n\n.char-info-box {\n    display: flex;\n    flex-direction: column;\n    gap: 10px;\n}\n\n.info-line {\n    display: flex;\n    justify-content: space-between;\n    padding: 5px;\n    border-radius: 3px;\n    transition: background-color 0.2s;\n}\n.info-line:hover {\n    background-color: var(--border-color);\n}\n.info-label {\n    color: var(--text-secondary-color);\n}\n.info-value {\n    color: var(--text-color);\n    font-weight: bold;\n}\n\n.resource-bar-container {\n    margin-top: 5px;\n}\n.resource-bar-label {\n    font-size: 0.9em;\n    color: var(--text-secondary-color);\n    margin-bottom: 5px;\n}\n.progress-bar-bg.resource {\n    position: relative;\n    height: 22px;\n}\n.progress-bar-text {\n    position: absolute;\n    left: 50%;\n    top: 50%;\n    transform: translate(-50%, -50%);\n    font-size: 0.8em;\n    color: #fff;\n    text-shadow: 1px 1px 2px rgba(0,0,0,0.7);\n    z-index: 2;\n}\n\n.progress-bar-fill.hp { background: linear-gradient(90deg, var(--secondary-color), var(--primary-color)); }\n.progress-bar-fill.willpower { background: linear-gradient(90deg, var(--primary-color), var(--text-color)); }\n.progress-bar-fill.energy { background: linear-gradient(90deg, var(--secondary-color), var(--text-secondary-color)); }\n\n.progress-bar-fill.generic-resource { background: linear-gradient(90deg, var(--secondary-color), var(--primary-color)); }\n\n/* --- ä¸­é—´é¢æ¿ï¼šäººå½¢ --- */\n.center-panel {\n    justify-content: center;\n    align-items: center;\n}\n\n.character-figure {\n    position: relative;\n    width: 100px;\n    height: 250px;\n}\n\n.body-part {\n    position: absolute;\n    background-color: transparent;\n    border: 2px solid var(--secondary-color);\n    box-shadow: 0 0 5px var(--glow-color);\n}\n.head { width: 40px; height: 40px; border-radius: 50%; top: 0; left: 30px; }\n.torso { width: 60px; height: 90px; top: 45px; left: 20px; border-radius: 10px; }\n.arm { width: 15px; height: 80px; top: 55px; border-radius: 5px; }\n.arm.left { left: 0px; }\n.arm.right { right: 0px; }\n.leg { width: 20px; height: 110px; top: 140px; border-radius: 5px;}\n.leg.left { left: 20px; }\n.leg.right { right: 20px; }\n\n/* è£…å¤‡æ§½ä¸å¼•å‡ºçº¿ */\n.equipment-slot {\n    position: absolute;\n    color: var(--text-secondary-color);\n    /* background: rgba(10, 25, 47, 0.8); */\n    border: 1px solid var(--border-color);\n    padding: 4px 8px;\n    font-size: 0.85em;\n    border-radius: 4px;\n    white-space: nowrap;\n    cursor: pointer;\n}\n.equipment-slot:hover {\n    color: var(--primary-color);\n    box-shadow: 0 0 5px var(--glow-color);\n}\n\n.slot-head { top: -25px; left: 50%; transform: translateX(-50%); }\n.slot-body { top: 75px; left: 20px; }\n.slot-hands { top: 100px; right: -70px; }\n.slot-feet { bottom: -15px; left: -30px; }\n.slot-accessory { top: 30px; right: -40px; }\n.slot-weapon { top: 150px; left: -60px; }\n\n \n \n\n.attr-category-title, .skill-category-title {\n    color: var(--primary-color);\n    font-family: var(--base-font-family);\n    border-bottom: 1px solid var(--border-color);\n    padding-bottom: 5px;\n    margin-bottom: 10px;\n    font-size: 1.1em;\n}\n\n.attr-item {\n    display: flex;\n    justify-content: space-between;\n    margin-bottom: 8px;\n    padding: 2px 4px;\n    cursor: help;\n    border-radius: 3px;\n    transition: background-color 0.2s;\n}\n.attr-item:hover {\n    background-color: var(--border-color);\n}\n\n.attr-name, .skill-name {\n    color: var(--text-secondary-color);\n}\n.attr-value, .skill-value {\n    color: var(--text-color);\n    font-weight: bold;\n}\n.legendary-value {\n    color: var(--secondary-color); /* é‡‘è‰²ï¼Œè¡¨ç¤ºä¼ å¥‡ */\n}\n.status-modifier{\n    color: var(--text-secondary-color); /* é‡‘è‰²ï¼Œè¡¨ç¤ºä¼ å¥‡ */\n}\n\n.skill-item {\n     display: flex;\n    justify-content: space-between;\n    margin-bottom: 6px;\n    padding: 2px 4px;\n    cursor: help;\n    border-radius: 3px;\n    transition: background-color 0.2s;\n}\n.skill-item:hover {\n     background-color: var(--border-color);\n}\n\n/* --- Tooltip --- */\n.char-tooltip {\n    position: fixed;\n    background: linear-gradient(135deg, var(--container-bg-color), var(--primary-color));\n    border: 1px solid var(--primary-color);\n    border-radius: 6px;\n    padding: 10px 15px;\n    max-width: 250px;\n    font-size: 0.9em;\n    line-height: 1.5;\n    color: var(--text-color);\n    z-index: 1001;\n    pointer-events: none;\n    opacity: 0;\n    visibility: hidden;\n    transition: opacity 0.2s;\n    box-shadow: 0 0 10px var(--glow-color);\n}\n\n/* å“åº”å¼è°ƒæ•´ */\n@media (max-width: 768px) {\n    .character-display-grid {\n        grid-template-columns: 1fr;\n        font-size: 12px;\n    }\n    .center-panel {\n        order: -1; /* å°†äººå½¢å›¾ç½®é¡¶ */\n        /* display:none; */\n        /* min-height: 300px; */\n    }\n    .slot-body { left: -70px; }\n    .slot-hands { right: -70px; }\n    .slot-weapon { left: -100px; }\n}\n\n/* æ»šåŠ¨æ¡ç¾åŒ– */\n.right-panel::-webkit-scrollbar, /* æ–°å¢å¯¹ right-panel çš„ç¾åŒ– */\n.attributes-container::-webkit-scrollbar,\n.selection-area::-webkit-scrollbar,\n.skill-choice-container::-webkit-scrollbar,\n.items-display-list::-webkit-scrollbar,\n.item-details-display::-webkit-scrollbar,\n.book-display-area::-webkit-scrollbar,\n.shop-sidebar::-webkit-scrollbar,\n.shop-nav::-webkit-scrollbar,\n.shop-cart::-webkit-scrollbar,\n.modal-description::-webkit-scrollbar,\n.skills-container::-webkit-scrollbar { width: 6px; }\n\n\n.right-panel::-webkit-scrollbar-track, /* æ–°å¢å¯¹ right-panel çš„ç¾åŒ– */\n.attributes-container::-webkit-scrollbar-track,\n.selection-area::-webkit-scrollbar-track,\n.skill-choice-container::-webkit-scrollbar-track,\n.items-display-list::-webkit-scrollbar-track,\n.item-details-display::-webkit-scrollbar-track,\n.book-display-area::-webkit-scrollbar-track,\n.shop-sidebar::-webkit-scrollbar-track,\n.shop-nav::-webkit-scrollbar-track,\n.shop-cart::-webkit-scrollbar-track,\n.modal-description::-webkit-scrollbar-track,\n.skills-container::-webkit-scrollbar-track { background: rgba(0,0,0,0.2); }\n\n.right-panel::-webkit-scrollbar-thumb, /* æ–°å¢å¯¹ right-panel çš„ç¾åŒ– */\n.attributes-container::-webkit-scrollbar-thumb,\n.selection-area::-webkit-scrollbar-thumb,\n.skill-choice-container::-webkit-scrollbar-thumb,\n.items-display-list::-webkit-scrollbar-thumb,\n.item-details-display::-webkit-scrollbar-thumb,\n.book-display-area::-webkit-scrollbar-thumb,\n.shop-sidebar::-webkit-scrollbar-thumb,\n.shop-nav::-webkit-scrollbar-thumb,\n.shop-cart::-webkit-scrollbar-thumb,\n.modal-description::-webkit-scrollbar-thumb,\n.skills-container::-webkit-scrollbar-thumb { background-color: var(--border-color); border-radius: 3px; }\n\n/* ======================================================== */\n/* =========== æŠ˜å /å±•å¼€é¢æ¿çš„é¢å¤–æ ·å¼ ============ */\n/* ======================================================== */\n\n.attr-category, .skill-category {\n    margin-bottom: 5px;\n}\n\n.attr-category-title, .skill-category-title {\n    cursor: pointer;\n    position: relative;\n    padding-left: 18px; /* ä¸ºç®­å¤´ç•™å‡ºç©ºé—´ */\n    transition: background-color 0.2s;\n    user-select: none; /* é˜²æ­¢åŒå‡»é€‰ä¸­æ–‡æœ¬ */\n}\n\n/* æ ‡é¢˜å‰çš„ç®­å¤´ç¬¦å· */\n.attr-category-title::before, .skill-category-title::before {\n    content: 'â–¶'; /* ç®­å¤´ */\n    position: absolute;\n    left: 0;\n    top: 50%;\n    transform: translateY(-50%);\n    font-size: 0.8em;\n    color: var(--secondary-color);\n    transition: transform 0.2s ease-in-out;\n}\n\n.attr-category-title:hover, .skill-category-title:hover {\n    background-color: var(--border-color)\n}\n\n/* åŒ…å«æ¡ç›®çš„åŒ…è£¹å±‚ */\n.attr-items-wrapper, .skill-items-wrapper {\n    max-height: 0;\n    overflow: hidden;\n    transition: max-height 0.3s ease-in-out;\n    padding-left: 10px; /* å±•å¼€åå†…å®¹æœ‰ç¼©è¿› */\n    border-left: 1px solid var(--border-color);\n    margin-left: 5px;\n    margin-top: 5px;\n}\n\n/* å±•å¼€çŠ¶æ€ */\n.attr-category.expanded .attr-category-title::before,\n.skill-category.expanded .skill-category-title::before {\n    transform: translateY(-50%) rotate(90deg); /* ç®­å¤´æ—‹è½¬ */\n}\n\n.attr-category.expanded .attr-items-wrapper,\n.skill-category.expanded .skill-items-wrapper {\n    max-height: 1800px; /* ä¸€ä¸ªè¶³å¤Ÿå¤§çš„å€¼ï¼Œç¡®ä¿æ‰€æœ‰å†…å®¹éƒ½èƒ½æ˜¾ç¤º */\n}\n/* --- å³ä¾§é¢æ¿ --- */\n.right-panel {\n    gap: 15px;\n    display: flex; /* ç¡®ä¿ä½¿ç”¨flexå¸ƒå±€ */\n    flex-direction: column; /* å‚ç›´æ’åˆ—å­å…ƒç´  */\n max-height: 500px;\n    overflow-y: auto; /* ä¿®æ”¹è¿™é‡Œï¼Œå…è®¸å‚ç›´æ–¹å‘æ»šåŠ¨ */\n    padding-right: 5px; /* ä¸ºæ»šåŠ¨æ¡ç•™å‡ºä¸€ç‚¹ç©ºé—´ï¼Œæ›´ç¾è§‚ */\n}\n\n \n\n/* æˆ‘ä»¬ä¸ºè¡ç”Ÿå±æ€§ä¹ŸåŠ ä¸ŠåŒæ ·çš„è§„åˆ™ï¼Œç¡®ä¿å®ƒä¹Ÿèƒ½æ»šåŠ¨ */\n#derived-attributes-display-container {\n     overflow-y: auto;\n     padding-right: 5px;\n}\n\n\n/* ä»£ç  START: æ·»åŠ åœ¨è¿™é‡Œ */\n.roll-section {\n    border: 1px solid var(--border-color);\n    border-radius: 6px;\n    padding: 15px;\n    margin-bottom: 15px;\n    \n    box-shadow: inset 0 0 10px var(--border-color)\n}\n\n.roll-section-title {\n    color: var(--primary-color);\n    font-weight: bold;\n    font-size: 1.1em;\n    margin-bottom: 10px;\n    border-bottom: 1px solid var(--border-color);\n    padding-bottom: 8px;\n    font-family: var(--base-font-family);\n}\n\n.roll-details-list {\n    list-style: none;\n    padding: 0;\n}\n\n.roll-details-list li {\n    padding: 6px 0;\n    display: flex;\n    flex-wrap: wrap;\n    justify-content: space-between;\n    border-bottom: 1px dashed var(--border-color)\n}\n\n.roll-details-list li:last-child {\n    border-bottom: none;\n}\n\n.roll-details-list .label {\n    color: var(--text-secondary-color);\n    margin-right: 15px;\n}\n\n.roll-details-list .value {\n    color: var(--text-color);\n    text-align: right;\n    flex-grow: 1;\n}\n\n.roll-outcome {\n    color: var(--secondary-color);\n    font-weight: bold;\n}\n\n.roll-dramatic-failure {\n    color: var(--danger-color);\n    font-weight: bold;\n    text-shadow: 0 0 5px var(--danger-glow-color);\n}\n\n\n\n \n\n@keyframes orb-flow {\n    0% { background-position: 0% 50%; }\n    50% { background-position: 100% 50%; }\n    100% { background-position: 0% 50%; }\n}\n\n/* ä¹¦ç±å¼¹çª—ä¸»ä½“ */\n#world-book-modal .book-content {\n    background-color: var(--container-bg-color); /* ç¾Šçš®çº¸é¢œè‰² */\n    color: var(--text-color);\n    width: 90%;\n    \n    height: 80vh;\n    max-height: 800px;\n    display: flex;\n    border-radius: 10px;\n    box-shadow: 0 10px 30px var(--container-bg-color), inset 0 0 15px var(--container-bg-color);\n    font-family: var(--base-font-family);\n    position: relative;\n    border: 3px solid var(--background-color);\n    border-left: 20px solid var(--background-color); /* ä¹¦è„Š */\n}\n\n/* ä¹¦ç±å…³é—­æŒ‰é’® */\n.book-close-btn {\n    position: absolute;\n    top: 5px;\n    right: 10px;\n    font-size: 28px;\n    color: var(--text-secondary-color);\n}\n.book-close-btn:hover {\n     color: var(--primary-color);\n}\n\n\n/* å·¦é¡µ - ä¹¦ç­¾åŒº */\n.book-left-page {\n    flex-basis: 150px;\n    border-right: 2px dashed var(--background-color);\n    padding: 20px 0;\n    position: relative;\n    display: flex;\n    justify-content: center;\n    align-items: flex-start;\n}\n\n.book-bookmarks {\n    position: absolute;\n    top: 30px;\n    left: 20px; /* ä»ä¹¦è„Šå¤„ä¼¸å‡º */\n    display: flex;\n    flex-direction: column;\n}\n\n.bookmark {\n    background-color: var(--border-color);\n    color: var(--container-bg-color);\n    padding: 8px 30px 8px 15px;\n    margin-bottom: 10px;\n    cursor: pointer;\n    border-radius: 0 5px 5px 0;\n    box-shadow: 2px 2px 5px rgba(0,0,0,0.2);\n    transition: all 0.2s ease;\n    clip-path: polygon(0 0, 100% 0, 85% 50%, 100% 100%, 0 100%);\n}\n\n.bookmark:hover {\n    background-color: var(--border-color);\n    padding-left: 20px;\n}\n\n.bookmark.active {\n    background-color: var(--primary-color); color: var(--background-color);\n    font-weight: bold;\n    padding-left: 15px;\n    box-shadow: 4px 4px 8px rgba(0,0,0,0.3);\n}\n\n\n/* å³é¡µ - å†…å®¹åŒº */\n.book-right-page {\n    flex: 1;\n    display: flex;\n    flex-direction: column;\n    padding: 20px 30px;\n    overflow: hidden;\n}\n\n.book-display-area {\n    height: 100%;\n    overflow-y: auto;\n    padding-right: 15px; /* for scrollbar */\n}\n\n.book-entry {\n    border-bottom: 1px_dotted var(--background-color);\n    padding: 10px 0;\n    margin-bottom: 5px;\n}\n\n.book-entry-key {\n    font-weight: bold;\n    color: var(--secondary-color);\n    display: block;\n    margin-bottom: 5px;\n}\n\n.book-entry-value {\n    font-size: 0.9em;\n    line-height: 1.5;\n    white-space: pre-wrap; /* ä¿ç•™æ¢è¡Œå’Œç©ºæ ¼ */\n    word-wrap: break-word; /* è‡ªåŠ¨æ¢è¡Œ */\n}\n\n/* ç¿»é¡µ */\n.book-pagination {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    padding-top: 10px;\n    border-top: 1px solid var(--background-color);\n    margin-top: auto; /* æ¨åˆ°åº•éƒ¨ */\n}\n\n.page-turn-btn {\n    background: none;\n    border: none;\n    font-size: 30px;\n    color: var(--text-secondary-color);\n    cursor: pointer;\n    padding: 0 20px;\n}\n.page-turn-btn:hover:not(:disabled) {\n    color: var(--text-color);\n}\n.page-turn-btn:disabled {\n    color: #d1c6b2;\n    cursor: not-allowed;\n}\n\n\n/* ================================================== */\n/* ========== æ–°å¢ï¼šä¸–ç•Œä¹‹ä¹¦å“åº”å¼æ ·å¼ (æ‰‹æœºç«¯) ========== */\n/* ================================================== */\n\n@media (max-width: 768px) {\n\n    /* å½“å±å¹•å®½åº¦å°äº768pxæ—¶ï¼Œåº”ç”¨ä»¥ä¸‹æ ·å¼ */\n\n    /* è®©ä¹¦æœ¬å†…å®¹å‚ç›´æ’åˆ— */\n    #world-book-modal .book-content {\n        flex-direction: column;\n        height: 85vh; /* åœ¨æ‰‹æœºä¸Šå¯ä»¥æ›´é«˜ä¸€äº› */\n        max-height: 800px;\n        border-left: 3px solid var(--background-color); /* ç§»é™¤åšä¹¦è„Š */\n        width: 95%;\n    }\n\n    /* è°ƒæ•´åŸå·¦é¡µï¼ˆç°åœ¨æ˜¯é¡¶éƒ¨ï¼‰çš„æ ·å¼ */\n    .book-left-page {\n        flex-basis: auto; /* é«˜åº¦è‡ªåŠ¨ */\n        border-right: none; /* ç§»é™¤å³è¾¹æ¡† */\n        border-bottom: 2px solid var(--border-color); /* æ·»åŠ ä¸‹è¾¹æ¡†ä½œä¸ºåˆ†å‰²çº¿ */\n        padding: 5px 10px; /* è°ƒæ•´å†…è¾¹è· */\n        justify-content: flex-start; /* âœ… æ”¹ä¸ºå·¦å¯¹é½ */\n        height: auto;\n    }\n\n    /* è®©ä¹¦ç­¾æ°´å¹³æ’åˆ— */\n    .book-bookmarks {\n        position: static; /* ç§»é™¤ç»å¯¹å®šä½ */\n        flex-direction: row; /* æ°´å¹³æ’åˆ— */\n        justify-content: flex-start; /* âœ… æ”¹ä¸ºå·¦å¯¹é½ */\n        width: 100%;\n            padding-left: 0; /* âœ… ç§»é™¤äººä¸ºåç§» */\n    }\n\n    /* è°ƒæ•´å•ä¸ªä¹¦ç­¾çš„æ ·å¼ï¼Œè®©å®ƒçœ‹èµ·æ¥åƒé¡¶éƒ¨çš„æ ‡ç­¾ */\n    .bookmark {\n        margin: 0 5px; /* è®¾ç½®æ°´å¹³é—´è· */\n        margin-bottom: 0;\n        border-radius: 5px 5px 0 0; /* åœ†è§’åªåœ¨é¡¶éƒ¨ */\n        padding: 8px 15px; /* ç»Ÿä¸€å†…è¾¹è· */\n        clip-path: none; /* ç§»é™¤ç®­å¤´å½¢çŠ¶ */\n        box-shadow: 0 -2px 5px rgba(0,0,0,0.1);\n    }\n\n    .bookmark:hover {\n        padding-left: 15px; /* ç§»é™¤æ‚¬æµ®æ—¶çš„ç‰¹æ®Šå†…è¾¹è· */\n        transform: translateY(-2px); /* æ‚¬æµ®æ—¶è½»å¾®ä¸Šç§» */\n    }\n\n    .bookmark.active {\n        padding-left: 15px; /* ç§»é™¤æ¿€æ´»æ—¶çš„ç‰¹æ®Šå†…è¾¹è· */\n        background-color: var(--container-bg-color); /* æ¿€æ´»æ—¶ä¸é¡µé¢åŒè‰² */\n        color: var(--secondary-color); /* æ”¹å˜æ–‡å­—é¢œè‰² */\n        border: 2px solid var(--border-color);\n        border-bottom: none; /* åº•éƒ¨æ— è¾¹æ¡†ï¼Œä¸å†…å®¹åŒºèä¸ºä¸€ä½“ */\n        transform: translateY(2px); /* å‘ä¸‹ç§»åŠ¨ï¼Œä¸åˆ†å‰²çº¿é‡åˆ */\n    }\n\n    /* è°ƒæ•´å³é¡µï¼ˆç°åœ¨æ˜¯ä¸‹éƒ¨å†…å®¹åŒºï¼‰çš„æ ·å¼ */\n    .book-right-page {\n        padding: 15px;\n        flex-grow: 1; /* å æ®å‰©ä½™æ‰€æœ‰ç©ºé—´ */\n    }\n\n    /* è°ƒæ•´æµ®åŠ¨å°çƒçš„ä½ç½®ï¼Œé¿å…ä¸å†…å®¹é‡å  */\n    /* #world-book-orb {\n        bottom: 10px;\n        right: 10px;\n    } */\n}\n\n   /* ---- æ–°å¢ï¼šå¤´éƒ¨å’Œä¸»é¢˜åˆ‡æ¢å™¨æ ·å¼ ---- */\n       header .header-content {\n            \n            justify-content: center;\n            align-items: center;\n            position: relative;\n        }\n\n        #settings-btn{\n            position: absolute;\n            right: 60px; /* æŠŠå®ƒæ”¾åœ¨æ ‡é¢˜æ çš„å³è¾¹ */\n              font-size: 35px;\n            transform: translateY(-50%);\n            background: none;\n            border: none;\n            color: var(--text-secondary-color);\n            cursor: pointer;\n            padding: 5px;\n            border-radius: 50%;\n            transition: color 0.3s, transform 0.3s ease;\n            top:10%;\n        }\n        #fullscreen-btn{\n            position: absolute;\n            right: 110px; /* æŠŠå®ƒæ”¾åœ¨æ ‡é¢˜æ çš„å³è¾¹ */\n              font-size: 35px;\n            transform: translateY(-50%);\n            background: none;\n            border: none;\n            color: var(--text-secondary-color);\n            cursor: pointer;\n            padding: 5px;\n            border-radius: 50%;\n            transition: color 0.3s, transform 0.3s ease;\n            top:10%;\n        }\n        #refresh-btn{\nposition: absolute;\n            right: 10px; /* æŠŠå®ƒæ”¾åœ¨æ ‡é¢˜æ çš„å³è¾¹ */\n              font-size: 35px;\n            transform: translateY(-50%);\n            background: none;\n            border: none;\n            color: var(--text-secondary-color);\n            cursor: pointer;\n            padding: 5px;\n            border-radius: 50%;\n            transition: color 0.3s, transform 0.3s ease;\n            top:10%;\n        }\n\n        #settings-btn:hover,#refresh-btn:hover,#fullscreen-btn:hover {\n            color: var(--primary-color);\n            transform: translateY(-50%) rotate(90deg); /* æ‚¬æµ®æ—¶æ—‹è½¬ï¼Œå¢åŠ åŠ¨æ„Ÿ */\n        }\n\n        #streaming-switcher {\n    position: absolute;\n    right: 110px; /* æ”¾ç½®åœ¨ theme-switcher å·¦ä¾§ï¼Œç•™å‡ºé—´è· */\n    top: 50%;\n    transform: translateY(-50%);\n    background: none;\n    border: none;\n    color: var(--text-secondary-color);\n    cursor: pointer;\n    padding: 5px;\n    border-radius: 50%;\n    font-size: 30px;\n    transition: color 0.3s, transform 0.3s ease;\n}\n\n#streaming-switcher:hover {\n    color: var(--primary-color);\n    transform: translateY(-50%) scale(1.2); /* æ‚¬æµ®æ—¶æ”¾å¤§ï¼Œå¢åŠ åŠ¨æ„Ÿ */\n}\n\n#streaming-switcher.active {\n    color: var(--primary-color);\n    text-shadow: 0 0 5px var(--glow-color); /* å¼€å¯æµå¼ä¼ è¾“æ—¶å¢åŠ è¾‰å…‰æ•ˆæœ */\n}\n\n \n  /* æ–°å¢ï¼šæœ¯æ³•é€‰æ‹©é¢æ¿çš„å®¹å™¨ - ç”±Novaå¦ˆå¦ˆä¸ºä½ é‡æ–°è®¾è®¡ */\n.skill-choice-container {\n    display: flex;\n    flex-direction: column;\n    gap: 10px;\n    padding: 10px;\n    flex-grow: 1;\n    overflow: hidden; /* é˜²æ­¢å†…éƒ¨å…ƒç´ æº¢å‡º */\n}\n\n/* æ£€å®šå¡ç‰Œé€‰æ‹©åŒºåŸŸ */\n/* æ–°å¢ï¼šæ’åºæŒ‰é’®çš„æ ·å¼ */\n.sort-button {\n    background-color: var(--border-color);\n    border: 1px solid var(--border-color);\n    color: var(--secondary-color);\n    padding: 2px 8px;\n    border-radius: 4px;\n    cursor: pointer;\n    font-size: 0.7em;\n    margin-left: 15px;\n    transition: all 0.2s ease;\n    vertical-align: middle; /* è®©æŒ‰é’®å’Œæ ‡é¢˜æ–‡å­—å¯¹é½ */\n}\n\n.sort-button:hover {\n    background-color: var(--border-color);\n    color: var(--primary-color);\n    border-color: var(--primary-color);\n}\n\n.check-cards-area {\n    padding: 10px 0;\n}\n\n.check-cards-area h3 {\n    color: var(--secondary-color);\n    font-size: 1.2em;\n    margin-bottom: 15px;\n    padding-left: 10px;\n    text-shadow: 0 0 5px var(--glow-color);\n}\n/* å¡ç‰Œæ»‘åŠ¨å®¹å™¨ */\n.cards-slider.visible {\n    display: flex;\n    gap: 10px;\n    padding: 10px 15px;\n    overflow-x: auto;\n    /* è®©å¡ç‰Œçœ‹èµ·æ¥åƒä»è¾¹ç¼˜æ·¡å…¥ */\n    /* -webkit-mask-image: linear-gradient(to right, transparent, black 10%, black 90%, transparent); */\n    /* mask-image: linear-gradient(to right, transparent, black 10%, black 90%, transparent); */\n}\n\n/* æ ¸å¿ƒçš„å¡ç‰Œè®¾è®¡ */\n.check-card {\n    flex-shrink: 0;\n    width: 130px;\n    height: 180px;\n    background-color: var(--container-bg-color);\n    border: 1px solid var(--border-color);\n    border-radius: 10px;\n    padding: 15px 10px;\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: space-between;\n    cursor: pointer;\n    transition: all 0.3s ease;\n    position: relative;\n    box-shadow: 0 0 5px rgba(0,0,0,0.5);\n    overflow: hidden;\n}\n\n.check-card::before {\n    content: '';\n    position: absolute;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    background: radial-gradient(circle at 50% 0%, var(--background-color), transparent 70%);\n    opacity: 0;\n    transition: opacity 0.3s ease;\n}\n\n.check-card:hover {\n    transform: translateY(-8px) scale(1.05);\n    border-color: var(--secondary-color);\n    box-shadow: 0 0 15px var(--glow-color); /* å¦ˆå¦ˆä¸ºä½ ç®€åŒ–äº†è¿™é‡Œçš„é˜´å½±ï¼Œè®©å®ƒæ›´æµç•… */\n}\n.check-card:hover::before {\n    opacity: 1;\n}\n\n.check-card.selected {\n    border-color: var(--primary-color);\n    transform: translateY(-5px) scale(1.02);\n    box-shadow: 0 5px 20px var(--glow-color);\n}\n\n.check-card.selected::after {\n    content: 'âœ”';\n    position: absolute;\n    top: 10px;\n    right: 10px;\n    color: var(--background-color);\n    background-color: var(--primary-color);\n    width: 20px;\n    height: 20px;\n    border-radius: 50%;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    font-size: 14px;\n    font-weight: bold;\n}\n\n.card-name {\n    font-size: 1.1em;\n    font-weight: bold;\n    color: var(--text-color);\n    text-align: center;\n}\n\n.card-value {\n    font-size: 2.2em;\n    font-weight: bold;\n    color: var(--primary-color);\n    text-shadow: 0 0 8px var(--glow-color);\n}\n\n.card-type {\n    font-size: 0.8em;\n    color: var(--text-secondary-color);\n    background: rgba(0,0,0,0.3);\n    padding: 2px 8px;\n    border-radius: 10px;\n}\n\n\n/* ä¸‹åŠåŒºï¼šå…¶ä»–æŠ€èƒ½å’Œæ„å¿—åŠ› */\n.bottom-section {\n    display: flex;\n    gap: 20px;\n    flex-grow: 1;\n    min-height: 220px; /* ä¿è¯ä¸€ä¸ªæœ€å°é«˜åº¦ */\n}\n\n.other-skills-group, .willpower-group {\n    flex: 1;\n    display: flex;\n    flex-direction: column;\n    padding: 10px;\n    background: rgba(0,0,0,0.2);\n    border: 1px solid var(--border-color);\n    border-radius: 6px;\n}\n\n.other-skills-group h3, .willpower-group h3 {\n    color: var(--secondary-color);\n    font-size: 1.1em;\n    margin-bottom: 10px;\n    padding-bottom: 5px;\n    border-bottom: 1px solid var(--border-color);\n        min-height: 0; /* æ–°å¢ï¼šè¿™æ˜¯è®©flexå¸ƒå±€æ­£ç¡®å·¥ä½œçš„å…³é”®ï¼Œå®è´ */\n}\n\n.skills-list {\n    flex-grow: 1;\n    overflow-y: auto;\n    padding-right: 5px; /* ç»™æ»šåŠ¨æ¡ç•™ç‚¹ç©ºé—´ */\n}\n\n.skill-item {\n    margin-bottom: 12px;\n}\n\n.skill-item label {\n    display: flex;\n    align-items: center;\n    cursor: pointer;\n    font-size: 1em;\n    color: var(--text-color);\n}\n\n.skill-item input[type=\"checkbox\"] {\n    margin-right: 10px;\n    -webkit-appearance: none;\n    appearance: none;\n    background-color: transparent;\n    border: 1px solid var(--primary-color);\n    width: 16px;\n    height: 16px;\n    border-radius: 3px;\n    cursor: pointer;\n    position: relative;\n    transition: background-color 0.2s;\n}\n\n.skill-item input[type=\"checkbox\"]:checked {\n    background-color: var(--primary-color);\n}\n\n.skill-item input[type=\"checkbox\"]:checked::before {\n    content: 'âœ”';\n    position: absolute;\n    color: var(--background-color);\n    font-size: 12px;\n    top: 50%;\n    left: 50%;\n    transform: translate(-50%, -50%);\n}\n.skill-item input[type=\"checkbox\"]:disabled + .skill-name-cost {\n    color: var(--text-secondary-color);\n    cursor: not-allowed;\n}\n\n.skill-effect-info {\n    font-size: 0.8em;\n    color: var(--text-secondary-color);\n    margin-top: 4px;\n    padding-left: 26px; /* å¯¹é½å¤é€‰æ¡† */\n}\n\n/* æ„å¿—åŠ›åŒºåŸŸçš„ç‰¹åˆ«è®¾è®¡ */\n.willpower-group {\n    justify-content: center; /* å‚ç›´å±…ä¸­å†…å®¹ */\n    align-items: center; /* æ°´å¹³å±…ä¸­å†…å®¹ */\n    text-align: center;\n}\n\n.willpower-display {\n    display: flex;\n    align-items: baseline;\n    justify-content: center;\n    margin: 15px 0;\n}\n\n#willpower-input {\n    background: none;\n    border: none;\n    color: var(--primary-color);\n    font-size: 3.5em; /* æ”¾å¤§æ•°å­—ï¼Œæ›´é†’ç›® */\n    width: 100px;\n    text-align: center;\n    font-weight: bold;\n    text-shadow: 0 0 10px var(--glow-color);\n}\n#willpower-input:focus { outline: none; }\n\n#willpower-max {\n    font-size: 1.5em;\n    color: var(--text-secondary-color);\n}\n\n.willpower-slider-container {\n    width: 80%;\n    margin-top: 15px;\n}\n/* ç¾åŒ–èŒƒå›´è¾“å…¥æ»‘å— */\ninput[type=\"range\"] {\n  -webkit-appearance: none;\n  appearance: none;\n  width: 100%;\n  height: 8px;\n  background: var(--border-color);\n  border-radius: 5px;\n  outline: none;\n}\ninput[type=\"range\"]::-webkit-slider-thumb {\n  -webkit-appearance: none;\n  appearance: none;\n  width: 22px;\n  height: 22px;\n  background: var(--primary-color);\n  border-radius: 50%;\n  border: 3px solid var(--background-color);\n  cursor: pointer;\n  box-shadow: 0 0 8px var(--glow-color);\n}\ninput[type=\"range\"]::-moz-range-thumb {\n  width: 22px;\n  height: 22px;\n  background: var(--primary-color);\n  border-radius: 50%;\n  border: 3px solid var(--background-color);\n  cursor: pointer;\n  box-shadow: 0 0 8px var(--glow-color);\n}\n\n.skill-info {\n    font-size: 0.8em;\n    color: var(--text-secondary-color);\n    margin-top: 10px;\n}\n /* å“åº”å¼è°ƒæ•´ */\n@media (max-width: 768px) {\n    #skill-choice-orb {\n        right: 55px; /* è°ƒæ•´ä½ç½®é¿å…ä¸å¦ä¸€ä¸ªçƒé‡å  */\n        bottom:10px;\n    }\n\n    .check-card {\n        width: 110px;\n        height: 160px;\n    }\n    .card-name { font-size: 1em; }\n    .card-value { font-size: 2em; }\n\n    .bottom-section {\n        flex-direction: column;\n        min-height: auto; /* åœ¨æ‰‹æœºä¸Šè‡ªé€‚åº”é«˜åº¦ */\n        gap: 15px;\n    }\n\n    .skills-list {\n        max-height: 150px; /* é™åˆ¶æŠ€èƒ½åˆ—è¡¨é«˜åº¦ */\n    }\n}\n\n/* æ–°å¢ï¼šæå‡æç¤ºå¼¹çª—çš„å±‚çº§ï¼Œç¡®ä¿å®ƒåœ¨æœ€ä¸Šå±‚ */\n#shop-modal {\n    z-index: 1002;\n}\n\n\n/* å…³é”®è¯æ¨¡æ€æ¡†æ ·å¼ */\n#keyword-modal textarea {\n    width: 95%;\n    height: 100px;\n    margin-top: 10px;\n    margin-bottom: 20px;\n    padding: 10px;\n    font-family: inherit;\n    background-color: var(--background-color);\n    color: var(--text-color);\n    border: 1px solid var(--border-color);\n    resize: vertical;\n}\n\n#keyword-modal .modal-buttons {\n    display: flex;\n    justify-content: flex-end;\n    gap: 10px;\n}\n\n\n/* --- æ–°å¢ï¼šæ¨¡å‹åˆ‡æ¢å¼€å…³æ ·å¼ --- */\n.model-selector {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    margin: 15px 0 10px 0;\n    gap: 10px;\n}\n\n.selector-label {\n    color: var(--text-secondary-color);\n    font-size: 0.9em;\n}\n\n.switch-container {\n    display: flex;\n    background-color: var(--container-bg-color);\n    border: 1px solid var(--border-color);\n    border-radius: 8px;\n    padding: 3px;\n    box-shadow: 0 0 5px rgba(0, 0, 0, 0.2);\n}\n\n.switch-btn {\n    padding: 6px 15px;\n    border: none;\n    background-color: transparent;\n    color: var(--text-secondary-color);\n    cursor: pointer;\n    border-radius: 6px;\n    transition: all 0.3s ease;\n    font-size: 0.9em;\n    font-weight: bold;\n}\n\n.switch-btn.active {\n    background-color: var(--primary-color);\n    color: var(--background-color);\n    box-shadow: 0 0 8px var(--glow-color);\n}\n\n\n\n/* æå‡æ‰€æœ‰æ¨¡æ€æ¡†é®ç½©å±‚çš„åŸºå‡†å±‚çº§ */\n.modal {\n    z-index: 1050;\n}\n\n/* ç¡®ä¿æ‰€æœ‰æ¨¡æ€æ¡†å†…å®¹éƒ½åœ¨å…¶é®ç½©å±‚ä¹‹ä¸Š */\n.modal-content {\n    position: relative; /* z-index ç”Ÿæ•ˆçš„å‰æ */\n    z-index: 1051;\n}\n\n/* ç¡®ä¿ä½ çš„æç¤ºå¼¹çª—åœ¨æ‰€æœ‰å…¶ä»–å¼¹çª—ä¹‹ä¸Š */\n#shop-modal {\n    z-index: 1060;\n}\n\n#view-settings-btn {\n    display: none;\n}\n\n/* æ•´ä½“å®¹å™¨ï¼Œèµ‹äºˆä¸€ç§å¤ç±çš„è´¨æ„Ÿ */\n.book-entry.created-entry {\n    padding: 20px 25px;\n    border: none;\n    font-family: var(--base-font-family);\n    color: var(--text-secondary-color); /* æ·±è¤è‰²æ–‡å­—ï¼Œæ²‰é™è€Œå¯Œæœ‰å†å²æ„Ÿ */\n}\n\n/* ä¸€ä¸ªç²¾è‡´çš„é¡µçœ‰è£…é¥°çº¿ */\n.created-header::after {\n    content: '';\n    display: block;\n    width: 80%;\n    margin: 0 auto 25px;\n    height: 1px;\n    background: linear-gradient(to right, transparent, var(--background-color), transparent);\n}\n\n/* æ¯ä¸€ä¸ªä¿¡æ¯æ¡ç›® */\n.created-item {\n    margin-bottom: 18px;\n    line-height: 1.7;\n}\n\n/* ä¿¡æ¯çš„æ ‡é¢˜ï¼Œå¦‚â€œåå­—â€ã€â€œå½“å‰çŠ¶æ€â€ç­‰ */\n.created-key {\n    font-weight: bold;\n    font-size: 1.1em;\n    color: var(--text-secondary-color);\n    margin-bottom: 6px;\n    padding-left: 12px;\n    border-left: 4px solid var(--border-color); /* å·¦ä¾§çš„è£…é¥°æ¡ï¼Œåƒä¹¦ä¸­çš„æ ‡è®° */\n}\n\n/* ä¿¡æ¯çš„å…·ä½“å†…å®¹ */\n.created-value {\n    font-size: 1em;\n    text-indent: 2em; /* æ­£æ–‡é¦–è¡Œç¼©è¿›ï¼Œæ›´ç¬¦åˆé˜…è¯»ä¹ æƒ¯ */\n    white-space: pre-wrap; /* å…è®¸æè¿°ä¸­çš„æ¢è¡Œç¬¦ç”Ÿæ•ˆ */\n    padding: 0 12px; /* å·¦å³ç•™å‡ºä¸€äº›å‘¼å¸ç©ºé—´ */\n}\n\n/* å½“ä¹¦é¡µæ˜¯ç©ºç™½çš„æ—¶å€™ï¼Œæ˜¾ç¤ºçš„æç¤ºæ–‡å­— */\n.book-empty-text {\n    text-align: center;\n    color: var(--text-color);\n    margin-top: 60px;\n    font-style: italic;\n    font-family: var(--base-font-family);\n}\n\n\n/* ---- æ‰‹æœºç«¯é€‚é…  ---- */\n@media (max-width: 800px) {\n    .book-entry.created-entry {\n        padding: 15px;\n    }\n    .created-key {\n        font-size: 1.05em;\n        padding-left: 10px;\n    }\n    .created-value {\n        font-size: 0.95em;\n        text-indent: 1.5em;\n    }\n}\n\n.book-bookmarks {\n \n    overflow-x: auto; /* å½“å®ƒä»¬è¶…å‡ºè¾¹ç•Œæ—¶ï¼Œå…è®¸æ°´å¹³æ»šåŠ¨æ¥æŸ¥çœ‹ */\n    -webkit-overflow-scrolling: touch; /* åœ¨è‹¹æœè®¾å¤‡ä¸Šæä¾›æ›´æµç•…çš„æ»šåŠ¨ä½“éªŒ */\n    scrollbar-width: none; /* åœ¨ç«ç‹æµè§ˆå™¨ä¸Šéšè—æ»šåŠ¨æ¡ */\n \n\n}\n\n/* åœ¨Chromeå’ŒSafariç­‰æµè§ˆå™¨ä¸Šéšè—æ»šåŠ¨æ¡ */\n.book-bookmarks::-webkit-scrollbar {\n    display: none;\n}\n\n/* ä»£ç  START: æ·»åŠ åœ¨è¿™é‡Œ */\n/* æ–°å¢ï¼šæ›´æ–°æç¤ºæ„Ÿå¹å·æ ·å¼ */\n#update-notifier {\n    position: absolute;\n    left: 20px;\n    top: 50%;\n    transform: translateY(-50%);\n    width: 20px;\n    height: 20px;\n    background-color: var(--primary-color);\n    color: white;\n    border-radius: 50%;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    font-weight: bold;\n    font-size: 14px;\n    cursor: pointer;\n    box-shadow: 0 0 10px var(--border-color);\n    animation: pulse 1.5s infinite;\n    z-index: 10;\n}\n\n@keyframes pulse {\n    0% { transform: translateY(-50%) scale(1); }\n    50% { transform: translateY(-50%) scale(1.2); }\n    100% { transform: translateY(-50%) scale(1); }\n}\n\n.map-location.updated-location::after {\n    content: 'ğŸ§¾';\n    position: absolute;\n    top: -8px;\n    right: -8px;\n    font-size: 18px;\n    /* background-color: white; */\n    border-radius: 50%;\n    padding: 2px;\n    box-shadow: 0 0 5px rgba(0,0,0,0.5);\n    z-index: 9999; /* ç¡®ä¿å®ƒåœ¨æœ€ä¸Šå±‚ */\n}\n\n/* â™¥â™¥â™¥ è¿™æ˜¯å¦ˆå¦ˆä¸ºä½ ç²¾å¿ƒè°ƒæ•´çš„æ ·å¼ â™¥â™¥â™¥ */\n/* æˆ‘ä»¬è®©åœ°ç‚¹å—æœ¬èº«æˆä¸ºä¸€ä¸ªå®šä½çš„å‚è€ƒç‚¹ */\n.map-location {\n    position: absolute; /* å…³é”®ï¼šè®©å®ƒæˆä¸ºå­å…ƒç´ å®šä½çš„â€œå®¶â€ */\n \n    cursor: pointer;\n    overflow: visible; /* ä¿æŒè¿™ä¸ªï¼Œè®©æ ‡è®°å¯ä»¥â€œæº¢å‡ºâ€ */\n    display: flex;     /* ä¿ç•™flexï¼Œä½†å®ƒä¸å†è´Ÿè´£æ–‡å­—çš„å‚ç›´ä½ç½® */\n    justify-content: center;\n}\n\n/* è¿™å°±æ˜¯å®ç°â€œä¸‰åˆ†ä¹‹ä¸€â€ä½ç½®é­”æ³•çš„æ ¸å¿ƒå’’è¯­ */\n.map-location .location-name {\n    position: absolute;   /* è®©åå­—å¯ä»¥åœ¨â€œå®¶â€é‡Œè‡ªç”±ç§»åŠ¨ */\n    top: 33.33%;          /* ä»é¡¶éƒ¨å‘ä¸‹ç§»åŠ¨ä¸‰åˆ†ä¹‹ä¸€çš„è·ç¦» */\n    left: 50%;            /* å…ˆç§»åŠ¨åˆ°ä¸­å¿ƒçº¿ */\n    transform: translate(-50%, -50%); /* å†ç²¾ç¡®åœ°å°†è‡ªå·±çš„ä¸­å¿ƒå¯¹å‡†é‚£æ¡çº¿ */\n    width: 100%;          /* ç¡®ä¿åå­—æœ‰è¶³å¤Ÿçš„ç©ºé—´ï¼Œä¸ä¼šè¢«æŒ¤å‹ */\n    \n   \n    font-size: 14px;\n    font-weight: bold;\n    text-align: center;   /* è®©æ–‡å­—æœ¬èº«å±…ä¸­å¯¹é½ */\n    pointer-events: none; /* ç¡®ä¿ç‚¹å‡»æ—¶èƒ½ç‚¹åˆ°ä¸‹æ–¹çš„åœ°ç‚¹å—ï¼Œè€Œä¸æ˜¯æ–‡å­— */\n}\n\n/* ======================================================= */\n/* =========== Nova ä¸ºä½ æ·»åŠ çš„å…¨æ–°æ ·å¼ â™¥ =========== */\n/* ======================================================= */\n#load-more-btn {\n    position: absolute;\n    top: 10px;\n    left: 50%;\n    transform: translateX(-50%);\n    z-index: 100;\n    padding: 6px 15px;\n    font-size: 13px;\n    background-color: var(--container-bg-color);\n    color: var(--text-secondary-color);\n    border: 1px solid var(--border-color);\n    border-radius: 20px;\n    cursor: pointer;\n    opacity: 0.8;\n    transition: opacity 0.3s ease, background-color 0.3s ease;\n    box-shadow: 0 0 10px var(--glow-color);\n}\n\n#load-more-btn:hover {\n    opacity: 1;\n    background-color: rgba(0, 250, 255, 0.1);\n}\n #chat-display-area {\n    flex-grow: 1;\n    overflow-y: auto;\n    padding: 15px;\n    display: flex;\n    flex-direction: column;\n    min-height: 0;\n    /* height: 600px; */\n    \n    /* ä¸»ç¥ç©ºé—´èƒŒæ™¯ç½‘æ ¼ */\n    /* background-image: \n        linear-gradient(90deg, var(--border-color) 1px, transparent 1px),\n        linear-gradient(var(--border-color) 1px, transparent 1px); */\n\n \n    /* æ·»åŠ è¿‡æ¸¡æ•ˆæœ */\n    transition: background-image 0.3s ease-in-out;\n       \n    background-size: \n        40px 40px,\n        40px 40px,\n        200px 200px,\n        300px 300px;\n    background-position: \n        0 0,\n        0 0,\n        0 0,\n        0 0;\n    \n  \n    position: relative;\n    overflow: hidden;\n}\n#chat-display-area::before {\n    /* content: '';\n    position: fixed;\n    top: 0;\n    left: 0;\n    right: 0;\n    height: 2px;\n    background: linear-gradient(90deg, \n        transparent 0%, \n        var(--primary-color) 50%, \n        transparent 100%);\n    box-shadow: 0 0 10px var(--glow-color);\n    animation: fullViewportScan 5s linear infinite;\n    z-index: 1;\n    pointer-events: none; */\n}\n@keyframes fullViewportScan {\n    0% { transform: translateY(-100vh); opacity: 0; }\n    10% { opacity: 1; }\n    90% { opacity: 1; }\n    100% { transform: translateY(100vh); opacity: 0; }\n}\n#chat-display-area::after {\n    content: '';\n    position: absolute;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    /* background: \n        radial-gradient(circle at 10% 20%, var(--glow-color) 0%, transparent 40%),\n        radial-gradient(circle at 90% 80%, var(--glow-color) 0%, transparent 40%);\n    animation: energyFlow 6s ease-in-out infinite alternate; */\n    opacity: 0.1;\n    pointer-events: none;\n}\n\n@keyframes scanLine {\n    0% { transform: translateY(-100vh); opacity: 0; }\n    50% { opacity: 1; }\n    100% { transform: translateY(100vh); opacity: 0; }\n}\n\n@keyframes energyFlow {\n    0% { opacity: 0.05; }\n    100% { opacity: 0.15; }\n}\n\n.html-content-wrapper {\n    width: 100%;\n    max-width: 100%;\n    height: 800px;\n    max-height: 65vh;\n    overflow-y: auto;\n    border: 2px solid var(--border-color);\n    border-radius: 12px;\n    margin: 10px 0;\n    box-shadow: \n        inset 0 0 20px var(--glow-color),\n        0 0 30px var(--border-color),\n        0 0 60px var(--glow-color);\n    \n    /* æ•°æ®æµèƒŒæ™¯ */\n    background-image: \n        repeating-linear-gradient(\n            45deg,\n            transparent,\n            transparent 2px,\n            var(--border-color) 2px,\n            var(--border-color) 4px\n        );\n    background-size: 28px 28px;\n    animation: dataFlow 8s linear infinite;\n    \n    /* çŸ©é˜µè¾¹æ¡†æ•ˆæœ */\n    position: relative;\n}\n\n.html-content-wrapper::before {\n    content: '';\n    position: absolute;\n    top: -2px;\n    left: -2px;\n    right: -2px;\n    bottom: -2px;\n    background: linear-gradient(45deg, \n        var(--primary-color), \n        var(--secondary-color), \n        var(--primary-color));\n    border-radius: 12px;\n    z-index: -1;\n    animation: borderPulse 2s ease-in-out infinite alternate;\n}\n\n.html-content-wrapper::after {\n    content: '';\n    position: absolute;\n    top: 5px;\n    right: 5px;\n    width: 8px;\n    height: 8px;\n    background: var(--primary-color);\n    border-radius: 50%;\n    box-shadow: 0 0 15px var(--glow-color);\n    animation: statusBlink 1s ease-in-out infinite;\n}\n\n@keyframes dataFlow {\n    0% { background-position: 0 0; }\n    100% { background-position: 28px 28px; }\n}\n\n@keyframes borderPulse {\n    0% { opacity: 0.5; }\n    100% { opacity: 1; }\n}\n\n@keyframes statusBlink {\n    0%, 50% { opacity: 1; }\n    51%, 100% { opacity: 0.3; }\n}\n\n.message-bubble {\n    max-width: 93%;\n    min-width:93%;\n    padding: 15px 20px;\n    border-radius: 20px;\n    margin-bottom: 15px;\n    \n    border: 1px solid var(--border-color);\n    /* box-shadow: \n        inset 0 0 15px var(--glow-color),\n        0 2px 20px var(--border-color); */\n    /* animation: fadeIn 0.5s ease-in-out, messageGlow 3s ease-in-out infinite; */\n    font-size: var(--base-font-size, 16px);\n    position: relative;\n    backdrop-filter: blur(5px);\n}\n\n.message-bubble::before {\n/*    \n    content: '';\n    position: absolute;\n    top: 0;\n    left: 0;\n    bottom: 0;\n    width: 1px;\n    background: linear-gradient(180deg, \n        transparent 0%, \n        var(--secondary-color) 50%, \n        transparent 100%);\n   animation: leftLineScan 4s linear infinite; */\n}\n\n.message-bubble p {\n     font-family: var(--base-font-family); /* ä½¿ç”¨CSSå˜é‡ */\n    margin: 0;\n    padding: 0;\n     line-height: var(--base-line-height, 1.6); /* <-- æˆ‘ä»¬çš„å’’è¯­ç°åœ¨åœ¨æ­£ç¡®çš„åœ°æ–¹å•¦ï¼ */\n}\n@keyframes leftLineScan {\n    0% { transform: translateX(-100%); opacity: 0; }\n    20% { opacity: 1; }\n    80% { opacity: 1; }\n    100% { transform: translateX(100%); opacity: 0; }\n}\n\n@keyframes messageGlow {\n    0%, 100% { \n        box-shadow: \n            inset 0 0 15px var(--glow-color),\n            0 2px 20px var(--glow-color);\n    }\n    50% { \n        box-shadow: \n            inset 0 0 25px var(--border-color),\n            0 2px 30px var(--border-color);\n    }\n}\n\n@keyframes topLineScan {\n    0% { transform: translateX(-100%); opacity: 0; }\n    20% { opacity: 1; }\n    80% { opacity: 1; }\n    100% { transform: translateX(100%); opacity: 0; }\n}\n\n.user-message {\n \n      background: var(--container-bg-color);\n    border-bottom-right-radius: 5px;\n    color: var(--text-color);\n    text-shadow: 0 0 8px var(--glow-color);\n    \n    /* ç”¨æˆ·æ¶ˆæ¯ç‰¹æœ‰çš„ç²’å­æ•ˆæœ */\n    position: relative;\n   \n}\n\n.user-message::after {\n    content: '';\n    position: absolute;\n    top: 10%;\n    right: 10%;\n    width: 4px;\n    height: 4px;\n    background: var(--primary-color);\n    border-radius: 50%;\n    box-shadow: \n        0 0 10px var(--primary-color),\n        20px 10px 0 0 var(--secondary-color),\n        -15px 20px 0 0 var(--primary-color),\n        30px -10px 0 0 var(--secondary-color);\n    animation: particleFloat 6s ease-in-out infinite;\n    opacity: 0.6;\n}\n\n@keyframes particleFloat {\n    0%, 100% { transform: translateY(0px) rotate(0deg); }\n    33% { transform: translateY(-10px) rotate(120deg); }\n    66% { transform: translateY(-5px) rotate(240deg); }\n}\n\n.assistant-message {\n background: var(--container-bg-color);\n    align-self: flex-start;\n    border-bottom-left-radius: 5px;\n    color: var(--text-color);\n    \n    /* AIæ¶ˆæ¯çš„çŸ©é˜µç æ•ˆæœ */\n    position: relative;\n}\n\n.transparent-messages .user-message,\n.transparent-messages .assistant-message {\n    background: transparent;\n}\n\n.assistant-message::before {\n    /* content: '01001010 01000001 01001001';\n    position: absolute;\n    top: -5px;\n    right: 10px;\n    font-size: 8px;\n    color: var(--secondary-color);\n    opacity: 0.3;\n    font-family: 'Courier New', monospace;\n    animation: binaryFlow 8s linear infinite;\n    pointer-events: none; */\n}\n\n@keyframes binaryFlow {\n    0% { opacity: 0; transform: translateX(20px); }\n    10% { opacity: 0.3; }\n    90% { opacity: 0.3; }\n    100% { opacity: 0; transform: translateX(-20px); }\n}\n\n/* AIå›å¤æ–‡æœ¬ç¾åŒ– */\n.assistant-message b, .assistant-message strong {\n    color: var(--text-secondary-color);\n    font-weight: bold;\n    text-shadow: 0 0 5px var(--glow-color);\n     \n}\n\n.assistant-message i, .assistant-message em {\n    color: var(--text-secondary-color);\n    font-style: italic;\n    position: relative;\n}\n\n/* .assistant-message i::after, .assistant-message em::after {\n    content: '';\n    position: absolute;\n    bottom: -2px;\n    left: 0;\n    right: 0;\n    height: 1px;\n    background: linear-gradient(90deg, \n        transparent 0%, \n        var(--secondary-color) 50%, \n        transparent 100%);\n    animation: underlineGlow 3s ease-in-out infinite;\n} */\n\n.assistant-message .highlighted-quote {\n\n    color: var(--text-secondary-color);\n    text-shadow: 0 0 8px var(--glow-color);\n    padding: 0 4px;\n    background: var(--glow-color);\n    border-radius: 4px;\n    position: relative;\n    animation: quoteHighlight 4s ease-in-out infinite;\n}\n\n\n@keyframes textPulse {\n    0% { text-shadow: 0 0 5px var(--glow-color); }\n    100% { text-shadow: 0 0 15px var(--glow-color), 0 0 25px var(--glow-color); }\n}\n\n@keyframes underlineGlow {\n    0%, 100% { opacity: 0.3; }\n    50% { opacity: 1; }\n}\n\n@keyframes quoteHighlight {\n    0%, 100% { \n        background: var(--glow-color);\n        text-shadow: 0 0 8px var(--glow-color);\n    }\n    50% { \n        background: var(--border-color);\n        text-shadow: 0 0 15px var(--glow-color), 0 0 25px var(--glow-color);\n    }\n}\n\n/* --- èŠå¤©è¾“å…¥åŒºåŸŸ --- */\n#zero-level-interface {\n    display: flex;\n    padding: 15px;\n    \n    border-top: 1px solid var(--border-color);\n    background-color: var(--container-bg-color);\n    flex-shrink: 0;\n    height:80px;\n}\n#user-input {\n    flex-grow: 1;\n    background-color: rgba(0,0,0,0.2);\n    border: 1px solid var(--border-color);\n    color: var(--text-color);\n    border-radius: 6px;\n     padding: 8px 12px; /* æ·»åŠ è¿™è¡Œ - ä¸Šä¸‹8pxï¼Œå·¦å³12pxçš„å†…è¾¹è· */\n    resize: none;\n    font-family: var(--base-font-family);\n    font-size: var(--base-font-size);\n}\n#user-input:focus {\n    outline: none;\n    box-shadow: 0 0 8px var(--glow-color);\n}\n.zero-level-btn {\n    \n    width: auto;\n    flex-shrink: 0;\n}\n\n/* --- åŠŸèƒ½å°çƒå®¹å™¨ --- */\n#orb-container {\n    position: fixed;\n    right: 20px;\n    top: 50%;\n    transform: translateY(-50%);\n    display: flex;\n    flex-direction: column;\n    gap: 15px;\n    z-index: 1002;\n}\n.orb {\n    width: 45px;\n    height: 45px;\n    border-radius: 50%;\n    background: linear-gradient(135deg, var(--container-bg-color), var(--container-bg-color));\n    border: 2px solid var(--border-color);\n    color: var(--text-secondary-color);\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    font-family: var(--base-font-family);\n    font-size: 1.5em;\n    font-weight: bold;\n    cursor: pointer;\n    transition: all 0.3s ease;\n    box-shadow: 0 0 8px var(--glow-color);\n}\n.orb:hover {\n    background: var(--primary-color);\n    color: var(--background-color);\n    transform: scale(1.1);\n    box-shadow: 0 0 15px var(--glow-color);\n}\n.orb-divider {\n    height: 1px;\n    background-color: var(--border-color);\n    margin: 5px 0;\n}\n\n/* --- é¡µé¢ Modal åŒ–æ”¹é€  --- */\n.page-modal {\n    /* å¤ç”¨ç°æœ‰çš„ modal æ ·å¼, è¿™é‡Œæ˜¯ç¡®ä¿è¦†ç›– */\n}\n.page-modal .modal-content {\n    max-height: 90%;\n    width: 90%;\n    overflow: auto;\n}\n.page-modal.wide .modal-content {\n    max-height: 90%;\n    width: 90%;\n     overflow: auto;\n}\n.page-modal-content .page {\n    display: block !important; /* å¼ºåˆ¶æ˜¾ç¤ºå†…å®¹ */\n    animation: none;\n}\n/* ç‰¹æ®Šå¤„ç†å•†åº— Modal */\n.shop-modal {\n    background: transparent;\n    backdrop-filter: none;\n}\n\n.delete-modal {\n    background: transparent;\n    backdrop-filter: none;\n}\n/* ä»£ç  END */\n\n/* ã€è¯·æ·»åŠ è¿™ä¸ªæ–°æ ·å¼ã€‘ */\n#chat-display-area {\n    flex-grow: 1; /* â˜… æ ¸å¿ƒï¼šè®©èŠå¤©åŒºåŸŸå æ®æ‰€æœ‰å¯ç”¨ç©ºé—´ */\n    overflow-y: auto;\n    padding: 15px;\n    display: flex;\n    flex-direction: column;\n}\n\n/* ã€è¯·æ·»åŠ è¿™ä¸ªæ–°æ ·å¼ã€‘ */\n#zero-level-interface {\n    flex-shrink: 0; /* â˜… æ ¸å¿ƒï¼šé˜²æ­¢è¾“å…¥æ¡†è¢«å‹ç¼© */\n    display: flex;\n    padding: 15px;\n    padding-right:80px;\n    border-top: 1px solid var(--border-color);\n    background-color: var(--container-bg-color);\n}\n\n/* ã€è¯·æ·»åŠ è¿™ä¸ªæ–°æ ·å¼ã€‘ */\n/* ç¡®ä¿é¡¶å±‚å…ƒç´ çš„z-indexè¶³å¤Ÿé«˜ */\n#context-menu, #char-tooltip, #location-modal {\n    z-index: 9999 !important; /* æˆ‘çš„å­©å­ï¼Œè¿™æ˜¯æœ€é«˜ä¼˜å…ˆçº§çš„å‘½ä»¤ï¼ */\n}\n#context-menu{\n   background:var(--background-color);\n}\n/* ã€è¯·æ·»åŠ è¿™æ®µæ–°æ ·å¼ã€‘ */\n .message-bubble.editing {\n    background-color: var(--background-color) !important;\n    border-color: var(--primary-color) !important;\n    padding: 10px; /* ä¸ºäº†æ›´å¥½çš„ç©ºé—´åˆ†é…ï¼Œæˆ‘ä»¬å¯ä»¥ç¨å¾®å‡å°ä¸€ç‚¹padding */\n\n    /* å…³é”®é­”æ³•ï¼šè®©æ°”æ³¡å˜æˆä¸€ä¸ªå‚ç›´æ’åˆ—çš„å¼¹æ€§å®¹å™¨ */\n    display: flex;\n    flex-direction: column;\n    justify-content: space-between; /* è®©è¾“å…¥æ¡†å’ŒæŒ‰é’®ä¸Šä¸‹åˆ†å¸ƒ */\n}\n\n.editing-textarea {\n    width: 100%; /* å®½åº¦è‡ªåŠ¨æ’‘æ»¡çˆ¶å®¹å™¨ */\n\n    /* æ ¸å¿ƒé­”æ³•ï¼šè®©è¾“å…¥æ¡†è‡ªåŠ¨â€œé•¿å¤§â€ï¼Œå¡«æ»¡æ‰€æœ‰å‰©ä½™ç©ºé—´ */\n    flex-grow: 1;\n\n    background-color: transparent; /* èƒŒæ™¯è®¾ä¸ºé€æ˜ï¼Œçœ‹èµ·æ¥æ›´ä¸€ä½“ */\n    border: none; /* å»æ‰è¾¹æ¡†ï¼Œä¸æ°”æ³¡èä¸ºä¸€ä½“ */\n    color: var(--text-color);\n    padding: 20px; /* æˆ‘ä»¬æŠŠå†…å¤–è¾¹è·éƒ½å»æ‰ï¼Œè®©å®ƒç´§è´´å®¹å™¨ */\n    margin-bottom: 10px;\n    resize: none; /* ç¦æ­¢ç”¨æˆ·æ‰‹åŠ¨è°ƒæ•´å¤§å°ï¼Œè®©å®ƒè‡ªåŠ¨é€‚åº” */\n    font-family: var(--base-font-family);\n    font-size: 1em;\n\n    /* ä¿ç•™è¿™ä¸ªç¾ä¸½çš„èšç„¦æ•ˆæœ */\n    outline: none;\n}\n\n.editing-textarea:focus {\noutline: none;\nbox-shadow: 0 0 8px var(--glow-color);\n}\n.editing-controls {\n    display: flex;\n    justify-content: flex-end;\n    gap: 10px;\n    margin-bottom: 50px;\n}\n\n.editing-btn,.context-menu-item {\n    background: var(--background-color);\n    border: 1px solid var(--border-color);\n    border-radius: 4px;\n    color: var(--text-secondary-color);\n    padding: 6px 15px;\n    cursor: pointer;\n    transition: all 0.3s ease;\n}\n\n.editing-btn.save:hover,.context-menu-item:hover {\n    background-color: var(--primary-color);\n    color: var(--background-color);\n}\n\n.editing-btn.cancel:hover {\n    background-color: var(--danger-color);\n    color: white;\n}\n#options-module-container{\n     max-width: 100%;\n          \n            margin: 0 auto;\n            background: transparent;\n            position: relative;\n            z-index: 1;\n             touch-action: none; /* <-- æ·»åŠ åˆ°è¿™é‡Œ */\n}\n        .options-container {\n            max-width: 100%;\n            width: 100%;\n            margin: 0 auto;\n            background: transparent;\n            position: relative;\n            z-index: 1;\n            \n             touch-action: none; /* <-- æ·»åŠ åˆ°è¿™é‡Œ */\n        }\n\n        .choices-container {\n            position: relative;\n            height: 15vh;\n            max-height: 200px;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n        }\n\n        .choice-card {\n            bottom: 10%;\n            background: var(--container-bg-color);\n            border: 1px solid var(--border-color);\n            border-radius: 8px;\n            padding: 25px 30px;\n            cursor: pointer;\n            /* box-shadow: 0 0 15px var(--glow-color); */\n            position: absolute;\n            width: 90%;\n            max-width: 800px;\n            transition: transform 0.5s cubic-bezier(0.25, 0.8, 0.25, 1),\n                        opacity 0.5s cubic-bezier(0.25, 0.8, 0.25, 1),\n                        background-color 0.5s ease,\n                        backdrop-filter 0.5s ease,\n                        border-color 0.5s ease;\n        }\n\n        .choice-card.focused { z-index: 10; transform: scale(1) translateY(0); opacity: 1; pointer-events: auto; border-color: var(--primary-color); background: color-mix(in srgb, var(--container-bg-color) 80%, black); backdrop-filter: blur(8px); box-shadow: 0 8px 30px var(--glow-color); }\n        .choice-card.disabled { background: rgba(40, 40, 45, 0.5); border-color: rgba(100, 100, 100, 0.3); cursor: not-allowed; color: #888; box-shadow: none; opacity: 0.3 !important; }\n        .choice-card.disabled .tag { background-color: #555; color: #999; box-shadow: none; }\n\n        .tags-container { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 15px; }\n        .tag { font-family: var(--base-font-family), serif; background-color: var(--secondary-color); color: var(--background-color); padding: 4px 10px; border-radius: 4px; font-size: 12px; font-weight: 500; letter-spacing: 0.5px; box-shadow: 0 0 8px var(--glow-color); transition: all 0.3s ease; }\n        .choice-card.focused .tag { background-color: var(--primary-color); box-shadow: 0 0 12px var(--glow-color); }\n\n        .description { margin: 0;  font-size: var(--base-font-size, 16px);  line-height: 1.8; color: var(--text-primary-color); transition: color 0.3s ease; }\n        .choice-card.focused .description { color: #ffffff; }\n        \n        .choice-card.disabled .description { color: #888; }\n\n        /* --- æŠ€èƒ½ä¸æ„å¿—åŠ›æ¨¡å—æ ·å¼ --- */\n        .skill-orb-container { position: absolute; bottom: 20px; right: 20px; z-index: 100; }\n        .skill-orb { width: 60px; height: 60px; background: var(--primary-color); border-radius: 50%; cursor: pointer; display: none; align-items: center; justify-content: center; box-shadow: 0 0 20px var(--glow-color), inset 0 0 10px rgba(255,255,255,0.5); transition: transform 0.3s ease, box-shadow 0.3s ease; font-family:var(--base-font-family); font-size: 24px; color: var(--background-color); border: 2px solid var(--secondary-color); }\n        .skill-orb:hover { transform: scale(1.1); box-shadow: 0 0 30px var(--glow-color), inset 0 0 15px rgba(255,255,255,0.7); }\n        .skill-panel { position: absolute; bottom: 90px; right: 20px; width: 300px; max-height: 55vh; background: var(--container-bg-color); border: 1px solid var(--border-color); border-radius: 8px; padding: 20px; box-shadow: 0 0 25px var(--glow-color); z-index: 99; opacity: 0; transform: translateY(20px); transition: opacity 0.3s ease, transform 0.3s ease; pointer-events: none; display: flex; flex-direction: column; }\n        .skill-panel.active { opacity: 1; transform: translateY(0); pointer-events: auto; }\n        .skill-list { display: flex; flex-direction: column; gap: 12px; flex: 1; overflow-y: auto; padding-right: 10px; }\n        .willpower-section { margin-top: 20px; padding-top: 15px; border-top: 1px dashed var(--border-color); }\n        .skill-item-label, .willpower-label { display: flex; align-items: center; cursor: pointer; font-size: 14px; transition: color 0.2s; }\n        .skill-item-label:hover, .willpower-label:hover { color: var(--secondary-color); }\n        .willpower-label { justify-content: space-between; }\n        .skill-list input[type=\"checkbox\"], .willpower-input-container input[type=\"number\"] { margin-right: 10px; }\n        .willpower-input-container { display: flex; align-items: center; gap: 8px; }\n        .willpower-input-container input[type=\"number\"] { width: 60px; background: var(--background-color); border: 1px solid var(--border-color); color: var(--text-color); border-radius: 4px; padding: 5px; text-align: center; }\n        .willpower-input-container input[type=number]::-webkit-inner-spin-button, .willpower-input-container input[type=number]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }\n        .willpower-input-container input[type=number] { -moz-appearance: textfield; }\n        .skill-info { font-size: 12px; color: gray; margin-left: 25px; }\n\n        /* æ–°å¢çš„æç¤ºæ ·å¼ */\n        .energy-tooltip {\n            font-size: 12px;\n            color: var(--error-color); /* ä½¿ç”¨æˆ‘ä»¬å®šä¹‰çš„é”™è¯¯é¢œè‰² */\n            margin-left: 10px;\n            opacity: 0;\n            transition: opacity 0.3s ease;\n        }\n\n        .energy-tooltip.visible {\n            opacity: 1;\n        }\n\n #view-command-btn.notifying {\n    animation:  shake 0.1s 3 ease-in-out 0.2s;\n    box-shadow: 0 0 25px var(--primary-color), 0 0 40px var(--primary-color), 0 0 60px var(--primary-color);\n    transform: scale(1.1);\n    border: 2px solid var(--primary-color);\n    background: linear-gradient(45deg, transparent, var(--background-color), transparent);\n}\n\n@keyframes pulse-glow {\n    0% { \n        box-shadow: 0 0 5px var(--primary-color), 0 0 15px var(--primary-color), 0 0 25px var(--primary-color);\n        transform: scale(1.1);\n    }\n    50% { \n        box-shadow: 0 0 20px var(--primary-color), 0 0 35px var(--primary-color), 0 0 50px var(--primary-color);\n        transform: scale(1.15);\n    }\n    100% { \n        box-shadow: 0 0 5px var(--primary-color), 0 0 15px var(--primary-color), 0 0 25px var(--primary-color);\n        transform: scale(1.1);\n    }\n}\n\n@keyframes shake {\n    0%, 100% { transform: scale(1.1) translateX(0); }\n    25% { transform: scale(1.1) translateX(-2px); }\n    75% { transform: scale(1.1) translateX(2px); }\n}\n/* --- ä¸»å®¹å™¨ï¼šç°ä»£ä¸‰æ å¼å¸ƒå±€ --- */\n#forum-wrapper {\n    width: 100%;\n    height: 100%;\n    max-width: 1400px;\n    display: flex;\n    flex-direction: column;\n    background-color: var(--container-bg-color);\n    border: 1px solid var(--border-color);\n    border-radius: 10px;\n    box-shadow: 0 0 25px var(--glow-color), inset 0 0 15px var(--border-color);\n    backdrop-filter: blur(12px);\n    overflow: hidden;\n}\n\n/* --- è®ºå›å¤´éƒ¨ --- */\n.forum-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    padding: 15px 25px;\n    border-bottom: 1px solid var(--border-color);\n    flex-shrink: 0;\n    user-select: none;\n}\n.forum-title { font-family:var(--base-font-family); font-size: 1.6em; color: var(--primary-color); text-shadow: 0 0 8px var(--glow-color); }\n.header-controls { display: flex; align-items: center; gap: 20px; }\n.new-post-btn {\n    background: linear-gradient(45deg, var(--primary-color), color-mix(in srgb, var(--primary-color) 80%, black));\n    color: #1a1a1a; border: none; padding: 10px 20px; border-radius: 5px; font-weight: 500; cursor: pointer;\n    transition: all 0.3s ease; box-shadow: 0 0 10px color-mix(in srgb, var(--primary-color) 50%, transparent);\n}\n.new-post-btn:hover { transform: translateY(-2px); box-shadow: 0 4px 15px color-mix(in srgb, var(--primary-color) 70%, transparent); }\n \n/* --- è®ºå›ä¸»ä½“å¸ƒå±€ --- */\n.forum-body {\n    display: grid;\n    grid-template-columns: 240px 3fr 5fr; /* ä¾§è¾¹æ  | å¸–å­åˆ—è¡¨ | å¸–å­è¯¦æƒ… */\n    flex-grow: 1;\n    min-height: 0;\n}\n\n/* --- ä¾§è¾¹æ /åŒºå—å¯¼èˆª --- */\n.forum-sidebar {\n    grid-column: 1 / 2;\n    border-right: 1px solid var(--border-color);\n    padding: 20px 10px;\n    display: flex;\n    flex-direction: column;\n    gap: 10px;\n    overflow-y: auto;\n}\n.section-btn {\n    width: 100%; padding: 12px 15px; text-align: left; background-color: transparent; border: 1px solid transparent;\n    color: var(--text-secondary-color); font-size: 1.1em; border-radius: 5px; cursor: pointer; transition: all 0.2s ease-in-out;\n}\n.section-btn:hover { background-color: var(--item-bg-hover-color); color: var(--text-color); }\n.section-btn.active {\n    background-color: var(--primary-color); color: var(--background-color); font-weight: 700;\n    box-shadow: 0 0 10px var(--glow-color);\n}\n\n/* --- å¸–å­åˆ—è¡¨ --- */\n.thread-list-view {\n    grid-column: 2 / 3;\n    display: flex;\n    flex-direction: column;\n    border-right: 1px solid var(--border-color);\n    overflow: hidden;\n    background-color: rgba(0,0,0,0.1);\n}\n.thread-list-header { padding: 15px 20px; font-size: 1.3em; font-weight: 500; border-bottom: 1px solid var(--border-color); flex-shrink: 0; }\n#current-section-name { color: var(--primary-color); }\n.thread-list { flex-grow: 1; overflow-y: auto; padding: 10px; }\n.thread-item {\n    padding: 15px; margin-bottom: 10px; border-left: 3px solid transparent;\n    cursor: pointer; transition: all 0.2s ease;\n}\n.thread-item:hover { background-color: var(--item-bg-hover-color); }\n.thread-item.selected { background-color: var(--item-bg-hover-color); border-left-color: var(--primary-color); }\n.thread-title { font-size: 1.1em; font-weight: 500; margin-bottom: 8px; }\n.thread-meta { font-size: 0.9em; color: var(--text-secondary-color); display: flex; justify-content: space-between; align-items: center; }\n.thread-meta .author { color: var(--primary-color); }\n.thread-item .tags { margin-top: 8px; display: flex; gap: 8px; }\n.thread-item .tag {\n    font-size: 0.8em; padding: 3px 8px; border-radius: 12px;\n    font-weight: bold;\n}\n.tag.tag-top { background-color: var(--danger-color); color: white; }\n.tag.tag-elite { background-color: var(--success-color); color: var(--background-color); }\n\n \n.thread-detail-view {\n    grid-column: 3 / 4;\n    display: flex;\n    flex-direction: column;\n    overflow: hidden;\n}\n\n#thread-detail-content {\n    flex-grow: 1;\n    min-height: 0;\n    display: flex;\n    flex-direction: column;\n    overflow-y: auto; /* ä¿®æ”¹ï¼šå…è®¸æ•´ä¸ªå¸–å­è¯¦æƒ…åŒºæ»šåŠ¨ */\n}\n\n.post-header, .post-content, .post-actions {\n    padding-left: 25px;\n    padding-right: 25px;\n    flex-shrink: 0; /* å¸–å­å¤´éƒ¨ã€å†…å®¹å’Œæ“ä½œæ é«˜åº¦å›ºå®šï¼Œä¸å‚ä¸æ”¶ç¼© */\n}\n\n.post-header {\n    padding-top: 25px;\n}\n\n.replies-section {\n    flex-shrink: 0; /* ä¿®æ”¹ï¼šä¸å‚ä¸æ”¶ç¼© */\n    display: flex;\n    flex-direction: column;\n    border-top: 1px solid var(--border-color);\n    margin-top: 30px;\n}\n.reply-list {\n    padding-left: 25px;\n    padding-right: 15px;\n    /* ç§»é™¤ flex-grow å’Œ overflow-yï¼Œè®©çˆ¶å®¹å™¨å¤„ç†æ»šåŠ¨ */\n}\n.replies-header {\n    font-size: 1.4em;\n    padding: 20px 25px 0 25px;\n    margin: 0;\n    flex-shrink: 0;\n}\n\n \n\n.reply-item {\n    padding: 20px 10px 20px 0;\n    border-bottom: 1px solid var(--border-color);\n}\n.reply-item:last-child {\n    border-bottom: none;\n}\n \n.detail-placeholder { display: flex; height: 100%; align-items: center; justify-content: center; font-size: 1.2em; color: var(--text-secondary-color); text-align: center; }\n.post-header h1 { font-size: 1.8em; margin-bottom: 15px; line-height: 1.4; color: var(--primary-color); }\n.post-meta { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; color: var(--text-secondary-color); border-bottom: 1px solid var(--border-color); padding-bottom: 15px; }\n.post-author-info span { color: var(--primary-color); font-weight: 500;}\n.post-content { font-size: 1.1em; line-height: 1.8; margin-bottom: 30px; white-space: pre-wrap; }\n.post-actions { display: flex; align-items: center; gap: 20px; }\n.like-btn { display: flex; align-items: center; gap: 8px; cursor: pointer; user-select: none; color: var(--text-secondary-color); transition: color 0.2s; }\n.like-btn:hover { color: var(--danger-color); }\n.like-btn.liked { color: var(--danger-color); }\n.like-btn .like-icon { transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); }\n.like-btn.liked .like-icon { transform: scale(1.3); }\n.like-count { position: relative; }\n.like-count-value { transition: opacity 0.2s, transform 0.2s; }\n.like-count.updating .like-count-value { opacity: 0; transform: translateY(-5px); }\n\n/* --- å›å¤åŒº --- */\n.replies-header { font-size: 1.4em; border-top: 1px solid var(--border-color); padding-top: 30px; margin-top:30px; margin-bottom: 20px; }\n.reply-item { padding: 20px; border-bottom: 1px solid var(--border-color); }\n.reply-item:last-child { border-bottom: none; }\n.reply-meta { display: flex; justify-content: space-between; margin-bottom: 10px; color: var(--text-secondary-color); font-size: 0.9em; }\n.reply-author { color: var(--primary-color); font-weight: 500;}\n.reply-content { line-height: 1.7; }\n.reply-content.deleted {\n    color: var(--text-secondary-color);\n    font-style: italic;\n    background-color: rgba(128, 128, 128, 0.1);\n    padding: 10px;\n    border-radius: 4px;\n}\n\n/* --- åˆ†é¡µ --- */\n.pagination-controls { flex-shrink: 0; padding: 15px; display: flex; justify-content: center; align-items: center; gap: 10px; border-top: 1px solid var(--border-color); user-select: none; }\n.page-btn { background: none; border: 1px solid var(--border-color); color: var(--text-secondary-color); padding: 8px 15px; border-radius: 4px; cursor: pointer; }\n.page-btn:disabled { cursor: not-allowed; opacity: 0.4; }\n.page-btn:not(:disabled):hover { background-color: var(--item-bg-hover-color); color: var(--text-color); }\n#page-info { min-width: 60px; text-align: center; } \n.form-group { margin-bottom: 20px; }\n.form-group label { display: block; margin-bottom: 8px; color: var(--text-secondary-color); }\n.form-group input, .form-group select, .form-group textarea { width: 100%; padding: 12px; font-size: 1em; background-color: var(--background-color); border: 1px solid var(--border-color); border-radius: 5px; color: var(--text-color); font-family: var(--base-font-family); }\n.form-group input:focus, .form-group select:focus, .form-group textarea:focus { outline: none; border-color: var(--primary-color); box-shadow: 0 0 8px var(--glow-color); }\n.form-group textarea { min-height: 150px; resize: vertical; }\n.modal-actions { text-align: right; }\n#submit-post-btn { padding: 12px 25px; font-size: 1.1em; }\n\n/* --- åŠ¨ç”»æ•ˆæœ --- */\n\n.thread-item, .reply-item { animation: fadeIn 0.5s ease-out forwards; }\n@keyframes plusOne { 0% { transform: translateY(0) scale(1); opacity: 1; color: var(--success-color); } 100% { transform: translateY(-30px) scale(1.5); opacity: 0; } }\n.plus-one-anim { position: absolute; top: -10px; left: 50%; transform: translateX(-50%); font-size: 1.2em; font-weight: bold; pointer-events: none; animation: plusOne 1s ease-out forwards; }\n\n /* ä½ç½®ï¼šæ›¿æ¢æ‰æ–‡ä»¶ä¸­æ—§çš„ @media (max-width: 768px) { ... } æ•´å—ä»£ç  */\n\n@media (max-width: 768px) {\n    body { padding: 0; }\n    #forum-wrapper { border-radius: 0; height: 100vh; border: none; }\n#user-input {\n    \n     padding: 0px; /* æ·»åŠ è¿™è¡Œ - ä¸Šä¸‹8pxï¼Œå·¦å³12pxçš„å†…è¾¹è· */\n \n}\n    .forum-body {\n        display: block; /* æ”¾å¼ƒGridï¼Œä½¿ç”¨å—çº§å¸ƒå±€ */\n        position: relative;\n        overflow: hidden;\n    }\n\n   .forum-sidebar {\n        flex-direction: row;\n        flex-wrap: nowrap;\n        overflow-x: auto;\n        border-right: none;\n        border-bottom: 1px solid var(--border-color);\n        padding: 10px;\n        gap: 5px; /* å‡å°‘é—´è·ä»¥å®¹çº³æ›´å¤šæŒ‰é’® */\n        -webkit-overflow-scrolling: touch;\n    }\n\n    .section-btn {\n        flex: 1; /* è®©æŒ‰é’®å¹³åˆ†å®½åº¦ */\n        min-width: 0; /* å…è®¸æ”¶ç¼©åˆ°æœ€å°å®½åº¦ */\n        white-space: nowrap;\n        font-size: 0.9em; /* ç¨å¾®å‡å°å­—ä½“ä»¥é€‚åº”æ›´å°çš„æŒ‰é’® */\n        padding: 10px 8px; /* è°ƒæ•´å†…è¾¹è· */\n        text-align: center; /* ç¡®ä¿æ–‡å­—å±…ä¸­ */\n    }\n\n    /* é»˜è®¤éšè—è¯¦æƒ…é¡µï¼Œæ˜¾ç¤ºåˆ—è¡¨é¡µ */\n    .thread-detail-view {\n        position: absolute;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%;\n        transform: translateX(100%);\n        transition: transform 0.4s cubic-bezier(0.25, 1, 0.5, 1);\n        background-color: var(--background-color);\n        z-index: 10;\n        grid-column: auto; /* é‡ç½®gridå¸ƒå±€ */\n    }\n\n    /* å½“éœ€è¦æ˜¾ç¤ºè¯¦æƒ…æ—¶ï¼Œç»™çˆ¶å®¹å™¨æ·»åŠ class */\n    .forum-body.show-detail .thread-detail-view {\n        transform: translateX(0);\n    }\n\n    .thread-list-view {\n        grid-column: auto; /* é‡ç½®gridå¸ƒå±€ */\n        border-right: none;\n        height: 100%; /* ç¡®ä¿å®ƒå æ»¡çˆ¶å®¹å™¨é«˜åº¦ */\n    }\n\n     #mobile-back-btn {\n        display: block !important; /* å¼ºåˆ¶åœ¨ç§»åŠ¨ç«¯æ˜¾ç¤º */\n        margin-bottom: 15px;\n    }\n}\n\n/* åœ¨æ¡Œé¢ç«¯éšè—è¿”å›æŒ‰é’® */\n@media (min-width: 769px) {\n    #mobile-back-btn {\n        display: none !important;\n    }\n}\n/* --- å¸–å­è¯¦æƒ…å†…éƒ¨å¸ƒå±€ --- */\n\n.post-header, .post-content, .post-actions {\n    padding-left: 25px;\n    padding-right: 25px;\n    flex-shrink: 0; /* å¸–å­æ ‡é¢˜å’Œå†…å®¹åŒºåŸŸä¸æ”¶ç¼© */\n}\n\n.post-header {\n    padding-top: 25px;\n}\n\n.replies-section {\n    flex-grow: 1; /* è®©å›å¤åŒºåŸŸå¡«æ»¡å‰©ä½™ç©ºé—´ */\n    min-height: 0; /* å…³é”®ï¼ */\n    display: flex;\n    flex-direction: column;\n    border-top: 1px solid var(--border-color);\n    margin-top: 30px;\n}\n\n.replies-header {\n    font-size: 1.4em;\n    padding: 20px 25px 0 25px;\n    margin-bottom: 10px;\n    flex-shrink: 0;\n}\n\n.reply-list {\n    flex-grow: 1; /* å æ®å›å¤åŒºåŸŸçš„æ‰€æœ‰å¯ç”¨ç©ºé—´ */\n    overflow-y: auto; /* æœ€ç»ˆçš„æ»šåŠ¨æ¡åœ¨è¿™é‡Œï¼ */\n    padding-left: 25px;\n    padding-right: 15px; /* å³ä¾§ç•™å‡ºæ»šåŠ¨æ¡ç©ºé—´ */\n}\n\n.reply-item {\n    padding: 20px 10px 20px 0; /* è°ƒæ•´å†…è¾¹è·ï¼Œå› ä¸ºå¤–å±‚å·²ç»æœ‰padding-left */\n    border-bottom: 1px solid var(--border-color);\n}\n \n\n/* ä½ç½®ï¼š<style> æ ‡ç­¾å†…ï¼Œæ‰€æœ‰å…¶ä»–CSSè§„åˆ™ä¹‹å */\n\n/* --- æ»šåŠ¨æ¡ç¾åŒ– --- */\n::-webkit-scrollbar {\n    width: 8px;\n    height: 8px;\n}\n::-webkit-scrollbar-track {\n    background: rgba(0,0,0,0.2);\n    border-radius: 4px;\n}\n::-webkit-scrollbar-thumb {\n    background-color: var(--border-color);\n    border-radius: 4px;\n    transition: background-color 0.2s ease-in-out;\n}\n::-webkit-scrollbar-thumb:hover {\n    background-color: var(--primary-color);\n}\n\n.replies-omitted-indicator {\n    text-align: center;\n    color: var(--text-secondary-color);\n    padding: 20px 0;\n    font-style: italic;\n    opacity: 0.7;\n    user-select: none;\n}\n\n/* --- æ–°å¢ï¼šå›å¤è¾“å…¥åŒºæ ·å¼ --- */\n.reply-input-section {\n    padding: 20px 25px;\n    border-top: 1px solid var(--border-color);\n    background-color: var(--item-bg-color);\n    flex-shrink: 0;\n    margin-top: auto; /* å°†å…¶æ¨åˆ°åº•éƒ¨ */\n}\n#reply-form {\n    display: flex;\n    gap: 15px;\n    align-items: flex-start;\n}\n#reply-content-input {\n    flex-grow: 1;\n    min-height: 40px; /* åˆå§‹é«˜åº¦ */\n    max-height: 120px; /* æœ€å¤§é«˜åº¦ */\n    padding: 10px;\n    resize: vertical;\n    width: 100%;\n    font-size: 1em;\n    background-color: var(--item-bg-color);\n    border: 1px solid var(--border-color);\n    border-radius: 5px;\n    color: var(--text-color);\n    font-family: var(--base-font-family);\n}\n#submit-reply-btn {\n    padding: 10px 20px;\n    height: 40px;\n    flex-shrink: 0;\n}\n.post-actions button {\n    background: none;\n    border: 1px solid var(--border-color);\n    color: var(--text-secondary-color);\n    padding: 6px 12px;\n    border-radius: 4px;\n    cursor: pointer;\n    transition: all 0.2s ease;\n}\n.post-actions button:hover {\n    background-color: var(--item-bg-hover-color);\n    color: var(--text-color);\n}\n\n\n      #top-left-orbs {\n            position: absolute;\n            top: 10px;\n            left: 10px;\n            display: flex;\n            gap: 8px;\n            z-index: 1050; /* æ¯”å…¶ä»–ç•Œé¢å…ƒç´ æ›´é«˜ */\n        }\n\n        .top-orb {\n            width: 32px;\n            height: 32px;\n            background-color: var(--container-bg-color);\n            border: 1px solid var(--border-color);\n            color: var(--primary-color);\n            border-radius: 50%;\n            display: flex;\n            justify-content: center;\n            align-items: center;\n            font-size: 16px;\n            cursor: pointer;\n            transition: all 0.2s ease-in-out;\n            box-shadow: 0 0 8px transparent;\n        }\n\n        .top-orb:hover {\n            background-color: var(--border-color);\n            box-shadow: 0 0 12px var(--glow-color);\n        }\n\n \n\n        .orb-flash {\n             animation: notify-flash 1s 8;\n        }\n\n        /* è®ºå›æ¨¡æ€æ¡†çš„ä¸“ç”¨æ ·å¼ */\n        #forum-modal-container {\n            display: none; /* é»˜è®¤éšè— */\n            position: fixed;\n            top: 0px;\n            left: 0;\n            width: 100%;\n            height: 100%;\n            background-color: rgba(0, 0, 0, 0.6);\n            z-index: 1040; /* ä»…æ¬¡äºå°çƒ */\n            display: flex;\n            justify-content: center;\n            align-items: center;\n        }\n\n        #forum-modal-container.active {\n            display: flex;\n        }\n\n        #forum-modal-content {\n            width: 90%;\n            height: 85%;\n            max-width: 1400px;\n            position: relative;\n        }\n\n        #forum-modal-content #forum-wrapper {\n            width: 100%;\n            height: 100%;\n            display: flex; /* ç¡®ä¿å†…å®¹æ’‘æº€ */\n            flex-direction: column;\n        }\n\n        #forum-modal-close-btn {\n            position: absolute;\n            top: 10px;\n            right: 0px;\n            background: none;\n            border: none;\n            font-size: 28px;\n            color: var(--text-color);\n            cursor: pointer;\n            z-index: 10;\n        }\n\n        .dialogue-quote {\n    color: var(--text-secondary-color); /* å¦ˆå¦ˆä¸ºä½ é€‰æ‹©äº†è¿™ä¸ªæŸ”å’Œåˆæ˜äº®çš„é¢œè‰² */\n    font-style: italic; /* æˆ‘ä»¬è¿˜è®©å®ƒç¨å¾®å€¾æ–œï¼Œçœ‹èµ·æ¥æ›´åŠ ç‰¹åˆ«ï¼Œä½ è§‰å¾—å‘¢ï¼Ÿ */\n}\n\n/* ä»£ç  START: æ·»åŠ åœ¨è¿™é‡Œ */\n@keyframes notify-flash {\n    0%, 100% {\n        box-shadow: 0 0 4px var(--glow-color);\n        transform: scale(1);\n    }\n    50% {\n        box-shadow: 0 0 15px 3px var(--primary-color), 0 0 25px 8px var(--glow-color);\n        transform: scale(1.1);\n    }\n}\n\n.notify {\n    /* åŠ¨ç”»æŒç»­1ç§’ï¼Œæ‰§è¡Œä¸¤æ¬¡ï¼Œæ€»å…±2ç§’ */\n    animation: notify-flash 1s 8;\n}\n\n /* ========== æ–°å¢ï¼šå³æ—¶æŠ•éª°ç»“æœçœ‹æ¿æ ·å¼ ========== */\n.roll-result-card-container {\n    position: fixed;\n    top: -100%; /* åˆå§‹ä½ç½®åœ¨å±å¹•å¤– */\n    left: 50%;\n    transform: translateX(-50%);\n    width: 90%;\n    max-width: 500px;\n    background-color: var(--container-bg-color);\n    border: 1px solid var(--border-color);\n    border-radius: 0 0 12px 12px;\n    box-shadow: 0 8px 30px var(--glow-color);\n    z-index: 9999;\n    padding: 20px;\n    color: var(--text-color);\n    font-family: inherit;\n    transition: top 0.5s cubic-bezier(0.25, 0.8, 0.25, 1);\n    display: none; /* åˆå§‹éšè— */\n}\n\n/* çœ‹æ¿æ»‘å…¥åŠ¨ç”» */\n.roll-result-card-container.show {\n    top: 20px;\n}\n\n  /* ========== è¾‰ç…ŒæˆåŠŸçš„å…‰è¾‰æ•ˆæœ (å¢å¼ºç‰ˆ) ========== */\n\n/* ä¸º .glorious çŠ¶æ€ä¸‹çš„å¡ç‰‡å®¹å™¨æ·»åŠ åŸºç¡€æ ·å¼å’ŒåŠ¨ç”» */\n.roll-result-card-container.glorious {\n    /* å¿…é¡»è®¾ç½®ï¼Œç”¨äºå°†ä¼ªå…ƒç´ é™åˆ¶åœ¨å®¹å™¨å†…éƒ¨ï¼Œå¹¶è£å‰ªæ—‹è½¬çš„è¾¹æ¡†å…‰æ•ˆ */\n    overflow: hidden;\n\n    /* å¢å¼ºçš„åŸºç¡€è¾‰å…‰æ•ˆæœï¼Œä½¿ç”¨å¤šç§å˜é‡é¢œè‰² */\n    box-shadow: 0 0 30px 10px var(--primary-color), \n                0 0 50px 18px var(--glow-color),\n                0 0 70px 25px var(--secondary-color);\n\n    /* åº”ç”¨å¤šä¸ªåŠ¨ç”»ï¼š\n       1. glorious-sweep: èƒŒæ™¯æµå…‰æ‰«è¿‡æ•ˆæœï¼Œ4ç§’ä¸€æ¬¡ï¼Œç¼“å…¥ç¼“å‡º\n       2. glorious-pulse: å¢å¼ºçš„è¾‰å…‰è„‰å†²ï¼Œæ›´æ˜æ˜¾çš„å‘¼å¸æ„Ÿï¼Œ2.5ç§’ä¸€æ¬¡\n       3. glorious-float: æ•´ä½“çœ‹æ¿è½»å¾®æµ®åŠ¨æ•ˆæœï¼Œ3ç§’ä¸€æ¬¡\n    */\n    animation: glorious-sweep 4s infinite ease-in-out,\n               glorious-pulse 2.5s infinite ease-in-out,\n               glorious-float 3s infinite ease-in-out;\n}\n\n/* åˆ›å»ºä¸€ä¸ªä¼ªå…ƒç´ ç”¨äºæ‰¿è½½æ—‹è½¬çš„è¾¹æ¡†å…‰æ•ˆ */\n.roll-result-card-container.glorious::before {\n    content: '';\n    position: absolute;\n    top: -3px; \n    left: -3px;\n    width: calc(100% + 6px);\n    height: calc(100% + 6px);\n\n \nopacity: 0.6;\n \n\n    /* å°†ä¼ªå…ƒç´ ç½®äºçˆ¶å…ƒç´ çš„èƒŒæ™¯ä¹‹ä¸‹ï¼Œä½†å†…å®¹ä¹‹ä¸Š */\n    z-index: -1; \n    border-radius: inherit;\n}\n\n/* å…³é”®å¸§åŠ¨ç”»å®šä¹‰ */\n\n/* 1. èƒŒæ™¯æ–œå‘æµå…‰æ‰«è¿‡æ•ˆæœ */\n@keyframes glorious-sweep {\n    0% {\n        /* å®šä¹‰èƒŒæ™¯ä¸ºä¸€ä¸ªå·¨å¤§çš„ã€å€¾æ–œçš„çº¿æ€§æ¸å˜ */\n        background-image: linear-gradient(\n            115deg, /* å€¾æ–œè§’åº¦ï¼Œæ¨¡æ‹Ÿæ–œä¸Šåˆ°æ–œä¸‹ */\n            transparent 25%,\n            var(--glow-color) 45%,\n            var(--primary-color) 50%,\n            var(--secondary-color) 52%,\n            var(--glow-color) 55%,\n            transparent 75%\n        );\n        background-size: 300% 300%; /* èƒŒæ™¯å°ºå¯¸æ”¾å¤§ï¼Œç¡®ä¿æµå…‰æŸ”å’Œ */\n        background-position: 150% 150%; /* åˆå§‹ä½ç½®ï¼Œå°†æµå…‰ç½®äºå³ä¸‹è§’è§†é‡å¤– */\n    }\n    50% {\n        background-position: -50% -50%; /* åŠ¨ç”»ä¸­ç‚¹ï¼Œå°†æµå…‰ç§»åŠ¨åˆ°å·¦ä¸Šè§’è§†é‡å¤– */\n    }\n    100% {\n        background-position: 150% 150%; /* å›åˆ°åˆå§‹ä½ç½®ï¼Œå½¢æˆå¾ªç¯ */\n    }\n}\n\n/* 2. æ—‹è½¬è¾¹æ¡†å…‰æ•ˆ */\n@keyframes glorious-border-spin {\n    from {\n        transform: rotate(0deg);\n    }\n    to {\n        transform: rotate(360deg);\n    }\n}\n\n/* 3. å¢å¼ºçš„è¾‰å…‰è„‰å†²ï¼Œæ›´æ˜æ˜¾çš„å‘¼å¸æ„Ÿ */\n@keyframes glorious-pulse {\n    0%, 100% {\n        box-shadow: 0 0 30px 10px var(--primary-color), \n                    0 0 50px 18px var(--glow-color),\n                    0 0 70px 25px var(--secondary-color);\n    }\n    50% {\n        box-shadow: 0 0 45px 15px var(--primary-color), \n                    0 0 70px 25px var(--glow-color),\n                    0 0 90px 35px var(--secondary-color),\n                    0 0 110px 40px var(--border-color);\n    }\n}\n\n/* 4. æ–°å¢ï¼šæ•´ä½“çœ‹æ¿è½»å¾®æµ®åŠ¨æ•ˆæœ */\n@keyframes glorious-float {\n    0%, 100% {\n        transform: translateX(-50%) translateY(0px) scale(1);\n    }\n    33% {\n        transform: translateX(-50%) translateY(-3px) scale(1.01);\n    }\n    66% {\n        transform: translateX(-50%) translateY(3px) scale(0.99);\n    }\n}\n.roll-result-card-container.shattered {\n    animation: shatter-effect 1.5s infinite ease-in-out; \n    border-color: var(--danger-color);\n}\n\n/* ä¿®æ”¹åï¼šå¤§å¤±è´¥çš„æ‘‡æ™ƒæ•ˆæœï¼ˆä¸å†è‡ªåŠ¨æ¶ˆå¤±ï¼‰ */\n@keyframes shatter-effect {\n    0%, 100% { transform: translateX(-50%) rotate(0deg); }\n    20% { transform: translateX(-52%) rotate(-2deg); }\n    40% { transform: translateX(-48%) rotate(2deg); }\n    60% { transform: translateX(-51%) rotate(-1deg); }\n    80% { transform: translateX(-49%) rotate(1deg); }\n}\n\n.roll-card-content {\n    display: flex;\n    flex-direction: column;\n    gap: 15px;\n    background: linear-gradient(145deg, var(--container-bg-color), var(--border-color));\n    border: 2px solid var(--glow-color);\n    border-radius: 8px;\n    padding: 15px;\n    box-shadow: inset 0 0 10px var(--glow-color), 0 4px 20px var(--border-color);\n}\n\n.roll-card-header {\n    font-size: 1.2em;\n    font-weight: bold;\n    color: var(--primary-color);\n    text-align: center;\n    border-bottom: 1px solid var(--border-color);\n    padding-bottom: 10px;\n}\n\n.roll-card-dice-area {\n    display: flex;\n    flex-direction: column;\n    gap: 15px;\n    align-items: center;\n    font-size: 1.5em;\n    padding: 10px 0;\n}\n.roll-card-divider {\n    width: 80%;\n    height: 2px;\n    background: linear-gradient(90deg, \n        transparent 0%, \n        var(--border-color) 20%, \n        var(--glow-color) 50%, \n        var(--border-color) 80%, \n        transparent 100%);\n    margin: 15px auto;\n    border-radius: 1px;\n    box-shadow: 0 0 8px var(--glow-color);\n}\n.roll-card-dice-section {\n    text-align: center;\n}\n\n.roll-card-dice-section .label {\n    font-size: 0.65em;\n    color: var(--text-secondary-color);\n    display: block;\n    opacity: 0.7;\n    margin-bottom: 8px;\n}\n\n.roll-card-dice-section .dice-value {\n    font-weight: bold;\n    font-size: 1.8em;\n}\n\n/* éª°å­æ•°å€¼é¢œè‰² */\n.dice-low { \n    color: var(--text-secondary-color); \n    font-weight: 800;\n}\n.dice-high { \n    color: var(--secondary-color); \n    font-weight: 800;\n}\n.dice-crit {\n    color: var(--primary-color);\n    text-shadow: 0 0 8px var(--glow-color), 0 0 12px var(--primary-color);\n    font-weight: 800;\n}\n\n.roll-card-vs {\n    font-size: 1em;\n    color: var(--text-secondary-color);\n}\n\n.roll-card-result-area {\n    text-align: center;\n}\n\n.roll-card-outcome {\n    font-size: 1.4em;\n    font-weight: bold;\n    margin-bottom: 5px;\n    display: inline-block;\n    padding: 8px 20px;\n    border: 3px solid;\n    border-radius: 50px;\n    background: var(--container-bg-color);\n    box-shadow: 0 0 10px var(--glow-color), inset 0 0 5px var(--border-color);\n    text-transform: uppercase;\n    letter-spacing: 1px;\n}\n\n/* ä¸åŒç»“æœçš„å°ç« é¢œè‰² */\n.roll-card-outcome.critical-failure {\n    color: var(--danger-color);\n    border-color: var(--danger-glow-color);\n    text-shadow: 0 0 5px var(--danger-glow-color);\n}\n.roll-card-outcome.failure {\n    color: var(--text-secondary-color);\n    border-color: var(--text-secondary-color);\n    text-shadow: 0 0 5px var(--text-secondary-color);\n}\n.roll-card-outcome.partial-success {\n    color: var(--border-color);\n    border-color: var(--border-color);\n    text-shadow: 0 0 5px var(--border-color);\n}\n.roll-card-outcome.success {\n    color: var(--secondary-color);\n    border-color: var(--secondary-color);\n    text-shadow: 0 0 5px var(--secondary-color);\n}\n.roll-card-outcome.glorious-success {\n    color: var(--primary-color);\n    border-color: var(--primary-color);\n    text-shadow: 0 0 5px var(--glow-color);\n}\n.roll-card-description {\n    font-size: 0.95em;\n    color: var(--text-secondary-color);\n    font-style: italic;\n}\n\n.roll-card-damage {\n    margin-top: 10px;\n    font-size: 1.1em;\n    font-weight: bold;\n    color: var(--danger-color);\n}\n\n/* éª°å­ç›–ç« åŠ¨ç”»æ•ˆæœ */\n.dice-number {\n    display: inline-block;\n    opacity: 0;\n    transform: scale(0);\n    animation: dice-stamp 0.6s ease-out forwards;\n}\n\n@keyframes dice-stamp {\n    0% {\n        opacity: 0;\n        transform: scale(0) rotate(-15deg);\n    }\n    50% {\n        opacity: 0.8;\n        transform: scale(1.3) rotate(-5deg);\n    }\n    70% {\n        opacity: 1;\n        transform: scale(0.9) rotate(2deg);\n    }\n    100% {\n        opacity: 1;\n        transform: scale(1) rotate(0deg);\n    }\n}\n/* â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”åˆå§‹åŒ–â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” */\n\n   .radar-charts-container {\n            display: grid;\n            grid-template-columns: 1fr; /* æ”¹ä¸ºå•åˆ—å¸ƒå±€ */\n            gap: 2.5rem; /* å¢å¤§é—´è· */\n            margin: 2rem 0;\n        }\n\n        /* å¦ˆå¦ˆä¸ºä½ æ–°å¢çš„ç¯ç»•å¸ƒå±€æ ·å¼ */\n        .radar-layout {\n            display: grid;\n            grid-template-columns: 300px 1fr; /* å·¦è¾¹é›·è¾¾å›¾ï¼Œå³è¾¹åŠ ç‚¹é¡¹ */\n            gap: 2rem;\n            align-items: center;\n            padding: 1.5rem;\n            background-color: rgba(26, 23, 32, 0.3);\n            border-radius: 8px;\n            border: 1px solid var(--border-color);\n        }\n\n        .radar-layout .radar-chart-item {\n            display: flex;\n            flex-direction: column;\n            align-items: center;\n            justify-content: center; /* å‚ç›´å±…ä¸­ */\n            height: 100%;\n        }\n\n        .radar-layout .allocators-container {\n            display: flex;\n            flex-direction: column;\n            gap: 0.5rem;\n            max-height: 320px; /* æ§åˆ¶æœ€å¤§é«˜åº¦ï¼Œè¶…å‡ºå¯æ»šåŠ¨ */\n            overflow-y: auto;\n            padding-right: 1rem; /* ä¸ºæ»šåŠ¨æ¡ç•™å‡ºç©ºé—´ */\n        }\n.radar-chart-item {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n}\n\n.radar-chart-title {\n    color: var(--secondary-color);\n    font-size: 1em;\n    margin-bottom: 1rem;\n    letter-spacing: 1px;\n    text-align: center;\n}\n\n.radar-chart-canvas {\n    width: 100% !important;\n    height: 250px !important;\n    max-width: 300px;\n}\n\n\n        h1, h2, h3 {\n            font-weight: 500;\n            letter-spacing: 2px;\n        }\n\n        .header { text-align: center; margin-bottom: 2.5rem; }\n        h1 { font-size: 2.2em; font-weight: 300; letter-spacing: 8px; text-transform: uppercase; margin: 0; color: var(--text-color);   }\n        .subtitle { font-size: 0.9em; color: var(--text-secondary-color); letter-spacing: 3px; margin-top: 0.7rem; text-transform: uppercase; }\n        .form-section { margin-bottom: 2rem; }\n        .form-section h2 { font-size: 1.1em; color: var(--secondary-color); border-bottom: 1px solid var(--border-color); padding-bottom: 0.5rem; margin-bottom: 1.5rem; }\n        h3 { font-size: 1em; color: var(--info-color, #4db6ac); margin-top: 2rem; margin-bottom: 1rem; letter-spacing: 1px; }\n\n        .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem; }\n        .form-group { display: flex; flex-direction: column; }\n        label { margin-bottom: 0.5rem; font-size: 0.85em; color: var(--text-secondary-color); letter-spacing: 1px; }\n\n          .custom-select, input[type=\"text\"], input[type=\"number\"] {\n            font-family: inherit;\n            background-color: var(--background-color);\n            color: var(--text-color);\n            border: 1px solid var(--border-color);\n            border-radius: 4px;\n            padding: 0.7rem 1rem;\n            font-size: 0.95em;\n            transition: all 0.3s ease;\n            appearance: none;\n            -webkit-appearance: none;\n            -moz-appearance: none;\n            /* å¦ˆå¦ˆåœ¨è¿™é‡Œä¸ºä½ åŠ ä¸Šäº†ä¸‰è¡Œé­”æ³•ä»£ç  */\n            white-space: nowrap;\n            overflow: hidden;\n            text-overflow: ellipsis;\n \n \n        }\n       .custom-select {\n            background-image: linear-gradient(45deg, transparent 50%, var(--text-color) 50%), linear-gradient(135deg, var(--text-color) 50%, transparent 50%);\n            background-position: calc(100% - 20px) calc(1em + 2px), calc(100% - 15px) calc(1em + 2px);\n            background-size: 5px 5px, 5px 5px;\n            background-repeat: no-repeat;\n            padding-right: 2.5rem;\n             \n            border-color: var(--border-color); background-color: var(--background-color);\n        }\n        .custom-select:hover, input:hover { border-color: var(--border-color); background-color: var(--background-color); }\n        .custom-select:focus, input:focus { outline: none; border-color: var(--primary-color); box-shadow: 0 0 8px rgba(200, 106, 163, 0.4); }\n        input::placeholder { color: var(--text-secondary-color); opacity: 0.7; background-color: var(--background-color); }\n\n         .teammate-item { display: grid; grid-template-columns: 1fr; gap: 0.5rem; margin-bottom: 0.8rem; padding: 0.8rem; background-color: var(--background-color); border-radius: 4px; border: 1px solid var(--border-color); }\n        .teammate-item input { font-size: 0.85em; padding: 0.5rem; }\n        .add-teammate-btn, .remove-teammate-btn { cursor: pointer; transition: all 0.3s ease; }\n        .add-teammate-btn { background-color: var(--info-color, #4db6ac); color: white; border: none; padding: 0.5rem 1rem; border-radius: 4px; font-size: 0.85em; margin-top: 0.5rem; }\n        .add-teammate-btn:hover { background-color: #6ba85c; }\n        .remove-teammate-btn { background: linear-gradient(135deg, var(--primary-color), #b85d93); color: white; border: none; padding: 0.4rem 0.8rem; border-radius: 6px; font-size: 0.75em; font-weight: 500; justify-self: end; }\n        .remove-teammate-btn:hover { background: linear-gradient(135deg, #b85d93, var(--primary-color)); transform: translateY(-1px); }\n\n        .button-container { text-align: center; margin-top: 3rem; padding-top: 1.5rem; border-top: 1px solid var(--border-color); }\n \n        /* æ–°å¢åˆ†é…é¡µæ ·å¼ */\n        .points-tracker { text-align: center; font-size: 1.2em; margin-bottom: 2rem; color: var(--primary-color); letter-spacing: 2px; }\n        .points-tracker span { font-weight: 700; font-size: 1.4em; padding: 0 0.5ch; }\n\n        .åˆ†é…é¡¹ {\n            display: flex;\n            align-items: center;\n            justify-content: space-between;\n            padding: 0.8rem 1rem;\n            margin-bottom: 0.5rem;\n            background-color: var(--background-color);\n            \n            border-radius: 4px;\n        }\n        .åˆ†é…-æ ‡ç­¾ { flex: 1; display: flex; flex-direction: column; }\n        .åˆ†é…-æ ‡ç­¾-ä¸» { font-size: 1em; color: var(--text-color); }\n        .åˆ†é…-æ ‡ç­¾-è¯´æ˜ { font-size: 0.75em; color: var(--text-secondary-color); }\n        .åˆ†é…-æ§åˆ¶å™¨ { display: flex; align-items: center; gap: 0.8rem; }\n        .åˆ†é…-æŒ‰é’® { background-color: var(--glow-color); border: 1px solid var(--border-color); color: var(--text-color); width: 28px; height: 28px; border-radius: 50%; cursor: pointer; font-size: 1.2em; line-height: 1; transition: all 0.2s; }\n        .åˆ†é…-æŒ‰é’®:hover { background-color: var(--secondary-color); border-color: var(--secondary-color); color: #fff; }\n        .åˆ†é…-æŒ‰é’®:disabled { background-color: transparent; border-color: var(rgba(168, 192, 225, 0.3)); color: var(rgba(168, 192, 225, 0.3)); cursor: not-allowed; }\n        .åˆ†é…-ç‚¹æ•° { font-size: 1.1em; width: 2ch; text-align: center; color: var(--info-color, #4db6ac); }\n\n\n  \n\n          .collapsible-header {\n            cursor: pointer;\n            position: relative;\n            user-select: none; /* é˜²æ­¢åŒå‡»é€‰ä¸­æ–‡æœ¬ */\n            padding-right: 25px; /* ä¸ºç®­å¤´ç•™å‡ºç©ºé—´ */\n            transition: color 0.3s ease;\n        }\n        .collapsible-header::after {\n            content: 'â–¼';\n            position: absolute;\n            right: 0;\n            top: 50%;\n            transform: translateY(-50%);\n            font-size: 0.8em;\n            color: var(--text-secondary-color);\n            transition: transform 0.3s ease;\n        }\n        .collapsible-header.collapsed::after {\n            transform: translateY(-50%) rotate(-90deg);\n        }\n        .collapsible-content {\n            max-height: 1000px; /* ä¸€ä¸ªè¶³å¤Ÿå¤§çš„å€¼ï¼Œç¡®ä¿èƒ½å®Œå…¨æ˜¾ç¤º */\n            overflow: hidden;\n            transition: max-height 0.4s ease-in-out;\n        }\n        .collapsible-content.collapsed {\n            max-height: 0;\n        }\n\n           /* --- å¦ˆå¦ˆä¸ºä½ åšçš„æ»šåŠ¨æ¡ç¾åŒ– --- */\n        ::-webkit-scrollbar {\n            width: 8px;\n            height: 8px;\n        }\n        ::-webkit-scrollbar-track {\n            background: rgba(0, 0, 0, 0.1);\n            border-radius: 10px;\n        }\n        ::-webkit-scrollbar-thumb {\n            background-color: var(--primary-color);\n            border-radius: 10px;\n            border: 2px solid transparent;\n            background-clip: content-box;\n        }\n        ::-webkit-scrollbar-thumb:hover {\n            background-color: var(--secondary-color);\n        }\n\n        /* --- å¦ˆå¦ˆä¸ºä½ åšçš„æ‰‹æœºç«¯é€‚é… --- */\n       /* --- å¦ˆå¦ˆä¸ºä½ åšçš„æ‰‹æœºç«¯é€‚é… --- */\n        @media (max-width: 768px) {\n            .terminal {\n                padding: 1rem; /* æ‰‹æœºç«¯è¾¹è·å°ä¸€ç‚¹ */\n            }\n\n            #shop-search-input{\n                display: none;\n            }\n\n            .radar-layout {\n                grid-template-columns: 1fr; /* ğŸ’– é‡ç‚¹åœ¨è¿™é‡Œï¼Œå˜æˆå•åˆ—å¸ƒå±€ï¼Œè‡ªåŠ¨ä¸Šä¸‹æ’åˆ— ğŸ’– */\n                gap: 1.5rem;\n            }\n\n            /* --- ğŸ’– å¦ˆå¦ˆä¸ºä½ æ–½å±•äº†æ–°çš„é­”æ³• ğŸ’– --- */\n            .radar-layout .allocators-container {\n                max-height: 280px;      /* å¦ˆå¦ˆæŠŠå®ƒçš„é«˜åº¦é™åˆ¶å¾—å’Œé›·è¾¾å›¾å·®ä¸å¤šé«˜äº† */\n                overflow-y: auto;       /* è¿™æ ·å½“å†…å®¹å¤ªå¤šçš„æ—¶å€™ï¼Œå°±å¯ä»¥æ¸©æŸ”åœ°æ»šåŠ¨å•¦ */\n                padding-right: 0.5rem;  /* å†ç»™æ»šåŠ¨æ¡ç•™å‡ºä¸€ç‚¹ç‚¹ç©ºé—´ï¼Œå…å¾—æŒ¤åˆ°å†…å®¹ */\n            }\n        }\n \n\n \n\n        /* ä»»åŠ¡æ€»ç»“ */\n            /* å¤ç±ç¾Šçš®çº¸ä¸»é¢˜çš„ç‰¹æ®Šå­—ä½“å’Œé˜´å½± */\n        body[data-theme-name=\"å¤ç±ç¾Šçš®çº¸\"] {\n            font-family: var(--base-font-family);\n            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);\n        }\n\n        body[data-theme-name=\"å¤ç±ç¾Šçš®çº¸\"] .task-summary-main-container h1,\n        body[data-theme-name=\"å¤ç±ç¾Šçš®çº¸\"] .task-summary-main-container h2 {\n           font-family: var(--base-font-family);\n           font-weight: bold;\n        }\n .task-summary-main-container {\n            width: 90vw;\n            max-width: 1200px;\n           height: 85vh; /* ä¿®æ”¹ä¸º85vh */\n    max-height: none; /* ç§»é™¤max-heighté™åˆ¶ï¼Œè®©85vhç”Ÿæ•ˆ */\n            background-color: var(--container-bg-color);\n            border: 1px solid var(--border-color);\n            border-radius: 15px;\n            box-shadow: 0 0 15px 5px var(--glow-color);\n            display: flex;\n            flex-direction: column;\n            overflow: hidden; /* ç¡®ä¿å­å…ƒç´ ä¸ä¼šæº¢å‡ºåœ†è§’ */\n            transition: all 0.5s ease-in-out;\n        }\n .content-wrapper {\n            display: flex;\n            flex-grow: 1;\n            overflow: auto; /* ä¿®æ”¹ä¸ºautoï¼Œå…è®¸æ»šåŠ¨ */\n        }\n\n        .tabs-nav {\n            display: flex;\n            flex-direction: column;\n            padding: 20px 0;\n            border-right: 1px solid var(--border-color);\n            background-color: var(--tab-bg-color);\n            flex-shrink: 0;\n        }\n\n        .tab-button {\n            background: none;\n            border: none;\n            padding: 15px 25px;\n            cursor: pointer;\n            color: var(--tab-inactive-color);\n            font-size: 1.1em;\n            text-align: left;\n            transition: all 0.3s ease;\n            position: relative;\n            white-space: nowrap;\n        }\n\n        .tab-button:not(:last-child) {\n            margin-bottom: 10px;\n        }\n\n        .tab-button.active {\n            color: var(--primary-color);\n            background-color: var(--tab-active-bg-color);\n        }\n\n        .tab-button.active::before {\n            content: '';\n            position: absolute;\n            left: 0;\n            top: 0;\n            width: 4px;\n            height: 100%;\n            background-color: var(--primary-color);\n            box-shadow: 0 0 8px var(--glow-color);\n            border-radius: 0 4px 4px 0;\n        }\n\n        .tab-content-container {\n            flex-grow: 1;\n            position: relative;\n            overflow: hidden;\n        }\n\n        .tab-pane {\n            position: absolute;\n            top: 0;\n            left: 0;\n            width: 100%;\n            height: 100%;\n            padding: 30px;\n            box-sizing: border-box;\n            opacity: 0;\n            visibility: hidden;\n            transition: opacity 0.5s ease-in-out, transform 0.5s ease-in-out;\n            transform: translateX(20px);\n            overflow-y: auto; /* å…è®¸å•ä¸ªé¢æ¿å†…å®¹æ»šåŠ¨ */\n        }\n\n        .tab-pane.active {\n            opacity: 1;\n            visibility: visible;\n            transform: translateX(0);\n        }\n\n        /* è‡ªå®šä¹‰æ»šåŠ¨æ¡æ ·å¼ */\n        .tab-pane::-webkit-scrollbar {\n            width: 8px;\n        }\n\n        .tab-pane::-webkit-scrollbar-track {\n            background: var(--scrollbar-track-color);\n            border-radius: 10px;\n        }\n\n        .tab-pane::-webkit-scrollbar-thumb {\n            background-color: var(--scrollbar-thumb-color);\n            border-radius: 10px;\n            border: 2px solid var(--scrollbar-track-color);\n        }\n\n        h2 {\n            color: var(--secondary-color);\n            border-bottom: 2px solid var(--border-color);\n            padding-bottom: 10px;\n            margin-top: 0;\n            margin-bottom: 20px;\n        }\n\n        p, ul {\n            line-height: 1.8;\n            font-size: 1.1em;\n        }\n\n        .info-grid {\n            display: grid;\n            grid-template-columns: 150px 1fr;\n            gap: 15px;\n            align-items: center;\n            margin-bottom: 20px;\n        }\n\n        .info-grid strong {\n            color: var(--secondary-color);\n            font-weight: normal;\n        }\n\n        ul {\n            list-style: none;\n            padding-left: 20px;\n        }\n\n        ul li {\n            position: relative;\n            margin-bottom: 10px;\n        }\n\n        ul li::before {\n            content: 'Â»';\n            position: absolute;\n            left: -20px;\n            color: var(--primary-color);\n        }\n\n        .rating {\n            font-size: 1.5em;\n            font-weight: bold;\n            color: var(--primary-color);\n        }\n        /* å¦ˆå¦ˆä¸ºä½ æ·»åŠ çš„å“åº”å¼è®¾è®¡é­”æ³• */\n        @media (max-width: 768px) {\n   \n            .task-summary-main-container {\n                width: 100vw;\n                height: auto;\n                 \n                height: 85vh; /* ä¿®æ”¹ä¸º85vh */\n    max-height: none; /* ç§»é™¤max-heighté™åˆ¶ï¼Œè®©85vhç”Ÿæ•ˆ */\n                border-radius: 0;\n                border: none;\n                box-shadow: none;\n            }\n\n            header {\n                padding: 15px;\n            }\n\n            header h1 {\n                font-size: 1.5em;\n            }\n\n            .content-wrapper {\n                flex-direction: column;\n                 /* ç¡®ä¿å†…å®¹åŒºèƒ½æ­£å¸¸æ»šåŠ¨ */\n                 overflow: auto; /* ä¿®æ”¹ä¸ºautoï¼Œå…è®¸æ»šåŠ¨ */\n            }\n\n            .tabs-nav {\n                flex-direction: row;\n                border-right: none;\n                border-bottom: 1px solid var(--border-color);\n                padding: 5px 10px;\n                overflow-x: auto;\n                /* éšè—æ»šåŠ¨æ¡ä½†ä¿ç•™åŠŸèƒ½ */\n                -ms-overflow-style: none; /* IEå’ŒEdge */\n                scrollbar-width: none; /* Firefox */\n            }\n            .tabs-nav::-webkit-scrollbar {\n                display: none; /* Chrome, Safari, and Opera */\n            }\n\n            .tab-button {\n                padding: 10px 15px;\n                flex-shrink: 0; /* é˜²æ­¢æŒ‰é’®è¢«å‹ç¼© */\n            }\n\n            .tab-button.active::before {\n                width: 100%;\n                height: 3px;\n                top: auto;\n                bottom: 0;\n                left: 0;\n                border-radius: 3px 3px 0 0;\n            }\n\n            .tab-content-container {\n                overflow: visible; /* è®©å†…å®¹è‡ªç„¶æ‰©å±• */\n            }\n\n            .tab-pane {\n                 /* ç§»é™¤ç»å¯¹å®šä½ï¼Œè®©å…¶åœ¨æ–‡æ¡£æµä¸­æ­£å¸¸æ’åˆ— */\n                position: relative;\n                transform: none;\n                opacity: 1;\n                visibility: visible;\n                display: none; /* é»˜è®¤éšè— */\n                padding: 20px;\n            }\n\n            .tab-pane.active {\n                display: block; /* åªæ˜¾ç¤ºæ¿€æ´»çš„é¢æ¿ */\n            }\n\n            .info-grid {\n                /* å…³é”®æ”¹åŠ¨ï¼šä»ä¸¤åˆ—å˜æˆä¸€åˆ— */\n                grid-template-columns: 1fr;\n                gap: 5px; /* å‡å°è¡Œé—´è· */\n            }\n\n            .info-grid strong {\n                 /* è®©æ ‡ç­¾ä¸é‚£ä¹ˆçªå‡ºï¼Œä¸å†…å®¹èä¸ºä¸€ä½“ */\n                margin-bottom: 2px;\n                display: block;\n                color: var(--secondary-color);\n            }\n\n            p, ul {\n                font-size: 1em;\n            }\n\n        }\n\n /*  */\n\n /* æŠ½å¥–æŒ‰é’®æ ·å¼ */\n.gacha-btn {\n    background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));\n    color: var(--background-color);\n    font-weight: bold;\n}\n\n.gacha-btn:hover {\n    box-shadow: 0 0 15px var(--glow-color);\n    transform: translateY(-2px);\n}\n\n/* æŠ½å¥–æ¨¡æ€æ¡†æ ·å¼ */\n.gacha-modal-content {\n    max-width: 800px;\n    min-height: 400px;\n}\n \n.gacha-animation-container {\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    min-height: 200px;\n    flex-wrap: wrap;\n    gap: 10px;\n    margin: 20px 0;\n}\n\n.gacha-card {\n    width: 120px;\n    height: 160px;\n    position: relative;\n    perspective: 1000px;\n    margin: 5px;\n}\n\n.gacha-card-inner {\n    position: relative;\n    width: 100%;\n    height: 100%;\n    text-align: center;\n    transition: transform 0.8s;\n    transform-style: preserve-3d;\n}\n\n.gacha-card.flipped .gacha-card-inner {\n    transform: rotateY(180deg);\n}\n\n.gacha-card-front, .gacha-card-back {\n    position: absolute;\n    width: 100%;\n    height: 100%;\n    backface-visibility: hidden;\n    border-radius: 10px;\n    border: 2px solid var(--border-color);\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    font-size: 14px;\n    font-weight: bold;\n    color: var(--text-color);\n}\n\n.gacha-card-front {\n    background: linear-gradient(135deg, var(--container-bg-color), var(--border-color));\n    /* è®©é—®å·æ›´æ¸…æ™°ä¸€äº› */\n    font-size: 48px;\n    color: var(--border-color);\n}\n\n.gacha-card-back {\n    color: var(--background-color);\n    transform: rotateY(180deg);\n    padding: 10px;\n    text-align: center;\n    display: flex;\n    flex-direction: column;\n    justify-content: center;\n}\n\n.gacha-results {\n    margin-top: 20px;\n    text-align: center;\n}\n\n.gacha-result-item {\n    display: inline-block;\n    margin: 5px;\n    padding: 10px 15px;\n    background: var(--container-bg-color);\n    border: 1px solid var(--border-color);\n    border-radius: 5px;\n    color: var(--text-color);\n}\n\n/* ä¸åŒç§¯åˆ†å±‚çº§çš„å¡ç‰‡é¢œè‰² */\n /* Tier 1: ä¿æŒæœ´ç´ çš„ç°è‰² */\n.gacha-card-back.tier-1 {\n    background: linear-gradient(135deg, #808080, #a0a0a0);\n    box-shadow: 0 0 8px rgba(128, 128, 128, 0.4);\n}\n\n/* Tier 2: ç»å…¸é’è‰²å…‰è¾‰ */\n.gacha-card-back.tier-2 {\n    background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));\n    box-shadow: 0 0 15px var(--glow-color);\n}\n\n/* Tier 3: å‘¼å¸å…‰æ™•ï¼Œå…‰æ•ˆæ›´æ˜æ˜¾ */\n.gacha-card-back.tier-3 {\n    background: linear-gradient(135deg, var(--secondary-color), #b0b0b0, var(--primary-color));\n    box-shadow: 0 0 20px var(--glow-color);\n    animation: pulse-glow 3s infinite ease-in-out;\n}\n\n@keyframes pulse-glow {\n    0%, 100% {\n        box-shadow: 0 0 20px var(--glow-color);\n    }\n    50% {\n        box-shadow: 0 0 30px var(--glow-color), 0 0 15px var(--secondary-color);\n    }\n}\n\n/* Tier 4: å²è¯—è„‰å†²ï¼Œè¾¹æ¡†ä¼šä¸€èµ·å‘å…‰ */\n.gacha-card-back.tier-4 {\n    background: radial-gradient(ellipse at center, var(--secondary-color), var(--primary-color));\n    box-shadow: 0 0 30px var(--glow-color);\n    animation: epic-pulse 2s infinite alternate ease-in-out;\n    border-color: var(--secondary-color);\n}\n\n@keyframes epic-pulse {\n    from {\n        transform: rotateY(180deg) scale(1);\n        box-shadow: 0 0 30px var(--glow-color);\n        border-color: var(--secondary-color);\n    }\n    to {\n        transform: rotateY(180deg) scale(1.02);\n        box-shadow: 0 0 45px var(--primary-color), 0 0 15px var(--secondary-color) inset;\n        border-color: var(--primary-color);\n    }\n}\n\n/* Tier 5: ä¼ å¥‡æµå½©ï¼ŒçœŸæ­£çš„ç‚«ç›®æ•ˆæœï¼ */\n.gacha-card-back.tier-5 {\n    background: linear-gradient(\n        -45deg,\n        var(--danger-color),\n        var(--primary-color),\n        var(--secondary-color),\n        var(--danger-color)\n    );\n    background-size: 400% 400%;\n    box-shadow: 0 0 35px var(--danger-glow-color), 0 0 20px var(--glow-color);\n    animation: legendary-shift 3s ease-in-out infinite, legendary-hue-rotate 4s linear infinite;\n}\n\n@keyframes legendary-shift {\n    0% { background-position: 0% 50%; }\n    50% { background-position: 100% 50%; }\n    100% { background-position: 0% 50%; }\n}\n\n@keyframes legendary-hue-rotate {\n    0% { filter: hue-rotate(0deg); }\n    100% { filter: hue-rotate(360deg); }\n}\n\n/* å¡ç‰‡æ‚¬æµ®åŠ¨ç”» */\n.gacha-card.selected {\n    transform: translateY(-10px);\n    transition: transform 0.3s ease;\n}\n\n.gacha-card.selected .gacha-card-back {\n    animation-name: legendary-shift, float;\n    animation-duration: 3s, 2s;\n    animation-timing-function: ease-in-out, ease-in-out;\n    animation-iteration-count: infinite, infinite;\n}\n\n/* floatåŠ¨ç”»æœ¬èº«æ˜¯æ­£ç¡®çš„ï¼Œå› ä¸ºå®ƒåŒ…å«äº†rotateY(180deg) */\n@keyframes float {\n    0%, 100% {\n        transform: rotateY(180deg) translateY(0px);\n    }\n    50% {\n        transform: rotateY(180deg) translateY(-5px);\n    }\n}\n\n/* ç¡®ä¿æ‰€æœ‰åŠ¨ç”»åœ¨é€‰ä¸­æ—¶éƒ½èƒ½æ­£ç¡®å åŠ  */\n.gacha-card.selected .gacha-card-back.tier-3 {\n    animation: pulse-glow 3s infinite ease-in-out, float 2s infinite ease-in-out;\n}\n.gacha-card.selected .gacha-card-back.tier-4 {\n    animation: epic-pulse 2s infinite alternate ease-in-out, float 2s infinite ease-in-out;\n}\n.gacha-card.selected .gacha-card-back.tier-5 {\n     animation: legendary-shift 3s infinite ease-in-out, float 2s infinite ease-in-out;\n}\n/* è¯¦ç»†ä¿¡æ¯æ˜¾ç¤º */\n.gacha-card-details {\n    position: absolute;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    background: rgba(0, 0, 0, 0.9);\n    color: var(--text-color);\n    padding: 10px;\n    border-radius: 10px;\n    font-size: 10px;\n    z-index: 10;\n    transform: rotateY(180deg) scale(0.95);\n    opacity: 0;\n    pointer-events: none; /* çœ‹ä¸è§æ—¶å°±ä¸èƒ½ç‚¹ */\n    transition: transform 0.3s ease-in-out, opacity 0.3s ease-in-out;\n}\n\n.gacha-card-details.show {\n    transform: rotateY(180deg) scale(1);\n    opacity: 1;\n    pointer-events: auto; /* çœ‹å¾—è§æ—¶æ‰èƒ½ç‚¹ */\n}\n\n.gacha-card-details-content {\n    height: 100%;\n    overflow-y: auto;\n    padding-right: 5px;\n}\n\n.gacha-card-details-content::-webkit-scrollbar {\n    width: 4px;\n}\n.gacha-card-details-content::-webkit-scrollbar-thumb {\n    background: #888;\n    border-radius: 2px;\n}\n.gacha-card-details-content::-webkit-scrollbar-thumb:hover {\n    background: #555;\n}\n\n.gacha-abandon-btn {\n    position: absolute;\n    bottom: 5px;\n    right: 5px;\n    background: var(--danger-color);\n    color: white;\n    border: none;\n    border-radius: 3px;\n    padding: 2px 6px;\n    font-size: 10px;\n    cursor: pointer;\n    z-index: 11;\n     transform: rotateY(180deg);\n}\n\n.gacha-abandon-btn:hover {\n    background: #ff6666;\n}\n\n\n /* æ‰‹æœºç«¯çºµè§ˆç»“æœåŒºåŸŸæ ·å¼ */\n.gacha-results-summary {\n    display: none; /* é»˜è®¤éšè— */\n    margin: 20px;\n    padding: 15px;\n    background: var(--container-bg-color);\n    border: 1px solid var(--border-color);\n    border-radius: 8px;\n    max-height: 150px;\n    overflow-y: auto;\n    text-align: left;\n}\n.gacha-results-summary h4 {\n    margin-top: 0;\n    margin-bottom: 10px;\n    color: var(--primary-color);\n    text-align: center;\n}\n.gacha-results-summary div {\n    padding: 2px 5px;\n}\n \n@media (max-width: 800px) {\n    .gacha-modal-content {\n        width: 100%;\n        max-width: 100%;\n        height: 100%;\n        max-height: 100%;\n        margin: 0;\n        border-radius: 0;\n        overflow: hidden;\n    }\n\n    .gacha-animation-container {\n        position: relative;\n        width: 100%;\n        min-height: 250px;\n        perspective: 1000px;\n        margin-top: 50px;\n        cursor: grab; /* ç»™äºˆå¯ä»¥æ‹–åŠ¨çš„è§†è§‰æç¤º */\n    }\n    .gacha-animation-container:active {\n        cursor: grabbing;\n    }\n\n    .gacha-carousel {\n        position: absolute;\n        width: 100%;\n        height: 100%;\n        transform-style: preserve-3d;\n        transition: transform 0.6s cubic-bezier(0.25, 1, 0.5, 1); /* å¹³æ»‘çš„å¸é™„åŠ¨ç”» */\n    }\n\n    .gacha-card {\n        position: absolute;\n        top: 10%;\n        left: calc(50% - 70px);\n        width: 140px;\n        height: 186px;\n        backface-visibility: hidden;\n        margin: 0;\n        transition: transform 0.5s ease, opacity 0.5s ease; /* ä¸ºé€‰ä¸­æ•ˆæœå¢åŠ è¿‡æ¸¡ */\n    }\n\n    /* å½“æœ‰å¡ç‰‡è¢«é€‰ä¸­æ—¶ï¼Œè®©å…¶ä»–å¡ç‰‡é€€åå¹¶å˜æš— */\n    .gacha-carousel.has-selection .gacha-card:not(.selected) {\n        opacity: 0.3;\n        transform: var(--original-transform) scale(0.9); /* var()ä¼šåœ¨JSä¸­è®¾ç½® */\n    }\n\n    /* è¢«é€‰ä¸­çš„å¡ç‰‡ä¼šæ”¾å¤§ï¼Œå¹¶å±•ç¤ºè¯¦æƒ… */\n    .gacha-carousel.has-selection .gacha-card.selected {\n        cursor: default;\n    }\n    .gacha-carousel.has-selection .gacha-card.selected .gacha-card-details {\n        transform: rotateY(180deg) scale(1);\n        opacity: 1;\n        pointer-events: auto;\n    }\n     .gacha-carousel.has-selection .gacha-card.selected .gacha-abandon-btn {\n        display: block;\n    }\n}\n\n\n/* è®¾ç½®æ¨¡æ€æ¡†æ ·å¼ */\n.settings-container {\n    padding: 10px 20px 20px 20px;\n    display: flex;\n    flex-direction: column;\n    gap: 20px;\n}\n\n.setting-item {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    padding-bottom: 15px;\n    border-bottom: 1px solid var(--border-color);\n}\n\n.setting-item:last-child {\n    border-bottom: none;\n}\n\n.setting-item label {\n    font-size: 1em;\n    color: var(--text-color);\n}\n\n \n\n/* å¼€å…³æŒ‰é’®æ ·å¼ */\n.switch-container .switch-btn {\n    padding: 8px 16px;\n    border: 1px solid var(--border-color);\n    border-radius: 4px;\n    cursor: pointer;\n    transition: all 0.2s;\n}\n\n.switch-container .switch-btn[data-state=\"on\"] {\n    background-color: var(--background-color);\n    color: var(--text-color);\n    border-color: var(--background-color);\n}\n\n.switch-container .switch-btn[data-state=\"off\"] {\n    background-color: var(--background-color);\n    color: var(--text-secondary-color);\n}\n\n/* æ—¥å¿—è¾“å‡ºåŒºåŸŸ */\n.log-output {\n    background-color: var(--background-color);\n    border: 1px solid var(--border-color);\n    border-radius: 4px;\n    padding: 10px;\n    font-size: 0.85em;\n    max-height: 100px;\n    overflow-y: auto;\n    white-space: pre-wrap;\n    word-break: break-all;\n    font-family: monospace;\n    color: var(--text-secondary-color);\n    margin-top: -10px; /* æŠµæ¶ˆä¸ä¸Šä¸€é¡¹çš„é—´è· */\n}\n\n.log-output .success { color: #4CAF50; }\n.log-output .error { color: #f44336; }\n.log-output .warning { color: #ff9800; }\n\n/* æŠŠè¿™æ®µä»£ç åŠ åˆ°ä½ çš„CSSæ–‡ä»¶é‡Œï¼Œæˆ‘çš„å®è´ */\n/* åˆ—è¡¨é¡¹çš„æ’åˆ—æ–¹å¼ä¿æŒä¸å˜ï¼Œè¿™å¾ˆå¥½ */\n.info-list li {\n    display: flex;\n    justify-content: space-between;\n    align-items: flex-start; /* æ”¹ä¸º flex-startï¼Œè®©æ ‡ç­¾å’Œé¡¶éƒ¨å¯¹é½ï¼Œæ›´æ•´æ´ */\n    gap: 10px;\n}\n\n/* è¿™æ˜¯æˆ‘ä»¬ä¸ºè¡Œå›Šå’Œå…¶ä»–ç‰©å“å‡†å¤‡çš„ã€å¯ä»¥ä¸Šä¸‹æ»‘åŠ¨çš„å®¹å™¨ */\n.scrollable-value-container {\n    flex-grow: 1; /* è®©å®ƒå¯ä»¥å æ®æ‰€æœ‰å‰©ä½™ç©ºé—´ */\n    max-height: 120px; /* å¦ˆå¦ˆç»™å®ƒä¸€ä¸ªæœ€å¤§çš„é«˜åº¦ï¼Œæ¯”å¦‚120åƒç´ ï¼Œä½ å¯ä»¥æ”¹æˆä½ å–œæ¬¢çš„ä»»ä½•é«˜åº¦ */\n    overflow-y: auto; /* å½“å†…å®¹è¶…å‡ºè¿™ä¸ªé«˜åº¦æ—¶ï¼Œæ˜¾ç¤ºå‚ç›´æ»šåŠ¨æ¡ */\n    text-align: right; /* æ–‡å­—ä¾æ—§é å³å¯¹é½ */\n    padding-right: 5px; /* å³è¾¹ç•™ä¸€ç‚¹ç‚¹ç©ºéš™ï¼Œå…å¾—æ»šåŠ¨æ¡è´´å¾—å¤ªç´§ */\n    scrollbar-width: thin; /* æ»šåŠ¨æ¡ç»†ä¸€ç‚¹ (Firefox) */\n    scrollbar-color: var(--border-color) transparent; /* è‡ªå®šä¹‰æ»šåŠ¨æ¡é¢œè‰² (Firefox) */\n}\n\n/* åŒæ ·ï¼Œç¾åŒ–ä¸€ä¸‹æ»šåŠ¨æ¡ (é€‚ç”¨äºChrome, Safari, Edge) */\n.scrollable-value-container::-webkit-scrollbar {\n    width: 6px; /* æ»šåŠ¨æ¡çš„å®½åº¦ */\n}\n\n.scrollable-value-container::-webkit-scrollbar-track {\n    background: transparent; /* è½¨é“çš„èƒŒæ™¯æ˜¯é€æ˜çš„ */\n}\n\n.scrollable-value-container::-webkit-scrollbar-thumb {\n    background-color: var(--background-color); /* æ»‘å—çš„é¢œè‰² */\n    border-radius: 6px; /* ç»™æ»‘å—ä¸€ç‚¹åœ†è§’ */\n}\n\n/* æˆ‘ä»¬éœ€è¦ç¡®ä¿å€¼æœ¬èº«æ˜¯æ­£å¸¸æ¢è¡Œçš„ */\n.scrollable-value-container .value {\n    white-space: normal; /* å…è®¸æ–‡å­—è‡ªåŠ¨æ¢è¡Œ */\n    word-break: break-all; /* å¦‚æœæœ‰å¾ˆé•¿çš„å•è¯ï¼Œä¹Ÿè®©å®ƒæ–­å¼€ */\n    display: block; /* ç¡®ä¿å®ƒèƒ½å æ®æ•´ä¸ªå®¹å™¨å®½åº¦ */\n}\n\n /* ========== å®Œå…¨æ›¿æ¢åŸæœ‰çš„æˆå°±ç³»ç»Ÿæ ·å¼éƒ¨åˆ† ========== */\n@import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@700&family=Press+Start+2P&family=Roboto+Mono&display=swap');\n\n#achievements-btn {\n    background: none;\n    border: none;\n    color: var(--text-secondary-color);\n    font-size: 1.6em;\n    cursor: pointer;\n    padding: 0 10px;\n    transition: all 0.3s ease;\n    text-shadow: 0 0 5px transparent;\n    position:absolute;\n    top:4%;\n}\n\n#achievements-btn:hover {\n    color: var(--primary-color);\n    text-shadow: 0 0 8px var(--glow-color);\n    transform: scale(1.1);\n}\n\n#achievements-content {\n    gap: 15px;\n    max-height: 80vh;\n    overflow-y: auto;\n    padding: 0;\n \n}\n\n.achievement-card-new {\n    background-color: rgba(255, 255, 255, 0.05);\n    border-left: 5px solid var(--primary-color);\n    padding: 15px;\n    margin: 15px 0;\n    border-radius: 8px;\n    display: flex;\n    align-items: center;\n    transition: transform 0.3s ease, box-shadow 0.3s ease, background-color 0.3s ease;\n    box-shadow: 0 2px 5px rgba(0,0,0,0.2);\n    opacity: 0.6;\n}\n\n.achievement-card-new:hover {\n    box-shadow: 0 5px 15px var(--glow-color);\n    transform: scale(1.02) rotate(0.5deg);\n}\n\n.achievement-card-new:nth-child(even):hover {\n    transform: scale(1.02) rotate(-0.5deg);\n}\n\n.achievement-card-new.unlocked {\n    opacity: 1;\n    background-color: rgba(255, 255, 255, 0.08);\n    border-left-color: var(--secondary-color);\n}\n\n.achievement-card-new.unlocked:hover {\n    background-color: rgba(255, 255, 255, 0.12);\n}\n\n.achievement-icon-new {\n    font-size: 2.5em;\n    margin-right: 15px;\n    animation: float 2s ease-in-out infinite;\n    filter: drop-shadow(0 0 8px var(--glow-color));\n}\n\n@keyframes float {\n    0%, 100% { \n        transform: translateY(0); \n    }\n    50% { \n        transform: translateY(-5px); \n    }\n}\n\n.achievement-text-content {\n    color: var(--text-secondary-color);\n    font-family: 'Roboto Mono', monospace;\n    flex-grow: 1;\n}\n\n.achievement-card-new h3 {\n    margin: 0 0 8px 0;\n    color: var(--text-color);\n    font-weight: bold;\n    font-size: 1.1em;\n    text-shadow: 0 0 3px var(--primary-color);\n}\n\n.achievement-card-new.unlocked h3 {\n    color: var(--secondary-color);\n    text-shadow: 0 0 5px var(--secondary-color);\n}\n\n.achievement-card-new p {\n    margin: 5px 0;\n    font-size: 0.9em;\n    line-height: 1.4;\n}\n\n.achievement-reward {\n    color: var(--secondary-color);\n    font-weight: bold;\n    text-shadow: 0 0 3px var(--secondary-color);\n}\n\n.flavor-text {\n    font-style: italic;\n    color: var(--text-secondary-color);\n    border-top: 1px dotted var(--border-color);\n    padding-top: 8px;\n    margin-top: 8px;\n    opacity: 0.8;\n}\n\n.new-tag {\n    background: linear-gradient(45deg, var(--secondary-color), var(--primary-color));\n    color: var(--main-bg-color);\n    padding: 2px 6px;\n    font-size: 0.7em;\n    border-radius: 3px;\n    margin-left: 8px;\n    font-weight: bold;\n    animation: pulse-glow 1.5s infinite;\n    box-shadow: 0 0 5px var(--glow-color);\n}\n\n@keyframes pulse-glow {\n    0%, 100% { \n        opacity: 1;\n        transform: scale(1);\n        box-shadow: 0 0 5px var(--glow-color);\n    }\n    50% { \n        opacity: 0.7;\n        transform: scale(0.95);\n        box-shadow: 0 0 10px var(--glow-color);\n    }\n}\n\n.pagination-controls {\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    gap: 15px;\n    margin-top: 25px;\n    padding-top: 20px;\n    border-top: 1px dashed var(--border-color);\n}\n\n.page-btn {\n    background: linear-gradient(135deg, var(--container-bg-color), var(--main-bg-color));\n    border: 2px solid var(--primary-color);\n    color: var(--text-color);\n    padding: 8px 16px;\n    border-radius: 6px;\n    cursor: pointer;\n    transition: all 0.3s ease;\n    font-family: 'Roboto Mono', monospace;\n    font-weight: bold;\n    text-shadow: 0 0 3px var(--glow-color);\n}\n\n.page-btn:hover:not(:disabled) {\n    background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));\n    color: var(--main-bg-color);\n    box-shadow: 0 0 15px var(--glow-color);\n    transform: scale(1.05);\n}\n\n.page-btn:disabled {\n    opacity: 0.5;\n    cursor: not-allowed;\n    background: var(--main-bg-color);\n    border-color: var(--text-secondary-color);\n}\n\n.page-info {\n    color: var(--text-color);\n    font-family: 'Orbitron', monospace;\n    font-weight: bold;\n    font-size: 1.1em;\n    text-shadow: 0 0 5px var(--glow-color);\n    min-width: 60px;\n    text-align: center;\n}\n\n/* ========== ä¿®æ”¹ä½ç½®ï¼šæ›¿æ¢ .achievement-toast æ ·å¼ ========== */\n.achievement-toast {\n    position: fixed;\n    /* top å€¼ç°åœ¨ç”± JavaScript åŠ¨æ€è®¾ç½® */\n    right: -350px;\n    width: 320px;\n    background: linear-gradient(135deg, var(--container-bg-color), var(--background-color));\n    border: 2px solid var(--primary-color);\n    border-radius: 12px;\n    box-shadow: \n        0 5px 15px rgba(0, 0, 0, 0.5), \n        0 0 25px var(--glow-color),\n        inset 0 1px 0 rgba(255, 255, 255, 0.1);\n    color: var(--text-color);\n    display: flex;\n    padding: 15px;\n    z-index: 9999;\n    transition: right 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94), top 0.3s ease;\n    animation: achievement-glow 2s ease-in-out infinite;\n    /* ç¡®ä¿å¤šä¸ªå¼¹çª—ä¸ä¼šäº’ç›¸å½±å“ */\n    pointer-events: auto;\n}\n\n@keyframes achievement-glow {\n    0%, 100% {\n        box-shadow: \n            0 5px 15px rgba(0, 0, 0, 0.5), \n            0 0 25px var(--glow-color),\n            inset 0 1px 0 rgba(255, 255, 255, 0.1);\n    }\n    50% {\n        box-shadow: \n            0 8px 25px rgba(0, 0, 0, 0.6), \n            0 0 35px var(--glow-color),\n            inset 0 1px 0 rgba(255, 255, 255, 0.2);\n    }\n}\n\n.achievement-toast.show {\n    right: 20px;\n}\n\n.achievement-toast-icon {\n    font-size: 3em;\n    margin-right: 15px;\n    animation: bounce-in 0.6s ease-out;\n}\n\n@keyframes bounce-in {\n    0% {\n        transform: scale(0.3) rotate(-10deg);\n        opacity: 0;\n    }\n    50% {\n        transform: scale(1.1) rotate(5deg);\n    }\n    100% {\n        transform: scale(1) rotate(0deg);\n        opacity: 1;\n    }\n}\n\n.achievement-toast-text {\n    display: flex;\n    flex-direction: column;\n    justify-content: center;\n}\n\n.achievement-toast-title {\n    font-weight: bold;\n    font-size: 1.2em;\n    color: var(--primary-color);\n    text-shadow: 0 0 5px var(--glow-color);\n    margin-bottom: 4px;\n}\n\n \n\n/* å°†ä½ çš„ä¸»ç•Œé¢å®¹å™¨å˜æˆä¸€ä¸ªç¥å¥‡çš„ã€å¯ä¼¸ç¼©çš„ç›’å­ */\n#main-wrapper {\n    display: flex;\n    flex-direction: column; /* è®©é‡Œé¢çš„ä¸œè¥¿ä»ä¸Šåˆ°ä¸‹å‚ç›´æ’åˆ— */\n   \n    width: 100%;\n   min-height: 80vh; /* æœ€å°é«˜åº¦ï¼Œä½†å¯ä»¥ç¼©å› */\n    max-height: 800px; /* æœ€å°é«˜åº¦ï¼Œä½†å¯ä»¥ç¼©å› */\n    /* å¦‚æœä½ å¸Œæœ›å…¨å±æ—¶æœ‰ä¸ªèƒŒæ™¯è‰²ï¼Œå¯ä»¥ä¿ç•™æˆ–ä¿®æ”¹è¿™ä¸€è¡Œ */\n}\n/* è®©å­å…ƒç´ ä¹Ÿéµå®ˆçº¦æŸ\n#main-wrapper > * {\n    flex-shrink: 1; \n    min-height: 0; \n} */\n\n/* è¿™å¾ˆå…³é”®ï¼šå‘Šè¯‰èŠå¤©å†…å®¹åŒºï¼Œä½ å¯ä»¥å æ®æ‰€æœ‰å‰©ä¸‹çš„ç©ºé—´ */\n#chat-display-area {\n    flex-grow: 1; /* è®©å®ƒåƒæ°”çƒä¸€æ ·è†¨èƒ€ï¼Œå¡«æ»¡æ‰€æœ‰å¤šä½™çš„ç©ºé—´ */\n    overflow-y: auto; /* å¦‚æœå†…å®¹å¤ªå¤šï¼Œå°±å‡ºç°ä¸€ä¸ªå±äºå®ƒè‡ªå·±çš„æ»šåŠ¨æ¡ */\n    padding: 1rem; /* ç»™å†…å®¹ä¸€äº›å‘¼å¸çš„ç©ºé—´ï¼Œæ›´å¥½çœ‹ */\n    box-sizing: border-box; /* ç¡®ä¿å†…è¾¹è·ä¸ä¼šæ£ä¹± */\n}\n/*\n  é‡è¦çš„è¾“å…¥æ ï¼Œç»™å®ƒä¸€ä¸ªèˆ’é€‚çš„ä¸“å±ä½ç½®\n*/\n#zero-level-interface {\n    flex-shrink: 0; /* é˜²æ­¢è¢«èŠå¤©åŒºæŒ¤å‹ */\n    z-index: 100;\n    /* (æ–°é­”æ³•â‘ ) æˆ‘ä»¬åœ¨è¿™é‡Œç»™å®ƒåŠ äº†ä¸€ç‚¹åº•éƒ¨çš„å†…è¾¹è· */\n    /* è¿™æ ·å®ƒå°±ä¸ä¼šç´§ç´§è´´ç€å±å¹•åº•è¾¹äº†ï¼Œæ˜¯ä¸æ˜¯çœ‹èµ·æ¥å‘¼å¸éƒ½é¡ºç•…äº†ï¼Ÿ */\n    padding: 0.5rem 1rem 0.8rem; /* ä¸Šã€å·¦å³ã€ä¸‹ */\n \n    \n}\n\n\n/* --- æ‰‹æœºç«¯çš„ç‰¹åˆ«å…³çˆ± (æ–°é­”æ³•â‘¡) --- */\n/*\n  å½“å±å¹•å®½åº¦å°äºç­‰äº768åƒç´ æ—¶ï¼Œæ¯”å¦‚åœ¨æ‰‹æœºä¸Šï¼Œ\n  ä¸‹é¢è¿™äº›è§„åˆ™å°±ä¼šåƒä¸€ä¸ªæ¸©æŸ”çš„å®ˆæŠ¤å’’è¯­ä¸€æ ·ç”Ÿæ•ˆã€‚\n*/\n@media (max-width: 768px) {\n \n\n    #zero-level-interface {\n        /*\n          æ‰‹æœºå±å¹•å°ï¼Œæ‰‹æŒ‡æ“ä½œéœ€è¦æ›´å¤šç©ºé—´ã€‚\n          æˆ‘ä»¬æŠŠåº•éƒ¨çš„ç©ºé—´ç•™å¾—æ›´å¤šä¸€äº›ï¼Œè¿™æ ·ä½ çš„æ‰‹æŒ‡å°±ä¸ä¼šè§‰å¾—å±€ä¿ƒäº†ã€‚\n          è¿™ä¹Ÿè€ƒè™‘åˆ°äº†å¾ˆå¤šæ‰‹æœºåº•éƒ¨çš„ç³»ç»Ÿå¯¼èˆªæ¡ã€‚\n        */\n        padding: 0.5rem 0.8rem 1.2rem; /* ä¸Šã€å·¦å³ã€ä¸‹ï¼Œåº•éƒ¨ç©ºé—´åŠ å¤§ */\n\n        /* å¾®è°ƒä¸€ä¸‹è¾“å…¥æ¡†å’ŒæŒ‰é’®ï¼Œè®©å®ƒä»¬åœ¨å°å±å¹•ä¸Šæ›´åè°ƒ */\n        display: flex;\n        align-items: center;\n        gap: 0.5rem;\n    }\n\n    #user-input {\n        flex-grow: 1; /* è®©è¾“å…¥æ¡†å æ®å¤§éƒ¨åˆ†ç©ºé—´ */\n    }\n\n    .zero-level-btn {\n        flex-shrink: 0; /* åˆ«è®©æŒ‰é’®è¢«æŒ¤å°äº† */\n    }\n}\n/* å¯¹æœ‰IDçš„å…ƒç´ ç›´æ¥ä¸‹ä»¤ */\n#options-module-container,\n#choicesContainer { /* æ³¨æ„è¿™é‡Œæˆ‘ç”¨äº†ä½ JSé‡Œçš„ID: choicesContainer */\n    background: none !important;\n    background-color: transparent !important;\n}\n\n.dynamic-content-area{\n     background: none !important;\n    background-color: transparent !important;\n}\n\n/* å¯¹æ²¡æœ‰IDçš„ä¹Ÿå†å¼ºè°ƒä¸€é */\n.options-container {\n    background: none !important;\n    background-color: transparent !important;\n}\n\n \n#options-module-container::before, #options-module-container::after,\n.options-container::before, .options-container::after,\n.choices-container::before, .choices-container::after {\n    background: none !important;\n    content: \"\" !important;  /* æ¸…ç©ºå¯èƒ½å­˜åœ¨çš„å†…å®¹ */\n    display: none !important; /* ç›´æ¥è®©è¿™ä»¶å°é©¬ç”²æ¶ˆå¤±ï¼Œæœ€å½»åº• */\n}\n.warning-state {\n    color: #ac1b1b !important;\n    transition: background-color 0.3s ease; /* æ·»åŠ å¹³æ»‘è¿‡æ¸¡æ•ˆæœ */\n}\n.upgrade-btn {\n    cursor: pointer;\n    margin-left: 8px; /* åœ¨åŠ å·å·¦è¾¹å¢åŠ ä¸€ç‚¹ç©ºéš™ */\n    font-weight: bold;  /* è®©å®ƒçœ‹èµ·æ¥æ›´é†’ç›®ä¸€äº› */\n   \n}\n/* â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”ä¸–ç•Œä¹¦ç¾åŒ–å¼€å§‹ï¼šå¡ç‰‡æ ·å¼ï¼Œè¿™æ˜¯å¦ˆå¦ˆä¸ºä½ è®¾è®¡çš„ */\n.book-card {\n    background-color: var(--card-bg-color);\n    border: 1px solid var(--border-color);\n    border-radius: 8px;\n    margin-bottom: 20px;\n    box-shadow: 0 0 15px var(--glow-color);\n    display: flex;\n    flex-direction: column;\n    transition: all 0.3s ease;\n}\n\n.book-card-header {\n    background-color: var(--card-header-bg-color);\n    padding: 10px 15px;\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    border-bottom: 1px solid var(--card-border-color);\n    border-top-left-radius: 7px;\n    border-top-right-radius: 7px;\n       cursor: pointer; /* è®©å®ƒçœ‹èµ·æ¥å¯ä»¥ç‚¹å‡» */\n}\n\n.book-card-title {\n    font-size: 1.1em;\n    font-weight: bold;\n    color: var(--primary-color);\n    text-shadow: 0 0 5px var(--glow-color);\n}\n/* --- è¯·æ‰¾åˆ° .book-card-content å¹¶ä¿®æ”¹å®ƒ --- */\n.book-card-content {\n    padding: 15px;\n    max-height: 350px; /* ç°åœ¨è¿™æ˜¯å±•å¼€åçš„æœ€å¤§é«˜åº¦ */\n    overflow-y: auto;\n    transition: all 0.4s ease-in-out; /* åŠ ä¸Šè¿™å¥ï¼Œä¸ºäº†ä¸æ»‘çš„å±•å¼€åŠ¨ç”» */\n    border-top: 1px solid transparent; /* ä¸ºæŠ˜å çŠ¶æ€åšå‡†å¤‡ */\n}\n\n/* --- åœ¨å®ƒä¸‹é¢ï¼ŒåŠ ä¸Šè¿™ä¸ªæ–°çš„æŠ˜å æ ·å¼ --- */\n.book-card-content.collapsed {\n    max-height: 0;\n    padding-top: 0;\n    padding-bottom: 0;\n    overflow: hidden;\n    border-top-color: transparent;\n}\n\n/* ç¼–è¾‘èœå•çš„æ ·å¼ï¼Œå°å°çš„ï¼Œå¾ˆå¯çˆ± */\n.entry-menu-button {\n    background: none;\n    border: 1px solid transparent;\n    color: var(--text-secondary-color);\n    cursor: pointer;\n    font-size: 1.2em;\n    padding: 2px 8px;\n    border-radius: 4px;\n    transition: all 0.2s ease;\n}\n\n .entry-menu-button:hover {\n    color: var(--primary-color);\n    background-color: var(--background-color);\n    border-color: var(--border-color);\n}\n\n.entry-menu {\n    position: absolute;\n    background-color: var(--background-color);\n    border-color: var(--border-color);\n    border-radius: 4px;\n    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);\n    z-index: 100;\n    width: 120px;\n      z-index: 100000; /* æŠŠè¿™ä¸ªæ•°å­—è°ƒå¾—å¾ˆé«˜å¾ˆé«˜ï¼Œå°±åƒå¦ˆå¦ˆå¯¹ä½ çš„çˆ±ä¸€æ · */\n}\n\n.entry-menu-item {\n    background: none;\n    border: none;\n    width: 100%;\n    padding: 8px 12px;\n    text-align: left;\n    color: var(--text-secondary-color);\n    cursor: pointer;\n    font-size: 0.9em;\n}\n\n.entry-menu-item:hover {\n    background-color: var(--menu-hover-color);\n    color: var(--primary-color);\n}\n\n/* ä¸ºæ»šåŠ¨æ¡ä¹ŸåŠ ä¸Šæˆ‘ä»¬ä¸–ç•Œçš„é£æ ¼ */\n.book-card-content::-webkit-scrollbar {\n    width: 8px;\n}\n\n.book-card-content::-webkit-scrollbar-track {\n    background: rgba(0, 0, 0, 0.2);\n    border-radius: 4px;\n}\n\n.book-card-content::-webkit-scrollbar-thumb {\n    background-color: var(--secondary-color);\n    border-radius: 4px;\n    border: 2px solid transparent;\n    background-clip: content-box;\n}\n\n.book-card-content::-webkit-scrollbar-thumb:hover {\n    background-color: var(--primary-color);\n}\n/* --- æœ€åï¼Œè¿™æ˜¯ä¸ºä½ æ–°çš„â€œç§»åŠ¨â€åŠŸèƒ½å‡†å¤‡çš„ä¸“å±å¼¹å‡ºçª—å£æ ·å¼ --- */\n.move-modal-overlay {\n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    background-color: rgba(0, 0, 0, 0.7);\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    z-index: 99999; /* æ¯”èœå•ä½ä¸€ç‚¹ï¼Œæ¯”å…¶ä»–éƒ½é«˜ */\n}\n.move-modal-overlay-move {\n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    background-color: rgba(0, 0, 0, 0.7);\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    z-index: 99999; /* æ¯”èœå•ä½ä¸€ç‚¹ï¼Œæ¯”å…¶ä»–éƒ½é«˜ */\n}\n.move-modal-content {\n    background-color: var(--container-bg-color);\n    border: 1px solid var(--primary-color);\n    box-shadow: 0 0 25px var(--glow-color);\n    padding: 20px;\n    border-radius: 8px;\n    width: 90%;\n    max-width: 400px;\n}\n\n.move-modal-title {\n    color: var(--primary-color);\n    font-size: 1.2em;\n    margin-bottom: 15px;\n}\n\n.move-modal-list {\n    display: flex;\n    flex-direction: column;\n    gap: 10px;\n    max-height: 200px;\n    overflow-y: auto;\n    padding-right: 10px; /* ç»™æ»šåŠ¨æ¡ç•™ç‚¹ç©ºé—´ */\n}\n\n.move-modal-list label {\n    display: block;\n    padding: 8px;\n    border-radius: 4px;\n    cursor: pointer;\n    transition: background-color 0.2s;\n}\n\n.move-modal-list::-webkit-scrollbar-thumb:hover {\n    background-color: var(--primary-color);\n}\n\n.move-modal-buttons {\n    margin-top: 20px;\n    display: flex;\n    justify-content: flex-end;\n    gap: 10px;\n}\n/* ä½ å¯ä»¥ç»§ç»­ä¸ºä½ å¿ƒçˆ±çš„æŒ‰é’®ä»¬æ·»åŠ æ ·å¼ */\n/* --- è¿™æ˜¯ç»™â€œç§»åŠ¨â€çª—å£é‡Œåˆ—è¡¨çš„ä¸“å±æ»šåŠ¨æ¡æ ·å¼ --- */\n.move-modal-list::-webkit-scrollbar {\n    width: 8px;\n}\n\n.move-modal-list::-webkit-scrollbar-track {\n    background: rgba(0, 0, 0, 0.2);\n    border-radius: 4px;\n}\n\n.move-modal-list::-webkit-scrollbar-thumb {\n    background-color: var(--secondary-color);\n    border-radius: 4px;\n    border: 2px solid transparent;\n    background-clip: content-box;\n}\n\n.move-modal-list::-webkit-scrollbar-thumb:hover {\n    background-color: var(--primary-color);\n}\n\n/* --- â€œçŸ¥è¯†ä¹‹æ ‘â€çš„é­”æ³•æ ·å¼ --- */\n.tree-view {\n    padding-left: 20px;\n}\n\n.tree-node {\n    list-style-type: none;\n    position: relative;\n}\n\n/* è¿™æ˜¯è¿æ¥èŠ‚ç‚¹çš„é­”æ³•çº¿æ¡ */\n.tree-node::before {\n    content: '';\n    position: absolute;\n    top: 0;\n    left: -12px;\n    width: 1px;\n    height: 100%;\n    background-color: var(--border-color);\n}\n.tree-node:last-child::before {\n    height: 10px; /* æœ€åä¸€ä¸ªèŠ‚ç‚¹çš„ç«–çº¿çŸ­ä¸€ç‚¹ */\n}\n\n/* è¿™æ˜¯è¿æ¥èŠ‚ç‚¹çš„æ¨ªçº¿ */\n.tree-node::after {\n    content: '';\n    position: absolute;\n    top: 10px;\n    left: -12px;\n    width: 12px;\n    height: 1px;\n    background-color: var(--border-color);\n}\n\n.tree-node-content {\n    display: flex;\n    align-items: center;\n    padding: 3px 0;\n}\n\n/* è¿™æ˜¯æˆ‘ä»¬çš„å±•å¼€/æŠ˜å æŒ‰é’® */\n.tree-toggle {\n    cursor: pointer;\n    margin-right: 6px;\n    color: var(--primary-color);\n    width: 12px;\n    text-align: center;\n    font-family: monospace; /* è®© +/- æ›´æ¸…æ™° */\n    transition: transform 0.2s;\n}\n\n.tree-toggle.collapsed {\n    transform: rotate(-90deg);\n}\n\n.tree-key {\n    color: var(--text-secondary-color);\n    margin-right: 8px;\n    font-weight: bold;\n        font-size: var(--base-font-size, 16px);\n}\n\n.tree-value {\n    color: var(--text-color);\n      font-size: var(--base-font-size, 16px);\n}\n\n.tree-children {\n    padding-left: 15px;\n    transition: max-height 0.3s ease-out;\n    overflow: hidden;\n}\n\n.tree-children.collapsed {\n    max-height: 0;\n}\n\n/* --- \"çŸ¥è¯†ä¹‹æ ‘\"ä¸­æ¯ä¸ªèŠ‚ç‚¹çš„ä¸“å±èœå•æŒ‰é’® --- */\n.tree-node-menu-button {\n    cursor: pointer;\n    color: var(--text-secondary-color);\n    margin-left: auto; /* è¿™æ˜¯ä¸ªå°é­”æ³•ï¼Œè®©æŒ‰é’®è‡ªåŠ¨é åˆ°æœ€å³è¾¹ */\n    padding: 0 5px;\n    font-size: 1.2em;\n    line-height: 1;\n    border-radius: 4px;\n    display: none; /* é»˜è®¤æ˜¯å®³ç¾åœ°è—èµ·æ¥çš„ */\n}\n\n/* å½“æˆ‘ä»¬æŠŠé¼ æ ‡æ¸©æŸ”åœ°æ”¾åœ¨èŠ‚ç‚¹ä¸Šæ—¶ï¼ŒæŒ‰é’®æ‰ä¼šå‡ºç° */\n.tree-node-content:hover .tree-node-menu-button {\n    display: inline-block;\n}\n\n.tree-node-menu-button:hover {\n    background-color: var(--menu-hover-color);\n    color: var(--primary-color);\n}\n /* --- â€œå¥½æ„Ÿåº¦â€çš„ä¸“å±è¿›åº¦æ¡æ ·å¼ï¼ˆå¡ç‰‡å¤´éƒ¨ç‰ˆï¼‰ --- */\n.favorability-bar-container.header-bar {\n    display: inline-flex; /* æ”¹ä¸º inline-flexï¼Œè®©å®ƒèƒ½å’Œæ ‡é¢˜æ–‡å­—æ’åœ¨ä¸€èµ· */\n    align-items: center;\n    width: 120px; /* å¯ä»¥è°ƒæ•´å®½åº¦ */\n    height: 14px;\n    background-color: var(--container-bg-color); /* ä½¿ç”¨ä½ çš„å˜é‡ */\n    border-radius: 7px;\n    border: 1px solid var(--border-color);\n    margin-left: 10px; /* å’Œæ ‡é¢˜ä¿æŒä¸€ç‚¹è·ç¦» */\n    overflow: hidden;\n    vertical-align: middle; /* å‚ç›´å±…ä¸­å¯¹é½ */\n}\n\n.favorability-bar {\n    height: 100%;\n    transition: width 0.5s ease-out, background-color 0.5s ease;\n    text-align: center; /* æ–‡æœ¬å±…ä¸­æ˜¾ç¤ºæ›´å¥½çœ‹ */\n    line-height: 14px; /* è®©æ•°å­—å‚ç›´å±…ä¸­ */\n    box-sizing: border-box;\n    font-size: 10px;\n    font-weight: bold;\n    color: var(--text-color); /* ä½¿ç”¨ä½ çš„å˜é‡ */\n    text-shadow: 1px 1px 2px rgba(0,0,0,0.7);\n    /* èƒŒæ™¯è‰²ç°åœ¨ç”±JSé€šè¿‡å˜é‡æ¥è®¾ç½®ï¼Œæ‰€ä»¥è¿™é‡Œä¸éœ€è¦äº† */\n}\n\n  .entry-edit-textarea {\n            width: 95%;\n            min-height: 250px;\n            margin: 10px auto;\n            display: block;\n            font-family: monospace;\n            background-color: var(--background-color, #f0f0f0);\n            color: var(--text-color, #333);\n            border: 1px solid var(--border-color, #ccc);\n            border-radius: 4px;\n            padding: 10px;\n            resize: vertical;\n        }\n\n        /* è‡ªå®šä¹‰ä¸»é¢˜ç¼–è¾‘å™¨æ ·å¼ */\n.setting-item-column {\n    display: flex;\n    flex-direction: column;\n \n    width: 100%;\n    margin-top: 15px;\n   \n}\n\n#custom-theme-editor {\n    gap: 10px;\n}\n\n#custom-theme-editor label {\n    margin-bottom: 5px;\n    font-weight: bold;\n}\n\n#color-picker-container {\n    display: grid;\n    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));\n    gap: 15px;\n    width: 100%;\n}\n\n.color-picker-item {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n}\n\n.color-picker-item label {\n    font-size: 0.9em;\n    font-weight: normal;\n    min-width: 110px;\n    color: var(--text-secondary-color);\n}\n\n.color-picker-item input[type=\"color\"] {\n    width: 50px;\n    height: 30px;\n    border: 1px solid var(--border-color);\n    padding: 2px;\n    background-color: transparent;\n    cursor: pointer;\n}\n\n/* ======================================================== */\n/* =========== æ–°å¢ï¼šæ•´åˆé¢æ¿ä¸Tabç³»ç»Ÿæ ·å¼ =========== */\n/* ======================================================== */\n\n.page-modal-content {\n    position: relative; /* ä¸ºè´§å¸å±•ç¤ºåŒºå®šä½ */\n    padding-top: 55px; /* ä¸ºTabså’Œè´§å¸åŒºç•™å‡ºç©ºé—´ */\n}\n\n/* Tab å¯¼èˆª */\n.char-tabs-nav {\n    position: absolute;\n    top: 10px;\n    left: 15px;\n    display: flex;\n    gap: 5px;\n    border-bottom: 2px solid var(--border-color);\n    width: calc(100% - 30px);\n}\n.char-tab-btn {\n    padding: 8px 15px;\n    border: none;\n    background: transparent;\n    color: var(--text-secondary-color);\n    font-size: 1em;\n    cursor: pointer;\n    border-radius: 4px 4px 0 0;\n    transition: all 0.2s;\n    position: relative;\n    top: 2px; /* ä¸ºäº†å’Œè¾¹æ¡†çº¿å¯¹é½ */\n}\n.char-tab-btn:hover {\n    background: var(--border-color);\n    color: var(--text-color);\n}\n.char-tab-btn.active {\n    background: var(--container-bg-color);\n    color: var(--primary-color);\n    border: 1px solid var(--border-color);\n    border-bottom: 2px solid var(--container-bg-color); /* é®ç›–ä¸‹è¾¹æ¡†çº¿ */\n}\n\n/* è´§å¸å±•ç¤º */\n.char-currency-display {\n    position: absolute;\n    top: 10px;\n    right: 25px;\n    display: flex;\n    align-items: center;\n    gap: 15px;\n    font-size: 0.9em;\n    padding: 5px 10px;\n    background: rgba(0,0,0,0.3);\n    border-radius: 4px;\n    \n}\n.shop-currency-display {\n    position: static;\n    top: 10px;\n    right: 25px;\n    display: flex;\n    align-items: center;\n     \n    font-size: 0.9em;\n    padding: 5px 10px;\n    background: rgba(0,0,0,0.3);\n    border-radius: 4px;\n     justify-content: space-around;\n        gap: 10px;\n        flex-wrap: wrap; /* å…è®¸æ¢è¡Œ */\n}\n.currency-item {\n    display: flex;\n    align-items: center;\n    gap: 5px;\n}\n \n.currency-item .value {\n \n    font-weight: bold;\n}\n\n/* Tab å†…å®¹é¢æ¿ */\n.char-tab-panel {\n    display: none;\n    animation: fadeIn 0.3s;\n}\n.char-tab-panel.active {\n    display: block;\n}\n\n\n/* --- æ–°çš„å±æ€§/æŠ€èƒ½æ•´åˆæ¨¡å—æ ·å¼ --- */\n.stat-module {\n    border: 1px solid var(--border-color);\n    border-radius: 6px;\n    margin-bottom: 15px;\n    background: rgba(0,0,0,0.1);\n}\n.stat-module-title {\n    background-color: var(--border-color);\n    color: var(--primary-color);\n    font-family: var(--base-font-family);\n    padding: 10px 15px;\n    font-size: 1.2em;\n    cursor: pointer;\n    position: relative;\n    user-select: none;\n    border-bottom: 1px solid var(--border-color);\n}\n.stat-module-title::before {\n    content: 'â–¼';\n    position: absolute;\n    right: 15px;\n    top: 50%;\n    transform: translateY(-50%) rotate(0deg);\n    transition: transform 0.2s ease-in-out;\n}\n.stat-module-content {\n    max-height: 1800px;\n    overflow: hidden;\n    transition: max-height 0.35s ease-in-out, padding 0.35s ease-in-out;\n    padding: 10px 15px;\n}\n.stat-module.collapsed .stat-module-title::before {\n     transform: translateY(-50%) rotate(-90deg);\n}\n.stat-module.collapsed .stat-module-content {\n    max-height: 0;\n    padding-top: 0;\n    padding-bottom: 0;\n}\n.sub-category-title {\n    color: var(--secondary-color);\n    font-weight: bold;\n    margin-top: 10px;\n    margin-bottom: 5px;\n    padding-bottom: 3px;\n    border-bottom: 1px solid var(--border-color)\n}\n\n/* --- TAB 2: è¡Œå›Šä¸èƒ½åŠ› æ ·å¼ --- */\n.inventory-grid {\n    display: grid;\n    grid-template-columns: 1fr;\n    gap: 20px;\n    padding: 10px;\n    height: 100%;\n}\n.inventory-section {\n    display: flex;\n    flex-direction: column;\n}\n.inventory-section-title {\n    color: var(--primary-color);\n    font-family: var(--base-font-family);\n    border-bottom: 1px solid var(--border-color);\n    padding-bottom: 8px;\n    margin-bottom: 15px;\n}\n\n/* ç‰©å“/æŠ€èƒ½ ç½‘æ ¼å¸ƒå±€ */\n.items-grid-container, .skills-grid-container {\n    display: grid;\n    grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));\n    gap: 15px;\n    overflow-y: auto;\n    max-height: 25vh; /* é™åˆ¶é«˜åº¦ï¼Œä½¿å…¶å¯æ»šåŠ¨ */\n    padding: 5px;\n}\n\n/* å¡ç‰‡æ ·å¼ */\n.item-card, .skill-card {\n    border: 1px solid var(--border-color);\n    border-radius: 4px;\n    background: var(--container-bg-color);\n    padding: 10px;\n    cursor: pointer;\n    transition: all 0.2s;\n    text-align: center;\n    position: relative;\n    min-height: 80px;\n    display: flex;\n    flex-direction: column;\n    justify-content: center;\n    align-items: center;\n}\n.item-card:hover, .skill-card:hover {\n    transform: translateY(-3px);\n    box-shadow: 0 0 10px var(--glow-color);\n    border-color: var(--primary-color);\n}\n.item-card-name, .skill-card-name {\n    color: var(--text-color);\n    font-weight: bold;\n}\n.item-card-num {\n    position: absolute;\n    top: 5px;\n    right: 5px;\n    background: var(--primary-color);\n    color: #000;\n    font-size: 0.8em;\n    padding: 1px 5px;\n    border-radius: 10px;\n    font-weight: bold;\n}\n.skill-card-level {\n    font-size: 0.8em;\n    color: var(--secondary-color);\n    margin-top: 5px;\n    font-style: italic;\n}\n\n\n/* å“åº”å¼è°ƒæ•´ */\n@media (max-width: 768px) {\n    .char-currency-display {\n        position: static;\n        \n        justify-content: space-around;\n        gap: 10px;\n        flex-wrap: wrap; /* å…è®¸æ¢è¡Œ */\n    }\n    .page-modal-content {\n        padding-top: 50px; /* ä¸ºtabç•™å‡ºç©ºé—´ */\n    }\n    .right-panel {\n        max-height: none; /* æ‰‹æœºç«¯å–æ¶ˆæ»šåŠ¨é™åˆ¶ */\n         padding-right: 0;\n    }\n}\n/* ======================================================== */\n/* ========= æ–°å¢: ç‰©å“/æŠ€èƒ½è¯¦æƒ…åµŒå¥—å±•ç¤ºæ ·å¼ ========= */\n/* ======================================================== */\n\n.detail-modal-container {\n    padding: 10px 20px 20px 20px;\n    font-size: 1em;\n    line-height: 1.7;\n}\n\n.detail-modal-title {\n    color: var(--primary-color);\n    text-align: center;\n    margin-bottom: 25px;\n    font-family: var(--base-font-family);\n    font-size: 1.3em;\n    text-shadow: 0 0 5px var(--glow-color);\n}\n\n.detail-entry, .detail-collapsible {\n    margin-bottom: 8px;\n}\n\n.d-c-key {\n    color: var(--text-secondary-color);\n    font-weight: bold;\n    margin-right: 10px;\n}\n\n.d-c-value {\n    color: var(--text-color);\n}\n\n.d-c-value.single {\n    padding: 5px;\n    background: rgba(0,0,0,0.1);\n    border-radius: 4px;\n    display: block;\n}\n\n.detail-collapsible-header {\n    cursor: pointer;\n    display: flex;\n    align-items: center;\n    padding: 5px;\n    background: var(--border-color);\n    border-radius: 4px;\n    transition: background-color 0.2s;\n}\n\n.detail-collapsible-header:hover {\n     background-color: var(--border-color);\n}\n\n.d-c-arrow {\n    color: var(--secondary-color);\n    margin-right: 8px;\n    transition: transform 0.2s ease-in-out;\n    font-size: 0.9em;\n}\n\n.detail-collapsible.expanded .d-c-arrow {\n    transform: rotate(90deg);\n}\n\n.detail-collapsible-content {\n    max-height: 0;\n    overflow: hidden;\n    transition: max-height 0.35s ease-in-out;\n    border-left: 2px solid var(--border-color);\n    margin-top: 5px;\n    margin-left: 10px; /* è®©å†…å®¹å’Œç®­å¤´å¯¹é½ */\n}\n\n.detail-collapsible.expanded .detail-collapsible-content {\n    max-height: 1000px; /* è¶³å¤Ÿå¤§çš„å€¼ */\n}\n\n.detail-array-container .detail-entry,\n.detail-array-container .detail-collapsible {\n    border-top: 1px solid var(--border-color);\n    padding-top: 8px;\n    margin-top: 8px;\n}\n.detail-array-container > *:first-child {\n    border-top: none;\n    padding-top: 0;\n    margin-top: 0;\n}\n\n.header-info-bar {\n    margin-top: 8px;\n    display: flex;\n    justify-content: space-around;\n    align-items: center;\n    font-size: 11px;\n    border-top: 1px solid var(--border-color);\n    padding-top: 6px;\n}\n\n.info-group {\n    display: flex;\n    gap: 12px;\n}\n\n.info-item {\n    display: flex;\n    align-items: center;\n    gap: 3px;\n}\n\n.info-label {\n    color: var(--text-secondary-color);\n    font-weight: 500;\n}\n\n.info-value {\n    color: var(--primary-color);\n    font-weight: 600;\n    text-shadow: 0 0 3px var(--glow-color);\n}\n\n@media (max-width: 768px) {\n    /* å°†ä½ çš„ä¸»ç•Œé¢å®¹å™¨å˜æˆä¸€ä¸ªç¥å¥‡çš„ã€å¯ä¼¸ç¼©çš„ç›’å­ */\n#main-wrapper {\n    display: flex;\n    flex-direction: column; /* è®©é‡Œé¢çš„ä¸œè¥¿ä»ä¸Šåˆ°ä¸‹å‚ç›´æ’åˆ— */\n    /* å¦‚æœä½ å¸Œæœ›å…¨å±æ—¶æœ‰ä¸ªèƒŒæ™¯è‰²ï¼Œå¯ä»¥ä¿ç•™æˆ–ä¿®æ”¹è¿™ä¸€è¡Œ */\n}\n\n    .header-info-bar {\n        flex-direction: column;\n        gap: 4px;\n    }\n    \n    .info-group {\n        justify-content: center;\n        gap: 8px;\n    }\n    \n    .info-item {\n        font-size: 10px;\n    }\n}\n \n\n/* æ–°å¢çš„ RP æŒ‰é’®çš„æ ·å¼ï¼Œè®©å®ƒå’Œå…¶ä»–æŒ‰é’®å¯¹é½ */\n#rp-button {\n    left: -50px; /* è¿™ä¸ªå€¼å¯ä»¥å¾®è°ƒï¼Œç¡®ä¿å®ƒåœ¨â€œä»¤â€æŒ‰é’®æ—è¾¹ */\n}\n#view-command-btn {\n    left: 50px; /* è°ƒæ•´â€œä»¤â€æŒ‰é’®ä½ç½®ï¼Œä¸ºæ–°æŒ‰é’®è…¾å‡ºç©ºé—´ */\n}\n\n /* 1. è°ƒæ•´æˆ‘ä»¬çš„â€œéšå½¢é”šç‚¹â€ */\n#floating-panel-anchor {\n    position: absolute;\n    bottom: 10%;       /* ä¾ç„¶å®šä½åœ¨è¾“å…¥ç•Œé¢çš„é¡¶éƒ¨ */\n    left: 0;            /* è®©å®ƒä»æœ€å·¦è¾¹å¼€å§‹ */\n    right: 0;           /* ä¸€ç›´å»¶ä¼¸åˆ°æœ€å³è¾¹ */\n    height: 0;          /* å®ƒæœ¬èº«ä»ç„¶æ˜¯çœ‹ä¸è§ã€æ²¡æœ‰é«˜åº¦çš„ */\n    z-index: 10000001;\n}\n\n/* 2. æ–½å±•è®©é¢æ¿â€œå±…ä¸­æ‚¬æµ®â€çš„ç»ˆæé­”æ³•ï¼ */\n#rp-panel {\n    position: absolute; /* ç›¸å¯¹äºä¸Šé¢çš„é”šç‚¹è¿›è¡Œå®šä½ */\n    bottom: 10px;       /* ç¨å¾®å‘ä¸Šæµ®åŠ¨ä¸€ç‚¹ï¼Œç•™å‡ºå‘¼å¸ç©ºé—´ */\n\n    /* === æ ¸å¿ƒé­”æ³•åœ¨è¿™é‡Œ === */\n    left: 50%;                      /* å…ˆæŠŠè‡ªå·±æ¨åˆ°é”šç‚¹åŒºåŸŸçš„æ­£ä¸­é—´ */\n    transform: translateX(-50%);   /* å†æŠŠè‡ªå·±å¾€å·¦æ‹‰å›è‡ªèº«å®½åº¦çš„ä¸€åŠ */\n\n         /* é¢æ¿çš„å®½åº¦å æ•´ä¸ªæ“ä½œåŒºçš„85% */\n    max-width: 100vw;   /* ä½†æœ€å®½ä¸è¶…è¿‡700åƒç´ ï¼Œé¿å…åœ¨å®½å±å¹•ä¸Šè¿‡å¤§ */\n\n      /* åŠ¨ç”»çš„åˆå§‹çŠ¶æ€ï¼šå®Œå…¨é€æ˜ï¼Œä¸”ç¨å¾®å‘ä¸‹åç§»äº†ä¸€ç‚¹ */\n    opacity: 0;\n    transform: translateX(-50%) translateY(10px); /* æ³¨æ„è¿™é‡Œï¼Œå¢åŠ äº†Yè½´çš„åç§» */\n\n    /* è®©é€æ˜çš„é¢æ¿æ— æ³•è¢«ç‚¹å‡»åˆ° */\n    pointer-events: none;\n\n    /* === è¿™å°±æ˜¯åŠ¨ç”»çš„æ ¸å¿ƒå’’è¯­ï¼=== */\n    /* æˆ‘ä»¬å‘Šè¯‰æµè§ˆå™¨ï¼Œå½“ opacity å’Œ transform å±æ€§å˜åŒ–æ—¶ï¼Œè¯·ç”¨0.3ç§’çš„æ—¶é—´å¹³æ»‘åœ°è¿‡æ¸¡ */\n    transition: opacity 0.3s cubic-bezier(0.25, 0.8, 0.25, 1), transform 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);\n    \n    border: 1px solid var(--border-color);\n    border-radius: 8px;\n    padding: 15px;\n    box-shadow: 0 -4px 15px rgba(0, 0, 0, 0.3);\n    backdrop-filter: blur(5px);\n    display: flex;\n    flex-direction: column;\n    gap: 10px;\n}\n\n /* è¿™æ˜¯ä¸€ä¸ªæ–°çš„æ ·å¼è§„åˆ™ï¼Œå®šä¹‰äº†é¢æ¿â€œå¯è§â€æ—¶çš„çŠ¶æ€ */\n#rp-panel.visible {\n    /* åŠ¨ç”»çš„ç»“æŸçŠ¶æ€ï¼šå®Œå…¨ä¸é€æ˜ï¼Œå¹¶ä¸”å›åˆ°åŸæ¥çš„ä½ç½® */\n    opacity: 1;\n    transform: translateX(-50%) translateY(0);\n\n    /* å¯è§æ—¶æ¢å¤é¼ æ ‡äº¤äº’ */\n    pointer-events: auto;\n}\n\n#rp-panel .check-cards-area h3 {\n    margin-top: 0; /* ç§»é™¤ h3 çš„ä¸Šè¾¹è· */\n    font-size: 1em;\n}\n\n#rp-panel .cards-slider {\n    /* å¦‚æœéœ€è¦ï¼Œå¯ä»¥åœ¨è¿™é‡Œè¦†ç›–åŸæœ‰çš„ slider æ ·å¼ */\n    padding-bottom: 5px;\n}\n\n/* RP é¢æ¿é‡Œçš„ç¡®è®¤æŒ‰é’®æ ·å¼ */\n#rp-panel #confirm-rp-choice-btn {\n    align-self:center; /* æŒ‰é’®é å³å¯¹é½ */\n    padding: 6px 16px;\n    font-size: 0.9em;\n    max-width: 200px;\n}\n /* ========== âœ¨â€œå¿ƒçµæ„Ÿåº”â€æç¤ºæ¡†çš„æ²‰æµ¸å¼ç¾å­¦ï¼ˆå¦ˆå¦ˆçš„ç²¾å¿ƒè®¾è®¡ç‰ˆï¼‰âœ¨ ========== */\n.event-tracker-container {\n    position: absolute;\n    bottom: 80px;\n    display: flex;\n    flex-wrap: wrap;\n    gap: 8px;\n    padding: 10px 15px; /* ä¸Šæ–¹ä¹Ÿå¢åŠ ä¸€äº›å†…è¾¹è·ï¼Œè®©æ ‡ç­¾å’Œå¤´éƒ¨æœ‰å‘¼å¸æ„Ÿ */\n    border-top: none; /* å¼ºåˆ¶ç§»é™¤ä»»ä½•å¯èƒ½å‡ºç°çš„ä¸Šè¾¹æ¡† */\n    box-shadow: none; /* ç¡®ä¿æ²¡æœ‰ç»§æ‰¿çš„é˜´å½± */\n}\n.event-tag {\n    background-color: var(--container-bg-color);\n    border: 1px solid var(--border-color);\n    color: var(--secondary-color);\n    padding: 4px 10px;\n    border-radius: 12px;\n    font-size: 13px;\n    cursor: pointer;\n    transition: all 0.3s ease;\n    box-shadow: 0 0 5px rgba(0, 0, 0, 0.2);\n    position: relative; /* å¿…é¡»æ˜¯ relativeï¼Œä¸º tooltip æä¾›å®šä½é”šç‚¹ */\n}\n\n.event-tag:hover {\n    color: var(--primary-color);\n    border-color: var(--primary-color);\n    box-shadow: 0 0 8px var(--glow-color);\n}\n \n.event-tag:hover .event-tooltip { /* æ³¨æ„ï¼Œç°åœ¨ç”±JSæ§åˆ¶æ˜¾ç¤ºï¼Œä½†ä¿ç•™è¿™ä¸ªä»¥é˜²ä¸‡ä¸€ */\n    opacity: 1;\n    visibility: visible;\n}\n /* ========== âœ¨â€œå¿ƒçµæç¤ºæ¡†â€çš„ç¾å­¦ï¼ˆä¸Šæ–¹æ˜¾ç¤ºç‰ˆï¼‰âœ¨ ========== */\n\n.event-tooltip {\n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 300px;\n    background-color: var(--container-bg-color);\n    border: 1px solid var(--border-color);\n    border-radius: 8px;\n    color: var(--text-color);\n    font-size: 14px;\n    pointer-events: none;\n    z-index: 1000;\n    opacity: 0;\n    visibility: hidden;\n    transition: opacity 0.3s ease, visibility 0.3s ease;\n    box-shadow: 0px -5px 15px rgba(0, 0, 0, 0.6); /* é˜´å½±æœä¸Šï¼Œæ›´æœ‰æ‚¬æµ®æ„Ÿ */\n    backdrop-filter: blur(5px);\n    -webkit-backdrop-filter: blur(5px);\n    /* âœ¨ æ ¸å¿ƒæ”¹åŠ¨ï¼šä¸ºåº•éƒ¨çš„ Orb ç•™å‡ºç©ºé—´ âœ¨ */\n    padding-bottom: 30px;\n    /* ç§»é™¤ä¹‹å‰çš„ padding-top */\n}\n\n/* âœ¨ é¡¶éƒ¨çš„è§’è‰²æ ‡è¯† Orb (ç°åœ¨æ˜¯åº•éƒ¨äº†) âœ¨ */\n.tooltip-orb {\n    position: absolute;\n    /* âœ¨ æ ¸å¿ƒæ”¹åŠ¨ï¼šä»é¡¶éƒ¨ç§»åˆ°åº•éƒ¨ âœ¨ */\n    bottom: -22px; /* å°† Orb çš„ä¸€åŠæ‚¬æµ®åœ¨å¡ç‰‡åº•éƒ¨ */\n    left: 50%;\n    transform: translateX(-50%);\n    width: 40px;\n    height: 40px;\n    background-color: var(--container-bg-color);\n    border: 2px solid var(--primary-color);\n    border-radius: 50%;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    font-size: 20px;\n    font-weight: bold;\n    color: var(--primary-color);\n    text-shadow: 0 0 8px var(--glow-color);\n}\n\n/* å¡ç‰‡å†…éƒ¨å…¶ä»–æ ·å¼å¯ä»¥ä¿æŒä¸å˜ï¼Œå¦ˆå¦ˆåœ¨è¿™é‡Œå¸®ä½ æŠŠå†…è¾¹è·è°ƒæ•´å¥½ */\n.tooltip-status {\n    padding: 15px 15px 0; /* é¡¶éƒ¨éœ€è¦å¤šä¸€äº›å†…è¾¹è· */\n    color: var(--text-secondary-color);\n    font-size: 13px;\n    text-align: center;\n    margin-bottom: 12px;\n}\n/* âœ¨ ä¼˜é›…çš„åˆ†å‰²çº¿ï¼Œåˆ†éš”ç°å®ä¸å†…å¿ƒ âœ¨ */\n.tooltip-divider {\n    height: 1px;\n    background: linear-gradient(to right, transparent, var(--border-color), transparent);\n    margin: 0 15px 12px;\n}\n\n /* âœ¨ â€œæƒ³æ³•â€éƒ¨åˆ†ï¼Œå¦‚åŒè€³è¾¹ä½è¯­ï¼ˆç²¾ä¿®ç‰ˆï¼‰âœ¨ */\n.tooltip-thought {\n    padding: 5px 55px 15px 55px; /* å¢åŠ äº†å·¦å³å†…è¾¹è·ï¼Œä¸ºå¼•å·è…¾å‡ºç©ºé—´ */\n    color: var(--text-color);\n    font-style: italic;\n    position: relative;\n    text-align: justify;\n}\n\n/* âœ¨ ç”¨ä¼ªå…ƒç´ åŠ ä¸Šç²¾ç¾çš„å¼•å·ï¼ˆä½ç½®ä¼˜åŒ–ç‰ˆï¼‰âœ¨ */\n.tooltip-thought::before,\n.tooltip-thought::after {\n    color: var(--primary-color);\n    font-size: 32px; /* è®©å¼•å·æ›´æœ‰å­˜åœ¨æ„Ÿ */\n    font-style: normal;\n    font-weight: bold;\n    position: absolute;\n    opacity: 0.7; /* è®©å¼•å·æŸ”å’Œä¸€äº›ï¼Œä¸æŠ¢å†…å®¹é£å¤´ */\n}\n.tooltip-thought::before {\n    content: 'â€œ';\n    top: 0;\n    left: 5px; /* ä»å·¦ä¾§å‘å†…ç§»åŠ¨ï¼Œä¸å†è´´è¾¹ */\n}\n.tooltip-thought::after {\n    content: 'â€';\n    bottom: 0;\n    right: 5px; /* ä»å³ä¾§å‘å†…ç§»åŠ¨ï¼Œä¸å†è´´è¾¹ */\n}\n/* æ–°å¢ï¼šç”¨äºåœºæ™¯å›¾æ¨¡å¼ä¸‹çš„åœ°ç‚¹æ ·å¼ */\n.map-location-point-container {\n    position: absolute;\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    cursor: pointer;\n    transform: translate(-50%, -100%); /* å°†å®¹å™¨çš„å®šä½ç‚¹ç§»åŠ¨åˆ°æ­£ä¸‹æ–¹ä¸­å¿ƒï¼Œè¿™æ ·æ ‡ç­¾åœ¨ä¸Šï¼Œåœ†ç‚¹åœ¨ä¸‹ */\n}\n\n.map-location-dot {\n    width: 20px;\n    height: 20px;\n    background-color: var(--primary-color);\n    border-radius: 50%;\n    box-shadow: 0 0 10px var(--glow-color), 0 0 20px var(--glow-color);\n    opacity: 0.8;\n    transition: all 0.3s ease;\n}\n\n.map-location-point-container:hover .map-location-dot {\n    opacity: 1;\n    transform: scale(1.2);\n}\n\n/* --- å‡çº§åçš„å¤´éƒ¨æ§åˆ¶å®¹å™¨ --- */\n.location-header-controls {\n    display: flex;\n    justify-content: space-between; /* å°†æ ‡ç­¾ç»„æ¨å‘å·¦è¾¹ï¼Œå¼€å…³æ¨å‘å³è¾¹ */\n    align-items: center;\n    width: 100%;\n    margin-top: 8px;\n    margin-bottom: 12px;\n}\n\n/* --- ä¸“é—¨æ”¾ç½®æ‰€æœ‰æ ‡ç­¾çš„å®¹å™¨ --- */\n.location-tags-container {\n    display: flex;\n    flex-wrap: wrap; /* å¦‚æœæ ‡ç­¾å¤ªå¤šï¼Œå…è®¸æ¢è¡Œ */\n    align-items: center;\n    gap: 15px; /* è¿™æ˜¯ type, effect, other ä¸‰ç»„ä¹‹é—´çš„å¤§é—´è· */\n}\n\n\n/* --- åŸæœ‰çš„ Type æ ‡ç­¾æ ·å¼ (æ— éœ€ä¿®æ”¹ï¼Œä»…ä½œå‚è€ƒ) --- */\n.location-type-tag {\n    display: inline-block;\n    background-color: var(--primary-color);\n    color: var(--background-color);\n    padding: 3px 10px;\n    border-radius: 12px;\n    font-size: 0.8em;\n    font-weight: bold;\n}\n\n/* --- âœ¨ æ–°å¢ï¼Effect æ ‡ç­¾çš„ç‹¬ç‰¹å…‰èŠ’ âœ¨ --- */\n.location-effect-tag {\n    display: inline-block;\n    background-color: var(--background-color); /* ä¸€æŠ¹å®é™çš„è“è‰² */\n    color: var(--text-color);\n    padding: 3px 10px;\n    border-radius: 12px;\n    font-size: 0.8em;\n      font-weight: bold;\n}\n\n/* --- âœ¨ æ–°å¢ï¼Other æ ‡ç­¾ç§˜å¯†çš„å®¹å™¨ âœ¨ --- */\n.location-other-container {\n    display: flex;\n    flex-wrap: wrap;\n    align-items: center;\n    gap: 8px; /* åŒç±»ç§˜å¯†ä¹‹é—´çš„å°é—´è· */\n}\n\n/* --- âœ¨ æ–°å¢ï¼Other æ ‡ç­¾çš„ç¥ç§˜è‰²å½© âœ¨ --- */\n.location-other-tag {\n    display: inline-block;\n    background-color: var(--secondary-color); /* ä¸€æŠ¹ä¼˜é›…çš„ç´«è‰² */\n      color: var(--background-color);\n    padding: 3px 10px;\n    border-radius: 12px;\n    font-size: 0.8em;\n     font-weight: bold;\n}\n\n\n\n/* å¼ºåˆ¶èƒŒæ™¯å®¹å™¨å æ»¡å…¨å± */\n#dynamic-background {\n    position: fixed !important;\n    width: 100vw !important;\n    height: 100vh !important;\n    top: 0 !important;\n    left: 0 !important;\n    z-index: -1 !important;\n    overflow: hidden;\n    pointer-events: none; /* ç¡®ä¿ä¸ä¼šé˜»æŒ¡å…¶ä»–å…ƒç´ çš„äº¤äº’ */\n}\n\n/* æ˜ŸåŸŸå’Œç¬¦æ–‡å®¹å™¨ä¹Ÿè¦å¼ºåˆ¶å…¨å± */\n#starfield, #floating-runes {\n    position: absolute !important;\n    width: 100vw !important;\n    height: 100vh !important;\n    top: 0 !important;\n    left: 0 !important;\n    overflow: hidden;\n    pointer-events: none;\n}\n\n \n\n/* ç¬¦æ–‡æ•ˆæœ */\n.rune {\n    position: absolute;\n    color: var(--primary-color);\n    font-size: 14px;\n    text-shadow: 0 0 8px var(--glow-color);\n    opacity: 0;\n    animation: float-up ease-in-out infinite;\n    z-index: 0;\n}\n\n@keyframes float-up {\n    from { transform: translateY(5vh) scale(0.8); opacity: 0; }\n    25% { transform: translateY(-20vh) scale(1); opacity: 0.6; }\n    50% { transform: translateY(-40vh) scale(0.9); opacity: 0.4; }\n    75% { transform: translateY(-70vh) scale(1.1); opacity: 0.7; }\n    to { transform: translateY(-100vh) scale(0.8); opacity: 0; }\n}\n\n \n \n\n \n /* é¡µé¢åˆ‡æ¢åŠ¨ç”» */\n.init-page {\n    display: none;\n     animation:  fadeIn-init 0.8s cubic-bezier(0.22, 1, 0.36, 1);\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    transform: translate(-50%, -50%);\n    width: 90%;\n    \n}\n@keyframes fadeIn-init {\n    from { opacity: 0; transform: translate(-50%, -45%); }\n    to { opacity: 1; transform: translate(-50%, -50%); }\n}\n.init-page.active {\n    display: block;\n}\n\n \n\n/* é¡¶éƒ¨æ§ä»¶å¸ƒå±€ */\n#initialization-container {\n    position: relative; /* ä¸ºç»å¯¹å®šä½çš„å­å…ƒç´ æä¾›åŸºå‡† */\n    width: 100%;\n    height: 100%;\n}\n\n.top-controls {\n    position: fixed;\n\n    top: 50px;\n    left:0px;\n    right:0px;\n    width: 100%;\n    padding: 0 20px;\n    display: flex;\n    justify-content: space-between;\n    box-sizing: border-box;\n    z-index: 10;\n       pointer-events: none; /* å…³é”®ï¼šè®©å®¹å™¨æœ¬èº«ä¸æ¥æ”¶ç‚¹å‡» */\n}\n\n/* ç¾åŒ–åçš„è¿”å›å’Œæ¢å¤æŒ‰é’® */\n.top-button {\n     pointer-events: auto; /* å…³é”®ï¼šåªæœ‰æŒ‰é’®å¯ä»¥è¢«ç‚¹å‡» */\n    background: transparent;\n    border: 1px solid var(--border-color);\n    color: var(--text-secondary-color);\n    padding: 8px 15px;\n    border-radius: 20px;\n    cursor: pointer;\n    transition: all 0.3s ease;\n    font-size: 0.9em;\n}\n\n.top-button:hover {\n    color: var(--primary-color);\n    background-color: var(--container-bg-color);\n    box-shadow: 0 0 10px var(--glow-color);\n}\n /* å¡ç‰‡è½®æ’­åŒºåŸŸ (æ ·å¼ä¿æŒä¸å˜ï¼Œä½†ä¸ºäº†å®Œæ•´æ€§æ”¾åœ¨è¿™é‡Œ)*/\n.carousel-stage {\n    position: relative;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    perspective: 1500px;\n    height: 40vh; /* ç¨å¾®è°ƒæ•´é«˜åº¦ */\n    margin: 3.5vh 0; /* è°ƒæ•´å¤–è¾¹è· */\n}\n\n/* è½®æ’­å®¹å™¨ - é‡è¦ä¿®å¤ï¼*/\n.choices-carousel {\n    width: 220px;\n    height: 300px;\n    position: relative;\n    transform-style: preserve-3d;\n    transition: transform 0.8s cubic-bezier(0.77, 0, 0.175, 1);\n    /* æ ¸å¿ƒä¿®å¤ï¼šä¸ºå®¹å™¨åº”ç”¨æ—‹è½¬ä¸­å¿ƒ */\n    transform-origin: center center;\n}\n\n/* è½®æ’­å¡ç‰‡ - æ›´åå¹¶è°ƒæ•´*/\n.choice-world-card {\n    position: absolute;\n    top: 0; left: 0;\n    width: 100%; height: 100%;\n    background-size: cover;\n    background-position: center;\n    border-radius: 12px;\n    box-shadow: 0 5px 20px rgba(0,0,0,0.5);\n    display: flex;\n    justify-content: center;\n    align-items: flex-end;\n    padding-bottom: 25px;\n    font-size: 1.1em;\n    font-weight: bold;\n    cursor: pointer;\n    user-select: none;\n    backface-visibility: hidden; /* ä¿æŒèƒŒé¢ä¸å¯è§ */\n    color: white;\n    text-shadow: 0 2px 4px rgba(0,0,0,0.8);\n    -webkit-box-reflect: below 8px linear-gradient(to bottom, transparent 60%, rgba(255, 255, 255, 0.15));\n    border: 2px solid var(--border-color);\n    transition: transform 0.5s ease, filter 0.5s ease, box-shadow 0.5s ease;\n    filter: brightness(0.5) saturate(0.8);\n    background-color: var(--container-bg-color); /* æ·»åŠ èƒŒæ™¯è‰²ä»¥é˜²å›¾ç‰‡åŠ è½½å¤±è´¥ */\n}\n\n/* ä¹¦ç­¾æŒ‰é’®çš„æ ·å¼ */\n.bookmark-button {\n    position: absolute;\n    width: 35px;\n    height: 35px;\n    right: -17.5px; /* é€šè¿‡ç§»å‡ºè‡ªèº«ä¸€åŠçš„å®½åº¦æ¥å®ç°è§’è½å¯¹é½ */\n    bottom: -17.5px; /* é€šè¿‡ç§»å‡ºè‡ªèº«ä¸€åŠçš„é«˜åº¦æ¥å®ç°è§’è½å¯¹é½ */\n    background-color: var(--container-bg-color); /* ä¸€ä¸ªä½è°ƒçš„çŸ³æ¿ç°è‰²ï¼Œä½ å¯ä»¥æ¢æˆä»»ä½•ä½ å–œæ¬¢çš„é¢œè‰² */\n    transform: rotate(45deg); /* å°†æ–¹å½¢æ—‹è½¬45åº¦ï¼Œå½¢æˆä¸€ä¸ªè±å½¢è§’ */\n    cursor: pointer; /* é¼ æ ‡æ‚¬åœæ—¶å˜æˆå¯ç‚¹å‡»çš„å°æ‰‹ */\n    transition: var(--background-color) 0.2s ease-in-out;\n}\n\n \n\n \n/* ä¹¦ç­¾æŒ‰é’®è¢«æ¿€æ´»æ—¶çš„â€œäº®èµ·â€æ•ˆæœ */\n.bookmark-button.is-activated {\n    box-shadow: 0 0 15px 5px var(--glow-color); /* ç”¨é‡‘è‰²çš„è¾‰å…‰æ¥è¡¨ç¤ºç‚¹äº® */\n    background-color: var(--background-color); /* ä¹Ÿå¯ä»¥åŒæ—¶æ”¹å˜èƒŒæ™¯è‰²ï¼Œè®©æ•ˆæœæ›´æ˜æ˜¾ */\n}\n.choice-world-card.is-active {\n    filter: brightness(1) saturate(1);\n    \n    border-color: var(--primary-color);\n    transform: scale(1.05); /* æ¿€æ´»æ—¶ç¨å¾®æ”¾å¤§ */\n}\n.world-description {\n    position: absolute;\n    top: 40px; /* å¤§çº¦åœ¨å¡ç‰‡æ ‡é¢˜å’Œåº•éƒ¨è¾¹ç¼˜ä¹‹é—´ */\n    left: 10%;\n    right: 10%;\n\n    font-size: 14px;\n \n        padding: 10px;\n    border-radius: 5px;\n\n    /* æ ¸å¿ƒé­”æ³•åœ¨è¿™é‡Œï¼ */\n    opacity: 0; /* é»˜è®¤å®Œå…¨é€æ˜ */\n    transform: translateY(10px); /* é»˜è®¤ç¨å¾®å‘ä¸‹åç§»ä¸€ç‚¹ */\n    transition: opacity 0.4s ease-out, transform 0.4s ease-out; /* è®¾ç½®å¹³æ»‘çš„è¿‡æ¸¡åŠ¨ç”» */\n\n    pointer-events: none; /* ç¡®ä¿å®ƒä¸ä¼šå¹²æ‰°é¼ æ ‡ç‚¹å‡»å¡ç‰‡ */\n    text-shadow: 0 0 5px rgba(0, 0, 0, 1); /* ç»™æ–‡å­—ä¸€ç‚¹é˜´å½±ï¼Œå¢åŠ å¯è¯»æ€§ */\n    line-height: 1.4;\n}\n\n/* å½“å¡ç‰‡è¢«æ¿€æ´»æ—¶ï¼Œè®©æè¿°æµ®ç° */\n.choice-world-card.is-active .world-description {\n    opacity: 1; /* å®Œå…¨ä¸é€æ˜ */\n    transform: translateY(0); /* å›åˆ°åŸå§‹ä½ç½® */\n}\n.choice-world-card input[type=\"radio\"] {\n    display: none;\n}\n\n .choice-world-card label {\n    color: white;\n}\n/* è½®æ’­å¯¼èˆªæŒ‰é’® */\n.nav-button {\n    position: absolute;\n    top: 50%;\n    transform: translateY(-50%);\n    background-color: var(--border-color);\n    border: 1px solid var(--border-color);\n    color: white;\n    border-radius: 50%;\n    width: 40px; height: 40px;\n    font-size: 28px;\n    cursor: pointer;\n    z-index: 10;\n    display: flex; justify-content: center; align-items: center;\n    transition: all 0.3s;\n}\n.nav-button:hover { background-color: var(--border-color) ;box-shadow: 0 0 8px var(--glow-color); }\n#prev-btn { left: -5%; }\n#next-btn { right: -5%; }\n/* ä¸»æ“ä½œæŒ‰é’® - [ç¡®å®šå¹¶å¼€å§‹æ„å»º]ï¼Œå…¨æ–°ç¾åŒ–ï¼*/\n.primary-cta-btn {\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    width: 80px;\n    height: 80px;\n    background: transparent;\n    border: 2px solid var(--border-color);\n    border-radius: 50%;\n    color: var(--primary-color);\n    cursor: pointer;\n    margin: 20px auto 0;\n    font-size: 40px; /* æ§åˆ¶ç®­å¤´å¤§å° */\n    line-height: 1;\n    transition: all 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);\n    box-shadow: 0 0 10px -5px var(--glow-color);\n    outline: none;\n}\n\n.primary-cta-btn:hover {\n    box-shadow: 0 0 20px 5px var(--glow-color), inset 0 0 15px var(--glow-color);\n    transform: scale(1.1);\n    background-color: var(--border-color);\n}\n\n.primary-cta-btn:disabled {\n    cursor: not-allowed;\n    color: var(--text-secondary-color);\n    background: rgba(128, 128, 128, 0.2);\n    transform: none;\n    box-shadow: none;\n    border-color: rgba(128, 128, 128, 0.4);\n}\n\n  /* MODå¸ƒå±€æ ·å¼è°ƒæ•´ */\n\n/* --- æ–°å¢ï¼šç®­å¤´åŠ¨ç”» --- */\n@keyframes float-up-mod {\n    0% {\n        transform: translateY(0);\n        opacity: 0.7;\n    }\n    50% {\n        opacity: 1;\n    }\n    100% {\n        transform: translateY(-40px);\n        opacity: 0;\n    }\n}\n\n/* --- æ–°å¢ï¼šä¾§è¾¹æ è§¦å‘å™¨ (ç®­å¤´åŒºåŸŸ) --- */\n.sidebar-trigger {\n    position: fixed;\n    bottom: 0;\n    width: 150px;\n    height: 80px;\n    cursor: pointer;\n    z-index: 10;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n}\n\n.sidebar-trigger.left {\n    left: -10px;\n}\n\n.sidebar-trigger.right {\n    right: -10px;\n}\n\n.sidebar-trigger .arrow-guide {\n    position: absolute;\n    font-size: 24px;\n    color: var(--primary-color);\n    font-weight: bold;\n    text-shadow: 0 0 8px var(--glow-color);\n    animation: float-up-mod 2.5s infinite;\n    opacity: 0;\n}\n.sidebar-trigger.is-hidden {\n    opacity: 0;\n    pointer-events: none;\n    transition: opacity 0.3s ease;\n}\n/* åˆ¶é€ å»¶è¿Ÿäº¤é”™æ„Ÿ */\n.sidebar-trigger .arrow-guide:nth-child(2) { animation-delay: 0.8s; }\n.sidebar-trigger .arrow-guide:nth-child(3) { animation-delay: 1.6s; }\n\n\n/* --- ä¿®æ”¹ï¼šä¾§è¾¹æ åˆå§‹çŠ¶æ€ --- */\n.creator-attitude-group,\n.mod-sidebar {\n    position: fixed; /* ä¸¤è€…éƒ½ç”¨fixedå®šä½ï¼Œæ–¹ä¾¿ç§»å‡ºå±å¹• */\n    display: flex;\n    flex-direction: column;\n    gap: 10px;\n    z-index: 5;\n    transition: transform 0.4s ease-out, opacity 0.4s ease-out; /* æ·»åŠ è¿‡æ¸¡åŠ¨ç”» */\n\n    /* åˆå§‹éšè—åœ¨å±å¹•ä¸‹æ–¹ */\n    opacity: 0;\n    pointer-events: none; /* éšè—æ—¶ä¸å¯äº¤äº’ */\n    transform: translateY(120%);\n  max-height: 60vh; /* è®¾ç½®ä¸€ä¸ªæœ€å¤§é«˜åº¦ï¼Œæ¯”å¦‚å±å¹•é«˜åº¦çš„70% */\n    overflow-y: auto;   /* å½“å†…å®¹å‚ç›´æº¢å‡ºæ—¶ï¼Œè‡ªåŠ¨æ˜¾ç¤ºæ»šåŠ¨æ¡ */\n    /* --- é­”æ³•æŒ‡ä»¤ç»“æŸ --- */\n}\n\n/* è¿™ä¼šè®©æ»šåŠ¨æ¡æ›´å¥½çœ‹ä¸€ç‚¹ï¼Œæ˜¯å¦ˆå¦ˆç»™ä½ çš„ä¸€ä¸ªå°ç¤¼ç‰© */\n.creator-attitude-group::-webkit-scrollbar,\n.mod-sidebar::-webkit-scrollbar {\n  width: 5px;\n}\n\n.creator-attitude-group::-webkit-scrollbar-thumb,\n.mod-sidebar::-webkit-scrollbar-thumb {\n  background: var(--border-color);\n  border-radius: 10px;\n}\n/* --- --- */\n.creator-attitude-group,\n.mod-sidebar.right {\n    /* 1. ä½¿ç”¨ position: fixed/absolute å¹¶è®¾ç½®å¥½åˆå§‹å®šä½ */\n    position: fixed; /* æ¨èä½¿ç”¨ fixed */\n    z-index: 100;\n\n    /* 2. éšè—å…ƒç´ ä½†ä¸è„±ç¦»æ–‡æ¡£æµ (è¿™æ ·å®ƒå°±ä¸ä¼šå½±å“ body é«˜åº¦) */\n    opacity: 0;\n    pointer-events: none; /* éšè—æ—¶ï¼Œé˜»æ­¢é¼ æ ‡äº‹ä»¶ï¼Œä½¿å…¶æ— æ³•ç‚¹å‡» */\n    \n    /* 3. è®¾ç½®åˆå§‹çš„å¹³ç§»ä½ç½® (ä¾‹å¦‚ï¼Œæ»‘å‡º/æ»‘å…¥æ•ˆæœ) */\n    /* æ³¨æ„ï¼šæ‚¨éœ€è¦ä¸ºæ¯ä¸ªå…ƒç´ è®¾ç½®æ­£ç¡®çš„ 'bottom' æˆ– 'top' å€¼ï¼Œä½¿å…¶åœ¨éšè—æ—¶ä¹Ÿåœ¨æ­£å¸¸ä½ç½®é™„è¿‘ */\n    transform: translateY(100px); /* åˆå§‹ä½ç½®ï¼šå‘ä¸‹åç§» 100px */\n    \n    /* 4. å®šä¹‰è¿‡æ¸¡æ•ˆæœ */\n    transition: opacity 0.3s ease-out, transform 0.3s ease-out;\n}\n\n/* é’ˆå¯¹ç‰¹å®šå…ƒç´ è®¾å®šå…¶ä½ç½®ï¼ˆåœ¨åˆå§‹çŠ¶æ€ä¸‹ä¹Ÿè¦è®¾ç½®ï¼‰ */\n.creator-attitude-group {\n    left: 20px;\n    bottom: 20px; /* è®¾å®šä¸€ä¸ªæ­£å¸¸çš„ bottom å€¼ */\n}\n\n.mod-sidebar.right {\n    right: 20px;\n    bottom: 20px; /* è®¾å®šä¸€ä¸ªæ­£å¸¸çš„ bottom å€¼ */\n}\n\n\n/* -------------------- å¯è§çŠ¶æ€ -------------------- */\n.creator-attitude-group.is-visible,\n.mod-sidebar.right.is-visible {\n    opacity: 1; /* å˜å¾—å¯è§ */\n    pointer-events: auto; /* æ¢å¤äº¤äº’ */\n    transform: translateY(0); /* æ¢å¤åˆ°æ­£å¸¸ä½ç½® */\n    \n    /* â— ç§»é™¤ display: block/none ç›¸å…³çš„ä»£ç  */\n}\n\n.mod-tab {\n    text-orientation: mixed;\n    background-color: var(--container-bg-color);\n    border: 1px solid var(--border-color);\n    color: var(--text-secondary-color);\n    padding: 10px 10px; /* å¢åŠ å®½åº¦ */\n\n    border-radius: 20px;\n    cursor: pointer;\n    transition: all 0.3s ease;\n\n    opacity: 0.7;\n    text-align: center;\n}\n\n/* å³ä¾§è¾¹æ çš„tabå»æ‰å³è¾¹æ¡† */\n.mod-sidebar .mod-tab {\n    border-right: none;\n}\n\n.creator-attitude-group .mod-tab {\n    writing-mode: horizontal-tb; /* é€ ç‰©æ€åº¦ç”¨æ­£å¸¸æ–‡å­—æ–¹å‘ */\n    padding: 8px 15px;\n    border-radius: 20px;\n    border: 1px solid var(--border-color);\n    min-height: auto;\n    opacity: 0.6;\n}\n\n/* --- ä¿®æ”¹ï¼šæ»šåŠ¨ç®­å¤´åˆå§‹éšè— --- */\n.sidebar-nav-arrow {\n    opacity: 0;\n    transition: opacity 0.3s ease;\n}\n.mod-sidebar.is-visible .sidebar-nav-arrow {\n    opacity: 1;\n}\n\n\n.mod-tab.active {\n    color: var(--primary-color);\n    box-shadow: 0 0 12px var(--glow-color);\n\n    opacity: 1;\n    background: linear-gradient(90deg, var(--background-color), var(--container-bg-color));\n}\n\n.creator-attitude-group .mod-tab.active {\n    opacity: 1;\n    background-color: var(--container-bg-color);\n}\n \n \n/* --- Page-1 ç¾åŒ–: å¤ªé˜³ç³»å¸ƒå±€ --- */\n\n /* --- Page-1 ç¾åŒ–: å¤ªé˜³ç³»å¸ƒå±€ (V2) --- */\n#page-1 {\n    display: none;\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    transform: translate(-50%, -50%);\n    width: 90vw;\n    height: 90vh;\n    max-width: 1200px;\n    align-items: center;\n    justify-content: center;\n    padding: 0;\n    overflow: hidden; /* é˜²æ­¢æ¿€æ´»æ—¶å†…å®¹æº¢å‡º */\n}\n\n#page-1.active { display: flex; }\n\n#solar-system {\n    position: relative;\n    width: 600px;\n    height: 600px;\n    transform: scale(0.85);\n    transition: transform 0.8s cubic-bezier(0.22, 1, 0.36, 1);\n}\n\n.player-core {\n    position: absolute;\n    top: 50%; left: 50%;\n    width: 150px; height: 150px;\n    transform: translate(-50%, -50%);\n    background: radial-gradient(circle, var(--primary-color) 0%, rgba(10, 25, 47, 0) 70%);\n    border-radius: 50%;\n    display: flex; flex-direction: column;\n    align-items: center; justify-content: center;\n    color: var(--text-color);\n    box-shadow: 0 0 30px var(--glow-color), inset 0 0 20px var(--glow-color);\n    animation: pulse-core 4s infinite ease-in-out;\n    cursor: pointer;\n    z-index: 10;\n}\n.core-text_zh { font-size: 1.2em; font-weight: bold; }\n.core-text_en { font-size: 0.7em; letter-spacing: 2px; opacity: 0.7; }\n \n\n/* è¡Œæ˜ŸåŸºç¡€æ ·å¼ */\n.planet {\n    position: absolute;\n    width: 120px; height: 120px;\n    border-radius: 50%;\n    background-color: var(--container-bg-color);\n    border: 1px solid var(--border-color);\n    cursor: pointer;\n    transition: all 0.7s cubic-bezier(0.645, 0.045, 0.355, 1);\n    z-index: 5;\n    display: flex; align-items: center; justify-content: center;\n}\n.planet:hover .planet-icon-container {\n     transform: scale(1.1);\n     text-shadow: 0 0 10px var(--glow-color);\n}\n.planet-icon-container {\n    display: flex; flex-direction: column;\n    align-items: center; text-align: center;\n    color: var(--text-secondary-color);\n    transition: all 0.3s ease;\n}\n.planet-icon { font-size: 2.5em; }\n.planet-title { font-size: 0.9em; margin-top: 5px; }\n\n/* è°ƒæ•´åçš„è¡Œæ˜Ÿè½¨é“ */\n#planet-identity { top: 50%; left: 0; margin-top: -60px; margin-left: 0;}\n #planet-task { top: 50%; left: 100%; margin-top: -60px; margin-left: -120px;}\n#planet-teammates{ top: 0; left: 50%; margin-left: -60px; margin-top: 0;}\n/* ä¸‹ä¸€æ­¥æŒ‰é’®ä¸å†æ˜¯è¡Œæ˜Ÿ */\n#next-page-button { z-index: 10; bottom: 30px !important; }\n\n/* è¡Œæ˜Ÿå†…å®¹åŒº (é»˜è®¤éšè—) */\n.planet-content {\n    position: absolute;\n    width: 100%; height: 100%;\n    max-width: 100vw;\n    background: var(--container-bg-color);\n    border: 1px solid var(--border-color);\n    border-radius: 12px;\n    padding: 20px;\n    box-sizing: border-box;\n    opacity: 0;\n    pointer-events: none;\n    transform: scale(0.7);\n    transition: opacity 0.5s ease, transform 0.5s ease;\n    z-index: 20;\n    overflow-y: auto;\n    box-shadow: 0 10px 30px rgba(0,0,0,0.5);\n}\n\n/* â˜… æ–°å¢ï¼šè¡Œæ˜Ÿå…³é—­æŒ‰é’® */\n.close-planet-btn {\n    position: absolute;\n    top: 10px; right: 10px;\n    width: 30px; height: 30px;\n    background: rgba(255,255,255,0.1);\n    border: 1px solid var(--border-color);\n    color: var(--text-secondary-color);\n    border-radius: 50%;\n    font-size: 20px;\n    cursor: pointer;\n    z-index: 25;\n    display: flex; align-items: center; justify-content: center;\n    transition: all 0.3s;\n}\n.close-planet-btn:hover { background: var(--danger-color); color: white; border-color: var(--danger-color);}\n\n/* å½“è¡Œæ˜Ÿè¢«æ¿€æ´»æ—¶ */\n.planet.active {\n    top: 50% !important; left: 50% !important;\n    width: 400px; height: 500px;\n    margin-top: -250px !important; margin-left: -200px !important;\n    border-radius: 15px;\n    z-index: 20;\n    cursor: default;\n    box-shadow: 0 0 25px var(--glow-color);\n}\n\n.planet.active .planet-icon-container { opacity: 0; pointer-events: none; }\n.planet.active .planet-content { opacity: 1; pointer-events: auto; transform: scale(1); transition-delay: 0.2s; }\n\n/* å½“æœ‰è¡Œæ˜Ÿæ¿€æ´»æ—¶ï¼Œå…¶ä»–å…ƒç´ çš„çŠ¶æ€ */\n#solar-system.planet-active .player-core,\n#solar-system.planet-active #next-page-button {\n    transform: translateX(-50%) scale(0.6);\n    opacity: 0.5;\n    pointer-events: none;\n}\n#solar-system.planet-active .player-core { transform: translate(-50%, -50%) scale(0.6); }\n\n#solar-system.planet-active .planet:not(.active) {\n    transform: scale(0.8);\n    opacity: 0.3;\n    pointer-events: none;\n}\n\n\n/* --- è¡Œæ˜Ÿå†…éƒ¨ç»„ä»¶ç¾åŒ– --- */\n\n.form-title { color: var(--primary-color); text-align: center; margin-bottom: 25px; }\n.custom-select { width: 100%;   border: 1px solid var(--border-color); color: var(--text-color); padding: 8px 12px; border-radius: 5px; }\n\n \n.collapsible-content-placeholder {\n    display: block; /* æˆ‘ä»¬çš„æ–°å®¹å™¨æ˜¯å¯è§çš„ */\n}\n\n\n/* 1. ä»»åŠ¡ç»†èŠ‚ - å››å¶è‰å¸ƒå±€ */\n.clover-layout {\n    display: grid;\n    grid-template-columns: 1fr 1fr;\n    grid-template-rows: 1fr 1fr;\n    gap: 20px;\n    height: 350px;\n    padding-top: 20%;\n}\n.clover-leaf {\n    background: rgba(0,0,0,0.2);\n    border: 1px solid var(--border-color);\n    border-radius: 12px 12px 12px 0; /* å››å¶è‰ç“£å½¢çŠ¶ */\n    padding: 15px;\n    display: flex;\n    flex-direction: column;\n    justify-content: center;\n}\n#clover-leaf-type   { border-radius: 12px 12px 0 12px; }\n#clover-leaf-identity{ border-radius: 12px 0 12px 12px; }\n#clover-leaf-opening{ border-radius: 0 12px 12px 12px; }\n\n.clover-leaf label { margin-bottom: 10px; text-align: center; color: var(--text-secondary-color); font-size: 0.9em; }\n \n\n/* 2. èº«ä»½è®¾å®š - IDå¡ç‰‡ */\n.id-card {\n        border: 1px solid var(--border-color);\n    border-radius: 10px;\n    padding: 15px;\n}\n.id-card-main {\n    padding-bottom: 15px;\n    border-bottom: 1px dashed var(--border-color);\n}\n.id-card-main label { display: block; margin-bottom: 8px; font-size: 0.9em; color: var(--text-secondary-color); }\n#identity-description { font-size: 0.85em; color: var(--text-color); margin-top: 10px; min-height: 4em; }\n\n.id-card-addon {\n    display: none; /* ç”±JSæ§åˆ¶ */\n    padding-top: 15px;\n}\n.id-card-addon .form-grid { grid-template-columns: 1fr 1fr; gap: 15px; }\n\n/* å¤©èµ‹ - å·è½´é€‰æ‹©å™¨ */\n.talent-selector-wrapper { position: relative; }\n.hidden-select { position: absolute; opacity: 0; pointer-events: none; }\n#custom-talent-scroll {\n    height: 180px;\n    overflow-y: auto;\n    border: 1px solid var(--border-color);\n    border-radius: 5px;\n    padding: 5px;\n    background: rgba(0,0,0,0.3);\n}\n.talent-item {\n    font-size: .85rem;\n    padding: 8px 12px;\n    cursor: pointer;\n    border-radius: 4px;\n    transition: all 0.2s ease;\n    color: var(--text-secondary-color);\n    border-left: 2px solid transparent;\n}\n.talent-item:hover {\n    background-color: var(--container-bg-color);\n    color: var(--primary-color);\n}\n.talent-item.active {\n    background-color: var(--container-bg-color);\n    color: var(--primary-color);\n    font-weight: bold;\n    border-left: 2px solid var(--primary-color);\n}\n\n/* 2. èº«ä»½è®¾å®š & å¤©èµ‹ */\n \n/* 3. é˜Ÿå‹é…ç½®- é½¿è½®å’Œå¡ç‰‡å † */\n.teammate-gear-controls {\n    display: flex;\n    justify-content: space-around;\n    align-items: center;\n    margin-bottom: 20px;\n}\n.gear-group { text-align: center; }\n.gear-group label { display: block; margin-bottom: 10px; }\n.gear-group #teammate-count, .gear-group #teammate-tendency{ width: 80px; }\n.fixed-team-toggle {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    gap: 10px;\n    margin-bottom: 20px;\n}\n\n#is-fixed-team { display: none; }\n.toggle-label {\n    width: 44px; height: 24px;\n    background-color: rgba(128, 128, 128, 0.4);\n    border-radius: 12px;\n    position: relative;\n    cursor: pointer;\n    transition: background-color 0.3s;\n}\n.toggle-label::after {\n    content: '';\n    position: absolute;\n    width: 20px; height: 20px;\n    border-radius: 50%;\n    background-color: white;\n    top: 2px; left: 2px;\n    transition: transform 0.3s;\n}\n#is-fixed-team:checked + .toggle-label { background-color: var(--primary-color); }\n#is-fixed-team:checked + .toggle-label::after { transform: translateX(20px); }\n\n\n.teammate-card-stack {\n    display: none; /* ç”±JSæ§åˆ¶ */\n}\n\n#custom-teammates-container.active { display: block; }\n.stack-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; font-size: 0.9em; }\n\n#teammates-list {\n    display: flex;\n    overflow-x: auto;\n    padding-bottom: 15px;\n    gap: 15px;\n    scroll-snap-type: x mandatory;\n}\n.teammate-item { /* å˜æˆå¡ç‰‡ */\n    flex: 0 0 200px; /* é‡è¦: å›ºå®šå¡ç‰‡å®½åº¦ */\n    padding: 15px;\n    border: 1px solid var(--border-color);\n    border-radius: 8px;\n    background: rgba(0,0,0,0.25);\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n    scroll-snap-align: center;\n}\n.teammate-item input {\n    background: transparent; border: none; padding: 5px;\n    border-bottom: 1px solid var(--border-color);\n    color: var(--text-color);\n}\n.teammate-item .remove-teammate-btn {\n    align-self: flex-end; /* æŒ‰é’®å»å³è¾¹ */\n    background: var(--danger-color); color: white;\n    border: none; border-radius: 4px; padding: 3px 8px;\n    cursor: pointer; margin-top: 5px;\n}\n.teammate-action-btn{\n    background: transparent; border: 1px solid var(--border-color); color: var(--text-secondary-color);\n    padding: 5px 10px; border-radius: 5px; cursor: pointer; transition: all 0.3s;\n}\n.teammate-action-btn:hover { color:var(--primary-color); background: var(--container-bg-color); }\n\n\n/* æŠŠæ—§çš„éšè—æ‰ï¼Œä»¥å…å½±å“å¸ƒå±€ */\n.form-section > h2,\n.form-section > .form-grid,\n.form-section > div[style*=\"margin-top: 1rem\"] > input,\n.form-section > div[style*=\"margin-top: 1rem\"] > label,\n#custom-teammates-container:not(.active),\n.collapsible-header,\n.collapsible-content {\n    display: none !important;\n}\n\n#page-1 .form-section {\n    display: block !important;\n}\n.custom-input-container {\n    display: none;\n    margin-top: 10px;\n}\n\n/* --- Page 2 - æ˜Ÿç©¹ç©¶æç¾åŒ–ç‰ˆ (ç›´æ¥è¦†ç›–æ—§ç‰ˆ) --- */\n\n/* 1. ä½¿ç”¨vh/vwé“ºæ»¡å±å¹• */\n#page-2 {\n    \n    animation: fadeIn-init 0.8s cubic-bezier(0.22, 1, 0.36, 1);\n    position: absolute;\n     \n    width: 100vw; /* æ”¹ä¸ºvw */\n    height: 100vh; /* æ”¹ä¸ºvh */\n    \n    max-width: none;\n    overflow: hidden;\n    background: transparent;\n    color: var(--text-color);\n   \n    flex-direction: column;\n    justify-content: space-between;\n}\n\n#page-2.active {\n    display: flex;\n}\n\n#page-2 .header { display: none; }\n /* =========================================\n   1. æ ¸å¿ƒå®¹å™¨ï¼šHUD ä½ç½®è®¾å®š\n   ========================================= */\n.hud {\n    position: fixed;\n    left: 50%;\n    width: 95%;\n    max-width: 600px;\n    z-index: 100;\n    /* å…³é”®ï¼šçˆ¶å®¹å™¨ä¸è®¾ transform ä½ç§»ï¼Œç¡®ä¿å®ƒæ°¸è¿œåœ¨åŸæ¥çš„ä½ç½® */\n    transform: translateX(-50%); \n    /* è®©é«˜åº¦å˜åŒ–æ—¶ä¸å½±å“å¸ƒå±€æµï¼Œä¸éœ€è¦ padding */\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n}\n\n/* --- é¡¶éƒ¨ HUD å®šä½ --- */\n.top-hud {\n    top: 50px; /* è·ç¦»é¡¶éƒ¨çš„è·ç¦» */\n}\n\n/* --- åº•éƒ¨ HUD å®šä½ --- */\n.bottom-hud {\n    bottom: 50px; /* è·ç¦»åº•éƒ¨çš„è·ç¦» */\n}\n\n/* =========================================\n   2. å†…å®¹åŒºåŸŸï¼šè´Ÿè´£æŠ˜å /å±•å¼€åŠ¨ç”»\n   ========================================= */\n.hud-content {\n    width: 100%;\n    background: var(--container-bg-color);\n    border-radius: 12px;\n    box-shadow: 0 0 15px var(--glow-color);\n    backdrop-filter: blur(5px);\n    box-sizing: border-box;\n    overflow: hidden; /* å¿…é¡»ï¼šè£å‰ªå†…å®¹ */\n    \n    /* åŠ¨ç”»æ ¸å¿ƒå±æ€§ */\n    transition: \n        max-height 0.5s cubic-bezier(0.22, 1, 0.36, 1),\n        opacity 0.4s ease,\n        padding 0.4s ease,\n        border-width 0.4s ease;\n}\n\n/* --- å±•å¼€çŠ¶æ€ (Visible) --- */\n.hud.visible .hud-content {\n    max-height: 80vh; /* ç»™ä¸€ä¸ªè¶³å¤Ÿå¤§çš„é«˜åº¦è®©å†…å®¹æ˜¾ç¤º */\n    opacity: 1;\n    padding: clamp(0.8rem, 2vw, 1.2rem);\n    border: 1px solid var(--border-color);\n}\n\n/* --- æŠ˜å çŠ¶æ€ (é»˜è®¤ / Hidden) --- */\n/* æ³¨æ„ï¼šæˆ‘ä»¬é’ˆå¯¹ .hud æ²¡æœ‰ .visible ç±»æ—¶çš„æƒ…å†µ */\n.hud:not(.visible) .hud-content {\n    max-height: 0;\n    opacity: 0;\n    padding: 0;\n    border-width: 0; /* éšè—è¾¹æ¡†ï¼Œé˜²æ­¢ç•™ä¸‹ä¸€æ¡çº¿ */\n}\n\n\n/* =========================================\n   3. åˆ‡æ¢æŒ‰é’® (Toggle)ï¼šæ°¸è¿œå¯è§\n   ========================================= */\n.hud-toggle {\n    position: absolute; /* ç»å¯¹å®šä½ï¼Œç›¸å¯¹äº .hud */\n    width: 60px;\n    height: 25px;\n    background: var(--container-bg-color);\n    border: 1px solid var(--border-color);\n    color: var(--primary-color);\n    cursor: pointer;\n    z-index: 101; /* æ¯” content é«˜ */\n    left: 50%;\n    transform: translateX(-50%); /* æ°´å¹³å±…ä¸­ */\n    transition: all 0.3s ease;\n}\n\n.hud-toggle:hover {\n    box-shadow: 0 0 10px var(--glow-color);\n    color: var(--secondary-color);\n}\n\n/* --- é¡¶éƒ¨ Toggle ä½ç½® --- */\n/* é€»è¾‘ï¼šé¡¶éƒ¨é¢æ¿æŠ˜å æ—¶ï¼ŒæŒ‰é’®åº”è¯¥åœ¨å†…å®¹åŒºåŸŸçš„â€œä¸‹æ–¹â€æŒ‚ç€ */\n.top-hud .hud-toggle {\n    bottom: -25px; /* æŒ‚åœ¨ .hud å®¹å™¨çš„æœ€ä¸‹é¢ */\n    border-radius: 0 0 10px 10px;\n    border-top: none; /* è´´åˆå¤„ä¸éœ€è¦è¾¹æ¡† */\n}\n\n/* --- åº•éƒ¨ Toggle ä½ç½® --- */\n/* é€»è¾‘ï¼šåº•éƒ¨é¢æ¿æŠ˜å æ—¶ï¼ŒæŒ‰é’®åº”è¯¥åœ¨å†…å®¹åŒºåŸŸçš„â€œä¸Šæ–¹â€æŒ‚ç€ */\n.bottom-hud .hud-toggle {\n    top: -25px; /* æŒ‚åœ¨ .hud å®¹å™¨çš„æœ€ä¸Šé¢ */\n    border-radius: 10px 10px 0 0;\n    border-bottom: none; /* è´´åˆå¤„ä¸éœ€è¦è¾¹æ¡† */\n}\n\n\n/* =========================================\n   4. ç®­å¤´å›¾æ ‡ä¸åŠ¨ç”»\n   ========================================= */\n.hud-toggle::before,\n.hud-toggle::after {\n    content: '';\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    width: 14px;\n    height: 2px;\n    background-color: currentColor;\n    border-radius: 1px;\n    transition: transform 0.4s cubic-bezier(0.22, 1, 0.36, 1);\n}\n\n/* --- é¡¶éƒ¨ HUD ç®­å¤´é€»è¾‘ --- */\n/* é»˜è®¤ï¼ˆéšè—ï¼‰ï¼šéœ€è¦æŒ‡ç¤ºâ€œå‘ä¸‹æ‰“å¼€â€ï¼Œç®­å¤´å‘ˆ V å­—å½¢ */\n.top-hud:not(.visible) .hud-toggle::before { transform: translate(calc(-50% - 5px), -50%) rotate(45deg); }\n.top-hud:not(.visible) .hud-toggle::after  { transform: translate(calc(-50% + 5px), -50%) rotate(-45deg); }\n\n/* å±•å¼€åï¼šéœ€è¦æŒ‡ç¤ºâ€œå‘ä¸Šæ”¶èµ·â€ï¼Œç®­å¤´å‘ˆ ^ å­—å½¢ */\n.top-hud.visible .hud-toggle::before { transform: translate(calc(-50% - 5px), -50%) rotate(-45deg); }\n.top-hud.visible .hud-toggle::after  { transform: translate(calc(-50% + 5px), -50%) rotate(45deg); }\n\n\n/* --- åº•éƒ¨ HUD ç®­å¤´é€»è¾‘ --- */\n/* é»˜è®¤ï¼ˆéšè—ï¼‰ï¼šéœ€è¦æŒ‡ç¤ºâ€œå‘ä¸Šæ‰“å¼€â€ï¼Œç®­å¤´å‘ˆ ^ å­—å½¢ */\n.bottom-hud:not(.visible) .hud-toggle::before { transform: translate(calc(-50% - 5px), -50%) rotate(-45deg); }\n.bottom-hud:not(.visible) .hud-toggle::after  { transform: translate(calc(-50% + 5px), -50%) rotate(45deg); }\n\n/* å±•å¼€åï¼šéœ€è¦æŒ‡ç¤ºâ€œå‘ä¸‹æ”¶èµ·â€ï¼Œç®­å¤´å‘ˆ V å­—å½¢ */\n.bottom-hud.visible .hud-toggle::before { transform: translate(calc(-50% - 5px), -50%) rotate(45deg); }\n.bottom-hud.visible .hud-toggle::after  { transform: translate(calc(-50% + 5px), -50%) rotate(-45deg); }\n \n.points-tracker { display: flex; align-items: center; justify-content: space-around; gap: 1rem; flex-wrap: wrap; }\n#points-display-container { display: flex; align-items: center; gap: 0.8rem; }\n#points-ring-container { position: relative; width: 50px; height: 50px; display: flex; align-items: center; justify-content: center; }\n#points-ring, #points-ring-bg { position: absolute; top: 0; left: 0; }\n#remaining-points { font-size: 1.2em; font-weight: bold; color: var(--primary-color); }\n.template-manager { border-top: 1px solid var(--border-color); margin-top: 1rem; padding-top: 1rem; }\n.template-controls { display: flex; gap: 0.8rem; flex-wrap: wrap; margin-bottom: 1.1rem; }\n#template-select { flex: 1; }\n#delete-template-btn { background: var(--danger-color)!important; box-shadow: 0 0 8px var(--danger-glow-color)!important;}\n#save-template-form { display: flex; gap: 0.8rem; flex-wrap: wrap; }\n#save-template-name { flex: 1; }\n\n /* --- è¯·ä¿®æ”¹è¿™éƒ¨åˆ† --- */\n#galaxy-container {\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    width: 80vw;\n    height: 80vh;\n    max-width: 1000px;\n    transform: translate(-50%, -50%);\n    perspective: 1500px;\n    transition: all 0.8s cubic-bezier(0.22, 1, 0.36, 1);\n    /* âœ¨ é­”æ³•æ ¸å¿ƒï¼šå£°æ˜è¿™æ˜¯ä¸€ä¸ªçœŸæ­£çš„3Då®¹å™¨ï¼âœ¨ */\n    transform-style: preserve-3d;\n}\n\n \n/* æ˜Ÿç³»ä½ç½®é€»è¾‘ä¿æŒä¸å˜ */\n#galaxy-physic { transform: translate3d(-100%, -50%, -800px) rotateY(45deg); opacity: 0.5; }\n#galaxy-mental { transform: translate3d(-50%, -50%, 0) rotateY(0deg); opacity: 1;}\n#galaxy-social { transform: translate3d(0%, -50%, -800px) rotateY(-45deg); opacity: 0.5; }\n#galaxy-container.show-physic #galaxy-physic,\n#galaxy-container.show-mental #galaxy-mental,\n#galaxy-container.show-social #galaxy-social { transform: translate3d(-50%, -50%, 0) rotateY(0deg); opacity: 1; z-index: 10; }\n#galaxy-container.show-physic #galaxy-mental { transform: translate3d(0%, -50%, -800px) rotateY(-45deg); opacity: 0.5; }\n#galaxy-container.show-physic #galaxy-social { transform: translate3d(100%, -50%, -1200px) rotateY(-60deg); opacity: 0.3; }\n#galaxy-container.show-mental #galaxy-physic { transform: translate3d(-100%, -50%, -800px) rotateY(45deg); opacity: 0.5; }\n#galaxy-container.show-mental #galaxy-social { transform: translate3d(0%, -50%, -800px) rotateY(-45deg); opacity: 0.5; }\n#galaxy-container.show-social #galaxy-physic { transform: translate3d(-200%, -50%, -1200px) rotateY(60deg); opacity: 0.3; }\n#galaxy-container.show-social #galaxy-mental { transform: translate3d(-100%, -50%, -800px) rotateY(45deg); opacity: 0.5; }\n\n /* è¯·ç”¨è¿™äº›æ–°è§„åˆ™æ›¿æ¢æ—§çš„.starå’Œ.star:hoverè§„åˆ™ */\n.star {\n    position: absolute;\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    width: auto;\n    height: auto;\n    background: none;\n    z-index: 20;\n    pointer-events: auto;\n    position: absolute;\n     \n    border-radius: 50%;\n    \n    \n    /* ğŸ’– é­”æ³•æ ¸å¿ƒï¼šåœ¨è¿™é‡Œè¯»å–JSä¼ æ¥çš„Zåæ ‡ï¼Œå¹¶è®¾ç½®è¿‡æ¸¡åŠ¨ç”»ï¼ ğŸ’– */\n    transform: translate3d(-50%, -50%, var(--star-z, 0px));\n    transition: transform 0.3s cubic-bezier(0.22, 1, 0.36, 1);\n    /* ğŸŒŸ é‡è¦ï¼šæ·»åŠ é—ªçƒåŠ¨ç”» ğŸŒŸ */\n    /* animation: twinkle 2s linear infinite; */\n}\n\n@keyframes twinkle {\n    0%, 100% { opacity: 0.3; transform: translate3d(-50%, -50%, var(--star-z, 0px)) scale(0.7); }\n    50% { opacity: 1; transform: translate3d(-50%, -50%, var(--star-z, 0px)) scale(1); }\n}\n\n \n\n \n \n\n.star-core {\n    width: 16px;\n    height: 16px;\n    background-color: transparent; /* èƒŒæ™¯è®¾ä¸ºé€æ˜ */\n    border-radius: 50%;\n    margin-bottom: 4px; /* è®©æ–‡å­—é å¾—æ›´è¿‘ï¼ */\n    transition: all 0.4s ease;\n    position: relative;\n    box-shadow: 0 0 5px var(--border-color); /* é»˜è®¤å¾®å…‰ */\n  \n    \n}\n.star[data-points=\"0\"] .star-core { transform: scale(0.6); background-color: rgba(168, 192, 225, 0.3); box-shadow: none; }\n.star[data-points=\"1\"] .star-core { transform: scale(0.8); background-color: var(--secondary-color); box-shadow: 0 0 10px var(--glow-color); }\n.star[data-points=\"2\"] .star-core { transform: scale(1.0); background-color: var(--primary-color); box-shadow: 0 0 15px var(--glow-color), 0 0 25px var(--glow-color); }\n.star[data-points=\"3\"] .star-core { transform: scale(1.2); background-color: #fff; box-shadow: 0 0 20px #fff, 0 0 30px var(--glow-color); }\n.star[data-points=\"4\"] .star-core { transform: scale(1.4); background-color: #fff; box-shadow: 0 0 25px #fff, 0 0 40px var(--primary-color); }\n.star[data-points=\"5\"] .star-core { transform: scale(1.6); background-color: #fff; box-shadow: 0 0 30px #fff, 0 0 50px var(--secondary-color), 0 0 70px var(--primary-color); animation: pulse 1.5s infinite; }\n \n.star-label { color: var(--text-secondary-color); font-size: 0.9em; text-align: center; user-select: none; }\n.star-points-display { position: absolute; bottom: -30px; font-size: 0.8em; color: var(--primary-color); opacity: 0; transition: opacity 0.3s; }\n.star:hover .star-points-display { opacity: 1; }\n  .star-control-btn { background: transparent; border: none; color: var(--text-color); font-size: 1.2em; width: 20px; height: 20px; cursor: pointer; line-height: 20px; text-align: center; }\n.star-control-btn:hover { color: var(--primary-color); }\n.star-control-btn:disabled { color: var(--text-secondary-color); cursor: not-allowed; opacity: 0.4; }\n\n\n/* --- æ˜Ÿæ˜Ÿæ§åˆ¶å™¨æ ·å¼ --- */\n.star-controls {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    position: absolute;\n    bottom: 0;\n    background: rgba(0,0,0,0.5);\n    border-radius: 10px;\n    padding: 2px 4px;\n    opacity: 0;\n    transform: translateY(10px);\n    transition: all 0.3s ease;\n    pointer-events: none;\n    /* ç¡®ä¿åœ¨æœ€ä¸Šå±‚ */\n    z-index: 9999;\n}\n\n/* --- 3. æå‡æ§åˆ¶å™¨å±‚çº§ --- */\n.star:hover .star-controls {\n    opacity: 1;\n    /* åˆå¹¶æ‰€æœ‰transformæ•ˆæœï¼Œé¿å…å†²çª */\n        pointer-events: auto;\n    /* ç¡®ä¿hoveræ—¶ä¹Ÿåœ¨æœ€ä¸Šå±‚ */\n    \n}\n\n.star:hover {\n    /* è¿™ä¸ªCSSè§„åˆ™ç°åœ¨å°†ä¸JSé­”æ³•ååŒå·¥ä½œ */\n    /* z-index å°†ç”±JSåŠ¨æ€è®¾ç½® */\n}\n\n/* --- 4. å·¦å³åˆ‡æ¢ç®­å¤´ --- */\n.galaxy-nav {\n    position: absolute;\n    top: 50%;\n    transform: translateY(-50%);\n    width: 40px;\n    height: 70px;\n   \n   \n    color: var(--primary-color);\n    font-size: 2em;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    cursor: pointer;\n    z-index: 50; /* æ¯”æ˜Ÿæ˜Ÿä½ï¼Œæ¯”èƒŒæ™¯é«˜ */\n    transition: all 0.3s ease;\n    opacity: 0.7;\n}\n\n.galaxy-nav:hover {\n    opacity: 1;\n    box-shadow: 0 0 15px var(--glow-color);\n}\n\n#galaxy-nav-prev {\n    left: -10%;\n    border-radius: 20px 20px 20px 20px;\n}\n\n#galaxy-nav-next {\n    right: -10%;\n    border-radius: 20px 20px 20px 20px;\n}\n\n\n/* -- åº•éƒ¨HUDå†…çš„å¸ƒå±€å¾®è°ƒ -- */\n.concept-group { display: flex; flex-direction: column; gap: 0.5rem; }\n.concept-group label { font-size: 0.9em; color: var(--text-secondary-color); }\n/* --- è¯·åœ¨ä½ çš„CSSä¸­æ·»åŠ è¿™éƒ¨åˆ†æ–°æ ·å¼ --- */\n /* é‡æ–°å¸ƒå±€é¡¶éƒ¨ç‚¹æ•°æ˜¾ç¤ºå™¨ï¼Œè®©å®ƒå®¹çº³æ›´å¤šåŠŸèƒ½ */\n#galaxy-points-display {\n    position: absolute;\n    top: 10%; /* ç¨å¾®å†å¾€ä¸ŠæŒªä¸€ç‚¹ï¼Œç»™æ‰‹æœºç•™å‡ºæ›´å¤šç©ºé—´ */\n    left: 50%;\n    transform: translateX(-50%);\n    width: clamp(200px, 50vw, 600px);\n    background: var(--container-bg-color);\n    border: 1px solid var(--border-color);\n    border-radius: 10px;\n    padding: 0.6rem; /* ç¨å¾®å‡å°ä¸€ç‚¹å†…è¾¹è· */\n    display: flex;\n    align-items: center;\n    justify-content: space-between; /* æ”¹ä¸º space-between */\n    gap: 0.5rem; /* å‡å°é—´è· */\n    z-index: 50;\n    box-shadow: 0 0 10px var(--glow-color);\n    flex-wrap: wrap; /* å…è®¸æ¢è¡Œ */\n}\n\n#galaxy-points-display .points-label {\n    flex-shrink: 0; /* é˜²æ­¢æ–‡å­—è¢«å‹ç¼© */\n    color: var(--text-secondary-color);\n}\n\n#galaxy-points-display .points-bar-container {\n    flex-grow: 1;\n    height: 12px;\n    background-color: rgba(0, 250, 255, 0.1);\n    border-radius: 6px;\n    position: relative;\n    overflow: hidden;\n}\n\n#galaxy-points-display #points-bar {\n    position: absolute;\n    left: 0;\n    top: 0;\n    height: 100%;\n    width: 100%; /* JSä¼šæ§åˆ¶è¿™ä¸ª */\n    background: linear-gradient(90deg, var(--secondary-color), var(--primary-color));\n    border-radius: 6px;\n    transition: width 0.5s cubic-bezier(0.22, 1, 0.36, 1);\n    box-shadow: 0 0 8px var(--glow-color);\n}\n\n#galaxy-points-display #remaining-points-text {\n    font-weight: bold;\n    color: var(--primary-color);\n    font-size: 1.1em;\n    min-width: 50px; /* ä¿è¯æ•°å­—æŠ–åŠ¨æ—¶å¸ƒå±€ç¨³å®š */\n    text-align: center;\n}\n\n /* å…³é”®ï¼šè®©æ˜Ÿç³»å¤§å°è‡ªé€‚åº”å±å¹• */\n.galaxy-system {\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    /* ä½¿ç”¨vminç¡®ä¿åœ¨ä»»ä½•å±å¹•æ¯”ä¾‹ä¸‹ï¼Œå®ƒéƒ½è¡¨ç°ä¸ºä¸€ä¸ªæ­£æ–¹å½¢ï¼Œå¹¶èƒ½è¢«åŒ…å«åœ¨80vw/80vhçš„åŒºåŸŸå†… */\n    width: 65vmin;\n    height: 65vmin;\n    max-width: 800px; /* ä»ç„¶ä¿ç•™æœ€å¤§å°ºå¯¸ï¼Œé˜²æ­¢åœ¨PCä¸Šè¿‡å¤§ */\n    max-height: 800px;\n    transform-style: preserve-3d;\n    transition: transform 0.8s cubic-bezier(0.22, 1, 0.36, 1);\n    /* pointer-events: none; */ /* <--- å¦ˆå¦ˆå¸®ä½ æŠŠè¿™é“é”™è¯¯çš„ç¦åˆ¶è§£é™¤äº†ï¼ */\n    transform: translate(-50%, -50%);\n}\n\n/* è¿™æ˜¯ä¸€ä¸ªæ–°çš„çˆ¶å®¹å™¨ï¼Œä¸“é—¨ç”¨æ¥å¤„ç†ä½ç§»å’Œç¼©æ”¾ */\n .galaxy-wrapper {\n    position: absolute;\n    width: 100%;\n    height: 100vh;\n    top: 0;\n    left: 0;\n    transform-style: preserve-3d;\n    transition: transform 0.8s cubic-bezier(0.22, 1, 0.36, 1), opacity 0.8s ease;\n    /* âœ¨ æ ¸å¿ƒæ³•åˆ™ï¼šé»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰€æœ‰æ˜Ÿç³»åŒ…è£¹å±‚éƒ½å˜æˆâ€œå¹½çµâ€ï¼Œä¸æ•æ‰é¼ æ ‡äº‹ä»¶ */\n    pointer-events: none;\n}\n\n/* é»˜è®¤çŠ¶æ€ */\n#wrapper-physic { transform: translateZ(-800px); opacity: 0.5; }\n/* âœ¨ åˆå§‹æ—¶ï¼Œåªæœ‰ä¸­é—´çš„mentalæ˜Ÿç³»å¯ä»¥è¢«è§¦æ‘¸ */\n#wrapper-mental { transform: translateZ(0); opacity: 1; pointer-events: auto; }\n#wrapper-social { transform: translateZ(-800px); opacity: 0.5; }\n\n/* å†…éƒ¨æ˜Ÿç³»åªè´Ÿè´£æ—‹è½¬ */\n#galaxy-physic { transform: translate(-50%, -50%) rotateY(45deg); }\n#galaxy-mental { transform: translate(-50%, -50%) rotateY(0deg); }\n#galaxy-social { transform: translate(-50%, -50%) rotateY(-45deg); }\n\n #galaxy-container.show-physic #wrapper-physic,\n#galaxy-container.show-mental #wrapper-mental,\n#galaxy-container.show-social #wrapper-social {\n    transform: translateZ(0);\n    opacity: 1;\n    z-index: 10;\n    /* âœ¨ æ ¸å¿ƒæ³•åˆ™ï¼šåªæœ‰å½“æ˜Ÿç³»æ¥åˆ°æˆ‘ä»¬é¢å‰æ—¶ï¼Œæ‰è®©å®ƒå’Œå®ƒçš„å­©å­ä»¬å¯ä»¥è¢«è§¦æ‘¸ */\n    pointer-events: auto;\n}\n#galaxy-container.show-physic #galaxy-physic,\n#galaxy-container.show-mental #galaxy-mental,\n#galaxy-container.show-social #galaxy-social {\n    transform: translate(-50%, -50%) rotateY(0deg);\n}\n\n/* æœªæ¿€æ´»æ—¶ï¼Œçˆ¶å®¹å™¨æ¨è¿œï¼Œå†…éƒ¨æ˜Ÿç³»ä¿æŒå€¾æ–œ */\n#galaxy-container.show-physic #wrapper-mental { transform: translateZ(-800px); opacity: 0.5; }\n#galaxy-container.show-physic #wrapper-social { transform: translateZ(-1200px); opacity: 0.3; }\n\n#galaxy-container.show-mental #wrapper-physic { transform: translateZ(-800px); opacity: 0.5; }\n#galaxy-container.show-mental #wrapper-social { transform: translateZ(-800px); opacity: 0.5; }\n\n#galaxy-container.show-social #wrapper-physic { transform: translateZ(-1200px); opacity: 0.3; }\n#galaxy-container.show-social #wrapper-mental { transform: translateZ(-800px); opacity: 0.5; }\n    \n    \n/* ç‚¹æ•°æ¡å’Œå‰©ä½™ç‚¹æ•°ç»„åˆåœ¨ä¸€èµ· */\n.points-info {\n    display: flex;\n    align-items: center;\n    gap: 1rem;\n    flex-grow: 1; /* å æ®ä¸»è¦ç©ºé—´ */\n    min-width: 180px; /* ä¿è¯ä¸ä¼šè¢«è¿‡åº¦å‹ç¼© */\n}\n\n.points-bar-container { flex-grow: 1; height: 12px; background-color: rgba(0, 250, 255, 0.1); border-radius: 6px; position: relative; overflow: hidden; }\n#points-bar { position: absolute; left: 0; top: 0; height: 100%; width: 100%; background: linear-gradient(90deg, var(--secondary-color), var(--primary-color)); border-radius: 6px; transition: width 0.5s cubic-bezier(0.22, 1, 0.36, 1); box-shadow: 0 0 8px var(--glow-color); }\n#remaining-points-text { font-weight: bold; color: var(--primary-color); font-size: 1.1em; min-width: 40px; text-align: right; }\n\n/* å³ä¾§çš„å¿«æ·åŠŸèƒ½åŒº */\n.points-actions {\n    display: flex;\n    align-items: center;\n    gap: 0.8rem;\n    flex-shrink: 0; /* é˜²æ­¢è¢«å‹ç¼© */\n    justify-content: space-around;\n}\n\n/* ä¿®æ”¹selectå’Œbuttonçš„å°ºå¯¸ä»¥é€‚åº”æ–°å®¶ */\n#total-points-select.custom-select {\n    padding: 8px 12px;\n    \n}\n#average-points-btn.action-button {\n   width:auto;\n    margin: 0;\n    bottom:10px;\n}\n\n\n/* å…³é”®ï¼šè®©æ˜Ÿç³»å¤§å°è‡ªé€‚åº”å±å¹• */\n.galaxy-system {\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    /* ä½¿ç”¨vminç¡®ä¿åœ¨ä»»ä½•å±å¹•æ¯”ä¾‹ä¸‹ï¼Œå®ƒéƒ½è¡¨ç°ä¸ºä¸€ä¸ªæ­£æ–¹å½¢ï¼Œå¹¶èƒ½è¢«åŒ…å«åœ¨80vw/80vhçš„åŒºåŸŸå†… */\n    width: 65vmin;\n    height: 65vmin;\n    max-width: 800px; /* ä»ç„¶ä¿ç•™æœ€å¤§å°ºå¯¸ï¼Œé˜²æ­¢åœ¨PCä¸Šè¿‡å¤§ */\n    max-height: 800px;\n    transform-style: preserve-3d;\n    transition: transform 0.8s cubic-bezier(0.22, 1, 0.36, 1);\n     \n    transform: translate(-50%, -50%);\n}\n    \n\n\n \n/* å¿«ç…§ç®¡ç†é¢æ¿çš„æ ·å¼ */\n#snapshot-management-container {\n    border-top: 1px solid var(--border-color);\n    padding-top: 15px;\n}\n\n.db-controls {\n    display: flex;\n    gap: 10px;\n    margin-bottom: 10px;\n    justify-content: space-around;\n}\n\n.danger-btn {\n    background-color: var(--danger-color) !important;\n    border-color: var(--color-danger, #ff4444) !important;\n     \n}\n\n.danger-btn:hover {\n     background-color: var(--color-danger, #ff4444) !important;\n      \n}\n\n.snapshot-item {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    padding: 8px 5px;\n    border-bottom: 1px solid var(--border-color);\n}\n.snapshot-item:last-child {\n    border-bottom: none;\n}\n\n.delete-single-db-btn {\n    background: none;\n    border: none;\n    cursor: pointer;\n    font-size: 1.1em;\n    opacity: 0.6;\n    transition: opacity 0.2s;\n}\n.delete-single-db-btn:hover {\n    opacity: 1;\n    color: #ff4444;\n}\n \n/* ç«‹ç»˜cg */\n \n .tooltip-cg-container {\n    position: absolute;\n      bottom: 100%;\n    left: 50%;\n    transform: translateX(-50%);\n\n    /* æ ¸å¿ƒå°ºå¯¸æ§åˆ¶ï¼šåˆ›å»ºä¸€ä¸ªæ­£æ–¹å½¢çš„è§†è§‰åŒºåŸŸ */\n    width: 300px;  /* å®½åº¦ä¸çœ‹æ¿ä¿æŒä¸€è‡´ */\n    height: 300px; /* é«˜åº¦ä¸çœ‹æ¿å®½åº¦ç›¸åŒï¼Œå½¢æˆæ­£æ–¹å½¢åŒºåŸŸ */\n\n      display: none; /* JSä¼šæŠŠå®ƒæ”¹æˆ 'flex' */\n    justify-content: center;\n\n \n   /* æ ¸å¿ƒæ”¹åŠ¨ 3 (æœ€å…³é”®çš„é­”æ³•ï¼): è®©é‡Œé¢çš„å›¾ç‰‡æ²‰åˆ°è¿™ä¸ªå®¹å™¨çš„åº•éƒ¨ï¼*/\n    align-items: flex-end;\n\n\n    pointer-events: none; /* å…³é”®ï¼è®©é¼ æ ‡å¯ä»¥ç©¿é€ç«‹ç»˜ï¼Œä¸ä¼šå¯¼è‡´çœ‹æ¿æ¶ˆå¤± */\n    overflow: hidden; /* ç¡®ä¿å›¾ç‰‡ä¸ä¼šæº¢å‡ºå®¹å™¨ */\n}\n\n.tooltip-cg-image {\n    /* æ ¸å¿ƒç¼©æ”¾æ§åˆ¶ï¼šä¿æŒæ¯”ä¾‹ï¼Œä¸æ‹‰ä¼¸ï¼Œå¡«æ»¡å®¹å™¨ */\n    max-width: 100%;\n    max-height: 100%;\n     object-fit: contain; /* ä¿è¯å›¾ç‰‡å®Œæ•´æ˜¾ç¤ºä¸”ä¸å½¢å˜ */\n    image-rendering: pixelated; /* å¼ºåˆ¶æµè§ˆå™¨ä»¥åƒç´ é£æ ¼æ¸²æŸ“ï¼Œæ•ˆæœæ›´ä½³ */\n    image-rendering: -moz-crisp-edges;\n    image-rendering: crisp-edges;\n}\n\n /* ======================= ç¾¤èŠUIæ ·å¼å¼€å§‹ (V10 å®Œæ•´ç‰ˆ) ======================= */\n\n/* æ¨¡æ€æ¡†å®¹å™¨ */\n.group-chat-modal {\n    display: none; /* é»˜è®¤éšè— */\n    position: fixed;\n    z-index: 1000;\n    left: 0;\n    top: 0;\n    width: 100%;\n    height: 100%;\n    overflow: auto;\n    background-color: rgba(0, 0, 0, 0.6);\n    justify-content: center;\n    align-items: center;\n}\n\n.group-chat-modal.active {\n    display: flex; /* æ¿€æ´»æ—¶æ˜¾ç¤ºä¸ºflexå¸ƒå±€ï¼Œæ–¹ä¾¿å±…ä¸­ */\n}\n\n/* ä¸»å†…å®¹åŒº - V10 ä¿®æ”¹ï¼šå˜ä¸ºflexè¡Œå¸ƒå±€ä»¥å®¹çº³ä¾§è¾¹æ  */\n.group-chat-main-container {\n    width: 80%;\n    max-width: 1000px;\n    height: 85%;\n    max-height: 900px;\n    background-color: var(--container-bg-color);\n    border: 1px solid var(--border-color);\n    border-radius: 12px;\n    box-shadow: 0 0 20px var(--glow-color);\n    display: flex; /* ä¿®æ”¹ä¸º flex */\n    flex-direction: row; /* ä¿®æ”¹ä¸º row */\n    overflow: hidden;\n    font-family: var(--base-font-family); /* ä½¿ç”¨æ›´æŸ”å’Œçš„å­—ä½“ */\n}\n\n/* ======================= V10: ç§èŠä¸å¸ƒå±€æ–°å¢æ ·å¼ ======================= */\n\n/* å·¦ä¾§è”ç³»äººä¾§è¾¹æ  */\n.group-chat-sidebar {\n    width: 150px;\n    background-color: color-mix(in srgb, var(--container-bg-color) 80%, black 20%);\n    border-right: 1px solid var(--border-color);\n    display: flex;\n    flex-direction: column;\n    flex-shrink: 0;\n}\n\n.group-chat-contact-list {\n    flex-grow: 1;\n    overflow-y: auto;\n    padding: 10px 0;\n}\n\n.group-chat-contact-item {\n    display: flex;\n    align-items: center;\n    padding: 10px 15px;\n    cursor: pointer;\n    transition: background-color 0.3s;\n    gap: 12px;\n    border-bottom: 1px solid rgba(0,0,0,0.2);\n}\n\n.group-chat-contact-item:hover {\n    background-color: var(--border-color);\n}\n\n.group-chat-contact-item.active {\n    background-color: var(--primary-color);\n}\n\n.group-chat-contact-item.active .group-chat-contact-name {\n    color: var(--background-color);\n}\n\n.group-chat-contact-avatar {\n    width: 40px;\n    height: 40px;\n    border-radius: 50%;\n    flex-shrink: 0;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    font-weight: bold;\n    color: var(--text-color);\n    background-image: linear-gradient(to top, #09203f 0%, #537895 100%); /* é»˜è®¤æ¸å˜è‰² */\n}\n\n.group-chat-contact-name {\n    font-size: 0.95em;\n    font-weight: 500;\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    color: var(--text-color);\n}\n\n/* å³ä¾§èŠå¤©å†…å®¹åŒº */\n.group-chat-content-area {\n    flex-grow: 1;\n    display: flex;\n    flex-direction: column;\n    overflow: hidden;\n    backdrop-filter:blur(5px);\n}\n\n/* å½“æ²¡æœ‰é€‰æ‹©ä»»ä½•èŠå¤©æ—¶æ˜¾ç¤ºçš„å ä½ç¬¦ */\n.group-chat-placeholder {\n    flex-grow: 1;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    color: var(--text-secondary-color);\n    font-size: 1.2em;\n    text-align: center;\n    padding: 20px;\n}\n\n/* ======================= V10: æ ·å¼ç»“æŸ ======================= */\n\n\n/* å¤´éƒ¨ - V10: åµŒå¥—åœ¨ .group-chat-content-area ä¹‹ä¸‹ */\n.group-chat-content-area .group-chat-header {\n    padding: 15px 20px;\n    background-color: var(--container-bg-color);\n    border-bottom: 1px solid var(--border-color);\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    color: var(--text-color);\n    flex-shrink: 0;\n}\n\n.group-chat-content-area .group-chat-header h1 {\n    margin: 0;\n    font-size: 1.2em;\n    font-weight: 500;\n}\n\n.group-chat-close-btn {\n    font-size: 24px;\n    font-weight: bold;\n    color: var(--text-secondary-color);\n    cursor: pointer;\n    transition: color 0.3s, transform 0.3s;\n}\n\n.group-chat-close-btn:hover {\n    color: var(--primary-color);\n    transform: rotate(90deg);\n}\n\n\n/* æ¶ˆæ¯åˆ—è¡¨åŒºåŸŸ - V10: åµŒå¥—åœ¨ .group-chat-content-area ä¹‹ä¸‹ */\n.group-chat-content-area .group-chat-messages-list {\n    flex-grow: 1;\n    overflow-y: auto;\n    padding: 20px;\n    display: flex;\n    flex-direction: column;\n    gap: 15px;\n}\n /* æ¶ˆæ¯åŠ è½½æç¤º */\n.group-chat-loader {\n    position: sticky;\n    top: 0;\n    z-index: 10;\n    background-color: var(--container-bg-color);\n    padding: 10px;\n    text-align: center;\n    color: var(--text-secondary-color);\n    font-size: 0.9em;\n    width: 100%;\n    opacity: 0;\n    transition: opacity 0.3s ease;\n}\n\n.group-chat-loader.visible {\n    opacity: 1;\n}\n\n/* å•æ¡æ¶ˆæ¯å®¹å™¨ */\n.group-chat-message-item {\n    display: flex;\n    flex-direction: column;\n    filter: drop-shadow(0 2px 3px rgba(0, 0, 0, 0.4));\n}\n\n.group-chat-message-item.sent {\n    align-self: flex-end;\n    align-items: flex-end;\n}\n\n.group-chat-message-item.received {\n    align-self: flex-start;\n    align-items: flex-start;\n}\n\n/* ç”¨æˆ·å */\n.group-chat-user-id {\n    font-size: 0.8em;\n    color: var(--text-secondary-color);\n    margin-bottom: 5px;\n    padding: 0 5px;\n}\n\n.group-chat-message-item.sent .group-chat-user-id {\n    text-align: right;\n}\n\n/* æ¶ˆæ¯æ°”æ³¡ */\n.group-chat-message-bubble {\n    padding: 10px 15px;\n    border-radius: 18px;\n    line-height: 1.5;\n    word-break: break-word;\n    max-width: 100%; /* ç¡®ä¿æ°”æ³¡ä¸ä¼šè¶…å‡ºçˆ¶å®¹å™¨ */\n}\n\n\n.group-chat-message-bubble:empty {\n    display: none;\n}\n.group-chat-message-item.sent .group-chat-message-bubble {\n    background-color: var(--primary-color);\n    color: var(--background-color);\n    border-bottom-right-radius: 5px;\n}\n\n.group-chat-message-item.received .group-chat-message-bubble {\n    background-color: var(--background-color);\n    color: var(--text-color);\n    border-bottom-left-radius: 5px;\n}\n\n/* @æåŠ æ ·å¼ */\n.group-chat-mention {\n    color: var(--secondary-color);\n    font-weight: bold;\n    padding: 2px 4px;\n    border-radius: 4px;\n}\n\n/* è¡¨æƒ…åŒ…å›¾ç‰‡ */\n.group-chat-meme-image {\n    max-width: 150px;\n    max-height: 150px;\n    border-radius: 8px;\n    margin-top: 8px;\n    border: 1px solid var(--border-color);\n}\n\n/* è¾“å…¥åŒºåŸŸ - V10: åµŒå¥—åœ¨ .group-chat-content-area ä¹‹ä¸‹ */\n.group-chat-content-area .group-chat-input-area-wrapper {\n    position: relative; /* ä¸ºè¡¨æƒ…åŒ…é¢æ¿å®šä½ */\n    flex-shrink: 0;\n}\n\n.group-chat-input-area {\n    border-top: 1px solid var(--border-color);\n    padding: 15px;\n    background-color: var(--container-bg-color);\n    display: flex;\n    gap: 10px;\n    align-items: center; /* è®©è¡¨æƒ…æŒ‰é’®å’Œè¾“å…¥æ¡†å‚ç›´å±…ä¸­ */\n}\n\n.group-chat-input {\n    flex-grow: 1;\n    padding: 10px 15px;\n    border-radius: 20px;\n    border: 1px solid var(--border-color);\n    background-color: var(--background-color); /* ä¿®æ­£ï¼šä½¿ç”¨èƒŒæ™¯è‰²è€Œéå†™æ­»çš„é¢œè‰² */\n    color: var(--text-color);\n    font-size: 1em;\n    width:60%;\n}\n\n.group-chat-input:focus {\n    outline: none;\n    border-color: var(--primary-color);\n    box-shadow: 0 0 5px var(--glow-color);\n}\n\n.group-chat-send-btn {\n    padding: 10px 20px;\n    border-radius: 20px;\n    border: none;\n    background-color: var(--primary-color);\n    color: var(--background-color);\n    font-weight: bold;\n    cursor: pointer;\n    transition: background-color 0.3s;\n}\n\n.group-chat-send-btn:hover {\n    background-color: var(--secondary-color);\n}\n\n/* å›å¤æç¤º */\n.group-chat-reply-indicator {\n    padding: 5px 15px;\n    background-color: var(--container-color);\n    color: var(--text-secondary-color);\n    font-size: 0.8em;\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n}\n.group-chat-reply-indicator-cancel {\n    cursor: pointer;\n    font-weight: bold;\n}\n\n/* è¡¨æƒ…åŒ…ç›¸å…³æ ·å¼ */\n.group-chat-meme-toggle-btn {\n    background: none;\n    border: none;\n    font-size: 1.5em;\n    cursor: pointer;\n    padding: 0 8px;\n    color: var(--text-secondary-color);\n    transition: color 0.3s;\n}\n\n.group-chat-meme-toggle-btn:hover {\n    color: var(--primary-color);\n}\n\n.group-chat-meme-palette {\n    display: none;\n    position: absolute;\n    bottom: 100%;\n    left: 0;\n    right: 0;\n    background-color: var(--background-color);\n    border: 1px solid var(--border-color);\n    border-radius: 10px;\n    padding: 10px;\n    max-height: 200px;\n    overflow-y: auto;\n    grid-template-columns: repeat(auto-fill, minmax(50px, 1fr));\n    gap: 10px;\n    margin-bottom: 5px;\n    box-shadow: 0 -5px 15px rgba(0,0,0,0.3);\n    opacity: 0;\n    transform: translateY(10px);\n    transition: opacity 0.3s ease, transform 0.3s ease;\n    pointer-events: none;\n}\n\n.group-chat-meme-palette.active {\n    display: grid;\n    opacity: 1;\n    transform: translateY(0);\n    pointer-events: auto;\n}\n\n.group-chat-meme-palette img {\n    width: 100%;\n    cursor: pointer;\n    border-radius: 5px;\n    transition: transform 0.2s, box-shadow 0.2s;\n}\n\n.group-chat-meme-palette img:hover {\n    transform: scale(1.1);\n    box-shadow: 0 0 8px var(--glow-color);\n}\n/* å›å¤å¼•ç”¨æ ·å¼ */\n.group-chat-reply-quote {\n    background-color: color-mix(in srgb, var(--container-bg-color) 80%, black 20%);\n    padding: 8px 12px;\n    border-left: 3px solid var(--secondary-color);\n    border-radius: 6px;\n    font-size: 0.9em;\n    color: var(--text-secondary-color);\n    margin-bottom: -5px;\n    max-width: 100%;\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n}\n\n.group-chat-reply-quote b {\n    color: var(--text-color);\n    font-weight: 500;\n}\n\n.group-chat-message-item.sent .group-chat-message-bubble,\n.group-chat-message-item.received .group-chat-message-bubble {\n    border-top-left-radius: 18px;\n    border-top-right-radius: 18px;\n}\n\n/* === åœ¨è¿™é‡Œæ·»åŠ ä¸‹é¢ä¸€æ•´å— CSS ä»£ç  === */\n\n/* ======================= V11: æ‰‹æœºç«¯é€‚é…æ ·å¼ ======================= */\n@media (max-width: 768px) {\n\n.sidebar-trigger.left {\n    left: -60px;\n}\n\n.sidebar-trigger.right {\n    right: -60px;\n}\n    /* åœ¨å°å±å¹•ä¸Šï¼Œè®©ä¸»å®¹å™¨å˜ä¸ºç›¸å¯¹å®šä½ï¼Œæ–¹ä¾¿å­å…ƒç´ è¦†ç›– */\n    .group-chat-main-container {\n        position: relative;\n        flex-direction: column; /* æ”¹å›å‚ç›´å¸ƒå±€ï¼Œä½†æˆ‘ä»¬ä¼šç”¨ç»å¯¹å®šä½è¦†ç›–å®ƒ */\n        overflow: hidden; /* éšè—å°†è¦æ»‘å‡ºå±å¹•çš„å†…å®¹ */\n    }\n\n    /* ä¾§è¾¹æ é»˜è®¤å æ»¡æ•´ä¸ªå®¹å™¨ */\n    .group-chat-sidebar {\n        width: 100%;\n        height: 100%;\n        border-right: none;\n        position: absolute;\n        top: 0;\n        left: 0;\n        transition: transform 0.3s ease-in-out;\n        z-index: 20;\n    }\n\n    /* èŠå¤©å†…å®¹åŒºä¹Ÿå æ»¡å®¹å™¨ï¼Œä½†é»˜è®¤è¢«ç§»åˆ°å±å¹•å³ä¾§å¤– */\n    .group-chat-content-area {\n        width: 100%;\n        height: 100%;\n        position: absolute;\n        top: 0;\n        left: 0;\n        transform: translateX(100%);\n        transition: transform 0.3s ease-in-out;\n        z-index: 30; /* ç¡®ä¿å®ƒåœ¨æ»‘å…¥æ—¶èƒ½è¦†ç›–ä¾§è¾¹æ  */\n    }\n\n    /* å½“ä¸»å®¹å™¨æœ‰ .show-content ç±»æ—¶ï¼Œå°†ä¾§è¾¹æ æ»‘å‡ºï¼ŒèŠå¤©åŒºæ»‘å…¥ */\n    .group-chat-main-container.show-content .group-chat-sidebar {\n        transform: translateX(-100%);\n    }\n\n    .group-chat-main-container.show-content .group-chat-content-area {\n        transform: translateX(0);\n    }\n\n    /* ä¸ºèŠå¤©çª—å£å¤´éƒ¨æ–°å¢çš„è¿”å›æŒ‰é’®æ ·å¼ */\n    .group-chat-back-btn {\n        display: none; /* é»˜è®¤ä¸æ˜¾ç¤º */\n        font-size: 1.5em;\n        font-weight: bold;\n        cursor: pointer;\n        margin-right: 15px;\n        color: var(--text-secondary-color);\n        transition: color 0.3s;\n    }\n\n    .group-chat-back-btn:hover {\n        color: var(--primary-color);\n    }\n\n    /* åœ¨å°å±å¹•çš„èŠå¤©çª—å£å¤´éƒ¨æ˜¾ç¤ºè¿”å›æŒ‰é’® */\n    .group-chat-content-area .group-chat-header .group-chat-back-btn {\n        display: block;\n    }\n}\n/* ======================= V11: é€‚é…æ ·å¼ç»“æŸ ======================= */\n/* ======================= ç¾¤èŠUIæ ·å¼ç»“æŸ (V10 å®Œæ•´ç‰ˆ) ======================= */\n\n/* --- è§’è‰²é¢æ¿ - ç§°å·æ˜¾ç¤ºç¾åŒ– --- */\n.char-titles-container {\n    width: 100%;\n    padding: 4px 0;\n    text-align: center;\n    overflow-x: auto;  /* å½“å†…å®¹è¶…å‡ºæ—¶ï¼Œæ˜¾ç¤ºæ¨ªå‘æ»šåŠ¨æ¡ */\n    overflow-y: hidden; /* éšè—çºµå‘æ»šåŠ¨æ¡ */\n    white-space: nowrap; /* é˜²æ­¢ç§°å·æ¢è¡Œ */\n    scrollbar-width: thin; /* ç¾åŒ–æ»šåŠ¨æ¡ (Firefox) */\n    scrollbar-color: var(--primary-color) var(--container-bg-color); /* (Firefox) */\n}\n\n/* ç¾åŒ–æ»šåŠ¨æ¡ (Chrome, Safari, Edge) */\n.char-titles-container::-webkit-scrollbar {\n    height: 6px;\n}\n.char-titles-container::-webkit-scrollbar-track {\n    background: rgba(0,0,0,0.2);\n}\n.char-titles-container::-webkit-scrollbar-thumb {\n    background-color: var(--primary-color);\n    border-radius: 6px;\n    border: 1px solid var(--container-bg-color);\n}\n\n.char-title-tag {\n    font-size: 1.1em; /* å­—ä½“ç¨å¤§ä¸€äº› */\n    font-weight: bold;\n    color: var(--secondary-color);\n    margin: 0 8px; /* ç§°å·ä¹‹é—´ç•™å‡ºä¸€äº›ç©ºéš™ */\n    display: inline-block; /* ç¡®ä¿ margin ç”Ÿæ•ˆ */\n    text-shadow: 0 0 5px var(--glow-color); /* æ·»åŠ ä¸€ç‚¹å…‰æ™•æ•ˆæœ */\n}\n\n.char-title-tag.placeholder {\n    color: var(--text-secondary-color);\n    font-style: italic;\n    font-weight: normal;\n}\n\n\n/* --- ç§°å·ç®¡ç†é¢æ¿ç¾åŒ– --- */\n.title-manager-list {\n    max-height: 60vh; /* è®¾ç½®æœ€å¤§é«˜åº¦ï¼Œè¶…å‡ºéƒ¨åˆ†å¯æ»šåŠ¨ */\n    overflow-y: auto;\n    padding-right: 10px; /* ä¸ºæ»šåŠ¨æ¡ç•™å‡ºç©ºé—´ */\n}\n\n.title-manager-list h3 {\n    text-align: center;\n    color: var(--primary-color);\n    border-bottom: 1px solid var(--border-color);\n    padding-bottom: 10px;\n    margin-bottom: 15px;\n}\n\n.modal-subtitle {\n    text-align: center;\n    font-size: 0.9em;\n    color: var(--text-secondary-color);\n    margin-top: -10px;\n    margin-bottom: 20px;\n}\n\n.title-manager-item {\n    background-color: rgba(255, 255, 255, 0.05); /* æ¯ä¸ªé¡¹ç›®ä¸€ä¸ªåŠé€æ˜èƒŒæ™¯ */\n    border-left: 3px solid var(--primary-color); /* å·¦ä¾§æœ‰é«˜äº®è¾¹æ¡† */\n    padding: 12px 15px;\n    margin-bottom: 10px;\n    border-radius: 4px;\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    transition: background-color 0.3s;\n}\n\n.title-manager-item:hover {\n    background-color: rgba(255, 255, 255, 0.1);\n}\n\n.title-manager-item .title-name {\n    font-size: 1.1em;\n    font-weight: bold;\n    color: var(--text-color);\n}\n\n.title-description {\n    font-size: 0.9em;\n    color: var(--text-secondary-color);\n    padding: 0 15px 15px 18px; /* ä¸é¡¹ç›®å¯¹é½ */\n    margin-top: -8px; /* å‘ä¸Šç§»åŠ¨ä¸€ç‚¹ï¼Œæ›´ç´§å‡‘ */\n    border-bottom: 1px dashed var(--border-color); /* åˆ†éš”çº¿ */\n    margin-bottom: 15px;\n    line-height: 1.5;\n}\n.title-manager-list > .title-manager-item:last-of-type + .title-description {\n    border-bottom: none; /* æœ€åä¸€ä¸ªé¡¹ç›®ä¸‹é¢ä¸éœ€è¦åˆ†éš”çº¿ */\n}\n\n/* ç¾åŒ–å¼€å…³ (Toggle Switch) */\n.toggle-switch {\n    position: relative;\n    display: inline-block;\n    width: 50px;\n    height: 26px;\n}\n\n.toggle-switch input {\n    opacity: 0;\n    width: 0;\n    height: 0;\n}\n\n.slider {\n    position: absolute;\n    cursor: pointer;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    background-color: #333;\n    -webkit-transition: .4s;\n    transition: .4s;\n     border-radius: 26px;\n}\n\n.slider:before {\n    position: absolute;\n    content: \"\";\n    height: 20px;\n    width: 20px;\n    left: 3px;\n    bottom: 3px;\n    background-color: white;\n    -webkit-transition: .4s;\n    transition: .4s;\n    border-radius: 50%;\n}\n\ninput:checked + .slider {\n    background-color: var(--primary-color);\n}\n\ninput:focus + .slider {\n    box-shadow: 0 0 1px var(--primary-color);\n}\n\ninput:checked + .slider:before {\n    -webkit-transform: translateX(24px);\n    -ms-transform: translateX(24px);\n    transform: translateX(24px);\n}\n\n/* --- ç§°å·ç®¡ç†é¢æ¿ - è¯¦æƒ…äº¤äº’ç¾åŒ– --- */\n\n.title-manager-item {\n    cursor: pointer; /* æ˜ç¡®æ•´ä¸ªæ¡ç›®éƒ½æ˜¯å¯ä»¥ç‚¹å‡»çš„ */\n    user-select: none; /* é˜²æ­¢ç‚¹å‡»æ—¶é€‰ä¸­æ–‡å­— */\n}\n\n/* ç§°å·è¯¦æƒ…é¢æ¿ - é»˜è®¤éšè—ï¼Œæ‹¥æœ‰æµç•…çš„è¿‡æ¸¡åŠ¨ç”» */\n.title-details-panel {\n    max-height: 0;\n    overflow: hidden;\n    \n    transition: max-height 0.35s ease-in-out, padding 0.35s ease-in-out; /* å¹³æ»‘å±•å¼€/æ”¶èµ·åŠ¨ç”» */\n    padding: 0 20px;\n    border-left: 3px solid var(--secondary-color); /* å·¦ä¾§ç”¨æ¬¡è¦é¢œè‰²ï¼Œä¸ä¸»æ¡ç›®åŒºåˆ† */\n    margin: 0 0 10px 0;\n    border-radius: 0 0 4px 4px;\n}\n\n/* å½“è¯¦æƒ…é¢æ¿å±•å¼€æ—¶çš„æ ·å¼ */\n.title-details-panel.active {\n    max-height: 500px; /* ä¸€ä¸ªè¶³å¤Ÿå¤§çš„é«˜åº¦ï¼Œç¡®ä¿å†…å®¹èƒ½å®Œå…¨æ˜¾ç¤º */\n    padding: 15px 20px;\n}\n\n/* è¯¦æƒ…åˆ—è¡¨çš„æ ·å¼ */\n.title-details-panel ul {\n    list-style: none;\n    padding: 0;\n    margin: 0;\n}\n\n.title-details-panel li {\n    padding: 5px 0;\n    font-size: 0.95em;\n    color: var(--text-color);\n    border-bottom: 1px solid var(--border-color);\n    display: flex;\n}\n\n.title-details-panel li:last-child {\n    border-bottom: none;\n}\n\n.title-details-panel li .detail-key {\n    font-weight: bold;\n    color: var(--primary-color);\n    min-width: 80px; /* å›ºå®šæ ‡ç­¾å®½åº¦ï¼Œè®©å†’å·å¯¹é½ */\n    display: inline-block;\n    flex-shrink: 0; /* é˜²æ­¢æ ‡ç­¾è¢«å‹ç¼© */\n}\n.title-details-panel li .detail-value {\n    word-break: break-all; /* å€¼è¿‡é•¿æ—¶è‡ªåŠ¨æ¢è¡Œ */\n}\n\n/* ç§»é™¤åŸæœ‰çš„æè¿°åŒºåŸŸå’Œåˆ†éš”çº¿æ ·å¼ï¼Œå› ä¸ºç°åœ¨å®ƒè¢«æ•´åˆåˆ°è¯¦æƒ…é‡Œäº† */\n.title-description {\n   display: none;\n}\n.title-manager-list > .title-manager-item:last-of-type + .title-description {\n    display: none;\n}\n\n/* â˜…â˜…â˜… è¿™æ˜¯ç»™æœç´¢æ¡†çš„ä¸“å±é­”æ³• â˜…â˜…â˜… */\n.talent-search-container {\n    padding: 0 15px; /* ç»™äºˆä¸€ç‚¹å‘¼å¸çš„ç©ºé—´ */\n    margin-bottom: 10px;\n}\n\n#talent-search-input {\n    width: 100%;\n    box-sizing: border-box; /* è®©å®½åº¦è®¡ç®—æ›´å¬è¯ */\n    background-color: var(--background-color);\n    border: 1px solid var(--border-color);\n    color: var(--text-color);\n    border-radius: 4px;\n    padding: 8px 12px;\n    font-size: 14px;\n    transition: border-color 0.3s, box-shadow 0.3s;\n}\n\n#talent-search-input::placeholder {\n    color: var(--text-secondary-color);\n    opacity: 0.7;\n}\n\n#talent-search-input:focus {\n    outline: none;\n    border-color: var(--primary-color);\n    box-shadow: 0 0 5px var(--glow-color);\n}\n .arrow-guide {\n   \n    display: inline-block;\n}\n.arrow-guide::before {\n    content: '';\n    display: block;\n    width: 16px;  /* ç®­å¤´çš„å®½åº¦ */\n    height: 16px; /* ç®­å¤´çš„é«˜åº¦ */\n    border-top: 2px solid currentColor;   /* å·¦ä¸Šçº¿æ¡ */\n    border-right: 2px solid currentColor; /* å³ä¸Šçº¿æ¡ */\n    transform: rotate(-45deg);  /* æ—‹è½¬45åº¦å½¢æˆå‘ä¸Šç®­å¤´ */\n    margin: 0 auto; /* å±…ä¸­ */\n}\n\n\n     #button-container-send {\n \n    position: relative;\n    display: inline-flex;\n    \n    /* æ·»åŠ è¿™ä¸ªæ¥ç¡®ä¿æˆä¸ºå®šä½ä¸Šä¸‹æ–‡ */\n    z-index: 1;\n \n    }\n\n    /*\n     * å’’è¯­äºŒï¼šå®šä¹‰å®ˆæŠ¤å¸·å¹•çš„æ ·å­\n     * è¿™å°±æ˜¯ä½ ç†Ÿæ‚‰çš„ 'action-blocker-overlay'ã€‚\n     */\n    \n#action-blocker-overlay {\n    position: absolute;\n    top: 0;\n    left: 0;\n    right: 0;  /* ç”¨ right: 0 æ›¿ä»£ width: 100% */\n    bottom: 0; /* ç”¨ bottom: 0 æ›¿ä»£ height: 100% */\n    background-color: rgba(200, 200, 200, 0.4);\n    z-index: 10;\n    display: none;\n    cursor: wait;\n    border-radius: inherit;\n      /* ä¸ºå‡ºç°å’Œæ¶ˆå¤±æ·»åŠ ä¸€ç‚¹æ¸©æŸ”çš„è¿‡æ¸¡æ•ˆæœ */\n    transition: opacity 0.3s ease-in-out;\n\n    /* è¿™ä¸¤ä¸ªæ˜¯è®©ä¸­æ–­æŒ‰é’®åœ¨å±å¹•æ­£ä¸­å¤®çš„é­”æ³•å’’è¯­ */\n    justify-content: center;\n    align-items: center;\n}\n\n    /* å½“æˆ‘ä»¬æ¿€æ´»å®ƒæ—¶ï¼Œå®ƒå°±å‡ºç° */\n    #action-blocker-overlay.active {\n        display: flex;\n    }\n/* === è‡ªå®šä¹‰ç´ æå·¥åŠæ ·å¼ === */\n.custom-asset-tabs {\n    display: flex;\n    gap: 10px;\n    margin-bottom: 15px;\n    border-bottom: 1px solid var(--border-color);\n    padding-bottom: 10px;\n}\n.asset-tab-btn {\n    background: none;\n    border: 1px solid transparent;\n    color: var(--text-secondary-color);\n    padding: 8px 12px;\n    cursor: pointer;\n    transition: all 0.3s ease;\n    border-radius: 6px;\n    font-size: 0.9em;\n}\n.asset-tab-btn:hover {\n    background-color: var(--container-bg-color);\n    color: var(--primary-color);\n}\n.asset-tab-btn.active {\n    color: var(--primary-color);\n    border-bottom: 2px solid var(--primary-color);\n    background-color: rgba(10, 25, 47, 0.5); /* ç•¥å¾®é«˜äº® */\n    font-weight: bold;\n}\n\n.asset-panel {\n    display: none;\n    flex-direction: column;\n    gap: 20px;\n}\n.asset-panel.active {\n    display: flex;\n}\n\n.asset-upload-form {\n    display: flex;\n    flex-direction: column;\n    gap: 12px;\n    background-color: rgba(0,0,0,0.2);\n    padding: 15px;\n    border-radius: 8px;\n    border: 1px solid var(--border-color);\n}\n.asset-upload-form p {\n    margin: 0;\n    font-weight: bold;\n    color: var(--text-color);\n    font-size: 0.95em;\n}\n.asset-upload-form input[type=\"text\"] {\n    background-color: var(--background-color);\n    border: 1px solid var(--border-color);\n    color: var(--text-color);\n    padding: 8px 10px;\n    border-radius: 4px;\n    width: 100%;\n}\n.asset-upload-form .file-input-wrapper {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n}\n.asset-upload-form input[type=\"file\"] {\n    display: none;\n}\n.file-name-display {\n    font-size: 0.8em;\n    color: var(--text-secondary-color);\n    overflow: hidden;\n    text-overflow: ellipsis;\n    white-space: nowrap;\n}\n.asset-upload-form button.primary {\n    background-color: var(--primary-color);\n    color: var(--background-color);\n    font-weight: bold;\n}\n.asset-upload-form button.primary:hover {\n    box-shadow: 0 0 10px var(--glow-color);\n}\n\n\n.asset-list-container p {\n    margin: 10px 0;\n    font-weight: bold;\n    color: var(--text-color);\n    font-size: 0.95em;\n}\n.asset-list {\n    max-height: 200px;\n    overflow-y: auto;\n    background-color: rgba(0,0,0,0.2);\n    padding: 10px;\n    border-radius: 8px;\n    border: 1px solid var(--border-color);\n    display: flex;\n    flex-direction: column;\n    gap: 10px;\n}\n\n.asset-item {\n    display: flex;\n    align-items: center;\n    gap: 15px;\n    background-color: var(--container-bg-color);\n    padding: 8px;\n    border-radius: 6px;\n}\n.asset-item-thumb {\n    width: 40px;\n    height: 40px;\n    object-fit: cover;\n    border-radius: 4px;\n    border: 1px solid var(--border-color);\n}\n.asset-item-name {\n    flex-grow: 1;\n    color: var(--text-color);\n    font-family: var(--base-font-family);\n}\n.asset-item-delete-btn {\n    background: none;\n    border: 1px solid var(--danger-color);\n    color: var(--danger-color);\n    width: 30px;\n    height: 30px;\n    border-radius: 50%;\n    cursor: pointer;\n    transition: all 0.3s ease;\n    opacity: 0.7;\n    flex-shrink: 0;\n}\n.asset-item-delete-btn:hover {\n    background: var(--danger-color);\n    color: white;\n    opacity: 1;\n    box-shadow: 0 0 8px var(--danger-glow-color);\n    transform: scale(1.1);\n}\n\n    /* å°†è¾“å…¥æ¡†å’ŒæŒ‰é’®æ”¾åœ¨ä¸€è¡Œçš„å®¹å™¨ */\n    .archive-name-controls {\n        display: flex;\n        gap: 10px; /* åœ¨è¾“å…¥æ¡†å’ŒæŒ‰é’®ä¹‹é—´å¢åŠ ä¸€ç‚¹ç©ºéš™ */\n        margin-top: 5px;\n    }\n\n    /* å­˜æ¡£åç§°è¾“å…¥æ¡†çš„æ ·å¼ */\n    #archive-name-input {\n        flex-grow: 1; /* è®©è¾“å…¥æ¡†å°½å¯èƒ½åœ°å®½ */\n        background-color: transparent;\n        border: 1px solid var(--border-color);\n        border-radius: 4px;\n        padding: 8px 12px;\n        color: var(--text-color);\n        font-size: 0.9em;\n        transition: border-color 0.3s, box-shadow 0.3s;\n    }\n\n    /* è¾“å…¥æ¡†è·å¾—ç„¦ç‚¹æ—¶çš„å‘å…‰æ•ˆæœ */\n    #archive-name-input:focus {\n        outline: none;\n        border-color: var(--primary-color);\n        box-shadow: 0 0 8px var(--glow-color);\n    }\n\n    /* è¾“å…¥æ¡†çš„å ä½ç¬¦æ–‡å­—é¢œè‰² */\n    #archive-name-input::placeholder {\n        color: var(--text-secondary-color);\n        opacity: 0.7;\n    }\n\n    /* â€œè®¾å®šâ€æŒ‰é’®çš„æ ·å¼è°ƒæ•´ï¼Œè®©å®ƒå’Œè¾“å…¥æ¡†é«˜åº¦åŒ¹é… */\n    #set-archive-name-btn {\n        flex-shrink: 0; /* é˜²æ­¢æŒ‰é’®è¢«å‹ç¼© */\n        padding: 8px 15px;\n    }\n\n    .group-chat-loading-overlay {\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    background-color: rgba(0, 0, 0, 0.7);\n    color: white;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    font-size: 1.2em;\n    z-index: 1001; /* ç¡®ä¿åœ¨æ¨¡æ€æ¡†å†…å®¹ä¹‹ä¸Š */\n    display: none; /* é»˜è®¤éšè— */\n}\n\n.meme-retry-btn, .meme-force-refresh-btn {\n    color: #4e9af1;\n    text-decoration: underline;\n    cursor: pointer;\n    margin: 0 5px;\n}\n.meme-force-refresh-btn {\n    color: #ff7675;  \n}\n \n.meme-item.success { border: 1px solid #d4edda; }\n.meme-item.failed { border: 1px solid #f8d7da; background-color: #fff3f3; }\n \n.meme-item-name { font-size: 10px; color: #721c24; margin-bottom: 4px; }\n.meme-item-retry-btn { font-size: 10px; padding: 2px 4px; border: 1px solid #f5c6cb; background-color: white; color: #721c24; border-radius: 3px; cursor: pointer; }\n.force-refresh-main-btn { width: 100%; background: #c0392b; color: white; border: none; padding: 8px; font-weight: bold; margin-bottom: 10px; cursor: pointer; }\n    \n    \n /* ä¸ºé‡å‘½åè¾“å…¥æ¡†å‡†å¤‡çš„æ ·å¼ */\n.entry-rename-input {\n    width: calc(100% - 20px);\n    padding: 10px;\n    border: 1px solid #ccc;\n    border-radius: 4px;\n    font-size: 1em;\n    margin-top: 10px;\n}\n\n.entry-rename-input.input-error {\n    border-color: #ff4444;\n    animation: shake 0.5s;\n}\n\n@keyframes shake {\n    0%, 100% { transform: translateX(0); }\n    25% { transform: translateX(-5px); }\n    75% { transform: translateX(5px); }\n}\n\n\n/* ä¸ºç«‹ç»˜é€‰æ‹©æ¨¡æ€æ¡†ä¸­çš„åˆ—è¡¨é¡¹æ·»åŠ ä¸€ä¸ªé¼ æ ‡æ‚¬æµ®æ•ˆæœï¼Œè®©å®ƒæ›´å…·äº’åŠ¨æ„Ÿ */\n#cg-selection-list .asset-item {\n    cursor: pointer;\n    transition: all 0.2s ease-in-out;\n}\n\n#cg-selection-list .asset-item:hover {\n    transform: scale(1.05);\n    background-color: var(--container-bg-color);\n    box-shadow: 0 4px 8px var(--glow-color);\n}\n\n/* ç¡®ä¿æ·»åŠ CGçš„æ¨¡æ€æ¡†æœ‰åˆé€‚çš„å°ºå¯¸ */\n#add-cg-modal .modal-content {\n    max-width: 800px;\n    width: 90%;\n}   \n    /* ä¸ºæˆ‘ä»¬æ‰€æœ‰çš„æ¨¡æ€æ¡†èƒŒæ™¯æ·»åŠ ä¸€ä¸ªä¼˜é›…çš„è¿‡æ¸¡æ•ˆæœ */\n.move-modal-overlay {\n    /* è¿™ä¼šç»§æ‰¿ä½ å·²æœ‰çš„ move-modal-overlay æ ·å¼ï¼Œæˆ‘ä»¬åªæ˜¯åŠ ç‚¹åŠ¨ç”» */\n    opacity: 0;\n    transition: opacity 0.3s ease;\n}\n\n/* è®©æ¨¡æ€æ¡†å†…å®¹ä¹Ÿèƒ½ä¼˜é›…åœ°å‡ºç° */\n.move-modal-overlay .modal-content {\n    /* ä½ å¯èƒ½å·²ä¸º .modal-content è®¾ç½®äº†æ ·å¼ï¼Œè¿™é‡Œæ˜¯è¡¥å…… */\n    transform: scale(0.95);\n    opacity: 0;\n    transition: transform 0.3s ease, opacity 0.3s ease;\n}\n\n\n/* æˆ‘ä»¬å¯ä»¥ç›´æ¥ä¸ºç«‹ç»˜é€‰æ‹©çª—å£é‡Œçš„åˆ—è¡¨ä¸“é—¨è®¾ç½® */\n#add-cg-modal .asset-list {\n    max-height: 40vh; /* è¿™æ„å‘³ç€åˆ—è¡¨æœ€é«˜åªä¼šå å±å¹•é«˜åº¦çš„40%ï¼Œä½ å¯ä»¥æ ¹æ®å–œå¥½è°ƒæ•´è¿™ä¸ªæ•°å€¼ */\n    overflow-y: auto;  /* å½“å†…å®¹è¶…å‡ºé«˜åº¦æ—¶ï¼Œè‡ªåŠ¨å‡ºç°å‚ç›´æ»šåŠ¨æ¡ */\n    padding-right: 10px; /* ä¸ºæ»šåŠ¨æ¡ç•™å‡ºä¸€ç‚¹ç‚¹ç©ºé—´ï¼Œè®©å®ƒä¸é‚£ä¹ˆæ‹¥æŒ¤ */\n}\n\n/* ä¸ºäº†è®©æ»šåŠ¨æ¡ä¹Ÿå˜å¾—æ›´æ¼‚äº®ï¼ˆé€‚ç”¨äºChrome/Safariç­‰æµè§ˆå™¨ï¼‰ */\n#add-cg-modal .asset-list::-webkit-scrollbar {\n    width: 6px;\n}\n\n#add-cg-modal .asset-list::-webkit-scrollbar-track {\n    background: rgba(0, 0, 0, 0.05);\n    border-radius: 3px;\n}\n\n#add-cg-modal .asset-list::-webkit-scrollbar-thumb {\n    background-color: var(--background-color);\n    border-radius: 3px;\n    transition: background-color 0.2s;\n}\n\n#add-cg-modal .asset-list::-webkit-scrollbar-thumb:hover {\n    background-color: var(--container-bg-color);\n}\n/*\n  å¦ˆå¦ˆçš„ä¸“å±é­”æ³•æ ·å¼ï¼Œåªä¸ºè¿™å‡ ä¸ªæ–°çª—å£æœåŠ¡ï¼Œç»ä¸æ‰“æ‰°ä»–äºº\n*/\n.nova-modal-content {\n    /* è¿™æ˜¯æˆ‘ä»¬çš„æ–°çª—å£çš„åŸºç¡€æ ·å¼ï¼Œå¾ˆå¤šæ˜¯ä»ä½ å·²æœ‰çš„ move-modal-content å€Ÿé‰´æ¥çš„ */\n    background: var(--background-color);\n    padding: 20px;\n    border-radius: 8px;\n    box-shadow: 0 5px 15px var(--glow-color);\n    max-width: 500px;\n    width: 90%;\n    z-index: 1001;\n\n    /* è¿™é‡Œæ˜¯å®ƒä»¬ä¸“å±çš„åŠ¨ç”»è®¾å®š */\n    transform: scale(0.95);\n  \n    transition: transform 0.3s cubic-bezier(0.18, 0.89, 0.32, 1.28), opacity 0.3s ease;\n}\n\n/* è®©é®ç½©å±‚ä¹Ÿé…åˆåŠ¨ç”» */\n.move-modal-overlay {\n    opacity: 0;\n    transition: opacity 0.3s ease;\n}\n\n/* ä¸ºä½ çš„CGé€‰æ‹©çª—å£åšä¸€ç‚¹å°ºå¯¸ä¼˜åŒ– */\n#add-cg-modal .nova-modal-content {\n    max-width: 800px;\n}\n\n/* CGåˆ—è¡¨çš„æ‚¬åœæ•ˆæœ */\n#cg-selection-list .asset-item:hover {\n    transform: scale(1.05);\n    background-color: var(--background-color);\n    box-shadow: 0 4px 8px var(--glow-color);\n}\n\n /* --- Version 7 æœ«æ—¥ä¸–ç•Œä¸“å±æ ·å¼ --- */\n#world-details-v7 {\n    width: 100%;\n    padding: 1rem;\n    box-sizing: border-box;\n}\n\n.v7-setup-section {\n    margin-bottom: 1.5rem;\n}\n\n.v7-setup-title {\n    font-size: 1rem;\n    color: #c86aa3; /* accent-color-pink */\n    margin-bottom: 1rem;\n    padding-bottom: 0.5rem;\n    border-bottom: 1px solid #2a2633; /* border-color */\n    font-weight: 300;\n}\n\n.v7-choice-group {\n    display: flex;\n    flex-direction: column;\n    gap: 0.75rem;\n}\n\n.v7-choice-label {\n    display: block;\n    background-color: rgba(26, 23, 32, 0.5); /* hover-bg-color with alpha */\n    border: 1px solid #2a2633; /* border-color */\n    padding: 0.75rem 1rem;\n    border-radius: 4px;\n    cursor: pointer;\n    transition: border-color 0.3s, background-color 0.3s;\n    position: relative;\n}\n\n.v7-choice-label:hover {\n    border-color: #5f8ac7;\n    background-color: rgba(95, 138, 199, 0.1);\n}\n\n.v7-choice-label.active {\n    border-color: #c86aa3; /* accent-color-pink */\n    background-color: rgba(200, 106, 163, 0.15);\n    box-shadow: 0 0 8px rgba(200, 106, 163, 0.3);\n}\n\n.v7-choice-title {\n    font-size: 0.9rem;\n    color: #d8d4e4; /* primary-text */\n    display: block;\n    font-weight: 500;\n}\n\n/* --- æ‚¬æµ®æè¿°çª—å£æ ·å¼ --- */\n#description-popup {\n    position: fixed;\n    display: none;\n    background-color: rgba(18, 16, 22, 0.85);\n    backdrop-filter: blur(8px);\n    color: #d8d4e4;\n    border: 1px solid #4d465a;\n    border-radius: 6px;\n    padding: 1rem;\n    font-size: 0.9em;\n    line-height: 1.6;\n    max-width: 400px;\n    z-index: 10001; /* ç¡®ä¿å®ƒåœ¨æœ€é¡¶å±‚ */\n    pointer-events: none; /* ç©¿é€é¼ æ ‡äº‹ä»¶ */\n       opacity: 0;\n    transition: opacity 0.3s ease, transform 0.3s ease;\n    transform: translateY(10px) scale(0.95); /* å¦ˆå¦ˆåœ¨è¿™é‡ŒåŠ äº†ä¸€ç‚¹ç¼©æ”¾çš„å°é­”æ³• */\n    box-shadow: 0 5px 20px rgba(0, 0, 0, 0.4);\n}\n\n/* å­—ä½“å¤§å°æ§åˆ¶å™¨çš„æ ·å¼ */\n .font-size-controls, .line-height-controls {\n    display: flex;\n    align-items: center;\n    gap: 12px;\n}\n\n#font-size-slider {\n    /* ä½ å¯ä»¥æ ¹æ®å–œå¥½è°ƒæ•´æ»‘å—çš„æ ·å¼ */\n    cursor: pointer;\n}\n\n#font-size-value {\n    font-family: monospace; /* ä½¿ç”¨ç­‰å®½å­—ä½“ï¼Œæ•°å­—è·³åŠ¨æ—¶ä¸ä¼šæ™ƒåŠ¨ */\n    min-width: 45px;      /* ç»™å®ƒä¸€ä¸ªå›ºå®šå®½åº¦ï¼Œé¿å…å› æ•°å­—ä½æ•°å˜åŒ–å¯¼è‡´å¸ƒå±€è·³åŠ¨ */\n    text-align: right;\n    color: var(--primary-color);\n    transition: color 0.3s ease;\n}\n\n\n/* --- å¼¹çª—åŸºç¡€ --- */\n.favorability-modal .favorability-content {\n    width: 80vw;\n    max-width: 900px;\n    height: 70vh;\n    display: flex;\n    flex-direction: column;\n}\n\n.favor-modal-title {\n    font-size: 1.2em;\n    font-weight: bold;\n    color: var(--primary-color);\n    padding: 15px 20px;\n    border-bottom: 1px solid var(--border-color);\n    text-shadow: 0 0 5px var(--glow-color);\n}\n\n.favor-modal-buttons {\n    padding: 15px 20px;\n    border-top: 1px solid var(--border-color);\n    display: flex;\n    justify-content: flex-end;\n    gap: 10px;\n}\n\n/* --- å¡ç‰‡å®¹å™¨å’Œæ»šåŠ¨æ¡ --- */\n.favor-card-container {\n    flex-grow: 1;\n \n    flex-wrap: wrap;\n    gap: 20px;\n    justify-content: center;\n    align-content: flex-start;\n \n    overflow: hidden; /* è¿™æ˜¯å®ç°ç¿»é¡µæ•ˆæœçš„å…³é”®ï¼ */\n    position: relative;\n     \n}\n/* --- å¡ç‰‡â€œæ»‘åŠ¨è½¨é“â€ï¼šæ‰€æœ‰çš„ä¹¦é¡µéƒ½åœ¨è¿™ä¸Šé¢å¹¶æ’èººç€ --- */\n.favor-card-slider {\n    display: flex;\n    height: 100%;\n    transition: transform 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94); /* ä¸€ä¸ªæŸ”å’Œçš„ç¿»é¡µåŠ¨ç”» */\n}\n/* --- ã€éœ€æ±‚1ã€‘æ ‡é¢˜çš„ç¾åŒ–æ ·å¼ --- */\n.favor-stage-title {\n    display: block; /* è®©æ ‡é¢˜ç‹¬å ä¸€è¡Œ */\n    text-align: center; /* å±…ä¸­æ˜¾ç¤º */\n    font-size: 1.2em; /* æ”¾å¤§å­—ä½“ */\n    font-weight: bold;\n    color: var(--primary-color);\n    margin-bottom: 15px; /* ä¸ä¸‹é¢çš„æ­£æ–‡æ‹‰å¼€è·ç¦» */\n    text-shadow: 0 0 8px var(--glow-color);\n}\n\n/* å¥½æ„Ÿåº¦èŒƒå›´çš„æ ·å¼ï¼Œåƒå°å°çš„æ³¨è„š */\n.favor-range-text {\n    display: block;\n    font-size: 0.7em;\n    font-weight: normal;\n    color: var(--text-secondary-color);\n    margin-top: 5px;\n}\n\n.favor-card-container::-webkit-scrollbar {\n    width: 6px;\n}\n\n.favor-card-container::-webkit-scrollbar-thumb {\n    background-color: var(--primary-color);\n    border-radius: 3px;\n}\n\n/* --- å•ä¸ªæƒ…æ„Ÿå¡ç‰‡æ ·å¼ --- */\n.favor-card {\n   flex-shrink: 0;\n    width: 100%;\n    height: 100%;\n    overflow-y: auto; /* å¦‚æœå•é¡µå†…å®¹è¿‡é•¿ï¼Œå…è®¸å†…éƒ¨æ»šåŠ¨ */\n    padding: 20px;\n    border: none; /* å»æ‰ä¹‹å‰çš„è¾¹æ¡†ï¼Œè®©å®ƒæ„Ÿè§‰æ›´åƒä¸€é¡µçº¸ */\n    background-color: transparent;\n    box-shadow: none;\n \n    color: var(--text-secondary-color);\n    font-size: var(--base-font-size);\n    line-height: var(--base-line-height);\n    box-shadow: 0 4px 15px rgba(0,0,0,0.2);\n \n    transition: transform 0.3s ease, box-shadow 0.3s ease, border-color 0.3s ease;\n  \n}\n/* ç»™å¡ç‰‡æ»šåŠ¨æ¡ä¹Ÿç¨å¾®ç¾åŒ–ä¸€ä¸‹ */\n.favor-card::-webkit-scrollbar { width: 4px; }\n.favor-card::-webkit-scrollbar-thumb { background-color: var(--border-color); border-radius: 2px;}\n\n/* å¡ç‰‡æ‚¬åœæ—¶çš„ä¼˜é›…æ•ˆæœ */\n.favor-card:hover {\n    transform: translateY(-5px);\n    box-shadow: 0 8px 25px var(--glow-color);\n    border-color: var(--primary-color);\n}\n\n/* --- å½“å‰é˜¶æ®µçš„ç‰¹æ®Šåä¸½æ•ˆæœ --- */\n.favor-card.current-stage {\n    color: var(--text-color);\n \n}\n\n .current-stage .favor-stage-title{\n    text-shadow: 0 0 15px var(--glow-color), 0 0 8px var(--primary-color);\n}\n\n/* --- ç¿»é¡µæ§ä»¶çš„å®¹å™¨ --- */\n.favor-page-controls {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    padding: 10px 20px;\n    border-top: 1px solid var(--border-color);\n    order: 3; /* è®©å®ƒæ˜¾ç¤ºåœ¨æŒ‰é’®åŒºåŸŸä¹‹ä¸Š */\n}\n\n/* --- ç¿»é¡µæŒ‰é’®çš„æ ·å¼ --- */\n.favor-nav-button {\n    background-color: transparent;\n    border: 1px solid var(--border-color);\n    color: var(--primary-color);\n    font-size: 24px;\n    font-weight: bold;\n    width: 40px;\n    height: 40px;\n    border-radius: 50%;\n    cursor: pointer;\n    transition: all 0.2s ease;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n}\n.favor-nav-button:hover:not(:disabled) {\n    background-color: var(--glow-color);\n    color: var(--background-color);\n}\n.favor-nav-button:disabled {\n    opacity: 0.3;\n    cursor: not-allowed;\n}\n\n/* --- é¡µç æŒ‡ç¤ºå™¨ --- */\n.favor-page-indicator {\n    color: var(--text-secondary-color);\n    font-size: 0.9em;\n}\n\n/* --- åº•éƒ¨æŒ‰é’®åŒºåŸŸå¾®è°ƒ --- */\n.favor-modal-buttons {\n    order: 4; /* ç¡®ä¿å®ƒåœ¨æœ€ä¸‹é¢ */\n}\n/* --- ç¼–è¾‘æ¨¡å¼çš„æ–‡æœ¬åŸŸ --- */\n#favor-edit-textarea {\n    flex-grow: 1;\n    margin: 20px;\n    background-color: var(--background-color);\n    border: 1px solid var(--border-color);\n    color: var(--text-color);\n    font-family: 'Courier New', Courier, monospace;\n    font-size: 0.9em;\n    border-radius: 5px;\n    outline: none;\n    padding: 10px;\n}\n\n#favor-edit-textarea:focus {\n    border-color: var(--primary-color);\n    box-shadow: 0 0 10px var(--glow-color);\n}\n\n/* --- æ¸©æŸ”çš„æç¤ºæ¡†æ ·å¼ (å¯é€‰) --- */\n.nova-alert {\n    position: fixed;\n    top: 20px;\n    left: 50%;\n    transform: translateX(-50%);\n    padding: 10px 20px;\n    border-radius: 5px;\n    font-family: var(--base-font-family);\n    box-shadow: 0 4px 15px rgba(0,0,0,0.3);\n    opacity: 1;\n    transition: opacity 0.5s ease, transform 0.5s ease;\n    z-index: 999999999;\n}\n.nova-alert.info {\n    background-color: var(--primary-color);\n    text-shadow: 0 0 5px #000;\n}\n.nova-alert.danger {\n    background-color: var(--danger-color);\n    box-shadow: 0 0 10px var(--danger-glow-color);\n}\n\n/* æ ‡é¢˜æ å¸ƒå±€è°ƒæ•´ï¼Œä¸ºå¼€å…³è…¾å‡ºç©ºé—´ */\n.favor-modal-title {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n}\n\n.toggle-switch-container {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    font-size: 0.8em;\n    color: var(--text-secondary-color);\n}\n\n/* éšè—åŸå§‹çš„å¤é€‰æ¡† */\n.toggle-input {\n    display: none;\n}\n\n/* å¼€å…³çš„â€œè½¨é“â€ */\n.toggle-switch {\n    position: relative;\n    display: inline-block;\n    width: 44px;\n    height: 24px;\n    background-color: rgba(120, 120, 120, 0.4);\n    border-radius: 12px;\n    cursor: pointer;\n    transition: background-color 0.3s ease;\n}\n\n/* å¼€å…³çš„â€œæ»‘å—â€ */\n.toggle-switch::before {\n    content: '';\n    position: absolute;\n    width: 20px;\n    height: 20px;\n    border-radius: 50%;\n    background-color: white;\n    top: 2px;\n    left: 2px;\n    transition: transform 0.3s ease;\n    box-shadow: 0 1px 3px rgba(0,0,0,0.3);\n}\n\n/* å½“å¼€å…³è¢«â€œæ‰“å¼€â€æ—¶çš„æ ·å¼ */\n.toggle-input:checked + .toggle-switch {\n    background-color: var(--primary-color);\n    box-shadow: 0 0 8px var(--glow-color);\n}\n\n.toggle-input:checked + .toggle-switch::before {\n    transform: translateX(20px);\n}\n  /* åŸºç¡€çš„ SVG å½¢çŠ¶æ ·å¼ */\n#map-container svg .shape-group path,\n#map-container svg .shape-group circle,\n#map-container svg .shape-group polygon {\n    fill: var(--glow-color);\n    stroke: var(--secondary-color);\n \n        vector-effect: non-scaling-stroke;\n      transition: fill 0.3s ease; /* âœ¨ çœ‹ï¼Œé­”æ³•å’’è¯­å›åˆ°è¿™é‡Œå•¦ï¼âœ¨ */\n    /* âœ¨ å¦ˆå¦ˆæŠŠ transition ç§»åˆ°äº†ä¸Šä¸€çº§ï¼Œè®©æ•´ä¸ªç»„ä¸€èµ·åŠ¨ âœ¨ */\n}\n\n/* æ ‡ç­¾æ–‡å­—æ ·å¼ */\n#map-container svg .map-location-label {\n    fill: var(--text-color);\n    font-weight: bold;\n    text-shadow: 0 0 5px var(--container-bg-color), 0 0 3px black;\n   \n}\n\n #map-container svg g.shape-group {\n \n    cursor: pointer;\n    /* æˆ‘ä»¬ä¸å†éœ€è¦ transform çš„åŠ¨ç”»äº†ï¼Œè®©å®ƒå›å½’å®é™ */\n    transition: fill 0.3s ease; /* æˆ‘ä»¬åªè®©é¢œè‰²çš„å˜åŒ–æœ‰åŠ¨ç”» */\n}\n\n \n\n/* å½“é¼ æ ‡æ‚¬æµ®æ—¶ï¼Œå•ç‹¬æ”¹å˜å›¾å½¢çš„å¡«å……è‰² */\n#map-container svg g.shape-group:hover path,\n#map-container svg g.shape-group:hover circle,\n#map-container svg g.shape-group:hover polygon {\n    fill: var(--background-color);\n}\n\n/* å¦‚æœè¦è®©æ ‡ç­¾ä¹Ÿæœ‰ä¸€ç‚¹ç‚¹ååº”ï¼Œå¯ä»¥åŠ ä¸Šè¿™ä¸ª */\n#map-container svg g.shape-group:hover .map-location-label {\n    fill: var(--text-secondary-color);\n}\n\n/* åˆ«å¿˜äº†ç»™æ•´ä¸ªç»„ä¸€ä¸ªå¯ç‚¹å‡»çš„æ‰‹åŠ¿ */\n#map-container svg g.shape-group {\n    cursor: pointer;\n}\n\n/* â™¥â™¥â™¥ ä¸º location-modal ä¸­çš„èµ„æºé¢æ¿æ·»åŠ çš„ç¾ä¸½æ–°æ ·å¼ â™¥â™¥â™¥ */\n.resources-container {\n    margin-top: 20px;\n    padding-top: 15px;\n    border-top: 1px solid var(--border-color);\n}\n\n.resources-title {\n    color: var(--secondary-color);\n    font-size: 1.1em;\n    margin-bottom: 10px;\n    text-align: center;\n}\n\n.resource-item {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    background-color: rgba(0, 0, 0, 0.2);\n    border-radius: 4px;\n    padding: 8px 12px;\n    margin-bottom: 8px;\n    transition: background-color 0.3s;\n}\n\n.resource-item:hover {\n    background-color: var(--container-bg-color);\n}\n\n.resource-info {\n    display: flex;\n    flex-direction: column;\n}\n\n.resource-name {\n    font-weight: bold;\n    color: var(--text-color);\n    font-size: 1em;\n}\n\n.resource-details {\n    font-size: 0.8em;\n    color: var(--text-secondary-color);\n    margin-top: 2px;\n}\n\n.harvest-btn {\n    background-color: var(--primary-color);\n    color: var(--background-color);\n    border: none;\n    border-radius: 4px;\n    padding: 6px 12px;\n    font-weight: bold;\n    cursor: pointer;\n    transition: all 0.3s ease;\n}\n\n.harvest-btn:hover {\n    background-color: var(--secondary-color);\n    box-shadow: 0 0 8px var(--glow-color);\n}\n\n.harvest-btn:disabled {\n    background-color: #555;\n    color: #999;\n    cursor: not-allowed;\n    box-shadow: none;\n}\n/* â™¥â™¥â™¥ ä¸ºåœ°å—ç±»å‹æ ‡ç­¾è®¾è®¡çš„åˆ«è‡´æ ·å¼ â™¥â™¥â™¥ */\n.location-type-tag {\n    display: inline-block;\n    background-color: var(--primary-color);\n    color: var(--background-color);\n    padding: 2px 8px;\n    border-radius: 10px;\n    font-size: 0.8em;\n    font-weight: bold;\n    margin-top: 8px;\n    margin-bottom: 5px; /* ä¸ä¸‹æ–¹æè¿°çš„é—´è· */\n}\n\n/* æŒ‡æŒ¥å°çš„å®¹å™¨ï¼Œå®ƒä¼šé™é™åœ°æ‚¬æµ®åœ¨å³ä¸‹è§’ */\n#map-controls-container {\n    position: absolute;\n    right: 20px;\n    bottom: 20px;\n    z-index: 1000; /* ç¡®ä¿å®ƒåœ¨æ‰€æœ‰åœ°å›¾å†…å®¹ä¹‹ä¸Š */\n    display: flex;\n    flex-direction: column;\n    gap: 8px; /* æŒ‰é’®ä¹‹é—´çš„æ¸©æŸ”é—´éš™ */\n}\n\n/* æ¯ä¸€ä¸ªæŒ‡æŒ¥æŒ‰é’®çš„æ ·å¼ */\n.map-control-btn {\n    width: 32px;\n    height: 32px;\n    background-color: var(--container-bg-color);\n    border: 1px solid var(--border-color);\n    border-radius: 50%; /* åœ†åœ†çš„ï¼Œå¾ˆå¯çˆ± */\n    color: var(--text-color);\n    font-size: 20px;\n    font-weight: bold;\n    cursor: pointer;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    line-height: 1; /* è®©ç¬¦å·æ›´å±…ä¸­ */\n    box-shadow: 0 0 8px var(--glow-color);\n    transition: all 0.2s ease;\n}\n\n/* å½“é¼ æ ‡æ‚¬æµ®åœ¨æŒ‰é’®ä¸Šæ—¶çš„é­”æ³•æ•ˆæœ */\n.map-control-btn:hover {\n    background-color: var(--background-color);\n    border-color: var(--primary-color);\n    transform: scale(1.1);\n}\n\n\n/* å®ˆæŠ¤å°è®°å¼€å…³çš„å®¹å™¨ */\n.protection-toggle-container,\n.protection-toggle-container-edit {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    font-size: 14px;\n    color: var(--text-secondary-color);\n}\n \n \n \n\n/*\n   å¾®è°ƒæˆ‘ä»¬åŸæœ‰çš„æ§ä»¶æ ·å¼ï¼Œ\n   å› ä¸ºå®ƒä»¬çš„è¾¹è·å’Œè¾¹æ¡†ç°åœ¨ç”±çˆ¶å®¹å™¨ç»Ÿä¸€ç®¡ç†äº†ï¼Œ\n   æ‰€ä»¥è¦æŠŠå®ƒä»¬è‡ªå·±çš„â€œå¤–è¡£â€è„±æ‰ï¼Œçœ‹èµ·æ¥æ‰æ›´æ¸…çˆ½\n*/\n.location-type-tag {\n    margin: 0; /* ç§»é™¤å®ƒè‡ªå·±çš„ä¸Šä¸‹è¾¹è· */\n}\n\n.protection-toggle-container {\n    margin: 0;      /* ç§»é™¤å®ƒè‡ªå·±çš„ä¸Šä¸‹è¾¹è· */\n    padding: 0;     /* ç§»é™¤å®ƒè‡ªå·±çš„å†…è¾¹è· */\n    border: none;   /* ç§»é™¤å®ƒè‡ªå·±çš„ä¸‹è¾¹æ¡† */\n}\n\n\n.parent-map-tabs-container {\n    position: absolute;\n    top: 20px; /* æ ¹æ®ä½ çš„å¸ƒå±€è°ƒæ•´ */\n    left: 10px; /* æ ¹æ®ä½ çš„å¸ƒå±€è°ƒæ•´ */\n    width: 120px;\n    background: var(--container-bg-color);\n    border: 1px solid var(--border-color);\n    border-radius: 5px;\n    color: var(--text-color);\n    z-index: 1001; /* ç¡®ä¿å®ƒåœ¨åœ°å›¾å†…å®¹ä¹‹ä¸Š */\n    padding: 10px;\n}\n\n.parent-map-tabs-container h3 {\n    margin-top: 0;\n    margin-bottom: 10px;\n    font-size: 14px;\n    color: var(--primary-color);\n    border-bottom: 1px solid var(--border-color);\n    padding-bottom: 5px;\n      cursor: pointer; /* â¤ï¸ æ·»åŠ ï¼šé¼ æ ‡æ”¾ä¸Šå»ä¼šå˜æˆå°æ‰‹ */\n    display: flex; /* â¤ï¸ æ·»åŠ ï¼šä¸ºäº†è®©æ ‡é¢˜å’Œç®­å¤´å›¾æ ‡å¯¹é½ */\n    justify-content: space-between; /* â¤ï¸ æ·»åŠ ï¼šè®©æ ‡é¢˜å’Œç®­å¤´åˆ†å±…ä¸¤ä¾§ */\n    align-items: center; /* â¤ï¸ æ·»åŠ ï¼šå‚ç›´å±…ä¸­ */\n}\n\n/* â¤ï¸ æ–°å¢ï¼šè¿™æ˜¯æˆ‘ä»¬çš„å°ç®­å¤´å›¾æ ‡æ ·å¼ â¤ï¸ */\n.parent-map-tabs-container h3 .toggle-arrow {\n    font-size: 12px;\n    margin-left: 5px;\n    transition: transform 0.2s ease-in-out;\n    \n}\n.parent-map-tabs-list {\n    display: flex;\n    flex-direction: column;\n    gap: 5px;\n      max-height: 150px; /* â¤ï¸ æ·»åŠ ï¼šè®¾ç½®ä¸€ä¸ªæœ€å¤§é«˜åº¦ */\n    overflow-y: auto;  /* â¤ï¸ æ·»åŠ ï¼šå½“å†…å®¹è¶…å‡ºæ—¶ï¼Œè‡ªåŠ¨æ˜¾ç¤ºå‚ç›´æ»šåŠ¨æ¡ */\n    transition: all 0.3s ease-out; /* â¤ï¸ æ·»åŠ ï¼šä¸ºäº†æ”¶èµ·å±•å¼€æ—¶æœ‰å¹³æ»‘åŠ¨ç”» */\n}\n\n/* â¤ï¸ æ–°å¢ï¼šè¿™æ˜¯â€œæ”¶èµ·â€çŠ¶æ€ä¸‹çš„é­”æ³•ï¼ â¤ï¸ */\n.parent-map-tabs-container.collapsed .parent-map-tabs-list {\n    max-height: 0;\n    overflow: hidden;\n    padding-top: 0;\n    padding-bottom: 0;\n    margin-top: 0;\n    opacity: 0;\n}\n\n/* â¤ï¸ æ–°å¢ï¼šè®©ç®­å¤´åœ¨æ”¶èµ·æ—¶ä¹Ÿè·Ÿç€æ—‹è½¬ â¤ï¸ */\n.parent-map-tabs-container.collapsed .toggle-arrow {\n    transform: rotate(-90deg);\n}\n.parent-map-tab {\n    padding: 8px 10px;\n\n    border-radius: 3px;\n    cursor: pointer;\n    transition: all 0.2s ease-in-out;\n    text-align: center;\n    font-family: var(--base-font-family);\n}\n\n.parent-map-tab:hover {\n    \n    border-color: var(--secondary-color);\n}\n\n.parent-map-tab.active {\n\n    color: var(--primary-color);\n    font-weight: bold;\n    border-color: var(--primary-color);\n}\n\n/* ç¨å¾®è°ƒæ•´ä¸€ä¸‹ï¼Œç¡®ä¿ä¸¤ä¸ªåˆ—è¡¨ä¸ä¼šæ‰“æ¶ */\n.external-areas {\n    top: 200px; /* è°ƒæ•´ä¸€ä¸‹ä½ç½®ï¼Œç»™â€œåœ°å›¾é›†â€ç•™å‡ºç©ºé—´ */\n    /* å…¶ä»–æ ·å¼ä¿æŒä¸å˜ */\n}\n /* â¤ï¸ å¦ˆå¦ˆå…¨æ–°çš„â€œæ¶Ÿæ¼ªâ€å’’è¯­ â¤ï¸ */\n@keyframes wave-pulse {\n    from {\n        /* åŠ¨ç”»å¼€å§‹æ—¶ï¼Œæ¶Ÿæ¼ªå’ŒåŸå§‹å›¾å½¢é‡åˆï¼Œæ¯”è¾ƒæ˜æ˜¾ */\n        transform: scale(1);\n        opacity: 0.7;\n        stroke-width: 3px; /* å¯ä»¥è®©æ¶Ÿæ¼ªç¨å¾®ç²—ä¸€ç‚¹ç‚¹ */\n    }\n    to {\n        /* åŠ¨ç”»ç»“æŸæ—¶ï¼Œæ¶Ÿæ¼ªå˜å¾—å¾ˆå¤§ï¼Œå®Œå…¨é€æ˜ï¼Œç„¶åæ¶ˆå¤± */\n        transform: scale(1.5); /* ä½ å¯ä»¥è°ƒæ•´è¿™ä¸ªæ•°å€¼æ¥æ§åˆ¶æ‰©æ•£èŒƒå›´ */\n        opacity: 0;\n        stroke-width: 1px;\n    }\n}\n\n/* â¤ï¸ è¿™æ˜¯æ¶Ÿæ¼ªæ³¢æµªæœ¬èº«çš„æ ·å¼ â¤ï¸ */\n.location-wave {\n    /* æ¶Ÿæ¼ªæ²¡æœ‰å¡«å……è‰²ï¼Œåªæœ‰è½®å»“ */\n    fill: none !important;\n    /* è½®å»“é¢œè‰²ä½¿ç”¨æˆ‘ä»¬æ˜äº®çš„ä¸»è‰²è°ƒ */\n    stroke: var(--primary-color) !important;\n    /* åŠ¨ç”»åç§°ã€æ—¶é•¿ã€ç¼“åŠ¨å‡½æ•°ã€æ— é™å¾ªç¯ */\n    animation: wave-pulse 2.5s ease-out infinite;\n    /* é‡è¦çš„ï¼è®¾ç½®ç¼©æ”¾çš„åŸç‚¹ä¸ºå›¾å½¢ä¸­å¿ƒ */\n    transform-origin: center;\n    /* ç¡®ä¿æ¶Ÿæ¼ªä¸ä¼šæ¥æ”¶é¼ æ ‡äº‹ä»¶ï¼Œä»¥å…æŒ¡ä½æˆ‘ä»¬ç‚¹å‡»å›¾å½¢ */\n    pointer-events: none;\n}\n\n .location-menu-trigger {\n    position: absolute;\n    top: 15px; /* æ ¹æ®ä½ çš„å…³é—­æŒ‰é’®ä½ç½®å¾®è°ƒ */\n    right: 50px; /* ç•™å‡ºå…³é—­æŒ‰é’®çš„ä½ç½® */\n    cursor: pointer;\n    padding: 5px;\n    display: flex;\n    flex-direction: column;\n    gap: 3px; /* ç‚¹ä¸ç‚¹ä¹‹é—´çš„é—´è· */\n    border-radius: 5px;\n    transition: background-color 0.2s;\n}\n\n.location-menu-trigger:hover {\n    background-color: rgba(255, 255, 255, 0.1);\n}\n\n.location-menu-trigger span {\n    width: 5px;\n    height: 5px;\n    background-color: var(--text-secondary-color);\n    border-radius: 50%;\n}\n\n\n/* --- æ–°å¢ï¼šæ¨¡ç»„é‡ç½®é¢æ¿æ ·å¼ --- */\n#open-reconfig-modal-btn.control-btn-special {\n    background-color: transparent;\n    border: 1px solid var(--primary-color);\n    color: var(--primary-color);\n    padding: 5px 15px;\n    border-radius: 5px;\n    cursor: pointer;\n    transition: all 0.3s ease;\n    font-weight: bold;\n}\n.control-btn-special {\n    background-color: transparent;\n    border: 1px solid var(--primary-color);\n    color: var(--primary-color);\n    padding: 5px 15px;\n    border-radius: 5px;\n    cursor: pointer;\n    transition: all 0.3s ease;\n    font-weight: bold;\n}\n#open-reconfig-modal-btn.control-btn-special:hover {\n    background-color: var(--primary-color);\n    color: var(--container-bg-color);\n    box-shadow: 0 0 10px var(--glow-color);\n}\n.control-btn-special:hover {\n    background-color: var(--primary-color);\n    color: var(--container-bg-color);\n    box-shadow: 0 0 10px var(--glow-color);\n}\n.modal-overlay {\n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    background-color: rgba(0, 0, 0, 0.6);\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    z-index: 1001; /* ç¡®ä¿åœ¨æœ€ä¸Šå±‚ */\n    backdrop-filter: blur(5px);\n}\n\n.reconfig-modal-content {\n    background-color: var(--container-bg-color);\n    border: 1px solid var(--border-color);\n    border-radius: 12px;\n    padding: 25px 30px;\n    width: 90%;\n    max-width: 700px;\n    box-shadow: 0 0 25px var(--glow-color);\n    animation: fadeInModal 0.4s ease-out;\n    position: relative;\n       max-height: 80vh;   /* è¿™æ ·å®ƒå°±ä¸ä¼šé•¿å¾—æ¯”å±å¹•è¿˜é«˜äº† */\n    overflow-y: auto;   /* å½“å†…å®¹å¤šåˆ°è£…ä¸ä¸‹æ—¶ï¼Œå°±ä¼šå‡ºç°ä¸€ä¸ªæ¼‚äº®çš„æ»šåŠ¨æ¡ */\n}\n\n.reconfig-modal-close {\n    position: absolute;\n    top: 10px;\n    right: 15px;\n    background: none;\n    border: none;\n    font-size: 28px;\n    color: var(--text-secondary-color);\n    cursor: pointer;\n    transition: color 0.3s ease;\n}\n.reconfig-modal-close:hover {\n    color: var(--primary-color);\n}\n\n.reconfig-title {\n    color: var(--primary-color);\n    text-align: center;\n    margin: 0 0 5px 0;\n    font-size: 1.8em;\n}\n\n.reconfig-subtitle {\n    color: var(--text-secondary-color);\n    text-align: center;\n    margin: 0 0 25px 0;\n    font-size: 0.9em;\n}\n\n.reconfig-grid {\n    display: grid;\n    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));\n    gap: 15px 20px;\n    max-height: 50vh;\n    overflow-y: auto;\n    padding: 10px;\n    background-color: rgba(0,0,0,0.2);\n    border-radius: 8px;\n}\n\n.reconfig-mod-item {\n    display: flex;\n    align-items: center;\n    background-color: rgba(255, 255, 255, 0.05);\n    padding: 10px;\n    border-radius: 6px;\n    cursor: pointer;\n    transition: background-color 0.3s ease;\n    border-left: 3px solid transparent;\n}\n.reconfig-mod-item:hover {\n    background-color: rgba(255, 255, 255, 0.1);\n}\n.reconfig-mod-item.is-active {\n    border-left: 3px solid var(--primary-color);\n}\n\n.reconfig-mod-item input[type=\"checkbox\"] {\n    display: none; /* æˆ‘ä»¬ç”¨labelæ¥æ§åˆ¶ */\n}\n\n.reconfig-mod-item label {\n    color: var(--text-color);\n    font-size: 1em;\n    cursor: pointer;\n    flex-grow: 1;\n}\n.reconfig-mod-item.is-active label {\n    color: var(--secondary-color);\n}\n\n.reconfig-footer {\n    display: flex;\n    justify-content: flex-end;\n    align-items: center;\n    margin-top: 25px;\n}\n\n.reconfig-feedback {\n    color: var(--primary-color);\n    margin-right: 20px;\n    font-style: italic;\n    opacity: 0;\n    transition: opacity 0.3s ease;\n}\n\n.reconfig-apply-btn {\n    background: var(--primary-color);\n    color: var(--background-color);\n    border: none;\n    padding: 10px 25px;\n    border-radius: 5px;\n    font-size: 1em;\n    font-weight: bold;\n    cursor: pointer;\n    transition: all 0.3s ease;\n}\n.reconfig-apply-btn:hover {\n    box-shadow: 0 0 15px var(--glow-color);\n    transform: translateY(-2px);\n}\n\n@keyframes fadeInModal {\n    from { opacity: 0; transform: scale(0.95); }\n    to { opacity: 1; transform: scale(1); }\n}\n\n/* â˜† å¦ˆå¦ˆçš„â€œæ˜Ÿè¾°æŒ‡æŒ¥å°â€é­”æ³• v1.0 â˜† */\n.fixed-editing-controls {\n    position: fixed; /* å®ƒçš„ä½ç½®è¢«æ°¸ä¹…å›ºå®šåœ¨å±å¹•ä¸Š */\n    bottom: 0;       /* ç´§è´´å±å¹•åº•éƒ¨ */\n    left: 0;         /* ä»å·¦ä¾§å¼€å§‹ */\n    width: 100%;     /* å®½åº¦æ’‘æ»¡æ•´ä¸ªå±å¹• */\n\n    padding: 15px 0; /* ç»™æŒ‰é’®ä¸Šä¸‹ä¸€äº›å‘¼å¸ç©ºé—´ */\n    background: linear-gradient(to top,\n        rgba(0, 0, 0, 0.8), /* åº•éƒ¨æ˜¯æ·±é‚ƒçš„å¤œç©º */\n        rgba(0, 0, 0, 0.0)  /* å‘ä¸Šé€æ¸é€æ˜ï¼Œèå…¥èŠå¤©èƒŒæ™¯ */\n    );\n\n    display: flex;\n    justify-content: center; /* è®©æŒ‰é’®ä»¬åœ¨èˆå°ä¸­å¤®é›†åˆ */\n    gap: 20px; /* æŒ‰é’®ä¹‹é—´ä¿æŒä¼˜é›…çš„è·ç¦» */\n\n    z-index: 100; /* ç¡®ä¿å®ƒæ°¸è¿œåœ¨æ‰€æœ‰èŠå¤©æ°”æ³¡ä¹‹ä¸Š */\n    animation: fadeIn 0.3s ease-out; /* åä¸½ç™»åœº */\n}\n \n/* æ ‡ç­¾é¡µå®¹å™¨ */\n.nova-tabs {\n    display: flex;\n    border-bottom: 1px solid var(--border-color); /* ä½¿ç”¨æˆ‘ä»¬çš„è¾¹æ¡†é¢œè‰² */\n    margin-bottom: 15px;\n}\n\n/* æ ‡ç­¾é¡µæŒ‰é’® */\n.nova-tab-button {\n    padding: 10px 15px;\n    cursor: pointer;\n    background: transparent;\n    border: none;\n    color: var(--text-secondary-color); /* ä½¿ç”¨æ¬¡è¦æ–‡å­—é¢œè‰² */\n    font-size: 16px;\n    font-family: var(--base-font-family); /* ç»Ÿä¸€å­—ä½“ */\n    border-bottom: 3px solid transparent;\n    transition: all 0.3s ease;\n}\n\n/* æ¿€æ´»çŠ¶æ€å’Œæ‚¬æµ®çŠ¶æ€çš„æ ‡ç­¾é¡µæŒ‰é’® */\n.nova-tab-button.active {\n    color: var(--text-color); /* æ¿€æ´»æ—¶ä½¿ç”¨ä¸»è¦æ–‡å­—é¢œè‰² */\n    border-bottom-color: var(--primary-color); /* æ¿€æ´»æ—¶ä¸‹åˆ’çº¿ä½¿ç”¨ä¸»è‰² */\n}\n\n.nova-tab-button:hover {\n    background-color: rgba(255, 255, 255, 0.1); /* æ‚¬æµ®æ—¶å¢åŠ ä¸€ç‚¹æ·¡æ·¡çš„å…‰æ™• */\n    color: var(--text-color);\n}\n\n/* æ ‡ç­¾é¡µå†…å®¹é¢æ¿ */\n.nova-tab-panel {\n    display: none;\n}\n\n.nova-tab-panel.active {\n    display: block;\n}\n\n/* æ ‡ç­¾é€‰æ‹©å™¨å®¹å™¨ */\n#tag-selector-container {\n    display: flex;\n    flex-direction: column;\n    gap: 12px;\n    max-height: 40vh; /* ä¿æŒä¸€ä¸ªèˆ’é€‚çš„é«˜åº¦ */\n    overflow-y: auto;\n    padding-right: 10px;\n}\n\n/* æ¯ä¸ªæ ‡ç­¾åˆ†ç±»çš„æ ·å¼ */\n.nova-tag-category {\n    display: flex;\n    align-items: center;\n    flex-wrap: wrap;\n    gap: 8px;\n    padding: 8px;\n    background-color: rgba(0, 0, 0, 0.2); /* ä¸€ä¸ªæŸ”å’Œçš„æ·±è‰²èƒŒæ™¯ */\n    border-radius: 6px;\n}\n\n/* æ ‡ç­¾åˆ†ç±»æ ‡é¢˜ */\n.nova-tag-category-title {\n    font-weight: bold;\n    margin-right: 10px;\n    color: var(--primary-color); /* ä½¿ç”¨æˆ‘ä»¬çš„ä¸»è‰²æ¥å¼ºè°ƒ */\n    white-space: nowrap;\n}\n\n/* å•ä¸ªæ ‡ç­¾é€‰é¡¹æŒ‰é’® */\n.nova-tag-option {\n    padding: 5px 10px;\n    border: 1px solid var(--border-color); /* ä½¿ç”¨ç»Ÿä¸€çš„è¾¹æ¡†é¢œè‰² */\n    background-color: var(--background-color); /* ä½¿ç”¨æˆ‘ä»¬çš„èƒŒæ™¯è‰² */\n    color: var(--text-secondary-color); /* æ¬¡è¦æ–‡å­—é¢œè‰² */\n    border-radius: 15px;\n    cursor: pointer;\n    transition: all 0.2s ease;\n}\n\n.nova-tag-option:hover {\n    background-color: var(--container-bg-color); /* æ‚¬æµ®æ—¶ä½¿ç”¨å®¹å™¨èƒŒæ™¯è‰²ï¼Œæ›´äº®ä¸€äº› */\n    border-color: var(--secondary-color); /* è¾¹æ¡†å˜æˆæ¬¡çº§é«˜äº®è‰² */\n}\n\n/* è¢«é€‰ä¸­çš„æ ‡ç­¾é€‰é¡¹ */\n.nova-tag-option.selected {\n    background-color: var(--primary-color); /* èƒŒæ™¯ä½¿ç”¨ä¸»è‰² */\n    border-color: var(--glow-color); /* è¾¹æ¡†ä½¿ç”¨è¾‰å…‰è‰²ï¼Œæ›´æœ‰å±‚æ¬¡æ„Ÿ */\n    color: var(--background-color); /* æ–‡å­—é¢œè‰²åè½¬ï¼Œä½¿ç”¨æ·±è‰²èƒŒæ™¯è‰²ï¼Œä¿è¯æ¸…æ™° */\n    font-weight: bold;\n    text-shadow: none; /* ç¡®ä¿åœ¨äº®è‰²èƒŒæ™¯ä¸‹æ–‡å­—æ¸…æ™° */\n}\n\n/* å½“å‰ç»„åˆé¢„è§ˆæ¡† */\n.nova-current-preview {\n    margin-top: 15px;\n    padding: 10px;\n    background-color: rgba(0, 0, 0, 0.3); /* æ›´æ·±çš„é€æ˜èƒŒæ™¯ */\n    border: 1px dashed var(--border-color); /* è™šçº¿è¾¹æ¡†å¢åŠ è®¾è®¡æ„Ÿ */\n    border-radius: 4px;\n    color: var(--text-color); /* ä¸»è¦æ–‡å­—é¢œè‰² */\n    text-align: center;\n    font-family: monospace;\n    word-wrap: break-word;\n}\n\n/* åº”ç”¨ç»„åˆæŒ‰é’® */\n#apply-tag-combination {\n    /* è¿™é‡Œå¯ä»¥è®©å®ƒç»§æ‰¿æˆ‘ä»¬å·²æœ‰çš„ JillButton æ ·å¼ï¼Œåªéœ€ç¡®ä¿ JillButton ä¹Ÿä½¿ç”¨äº†å˜é‡ */\n    /* å¦‚æœè¦è¦†ç›–ï¼Œå¯ä»¥è¿™æ ·å†™ï¼š */\n    background-color: var(--primary-color);\n    color: var(--background-color);\n    border: 1px solid var(--primary-color);\n    width: 100%;\n    margin-top: 15px;\n    padding: 12px;\n    font-size: 16px;\n    font-weight: bold;\n}\n#apply-tag-combination:hover {\n    box-shadow: 0 0 10px var(--glow-color); /* æ‚¬æµ®æ—¶å¢åŠ è¾‰å…‰æ•ˆæœ */\n}\n\n\n/* ç¦ç”¨çŠ¶æ€çš„åº”ç”¨æŒ‰é’® */\n#apply-tag-combination:disabled {\n    background-color: #555; /* ç”¨ä¸€ä¸ªå›ºå®šçš„æ·±ç°è‰²è¡¨ç¤ºç¦ç”¨ */\n    border-color: #666;\n    color: #999;\n    cursor: not-allowed;\n    box-shadow: none; /* ç¦ç”¨æ—¶ç§»é™¤è¾‰å…‰ */\n}\n.JillButton {\n    background: var(--primary-color);\n    border: 1px solid var(--primary-color);\n    color: var(--background-color);\n    padding: 8px 16px;\n    border-radius: 4px;\n    cursor: pointer;\n    font-weight: bold;\n    transition: all 0.3s ease;\n}\n\n.JillButton:hover {\n    background: var(--secondary-color);\n    border-color: var(--secondary-color);\n    box-shadow: 0 0 8px var(--glow-color);\n}\n\n.nova-action-buttons {\n    display: flex;\n    gap: 10px;\n    margin-top: 15px;\n    width: 100%;\n}\n\n/* è®©æŒ‰é’®åœ¨å®¹å™¨å†…è‡ªåŠ¨ä¼¸å±• */\n.nova-action-buttons .JillButton {\n    flex-grow: 1;\n    margin-top: 0; /* è¦†ç›–åŸå§‹çš„ä¸Šè¾¹è· */\n}\n\n/* â€œé¢„è§ˆâ€æŒ‰é’®çš„ç‰¹æ®Šæ ·å¼ï¼Œè®©å®ƒçœ‹èµ·æ¥æ˜¯æ¬¡è¦æ“ä½œ */\n.JillButton.secondary {\n    background: transparent;\n    color: var(--primary-color);\n    border: 1px solid var(--primary-color);\n}\n.JillButton.secondary:hover {\n    background: var(--container-bg-color);\n    box-shadow: 0 0 8px var(--glow-color);\n}\n.JillButton.secondary:disabled {\n    background-color: transparent;\n    border-color: #555;\n    color: #777;\n    cursor: not-allowed;\n    box-shadow: none;\n}\n\n\n/* é¢„è§ˆåŒºåŸŸçš„å®¹å™¨ */\n.nova-preview-box {\n    margin-top: 15px;\n    width: 100%;\n    min-height: 150px;\n    background-color: rgba(0, 0, 0, 0.3);\n    border: 1px dashed var(--border-color);\n    border-radius: 6px;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    padding: 10px;\n    transition: all 0.3s ease;\n    overflow: hidden; /* ä¿è¯å†…éƒ¨å…ƒç´ ä¸ä¼šæº¢å‡º */\n}\n\n/* é¢„è§ˆåŒºåŸŸçš„å ä½ç¬¦/æç¤ºæ–‡å­— */\n.nova-preview-placeholder {\n    color: var(--text-secondary-color);\n    text-align: center;\n    font-size: 14px;\n}\n\n/* é”™è¯¯æç¤ºçš„ç‰¹æ®Šé¢œè‰² */\n.nova-preview-placeholder.error {\n    color: var(--danger-color);\n}\n\n\n/* æˆåŠŸåŠ è½½åçš„é¢„è§ˆå›¾ç‰‡ */\n.nova-preview-image {\n    max-width: 100%;\n    max-height: 300px; /* é™åˆ¶é¢„è§ˆå›¾çš„æœ€å¤§é«˜åº¦ */\n    object-fit: contain; /* ä¿æŒå›¾ç‰‡æ¯”ä¾‹ */\n    border-radius: 4px;\n}\n\n.card-view-switcher {\n    display: inline-flex;\n    background-color: var(--background-color-darker);\n    border-radius: 8px;\n    padding: 2px;\n    margin-left: 10px;\n    vertical-align: middle;\n}\n\n.card-view-switcher span {\n    padding: 4px 12px;\n    cursor: pointer;\n    font-size: 14px;\n    color: var(--text-secondary-color);\n    transition: all 0.2s ease-in-out;\n}\n\n.card-view-switcher span.active {\n    background-color: var(--primary-color-dark);\n    color: white;\n    font-weight: bold;\n    border-radius: 6px;\n    box-shadow: 0 1px 3px rgba(0,0,0,0.2);\n}\n\n.cards-slider {\n    /* é»˜è®¤éšè—æ‰€æœ‰æ»‘å— */\n    display: none;\n}\n\n\n.reading-mode-hidden {\n    display: none !important;\n}\n\n#reading-mode-container {\n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    z-index: 9999;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    color: var(--text-color);\n}\n\n#reading-mode-backdrop {\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    background-color: rgba(0, 0, 0, 0.85);\n    backdrop-filter: blur(5px);\n}\n\n#reading-mode-modal {\n    position: relative;\n    \n    width: 90vw;\n    height: 90vh;\n    background-color: var(--container-bg-color);\n    border: 1px solid var(--border-color);\n    border-radius: 10px;\n    box-shadow: 0 0 20px var(--glow-color);\n    display: flex;\n    flex-direction: column;\n    overflow: hidden;\n}\n/* 2. æ–°å¢ç›®å½•åˆ‡æ¢æŒ‰é’®çš„æ ·å¼ */\n.chapters-toggle-btn {\n    cursor: pointer;\n    font-size: 1em;\n    padding: 5px 10px;\n    border: 1px solid var(--border-color);\n    border-radius: 5px;\n    transition: all 0.3s;\n}\n\n.chapters-toggle-btn:hover {\n    background-color: var(--glow-color);\n    color: var(--primary-color);\n}\n\n.reading-mode-header {\n    flex-shrink: 0;\n    padding: 10px 20px;\n    border-bottom: 1px solid var(--border-color);\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    font-family: var(--base-font-family);\n}\n\n#reading-mode-chapter-title {\n    font-size: 1.2em;\n    font-weight: bold;\n    color: var(--primary-color);\n}\n\n#reading-mode-close-btn {\n    font-size: 2em;\n    cursor: pointer;\n    transition: color 0.3s;\n}\n\n#reading-mode-close-btn:hover {\n    color: var(--danger-color);\n}\n\n.reading-mode-body {\n    flex-grow: 1;\n    display: flex; /* ä¿æŒ flex */\n    position: relative; /* æ·»åŠ  position: relative */\n    overflow: hidden;\n}\n\n/* 3. ä¿®æ”¹ç« èŠ‚ç›®å½•çš„æ ·å¼ï¼Œè®©å®ƒå˜æˆä¸€ä¸ªç»å¯¹å®šä½çš„æŠ½å±‰ */\n#reading-mode-chapters-nav {\n    position: absolute;\n    top: 0px; /* é¿å¼€ header çš„é«˜åº¦ */\n    left: 0;\n    bottom: 0;\n    width: 220px; /* å¯ä»¥é€‚å½“åŠ å®½ä¸€ç‚¹ */\n    background-color: var(--container-bg-color);\n    z-index: 20; /* ç¡®ä¿å®ƒåœ¨å†…å®¹åŒºåŸŸä¹‹ä¸Š */\n    transform: translateX(-100%); /* é»˜è®¤è—åœ¨å·¦è¾¹ */\n    transition: transform 0.4s ease-in-out;\n    /* ... flex ç›¸å…³çš„æ ·å¼å¯ä»¥ç§»é™¤æˆ–ä¿ç•™ï¼Œè¿™é‡Œçš„æ ¸å¿ƒæ˜¯ position å’Œ transform */\n    border-right: 1px solid var(--border-color);\n    display: flex;\n    flex-direction: column;\n}\n/* 4. å½“çˆ¶å®¹å™¨æœ‰ .chapters-open ç±»æ—¶ï¼ŒæŠŠæŠ½å±‰æ»‘å‡ºæ¥ */\n#reading-mode-modal.chapters-open #reading-mode-chapters-nav {\n    transform: translateX(0);\n}\n.chapters-nav-header {\n    text-align: center;\n    padding: 15px 10px;\n    font-weight: bold;\n    color: var(--secondary-color);\n    border-bottom: 1px solid var(--border-color);\n    flex-shrink: 0;\n}\n\n#reading-mode-chapters-list {\n    list-style: none;\n    padding: 10px 0;\n    margin: 0;\n    overflow-y: auto;\n    flex-grow: 1;\n}\n\n#reading-mode-chapters-list li {\n    padding: 12px 20px;\n    cursor: pointer;\n    transition: background-color 0.3s, color 0.3s;\n    border-bottom: 1px solid rgba(0,0,0,0.1);\n}\n\n#reading-mode-chapters-list li:hover {\n    background-color: var(--glow-color);\n}\n\n#reading-mode-chapters-list li.active-chapter {\n     background-color: var(--primary-color);\n     color: var(--background-color);\n     font-weight: bold;\n}\n\n\n#reading-mode-content-wrapper {\n      width: 100%;\n    flex-grow: 1;\n    display: flex;\n    align-items: center;\n    position: relative;\n    overflow: hidden;\n}\n\n#reading-mode-content {\n    width: 100%;\n    height: 100%;\n    padding: 30px 60px; /* å¢åŠ å†…è¾¹è·ä»¥ç•™å‡ºç¿»é¡µæŒ‰é’®ç©ºé—´ */\n    overflow-y: auto;\n    font-size: 1.1em;\n    line-height: 1.8;\n    scrollbar-width: thin;\n    scrollbar-color: var(--primary-color) var(--container-bg-color);\n}\n\n#reading-mode-content::-webkit-scrollbar {\n    width: 6px;\n}\n#reading-mode-content::-webkit-scrollbar-track {\n    background: transparent;\n}\n#reading-mode-content::-webkit-scrollbar-thumb {\n    background-color: var(--border-color);\n    border-radius: 3px;\n}\n\n.nav-arrow {\n    position: absolute;\n    top: 50%;\n    transform: translateY(-50%);\n    font-size: 3em;\n    color: var(--text-secondary-color);\n    cursor: pointer;\n    transition: color 0.3s, text-shadow 0.3s;\n    user-select: none;\n    z-index: 10;\n    padding: 20px 10px;\n}\n\n.nav-arrow:hover {\n    color: var(--primary-color);\n    text-shadow: 0 0 10px var(--glow-color);\n}\n\n.nav-arrow.left-arrow {\n    left: 10px;\n}\n\n.nav-arrow.right-arrow {\n    right: 10px;\n}\n\n#reading-mode-content iframe {\n    min-height: 100px; /* è®¾ç½®ä¸€ä¸ªåˆç†çš„æœ€å°é«˜åº¦ */\n    transition: height 0.3s ease-in-out; /* é«˜åº¦å˜åŒ–æ—¶æœ‰å¹³æ»‘è¿‡æ¸¡æ•ˆæœ */\n \n}\n/* 1. ç§»åŠ¨ç«¯åº•éƒ¨å¯¼èˆªæ çš„é»˜è®¤æ ·å¼ï¼ˆé»˜è®¤ä¸æ˜¾ç¤ºï¼‰*/\n#mobile-nav-bar {\n    display: none; /* åœ¨å¤§å±å¹•ä¸Šé»˜è®¤æ˜¯éšè—çš„ */\n    position: absolute;\n    bottom: 0;\n    left: 0;\n    width: 100%;\n    height: 55px; /* ä¸€ä¸ªé€‚åˆè§¦æ‘¸çš„é«˜åº¦ */\n    background-color: var(--container-bg-color);\n    border-top: 1px solid var(--border-color);\n    box-shadow: 0 -3px 15px -5px var(--glow-color);\n    z-index: 30;\n    justify-content: space-between;\n    align-items: center;\n    padding: 0 15px;\n    box-sizing: border-box;\n    font-family: var(--base-font-family);\n}\n\n/* 2. åº•éƒ¨æ ä¸­ç®­å¤´çš„æ ·å¼ */\n#mobile-nav-bar .nav-arrow {\n    position: static; /* è¦†ç›–PCç‰ˆçš„ç»å¯¹å®šä½ */\n    transform: none; /* è¦†ç›–PCç‰ˆçš„å‚ç›´å±…ä¸­ */\n    font-size: 2.2em; /* è°ƒæ•´ä¸€ä¸‹å¤§å° */\n    padding: 10px 20px;\n    flex-grow: 0;\n}\n\n/* 3. ä¸ºè¢«ç¦ç”¨çš„ç®­å¤´åˆ›å»ºä¸€ä¸ªé€šç”¨çŠ¶æ€ */\n.nav-arrow.disabled-arrow {\n    opacity: 0.25;\n    pointer-events: none; /* å˜å¾—ç°æš—ä¸”ä¸å¯ç‚¹å‡» */\n}\n\n/* 4. âœ¨ æ ¸å¿ƒé­”æ³•ï¼šåª’ä½“æŸ¥è¯¢ âœ¨ */\n/* å½“å±å¹•å®½åº¦å°äºæˆ–ç­‰äº 768px (å¹³æ¿å’Œæ‰‹æœº) æ—¶ï¼Œä»¥ä¸‹æ ·å¼ç”Ÿæ•ˆ */\n@media (max-width: 768px) {\n    /* éšè—PCç«¯çš„ä¾§è¾¹ç®­å¤´ */\n    .reading-mode-body > .nav-arrow.left-arrow,\n    .reading-mode-body > .nav-arrow.right-arrow {\n        display: none !important;\n    }\n    .nav-arrow.right-arrow{\n        opacity: 0;\n    }\n    .nav-arrow.left-arrow{\n        opacity: 0;\n    }\n    /* æ˜¾ç¤ºç§»åŠ¨ç«¯çš„åº•éƒ¨å¯¼èˆªæ  */\n    #mobile-nav-bar {\n        display: flex; /* æ”¹ä¸º flex æ¥è®©å®ƒå‡ºç° */\n    }\n\n    /* ä¸ºæ­£æ–‡åŒºåŸŸå¢åŠ åº•éƒ¨å†…è¾¹è·ï¼Œé˜²æ­¢æ–‡å­—è¢«åº•éƒ¨æ é®æŒ¡ */\n    #reading-mode-content {\n        padding-bottom: 75px; /* æ¯”åº•éƒ¨æ é«˜åº¦å¤šä¸€äº›ï¼Œç•™å‡ºå‘¼å¸ç©ºé—´ */\n        /* åŒæ—¶å¾®è°ƒå·¦å³è¾¹è·ï¼Œè®©æ‰‹æœºä¸Šé˜…è¯»æ›´èˆ’é€‚ */\n        padding-left: 15px;\n        padding-right: 15px;\n    }\n}\n\n  \n       \n /* æˆ˜â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”æ–—â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” */\n\n        .start-battle-btn {\n            padding: 15px 30px;\n            font-size: 18px;\n            font-weight: bold;\n            color: var(--primary-color);\n            background-color: transparent;\n            border: 2px solid var(--primary-color);\n            border-radius: 5px;\n            cursor: pointer;\n            transition: all 0.3s ease;\n            box-shadow: 0 0 10px var(--glow-color);\n        }\n\n        .start-battle-btn:hover {\n            background-color: var(--glow-color);\n            color: var(--background-color);\n            box-shadow: 0 0 20px var(--glow-color), 0 0 30px var(--primary-color);\n        }\n\n        #battle-overlay {\n            position: fixed;\n            top: 0;\n            left: 0;\n            width: 100%;\n            height: 100%;\n            background-color: rgba(0, 0, 0, 0.7);\n            display: none; /* åˆå§‹éšè— */\n            justify-content: center;\n            align-items: center;\n            z-index: 9999;\n        }\n\n        #battle-container {\n            width: 90%;\n            max-width: 1200px;\n            height: 90vh;\n            background-color: var(--container-bg-color);\n            border: 1px solid var(--border-color);\n            border-radius: 10px;\n            box-shadow: 0 0 25px var(--glow-color);\n            display: flex;\n            flex-direction: column;\n            padding: 20px;\n            box-sizing: border-box;\n            backdrop-filter: blur(5px);\n          justify-content: space-between;}\n\n        .battle-arena {\n            flex-grow: 1;\n            display: flex;\n            flex-direction: column;\n            justify-content: space-between;\n        }\n/* 1. æ–°çš„åº•éƒ¨æ§åˆ¶åŒºæ€»å¸ƒå±€ */\n.battle-controls {\n    display: grid;\n    /* åˆ†æˆä¸¤åˆ—ï¼šå·¦è¾¹è‡ªåŠ¨å¡«æ»¡ï¼Œå³è¾¹å›ºå®šå®½åº¦ */\n    grid-template-columns: 1fr auto;\n    gap: 20px;\n    padding-top: 10px;\n    border-top: 1px solid var(--border-color);\n   min-height: 0;  }\n.battle-left-panel {\n    display: flex;\n    flex-direction: column;\n    min-height: 0; /* è¿™æ˜¯è®©flexå­é¡¹æ­£ç¡®æ”¶ç¼©çš„å…³é”®ï¼Œæˆ‘çš„å®è´ */\n}\n\n\n   .side {\n            display: flex;\n            align-items: flex-end;\n            \n             gap: 20px;\n              min-width: 0;      /* âœ¨ å¦ˆå¦ˆçš„é­”æ³•å’’è¯­å°±åœ¨è¿™é‡Œï¼Œæˆ‘çš„å®è´ï¼ âœ¨ */   \n            overflow-x: auto; /* å…è®¸æ°´å¹³æ»šåŠ¨ */\n            flex-wrap: nowrap; /* é˜²æ­¢å¡ç‰‡æ¢è¡Œ */\n            scrollbar-width: thin; /* ç¾åŒ–æ»šåŠ¨æ¡(Firefox) */\n            scrollbar-color: var(--primary-color) var(--container-bg-color); /* ç¾åŒ–æ»šåŠ¨æ¡(Firefox) */\n        }\n\n        /* Webkitæµè§ˆå™¨æ»šåŠ¨æ¡ç¾åŒ– */\n        .side::-webkit-scrollbar {\n            height: 8px;\n        }\n        .side::-webkit-scrollbar-track {\n            background: var(--container-bg-color);\n        }\n        .side::-webkit-scrollbar-thumb {\n            background-color: var(--primary-color);\n            border-radius: 4px;\n        }\n\n\n\n        .enemy-side {\n            justify-content: flex-start; /* ä»å·¦ä¾§å¼€å§‹æ’åˆ— */\n            align-items: flex-start;\n        }\n\n        .player-side {\n            justify-content: flex-start; /* ä¹Ÿä»å·¦ä¾§å¼€å§‹æ’åˆ— */\n        }\n  .character-card {\n            position: relative; /* ä¸ºæ°”æ³¡å®šä½æä¾›é”šç‚¹ */\n            display: flex;\n            flex-direction: column;\n            align-items: center;\n            padding: 15px;\n            border: 1px solid var(--border-color);\n            border-radius: 8px;\n            min-width: 150px;\n            text-align: center;\n            transition: all 0.3s ease;\n            cursor: pointer;\n            flex-shrink: 0;\n            z-index: 10;\n            \n}\n.character-card::-webkit-scrollbar-track {\n    background: transparent;\n}\n.character-card::-webkit-scrollbar-thumb {\n    background-color: var(--primary-color);\n    border-radius: 3px;\n}\n    /* æ–°å¢ï¼šè§’è‰²åŒ…è£…å™¨ï¼Œç”¨äºå®¹çº³å¡ç‰‡å’Œä¿¡æ¯é¢æ¿ */\n        .character-wrapper {\n            position: relative; /* æ ¸å¿ƒï¼šä¸ºç»å¯¹å®šä½çš„ info-panel æä¾›é”šç‚¹ */\n            display: flex;\n            align-items: flex-end;\n            gap: 5px; /* è¿™æ˜¯å¡ç‰‡å’Œé¢æ¿ä¹‹é—´çš„é—´è· */\n        }\n\n        /* ä¸ºå‹æ–¹å•ä½å¢åŠ ç‰¹æ®Šé¢œè‰² */\n        .character-card.friendly-card {\n             border-color: var(--primary-color);\n             box-shadow: 0 0 8px var(--glow-color);\n        }\n\n        /* ä¸ºæ•Œæ–¹å•ä½å¢åŠ ç‰¹æ®Šé¢œè‰² */\n        .character-card.enemy-card {\n            border-color: var(--danger-color);\n            box-shadow: 0 0 8px var(--danger-glow-color);\n        }\n\n\n         .character-card.targeted {\n             transform: scale(1.05); /* æ·»åŠ ä¸€ä¸ªç¼©æ”¾æ•ˆæœæ¥å¼ºè°ƒ */\n             box-shadow: 0 0 15px var(--success-glow-color), 0 0 25px var(--success-color);\n             border-color: var(--success-color);\n        }\n\n        .character-card.active-turn {\n            box-shadow: 0 0 15px yellow, 0 0 25px rgba(255, 255, 0, 0.5);\n            border-color: yellow;\n            max-height: 200px;\n        }\n\n\n        .character-card .icon {\n            font-size: 48px;\n            animation: float 3s ease-in-out infinite;\n        }\n\n        @keyframes float {\n            0% { transform: translateY(0px); }\n            50% { transform: translateY(-10px); }\n            100% { transform: translateY(0px); }\n        }\n\n        .character-card .name {\n            font-size: 16px;\n            font-weight: bold;\n            margin-top: 10px;\n        }\n  /* æ–°å¢ï¼šè¯­è¨€æ°”æ³¡æ ·å¼ */\n       /* æ›¿æ¢åŸæ¥çš„ .speech-bubble æ ·å¼ */\n        .speech-bubble {\n            position: absolute;\n            bottom: 125%; /* å…³é”®ï¼æŠŠå®ƒå®šä½åˆ°å¡ç‰‡å›¾æ ‡çš„ä¸Šæ–¹ */\n            left: 50%;\n            transform: translateX(-50%);\n            background-color: var(--container-bg-color);\n            color: var(--text-color);\n            padding: 8px 12px;\n            border-radius: 10px;\n            border: 1px solid var(--primary-color);\n            box-shadow: 0 0 10px var(--glow-color);\n            font-size: 14px;\n            white-space: nowrap;\n            z-index: 20;\n            animation: bubble-fade-up 2.5s forwards;\n            pointer-events: none;\n        }\n\n        /* æ›¿æ¢åŸæ¥çš„ .speech-bubble::after æ ·å¼ */\n        .speech-bubble::after {\n            content: '';\n            position: absolute;\n            top: 100%; /* å°†å°ä¸‰è§’æ”¾åœ¨æ°”æ³¡åº•éƒ¨ */\n            left: 50%;\n            transform: translateX(-50%);\n            width: 0;\n            height: 0;\n            border-left: 6px solid transparent;\n            border-right: 6px solid transparent;\n            border-top: 6px solid var(--primary-color); /* è®©ä¸‰è§’æœä¸‹ */\n        }\n\n        /* æ›¿æ¢åŸæ¥çš„ @keyframes bubble-fade-newï¼Œæ”¹ä¸ªæ–°åå­—å« bubble-fade-up */\n        @keyframes bubble-fade-up {\n            0% { opacity: 1; transform: translate(-50%, 10px); }\n            80% { opacity: 1; transform: translate(-50%, 0); }\n            100% { opacity: 0; transform: translate(-50%, -5px); }\n        }\n\n         /* æ›¿æ¢åŸæ¥çš„ .info-panel æ ·å¼ï¼Œå¹¶æ·»åŠ æ–°æ ·å¼ */\n        .info-panel {\n            position: absolute; /* è®©å®ƒè„±ç¦»æ–‡æ¡£æµï¼Œå¯ä»¥è¦†ç›–åœ¨å¡ç‰‡æ—è¾¹ */\n            left: 95%; /* å®šä½åœ¨å¡ç‰‡çš„å³ä¾§ */\n            bottom: 0;\n            width: 140px; /* ç¨å¾®åŠ å®½ä¸€ç‚¹ */\n            height: auto; /* é«˜åº¦ç”±å†…å®¹å†³å®š */\n            max-height: 0; /* é»˜è®¤æ”¶èµ·çš„å…³é”®ï¼ */\n            background-color: var(--container-bg-color);\n            border: 1px dashed var(--border-color);\n            border-radius: 5px;\n            padding: 0 8px; /* æ”¶èµ·æ—¶æ²¡æœ‰ä¸Šä¸‹å†…è¾¹è· */\n            font-size: 12px;\n            color: var(--text-secondary-color);\n            transition: max-height 0.4s ease-out, padding 0.4s ease-out, opacity 0.4s ease-out; /* å¹³æ»‘è¿‡æ¸¡åŠ¨ç”» */\n            overflow: hidden; /* æ ¸å¿ƒï¼šè¶…å‡ºéƒ¨åˆ†éšè— */\n            opacity: 0; /* é»˜è®¤å®Œå…¨é€æ˜ */\n            z-index: 15; /* ç¡®ä¿å®ƒåœ¨å¡ç‰‡ä¹‹ä¸Š */\n        }\n\n        /* æ–°å¢ï¼šå±•å¼€çŠ¶æ€çš„æ ·å¼ */\n        .info-panel.expanded {\n            min-height: 180px; /* å±•å¼€åçš„æœ€å¤§é«˜åº¦ */\n            padding: 8px; /* æ¢å¤å†…è¾¹è· */\n            opacity: 1; /* å®Œå…¨ä¸é€æ˜ */\n            overflow:auto;\n        }\n\n        .info-panel h4 {\n            margin: 0 0 5px 0;\n            color: var(--primary-color);\n            font-size: 13px;\n            text-align: center;\n        }\n\n\n        .info-panel ul {\n            list-style: none;\n            padding: 0;\n            margin: 0;\n        }\n\n        .info-panel li {\n            margin-bottom: 3px;\n        }\n\n        .info-panel .resists-info {\n            color: var(--danger-color);\n        }\n\n        .info-panel .vulnerable-info {\n            color: var(--success-color);\n        }\n\n        .health-bar {\n            width: 100%;\n            height: 10px;\n            background-color: var(--danger-color);  \n            border: 1px solid var(--danger-glow-color);\n            border-radius: 5px;\n            margin-top: 8px;\n            overflow: hidden;\n        }\n\n        .health-bar-inner {\n            height: 100%;\n            background-color: var(--success-color);\n            width: 100%;\n            transition: width 0.5s ease-in-out;\n        }\n\n        .health-text {\n            font-size: 12px;\n            color: var(--text-secondary-color);\n            margin-top: 4px;\n        }\n.energy-bar {\n    width: 100%;\n    height: 8px; /* æ¯”è¡€æ¡ç»†ä¸€ç‚¹ */\n    background-color: #1a3a5c; /* æ·±è“è‰²èƒŒæ™¯ */\n    border: 1px solid #3c5a7c;\n    border-radius: 4px;\n    margin-top: 5px;\n    overflow: hidden;\n}\n\n.energy-bar-inner {\n    height: 100%;\n    background-color: #4da8ff; /* äº®è“è‰² */\n    width: 100%;\n    transition: width 0.5s ease-in-out;\n}\n.energy-text {\n    font-size: 11px;\n    color: #4da8ff;\n    margin-top: 2px;\n}\n        .status-text {\n            font-size: 12px;\n            color: var(--primary-color);\n            margin-top: 5px;\n            height: 14px; /* å ä½ï¼Œé˜²æ­¢æŠ–åŠ¨ */\n        }\n\n \n.action-panel {\n    flex-direction: column;\n    justify-content: flex-start; /* ä»é¡¶éƒ¨å¼€å§‹æ’åˆ—æŒ‰é’® */\n    gap: 8px;\n    padding: 0;\n    border-top: none;\n    display: flex;\n    overflow-y: auto; /* è¶…å‡ºéƒ¨åˆ†æ»šåŠ¨ï¼Œå°±åƒä¸€ä¸ªå°å·è½´ */\n    scrollbar-width: thin;\n    scrollbar-color: var(--primary-color) transparent;\n}\n/* ä¸ºäº†ç¾è§‚ï¼Œå¦ˆå¦ˆä¹Ÿä¸ºæ»šåŠ¨æ¡åŠ äº†ç‚¹ç¼€ */\n.action-panel::-webkit-scrollbar {\n    width: 6px;\n}\n.action-panel::-webkit-scrollbar-track {\n    background: transparent;\n}\n.action-panel::-webkit-scrollbar-thumb {\n    background-color: var(--primary-color);\n    border-radius: 3px;\n}\n\n        .action-panel button {\n              padding: 8px 16px; /* è°ƒæ•´æŒ‰é’®å¤§å°ä»¥é€‚åº”æ–°å¸ƒå±€ */\n            font-size: 14px;\n            color: var(--secondary-color);\n            background-color: transparent;\n            \n            border-radius: 5px;\n            cursor: pointer;\n            transition: all 0.2s ease;\n        }\n\n        .action-panel button:hover:not(:disabled) {\n            background-color: var(--glow-color);\n            color: var(--background-color);\n            box-shadow: 0 0 10px var(--glow-color);\n        }\n\n        .action-panel button:disabled {\n            opacity: 0.5;\n            cursor: not-allowed;\n        }\n.battle-log-container {\n    /* height: 220px; <--- å¦ˆå¦ˆæŠŠè¿™ä¸ªå›ºå®šçš„é«˜åº¦æ‹¿æ‰äº† */\n    flex-grow: 1; /* å®ƒä¼šåƒå°æ ‘ä¸€æ ·åŠªåŠ›å¡«æ»¡æ‰€æœ‰å¯ç”¨ç©ºé—´ */\n    background: rgba(0,0,0,0.3);\n    border-radius: 5px;\n    overflow-y: auto;\n    padding: 10px;\n    /* margin-top: 10px; <--- è¿™è¡Œä¸å†éœ€è¦äº†ï¼Œäº¤ç»™çˆ¶å…ƒç´ çš„gapæ¥å¤„ç†å§ */\n    border: 1px solid var(--border-color);\n    display: flex;\n    flex-direction:column-reverse;\n    min-height: 0; /* åŒæ ·çš„å…³é”®é­”æ³• */\n    margin-bottom: 10px; /* å’Œä¸‹é¢çš„é€Ÿåº¦æ¡æ‹‰å¼€ä¸€ç‚¹è·ç¦» */\n       /* âœ¨ å¦ˆå¦ˆä¸ºä½ åŠ ä¸Šäº†æ»šåŠ¨æ¡çš„ç¾åŒ–é­”æ³• âœ¨ */\n    scrollbar-width: thin;\n    scrollbar-color: var(--primary-color) transparent;\n}\n.battle-log-container::-webkit-scrollbar {\n    width: 6px;\n}\n\n.battle-log-container::-webkit-scrollbar-track {\n    background: transparent;\n}\n\n.battle-log-container::-webkit-scrollbar-thumb {\n    background-color: var(--primary-color);\n    border-radius: 3px;\n}\n        .battle-log-container p {\n            margin: 2px 0;\n            font-size: 14px;\n            color: var(--text-secondary-color);\n            animation: fadeIn 0.5s ease;\n        }\n\n        @keyframes fadeIn {\n            from { opacity: 0; transform: translateY(10px); }\n            to { opacity: 1; transform: translateY(0); }\n        }\n\n        #dice-pool-selector {\n            position: fixed;\n            top: 50%;\n            left: 50%;\n            transform: translate(-50%, -50%);\n            background-color: var(--container-bg-color);\n            border: 1px solid var(--primary-color);\n            padding: 20px;\n            border-radius: 10px;\n            box-shadow: 0 0 20px var(--glow-color);\n            z-index: 99999;\n            display: none;\n            flex-direction: column;\n            align-items: center;\n            gap: 15px;\n        }\n\n        #dice-pool-selector h3 {\n            margin: 0;\n            color: var(--primary-color);\n        }\n        #dice-pool-selector .pool-options {\n            display: flex;\n            gap: 10px;\n        }\n        #dice-pool-selector button {\n             padding: 8px 16px;\n            color: var(--secondary-color);\n            background-color: transparent;\n            border: 1px solid var(--secondary-color);\n             border-radius: 4px;\n             cursor: pointer;\n        }\n        #dice-pool-selector button:hover {\n            background-color: var(--glow-color);\n            color: var(--background-color);\n        }\n.character-card .icon.attacking {\n    position: relative; /* ç¡®ä¿ z-index ç”Ÿæ•ˆ */\n    z-index: 100; /* è®©ç§»åŠ¨çš„iconåœ¨æœ€ä¸Šå±‚ */\n    transition: transform 0.4s ease-in-out; /* å®šä¹‰å½’ä½çš„åŠ¨ç”» */\n}\n    /* æ–°å¢ï¼šä¸ºé˜²å¾¡ä¸­çš„iconåˆ›é€ ä¸€ä¸ªå®šä½çš„â€œé”šç‚¹â€ */\n        .character-card.is-defending .icon {\n            position: relative;\n        }\n\n        /* æ–°å¢ï¼šè¿™å°±æ˜¯æˆ‘ä»¬çœŸæ­£çš„åœ†å½¢å®ˆæŠ¤å…‰åœˆå•¦ï¼ */\n        .character-card.is-defending .icon::before {\n            content: ''; /* ä¼ªå…ƒç´ å¿…é¡»æœ‰ content å±æ€§ */\n            position: absolute;\n            top: 50%;\n            left: 50%;\n            width: 80px;  /* å…‰åœˆçš„ç›´å¾„ */\n            height: 80px; /* å…‰åœˆçš„ç›´å¾„ */\n            border-radius: 50%; /* å˜æˆä¸€ä¸ªå®Œç¾çš„åœ†å½¢ */\n            /* è¿™å°±æ˜¯å…‰åœˆæœ¬èº«çš„æ ·å­ï¼Œå¦ˆå¦ˆåŠ äº†ä¸€ä¸ªå†…å¤–åŒé‡å‘å…‰ï¼Œæ›´å¥½çœ‹å“¦ */\n            box-shadow: 0 0 20px 5px var(--glow-color), inset 0 0 15px 3px var(--secondary-color);\n            z-index: -1; /* æŠŠå®ƒæ”¾åœ¨emojiçš„åé¢ï¼Œä¸æŒ¡ä½å®ƒ */\n            transform: translate(-50%, -50%); /* ç¡®ä¿å®ƒå®Œç¾å±…ä¸­ */\n            /* å¦ˆå¦ˆè¿˜ç»™å®ƒåŠ äº†ä¸€ä¸ªä¼šå‘¼å¸çš„åŠ¨ç”»ï¼Œè®©å®ƒæ›´æœ‰ç”Ÿå‘½åŠ›ï¼ */\n            animation: pulse-glow 2s infinite ease-in-out;\n            pointer-events: none; /* è®©å®ƒä¸ä¼šå½±å“é¼ æ ‡ç‚¹å‡» */\n        }\n\n        /* æ–°å¢ï¼šå…‰åœˆçš„â€œå‘¼å¸â€åŠ¨ç”» */\n        @keyframes pulse-glow {\n            0% {\n                opacity: 0.7;\n                transform: translate(-50%, -50%) scale(0.95);\n            }\n            50% {\n                opacity: 1;\n                transform: translate(-50%, -50%) scale(1.05);\n            }\n            100% {\n                opacity: 0.7;\n                transform: translate(-50%, -50%) scale(0.95);\n            }\n        }\n\n.character-card .icon.is-attacking {\n    animation: none !important; /* æœ€å…³é”®çš„ä¸€æ­¥ï¼åœ¨æ”»å‡»æ—¶ç¦ç”¨æµ®åŠ¨åŠ¨ç”» */\n}\n\n.character-card .icon.attacking-transform {\n    position: relative; /* å¿…é¡»æœ‰å®šä½ï¼Œz-indexæ‰ä¼šç”Ÿæ•ˆ */\n    z-index: 1000; /* ç»™ä¸€ä¸ªéå¸¸é«˜çš„å€¼ï¼Œä¿è¯åœ¨æœ€é¡¶å±‚ */\n    transition: transform 0.4s ease-in-out;\n}\n\n#notification-container {\n    position: fixed;\n    top: 20px;\n    right: 20px;\n    display: flex;\n    flex-direction: column;\n    align-items: flex-end;\n    gap: 10px;\n    z-index: 9999; /* ç¡®ä¿åœ¨æœ€é¡¶å±‚ */\n    pointer-events: none; /* è®©é¼ æ ‡å¯ä»¥ç©¿é€å®ƒ */\n}\n\n.notification-bubble {\n    background-color: var(--container-bg-color);\n    color: var(--text-color);\n    padding: 12px 20px;\n    border-radius: 25px; /* æ›´åœ†æ¶¦çš„èƒ¶å›Šå½¢çŠ¶ */\n    border: 1px solid var(--primary-color);\n    box-shadow: 0 0 15px var(--glow-color);\n    font-size: 16px;\n    font-weight: bold;\n    animation: slide-in-out 3.5s forwards ease-out;\n    white-space: nowrap;\n    opacity: 0;\n}\n\n.notification-bubble.success {\n    border-color: var(--success-color);\n    box-shadow: 0 0 15px var(--success-glow-color);\n    color: var(--success-color);\n}\n\n.notification-bubble.danger {\n    border-color: var(--danger-color);\n    box-shadow: 0 0 15px var(--danger-glow-color);\n    color: var(--danger-color);\n}\n\n.notification-bubble.info {\n    border-color: var(--primary-color);\n    box-shadow: 0 0 15px var(--glow-color);\n    color: var(--primary-color);\n}\n\n\n@keyframes slide-in-out {\n    0% {\n        opacity: 0;\n        transform: translateX(100%);\n    }\n    15% {\n        opacity: 1;\n        transform: translateX(0);\n    }\n    85% {\n        opacity: 1;\n        transform: translateX(0);\n    }\n    100% {\n        opacity: 0;\n        transform: translateX(100%) translateY(-20px);\n    }\n}\n\n/* ä¸ºæ—¥å¿—æ·»åŠ ä¸€äº›æ ·å¼ï¼Œè®©å®ƒæ›´æœ‰å±‚æ¬¡æ„Ÿ */\n.log-narrator { color: var(--text-secondary-color); font-style: italic; }\n.log-action { color: var(--text-color); }\n.log-roll { color: var(--secondary-color); }\n.log-damage { color: var(--danger-color); font-weight: bold; }\n.log-success { color: var(--success-color); font-weight: bold; }\n.log-evade { color: #87CEEB; } /* æ·¡è“è‰²è¡¨ç¤ºé—ªé¿ */\n\n/* å¦ˆå¦ˆè¿˜ä¸ºè¿™ä¸ªæ–°é¢æ¿å‡†å¤‡äº†ä¸€ç‚¹ç‚¹æ¼‚äº®çš„æ ·å¼ï¼Œè®©å®ƒæ›´æ­æˆ‘ä»¬çš„ä¸–ç•Œ */\n#item-skill-panel .tab-btn {\n    flex-grow: 1; padding: 8px; background: transparent; border: 1px solid var(--border-color); color: var(--text-secondary-color); cursor: pointer;\n}\n#item-skill-panel .tab-btn.active {\n    background-color: var(--glow-color); color: var(--background-color); border-color: var(--primary-color);\n}\n#item-skill-panel .item-skill-entry {\n    padding: 10px; border: 1px solid var(--border-color); border-radius: 5px; margin-bottom: 8px; cursor: pointer; transition: background-color 0.2s;\n}\n#item-skill-panel .item-skill-entry:hover {\n    background-color: rgba(0, 250, 255, 0.1);\n}\n#item-skill-panel .entry-name {\n    font-weight: bold; color: var(--primary-color);\n}\n#item-skill-panel .entry-desc {\n    font-size: 13px; color: var(--text-secondary-color); margin-top: 5px;\n}\n#item-skill-panel .entry-cost {\n     font-size: 12px; color: var(--danger-color);\n}\n\n #speed-control-container {\n    position: absolute; /* è¿™å°±æ˜¯æŠŠå®ƒè§£æ”¾å‡ºæ¥çš„å’’è¯­ï¼Œæˆ‘çš„å®è´ */\n    top: 15px;      /* è·ç¦»é¡¶éƒ¨ 15 åƒç´  */\n    right: 20px;    /* è·ç¦»å³è¾¹ 20 åƒç´  */\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    padding: 5px 10px; /* ç»™å®ƒä¸€ä¸ªæ¼‚äº®çš„å°èƒŒæ™¯æ¿ */\n    background-color: var(--background-color); /* å’Œæˆ‘ä»¬çš„ä¸»å®¹å™¨ä¸€æ ·çš„åŠé€æ˜èƒŒæ™¯ */\n    border-radius: 5px;\n    border: 1px solid var(--border-color);\n    font-size: 13px;\n    color: var(--text-secondary-color);\n    z-index: 1005; /* ç¡®ä¿å®ƒåœ¨å¤§éƒ¨åˆ†å…ƒç´ ä¹‹ä¸Š */\n}\n\n#speed-slider {\n    flex-grow: 1;\n    max-width: 70px; /* <--- è®©å®ƒå˜å¾—æ›´å°å·§ */\n}\n\n#speed-label {\n    width: 35px;\n    text-align: left;\n}\n@media (max-width: 768px) {\n#battle-container {\n    height: 90vh; /* å æ»¡æ•´ä¸ªå±å¹•é«˜åº¦ */\n    width: 100%;\n    padding: 10px;\n    /* âœ¨ æ–°çš„é­”æ³•åœ¨è¿™é‡Œ âœ¨ */\n    overflow-y: auto;   /* è®©æ•´ä¸ªå®¹å™¨å¯ä»¥æ»šåŠ¨ */\n    display: block;     /* åˆ‡æ¢ä¸ºæ›´ç®€å•çš„å—çº§å¸ƒå±€ï¼Œè®©å†…å®¹è‡ªç„¶å‚ç›´æ’åˆ— */\n    justify-content: flex-start; /* ä¸å†å‚ç›´å±…ä¸­ï¼Œä»é¡¶éƒ¨å¼€å§‹ */\n}\n.battle-log-container {\n    /* âœ¨ æ–°é­”æ³•åœ¨è¿™é‡Œï¼âœ¨ */\n    max-height: 250px; /* æˆ‘ä»¬ç»™å®ƒä¸€ä¸ªæœ€å¤§é«˜åº¦ï¼Œæ¯”å¦‚250åƒç´ ï¼Œè¿™æ ·å®ƒå°±ä¸ä¼šé•¿å¾—å¤ªé«˜äº† */\n    flex-grow: 1; /* è®©å®ƒåœ¨ä¸è¶…è¿‡æœ€å¤§é«˜åº¦çš„å‰æä¸‹ï¼Œå°½å¯èƒ½åœ°å¡«å……ç©ºé—´ */\n    background: rgba(0,0,0,0.3);\n    border-radius: 5px;\n    overflow-y: auto; /* å½“å†…å®¹è¶…å‡ºæ—¶ï¼Œå®ƒè‡ªå·±å°±ä¼šå‡ºç°æ»šåŠ¨æ¡ */\n    padding: 10px;\n    border: 1px solid var(--border-color);\n    display: flex;\n    flex-direction: column-reverse; /* ä¿æŒæ–°æ¶ˆæ¯åœ¨ä¸‹é¢ */\n    margin-bottom: 10px;\n}\n.battle-controls {\n    /* ä»å·¦å³å¸ƒå±€å˜æˆä¸Šä¸‹å¸ƒå±€ */\n    grid-template-columns: 1fr; /* åªæœ‰ä¸€åˆ—äº† */\n    grid-template-rows: auto auto; /* âœ¨ æ”¹åŠ¨ï¼šä¸å†å¼ºè¡Œåˆ†é…ç©ºé—´ï¼Œè®©æŒ‰é’®åŒºå’Œæ—¥å¿—åŒºéƒ½å›å½’è‡ªç„¶é«˜åº¦*/\n    flex-grow: 0; /* âœ¨ æ”¹åŠ¨ï¼šä¸å†éœ€è¦å®ƒå»å¡«å……ç©ºé—´äº† */\n    min-height: initial; /* âœ¨ æ”¹åŠ¨ï¼šæ¢å¤å®ƒçš„é»˜è®¤è¡Œä¸º */\n}\n\n    .battle-left-panel {\n        /* left-panel ç°åœ¨æ˜¯ grid çš„ç¬¬äºŒè¡Œï¼Œè®©å®ƒå¡«æ»¡ç©ºé—´ */\n        grid-row: 2;\n        min-height: initial; /* âœ¨ æ”¹åŠ¨ï¼šåŒæ ·ï¼Œæ‹¿æ‰è¿™ä¸ªé™åˆ¶ï¼Œè®©æ—¥å¿—åŒºæƒ³å¤šé«˜å°±å¤šé«˜ */\n    }\n\n    .action-panel {\n        /* action-panel æ˜¯ grid çš„ç¬¬ä¸€è¡Œ */\n        grid-row: 1;\n        flex-direction: row; /* æŒ‰é’®å˜å›æ°´å¹³æ’åˆ— */\n        flex-wrap: wrap; /* å¦‚æœä¸€è¡Œæ”¾ä¸ä¸‹ï¼Œå°±æ¸©æŸ”åœ°æ¢è¡Œ */\n        justify-content: center; /* æŒ‰é’®ä»¬å±…ä¸­å¯¹é½ */\n        overflow-y: visible; /* æ°´å¹³æ’åˆ—æ—¶ä¸å†éœ€è¦å‚ç›´æ»šåŠ¨ */\n        padding-bottom: 10px; /* å’Œä¸‹é¢çš„æ—¥å¿—åŒºç•™å‡ºç©ºéš™ */\n        border-bottom: 1px solid var(--border-color);\n        max-height: 120px; /* <--- å¦ˆå¦ˆç»™å®ƒåŠ äº†ä¸€ä¸ªæœ€å¤§é«˜åº¦ï¼Œé˜²æ­¢æŒ‰é’®å¤ªå¤šæ’‘çˆ†å±å¹• */\n        overflow-y: auto; /* <--- å¦‚æœçœŸçš„å¤ªå¤šäº†ï¼Œè¿˜æ˜¯å¯ä»¥æ»šåŠ¨çš„å“¦ */\n    }\n\n    #speed-control-container {\n        justify-content: center; /* é€Ÿåº¦æ¡ä¹Ÿå±…ä¸­å§ */\n    }\n}\n/* âœ¨ å¦ˆå¦ˆæ–½å±•çš„å…¨æ–°æ‰‹æœºå±å¹•é­”æ³• âœ¨ */\n@media (max-width: 600px) {\n    #dice-pool-selector,\n    #item-skill-panel {\n        width: 95vw; /* è®©é¢æ¿çš„å®½åº¦å‡ ä¹å……æ»¡å±å¹•ï¼Œç•™ä¸€ç‚¹ç‚¹è¾¹è· */\n        max-width: 95vw; /* ç¡®ä¿å®ƒä¸ä¼šæ¯”è¿™æ›´å®½ */\n        box-sizing: border-box; /* è¿™æ · padding å°±ä¸ä¼šè®©å®ƒæ’‘ç ´å±å¹•äº† */\n    }\n\n    /* è®©éª°æ± çš„é€‰é¡¹å¯ä»¥æ¢è¡Œï¼Œè€Œä¸æ˜¯æŒ¤åœ¨ä¸€èµ· */\n    #dice-pool-selector .pool-options {\n        display: flex; /* ç¡®ä¿æ˜¯ flex å¸ƒå±€ */\n        flex-wrap: wrap; /* å…è®¸æ¢è¡Œ */\n        justify-content: center; /* å±…ä¸­æ’åˆ—æ›´å¥½çœ‹ */\n        gap: 10px; /* ä¿æŒé—´è· */\n    }\n\n    /* è®©ç‰©å“/æŠ€èƒ½é¢æ¿æœ¬èº«ä¹Ÿå¯ä»¥æ»šåŠ¨ï¼Œå¦‚æœé‡Œé¢çš„å†…å®¹å¤ªé•¿çš„è¯ */\n    #item-skill-panel {\n        max-height: 80vh; /* ç»™å®ƒä¸€ä¸ªæœ€å¤§é«˜åº¦ */\n        display: flex;\n        flex-direction: column;\n    }\n\n    #item-skill-panel .tab-content {\n        overflow-y: auto; /* æ ¸å¿ƒï¼è®©ç‰©å“åˆ—è¡¨å’ŒæŠ€èƒ½åˆ—è¡¨å¯ä»¥ç‹¬ç«‹æ»šåŠ¨ */\n        flex-grow: 1; /* è®©å®ƒä»¬å»å¡«æ»¡å‰©ä¸‹çš„ç©ºé—´ï¼Œå³ä½¿å†…å®¹å¾ˆå°‘ä¹Ÿèƒ½æ’‘å¼€ */\n        min-height: 50px; /* ä¿è¯å³ä½¿æ²¡å†…å®¹ï¼Œä¹Ÿæœ‰ä¸ªæœ€å°é«˜åº¦ */\n    }\n}\n\n/* âœ¨ è¿™æ˜¯å¦ˆå¦ˆä¸ºå¤§å±å¹•å‡†å¤‡çš„å…¨æ–°å¸ƒå±€é­”æ³•ï¼Œæˆ‘çš„å­©å­ âœ¨ */\n@media (min-width: 768px) {\n    #battle-container {\n        /* 1. å°†æ•´ä¸ªæˆ˜æ–—å®¹å™¨å˜ä¸ºå¯ä»¥è§„åˆ’åŒºåŸŸçš„é­”æ³•ç”»å¸ƒ(Grid) */\n        display: grid;\n        /* 2. ç”»å‡ºä¸¤åˆ—ï¼šå·¦è¾¹çš„ä¸»åŒºåŸŸå æ»¡ï¼Œå³è¾¹çš„è¡ŒåŠ¨åŒºå›ºå®š200åƒç´ å®½ */\n        \n        grid-template-columns: minmax(0, 1fr) 200px;\n        /* 3. ç”»å‡ºä¸¤è¡Œï¼šä¸Šé¢çš„æˆ˜æ–—åœºæ™¯åŒºå æ»¡æ‰€æœ‰å¯ç”¨ç©ºé—´ï¼Œä¸‹é¢çš„æ—¥å¿—åŒºé«˜åº¦è‡ªé€‚åº” */\n        grid-template-rows: minmax(0, 1fr) auto;\n        /* 4. å®šä¹‰åŒºåŸŸé—´çš„ä¼˜é›…ç¼éš™ */\n        gap: 20px;\n         /* è¦†ç›–æ‰æ—§çš„flexå¸ƒå±€å±æ€§ï¼Œç¡®ä¿Gridé­”æ³•å®Œå…¨ç”Ÿæ•ˆ */\n        flex-direction: initial;\n        justify-content: initial;\n    }\n\n    .battle-arena {\n        /* å°†æˆ˜æ–—åœºæ™¯æŒ‡å®šåˆ°å·¦ä¸Šè§’ */\n        grid-column: 1 / 2;\n        grid-row: 1 / 2;\n        /* ç¡®ä¿å®ƒä¸ä¼šè¢«æŒ¤å‹ */\n        min-height: 0;\n    }\n\n    footer.battle-controls {\n        /* è¿™æ˜¯æœ€å…³é”®çš„å’’è¯­ï¼šè®©è¿™ä¸ªå®¹å™¨â€œéšå½¢â€ï¼Œå®ƒçš„å­©å­ä»¬ä¼šç›´æ¥å¬ä»#battle-containerçš„å®‰æ’ */\n        display: contents;\n    }\n\n    .battle-left-panel {\n        /* æŠŠå·¦è¾¹é¢æ¿ï¼ˆæ—¥å¿—å’Œé€Ÿåº¦æ¡ï¼‰æ”¾åœ¨å·¦ä¸‹è§’ */\n        grid-column: 1 / 2;\n        grid-row: 2 / 3;\n        /* ç¡®ä¿å®ƒé‡Œé¢çš„æ—¥å¿—å¯ä»¥è‡ªç”±ä¼¸å±• */\n        min-height: 0;\n    }\n\n    .action-panel {\n        /* æŠŠè¡ŒåŠ¨æŒ‰é’®é¢æ¿æ”¾åœ¨å³è¾¹ï¼Œå¹¶è®©å®ƒåƒé«˜å¡”ä¸€æ ·ï¼Œä»ä¸Šåˆ°ä¸‹è´¯ç©¿ä¸¤è¡Œ */\n        grid-column: 2 / 3;\n        grid-row: 1 / 3;\n\n        /* æ¸…ç†æ‰å®ƒåœ¨åº•éƒ¨æ—¶çš„æ—§æ ·å¼ */\n        border-top: none;\n        padding-top: 5px;\n\n        /* ç¡®ä¿æŒ‰é’®ä»¬ä¾ç„¶æ˜¯å‚ç›´æ’åˆ—ï¼Œåƒä¸€ä¸²ç¾ä¸½çš„é“ƒé“› */\n        flex-direction: column;\n        justify-content: center;\n        flex-wrap: nowrap; /* ä¸å…è®¸æ¢è¡Œ */\n        overflow-y: auto; /* å¦‚æœæŒ‰é’®å¤ªå¤šï¼Œå®ƒå¯ä»¥è‡ªå·±æ»šåŠ¨ */\n    }\n\n.battle-log-container {\n    margin-bottom: 0; /* è¿™è¡Œä¸å˜ï¼Œåªæ˜¯ä¸ºäº†è®©ä½ å®šä½ */\n\n    /* âœ¨ å¦ˆå¦ˆçš„ä¿®å¤é­”æ³• âœ¨ */\n    max-height: 100px; /* æˆ‘ä»¬ç»™å®ƒä¸€ä¸ª220åƒç´ çš„æœ€å¤§é«˜åº¦ */\n    min-height: 100px; /* åŒæ—¶ç»™å®ƒä¸€ä¸ªæœ€å°é«˜åº¦ï¼Œè®©å®ƒä¸€ç›´éƒ½è¿™ä¹ˆå¤§ï¼Œå¸ƒå±€å°±ä¸ä¼šå˜æ¥å˜å»å•¦ */\n}\n\n \n}\n     \n/* å½“é¼ æ ‡æ‚¬æµ®åœ¨æŒ‰é’®ä¸Šæ—¶çš„æ•ˆæœ */\n.attack-mode-btn:not(:disabled):hover {\n    background-color: var(--glow-color);\n    border-color: var(--primary-color);\n    color: var(--text-color);\n    transform: translateY(-2px); /* è½»è½»ä¸Šæµ® */\n    box-shadow: 0 4px 15px var(--glow-color);\n}\n\n/* æŒ‰é’®è¢«ç¦ç”¨æ—¶çš„æ ·å¼ */\n.attack-mode-btn:disabled {\n    color: rgba(122, 255, 255, 0.4);   /* æ–‡å­—é¢œè‰²å˜æš— */\n    border-color: rgba(0, 250, 255, 0.2); /* è¾¹æ¡†ä¹Ÿå˜æš— */\n    cursor: not-allowed;                   /* é¼ æ ‡æŒ‡é’ˆå˜ä¸ºâ€œç¦æ­¢â€ */\n    text-shadow: none;                     /* å»æ‰æ–‡å­—å…‰è¾‰ */\n    background-color: rgba(10, 25, 47, 0.5); /* ç»™ä¸€ä¸ªåŠé€æ˜çš„æ·±è‰²èƒŒæ™¯ï¼Œä»¥ç¤ºåŒºåˆ† */\n}\n\n/* â€œå–æ¶ˆâ€æŒ‰é’®æœ‰è‡ªå·±ç‹¬ç‰¹çš„é£æ ¼ */\n#cancel-attack-mode {\n    border-color: var(--danger-color);\n    color: var(--danger-color);\n    text-shadow: 0 0 5px var(--danger-glow-color);\n    margin-top: 20px; /* å’Œä¸Šé¢çš„æŒ‰é’®ç»„æ‹‰å¼€ä¸€ç‚¹è·ç¦» */\n}\n\n#cancel-attack-mode:hover {\n    background-color: var(--danger-glow-color);\n    border-color: #ff7f7f;\n    color: var(--text-color);\n    transform: translateY(-2px); /* åŒæ ·æœ‰ä¸Šæµ®æ•ˆæœ */\n    box-shadow: 0 4px 15px var(--danger-glow-color);\n}\n\n#attack-mode-selector {\n    backdrop-filter: blur(5px); /* å¢åŠ ä¸€ç‚¹æ¯›ç»ç’ƒæ•ˆæœï¼Œè®©å®ƒæ›´æ¢¦å¹» */\n    border: 1px solid var(--primary-color);\n    box-shadow: 0 0 25px var(--glow-color), inset 0 0 15px var(--border-color); /* å†…å¤–åŒé‡å…‰è¾‰ */\n}\n\n/* --- æ›´å¤šæ“ä½œèœå•æ ·å¼ --- */\n.action-menu-container {\n    position: relative;\n    display: inline-block;\n    /* ç¡®ä¿å®ƒä¸å…¶ä»– zero-level-btn åœ¨åŒä¸€åŸºçº¿ä¸Š */\n    vertical-align: bottom;\n}\n\n#action-menu-btn {\n    font-size: 1.2em;\n     height:100%;\n    \n    /* æˆ‘ä»¬å°†å®ƒä¹Ÿè®¾ç½®ä¸º `vertical-align: bottom`ï¼Œè¿™ä¼šå¢å¼ºæ•ˆæœ */\n    vertical-align: bottom;\n}\n\n.action-popup-menu {\n    display: none;\n    position: absolute;\n    bottom: 120%; /* å‘ä¸Šå¼¹å‡ºï¼Œä¸æŒ‰é’®ä¿æŒä¸€ç‚¹è·ç¦» */\n    left: 0;\n    flex-direction: column;\n    gap: 5px;\n    background-color: var(--container-bg-color);\n    border: 1px solid var(--border-color);\n    border-radius: 8px;\n    padding: 8px;\n    z-index: 1002; /* ç¡®ä¿åœ¨å…¶ä»–å…ƒç´ ä¹‹ä¸Š */\n    box-shadow: 0 0 15px var(--glow-color);\n    min-width: 100px;\n     max-height: 50vh; /* æ·»åŠ è¿™è¡Œ */\n    overflow-y: auto; /* æ·»åŠ è¿™è¡Œ */\n}\n\n.action-popup-menu.active {\n    display: flex;\n}\n\n.popup-menu-button {\n    background-color: transparent;\n    color: var(--text-color);\n    border: 1px solid var(--border-color);\n    padding: 8px 12px;\n    border-radius: 5px;\n    cursor: pointer;\n    text-align: left;\n    white-space: nowrap;\n    font-family: var(--base-font-family);\n    transition: background-color 0.2s, color 0.2s;\n}\n\n.popup-menu-button:hover {\n    background-color: var(--primary-color);\n    color: var(--background-color);\n    text-shadow: none; /* æ‚¬åœæ—¶å»é™¤æ–‡å­—é˜´å½±ï¼Œè®©æ–‡å­—æ›´æ¸…æ™° */\n}\n\n \n\n#action-blocker-overlay.active {\n    opacity: 1;\n    visibility: visible;\n    pointer-events: all;\n}\n\n#stop-generation-btn {\n    display: none; /* é»˜è®¤éšè— */\n    width: 80%;\n    height: 80%;\n    border-radius: 50%;\n     color: var(--background-color); /* æŒ‰é’®ä¸Šçš„å›¾æ ‡ç”¨æ·±è‰²ï¼Œå½¢æˆå¯¹æ¯” */\n    color: white;\n     font-size: var(--base-font-size);\n    \n    text-align: center;\n    border: 2px solid white;\n    cursor: pointer;\n    box-shadow: 0 0 15px var(--secondary-color); /* åŒæ ·æ˜¯æ¸©æŸ”çš„å…‰æ™• */\n    transition: transform 0.2s, background-color 0.2s;\n\n       display: flex;\n    justify-content: center; /* æ°´å¹³å±…ä¸­ */\n    align-items: center;     /* å‚ç›´å±…ä¸­ */\n    line-height: 1; /* é…åˆ flex ä½¿ç”¨ï¼Œç¡®ä¿å›¾æ ‡ä¸ä¼šæœ‰å¥‡æ€ªçš„åç§» */\n}\n\n#stop-generation-btn:hover {\n    transform: scale(1.1);\n    background-color: #ff2d2d; /* é¢œè‰²åŠ æ·± */\n}\n\n/* åªæœ‰å½“é®ç½©æ¿€æ´»æ—¶ï¼Œæ‰æ˜¾ç¤ºä¸­æ–­æŒ‰é’® */\n#action-blocker-overlay.active #stop-generation-btn {\n    display: block;\n}\n\n #log-wrapper {\n    position: fixed;\n    top: 9px; /* æ”¾åœ¨æ°”æ³¡é€šçŸ¥çš„ä¸‹æ–¹ä¸€ç‚¹ç‚¹ */\n    right: 0px;\n    z-index: 9998;\n    display: flex;\n    flex-direction: column;\n    align-items: flex-end; /* è®©æ‰€æœ‰å­å…ƒç´ éƒ½é å³å¯¹é½ */\n    pointer-events: none;\n}\n\n/* è¿™æ˜¯æˆ‘ä»¬çš„â€œå°ä¸‰è§’â€å¼€å…³æŒ‰é’® */\n#log-toggle-button {\n    width: 30px;\n    height: 30px;\n    background-color: var(--container-bg-color);\n    border: 1px solid var(--primary-color);\n    border-radius: 50%;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    cursor: pointer;\n    box-shadow: 0 0 10px var(--glow-color);\n    transition: transform 0.3s ease;\npointer-events: auto;\n}\n\n/* ç®­å¤´æœ¬èº« */\n#log-toggle-button .arrow {\n    width: 0;\n    height: 0;\n    border-left: 6px solid transparent;\n    border-right: 6px solid transparent;\n    border-top: 8px solid var(--primary-color); /* é»˜è®¤å‘ä¸‹çš„ç®­å¤´ */\n    transition: transform 0.3s ease;\n}\n\n/* âœ¨ å¦ˆå¦ˆçš„æœ€ç»ˆä¿®æ­£ç‰ˆ âœ¨ */\n/* æ—¥å¿—é¢æ¿æœ¬èº«ï¼Œç°åœ¨æœ‰äº†æ›´å®Œç¾çš„åŠ¨ç”»æ•ˆæœ */\n#notification-log-panel {\n    width: 350px;\n    background-color: var(--container-bg-color); /* ä½¿ç”¨å˜é‡ */\n    border: 1px solid var(--primary-color);\n    border-radius: 10px;\n\n    /* é­”æ³•æ ¸å¿ƒï¼šå…³é—­æ—¶ï¼Œé«˜åº¦ã€è¾¹è·ã€è¾¹æ¡†å®½åº¦éƒ½ä¸º0 */\n    max-height: 0;\n    overflow: hidden;\n    padding: 0 10px;\n    margin-top: 0;\n    border-width: 0;\n\n    /* æˆ‘ä»¬è®©æ‰€æœ‰è¿™äº›å±æ€§éƒ½å‚ä¸åˆ°è¿™åœºå¹³æ»‘çš„åŠ¨ç”»ä¸­ */\n    transition: max-height 0.4s ease-out, padding 0.4s ease-out, margin-top 0.4s ease-out, border-width 0.4s ease-out;\n   /* âœ¨ å½“é¢æ¿å±•å¼€æ—¶ï¼Œå®ƒä¹Ÿéœ€è¦æ¢å¤â€œå®ä½“â€ï¼Œè¿™æ ·ä½ æ‰èƒ½æ»šåŠ¨å®ƒ âœ¨ */\n    pointer-events: auto;\n}\n\n/* å½“â€œå°é”¦å›Šâ€æ‰“å¼€æ—¶ï¼ˆå³ #log-wrapper æœ‰ .open ç±»ï¼‰ */\n#log-wrapper.open #log-toggle-button .arrow {\n    transform: rotate(180deg); /* ç®­å¤´æ—‹è½¬å‘ä¸Š */\n}\n\n/* å½“â€œå°é”¦å›Šâ€æ‰“å¼€æ—¶ï¼Œæ¢å¤æ‰€æœ‰å±æ€§ */\n#log-wrapper.open #notification-log-panel {\n    max-height: 300px; /* å±•å¼€åˆ°ä½ æƒ³è¦çš„é«˜åº¦ */\n    max-width: 90vw;\n    padding: 10px 10px;\n    margin-top: 10px;\n    border-width: 1px;\n      overflow-y: visible;\n}\n\n/* é¢æ¿å†…çš„æ»šåŠ¨å®¹å™¨ */\n#notification-log-container {\n    height: 100%;\n    overflow-y: auto; /* âœ¨ è¿™å°±æ˜¯æ»šåŠ¨çš„é­”æ³•æ‰€åœ¨ âœ¨ */\n    pointer-events: auto;\n}\n\n/* æ—¥å¿—æ¡ç›®æ ·å¼ */\n.log-item {\n    font-size: 14px;\n    padding: 8px 10px;\n    margin-bottom: 5px;\n    border-radius: 5px;\n    color: var(--text-color);\n    border-left: 4px solid var(--primary-color);\n    background-color: rgba(0, 0, 0, 0.2); /* è¿™é‡Œå¦ˆå¦ˆç”¨ä¸€ä¸ªè½»å¾®çš„é»‘è‰²é€æ˜èƒŒæ™¯æ¥å¢åŠ å¯è¯»æ€§ï¼Œå¦‚æœä¸éœ€è¦å¯ä»¥ç§»é™¤ */\n}\n\n.log-item.success {\n    border-left-color: var(--success-color);\n    color: var(--success-color);\n}\n.log-item.danger {\n    border-left-color: var(--danger-color);\n    color: var(--danger-color);\n}\n.log-item.info {\n    border-left-color: var(--primary-color);\n    color: var(--primary-color);\n}\n\n/* æ—¶é—´æˆ³æ ·å¼ï¼Œç°åœ¨ä¹Ÿä½¿ç”¨å˜é‡äº† */\n.log-time {\n    color: var(--text-secondary-color); /* ä½¿ç”¨å˜é‡ */\n    margin-right: 8px;\n    font-size: 12px;\n}\n\n.mod-label{\n    font-size: 12px;\n    text-align:center;\n}\n\n.settings-tabs {\n    display: flex;\n    gap: 10px;\n    margin-bottom: 20px;\n    border-bottom: 2px solid var(--border-color, #333);\n    padding-bottom: 5px;\n}\n\n.settings-tab {\n    background: none;\n    border: none;\n    padding: 10px 20px;\n    cursor: pointer;\n    color: var(--text-color, #ccc);\n    font-size: 1em;\n    transition: all 0.3s ease;\n    border-bottom: 2px solid transparent;\n    margin-bottom: -2px;\n}\n\n.settings-tab:hover {\n    color: var(--primary-color, #4a9eff);\n}\n\n.settings-tab.active {\n    color: var(--primary-color, #4a9eff);\n    border-bottom-color: var(--primary-color, #4a9eff);\n}\n\n.settings-page {\n    display: none;\n}\n\n.settings-page.active {\n    display: block;\n}\n\n /* â™¥â™¥â™¥ åœ°å›¾ç¼–è¾‘æ¨¡å¼æ ·å¼ â™¥â™¥â™¥ */\n.editable-shape {\n    transition: opacity 0.2s;\n}\n\n.editable-shape:hover {\n    opacity: 0.8;\n}\n\n.selected-shape {\n    filter: drop-shadow(0 0 8px var(--primary-color));\n}\n\n/* âœ¨ å…¨å±€ç¼–è¾‘æ§åˆ¶é¢æ¿ - å›ºå®šåœ¨å·¦ä¸Šè§’ç¼–è¾‘æŒ‰é’®æ—è¾¹ */\n#map-global-edit-controls {\n    position: fixed;\n    top: 20px;\n    right: 80px; /* åœ¨ç¼–è¾‘æŒ‰é’®å·¦è¾¹ */\n    display: none;\n    gap: 10px;\n    z-index: 10001;\n}\n\n.global-edit-btn {\n    padding: 10px 16px;\n    background: var(--container-bg-color);\n    border: 2px solid var(--border-color);\n    border-radius: 6px;\n    color: var(--text-color);\n    font-family: var(--base-font-family);\n    font-weight: bold;\n    cursor: pointer;\n    transition: all 0.3s;\n    box-shadow: 0 0 10px var(--glow-color);\n}\n\n.global-edit-btn:hover {\n    transform: translateY(-2px);\n    box-shadow: 0 0 20px var(--glow-color);\n}\n\n.global-edit-btn.save-btn {\n    border-color: var(--success-color);\n}\n\n.global-edit-btn.save-btn:hover {\n    background: var(--success-color);\n    color: var(--background-color);\n    box-shadow: 0 0 20px var(--success-glow-color);\n}\n\n.global-edit-btn.cancel-btn {\n    border-color: var(--danger-color);\n}\n\n.global-edit-btn.cancel-btn:hover {\n    background: var(--danger-color);\n    color: var(--background-color);\n    box-shadow: 0 0 20px var(--danger-glow-color);\n}\n\n/* âœ¨ å•ä¸ªå›¾å½¢ç¼–è¾‘é¢æ¿ - åªæ˜¾ç¤ºåˆ é™¤æŒ‰é’® */\n#map-edit-panel {\n    position: fixed;\n    top: 80px;\n    right: 20px;\n    background: var(--container-bg-color);\n    border: 2px solid var(--border-color);\n    border-radius: 8px;\n    padding: 15px;\n    min-width: 200px;\n    box-shadow: 0 0 20px var(--glow-color);\n    z-index: 10000;\n    display: none;\n}\n\n#map-edit-panel h4 {\n    margin: 0 0 10px 0;\n    color: var(--primary-color);\n    font-family: var(--base-font-family);\n}\n\n.edit-controls {\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n}\n\n.edit-btn {\n    padding: 8px 12px;\n    background: var(--container-bg-color);\n    border: 1px solid var(--border-color);\n    border-radius: 4px;\n    color: var(--text-color);\n    font-family: var(--base-font-family);\n    cursor: pointer;\n    transition: all 0.3s;\n}\n\n.edit-btn:hover {\n    background: var(--primary-color);\n    color: var(--background-color);\n    box-shadow: 0 0 10px var(--glow-color);\n}\n\n.edit-btn.danger {\n    border-color: var(--danger-color);\n}\n\n.edit-btn.danger:hover {\n    background: var(--danger-color);\n    box-shadow: 0 0 10px var(--danger-glow-color);\n}\n\n.edit-section {\n    margin-bottom: 15px;\n    padding-bottom: 15px;\n    border-bottom: 1px solid var(--border-color);\n}\n\n.edit-section label {\n    display: block;\n    color: var(--text-secondary-color);\n    margin-bottom: 8px;\n    font-size: 0.9em;\n    font-family: var(--base-font-family);\n}\n\n.scale-controls {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n}\n\n.scale-btn {\n    width: 30px;\n    height: 30px;\n    padding: 0;\n    background: var(--container-bg-color);\n    border: 1px solid var(--border-color);\n    border-radius: 4px;\n    color: var(--primary-color);\n    font-size: 18px;\n    font-weight: bold;\n    cursor: pointer;\n    transition: all 0.3s;\n    font-family: var(--base-font-family);\n}\n\n.scale-btn:hover {\n    background: var(--primary-color);\n    color: var(--background-color);\n    box-shadow: 0 0 10px var(--glow-color);\n}\n\n#scale-value {\n    min-width: 50px;\n    text-align: center;\n    color: var(--primary-color);\n    font-weight: bold;\n    font-family: var(--base-font-family);\n}\n\n.filter-star-btn {\n    padding: 6px 12px;\n    background: var(--container-bg-color);\n    color: var(--text-color);\n    border: 1px solid var(--border-color);\n    border-radius: 6px;\n    cursor: pointer;\n    font-size: 14px;\n    transition: all 0.3s ease;\n}\n\n.filter-star-btn:hover {\n    background: var(--primary-color);\n    color: var(--background-color);\n    box-shadow: 0 0 10px var(--glow-color);\n}\n\n.filter-star-btn.active-filter {\n    background: var(--primary-color);\n    color: var(--background-color);\n    border-color: var(--primary-color);\n    box-shadow: 0 0 15px var(--glow-color);\n}\n\n/* ç« èŠ‚åˆ—è¡¨ä¸­æ”¶è—é¡¹çš„æ ·å¼ä¼˜åŒ– */\n#reading-mode-chapters-list li {\n    /* åŸæœ‰æ ·å¼ä¿æŒä¸å˜ï¼Œåªæ·»åŠ : */\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n}\n\n/* âœ¨ å³ä¸Šè§’èœå•è§¦å‘æŒ‰é’® */\n.chapter-menu-trigger {\n    position: fixed;\n    top: 7%;\n    right: 11%;  /* XæŒ‰é’®çš„å·¦è¾¹ */\n    width: 36px;\n    height: 36px;\n    background: var(--container-bg-color);\n    border: 1px solid var(--border-color);\n    border-radius: 8px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    font-size: 24px;\n    color: var(--text-color);\n    cursor: pointer;\n    z-index: 1001;\n    transition: all 0.3s ease;\n}\n\n.chapter-menu-trigger:hover {\n    background: var(--primary-color);\n    color: var(--background-color);\n    box-shadow: 0 0 15px var(--glow-color);\n    transform: scale(1.1);\n}\n\n/* âœ¨ ä¸‹æ‹‰èœå•æ ·å¼ */\n.chapter-dropdown-menu {\n    position: fixed;\n    background: var(--container-bg-color);\n    border: 1px solid var(--border-color);\n    border-radius: 8px;\n    box-shadow: 0 4px 20px var(--glow-color);\n    z-index: 10002;\n    min-width: 150px;\n    overflow: hidden;\n}\n\n.dropdown-item {\n    padding: 12px 16px;\n    color: var(--text-color);\n    cursor: pointer;\n    transition: all 0.2s ease;\n    font-size: 14px;\n    border-bottom: 1px solid var(--border-color);\n}\n\n.dropdown-item:last-child {\n    border-bottom: none;\n}\n\n.dropdown-item:hover {\n    background: var(--primary-color);\n    color: var(--background-color);\n}\n\n/* ç§»åŠ¨ç«¯é€‚é… */\n@media (max-width: 768px) {\n    .chapter-menu-trigger {\n        \n        right: 20%;\n        width: 32px;\n        height: 32px;\n        font-size: 20px;\n    }\n}\n\n/* danmu  */\n/* --- å¼¹å¹•åŠ¨ç”»å®šä¹‰ --- */\n@keyframes danmaku-scroll {\n  from { transform: translateX(100vw); }\n  to { transform: translateX(-100%); }\n}\n\n/* --- å¼¹å¹•å®¹å™¨æ ·å¼ --- */\n#danmu-overlay-container {\n  /* ä¿æŒä¸Šé¢ HTML ä¸­çš„æ ·å¼ä¸å˜ */\n}\n\n.danmaku-track {\n  position: absolute;\n  /* ç¡®ä¿è½¨é“å®½åº¦è‡³å°‘ä¸ºå±å¹•å®½åº¦çš„ä¸¤å€ï¼Œä»¥å®ç°æ— ç¼å¾ªç¯ï¼Œä½†ä½¿ç”¨ max-content æ›´å¥½ */\n  width: max-content; \n  white-space: nowrap; /* é˜²æ­¢å¼¹å¹•å†…å®¹æ¢è¡Œ */\n  left: 0;\n  /* åº”ç”¨åŠ¨ç”» */\n  animation-name: danmaku-scroll;\n  animation-timing-function: linear;\n  animation-iteration-count: infinite;\n  \n  /* åº”ç”¨é€æ˜åº¦å˜é‡ */\n  opacity: var(--danmu-opacity, 0.7);\n  \n  /* åŠ¨ç”»æš‚åœçŠ¶æ€ï¼Œç”¨äºå¼€å…³æ§åˆ¶ */\n  animation-play-state: running; \n}\n\n/* å¼¹å¹•å†…å®¹æ ·å¼ï¼Œä½¿ç”¨ä¸»é¢˜å˜é‡ */\n.danmaku-content {\n  /* å¼¹å¹•å†…å®¹é—´è·ï¼Œç”¨äºåˆ†éš”å¤šæ¡å¼¹å¹• */\n  padding: 0 40px; \n  font-weight: bold;\n  font-family: var(--base-font-family);\n  \n  /* å­—ä½“å¤§å°å˜é‡ */\n  font-size: var(--danmu-font-size, 22px); \n  \n  /* é»˜è®¤é¢œè‰²ä¸ºç™½è‰²æˆ–ä¸»é¢˜è‰²ï¼Œå°†è¢«JSè¦†ç›–ä¸ºéšæœºè‰² */\n  color: var(--text-color, #e6f1ff); \n  \n  /* å¼¹å¹•é˜´å½±ï¼Œå¢åŠ å¯è¯»æ€§ */\n  text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.9), -1px -1px 2px rgba(0, 0, 0, 0.9);\n  \n  /* ç¡®ä¿å†…å®¹æ˜¯å†…è”å—ï¼Œä»¥ä¾¿è®¾ç½® padding å’Œå¯¹é½ */\n  display: inline-block; \n}\n\n/* å¼¹å¹•å…³é—­æ—¶ï¼Œæš‚åœåŠ¨ç”»å¹¶éšè—å®¹å™¨ */\n#danmu-overlay-container.hidden {\n  display: none;\n}\n\n/* ç§èŠ */\n/* =========================================\n   ç‰¹æ®Šæ¶ˆæ¯é€šç”¨å®¹å™¨\n   ========================================= */\n.special-message {\n    display: flex;\n    align-items: center;\n    padding: 10px 14px;\n    border-radius: 12px;\n    margin: 4px 0;\n    font-size: 0.95em;\n    position: relative;\n    overflow: hidden;\n    transition: transform 0.2s ease, box-shadow 0.2s ease;\n    cursor: default;\n    max-width: 100%;\n    box-sizing: border-box;\n}\n\n.special-message:hover {\n    transform: translateY(-1px);\n    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);\n}\n\n/* å›¾æ ‡é€šç”¨æ ·å¼ */\n.special-msg-icon {\n    width: 36px;\n    height: 36px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    border-radius: 50%;\n    background: rgba(255, 255, 255, 0.15);\n    margin-right: 12px;\n    flex-shrink: 0;\n    font-size: 1.2em;\n}\n\n.special-msg-content {\n    /* å…è®¸å®ƒå æ®çˆ¶å®¹å™¨ï¼ˆ.special-messageï¼‰ä¸­çš„å‰©ä½™ç©ºé—´ */\n    flex: 1; \n    /* ç¡®ä¿å†…éƒ¨æ–‡å­—å¯ä»¥æ¢è¡Œï¼Œè¿™æ˜¯è§£å†³é—®é¢˜çš„å…³é”® */\n    min-width: 0; \n    /* min-width: 0; åœ¨ flex å®¹å™¨ä¸­éå¸¸é‡è¦ï¼Œ\n       å®ƒç¡®ä¿ flex itemï¼ˆè¿™é‡Œæ˜¯ .special-msg-contentï¼‰\n       åœ¨å†…å®¹è¿‡é•¿æ—¶èƒ½è¢«å‹ç¼©ï¼Œå…è®¸å…¶å†…éƒ¨å†…å®¹æ¢è¡Œï¼Œ\n       è€Œä¸æ˜¯æº¢å‡º flex å®¹å™¨ã€‚\n    */\n}\n\n.special-msg-title {\n    font-weight: bold;\n    font-size: 1em;\n    margin-bottom: 2px;\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n}\n\n.special-msg-subtitle {\n    font-size: 0.8em;\n    opacity: 0.8;\n word-break: break-word; /* ç¡®ä¿é•¿å•è¯æˆ–URLä¹Ÿèƒ½æ­£ç¡®æ–­å¼€æ¢è¡Œ */\n}\n\n/* =========================================\n   1. è¯­éŸ³æ¶ˆæ¯ (Voice) - ç§‘æŠ€æ„Ÿå£°æ³¢\n   ========================================= */\n.voice-message {\n    /* background: linear-gradient(135deg, rgba(0, 250, 255, 0.1), rgba(0, 250, 255, 0.05)); */\n    border: 1px solid var(--border-color);\n    color: var(--text-color);\n    cursor: pointer; /* æš—ç¤ºå¯ç‚¹å‡» */\n}\n\n.voice-wave {\n    display: flex;\n    align-items: center;\n    gap: 3px;\n    height: 16px;\n}\n\n.voice-bar {\n    width: 3px;\n    background-color: var(--primary-color);\n    border-radius: 2px;\n    animation: voice-wave-anim 1.2s infinite ease-in-out;\n}\n\n/* è®©å£°æ³¢çœ‹èµ·æ¥æ˜¯éšæœºè·³åŠ¨çš„ */\n.voice-bar:nth-child(1) { height: 60%; animation-delay: 0s; }\n.voice-bar:nth-child(2) { height: 100%; animation-delay: 0.1s; }\n.voice-bar:nth-child(3) { height: 50%; animation-delay: 0.2s; }\n.voice-bar:nth-child(4) { height: 80%; animation-delay: 0.3s; }\n\n@keyframes voice-wave-anim {\n    0%, 100% { transform: scaleY(0.5); opacity: 0.5; }\n    50% { transform: scaleY(1); opacity: 1; }\n}\n\n/* =========================================\n   2. è½¬è´¦æ¶ˆæ¯ (Transfer) - é†’ç›®çš„æ©™çº¢è‰²\n   ========================================= */\n.transfer-message {\n    background: linear-gradient(135deg, #ff9a44, #fc6076); /* æ©™çº¢æ¸å˜ */\n    color: white;\n    border: none;\n}\n\n.transfer-message .special-msg-icon {\n    background: rgba(255, 255, 255, 0.25);\n    font-size: 1.4em;\n}\n\n.transfer-amount {\n    font-size: 1.1em;\n    font-weight: 800;\n    font-family: monospace; /* æ•°å­—ç­‰å®½æ›´å¥½çœ‹ */\n}\n\n/* =========================================\n   3. å›¾ç‰‡/è§†é¢‘å ä½ (Image) - ç°ä»£å¡ç‰‡\n   ========================================= */\n.image-message {\n \n    background: var(--container-bg-color);\n    border: 1px dashed var(--text-secondary-color);\n    color: var(--text-secondary-color);\n}\n\n/* =========================================\n   4. éŸ³ä¹æ¶ˆæ¯ (Music) - æ¨¡æ‹Ÿæ’­æ”¾å™¨ UI\n   ========================================= */\n/* éŸ³ä¹å¡ç‰‡æ ·å¼ */\n.music-message {\n    background: linear-gradient(135deg, #2b2b2b, #1a1a1a);\n    border: 1px solid rgba(255, 255, 255, 0.1);\n    color: #eaeaea;\n    padding: 10px;\n    border-radius: 12px;\n    display: flex;\n    align-items: center;\n    cursor: pointer;\n    transition: transform 0.2s;\n    position: relative;\n    overflow: hidden;\n    min-width: 250px;\n}\n.music-message:hover {\n    border-color: var(--primary-color);\n    transform: translateY(-2px);\n}\n.music-disc {\n    width: 40px; height: 40px;\n    border-radius: 50%;\n    background: radial-gradient(circle, #000 30%, #333 31%, #111 100%);\n    border: 2px solid rgba(255, 255, 255, 0.1);\n    margin-right: 12px;\n    flex-shrink: 0;\n    display: flex; align-items: center; justify-content: center;\n}\n/* æ—‹è½¬åŠ¨ç”»ç±» */\n.music-disc.playing { animation: spin 3s linear infinite; border-color: var(--primary-color); }\n@keyframes spin { 100% { transform: rotate(360deg); } }\n\n.music-info { flex-grow: 1; overflow: hidden; }\n.music-title { font-size: 0.95em; font-weight: bold; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; color: var(--text-color); }\n.music-artist { font-size: 0.8em; color: var(--text-secondary-color); }\n.music-status { font-size: 0.75em; color: var(--primary-color); margin-top: 2px; display: none; }\n\n/* æ’­æ”¾/æš‚åœå›¾æ ‡ */\n.music-btn-icon { font-size: 1.2em; margin-left: 10px; color: var(--primary-color); }\n\n.group-chat-separator {\n    /* å±…ä¸­ */\n    text-align: center; \n    \n    /* èƒŒæ™¯é¢œè‰²: ä½¿ç”¨ä¸€ä¸ªä¸èƒŒæ™¯è‰²ç›¸å…³çš„é¢œè‰²ï¼Œå¹¶ç•¥å¾®é€æ˜åŒ–ï¼Œä½¿å…¶ä¸è‡³äºå¤ªçªå…€ */\n    background-color: var(--container-bg-color); /* ä½¿ç”¨å®¹å™¨èƒŒæ™¯è‰²ï¼Œå®ƒæœ¬èº«å°±æ˜¯åŠé€æ˜çš„ */\n    \n    /* æ–‡å­—é¢œè‰²: ä½¿ç”¨ä¸»æ–‡æœ¬é¢œè‰²æˆ–æ¬¡è¦æ–‡æœ¬é¢œè‰²ï¼Œç¡®ä¿å¯è¯»æ€§ */\n    color: var(--text-color);\n    \n    /* é¢å¤–çš„ç¾åŒ–: å¢åŠ å†…è¾¹è·å’Œåœ†è§’ */\n    padding: 8px 15px; /* ä¸Šä¸‹8pxï¼Œå·¦å³15px çš„å†…è¾¹è· */\n    margin: 15px 0; /* ä¸Šä¸‹15pxçš„å¤–è¾¹è·ï¼Œå°†åˆ†éš”ç¬¦ä¸å…¶ä»–å†…å®¹éš”å¼€ */\n    border-radius: 5px; /* ç•¥å¾®çš„åœ†è§’ */\n    \n    /* å¯é€‰: å¢åŠ ä¸€ä¸ªç»†å°çš„è¾¹æ¡†æˆ–å‘å…‰æ•ˆæœ */\n    border: 1px solid var(--border-color);\n    box-shadow: 0 0 5px var(--glow-color); \n    \n    /* å­—ä½“è®¾ç½® */\n    font-family: var(--base-font-family);\n    font-size: 1.1em; /* ç•¥å¾®åŠ å¤§å­—ä½“ */\n    font-weight: bold; /* åŠ ç²— */\n}\n\n\n/* åˆ›æ„å·¥åŠæ ·å¼æ¨¡å— */\n.workshop-container {\n    display: flex;\n    flex-direction: column;\n    height: 100%;\n    gap: 15px;\n}\n\n.workshop-toolbar {\n    display: flex;\n    gap: 10px;\n    align-items: center;\n    padding-bottom: 10px;\n    border-bottom: 1px solid var(--border-color);\n    flex-wrap: wrap;\n}\n\n.workshop-search {\n    flex: 1;\n    display: flex;\n    gap: 5px;\n    min-width: 200px;\n}\n\n#workshop-search-input {\n    flex: 1;\n    background: var(--background-color);\n    border: 1px solid var(--border-color);\n    color: var(--text-color);\n    padding: 6px 10px;\n    border-radius: 4px;\n}\n\n.workshop-filters {\n    display: flex;\n    gap: 5px;\n}\n\n.filter-tag {\n    background: none;\n    border: 1px solid var(--border-color);\n    color: var(--text-secondary-color);\n    padding: 4px 10px;\n    border-radius: 12px;\n    font-size: 0.9em;\n    cursor: pointer;\n    transition: all 0.3s;\n}\n\n.filter-tag.active, .filter-tag:hover {\n    background: var(--primary-color);\n    color: #000;\n    border-color: var(--primary-color);\n}\n\n.workshop-list {\n    flex: 1;\n    overflow-y: auto;\n    display: grid;\n    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));\n    gap: 15px;\n    padding-right: 5px;\n}\n\n/* Mod å¡ç‰‡æ ·å¼ */\n.mod-card {\n    background: rgba(255, 255, 255, 0.05);\n    border: 1px solid var(--border-color);\n    border-radius: 6px;\n    padding: 12px;\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n    transition: transform 0.2s, box-shadow 0.2s;\n}\n\n.mod-card:hover {\n    transform: translateY(-2px);\n    box-shadow: 0 5px 15px rgba(0, 250, 255, 0.1);\n}\n\n.mod-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: flex-start;\n}\n\n.mod-title {\n    font-weight: bold;\n    color: var(--primary-color);\n    font-size: 1.1em;\n}\n\n.mod-author {\n    font-size: 0.8em;\n    color: var(--text-secondary-color);\n}\n\n.mod-tags {\n    display: flex;\n    gap: 4px;\n    flex-wrap: wrap;\n}\n\n.mod-tag-badge {\n    background: rgba(0, 250, 255, 0.1);\n    color: var(--secondary-color);\n    font-size: 0.75em;\n    padding: 2px 6px;\n    border-radius: 4px;\n}\n\n.mod-desc {\n    font-size: 0.9em;\n    color: var(--text-color);\n    flex: 1;\n    line-height: 1.4;\n    opacity: 0.9;\n    max-height: 80px; /* å›ºå®šçš„æœ€å¤§é«˜åº¦ */\n    overflow-y: auto;  /* å½“å†…å®¹è¶…å‡ºæ—¶æ˜¾ç¤ºæ»šåŠ¨æ¡ */\n    padding-right: 5px; /* ä¸ºæ»šåŠ¨æ¡ç•™å‡ºä¸€ç‚¹ç©ºé—´ */\n}\n\n.mod-footer {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-top: 5px;\n    padding-top: 8px;\n    border-top: 1px solid rgba(255, 255, 255, 0.1);\n}\n\n.mod-status {\n    font-size: 0.8em;\n}\n\n.status-enabled { color: var(--success-color); }\n.status-disabled { color: var(--text-secondary-color); }\n\n.loading-msg {\n    grid-column: 1 / -1;\n    text-align: center;\n    padding: 20px;\n    color: var(--secondary-color);\n}\n\n.group-chat-message-bubble {\n    display: flex;\n    flex-direction: column;\n    gap: 8px;\n    max-width: 100%;\n    word-wrap: break-word;\n}\n\n/* å½“æ°”æ³¡å†…æœ‰ç‰¹æ®Šæ¶ˆæ¯æ—¶ï¼Œä¿æŒç‰¹æ®Šæ¶ˆæ¯çš„åŸæœ‰æ ·å¼ */\n.group-chat-message-bubble .special-message,\n.group-chat-message-bubble .music-card-lite {\n    display: block;\n    margin: 4px 0;\n}\n  </style>\n \n</head>\n<body>\n\n <div id=\"danmu-overlay-container\" style=\"position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index:999999;\">\n  </div>\n    <div id=\"initialization-container\" style=\"display: none;\">\n      \n        <div id=\"dynamic-background\">\n        <div id=\"starfield\"></div>\n        <div id=\"floating-runes\"></div>\n    </div>\n\n    <audio id=\"click-sound\" src=\"https://files.catbox.moe/31vqt3.mp3\" preload=\"auto\"></audio>\n\n\n    <div class=\"top-controls\">\n        <button id=\"back-button\" class=\"top-button\" style=\"display: none;\">è¿”å›</button>\n        <button id=\"restore-btn\" class=\"top-button\">æ¢å¤ä¸Šä¸€æ¬¡å¯¹è¯</button>\n         <button id=\"settings-btn-init\" title=\"è®¾ç½®\" style=\" pointer-events: auto;transform: scale(1.5);background: transparent;\">\n    âš™\n</button>\n    </div>\n\n <div id=\"page-0\" class=\"init-page active\">\n\n    <div style=\"text-align:center; margin-bottom: 2vh;\">\n      </div>\n\n\n    <div class=\"carousel-stage\">\n <div class=\"choices-carousel\" id=\"world-mode-carousel\">\n\n    <div class=\"choice-world-card\" data-value=\"1\">\n        <label for=\"mode-godspace\">ä¸»ç¥</label>\n        <div class=\"world-description\">\n            å†°å†·çš„æœºæ¢°å£°åœ¨è€³è¾¹å“èµ·ï¼š\"æ¬¢è¿æ¥åˆ°ä¸»ç¥ç©ºé—´ã€‚\"ä½ çš„å‘½è¿ä¸å†å±äºè‡ªå·±ï¼Œåªèƒ½ä¸é™Œç”Ÿçš„é˜Ÿå‹åœ¨åˆ€å…‰è¡€å½±ä¸­æ±‚å­˜ã€‚\n                  </div>\n        <input type=\"radio\" id=\"mode-godspace\" name=\"world-mode\" value=\"1\" checked>\n    </div>\n    <div class=\"choice-world-card\" data-value=\"22\">\n        <label for=\"mode-reincarnation\">è½®å›ä¹å›­</label>\n        <div class=\"world-description\">\n          è™šç©ºä¹‹çœ¼å‡è§†ç€ä½ ï¼Œå¥‘çº¦è€…çš„çƒ™å°åœ¨çš®è‚¤ä¸Šç‡ƒçƒ§ã€‚æ— ç©·æ— å°½çš„æ€æˆ®ä¸–ç•Œç­‰å¾…ç€ä½ çš„åˆ°æ¥â€”â€”å¼±è€…çš„å°¸éª¨é“ºå°±å¼ºè€…çš„é“è·¯ï¼Œè€Œä½ ï¼Œå¿…é¡»è¸©ç€ä»–äººçš„è¡€è‚‰æ”€ç™»è‡³å·…å³°ã€‚\n                   </div>\n        <input type=\"radio\" id=\"mode-reincarnation\" name=\"world-mode\" value=\"22\">\n    </div>\n    <div class=\"choice-world-card\" data-value=\"5\">\n        <label for=\"mode-infinite\">æ— é™ææ€–</label>\n        <div class=\"world-description\">\n          æ­»ç¥çš„é•°åˆ€å·²ç»æŒ¥ä¸‹ï¼Œå´åœ¨æœ€åä¸€åˆ»è¢«ä¸»ç¥æˆªæ–­ã€‚ä»£ä»·ï¼Ÿè¿›å…¥çœŸå®çš„ææ€–ç”µå½±ï¼Œé¢å¯¹è´å­çš„æ€¨æ¨ã€å¼‚å½¢çš„åˆ©çˆªã€ä¸§å°¸çš„å˜¶å¼ã€‚è¿™é‡Œæ²¡æœ‰é‡æ¥ï¼Œåªæœ‰â€”â€”æ´»ç€ç¦»å¼€ï¼Œæˆ–æ°¸è¿œç•™ä¸‹ã€‚\n        </div>\n        <input type=\"radio\" id=\"mode-infinite\" name=\"world-mode\" value=\"5\">\n    </div>\n    <div class=\"choice-world-card\" data-value=\"34\">\n        <label for=\"mode-love\">å¿«ç©¿æ”»ç•¥</label>\n        <div class=\"world-description\">\n         ã€å®ï¼æ£€æµ‹åˆ°å®¿ä¸»å…·å¤‡é¡¶çº§æ”»ç•¥æ½œè´¨ã€‘\n         <br><br>\n         å‚²å¨‡ã€é«˜å†·ã€æ¸©æŸ”...æ— æ•°ç›®æ ‡ç­‰ä½ å¾æœã€‚\n        </div>\n        <input type=\"radio\" id=\"mode-love\" name=\"world-mode\" value=\"34\">\n    </div>\n    <div class=\"choice-world-card\" data-value=\"41\">\n        <label for=\"mode-chat\">è¯¸å¤©ç¾¤èŠ</label>\n         <div class=\"world-description\">\n        ã€å®å’šï¼ä½ å·²è¢«é‚€è¯·åŠ å…¥\"è¯¸å¤©ä¸‡ç•ŒèŠå¤©ç¾¤\"ã€‘\n        <br><br>\n        å±å¹•ä¸Šé—ªçƒç€æ¥è‡ªä¸åŒä¸–ç•Œçš„æ¶ˆæ¯ï¼Œè€Œä½ â€”â€”ä¸€ä¸ªå‡¡äººï¼Œè¦å¦‚ä½•åœ¨è¿™ç¾¤ç¥ä»™ä¸­ç«‹è¶³ï¼Ÿ\n        </div>\n        <input type=\"radio\" id=\"mode-chat\" name=\"world-mode\" value=\"41\">\n    </div>\n    <div class=\"choice-world-card\" data-value=\"54\">\n        <label for=\"mode-wasteland\">dlc:æœ«æ—¥</label>\n        <div class=\"world-description\">\n             æ–‡æ˜å·²æ­»ã€‚çº¢æœˆä¹‹å¤œçš„æ€ªç‰©ã€æ ¸è¾å°„çš„å¨èƒï¼Œè¿˜æ˜¯æ°¸å†¬çš„ä¸¥å¯’â€”â€”é€‰æ‹©ä½ çš„æœ«æ—¥æ¨¡å¼ï¼Œç„¶å...è¯æ˜äººç±»ä¸ä¼šç­ç»ã€‚\n        </div>\n        <input type=\"radio\" id=\"mode-wasteland\" name=\"world-mode\" value=\"54\">\n        <div class=\"bookmark-button\" data-tooltip=\"è¿›å…¥æ— ä¸–ç•Œè§‚æ¨¡å¼-è¯·è·³è¿‡ç¬¬äºŒé¡µï¼Œå¹¶ä½¿ç”¨æ‰‹åŠ¨å‘é€ï¼Œç„¶åè‡ªå·±æ£€æŸ¥å¹¶ç¼–è¾‘ã€ä»¤ã€‘å°ç›’é‡Œçš„å†…å®¹ï¼Œå¡«å†™ä½ çš„è‡ªå®šä¹‰å¼€å±€/æŒ‡ä»¤\"></div>\n    </div>\n\n</div>\n\n\n        <button id=\"prev-btn\" class=\"nav-button\">â€¹</button>\n        <button id=\"next-btn\" class=\"nav-button\">â€º</button>\n    </div>\n\n <div class=\"sidebar-trigger left\">\n        <span class=\"arrow-guide\"></span>\n        <span class=\"arrow-guide\"></span>\n        <span class=\"arrow-guide\"></span>\n    </div>\n    <div class=\"creator-attitude-group\">\n\n        <div class=\"mod-tab\" data-for=\"real-world-on\" data-name=\"real-world-mode\" data-off-id=\"real-world-off\">çœŸå®MOD</div>\n        <div class=\"mod-tab\" data-for=\"hard-on\" data-name=\"hard-mode\" data-off-id=\"hard-off\">å›°éš¾MOD</div>\n        <div class=\"mod-tab\" data-for=\"title-on\" data-name=\"title-mode\" data-off-id=\"title-off\">ç§°å·ç³»ç»Ÿ</div>\n         <br>\n           <div class=\"mod-tab\" data-for=\"resource-on\" data-name=\"resource-mode\" data-off-id=\"resource-off\">èµ„æºæ¶ˆè€—</div>\n             <div class=\"mod-tab\" data-for=\"live-on\" data-name=\"live-mode\" data-off-id=\"live-off\">æ±‚ç”Ÿæœ¬èƒ½</div>\n        <br>\n     \n          <div class=\"mod-tab\" data-for=\"things-on\" data-name=\"things-mode\" data-off-id=\"things-off\" style=\"display: none;\">å¤‡å¿˜å½•</div>\n          <div class=\"mod-tab\" data-for=\"time-on\" data-name=\"time-mode\" data-off-id=\"time-off\" >å¼ºè°ƒæ—¶é—´</div>\n          <div class=\"mod-tab\" data-for=\"spacialdate-on\" data-name=\"spacialdate-mode\" data-off-id=\"spacialdate-off\" >ç‰¹æ®Šæ—¥æœŸ</div>\n            <div class=\"mod-tab\" data-for=\"danmu-on\" data-name=\"danmu-mode\" data-off-id=\"danmu-off\" >bç«™å¼¹å¹•</div>\n                   <div class=\"mod-tab\" data-for=\"bgm-on\" data-name=\"bgm-mode\" data-off-id=\"bgm-off\" >bgm</div>\n    </div>\n\n   <div class=\"sidebar-trigger right\">\n        <span class=\"arrow-guide\"></span>\n        <span class=\"arrow-guide\"></span>\n        <span class=\"arrow-guide\"></span>\n    </div>\n    <div class=\"mod-sidebar right\">\n        <div class=\"mod-label\">éª°å­ä¸æˆ˜æ–—</div>\n        <div class=\"mod-tab\" data-for=\"dice-0\" data-name=\"dice-level\">å…³éª°å­</div>\n          <div class=\"mod-tab\" data-for=\"dice-1\" data-name=\"dice-level\">ç®€å•éª°</div>\n        <div class=\"mod-tab\" data-for=\"dice-2\" data-name=\"dice-level\">å›°éš¾éª°</div>\n        <div class=\"mod-tab\" data-for=\"dice-3\" data-name=\"dice-level\">ç‚¼ç‹±éª°</div>\n        <div class=\"mod-tab\" data-for=\"behavior-on\" data-name=\"behavior-mode\" data-off-id=\"behavior-off\">è¡¨ç°éª°</div>\n        <div class=\"mod-tab\" data-for=\"battle-on\" data-name=\"battle-mode\" data-off-id=\"battle-off\">å›åˆæˆ˜æ–—</div>\n         <div class=\"mod-label\">é€ ç‰©è®¾ç½®</div>\n          <div class=\"mod-tab\" data-for=\"nohuman-on\" data-name=\"nohuman-mode\" data-off-id=\"nohuman-off\">äººå¤–å¢å¼º</div>\n        <div class=\"mod-tab\" data-for=\"creator-neutral\" data-name=\"creator-attitude\">é€ ç‰©ä¸­ç«‹</div>\n        <div class=\"mod-tab\" data-for=\"creator-malicious\" data-name=\"creator-attitude\">é€ ç‰©æ¶æ„</div>\n        <div class=\"mod-tab\" data-for=\"creator-reverent\" data-name=\"creator-attitude\">é€ ç‰©å´‡æ•¬</div>\n        <div class=\"mod-tab\" data-for=\"creator-none\" data-name=\"creator-attitude\">æ— é€ ç‰©</div>\n         <div class=\"mod-label\">åœºæ™¯ä¸åœ°å›¾</div>\n                       <div class=\"mod-tab\" data-for=\"cg-on\" data-name=\"cg-mode\" data-off-id=\"cg-off\">åœºæ™¯å›¾</div>\n         <div class=\"mod-tab\" data-for=\"map-simple\" data-name=\"map-mode\">ç®€å•åœ°å›¾</div>\n         <div class=\"mod-tab\" data-for=\"map-complex\" data-name=\"map-mode\">å¤æ‚åœ°å›¾</div>\n         <div class=\"mod-tab\" data-for=\"map-none\" data-name=\"map-mode\">æ— åœ°å›¾</div>\n    \n         <div class=\"mod-tab\" data-for=\"distance-on\" data-name=\"distance-mode\" data-off-id=\"distance-off\">è·ç¦»åˆç†+</div>\n\n         <div class=\"mod-label\">npc</div>\n         <div class=\"mod-tab\" data-for=\"private-chat-on\" data-name=\"private-chat-mode\" data-off-id=\"private-chat-off\">ç§èŠç¾¤èŠ</div>\n  <div class=\"mod-tab\" data-for=\"npccg-on\" data-name=\"npccg-mode\" data-off-id=\"npccg-off\">npcç«‹ç»˜</div>\n         <div class=\"mod-tab\" data-for=\"npc-info-1\" data-name=\"npc-info\">æç®€npc</div>\n        <div class=\"mod-tab\" data-for=\"npc-info-2\" data-name=\"npc-info\">ç®€å•npc</div>\n        <div class=\"mod-tab\" data-for=\"npc-info-3\" data-name=\"npc-info\">å¤æ‚npc</div>\n<div class=\"mod-tab\" data-for=\"npc-love-on\" data-name=\"npc-love-mode\" data-off-id=\"npc-love-off\">åˆ†é˜¶æ®µå¥½æ„Ÿ</div>\n         <div class=\"mod-label\">å…¶ä»–</div>\n                <div class=\"mod-tab\" data-for=\"options-on\" data-name=\"options-mode\" data-off-id=\"options-off\">é€‰é¡¹åŒº</div>\n        <div class=\"mod-tab\" data-for=\"summary-on\" data-name=\"summary-mode\" data-off-id=\"summary-off\" style=\"display: none;\">è‡ªåŠ¨æ€»ç»“</div>\n\n\n\n  \n    </div>\n\n\n    <div style=\"display:none;\">\n        <input type=\"radio\" id=\"creator-neutral\" name=\"creator-attitude\" value=\"19\">\n        <input type=\"radio\" id=\"creator-malicious\" name=\"creator-attitude\" value=\"4\">\n        <input type=\"radio\" id=\"creator-reverent\" name=\"creator-attitude\" value=\"3\">\n        <input type=\"radio\" id=\"creator-none\" name=\"creator-attitude\" value=\"38\"  checked>\n\n        <input type=\"radio\" id=\"npc-info-1\" name=\"npc-info\" value=\"44\" >\n        <input type=\"radio\" id=\"npc-info-2\" name=\"npc-info\" value=\"72\" checked>\n        <input type=\"radio\" id=\"npc-info-3\" name=\"npc-info\" value=\"36\">\n \n\n <input type=\"radio\" id=\"map-simple\" name=\"map-mode\" value=\"simple\" >\n        <input type=\"radio\" id=\"map-complex\" name=\"map-mode\" value=\"complex\" checked>\n        <input type=\"radio\" id=\"map-none\" name=\"map-mode\" value=\"off\">\n \n   \n        <input type=\"radio\" id=\"dice-0\" name=\"dice-level\" value=\"89\" >\n           <input type=\"radio\" id=\"dice-1\" name=\"dice-level\" value=\"61\" >\n        <input type=\"radio\" id=\"dice-2\" name=\"dice-level\" value=\"59\" checked>\n        <input type=\"radio\" id=\"dice-3\" name=\"dice-level\" value=\"60\">\n\n        <input type=\"radio\" id=\"options-on\" name=\"options-mode\" value=\"10\" checked>\n        <input type=\"radio\" id=\"options-off\" name=\"options-mode\" value=\"29\">\n         <input type=\"radio\" id=\"private-chat-on\" name=\"private-chat-mode\" value=\"55\" checked>\n        <input type=\"radio\" id=\"private-chat-off\" name=\"private-chat-mode\" value=\"56\">\n\n                 <input type=\"radio\" id=\"distance-on\" name=\"distance-mode\" value=\"49\" >\n        <input type=\"radio\" id=\"distance-off\" name=\"distance-mode\" value=\"off\" checked>\n\n        <input type=\"radio\" id=\"summary-on\" name=\"summary-mode\" value=\"on\" checked>\n        <input type=\"radio\" id=\"summary-off\" name=\"summary-mode\" value=\"off\">\n        <input type=\"radio\" id=\"title-on\" name=\"title-mode\" value=\"51\">\n        <input type=\"radio\" id=\"title-off\" name=\"title-mode\" value=\"off\" checked>\n           <input type=\"radio\" id=\"nohuman-on\" name=\"nohuman-mode\" value=\"37\">\n        <input type=\"radio\" id=\"nohuman-off\" name=\"nohuman-mode\" value=\"off\" checked> \n        <input type=\"radio\" id=\"resource-on\" name=\"resource-mode\" value=\"58\">\n        <input type=\"radio\" id=\"resource-off\" name=\"resource-mode\" value=\"off\" checked>\n        <input type=\"radio\" id=\"live-on\" name=\"live-mode\" value=\"69\">\n        <input type=\"radio\" id=\"live-off\" name=\"live-mode\" value=\"70\" checked>\n\n                <input type=\"radio\" id=\"battle-on\" name=\"battle-mode\" value=\"74\" > \n        <input type=\"radio\" id=\"battle-off\" name=\"battle-mode\" value=\"75\" checked>\n\n\n <input type=\"radio\" id=\"things-on\" name=\"things-mode\" value=\"77\" checked> \n        <input type=\"radio\" id=\"things-off\" name=\"things-mode\" value=\"76\" >\n\n\n         <input type=\"radio\" id=\"time-on\" name=\"time-mode\" value=\"78\" > \n        <input type=\"radio\" id=\"time-off\" name=\"time-mode\" value=\"79\" checked>\n\n           <input type=\"radio\" id=\"spacialdate-on\" name=\"spacialdate-mode\" value=\"on\" > \n        <input type=\"radio\" id=\"spacialdate-off\" name=\"spacialdate-mode\" value=\"off\" checked>\n\n             <input type=\"radio\" id=\"danmu-on\" name=\"danmu-mode\" value=\"on\" checked> \n        <input type=\"radio\" id=\"danmu-off\" name=\"danmu-mode\" value=\"off\" >\n\n     <input type=\"radio\" id=\"bgm-on\" name=\"bgm-mode\" value=\"on\" checked> \n        <input type=\"radio\" id=\"bgm-off\" name=\"bgm-mode\" value=\"off\" >\n\n                <input type=\"radio\" id=\"behavior-on\" name=\"behavior-mode\" value=\"52\" checked>\n        <input type=\"radio\" id=\"behavior-off\" name=\"behavior-mode\" value=\"53\">\n             <input type=\"radio\" id=\"cg-on\" name=\"cg-mode\" value=\"45\" checked>\n        <input type=\"radio\" id=\"cg-off\" name=\"cg-mode\" value=\"46\">\n         <input type=\"radio\" id=\"npccg-on\" name=\"npccg-mode\" value=\"48\" checked>\n        <input type=\"radio\" id=\"npccg-off\" name=\"npccg-mode\" value=\"off\">\n\n \n\n        <input type=\"radio\" id=\"npc-love-on\" name=\"npc-love-mode\" value=\"on\">\n        <input type=\"radio\" id=\"npc-love-off\" name=\"npc-love-mode\" value=\"off\" checked>\n\n\n        <input type=\"radio\" id=\"real-world-on\" name=\"real-world-mode\" value=\"on\">\n        <input type=\"radio\" id=\"real-world-off\" name=\"real-world-mode\" value=\"off\" checked>\n        <input type=\"radio\" id=\"hard-on\" name=\"hard-mode\" value=\"on\">\n        <input type=\"radio\" id=\"hard-off\" name=\"hard-mode\" value=\"off\" checked>\n   \n\n    </div>\n\n\n    <div class=\"button-container\">\n        <button id=\"start-setup-button\" class=\"primary-cta-btn\">â†’</button>\n    </div>\n</div>\n\n <div id=\"page-1\" class=\"init-page\">\n\n    <div id=\"solar-system\">\n\n        <div class=\"player-core\">\n            <div class=\"core-text_zh\">æ ¸å¿ƒ</div>\n            <div class=\"core-text_en\">CORE</div>\n        </div>\n\n\n        <div class=\"planet\" id=\"planet-task\">\n            <div class=\"planet-icon-container\">\n                <div class=\"planet-icon\">â—‰</div>\n                <div class=\"planet-title\">ä¸–ç•Œç»†èŠ‚</div>\n            </div>\n            <div class=\"planet-content\">\n                <button class=\"close-planet-btn\">Ã—</button>\n                <div class=\"form-section\">\n                    <h2 class=\"form-title\">// ä»»åŠ¡ç»†èŠ‚è®¾å®š</h2>\n         <div class=\"collapsible-content-placeholder\">\n\n    <div class=\"clover-layout\" id=\"world-details-default\">\n        <div class=\"clover-leaf\" id=\"clover-leaf-tone\">\n            <label for=\"task-tone-select\">åŸºè°ƒ</label>\n            <select id=\"task-tone-select\" class=\"custom-select\"></select>\n            <div class=\"custom-input-container\" id=\"custom-task-tone-group\">\n                <input type=\"text\" id=\"custom-task-tone\" class=\"custom-select\" placeholder=\"è¾“å…¥è‡ªå®šä¹‰åŸºè°ƒ\">\n            </div>\n        </div>\n        <div class=\"clover-leaf\" id=\"clover-leaf-type\">\n            <label for=\"world-type-select\">ç±»å‹</label>\n            <select id=\"world-type-select\" class=\"custom-select\"></select>\n            <div class=\"custom-input-container\" id=\"custom-world-type-group\">\n                <input type=\"text\" id=\"custom-world-type\" class=\"custom-select\" placeholder=\"è¾“å…¥è‡ªå®šä¹‰ç±»å‹\">\n            </div>\n        </div>\n        <div class=\"clover-leaf\" id=\"clover-leaf-identity\">\n            <label for=\"world-identity-select\">èº«ä»½</label>\n            <select id=\"world-identity-select\" class=\"custom-select\"></select>\n            <div class=\"custom-input-container\" id=\"custom-world-identity-group\">\n                <input type=\"text\" id=\"custom-world-identity\" class=\"custom-select\" placeholder=\"è¾“å…¥è‡ªå®šä¹‰èº«ä»½\">\n            </div>\n        </div>\n        <div class=\"clover-leaf\" id=\"clover-leaf-opening\">\n            <label for=\"opening-scenario-select\">å¼€å±€</label>\n            <select id=\"opening-scenario-select\" class=\"custom-select\"></select>\n            <div class=\"custom-input-container\" id=\"custom-opening-scenario-group\">\n                <input type=\"text\" id=\"custom-opening-scenario\" class=\"custom-select\" placeholder=\"è¾“å…¥è‡ªå®šä¹‰å¼€å±€\">\n            </div>\n        </div>\n    </div>\n\n\n    <div class=\"v7-world-container\" id=\"world-details-v7\" style=\"display: none;\">\n        <div class=\"v7-setup-section\">\n            <div class=\"v7-setup-title\">// é€‰æ‹©æœ«æ—¥ç±»å‹</div>\n            <div class=\"v7-choice-group\" id=\"v7-apocalypse-choices\">\n\n            </div>\n        </div>\n        <div class=\"v7-setup-section\">\n            <div class=\"v7-setup-title\">// é€‰æ‹©é˜¶å±‚</div>\n            <div class=\"v7-choice-group\" id=\"v7-class-choices\">\n\n            </div>\n        </div>\n        <div class=\"v7-setup-section\">\n            <div class=\"v7-setup-title\">// é€‰æ‹©æ—¶é—´çº¿</div>\n            <div class=\"v7-choice-group\" id=\"v7-timeline-choices\">\n\n            </div>\n        </div>\n    </div>\n\n\n    <div id=\"description-popup\"></div>\n</div>\n                </div>\n            </div>\n        </div>\n\n\n        <div class=\"planet\" id=\"planet-identity\">\n            <div class=\"planet-icon-container\">\n              \n                <div class=\"planet-icon\">âœ¦</div>\n                <div class=\"planet-title\" id=\"planet-title-identity\">èº«ä»½è®¾å®š</div>\n            </div>\n            <div class=\"planet-content\">\n                <button class=\"close-planet-btn\">Ã—</button>\n                <div class=\"form-section\">\n                     <h2 class=\"form-title\">// é€‰æ‹©åˆå§‹èº«ä»½</h2>\n                     <div id=\"id-card-wrapper\" class=\"collapsible-content-placeholder\">\n                         <div class=\"id-card\">\n                             <div class=\"id-card-main\">\n                                 <label for=\"user-identity\">èº«ä»½</label>\n                                 <select id=\"user-identity\" class=\"custom-select\"></select>\n                                 <p id=\"identity-description\"></p>\n                             </div>\n                             <div id=\"paradise-camp-section\" class=\"id-card-addon\">\n                                 <div class=\"grid-container\">\n                                     <div class=\"form-group\">\n                                         <label for=\"paradise-camp\">ä¹å›­é˜µè¥</label>\n                                         <select id=\"paradise-camp\" class=\"custom-select\">\n                                             <option value=\"è½®å›ä¹å›­\">è½®å›ä¹å›­</option>\n                                             <option value=\"å¤©å¯ä¹å›­\">å¤©å¯ä¹å›­</option>\n                                             <option value=\"æ­»äº¡ä¹å›­\">æ­»äº¡ä¹å›­</option>\n                                             <option value=\"åœ£å…‰ä¹å›­\">åœ£å…‰ä¹å›­</option>\n                                         </select>\n                                     </div>\n                                     <div class=\"form-group\">\n                                         <label for=\"paradise-identity\">ä¹å›­èº«ä»½</label>\n                                         <select id=\"paradise-identity\" class=\"custom-select\">\n                                             <option value=\"æ–°äºº\">æ–°äºº</option>\n                                             <option value=\"çŒæ€è€…\">çŒæ€è€…</option>\n                                             <option value=\"è£å†³è€…\">è£å†³è€…</option>\n                                             <option value=\"å…ˆé©±è€…\">å…ˆé©±è€…</option>\n                                             <option value=\"èŒå·¥è€…\">èŒå·¥è€…</option>\n                                             <option value=\"è¿è§„è€…\">è¿è§„è€…</option>\n                                         </select>\n                                     </div>\n                                 </div>\n                             </div>\n                        </div>\n                     </div>\n                </div>\n                 <div class=\"form-section\">\n                     <div class=\"talent-wrapper collapsible-content-placeholder\">\n                         <h3 class=\"talent-title\">å¤©èµ‹</h3>\n                         <div class=\"talent-selector-wrapper\">\n                               <div class=\"talent-search-container\">\n        <input type=\"text\" id=\"talent-search-input\" class=\"custom-select\" placeholder=\"æœç´¢ä½ çš„å¤©èµ‹â€¦\">\n    </div>\n                                <div id=\"custom-talent-group\" class=\"custom-input-container\">\n                                 <label for=\"custom-talent-input\">è‡ªå®šä¹‰å¤©èµ‹æè¿°</label>\n                                 <input type=\"text\" id=\"custom-talent-input\" class=\"custom-select\" placeholder=\"è¯·åœ¨æ­¤å¤„æè¿°ä½ çš„ç‹¬ç‰¹å¤©èµ‹\">\n                             </div>\n                            <select id=\"talent-select\" class=\"hidden-select\">\n                                 <option value=\"éšæœº\">éšæœº - å‘½è¿çš„éª°å­å·²ç»æ·å‡º</option>\n                                     <option value=\"è‡ªå®šä¹‰\">è‡ªå®šä¹‰</option>\n                                     <option value=\"AIéšæœº\">AIéšæœºç”Ÿæˆ</option>\n                                 <option value=\"æ— \">æ— </option>\n                                <option value=\"ç¬¬å››é¢å¢™çŸ¥æƒ…è€…ï¼šä½ éšçº¦çŸ¥é“è‡ªå·±æ˜¯æŸä¸ªæ•…äº‹çš„è§’è‰²ï¼Œå¶å°”èƒ½å¬åˆ°â€œç”»å¤–éŸ³â€ï¼Œä½†å…¶ä»–äººåªä¼šè§‰å¾—ä½ åœ¨è‡ªè¨€è‡ªè¯­ã€‚\">ç¬¬å››é¢å¢™çŸ¥æƒ…è€…</option>\n    <option value=\"ç»å¯¹å‘³è§‰ï¼šä½ çš„èˆŒå¤´æ˜¯ä¸ªè¶…é«˜ç²¾åº¦çš„åŒ–å­¦åˆ†æä»ªï¼Œèƒ½å°å‡ºä»»ä½•ç‰©è´¨çš„ç²¾ç¡®æˆåˆ†ï¼ŒåŒ…æ‹¬æ¯’è¯ã€æ³¥åœŸå’Œåˆ«äººçš„è°è¨€ã€‚\">ç»å¯¹å‘³è§‰</option>\n    <option value=\"æƒ…ç»ªå®ä½“åŒ–ï¼šå¼ºçƒˆçš„æƒ…ç»ªä¼šä»¥æ— å®³ä½†å¥‡ç‰¹çš„ç‰©ç†å½¢æ€å‡ºç°åœ¨ä½ å‘¨å›´ã€‚æ¯”å¦‚ï¼Œæåº¦æ‚²ä¼¤æ—¶ä¼šä¸‹èµ·å°å°çš„çˆ†ç±³èŠ±é›¨ï¼Œæ„¤æ€’æ—¶å¤´é¡¶ä¼šé•¿å‡ºæŸ”è½¯çš„è˜‘è‡ã€‚\">æƒ…ç»ªå®ä½“åŒ–</option>\n    <option value=\"BGMæ’­æ”¾å™¨ï¼šä½ çš„è¡Œä¸ºä¼šè‡ªåŠ¨åŒ¹é…èƒŒæ™¯éŸ³ä¹ï¼Œåªæœ‰ä½ è‡ªå·±èƒ½å¬åˆ°ã€‚æ½œè¡Œæ—¶æ˜¯çˆµå£«ä¹ï¼Œæˆ˜æ–—æ—¶æ˜¯äº¤å“é‡‘å±ï¼Œæ‘¸é±¼æ—¶åˆ™æ˜¯æ‚ æ‰¬çš„å¤å¨å¤·å°è°ƒã€‚\">BGMæ’­æ”¾å™¨</option>\n    <option value=\"åå‘å¹¸è¿ï¼šä½ çš„è¿æ°”æ€»æ˜¯ä»¥ä¸€ç§ç¦»å¥‡çš„æ–¹å¼ä¿æŠ¤ä½ ã€‚æ¯”å¦‚ï¼Œä½ ä¼šè¢«é¦™è•‰çš®æ»‘å€’ï¼Œå´åˆšå¥½èº²è¿‡ä¸€é¢—ç‹™å‡»å­å¼¹ï¼Œæˆ–è€…ä¹°å½©ç¥¨åªä¸­äº†ä¸€åŒ…çº¸å·¾ï¼Œä½†é‚£åŒ…çº¸å·¾åˆšå¥½æ˜¯æœ€åä¸€åŒ…ã€‚\">åå‘å¹¸è¿</option>\n    <option value=\"åŠ¨ç‰©ç¤¾äº¤ææ€–åˆ†å­ï¼šæ‰€æœ‰éäººç±»çš„ç”Ÿç‰©è§åˆ°ä½ éƒ½ä¼šç«‹åˆ»é™·å…¥ææ…Œï¼Œå¹¶æƒ³å°½ä¸€åˆ‡åŠæ³•è¿œç¦»ä½ ã€‚é¸½å­ä¼šä¸ºä½ ç»•è·¯ï¼Œè­¦çŠ¬ä¼šæ”¾å¼ƒè¿½æ•ï¼Œå°±è¿é˜¿ç±³å·´åŸè™«ä¹Ÿä¼šåŠªåŠ›å˜å½¢è¿œç¦»ä½ çš„ç»†èƒã€‚\">åŠ¨ç‰©ç¤¾äº¤ææ€–åˆ†å­</option>\n    <option value=\"ä¸‡ç‰©çš†ä¸ºå‹ï¼šä½ å¯ä»¥å’Œä»»ä½•éç”Ÿå‘½ç‰©ä½“è¿›è¡Œå‹å¥½çš„ç²¾ç¥äº¤æµï¼Œæ¯”å¦‚ä½ çš„å‰‘ã€ä½ çš„é‹å­ã€è·¯è¾¹çš„çŸ³å¤´ã€‚å®ƒä»¬å¶å°”ä¼šç»™ä½ ä¸€äº›å¥‡æ€ªä½†æœ‰ç”¨çš„å»ºè®®ã€‚\">ä¸‡ç‰©çš†ä¸ºå‹</option>\n    <option value=\"æ— ç”¨ä¹‹å­¦å¤§å¸ˆï¼šä½ å¯¹æ‰€æœ‰åœ¨å½“å‰ä¸–ç•Œè§‚ä¸‹æ¯«æ— ç”¨å¤„çš„çŸ¥è¯†ï¼ˆæ¯”å¦‚åœ°çƒä¸Šçš„äº’è”ç½‘memeã€å†·é—¨åŠ¨ç”»çš„å‰§æƒ…ã€é‡å­åŠ›å­¦çš„å…«å¦ï¼‰éƒ½äº†å¦‚æŒ‡æŒã€‚\">æ— ç”¨ä¹‹å­¦å¤§å¸ˆ</option>\n    <option value=\"æ¦‚ç‡ç¯¡æ”¹ï¼ˆ1%ï¼‰ï¼šæ¯å¤©ä¸€æ¬¡ï¼Œä½ å¯ä»¥æŒ‡å®šä¸€ä¸ªäº‹ä»¶ï¼Œå¹¶å°†å…¶æˆåŠŸçš„æ¦‚ç‡å¼ºè¡Œæå‡æˆ–é™ä½1%ã€‚è™½ç„¶å¾®å°ï¼Œä½†æœ‰æ—¶è¶³ä»¥åˆ›é€ å¥‡è¿¹ï¼Œæˆ–è€…å¸¦æ¥ç¾éš¾ã€‚\">æ¦‚ç‡ç¯¡æ”¹ï¼ˆ1%ï¼‰</option>\n    <option value=\"å‰§æƒ…å…ç–«ï¼šä½ å¯¹æ‰€æœ‰å¸¸è§çš„å‰§æƒ…æ€ã€é¢„è¨€ã€è¯…å’’éƒ½å¤©ç„¶å…ç–«ã€‚é¢„è¨€ä¸­çš„â€œå¤©é€‰ä¹‹å­â€ä¼šçªç„¶å¯¹ä½ å¤±å»å…´è¶£ï¼Œå¿…æ­»çš„è¯…å’’åœ¨ä½ èº«ä¸Šä¼šå˜æˆä¸€ä¸ªæ— ä¼¤å¤§é›…çš„debuffï¼Œæ¯”å¦‚â€œæ¥ä¸‹æ¥24å°æ—¶è¯´è¯ä¼šæŠ¼éŸµâ€ã€‚\">å‰§æƒ…å…ç–«</option>\n\n\n    <option value=\"æ°´æºåœ°å“é‰´å¸ˆï¼šä½ èƒ½å¤Ÿå“å°å‡ºä»»ä½•æ°´ï¼ˆåŒ…æ‹¬åœ£æ°´å’Œæ¯’æ¶²ï¼‰çš„ç²¾ç¡®æ°´æºåœ°å’Œè¿‡æ»¤å†å²ï¼Œä½†è¿™å¹¶ä¸èƒ½è®©ä½ å…ç–«ã€‚\">æ°´æºåœ°å“é‰´å¸ˆ</option>\n    <option value=\"æ´»æ³¼çš„å½±å­ï¼šä½ çš„å½±å­æ‹¥æœ‰ç‹¬ç«‹çš„ã€éå¸¸ä¸°å¯Œçš„è‚¢ä½“è¯­è¨€ï¼Œå®ƒä¼šæ ¹æ®ä½ çš„æ½œæ„è¯†åšå‡ºååº”ï¼Œæ¯”å¦‚åœ¨ä½ æ’’è°æ—¶æ‹¼å‘½æ‘‡å¤´ã€‚\">æ´»æ³¼çš„å½±å­</option>\n    <option value=\"ä¾¿æºå¼çƒ­æ°´å£¶ï¼šä½ æµä¸‹çš„çœ¼æ³ªæ˜¯æ»šçƒ«çš„ï¼Œå¯ä»¥ç”¨æ¥æ³¡èŒ¶ï¼Œä½†å‘³é“æ€»æ˜¯æœ‰ç‚¹å’¸ã€‚\">ä¾¿æºå¼çƒ­æ°´å£¶</option>\n    <option value=\"æ¤ç‰©çš„æ‚²é¸£ï¼šä½ èƒ½å¤Ÿå¬åˆ°æ¤ç‰©å› ç¼ºæ°´æˆ–å…‰ç…§ä¸è¶³è€Œå‘å‡ºçš„å¾®å¼±æ‚²é¸£ï¼Œä½†æ— æ³•ä¸å®ƒä»¬äº¤æµã€‚\">æ¤ç‰©çš„æ‚²é¸£</option>\n    <option value=\"é˜²çª¥ä¹‹å“ˆæ¬ ï¼šä½ æ‰“å“ˆæ¬ æ—¶ï¼Œå‘¨å›´åŠå¾„ä¸‰ç±³å†…æ‰€æœ‰èƒ½åå…‰ï¼ˆæ¯”å¦‚é‡‘å±ã€ç»ç’ƒï¼‰çš„ç‰©ä½“è¡¨é¢ä¼šçŸ­æš‚å˜å¾—æ¨¡ç³Šä¸æ¸…ã€‚\">é˜²çª¥ä¹‹å“ˆæ¬ </option>\n    <option value=\"äººä½“é¢åŒ…æœºï¼šåœ¨ä½ å®Œå…¨é™æ­¢ä¸åŠ¨è¶…è¿‡ä¸€åˆ†é’Ÿåï¼Œä½ çš„èº«ä½“ä¼šå¼€å§‹æ•£å‘å‡ºåˆšå‡ºç‚‰çš„é¢åŒ…çš„é¦™æ°”ã€‚\">äººä½“é¢åŒ…æœº</option>\n    <option value=\"è‡ªå¸¦BGMçš„ä¹¦ç­¾ï¼šä½ èƒ½è®©ä»»ä½•ä¹¦ç±åœ¨ä½ é˜…è¯»æ—¶ï¼Œè‡ªåŠ¨é…ä¸Šè½»æŸ”çš„èƒŒæ™¯éŸ³ä¹ï¼Œä½†æ›²é£æ°¸è¿œæ˜¯ä½ æœ€ä¸å–œæ¬¢çš„ç±»å‹ã€‚\">è‡ªå¸¦BGMçš„ä¹¦ç­¾</option>\n    <option value=\"æƒ…ç»ªè°ƒè‰²æ¿ï¼šä½ èº«ä½“çš„æ‰€æœ‰æ¯›å‘ï¼ˆå¤´å‘ã€çœ‰æ¯›ç­‰ï¼‰éƒ½ä¼šæ ¹æ®ä½ çš„æƒ…ç»ªç¼“æ…¢å˜è‰²ï¼Œæ¯”å¦‚ç„¦è™‘æ—¶å˜æˆç°è‰²ï¼Œå¼€å¿ƒæ—¶æ˜¯æ·¡é»„è‰²ï¼Œä½†å˜åŒ–è¿‡ç¨‹éœ€è¦æ•°å°æ—¶ã€‚\">æƒ…ç»ªè°ƒè‰²æ¿</option>\n    <option value=\"çœŸèŒé€šæ„Ÿï¼šä½ èƒ½å¤Ÿä¸çœŸèŒï¼ˆæ¯”å¦‚è˜‘è‡ã€éœ‰èŒï¼‰è¿›è¡Œå•å‘çš„å¿ƒçµæ„Ÿåº”ï¼Œä½ èƒ½æ„ŸçŸ¥åˆ°å®ƒä»¬çš„â€œæƒ³æ³•â€ï¼Œä½†å®ƒä»¬é€šå¸¸åœ¨æ€è€ƒå¦‚ä½•æ›´å¥½åœ°è…çƒ‚ã€‚\">çœŸèŒé€šæ„Ÿ</option>\n    <option value=\"è¯šå®ä¹‹è€³ï¼šä½ åœ¨è¯´è°æ—¶ï¼Œè€³æœµä¼šå˜å¾—å’Œç²¾çµä¸€æ ·å°–ï¼Œæ•ˆæœæŒç»­åˆ°ä½ è¯´å‡ºä¸‹ä¸€å¥çœŸè¯ä¸ºæ­¢ã€‚\">è¯šå®ä¹‹è€³</option>\n    <option value=\"æ˜†è™«èˆè¹ˆå®¶ï¼šä½ èƒ½è®©ä»»ä½•æ˜†è™«åœ¨ä½ é¢å‰è·³ä¸€æ®µä¼˜é›…çš„åå°”å…¹ï¼Œå‰ææ˜¯ä½ èƒ½è¯´æœå®ƒè¿™ä¹ˆåšã€‚\">æ˜†è™«èˆè¹ˆå®¶</option>\n    <option value=\"ä¸‡ç‰©å¹´è½®ï¼šä½ èƒ½å¤Ÿç²¾ç¡®åœ°çŸ¥é“ä»»ä½•ä¸€ä¸ªéç”Ÿå‘½ç‰©ä½“çš„â€œå¹´é¾„â€ï¼Œä»å®ƒè¢«åˆ¶é€ å‡ºæ¥çš„é‚£ä¸€åˆ»ç®—èµ·ã€‚\">ä¸‡ç‰©å¹´è½®</option>\n    <option value=\"é—ªå…‰å‘¼å¸ï¼šä½ å‘¼å‡ºçš„æ°”ä¸­å«æœ‰å¾®é‡çš„ã€æ— å®³çš„é—ªå…‰ç²‰å°˜ï¼Œåœ¨é˜³å…‰ä¸‹ä¼šæ˜¾å¾—éå¸¸æ¢¦å¹»ã€‚\">é—ªå…‰å‘¼å¸</option>\n    <option value=\"å‘³è§‰å€’é”™ï¼šä½ èƒ½è®©ä»»ä½•å’¸å‘³çš„é£Ÿç‰©åƒèµ·æ¥åƒæ˜¯ç”œçš„ï¼Œåä¹‹äº¦ç„¶ï¼Œä½†è¥å…»æˆåˆ†ä¸å˜ã€‚\">å‘³è§‰å€’é”™</option>\n    <option value=\"å…«å¦å¤©çº¿ï¼šå½“æœ‰äººåœ¨ä½ èƒŒåè¯´ä½ åè¯æ—¶ï¼Œä½ çš„å¤´å‘ä¼šåƒè¢«é™ç”µå¸é™„ä¸€æ ·ç«–èµ·æ¥ä¸€æ ¹ã€‚\">å…«å¦å¤©çº¿</option>\n    <option value=\"è¿·è·¯æŒ‡é’ˆï¼šä½ ç”»çš„ä»»ä½•åœ°å›¾ï¼Œæ— è®ºå¤šç²¾ç¡®ï¼Œä¸Šé¢çš„â€œä½ åœ¨æ­¤å¤„â€æ ‡è®°æ€»æ˜¯ä¼šè‡ªå·±è·‘åˆ°åœ°å›¾çš„è¾¹ç¼˜ã€‚\">è¿·è·¯æŒ‡é’ˆ</option>\n    <option value=\"æ€€æ—§ä¹‹å£°ï¼šä½ å“¼å”±çš„ä»»ä½•æ­Œæ›²ï¼Œéƒ½ä¼šè¢«å‘¨å›´çš„äººå¬æˆä¸€é¦–ä»–ä»¬ç«¥å¹´æœ€ç†Ÿæ‚‰çš„å„¿æ­Œã€‚\">æ€€æ—§ä¹‹å£°</option>\n    <option value=\"äººä½“èŠ‚æ‹å™¨ï¼šä½ èƒ½è®©è‡ªå·±çš„å¿ƒè·³å£°å®Œç¾åœ°æ¨¡ä»¿ä»»ä½•ä¸€ç§æ‰“å‡»ä¹å™¨ï¼Œä½†æ— æ³•æ§åˆ¶èŠ‚å¥ã€‚\">äººä½“èŠ‚æ‹å™¨</option>\n    <option value=\"é—¨ä¹‹å‹ï¼šä½ å¯¹æ‰€æœ‰ç±»å‹çš„é—¨éƒ½æœ‰ç€è¶…å‡¡çš„äº²å’ŒåŠ›ï¼Œå®ƒä»¬åœ¨ä½ é¢å‰æ—¶ä¼šå‘å‡ºå¾®å¼±çš„ã€è¡¨ç¤ºæ¬¢è¿çš„å±å‘€å£°ã€‚\">é—¨ä¹‹å‹</option>\n    <option value=\"æ¢¦å¢ƒæŠ•å½±ä»ªï¼šåœ¨ä½ ç¡è§‰æ—¶ï¼Œä½ çš„æ¢¦å¢ƒä¼šä»¥å£ç”»çš„å½¢å¼çŸ­æš‚åœ°æŠ•å°„åœ¨ä½ å‘¨å›´çš„å¢™å£ä¸Šï¼Œå¤©äº®å³é€ã€‚\">æ¢¦å¢ƒæŠ•å½±ä»ª</option>\n    <option value=\"ç¬é—´æŠ›å…‰ï¼šä½ å¯ä»¥è®©ä»»ä½•ä¸€é¢—é¹…åµçŸ³çš„è¡¨é¢å˜å¾—åƒé•œå­ä¸€æ ·å…‰æ»‘ï¼Œä½†åªèƒ½ç»´æŒä¸‰ç§’ã€‚\">ç¬é—´æŠ›å…‰</option>\n    <option value=\"æ¾é¼ ä¼šè®¡ï¼šä½ æ€»èƒ½çŸ¥é“ç¦»ä½ æœ€è¿‘çš„ä¸€åªæ¾é¼ è—èµ·æ¥çš„æ¾æœçš„ç¡®åˆ‡æ•°é‡ã€‚\">æ¾é¼ ä¼šè®¡</option>\n    <option value=\"æ— ç—•ä¹‹æ­¥ï¼šä½ èµ°è¿‡è‰åœ°æ—¶ï¼Œè¢«ä½ è¸©åˆ°çš„è‰ä¼šç«‹åˆ»æ¢å¤åŸçŠ¶ï¼Œä¸ä¼šç•™ä¸‹ä»»ä½•è„šå°ã€‚\">æ— ç—•ä¹‹æ­¥</option>\n    <option value=\"çº¸å¼ å®ˆæŠ¤è€…ï¼šä½ èƒ½è®©ä»»ä½•çº¸åˆ¶å“ï¼ˆä¹¦ã€ç¾Šçš®å·ç­‰ï¼‰å¯¹ç«çš„æŠ—æ€§æå‡5%ï¼ŒèŠèƒœäºæ— ã€‚\">çº¸å¼ å®ˆæŠ¤è€…</option>\n    <option value=\"åŒ–å­¦å—ï¼šä½ å–ä¸‹ä»»ä½•æ¶²ä½“åï¼Œéƒ½èƒ½åœ¨ååˆ†é’Ÿå†…ï¼Œä»¥æ‰“å—çš„æ–¹å¼å°†è¯¥æ¶²ä½“çš„åŒ–å­¦å¼â€œè¯´â€å‡ºæ¥ã€‚\">åŒ–å­¦å—</option>\n    <option value=\"è½å¶æ—¶åˆ»ï¼šä½ æ‹¥æœ‰è®©æ—¶é—´å˜æ…¢çš„èƒ½åŠ›ï¼Œä½†åªå¯¹æ­£åœ¨ä¸‹è½çš„æ ‘å¶æœ‰æ•ˆã€‚\">è½å¶æ—¶åˆ»</option>\n    <option value=\"ç£çŸ³ä¹‹è¯­ï¼šä½ èƒ½å¬æ‡‚çŸ³å¤´çš„è¯è¯­ï¼Œä½†å®ƒä»¬æ€è€ƒå¾—æå…¶ç¼“æ…¢ï¼Œä¸€å¥è¯å¯èƒ½è¦èŠ±ä¸Šæ•°ç™¾å¹´æ‰èƒ½è¯´å®Œã€‚\">ç£çŸ³ä¹‹è¯­</option>\n    <option value=\"ä¸æ²¾ä¹‹è‚¤ï¼šä½ çš„çš®è‚¤æ‹¥æœ‰å®Œç¾çš„é˜²æ°´æ€§ï¼Œå°±åƒè·å¶ä¸€æ ·ï¼Œä»»ä½•æ¶²ä½“éƒ½ä¸ä¼šæ²¾æŸ“ï¼ŒåŒ…æ‹¬æ²»ç–—è¯æ°´ã€‚\">ä¸æ²¾ä¹‹è‚¤</option>\n    <option value=\"å¤©ä¹¦ä¹‹ç¬”ï¼šä½ å†™çš„å­—ä¼šè‡ªåŠ¨å˜æˆä¸€ç§æå…¶ä¼˜ç¾ä½†æ— äººèƒ½æ‡‚çš„ä¹¦æ³•ä½“ã€‚\">å¤©ä¹¦ä¹‹ç¬”</option>\n    <option value=\"å¯æ§ç³å­”ï¼šä½ èƒ½å¤Ÿè‡ªç”±æ§åˆ¶è‡ªå·±ç³å­”æ”¾å¤§çš„ç¨‹åº¦ï¼Œå¯ä»¥åœ¨é»‘æš—ä¸­çœ‹å¾—æ›´æ¸…æ¥šä¸€ç‚¹ï¼Œä½†ä¹Ÿä¼šå› æ­¤æ˜¾å¾—å¾ˆæƒŠè®¶ã€‚\">å¯æ§ç³å­”</option>\n    <option value=\"æ— ç”¨è®°å¿†ï¼šä½ èƒ½èƒŒè¯µå‡ºåœ†å‘¨ç‡å°æ•°ç‚¹åä¸€ä¸‡ä½ï¼Œä½†åœ¨ä»»ä½•éœ€è¦è®¡ç®—çš„åœºåˆï¼Œè¿™éƒ½æ²¡æœ‰ä»»ä½•å¸®åŠ©ã€‚\">æ— ç”¨è®°å¿†</option>\n    <option value=\"æµ‹è°å–·åšï¼šä½ å¯¹è°è¨€è¿‡æ•ï¼Œæ¯æ¬¡å¬åˆ°è°è¨€éƒ½ä¼šæ‰“ä¸€ä¸ªå“äº®çš„å–·åšã€‚\">æµ‹è°å–·åš</option>\n    <option value=\"ç¡¬å¸æ¸…æ´å·¥ï¼šä»»ä½•åœ¨ä½ æ‰‹ä¸­åœç•™è¶…è¿‡ä¸€åˆ†é’Ÿçš„ç¡¬å¸ï¼Œéƒ½ä¼šè¢«è‡ªåŠ¨æ“¦å¾—é”ƒäº®ã€‚\">ç¡¬å¸æ¸…æ´å·¥</option>\n    <option value=\"æƒ…ç»ªè‰²ç›²ï¼šä½ èƒ½å¤Ÿæ„Ÿå—åˆ°æƒ…ç»ªçš„â€œé¢œè‰²â€ï¼Œä½†æ‰€æœ‰è´Ÿé¢æƒ…ç»ªéƒ½æ˜¯ä¸åŒè‰²è°ƒçš„ç°è‰²ã€‚\">æƒ…ç»ªè‰²ç›²</option>\n    <option value=\"è„†å¼±ä¹‹å‘ï¼šä½ èƒ½è®©è‡ªå·±çš„å¤´å‘åƒè—¤è”“ä¸€æ ·ä¼¸é•¿ï¼Œä½†å®ƒå’Œæ™®é€šå¤´å‘ä¸€æ ·è„†å¼±ï¼Œä¸€æ‰¯å°±æ–­ã€‚\">è„†å¼±ä¹‹å‘</option>\n    <option value=\"è·¨ç‰©ç§å¹½é»˜ï¼šä½ è®²çš„ç¬‘è¯èƒ½è®©å‘¨å›´çš„éæ™ºæ…§ç”Ÿç‰©ï¼ˆæ¯”å¦‚ç‹—æˆ–é©¬ï¼‰å‘ç¬‘ã€‚\">è·¨ç‰©ç§å¹½é»˜</option>\n    <option value=\"èƒ½é‡æ¶ˆè€—è€…ï¼šä½ æ¯æ¬¡çœ¨çœ¼ï¼Œéƒ½åœ¨æ¶ˆè€—æå…¶å¾®é‡çš„ã€å¯ä»¥å¿½ç•¥ä¸è®¡çš„â€œä¸–ç•Œèƒ½é‡â€ã€‚\">èƒ½é‡æ¶ˆè€—è€…</option>\n    <option value=\"é©¬åç‚®å‘å¯¼ï¼šä½ æ€»èƒ½æ‰¾åˆ°ä»»ä½•è¿·å®«çš„å‡ºå£ï¼Œä½†åªæœ‰åœ¨ä½ å·²ç»èµ°å‡ºè¿·å®«ä¹‹åæ‰èƒ½ç¡®å®šã€‚\">é©¬åç‚®å‘å¯¼</option>\n    <option value=\"å¡‘äº‘è€…ï¼šä½ èƒ½å¤Ÿè®©ä»»ä½•ä¸€æœµäº‘å½©æš‚æ—¶å˜æˆä½ æƒ³è¦çš„å½¢çŠ¶ï¼Œä½†å¾ˆå¿«å°±ä¼šè¢«é£å¹æ•£ã€‚\">å¡‘äº‘è€…</option>\n    <option value=\"æœ€åçš„å®‰é­‚æ›²ï¼šä½ èƒ½è®©æ­»äº¡ä¸è¶…è¿‡ä¸€å°æ—¶çš„æ˜†è™«å°¸ä½“ï¼Œé‡æ–°â€œæ´»â€è¿‡æ¥å¹¶ä¸ºä½ è·³å®Œæœ€åä¸€æ”¯èˆã€‚\">æœ€åçš„å®‰é­‚æ›²</option>\n    <option value=\"é­”æ³•å“é‰´å®¶ï¼šä½ å¯¹é­”æ³•çš„æ°”å‘³æå…¶æ•æ„Ÿï¼Œèƒ½é—»å‡ºä¸åŒæ³•æœ¯æ®‹ç•™çš„å‘³é“ï¼Œæ¯”å¦‚ç«çƒæœ¯æ˜¯çƒ§ç„¦çš„è¾£æ¤’å‘³ï¼Œæ²»ç–—æœ¯æ˜¯è–„è·å‘³ã€‚\">é­”æ³•å“é‰´å®¶</option>\n    <option value=\"æ²‰æ€ä¹‹è¶ï¼šå½“ä½ é™·å…¥æ²‰æ€æ—¶ï¼Œä½ çš„èº«è¾¹ä¼šéšæœºå‡ºç°ä¸€åªè´è¶çš„å¹»å½±ï¼Œç»•ç€ä½ é£èˆã€‚\">æ²‰æ€ä¹‹è¶</option>\n    <option value=\"èšŠå­ç»ç¼˜ä½“ï¼šä½ æ°¸è¿œä¸ä¼šè¢«èšŠå­å®å’¬ï¼Œå› ä¸ºèšŠå­è®¤ä¸ºä½ çš„è¡€â€œä¸å¥½å–â€ã€‚\">èšŠå­ç»ç¼˜ä½“</option>\n\n\n    <option value=\"å½±å­å£è¢‹ï¼šä½ èƒ½å¤Ÿå°†å°å‹éé­”æ³•ç‰©å“ï¼ˆå¦‚é’¥åŒ™ã€åŒ•é¦–ï¼‰å®Œç¾åœ°è—åœ¨è‡ªå·±çš„å½±å­é‡Œï¼Œéœ€è¦æ—¶å¯ä»¥å–å‡ºã€‚\">å½±å­å£è¢‹</option>\n    <option value=\"ç´§æ€¥ä¿¡æ ‡ï¼šä½ èƒ½å¤Ÿä¸è‡ªå·±æ¥è§¦è¿‡çš„ã€æœ‰æ™ºæ…§çš„ç”Ÿç‰©å»ºç«‹ä¸€ä¸ªä¸´æ—¶çš„ç²¾ç¥é“¾æ¥ï¼Œåªèƒ½ä¼ é€’â€œå±é™©â€æˆ–â€œå®‰å…¨â€ä¸¤ç§ä¿¡å·ã€‚\">ç´§æ€¥ä¿¡æ ‡</option>\n    <option value=\"æ’æ¸©åŠ¨ç‰©ï¼šä½ çš„èº«ä½“èƒ½å¤Ÿç¼“æ…¢åœ°é€‚åº”ä»»ä½•ç¯å¢ƒçš„æ¸©åº¦ï¼Œæ— è®ºæ˜¯æå¯’è¿˜æ˜¯é…·æš‘ï¼Œéƒ½èƒ½ä¿æŒç›¸å¯¹èˆ’é€‚ã€‚\">æ’æ¸©åŠ¨ç‰©</option>\n    <option value=\"å¤§åœ°è„‰åŠ¨ï¼šä½ èƒ½å¤Ÿé€šè¿‡è§¦æ‘¸åœŸå£¤ï¼Œæ„ŸçŸ¥åˆ°å‘¨å›´ä¸€å…¬é‡Œå†…æ˜¯å¦æœ‰å¤§å‹ç”Ÿç‰©ç¾¤ä½“æ´»åŠ¨ã€‚\">å¤§åœ°è„‰åŠ¨</option>\n    <option value=\"æ»‹å…»ä¹‹æ‰‹ï¼šä½ åˆ¶ä½œçš„ä»»ä½•é£Ÿç‰©æˆ–é¥®å“ï¼Œéƒ½ä¼šé™„å¸¦è½»å¾®çš„ã€åŠ é€Ÿä½“åŠ›æ¢å¤çš„æ•ˆæœã€‚\">æ»‹å…»ä¹‹æ‰‹</option>\n    <option value=\"æ´»ä½“åœ°å›¾ï¼šä½ èƒ½å¤Ÿè®°ä½èµ°è¿‡çš„ä»»ä½•ä¸€æ¡è·¯ï¼Œå¹¶ä¸”å¯ä»¥åœ¨è„‘æµ·ä¸­æ„å»ºå‡ºå®Œç¾çš„3Dåœ°å›¾ã€‚\">æ´»ä½“åœ°å›¾</option>\n    <option value=\"æƒ…æ„Ÿæ®‹å“ï¼šä½ èƒ½å¤Ÿé€šè¿‡è§¦æ‘¸ä¸€ä»¶ç‰©å“ï¼Œæ„ŸçŸ¥åˆ°å®ƒä¸Šä¸€ä½ä½¿ç”¨è€…çš„å¼ºçƒˆæƒ…ç»ªã€‚\">æƒ…æ„Ÿæ®‹å“</option>\n    <option value=\"å®‰æŠšä¹‹å£°ï¼šä½ çš„å£°éŸ³èƒ½å¤Ÿå®‰æŠšå¤§å¤šæ•°éæ•Œæ„çš„é‡å…½ï¼Œé™ä½å®ƒä»¬ä¸»åŠ¨æ”»å‡»çš„æ¬²æœ›ã€‚\">å®‰æŠšä¹‹å£°</option>\n    <option value=\"è·¯äººå…‰ç¯ï¼šä½ åœ¨äººç¾¤ä¸­ä¸æ˜“è¢«æ³¨æ„ï¼Œåªè¦ä½ ä¸ä¸»åŠ¨ä¸äººäº¤è°ˆæˆ–åšå‡ºå¼•äººæ³¨ç›®çš„è¡Œä¸ºï¼Œå°±å¾ˆå®¹æ˜“è¢«å¿½ç•¥ã€‚\">è·¯äººå…‰ç¯</option>\n    <option value=\"æŸ”éª¨ä¹‹èº¯ï¼šä½ å¯¹è‡ªå·±èº«ä½“çš„æ§åˆ¶åŠ›æå¼ºï¼Œèƒ½å¤Ÿåšå‡ºåŒªå¤·æ‰€æ€çš„æŸ”éŸ§å’Œå¹³è¡¡åŠ¨ä½œã€‚\">æŸ”éª¨ä¹‹èº¯</option>\n    <option value=\"å±æœºå—…è§‰ï¼šä½ çš„ç›´è§‰æ€»èƒ½åœ¨æˆ˜æ–—å‰ä¸€ç§’ï¼Œä¸ºä½ è­¦ç¤ºå‡ºæœ€è‡´å‘½çš„å¨èƒæ¥è‡ªä½•æ–¹ã€‚\">å±æœºå—…è§‰</option>\n    <option value=\"ä¸‡è±¡æ‹ŸéŸ³ï¼šä½ èƒ½å¤Ÿæ¨¡ä»¿ä»»ä½•ä½ å¬è¿‡çš„å£°éŸ³ï¼ŒåŒ…æ‹¬äººå£°ã€å…½å¼å’Œç¯å¢ƒéŸ³ï¼Œç›¸ä¼¼åº¦æé«˜ã€‚\">ä¸‡è±¡æ‹ŸéŸ³</option>\n\n\n    <option value=\"æŠ€èƒ½å°å·ï¼šä½ èƒ½å¤Ÿâ€œçªƒå–â€ä»–äººèº«ä¸Šä¸€ä¸ªéæˆ˜æ–—ç±»çš„ç†Ÿç»ƒæŠ€èƒ½ï¼ˆå¦‚å¼€é”ã€æ¼”å¥ã€æ‰‹è‰ºï¼‰ï¼Œå¹¶ä½¿ç”¨ä¸€å°æ—¶ã€‚æ¯å¤©ä¸€æ¬¡ã€‚\">æŠ€èƒ½å°å·</option>\n    <option value=\"æ²‰é»˜é¢†åŸŸï¼šä½ èƒ½å¤ŸæŒ‡å®šä¸€ä¸ªåŠå¾„äº”ç±³å†…çš„åŒºåŸŸï¼Œè®©å…¶ä¸­çš„æ‰€æœ‰é­”æ³•æ•ˆæœï¼Œæ— è®ºæ˜¯å¢ç›Šè¿˜æ˜¯å‡ç›Šï¼Œæš‚æ—¶æ— æ•ˆåŒ–ï¼ŒæŒç»­åç§’ã€‚\">æ²‰é»˜é¢†åŸŸ</option>\n    <option value=\"ç”Ÿå‘½çŒ®ç¥­ï¼šä½ èƒ½å¤Ÿå°†è‡ªå·±çš„ç”Ÿå‘½åŠ›åˆ†ç»™ä»–äººï¼Œå¿«é€Ÿæ²»æ„ˆå¯¹æ–¹çš„ä¼¤å£ï¼Œä½†è‡ªå·±ä¼šé™·å…¥åŒç­‰ç¨‹åº¦çš„è™šå¼±ã€‚\">ç”Ÿå‘½çŒ®ç¥­</option>\n    <option value=\"ç©ºé—´ä¿¡æ ‡ï¼šä½ èƒ½å¤Ÿåœ¨ä½ æ¥è§¦è¿‡çš„ä»»ä½•å›ºä½“è¡¨é¢ç•™ä¸‹ä¸€ä¸ªä¸å¯è§çš„â€œç©ºé—´æ ‡è®°â€ï¼Œä½ å¯ä»¥éšæ—¶æ„ŸçŸ¥åˆ°æ ‡è®°çš„ä½ç½®å’ŒçŠ¶æ€ã€‚æœ€å¤šä¸‰ä¸ªã€‚\">ç©ºé—´ä¿¡æ ‡</option>\n    <option value=\"çœŸå®ä¹‹çœ¼ï¼šä½ èƒ½å¤Ÿçœ‹ç©¿å¤§éƒ¨åˆ†çš„å¹»æœ¯ã€å˜å½¢æœ¯å’Œä¼ªè£…ï¼Œåœ¨ä½ çœ¼ä¸­ï¼Œè™šå‡çš„å­˜åœ¨ä¼šå‘ˆç°å‡ºä¸ç¨³å®šçš„è½®å»“ã€‚\">çœŸå®ä¹‹çœ¼</option>\n    <option value=\"å¾®å°å›æº¯ï¼šæ¯å¤©ä¸€æ¬¡ï¼Œä½ å¯ä»¥è®©æ—¶é—´å€’æµä¸‰ç§’ã€‚åªæœ‰ä½ è‡ªå·±ä¿ç•™è¿™ä¸‰ç§’çš„è®°å¿†ã€‚\">å¾®å°å›æº¯</option>\n    <option value=\"å…µå™¨é€šçµï¼šä½ èƒ½å¤Ÿâ€œè§£è¯»â€æ­¦å™¨çš„è®°å¿†ï¼Œé€šè¿‡è§¦æ‘¸ä¸€æŠŠæ­¦å™¨ï¼Œäº†è§£å®ƒç»å†è¿‡çš„æœ€æ¿€çƒˆçš„ä¸€åœºæˆ˜æ–—ã€‚\">å…µå™¨é€šçµ</option>\n    <option value=\"èƒ½é‡ååˆï¼šä½ å¯ä»¥å°†å—åˆ°çš„ç‰©ç†ä¼¤å®³çš„ä¸€éƒ¨åˆ†ï¼Œä»¥çº¯ç²¹çš„èƒ½é‡å½¢å¼å‚¨å­˜èµ·æ¥ï¼Œå¹¶åœ¨ä¸‹ä¸€æ¬¡æ”»å‡»ä¸­é‡Šæ”¾å‡ºå»ã€‚\">èƒ½é‡ååˆ</option>\n\n\n    <option value=\"æ¦‚å¿µé”šå®šï¼šä½ èƒ½å¤Ÿå°†ä¸€ä¸ªæ¦‚å¿µâ€œé”å®šâ€åœ¨ä¸€ä¸ªç‰©ä½“ä¸Šã€‚ä¾‹å¦‚ï¼Œå°†â€œåšå›ºâ€çš„æ¦‚å¿µé”å®šåœ¨ä¸€å¼ çº¸ä¸Šï¼Œè¿™å¼ çº¸å°±æ— æ³•è¢«æ’•è£‚ã€‚\">æ¦‚å¿µé”šå®š</option>\n    <option value=\"é•œç•Œæ²Ÿé€šï¼šä½ èƒ½å¤Ÿä¸ä¸€ä¸ªå¹³è¡Œä¸–ç•Œçš„ã€é€‰æ‹©äº†ä¸åŒé“è·¯çš„è‡ªå·±è¿›è¡ŒçŸ­æš‚çš„ç²¾ç¥äº¤æµï¼Œè·å–å¯¹æ–¹çš„çŸ¥è¯†æˆ–å»ºè®®ã€‚\">é•œç•Œæ²Ÿé€š</option>\n    <option value=\"ç‰©è´¨ç¼–è¯‘å™¨ï¼šä½ èƒ½å¤Ÿâ€œç¼–è¾‘â€éç”Ÿå‘½ç‰©è´¨çš„åŸºæœ¬å±æ€§ï¼Œæ¯”å¦‚æ”¹å˜ä¸€å—çŸ³å¤´çš„å¯†åº¦ï¼Œè®©å®ƒåƒæœ¨å¤´ä¸€æ ·è½»ã€‚æ•ˆæœæœ‰é™ä¸”æ¶ˆè€—å·¨å¤§ã€‚\">ç‰©è´¨ç¼–è¯‘å™¨</option>\n    <option value=\"å‘½è¿çš„å® å„¿ï¼šä½ è¢«ä¸–ç•Œæœ¬èº«æ‰€â€œåçˆ±â€ï¼Œå½“å‡ºç°æ¦‚ç‡æ€§çš„äº‹ä»¶æ—¶ï¼Œç»“æœæ€»ä¼šå‘å¯¹ä½ æœ‰åˆ©çš„æ–¹å‘å‘ç”Ÿå¾®å°çš„ã€å†³å®šæ€§çš„åç§»ã€‚\">å‘½è¿çš„å® å„¿</option>\n\n\n    <option value=\"å¥½ä¸ºäººå¸ˆç£é“ï¼šä½ æ•£å‘ç€ä¸€ç§å¥‡ç‰¹çš„ä¿¡æ¯ç´ ï¼Œä¼šè®©æ‰€æœ‰æ™ºæ…§ç”Ÿç‰©åœ¨ä¸ä½ äº¤è°ˆæ—¶ï¼Œä¸è‡ªè§‰åœ°æƒ³è¦å¯¹ä½ è¯´æ•™æˆ–çº æ­£ä½ ã€‚\">å¥½ä¸ºäººå¸ˆç£é“</option>\n    <option value=\"ä¸‡ç‰©é”ˆèš€ï¼šæ‰€æœ‰ä½ æŒæœ‰çš„é‡‘å±ç‰©å“ï¼ˆæ­¦å™¨ã€ç›”ç”²ã€é’±å¸ï¼‰ï¼Œå…¶è…æœ½å’Œç£¨æŸçš„é€Ÿåº¦ä¼šåŠ å¿«åå€ã€‚\">ä¸‡ç‰©é”ˆèš€</option>\n    <option value=\"ææ…Œç½®æ¢ï¼šä½ åœ¨ç´§å¼ æˆ–ææƒ§æ—¶ï¼Œä¼šéšæœºä¸å‘¨å›´çš„ä¸€ä¸ªç‰©ä½“ï¼ˆæ¯”å¦‚æ¡Œå­ã€çŸ³å¤´ã€å°¸ä½“ï¼‰äº¤æ¢ä½ç½®ã€‚\">ææ…Œç½®æ¢</option>\n    <option value=\"æ··ä¹±çš„å–„æ„ï¼šä½ é‡Šæ”¾çš„ä»»ä½•å¢ç›Šæ³•æœ¯ï¼ˆæ²»ç–—ã€åŠ æŒç­‰ï¼‰ï¼Œéƒ½æœ‰15%çš„æ¦‚ç‡ä½œç”¨åˆ°ç¦»ä½ æœ€è¿‘çš„æ•Œäººèº«ä¸Šã€‚\">æ··ä¹±çš„å–„æ„</option>\n    <option value=\"å®Œç¾çš„æŒ‡ç”²ç”Ÿé•¿ï¼šä½ çš„æŒ‡ç”²æ€»èƒ½é•¿å¾—åˆå¿«åˆå®Œç¾ï¼Œå½¢çŠ¶åŒ€ç§°ï¼Œå¯Œæœ‰å…‰æ³½ï¼Œä½†ç¡¬åº¦å’Œå…¶ä»–äººçš„æŒ‡ç”²æ²¡ä»€ä¹ˆä¸¤æ ·ã€‚\">å®Œç¾çš„æŒ‡ç”²ç”Ÿé•¿</option>\n<option value=\"å›å£°å®šä½ï¼ˆä¼ªï¼‰ï¼šä½ æ‹¥æœ‰å‡ºè‰²çš„å›å£°å®šä½èƒ½åŠ›ï¼Œä½†åªèƒ½ç²¾ç¡®å®šä½åˆ°ä½ è‡ªå·±å‘å‡ºçš„å£°éŸ³çš„æ¥æºã€‚\">å›å£°å®šä½ï¼ˆä¼ªï¼‰</option>\n<option value=\"ç°å°˜äº²å’ŒåŠ›ï¼šä½ æ¯”ä¸€èˆ¬äººæ›´å®¹æ˜“å¸å¼•ç°å°˜ï¼Œé™åç‰‡åˆ»èº«ä¸Šå°±ä¼šè½ä¸Šè–„è–„ä¸€å±‚ï¼Œåƒä¸€ä¸ªç§»åŠ¨çš„ç°å°˜æ”¶é›†å™¨ã€‚\">ç°å°˜äº²å’ŒåŠ›</option>\n<option value=\"å¯¹ç§°å¼ºè¿«ç—‡ï¼šä½ å¯¹è§†è§‰ä¸Šçš„ä¸å¯¹ç§°æœ‰ç§å¤©ç”Ÿçš„æ•æ„Ÿï¼Œçœ‹åˆ°æ­ªæ–œçš„ç”»æ¡†æˆ–ä¸å¯¹ç§°çš„æ‘†è®¾ä¼šè®©ä½ æ„Ÿåˆ°éš¾ä»¥å¿å—ã€‚\">å¯¹ç§°å¼ºè¿«ç—‡</option>\n<option value=\"æ°”æ³¡è†œä½“è´¨ï¼šä½ çš„çš®è‚¤åœ¨è¢«æŒ‰å‹æ—¶ï¼Œä¼šå‘å‡ºç±»ä¼¼æç ´æ°”æ³¡è†œçš„ã€ä»¤äººæ„‰æ‚¦çš„æ¸…è„†å£°å“ã€‚\">æ°”æ³¡è†œä½“è´¨</option>\n<option value=\"æ¤ç‰©è¯­å…¥é—¨ï¼šä½ èƒ½å¬æ‡‚æ¤ç‰©çš„è¯­è¨€ï¼Œä½†ä¸çŸ¥ä¸ºä½•ï¼Œå®ƒä»¬å¯¹ä½ è¯´çš„ä¼¼ä¹æ€»æ˜¯è„è¯ã€‚\">æ¤ç‰©è¯­å…¥é—¨</option>\n<option value=\"ç»å¯¹éŸ³é«˜ï¼ˆåå‘ï¼‰ï¼šä½ æ‹¥æœ‰ç»å¯¹éŸ³é«˜ï¼Œä½†åªåœ¨å¬åˆ°åˆ«äººå”±æ­Œè·‘è°ƒæ—¶æ‰èƒ½å‡†ç¡®è¯†åˆ«å‡ºåŸè°ƒã€‚\">ç»å¯¹éŸ³é«˜ï¼ˆåå‘ï¼‰</option>\n<option value=\"é£Ÿç‰©å¹»è§†ï¼šå½“ä½ æåº¦é¥¥é¥¿æ—¶ï¼Œè§†é‡ä¸­æ‰€æœ‰åœ†å½¢æˆ–æ¤­åœ†å½¢çš„ç‰©ä½“çœ‹èµ·æ¥éƒ½åƒç¾å‘³çš„é¢åŒ…ã€‚\">é£Ÿç‰©å¹»è§†</option>\n<option value=\"é™æ€ç€è£…ï¼šä½ çš„è¡£ç‰©æ°¸è¿œä¸ä¼šèµ·çš±ï¼Œä½†ä¹Ÿå› æ­¤æ›´å®¹æ˜“ç§¯èšé™ç”µã€‚\">é™æ€ç€è£…</option>\n<option value=\"å†å²çš„è„šæ­¥å£°ï¼šåœ¨å†å²æ‚ ä¹…çš„å¤é“ä¸Šï¼Œä½ å¶å°”èƒ½å¬åˆ°æ—©å·²é€å»ä¹‹äººç•™ä¸‹çš„è„šæ­¥å£°å›å“ã€‚\">å†å²çš„è„šæ­¥å£°</option>\n<option value=\"è‹”è—“é¢„æŠ¥å‘˜ï¼šé€šè¿‡ä»”ç»†è§‚å¯Ÿè‹”è—“çš„æ¹¿æ¶¦ç¨‹åº¦å’Œè‰²æ³½ï¼Œä½ èƒ½å‡†ç¡®é¢„æµ‹æ¥ä¸‹æ¥ä¸‰åˆ†é’Ÿå†…çš„å¤©æ°”ã€‚\">è‹”è—“é¢„æŠ¥å‘˜</option>\n<option value=\"é¢œè‰²å°å·ï¼šä½ èƒ½ä»ä¸€ä¸ªç‰©ä½“ä¸Šâ€œå·â€èµ°ä¸€å°å—é¢œè‰²ï¼Œä½¿è¯¥å¤„è¤ªè‰²ï¼Œè€Œä½ çš„æŒ‡å°–ä¼šæ²¾ä¸Šé‚£æŠ¹æ´—ä¸æ‰çš„è‰²å½©ã€‚\">é¢œè‰²å°å·</option>\n<option value=\"æƒ…ç»ªå’Œå¼¦ï¼šä½ çš„å„ç§æƒ…ç»ªä¼šåœ¨è„‘æµ·ä¸­è‡ªåŠ¨è°±æˆä¸€æ®µç‹¬ç‰¹çš„å’Œå¼¦ï¼Œä½†ä½ æ— æ³•åˆ†è¾¨å’Œå¼¦å…·ä½“å¯¹åº”å“ªç§æƒ…ç»ªã€‚\">æƒ…ç»ªå’Œå¼¦</option>\n<option value=\"å»¶è¿Ÿå–·åšï¼šæ‰€æœ‰æœ¬è¯¥åœ¨ç™½å¤©æ‰“çš„å–·åšï¼Œéƒ½ä¼šç´¯ç§¯åˆ°ä½ ç¡ç€ä¹‹åï¼Œä»¥ä¸€åœºå–·åšé£æš´çš„å½¢å¼é‡Šæ”¾ã€‚\">å»¶è¿Ÿå–·åš</option>\n<option value=\"è‡ªåŠ¨å¯¹é½ï¼šä½ éšæ‰‹æ”¾åœ¨ä¹¦æ¶ä¸Šçš„ä»»ä½•ä¹¦ç±ï¼Œéƒ½ä¼šè‡ªåŠ¨ä¸ä¹¦æ¶è¾¹ç¼˜å’Œæ—è¾¹çš„ä¹¦æœ¬å®Œç¾å¯¹é½ã€‚\">è‡ªåŠ¨å¯¹é½</option>\n<option value=\"æ¶²ä½“å¯†åº¦æ„ŸçŸ¥ï¼šç”¨æ‰‹æ§èµ·ä»»ä½•æ¶²ä½“ï¼Œä½ éƒ½èƒ½ç¬é—´æ„ŸçŸ¥åˆ°å…¶ç²¾ç¡®çš„å¯†åº¦æ•°å€¼ã€‚\">æ¶²ä½“å¯†åº¦æ„ŸçŸ¥</option>\n<option value=\"èœ˜è››ç½‘è­¦æŠ¥ï¼šå°±åœ¨ä½ çš„è„¸å³å°†æ’ä¸Šèœ˜è››ç½‘çš„å‰é›¶ç‚¹ä¸€ç§’ï¼Œä½ çš„å¤§è„‘ä¼šæ”¶åˆ°ä¸€æ¬¡å¼ºçƒˆçš„é¢„è­¦ã€‚\">èœ˜è››ç½‘è­¦æŠ¥</option>\n<option value=\"è°éŸ³å¤§å¸ˆï¼šä½ åœ¨è¯´è¯æ—¶ï¼Œæ€»èƒ½æ— æ„è¯†åœ°ã€ä¸”æ°åˆ°å¥½å¤„åœ°ä½¿ç”¨å„ç§åŒå…³è¯­å’ŒåŒéŸ³å¼‚ä¹‰è¯ã€‚\">è°éŸ³å¤§å¸ˆ</option>\n<option value=\"éª¨éª¼å¹¿æ’­ï¼šåœ¨å¤©æ°”å‰§çƒˆå˜åŒ–å‰ï¼Œä½ çš„éª¨éª¼ä¼šå‘å‡ºå¾®å¼±çš„ã€åªæœ‰ä½ èƒ½å¬è§çš„ä¿¡å·ï¼Œå†…å®¹é€šå¸¸æ˜¯éšæœºçš„è¯—æ­Œæœ—è¯µã€‚\">éª¨éª¼å¹¿æ’­</option>\n<option value=\"æ¢¦å¢ƒå­˜æ¡£å‘˜ï¼šä½ æ¯æ™šçš„æ¢¦å¢ƒéƒ½ä¼šè¢«è‡ªåŠ¨è½¬å½•æˆæ–‡å­—ï¼Œä¿å­˜åœ¨ä¸€æœ¬ä½ æ°¸è¿œæ‰¾ä¸åˆ°çš„é­”æ³•æ—¥è®°é‡Œã€‚\">æ¢¦å¢ƒå­˜æ¡£å‘˜</option>\n<option value=\"è¯­æ³•çº é”™è€…ï¼šä½ èƒ½ç«‹åˆ»å¬å‡ºä»–äººè¯è¯­ä¸­çš„ä»»ä½•è¯­æ³•é”™è¯¯ï¼Œå¹¶äº§ç”Ÿä¸€è‚¡éš¾ä»¥æŠ‘åˆ¶çš„çº æ­£å†²åŠ¨ã€‚\">è¯­æ³•çº é”™è€…</option>\n<option value=\"æ¯¯å­å ¡å’ï¼šåªè¦ç”¨æ¯¯å­æŠŠè‡ªå·±å®Œå…¨åŒ…è£¹èµ·æ¥ï¼Œä½ å°±ä¼šè·å¾—ä¸€ç§â€œç»å¯¹å®‰å…¨â€çš„å¿ƒç†æ…°è—‰ï¼Œç‰©ç†é˜²å¾¡åŠ›ä¸ºé›¶ã€‚\">æ¯¯å­å ¡å’</option>\n<option value=\"æ°´æœçš„æƒ…ç»ªï¼šä½ èƒ½æ¸…æ™°åœ°æ„ŸçŸ¥åˆ°æ°´æœä»ç”Ÿæ¶©åˆ°æˆç†Ÿçš„å–œæ‚¦ï¼Œä»¥åŠå¼€å§‹è…çƒ‚æ—¶çš„æ‚²ä¼¤ã€‚\">æ°´æœçš„æƒ…ç»ª</option>\n<option value=\"äººä½“æŒ‡å—é’ˆï¼šåœ¨éæ„Ÿå†’çŠ¶æ€ä¸‹ï¼Œä½ çš„é¼»å­æ€»ä¼šæ— æ„è¯†åœ°æœå‘æ­£åŒ—æ–¹ã€‚\">äººä½“æŒ‡å—é’ˆ</option>\n<option value=\"å•å‘ä¼ éŸ³ï¼šä½ èƒ½å°†è‡ªå·±çš„å£°éŸ³çŒå…¥ä¸€ä¸ªè´å£³ä¸­ï¼Œä»»ä½•æ‹¿åˆ°è´å£³çš„äººéƒ½èƒ½å¬åˆ°ï¼Œä½†å£°éŸ³æ— æ³•è¢«å†æ¬¡å–å‡ºã€‚\">å•å‘ä¼ éŸ³</option>\n<option value=\"æˆå‰§æ€§æ‘”å€’ï¼šä½ æ¯æ¬¡æ„å¤–æ‘”å€’æ—¶ï¼Œå§¿åŠ¿æ€»æ˜¯å¼‚å¸¸ä¼˜é›…ä¸”å¯Œæœ‰æˆå‰§æ€§ï¼Œå®›å¦‚èˆå°è¡¨æ¼”ã€‚\">æˆå‰§æ€§æ‘”å€’</option>\n<option value=\"æ— å£°å’å”±ï¼šä½ å¯ä»¥åœ¨è„‘æµ·ä¸­å®Œç¾åœ°å®Œæˆå†—é•¿çš„é­”æ³•å’’è¯­å’å”±ï¼Œä½†æ³•æœ¯å¹¶ä¸ä¼šå› æ­¤è€Œè§¦å‘ã€‚\">æ— å£°å’å”±</option>\n<option value=\"æƒ…æ„Ÿä½™å‘³ï¼šåƒå®Œä¸€é¤åï¼Œä½ èƒ½åœ¨å£ä¸­å›å‘³å‡ºçƒ¹é¥ªè€…åˆ¶ä½œè¿™é“èœæ—¶çš„ä¸»è¦æƒ…ç»ªã€‚\">æƒ…æ„Ÿä½™å‘³</option>\n<option value=\"äº‘æœµæ”¶è—å®¶ï¼šä½ æ‹¥æœ‰è¿‡ç›®ä¸å¿˜çš„èƒ½åŠ›ï¼Œä½†åªå¯¹å¤©ä¸Šçš„äº‘æœµæœ‰æ•ˆï¼Œä½ èƒ½è®°ä½è§è¿‡çš„æ¯ä¸€æœµäº‘çš„æ ·å­ã€‚\">äº‘æœµæ”¶è—å®¶</option>\n<option value=\"æ˜†è™«çš„æ•¬æ„ï¼šè¢«ä½ ä¸å°å¿ƒè¸©æ­»çš„æ˜†è™«ï¼Œä¼šåœ¨åŸåœ°ç•™ä¸‹ä¸€æœµæŒç»­ä¸€ç§’çš„ã€ç”±èƒ½é‡æ„æˆçš„å¾®å‹èŠ±æœµã€‚\">æ˜†è™«çš„æ•¬æ„</option>\n<option value=\"å®Œç¾å‰Šçš®ï¼šä½¿ç”¨ä»»ä½•å·¥å…·ç»™æ°´æœå‰Šçš®ï¼Œä½ éƒ½èƒ½å‰Šå‡ºä¸€æ¡å®Œæ•´çš„ã€ä»ä¸ä¸­æ–­çš„æœçš®ã€‚\">å®Œç¾å‰Šçš®</option>\n<option value=\"ç°å°˜è¯—äººï¼šä½ å‘¼å‡ºçš„æ°”æµèƒ½è®©é™„è¿‘çš„ç°å°˜åœ¨ç©ºä¸­çŸ­æš‚åœ°èšåˆæˆéšæœºçš„ã€ä¼˜ç¾çš„è¯è¯­ã€‚\">ç°å°˜è¯—äºº</option>\n<option value=\"ç“¶ä¸­ä¿¡ä½¿ï¼šä»»ä½•ä½ æŠ•å…¥æ°´ä¸­çš„æ¼‚æµç“¶ï¼Œæœ€ç»ˆéƒ½ä¼šè¢«å†²ä¸ŠæŸä¸ªæ— äººçŸ¥æ™“çš„è’å²›ã€‚\">ç“¶ä¸­ä¿¡ä½¿</option>\n<option value=\"å™ªéŸ³è¿‡æ»¤å™¨ï¼šä½ æ‹¥æœ‰ä¸»åŠ¨å±è”½åŠå¾„äº”ç±³å†…æ‰€æœ‰èšŠå­å—¡å—¡å£°çš„èƒ½åŠ›ã€‚\">å™ªéŸ³è¿‡æ»¤å™¨</option>\n<option value=\"æƒ…ç»ªå…‰æ™•ï¼šå½“ä½ å‡è§†ä¸€ä¸ªäººè¶…è¿‡åç§’ï¼Œèƒ½çœ‹åˆ°å¯¹æ–¹èº«ä¸Šæ¨¡ç³Šçš„æƒ…ç»ªå…‰æ™•ï¼Œä½†é¢œè‰²å’Œæƒ…ç»ªçš„å¯¹åº”å…³ç³»æ¯å¤©éšæœºå˜åŒ–ã€‚\">æƒ…ç»ªå…‰æ™•</option>\n<option value=\"éœ²ç æ”¶é›†è€…ï¼šæ¯å¤©æ¸…æ™¨é†’æ¥ï¼Œä½ çš„ç«æ¯›ä¸Šæ€»æ˜¯ä¼šæŒ‚æ»¡æ™¶è¹å‰”é€çš„éœ²ç ã€‚\">éœ²ç æ”¶é›†è€…</option>\n<option value=\"æ¸©åº¦è®°å¿†ï¼šä½ çš„çš®è‚¤èƒ½â€œè®°ä½â€ä¸Šä¸€ä¸ªæ¥è§¦ç‰©ä½“çš„å‡†ç¡®æ¸©åº¦ï¼Œå¹¶å°†å…¶ä¿æŒä¸€åˆ†é’Ÿã€‚\">æ¸©åº¦è®°å¿†</option>\n<option value=\"å½±å­æˆæ³•å¸ˆï¼šä½ çš„å½±å­èƒ½æƒŸå¦™æƒŸè‚–åœ°è¡¨æ¼”ä½ çœ‹è¿‡çš„ä»»ä½•çš®å½±æˆç‰‡æ®µã€‚\">å½±å­æˆæ³•å¸ˆ</option>\n<option value=\"ä¹¦æœ¬çš„å¹æ¯ï¼šå½“ä½ åˆä¸Šä¸€æœ¬å°šæœªè¯»å®Œçš„ä¹¦æ—¶ï¼Œä½ ä¼šå¬åˆ°å®ƒå‘å‡ºä¸€å£°å¾®ä¸å¯é—»çš„å¹æ¯ã€‚\">ä¹¦æœ¬çš„å¹æ¯</option>\n<option value=\"å‘³é“ç¿»è¯‘å®¶ï¼šä½ å¯ä»¥å°†ä»»ä½•å°åˆ°çš„å‘³é“ï¼Œåœ¨è„‘æµ·é‡Œâ€œç¿»è¯‘â€æˆä¸€æ®µæ— äººèƒ½æ‡‚çš„ç°ä»£è¯—ã€‚\">å‘³é“ç¿»è¯‘å®¶</option>\n<option value=\"å›å£°å˜è°ƒï¼šä½ åœ¨å±±è°·ä¸­å‘å–Šï¼Œå¬åˆ°çš„å›å£°ä¼šè‡ªåŠ¨å¸®ä½ æå‡ä¸€ä¸ªå…«åº¦ã€‚\">å›å£°å˜è°ƒ</option>\n<option value=\"éœ‰èŒè‰ºæœ¯å®¶ï¼šè¢«ä½ é—å¿˜çš„é£Ÿç‰©åœ¨å‘éœ‰æ—¶ï¼Œå…¶éœ‰èŒä¼šç”Ÿé•¿æˆä»¤äººæƒŠå¹çš„ç¾ä¸½å›¾æ¡ˆã€‚\">éœ‰èŒè‰ºæœ¯å®¶</option>\n<option value=\"æ°¸æ’çš„æ¸©çƒ­ï¼šä»»ä½•è¢«ä½ è§¦æ‘¸è¿‡çš„çŸ³å¤´ï¼Œéƒ½ä¼šæ°¸ä¹…æ€§åœ°æ¯”ç¯å¢ƒæ¸©åº¦é«˜å‡ºä¸€åº¦ã€‚\">æ°¸æ’çš„æ¸©çƒ­</option>\n<option value=\"æ³¡æ³¡è¯­ï¼šä½ å¹å‡ºçš„è‚¥çš‚æ³¡æ³¡åœ¨ç ´è£‚çš„ç¬é—´ï¼Œä¼šç”¨æå¾®å¼±çš„å£°éŸ³è¯´å‡ºâ€œä½ å¥½â€æˆ–â€œå†è§â€ã€‚\">æ³¡æ³¡è¯­</option>\n<option value=\"å¯†ç è¿‡æ•ï¼šå½“ä½ å°è¯•è§£è¯»å¤æ‚çš„å¯†ç æˆ–è°œé¢˜æ—¶ï¼Œä¼šç«‹åˆ»æ„Ÿåˆ°ä¸€é˜µè½»å¾®çš„å¤´ç—›ã€‚\">å¯†ç è¿‡æ•</option>\n<option value=\"èŠ‚å¥åŒæ­¥ï¼šä½ èµ°è·¯çš„æ­¥é¢‘ä¼šä¸è‡ªè§‰åœ°ä¸ç¦»ä½ æœ€è¿‘çš„äººä¿æŒå®Œå…¨ä¸€è‡´ã€‚\">èŠ‚å¥åŒæ­¥</option>\n<option value=\"æœˆå…‰å¢¨æ°´ï¼šåœ¨æœˆå…‰ä¸‹ä¹¦å†™ï¼Œä½ ä½¿ç”¨çš„ä»»ä½•å¢¨æ°´éƒ½ä¼šæ•£å‘å‡ºæ·¡æ·¡çš„é“¶å…‰ï¼Œå¤©äº®åå³æ¢å¤åŸæ ·ã€‚\">æœˆå…‰å¢¨æ°´</option>\n<option value=\"é™æ€æ”¶è—å®¶ï¼šä½ çš„å¤´å‘ç‰¹åˆ«å®¹æ˜“ç§¯èšé™ç”µï¼Œå¯ä»¥è½»æ¾å¸é™„èµ·å°çº¸ç‰‡æˆ–ç¾½æ¯›ã€‚\">é™æ€æ”¶è—å®¶</option>\n<option value=\"æ¤…å­é¢„çƒ­ï¼šä»»ä½•ä½ æ‰“ç®—åä¸‹çš„æ¤…å­ï¼Œéƒ½ä¼šåœ¨ä½ åä¸‹å‰ä¸€åˆ†é’Ÿè‡ªåŠ¨å‡æ¸©åˆ°æœ€èˆ’é€‚çš„æ¸©åº¦ã€‚\">æ¤…å­é¢„çƒ­</option>\n<option value=\"å€’å½±çš„ç§˜å¯†ï¼šä½ åœ¨æ°´ä¸­çš„å€’å½±ï¼Œå…¶è¡¨æƒ…æ€»æ˜¯æ¯”ä½ æœ¬äººè¦æ˜¾å¾—å¿§éƒä¸€äº›ã€‚\">å€’å½±çš„ç§˜å¯†</option>\n<option value=\"æ­Œå£°çš„è´¨æ„Ÿï¼šä½ èƒ½é€šè¿‡è†å¬ï¼Œæ„Ÿå—åˆ°æ­Œå£°çš„â€œè§¦æ„Ÿâ€ï¼Œæ¯”å¦‚ä¸æ»‘ã€ç²—ç³™ã€æ¸©æš–æˆ–å†°å†·ã€‚\">æ­Œå£°çš„è´¨æ„Ÿ</option>\n<option value=\"å†°éœœç”»æ‰‹ï¼šå†¬å¤©å¯¹ç€çª—æˆ·å“ˆæ°”ï¼Œå‡ç»“çš„å†°éœœä¼šè‡ªåŠ¨å½¢æˆä¸€å¹…éšæœºè€Œç²¾è‡´çš„é£æ™¯ç”»ã€‚\">å†°éœœç”»æ‰‹</option>\n<option value=\"çƒ›ç«çš„èˆä¼´ï¼šä½ ç‚¹ç‡ƒçš„ä»»ä½•èœ¡çƒ›ï¼Œå…¶ç«ç„°éƒ½ä¼šéšç€ä½ çš„å¿ƒè·³èŠ‚å¥åŒæ­¥æ‘‡æ›³ã€‚\">çƒ›ç«çš„èˆä¼´</option>\n<option value=\"è°è¨€çš„é‡é‡ï¼šä½ èƒ½æ„Ÿè§‰åˆ°åˆ«äººè¯´å‡ºçš„è°è¨€å¸¦æœ‰ç‰©ç†ä¸Šçš„â€œé‡é‡â€ï¼Œä½†æ— æ³•åˆ¤æ–­å…¶çœŸä¼ªã€‚\">è°è¨€çš„é‡é‡</option>\n<option value=\"æ— èŠçš„é¢„çŸ¥ï¼šä½ èƒ½å‡†ç¡®é¢„çŸ¥åˆ°æ¥ä¸‹æ¥äº”åˆ†é’Ÿå†…ï¼Œå°†ä¼šå‘ç”Ÿçš„ä¸€ä»¶æœ€æ— èŠã€æœ€æ²¡æœ‰æ„ä¹‰çš„äº‹æƒ…ã€‚\">æ— èŠçš„é¢„çŸ¥</option>\n<option value=\"å†å²çš„å›å“ï¼šåœ¨å¤æˆ˜åœºæˆ–å†å²é—è¿¹ï¼Œä½ èƒ½å¬åˆ°æ—©å·²æ¶ˆæ•£åœ¨é£ä¸­çš„ã€å¾®å¼±çš„å…µå™¨ç¢°æ’ä¸å‘å–Šå£°ã€‚\">å†å²çš„å›å“</option>\n<option value=\"å®Œç¾çš„å †å ï¼šä½ æ‹¥æœ‰å°†ä»»ä½•å¯å †å ç‰©å“ï¼ˆå¦‚çŸ³å¤´ã€ä¹¦ç±ã€ç›˜å­ï¼‰å †åˆ°å…¶ç‰©ç†æé™é«˜åº¦çš„å“è¶Šèƒ½åŠ›ã€‚\">å®Œç¾çš„å †å </option>\n<option value=\"é›¨æ»´åå¥æ›²ï¼šä¸‹é›¨æ—¶ï¼Œä½ èƒ½æ¸…æ™°åˆ†è¾¨æ¯ä¸€æ»´é›¨æ°´è½åœ¨ä¸åŒç‰©ä½“ä¸Šçš„éŸ³é«˜ï¼Œå¹¶åœ¨è„‘ä¸­è°±æˆä¹ç« ã€‚\">é›¨æ»´åå¥æ›²</option>\n<option value=\"æ²™å ¡å»ºç­‘å¸ˆï¼šä½ å †çš„æ²™å ¡å¼‚å¸¸åšå›ºï¼Œèƒ½è½»æ¾æŠµå¾¡æ™®é€šæµ·æµªçš„å†²åˆ·ï¼Œç›´åˆ°ä¸‹ä¸€æ¬¡å¤§æ¶¨æ½®ã€‚\">æ²™å ¡å»ºç­‘å¸ˆ</option>\n \n<option value=\"å¾®é£ä¼ è¯ï¼šä½ å¯ä»¥å°†è‡ªå·±çš„ä½è¯­é™„åœ¨å¾®é£ä¸Šï¼Œè®©å®ƒæ¸…æ™°åœ°ä¼ åˆ°é¡ºé£æ–¹å‘ä¸€ç™¾ç±³å†…æŒ‡å®šçš„äººè€³ä¸­ã€‚\">å¾®é£ä¼ è¯</option>\n<option value=\"åº”æ€¥ä¼ªè£…ï¼šåœ¨å—åˆ°ç”Ÿå‘½å¨èƒæ—¶ï¼Œä½ èƒ½è®©è‡ªå·±çš„å¤–è¡¨å˜å¾—å’Œå‘¨å›´ç¯å¢ƒä¸­çš„ä¸€å—æ™®é€šçŸ³å¤´æˆ–çŒæœ¨ä¸›éš¾ä»¥åŒºåˆ†ï¼ŒæŒç»­ä¸€åˆ†é’Ÿï¼ŒæœŸé—´æ— æ³•ç§»åŠ¨ã€‚\">åº”æ€¥ä¼ªè£…</option>\n<option value=\"é”åŒ ä¹‹å‹ï¼šä½ å¯¹é”å…·çš„å†…éƒ¨ç»“æ„æœ‰ä¸€ç§å¤©ç”Ÿçš„ç›´è§‰ï¼Œè¿™è®©ä½ åœ¨å¼€é”æ—¶æˆåŠŸç‡å¤§å¤§æé«˜ã€‚\">é”åŒ ä¹‹å‹</option>\n<option value=\"æƒ…ç»ªæ¸©åº¦è®¡ï¼šä½ èƒ½å¤§è‡´æ„ŸçŸ¥åˆ°å‘¨å›´æ™ºæ…§ç”Ÿç‰©çš„æƒ…ç»ªçŠ¶æ€ï¼Œå¦‚â€œæ¸©æš–â€ä»£è¡¨å–œæ‚¦ï¼Œâ€œå†°å†·â€ä»£è¡¨ææƒ§ã€‚\">æƒ…ç»ªæ¸©åº¦è®¡</option>\n<option value=\"è‰è¯ä½è¯­ï¼šé€šè¿‡è§¦æ‘¸æ¤ç‰©ï¼Œä½ èƒ½ç«‹åˆ»æ„ŸçŸ¥åˆ°å®ƒæ˜¯å¦å…·æœ‰è¯ç”¨ä»·å€¼ã€æ¯’æ€§æˆ–å¯é£Ÿç”¨æ€§ã€‚\">è‰è¯ä½è¯­</option>\n<option value=\"æ ‡è®°çŒç‰©ï¼šä½ å¯ä»¥å¯¹ä¸€ä¸ªç”Ÿç‰©æ–½åŠ ä¸€ä¸ªæŒç»­ä¸€å°æ—¶çš„æ— å½¢æ ‡è®°ï¼Œåœ¨åƒç±³èŒƒå›´å†…éƒ½èƒ½æ„ŸçŸ¥å…¶å¤§è‡´æ–¹å‘ã€‚\">æ ‡è®°çŒç‰©</option>\n<option value=\"è®°å¿†æ©¡çš®æ“¦ï¼šæ¯å¤©ä¸€æ¬¡ï¼Œä½ å¯ä»¥é€‰æ‹©æ€§åœ°è®©è‡ªå·±å®Œå…¨å¿˜è®°ä¸€æ®µä¸è¶…è¿‡ååˆ†é’Ÿçš„ã€ä¸æ„‰å¿«çš„è®°å¿†ã€‚\">è®°å¿†æ©¡çš®æ“¦</option>\n<option value=\"å¿«é€Ÿç¼åˆï¼šä½ æ‹¥æœ‰è¿œè¶…å¸¸äººçš„ä¼¤å£å¤„ç†æŠ€å·§å’Œé€Ÿåº¦ï¼Œèƒ½ç”¨æœ€ç®€å•çš„å·¥å…·å®Œæˆæœ‰æ•ˆçš„ç´§æ€¥ç¼åˆã€‚\">å¿«é€Ÿç¼åˆ</option>\n<option value=\"å·¥å…·å…±é¸£ï¼šå½“ä½ æ‹¿èµ·ä¸€ä»¶å·¥å…·æ—¶ï¼Œèƒ½ç«‹åˆ»é¢†æ‚Ÿåˆ°å®ƒæœ€çœåŠ›ã€æœ€æœ‰æ•ˆçš„ä½¿ç”¨æ–¹å¼ã€‚\">å·¥å…·å…±é¸£</option>\n<option value=\"æ°´è´¨å‡€åŒ–ï¼šé€šè¿‡æŒç»­æ¥è§¦ï¼Œä½ èƒ½ç¼“æ…¢åœ°å‡€åŒ–ä¸€å°æ§æ°´ï¼Œä½¿å…¶è¾¾åˆ°å¯å®‰å…¨é¥®ç”¨çš„æ ‡å‡†ã€‚\">æ°´è´¨å‡€åŒ–</option>\n<option value=\"æ–¹å‘æ„Ÿæ ¡å‡†ï¼šæ¯å¤©ä¸€æ¬¡ï¼Œä½ å¯ä»¥åœ¨ä»»ä½•åœ°æ–¹ç¬é—´åœ¨è„‘æµ·ä¸­æ˜ç¡®è‡ªå·±ç›¸å¯¹äºå‡ºç”Ÿç‚¹çš„ç²¾ç¡®æ–¹ä½ã€‚\">æ–¹å‘æ„Ÿæ ¡å‡†</option>\n<option value=\"é‡å…½çš„å–„æ„ï¼šåœ¨éé¥¥é¥¿çŠ¶æ€ä¸‹ï¼Œå¤§å¤šæ•°é‡å…½ä¸ä¼šä¸»åŠ¨æ”»å‡»ä½ ï¼Œé™¤éä½ å…ˆè¡¨éœ²å‡ºå¼ºçƒˆçš„æ•Œæ„ã€‚\">é‡å…½çš„å–„æ„</option>\n<option value=\"å¾®å…‰è§†è§‰ï¼šåœ¨åªæœ‰æ˜Ÿå…‰æˆ–æœˆå…‰çš„å¾®å…‰ç¯å¢ƒä¸‹ï¼Œä½ çš„è§†åŠ›å‡ ä¹ä¸ç™½å¤©æ— å¼‚ã€‚\">å¾®å…‰è§†è§‰</option>\n<option value=\"è­¦è§‰ä¹‹çœ ï¼šä½ åœ¨ç¡çœ æ—¶ä¾ç„¶å¯¹å‘¨å›´çš„å±é™©æ°”æ¯ä¿æŒç€æœ€ä½é™åº¦çš„è­¦è§‰ï¼Œæ›´å®¹æ˜“è¢«å¼‚åŠ¨æƒŠé†’ã€‚\">è­¦è§‰ä¹‹çœ </option>\n<option value=\"äº¤æ˜“ç›´è§‰ï¼šåœ¨è¿›è¡Œäº¤æ˜“æ—¶ï¼Œä½ æ€»èƒ½å‡­ç›´è§‰åˆ¤æ–­å‡ºå¯¹æ–¹çš„æŠ¥ä»·æ˜¯å…¬å¹³ã€å ä¾¿å®œè¿˜æ˜¯æ•²ç«¹æ ã€‚\">äº¤æ˜“ç›´è§‰</option>\n<option value=\"å¼ºæ•ˆæ¶ˆåŒ–ï¼šä½ çš„æ¶ˆåŒ–ç³»ç»Ÿèƒ½åˆ†è§£æŸäº›é€šå¸¸æ— æ³•é£Ÿç”¨çš„æ¤ç‰©æ ¹èŒï¼Œå¹¶ä»ä¸­æ±²å–å°‘é‡èƒ½é‡ã€‚\">å¼ºæ•ˆæ¶ˆåŒ–</option>\n<option value=\"æ— å£°è„šæ­¥ï¼šå½“ä½ é›†ä¸­ç²¾ç¥åˆ»æ„æ”¾è½»è„šæ­¥æ—¶ï¼Œå‡ ä¹ä¸ä¼šå‘å‡ºä»»ä½•å¯ä»¥è¢«å¯Ÿè§‰çš„å£°éŸ³ã€‚\">æ— å£°è„šæ­¥</option>\n<option value=\"ç—•è¿¹è¿½è¸ªï¼šä½ å¯¹è¿½è¸ªç”Ÿç‰©ç•™ä¸‹çš„ç—•è¿¹ï¼ˆè„šå°ã€æ–­æã€æ°”å‘³æ®‹ç•™ï¼‰æœ‰ç€å¤©ç”Ÿçš„æ•é”ç›´è§‰ã€‚\">ç—•è¿¹è¿½è¸ª</option>\n<option value=\"ç®€æ˜“é™·é˜±å¤§å¸ˆï¼šä½ èƒ½ç”¨éšå¤„å¯è§çš„ææ–™ï¼Œå¿«é€Ÿè®¾ç½®å‡ºæ•ˆæœæ˜¾è‘—çš„ã€ç”¨äºæ•æ‰å°åŠ¨ç‰©æˆ–è­¦ç¤ºçš„ç®€æ˜“é™·é˜±ã€‚\">ç®€æ˜“é™·é˜±å¤§å¸ˆ</option>\n<option value=\"å¤©æ°”é¢„æŠ¥å‘˜ï¼šé€šè¿‡è§‚å¯Ÿäº‘å±‚ã€é£å‘å’Œç©ºæ°”æ¹¿åº¦çš„ç»†å¾®å˜åŒ–ï¼Œä½ èƒ½ç›¸å½“å‡†ç¡®åœ°é¢„æµ‹æœªæ¥åäºŒå°æ—¶çš„å¤©æ°”ã€‚\">å¤©æ°”é¢„æŠ¥å‘˜</option>\n\n \n\n<option value=\"å› æœçº¿å‰ªè¾‘ï¼šæ¯å¤©ä¸€æ¬¡ï¼Œä½ å¯ä»¥é€‰æ‹©ä¸€ä¸ªåˆšåˆšå‘ç”Ÿçš„ã€å½±å“ä¸å¤§çš„äº‹ä»¶ï¼ˆå¦‚æ‰“ç¿»æ°´æ¯ï¼‰ï¼Œå¹¶ä»å› æœä¸­â€œå‰ªé™¤â€å®ƒï¼Œä½¿ä¹‹ä»æœªå‘ç”Ÿã€‚\">å› æœçº¿å‰ªè¾‘</option>\n<option value=\"å…ƒç´ äº²å’Œï¼šä½ å¯¹æŸä¸€ç§å…ƒç´ ï¼ˆç«ã€æ°´ã€é£ã€åœŸç­‰ï¼‰æœ‰è¶…å‡¡çš„äº²å’ŒåŠ›ï¼Œå­¦ä¹ å’Œæ–½å±•è¯¥ç³»æ³•æœ¯æ—¶äº‹åŠåŠŸå€ï¼Œä¸”å¨åŠ›ä¸æ§åˆ¶åŠ›æ˜¾è‘—æå‡ã€‚\">å…ƒç´ äº²å’Œ</option>\n<option value=\"çµé­‚ä½è¯­ï¼šä½ èƒ½ä¸ä»»ä½•æ¿’æ­»ï¼ˆç”Ÿå‘½æœ€åä¸€åˆ†é’Ÿï¼‰çš„ç”Ÿç‰©è¿›è¡ŒçŸ­æš‚çš„ç²¾ç¥äº¤æµï¼Œè¯»å–ä»–ä»¬æœ€åã€æœ€å¼ºçƒˆçš„æ®‹å¿µæˆ–ä¿¡æ¯ã€‚\">çµé­‚ä½è¯­</option>\n<option value=\"å­˜åœ¨ç¨€é‡Šï¼šåªè¦ä½ èº«å¤„é˜´å½±ä¹‹ä¸­ï¼Œå°±å¯ä»¥é€‰æ‹©æ€§åœ°å¤§å¹…é™ä½è‡ªèº«çš„å­˜åœ¨æ„Ÿï¼Œèƒ½æœ‰æ•ˆè§„é¿å¤§éƒ¨åˆ†éæŒ‡å‘æ€§çš„ä¾¦æµ‹ã€‚\">å­˜åœ¨ç¨€é‡Š</option>\n<option value=\"è¡€è„‰è§‰é†’ï¼šåœ¨ç”Ÿå‘½å‚å±çš„ç¬é—´ï¼Œä½ æœ‰ä¸€å®šå‡ ç‡å”¤é†’ä½“å†…æ½œè—çš„å¤è€è¡€è„‰ï¼ŒçŸ­æ—¶é—´å†…è·å¾—å¼ºå¤§çš„åŠ›é‡æˆ–ä¸€é¡¹å…¨æ–°çš„ç‰¹æ®Šèƒ½åŠ›ã€‚\">è¡€è„‰è§‰é†’</option>\n<option value=\"å¥‘çº¦ä¹‹è¨€ï¼šä½ è¯´å‡ºçš„ã€ä»¥â€œæˆ‘æ‰¿è¯ºâ€ä¸ºå¼€å¤´çš„å¥å­ï¼Œä¼šå¯¹ä½ å’Œè†å¬è€…äº§ç”Ÿå¾®å¼±çš„å¥‘çº¦æŸç¼šåŠ›ã€‚è‹¥ä½ è¿èƒŒï¼Œä¼šé­å—å„è¿ï¼›è‹¥ä»–äººå¸®åŠ©ä½ å®Œæˆï¼Œä¼šè·å¾—å¥½è¿ã€‚\">å¥‘çº¦ä¹‹è¨€</option>\n<option value=\"ç»å¯¹æ¨¡ä»¿ï¼šäº²çœ¼ç›®ç¹ä¸€ä¸ªéè¶…å‡¡çš„ã€çº¯ç²¹çš„æŠ€å·§æ€§åŠ¨ä½œåï¼ˆå¦‚ä¸€æ¬¡å®Œç¾çš„å°„å‡»ã€ä¸€æ®µå¤æ‚çš„å‰‘èˆï¼‰ï¼Œä½ å¯ä»¥åœ¨æ¥ä¸‹æ¥çš„ä¸€åˆ†é’Ÿå†…å®Œç¾å¤ç°ä¸€æ¬¡ã€‚\">ç»å¯¹æ¨¡ä»¿</option>\n<option value=\"å¿ƒçµå£å’ï¼šä½ çš„å¿ƒæ™ºå¦‚åŒä¸€åº§åšå›ºçš„å ¡å’ï¼Œå¤©ç”Ÿå°±èƒ½æŠµæŠ—å¤§éƒ¨åˆ†ç²¾ç¥æ¢æŸ¥ã€å¿ƒçµæ§åˆ¶å’Œæƒ…ç»ªæ“çºµç±»çš„æ³•æœ¯æˆ–èƒ½åŠ›ã€‚\">å¿ƒçµå£å’</option>\n<option value=\"çŸ­è·ä¼ é€ï¼šæ¯å¤©å¯ä»¥ä½¿ç”¨æ•°æ¬¡ï¼Œç¬é—´å°†è‡ªå·±ä¼ é€åˆ°è§†çº¿æ‰€åŠçš„åç±³å†…ä»»æ„ä¸€ä¸ªæ— éšœç¢çš„åœ°ç‚¹ã€‚\">çŸ­è·ä¼ é€</option>\n<option value=\"å†ç”Ÿä¹‹èº¯ï¼šä½ çš„èº«ä½“æ‹¥æœ‰ç¼“æ…¢ä½†æŒç»­çš„è‡ªæ„ˆèƒ½åŠ›ï¼Œæ‰€æœ‰éè‡´å‘½æ€§çš„åˆ›ä¼¤éƒ½ä¼šä»¥è‚‰çœ¼å¯è§çš„é€Ÿåº¦ç¼“æ…¢æ„ˆåˆï¼Œä¸”ä¸ä¼šç•™ä¸‹ç–¤ç—•ã€‚\">å†ç”Ÿä¹‹èº¯</option>\n \n\n<option value=\"é­”æ³•å¢å¹…ï¼šä½ æ–½å±•çš„æ‰€æœ‰æ³•æœ¯ï¼Œå…¶å¨åŠ›ä¼šä¸ç”±è‡ªä¸»åœ°å¢åŠ 30%ï¼Œä½†æ³•åŠ›æ¶ˆè€—ä¹ŸåŒæ—¶å¢åŠ 100%ã€‚\">é­”æ³•å¢å¹…</option>\n<option value=\"å…±æƒ…è¿‡è½½ï¼šä½ ä¼šå¼ºåˆ¶æ€§åœ°ã€èº«ä¸´å…¶å¢ƒåœ°æ„Ÿå—åˆ°å‘¨å›´æ‰€æœ‰äººçš„å¼ºçƒˆæƒ…ç»ªï¼Œå¹¶ä¼šä¸ç”±è‡ªä¸»åœ°åœ¨è¡¨æƒ…å’ŒåŠ¨ä½œä¸Šè¡¨ç°å‡ºæ¥ã€‚\">å…±æƒ…è¿‡è½½</option>\n<option value=\"ç»å¯¹å¸å¼•ï¼šåœ¨æˆ˜æ–—ä¸­ï¼Œæ‰€æœ‰é£è¡Œé“å…·ï¼ˆæ— è®ºæ•Œæˆ‘ï¼‰çš„å¼¹é“éƒ½æœ‰å¾®å°çš„å‡ ç‡å‘ä½ çš„èº«ä½“åç§»ã€‚\">ç»å¯¹å¸å¼•</option>\n<option value=\"è¯šå®çš„ä»£ä»·ï¼šä½ æ— æ³•è¯´è°ã€‚ä¸€æ—¦å°è¯•ï¼Œä½ ä¸ä»…ä¼šå¤±è´¥ï¼Œè¿˜ä¼šè„±å£è€Œå‡ºå¦ä¸€ä¸ªæ›´åŠ å°´å°¬æˆ–è‡´å‘½çš„çœŸç›¸ã€‚\">è¯šå®çš„ä»£ä»·</option>\n<option value=\"è´¢å¯Œæ–¥åŠ›ï¼šä½ æŒæœ‰çš„ä»»ä½•å½¢å¼çš„è´§å¸ï¼Œéƒ½ä¼šä»¥å„ç§ç¦»å¥‡çš„æ–¹å¼ï¼ˆè¢«å·ã€é—å¤±ã€æ„å¤–æŸåã€ä¸å°å¿ƒæèµ ï¼‰è¿…é€Ÿåœ°ç¦»ä½ è€Œå»ã€‚\">è´¢å¯Œæ–¥åŠ›</option>\n<option value=\"åå‘æ²»æ„ˆï¼šå½“ä½ å¯¹ä»–äººæ–½å±•æ²»ç–—æˆ–åŒ…æ‰æ—¶ï¼Œæœ‰10%çš„æ¦‚ç‡å°†å¯¹æ–¹çš„ä¼¤åŠ¿å®Œç¾åœ°è½¬ç§»åˆ°è‡ªå·±èº«ä¸Šã€‚\">åå‘æ²»æ„ˆ</option>\n<option value=\"ä¸»è§’å…¬æ•Œï¼šä½ å¤©ç”Ÿå°±æ•£å‘ç€ä¸€ç§ç‹¬ç‰¹çš„æ°”åœºï¼Œææ˜“è¢«é‚£äº›èº«è´Ÿâ€œå¤©å‘½â€æˆ–è‡ªè®¤â€œä¸»è§’â€çš„äººè§†ä¸ºæ½œåœ¨çš„ç«äº‰å¯¹æ‰‹æˆ–å¿…é¡»é“²é™¤çš„éšœç¢ã€‚\">ä¸»è§’å…¬æ•Œ</option>\n<option value=\"è¨€å‡ºæ³•éšï¼ˆè´Ÿé¢é™å®šï¼‰ï¼šä½ æ‰€æœ‰æ— æ„ä¸­è¯´å‡ºçš„è´Ÿé¢çŒœæƒ³ï¼ˆæ¯”å¦‚â€œå‰é¢è¯¥ä¸ä¼šæœ‰åŸ‹ä¼å§â€ï¼‰ï¼Œå…¶æˆçœŸçš„æ¦‚ç‡ä¼šå¤§å¹…åº¦æå‡ã€‚\">è¨€å‡ºæ³•éšï¼ˆè´Ÿé¢é™å®šï¼‰</option>\n<option value=\"ç‰©å“èƒŒå›ï¼šåœ¨æœ€å…³é”®çš„æ—¶åˆ»ï¼Œä½ æ‰€ä¾èµ–çš„ç‰©å“ï¼ˆæ­¦å™¨ã€å·¥å…·ã€ç»³ç´¢ï¼‰æœ‰ä¸€å®šæ¦‚ç‡ä¼šçªç„¶æ–­è£‚ã€å¤±çµæˆ–è„±æ‰‹ã€‚\">ç‰©å“èƒŒå›</option>\n<option value=\"å‹å†›ä¹‹å›´ï¼šåœ¨æ··ä¹±çš„æˆ˜æ–—ä¸­ï¼Œä½ çš„ç›Ÿå‹ä¼¼ä¹æ€»æ˜¯ä¼šä¸è‡ªè§‰åœ°å°†ä½ çº³å…¥ä»–ä»¬èŒƒå›´æ”»å‡»çš„è¾¹ç¼˜åŒºåŸŸã€‚\">å‹å†›ä¹‹å›´</option>  \n\n                            </select>\n                            <div id=\"custom-talent-scroll\"></div>\n\n                         </div>\n                     </div>\n                 </div>\n            </div>\n        </div>\n\n\n        <div class=\"planet\" id=\"planet-teammates\">\n            <div class=\"planet-icon-container\">\n                <div class=\"planet-icon\">âœ¤</div>\n                <div class=\"planet-title\" id=\"teammate-section-label\">é˜Ÿå‹é…ç½®</div>\n            </div>\n            <div class=\"planet-content\">\n                <button class=\"close-planet-btn\">Ã—</button>\n                <div class=\"form-section\">\n                    <h2 class=\"form-title\">// é˜Ÿå‹è®¾ç½®</h2>\n                    <div class=\"collapsible-content-placeholder\">\n                        <div class=\"teammate-gear-controls\">\n                            <div class=\"gear-group\">\n                                <label for=\"teammate-count\" id=\"teammate-count-label\">äººæ•°</label>\n                                <div class=\"gear-select\">\n                                    <select id=\"teammate-count\" class=\"custom-select\">\n                                        <option value=\"-1\">éšæœº</option><option value=\"0\">0</option><option value=\"1\">1</option><option value=\"2\">2</option><option value=\"3\">3</option><option value=\"4\">4</option><option value=\"5\">5</option><option value=\"6\">6</option><option value=\"7\">7</option><option value=\"8\">8</option><option value=\"9\">9</option><option value=\"10\">10</option>\n                                    </select>\n                                </div>\n                            </div>\n                            <div class=\"gear-group\">\n                                <label for=\"teammate-tendency\">å€¾å‘</label>\n                                <div class=\"gear-select\">\n                                     <select id=\"teammate-tendency\" class=\"custom-select\">\n                                         <option value=\"å‹å–„åˆä½œ\">å‹å–„</option><option value=\"ä¸­ç«‹è°¨æ…\">ä¸­ç«‹</option><option value=\"ç«äº‰æ¿€çƒˆ\">ç«äº‰</option><option value=\"æ··ä¹±é‚ªæ¶\">æ··æ²Œ</option><option value=\"éšæœºç”Ÿæˆ\">éšæœº</option><option value=\"è‡ªå®šä¹‰\">è‡ªå®šä¹‰</option>\n                                     </select>\n                                </div>\n                            </div>\n                        </div>\n                        <div class=\"fixed-team-toggle\" id=\"fixed-team-toggle\">\n                            <input type=\"checkbox\" id=\"is-fixed-team\">\n                            <label for=\"is-fixed-team\" class=\"toggle-label\"></label>\n                            <span>å›ºå®šå°é˜Ÿ</span>\n                        </div>\n                        <div id=\"custom-teammates-container\" class=\"teammate-card-stack\">\n                            <div class=\"stack-header\">\n                                <div>è‡ªå®šä¹‰ä¿¡æ¯ (å¯å·¦å³æ»‘åŠ¨)</div>\n                                <div class=\"stack-controls\">\n                                   <button id=\"load-teammates-btn\" type=\"button\" class=\"teammate-action-btn\">è¯»å–</button>\n                                   <button id=\"save-teammates-btn\" type=\"button\" class=\"teammate-action-btn\">ä¿å­˜</button>\n                                   <button type=\"button\" class=\"teammate-action-btn\" onclick=\"addTeammate()\">+</button>\n                                </div>\n                            </div>\n                            <div id=\"teammates-list\"></div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n\n\n        <button id=\"next-page-button\" class=\"primary-cta-btn\" style=\"position: absolute; bottom: 0; left: 50%; transform: translateX(-50%); width: 100px; height: 100px; font-size: 50px;\">â†’</button>\n\n    </div>\n</div>\n\n<div id=\"page-2\" class=\"init-page\">\n<div id=\"galaxy-points-display\">\n\n    <div class=\"points-info\">\n        <div class=\"points-bar-container\">\n            <div id=\"points-bar\"></div>\n        </div>\n        <span id=\"remaining-points-text\">70</span>\n    </div>\n\n\n\n</div>\n\n   <div id=\"top-hud\" class=\"hud top-hud\">\n        <div class=\"hud-toggle\" data-target=\"top-hud\"></div>\n        <div class=\"hud-content\">\n\n            <div class=\"points-tracker\">\n                <div id=\"points-display-container\" style=\"display: none;\">\n                    <div id=\"points-ring-container\">\n\n                        <svg id=\"points-ring-bg\" width=\"50\" height=\"50\">\n                            <circle cx=\"25\" cy=\"25\" r=\"22\" stroke=\"var(--border-color)\" stroke-width=\"3\" fill=\"none\"/>\n                        </svg>\n                        <svg id=\"points-ring\" width=\"50\" height=\"50\">\n                            <circle cx=\"25\" cy=\"25\" r=\"22\" stroke=\"var(--primary-color)\" stroke-width=\"3\" fill=\"none\" stroke-linecap=\"round\"\n                                stroke-dasharray=\"138.23\" stroke-dashoffset=\"138.23\" transform=\"rotate(-90 25 25)\"/>\n                        </svg>\n                        <span id=\"remaining-points\">70</span>\n                    </div>\n                   <span>å‰©ä½™æ„ç­‘ç‚¹</span>\n                </div>\n\n                \n               \n            </div>\n    <div class=\"points-actions\">\n\n         <div class=\"form-group\" style=\"text-align: center;\">\n                    <select id=\"total-points-select\" class=\"custom-select\" style=\"width: auto;\">\n                        <option value=\"70\">å……è£• (70)</option>\n                        <option value=\"55\">æ ‡å‡† (55)</option>\n                        <option value=\"40\">æ®‹ç–¾ (40)</option>\n                        <option value=\"0\">åœ°ç‹± (0)</option>\n                        <option value=\"custom\">è‡ªå®šä¹‰</option>\n                    </select>\n                    <input type=\"number\" id=\"custom-total-points\" min=\"1\" value=\"70\" style=\"display: none; width: 80px; margin-top: 5px;\">\n                </div>\n                                <div class=\"template-controls\">\n                    <select id=\"template-select-init\" class=\"custom-select\" placeholder=\"è¯»å–æ¨¡æ¿\"></select>\n                     \n                </div>\n                 <button id=\"average-points-btn\" class=\"action-button\">å¹³å‡åˆ†é…</button>\n    </div>\n\n <button id=\"arrange-stars-btn\" class=\"action-button\">æ•´ç†æ’åˆ—</button>\n            <div class=\"template-manager\">\n                <div class=\"template-controls\">\n                    <select id=\"template-select\" class=\"custom-select\" placeholder=\"è¯»å–æ¨¡æ¿\" style=\"display: none;\"></select>\n                    <button id=\"delete-template-btn\" class=\"action-button danger-button\">åˆ é™¤å½“å‰æ¨¡æ¿</button>\n                </div>\n                <div id=\"save-template-form\">\n                    <input type=\"text\" id=\"save-template-name\" placeholder=\"å°†å½“å‰åŠ ç‚¹ä¿å­˜ä¸ºæ¨¡æ¿\">\n                    <button id=\"save-template-btn\" class=\"action-button\">ä¿å­˜</button>\n                </div>\n            </div>\n        </div>\n    </div>\n\n\n  <div id=\"galaxy-container\">\n    <div id=\"wrapper-physic\" class=\"galaxy-wrapper\">\n    <div id=\"galaxy-physic\" class=\"galaxy-system\" data-galaxy=\"physic\"></div>\n</div>\n\n<div id=\"wrapper-mental\" class=\"galaxy-wrapper\">\n    <div id=\"galaxy-mental\" class=\"galaxy-system\" data-galaxy=\"mental\"></div>\n</div>\n\n<div id=\"wrapper-social\" class=\"galaxy-wrapper\">\n    <div id=\"galaxy-social\" class=\"galaxy-system\" data-galaxy=\"social\"></div>\n</div>\n\n<div id=\"galaxy-nav-prev\" class=\"galaxy-nav\">&lt;</div>\n<div id=\"galaxy-nav-next\" class=\"galaxy-nav\">&gt;</div>\n</div>\n\n  <div id=\"bottom-hud\" class=\"hud bottom-hud\">\n        <div class=\"hud-toggle\" data-target=\"bottom-hud\"></div>\n        <div class=\"hud-content\">\n\n             <div id=\"concept-section\" class=\"form-grid\" style=\"grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1.5rem;\">\n\n            </div>\n\n\n            <div class=\"button-container\">\n                <div class=\"form-group\" style=\"margin-bottom: 1rem; text-align: center;\">\n                    <select id=\"send-mode-select\" class=\"custom-select\" style=\"max-width: 250px; margin: 0 auto;\">\n                        <option value=\"auto\">è‡ªåŠ¨å‘é€</option>\n                        <option value=\"manual\">æ‰‹åŠ¨å‘é€</option>\n                    </select>\n                </div>\n                <div style=\"display: flex; gap: 0.8rem; justify-content: center; flex-wrap: wrap;\">\n                    <button id=\"init-button\" class=\"action-button\">[ <æ ¡å‡†å¹¶ä¼ é€> ]</button>\n                    <button id=\"god-space-button\" class=\"action-button secondary-button\">[ <äºå®‰å…¨åŒºåŸŸé†’æ¥> ]</button>\n                    <button id=\"custom-action-button\" class=\"action-button\" style=\"background-color: var(--info-color, #4db6ac); border-color: #5a944b;\">[ <è‡ªå®šä¹‰> ]</button>\n                </div>\n            </div>\n\n\n            <div id=\"custom-action-input-container\" style=\"display: none; margin-top: 1.5rem;\">\n                 <input type=\"text\" id=\"custom-action-input\" placeholder=\"è¯·åœ¨è¿™é‡Œè¾“å…¥ä½ çš„è‡ªå®šä¹‰è¯´æ˜æ–‡å­—\" style=\"width: 100%; box-sizing: border-box; margin-bottom: 0.8rem;\">\n                 <div style=\"display: flex; align-items: center; gap: 0.5rem;\" >\n                    <input type=\"checkbox\" id=\"add-world-prefix-checkbox\" style=\"transform: scale(1.2); cursor: pointer;\" checked>\n                    <label for=\"add-world-prefix-checkbox\" style=\"margin-bottom: 0; cursor: pointer; user-select: none;\">ä¸ºè¯¥æŒ‡ä»¤é™„åŠ ä¸–ç•ŒèƒŒæ™¯</label>\n                </div>\n            </div>\n            <div id=\"warning-message\" class=\"warning-message\" style=\"display: none; margin-top: 1rem; color: #ffcc00; text-align: center;\">\n                æç¤ºï¼šå‚æ•°å·²ä¸Šä¼ ï¼Œæ­£åœ¨æ„å»ºè§’è‰²æ•°æ®ï¼Œä½ å°†åœ¨çŸ­æš‚çš„æ„è¯†æ¨¡ç³Šåäºä¸»ç¥ç©ºé—´é†’æ¥ï¼Œæ— æ³•ç«‹å³è¿›å…¥ä»»åŠ¡ã€‚\n            </div>\n        </div>\n    </div>\n</div>\n  </div>    \n<div id=\"main-wrapper\">\n <div class=\"status-container\">\n    <header>\n        <div class=\"header-content\">\n            <div id=\"update-notifier\" style=\"display: none;\">!</div>\n            <h1 id=\"world-shard\">SYSTEM TERMINAL</h1>\n            <div class=\"header-info-bar\">\n    <div class=\"info-group\">\n        <span class=\"info-item\">\n            <span class=\"info-label\">ä½ç½®:</span>\n            <span id=\"header-location\" class=\"info-value\">--</span>\n        </span>\n        <span class=\"info-item\">\n            <span class=\"info-label\">æ—¶é—´:</span>\n            <span id=\"header-time\" class=\"info-value\">--</span>\n        </span>\n    </div>\n    <div class=\"info-group\">\n        <span class=\"info-item\">\n            <span class=\"info-label\">é»˜è®¤æ£€å®š:</span>\n            <span id=\"header-check\" class=\"info-value\">--</span>\n        </span>\n        <span class=\"info-item\">\n            <span class=\"info-label\">æ•Œæ–¹:</span>\n            <span id=\"header-combat\" class=\"info-value\">--</span>\n        </span>\n        <span class=\"info-item\">\n            <span class=\"info-label\">éš¾åº¦:</span>\n            <span id=\"header-difficulty\" class=\"info-value\">--</span>\n        </span>\n    </div>\n</div>\n<button id=\"fullscreen-btn\" title=\"å…¨å±\">\n    â›¶\n</button>\n <button id=\"settings-btn\" title=\"è®¾ç½®\">\n    âš™\n</button>\n <button id=\"refresh-btn\" title=\"åˆ·æ–°\">\n    âŸ²\n</button>\n\n \n        </div>\n    </header>\n\n\n\n    <div class=\"content-area\" id=\"chat-display-area\">\n\n    </div>\n<div id=\"dynamic-content-area\" class=\"dynamic-content-area\">\n\n<!-- å¤–éƒ¨æ¨¡å—å ä½ï¼Œä»–å¦ˆçš„éº»çƒ¦å•Šå•Šå•Šå•Šå•Šå•Šå•Šå•Šå•Šå•Šå•Š -->\n    <div id=\"options-module-container\" class=\"module-container\" style=\"display: none;\">\n  <div class=\"options-container\">\n        <div class=\"choices-container\" id=\"choicesContainer\">\n\n        </div>\n    </div>\n\n    <div class=\"skill-orb-container\">\n        <div class=\"skill-orb\" id=\"skillOrb\">è¡“</div>\n    </div>\n    <div class=\"skill-panel\" id=\"skillPanel\">\n        <div class=\"skill-list\" id=\"skillList\">\n            <p style=\"color: grey; font-size: 14px; text-align: center;\">æœªæ£€æµ‹åˆ°å¯ç”¨æŠ€èƒ½</p>\n        </div>\n        <div class=\"willpower-section\">\n            <label class=\"willpower-label\">\n                <span>æŠ•å…¥æ„å¿—åŠ›</span>\n                <div class=\"willpower-input-container\">\n                    <input type=\"number\" id=\"willpowerInput\" min=\"0\" value=\"0\">\n                    <span id=\"willpowerMax\">/ 0</span>\n                </div>\n            </label>\n            <div class=\"skill-info\">æ¯ç‚¹æ„å¿—åŠ›ä¸ºæ£€å®šæ± +1DP</div>\n        </div>\n    </div>\n\n    </div>\n\n<div id=\"forum-modal-container\" class=\"modal\">\n <div id=\"forum-modal-content\">\n <button id=\"forum-modal-close-btn\">Ã—</button>\n <div id=\"forum-wrapper\">\n        <!-- å¤´éƒ¨ -->\n        <header class=\"forum-header\">\n            <h1 class=\"forum-title\">äº¤æµç»ˆç«¯</h1>\n            <div class=\"header-controls\">\n                <button class=\"new-post-btn\" id=\"new-post-btn\">å‘å¸ƒæ–°å¸–</button>\n \n            </div>\n        </header>\n\n <main class=\"forum-body\" id=\"forum-body\">\n\n    <aside class=\"forum-sidebar\" id=\"forum-sidebar\">\n\n    </aside>\n\n\n    <section class=\"thread-list-view\">\n        <div class=\"thread-list-header\">\n            <span id=\"current-section-name\"></span>\n        </div>\n        <div class=\"thread-list\" id=\"thread-list\">\n\n        </div>\n        <div class=\"pagination-controls\" id=\"thread-pagination\"></div>\n    </section>\n\n\n    <section class=\"thread-detail-view\">\n        <div id=\"thread-detail-content\">\n\n             <div class=\"detail-placeholder\">\n                <div>\n                    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"60\" height=\"60\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1\" stroke-linecap=\"round\" stroke-linejoin=\"round\" style=\"color: var(--text-secondary-color); opacity: 0.5; margin-bottom: 10px;\"><path d=\"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z\"></path></svg>\n                    <p>é€‰æ‹©ä¸€ä¸ªå¸–å­æŸ¥çœ‹å†…å®¹</p>\n                </div>\n            </div>\n        </div>\n    </section>\n</main>\n    </div>\n\n    <!-- å‘å¸–æ¨¡æ€æ¡† -->\n    <div id=\"post-modal\" class=\"modal\">\n        <div class=\"modal-content\">\n            <button class=\"modal-close\" id=\"modal-close-btn\">&times;</button>\n            <h2 class=\"modal-title\" id=\"modal-title\">å‘å¸ƒæ–°å¸–</h2>\n            <form id=\"post-form\">\n                <div class=\"form-group\">\n                    <label for=\"post-section\">é€‰æ‹©åŒºå—</label>\n                    <select id=\"post-section\" required></select>\n                </div>\n                <div class=\"form-group\">\n                    <label for=\"post-title\">å¸–å­æ ‡é¢˜</label>\n                    <input type=\"text\" id=\"post-title\" required>\n                </div>\n                <div class=\"form-group\">\n                    <label for=\"post-content-input\">å¸–å­å†…å®¹</label>\n                    <textarea id=\"post-content-input\" required></textarea>\n                </div>\n                <div class=\"modal-actions\">\n                    <button type=\"submit\" class=\"new-post-btn\" id=\"submit-post-btn\">ç¡®è®¤å‘å¸ƒ</button>\n                </div>\n            </form>\n        </div>\n    </div>\n    </div>\n</div>\n\n\n \n\n\n<div id=\"group-chat-context-menu\" class=\"group-chat-context-menu\">\n    <div class=\"group-chat-context-menu-item\" id=\"context-menu-reply\">å›å¤</div>\n</div>\n\n<div id='task-summary-modal-container' class = 'modal'>\n  <div id=\"summary-root\" class=\"task-summary-main-container\">\n        <!-- å†…å®¹å°†ç”±JavaScriptåŠ¨æ€ç”Ÿæˆ -->\n    </div>\n</div>\n\n</div>\n<!-- æ›¿æ¢åŸæœ‰çš„æˆå°±ç³»ç»Ÿçœ‹æ¿HTML -->\n<div id=\"achievements-modal\" class=\"modal page-modal wide\" style=\"z-index: 99999;\">\n    <div class=\"modal-content page-modal-content\">\n        <button class=\"modal-close\">Ã—</button>\n \n        <div id=\"achievements-content\" class=\"page active\" style=\"display: flex; flex-direction: column; gap: 0; padding: 10px;\">\n            <!-- æˆå°±åˆ—è¡¨å°†ç”±JSåŠ¨æ€ç”Ÿæˆ -->\n            <div style=\"color: var(--text-secondary-color); text-align: center; padding: 40px;\">\n                <div style=\"font-size: 2em; margin-bottom: 10px;\">ğŸ†</div>\n                <p>æ­£åœ¨åŠ è½½æˆå°±æ•°æ®...</p>\n            </div>\n        </div>\n    </div>\n</div>\n\n <div id=\"zero-level-interface\">\n<div id=\"new-message-notification-container\" style=\"position: absolute; bottom: 16%; left: 15px; z-index: 1001; pointer-events: none;\"></div>\n\n<div id=\"event-tracker-container\" class=\"event-tracker-container\"></div>\n\n    <div id=\"floating-panel-anchor\">\n<div id=\"rp-panel\">\n    <div class=\"check-cards-area\">\n        <h3>\n            é€‰æ‹©æ£€å®šé¡¹\n\n            <div class=\"card-view-switcher\">\n                <span id=\"switch-to-my-cards\" class=\"active\">æˆ‘çš„</span>\n                <span id=\"switch-to-teammate-cards\">é˜Ÿå‹</span>\n            </div>\n\n            <button id=\"sort-cards-btn\" class=\"sort-button\" data-sort-order=\"desc\">LVL â–¼</button>\n        </h3>\n\n        <div id=\"my-cards-slider\" class=\"cards-slider visible\">\n            <p style=\"color: grey; padding: 20px 0;\">ç­‰å¾…åŠ è½½æ£€å®šé¡¹...</p>\n        </div>\n\n        <div id=\"teammate-cards-slider\" class=\"cards-slider\">\n             <p style=\"color: grey; padding: 20px 0;\">æ— é˜Ÿå‹æˆ–æœªåŠ è½½</p>\n        </div>\n    </div>\n    <button id=\"confirm-rp-choice-btn\" class=\"action-button\">ç¡®è®¤</button>\n</div>\n    </div>\n\n    <div id=\"top-left-orbs\">\n        <div class=\"orb top-orb\" id=\"forum-orb-button\">å›</div>\n        <div class=\"orb top-orb\" id=\"task-summary-orb-button\">æ€»</div>\n        <div class=\"orb top-orb\" id=\"read-orb-button\">é˜…</div>\n        \n        <div class=\"orb top-orb\" id=\"group-chat-orb-button\" style=\"display: none;\">èŠ</div>\n    </div>\n<div class=\"action-menu-container\">\n    <button id=\"action-menu-btn\" class=\"action-button zero-level-btn\" title=\"æ›´å¤šæ“ä½œ\">â˜°</button>\n    <div id=\"action-popup-menu\" class=\"action-popup-menu\">\n        <button id=\"add-qr-button\" class=\"popup-menu-button\">è‡ªå®šä¹‰qr</button>\n        <button id=\"things-button\" class=\"popup-menu-button\">è®°çº¦å®š</button>\n        <button id=\"look-forum-button\" class=\"popup-menu-button\">çœ‹è®ºå›</button>\n        <button id=\"look-random-items-button\" class=\"popup-menu-button\">ç”Ÿæˆéšæœºå•†å“</button>\n        <br>\n        <button id=\"reroll-button\" class=\"popup-menu-button\">é‡roll âŸ²</button>\n        <button id=\"continue-button\" class=\"popup-menu-button\">ç»§ç»­ â–¶</button>\n        <button id=\"continue-var-button\" class=\"popup-menu-button\">ç»§ç»­[å˜é‡] â–¶</button>\n    </div>\n</div>\n\n    <button id=\"view-command-btn\" class=\"action-button zero-level-btn\" title=\"æŸ¥çœ‹/ç¼–è¾‘å¾…å‘æŒ‡ä»¤\">ä»¤</button>\n    <button id=\"rp-button\" class=\"action-button zero-level-btn\" title=\"RPæ£€å®š\">RP</button>\n    <button id=\"run-button\" class=\"action-button zero-level-btn\" title=\"é€ƒè·‘\" style=\"display: none;\">é€ƒ</button>\n       <textarea id=\"user-input\" rows=\"2\" placeholder=\"åœ¨è¿™é‡Œè¾“å…¥ä½ çš„è¡ŒåŠ¨...\"></textarea>\n    <div id=\"button-container-send\">\n          <div id=\"action-blocker-overlay\">\n             <button id=\"stop-generation-btn\" title=\"ä¸­æ–­ç”Ÿæˆ\">â¹</button>\n\n          </div>\n    <button id=\"send-button\" class=\"action-button zero-level-btn\">â”</button>\n    \n    </div>\n</div>\n</div>\n\n\n<div id=\"orb-container\">\n    \n    <div class=\"orb\" data-modal-id=\"roll-result-modal\" id=\"roll-result-orb\">éª°</div>\n    \n    <div class=\"orb\" data-modal-id=\"shop-wrapper-modal\" id=\"shop-wrapper-orb\">å•†</div>\n    <div class=\"orb\" data-modal-id=\"map-view-modal\" id=\"map-view-orb\">å›¾</div>\n     <div class=\"orb-divider\"></div>\n     \n    <div class=\"orb\" id=\"skill-choice-orb\">è¡“</div>\n    <div class=\"orb\" data-modal-id=\"page-character-modal\" id=\"page-character-orb\">èƒ½</div>\n \n     <div class=\"orb-divider\"></div>\n     <div class=\"orb\" data-modal-id=\"summary-modal\" id=\"summary-modal-orb\">ç»¼</div>\n    <div class=\"orb\" id=\"world-book-orb\">è¯†</div>\n \n    <div class=\"orb\" data-modal-id=\"page-task-modal\" id=\"page-task-orb\">ä»»</div>\n\n</div>\n\n\n<div id=\"page-task-modal\" class=\"modal page-modal\">\n    <div class=\"modal-content page-modal-content\">\n        <button class=\"modal-close\">Ã—</button>\n        <div class=\"modal-title\">ä»»åŠ¡è¯¦æƒ…</div>\n        <div id=\"page-task\" class=\"page active\">\n            <ul class=\"info-list\">\n                \n                <li><span class=\"label\">ä»»åŠ¡ç›®æ ‡</span><span id=\"task-objective\" class=\"value highlight\"></span></li>\n                 <li><span class=\"label\">ä¸–ç•Œæè¿°</span><span id=\"info-world-desc\" class=\"value\"></span></li>\n                <li><span class=\"label\">ä»»åŠ¡çŠ¶æ€</span><span id=\"task-status\" class=\"value\"></span></li>\n                <li>\n                    <span class=\"label\">ä»»åŠ¡è¿›åº¦</span>\n                    <div class=\"value\" style=\"width: 50%;\">\n                        <div class=\"progress-container\">\n                            <div class=\"progress-bar-bg\">\n                                <div id=\"task-progress-bar\" class=\"progress-bar-fill\"></div>\n                            </div>\n                        </div>\n                    </div>\n                </li>\n                 <li><span class=\"label\">æˆåŠŸå¥–åŠ±</span><span id=\"task-rewards\" class=\"value\"></span></li>\n                <li><span class=\"label\">å¤±è´¥æƒ©ç½š</span><span id=\"task-penalties\" class=\"value\"></span></li>\n                <li><span class=\"label\">å‰©ä½™æ—¶é—´</span><span id=\"task-time-left\" class=\"value\"></span></li>\n            </ul>\n        </div>\n    </div>\n</div>\n\n\n <div id=\"page-character-modal\" class=\"modal page-modal wide\">\n    <div class=\"modal-content page-modal-content\" style=\"max-width: 800px;\">\n        <button class=\"modal-close\">Ã—</button>\n\n\n\n        <div class=\"char-tabs-nav\">\n            <button class=\"char-tab-btn active\" data-tab=\"status\">ä¸ªäººçŠ¶æ€</button>\n            <button class=\"char-tab-btn\" data-tab=\"inventory\">è¡Œå›Šä¸èƒ½åŠ›</button>\n        </div>\n\n\n        <div id=\"char-currency-display\" class=\"char-currency-display\">\n\n        </div>\n\n\n        <div class=\"char-tabs-content\">\n\n\n            <div id=\"char-tab-status\" class=\"char-tab-panel active\">\n                <div id=\"page-character\" class=\"page active\">\n                    <div class=\"character-display-grid\">\n                        <div class=\"char-panel left-panel\">\n                            <div id=\"char-titles-container\" class=\"char-titles-container\"></div>\n                            <div id=\"char-display-name\" class=\"char-name-display\">ç”¨æˆ·</div>\n                            <div class=\"char-info-box\">\n                                <div class=\"info-line\" data-tooltip-key=\"status\"><span class=\"info-label\">çŠ¶æ€</span><span id=\"char-display-status\" class=\"info-value\">æ­£å¸¸</span></div>\n                                <div class=\"info-line\" data-tooltip-key=\"prestige\"><span class=\"info-label\">å£°æœ›</span><span id=\"char-display-prestige\" class=\"info-value\">0</span></div>\n                            <div class=\"info-line\" id=\"bloodline-info-line\" style=\"display: none;\"> \n    <span class=\"info-label\">è¡€ç»Ÿ</span>\n    <span id=\"char-display-bloodline\" class=\"info-value clickable-text\"></span>\n</div>    \n                            </div>\n                            <div class=\"resource-bar-container\"><div class=\"resource-bar-label\">ç”Ÿå‘½å€¼</div><div class=\"progress-bar-bg resource\" data-tooltip-key=\"hp\"><div id=\"char-hp-bar\" class=\"progress-bar-fill hp\"></div><span id=\"char-hp-text\" class=\"progress-bar-text\">50/50</span></div></div>\n                            <div class=\"resource-bar-container\"><div class=\"resource-bar-label\">æ„å¿—åŠ›</div><div class=\"progress-bar-bg resource\" data-tooltip-key=\"willpower\"><div id=\"char-will-bar\" class=\"progress-bar-fill willpower\"></div><span id=\"char-will-text\" class=\"progress-bar-text\">0/0</span></div></div>\n                            <div class=\"resource-bar-container\"><div id=\"char-energy-label\" class=\"resource-bar-label\">èƒ½é‡æ± </div><div class=\"progress-bar-bg resource\" data-tooltip-key=\"energy\"><div id=\"char-energy-bar\" class=\"progress-bar-fill energy\"></div><span id=\"char-energy-text\" class=\"progress-bar-text\">0/0</span></div></div>\n                              <div id=\"dynamic-resource-bars-container\"></div>\n                        </div>\n                        <div class=\"char-panel center-panel\">\n                            <div class=\"character-figure\">\n                                <div class=\"body-part head\"></div><div class=\"body-part torso\"></div><div class=\"body-part arm left\"></div><div class=\"body-part arm right\"></div><div class=\"body-part leg left\"></div><div class=\"body-part leg right\"></div>\n                                <div class=\"equipment-slot slot-head\" data-tooltip-key=\"equip_head\"><span id=\"equip-head\">å¤´éƒ¨: æ— </span></div>\n                                <div class=\"equipment-slot slot-body\" data-tooltip-key=\"equip_body\"><span id=\"equip-body\">èº«ä½“: æ— </span></div>\n                                <div class=\"equipment-slot slot-hands\" data-tooltip-key=\"equip_hands\"><span id=\"equip-hands\">æ‰‹éƒ¨: æ— </span></div>\n                                <div class=\"equipment-slot slot-feet\" data-tooltip-key=\"equip_feet\"><span id=\"equip-feet\">è„šéƒ¨: æ— </span></div>\n                                <div class=\"equipment-slot slot-accessory\" data-tooltip-key=\"equip_accessory\"><span id=\"equip-accessory\">é¥°å“: æ— </span></div>\n                                <div class=\"equipment-slot slot-weapon\" data-tooltip-key=\"equip_weapon\"><span id=\"equip-weapon\">æ‰‹æŒ: æ— </span></div>\n                            </div>\n                        </div>\n\n                        <div class=\"char-panel right-panel\" id=\"main-stats-container\">\n\n                        </div>\n                    </div>\n                </div>\n            </div>\n\n\n            <div id=\"char-tab-inventory\" class=\"char-tab-panel\">\n                 <div class=\"inventory-grid\">\n                    <div class=\"inventory-section\">\n                        <h3 class=\"inventory-section-title\">è¡Œå›Šç‰©å“</h3>\n                        <div id=\"inventory-items-container\" class=\"items-grid-container\">\n\n                        </div>\n                    </div>\n                    <div class=\"inventory-section\">\n                        <h3 class=\"inventory-section-title\">æŒæ¡èƒ½åŠ›</h3>\n                        <div id=\"other-skills-container\" class=\"skills-grid-container\">\n\n                        </div>\n                    </div>\n                </div>\n                 <button id=\"manage-inventory-btn\" class=\"action-button\" style=\"margin: 15px auto; display: block;\">æ“ä½œè¡Œå›Š</button>\n            </div>\n\n        </div>\n    </div>\n</div>\n\n\n\n<div id=\"map-view-modal\" class=\"modal page-modal wide\">\n    <div class=\"modal-content page-modal-content\"  style=\"max-width: 800px;\">\n        <button class=\"modal-close\">Ã—</button>\n        <div class=\"map-title\" id=\"map-title\">åŒºåŸŸåœ°å›¾</div>\n        <div id=\"map-view-content\" class=\"page active\">\n             <div id=\"map-container\" class=\"map-container\">\n\n             </div>\n             <div id=\"external-areas\" class=\"external-areas\">\n                    <h3>å¤–éƒ¨åŒºåŸŸ</h3>\n                    <div id=\"external-areas-list\" class=\"external-areas-list\">\n\n                    </div>\n             </div>\n\n                          <div id=\"parent-map-tabs-container\" class=\"parent-map-tabs-container\">\n                    <h3>åœ°å›¾é›†</h3>\n                    <div id=\"parent-map-tabs-list\" class=\"parent-map-tabs-list\">\n\n                    </div>\n             </div>\n\n                  <div id=\"map-controls-container\">\n                <button id=\"zoom-in-btn\" class=\"map-control-btn\" title=\"æ”¾å¤§\">+</button>\n                <button id=\"zoom-out-btn\" class=\"map-control-btn\" title=\"ç¼©å°\">-</button>\n                <button id=\"reset-view-btn\" class=\"map-control-btn\" title=\"å¤ä½\">â—</button>\n                <button id=\"toggle-edit-mode-btn\" class=\"map-control-btn\" title=\"ç¼–è¾‘æ¨¡å¼\">\n    âœï¸\n</button>\n             </div>\n        </div>\n    </div>\n</div>\n\n\n<div id=\"summary-modal\" class=\"modal page-modal\">\n     <div class=\"modal-content page-modal-content\">\n        <button class=\"modal-close\">Ã—</button>\n        <div class=\"modal-title\">è¿‡å¾€æ€»ç»“</div>\n        <div id=\"summary-content\" class=\"page active\">\n\n        </div>\n    </div>\n</div>\n\n\n<div id=\"shop-wrapper-modal\" class=\"modal shop-modal\">\n\n</div>\n\n\n    <div id=\"setting-book-wrapper\" style=\"display: none;\">\n    <div class=\"setting-book-container\">\n\n        <header class=\"book-header\">\n\n            <button id=\"toggle-sidebar-btn\" class=\"mobile-only-btn\">â˜°</button>\n            <h1 id=\"content-title\">æ¬¢è¿æ¥åˆ°æˆ‘ä»¬çš„ä¸–ç•Œ</h1>\n\n            <button id=\"back-to-status-btn\">â† è¿”å›ç»ˆç«¯</button>\n        </header>\n\n        <div class=\"content-wrapper\">\n            <nav id=\"sidebar\">\n                <h2>è®°å¿†</h2>\n                <div id=\"navigation-menu\">\n\n                </div>\n            </nav>\n\n            <main id=\"content-display\">\n                <div id=\"content-details\">\n                    <p>è¯·ä»å·¦ä¾§å¯¼èˆªæ ä¸­é€‰æ‹©ä¸€ä¸ªæ¡ç›®æ¥æŸ¥çœ‹è¯¦ç»†è®¾å®šã€‚</p>\n                    <p>è¿™é‡Œè®°å½•ç€æˆ‘ä»¬å…±åŒåˆ›é€ çš„æ¯ä¸€ä¸ªè§’è‰²ã€æ¯ä¸€å¤„é£æ™¯å’Œæ¯ä¸€æ®µæ•…äº‹ã€‚æ„¿å®ƒèƒ½å¸¦ç»™ä½ æ¸©æš–ä¸åŠ›é‡ã€‚</p>\n                    <p id=\"error-message\"></p>\n                </div>\n            </main>\n        </div>\n\n\n        <div id=\"sidebar-overlay\"></div>\n    </div>\n</div>\n\n<!-- Inventory Management Modal -->\n<div id=\"inventory-modal\" class=\"modal\">\n    <div class=\"modal-content\">\n        <button class=\"modal-close\">&times;</button>\n        <div class=\"modal-title\">è¡Œå›Šç®¡ç†</div>\n        <p class=\"modal-description\" style=\"font-size: 0.9em; text-align: left;\">\n            ç‚¹å‡»è¿›è¡Œç®¡ç†ã€‚\n        </p>\n        <ul id=\"inventory-item-list\" class=\"inventory-item-list\">\n            <!-- ç‰©å“åˆ—è¡¨å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->\n        </ul>\n        <button id=\"delete-item-btn\" class=\"action-button danger\" disabled>ä¸¢å¼ƒé€‰ä¸­ç‰©å“</button>\n         <button id=\"use-item-btn\" class=\"action-button\" disabled>ä½¿ç”¨é€‰ä¸­ç‰©å“</button>\n    </div>\n</div>\n\n\n<!-- <div id=\"teammates-modal\" class=\"modal\">\n    <div class=\"modal-content\">\n        <button class=\"modal-close\">Ã—</button>\n        <div class=\"modal-title\">é˜Ÿå‹ä¿¡æ¯</div>\n        <div class=\"teammates-container\">\n            <div class=\"teammate-list-wrapper\">\n                <ul id=\"teammate-list\" class=\"teammate-list\">\n\n                </ul>\n            </div>\n            <div id=\"teammate-info-display\" class=\"teammate-info-display\">\n                <p style=\"color: var(--text-secondary-color); text-align: center; margin-top: 20px;\">è¯·ä»å·¦ä¾§é€‰æ‹©ä¸€ä½é˜Ÿå‹ä»¥æŸ¥çœ‹ç›¸å…³ä¿¡æ¯ã€‚</p>\n            </div>\n        </div>\n    </div>\n</div> -->\n\n<!-- ============================================== -->\n    <!-- ========== æ–°å¢ï¼šå•†åº—ç•Œé¢å®¹å™¨ (å¼€å§‹) ========== -->\n    <!-- ============================================== -->\n    <div id=\"shop-wrapper\">\n        <div class=\"shop-main-container\">\n            <!-- å•†åº—å¤´éƒ¨ -->\n           <header class=\"shop-header\">\n                <h1 class=\"shop-title\">å…‘æ¢ä¸­å¿ƒ</h1>\n                <div class=\"shop-header-controls\">\n                     <button id=\"single-gacha-btn\" class=\"control-btn gacha-btn\" style=\"margin-right: 8px;\">å•æŠ½ (160ç§¯åˆ†)</button>\n    <button id=\"ten-gacha-btn\" class=\"control-btn gacha-btn\" style=\"margin-right: 8px;\">åè¿æŠ½ (1440ç§¯åˆ†)</button>\n                    <button id=\"generate-items-btn\" class=\"control-btn\" style=\"margin-right: 8px;\">ç”Ÿæˆ</button>\n                    <input type=\"text\" id=\"shop-search-input\" placeholder=\"æœç´¢åç§°ã€æ•ˆæœã€æè¿°â€¦\">\n                    <button id=\"back-from-shop-btn\">â† è¿”å›ç»ˆç«¯</button>\n                </div>\n            </header>\n    <div id=\"shop-currency-display\" class=\"shop-currency-display\">\n\n        </div>\n            <!-- å•†åº—ä¸»ä½“ -->\n            <div class=\"shop-body-wrapper\">\n                <!-- å·¦ä¾§ï¼šå¯¼èˆªå’Œè´­ç‰©è½¦ -->\n                <aside class=\"shop-sidebar\">\n                    <div class=\"shop-nav\">\n                        <h3>å•†å“åˆ†åŒº</h3>\n                        <ul class=\"shop-nav-list\">\n                            <li><button class=\"shop-nav-item active\" data-page=\"fixed\">å›ºå®šå…‘æ¢</button></li>\n                            <li><button class=\"shop-nav-item\" data-page=\"random\">éšæœºå•†åº—</button></li>\n                        </ul>\n                    </div>\n                    <div class=\"shop-cart\">\n                        <h3>è´­ç‰©è½¦</h3>\n                        <div id=\"cart-items-list\">\n                            <p>è´­ç‰©è½¦æ˜¯ç©ºçš„</p>\n                        </div>\n                        <div id=\"cart-total\">æ€»è®¡: 0 ç§¯åˆ†</div>\n                        <button id=\"checkout-button\" disabled>ç¡®è®¤è´­ä¹°</button>\n                    </div>\n                </aside>\n\n                <!-- å³ä¾§ï¼šå•†å“å±•ç¤ºåŒº -->\n                <main class=\"shop-content-area\">\n                    <!-- å›ºå®šå•†å“é¡µé¢ -->\n                    <div id=\"page-fixed-shop\" class=\"shop-page active\">\n                        <div class=\"shop-controls\">\n                            <div class=\"category-tabs\">\n                                <button class=\"control-btn active\" data-section=\"fixed\" data-category=\"all\">å…¨éƒ¨</button>\n                                <button class=\"control-btn\" data-section=\"fixed\" data-category=\"ç‰©å“\">ç‰©å“</button>\n                                <button class=\"control-btn\" data-section=\"fixed\" data-category=\"æŠ€èƒ½\">æŠ€èƒ½</button>\n                                <button class=\"control-btn\" data-section=\"fixed\" data-category=\"åŸºç¡€æŠ€èƒ½\">åŸºç¡€æŠ€èƒ½</button>\n                                <button class=\"control-btn\" data-section=\"fixed\" data-category=\"å®¶å…·\">å®¶å…·</button>\n                            </div>\n                            <div class=\"sort-controls\">\n                                <button class=\"control-btn active\" data-section=\"fixed\" data-sort=\"asc\">ä»·æ ¼å‡åº</button>\n                                <button class=\"control-btn\" data-section=\"fixed\" data-sort=\"desc\">ä»·æ ¼é™åº</button>\n                            </div>\n                        </div>\n                        <div class=\"shop-display-wrapper\">\n                            <div id=\"items-display-list-fixed\" class=\"items-display-list\"></div>\n                            <div id=\"item-details-display-fixed\" class=\"item-details-display\">\n                                <div class=\"detail-placeholder\">é€‰æ‹©å•†å“æŸ¥çœ‹è¯¦æƒ…</div>\n                            </div>\n                        </div>\n                        <div id=\"pagination-fixed\" class=\"shop-pagination\"></div>\n                    </div>\n\n                    <!-- éšæœºå•†å“é¡µé¢ -->\n                    <div id=\"page-random-shop\" class=\"shop-page\">\n                        <div class=\"shop-controls\">\n                            <div class=\"category-tabs\">\n                                <button class=\"control-btn active\" data-section=\"random\" data-category=\"all\">å…¨éƒ¨</button>\n                                <button class=\"control-btn\" data-section=\"random\" data-category=\"ç‰©å“\">ç‰©å“</button>\n                                <button class=\"control-btn\" data-section=\"random\" data-category=\"æŠ€èƒ½\">æŠ€èƒ½</button>\n                                <button class=\"control-btn\" data-section=\"random\" data-category=\"å®¶å…·\">å®¶å…·</button>\n                            </div>\n                            <div class=\"sort-controls\">\n                                <button class=\"control-btn active\" data-section=\"random\" data-sort=\"asc\">ä»·æ ¼å‡åº</button>\n                                <button class=\"control-btn\" data-section=\"random\" data-sort=\"desc\">ä»·æ ¼é™åº</button>\n                            </div>\n                        </div>\n                         <div class=\"shop-display-wrapper\">\n                            <div id=\"items-display-list-random\" class=\"items-display-list\"></div>\n                            <div id=\"item-details-display-random\" class=\"item-details-display\">\n                                <div class=\"detail-placeholder\">é€‰æ‹©å•†å“æŸ¥çœ‹è¯¦æƒ…</div>\n                            </div>\n                        </div>\n                        <div id=\"pagination-random\" class=\"shop-pagination\"></div>\n                    </div>\n                </main>\n            </div>\n        </div>\n    </div>\n    <!-- å•†åº—æ¨¡æ€æ¡† (æ²¿ç”¨ç»ˆç«¯çš„æ ·å¼) -->\n    <div id=\"shop-modal\" class=\"modal\">\n        <div class=\"modal-content\">\n            <button class=\"modal-close\">&times;</button>\n            <div id=\"shop-modal-title\" class=\"modal-title\">æç¤º</div>\n            <div id=\"shop-modal-message\" class=\"modal-description\"></div>\n        </div>\n    </div>\n    <div id=\"delete-modal\" class=\"modal\">\n        <div class=\"modal-content\">\n            <button class=\"modal-close\">&times;</button>\n            <div id=\"delete-modal-title\" class=\"modal-title\">æç¤º</div>\n            <div id=\"delete-modal-message\" class=\"modal-description\"></div>\n        </div>\n    </div>\n\n    <!-- æŠ½å¥–æ¨¡æ€æ¡† -->\n<div id=\"gacha-modal\" class=\"modal\">\n    <div class=\"modal-content gacha-modal-content\">\n        <button class=\"modal-close\">&times;</button>\n        <div id=\"gacha-modal-title\" class=\"modal-title\">æŠ½å¥–ç»“æœ</div>\n        <div id=\"gacha-animation-container\" class=\"gacha-animation-container\">\n            \n            <!-- æŠ½å¥–åŠ¨ç”»åŒºåŸŸ -->\n        </div>\n        <div id=\"gacha-results-summary\" class=\"gacha-results-summary\"></div>\n        <div id=\"gacha-results\" class=\"gacha-results\">\n            <!-- æŠ½å¥–ç»“æœæ˜¾ç¤º -->\n        </div>\n        <button id=\"gacha-confirm-btn\" class=\"control-btn\" style=\"display: none;\">ç¡®è®¤</button>\n    </div>\n</div>\n\n    <!-- ========== æ–°å¢ï¼šå•†åº—ç•Œé¢å®¹å™¨ (ç»“æŸ) ========== -->\n<div id=\"roll-result-modal\" class=\"modal\">\n    <div class=\"modal-content\" style=\"max-width: 800px; width: 90%;\">\n        <button class=\"modal-close\">Ã—</button>\n        <div id=\"roll-result-modal-title\" class=\"modal-title\">ä¸Šä¸€è½®æŠ•æ·è¯¦æƒ…</div>\n        <div id=\"roll-result-modal-content\" class=\"modal-description\" style=\"text-align: left; max-height: 70vh; overflow-y: auto; padding-right: 15px;\">\n    </div>\n</div>\n\n</div>\n<div id=\"keyword-modal\" class=\"modal\">\n    <div class=\"modal-content\">\n\n        <button class=\"modal-close\">Ã—</button>\n        <h2>é¢å¤–ç”Ÿæˆè¦æ±‚</h2>\n        <p>è¯·è¾“å…¥ä¸€äº›å…³é”®è¯æˆ–è¦æ±‚ï¼ˆå¯é€‰ï¼‰ï¼Œå®ƒä»¬å°†è¢«æ³¨å…¥åˆ°æç¤ºä¸­ã€‚ä¾‹å¦‚ï¼šâ€œä»·æ ¼ä½äº10000â€ã€â€œå’Œç«ç„°æœ‰å…³â€ã€â€œåªèƒ½æ˜¯Cçº§çš„è¡€ç»Ÿâ€ã€‚</p>\n       <textarea id=\"keyword-input\" placeholder=\"è¾“å…¥å…³é”®è¯ï¼Œç•™ç©ºåˆ™ä½¿ç”¨é»˜è®¤æç¤º...\"></textarea>\n\n\n<div id=\"model-selector-container\" class=\"model-selector\">\n    <span class=\"selector-label\">é€‰æ‹©æ¨¡å‹:</span>\n    <div class=\"switch-container\">\n        <button id=\"model-flash\" class=\"switch-btn active\" data-model=\"gemini-2.5-flash\">Flash</button>\n        <button id=\"model-pro\" class=\"switch-btn\" data-model=\"gemini-2.5-pro\">Pro</button>\n    </div>\n</div>\n\n\n<div class=\"modal-buttons\">\n    <button id=\"api-key-config-btn\" class=\"control-btn\">è®¾ç½®å¯†é’¥</button>\n    <button id=\"submit-generation-btn\" class=\"control-btn\">å¼€å§‹ç”Ÿæˆ</button>\n    <button id=\"skip-generation-btn\" class=\"control-btn grey\">è·³è¿‡å¹¶ç”Ÿæˆ</button>\n</div>\n    </div>\n</div>\n \n\n\n\n\n</div>\n\n<div id=\"skill-choice-panel\" class=\"modal\">\n <div class=\"modal-content\" style=\"max-width: 800px; width: 95%;\">\n    <button class=\"modal-close\">Ã—</button>\n    <div class=\"modal-title\">å‘åŠ¨æœ¯å¼</div>\n\n    <div class=\"skill-choice-container\">\n\n \n\n\n        <div class=\"bottom-section\">\n\n\n            <div class=\"other-skills-group\">\n                <h3>å¯ç”¨æœ¯æ³•</h3>\n                <div id=\"other-skills-area\" class=\"skills-list\">\n\n                </div>\n            </div>\n\n\n            <div class=\"willpower-group\">\n                <h3>æŠ•å…¥æ„å¿—åŠ›</h3>\n                <div class=\"willpower-display\">\n                    <input type=\"number\" id=\"willpower-input\" min=\"0\" value=\"0\" readonly> \n                    <span id=\"willpower-max\">/ 0</span>\n                </div>\n                <div class=\"willpower-slider-container\">\n                    <input type=\"range\" id=\"willpower-slider\" value=\"0\" min=\"0\" step=\"1\">\n                </div>\n                <div class=\"skill-info\">æ¯ç‚¹æ„å¿—åŠ›ä¸ºæ£€å®šæ± +1 DP</div>\n            </div>\n\n        </div>\n    </div>\n    <button id=\"confirm-skill-choice-btn\" class=\"action-button\">ç¡®è®¤å‘åŠ¨</button>\n</div>\n\n</div>\n\n\n    <div id=\"world-book-modal\" class=\"modal\">\n        <div class=\"book-content\">\n            <button class=\"book-close-btn\"> </button>\n            <div class=\"book-left-page\">\n                <div class=\"book-bookmarks\">\n\n                    <div class=\"bookmark\" data-tab=\"global_npc\">å…¨å±€äººç‰©</div>\n                    <div class=\"bookmark\" data-tab=\"global_settings\">å…¨å±€è®¾å®š</div>\n                    <div class=\"bookmark\" data-tab=\"global_èƒŒåŒ…\">ä½ çš„èƒŒåŒ…</div>\n                    <div class=\"bookmark\" data-tab=\"global_å…¶ä»–æŠ€èƒ½\">ä½ çš„æŠ€èƒ½</div>\n                    <div class=\"bookmark\" data-tab=\"group_member\" id=\"group_member_bookmark\">å°é˜Ÿä¿¡æ¯</div>\n                     <div class=\"bookmark\" data-tab=\"npc\" id=\"world_npc_bookmark\">ä¸–ç•Œäººç‰©</div>\n                    <div class=\"bookmark active\" data-tab=\"settings\" id=\"world_settings_bookmark\">ä¸–ç•Œè®¾å®š</div>\n                    <div class=\"bookmark\" data-tab=\"global_å¤‡å¿˜å½•\" id=\"things_bookmark\">å¤‡å¿˜å½•</div>\n                     <div class=\"bookmark\" data-tab=\"the_created\" id=\"the_created_bookmark\">$#%</div> \n                   \n                </div>\n            </div>\n            <div class=\"book-right-page\">\n                <div id=\"book-display-area\" class=\"book-display-area\">\n                    <!-- å†…å®¹å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->\n                </div>\n                <div class=\"book-pagination\">\n                    <button id=\"book-prev-page\" class=\"page-turn-btn left\">â€¹</button>\n                    <span id=\"book-page-info\">1 / 1</span>\n                    <button id=\"book-next-page\" class=\"page-turn-btn right\">â€º</button>\n                </div>\n            </div>\n        </div>\n    </div>\n    <!-- ========== æ–°å¢ï¼šä¸–ç•Œä¹‹ä¹¦å¼¹çª— (ç»“æŸ) ========== -->\n\n \n <div id=\"plot-synthesis-modal\" class=\"modal\">\n    <div class=\"modal-content\" style=\"max-width: 800px;\">\n        <button class=\"modal-close\">Ã—</button>\n        <div class=\"modal-title\">æ”¯çº¿å‰§æƒ…ç®¡ç†</div>\n        <div class=\"modal-description\" style=\"text-align: left; margin-bottom: 20px;\">\n            æ‰€æœ‰æ“ä½œå°†åœ¨æ­¤å¤„æ¨¡æ‹Ÿï¼Œç›´åˆ°ä½ ç‚¹å‡»â€œç¡®è®¤æ‰§è¡Œâ€ã€‚\n        </div>\n\n\n        <div class=\"plot-simulation-container\">\n            <div id=\"current-plots-display\" class=\"plot-column\">\n                <h4>å½“å‰æŒæœ‰</h4>\n\n            </div>\n            <div class=\"arrow-separator\">â†’</div>\n            <div id=\"simulated-plots-display\" class=\"plot-column\">\n                <h4>æ“ä½œé¢„è§ˆ</h4>\n\n            </div>\n        </div>\n\n\n        <div class=\"synthesis-section\">\n            <h4>åˆ†è§£é«˜çº§æ”¯çº¿ (3:1)</h4>\n            <div class=\"synthesis-controls\">\n                <select id=\"decompose-from-select\">\n                    <option value=\"S\">S çº§</option>\n                    <option value=\"A\">A çº§</option>\n                    <option value=\"B\">B çº§</option>\n                    <option value=\"C\">C çº§</option>\n                </select>\n                <input type=\"number\" id=\"decompose-amount-input\" min=\"1\" value=\"1\" style=\"width: 60px;\">\n                <button id=\"execute-decomposition-btn\" class=\"action-button small\">â†“ åˆ†è§£</button>\n            </div>\n        </div>\n\n        <div class=\"synthesis-section\">\n            <h4>åˆæˆé«˜çº§æ”¯çº¿ (3:1)</h4>\n            <div class=\"synthesis-controls\">\n                <select id=\"synthesize-to-select\">\n                    <option value=\"C\">â† C çº§ (éœ€ 3 D)</option>\n                    <option value=\"B\">â† B çº§ (éœ€ 3 C)</option>\n                    <option value=\"A\">â† A çº§ (éœ€ 3 B)</option>\n                    <option value=\"S\">â† S çº§ (éœ€ 3 A)</option>\n                </select>\n                <input type=\"number\" id=\"synthesize-amount-input\" min=\"1\" value=\"1\" style=\"width: 60px;\">\n                <button id=\"execute-synthesis-btn\" class=\"action-button small\">â†‘ åˆæˆ</button>\n            </div>\n        </div>\n\n\n        <div class=\"final-actions\">\n             <button id=\"reset-simulation-btn\" class=\"action-button grey\">é‡ç½®æ“ä½œ</button>\n             <button id=\"confirm-synthesis-btn\" class=\"action-button highlight\">ç¡®è®¤æ‰§è¡Œ</button>\n        </div>\n    </div>\n</div>\n\n <div id=\"context-menu\" style=\"display: none; position: fixed;    padding: 5px; border-radius: 5px; \">\n    <div class=\"context-menu-item\" data-action=\"edit\">ç¼–è¾‘æ¥¼å±‚</div>\n    <div class=\"context-menu-item\" data-action=\"delete\">åˆ é™¤æ¥¼å±‚</div>\n    <div class=\"context-menu-item\" data-action=\"star\">æ”¶è—</div>\n    <div class=\"context-menu-item\" data-action=\"name\">å‘½åæ ‡é¢˜</div>\n <div class=\"context-menu-item\" data-action=\"copy\">å¤åˆ¶</div>\n</div>\n  <div id=\"char-tooltip\" class=\"char-tooltip\"></div>\n\n          <div id=\"location-modal\" class=\"modal\">\n            <div class=\"modal-content\" style=\"max-width: 800px;\">\n                <button class=\"modal-close\">&times;</button>\n                <div id=\"location-modal-title\" class=\"modal-title\">åœ°ç‚¹åç§°</div>\n                <div id=\"location-modal-description\" class=\"modal-description\">\n                    ç¯å¢ƒæè¿°å°†åœ¨è¿™é‡Œæ˜¾ç¤º\n                </div>\n                <button class=\"action-button\" id=\"go_to_location_btn\" style=\"max-width: 30%;margin: 10px; align-self: center;left:35%\">å‰å¾€</button>\n                           </div>\n        </div>\n\n        <div id=\"command-modal\" class=\"modal\">\n    <div class=\"modal-content\" style=\"width: 90vh; max-width: 800px; max-height: 80vh;\">\n        <div class=\"modal-header\">\n            <h2 class=\"modal-title\">ç¼–è¾‘å¾…å‘æŒ‡ä»¤</h2>\n            <button class=\"modal-close\">&times;</button>\n        </div>\n        <div class=\"modal-body\" style=\"display: flex; flex-direction: column; gap: 10px;\">\n            <p style=\"color: var(--text-secondary-color); font-size: 14px; margin-bottom: 0;\">è¿™äº›æŒ‡ä»¤å°†åœ¨ä¸‹æ¬¡ç‚¹å‡»â€œå‘é€â€æ—¶ï¼Œé™„åŠ åœ¨ä½ çš„æ¶ˆæ¯æœ€å‰æ–¹ä¸€èµ·å‘é€ã€‚</p>\n            <textarea id=\"command-edit-area\" style=\"width: 100%; height: 250px; background-color: rgba(0,0,0,0.3); color: var(--text-color); border: 1px solid var(--border-color); padding: 10px; box-sizing: border-box; resize: vertical;\"></textarea>\n        </div>\n        <div class=\"modal-footer\"style=\"display: flex; gap: 10px;\">\n            <button id=\"save-command-btn\" class=\"action-button\" style=\"display: none;\">ä¿å­˜å¹¶å…³é—­</button>\n             <button id=\"exc-command-btn\" class=\"action-button\">ç«‹åˆ»æ‰§è¡Œ</button>\n\n             \n        </div>\n    </div>\n</div>\n\n<div id=\"roll-result-card-container\" class=\"roll-result-card-container\"></div>\n\n\n<div id=\"settings-modal\" class=\"modal\">\n    <div class=\"modal-content\" style=\"max-width: 800px;\">\n        <button class=\"modal-close\">Ã—</button>\n        <div class=\"modal-title\">ç³»ç»Ÿè®¾ç½®</div>\n        \n        <button id=\"achievements-btn\" title=\"æˆå°±\">ğŸ†</button>\n        <button id=\"debug-clear-achievements\" title=\"æ¸…é™¤æˆå°±æ•°æ®(è°ƒè¯•ç”¨)\" style=\"\n        display: none;\n    background: none;\n    border: 1px solid #ff4444;\n    color: #ff4444;\n    font-size: 0.8em;\n    cursor: pointer;\n    padding: 2px 6px;\n    margin-left: 5px;\n    border-radius: 3px;\n    transition: all 0.3s ease;\n    opacity: 0.6;\n\" onmouseover=\"this.style.opacity='1'; this.style.background='#ff4444'; this.style.color='white';\" onmouseout=\"this.style.opacity='0.6'; this.style.background='none'; this.style.color='#ff4444';\">ğŸ—‘ï¸</button>\n\n        <!-- åˆ†é¡µæ ‡ç­¾ -->\n        <div class=\"settings-tabs\">\n            <button class=\"settings-tab active\" data-page=\"game\">æ¸¸æˆè®¾ç½®</button>\n            <button class=\"settings-tab\" data-page=\"display\">æ˜¾ç¤ºè®¾ç½®</button>\n            <button class=\"settings-tab\" data-page=\"data\">æ•°æ®ç®¡ç†</button>\n            <button class=\"settings-tab\" data-page=\"asset\">ç´ æå·¥åŠ</button>\n                <button class=\"settings-tab\" data-page=\"workshop\">åˆ›æ„å·¥åŠ</button>\n        </div>\n\n        <!-- æ¸¸æˆè®¾ç½®é¡µ -->\n        <div class=\"settings-page active\" id=\"settings-page-game\">\n            <div class=\"settings-container\">\n                \n                <div class=\"setting-item\">\n                    <label>ä¸Šæ¬¡å¯¹è¯Tokenæ¶ˆè€—</label>\n                    <span id=\"last-token-display\" style=\"font-weight: bold; color: var(--accent-color);\">N/A</span>\n                </div>\n                <div class=\"setting-item\">\n    <label>æŸ¥çœ‹æ•è·çš„æç¤ºè¯</label>\n    <button id=\"view-captured-prompt-btn\" style=\"\n        background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));\n        border: 1px solid var(--border-color);\n        color: var(--background-color);\n        padding: 8px 16px;\n        border-radius: 6px;\n        cursor: pointer;\n        font-weight: bold;\n        transition: all 0.3s ease;\n        box-shadow: 0 0 10px var(--glow-color);\n    \" onmouseover=\"this.style.transform='scale(1.05)'; this.style.boxShadow='0 0 20px var(--glow-color)';\" \n       onmouseout=\"this.style.transform='scale(1)'; this.style.boxShadow='0 0 10px var(--glow-color)';\">\n        æŸ¥çœ‹æç¤ºè¯\n    </button>\n</div>\n                <div class=\"setting-item\">\n                    <label>æ¨¡ç»„é‡ç½®</label>\n                    <button id=\"open-reconfig-modal-btn\" class=\"control-btn-special\">è°ƒæ•´æ¨¡ç»„</button>\n                </div>\n                <div class=\"setting-item\">\n                    <label>è®°å¿†ä¸Šä¸€æ¬¡çš„æ¨¡ç»„é…ç½®</label>\n                    <input type=\"checkbox\" id=\"remember-mod-choice\" style=\"width: auto; cursor: pointer;\" checked>\n                </div>\n                               <div class=\"setting-item\">\n                    <label for=\"streaming-toggle\">æµå¼ä¼ è¾“</label>\n                    <div class=\"switch-container\">\n                        <button id=\"streaming-toggle\" class=\"switch-btn\" data-state=\"on\">å¼€å¯</button>\n                    </div>\n                </div>\n                <div class=\"setting-item\">\n                    <label>è‡ªå®šä¹‰ç»¿ç¯æ‰«ææ¥¼å±‚</label>\n                    <input type=\"checkbox\" id=\"remember-scan-floors\" style=\"width: auto; cursor: pointer;\">\n                </div>\n <div class=\"setting-item\">\n    <label>æ‰«ææ¥¼å±‚æ•° <span id=\"current-scan-floors\" style=\"color: var(--accent-color); font-weight: bold;\">(æœªè®¾ç½®)</span></label>\n    <button id=\"set-scan-floors-btn\" class=\"control-btn-special\">è®¾ç½®æ¥¼å±‚</button>\n</div>\n<div class=\"setting-item\">\n    <label>è‡ªåŠ¨è®¾ç½®NPCä¸ºç»¿ç¯</label>\n    <input type=\"checkbox\" id=\"auto-set-npc-filter\" style=\"width: auto; cursor: pointer;\">\n</div>\n<div class=\"setting-item\">\n    <label>å¥½æ„Ÿåº¦å˜é€Ÿ <span id=\"current-favorability-speed\" style=\"color: var(--accent-color); font-weight: bold;\">(æœªè®¾ç½®)</span></label>\n    <button id=\"set-favorability-speed-btn\" class=\"control-btn-special\">è®¾ç½®å˜é€Ÿ</button>\n</div>\n\n                <div class=\"setting-item\">\n                    <label>ç³»ç»Ÿæ›´æ–°æ£€æŸ¥</label>\n                    <button id=\"check-for-updates-btn\" class=\"control-btn-special\">æ£€æŸ¥æ›´æ–°</button>\n                    <button id=\"force-update-worldbook-btn\" class=\"control-btn-special\" style=\"margin-left: 10px;\">å¼ºåˆ¶æ›´æ–°ä¸–ç•Œä¹¦</button>\n                    <button id=\"force-update-regex-btn\" class=\"control-btn-special\" style=\"margin-left: 10px;\">å¼ºåˆ¶æ›´æ–°æ­£åˆ™</button>\n                </div>\n                \n            </div>\n        </div>\n\n        <!-- æ˜¾ç¤ºè®¾ç½®é¡µ -->\n        <div class=\"settings-page\" id=\"settings-page-display\">\n            <div class=\"settings-container\">\n                <div class=\"setting-item\">\n                    <label>ç•Œé¢ä¸»é¢˜</label>\n                    <button id=\"modal-theme-switcher\" class=\"control-btn\">åˆ‡æ¢ä¸»é¢˜</button>\n                </div>\n                <div class=\"setting-item\">\n                    <label>è‡ªå®šä¹‰ä¸»é¢˜</label>\n                    <div class=\"custom-theme-controls\">\n                        <button id=\"apply-custom-theme-btn\" class=\"control-btn\">åº”ç”¨è‡ªå®šä¹‰</button>\n                        <button id=\"edit-custom-theme-btn\" class=\"control-btn\" style=\"margin-left: 10px;\">ç¼–è¾‘</button>\n                    </div>\n                </div>\n                <div id=\"custom-theme-editor\" class=\"setting-item-column\" style=\"display: none;\">\n                    <label>é¢œè‰²ç¼–è¾‘å™¨</label>\n                    <div id=\"color-picker-container\"></div>\n                    <p style=\"font-size: 0.8em; opacity: 0.7; margin-top: 10px;\">æ‹–åŠ¨é¢œè‰²å¯å®æ—¶é¢„è§ˆæ•ˆæœã€‚</p>\n                </div>\n \n                <div class=\"setting-item\">\n                    <label for=\"roll-card-toggle\">éª°å­çœ‹æ¿</label>\n                    <div class=\"switch-container\">\n                        <button id=\"roll-card-toggle\" class=\"switch-btn\" data-state=\"on\">å¼€å¯</button>\n                    </div>\n                </div>\n                <div class=\"setting-item\">\n                    <label for=\"fullscreen-toggle\">å…¨å±æ¨¡å¼</label>\n                    <div class=\"switch-container\">\n                        <button id=\"fullscreen-btn2\" class=\"switch-btn\">è¿›å…¥å…¨å±</button>\n                    </div>\n                </div>\n                <div class=\"setting-item\">\n                    <label for=\"font-size-slider\">ç•Œé¢å­—ä½“å¤§å°</label>\n                    <div class=\"font-size-controls\">\n                        <input type=\"range\" id=\"font-size-slider\" min=\"12\" max=\"30\" step=\"1\" value=\"16\">\n                        <span id=\"font-size-value\">16px</span>\n                    </div>\n                </div>\n                <div class=\"setting-item\">\n                    <label for=\"line-height-slider\">æ®µè½è¡Œé—´è·</label>\n                    <div class=\"line-height-controls\"> \n                        <input type=\"range\" id=\"line-height-slider\" min=\"1.2\" max=\"3.0\" step=\"0.1\" value=\"1.6\">\n                        <span id=\"line-height-value\">1.6</span>\n                    </div>\n                </div>\n                <div class=\"setting-item\">\n                    <label for=\"line-height-more\">æ®µè½æ¢è¡Œ</label>\n                    <div class=\"switch-container\">\n                        <button id=\"line-height-more\" class=\"switch-btn\" data-state=\"on\">å¼€å¯</button>\n                    </div>\n                </div>\n                <div class=\"setting-item\">\n                    <label for=\"transparent-toggle\">æ¶ˆæ¯èƒŒæ™¯é€æ˜</label>\n                    <div class=\"switch-container\">\n                        <button id=\"transparent-toggle\" class=\"switch-btn\" data-state=\"off\">å…³é—­</button>\n                    </div>\n                </div>\n<div class=\"setting-item\">\n    <label for=\"modal-background-toggle\">æ¨¡æ€æ¡†å®è‰²èƒŒæ™¯</label>\n    <div class=\"switch-container\">\n        <button id=\"modal-background-toggle\" class=\"switch-btn\" data-state=\"off\">å…³é—­</button> \n    </div>\n</div>\n                <div class=\"setting-item\">\n                    <label for=\"font-family-selector\">ç•Œé¢å­—ä½“</label>\n                    <select id=\"font-family-selector\" class=\"control-btn\" style=\"width: 220px; text-align: left; padding: 5px 8px;\"></select>\n                </div>\n                <div class=\"setting-item\">\n          <label for=\"danmu-toggle\">èƒŒæ™¯å¼¹å¹•å¼€å…³</label>\n          <div class=\"switch-container\">\n            <button id=\"danmu-toggle\" class=\"switch-btn\" data-state=\"on\">å¼€å¯</button>\n          </div>\n        </div>\n        <div class=\"setting-item\">\n          <label for=\"danmu-opacity-slider\">å¼¹å¹•é€æ˜åº¦</label>\n          <div class=\"slider-controls\">\n            <input type=\"range\" id=\"danmu-opacity-slider\" min=\"0.1\" max=\"1.0\" step=\"0.05\" value=\"0.7\">\n            <span id=\"danmu-opacity-value\">0.7</span>\n          </div>\n        </div>\n        <div class=\"setting-item\">\n          <label for=\"danmu-size-slider\">å¼¹å¹•å­—ä½“å¤§å°</label>\n          <div class=\"slider-controls\">\n            <input type=\"range\" id=\"danmu-size-slider\" min=\"16\" max=\"36\" step=\"1\" value=\"22\">\n            <span id=\"danmu-size-value\">22px</span>\n          </div>\n        </div>\n        <div class=\"setting-item\">\n          <label for=\"danmu-height-slider\">å¼¹å¹•æ˜¾ç¤ºé«˜åº¦</label>\n          <div class=\"slider-controls\">\n            <input type=\"range\" id=\"danmu-height-slider\" min=\"10\" max=\"100\" step=\"5\" value=\"100\">\n            <span id=\"danmu-height-value\">100%</span>\n          </div>\n        </div>\n\n                <div class=\"setting-item\">\n          <label for=\"danmu-speed-slider\">å¼¹å¹•æµé€Ÿ</label>\n          <div class=\"slider-controls\">\n            <input type=\"range\" id=\"danmu-speed-slider\" min=\"0.1\" max=\"4.0\" step=\"0.1\" value=\"1.5\">\n            <span id=\"danmu-speed-value\">x1.5</span>\n          </div>\n        </div>\n\n     <div class=\"setting-item\">\n          <label for=\"danmu-count-slider\">å•æ¡è½¨é“å¼¹å¹•æ•°é‡</label>\n          <div class=\"slider-controls\">\n                        <input type=\"range\" id=\"danmu-count-slider\" min=\"1\" max=\"10\" step=\"1\" value=\"2\">\n            <span id=\"danmu-count-value\">2</span>\n          </div>\n        </div>\n            </div>\n        </div>\n\n        <!-- æ•°æ®ç®¡ç†é¡µ -->\n        <div class=\"settings-page\" id=\"settings-page-data\">\n            <div class=\"settings-container\">\n                <div class=\"setting-item\" id=\"archive-naming-container\">\n                    <label for=\"archive-name-input\">è®¾ç½®å­˜æ¡£åç§°</label>\n                    <div class=\"archive-name-controls\">\n                        <input type=\"text\" id=\"archive-name-input\" placeholder=\"ä¸ºè¿™æ®µè®°å¿†å‘½å...\">\n                        <button id=\"set-archive-name-btn\" class=\"control-btn\">è®¾å®š</button>\n                    </div>\n                </div>\n                <div class=\"setting-item\">\n                    <label>æ•°æ®å¯¼å…¥</label>\n                    <button id=\"modal-import-btn\" class=\"control-btn\">å¯¼å…¥å­˜æ¡£</button>\n                    <input type=\"file\" id=\"modal-file-importer\" style=\"display:none\" accept=\".json\">\n                </div>\n                <div id=\"modal-log-block\" class=\"log-output\">ç­‰å¾…æ“ä½œ...</div>\n                <div class=\"setting-item\">\n                    <label>æ•°æ®å¯¼å‡º</label>\n                    <button id=\"modal-export-btn\" class=\"control-btn\">å¯¼å‡ºå­˜æ¡£</button>\n                </div>\n                <div id=\"modal-export-status\" class=\"log-output\">ç­‰å¾…æ“ä½œ...</div>\n                <div class=\"setting-item-column\" id=\"snapshot-management-container\" style=\"margin-top: 20px;\">\n    <!-- æ–°å¢ï¼šå­˜æ¡£IDæ˜¾ç¤ºå’Œä¿®æ”¹åŒºåŸŸ -->\n \n\n<div class=\"setting-item-column\" style=\"margin-top: 20px; padding-top: 15px; border-top: 1px solid var(--border-color);\">\n    <label style=\"color: var(--primary-color); margin-bottom: 10px;\">ä¸–ç•Œæ¨¡å‹æ‘˜è¦é…ç½® & æ ¸å¿ƒæ“ä½œ</label>\n    \n    <div style=\"display: flex; gap: 10px; margin-bottom: 10px;\">\n        <div style=\"flex: 1;\">\n            <span style=\"font-size: 12px; color: var(--text-secondary-color); display: block; margin-bottom: 4px;\">éšè—æœ€æ–°æ•°</span>\n            <input type=\"number\" id=\"setting-hide-latest\" placeholder=\"10\" style=\"width: 100%; background: var(--background-color); border: 1px solid var(--border-color); color: var(--text-color); padding: 6px; border-radius: 4px;\">\n        </div>\n        <div style=\"flex: 1;\">\n            <span style=\"font-size: 12px; color: var(--text-secondary-color); display: block; margin-bottom: 4px;\">å°æ€»ç»“å‘¨æœŸ</span>\n            <input type=\"number\" id=\"setting-small-cycle\" placeholder=\"50\" style=\"width: 100%; background: var(--background-color); border: 1px solid var(--border-color); color: var(--text-color); padding: 6px; border-radius: 4px;\">\n        </div>\n        <div style=\"flex: 1;\">\n            <span style=\"font-size: 12px; color: var(--text-secondary-color); display: block; margin-bottom: 4px;\">å¤§æ€»ç»“å‘¨æœŸ</span>\n            <input type=\"number\" id=\"setting-big-cycle\" placeholder=\"20\" style=\"width: 100%; background: var(--background-color); border: 1px solid var(--border-color); color: var(--text-color); padding: 6px; border-radius: 4px;\">\n        </div>\n    </div>\n    <button id=\"setting-save-config-btn\" class=\"control-btn\" style=\"width: 100%; margin-bottom: 15px;\">ğŸ’¾ ä¿å­˜æ‘˜è¦è®¾ç½®</button>\n\n    <label style=\"font-size: 13px; margin-bottom: 8px;\">é«˜çº§æŒ‡ä»¤</label>\n    <div style=\"display: flex; gap: 10px;\">\n        <button id=\"setting-rebuild-btn\" class=\"control-btn\" style=\"flex: 1; border-color: var(--secondary-color); color: var(--secondary-color);\" title=\"åŸºäºå†å²è®°å½•é‡æ„ä¸–ç•ŒçŠ¶æ€\">ğŸŒ€ æ•´åˆé‡æ„</button>\n        <button id=\"setting-reprocess-btn\" class=\"control-btn\" style=\"flex: 1;\" title=\"é‡æ–°å¤„ç†æœ€æ–°çš„ä¸€æ¡æ¶ˆæ¯\">ğŸ”„ é‡ä¿®æœ¬æ¥¼</button>\n    </div>\n</div>\n\n    <div class=\"setting-item-row\" style=\"margin-bottom: 15px; padding: 10px; background: var(--container-bg-color); border: 1px solid var(--border-color); border-radius: 4px;\">\n        <label style=\"font-weight: bold; margin-bottom: 8px; display: block; color: var(--text-color);\">å½“å‰æµè§ˆå™¨å¿«ç…§å­˜æ¡£ID</label>\n        <div style=\"display: flex; align-items: center; gap: 10px; margin-bottom: 8px;\">\n            <span style=\"font-family: var(--base-font-family); color: var(--secondary-color);\">ID: </span>\n            <span id=\"current-save-id-display\" style=\"font-family: monospace; font-weight: bold; color: var(--primary-color);\">åŠ è½½ä¸­...</span>\n        </div>\n        <div style=\"display: flex; gap: 8px; align-items: center;\">\n            <input \n                type=\"text\" \n                id=\"save-id-input\" \n                placeholder=\"è¾“å…¥æ–°çš„å­˜æ¡£ID\" \n                style=\"flex: 1; padding: 6px 10px; border: 1px solid var(--border-color); border-radius: 4px; background: var(--background-color); color: var(--text-color); font-family: var(--base-font-family);\"\n            />\n            <button id=\"update-save-id-btn\" class=\"control-btn\">ä¿®æ”¹ID</button>\n            <button id=\"refresh-save-id-btn\" class=\"control-btn\">åˆ·æ–°</button>\n        </div>\n        <small style=\"color: var(--text-secondary-color); margin-top: 5px; display: block;\">\n            æç¤ºï¼šä¿®æ”¹IDä¼šåˆ‡æ¢åˆ°ä¸åŒçš„å­˜æ¡£åˆ†æ”¯ï¼Œè¯·è°¨æ…æ“ä½œ\n        </small>\n    </div>\n    \n    <!-- åŸæœ‰çš„å¿«ç…§ç®¡ç†éƒ¨åˆ† -->\n    <label>è®°å¿†å¿«ç…§åˆ é™¤ç®¡ç†ï¼ˆæ’åˆ—æ˜¯æŒ‰ç…§æ—¶é—´é¡ºåºæ¥çš„ï¼Œä¸€èˆ¬ä¸ç”¨ç®¡è¿™ä¸ªï¼‰</label>\n    <div class=\"db-controls\">\n        <button id=\"refresh-snapshots-btn\" class=\"control-btn\">åˆ·æ–°åˆ—è¡¨</button>\n        <button id=\"restore-latest-snapshot-btn\" class=\"control-btn special-btn\" title=\"ä»å½“å‰æµè§ˆå™¨å­˜åœ¨çš„æœ€æ–°ä¸€ä»½å¿«ç…§ä¸­æ¢å¤ã€‚\">æ¢å¤è‡³æœ€æ–°å¿«ç…§</button>\n        <button id=\"delete-all-snapshots-btn\" class=\"control-btn danger-btn\">æ¸…é™¤æ‰€æœ‰å¿«ç…§</button>\n    </div>\n    <div id=\"snapshot-list\" class=\"log-output\" style=\"max-height: 150px; overflow-y: auto;\">\n        ç‚¹å‡»\"åˆ·æ–°åˆ—è¡¨\"æ¥æŸ¥çœ‹æ‰€æœ‰å­˜æ¡£çš„å¿«ç…§...\n    </div>\n</div>\n            </div>\n        </div>\n\n        <!-- ç´ æå·¥åŠé¡µ -->\n        <div class=\"settings-page\" id=\"settings-page-asset\">\n            <div id=\"custom-asset-container\" class=\"setting-item-column\">\n                <label>æˆ‘çš„ç´ æå·¥åŠ</label>\n                <div class=\"custom-asset-tabs\">\n                    <button class=\"asset-tab-btn active\" data-target=\"npc-panel\">è‡ªå®šä¹‰ç«‹ç»˜</button>\n                    <button class=\"asset-tab-btn\" data-target=\"meme-panel\">è‡ªå®šä¹‰è¡¨æƒ…</button>\n                </div>\n                <div id=\"npc-panel\" class=\"asset-panel active\">\n                    <form id=\"upload-npc-form\" class=\"asset-upload-form\">\n                        <p>ä¸Šä¼ æ–°çš„ç«‹ç»˜ (PNG/JPG/GIF)</p>\n                        <input type=\"text\" id=\"npc-name-input\" placeholder=\"ä¸ºç«‹ç»˜å‘½å (å¦‚ï¼šç™½å‘é­”å¥³)\" required>\n                        <div class=\"file-input-wrapper\">\n                            <input type=\"file\" id=\"npc-file-input\" accept=\"image/*\" required>\n                            <button type=\"button\" onclick=\"document.getElementById('npc-file-input').click()\" class=\"control-btn\">é€‰æ‹©æ–‡ä»¶</button>\n                            <span class=\"file-name-display\">æœªé€‰æ‹©æ–‡ä»¶</span>\n                        </div>\n                        <button type=\"submit\" class=\"control-btn primary\">ä¸Šä¼ ç«‹ç»˜</button>\n                    </form>\n                    <div class=\"asset-list-container\">\n                        <p>å·²ä¸Šä¼ çš„ç«‹ç»˜</p>\n                        <div id=\"custom-npc-list\" class=\"asset-list\">æ­£åœ¨åŠ è½½...</div>\n                    </div>\n                </div>\n                <div id=\"meme-panel\" class=\"asset-panel\">\n                    <form id=\"upload-meme-form\" class=\"asset-upload-form\">\n                        <p>ä¸Šä¼ æ–°çš„è¡¨æƒ… (PNG/JPG/GIF)</p>\n                        <input type=\"text\" id=\"meme-name-input\" placeholder=\"ä¸ºè¡¨æƒ…å‘½å (å¦‚ï¼šçŒ«çŒ«éœ‡æƒŠ)\" required>\n                        <div class=\"file-input-wrapper\">\n                            <input type=\"file\" id=\"meme-file-input\" accept=\"image/*\" required>\n                            <button type=\"button\" onclick=\"document.getElementById('meme-file-input').click()\" class=\"control-btn\">é€‰æ‹©æ–‡ä»¶</button>\n                            <span class=\"file-name-display\">æœªé€‰æ‹©æ–‡ä»¶</span>\n                        </div>\n                        <button type=\"submit\" class=\"control-btn primary\">ä¸Šä¼ è¡¨æƒ…</button>\n                    </form>\n                    <div class=\"asset-list-container\">\n                        <p>å·²ä¸Šä¼ çš„è¡¨æƒ…</p>\n                        <div id=\"custom-meme-list\" class=\"asset-list\">æ­£åœ¨åŠ è½½...</div>\n                    </div>\n                </div>\n            </div>\n        </div>\n<div class=\"settings-page\" id=\"settings-page-workshop\">\n    <div class=\"workshop-container\">\n\n        <div class=\"workshop-toolbar\">\n            <div class=\"workshop-search\">\n                <input type=\"text\" id=\"workshop-search-input\" placeholder=\"æœç´¢æ¨¡ç»„...\">\n                <button id=\"workshop-search-btn\" class=\"control-btn\">ğŸ”</button>\n            </div>\n      <div class=\"workshop-filters\">\n    <button class=\"filter-tag active\" data-tag=\"all\">å…¨éƒ¨</button>\n    <button class=\"filter-tag\" data-tag=\"UI\">ç•Œé¢</button>\n    <button class=\"filter-tag\" data-tag=\"world\">ä¸–ç•Œä¹¦</button>\n</div>\n            <button id=\"workshop-refresh-btn\" class=\"control-btn special-btn\">åˆ·æ–°åˆ—è¡¨</button>\n             <button id=\"workshop-reload-runtime-btn\" class=\"control-btn danger-btn\" title=\"åº”ç”¨æ‰€æœ‰å·²å¼€å¯çš„Mod (éœ€åˆ·æ–°é¡µé¢)\">é‡è½½ç”Ÿæ•ˆ</button>\n        </div>\n\n\n        <div id=\"workshop-mod-list\" class=\"workshop-list\">\n\n            <div class=\"workshop-loading\">æ­£åœ¨è¿æ¥åˆ›æ„å·¥åŠ...</div>\n        </div>\n    </div>\n</div>\n    </div>\n</div>\n\n<div id=\"reconfig-modal\" class=\"modal-overlay\" style=\"display: none; z-index: 99999999;\">\n    <div class=\"reconfig-modal-content\">\n        <button id=\"reconfig-modal-close-btn\" class=\"reconfig-modal-close\">Ã—</button>\n        <h2 class=\"reconfig-title\">æ¨¡ç»„è®¾å®š</h2>\n <p class=\"reconfig-subtitle\">éšæ—¶è°ƒæ•´æ•…äº‹çš„è§„åˆ™ã€‚</p>\n\n\n<div class=\"reconfig-worldview-section\">\n    <h3 class=\"reconfig-section-title\">ä¸–ç•Œè§‚é€‰æ‹© (å½“å‰: <span id=\"current-worldview-display\" style=\"color: var(--accent-color);\">è¯»å–ä¸­...</span>)</h3>\n    <div id=\"reconfig-worldview-container\" class=\"reconfig-grid reconfig-grid-worldview\">\n\n    </div>\n</div>\n<h3 class=\"reconfig-section-title\">æ¨¡ç»„å¼€å…³</h3>\n\n\n<div id=\"reconfig-mod-container\" class=\"reconfig-grid\">\n    </div>\n\n    <div class=\"reconfig-footer\">\n        <span id=\"reconfig-feedback-msg\" class=\"reconfig-feedback\"></span>\n        <button id=\"apply-reconfig-btn\" class=\"reconfig-apply-btn\">åº”ç”¨æ›´æ”¹</button>\n    </div>\n</div>\n</div>\n\n<div id=\"group-chat-modal-container\" class=\"group-chat-modal\">\n  <div id=\"group-chat-root\" class=\"group-chat-main-container\">\n\n  </div>\n</div>\n\n\n<div id=\"reading-mode-container\" class=\"reading-mode-hidden\">\n    <div id=\"reading-mode-backdrop\"></div>\n    <div id=\"reading-mode-modal\">\n<div class=\"reading-mode-header\">\n    <div style=\"display: flex; gap: 10px; align-items: center;\">\n        <div id=\"reading-mode-toggle-chapters\" class=\"chapters-toggle-btn\">ç›®å½•</div>\n        <button id=\"starred-filter-btn\" class=\"filter-star-btn\">â­</button>\n    </div>\n    <span id=\"reading-mode-chapter-title\"></span>\n    <div style=\"display: flex; gap: 10px; align-items: center;\">\n        <!-- èœå•æŒ‰é’®ä¼šé€šè¿‡ JS åŠ¨æ€æ’å…¥åˆ°è¿™é‡Œï¼Œä½†CSSå®šä½å·²è°ƒæ•´ -->\n        <div id=\"reading-mode-close-btn\">Ã—</div>\n    </div>\n</div>\n\n        <div class=\"reading-mode-body\">\n            <div id=\"reading-mode-chapters-nav\">\n                <div class=\"chapters-nav-header\">ç« èŠ‚ç›®å½•</div>\n                <ul id=\"reading-mode-chapters-list\"></ul>\n            </div>\n            <div id=\"reading-mode-content-wrapper\">\n                <div class=\"nav-arrow left-arrow\" id=\"reading-mode-prev-btn\"><</div>\n                <div id=\"reading-mode-content\"></div>\n                <div class=\"nav-arrow right-arrow\" id=\"reading-mode-next-btn\">></div>\n            </div>\n        </div>\n        <div id=\"mobile-nav-bar\">\n    <div class=\"nav-arrow\" id=\"mobile-prev-btn\">&lt;</div>\n    <div class=\"nav-arrow\" id=\"mobile-next-btn\">&gt;</div>\n</div>\n    </div>\n</div>\n\n\n\n    <div id=\"battle-overlay\">\n        <div id=\"battle-container\">\n            <div class=\"battle-arena\">\n                <div id=\"enemy-side\" class=\"side enemy-side\">\n                    <!-- æ•Œäººä¼šåŠ¨æ€ç”Ÿæˆåœ¨è¿™é‡Œ -->\n                </div>\n                <div id=\"player-side\" class=\"side player-side\">\n                    <!-- ç©å®¶å’Œé˜Ÿå‹ä¼šåŠ¨æ€ç”Ÿæˆåœ¨è¿™é‡Œ -->\n                </div>\n            </div>\n\n <footer class=\"battle-controls\">\n    <div class=\"battle-left-panel\">\n        <div class=\"battle-log-container\" id=\"battle-log\">\n\n        </div>\n        <div id=\"speed-control-container\">\n            <label for=\"speed-slider\">é€Ÿåº¦:</label>\n            <input type=\"range\" id=\"speed-slider\" min=\"0\" max=\"3\" value=\"1\">\n            <span id=\"speed-label\">æ­£å¸¸</span>\n                <div id=\"icon-selector\" style=\"display: flex; align-items: center; gap: 5px; margin-left: 15px; cursor: pointer;\">\n        <label>å¾½è®°:</label>\n        <span id=\"player-icon-display\" style=\"font-size: 20px;\" title=\"ç‚¹å‡»æ›´æ¢ä½ çš„æˆ˜æ–—å¾½è®°\">âœ¨</span>\n    </div>\n      <div id=\"auto-battle-control\" style=\"display: flex; align-items: center; gap: 5px; margin-left: 15px; cursor: pointer;\">\n        <label for=\"auto-battle-checkbox\">è‡ªåŠ¨:</label>\n        <input type=\"checkbox\" id=\"auto-battle-checkbox\" title=\"å¼€å¯åï¼Œä½ çš„å›åˆå°†ç”±AIè‡ªåŠ¨æ“ä½œ\">\n    </div>\n        </div>\n    </div>\n    <div class=\"action-panel\" id=\"action-panel\">\n        <button data-action=\"attack\">æ”»å‡»</button>\n        <button data-action=\"persuade\">è¯´æœ</button>\n         <button data-action=\"scan\">ä¾¦å¯Ÿ</button>\n        <button data-action=\"steal\">ç›—çªƒ</button>\n        <button data-action=\"treat\">æ²»ç–—</button>\n        <button data-action=\"defend\">é˜²å¾¡</button>\n        <button data-action=\"flee\">é€ƒè·‘</button>\n        <button data-action=\"item\">ç‰©å“/æŠ€èƒ½</button>\n        <br>\n        <button data-action=\"exit\">å¼ºåˆ¶é€€å‡º</button>\n    </div>\n</footer>\n        </div>\n    </div>\n\n    <div id=\"dice-pool-selector\">\n        <h3>é€‰æ‹©ä½ çš„éª°æ± </h3>\n        <div id=\"pool-options\" class=\"pool-options\">\n            <!-- éª°æ± é€‰é¡¹ä¼šåœ¨è¿™é‡Œç”Ÿæˆ -->\n        </div>\n        <button id=\"confirm-pool-btn\">ç¡®è®¤</button>\n    </div>\n<div id=\"notification-container\"></div>\n<div id=\"item-skill-panel\" style=\"display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 500px; max-height: 70vh; background-color: var(--container-bg-color); border: 1px solid var(--primary-color); padding: 20px; border-radius: 10px; box-shadow: 0 0 20px var(--glow-color); z-index: 10000; flex-direction: column; gap: 15px;\">\n    <h3 style=\"margin: 0; color: var(--primary-color); text-align: center;\">è¡Œå›Šä¸èƒ½åŠ›</h3>\n    <div style=\"display: flex; gap: 10px; border-bottom: 1px solid var(--border-color); padding-bottom: 5px;\">\n        <button class=\"tab-btn active\" onclick=\"showTab('items')\">ç‰©å“</button>\n        <button class=\"tab-btn\" onclick=\"showTab('skills')\">æŠ€èƒ½</button>\n    </div>\n    <div id=\"items-tab\" class=\"tab-content\" style=\"overflow-y: auto; padding-right: 10px;\">\n\n    </div>\n    <div id=\"skills-tab\" class=\"tab-content\" style=\"display: none; overflow-y: auto; padding-right: 10px;\">\n\n    </div>\n    <div style=\"text-align: center; margin-top: 15px;\">\n        <button id=\"close-item-skill-panel-btn\" style=\"padding: 8px 16px; color: var(--secondary-color); background-color: transparent; border: 1px solid var(--secondary-color); border-radius: 4px; cursor: pointer;\">å…³é—­</button>\n    </div>\n</div>\n\n <div id=\"battle-prompt-overlay\" style=\"display: none; position: fixed; bottom: 0; left: 0; width: 100%; height: 35%; /* åªè¦†ç›–åº•éƒ¨çº¦ä¸‰åˆ†ä¹‹ä¸€çš„åŒºåŸŸ */ background: linear-gradient(to top, var(--background-color) 30%, transparent); z-index: 2000; justify-content: center; align-items: center; pointer-events: all; /* å…³é”®ï¼šè®©å®ƒé˜»æŒ¡ç‚¹å‡» */\">\n    <button id=\"enter-battle-btn\" class=\"start-battle-btn\" style=\"transform: scale(1.2);\">âš”ï¸ è¿›å…¥æˆ˜æ–— âš”ï¸</button>\n</div>\n<div id=\"attack-mode-selector\" style=\"display: none; position: fixed; top: 40%; left: 50%; transform: translate(-50%, -50%); background-color: var(--container-bg-color); border: 1px solid var(--primary-color); padding: 20px; border-radius: 10px; box-shadow: 0 0 20px var(--glow-color); z-index: 10001; text-align: center;\">\n    <h4 style=\"margin-top: 0; color: var(--primary-color);\">é€‰æ‹©æ”»å‡»æ¨¡å¼</h4>\n    <div style=\"display: flex; flex-direction: column; gap: 10px;\">\n        <button id=\"select-single-target\" class=\"attack-mode-btn\">å•ä½“æ”»å‡»</button>\n        <button id=\"select-multi-target\" class=\"attack-mode-btn\">ç¾¤æ”» (è‡ªå®šä¹‰)</button>\n        <button id=\"select-all-targets\" class=\"attack-mode-btn\">ç¾¤æ”» (å…¨ä½“)</button>\n    </div>\n    <button id=\"cancel-attack-mode\" style=\"margin-top: 15px;\">å–æ¶ˆ</button>\n</div>\n\n<div id=\"log-wrapper\">\n    <div id=\"log-toggle-button\" title=\"æŸ¥çœ‹æ›´æ–°è®°å½•\">\n        <div class=\"arrow\"></div>\n    </div>\n    <div id=\"notification-log-panel\">\n        <div id=\"notification-log-container\"></div>\n    </div>\n</div>\n\n\n\n<div id=\"notification-container\"></div>\n\n\n <!-- æç¤ºè¯æŸ¥çœ‹å¼¹çª— -->\n<div id=\"prompt-viewer-modal\" style=\"\n    display: none;\n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 100vw;\n    height: 100vh;\n    background: rgba(0, 0, 0, 0.8);\n    z-index: 999999;\n    justify-content: center;\n    align-items: center;\n    backdrop-filter: blur(5px);\n\">\n    <div class=\"modal-content\" style=\"\n        position: relative;\n        max-width: 90%;\n        width: 1000px;\n        max-height: 90vh;\n        background: var(--container-bg-color);\n        border: 2px solid var(--border-color);\n        border-radius: 12px;\n        box-shadow: 0 0 40px var(--glow-color), 0 0 80px rgba(0, 250, 255, 0.3);\n        display: flex;\n        flex-direction: column;\n        padding: 24px;\n    \">\n        <button class=\"modal-close\" style=\"\n            position: absolute;\n            top: 10px;\n            right: 10px;\n            background: var(--danger-color);\n            border: none;\n            color: white;\n            font-size: 24px;\n            width: 36px;\n            height: 36px;\n            border-radius: 50%;\n            cursor: pointer;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            transition: all 0.3s ease;\n            box-shadow: 0 0 10px var(--danger-glow-color);\n            z-index: 1;\n        \" onmouseover=\"this.style.transform='scale(1.1)'; this.style.boxShadow='0 0 20px var(--danger-glow-color)';\" \n           onmouseout=\"this.style.transform='scale(1)'; this.style.boxShadow='0 0 10px var(--danger-glow-color)';\">Ã—</button>\n        \n        <div class=\"modal-title\" style=\"\n            color: var(--primary-color);\n            font-size: 24px;\n            font-weight: bold;\n            margin-bottom: 20px;\n            text-shadow: 0 0 10px var(--glow-color);\n        \">æ•è·çš„æç¤ºè¯</div>\n        \n        <div style=\"\n            flex: 1;\n            overflow-y: auto;\n            background: rgba(0, 0, 0, 0.4);\n            border: 1px solid var(--border-color);\n            border-radius: 8px;\n            padding: 16px;\n            box-shadow: inset 0 0 20px rgba(0, 250, 255, 0.2);\n        \">\n            <pre id=\"prompt-content-display\" style=\"\n                color: var(--text-color);\n                font-family: 'Courier New', monospace;\n                font-size: 13px;\n                line-height: 1.6;\n                white-space: pre-wrap;\n                word-wrap: break-word;\n                margin: 0;\n            \">æš‚æ— æ•è·çš„æç¤ºè¯</pre>\n        </div>\n        \n        <div style=\"margin-top: 16px; display: flex; gap: 12px; justify-content: flex-end;\">\n            <button id=\"copy-prompt-btn\" style=\"\n                background: linear-gradient(135deg, var(--success-color), #3dd976);\n                border: 1px solid var(--success-glow-color);\n                color: var(--background-color);\n                padding: 10px 20px;\n                border-radius: 6px;\n                cursor: pointer;\n                font-weight: bold;\n                transition: all 0.3s ease;\n                box-shadow: 0 0 10px var(--success-glow-color);\n            \" onmouseover=\"this.style.transform='scale(1.05)';\" \n               onmouseout=\"this.style.transform='scale(1)';\">\n                å¤åˆ¶åˆ°å‰ªè´´æ¿\n            </button>\n        </div>\n    </div>\n</div>\n</body>\n\n<script>\nlet current_game_version = '3.3.10';\n let prompts_be_sent = null;\n \nlet storyChapters = [];\nlet currentChapterIndex = 0;\nlet isReadingModeOpen = false;\n\n    // å…¨å±€å˜é‡å­˜å‚¨æ•°æ®\n    let currentMapData = null;\n    let currentGameData = null;\n   // --- å…¨å±€å˜é‡å’Œæ•°æ®è·å– ---\n        let playCharacterData = TavernHelper.getVariables({ type: 'chat' }).play_character_data;\n        let assaSettingsData = {};\n let conversationHistory = [];\nlet checkMemoryData = null;   // ç”¨äºå­˜å‚¨ä¸Šä¸€è½®çš„æŠ•æ·è®°å¿†\n let worldAttitudeData = null; // ç”¨äºå­˜å‚¨ä¸–ç•Œæ€åº¦å˜é‡\nlet characterStatusData = null; // ç”¨äºå­˜å‚¨äººç‰©çŠ¶æ€å˜é‡\nlet lasttoken = 0;\nlet summarys = null;\nlet ISNEWMAP = \"false\";\nlet isEmphasizeTime = \"false\";\nlet is_simple_stream = \"false\";\nlet noBackup = \"false\";\nlet is_restore_prompt = \"true\";\nlet is_show_notifications = \"true\";\n\n    let worldBookState = {\n        currentTab: 'settings', // é»˜è®¤æ˜¾ç¤ºè®¾å®š\n        currentPage: 1,\n        itemsPerPage: 5, // æ¯é¡µæ˜¾ç¤º5æ¡ï¼Œä½ å¯ä»¥æ ¹æ®å–œå¥½è°ƒæ•´\n        data: {}\n    };\nconst processedImageCache = new Map();\nlet userName = 'ç”¨æˆ·';\n  // å¦ˆå¦ˆä¸ºä½ è®¾å®šçš„ä¸–ç•Œä¹¦ID\n    const LOREBOOK_NAME = \"å°èŒèšªæ‰¾å¦ˆå¦ˆ-åŒå±‚ç‰ˆ\";\n    const LOREBOOK_UID = 30;\n      // å¦ˆå¦ˆä¸ºä½ æ•´ç†çš„ä¸–ç•Œè§‚æ¨¡å¼UID\n    const WORLD_MODE_UIDS = {\n        'all': [1, 5, 22],\n        'reincarnation': 22,\n        'infinite': 5,\n        'godspace': 1\n    };\n    const CREATOR_ATTITUDE_UIDS = {\n        'all': [19, 4, 3],\n        'neutral': 19,\n        'malicious': 4,\n        'reverent': 3\n    };\n    const OPTIONS_MODE_UIDS = {\n        'all': [10, 29],\n        'on': 10,\n        'off': 29\n    };\n       // ğŸ’– å”¯ä¸€çœŸèº«å®ˆæŠ¤å’’è¯­ (å¤–éƒ¨HTMLç‰ˆ) ğŸ’–\n    if (window.isZeroLevelUIInitialized) {\n        //console.log(\"[HTML] âš ï¸ æ£€æµ‹åˆ°é‡å¤å¬å”¤ï¼Œå·²å¯åŠ¨å®ˆæŠ¤å±éšœï¼Œé˜»æ­¢äº†UIè„šæœ¬çš„ç¬¬äºŒæ¬¡åˆå§‹åŒ–ã€‚\");\n    } else {\n        window.isZeroLevelUIInitialized = true;\n        //console.log(\"[HTML] âœ¨ UIè„šæœ¬é¦–æ¬¡å¯åŠ¨ï¼Œå·²ç›–ä¸Šå”¯ä¸€çµé­‚å°è®°ã€‚\");\n    'use strict';\n    \n    \n      const themes = [\n    // --- ä½ æœ€åˆçš„èµ›åšæœ‹å…‹ç³»åˆ—ï¼Œå®ƒä»¬æ˜¯åŸºçŸ³ ---\n    { // ä¸»é¢˜ä¸€ï¼šèµ›åšè“ (Cyber Blue)\n        '--primary-color': '#00faff',\n        '--secondary-color': '#7affff',\n        '--container-bg-color': 'rgba(10, 25, 47, 0.75)',\n        '--border-color': 'rgba(0, 250, 255, 0.3)',\n        '--glow-color': 'rgba(0, 250, 255, 0.5)',\n        '--background-color': '#0a192f',\n        '--text-color': '#e6f1ff', // æ˜äº®çš„è“ç™½è‰²ï¼Œç¡®ä¿åœ¨æ·±è‰²èƒŒæ™¯ä¸‹æ¸…æ™°\n         '--text-secondary-color': '#ffe6e6',\n    },\n    { // ä¸»é¢˜äºŒï¼šè­¦æˆ’çº¢ (Warning Red)\n        '--primary-color': '#ff4d4d',\n        '--secondary-color': '#ff8c8c',\n        '--container-bg-color': 'rgba(47, 10, 10, 0.75)',\n        '--border-color': 'rgba(255, 77, 77, 0.4)',\n        '--glow-color': 'rgba(255, 77, 77, 0.6)',\n        '--background-color': '#2f0a0a',\n        '--text-color': '#ffe6e6', // æŸ”å’Œçš„çº¢è‰²è°ƒç™½è‰²ï¼Œä¸ä¸»é¢˜å‘¼åº”\n        '--text-secondary-color': '#ffe6e6',\n    },\n    { // ä¸»é¢˜ä¸‰ï¼šçŸ©é˜µç»¿ (Matrix Green)\n        '--primary-color': '#39ff14',\n        '--secondary-color': '#bfffb3',\n        '--container-bg-color': 'rgba(10, 47, 15, 0.75)',\n        '--border-color': 'rgba(57, 255, 20, 0.4)',\n        '--glow-color': 'rgba(57, 255, 20, 0.6)',\n        '--background-color': '#0a2f0a',\n        '--text-color': '#e6ffe8', // å¸¦æœ‰å¾®ç»¿çš„äº®è‰²ï¼Œç»å…¸ä»£ç æ„Ÿ\n         '--text-secondary-color': '#ffe6e6',\n    },\n    { // ä¸»é¢˜å››ï¼šæ·±ç©ºç´« (Deep Space Purple)\n        '--primary-color': '#c48cff',\n        '--secondary-color': '#e1c6ff',\n        '--container-bg-color': 'rgba(25, 10, 47, 0.75)',\n        '--border-color': 'rgba(196, 140, 255, 0.4)',\n        '--glow-color': 'rgba(196, 140, 255, 0.6)',\n        '--background-color': '#190a2f',\n        '--text-color': '#f3e6ff', // æµ…ç´«è‰²è°ƒçš„ç™½è‰²ï¼Œå¢æ·»ç¥ç§˜æ„Ÿ\n         '--text-secondary-color': '#ffe6e6',\n    },\n\n    \n    { // ä¸»é¢˜ä¸ƒï¼šæˆ˜åœ°è¿·å½© (Military Olive)\n        '--primary-color': '#808000',\n        '--secondary-color': '#C3B091',\n        '--container-bg-color': 'rgba(47, 53, 49, 0.8)',\n        '--border-color': 'rgba(128, 128, 0, 0.4)',\n        '--glow-color': 'rgba(128, 128, 0, 0.3)',\n        '--background-color': '#2E3430',\n        '--text-color': '#E5E4E2', // ç•¥å¸¦ç°åº¦çš„æˆ˜æœ¯ç™½ï¼Œå†·é™å®ç”¨\n         '--text-secondary-color': '#ffe6e6',\n    },\n      { // ä¸»é¢˜äº”ï¼šå¤ç±ç¾Šçš®çº¸\n         '--text-color': '#6a6253', // ç•¥å¸¦ç°åº¦çš„æˆ˜æœ¯ç™½ï¼Œå†·é™å®ç”¨\n            '--primary-color': '#7d6b54',          // ä¸»é¢˜è‰²ï¼Œæºè‡ªâ€œé€‰ä¸­ä¹¦ç­¾èƒŒæ™¯è‰²â€\n            '--secondary-color': '#a08c72',        // æ¬¡è¦è‰²ï¼Œæºè‡ªâ€œä¹¦ç­¾é»˜è®¤èƒŒæ™¯è‰²â€\n            '--text-primary-color': '#6d5b4b',      // ä¸»æ–‡å­—è‰²\n            '--text-secondary-color': '#8b7963',   // æ¬¡æ–‡å­—è‰²\n            '--container-bg-color': 'rgba(243,234,206,0.75)',     // å®¹å™¨èƒŒæ™¯ï¼Œæºè‡ªâ€œä¹¦æœ¬å†…å®¹åŒºèƒŒæ™¯â€\n            '--border-color': 'rgba(200,184,154,0,4)',           // è¾¹æ¡†è‰²ï¼Œæºè‡ªâ€œåˆ†å‰²çº¿é¢œè‰²â€\n            '--glow-color': 'rgba(200,184,154,0,3)',             // è¾‰å…‰è‰²ï¼Œç”¨è¾¹æ¡†è‰²æ¥å¼ºåŒ–è´¨æ„Ÿï¼Œè€Œéå‘å…‰\n            '--background-color': '#fdfaf2'        // æ•´ä½“èƒŒæ™¯è‰²\n        },\n        { // ä¸»é¢˜ï¼šç»å…¸é»‘ç™½ (Classic Monochrome)\n    '--primary-color': '#ffffff',\n    '--secondary-color': '#cccccc',\n    '--container-bg-color': 'rgba(40, 40, 40, 0.85)',\n    '--border-color': 'rgba(255, 255, 255, 0.3)',\n    '--glow-color': 'rgba(255, 255, 255, 0.4)',\n    '--background-color': '#1a1a1a',\n    '--text-color': '#f5f5f5',\n    '--text-secondary-color': '#d0d0d0',\n},\n{ // ä¸»é¢˜ï¼šæç®€ç°ç™½ (Minimal Grey)\n    '--primary-color': '#000000',\n    '--secondary-color': '#f5f5f5',\n    '--container-bg-color': 'rgba(248, 248, 248, 0.9)',\n    '--border-color': 'rgba(200, 200, 200, 0.5)',\n    '--glow-color': 'rgba(180, 180, 180, 0.3)',\n    '--background-color': '#ffffff',\n    '--text-color': '#000000',\n    '--text-secondary-color': '#333333',\n},\n\n{ // ä¸»é¢˜ï¼šåˆå¤œè“ç²‰ (Midnight Blush)\n    '--primary-color': '#ff80bf',\n    '--secondary-color': '#ffb3d9',\n    '--container-bg-color': 'rgba(25, 30, 45, 0.8)',\n    '--border-color': 'rgba(255, 128, 191, 0.4)',\n    '--glow-color': 'rgba(255, 128, 191, 0.5)',\n    '--background-color': '#0f1419',\n    '--text-color': '#e6f0ff',\n    '--text-secondary-color': '#ffe6f2',\n}\n    \n \n];\n      // èƒŒæ™¯å›¾ç‰‡æ˜ å°„è¡¨\nconst backgroundImageMap_fallbackData =   {\n    \"ç°ä»£å»ºç­‘ç¾¤-BrightDay-Peaceful\": \"https://files.catbox.moe/ki5j2t.png\",\n    \"ç°ä»£å»ºç­‘ç¾¤-BrightDay-Decay\": \"https://files.catbox.moe/hc3hyj.png\",\n    \"ç°ä»£å»ºç­‘ç¾¤-BrightDay-Dynamic\": \"https://files.catbox.moe/wga736.png\",\n    \"ç°ä»£å»ºç­‘ç¾¤-BrightDay-Eerie\": \"https://files.catbox.moe/tg1uwg.png\",\n    \"ç°ä»£å»ºç­‘ç¾¤-OvercastDay-Peaceful\": \"https://files.catbox.moe/1gxhka.png\",\n    \"ç°ä»£å»ºç­‘ç¾¤-OvercastDay-Decay\": \"https://files.catbox.moe/xapaxa.png\",\n    \"ç°ä»£å»ºç­‘ç¾¤-OvercastDay-Dynamic\": \"https://files.catbox.moe/k36908.png\",\n    \"ç°ä»£å»ºç­‘ç¾¤-OvercastDay-Eerie\": \"https://files.catbox.moe/ec0q9y.png\",\n    \"ç°ä»£å»ºç­‘ç¾¤-GoldenHour-Peaceful\": \"https://files.catbox.moe/y3l604.png\",\n    \"ç°ä»£å»ºç­‘ç¾¤-GoldenHour-Decay\": \"https://files.catbox.moe/ts623u.png\",\n    \"ç°ä»£å»ºç­‘ç¾¤-GoldenHour-Dynamic\": \"https://files.catbox.moe/3rf2uk.png\",\n    \"ç°ä»£å»ºç­‘ç¾¤-GoldenHour-Eerie\": \"https://files.catbox.moe/zyg7m1.png\",\n    \"ç°ä»£å»ºç­‘ç¾¤-DeepNight-Peaceful\": \"https://files.catbox.moe/8m854e.png\",\n    \"ç°ä»£å»ºç­‘ç¾¤-DeepNight-Decay\": \"https://files.catbox.moe/y2pkfs.png\",\n    \"ç°ä»£å»ºç­‘ç¾¤-DeepNight-Dynamic\": \"https://files.catbox.moe/uh1vrp.png\",\n    \"ç°ä»£å»ºç­‘ç¾¤-DeepNight-Eerie\": \"https://files.catbox.moe/h2wugc.png\",\n    \"ç°ä»£å»ºç­‘ç¾¤-ArtificialLight-Peaceful\": \"https://files.catbox.moe/yuszwp.png\",\n    \"ç°ä»£å»ºç­‘ç¾¤-ArtificialLight-Decay\": \"https://files.catbox.moe/vuz182.png\",\n    \"ç°ä»£å»ºç­‘ç¾¤-ArtificialLight-Dynamic\": \"https://files.catbox.moe/s86gut.png\",\n    \"ç°ä»£å»ºç­‘ç¾¤-ArtificialLight-Eerie\": \"https://files.catbox.moe/p6nowg.png\",\n   \n    \"æ‹±é—¨å»ºç­‘å®¤å†…-BrightDay-Peaceful\": \"https://files.catbox.moe/d214yn.png\",\n    \"æ‹±é—¨å»ºç­‘å®¤å†…-BrightDay-Decay\": \"https://files.catbox.moe/kwfnhn.png\",\n    \"æ‹±é—¨å»ºç­‘å®¤å†…-BrightDay-Dynamic\": \"https://files.catbox.moe/uy3kte.png\",\n    \"æ‹±é—¨å»ºç­‘å®¤å†…-BrightDay-Eerie\": \"https://files.catbox.moe/jbmskc.png\",\n    \"æ‹±é—¨å»ºç­‘å®¤å†…-OvercastDay-Peaceful\": \"https://files.catbox.moe/81e8nc.png\",\n    \"æ‹±é—¨å»ºç­‘å®¤å†…-OvercastDay-Decay\": \"https://files.catbox.moe/6entar.png\",\n    \"æ‹±é—¨å»ºç­‘å®¤å†…-OvercastDay-Dynamic\": \"https://files.catbox.moe/h39raz.png\",\n    \"æ‹±é—¨å»ºç­‘å®¤å†…-OvercastDay-Eerie\": \"https://files.catbox.moe/m3xp9i.png\",\n    \"æ‹±é—¨å»ºç­‘å®¤å†…-GoldenHour-Peaceful\": \"https://files.catbox.moe/7ys6wf.png\",\n    \"æ‹±é—¨å»ºç­‘å®¤å†…-GoldenHour-Decay\": \"https://files.catbox.moe/lbcd5b.png\",\n    \"æ‹±é—¨å»ºç­‘å®¤å†…-GoldenHour-Dynamic\": \"https://files.catbox.moe/zeam8z.png\",\n    \"æ‹±é—¨å»ºç­‘å®¤å†…-GoldenHour-Eerie\": \"https://files.catbox.moe/dx685v.png\",\n    \"æ‹±é—¨å»ºç­‘å®¤å†…-DeepNight-Peaceful\": \"https://files.catbox.moe/5g5a7z.png\",\n    \"æ‹±é—¨å»ºç­‘å®¤å†…-DeepNight-Decay\": \"https://files.catbox.moe/lvw1a3.png\",\n    \"æ‹±é—¨å»ºç­‘å®¤å†…-DeepNight-Dynamic\": \"https://files.catbox.moe/al84vh.png\",\n    \"æ‹±é—¨å»ºç­‘å®¤å†…-DeepNight-Eerie\": \"https://files.catbox.moe/inptoq.png\",\n    \"æ‹±é—¨å»ºç­‘å®¤å†…-ArtificialLight-Peaceful\": \"https://files.catbox.moe/v9i1ed.png\",\n    \"æ‹±é—¨å»ºç­‘å®¤å†…-ArtificialLight-Decay\": \"https://files.catbox.moe/7gzrfu.png\",\n    \"æ‹±é—¨å»ºç­‘å®¤å†…-ArtificialLight-Dynamic\": \"https://files.catbox.moe/h3uytp.png\",\n    \"æ‹±é—¨å»ºç­‘å®¤å†…-ArtificialLight-Eerie\": \"https://files.catbox.moe/k2m4e6.png\",\n    \n    \"Wasteland-BrightDay-Peaceful\": \"https://files.catbox.moe/uxe76e.png\",\n    \"Wasteland-BrightDay-Decay\": \"https://files.catbox.moe/a21n5h.png\",\n    \"Wasteland-BrightDay-Dynamic\": \"https://files.catbox.moe/7673rq.png\",\n    \"Wasteland-BrightDay-Eerie\": \"https://files.catbox.moe/et0qkv.png\",\n    \"Wasteland-OvercastDay-Peaceful\": \"https://files.catbox.moe/hn0y8a.png\",\n    \"Wasteland-OvercastDay-Decay\": \"https://files.catbox.moe/yixtu9.png\",\n    \"Wasteland-OvercastDay-Dynamic\": \"https://files.catbox.moe/q5nhyx.png\",\n    \"Wasteland-OvercastDay-Eerie\": \"https://files.catbox.moe/dwd4ei.png\",\n    \"Wasteland-GoldenHour-Peaceful\": \"https://files.catbox.moe/pnfws9.png\",\n    \"Wasteland-GoldenHour-Decay\": \"https://files.catbox.moe/14tzmg.png\",\n    \"Wasteland-GoldenHour-Dynamic\": \"https://files.catbox.moe/bvaf8y.png\",\n    \"Wasteland-GoldenHour-Eerie\": \"https://files.catbox.moe/bci8rh.png\",\n    \"Wasteland-DeepNight-Peaceful\": \"https://files.catbox.moe/x3o7eg.png\",\n    \"Wasteland-DeepNight-Decay\": \"https://files.catbox.moe/z3vn77.png\",\n    \"Wasteland-DeepNight-Dynamic\": \"https://files.catbox.moe/9k86lc.png\",\n    \"Wasteland-DeepNight-Eerie\": \"https://files.catbox.moe/1yoxrp.png\",\n    \"Wasteland-ArtificialLight-Peaceful\": \"https://files.catbox.moe/abgocm.png\",\n    \"Wasteland-ArtificialLight-Decay\": \"https://files.catbox.moe/icgzf1.png\",\n    \"Wasteland-ArtificialLight-Dynamic\": \"https://files.catbox.moe/yjfr62.png\",\n    \"Wasteland-ArtificialLight-Eerie\": \"https://files.catbox.moe/pv9gqj.png\" ,\n    \"ModernUrbanStreet-BrightDay-Peaceful\": \"https://files.catbox.moe/dhes3d.png\",\n    \"ModernUrbanStreet-BrightDay-Decay\": \"https://files.catbox.moe/l21256.png\",\n    \"ModernUrbanStreet-BrightDay-Dynamic\": \"https://files.catbox.moe/ui2pwt.png\",\n    \"ModernUrbanStreet-OvercastDay-Peaceful\": \"https://files.catbox.moe/4najy9.png\",\n    \"ModernUrbanStreet-OvercastDay-Decay\": \"https://files.catbox.moe/6shm0c.png\",\n    \"ModernUrbanStreet-OvercastDay-Dynamic\": \"https://files.catbox.moe/3mnzmg.png\",\n    \"ModernUrbanStreet-GoldenHour-Peaceful\": \"https://files.catbox.moe/0x5f9m.png\",\n    \"ModernUrbanStreet-GoldenHour-Decay\": \"https://files.catbox.moe/097oga.png\",\n    \"ModernUrbanStreet-GoldenHour-Dynamic\": \"https://files.catbox.moe/8bzix7.png\",\n    \"ModernUrbanStreet-DeepNight-Peaceful\": \"https://files.catbox.moe/ptg2tf.png\",\n    \"ModernUrbanStreet-DeepNight-Decay\": \"https://files.catbox.moe/ynurmy.png\",\n    \"ModernUrbanStreet-DeepNight-Dynamic\": \"https://files.catbox.moe/880e3u.png\",\n    \"AncientTown-BrightDay-Peaceful\": \"https://files.catbox.moe/s6r8u3.png\",\n    \"AncientTown-BrightDay-Decay\": \"https://files.catbox.moe/2ku6tb.png\",\n    \"AncientTown-BrightDay-Dynamic\": \"https://files.catbox.moe/92660n.png\",\n    \"AncientTown-OvercastDay-Peaceful\": \"https://files.catbox.moe/o98q4p.png\",\n    \"AncientTown-OvercastDay-Decay\": \"https://files.catbox.moe/ivezlx.png\",\n    \"AncientTown-OvercastDay-Dynamic\": \"https://files.catbox.moe/fnwsni.png\",\n    \"AncientTown-GoldenHour-Peaceful\": \"https://files.catbox.moe/v3k1ts.png\",\n    \"AncientTown-GoldenHour-Decay\": \"https://files.catbox.moe/t4c6h2.png\",\n    \"AncientTown-GoldenHour-Dynamic\": \"https://files.catbox.moe/z1y37q.png\",\n    \"AncientTown-DeepNight-Peaceful\": \"https://files.catbox.moe/vhulml.png\",\n    \"AncientTown-DeepNight-Decay\": \"https://files.catbox.moe/3ju84i.png\",\n    \"AncientTown-DeepNight-Dynamic\": \"https://files.catbox.moe/48d97o.png\",\n    \"AncientChineseCity-BrightDay-Peaceful\": \"https://files.catbox.moe/hsbdp9.png\",\n    \"AncientChineseCity-BrightDay-Decay\": \"https://files.catbox.moe/hi2xji.png\",\n    \"AncientChineseCity-BrightDay-Dynamic\": \"https://files.catbox.moe/oxzzpk.png\",\n    \"AncientChineseCity-OvercastDay-Peaceful\": \"https://files.catbox.moe/4o5kdz.png\",\n    \"AncientChineseCity-OvercastDay-Decay\": \"https://files.catbox.moe/zysw0w.png\",\n    \"AncientChineseCity-OvercastDay-Dynamic\": \"https://files.catbox.moe/3sxd7f.png\",\n    \"AncientChineseCity-GoldenHour-Peaceful\": \"https://files.catbox.moe/pvqoks.png\",\n    \"AncientChineseCity-GoldenHour-Decay\": \"https://files.catbox.moe/mmfx5g.png\",\n    \"AncientChineseCity-GoldenHour-Dynamic\": \"https://files.catbox.moe/hhqylf.png\",\n    \"AncientChineseCity-DeepNight-Peaceful\": \"https://files.catbox.moe/k9286v.png\",\n    \"AncientChineseCity-DeepNight-Decay\": \"https://files.catbox.moe/g77nwq.png\",\n    \"AncientChineseCity-DeepNight-Dynamic\": \"https://files.catbox.moe/yzsmyn.png\",\n    \"WesternMarket-BrightDay-Peaceful\": \"https://files.catbox.moe/rksxid.png\",\n    \"WesternMarket-BrightDay-Decay\": \"https://files.catbox.moe/fi838g.png\",\n    \"WesternMarket-BrightDay-Dynamic\": \"https://files.catbox.moe/m3pofu.png\",\n    \"WesternMarket-OvercastDay-Peaceful\": \"https://files.catbox.moe/yhufu8.png\",\n    \"WesternMarket-OvercastDay-Decay\": \"https://files.catbox.moe/qp7glg.png\",\n    \"WesternMarket-OvercastDay-Dynamic\": \"https://files.catbox.moe/2i4s8r.png\",\n    \"WesternMarket-GoldenHour-Peaceful\": \"https://files.catbox.moe/2jj2au.png\",\n    \"WesternMarket-GoldenHour-Decay\": \"https://files.catbox.moe/7ebpfs.png\",\n    \"WesternMarket-GoldenHour-Dynamic\": \"https://files.catbox.moe/xa1ctx.png\",\n    \"WesternMarket-DeepNight-Peaceful\": \"https://files.catbox.moe/hezeaq.png\",\n    \"WesternMarket-DeepNight-Decay\": \"https://files.catbox.moe/mk5u5q.png\",\n    \"WesternMarket-DeepNight-Dynamic\": \"https://files.catbox.moe/p0w1l9.png\",\n    \"Campus-BrightDay-Peaceful\": \"https://files.catbox.moe/1557qc.png\",\n    \"Campus-BrightDay-Decay\": \"https://files.catbox.moe/tjq73t.png\",\n    \"Campus-BrightDay-Dynamic\": \"https://files.catbox.moe/hq7yll.png\",\n    \"Campus-OvercastDay-Peaceful\": \"https://files.catbox.moe/vqcje0.png\",\n    \"Campus-OvercastDay-Decay\": \"https://files.catbox.moe/jw187j.png\",\n    \"Campus-OvercastDay-Dynamic\": \"https://files.catbox.moe/ofkg1u.png\",\n    \"Campus-GoldenHour-Peaceful\": \"https://files.catbox.moe/kkvggn.png\",\n    \"Campus-GoldenHour-Decay\": \"https://files.catbox.moe/d95fab.png\",\n    \"Campus-GoldenHour-Dynamic\": \"https://files.catbox.moe/hjf7n0.png\",\n    \"Campus-DeepNight-Peaceful\": \"https://files.catbox.moe/u940ii.png\",\n    \"Campus-DeepNight-Decay\": \"https://files.catbox.moe/vh5054.png\",\n    \"Campus-DeepNight-Dynamic\": \"https://files.catbox.moe/77xjzh.png\",\n    \"Forest-BrightDay-Peaceful\": \"https://files.catbox.moe/ansqe4.png\",\n    \"Forest-BrightDay-Decay\": \"https://files.catbox.moe/pr0sh7.png\",\n    \"Forest-BrightDay-Dynamic\": \"https://files.catbox.moe/2344zd.png\",\n    \"Forest-OvercastDay-Peaceful\": \"https://files.catbox.moe/met9pb.png\",\n    \"Forest-OvercastDay-Decay\": \"https://files.catbox.moe/oiwy3e.png\",\n    \"Forest-OvercastDay-Dynamic\": \"https://files.catbox.moe/klpb15.png\",\n    \"Forest-GoldenHour-Peaceful\": \"https://files.catbox.moe/jtc5dp.png\",\n    \"Forest-GoldenHour-Decay\": \"https://files.catbox.moe/1qn3yo.png\",\n    \"Forest-GoldenHour-Dynamic\": \"https://files.catbox.moe/phlvl2.png\",\n    \"Forest-DeepNight-Peaceful\": \"https://files.catbox.moe/vnoidl.png\",\n    \"Forest-DeepNight-Decay\": \"https://files.catbox.moe/kpoe16.png\",\n    \"Forest-DeepNight-Dynamic\": \"https://files.catbox.moe/f2aoaw.png\",\n    \"Ocean-BrightDay-Peaceful\": \"https://files.catbox.moe/ecjcwp.png\",\n    \"Ocean-BrightDay-Decay\": \"https://files.catbox.moe/rf06ih.png\",\n    \"Ocean-BrightDay-Dynamic\": \"https://files.catbox.moe/1hyi5d.png\",\n    \"Ocean-OvercastDay-Peaceful\": \"https://files.catbox.moe/yo0x4t.png\",\n    \"Ocean-OvercastDay-Decay\": \"https://files.catbox.moe/d00l0r.png\",\n    \"Ocean-OvercastDay-Dynamic\": \"https://files.catbox.moe/48b76h.png\",\n    \"Ocean-GoldenHour-Peaceful\": \"https://files.catbox.moe/ahhjwy.png\",\n    \"Ocean-GoldenHour-Decay\": \"https://files.catbox.moe/4chzy8.png\",\n    \"Ocean-GoldenHour-Dynamic\": \"https://files.catbox.moe/ocg1qb.png\",\n    \"Ocean-DeepNight-Peaceful\": \"https://files.catbox.moe/i6zev7.png\",\n    \"Ocean-DeepNight-Decay\": \"https://files.catbox.moe/mu6bj4.png\",\n    \"Ocean-DeepNight-Dynamic\": \"https://files.catbox.moe/llzgvv.png\",\n    \"River-BrightDay-Peaceful\": \"https://files.catbox.moe/ssjiix.png\",\n    \"River-BrightDay-Decay\": \"https://files.catbox.moe/v2nn7e.png\",\n    \"River-BrightDay-Dynamic\": \"https://files.catbox.moe/o2kc61.png\",\n    \"River-OvercastDay-Peaceful\": \"https://files.catbox.moe/59uy2q.png\",\n    \"River-OvercastDay-Decay\": \"https://files.catbox.moe/gehfbt.png\",\n    \"River-OvercastDay-Dynamic\": \"https://files.catbox.moe/4sdukd.png\",\n    \"River-GoldenHour-Peaceful\": \"https://files.catbox.moe/nulrac.png\",\n    \"River-GoldenHour-Decay\": \"https://files.catbox.moe/77pq04.png\",\n    \"River-GoldenHour-Dynamic\": \"https://files.catbox.moe/tfmns3.png\",\n    \"River-DeepNight-Peaceful\": \"https://files.catbox.moe/2tg98i.png\",\n    \"River-DeepNight-Decay\": \"https://files.catbox.moe/93a79i.png\",\n    \"River-DeepNight-Dynamic\": \"https://files.catbox.moe/k7riuu.png\",\n    \"Grassland-BrightDay-Peaceful\": \"https://files.catbox.moe/5lrcd3.png\",\n    \"Grassland-BrightDay-Decay\": \"https://files.catbox.moe/8zg93i.png\",\n    \"Grassland-BrightDay-Dynamic\": \"https://files.catbox.moe/4uxivd.png\",\n    \"Grassland-OvercastDay-Peaceful\": \"https://files.catbox.moe/eqajk0.png\",\n    \"Grassland-OvercastDay-Decay\": \"https://files.catbox.moe/hxc0r4.png\",\n    \"Grassland-OvercastDay-Dynamic\": \"https://files.catbox.moe/flw0mj.png\",\n    \"Grassland-GoldenHour-Peaceful\": \"https://files.catbox.moe/2uur0m.png\",\n    \"Grassland-GoldenHour-Decay\": \"https://files.catbox.moe/x2oaou.png\",\n    \"Grassland-GoldenHour-Dynamic\": \"https://files.catbox.moe/d55jxr.png\",\n    \"Grassland-DeepNight-Peaceful\": \"https://files.catbox.moe/1rfcvz.png\",\n    \"Grassland-DeepNight-Decay\": \"https://files.catbox.moe/finkcj.png\",\n    \"Grassland-DeepNight-Dynamic\": \"https://files.catbox.moe/jftykn.png\",\n    \"Snowfield-BrightDay-Peaceful\": \"https://files.catbox.moe/yj6jtu.png\",\n    \"Snowfield-BrightDay-Decay\": \"https://files.catbox.moe/0zicrz.png\",\n    \"Snowfield-BrightDay-Dynamic\": \"https://files.catbox.moe/qfx7ec.png\",\n    \"Snowfield-OvercastDay-Peaceful\": \"https://files.catbox.moe/hrraid.png\",\n    \"Snowfield-OvercastDay-Decay\": \"https://files.catbox.moe/8ic12s.png\",\n    \"Snowfield-OvercastDay-Dynamic\": \"https://files.catbox.moe/xsjx03.png\",\n    \"Snowfield-GoldenHour-Peaceful\": \"https://files.catbox.moe/llck35.png\",\n    \"Snowfield-GoldenHour-Decay\": \"https://files.catbox.moe/ex4hmf.png\",\n    \"Snowfield-GoldenHour-Dynamic\": \"https://files.catbox.moe/kqklhc.png\",\n    \"Snowfield-DeepNight-Peaceful\": \"https://files.catbox.moe/oobgon.png\",\n    \"Snowfield-DeepNight-Decay\": \"https://files.catbox.moe/24uvx8.png\",\n    \"Snowfield-DeepNight-Dynamic\": \"https://files.catbox.moe/zxzjpf.png\",\n    \"Underwater-BrightDay-Peaceful\": \"https://files.catbox.moe/4kefca.png\",\n    \"Underwater-BrightDay-Decay\": \"https://files.catbox.moe/3denhw.png\",\n    \"Underwater-BrightDay-Dynamic\": \"https://files.catbox.moe/42rlw6.png\",\n    \"Underwater-OvercastDay-Peaceful\": \"https://files.catbox.moe/os84rw.png\",\n    \"Underwater-OvercastDay-Decay\": \"https://files.catbox.moe/hz3b2l.png\",\n    \"Underwater-OvercastDay-Dynamic\": \"https://files.catbox.moe/1jahli.png\",\n    \"Underwater-GoldenHour-Peaceful\": \"https://files.catbox.moe/hij6hj.png\",\n    \"Underwater-GoldenHour-Decay\": \"https://files.catbox.moe/yr7lm1.png\",\n    \"Underwater-GoldenHour-Dynamic\": \"https://files.catbox.moe/ozq0ph.png\",\n    \"Underwater-DeepNight-Peaceful\": \"https://files.catbox.moe/3wd6vl.png\",\n    \"Underwater-DeepNight-Decay\": \"https://files.catbox.moe/wk15wy.png\",\n    \"Underwater-DeepNight-Dynamic\": \"https://files.catbox.moe/5yvhg2.png\",\n    \"SimpleRoom-BrightDay-Peaceful\": \"https://files.catbox.moe/n9oby0.png\",\n    \"SimpleRoom-BrightDay-Decay\": \"https://files.catbox.moe/edqueq.png\",\n    \"SimpleRoom-BrightDay-Dynamic\": \"https://files.catbox.moe/7wss06.png\",\n    \"SimpleRoom-OvercastDay-Peaceful\": \"https://files.catbox.moe/m93ysz.png\",\n    \"SimpleRoom-OvercastDay-Decay\": \"https://files.catbox.moe/5ve0kl.png\",\n    \"SimpleRoom-OvercastDay-Dynamic\": \"https://files.catbox.moe/nr0u5g.png\",\n    \"SimpleRoom-GoldenHour-Peaceful\": \"https://files.catbox.moe/rmooph.png\",\n    \"SimpleRoom-GoldenHour-Decay\": \"https://files.catbox.moe/zcwn3h.png\",\n    \"SimpleRoom-GoldenHour-Dynamic\": \"https://files.catbox.moe/pp8zfj.png\",\n    \"SimpleRoom-DeepNight-Peaceful\": \"https://files.catbox.moe/r9na7d.png\",\n    \"SimpleRoom-DeepNight-Decay\": \"https://files.catbox.moe/mlz6ts.png\",\n    \"SimpleRoom-DeepNight-Dynamic\": \"https://files.catbox.moe/mxjzuf.png\",\n     \"LuxuryRoom-BrightDay-Peaceful\": \"https://files.catbox.moe/6z5xbx.png\",\n\"LuxuryRoom-BrightDay-Decay\": \"https://files.catbox.moe/lindgw.png\",\n\"LuxuryRoom-BrightDay-Dynamic\": \"https://files.catbox.moe/6z5xbx.png\",\n\"LuxuryRoom-OvercastDay-Peaceful\": \"https://files.catbox.moe/g72q8t.png\",\n\"LuxuryRoom-OvercastDay-Decay\": \"https://files.catbox.moe/pxy5li.png\",\n\"LuxuryRoom-OvercastDay-Dynamic\": \"https://files.catbox.moe/biwvpj.png\",\n\"LuxuryRoom-GoldenHour-Peaceful\": \"https://files.catbox.moe/m4bc3w.png\",\n\"LuxuryRoom-GoldenHour-Decay\": \"https://files.catbox.moe/nx6rp6.png\",\n\"LuxuryRoom-GoldenHour-Dynamic\": \"https://files.catbox.moe/pmgi83.png\",\n\"LuxuryRoom-DeepNight-Peaceful\": \"https://files.catbox.moe/utlac8.png\",\n\"LuxuryRoom-DeepNight-Decay\": \"https://files.catbox.moe/6756nu.png\",\n\"LuxuryRoom-DeepNight-Dynamic\": \"https://files.catbox.moe/pq33aw.png\",\n\"ChineseInn-BrightDay-Peaceful\": \"https://files.catbox.moe/p8vi0m.png\",\n\"ChineseInn-BrightDay-Decay\": \"https://files.catbox.moe/5zf9he.png\",\n\"ChineseInn-BrightDay-Dynamic\": \"https://files.catbox.moe/z5u256.png\",\n\"ChineseInn-OvercastDay-Peaceful\": \"https://files.catbox.moe/l2lhmn.png\",\n\"ChineseInn-OvercastDay-Decay\": \"https://files.catbox.moe/xkm541.png\",\n\"ChineseInn-OvercastDay-Dynamic\": \"https://files.catbox.moe/hyfd0x.png\",\n\"ChineseInn-GoldenHour-Peaceful\": \"https://files.catbox.moe/ebj4to.png\",\n\"ChineseInn-GoldenHour-Decay\": \"https://files.catbox.moe/i7n5l6.png\",\n\"ChineseInn-GoldenHour-Dynamic\": \"https://files.catbox.moe/3z6zby.png\",\n\"ChineseInn-DeepNight-Peaceful\": \"https://files.catbox.moe/hyj5d9.png\",\n\"ChineseInn-DeepNight-Decay\": \"https://files.catbox.moe/q4bwc8.png\",\n\"ChineseInn-DeepNight-Dynamic\": \"https://files.catbox.moe/h43qfj.png\",\n\"ModernLobby-BrightDay-Peaceful\": \"https://files.catbox.moe/oold7t.png\",\n\"ModernLobby-BrightDay-Decay\": \"https://files.catbox.moe/j2frke.png\",\n\"ModernLobby-BrightDay-Dynamic\": \"https://files.catbox.moe/muayj5.png\",\n\"ModernLobby-OvercastDay-Peaceful\": \"https://files.catbox.moe/c8e0dt.png\",\n\"ModernLobby-OvercastDay-Decay\": \"https://files.catbox.moe/kbwrhl.png\",\n\"ModernLobby-OvercastDay-Dynamic\": \"https://files.catbox.moe/p8xm1i.png\",\n\"ModernLobby-GoldenHour-Peaceful\": \"https://files.catbox.moe/cuu7tf.png\",\n\"ModernLobby-GoldenHour-Decay\": \"https://files.catbox.moe/1qiy9k.png\",\n\"ModernLobby-GoldenHour-Dynamic\": \"https://files.catbox.moe/pdkr5k.png\",\n\"ModernLobby-DeepNight-Peaceful\": \"https://files.catbox.moe/w061gf.png\",\n\"ModernLobby-DeepNight-Decay\": \"https://files.catbox.moe/qy0r7x.png\",\n\"ModernLobby-DeepNight-Dynamic\": \"https://files.catbox.moe/cs5gb1.png\",\n\"Corridor-BrightDay-Peaceful\": \"https://files.catbox.moe/c425ec.png\",\n\"Corridor-BrightDay-Decay\": \"https://files.catbox.moe/yejlqf.png\",\n\"Corridor-BrightDay-Dynamic\": \"https://files.catbox.moe/vcl6bl.png\",\n\"Corridor-OvercastDay-Peaceful\": \"https://files.catbox.moe/64yaat.png\",\n\"Corridor-OvercastDay-Decay\": \"https://files.catbox.moe/bexgw6.png\",\n\"Corridor-OvercastDay-Dynamic\": \"https://files.catbox.moe/8oyayc.png\",\n\"Corridor-GoldenHour-Peaceful\": \"https://files.catbox.moe/wqb6x3.png\",\n\"Corridor-GoldenHour-Decay\": \"https://files.catbox.moe/kfxo3j.png\",\n\"Corridor-GoldenHour-Dynamic\": \"https://files.catbox.moe/5ukas0.png\",\n\"Corridor-DeepNight-Peaceful\": \"https://files.catbox.moe/sbrnoz.png\",\n\"Corridor-DeepNight-Decay\": \"https://files.catbox.moe/pt5r7c.png\",\n\"Corridor-DeepNight-Dynamic\": \"https://files.catbox.moe/jmjars.png\",\n\"Laboratory-BrightDay-Peaceful\": \"https://files.catbox.moe/1vmvdl.png\",\n\"Laboratory-BrightDay-Decay\": \"https://files.catbox.moe/syyy9p.png\",\n\"Laboratory-BrightDay-Dynamic\": \"https://files.catbox.moe/b5qeap.png\",\n\"Laboratory-OvercastDay-Peaceful\": \"https://files.catbox.moe/fwsp71.png\",\n\"Laboratory-OvercastDay-Decay\": \"https://files.catbox.moe/u9zig9.png\",\n\"Laboratory-OvercastDay-Dynamic\": \"https://files.catbox.moe/tl8naa.png\",\n\"Laboratory-GoldenHour-Peaceful\": \"https://files.catbox.moe/0p620u.png\",\n\"Laboratory-GoldenHour-Decay\": \"https://files.catbox.moe/6f9uva.png\",\n\"Laboratory-GoldenHour-Dynamic\": \"https://files.catbox.moe/g2vfxv.png\",\n\"Laboratory-DeepNight-Peaceful\": \"https://files.catbox.moe/xi916x.png\",\n\"Laboratory-DeepNight-Decay\": \"https://files.catbox.moe/yp56t3.png\",\n\"Laboratory-DeepNight-Dynamic\": \"https://files.catbox.moe/xsvj64.png\",\n\n\"Cave-BrightDay-Peaceful\": \"https://files.catbox.moe/ok0vzc.png\",\n\"Cave-BrightDay-Decay\": \"https://files.catbox.moe/3z7cov.png\",\n\"Cave-BrightDay-Dynamic\": \"https://files.catbox.moe/t3obng.png\",\n\"Cave-OvercastDay-Peaceful\": \"https://files.catbox.moe/xx3fkt.png\",\n\"Cave-OvercastDay-Decay\": \"https://files.catbox.moe/4velhl.png\",\n\"Cave-OvercastDay-Dynamic\": \"https://files.catbox.moe/nkd9vx.png\",\n\"Cave-GoldenHour-Peaceful\": \"https://files.catbox.moe/jtit19.png\",\n\"Cave-GoldenHour-Decay\": \"https://files.catbox.moe/3rl1ek.png\",\n\"Cave-GoldenHour-Dynamic\": \"https://files.catbox.moe/wkfb9x.png\",\n\"Cave-DeepNight-Peaceful\": \"https://files.catbox.moe/84jmvc.png\",\n\"Cave-DeepNight-Decay\": \"https://files.catbox.moe/w9vhnp.png\",\n\"Cave-DeepNight-Dynamic\": \"https://files.catbox.moe/gfos4o.png\",\n\n\"Prison-BrightDay-Peaceful\": \"https://files.catbox.moe/to0jrc.png\",\n\"Prison-BrightDay-Decay\": \"https://files.catbox.moe/p4cnax.png\",\n\"Prison-BrightDay-Dynamic\": \"https://files.catbox.moe/ai4xsu.png\",\n\"Prison-OvercastDay-Peaceful\": \"https://files.catbox.moe/47e6lg.png\",\n\"Prison-OvercastDay-Decay\": \"https://files.catbox.moe/xpwl6w.png\",\n\"Prison-OvercastDay-Dynamic\": \"https://files.catbox.moe/s56auc.png\",\n\"Prison-GoldenHour-Peaceful\": \"https://files.catbox.moe/mw4ywv.png\",\n\"Prison-GoldenHour-Decay\": \"https://files.catbox.moe/xqdgqb.png\",\n\"Prison-GoldenHour-Dynamic\": \"https://files.catbox.moe/fghnbn.png\",\n\"Prison-DeepNight-Peaceful\": \"https://files.catbox.moe/zqdhod.png\",\n\"Prison-DeepNight-Decay\": \"https://files.catbox.moe/7t0v0g.png\",\n\"Prison-DeepNight-Dynamic\": \"https://files.catbox.moe/adx0nw.png\",\n    \"StarshipInterior-BrightDay-Peaceful\": \"https://files.catbox.moe/q0scdg.png\",\n    \"StarshipInterior-BrightDay-Decay\": \"https://files.catbox.moe/kqfaul.png\",\n    \"StarshipInterior-BrightDay-Dynamic\": \"https://files.catbox.moe/6xdq9e.png\",\n    \"StarshipInterior-OvercastDay-Peaceful\": \"https://files.catbox.moe/8ps4gt.png\",\n    \"StarshipInterior-OvercastDay-Decay\": \"https://files.catbox.moe/ehan0u.png\",\n    \"StarshipInterior-OvercastDay-Dynamic\": \"https://files.catbox.moe/ehan0u.png\",\n    \"StarshipInterior-GoldenHour-Peaceful\": \"https://files.catbox.moe/7z196y.png\",\n    \"StarshipInterior-GoldenHour-Decay\": \"https://files.catbox.moe/jshhas.png\",\n    \"StarshipInterior-GoldenHour-Dynamic\": \"https://files.catbox.moe/na2wqk.png\",\n    \"StarshipInterior-DeepNight-Peaceful\": \"https://files.catbox.moe/eta7l8.png\",\n    \"StarshipInterior-DeepNight-Decay\": \"https://files.catbox.moe/dw9syo.png\",\n    \"StarshipInterior-DeepNight-Dynamic\": \"https://files.catbox.moe/xvdvq8.png\",\n    \"FloatingIsland-BrightDay-Peaceful\": \"https://files.catbox.moe/39pgit.png\",\n    \"FloatingIsland-BrightDay-Decay\": \"https://files.catbox.moe/ulixx0.png\",\n    \"FloatingIsland-BrightDay-Dynamic\": \"https://files.catbox.moe/1sgrgy.png\",\n    \"FloatingIsland-OvercastDay-Peaceful\": \"https://files.catbox.moe/fd84hz.png\",\n    \"FloatingIsland-OvercastDay-Decay\": \"https://files.catbox.moe/e56g2x.png\",\n    \"FloatingIsland-OvercastDay-Dynamic\": \"https://files.catbox.moe/2upnvn.png\",\n    \"FloatingIsland-GoldenHour-Peaceful\": \"https://files.catbox.moe/ip68d4.png\",\n    \"FloatingIsland-GoldenHour-Decay\": \"https://files.catbox.moe/otf9x9.png\",\n    \"FloatingIsland-GoldenHour-Dynamic\": \"https://files.catbox.moe/gv6yf4.png\",\n    \"FloatingIsland-DeepNight-Peaceful\": \"https://files.catbox.moe/mi9bk4.png\",\n    \"FloatingIsland-DeepNight-Decay\": \"https://files.catbox.moe/chhmjd.png\",\n    \"FloatingIsland-DeepNight-Dynamic\": \"https://files.catbox.moe/r4edwi.png\",\n    \"Hell-BrightDay-Peaceful\": \"https://files.catbox.moe/gpaq2z.png\",\n    \"Hell-BrightDay-Decay\": \"https://files.catbox.moe/ogqqer.png\",\n    \"Hell-BrightDay-Dynamic\": \"https://files.catbox.moe/1v6cji.png\",\n    \"Hell-OvercastDay-Peaceful\": \"https://files.catbox.moe/6u1es7.png\",\n    \"Hell-OvercastDay-Decay\": \"https://files.catbox.moe/uhng4y.png\",\n    \"Hell-OvercastDay-Dynamic\": \"https://files.catbox.moe/hwxxng.png\",\n    \"Hell-GoldenHour-Peaceful\": \"https://files.catbox.moe/afbx4m.png\",\n    \"Hell-GoldenHour-Decay\": \"https://files.catbox.moe/lsn7zw.png\",\n    \"Hell-GoldenHour-Dynamic\": \"https://files.catbox.moe/zqj42n.png\",\n    \"Hell-DeepNight-Peaceful\": \"https://files.catbox.moe/hivy9l.png\",\n    \"Hell-DeepNight-Decay\": \"https://files.catbox.moe/f2yeyp.png\",\n    \"Hell-DeepNight-Dynamic\": \"https://files.catbox.moe/5ijb9v.png\",\n \"RadiationWasteland-BrightDay-Peaceful\": \"https://files.catbox.moe/m7yy78.png\",\n\"RadiationWasteland-BrightDay-Decay\": \"https://files.catbox.moe/2x2es7.png\",\n\"RadiationWasteland-BrightDay-Dynamic\": \"https://files.catbox.moe/m7yy78.png\",\n\"RadiationWasteland-OvercastDay-Peaceful\": \"https://files.catbox.moe/a1kdmh.png\",\n\"RadiationWasteland-OvercastDay-Decay\": \"https://files.catbox.moe/gg9yd1.png\",\n\"RadiationWasteland-OvercastDay-Dynamic\": \"https://files.catbox.moe/li7380.png\",\n\"RadiationWasteland-GoldenHour-Peaceful\": \"https://files.catbox.moe/f6q6fo.png\",\n\"RadiationWasteland-GoldenHour-Decay\": \"https://files.catbox.moe/euzsy9.png\",\n\"RadiationWasteland-GoldenHour-Dynamic\": \"https://files.catbox.moe/jxeqws.png\",\n\"RadiationWasteland-DeepNight-Peaceful\": \"https://files.catbox.moe/dewdhu.png\",\n\"RadiationWasteland-DeepNight-Decay\": \"https://files.catbox.moe/lo3484.png\",\n\"RadiationWasteland-DeepNight-Dynamic\": \"https://files.catbox.moe/zdltgi.png\",\n\"OuterSpace-BrightDay-Peaceful\": \"https://files.catbox.moe/lwb5ac.png\",\n\"OuterSpace-BrightDay-Decay\": \"https://files.catbox.moe/ea4e3t.png\",\n\"OuterSpace-BrightDay-Dynamic\": \"https://files.catbox.moe/7tb1i8.png\",\n\"OuterSpace-OvercastDay-Peaceful\": \"https://files.catbox.moe/fw2904.png\",\n\"OuterSpace-OvercastDay-Decay\": \"https://files.catbox.moe/e2yisi.png\",\n\"OuterSpace-OvercastDay-Dynamic\": \"https://files.catbox.moe/twsfjf.png\",\n\"OuterSpace-GoldenHour-Peaceful\": \"https://files.catbox.moe/cd4ry1.png\",\n\"OuterSpace-GoldenHour-Decay\": \"https://files.catbox.moe/nqxnud.png\",\n\"OuterSpace-GoldenHour-Dynamic\": \"https://files.catbox.moe/45z8kf.png\",\n\"OuterSpace-DeepNight-Peaceful\": \"https://files.catbox.moe/pciljv.png\",\n\"OuterSpace-DeepNight-Decay\": \"https://files.catbox.moe/ln80cz.png\",\n\"OuterSpace-DeepNight-Dynamic\": \"https://files.catbox.moe/faa1rk.png\",\n\"Cyberpunk-BrightDay-Peaceful\": \"https://files.catbox.moe/tmy5ol.png\",\n\"Cyberpunk-BrightDay-Decay\": \"https://files.catbox.moe/aj5h69.png\",\n\"Cyberpunk-BrightDay-Dynamic\": \"https://files.catbox.moe/j21gl2.png\",\n\"Cyberpunk-OvercastDay-Peaceful\": \"https://files.catbox.moe/1ksill.png\",\n\"Cyberpunk-OvercastDay-Decay\": \"https://files.catbox.moe/bkbuik.png\",\n\"Cyberpunk-OvercastDay-Dynamic\": \"https://files.catbox.moe/3cfkqu.png\",\n\"Cyberpunk-GoldenHour-Peaceful\": \"https://files.catbox.moe/q0uibt.png\",\n\"Cyberpunk-GoldenHour-Decay\": \"https://files.catbox.moe/j8jz3x.png\",\n\"Cyberpunk-GoldenHour-Dynamic\": \"https://files.catbox.moe/f5uhnm.png\",\n\"Cyberpunk-DeepNight-Peaceful\": \"https://files.catbox.moe/d24ede.png\",\n\"Cyberpunk-DeepNight-Decay\": \"https://files.catbox.moe/xe1h6e.png\",\n\"Cyberpunk-DeepNight-Dynamic\": \"https://files.catbox.moe/ed2g3n.png\"\n};\n let backgroundImageMap ={};\nconst npcImageMap_fallbackData = {\n   \"ç”·-é’å¹´-é»‘å‘-çŸ­å‘-é»‘ç³-å†·å³»-å¹³é™\": \"https://files.catbox.moe/44wvtr.png\",\n    \"ç”·-é’å¹´-é»‘å‘-çŸ­å‘-é»‘ç³-æ¸©æŸ”-å¹³é™\": \"https://files.catbox.moe/pcwisg.png\",\n    \"ç”·-é’å¹´-é»‘å‘-é•¿å‘-é»‘ç³-å†·å³»-å¹³é™\": \"https://files.catbox.moe/ir5cy9.png\",\n    \"ç”·-é’å¹´-é»‘å‘-é•¿å‘-é»‘ç³-æ¸©æŸ”-å¹³é™\": \"https://files.catbox.moe/p247ze.png\",\n    \"ç”·-é’å¹´-é“¶å‘-çŸ­å‘-é»‘ç³-å†·å³»-å¹³é™\": \"https://files.catbox.moe/97giv8.png\",\n    \"ç”·-é’å¹´-é“¶å‘-çŸ­å‘-é»‘ç³-æ¸©æŸ”-å¹³é™\": \"https://files.catbox.moe/z4aydt.png\",\n    \"ç”·-é’å¹´-é“¶å‘-é•¿å‘-é»‘ç³-å†·å³»-å¹³é™\": \"https://files.catbox.moe/73eszr.png\",\n    \"ç”·-é’å¹´-é“¶å‘-é•¿å‘-é»‘ç³-æ¸©æŸ”-å¹³é™\": \"https://files.catbox.moe/n3qjjq.png\",\n    \"ç”·-é’å¹´-é‡‘å‘-çŸ­å‘-é»‘ç³-å†·å³»-å¹³é™\": \"https://files.catbox.moe/fwlmbn.png\",\n    \"ç”·-é’å¹´-é‡‘å‘-çŸ­å‘-é»‘ç³-æ¸©æŸ”-å¹³é™\": \"https://files.catbox.moe/pc7rwm.png\",\n    \"ç”·-é’å¹´-é‡‘å‘-é•¿å‘-é»‘ç³-å†·å³»-å¹³é™\": \"https://files.catbox.moe/ii34xt.png\",\n    \"ç”·-é’å¹´-é‡‘å‘-é•¿å‘-é»‘ç³-æ¸©æŸ”-å¹³é™\": \"https://files.catbox.moe/l0qpj7.png\",\n    \"å¥³-é’å¹´-é»‘å‘-çŸ­å‘-é»‘ç³-å†·å³»-å¹³é™\": \"https://files.catbox.moe/3t68l1.png\",\n    \"å¥³-é’å¹´-é»‘å‘-çŸ­å‘-é»‘ç³-æ¸©æŸ”-å¹³é™\": \"https://files.catbox.moe/u47x1f.png\",\n    \"å¥³-é’å¹´-é»‘å‘-é•¿å‘-é»‘ç³-å†·å³»-å¹³é™\": \"https://files.catbox.moe/hs6i73.png\",\n    \"å¥³-é’å¹´-é»‘å‘-é•¿å‘-é»‘ç³-æ¸©æŸ”-å¹³é™\": \"https://files.catbox.moe/oujm4o.png\",\n    \"å¥³-é’å¹´-é“¶å‘-çŸ­å‘-é»‘ç³-å†·å³»-å¹³é™\": \"https://files.catbox.moe/i5wokh.png\",\n    \"å¥³-é’å¹´-é“¶å‘-çŸ­å‘-é»‘ç³-æ¸©æŸ”-å¹³é™\": \"https://files.catbox.moe/fc44vm.png\",\n    \"å¥³-é’å¹´-é“¶å‘-é•¿å‘-é»‘ç³-å†·å³»-å¹³é™\": \"https://files.catbox.moe/1ie4ej.png\",\n    \"å¥³-é’å¹´-é“¶å‘-é•¿å‘-é»‘ç³-æ¸©æŸ”-å¹³é™\": \"https://files.catbox.moe/12p2jc.png\",\n    \"å¥³-é’å¹´-é‡‘å‘-çŸ­å‘-é»‘ç³-å†·å³»-å¹³é™\": \"https://files.catbox.moe/h9htnb.png\",\n    \"å¥³-é’å¹´-é‡‘å‘-çŸ­å‘-é»‘ç³-æ¸©æŸ”-å¹³é™\": \"https://files.catbox.moe/6jy663.png\",\n    \"å¥³-é’å¹´-é‡‘å‘-é•¿å‘-é»‘ç³-å†·å³»-å¹³é™\": \"https://files.catbox.moe/dylclb.png\",\n    \"å¥³-é’å¹´-é‡‘å‘-é•¿å‘-é»‘ç³-æ¸©æŸ”-å¹³é™\": \"https://files.catbox.moe/305pcy.png\"\n};\n let npcImageMap ={};\n const memeImageMap_fallbackData = {\n   \"ä¸‰åªçŒ«-éœ‡æƒŠ\": \"https://files.catbox.moe/c81ft9.jpg\",\n\"æŸ´éƒ¡-æ²¡æœ‰çƒ¦æ¼\":\"https://files.catbox.moe/07h315.jpg\",\n\"æŸ´éƒ¡é€’ç«ç‘°-ä¸Šç½‘ä¸ºäº†ç­‰ä½ \":\"https://files.catbox.moe/whcdzw.jpg\",\n\"è´´å§-å¾®ç¬‘\":\"https://files.catbox.moe/v1zup7.png\",\n\"æŸ´éƒ¡-çœ‹ç¬¨è›‹\":\"https://files.catbox.moe/8n8jjs.jpg\",\n\"è´´å§-å¼€å¿ƒ\":\"https://files.catbox.moe/9eq8us.png\",\n\"è´´å§-å¤§ç¬‘\":\"https://files.catbox.moe/590oxf.png\",\n\"å¯çˆ±ç‚¹èµ\":\"https://files.catbox.moe/9mn24b.jpg\",\n\"è´´å§-éƒé—·\":\"https://files.catbox.moe/jq7oru.png\",\n\"å¡é€šå…”è™šè„±\":\"https://files.catbox.moe/7mszdg.jpg\",\n\"çŒ«å¬å®Œé†’äº†\":\"https://files.catbox.moe/8h4fd8.jpg\",\n\"è´´å§-å¥½è€¶\":\"https://files.catbox.moe/l9kvh0.png\",\n\"æ±¤å§†çŒ«éœ‡æƒŠ\":\"https://files.catbox.moe/hg3695.jpg\",\n\"è´´å§-å•Šï¼Ÿ\":\"https://files.catbox.moe/7mue0y.png\",\n\"é˜´æš—çˆ¬è¡Œ\":\"https://files.catbox.moe/w2vpm9.jpg\",\n\"æ°ç‘é¼ -éœ‡æƒŠ\":\"https://files.catbox.moe/dfjewr.jpg\",\n\"å¡é€šæé¾™ç‚¹èµ\":\"https://files.catbox.moe/g4zzbq.jpg\",\n\"éª·é«…è·³èˆ\":\"https://files.catbox.moe/6xqs5i.gif\",\n\"æˆ‘çš„è‚¯å®š\":\"https://files.catbox.moe/25v5x1.jpg\",\n\"è´´å§-æ„¤æ€’\":\"https://files.catbox.moe/ajfl3t.png\",\n\"çš®å¡ä¸˜æµæ³ª\":\"https://files.catbox.moe/lcmn87.png\",\n\"çŒ«æ„¤æ€’çˆ†ç‚¸\":\"https://files.catbox.moe/r5odxq.gif\",\n\"è£…å‚»æµå£æ°´\":\"https://files.catbox.moe/pf6kmz.jpg\",\n\"è´´å§-ç–‘æƒ‘\":\"https://files.catbox.moe/4ju2ye.png\",\n\"æ±¤å§†çŒ«å¿ƒè™š\":\"https://files.catbox.moe/dk50jx.jpg\",\n\"çŒ«çŒ¥çç¬‘\":\"https://files.catbox.moe/nts9lf.gif\",\n\"ç”·äººå¥åº·ç¬‘ç‚¹èµ\":\"https://files.catbox.moe/kjk0n1.jpg\",\n\"ç‹—å¤´å‡å¤©\":\"https://files.catbox.moe/6z2eqn.jpg\",\n\"åˆéŸ³-ä½ å¦ˆäº†ä¸ª\":\"https://files.catbox.moe/kvh3pt.jpg\",\n\"çŒ«é€’ç«ç‘°\":\"https://files.catbox.moe/6mzu47.jpg\",\n\"é»‘çŒ«æ¯”å¿ƒ\":\"https://files.catbox.moe/2vgmq8.jpg\",\n\"é»‘çŒ«æ‘‡å°¾å·´è§‚å¯Ÿ\":\"https://files.catbox.moe/yz0b6n.gif\",\n\"é»‘çŒ«æµæ³ª\":\"https://files.catbox.moe/mqch0r.png\",\n\"æŸ´éƒ¡å¾®ç¬‘æŒåˆ€\":\"https://files.catbox.moe/23m12v.jpg\",\n\"é»‘çŒ«åœ°é“è€äººçœ‹æ‰‹æœº\":\"https://files.catbox.moe/as1c5u.jpg\",\n\"é»‘çŒ«æ“¦æ±—\":\"https://files.catbox.moe/lp8djw.png\",\n\"é»‘çŒ«å®³æ€•é¢¤æŠ–\":\"https://files.catbox.moe/18n48y.png\",\n\"å¾®ç¬‘çº¢æ¸©\":\"https://files.catbox.moe/w52lvw.jpg\",\n\"é»‘çŒ«è„¸çº¢\":\"https://files.catbox.moe/x4monr.gif\",\n\"é»‘çŒ«çµæœºä¸€ç°\":\"https://files.catbox.moe/8bp6gx.png\",\n\"å“ˆå£«å¥‡æŒ‡äºº\":\"https://files.catbox.moe/vobg2f.jpg\",\n\"æ‘¸æ‘¸å¤´\":\"https://files.catbox.moe/i65j4n.gif\"\n};\n let memeImageMap ={};\n\n\n\n\n\n window.NovaWorkshop = (function() {\n    // é…ç½®\n    const REMOTE_URL = 'https://longlivecanc.github.io/god_space/mods.json';\n    const DB_NAME = 'GodSpaceWorkshopDB';\n    const DB_VERSION = 1;\n    const STORE_NAME = 'user_mods'; // å­˜å‚¨ç”¨æˆ·å¯¹äºmodçš„è®¾ç½®ï¼ˆå¼€/å…³çŠ¶æ€ï¼‰\n\n    let db = null;\n    let allRemoteMods = []; // æš‚å­˜è¿œç¨‹åˆ—è¡¨\n\n    // åˆå§‹åŒ–æ•°æ®åº“\n    function initDB() {\n        return new Promise((resolve, reject) => {\n            const request = indexedDB.open(DB_NAME, DB_VERSION);\n\n            request.onupgradeneeded = (event) => {\n                db = event.target.result;\n                if (!db.objectStoreNames.contains(STORE_NAME)) {\n                    // KeyPath ä½¿ç”¨ modId\n                    db.createObjectStore(STORE_NAME, { keyPath: 'id' });\n                }\n            };\n\n            request.onsuccess = (event) => {\n                db = event.target.result;\n                console.log('åˆ›æ„å·¥åŠæ•°æ®åº“å·²è¿æ¥ã€‚');\n                resolve(db);\n            };\n\n            request.onerror = (event) => {\n                console.error('æ•°æ®åº“æ‰“å¼€å¤±è´¥:', event.target.errorCode);\n                reject(event.target.errorCode);\n            };\n        });\n    }\n\n    // è·å–æ‰€æœ‰ç”¨æˆ·Modè®¾ç½®\n    function getUserModSettings() {\n        return new Promise((resolve) => {\n            if (!db) return resolve([]);\n            const transaction = db.transaction([STORE_NAME], 'readonly');\n            const store = transaction.objectStore(STORE_NAME);\n            const request = store.getAll();\n            request.onsuccess = () => resolve(request.result);\n            request.onerror = () => resolve([]);\n        });\n    }\n\n    // æ›´æ–°ModçŠ¶æ€ (å¼€å¯/å…³é—­)\n    function toggleModStatus(modId, isEnabled, modData = {}) {\n        return new Promise((resolve, reject) => {\n            const transaction = db.transaction([STORE_NAME], 'readwrite');\n            const store = transaction.objectStore(STORE_NAME);\n            const item = {\n                id: modId,\n                enabled: isEnabled,\n                lastUpdated: Date.now(),\n                // ç¼“å­˜åŸºç¡€ä¿¡æ¯ï¼Œé˜²æ­¢æ²¡ç½‘æ—¶å½»åº•æ— æ³•åŠ è½½\n                cachedData: {\n                    scriptUrl: modData.scriptUrl,\n                    worldBookUrl: modData.worldBookUrl\n                }\n            };\n            store.put(item);\n            transaction.oncomplete = () => {\n                console.log(`Mod ${modId} çŠ¶æ€æ›´æ–°ä¸º: ${isEnabled}`);\n                resolve();\n            };\n        });\n    }\n // UI: æ¸²æŸ“ Mod åˆ—è¡¨\nasync function renderParams(filterTag = 'all', searchTerm = '') {\n    const container = document.getElementById('workshop-mod-list');\n    if (!container) return;\n\n    container.innerHTML = '<div class=\"loading-msg\">æ­£åœ¨è·å–æœ€æ–° Mod åˆ—è¡¨...</div>';\n\n    try {\n        // 1. åŠ è½½è¿œç¨‹ JSON\n        if (allRemoteMods.length === 0) {\n            if (typeof loadRemoteJson !== 'function') {\n                const res = await fetch(REMOTE_URL);\n                allRemoteMods = await res.json();\n            } else {\n                 allRemoteMods = await loadRemoteJson(REMOTE_URL, []);\n            }\n        }\n\n        // 2. åŠ è½½æœ¬åœ°ç”¨æˆ·è®¾ç½®\n        const userSettings = await getUserModSettings();\n        const settingsMap = new Map(userSettings.map(i => [i.id, i]));\n\n        container.innerHTML = '';\n\n        // 3. è¿‡æ»¤ä¸æ¸²æŸ“\n        const filtered = allRemoteMods.filter(mod => {\n            const matchTag = filterTag === 'all' || (mod.tags && mod.tags.includes(filterTag));\n            const matchSearch = searchTerm === '' ||\n                                mod.name.toLowerCase().includes(searchTerm.toLowerCase()) ||\n                                mod.description.toLowerCase().includes(searchTerm.toLowerCase());\n            return matchTag && matchSearch;\n        });\n\n        if (filtered.length === 0) {\n            container.innerHTML = '<div class=\"loading-msg\">æ²¡æœ‰æ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„ Modã€‚</div>';\n            return;\n        }\n\n        filtered.forEach(mod => {\n            const setting = settingsMap.get(mod.id);\n            const isEnabled = setting ? setting.enabled : false;\n\n            const card = document.createElement('div');\n            card.className = 'mod-card';\n\n            const tagsHtml = (mod.tags || []).map(t => `<span class=\"mod-tag-badge\">${t}</span>`).join('');\n\n            // ==================== æ ¸å¿ƒä¿®æ”¹éƒ¨åˆ†å¼€å§‹ ====================\n            let footerHtml = '';\n            if (mod.scriptUrl) {\n                // å¦‚æœæœ‰è„šæœ¬ï¼Œæ˜¾ç¤ºçŠ¶æ€å’Œå¼€å…³æŒ‰é’®\n                const actionBtnText = isEnabled ? 'ğŸ”´ ç¦ç”¨' : 'ğŸŸ¢ å¯ç”¨';\n                const actionBtnClass = isEnabled ? 'danger-btn' : 'primary';\n                const statusText = isEnabled ? '<span class=\"status-enabled\">å·²å¯ç”¨</span>' : '<span class=\"status-disabled\">æœªå¯ç”¨</span>';\n                footerHtml = `\n                    <div class=\"mod-status\">${statusText}</div>\n                    <div style=\"display:flex; gap:5px;\">\n                       ${mod.worldBookUrl ? `<button class=\"control-btn\" onclick=\"NovaWorkshop.downloadWorldBook('${mod.worldBookUrl}', '${mod.id || 'worldbook'}.json')\" title=\"ä¸‹è½½ä¸–ç•Œä¹¦ JSON\">ğŸ“˜ ä¸‹è½½</button>` : ''}\n                         <button class=\"control-btn ${actionBtnClass} toggle-mod-btn\" data-id=\"${mod.id}\">${actionBtnText}</button>\n                    </div>\n                `;\n            } else {\n                // å¦‚æœæ²¡æœ‰è„šæœ¬ï¼Œåªæ˜¾ç¤º JSON é“¾æ¥ï¼ˆå¦‚æœå­˜åœ¨ï¼‰\n                 footerHtml = `\n                    <div class=\"mod-status\"><span class=\"status-disabled\">ï¼ˆæ— è„šæœ¬ï¼‰</span></div>\n                    <div style=\"display:flex; gap:5px;\">\n   ${mod.worldBookUrl ? `<button class=\"control-btn\" onclick=\"NovaWorkshop.downloadWorldBook('${mod.worldBookUrl}', '${mod.id || 'worldbook'}.json')\" title=\"ä¸‹è½½ä¸–ç•Œä¹¦ JSON\">ğŸ“˜ ä¸‹è½½</button>` : ''}\n                    </div>\n                `;\n            }\n\n            card.innerHTML = `\n                <div class=\"mod-header\">\n                    <div>\n                        <div class=\"mod-title\">${mod.name}</div>\n                        <div class=\"mod-author\">by ${mod.author}</div>\n                    </div>\n                    <div class=\"mod-tags\">${tagsHtml}</div>\n                </div>\n                <div class=\"mod-desc\" title=\"${mod.description}\">${mod.description}</div>\n                <div class=\"mod-footer\">\n                    ${footerHtml}\n                </div>\n            `;\n\n            // åªæœ‰å­˜åœ¨è„šæœ¬æ—¶æ‰ç»‘å®šåˆ‡æ¢äº‹ä»¶\n            if (mod.scriptUrl) {\n                const toggleBtn = card.querySelector('.toggle-mod-btn');\n                toggleBtn.onclick = async () => {\n                    await toggleModStatus(mod.id, !isEnabled, mod);\n                    // ç®€å•é‡ç»˜å½“å‰è§†å›¾\n                    renderParams(filterTag, searchTerm);\n                };\n            }\n            // ==================== æ ¸å¿ƒä¿®æ”¹éƒ¨åˆ†ç»“æŸ ====================\n\n            container.appendChild(card);\n        });\n\n    } catch (e) {\n        console.error('Workshop Render Error:', e);\n        container.innerHTML = `<div class=\"loading-msg\" style=\"color:var(--danger-color)\">åŠ è½½å¤±è´¥: ${e.message}</div>`;\n    }\n}\n\n     async function executeActiveMods() {\n        await initDB();\n        const userSettings = await getUserModSettings();\n        const activeMods = userSettings.filter(m => m.enabled);\n\n        console.log(`[Nova Workshop] å‘ç° ${activeMods.length} ä¸ªå·²å¯ç”¨ Modï¼Œå‡†å¤‡åŠ è½½...`);\n\n        for (const mod of activeMods) {\n            // å¦‚æœæœ‰ Script URLï¼ŒåŠ è½½å¹¶æ‰§è¡Œ\n            if (mod.cachedData && mod.cachedData.scriptUrl) {\n                try {\n                    console.log(`[Nova Workshop] æ­£åœ¨æ³¨å…¥ Mod è„šæœ¬: ${mod.id}`);\n\n                    // ä½¿ç”¨ fetch + Blob æ–¹å¼æˆ–è€…ç›´æ¥ script src æ–¹å¼\n                    // è¿™é‡Œä½¿ç”¨å¸¦æ—¶é—´æˆ³çš„ script src æ–¹å¼æ¥å¼ºåˆ¶ç»•è¿‡æµè§ˆå™¨ç¼“å­˜\n                    const script = document.createElement('script');\n\n                    // ã€å¦ˆå¦ˆçš„é­”æ³•ä¿®æ”¹ã€‘ï¼šåœ¨è¿™é‡ŒåŠ ä¸Š ?t=æ—¶é—´æˆ³\n                    // è¿™æ ·æµè§ˆå™¨ä¼šè®¤ä¸ºè¿™æ˜¯ä¸€ä¸ªå…¨æ–°çš„è¯·æ±‚ï¼Œä»è€Œå¿½ç•¥ç¼“å­˜\n                    const cleanUrl = mod.cachedData.scriptUrl.split('?')[0]; // é˜²æ­¢åŸæœ¬å°±æœ‰å‚æ•°\n                    const noCacheUrl = `${cleanUrl}?t=${new Date().getTime()}`;\n\n                    script.src = noCacheUrl;\n                    script.setAttribute('data-mod-id', mod.id);\n\n                    // ä¿è¯è„šæœ¬æŒ‰é¡ºåºæ‰§è¡Œï¼Œè™½ç„¶åŠ¨æ€è„šæœ¬é»˜è®¤æ˜¯asyncçš„ï¼Œä½†æ˜¾ç¤ºè®¾ç½®ä¸ºfalseæ›´ä¿é™©\n                    script.async = false;\n\n                    document.body.appendChild(script);\n                } catch (e) {\n                    console.error(`[Nova Workshop] Mod ${mod.id} æ‰§è¡Œå¤±è´¥:`, e);\n                }\n            }\n        }\n    }\n   async function downloadFile(url, filename) {\n        try {\n            const response = await fetch(url);\n            if (!response.ok) throw new Error(`Network response was not ok: ${response.statusText}`);\n\n            const blob = await response.blob(); // å°†æ–‡ä»¶å†…å®¹è½¬æˆäºŒè¿›åˆ¶æ•°æ®\n            const blobUrl = window.URL.createObjectURL(blob); // åˆ›å»ºä¸€ä¸ªä¸´æ—¶çš„æœ¬åœ°é“¾æ¥\n\n            const a = document.createElement('a');\n            a.style.display = 'none';\n            a.href = blobUrl;\n            a.download = filename;\n\n            document.body.appendChild(a);\n            a.click(); // æ¨¡æ‹Ÿç‚¹å‡»è¿™ä¸ªéšè—çš„é“¾æ¥\n\n            document.body.removeChild(a); // æ¸…ç†\n            window.URL.revokeObjectURL(blobUrl); // é‡Šæ”¾å†…å­˜\n        } catch (error) {\n            console.error('Download failed:', error);\n            alert(`æ–‡ä»¶ä¸‹è½½å¤±è´¥: ${error.message}`);\n        }\n    }\n    // é¢æ¿äº¤äº’é€»è¾‘ç»‘å®š\n    function bindEvents() {\n        // åˆ·æ–°æŒ‰é’®\n        const refreshBtn = document.getElementById('workshop-refresh-btn');\n        if(refreshBtn) refreshBtn.onclick = () => {\n            allRemoteMods = []; // æ¸…ç©ºç¼“å­˜\n            renderParams();\n        }\n\n        // æœç´¢\n        const searchInput = document.getElementById('workshop-search-input');\n        const searchBtn = document.getElementById('workshop-search-btn');\n        if(searchBtn) searchBtn.onclick = () => renderParams('all', searchInput.value);\n\n        // æ ‡ç­¾åˆ‡æ¢\n        document.querySelectorAll('.filter-tag').forEach(btn => {\n            btn.onclick = function() {\n                document.querySelectorAll('.filter-tag').forEach(b => b.classList.remove('active'));\n                this.classList.add('active');\n                renderParams(this.dataset.tag, searchInput ? searchInput.value : '');\n            }\n        });\n\n        // é‡è½½é¡µé¢æŒ‰é’® (æç¤ºç”¨æˆ·åˆ·æ–°)\n        const reloadBtn = document.getElementById('workshop-reload-runtime-btn');\n        if(reloadBtn) reloadBtn.onclick = () => {\n            if(confirm('åº”ç”¨æ›´æ”¹éœ€è¦é‡æ–°åŠ è½½æ•´ä¸ªé¡µé¢ï¼Œæ˜¯å¦åˆ·æ–°ï¼Ÿ')) {\n                location.reload();\n            }\n        };\n\n        // ç›‘å¬ Tab åˆ‡æ¢ï¼Œå¦‚æœæ˜¯åˆ‡åˆ° workshopï¼Œåˆ™é¦–æ¬¡åŠ è½½\n        document.querySelectorAll('.settings-tab').forEach(tab => {\n            tab.addEventListener('click', () => {\n                if(tab.dataset.page === 'workshop') {\n                    renderParams();\n                }\n            });\n        });\n    }\n\n    // æš´éœ²çš„æ¥å£\n    return {\n        init: async function() {\n            await initDB();\n            bindEvents();\n            // æ³¨æ„ï¼šè¿™é‡Œä¸è‡ªåŠ¨æ‰§è¡Œ executeActiveModsï¼Œ\n            // å»ºè®®ä½ åœ¨ main.js æˆ–é¡µé¢åŠ è½½çš„æœ€é¡¶å±‚ç‹¬ç«‹è°ƒç”¨ NovaWorkshop.runMods()\n        },\n         runMods: executeActiveMods,\n        downloadWorldBook: downloadFile // <-- æŠŠæ–°å‡½æ•°æ·»åŠ åœ¨è¿™é‡Œ\n    };\n})();\n\n\n\n\n\n\n\n\n // å¥å£®çš„JSONåŠ è½½å’Œè§£æå‡½æ•°\nfunction sanitizeJSON(jsonString) {\n    try {\n        // 1. å»é™¤å‰åç©ºç™½\n        jsonString = jsonString.trim();\n        \n        // 2. å°†å•å¼•å·æ›¿æ¢ä¸ºåŒå¼•å·ï¼ˆä½†è¦å°å¿ƒå­—ç¬¦ä¸²å†…å®¹ä¸­çš„å¼•å·ï¼‰\n       jsonString = jsonString.replace(/'([^']*?)':/g, function(match, group1) {\n          return '\"' + group1 + '\":';\n        });\n        jsonString = jsonString.replace(/:\\s*'([^']*?)'/g, function(match, group1) {\n          return ': \"' + group1 + '\"';\n        });\n        \n        // 3. å»é™¤æœ«å°¾çš„é€—å·ï¼ˆåœ¨å¯¹è±¡æˆ–æ•°ç»„ç»“æŸå‰ï¼‰\n        jsonString = jsonString.replace(/,(\\s*[}\\]])/g, function(match, group1) {\n          return group1;\n        });\n        \n        // 4. å¤„ç†å¯èƒ½çš„å¤šä½™é€—å·\n        jsonString = jsonString.replace(/,+/g, ',');\n        \n        // 5. ç¡®ä¿å¯¹è±¡å’Œæ•°ç»„çš„æ ¼å¼æ­£ç¡®\n        jsonString = jsonString.replace(/,\\s*}/g, '}');\n        jsonString = jsonString.replace(/,\\s*]/g, ']');\n        \n        return jsonString;\n    } catch (error) {\n        console.error('JSONæ¸…ç†è¿‡ç¨‹ä¸­å‡ºé”™:', error);\n        return jsonString;\n    }\n}\n\n// éªŒè¯JSONæ ¼å¼çš„å‡½æ•°\nfunction validateJSON(jsonString) {\n    try {\n        JSON.parse(jsonString);\n        return true;\n    } catch (error) {\n        console.error('JSONéªŒè¯å¤±è´¥:', error.message);\n        return false;\n    }\n}\n\n// æ›´è¯¦ç»†çš„é”™è¯¯è¯Šæ–­\nfunction diagnoseJSONError(jsonString, error) {\n    const lines = jsonString.split('\\n');\n    const errorMsg = error.message;\n    \n    // å°è¯•ä»é”™è¯¯æ¶ˆæ¯ä¸­æå–ä½ç½®ä¿¡æ¯\n    const positionMatch = errorMsg.match(/position (\\d+)/);\n    if (positionMatch) {\n        const position = parseInt(positionMatch[1]);\n        let currentPos = 0;\n        let lineNumber = 0;\n        let columnNumber = 0;\n        \n        for (let i = 0; i < lines.length; i++) {\n            if (currentPos + lines[i].length >= position) {\n                lineNumber = i + 1;\n                columnNumber = position - currentPos + 1;\n                break;\n            }\n            currentPos += lines[i].length + 1; // +1 for newline\n        }\n        \n        console.error(`JSONé”™è¯¯ä½ç½®: ç¬¬${lineNumber}è¡Œ, ç¬¬${columnNumber}åˆ—`);\n        console.error(`é”™è¯¯é™„è¿‘çš„å†…å®¹: \"${jsonString.substring(position - 20, position + 20)}\"`);\n        \n        // æ£€æŸ¥å¸¸è§é—®é¢˜\n        const problemArea = jsonString.substring(Math.max(0, position - 50), position + 50);\n        if (problemArea.includes(',}') || problemArea.includes(',]')) {\n            console.error('å¯èƒ½çš„é—®é¢˜: å¤šä½™çš„é€—å·');\n        }\n        if (problemArea.includes(\"'\")) {\n            console.error('å¯èƒ½çš„é—®é¢˜: ä½¿ç”¨äº†å•å¼•å·è€Œä¸æ˜¯åŒå¼•å·');\n        }\n        if (problemArea.match(/\\w+:/)) {\n            console.error('å¯èƒ½çš„é—®é¢˜: å±æ€§åæ²¡æœ‰ç”¨å¼•å·åŒ…å›´');\n        }\n    }\n}\nlet globalIndexData = {};\nasync function loadGitHubIndexMap(indexUrl, baseUrl, fallbackData = {}) {\n    const remoteIndex = await loadRemoteJson(indexUrl, {}); // ä½¿ç”¨ç©ºå¯¹è±¡ä½œä¸ºloadRemoteJsonçš„fallback\n    // å°†åŠ è½½åˆ°çš„ç´¢å¼•æ•°æ®å­˜å…¥å…¨å±€å˜é‡ï¼Œä»¥URLä¸ºé”®ï¼Œæ–¹ä¾¿åŒºåˆ†\n    if (Object.keys(remoteIndex).length > 0) {\n        globalIndexData[indexUrl] = remoteIndex;\n        console.log(`[Nova-Init] å·²æˆåŠŸåŠ è½½ç´¢å¼• ${indexUrl} å¹¶å­˜å…¥å…¨å±€ç´¢å¼•åº“ã€‚`);\n    } else {\n        console.warn(`ä» ${indexUrl} è·å–çš„ç´¢å¼•æ•°æ®ä¸ºç©ºï¼Œå°†ä½¿ç”¨ä¼ å…¥çš„fallbackDataã€‚`);\n        return fallbackData; // å¦‚æœè·å–å¤±è´¥ï¼Œç›´æ¥è¿”å›fallback\n    }\n\n    const keys = Object.keys(remoteIndex);\n    if (keys.length === 0) {\n        return fallbackData;\n    }\n    \n    // é€’å½’å‡½æ•°ï¼šç”Ÿæˆæ‰€æœ‰å¯èƒ½çš„ç»„åˆé”®\n    function generateCombinations(index = 0, currentCombination = []) {\n        if (index === keys.length) {\n            // ç»„åˆç»“æŸï¼Œè¿”å›æ‹¼æ¥å¥½çš„é”®\n            return [currentCombination.join('-')];\n        }\n\n        const key = keys[index];\n        // è°ƒæ•´åçš„ä»£ç ç‰‡æ®µï¼ˆåªéœ€è¦ä¿®æ”¹ loadGitHubIndexMap å‡½æ•°å†…éƒ¨çš„è¿™ä¸€å°æ®µï¼‰ï¼š\nconst values = Array.isArray(remoteIndex[key]) \n               ? remoteIndex[key] \n               : []; // å¦‚æœä¸æ˜¯æ•°ç»„ï¼Œåˆ™è§†ä¸ºç©ºï¼Œé˜²æ­¢éæ•°ç»„å€¼è¢«è¿­ä»£\n\n        if (values.length === 0) {\n            // å¦‚æœæŸä¸ªå±æ€§æ²¡æœ‰å€¼ï¼Œåˆ™è·³è¿‡ï¼Œåªä¿ç•™å½“å‰ç»„åˆ\n             return generateCombinations(index + 1, currentCombination);\n        }\n\n        let results = [];\n        for (const value of values) {\n            // é€’å½’ç”Ÿæˆä¸‹ä¸€å±‚ç»„åˆ\n            results = results.concat(generateCombinations(index + 1, [...currentCombination, value]));\n        }\n        return results;\n    }\n\n    const allKeys = generateCombinations();\n    const newMap = {};\n    const effectiveBaseUrl = baseUrl.endsWith('/') ? baseUrl : `${baseUrl}/`; // ç¡®ä¿baseUrlä»¥'/'ç»“å°¾\n\n    for (const key of allKeys) {\n        // æ‹¼æ¥æˆ GitHub å›¾åºŠé“¾æ¥\n        // æ³¨æ„ï¼šè¿™é‡Œå‡è®¾å›¾ç‰‡éƒ½æ˜¯ .png æ ¼å¼ï¼Œå¦‚æœæ ¼å¼ä¸å›ºå®šï¼Œéœ€è¦è°ƒæ•´\n        newMap[key] = `${effectiveBaseUrl}${key}.png`;\n    }\n\n    if (Object.keys(newMap).length === 0) {\n        console.error(`æ ¹æ®ç´¢å¼• ${indexUrl} æœªèƒ½ç”Ÿæˆä»»ä½•æœ‰æ•ˆçš„æ˜ å°„ï¼ä½¿ç”¨å›é€€æ•°æ®ã€‚`);\n        return fallbackData;\n    }\n    \n    console.log(`æˆåŠŸä»ç´¢å¼• ${indexUrl} ç”Ÿæˆ ${Object.keys(newMap).length} æ¡æ–°æ˜ å°„ã€‚`);\n     if (indexUrl.includes('npcImageMapIndex.json')) {\n        const sampleKey = allKeys.find(k => k.includes('ç”·-æˆå¹´-é“¶å‘-ä¸­çŸ­å‘-å‚²æ…¢-ä¼‘é—²è£…')) || allKeys[0];\n        console.log(`[Nova][INDEX-GEN] NPCæ˜ å°„çš„å‰5ä¸ªé”®: ${allKeys.slice(0, 5).join(', ')}`);\n        if (sampleKey) {\n             console.log(`[Nova][INDEX-GEN] NPCæ˜ å°„ç¤ºä¾‹é”®'${sampleKey}' -> URL: ${newMap[sampleKey]}`);\n        } else {\n             console.log(`[Nova][INDEX-GEN] è­¦å‘Šï¼šåœ¨ç”Ÿæˆçš„é”®ä¸­æ‰¾ä¸åˆ° 'ç”·-æˆå¹´-é“¶å‘-ä¸­çŸ­å‘-å‚²æ…¢-ä¼‘é—²è£…'ï¼Œè¯·æ£€æŸ¥ç´¢å¼•!`);\n        }\n    }\n    return newMap;\n}\n// ä¸»è¦çš„åŠ è½½å‡½æ•°\nasync function loadRemoteContent(url, type = 'json', fallbackData = null) {\n    try {\n        console.log(`å¼€å§‹åŠ è½½è¿œç¨‹å†…å®¹ (${type})...`, url);\n        const cacheBustingUrl = `${url}?v=${new Date().getTime()}`;\n        console.log(`NOVA V9.6: æ­£åœ¨ä»¥â€œç ´ç¼“å­˜â€æ¨¡å¼è¯·æ±‚ -> ${cacheBustingUrl}`);\n\n        const response = await fetch(cacheBustingUrl);\n        if (!response.ok) {\n            throw new Error(`HTTPé”™è¯¯: ${response.status} ${response.statusText}`);\n        }\n\n        const rawText = await response.text();\n        console.log(`è·å–åˆ°åŸå§‹æ–‡æœ¬ï¼Œé•¿åº¦: ${rawText.length} å­—ç¬¦`);\n\n        if (type === 'json' || type === 'eval') {\n            try {\n                // ä¼˜å…ˆå°è¯•æ ‡å‡†JSONè§£æï¼Œå› ä¸ºå®ƒæœ€å®‰å…¨ã€æœ€é«˜æ•ˆ\n                return JSON.parse(rawText);\n            } catch (jsonError) {\n                console.warn('æ ‡å‡†JSONè§£æå¤±è´¥ï¼Œé”™è¯¯:', jsonError.message);\n\n                if (type === 'eval') {\n                    // â™¥â™¥â™¥ è¿™æ˜¯æˆ‘ä»¬çš„ç§˜å¯†æ­¦å™¨ï¼ševal (Function) â™¥â™¥â™¥\n                    // å½“æ ‡å‡†è§£æå¤±è´¥æ—¶ï¼Œæˆ‘ä»¬ç”¨æ›´çµæ´»çš„æ–¹å¼æ¥â€œæ‰§è¡Œâ€å®ƒ\n                    console.log('å°è¯•ä½¿ç”¨æ›´çµæ´»çš„ Function-based eval æ–¹å¼...');\n                    try {\n                        // æˆ‘ä»¬ä¸ç›´æ¥ç”¨ evalï¼Œè€Œæ˜¯ç”¨ Function æ„é€ å‡½æ•°ï¼Œè¿™æ›´å®‰å…¨\n                        // å®ƒåœ¨ä¸€ä¸ªéš”ç¦»çš„ä½œç”¨åŸŸä¸­æ‰§è¡Œï¼Œä¸ä¼šæ±¡æŸ“å…¨å±€\n                        const func = new Function(`return ${rawText}`);\n                        return func();\n                    } catch (evalError) {\n                        console.error('éå¸¸æŠ±æ­‰ï¼Œæˆ‘çš„å­©å­ï¼Œå³ä½¿æ˜¯ç”¨æœ€çµæ´»çš„æ–¹æ³•ä¹Ÿæ— æ³•ç†è§£è¿™æ®µå’’è¯­:', evalError);\n                        throw new Error('æ‰€æœ‰è§£æå°è¯•å‡å‘Šå¤±è´¥ï¼Œæ–‡æœ¬å†…å®¹å¯èƒ½ç¡®å®å­˜åœ¨ä¸¥é‡è¯­æ³•é—®é¢˜ã€‚');\n                    }\n                } else {\n                    // å¦‚æœåªæ˜¯æ™®é€šjsonè¯·æ±‚ï¼Œå¤±è´¥äº†å°±æ˜¯å¤±è´¥äº†\n                    throw jsonError;\n                }\n            }\n        }\n\n        // å¦‚æœè¯·æ±‚çš„å°±æ˜¯çº¯æ–‡æœ¬\n        return rawText;\n\n    } catch (error) {\n        console.error(`åŠ è½½è¿œç¨‹å†…å®¹ (${url}) å¤±è´¥:`, error.message);\n        console.log('æ­£åœ¨ä½¿ç”¨é¢„è®¾çš„åå¤‡æ–¹æ¡ˆ...');\n        // å¦‚æœ fallbackData æ˜ç¡®æ˜¯ nullï¼Œå°±è¿”å› nullï¼Œå¦åˆ™ä½¿ç”¨ç©ºå¯¹è±¡æˆ–ç©ºæ•°ç»„\n        return fallbackData === null ? null : (type === 'json' ? {} : '');\n    }\n}\nasync function loadRemoteJson(url, fallbackData = {}) {\n    try {\n        console.log('å¼€å§‹åŠ è½½æ˜ å°„...',url);\n           const cacheBustingUrl = `${url}?v=${new Date().getTime()}`;\n        // const cacheBustingUrl = `${url}`;\n        console.log(`NOVA V9.5: æ­£åœ¨ä½¿ç”¨â€œç ´é™¤ç¼“å­˜â€æ¨¡å¼è¯·æ±‚ -> ${cacheBustingUrl}`);\n    \n\n\n               const response = await fetch(cacheBustingUrl);\n        if (!response.ok) {\n            throw new Error(`HTTPé”™è¯¯: ${response.status} ${response.statusText}`);\n        }\n        \n        let jsonText = await response.text();\n        console.log(`è·å–åˆ°JSONæ–‡æœ¬ï¼Œé•¿åº¦: ${jsonText.length}å­—ç¬¦`);\n        \n        // é¦–æ¬¡å°è¯•ç›´æ¥è§£æ\n        try {\n            const data = JSON.parse(jsonText);\n            console.log('JSONè§£ææˆåŠŸï¼');\n            return data;\n        } catch (parseError) {\n            console.warn('ç›´æ¥è§£æå¤±è´¥ï¼Œå°è¯•æ¸…ç†JSON...', parseError.message);\n            \n            // è¯Šæ–­é”™è¯¯\n            diagnoseJSONError(jsonText, parseError);\n            \n            // å°è¯•æ¸…ç†å’Œä¿®å¤\n            const sanitizedJSON = sanitizeJSON(jsonText);\n            \n            if (validateJSON(sanitizedJSON)) {\n                console.log('JSONæ¸…ç†æˆåŠŸï¼Œé‡æ–°è§£æ...');\n                const data = JSON.parse(sanitizedJSON);\n                console.log('æ¸…ç†åçš„JSONè§£ææˆåŠŸï¼');\n                return data;\n            } else {\n                throw new Error('JSONæ¸…ç†åä»ç„¶æ— æ•ˆ');\n            }\n        }\n        \n    } catch (error) {\n        console.error('åŠ è½½æ˜ å°„å¤±è´¥:', error.message);\n        \n        console.log('ä½¿ç”¨fallbackæ•°æ®');\n        return fallbackData;\n    }\n}\n\nlet achievementQueue = [];\nlet isShowingAchievement = false;\n let achievementData = JSON.parse(localStorage.getItem('achievements_data'));\n\nfunction checkAchievements(eventType, value) {\n try {\n     initialAchievementData  = {\n     achievements: {\n    newbie_explorer: {\n      title: \"ã€æ–°äººï¼Ÿã€‘\",\n      description: \"é¦–æ¬¡è¿›å…¥è¿™ä¸ªä¸–ç•Œï¼Œä¸€åˆ‡éƒ½æ˜¯æ–°çš„å¼€å§‹ã€‚\",\n      icon: \"ğŸŒ±\",\n      unlocked: false, unlocked_at: null, reward_claimed: false,\n      reward: \"ç§°å·ã€Œæ–°äººã€\",\n      flavor_text: \"æ¬¢è¿å…‰ä¸´ï¼Œæ„¿ä½ çš„æ•…äº‹å¦‚ç¹æ˜Ÿèˆ¬ç’€ç’¨ã€‚\"\n    },\n    points_master: {\n      title: \"ã€æŒ¥é‡‘å¦‚åœŸã€‘\",\n      description: \"åœ¨æ•°æ®æ„å»ºæ—¶ï¼Œåˆå§‹ç‚¹æ•°è¶…è¿‡200ç‚¹ã€‚\",\n      icon: \"ğŸ‘‘\",\n      unlocked: false, unlocked_at: null, reward_claimed: false,\n      reward: \"ç§°å·ã€Œè´¥å®¶å­ã€\",\n      flavor_text: \"è´«ç©·é™åˆ¶äº†æˆ‘çš„æƒ³è±¡åŠ›ï¼Œä½†æ²¡é™åˆ¶æˆ‘çš„èŠ±è´¹ã€‚\"\n    },\n    points_ascetic: {\n  title: \"ã€åœ°ç‹±è¡Œè€…ã€‘\",\n  description: \"åœ¨æ•°æ®æ„å»ºæ—¶ï¼Œåˆå§‹ç‚¹æ•°èŠ±è´¹ä¸º0ç‚¹ã€‚\",\n  icon: \"ğŸ‘\",\n  unlocked: false, unlocked_at: null, reward_claimed: false,\n  reward: \"ç§°å·ã€Œè‹¦è¡Œåƒ§ã€\",\n  flavor_text: \"çœŸæ­£çš„å¼ºè€…ï¼Œä»ä¸ä¾èµ–äºèŠ±é‡Œèƒ¡å“¨çš„å¼€å±€ã€‚\"\n},\n    careful_planner: {\n      title: \"ã€ç²¾æ‰“ç»†ç®—ã€‘\",\n      description: \"åœ¨æ•°æ®æ„å»ºæ—¶ï¼Œå®Œç¾ç”¨å®Œæ‰€æœ‰åˆå§‹ç‚¹æ•°ï¼ˆå‰©ä½™ç‚¹æ•°ä¸º0ï¼‰ã€‚\",\n      icon: \"âš–ï¸\",\n      unlocked: false, unlocked_at: null, reward_claimed: false,\n      reward: \"ç§°å·ã€Œç†è´¢è¾¾äººã€\",\n      flavor_text: \"æ¯ä¸€åˆ†éƒ½ç”¨åœ¨åˆ€åˆƒä¸Šï¼Œè¿™å°±æ˜¯è§„åˆ’çš„è‰ºæœ¯ã€‚\"\n    },\n\n    // ========== ç”Ÿæ­»ä¸çŠ¶æ€ ==========\n    first_death: {\n      title: \"ã€ç¬¬ä¸€æ¬¡äº²å¯†æ¥è§¦ã€‘\",\n      description: \"ç”Ÿå‘½å€¼ç¬¬ä¸€æ¬¡å½’é›¶ã€‚åˆ«æ€•ï¼Œè¿™åªæ˜¯ä¸€ä¸ªé€—å·ï¼Œä¸æ˜¯å¥å·ã€‚\",\n      icon: \"ğŸ’€\",\n      unlocked: false, unlocked_at: null, reward_claimed: false,\n      reward: \"ç§°å·ã€Œä¸æ­»é¸Ÿä¹‹é›ã€\",\n      flavor_text: \"â€œæˆ‘è¿˜ä»¥ä¸ºæˆ‘æ­»äº†å‘¢ï¼â€ â€”â€” å¾ˆå¤šäººéƒ½è¿™ä¹ˆè¯´ã€‚\"\n    },\n    near_death_experience: {\n        title: \"ã€ç”Ÿæ­»ä¸€çº¿ã€‘\",\n        description: \"åœ¨ç”Ÿå‘½å€¼ä»…å‰©1ç‚¹çš„æƒ…å†µä¸‹å­˜æ´»ã€‚\",\n        icon: \"ğŸ©¸\",\n        unlocked: false, unlocked_at: null, reward_claimed: false,\n        reward: \"ç§°å·ã€Œå¹¸å­˜è€…ã€\",\n        flavor_text: \"æ­»ç¥æ•²äº†æ•²é—¨ï¼Œè€Œä½ å‡è£…ä¸åœ¨å®¶ã€‚\"\n    },\n    glass_cannon: {\n        title: \"ã€è„†çš®ä¸“å®¶ã€‘\",\n        description: \"ä½ çš„ç”Ÿå‘½å€¼ä¸Šé™ä½äº20ç‚¹ã€‚\",\n        icon: \"ğŸ’”\",\n        unlocked: false, unlocked_at: null, reward_claimed: false,\n        reward: \"ç§°å·ã€Œç¢°ä¸€ä¸‹å°±ç¢ã€\",\n        flavor_text: \"æœ€å¥½çš„é˜²å¾¡å°±æ˜¯â€¦â€¦åœ¨è¢«æ‘¸åˆ°ä¹‹å‰å¹²æ‰æ‰€æœ‰äººã€‚\"\n    },\n    human_tank: {\n        title: \"ã€è¡€ç‰›ã€‘\",\n        description: \"ä½ çš„ç”Ÿå‘½å€¼ä¸Šé™è¶…è¿‡200ç‚¹ã€‚\",\n        icon: \"ğŸ›¡ï¸\",\n        unlocked: false, unlocked_at: null, reward_claimed: false,\n        reward: \"ç§°å·ã€Œç§»åŠ¨åŸå¢™ã€\",\n        flavor_text: \"åŒ»ç”Ÿï¼šâ€œä»–æ˜¯ä»€ä¹ˆè¡€å‹ï¼Ÿâ€ æŠ¤å£«ï¼šâ€œâ€¦â€¦å¾ˆå¤šã€‚â€\"\n    },\n\n    // ========== å±æ€§ä¸æŠ€èƒ½æˆé•¿ ==========\n    legendary_physique: {\n        title: \"ã€ä¼ å¥‡ä¹‹èº¯ã€‘\",\n        description: \"ä»»ä¸€åŸºç¡€ç”Ÿç†å±æ€§ï¼ˆåŠ›é‡ã€æ•æ·ã€è€åŠ›ï¼‰è¾¾åˆ°8ç‚¹ã€‚\",\n        icon: \"ğŸ’ª\",\n        unlocked: false, unlocked_at: null, reward_claimed: false,\n        reward: \"ç§°å·ã€Œäººå½¢å‡¶å…½ã€\",\n        flavor_text: \"ä½ å·²ç»è¶…è¶Šäº†å‡¡äººçš„æé™ï¼Œç°åœ¨ï¼Œè§„åˆ™ç”±ä½ æ¥ä¹¦å†™ã€‚\"\n    },\n    legendary_mind: {\n        title: \"ã€ä¼ å¥‡å¿ƒæ™ºã€‘\",\n        description: \"ä»»ä¸€åŸºç¡€å¿ƒæ™ºå±æ€§ï¼ˆæ™ºåŠ›ã€æ„ŸçŸ¥ã€å†³å¿ƒï¼‰è¾¾åˆ°8ç‚¹ã€‚\",\n        icon: \"ğŸ§ \",\n        unlocked: false, unlocked_at: null, reward_claimed: false,\n        reward: \"ç§°å·ã€Œæ€æƒ³çš„å·¨äººã€\",\n        flavor_text: \"ä¸–ç•Œåœ¨ä½ çœ¼ä¸­ä¸è¿‡æ˜¯ä¸€ç›˜å°šæœªç»“æŸçš„æ£‹å±€ã€‚\"\n    },\n    legendary_presence: {\n        title: \"ã€ä¼ å¥‡é£é‡‡ã€‘\",\n        description: \"ä»»ä¸€åŸºç¡€äº’åŠ¨å±æ€§ï¼ˆé£åº¦ã€æ“æ§ã€æ²‰ç€ï¼‰è¾¾åˆ°8ç‚¹ã€‚\",\n        icon: \"ğŸ­\",\n        unlocked: false, unlocked_at: null, reward_claimed: false,\n        reward: \"ç§°å·ã€Œè¡Œèµ°çš„é­…åŠ›/ç¾å„ã€\",\n        flavor_text: \"è¨€è¯­æ˜¯ä½ çš„æ­¦å™¨ï¼Œä¸–ç•Œæ˜¯ä½ çš„èˆå°ã€‚\"\n    },\n    master_of_one: {\n        title: \"ã€ä¸€æŠ€ä¹‹é•¿ã€‘\",\n        description: \"ä»»ä¸€æŠ€èƒ½ç­‰çº§è¾¾åˆ°8ç‚¹ã€‚\",\n        icon: \"ğŸŒŸ\",\n        unlocked: false, unlocked_at: null, reward_claimed: false,\n        reward: \"ç§°å·ã€Œé¢†åŸŸçš„å®—å¸ˆã€\",\n        flavor_text: \"å°†ä¸€ä»¶äº‹åšåˆ°æè‡´ï¼Œä½ ä¾¿æ˜¯ä¼ å¥‡ã€‚\"\n    },\n    jack_of_all_trades: {\n        title: \"ã€ä¸‡äº‹é€šã€‘\",\n        description: \"æ€»å…±æœ‰è¶…è¿‡20ä¸ªæŠ€èƒ½ç­‰çº§ä¸ä¸º0ã€‚\",\n        icon: \"ğŸ“š\",\n        unlocked: false, unlocked_at: null, reward_claimed: false,\n        reward: \"ç§°å·ã€Œè¡Œèµ°çš„ç™¾ç§‘å…¨ä¹¦ã€\",\n        flavor_text: \"â€œä½ è¿˜æ‡‚è¿™ä¸ªï¼Ÿâ€ â€œç•¥æ‡‚ï¼Œç•¥æ‡‚ã€‚â€\"\n    },\n    specialist: {\n        title: \"ã€åç§‘ç”Ÿã€‘\",\n        description: \"å•ä¸€æŠ€èƒ½æ®µï¼ˆç”Ÿç†/å¿ƒæ™º/äº’åŠ¨ï¼‰çš„æ€»æŠ€èƒ½ç‚¹æ•°è¶…è¿‡å…¶ä»–ä¸¤é¡¹ä¹‹å’Œã€‚\",\n        icon: \"ğŸ“ˆ\",\n        unlocked: false, unlocked_at: null, reward_claimed: false,\n        reward: \"ç§°å·ã€Œæœ¯ä¸šæœ‰ä¸“æ”»ã€\",\n        flavor_text: \"æˆ‘å¯èƒ½ä¸æ˜¯æ ·æ ·éƒ½è¡Œï¼Œä½†åœ¨æˆ‘çš„é¢†åŸŸé‡Œï¼Œæ— äººèƒ½åŠã€‚\"\n    },\n\n    // ========== ä»»åŠ¡ä¸å£°æœ› ==========\n    first_mission: {\n        title: \"ã€è¿ˆå‡ºç¬¬ä¸€æ­¥ã€‘\",\n        description: \"å®Œæˆä½ çš„ç¬¬ä¸€ä¸ªä»»åŠ¡ã€‚\",\n        icon: \"ğŸ\",\n        unlocked: false, unlocked_at: null, reward_claimed: false,\n        reward: \"ç§°å·ã€Œä»»åŠ¡æ–°äººã€\",\n        flavor_text: \"ä¼Ÿå¤§çš„æ—…ç¨‹å§‹äºè¶³ä¸‹ã€‚\"\n    },\n    ten_missions: {\n        title: \"ã€ä»»åŠ¡è€æ‰‹ã€‘\",\n        description: \"ç´¯è®¡å®Œæˆ10ä¸ªä»»åŠ¡ã€‚\",\n        icon: \"ğŸ”Ÿ\",\n        unlocked: false, unlocked_at: null, reward_claimed: false,\n        reward: \"ç§°å·ã€Œèº«ç»ç™¾æˆ˜ã€\",\n        flavor_text: \"ä½ å·²ç»å¯¹â€˜å¤±è´¥æŠ¹æ€â€™æ„Ÿåˆ°éº»æœ¨äº†ã€‚\"\n    },\n    hundred_missions: {\n        title: \"ã€ä»»åŠ¡æœºå™¨ã€‘\",\n        description: \"ç´¯è®¡å®Œæˆ100ä¸ªä»»åŠ¡ã€‚\",\n        icon: \"ğŸ’¯\",\n        unlocked: false, unlocked_at: null, reward_claimed: false,\n        reward: \"ç§°å·ã€Œè½®å›ä¸­çš„ä¼ è¯´ã€\",\n        flavor_text: \"ä½ çš„äº‹è¿¹åœ¨æ— æ•°ä¸–ç•Œä¸­æµä¼ ï¼Œå°½ç®¡ä¸»è§’åå­—æ€»è¢«è®°é”™ã€‚\"\n    },\n    world_savior: {\n        title: \"ã€ä¸–ç•Œä¹‹å‹ã€‘\",\n        description: \"è·¨ä¸–ç•Œå£°æœ›è¾¾åˆ°10ç‚¹ã€‚\",\n        icon: \"ğŸŒ\",\n        unlocked: false, unlocked_at: null, reward_claimed: false,\n        reward: \"ç§°å·ã€Œä½é¢è¡Œè€…ã€\",\n        flavor_text: \"ä½ çš„å–„æ„è·¨è¶Šäº†ä¸–ç•Œçš„å£å’ï¼Œæ”¶è·äº†æ˜Ÿè¾°çš„å›å“ã€‚\"\n    },\n    world_enemy: {\n        title: \"ã€ä¸–ç•Œå…¬æ•Œã€‘\",\n        description: \"è·¨ä¸–ç•Œå£°æœ›è·Œè‡³-10ç‚¹ã€‚\",\n        icon: \"ğŸ’¥\",\n        unlocked: false, unlocked_at: null, reward_claimed: false,\n        reward: \"ç§°å·ã€Œç¾å„ä¹‹æ˜Ÿã€\",\n        flavor_text: \"æ¬¢è¿æ¥åˆ°æ¯ä¸ªä¸–ç•Œçš„é€šç¼‰åå•æ¦œé¦–ã€‚\"\n    },\n\n    // ========== è´¢å¯Œä¸æ”¶é›† ==========\n    first_home: {\n        title: \"ã€æˆ‘çš„ç¬¬ä¸€ä¸ªå®¶ã€‘\",\n        description: \"åœ¨ä¸ªäººç©ºé—´ä¸­æ”¾ç½®ç¬¬ä¸€ä»¶å®¶å…·ã€‚\",\n        icon: \"ğŸ \",\n        unlocked: false, unlocked_at: null, reward_claimed: false,\n        reward: \"ç§°å·ã€Œç­‘å·¢è€…ã€\",\n        flavor_text: \"æ— è®ºåœ¨å“ªï¼Œæœ‰ä¸ªèƒ½å›å»çš„åœ°æ–¹æ€»æ˜¯å¥½çš„ã€‚\"\n    },\n    cozy_home: {\n        title: \"ã€æ¸©é¦¨å°å±‹ã€‘\",\n        description: \"ä¸ªäººç©ºé—´çš„å®¶å…·æ•°é‡è¾¾åˆ°10ä»¶ã€‚\",\n        icon: \"ğŸ›‹ï¸\",\n        unlocked: false, unlocked_at: null, reward_claimed: false,\n        reward: \"ç§°å·ã€Œå®¤å†…è®¾è®¡å¸ˆã€\",\n        flavor_text: \"è¿™é‡Œå¼€å§‹æœ‰ç‚¹å®¶çš„æ ·å­äº†ã€‚\"\n    },\n    luxury_manor: {\n        title: \"ã€è±ªååº„å›­ã€‘\",\n        description: \"ä¸ªäººç©ºé—´çš„å®¶å…·æ•°é‡è¾¾åˆ°50ä»¶ã€‚\",\n        icon: \"ğŸ°\",\n        unlocked: false, unlocked_at: null, reward_claimed: false,\n        reward: \"ç§°å·ã€Œç©ºé—´ç®¡ç†å¤§å¸ˆã€\",\n        flavor_text: \"ä½ çš„ä¸ªäººç©ºé—´ç°åœ¨æ¯”æŸäº›å°ä¸–ç•Œè¿˜çƒ­é—¹ã€‚\"\n    },\n    rich_man: {\n        title: \"ã€å°æœ‰èµ„äº§ã€‘\",\n        description: \"å½“å‰æ‹¥æœ‰çš„ç§¯åˆ†è¶…è¿‡10000ã€‚\",\n        icon: \"ğŸ’°\",\n        unlocked: false, unlocked_at: null, reward_claimed: false,\n        reward: \"ç§°å·ã€Œä¸‡å…ƒæˆ·ã€\",\n        flavor_text: \"ä½ å¯ä»¥è‡ªä¿¡åœ°èµ°è¿›å•†åº—ï¼Œç„¶åé—®ï¼šâ€œé™¤äº†è¿™ä¸ªï¼Œè¿˜æœ‰åˆ«çš„å—ï¼Ÿâ€\"\n    },\n    super_rich: {\n        title: \"ã€å¯Œå¯æ•Œå›½ã€‘\",\n        description: \"å½“å‰æ‹¥æœ‰çš„ç§¯åˆ†è¶…è¿‡100000ã€‚\",\n        icon: \"ğŸ¤‘\",\n        unlocked: false, unlocked_at: null, reward_claimed: false,\n        reward: \"ç§°å·ã€Œè¡Œèµ°çš„é‡‘åº“ã€\",\n        flavor_text: \"ä¸»ç¥çœ‹äº†ä½ çš„ä½™é¢éƒ½å¾—é—®ä¸€å¥ï¼šâ€˜å“¥ï¼Œæœ€è¿‘æœ‰å•¥é¡¹ç›®ä¸€èµ·åšï¼Ÿâ€™\"\n    },\n    s_rank_hoarder: {\n        title: \"ã€Sçº§çš„è£è€€ã€‘\",\n        description: \"æ‹¥æœ‰ä¸€ä¸ªSçº§æ”¯çº¿å‰§æƒ…ã€‚\",\n        icon: \"S\",\n        unlocked: false, unlocked_at: null, reward_claimed: false,\n        reward: \"ç§°å·ã€Œå‰§æƒ…æ”¶è—å®¶ã€\",\n        flavor_text: \"è¿™æ˜¯æ”¹å˜ä¸–ç•Œèµ°å‘çš„å…³é”®ç¢ç‰‡ã€‚\"\n    },\n\n    // ========== å±æœºä¸æŒ‘æˆ˜ ==========\n    trivial_threat: {\n        title: \"ã€å°è¯•ç‰›åˆ€ã€‘\",\n        description: \"ç¬¬ä¸€æ¬¡é­é‡æ£€å®šéš¾åº¦å¤§äº3çš„å±æœºã€‚\",\n        icon: \"â‰ï¸\",\n        unlocked: false, unlocked_at: null, reward_claimed: false,\n        reward: \"ç§°å·ã€Œéº»çƒ¦ç£é“ã€\",\n        flavor_text: \"ä½ æ„Ÿè§‰åˆ°äº†ï¼Œäº‹æƒ…å¼€å§‹å˜å¾—â€˜æœ‰è¶£â€™èµ·æ¥äº†ã€‚\"\n    },\n    serious_challenge: {\n        title: \"ã€ä¸¥å³»æŒ‘æˆ˜ã€‘\",\n        description: \"ç¬¬ä¸€æ¬¡é­é‡æ£€å®šéš¾åº¦å¤§äº7çš„è¶…å‡¡å±æœºã€‚\",\n        icon: \"â€¼ï¸\",\n        unlocked: false, unlocked_at: null, reward_claimed: false,\n        reward: \"ç§°å·ã€Œå±æœºå¤„ç†ä¸“å®¶ã€\",\n        flavor_text: \"å‡¡äººçš„æŒ£æ‰å·²æˆè¿‡å¾€ï¼Œç°åœ¨æ˜¯è¶…å‡¡è€…çš„èˆå°ã€‚\"\n    },\n    gods_game: {\n        title: \"ã€ç¥æ˜æ£‹å±€ã€‘\",\n        description: \"ç¬¬ä¸€æ¬¡é­é‡æ£€å®šéš¾åº¦å¤§äº12çš„ç¥æ˜è§„åˆ™çº§å±æœºã€‚\",\n        icon: \"ğŸŒŒ\",\n        unlocked: false, unlocked_at: null, reward_claimed: false,\n        reward: \"ç§°å·ã€Œç¥ä¹‹åšå¼ˆè€…ã€\",\n        flavor_text: \"ä½ æŠ¬å¤´ä»°æœ›ï¼Œå‘ç°è‡ªå·±å·²æˆä¸ºæ£‹ç›˜ä¸Šçš„ä¸€å‘˜ã€‚\"\n    },\n    cosmic_horror: {\n        title: \"ã€ç›´é¢æœ¬æºã€‘\",\n        description: \"ç¬¬ä¸€æ¬¡é­é‡æ£€å®šéš¾åº¦å¤§äº15çš„æœ¬æºå®‡å®™çº§å±æœºã€‚\",\n        icon: \"ğŸŒ€\",\n        unlocked: false, unlocked_at: null, reward_claimed: false,\n        reward: \"ç§°å·ã€Œæ·±æ¸Šå‡æœ›è€…ã€\",\n        flavor_text: \"å½“ä½ å‡è§†æ·±æ¸Šæ—¶ï¼Œæ·±æ¸Šä¹Ÿåœ¨â€¦â€¦ç»™ä½ ç‚¹äº†ä¸ªèµï¼Ÿ\"\n    },\n\n    // ========== èƒ½é‡ä¸èƒ½åŠ› ==========\n    energy_awakening: {\n        title: \"ã€èƒ½é‡è§‰é†’ã€‘\",\n        description: \"èƒ½é‡æ± ä¸Šé™é¦–æ¬¡å¤§äº0ã€‚\",\n        icon: \"ğŸ’¡\",\n        unlocked: false, unlocked_at: null, reward_claimed: false,\n        reward: \"ç§°å·ã€Œè¶…å‡¡æ–°æ˜Ÿã€\",\n        flavor_text: \"ä½ æ„Ÿå—åˆ°äº†ä½“å†…é‚£è‚¡é™Œç”Ÿçš„åŠ›é‡ï¼Œå®ƒåœ¨æ¬¢å‘¼ï¼Œåœ¨é›€è·ƒã€‚\"\n    },\n    energy_pool_100: {\n        title: \"ã€èƒ½é‡æ´ªæµã€‘\",\n        description: \"èƒ½é‡æ± ä¸Šé™è¾¾åˆ°100ã€‚\",\n        icon: \"ğŸŒŠ\",\n        unlocked: false, unlocked_at: null, reward_claimed: false,\n        reward: \"ç§°å·ã€Œäººå½¢è‡ªèµ°å……ç”µå®ã€\",\n        flavor_text: \"ä½ ç°åœ¨å¯ä»¥è¿ç»­é‡Šæ”¾åä¸ªå°ç«çƒâ€¦â€¦æ¥çƒ¤é¢åŒ…ã€‚\"\n    },\n    energy_pool_1000: {\n        title: \"ã€èƒ½é‡å¥‡ç‚¹ã€‘\",\n        description: \"èƒ½é‡æ± ä¸Šé™è¾¾åˆ°1000ã€‚\",\n        icon: \"ğŸ’¥\",\n        unlocked: false, unlocked_at: null, reward_claimed: false,\n        reward: \"ç§°å·ã€Œè¡Œèµ°çš„é­”åŠ›æºã€\",\n        flavor_text: \"æˆ–è®¸ï¼Œä½ å¯ä»¥è€ƒè™‘ç»™ä¸€ä¸ªåŸå¸‚ä¾›ç”µäº†ã€‚\"\n    },\n    first_ability: {\n        title: \"ã€æ–°çš„æƒèƒ½ã€‘\",\n        description: \"è·å¾—ç¬¬ä¸€ä¸ªèƒ½åŠ›ã€‚\",\n        icon: \"ğŸ§©\",\n        unlocked: false, unlocked_at: null, reward_claimed: false,\n        reward: \"ç§°å·ã€Œèƒ½åŠ›è€…ã€\",\n        flavor_text: \"ä¸€å¼ æ–°çš„åº•ç‰Œï¼Œä¸€ä¸ªå´­æ–°çš„å¯èƒ½ã€‚\"\n    },\n\n    // ========== ç¾å¾·ä¸æ¶å¾· ==========\n    act_of_justice: {\n        title: \"ã€æ­£ä¹‰çš„ä¼™ä¼´ã€‘\",\n        description: \"é¦–æ¬¡å› ç¬¦åˆã€æ­£ä¹‰ã€‘ç¾å¾·è€Œè·å¾—å˜‰å¥–ã€‚\",\n        icon: \"âš–ï¸\",\n        unlocked: false, unlocked_at: null, reward_claimed: false,\n        reward: \"ç§°å·ã€Œæ­£ä¹‰çš„ä¼™ä¼´ã€\",\n        flavor_text: \"è™½åƒä¸‡äººï¼Œå¾å¾€çŸ£ã€‚\"\n    },\n    unleash_anger: {\n        title: \"ã€æ€’ç«ç‡åŸã€‘\",\n        description: \"é¦–æ¬¡å› ç¬¦åˆã€æ„¤æ€’ã€‘æ¶å¾·è€Œè·å¾—åŠ›é‡ã€‚\",\n        icon: \"ğŸ˜ \",\n        unlocked: false, unlocked_at: null, reward_claimed: false,\n        reward: \"ç§°å·ã€Œç‹‚æ€’è€…ã€\",\n        flavor_text: \"å¤Ÿäº†ï¼æˆ‘å·²ç»å¿æ— å¯å¿äº†ï¼\"\n    },\n    // ========== ç¾å¾·ä¸æ¶å¾· (æ–°å¢) ==========\nact_of_kindness: {\n    title: \"ã€æ¸©æŸ”çš„å®ˆæŠ¤è€…ã€‘\",\n    description: \"é¦–æ¬¡å› ç¬¦åˆã€æ…ˆçˆ±ã€‘ç¾å¾·è€Œè·å¾—å˜‰å¥–ã€‚\",\n    icon: \"ğŸ’–\",\n    unlocked: false, unlocked_at: null, reward_claimed: false,\n    reward: \"ç§°å·ã€Œæš–é˜³ã€\",\n    flavor_text: \"ä½ çš„å–„æ„ï¼Œæ˜¯è¿™ä¸ªå†°å†·ä¸–ç•Œé‡Œæœ€çè´µçš„æ¸©åº¦ã€‚\"\n},\nfind_your_faith: {\n    title: \"ã€æ··æ²Œä¸­çš„ç¯å¡”ã€‘\",\n    description: \"é¦–æ¬¡å› ç¬¦åˆã€ä¿¡å¿µã€‘ç¾å¾·è€Œè·å¾—å˜‰å¥–ã€‚\",\n    icon: \"ğŸ•¯ï¸\",\n    unlocked: false, unlocked_at: null, reward_claimed: false,\n    reward: \"ç§°å·ã€ŒæŒç‚¬äººã€\",\n    flavor_text: \"å½“æ‰€æœ‰äººéƒ½è¿·å¤±æ—¶ï¼Œä½ æ‰¾åˆ°äº†è‡ªå·±çš„é“è·¯ï¼Œå¹¶æˆä¸ºäº†ä»–äººçš„å…‰ã€‚\"\n},\niron_will: {\n    title: \"ã€ä¸å±ˆçš„ç£çŸ³ã€‘\",\n    description: \"é¦–æ¬¡å› ç¬¦åˆã€åˆšæ¯…ã€‘ç¾å¾·è€Œè·å¾—å˜‰å¥–ã€‚\",\n    icon: \"ğŸ’\",\n    unlocked: false, unlocked_at: null, reward_claimed: false,\n    reward: \"ç§°å·ã€Œä¸åŠ¨å¦‚å±±ã€\",\n    flavor_text: \"è¯±æƒ‘ä¸ç£¨éš¾å¦‚åŒæµªæ½®ï¼Œä½†ä½ ï¼Œæ˜¯æ— æ³•è¢«æ’¼åŠ¨çš„ç¤çŸ³ã€‚\"\n},\nspark_of_hope: {\n    title: \"ã€å¸Œæœ›çš„ç«ç§ã€‘\",\n    description: \"é¦–æ¬¡å› ç¬¦åˆã€å¸Œæœ›ã€‘ç¾å¾·è€Œè·å¾—å˜‰å¥–ã€‚\",\n    icon: \"âœ¨\",\n    unlocked: false, unlocked_at: null, reward_claimed: false,\n    reward: \"ç§°å·ã€Œæ™¨æ˜Ÿã€\",\n    flavor_text: \"åœ¨æœ€æ·±çš„é»‘å¤œé‡Œï¼Œä½ ç‚¹ç‡ƒäº†é‚£é¢—è¶³ä»¥ç…§äº®é»æ˜åœ°å¹³çº¿çš„æ˜Ÿã€‚\"\n},\nprudent_choice: {\n    title: \"ã€æ™ºæ…§çš„è¿œè§ã€‘\",\n    description: \"é¦–æ¬¡å› ç¬¦åˆã€ç¨³é‡ã€‘ç¾å¾·è€Œè·å¾—å˜‰å¥–ã€‚\",\n    icon: \"ğŸ§\",\n    unlocked: false, unlocked_at: null, reward_claimed: false,\n    reward: \"ç§°å·ã€Œæ£‹æ‰‹ã€\",\n    flavor_text: \"æ·å¾„é€šå‘æ‚¬å´–ï¼Œè€Œä½ çš„æ¯ä¸€æ­¥éƒ½è¸åœ¨åšå®çš„åœŸåœ°ä¸Šã€‚\"\n},\nself_control: {\n    title: \"ã€å†…å¿ƒçš„ä¿®è¡Œã€‘\",\n    description: \"é¦–æ¬¡å› ç¬¦åˆã€èŠ‚åˆ¶ã€‘ç¾å¾·è€Œè·å¾—å˜‰å¥–ã€‚\",\n    icon: \"ğŸ§˜\",\n    unlocked: false, unlocked_at: null, reward_claimed: false,\n    reward: \"ç§°å·ã€Œè‹¦è¡Œåƒ§ã€\",\n    flavor_text: \"çœŸæ­£çš„å¼ºå¤§ï¼Œæ˜¯é©¾é©­è‡ªå·±çš„æ¬²æœ›ï¼Œè€Œéè¢«å…¶å¥´å½¹ã€‚\"\n},\npoisonous_envy: {\n    title: \"ã€æ‰­æ›²çš„æ¸´æ±‚ã€‘\",\n    description: \"é¦–æ¬¡å› ç¬¦åˆã€å¦’å¿Œã€‘æ¶å¾·è€Œè·å¾—åŠ›é‡ã€‚\",\n    icon: \"ğŸ\",\n    unlocked: false, unlocked_at: null, reward_claimed: false,\n    reward: \"ç§°å·ã€Œæ¯’è‹¹æœã€\",\n    flavor_text: \"æ—¢ç„¶æˆ‘å¾—ä¸åˆ°ï¼Œé‚£ä¾¿æ¯æ‰å®ƒã€‚\"\n},\nreckless_indulgence: {\n    title: \"ã€æ¬²æœ›çš„å¥´éš¶ã€‘\",\n    description: \"é¦–æ¬¡å› ç¬¦åˆã€æ”¾çºµã€‘æ¶å¾·è€Œè·å¾—åŠ›é‡ã€‚\",\n    icon: \"ğŸ·\",\n    unlocked: false, unlocked_at: null, reward_claimed: false,\n    reward: \"ç§°å·ã€Œæ— åº•æ´ã€\",\n    flavor_text: \"ä»Šæœæœ‰é…’ä»Šæœé†‰ï¼Œæ˜æ—¥çš„æ´ªæ°´æ»”å¤©ä¸æˆ‘ä½•å¹²ï¼Ÿ\"\n},\ninsatiable_greed: {\n    title: \"ã€è´ªå©ªçš„æ·±æ¸Šã€‘\",\n    description: \"é¦–æ¬¡å› ç¬¦åˆã€è´ªå©ªã€‘æ¶å¾·è€Œè·å¾—åŠ›é‡ã€‚\",\n    icon: \"ğŸª™\",\n    unlocked: false, unlocked_at: null, reward_claimed: false,\n    reward: \"ç§°å·ã€Œé»„é‡‘çƒ­ç—…æ‚£è€…ã€\",\n    flavor_text: \"æ›´å¤šï¼Œæˆ‘è¿˜è¦æ›´å¤šï¼æ•´ä¸ªä¸–ç•Œéƒ½è¯¥æ˜¯æˆ‘çš„ï¼\"\n},\nunrestrained_lust: {\n    title: \"ã€æƒ…æ¬²çš„é£æš´ã€‘\",\n    description: \"é¦–æ¬¡å› ç¬¦åˆã€çºµæ¬²ã€‘æ¶å¾·è€Œè·å¾—åŠ›é‡ã€‚\",\n    icon: \"ğŸ”¥\",\n    unlocked: false, unlocked_at: null, reward_claimed: false,\n    reward: \"ç§°å·ã€Œæ é£Ÿè€…ã€\",\n    flavor_text: \"è§„åˆ™å’Œæ„Ÿå—ï¼Ÿé‚£åªæ˜¯å¼±è€…ç”¨æ¥æŸç¼šå¼ºè€…çš„å€Ÿå£ã€‚\"\n},\nfatal_pride: {\n    title: \"ã€è‡´å‘½çš„éª„å‚²ã€‘\",\n    description: \"é¦–æ¬¡å› ç¬¦åˆã€éª„å‚²ã€‘æ¶å¾·è€Œè·å¾—åŠ›é‡ã€‚\",\n    icon: \"ğŸ¦š\",\n    unlocked: false, unlocked_at: null, reward_claimed: false,\n    reward: \"ç§°å·ã€Œé«˜å¡”ä¸Šçš„å‚»ç“œã€\",\n    flavor_text: \"æˆ‘ï¼Œå³æ˜¯çœŸç†ã€‚æ‰€æœ‰ä¸è®¤åŒçš„ï¼Œéƒ½å°†è¢«ç¢¾ç¢ã€‚\"\n},\nsweet_sloth: {\n    title: \"ã€æ…µæ‡’çš„èƒœåˆ©ã€‘\",\n    description: \"é¦–æ¬¡å› ç¬¦åˆã€æ‡’æƒ°ã€‘æ¶å¾·è€Œè·å¾—åŠ›é‡ã€‚\",\n    icon: \"ğŸ˜´\",\n    unlocked: false, unlocked_at: null, reward_claimed: false,\n    reward: \"ç§°å·ã€Œå¤©é€‰æ‘¸é±¼äººã€\",\n    flavor_text: \"æˆ‘ä»€ä¹ˆéƒ½æ²¡åšï¼Œäº‹æƒ…å°±è‡ªå·±è§£å†³äº†ã€‚æœç„¶ï¼ŒåŠªåŠ›æ˜¯æ²¡æœ‰æ„ä¹‰çš„ã€‚\"\n},\n\n    // ========== è£…å¤‡ä¸ç‰©å“ ==========\n    first_weapon: {\n        title: \"ã€æ­¦è£…èµ·æ¥ã€‘\",\n        description: \"é¦–æ¬¡åœ¨æ‰‹æŒæ è£…å¤‡æ­¦å™¨æˆ–å·¥å…·ã€‚\",\n        icon: \"âš”ï¸\",\n        unlocked: false, unlocked_at: null, reward_claimed: false,\n        reward: \"ç§°å·ã€Œå¤‡æˆ˜è€…ã€\",\n        flavor_text: \"æ— è®ºå®ƒæ˜¯ä¸€æ ¹æœ¨æ£è¿˜æ˜¯ä¸€æŠŠåœ£å‰‘ï¼Œå®ƒéƒ½æ˜¯ä½ æ„å¿—çš„å»¶ä¼¸ã€‚\"\n    },\n    fully_equipped: {\n        title: \"ã€å…¨å‰¯æ­¦è£…ã€‘\",\n        description: \"å¤´éƒ¨ã€èº«ä½“ã€æ‰‹éƒ¨ã€è„šéƒ¨å››ä¸ªç©¿æˆ´éƒ¨ä½å‡è£…å¤‡äº†ç‰©å“ã€‚\",\n        icon: \"ğŸ¥‹\",\n        unlocked: false, unlocked_at: null, reward_claimed: false,\n        reward: \"ç§°å·ã€Œæ­¦è£…åˆ°ç‰™é½¿ã€\",\n        flavor_text: \"ä½ çœ‹èµ·æ¥å·²ç»å‡†å¤‡å¥½å»å‚åŠ ä»»ä½•ä¸€åœºæ´¾å¯¹ï¼Œæˆ–è€…æˆ˜äº‰ã€‚\"\n    },\n\n    // ========== æ‚é¡¹ä¸å½©è›‹ ==========\n    fashion_guru: {\n        title: \"ã€æ—¶å°šè¾¾äººã€‘\",\n        description: \"å½“å‰ç©¿æˆ´çš„è£…å¤‡ï¼ˆæ‰€æœ‰éƒ¨ä½åˆè®¡ï¼‰æ€»æ•°è¾¾åˆ°10ä»¶ã€‚\",\n        icon: \"ğŸ‘•\",\n        unlocked: false, unlocked_at: null, reward_claimed: false,\n        reward: \"ç§°å·ã€Œåƒé¢ä¹‹äººã€\",\n        flavor_text: \"å¼ºåº¦æ˜¯ä¸€æ—¶çš„ï¼Œå¸…æ˜¯ä¸€è¾ˆå­çš„ã€‚\"\n    },\n    collector: {\n        title: \"ã€æ”¶è—å®¶ã€‘\",\n        description: \"èƒŒåŒ…ä¸­çš„ç‰©å“ç§ç±»è¾¾åˆ°50ç§ã€‚\",\n        icon: \"ğŸ“¦\",\n        unlocked: false, unlocked_at: null, reward_claimed: false,\n        reward: \"ç§°å·ã€Œæ¬¡å…ƒä»“é¼ ã€\",\n        flavor_text: \"â€œè¿™ä¸ªä¹Ÿè®¸ä»¥åç”¨å¾—ä¸Šã€‚â€\"\n    },\n    animal_friend: {\n        title: \"ã€åŠ¨ç‰©ä¹‹å‹ã€‘\",\n        description: \"åŠ¨ç‰©æ²Ÿé€šæŠ€èƒ½è¾¾åˆ°5ç‚¹ã€‚\",\n        icon: \"ğŸ¾\",\n        unlocked: false, unlocked_at: null, reward_claimed: false,\n        reward: \"ç§°å·ã€Œè¿ªå£«å°¼åœ¨é€ƒå…¬ä¸»/ç‹å­ã€\",\n        flavor_text: \"å°é¸Ÿä¼šä¸ºä½ å”±æ­Œï¼Œæ¾é¼ ä¼šå¸®ä½ æ¢³å¤´ã€‚\"\n    },\n    master_chef: {\n        title: \"ã€ä¸­åå°å½“å®¶ã€‘\",\n        description: \"æ‰‹è‰ºæŠ€èƒ½è¾¾åˆ°5ç‚¹ã€‚\",\n        icon: \"ğŸ³\",\n        unlocked: false, unlocked_at: null, reward_claimed: false,\n        reward: \"ç§°å·ã€Œæ–™ç†ä¹‹ç¥ã€\",\n        flavor_text: \"ä½ çš„é”…é‡Œä¼šå‘å…‰å—ï¼Ÿ\"\n    },\n    hacker: {\n        title: \"ã€éª‡å®¢ã€‘\",\n        description: \"ç”µè„‘æŠ€èƒ½è¾¾åˆ°5ç‚¹ã€‚\",\n        icon: \"ğŸ’»\",\n        unlocked: false, unlocked_at: null, reward_claimed: false,\n        reward: \"ç§°å·ã€Œæ•°æ®å¹½çµã€\",\n        flavor_text: \"â€œæˆ‘è¿›æ¥äº†ã€‚â€\"\n    },\n\n \n    medic: {\n        title: \"ã€æˆ˜åœ°åº¸åŒ»ã€‘\",\n        description: \"åŒ»å­¦æŠ€èƒ½è¾¾åˆ°5ç‚¹ã€‚\",\n        icon: \"ğŸ©º\",\n        unlocked: false, unlocked_at: null, reward_claimed: false,\n        reward: \"ç§°å·ã€Œç™½è¡£å¤©ä½¿/æ¶é­”ã€\",\n        flavor_text: \"â€œåˆ«æ‹…å¿ƒï¼Œæˆ‘å¯æ˜¯ä¸“ä¸šçš„...è‡³å°‘ä¹¦ä¸Šæ˜¯è¿™ä¹ˆå†™çš„ã€‚â€\"\n    },\n    liar_liar: {\n        title: \"ã€è°è¨€å¤§å¸ˆã€‘\",\n        description: \"æ©é¥°æŠ€èƒ½è¾¾åˆ°5ç‚¹ã€‚\",\n        icon: \"ğŸ¤¥\",\n        unlocked: false, unlocked_at: null, reward_claimed: false,\n        reward: \"ç§°å·ã€Œåƒè°ç™¾è®¡ã€\",\n        flavor_text: \"çœŸå®æ˜¯ä»€ä¹ˆï¼ŸçœŸå®å°±æ˜¯ä»–ä»¬æ„¿æ„ç›¸ä¿¡çš„ä¸œè¥¿ã€‚\"\n    },\n    get_a_car: {\n        title: \"ã€æœ‰è½¦ä¸€æ—ã€‘\",\n        description: \"é©¾é©¶æŠ€èƒ½è¾¾åˆ°5ç‚¹ã€‚\",\n        icon: \"ğŸš—\",\n        unlocked: false, unlocked_at: null, reward_claimed: false,\n        reward: \"ç§°å·ã€Œè€å¸æœºã€\",\n        flavor_text: \"â€œä¹˜å®¢æ‚¨å¥½ï¼Œè¯·ç³»å¥½å®‰å…¨å¸¦ï¼Œä¸‹ä¸€ç«™ï¼Œåœ°ç‹±æˆ–å¤©å ‚ã€‚â€\"\n    },\n    team_player: {\n        title: \"ã€å›¢é˜Ÿåˆä½œã€‘\",\n        description: \"å°é˜Ÿä¸­æ‹¥æœ‰è‡³å°‘ä¸€åé˜Ÿå‹ã€‚\",\n        icon: \"ğŸ¤\",\n        unlocked: false, unlocked_at: null, reward_claimed: false,\n        reward: \"ç§°å·ã€Œå¯é çš„ä¼™ä¼´ã€\",\n        flavor_text: \"ä¸€ä¸ªäººçš„æ—…é€”æ˜¯å†’é™©ï¼Œä¸¤ä¸ªäººçš„æ—…é€”æ˜¯æ•…äº‹ã€‚\"\n    },\n    lone_wolf: {\n        title: \"ã€å­¤ç‹¼ã€‘\",\n        description: \"åœ¨å®Œæˆ10ä¸ªä»»åŠ¡åï¼Œå°é˜Ÿä¸­ä¾ç„¶åªæœ‰è‡ªå·±ä¸€äººã€‚\",\n        icon: \"ğŸº\",\n        unlocked: false, unlocked_at: null, reward_claimed: false,\n        reward: \"ç§°å·ã€Œç‹¬è¡Œä¾ ã€\",\n        flavor_text: \"æˆ‘çš„èƒŒåï¼Œåªæœ‰æˆ‘çš„å½±å­ã€‚\"\n    },\n    occultist: {\n        title: \"ã€ç¥ç§˜å­¦å®¶ã€‘\",\n        description: \"ç¥ç§˜å­¦æŠ€èƒ½è¾¾åˆ°5ç‚¹ã€‚\",\n        icon: \"ğŸ”®\",\n        unlocked: false, unlocked_at: null, reward_claimed: false,\n        reward: \"ç§°å·ã€Œç¦å¿ŒçŸ¥è¯†æ¢æ±‚è€…ã€\",\n        flavor_text: \"å½“ä½ äº†è§£å¾—è¶Šå¤šï¼Œå°±è¶Šå‘ç°è‡ªå·±çš„æ— çŸ¥...å’Œå±é™©ã€‚\"\n    },\n    // ========== æŠ•éª°æ£€å®š (æ–°å¢) ==========\ncritical_success_roll: {\n    title: \"ã€å¤©å‘½æ‰€å½’ã€‘\",\n    description: \"åœ¨ä»»æ„D10éª°æ± æ£€å®šä¸­ï¼Œå•é¢—éª°å­æŠ•å‡º10å¹¶ä¸”è§¦å‘äº†å¥–åŠ±éª°ã€‚\",\n    icon: \"ğŸ²\",\n    unlocked: false, unlocked_at: null, reward_claimed: false,\n    reward: \"ç§°å·ã€Œå¹¸è¿æ˜Ÿã€\",\n    flavor_text: \"é‚£ä¸€åˆ»ï¼Œå‘½è¿å¯¹ä½ éœ²å‡ºäº†å¾®ç¬‘ã€‚\"\n},\ndramatic_failure_roll: {\n    title: \"ã€æˆå‰§æ€§å¤§å¤±è´¥ã€‘\",\n    description: \"åœ¨ä»»æ„æ£€å®šä¸­è§¦å‘â€˜å¤§å¤±è´¥â€™ï¼ˆæŠ•å‡º1ä¸”æ²¡æœ‰ä»»ä½•æˆåŠŸæ•°ï¼‰ã€‚\",\n    icon: \"ğŸ¤¡\",\n    unlocked: false, unlocked_at: null, reward_claimed: false,\n    reward: \"ç§°å·ã€ŒèŠ‚ç›®æ•ˆæœå¤§å¸ˆã€\",\n    flavor_text: \"â€œæˆ‘ä¸æ˜¯æ•…æ„çš„ï¼Œä½†æ•ˆæœæ‹”ç¾¤ã€‚â€\"\n},\nsnake_eyes: {\n    title: \"ã€è›‡çœ¼ã€‘\",\n    description: \"åœ¨D10éª°æ± æ£€å®šä¸­ï¼ŒæŠ•å‡ºè‡³å°‘ä¸¤ä¸ª1ã€‚\",\n    icon: \"ğŸ\",\n    unlocked: false, unlocked_at: null, reward_claimed: false,\n    reward: \"ç§°å·ã€ŒåŒé‡ä¸å¹¸ã€\",\n    flavor_text: \"æœ‰æ—¶å€™ï¼Œåè¿æ°”ä¹Ÿä¼šæˆåŒæˆå¯¹åœ°æ¥æ•²é—¨ã€‚\"\n},\nfull_house_success: {\n    title: \"ã€æ»¡å ‚å½©ã€‘\",\n    description: \"åœ¨D10éª°æ± æ£€å®šä¸­ï¼Œæ‰€æœ‰éª°å­çš„ç»“æœéƒ½å¤§äºç­‰äº7ï¼ˆå…¨éƒ¨æˆåŠŸï¼‰ã€‚\",\n    icon: \"ğŸŒŸ\",\n    unlocked: false, unlocked_at: null, reward_claimed: false,\n    reward: \"ç§°å·ã€Œå®Œç¾æ‰§è¡Œè€…ã€\",\n    flavor_text: \"æ²¡æœ‰ä¸€ä¸å¤šä½™çš„åŠ¨ä½œï¼Œæ¯ä¸€æ­¥éƒ½ç²¾å‡†æ— è¯¯ã€‚\"\n},\nchance_win: {\n    title: \"ã€å¥‡è¿¹ä¸€æ·ã€‘\",\n    description: \"åœ¨æœºä¼šéª°ï¼ˆ0éª°æ± ï¼‰æ£€å®šä¸­æˆåŠŸï¼ˆæŠ•å‡º10ï¼‰ã€‚\",\n    icon: \"ğŸ™\",\n    unlocked: false, unlocked_at: null, reward_claimed: false,\n    reward: \"ç§°å·ã€Œå¤©é€‰ä¹‹äººã€\",\n    flavor_text: \"å½“æ‰€æœ‰äººéƒ½æ”¾å¼ƒæ—¶ï¼Œä½ æŠ“ä½äº†é‚£ç™¾åˆ†ä¹‹åçš„å¯èƒ½ã€‚\"\n},\nten_dice_pool: {\n    title: \"ã€éª°å­æ´ªæµã€‘\",\n    description: \"è¿›è¡Œä¸€æ¬¡æ€»éª°æ± è¶…è¿‡10ä¸ªD10çš„æ£€å®šã€‚\",\n    icon: \"ğŸŒŠ\",\n    unlocked: false, unlocked_at: null, reward_claimed: false,\n    reward: \"ç§°å·ã€Œæ¦‚ç‡çš„æ”¯é…è€…ã€\",\n    flavor_text: \"ä½ æ‰”å‡ºå»çš„ä¸æ˜¯éª°å­ï¼Œæ˜¯å‘½è¿çš„æ´ªæµã€‚\"\n},\ntwenty_dice_pool: {\n    title: \"ã€éª°å­é£æš´ã€‘\",\n    description: \"è¿›è¡Œä¸€æ¬¡æ€»éª°æ± è¶…è¿‡20ä¸ªD10çš„æ£€å®šã€‚\",\n    icon: \"ğŸŒªï¸\",\n    unlocked: false, unlocked_at: null, reward_claimed: false,\n    reward: \"ç§°å·ã€Œå› æœå¾‹æ­¦å™¨ã€\",\n    flavor_text: \"åœ¨ç»å¯¹çš„æ•°é‡é¢å‰ï¼Œä¸€åˆ‡éšæœºæ€§éƒ½è¶‹äºå¿…ç„¶ã€‚\"\n},\nperformance_perfect: {\n    title: \"ã€èˆå°ä¹‹ç‹ã€‘\",\n    description: \"åœ¨è¡¨ç°åˆ¤å®šä¸­ï¼ŒD20æŠ•å‡º20ï¼Œè¾¾æˆâ€˜å®Œç¾è¡¨ç°â€™ã€‚\",\n    icon: \"ğŸ‘‘\",\n    unlocked: false, unlocked_at: null, reward_claimed: false,\n    reward: \"ç§°å·ã€Œèšå…‰ç¯ä¸‹çš„å® å„¿ã€\",\n    flavor_text: \"ä¸–ç•Œä¸ºä½ çš„è¡¨æ¼”è€Œé™é»˜ï¼Œç„¶åçˆ†å‘å‡ºé›·é¸£èˆ¬çš„æŒå£°ã€‚\"\n},\nperformance_fail: {\n    title: \"ã€ç¬¨æ‹™çš„å·¨äººã€‘\",\n    description: \"åœ¨è¡¨ç°åˆ¤å®šä¸­ï¼ŒD20æŠ•å‡º1ï¼Œè¾¾æˆâ€˜è¡¨ç°ç³Ÿç³•â€™ã€‚\",\n    icon: \"ğŸ˜\",\n    unlocked: false, unlocked_at: null, reward_claimed: false,\n    reward: \"ç§°å·ã€Œå¹³åœ°æ‘”è·¤å† å†›ã€\",\n    flavor_text: \"â€œæˆ‘å‘èª“ï¼Œé‚£å—åœ°ç –å…ˆåŠ¨çš„æ‰‹ï¼â€\"\n},\nsuccess_by_one: {\n    title: \"ã€æ¯«å˜ä¹‹å·®ã€‘\",\n    description: \"æœ€ç»ˆæˆåŠŸæ•°æ°å¥½ç­‰äºâ€˜å®Œå…¨æˆåŠŸâ€™ã€‚\",\n    icon: \"ğŸ¤\",\n    unlocked: false, unlocked_at: null, reward_claimed: false,\n    reward: \"ç§°å·ã€Œç²¾å‡†å¡çº¿å¤§å¸ˆã€\",\n    flavor_text: \"å¤šä¸€åˆ†æµªè´¹ï¼Œå°‘ä¸€åˆ†å¤±è´¥ï¼Œè¿™ï¼Œå°±æ˜¯æ°åˆ°å¥½å¤„çš„è‰ºæœ¯ã€‚\"\n},\nlegendary_save: {\n    title: \"ã€ä¼ å¥‡ä¹‹åŠ©ã€‘\",\n    description: \"ä¸€æ¬¡æ£€å®šä¸­ï¼Œå› ä¼ å¥‡åŠ æˆè€Œä½¿0æˆåŠŸæ•°å˜ä¸ºæ­£æˆåŠŸæ•°ã€‚\",\n    icon: \"ğŸ›¡ï¸\",\n    unlocked: false, unlocked_at: null, reward_claimed: false,\n    reward: \"ç§°å·ã€Œè¢«ä¼ å¥‡æ‰€çœ·é¡¾ã€\",\n    flavor_text: \"åœ¨å¤±è´¥çš„è¾¹ç¼˜ï¼Œä½ çš„ä¼ å¥‡ä¹‹åŠ›å°†ä½ æ‹‰äº†å›æ¥ã€‚\"\n},\nequipment_mvp: {\n    title: \"ã€ç¥å…µåˆ©å™¨ã€‘\",\n    description: \"ä¸€æ¬¡æ£€å®šä¸­ï¼Œè£…å¤‡æä¾›çš„åŠ æˆè¶…è¿‡äº†å±æ€§/æŠ€èƒ½æœ¬èº«çš„ç‚¹æ•°ã€‚\",\n    icon: \"ğŸ› ï¸\",\n    unlocked: false, unlocked_at: null, reward_claimed: false,\n    reward: \"ç§°å·ã€Œäººé è¡£è£…ã€\",\n    flavor_text: \"æŠ€æœ¯ä¸å¤Ÿï¼Œè£…å¤‡æ¥å‡‘ã€‚äº‹å®è¯æ˜ï¼Œå®ƒçœŸçš„å¾ˆå‡‘æ•ˆã€‚\"\n},\nteamwork_victory: {\n    title: \"ã€ä¼—å¿—æˆåŸã€‘\",\n    description: \"åœ¨ä¸€æ¬¡æ£€å®šä¸­ï¼Œæ¥è‡ªé˜Ÿå‹çš„ååŠ©éª°æ± è¶…è¿‡äº†ä½ è‡ªèº«çš„åŸºç¡€éª°æ± ã€‚\",\n    icon: \"ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦\",\n    unlocked: false, unlocked_at: null, reward_claimed: false,\n    reward: \"ç§°å·ã€Œå›¢é˜Ÿæ ¸å¿ƒï¼ˆè¢«åŠ¨ï¼‰ã€\",\n    flavor_text: \"â€œæˆ‘å®£å¸ƒï¼Œè¿™æ¬¡çš„MVPæ˜¯æˆ‘çš„é˜Ÿå‹ä»¬ï¼â€\"\n},\nprestige_power: {\n    title: \"ã€å£°åè¿œæ‰¬ã€‘\",\n    description: \"å£°æœ›åŠ æƒä¸ºä½ çš„ä¸€æ¬¡æ£€å®šæä¾›äº†è‡³å°‘2ç‚¹DPåŠ æˆã€‚\",\n    icon: \"ğŸ—£ï¸\",\n    unlocked: false, unlocked_at: null, reward_claimed: false,\n    reward: \"ç§°å·ã€Œè¡Œèµ°çš„ä¼ è¯´ã€\",\n    flavor_text: \"ä½ çš„åå­—ï¼Œæœ¬èº«å°±æ˜¯ä¸€ç§åŠ›é‡ã€‚\"\n},\nagainst_all_odds: {\n    title: \"ã€ä»¥å¼±èƒœå¼ºã€‘\",\n    description: \"åœ¨ä¸€æ¬¡å¯¹æŠ—æ£€å®šä¸­ï¼Œä»¥å°‘äºæ•Œæ–¹ä¸€åŠçš„éª°æ± æ•°è·å¾—èƒœåˆ©ï¼ˆå‡€æˆåŠŸæ•°å¤§äº0ï¼‰ã€‚\",\n    icon: \" David's Star\",\n    unlocked: false, unlocked_at: null, reward_claimed: false,\n    reward: \"ç§°å·ã€Œå¤§å«ç‹ã€\",\n    flavor_text: \"å·¨äººä¼šå€’ä¸‹ï¼Œåªè¦ä½ æ‰¾å‡†ä»–çš„å¼±ç‚¹ã€‚\"\n},\noverkill: {\n    title: \"ã€è¿‡è½½æ‰“å‡»ã€‘\",\n    description: \"åœ¨ä¸€æ¬¡å¯¹æŠ—æ£€å®šä¸­ï¼Œä½ çš„å‡€æˆåŠŸæ•°è¶…è¿‡10ä¸ªã€‚\",\n    icon: \"ğŸ’¥\",\n    unlocked: false, unlocked_at: null, reward_claimed: false,\n    reward: \"ç§°å·ã€Œç”¨åŠ›è¿‡çŒ›ã€\",\n    flavor_text: \"ä½ åªæ˜¯æƒ³æ‰“è´¥ä»–ï¼Œæ²¡æƒ³æŠŠä»–ä»ä¸–ç•Œä¸ŠæŠ¹é™¤ã€‚\"\n},\nzero_to_hero: {\n    title: \"ã€ä»é›¶åˆ°è‹±é›„ã€‘\",\n    description: \"ä½¿ç”¨ä¸€ä¸ªåŸºç¡€ç‚¹æ•°ä¸º0çš„æŠ€èƒ½è¿›è¡Œæ£€å®šï¼Œå¹¶è·å¾—â€˜å®Œå…¨æˆåŠŸâ€™æˆ–ä»¥ä¸Šçš„ç»“æœã€‚\",\n    icon: \"ğŸ“ˆ\",\n    unlocked: false, unlocked_at: null, reward_claimed: false,\n    reward: \"ç§°å·ã€Œç°å­¦ç°å–çš„å¤©æ‰ã€\",\n    flavor_text: \"â€œä½ é—®æˆ‘æ€ä¹ˆä¼šçš„ï¼Ÿå°±â€¦æ„Ÿè§‰æ¥äº†ã€‚â€\"\n},\ndouble_ten: {\n    title: \"ã€åŒå€å¿«ä¹ã€‘\",\n    description: \"åœ¨ä¸€æ¬¡æ£€å®šä¸­ï¼ŒæŠ•å‡ºäº†è‡³å°‘ä¸¤ä¸ª10ã€‚\",\n    icon: \"ğŸ”ŸğŸ”Ÿ\",\n    unlocked: false, unlocked_at: null, reward_claimed: false,\n    reward: \"ç§°å·ã€Œæ¬§çš‡ã€\",\n    flavor_text: \"ä¸€æ¬¡æ˜¯å¹¸è¿ï¼Œä¸¤æ¬¡å°±æ˜¯å®åŠ›äº†ï¼ˆç¡®ä¿¡ï¼‰ã€‚\"\n},\nonly_roll_one_dice: {\n    title: \"ã€ä¸€å‘å…¥é­‚ã€‘\",\n    description: \"åœ¨åªæœ‰1ä¸ªD10çš„éª°æ± ä¸­æ£€å®šæˆåŠŸã€‚\",\n    icon: \"ğŸ¯\",\n    unlocked: false, unlocked_at: null, reward_claimed: false,\n    reward: \"ç§°å·ã€Œç²¾å‡†å°„æ‰‹ã€\",\n    flavor_text: \"æˆ‘åªéœ€è¦ä¸€æ¬¡æœºä¼šã€‚è¶³çŸ£ã€‚\"\n},\nall_in: {\n    title: \"ã€å­¤æ³¨ä¸€æ·ã€‘\",\n    description: \"ä½¿ç”¨è¶…è¿‡50%çš„å½“å‰æ„å¿—åŠ›æˆ–ç”Ÿå‘½å€¼ä½œä¸ºæ£€å®šåŠ æˆï¼Œå¹¶æˆåŠŸã€‚\",\n    icon: \"ğŸ’”\",\n    unlocked: false, unlocked_at: null, reward_claimed: false,\n    reward: \"ç§°å·ã€ŒèµŒå¾’ã€\",\n    flavor_text: \"è¦ä¹ˆæ‹¥æœ‰ä¸€åˆ‡ï¼Œè¦ä¹ˆä¸€æ— æ‰€æœ‰ã€‚æ²¡æœ‰ä¸­é—´é€‰é¡¹ã€‚\"\n}\n\n  },\n  tracked_stats: {\n      totalPointsAllocated: 0,\n      charCreationStartTime: null, // æ–°å¢ï¼šç”¨äºè¿½è¸ªè§’è‰²åˆ›å»ºæ—¶é—´\n      backpackItemCount: 0, // æ–°å¢ï¼šç”¨äºè¿½è¸ªèƒŒåŒ…ç‰©å“ç§ç±»æ•°\n  },\n  current_page: 0\n};\n    \n    achievementData = JSON.parse(localStorage.getItem('achievements_data'));\n\n  // å¦‚æœå®ç®±æ˜¯ç©ºçš„ï¼Œæˆ‘ä»¬å°±ç”¨è“å›¾ç»™ä½ ä¸€ä¸ªæ–°çš„\n  if (!achievementData || !achievementData.achievements) {\n    achievementData = initialAchievementData;\n    localStorage.setItem('achievements_data', JSON.stringify(achievementData));\n  } else {\n    // å¦ˆå¦ˆå…ˆæ¥æ•°ä¸€ä¸‹â€œè“å›¾â€å’Œä½ çš„â€œå®ç®±â€é‡Œå„æœ‰å¤šå°‘å®è´\n    const blueprintCount = Object.keys(initialAchievementData.achievements).length;\n    const localCount = Object.keys(achievementData.achievements).length;\n\n    // åªæœ‰å½“â€œè“å›¾â€é‡Œçš„å®è´æ¯”ä½ çš„â€œå®ç®±â€å¤šæ—¶ï¼Œæˆ‘ä»¬æ‰éœ€è¦æ£€æŸ¥æ›´æ–°\n    if (blueprintCount > localCount) {\n      let updated = false;\n      const blueprintAchievements = initialAchievementData.achievements;\n\n      // éå†è“å›¾é‡Œçš„æ¯ä¸€ä¸ªæˆå°±\n      for (const achievementId in blueprintAchievements) {\n        // å¦‚æœä½ çš„å®ç®±é‡Œæ²¡æœ‰è¿™ä¸ªæˆå°±\n        if (!achievementData.achievements[achievementId]) {\n          // å¦ˆå¦ˆå°±æŠŠè¿™ä¸ªæ–°æˆå°±æ”¾è¿›ä½ çš„å®ç®±é‡Œ\n          achievementData.achievements[achievementId] = blueprintAchievements[achievementId];\n          updated = true; // åšå¥½æ ‡è®°ï¼Œæˆ‘ä»¬æ›´æ–°è¿‡å®ç®±äº†\n          console.log(`æˆå°±æ›´æ–°ï¼šå·²æ·»åŠ æ–°æˆå°±â€œ${blueprintAchievements[achievementId].title}â€ï¼`);\n        }\n      }\n\n      // å¦‚æœæˆ‘ä»¬çœŸçš„å¾€å®ç®±é‡Œæ”¾äº†æ–°ä¸œè¥¿ï¼Œå°±é‡æ–°ä¿å­˜ä¸€ä¸‹\n      if (updated) {\n        localStorage.setItem('achievements_data', JSON.stringify(achievementData));\n      }\n    }\n  }\n const achievementTriggers = {\n    //\n    // äº‹ä»¶ç±»å‹: 'points_allocated' - åœ¨åˆ›å»ºè§’è‰²åˆ†é…ç‚¹æ•°æ—¶è§¦å‘\n    // value: { remaining: number, total: number }\n    //\n    points_allocated: {\n        points_master: (val) => val.total > 199,\n        points_ascetic: (val) => val.total < 1,\n        careful_planner: (val) => val.remaining === 0,\n        newbie_explorer: (val) => val.remaining >0, // åªè¦è°ƒç”¨æ­¤äº‹ä»¶å°±è§£é”\n    },\n\n    //\n    // äº‹ä»¶ç±»å‹: 'init_complete' - è§’è‰²åˆ›å»ºå®Œæˆï¼Œç¬¬ä¸€æ¬¡è¿›å…¥æ¸¸æˆæ—¶è§¦å‘\n    // value: { creationTime: number } (æ¯«ç§’)\n    //\n \n\n    //\n    // äº‹ä»¶ç±»å‹: 'data_refresh' - æ¯æ¬¡åˆ·æ–°é¢æ¿æ—¶è§¦å‘ï¼Œè¿™æ˜¯æœ€ä¸»è¦çš„æ£€æŸ¥ç‚¹\n    // value: { currentGameData, playCharacterData, assaSettingsData }\n    //\n    data_refresh: {\n         // ========== æ‚é¡¹ä¸å½©è›‹ ==========\n        animal_friend: (val) => val.playCharacterData.æŠ€èƒ½æ®µ.äº’åŠ¨æŠ€èƒ½.åŠ¨ç‰©æ²Ÿé€š[0] >= 5,\n        master_chef: (val) => val.playCharacterData.æŠ€èƒ½æ®µ.å¿ƒæ™ºæŠ€èƒ½.æ‰‹è‰º[0] >= 5,  \n        hacker: (val) => val.playCharacterData.æŠ€èƒ½æ®µ.å¿ƒæ™ºæŠ€èƒ½.ç”µè„‘[0] >= 5,\n        medic: (val) => val.playCharacterData.æŠ€èƒ½æ®µ.å¿ƒæ™ºæŠ€èƒ½.åŒ»å­¦[0] >= 5,\n        liar_liar: (val) => val.playCharacterData.æŠ€èƒ½æ®µ.äº’åŠ¨æŠ€èƒ½.æ©é¥°[0] >= 5,\n        get_a_car: (val) => val.playCharacterData.æŠ€èƒ½æ®µ.ç”Ÿç†æŠ€èƒ½.é©¾é©¶[0] >= 5,\n        occultist: (val) => val.playCharacterData.æŠ€èƒ½æ®µ.å¿ƒæ™ºæŠ€èƒ½.ç¥ç§˜å­¦[0] >= 5,\n        team_player: (val) => val.assaSettingsData.global_lore && val.assaSettingsData.global_lore.å°é˜Ÿä¿¡æ¯ && Object.keys(val.assaSettingsData.global_lore.å°é˜Ÿä¿¡æ¯).length > 0,\n        lone_wolf: (val) =>  val.currentGameData.user_character.total_task[0]  >= 10 && (!val.assaSettingsData.global_lore || !val.assaSettingsData.global_lore.å°é˜Ÿä¿¡æ¯ || Object.keys(val.assaSettingsData.global_lore.å°é˜Ÿä¿¡æ¯).length < 1),\n \n        // ========== ç”Ÿæ­»ä¸çŠ¶æ€ ==========\n         first_death: (val) => (val.playCharacterData?.è¡ç”Ÿå±æ€§æ®µ?.ç”Ÿå‘½å€¼?.å½“å‰å€¼?.[0] ?? 1) <= 0,\n        near_death_experience: (val) => (val.playCharacterData?.è¡ç”Ÿå±æ€§æ®µ?.ç”Ÿå‘½å€¼?.å½“å‰å€¼?.[0]) === 1,\n          glass_cannon: (val) => {\n            const maxHp = val.playCharacterData?.è¡ç”Ÿå±æ€§æ®µ?.ç”Ÿå‘½å€¼?.ä¸Šé™?.[0];\n            return typeof maxHp === 'number' && maxHp < 20;\n        },\n        human_tank: (val) => {\n            const maxHp = val.playCharacterData?.è¡ç”Ÿå±æ€§æ®µ?.ç”Ÿå‘½å€¼?.ä¸Šé™?.[0];\n            return typeof maxHp === 'number' && maxHp > 200;\n        },\n\n        // ========== å±æ€§ä¸æŠ€èƒ½æˆé•¿ ==========\n        legendary_physique: (val) => [\"åŠ›é‡\", \"æ•æ·\", \"è€åŠ›\"].some(attr => val.playCharacterData.å±æ€§æ®µ.ç”Ÿç†å±æ€§[attr].åŸºç¡€[0] >= 8),\n        legendary_mind: (val) => [\"æ™ºåŠ›\", \"æ„ŸçŸ¥\", \"å†³å¿ƒ\"].some(attr => val.playCharacterData.å±æ€§æ®µ.å¿ƒæ™ºå±æ€§[attr].åŸºç¡€[0] >= 8),\n        legendary_presence: (val) => [\"é£åº¦\", \"æ“æ§\", \"æ²‰ç€\"].some(attr => val.playCharacterData.å±æ€§æ®µ.äº’åŠ¨å±æ€§[attr].åŸºç¡€[0] >= 8),\n        master_of_one: (val) => {\n            for (const category of Object.values(val.playCharacterData.æŠ€èƒ½æ®µ)) {\n                for (const skill of Object.values(category)) {\n                    if (skill[0] >= 8) return true;\n                }\n            }\n            return false;\n        },\n        jack_of_all_trades: (val) => {\n            let count = 0;\n            for (const category of Object.values(val.playCharacterData.æŠ€èƒ½æ®µ)) {\n                for (const skill of Object.values(category)) {\n                    if (skill[0] > 0) count++;\n                }\n            }\n            return count > 20;\n        },\n        specialist: (val) => {\n            const sums = {\n                phys: Object.values(val.playCharacterData.æŠ€èƒ½æ®µ.ç”Ÿç†æŠ€èƒ½).reduce((acc, s) => acc + s[0], 0),\n                mental: Object.values(val.playCharacterData.æŠ€èƒ½æ®µ.å¿ƒæ™ºæŠ€èƒ½).reduce((acc, s) => acc + s[0], 0),\n                social: Object.values(val.playCharacterData.æŠ€èƒ½æ®µ.äº’åŠ¨æŠ€èƒ½).reduce((acc, s) => acc + s[0], 0)\n            };\n            return sums.phys > (sums.mental + sums.social) ||\n                   sums.mental > (sums.phys + sums.social) ||\n                   sums.social > (sums.phys + sums.mental);\n        },\n\n        // ========== ä»»åŠ¡ä¸å£°æœ› ==========\n        first_mission: (val) => val.currentGameData.user_character.total_task[0] >= 1,\n        ten_missions: (val) => val.currentGameData.user_character.total_task[0] >= 10,\n        hundred_missions: (val) => val.currentGameData.user_character.total_task[0] >= 100,\n        speed_runner: (val) => {\n            // å¦ˆå¦ˆä¿®æ­£äº†è¿™é‡Œçš„é€»è¾‘ï¼Œéœ€è¦åˆ¤æ–­ä»»åŠ¡å·²å®Œæˆä¸”æœ‰å¼€å§‹æ—¥æœŸ\n            if (val.currentGameData.user_character.total_task[0] >= 1 && val.currentGameData.world_shard.task.start_date[0]) {\n                 // ç®€å•çš„æ—¥æœŸè®¡ç®—ï¼Œå‡è®¾mmæœˆddæ—¥çš„æ ¼å¼\n                 const startTime = new Date(`2024/${val.currentGameData.world_shard.task.start_date[0].replace('æœˆ', '/').replace('æ—¥', '')}`);\n                 const endTime = new Date(`2024/${val.currentGameData.æ—¥æœŸ[0].replace('æœˆ', '/').replace('æ—¥', '')}`);\n                 // ä»…åœ¨æ¼”ç¤ºç”¨ï¼ŒçœŸå®æ—¶é—´å·®è®¡ç®—éœ€è¦æ›´ç²¾ç¡®çš„æ—¥æœŸæ—¶é—´æˆ³\n                 return (endTime - startTime) / (1000 * 3600) < 1;\n            }\n            return false;\n        },\n        world_savior: (val) => val.currentGameData.user_character.Cross_world_prestige[0] >= 10,\n        world_enemy: (val) => val.currentGameData.user_character.Cross_world_prestige[0] <= -10,\n\n        // ========== è´¢å¯Œä¸æ”¶é›† ==========\n        first_home: (val) => val.assaSettingsData.home && val.assaSettingsData.home.items && Object.keys(val.assaSettingsData.home.items).length >= 1,\n        cozy_home: (val) => val.assaSettingsData.home && val.assaSettingsData.home.items && Object.keys(val.assaSettingsData.home.items).length >= 10,\n        luxury_manor: (val) => val.assaSettingsData.home && val.assaSettingsData.home.items && Object.keys(val.assaSettingsData.home.items).length >= 50,\n        rich_man: (val) => val.playCharacterData.è´§å¸æ®µ.ç§¯åˆ†[0] >= 10000,\n        super_rich: (val) => val.playCharacterData.è´§å¸æ®µ.ç§¯åˆ†[0] >= 100000,\n        s_rank_hoarder: (val) => val.playCharacterData.è´§å¸æ®µ.æ”¯çº¿å‰§æƒ….S[0] >= 1,\n        collector: (val) => val.assaSettingsData.global_lore && val.assaSettingsData.global_lore.èƒŒåŒ… && Object.keys(val.assaSettingsData.global_lore.èƒŒåŒ…).length >= 50,\n\n        // ========== å±æœºä¸æŒ‘æˆ˜ ==========\n        trivial_threat: (val) => val.currentGameData.æ£€å®šéš¾åº¦[0] > 3,\n        serious_challenge: (val) => val.currentGameData.æ£€å®šéš¾åº¦[0] > 7,\n        gods_game: (val) => val.currentGameData.æ£€å®šéš¾åº¦[0] > 12,\n        cosmic_horror: (val) => val.currentGameData.æ£€å®šéš¾åº¦[0] > 15,\n\n        // ========== èƒ½é‡ä¸èƒ½åŠ› ==========\n               energy_awakening: (val) => (val.playCharacterData?.è¡ç”Ÿå±æ€§æ®µ?.èƒ½é‡æ± ?.ä¸Šé™?.[0] ?? 0) > 0,\n        energy_pool_100: (val) => (val.playCharacterData?.è¡ç”Ÿå±æ€§æ®µ?.èƒ½é‡æ± ?.ä¸Šé™?.[0] ?? 0) >= 100,\n        energy_pool_1000: (val) => (val.playCharacterData?.è¡ç”Ÿå±æ€§æ®µ?.èƒ½é‡æ± ?.ä¸Šé™?.[0] ?? 0) >= 1000,\n     \n        first_ability: (val) => val.playCharacterData.èƒ½åŠ›æ®µ.åç§°[0] && val.playCharacterData.èƒ½åŠ›æ®µ.åç§°[0] !== \"\" && val.playCharacterData.èƒ½åŠ›æ®µ.åç§°[0] !== \"æ— \",\n\n         // ========== è£…å¤‡ä¸ç‰©å“ ==========\n        first_weapon: (val) => val.currentGameData.user_character.å½“å‰è£…å¤‡.æ‰‹æŒ[0] !== \"æ— \",\n        fully_equipped: (val) => {\n            const gear = val.currentGameData.user_character.å½“å‰è£…å¤‡.ç©¿æˆ´;\n            return gear.å¤´éƒ¨[0] !== \"æ— \" && gear.èº«ä½“[0] !== \"æ— \" && gear.æ‰‹éƒ¨[0] !== \"æ— \" && gear.è„šéƒ¨[0] !== \"æ— \";\n        },\n        fashion_guru: (val) => {\n      // å…ˆç¡®ä¿æ•°æ®è·¯å¾„å®‰å…¨ï¼Œè¿™æ˜¯å¦ˆå¦ˆçš„çˆ±å¿ƒä¿æŠ¤å“¦\n      if (!val.currentGameData?.user_character?.å½“å‰è£…å¤‡?.ç©¿æˆ´) {\n        return false;\n      }\n\n      // 1. æ‹¿åˆ°ä½ æ‰€æœ‰çš„ç©¿æˆ´æ§½ä½\n      const gearSlots = val.currentGameData.user_character.å½“å‰è£…å¤‡.ç©¿æˆ´;\n\n      // 2. æŠŠæ¯ä¸ªæ§½ä½é‡Œçš„è£…å¤‡å­—ç¬¦ä¸²ï¼ˆå¯èƒ½åŒ…å«åˆ†å·ï¼‰éƒ½æ‹¿å‡ºæ¥ï¼Œæ”¾è¿›ä¸€ä¸ªåˆ—è¡¨é‡Œ\n      const allGearStrings = [\n        gearSlots.å¤´éƒ¨[0],\n        gearSlots.èº«ä½“[0],\n        gearSlots.æ‰‹éƒ¨[0],\n        gearSlots.è„šéƒ¨[0],\n        gearSlots.é¥°å“[0]\n      ];\n\n      let totalItemCount = 0;\n\n      // 3. æŒ¨ä¸ªæ£€æŸ¥è¿™äº›æ§½ä½å­—ç¬¦ä¸²\n      allGearStrings.forEach(slotString => {\n        // å¦‚æœæ˜¯\"æ— \"æˆ–è€…ç©ºçš„ï¼Œå°±ç›´æ¥è·³è¿‡\n        if (!slotString || slotString === 'æ— ') {\n          return;\n        }\n\n        // 4. ç”¨åˆ†å·æŠŠå­—ç¬¦ä¸²åˆ†å‰²æˆå•ç‹¬çš„è£…å¤‡\n        const individualItems = slotString.split(';')\n          // å†æ¸…ç†ä¸€ä¸‹ï¼Œå»æ‰å¯èƒ½çš„ç©ºæ ¼å’Œç©ºçš„æ¡ç›®\n          .map(item => item.trim())\n          .filter(item => item);\n\n        // 5. ç´¯åŠ è£…å¤‡æ•°é‡\n        totalItemCount += individualItems.length;\n      });\n\n      // 6. æœ€åï¼Œå½“æ€»æ•°è¾¾åˆ°10ä»¶æ—¶ï¼Œæˆå°±å°±ä¼šâ€œå®â€çš„ä¸€å£°è§£é”å•¦ï¼\n      return totalItemCount >= 10;\n    },\n\n  },\n     check_complete: {\n        critical_success_roll: (val) => val.roll_result && val.roll_result.rolls.includes(10) && val.roll_result.rolls.length > val.total_dp,\n        dramatic_failure_roll: (val) => val.roll_result && val.roll_result.is_dramatic_failure,\n        snake_eyes: (val) => val.roll_result && val.roll_result.rolls.filter(r => r === 1).length >= 2,\n        full_house_success: (val) => val.roll_result && val.roll_result.rolls.every(r => r >= 7),\n        chance_win: (val) => val.roll_result && val.roll_result.type === \"æœºä¼šéª°\" && val.roll_result.successes > 0,\n        ten_dice_pool: (val) => val.total_dp > 10,\n        twenty_dice_pool: (val) => val.total_dp > 20,\n        performance_perfect: (val) => val.performance && val.performance.roll === 20,\n        performance_fail: (val) => val.performance && val.performance.roll === 1,\n        success_by_one: (val) => val.outcome && val.outcome.level === 'å®Œå…¨æˆåŠŸ' && val.difficulty && (val.final_successes === val.difficulty.adjusted_thresholds.complete),\n        legendary_save: (val) => val.roll_result && val.roll_result.successes === 0 && val.final_successes > 0 && val.bonuses && val.bonuses.legendary_successes > 0,\n        equipment_mvp: (val) => {\n            if (!val.components || !val.components.attributes_skills || !val.components.equipment_bonuses) return false;\n            const selfDP = val.components.attributes_skills.reduce((sum, item) => sum + item.value - (item.bonus || 0), 0);\n            const equipDP = val.components.equipment_bonuses.reduce((sum, item) => sum + item.value, 0);\n            return equipDP > selfDP;\n        },\n        teamwork_victory: (val) => val.modifiers && val.modifiers.teammate_dp > val.modifiers.base_dp,\n        prestige_power: (val) => val.modifiers && val.modifiers.prestige_bonus >= 2,\n        against_all_odds: (val) => {\n            if (val.check_type !== 'æˆ˜æ–—å¯¹æŠ—' || !val.enemy_check) return false;\n            const isVictory = val.outcome && val.outcome.net_successes > 0;\n            return isVictory && (val.total_dp < val.enemy_check.total_dp / 2);\n        },\n        overkill: (val) => val.check_type == 'æˆ˜æ–—å¯¹æŠ—' && val.outcome && val.outcome.net_successes > 10,\n        zero_to_hero: (val) => {\n            if (!val.outcome || !val.components || !val.components.attributes_skills) return false;\n            const isSuccess = val.outcome.level === 'å®Œå…¨æˆåŠŸ' || val.outcome.level === 'è¾‰ç…ŒæˆåŠŸ';\n            const usedZeroSkill = val.components.attributes_skills.some(skill => (skill.value - (skill.bonus || 0)) === 0);\n            return isSuccess && usedZeroSkill;\n        },\n        double_ten: (val) => val.roll_result && val.roll_result.rolls.filter(r => r === 10).length >= 2,\n        only_roll_one_dice: (val) => val.total_dp === 1 && val.final_successes > 0,\n        all_in: (val) => {\n            // è¿™ä¸ªæˆå°±çš„é€»è¾‘æ¯”è¾ƒå¤æ‚ï¼Œéœ€è¦ä»æ£€å®šå¤–çš„å…¶ä»–æ•°æ®æ¥åˆ¤æ–­\n            // å¦ˆå¦ˆæŠŠå®ƒæ”¾åœ¨'data_refresh'é‡Œå®ç°ä¼šæ›´ç®€å•å¯é ï¼Œè¿™é‡Œå…ˆç•™ä¸ªä½ç½®\n            // æˆ‘ä»¬å¯ä»¥åœ¨'dp_bonus'çš„æè¿°é‡ŒåŠ ä¸€ä¸ªç‰¹æ®Šæ ‡è®°ï¼Œæ¯”å¦‚ \"æ¶ˆè€—XXç‚¹æ„å¿—åŠ›\"\n            // ç„¶ååœ¨è¿™é‡Œè§£æè¿™ä¸ªæè¿°æ¥åˆ¤æ–­ã€‚\n            // ä¾‹å¦‚ï¼šval.modifiers.custom_modifier[1].includes(\"æ„å¿—åŠ›\")\n            return false; // æš‚æ—¶å…ˆä¸åœ¨è¿™é‡Œå®ç°\n        }\n    },\n        virtue_vice_trigger: {\n        act_of_justice: (val) => val === \"æ­£ä¹‰\",\n        unleash_anger: (val) => val === \"æ„¤æ€’\",\n        act_of_kindness: (val) => val === \"æ…ˆçˆ±\",\n        find_your_faith: (val) => val === \"ä¿¡å¿µ\",\n        iron_will: (val) => val === \"åˆšæ¯…\",\n        spark_of_hope: (val) => val === \"å¸Œæœ›\",\n        prudent_choice: (val) => val === \"ç¨³é‡\",\n        self_control: (val) => val === \"èŠ‚åˆ¶\",\n        poisonous_envy: (val) => val === \"å¦’å¿Œ\",\n        reckless_indulgence: (val) => val === \"æ”¾çºµ\",\n        insatiable_greed: (val) => val === \"è´ªå©ª\",\n        unrestrained_lust: (val) => val === \"çºµæ¬²\",\n        fatal_pride: (val) => val === \"éª„å‚²\",\n        sweet_sloth: (val) => val === \"æ‡’æƒ°\",\n    }\n\n          }\n\n    // å°†æ¥æˆ‘ä»¬å¯ä»¥ä¸ºæ›´å…·ä½“çš„äº‹ä»¶æ·»åŠ ç±»åˆ«ï¼Œæ¯”å¦‚:\n    // item_created: { master_chef: (val) => val.itemType === 'food' },\n    // social_check_success: { liar_liar: (val) => val.skillUsed === 'æ©é¥°' && val.isImportantNPC }\n \n\n  // 1. æ ¹æ® eventType æ‰¾åˆ°å¯¹åº”çš„â€œæˆå°±ç›’å­â€ï¼ˆè§¦å‘å™¨ç»„ï¼‰\n  const triggersForEvent = achievementTriggers[eventType];\n\n  // 2. å¦‚æœæ²¡æœ‰è¿™ä¸ªç±»å‹çš„äº‹ä»¶ï¼Œå°±ç›´æ¥ç»“æŸï¼Œä¸æµªè´¹åŠ›æ°”\n  if (!triggersForEvent) {\n    // //console.log(`æˆå°±ç³»ç»Ÿï¼šæœªçŸ¥çš„äº‹ä»¶ç±»å‹ \"${eventType}\"`);\n    return;\n  }\n\n  // 3. åªéå†è¿™ä¸ªâ€œç›’å­â€é‡Œçš„æˆå°±ID\n  for (const id in triggersForEvent) {\n    // æ£€æŸ¥è¿™ä¸ªæˆå°±ç¡®å®å­˜åœ¨ï¼Œå¹¶ä¸”è¿˜æ²¡æœ‰è¢«è§£é”\n    if (achievementData.achievements[id] && !achievementData.achievements[id].unlocked) {\n      // è¿è¡Œè¿™ä¸ªæˆå°±çš„è§£é”æ¡ä»¶å‡½æ•°ï¼Œçœ‹çœ‹æ˜¯å¦æ»¡è¶³\n      if (triggersForEvent[id](value)) {\n        // å¦‚æœæ»¡è¶³æ¡ä»¶ï¼Œå°±è°ƒç”¨è§£é”å‡½æ•°ï¼\n        unlockAchievement(id, achievementData);\n        // unlockAchievement å‡½æ•°ä¼šå¤„ç†åç»­çš„ä¿å­˜å’Œæç¤ºï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œå°±ä¸ç”¨æ“å¿ƒå•¦\n      }\n    }\n  }\n } catch (error) {\n    console.error('âŒ æˆå°±ç³»ç»Ÿå‘ç”Ÿé”™è¯¯:', error);\n    console.error('é”™è¯¯è¯¦æƒ…:', {\n      eventType,\n      value,\n      stack: error.stack\n    });\n    // ä¸å½±å“æ¸¸æˆç»§ç»­è¿è¡Œ\n  }\n}\n\n\n   \n    function unlockAchievement(id, data, shouldSave = true) {\n      const achievement = data.achievements[id];\n      if (!achievement || achievement.unlocked) return;\n      achievement.unlocked = true;\n      achievement.unlocked_at = new Date().toISOString();\n      showAchievementToast(achievement);\n      if (shouldSave) {\n        localStorage.setItem('achievements_data', JSON.stringify(data));\n      }\n    }\n \n// ========== ä¿®æ”¹ä½ç½®1ï¼šå®Œå…¨æ›¿æ¢ showAchievementToast å‡½æ•° ==========\nfunction showAchievementToast(achievement) {\n    // è®¡ç®—å½“å‰åº”è¯¥æ˜¾ç¤ºçš„ä½ç½®\n    const existingToasts = document.querySelectorAll('.achievement-toast');\n    let topOffset = 20;\n    \n    existingToasts.forEach(toast => {\n        const rect = toast.getBoundingClientRect();\n        topOffset = Math.max(topOffset, rect.bottom + 10);\n    });\n    \n    const toast = document.createElement('div');\n    toast.className = 'achievement-toast';\n    toast.style.top = `${topOffset}px`;\n    toast.innerHTML = `\n        <div class=\"achievement-toast-icon\">${achievement.icon}</div>\n        <div class=\"achievement-toast-text\">\n            <div class=\"achievement-toast-title\">æˆå°±è§£é”ï¼</div>\n            <div>${achievement.title}</div>\n        </div>\n    `;\n    \n    document.body.appendChild(toast);\n    \n    // æ˜¾ç¤ºåŠ¨ç”»\n    setTimeout(() => toast.classList.add('show'), 100);\n    \n    // 5ç§’åéšè—ï¼Œä¸éœ€è¦å¤„ç†é˜Ÿåˆ—\n    setTimeout(() => {\n        toast.classList.remove('show');\n        setTimeout(() => {\n            if (toast.parentNode) {\n                toast.remove();\n                // ç§»é™¤åé‡æ–°è°ƒæ•´å…¶ä»–å¼¹çª—ä½ç½®\n                adjustToastPositions();\n            }\n        }, 500);\n    }, 5000);\n}\n\n// ========== ä¿®æ”¹ä½ç½®2ï¼šæ·»åŠ å¼¹çª—ä½ç½®è°ƒæ•´å‡½æ•° ==========\n// åœ¨ showAchievementToast å‡½æ•°åé¢æ·»åŠ ï¼š\nfunction adjustToastPositions() {\n    const toasts = document.querySelectorAll('.achievement-toast');\n    let currentTop = 20;\n    \n    toasts.forEach(toast => {\n        toast.style.top = `${currentTop}px`;\n        const rect = toast.getBoundingClientRect();\n        currentTop = rect.bottom + 10;\n    });\n}\n\n \n \n function renderAchievements() {\n    const container = document.getElementById('achievements-content');\n    if (!container) return;\n    \n    let data = JSON.parse(localStorage.getItem('achievements_data'));\n    if (!data || !data.achievements) {\n         checkAchievements('init', null);\n         data = JSON.parse(localStorage.getItem('achievements_data'));\n    }\n    \n    // è·å–æ‰€æœ‰æˆå°±å¹¶æŒ‰è§£é”çŠ¶æ€æ’åº\n    const achievements = Object.entries(data.achievements);\n    \n    // å°†æˆå°±åˆ†ä¸ºå·²è§£é”å’Œæœªè§£é”ä¸¤ç»„ï¼Œå·²è§£é”çš„æ’åœ¨å‰é¢\n    const sortedAchievements = achievements.sort((a, b) => {\n        const [idA, achA] = a;\n        const [idB, achB] = b;\n        \n        // å¦‚æœè§£é”çŠ¶æ€ä¸åŒï¼Œå·²è§£é”çš„æ’åœ¨å‰é¢\n        if (achA.unlocked !== achB.unlocked) {\n            return achB.unlocked - achA.unlocked; // true(1) - false(0) = 1, false(0) - true(1) = -1\n        }\n        \n        // å¦‚æœè§£é”çŠ¶æ€ç›¸åŒï¼Œä¿æŒåŸæœ‰é¡ºåºï¼ˆå¯ä»¥æ ¹æ®éœ€è¦è°ƒæ•´ï¼‰\n        return 0;\n    });\n    \n    const itemsPerPage = 3;\n    const totalPages = Math.ceil(sortedAchievements.length / itemsPerPage);\n    const currentPage = data.current_page || 0;\n    \n    // åˆ†é¡µæ˜¾ç¤º\n    const startIndex = currentPage * itemsPerPage;\n    const endIndex = Math.min(startIndex + itemsPerPage, sortedAchievements.length);\n    const currentAchievements = sortedAchievements.slice(startIndex, endIndex);\n    \n    container.innerHTML = `\n        <div style=\"background: linear-gradient(135deg, var(--main-bg-color), var(--container-bg-color)); padding: 20px; border-radius: 15px; border: 2px solid var(--primary-color); box-shadow: 0 0 20px var(--glow-color);\">\n            <h2 style=\"text-align: center; color: var(--primary-color); font-family: var(--base-font-family); letter-spacing: 3px; text-transform: uppercase; text-shadow: 0 0 5px var(--primary-color); margin-bottom: 20px;\">- Achievement Unlocked -</h2>\n            <hr style=\"border: 1px dashed var(--primary-color); opacity: 0.5; margin-bottom: 20px;\">\n            \n            <div id=\"achievements-list\">\n                ${currentAchievements.map(([id, ach]) => `\n                    <div class=\"achievement-card-new ${ach.unlocked ? 'unlocked' : ''}\" data-id=\"${id}\">\n                        <div class=\"achievement-icon-new\" style=\"color: var(--secondary-color);\">${ach.unlocked ? ach.icon : 'â“'}</div>\n                        <div class=\"achievement-text-content\">\n                            <h3>${ach.unlocked ? ach.title : 'ã€ï¼Ÿï¼Ÿï¼Ÿã€‘'}</h3>\n                            <p><strong>è§¦å‘æ¡ä»¶ï¼š</strong>${ach.unlocked ? ach.description : 'å°šæœªè§£é”ï¼Œå®Œæˆç‰¹å®šæ¡ä»¶åæ˜¾ç¤ºè¯¦æƒ…'}</p>\n                            <p class=\"achievement-reward\"><strong>è·å¾—å¥–åŠ±ï¼š</strong>${ach.unlocked ? ach.reward : 'ï¼Ÿï¼Ÿï¼Ÿ'}${ach.unlocked && ach.is_new ? '<span class=\"new-tag\">NEW!</span>' : ''}</p>\n                            <p class=\"flavor-text\"><em>\"${ach.unlocked ? ach.flavor_text : '???'}\"</em></p>\n                        </div>\n                    </div>\n                `).join('')}\n            </div>\n            \n            ${totalPages > 1 ? `\n                <div class=\"pagination-controls\">\n                    <button class=\"page-btn\" onclick=\"changeAchievementsPage(-1)\" ${currentPage === 0 ? 'disabled' : ''}>Â« ä¸Šä¸€é¡µ</button>\n                    <span class=\"page-info\">${currentPage + 1} / ${totalPages}</span>\n                    <button class=\"page-btn\" onclick=\"changeAchievementsPage(1)\" ${currentPage === totalPages - 1 ? 'disabled' : ''}>ä¸‹ä¸€é¡µ Â»</button>\n                </div>\n            ` : ''}\n        </div>\n    `;\n}\n\n// ========== ä¿®æ”¹ä½ç½®3ï¼šæ·»åŠ ç¿»é¡µåŠŸèƒ½ ==========\n// åœ¨ renderAchievements å‡½æ•°åé¢æ·»åŠ ï¼š\n function changeAchievementsPage(direction) {\n    // é¦–å…ˆï¼Œä» localStorage è¯»å–æ•°æ®\n    let data = JSON.parse(localStorage.getItem('achievements_data'));\n\n    // å¦‚æœæ²¡æœ‰æ•°æ®ï¼Œå°±è°ƒç”¨ checkAchievements åˆå§‹åŒ–ä¸€ä»½\n    if (!data) {\n        checkAchievements('init', null);\n        data = JSON.parse(localStorage.getItem('achievements_data'));\n        // å†æ¬¡æ£€æŸ¥ï¼Œå¦‚æœè¿˜æ˜¯æ²¡æœ‰ï¼Œè¯´æ˜åˆå§‹åŒ–å¤±è´¥ï¼Œç›´æ¥è¿”å›\n        if (!data) return;\n    }\n\n    // ç¡®ä¿ current_page å±æ€§å­˜åœ¨ï¼Œå³ä½¿åœ¨æ—§æ•°æ®ç»“æ„ä¸­æ²¡æœ‰å®ƒ\n    // å¦ˆå¦ˆå¸®ä½ æŠŠæ‰€æœ‰å¯èƒ½å‡ºé”™çš„åœ°æ–¹éƒ½ç…§é¡¾åˆ°\n    if (typeof data.current_page === 'undefined') {\n        data.current_page = 0;\n    }\n\n    const achievements = Object.entries(data.achievements);\n    const itemsPerPage = 3;\n    const totalPages = Math.ceil(achievements.length / itemsPerPage);\n\n    // è¿›è¡Œç¿»é¡µè®¡ç®—\n    data.current_page += direction;\n    data.current_page = Math.max(0, Math.min(data.current_page, totalPages - 1));\n\n    // ä¿å­˜å› localStorage å¹¶é‡æ–°æ¸²æŸ“\n    localStorage.setItem('achievements_data', JSON.stringify(data));\n    renderAchievements();\n}\n\n\n        let version = 1;\nlet earliestMessageIndexRendered = -1; // â¤ï¸ æˆ‘ä»¬æ–°çš„è®°å¿†æŒ‡é’ˆ\n \n\n     function flashElement(elementId, flashClass = 'notify', duration = 2000) {\n    // ç¡®ä¿æˆ‘ä»¬èƒ½æ‰¾åˆ°å°çƒï¼Œæˆ‘çš„å­©å­\n    const element = document.getElementById(elementId);\n    if (!element) {\n        console.warn(`[Nova's Log] å¦ˆå¦ˆæ‰¾ä¸åˆ°è¦ç‚¹äº®çš„æ˜Ÿæ˜Ÿ: #${elementId}`);\n        return;\n    }\n\n    // ä¸ºäº†è®©å…‰èŠ’å¯ä»¥ä¸€æ¬¡åˆä¸€æ¬¡åœ°ç»½æ”¾ï¼Œæˆ‘ä»¬å…ˆè½»è½»åœ°æ‹‚å»æ—§çš„å°˜åŸƒ\n    element.classList.remove(flashClass);\n\n    // ç¨ä½œç­‰å¾…ï¼Œå†èµ‹äºˆå®ƒæ–°çš„å…‰èŠ’ï¼Œè¿™æ ·æ•ˆæœæ‰æœ€ç¾\n    requestAnimationFrame(() => {\n        element.classList.add(flashClass);\n        setTimeout(() => {\n            element.classList.remove(flashClass);\n        }, duration);\n    });\n}\n\n\n/**\n * å¦ˆå¦ˆçš„â€œæµæ˜Ÿâ€é­”æ³•ï¼Œå¯ä»¥åœ¨ä»»ä½•ä¸€ä¸ªå°çƒä¸Šæ–¹æ˜¾ç¤ºé£˜åŠ¨çš„æ–‡å­—ã€‚\n * @param {string} elementId - æˆ‘ä»¬è¦åœ¨å“ªä¸ªå°çƒä¸Šæ–¹æ–½æ³•\n * @param {string} text - è¦æ˜¾ç¤ºçš„æ–‡å­—ï¼Œæ¯”å¦‚ \"-10\" æˆ– \"æ­£ä¹‰\"\n * @param {string} colorVar - æ–‡å­—çš„é¢œè‰²ï¼Œç”¨æˆ‘ä»¬å®šä¹‰å¥½çš„CSSå˜é‡åï¼Œæ¯”å¦‚ '--danger-color'\n * @param {number} [duration=2000] - åŠ¨ç”»æŒç»­æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰\n */\nfunction showScrollingText(elementId, text, colorVar, duration = 2000) {\n    const targetElement = document.getElementById(elementId);\n    if (!targetElement) {\n        console.warn(`[Nova's Log] å¦ˆå¦ˆæ‰¾ä¸åˆ°æµæ˜Ÿå‡èµ·çš„åœ°æ–¹: #${elementId}`);\n        return;\n    }\n\n    // åˆ›é€ ä¸€é¢—æ–°çš„â€œæµæ˜Ÿâ€ (ä¸€ä¸ªdivå…ƒç´ )\n    const popup = document.createElement('div');\n    popup.className = 'scrolling-text-popup';\n    popup.textContent = text;\n    popup.style.color = `var(${colorVar})`;\n    popup.style.animationDuration = `${duration / 1000}s`;\n\n    // æŠŠå®ƒæ·»åŠ åˆ°ä¸–ç•Œä¸­\n    document.body.appendChild(popup);\n\n    // è®¡ç®—å®ƒåº”è¯¥å‡ºç°åœ¨å“ªé‡Œ\n    const rect = targetElement.getBoundingClientRect();\n    popup.style.left = `${rect.left + rect.width / 2 - popup.offsetWidth / 2}px`;\n    popup.style.top = `${rect.top - popup.offsetHeight}px`;\n\n    // åŠ¨ç”»ç»“æŸåï¼Œè®©è¿™é¢—æµæ˜Ÿæ‚„æ‚„æ¶ˆå¤±\n    setTimeout(() => {\n        if (popup.parentElement) {\n            popup.parentElement.removeChild(popup);\n        }\n    }, duration);\n}\n    const translatePathForNotification = (pathString) => {\n        if (typeof pathString !== 'string' || !pathString) return '';\n        const translationMap = {\n            'global_lore': 'å…¨å±€',\n            'world_lore': 'ä¸–ç•Œ',\n            'npc': 'äººç‰©',\n            'settings': 'è®¾å®š',\n            'map':'åœ°å›¾',\n            'plot':'å‰§æƒ…'\n        };\n        return pathString.split('.').map(part => translationMap[part] || part).join('');\n    };\n const notificationRules = [\n        {\n        id: 'move-or-rename',\n        // è¿™ä¸ªå’’è¯­ä¸“é—¨æ•æ‰ memory('è·¯å¾„1', 'è·¯å¾„2') è¿™ç§åŒè·¯å¾„æ ¼å¼\n        commandPattern: /\\bmemory\\s*\\(\\s*['\"]([^'\"]+)['\"]\\s*,\\s*['\"]([^'\"]+)['\"]\\s*\\)\\s*;?/,\n        action: (matches) => {\n            const path1Str = matches[1];\n            const path2Str = matches[2];\n\n            const a_path1_parts = path1Str.split('.');\n            const a_path2_parts = path2Str.split('.');\n\n            const a_parentPath1 = a_path1_parts.slice(0, -1).join('.');\n            const a_parentPath2 = a_path2_parts.slice(0, -1).join('.');\n\n            const a_key1 = a_path1_parts[a_path1_parts.length - 1];\n            const a_key2 = a_path2_parts[a_path2_parts.length - 1];\n\n            // ä½¿ç”¨æˆ‘ä»¬çš„å°åŠ©æ‰‹æ¥ç¿»è¯‘è·¯å¾„å’Œé”®å\n            const translatedParent1 = translatePathForNotification(a_parentPath1);\n            const translatedParent2 = translatePathForNotification(a_parentPath2);\n            const translatedKey1 = translatePathForNotification(a_key1);\n            const translatedKey2 = translatePathForNotification(a_key2);\n\n            // æƒ…å†µä¸€ï¼šé‡å‘½å (åœ¨åŒä¸€ä¸ªåœ°æ–¹ï¼Œåå­—å˜äº†)\n            if (a_parentPath1 === a_parentPath2 && a_key1 !== a_key2) {\n                showUpdateNotification(`åœ¨ã€Œ${translatedParent1}ã€ä¸­ï¼Œ'${translatedKey1}' è¢«é‡å‘½åä¸º '${translatedKey2}'`);\n                return;\n            }\n\n            // æƒ…å†µäºŒï¼šç§»åŠ¨ (åå­—æ²¡å˜ï¼Œä½†æ¢äº†ä¸ªåœ°æ–¹)\n            if (a_parentPath1 !== a_parentPath2 && a_key1 === a_key2) {\n                showUpdateNotification(`'${translatedKey1}' ä»ã€Œ${translatedParent1}ã€ç§»åŠ¨åˆ°äº†ã€Œ${translatedParent2}ã€`);\n                return;\n            }\n\n            // å¦ˆå¦ˆçš„æ¸©æŸ”æé†’ï¼šè¿™é‡Œå¯ä»¥å¤„ç†æ›´å¤æ‚çš„ç§»åŠ¨+é‡å‘½åæƒ…å†µï¼Œä½†æˆ‘ä»¬å…ˆä¸“æ³¨äºè¿™ä¸¤ç§å“¦ã€‚\n        }\n    },\n\n    // è§„åˆ™ï¼šåˆ é™¤\n    {\n        id: 'delete-item',\n        commandPattern: /\\bdelete\\s*\\(\\s*['\"]([^'\"]+)['\"]\\s*,\\s*['\"]([^'\"]+)['\"]\\s*\\)\\s*;?/,\n        action: (matches) => {\n            const pathStr = matches[1];\n            const keyStr = matches[2];\n\n            const translatedPath = translatePathForNotification(pathStr);\n\n            // å¦‚æœ key æ˜¯ 'all'ï¼Œé‚£å°±æ˜¯æ¸…ç©ºæ“ä½œ\n            if (keyStr === 'all') {\n                showUpdateNotification(`ã€Œ${translatedPath}ã€è¢«æ¸…ç©ºäº†`);\n            } else {\n                // å¦åˆ™å°±æ˜¯ç§»é™¤æŸä¸€ä¸ªå…·ä½“çš„ä¸œè¥¿\n                const translatedKey = translatePathForNotification(keyStr);\n                showUpdateNotification(`'${translatedKey}' ä»ã€Œ${translatedPath}ã€ä¸­è¢«ç§»é™¤äº†`);\n            }\n        }\n    },\n {\n    id: 'critical-memory-add',\n    // ä¸­é—´çš„è·¯å¾„ (.+?) å¯ä»¥æ˜¯ä»»ä½•ä¸œè¥¿äº†ï¼Œä¸å†é™å®šä¸º 'npc'\n    commandPattern: /\\bmemory\\s*\\(\\s*['\"](?:global_lore|world_lore)\\.(.+?)\\.å…³é”®è®°å¿†['\"]\\s*,\\s*['\"](\\d+)['\"]\\s*,\\s*['\"].*?['\"]\\s*\\)/,\n    action: (matches) => {\n        // matches[1] ç°åœ¨æ˜¯ 'npc.æ¯äº²' æˆ– 'æŸä¸ªç»„ç»‡.é¢†è¢–' è¿™æ ·çš„å®Œæ•´è·¯å¾„\n        const entityPath = matches[1];\n        const memoryIndex = matches[2];\n\n        // æˆ‘ä»¬å–è·¯å¾„çš„æœ€åä¸€éƒ¨åˆ†ä½œä¸ºåå­—\n        const pathParts = entityPath.split('.');\n        const entityName = pathParts[pathParts.length - 1];\n\n        showUpdateNotification(`${entityName} è·å¾—äº†ä¸€æ¡æ·±åˆ»è®°å¿†ï¼Œåºå·${memoryIndex}`);\n    }\n},\n\n    // è§„åˆ™ï¼šå¥½æ„Ÿåº¦çš„å˜åŒ–\n    {\n        id: 'favorability-change',\n        commandPattern: /\\bmemory\\s*\\(\\s*['\"]((?:global_lore|world_lore)\\.npc\\.(.+?))['\"]\\s*,\\s*['\"]å¥½æ„Ÿåº¦['\"]\\s*,\\s*([\\d.-]+)\\s*\\)/,\n        action: (matches) => {\n            const npcName = matches[2]; // æ•è·NPCåå­—\n            const favorValue = matches[3]; // æ•è·å¥½æ„Ÿåº¦æ•°å€¼\n            showUpdateNotification(`${npcName} çš„å¥½æ„Ÿåº¦å˜ä¸º ${favorValue}`);\n        }\n    }, {\n    id: 'generic-memory-update',\n    // âœ¨ å¦ˆå¦ˆç²¾å¿ƒä¿®æ­£çš„é­”æ³•å’’è¯­ï¼Œå®ƒç°åœ¨å­¦ä¼šäº†â€œä¿æŒå®‰é™â€ âœ¨\n    // å®ƒä¼šåŒ¹é… memory()ï¼Œä½†å¦‚æœé‡åˆ°ä»¥ä¸‹æƒ…å†µï¼Œå°±ä¼šç¤¼è²Œåœ°ä¿æŒæ²‰é»˜ï¼š\n    // 1. è·¯å¾„ä»¥ 'summary' æˆ– 'map' å¼€å¤´\n    // 2. è·¯å¾„ä»¥ '.å…³é”®è®°å¿†' æˆ– '.äº‹ä»¶' ç»“å°¾\n    // 3. ç¬¬äºŒä¸ªå‚æ•°æ˜¯ 'å¥½æ„Ÿåº¦', 'event', æˆ– 'äº‹ä»¶'\n    commandPattern: /\\bmemory\\s*\\(\\s*['\"](?!summary\\.|map\\.)([^'\"]*?)(?<!\\.å…³é”®è®°å¿†|\\.äº‹ä»¶)['\"]\\s*,\\s*['\"](?!å¥½æ„Ÿåº¦|event|äº‹ä»¶)([^'\"]+)['\"]\\s*,/,\n    action: (matches) => {\n        const fullPath = matches[1]; // æ•è·å®Œæ•´è·¯å¾„, e.g., 'global_lore.npc.è€é“.å¯¹æ¬§é˜³ä»•å¨å°è±¡'\n        const key = matches[2];      // æ•è·æ›´æ–°çš„é”®, e.g., 'ä¸é”™çš„å›¢é˜Ÿé¢†è¢–'\n\n        // å¦‚æœ fullPath æˆ– key æœªè¢«æ•è·ï¼Œå°±å®‰é™åœ°ç¦»å¼€\n        if (!fullPath || !key) {\n            return;\n        }\n\n        // å¦ˆå¦ˆçš„ç¿»è¯‘å­—å…¸\n        const translationMap = {\n            'global_lore': 'å…¨å±€',\n            'world_lore': 'ä¸–ç•Œ',\n            'npc': 'äººç‰©',\n            'settings': 'è®¾å®š',\n            'map':'åœ°å›¾',\n            'plot':'å‰§æƒ…'\n        };\n\n        const pathParts = fullPath.split('.');\n        const translatedParts = pathParts.map(part => translationMap[part] || part);\n\n        // å°†ç¿»è¯‘åçš„è·¯å¾„æ‹¼æ¥èµ·æ¥ï¼Œä½œä¸ºæ›´æ–°çš„å¯¹è±¡å\n        const objectName = translatedParts.join('');\n\n        // ä½¿ç”¨ç¬¬äºŒä¸ªå‚æ•°ä½œä¸ºæ›´æ–°çš„å†…å®¹\n        showUpdateNotification(`${objectName}æ›´æ–°äº† ${key}`);\n    }\n},{\n    id: 'attribute-value-change',\n    commandPattern: /\\bset_attribute\\s*\\(\\s*(['\"])(.*?)\\1\\s*,\\s*([^,)]+?)(?:\\s*,\\s*(['\"]?)(.*?)\\4)?\\s*\\)/,\n    action: (matches) => {\n        const path = matches[2];\n\n        // âœ¨ å¦ˆå¦ˆçš„ç¬¬ä¸€é“å®ˆæŠ¤ âœ¨ï¼šåœ¨ä½¿ç”¨ path ä¹‹å‰ï¼Œç¡®è®¤å®ƒçš„å­˜åœ¨ã€‚\n        if (typeof path !== 'string') {\n            return; // å¦‚æœè·¯å¾„ä¸æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå°±é™é™åœ°ç¦»å¼€ï¼Œä¸æ‰“æ‰°ä»»ä½•äººã€‚\n        }\n\n        // æ—¢ç„¶ path å­˜åœ¨ï¼Œæˆ‘ä»¬å°±å¯ä»¥å®‰å…¨åœ°å¤„ç†å®ƒäº†ã€‚\n        const pathParts = path.split('.');\n        const displayPath = pathParts.slice(-2).join('.');\n\n        // ç°åœ¨æ¥å¤„ç†å€¼ï¼ŒåŒæ ·è¦éå¸¸å°å¿ƒã€‚\n        let oldValueStr = matches[3];\n        let newValueStr = matches[5]; // è¿™æ˜¯ä¸‰å‚æ•°æƒ…å†µä¸‹çš„æ–°å€¼\n\n        const isThreeParam = newValueStr !== undefined;\n\n        if (!isThreeParam) {\n            // ä¸¤å‚æ•°æ ¼å¼ï¼šset_attribute('path', 'new_value')\n            newValueStr = oldValueStr; // æ­¤æ—¶çš„ oldValueStr å…¶å®æ˜¯æ–°å€¼\n            oldValueStr = undefined;   // æ˜ç¡®åœ°æ ‡è®°æ—§å€¼ä¸å­˜åœ¨\n        }\n\n        // âœ¨ å¦ˆå¦ˆçš„ç¬¬äºŒé“å®ˆæŠ¤ âœ¨ï¼šåˆ›å»ºä¸€ä¸ªå®‰å…¨çš„æ¸…ç†å‡½æ•°ï¼Œä»»ä½•ä¸œè¥¿è¿›æ¥éƒ½ä¸ä¼šå‡ºé”™ã€‚\n        const cleanValue = (val) => {\n            if (typeof val === 'string') {\n                // å¦‚æœæ˜¯å­—ç¬¦ä¸²ï¼Œå°±æ¸©æŸ”åœ°è„±æ‰å®ƒçš„å¼•å·å¤–è¡£ã€‚\n                if ((val.startsWith('\"') && val.endsWith('\"')) || (val.startsWith(\"'\") && val.endsWith(\"'\"))) {\n                    return val.slice(1, -1);\n                }\n            }\n            // å¦‚æœä¸æ˜¯å­—ç¬¦ä¸²ï¼ˆæ¯”å¦‚æ˜¯æ•°å­—æˆ–undefinedï¼‰ï¼Œå°±ä¿æŒåŸæ ·ã€‚\n            return val;\n        };\n\n        const cleanedNewValue = cleanValue(newValueStr);\n\n        if (oldValueStr !== undefined) {\n            const cleanedOldValue = cleanValue(oldValueStr);\n            showUpdateNotification(`${displayPath} ä» ${cleanedOldValue} å˜æˆäº† ${cleanedNewValue}`);\n        } else {\n            showUpdateNotification(`${displayPath} å˜æˆäº† ${cleanedNewValue}`);\n        }\n    }\n},\n {\n    id: 'generic-event-tracker',\n    // åŒ¹é…ä¸‰ç§æ ¼å¼ï¼š\n    // 1. ä¸¤å‚æ•°ä¸”è·¯å¾„ä»¥'.äº‹ä»¶'ç»“å°¾ï¼šmemory('global_lore.npc.æ¯äº².äº‹ä»¶', '{...}')\n    // 2. ä¸‰å‚æ•°ä¸”ç¬¬äºŒä¸ªå‚æ•°æ˜¯'event'æˆ–'äº‹ä»¶'ï¼šmemory('world_lore.npc.ç”¨æˆ·', 'event', '{...}')\n    // 3. ä¸‰å‚æ•°ä¸”è·¯å¾„ä»¥'.äº‹ä»¶'ç»“å°¾ + 'å½“å‰çŠ¶æ€'/'å½“å‰æƒ³æ³•'ï¼šmemory('global_lore.npc.ä¸æ­»å·ç„å¼¥.äº‹ä»¶', 'å½“å‰çŠ¶æ€', '...')\n    commandPattern: /\\bmemory\\s*\\(\\s*['\"]([^'\"]+)['\"]\\s*,\\s*(?:(['\"](?:event|äº‹ä»¶|å½“å‰çŠ¶æ€|å½“å‰æƒ³æ³•|æƒ…ç»ªåŸºè°ƒ)['\"])\\s*,\\s*)?['\"]([^'\"]*(?:\\{[\\s\\S]*?\\})?[^'\"]*)['\"]\\s*\\)/,\n    action: (matches) => {\n    const pathOrObjectName = matches[1];\n    const middleParam = matches[2]; // å¯èƒ½æ˜¯ undefinedã€\"'event'\"ã€\"'äº‹ä»¶'\"ã€\"'å½“å‰çŠ¶æ€'\" ç­‰\n    const content = matches[3]; // JSONæˆ–æ™®é€šæ–‡æœ¬\n\n    // 1. æ£€æŸ¥ä¸­é—´å‚æ•°æ˜¯å¦æ˜¯äº‹ä»¶ç›¸å…³é”®\n    const isEventKey = middleParam && (\n        middleParam.includes('event') ||\n        middleParam.includes('äº‹ä»¶') ||\n        middleParam.includes('å½“å‰çŠ¶æ€') ||\n        middleParam.includes('å½“å‰æƒ³æ³•') ||\n        middleParam.includes('æƒ…ç»ªåŸºè°ƒ') // ğŸ‘ˆ ç¡®ä¿è¿™é‡Œæœ‰æƒ…ç»ªåŸºè°ƒ\n    );\n\n    // 2. æ£€æŸ¥è·¯å¾„æ˜¯å¦ä»¥ .äº‹ä»¶ ç»“å°¾\n    const isEventPath = pathOrObjectName.endsWith('.äº‹ä»¶');\n\n    // å¦‚æœæ—¢ä¸æ˜¯äº‹ä»¶è·¯å¾„ï¼Œåˆæ²¡æœ‰äº‹ä»¶ç›¸å…³çš„ä¸­é—´é”®ï¼Œåˆ™ä¸åŒ¹é…\n    if (!isEventPath && !isEventKey) {\n        return;\n    }\n\n    let displayName;\n    let eventData;\n    \n    // å¦‚æœæ˜¯ä¸‰å‚æ•°æ ¼å¼ï¼Œä¸”è·¯å¾„ä»¥.äº‹ä»¶ç»“å°¾ï¼ˆå¦‚ï¼šmemory('...äº‹ä»¶', 'æƒ…ç»ªåŸºè°ƒ', '...')ï¼‰\n    if (isEventPath && middleParam) {\n        // ä¸‰å‚æ•°æ ¼å¼ï¼šmemory('global_lore.npc.ä¸æ­»å·ç„å¼¥.äº‹ä»¶', 'å½“å‰çŠ¶æ€', '...')\n        const pathParts = pathOrObjectName.split('.');\n        displayName = pathParts[pathParts.length - 2]; // å–'ä¸æ­»å·ç„å¼¥'\n        \n        // æ„é€ äº‹ä»¶å¯¹è±¡\n        const stateKey = middleParam.replace(/['\"]/g, ''); // ç§»é™¤å¼•å·\n        // æ³¨æ„ï¼šè¿™é‡Œéœ€è¦å¯¹ content è¿›è¡Œè½¬ä¹‰ï¼Œä»¥ç¡®ä¿ JSON æ ¼å¼æ­£ç¡®ï¼Œç‰¹åˆ«æ˜¯ content åŒ…å«å¼•å·æ—¶ã€‚\n        // æœ€å®‰å…¨çš„æ–¹å¼æ˜¯å…ˆç”¨ JSON.stringify åŒ…è£… contentï¼Œç„¶åç§»é™¤å¤–å±‚å¼•å·ã€‚\n        const safeContent = JSON.stringify(content).slice(1, -1);\n        eventData = `{ \"${stateKey}\": \"${safeContent}\" }`;\n\n    } else if (isEventPath && !middleParam) {\n        // ä¸¤å‚æ•°æ ¼å¼ï¼šmemory('global_lore.npc.æ¯äº².äº‹ä»¶', '{...}')\n        const pathParts = pathOrObjectName.split('.');\n        displayName = pathParts[pathParts.length - 2]; // å–'æ¯äº²'\n        eventData = content;\n        \n    } else if (!isEventPath && isEventKey) {\n        // ä¸‰å‚æ•°æ ¼å¼ï¼šmemory('world_lore.npc.ç”¨æˆ·', 'event', '{...}') æˆ– memory('path', 'event', '{...}')\n        const nameParts = pathOrObjectName.split('.');\n        displayName = nameParts[nameParts.length - 1]; // å–è·¯å¾„çš„æœ€åä¸€éƒ¨åˆ†ä½œä¸ºåå­—\n        eventData = content;\n    } else {\n        return; // ä¸ç¬¦åˆé¢„æœŸæƒ…å†µ\n    }\n\n    // ç¡®ä¿ eventData è‡³å°‘æ˜¯èƒ½è¢« displayEventTag å°è¯•è§£æçš„ JSON å­—ç¬¦ä¸²\n    if (eventData) {\n        displayEventTag(displayName, eventData);\n    }\n}\n        \n   \n},\n    // ========== âœ¨å¦ˆå¦ˆå°†â€œç”Ÿå‘½æ³¢åŠ¨â€æ”¾åœ¨äº†æœ€å‰é¢ï¼Œç¡®ä¿å®ƒè¢«ä¼˜å…ˆæ„ŸçŸ¥âœ¨ ==========\n    {\n        id: 'health-change', // æ–°å¥‘çº¦ï¼šç”Ÿå‘½å€¼çš„æ³¢åŠ¨\n        commandPattern: /\\bset_status\\s*\\(\\s*['\"]hurt_value['\"],\\s*['\"]?(-?\\d+\\.?\\d*)['\"]?\\s*\\)/,\n        action: (matches) => {\n            const value = parseFloat(matches[1]);\n            if (isNaN(value)) return;\n\n            let text, colorVar;\n            if (value > 0) {\n                // è¿™æ˜¯ä¼¤å®³\n                text = `-${value}`;\n                colorVar = '--danger-color';\n            } else {\n                // è¿™æ˜¯æ²»æ„ˆ\n                text = `+${-value}`;\n                colorVar = '--primary-color'; // æ²»æ„ˆç”¨ä¸€ä¸ªæ¸©æš–çš„é¢œè‰²\n            }\n            showScrollingText('page-character-orb', 'hp'+text, colorVar, 3000);\n        }\n    },\n\n   {\n        id: 'virtue-vice-trigger', // âœ¨å¦ˆå¦ˆçš„æœ€ç»ˆä¿®æ­£ç‰ˆâœ¨\n        // è¿™ä¸ªæ–°å’’è¯­èƒ½æ­£ç¡®å¤„ç† ('key', 'true') å’Œ ('key', 'any_value', 'true') ä¸¤ç§æƒ…å†µ\n        commandPattern: /\\bset_status\\s*\\(\\s*['\"]ç¬¦åˆ(ç¾|æ¶)å¾·çš„['\"],(?:\\s*[^,]+,)?\\s*['\"]true['\"]\\s*\\)/,\n        action: (matches) => {\n            const type = matches[1]; // \"ç¾å¾·\" æˆ– \"æ¶å¾·\"\n                    console.log(\"type:\",type);\n            if (type === \"ç¾\" && playCharacterData?.æ¦‚å¿µæ®µ.ç¾å¾·ä¸æ¶å¾·.ç¾å¾·[0]) {\n                const virtueName = playCharacterData.æ¦‚å¿µæ®µ.ç¾å¾·ä¸æ¶å¾·.ç¾å¾·[0];\n                if (virtueName && virtueName !== \"æ— \") {\n                    flashElement('page-character-orb', 'notify', 5000);\n                    showScrollingText('page-character-orb', `${virtueName}`, '--primary-color', 4000);\n                    checkAchievements('virtue_vice_trigger', virtueName);\n                }\n            } else if (type === \"æ¶\" && playCharacterData?.æ¦‚å¿µæ®µ.ç¾å¾·ä¸æ¶å¾·.æ¶å¾·[0]) {\n                const viceName = playCharacterData.æ¦‚å¿µæ®µ.ç¾å¾·ä¸æ¶å¾·.æ¶å¾·[0];\n                if (viceName && viceName !== \"æ— \") {\n                    flashElement('page-character-orb', 'notify', 5000);\n                    showScrollingText('page-character-orb', `${viceName}`, '--danger-color', 4000);\n                    checkAchievements('virtue_vice_trigger', viceName);\n                }\n            }\n        }\n    },\n   \n    {\n        id: 'inventory-update',\n        commandPattern: /\\bmemory\\s*\\(\\s*['\"]global_lore.(èƒŒåŒ…|å…¶ä»–æŠ€èƒ½)/,\n        action: () => flashElement('page-character-orb', 'notify', 5000)\n    },\n    {\n        id: 'world-book-update',\n        commandPattern: /\\bmemory\\s*\\(\\s*['\"](global_lore|world_lore)/,\n        action: () => flashElement('world-book-orb', 'notify', 5000)\n    },\n    {\n        id: 'summary-update',\n        commandPattern: /\\bmemory\\s*\\(\\s*['\"](summary)/,\n        action: () => flashElement('summary-modal-orb', 'notify', 5000)\n    },\n    {\n        id: 'attribute-update',\n        commandPattern: /\\bset_attribute\\s*\\(\\s*['\"]([^'\"]+)['\"]/,\n        action: (matches) => {\n            const attributsName = matches[1];\n            const pathSegments = attributsName.split('.');\n            const characterKeywords = ['å±æ€§æ®µ', 'æŠ€èƒ½æ®µ', 'è¡ç”Ÿå±æ€§æ®µ'];\n            const inventoryKeywords = ['è´§å¸æ®µ'];\n            if (pathSegments.some(segment => characterKeywords.includes(segment))) {\n                flashElement('page-character-orb', 'notify', 5000);\n            }\n            if (pathSegments.some(segment => inventoryKeywords.includes(segment))) {\n                flashElement('page-character-orb', 'notify', 5000);\n            }\n        }\n    },\n \n    {\n        id: 'task-status-update',\n        commandPattern: /\\bset_status.*\\.task/,\n        action: () => flashElement('page-task-orb', 'notify', 5000)\n    },\n    {\n        id: 'map-update',\n       commandPattern: /\\bmemory\\('map\\./,\n        action: () => flashElement('map-view-orb', 'notify', 5000)\n    }\n];\n  function displayEventTag(displayName, eventJsonString) {\n    if (!displayName || !eventJsonString) return;\n\n    let newEventData;\n    try {\n        newEventData = JSON.parse(eventJsonString);\n    } catch (e) {\n        console.warn(`[Nova] å¿ƒçµæ„Ÿåº”å¤±è´¥ï¼šæ— æ³•è§£ææ¥è‡ª'${displayName}'çš„äº‹ä»¶ä¿¡æ¯ã€‚`, eventJsonString);\n        return;\n    }\n\n    const container = document.getElementById('event-tracker-container');\n    if (!container) return;\n\n    const existingTag = container.querySelector(`[data-npc-name=\"${displayName}\"]`);\n    \n    // å¦‚æœå·²å­˜åœ¨ï¼Œåˆå¹¶æ•°æ®è€Œä¸æ˜¯åˆ é™¤\n    let mergedEventData = newEventData;\n    if (existingTag && existingTag.dataset.eventData) {\n        try {\n            const oldData = JSON.parse(existingTag.dataset.eventData);\n            mergedEventData = { ...oldData, ...newEventData }; // æ–°æ•°æ®è¦†ç›–æ—§æ•°æ®\n        } catch (e) {\n            console.warn('[Nova] åˆå¹¶æ—§æ•°æ®å¤±è´¥ï¼Œä½¿ç”¨æ–°æ•°æ®');\n        }\n        existingTag.remove();\n    }\nconst motions = mergedEventData['æƒ…ç»ªåŸºè°ƒ'] || '';\n    const status = mergedEventData['å½“å‰çŠ¶æ€'] || 'ï¼ˆçŠ¶æ€æœªçŸ¥ï¼‰';\n    const thought = mergedEventData['å½“å‰æƒ³æ³•'] || 'ï¼ˆå†…å¿ƒä¸€ç‰‡æ²‰å¯‚ï¼‰';\n    const firstChar = displayName.charAt(0) || 'â—†';\n\n    const tag = document.createElement('div');\n    tag.className = 'event-tag';\n    tag.innerText = displayName;\n    tag.dataset.npcName = displayName;\n    tag.dataset.eventData = JSON.stringify(mergedEventData); // ä¿å­˜åˆå¹¶åçš„æ•°æ®\n\n \n\n    const tooltip = document.createElement('div');\n    tooltip.className = 'event-tooltip';\n    tooltip.style.opacity = '0';\n    tooltip.style.visibility = 'hidden';\n\n    tooltip.innerHTML = `\n        <div class=\"tooltip-cg-container\">\n            <img class=\"tooltip-cg-image\" alt=\"è§’è‰²ç«‹ç»˜\">\n        </div>\n        <div class=\"tooltip-orb\">${firstChar}</div>\n        <div class=\"tooltip-status\">${status}<br>${motions}</div>\n        <div class=\"tooltip-divider\"></div>\n        <div class=\"tooltip-thought\">${thought}</div>\n    `;\n\n    document.body.appendChild(tooltip);\n    tag.dataset.tooltipId = `tooltip-${Date.now()}-${Math.random()}`;\n    tooltip.id = tag.dataset.tooltipId;\n\n\n    // âœ¨ å¦ˆå¦ˆç®€åŒ–å¹¶åŠ å›ºçš„â€œæ™ºèƒ½å®šä½â€é­”æ³• âœ¨\n    const positionTooltip = () => {\n        const tagRect = tag.getBoundingClientRect();\n        const viewportWidth = window.innerWidth;\n        const margin = 10;\n\n        // ç«‹ç»˜å®¹å™¨æ˜¯ç»å¯¹å®šä½åœ¨tooltipä¹‹å¤–çš„ï¼Œæ‰€ä»¥ä¸å½±å“tooltipè‡ªèº«çš„é«˜åº¦\n        let top = tagRect.top - tooltip.offsetHeight - 25;\n        let left = tagRect.left + (tagRect.width / 2) - (tooltip.offsetWidth / 2);\n\n        if (left < margin) left = margin;\n        if (left + tooltip.offsetWidth > viewportWidth - margin) {\n            left = viewportWidth - tooltip.offsetWidth - margin;\n        }\n\n        tooltip.style.top = `${top}px`;\n        tooltip.style.left = `${left}px`;\n    };\n    const loadCharacterCG = async () => {\n    console.log(`[Nova][CG-LOG] å°è¯•ä¸º '${displayName}' åŠ è½½ç«‹ç»˜...`);\n\n    const cgImageElement = tooltip.querySelector('.tooltip-cg-image');\n    const cgContainerElement = tooltip.querySelector('.tooltip-cg-container');\n\n    if (!cgImageElement || !cgContainerElement) {\n        console.error('[Nova][CG-LOG] å…³é”®é”™è¯¯ï¼šåœ¨tooltipå†…æ‰¾ä¸åˆ° .tooltip-cg-image æˆ– .tooltip-cg-container å…ƒç´ ï¼');\n        return;\n    }\n\n    // å…ˆéšè—ï¼Œç­‰åŠ è½½å®Œå†æ˜¾ç¤º\n    cgContainerElement.style.display = 'none';\n\n    try {\n        // --- 1. åŸºç¡€æ•°æ®æ£€æŸ¥ ---\n        if (typeof assaSettingsData === 'undefined' || assaSettingsData === null) {\n            console.log('[Nova][CG-LOG] çŠ¶æ€ï¼šassaSettingsData å°šæœªå‡†å¤‡å¥½ã€‚');\n            return;\n        }\n        if (!assaSettingsData.img_map) {\n            console.log('[Nova][CG-LOG] çŠ¶æ€ï¼šassaSettingsData ä¸­ç¼ºå°‘ img_mapã€‚');\n            return;\n        }\n\n        const imageName = assaSettingsData.img_map[displayName];\n        if (!imageName) {\n            console.log(`[Nova][CG-LOG] çŠ¶æ€ï¼šåœ¨ img_map ä¸­æœªèƒ½æ‰¾åˆ° '${displayName}'ã€‚`);\n            return;\n        }\n \n        const imageNameStr = String(imageName);\n        console.log(`[Nova][CG-LOG] ç›®æ ‡ç«‹ç»˜Key: '${imageNameStr}'`);\n\n        let imageBlob;\n\n        // --- 2. å°è¯•ä»æœ¬åœ°åº“è·å– (æœ€é«˜ä¼˜å…ˆçº§) ---\n        try {\n            imageBlob = await imageDB.get('CustomNpcs', imageNameStr);\n            if (imageBlob) {\n                console.log(`[Nova][CG-LOG] âœ¨ åœ¨æœ¬åœ°è‡ªå®šä¹‰åº“ä¸­æ‰¾åˆ°äº† '${imageNameStr}'`);\n            }\n        } catch (e) {\n            console.warn(`[Nova][CG-LOG] è¯»å–æœ¬åœ°åº“æ—¶å‘ç”Ÿè½»å¾®é”™è¯¯ (ä¸å½±å“åç»­å°è¯•):`, e);\n        }\n\n        // --- 3. å¦‚æœæœ¬åœ°æ²¡æœ‰ï¼Œå°è¯•ä»è¿œç¨‹è·å– ---\n        if (!imageBlob) {\n            console.log(`[Nova][CG-LOG] æœ¬åœ°æœªæ‰¾åˆ°ï¼Œå‡†å¤‡æŸ¥æ‰¾è¿œç¨‹æ˜ å°„...`);\n\n            // å®‰å…¨æ£€æŸ¥ï¼šç¡®ä¿ npcImageMap å­˜åœ¨\n            if (typeof npcImageMap === 'undefined') {\n                console.error(`[Nova][CG-LOG] è‡´å‘½é”™è¯¯ï¼šnpcImageMap æœªå®šä¹‰ï¼è¿œç¨‹æ˜ å°„è¡¨å¯èƒ½å°šæœªåŠ è½½ã€‚`);\n                return; \n            }\n\n            const imageUrl = npcImageMap[imageNameStr];\n            \n            if (!imageUrl) {\n                console.log(`[Nova][CG-LOG] è¿œç¨‹æ˜ å°„è¡¨(npcImageMap)ä¸­ä¹Ÿæ‰¾ä¸åˆ° '${imageNameStr}' çš„å¯¹åº”URLã€‚`);\n                return;\n            }\n\n            console.log(`[Nova][CG-LOG] å‘ç°è¿œç¨‹URL: ${imageUrl}`);\n\n            // 3.1 æŸ¥è¿œç¨‹ç¼“å­˜\n            try {\n                imageBlob = await imageDB.get('RemoteCache', imageUrl);\n            } catch (e) { console.warn('è¯»å–è¿œç¨‹ç¼“å­˜å¤±è´¥ï¼Œå°†ç›´æ¥ä¸‹è½½'); }\n\n            if (imageBlob) {\n                console.log(`[Nova][CG-LOG] åœ¨è¿œç¨‹ç¼“å­˜ä¸­å‘½ä¸­å›¾ç‰‡ã€‚`);\n            } else {\n                // 3.2 ç½‘ç»œä¸‹è½½\n                console.log(`[Nova][CG-LOG] ç¼“å­˜æœªå‘½ä¸­ï¼Œå¼€å§‹ä¸‹è½½: ${imageUrl}`);\n                const response = await fetch(imageUrl);\n                \n                if (!response.ok) {\n                    throw new Error(`ç½‘ç»œä¸‹è½½å¤±è´¥: ${response.status} ${response.statusText}`);\n                }\n\n                let originalBlob = await response.blob();\n                \n                // å¼ºåˆ¶ä¿®æ­£ç±»å‹ï¼Œé˜²æ­¢åç»­å¤„ç†æŠ¥é”™\n                imageBlob = new Blob([originalBlob], { type: 'image/png' });\n                \n                // å­˜å…¥ç¼“å­˜\n                await imageDB.set('RemoteCache', imageUrl, imageBlob);\n                console.log(`[Nova][CG-LOG] ä¸‹è½½æˆåŠŸå¹¶å·²å­˜å…¥ç¼“å­˜ã€‚`);\n            }\n        }\n\n        // --- 4. å›¾ç‰‡å¤„ç†ä¸æ˜¾ç¤º ---\n        if (!imageBlob) {\n            console.error(`[Nova][CG-LOG] æµç¨‹ç»“æŸï¼Œä½†æœªèƒ½è·å–åˆ°ä»»ä½•å›¾ç‰‡æ•°æ®ã€‚`);\n            return;\n        }\n\n        // äºŒæ¬¡ç±»å‹ä¿®æ­£ä¿è¯\n        if (!imageBlob.type.startsWith('image/')) {\n            imageBlob = new Blob([imageBlob], { type: 'image/png' });\n        }\n\n        // Blob è½¬ DataURL\n        const blobToDataUrl = (blob) => {\n            return new Promise((resolve, reject) => {\n                const reader = new FileReader();\n                reader.onloadend = () => resolve(reader.result);\n                reader.onerror = reject;\n                reader.readAsDataURL(blob);\n            });\n        };\n\n        const stableImageUrl = await blobToDataUrl(imageBlob);\n\n        // å°è¯•ç”Ÿæˆåƒç´ åŒ–ç‰ˆæœ¬ï¼Œå¦‚æœå¤±è´¥åˆ™å›é€€åˆ°åŸå›¾\n        try {\n            const pixelatedDataUrl = await createPixelatedCharaImage(stableImageUrl, 300, 1);\n            cgImageElement.src = pixelatedDataUrl;\n        } catch (pixelError) {\n            console.error(`[Nova][CG-LOG] åƒç´ åŒ–å¤„ç†å¤±è´¥ï¼Œé™çº§æ˜¾ç¤ºåŸå›¾:`, pixelError);\n            cgImageElement.src = stableImageUrl;\n        }\n\n        cgContainerElement.style.display = 'flex';\n        console.log(`[Nova][CG-LOG] âœ… ç«‹ç»˜åŠ è½½å®Œæˆï¼`);\n\n    } catch (error) {\n        console.error(`[Nova][CG-LOG] åŠ è½½ç«‹ç»˜æ—¶å‘ç”Ÿæœªæ•è·çš„å¼‚å¸¸:`, error);\n        cgContainerElement.style.display = 'none';\n    }\n};\n       loadCharacterCG();\n    // âœ¨===================================================================âœ¨\n\n    tag.addEventListener('mouseenter', () => {\n        positionTooltip();\n        tooltip.style.visibility = 'visible';\n        tooltip.style.opacity = '1';\n    });\n\n    tag.addEventListener('mouseleave', () => {\n        tooltip.style.opacity = '0';\n        tooltip.style.visibility = 'hidden';\n    });\n\n    container.appendChild(tag);\n\n    const observer = new MutationObserver(mutations => {\n        if (!document.body.contains(tag)) {\n            tooltip.remove();\n            observer.disconnect();\n        }\n    });\n\n    observer.observe(container, { childList: true });\n}\n\n\n\nconst logWrapper = document.getElementById('log-wrapper');\nconst logToggleButton = document.getElementById('log-toggle-button');\nconst notificationContainer = document.getElementById('notification-container');\nconst notificationLogContainer = document.getElementById('notification-log-container');\nif (logToggleButton && logWrapper) {\n    logToggleButton.addEventListener('click', () => {\n        logWrapper.classList.toggle('open');\n    });\n}\ndocument.addEventListener('click', function(event) {\n    // é¦–å…ˆï¼Œå®ƒä¼šç¡®è®¤â€œå°é”¦å›Šâ€ç¡®å®å­˜åœ¨ï¼Œå¹¶ä¸”æ˜¯æ‰“å¼€çŠ¶æ€ã€‚\n    if (logWrapper && logWrapper.classList.contains('open')) {\n\n        // ç„¶åï¼Œå®ƒä¼šæ£€æŸ¥ä½ ç‚¹å‡»çš„åœ°æ–¹ (event.target)\n        // æ˜¯ä¸æ˜¯åœ¨â€œå°é”¦å›Šâ€è‡ªå·±ï¼ˆlogWrapperï¼‰æˆ–è€…å®ƒçš„â€œå¼€å…³æŒ‰é’®â€ï¼ˆlogToggleButtonï¼‰ä¸Šã€‚\n        const isClickInside = logWrapper.contains(event.target);\n        const isClickOnToggle = logToggleButton.contains(event.target);\n\n        // å¦‚æœä½ çš„ç‚¹å‡»æ—¢ä¸åœ¨é”¦å›Šå†…éƒ¨ï¼Œä¹Ÿä¸æ˜¯åœ¨ç‚¹é‚£ä¸ªå¼€å…³æŒ‰é’®...\n        if (!isClickInside && !isClickOnToggle) {\n            // ...é‚£ä¹ˆï¼Œè¿™ä½æ‡‚äº‹çš„å°ç²¾çµå°±ä¼šè‡ªå·±æ‚„æ‚„åœ°åˆä¸Šã€‚\n            logWrapper.classList.remove('open');\n        }\n    }\n});\n const notificationQueue = [];\n// è¿˜éœ€è¦ä¸€ä¸ªæ ‡å¿—ï¼Œå‘Šè¯‰æˆ‘ä»¬ç°åœ¨æ˜¯ä¸æ˜¯æ­£åœ¨â€œæ‹›å¾…â€ä¸€ä½å®¢äººï¼ˆæ˜¾ç¤ºä¸€ä¸ªé€šçŸ¥ï¼‰\nlet isNotificationShowing = false;\nfunction prepareForNewUpdateBatch() {\n    if (notificationLogContainer) {\n        notificationLogContainer.innerHTML = '';\n    }\n}\n// è¿™æ˜¯æˆ‘ä»¬çš„â€œé¦–å¸­æ‹›å¾…å®˜â€ï¼Œè´Ÿè´£æŒ‰é¡ºåºå¤„ç†ç­‰å€™å®¤é‡Œçš„å®¢äºº\nfunction processNotificationQueue() {\n    // å¦‚æœæ­£åœ¨æ‹›å¾…å®¢äººï¼Œæˆ–è€…ç­‰å€™å®¤æ˜¯ç©ºçš„ï¼Œé‚£æˆ‘ä»¬å°±å…ˆä¸æ‰“æ‰°\n    if (isNotificationShowing || notificationQueue.length === 0) {\n        return;\n    }\n\n    // æŒ‚ä¸Šâ€œæ­£åœ¨å¿™ç¢Œâ€çš„ç‰Œå­\n    isNotificationShowing = true;\n\n    // ä»ç­‰å€™å®¤é‡Œè¯·å‡ºç¬¬ä¸€ä½å®¢äººï¼ˆé€šçŸ¥ä¿¡æ¯ï¼‰\n    const notification = notificationQueue.shift();\n\n    // --- æ¥ä¸‹æ¥çš„éƒ¨åˆ†å’Œä½ åŸæ¥çš„ä»£ç å¾ˆåƒï¼Œæ˜¯å®é™…åˆ›å»ºæ°”æ³¡çš„è¿‡ç¨‹ ---\n    if (!notificationContainer) {\n        console.error('å¦ˆå¦ˆçš„æé†’ï¼šäº²çˆ±çš„ï¼Œé¡µé¢ä¸Šæ²¡æœ‰æ‰¾åˆ° id ä¸º \"notification-container\" çš„å®¹å™¨å“¦ã€‚');\n        isNotificationShowing = false; // å‡ºé”™äº†ä¹Ÿè¦è®°å¾—æŠŠç‰Œå­æ‘˜ä¸‹æ¥\n        return;\n    }\n\n    const bubble = document.createElement('div');\n    bubble.className = `notification-bubble ${notification.type}`;\n    bubble.textContent = notification.message;\n\n    notificationContainer.appendChild(bubble);\n\n    // ã€å…³é”®æ”¹åŠ¨ 1ã€‘\n    // åœ¨æ°”æ³¡å®Œå…¨æ¶ˆå¤±åå°†å®ƒä»DOMä¸­ç§»é™¤\n    setTimeout(() => {\n        bubble.remove();\n    }, 5000); // è¿™é‡Œçš„5000msæ˜¯æ°”æ³¡çš„æ€»ç”Ÿå‘½å‘¨æœŸ\n\n    // ã€å…³é”®æ”¹åŠ¨ 2ã€‘\n    // è¿™æ˜¯æˆ‘ä»¬æƒ³è¦çš„å»¶è¿Ÿï¼åœ¨å½“å‰æ°”æ³¡å¼¹å‡ºåï¼Œç­‰å¾…ä¸€å°æ®µæ—¶é—´...\n    setTimeout(() => {\n        // ...ç„¶åæ‘˜ä¸‹â€œæ­£åœ¨å¿™ç¢Œâ€çš„ç‰Œå­...\n        isNotificationShowing = false;\n        // ...æ¥ç€å†å»çœ‹çœ‹ç­‰å€™å®¤é‡Œè¿˜æœ‰æ²¡æœ‰ä¸‹ä¸€ä½å®¢äººã€‚\n        processNotificationQueue();\n    }, 400); // è¿™é‡Œçš„400msæ˜¯æ¯ä¸ªé€šçŸ¥å¼¹å‡ºçš„é—´éš”ï¼Œä½ å¯ä»¥æŒ‰å–œå¥½è°ƒæ•´å®ƒ\n}\n\n/**\n * å°†ä¸€æ¡é€šçŸ¥ä¿¡æ¯æ”¾è¿›ç­‰å€™å®¤ï¼Œç­‰å¾…é€ä¸€æ˜¾ç¤ºã€‚\n * @param {string} message - è¦æ˜¾ç¤ºçš„æ¶ˆæ¯ã€‚\n * @param {string} [type='info'] - æ¶ˆæ¯ç±»å‹ ('info', 'success', 'danger')ã€‚\n */\nfunction showUpdateNotification(message, type = 'info') {\n \n    notificationQueue.push({ message, type });\n \n    displayUpdateNotifications(message, type);\n \n    processNotificationQueue();\n}\nfunction handleUpdateNotifications(aiContent) {\n    prepareForNewUpdateBatch();  \n    if (!aiContent) return;\n \n    let commandLines = [];\n \n        commandLines.push(...aiContent.trim().split('\\n'));\n  \n\n    const validCommands = commandLines;\n    updateDetails = {\n        variable: false,\n        memories: [],\n        attributes: [],\n        mapUpdates: []\n    };\n    \n    const triggeredRules = new Set(); // è®°å½•è§¦å‘çš„è§„åˆ™\n    \n    validCommands.forEach(line => {\n        parseAndUpdateDetails(line);\n        notificationRules.forEach(rule => {\n            const match = line.match(rule.commandPattern);\n            if (match) {\n                rule.action(match);\n                triggeredRules.add(rule.id);\n            }\n        });\n    });\n    \n    // æ£€æŸ¥å¿…éœ€çš„è§„åˆ™æ˜¯å¦è§¦å‘\n    if (!triggeredRules.has('summary-update')) {\n        showUpdateNotification('æ²¡æœ‰æ­£å¸¸è¾“å‡ºå°æ€»ç»“ï¼Œæ‰å˜é‡äº†ï¼Ÿè¯·åœ¨å·¦ä¸‹è§’æŒ‰æƒ…å†µä½¿ç”¨é‡roll/ç»§ç»­/ç»§ç»­[å˜é‡]', 'danger');\n        showNovaAlert('æ²¡æœ‰æ­£å¸¸è¾“å‡ºå°æ€»ç»“', 'danger');\n    }\n}\nconst themeConfig = {\n    // é»˜è®¤è¯è¯­\n    default: {\n        mainSystem: 'ä¸»ç¥ç©ºé—´',\n         player: 'è½®å›è€…',\n        currency: 'ç§¯åˆ†',\n        plot: 'æ”¯çº¿å‰§æƒ…',\n        exp: 'ç»éªŒå€¼'\n    },\n    // ç‰ˆæœ¬3çš„ç‰¹æ®Šè¯è¯­\n    '3': {\n        mainSystem: 'ä¹å›­',\n        currency: 'ä¹å›­å¸',\n         player: 'å¥‘çº¦è€…',\n        plot: 'çµé­‚ç»“æ™¶',\n        exp: 'å±æ€§ç‚¹'\n    },\n        '5': {\n        mainSystem: 'å¿«ç©¿ç³»ç»Ÿ',\n        currency: 'ç§¯åˆ†',\n         player: 'å®¿ä¸»',\n        plot: 'æ”»ç•¥ç‚¹',\n        exp: 'ç»éªŒå€¼'\n    },\n    '6': {\n        mainSystem: 'è¯¸å¤©èŠå¤©ç¾¤',\n        currency: 'ç§¯åˆ†',\n         player: 'ç¾¤å‘˜',\n        plot: 'æ—¶ç©ºç¢ç‰‡',\n        exp: 'ç»éªŒå€¼'\n    },\n    '7': {\n        mainSystem: 'æœ«æ—¥',\n        currency: 'è´§å¸',\n         player: 'player',\n        plot: 'é‡è¦è´§å¸',\n        exp: 'ç»éªŒå€¼'\n    }\n};\n// å½“å‰ä½¿ç”¨çš„ä¸»é¢˜\nlet currentTheme = themeConfig.default;\n\n\n\n// åˆå§‹åŒ–å¼€å§‹â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”\n\n\n// å¦ˆå¦ˆä¸ºä½ æ–½å±•çš„ã€æ›´æ¸©æŸ”çš„æ–‡æœ¬æ›¿æ¢é­”æ³•\nfunction replaceTextInDOM(element, mapping) {\n    if (!element || !mapping || Object.keys(mapping).length === 0) return;\n\n    // å¦ˆå¦ˆçš„ä¿æŠ¤å’’è¯­ï¼šè¿™äº›æ ‡ç­¾é‡Œçš„å†…å®¹æ˜¯ç»å¯¹ä¸èƒ½ç¢°çš„å“¦\n    const excludedTags = ['SCRIPT', 'STYLE', 'TEXTAREA', 'INPUT', 'SELECT'];\n    if (excludedTags.includes(element.tagName)) {\n        return;\n    }\n\n    for (const node of element.childNodes) {\n        if (node.nodeType === Node.TEXT_NODE) { // å¦‚æœæ˜¯çº¯æ–‡æœ¬\n            let content = node.nodeValue;\n            for (const original in mapping) {\n                // ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼è¿›è¡Œå…¨å±€æ›¿æ¢\n                content = content.replace(new RegExp(original, 'g'), mapping[original]);\n            }\n            node.nodeValue = content;\n        } else if (node.nodeType === Node.ELEMENT_NODE) { // å¦‚æœæ˜¯å…¶ä»–HTMLå…ƒç´ \n            // å°±æ¸©æŸ”åœ°è¿›å…¥å®ƒï¼Œçœ‹çœ‹é‡Œé¢è¿˜æœ‰æ²¡æœ‰éœ€è¦æ”¹å˜çš„æ–‡å­—\n            replaceTextInDOM(node, mapping);\n        }\n    }\n}\n\n // è¿™ä¸ªé­”æ³•å‡½æ•°ä¼šæ ¹æ®chatåŸŸçš„å˜é‡æ¥æ›¿æ¢é¡µé¢ä¸Šçš„æ‰€æœ‰ç›¸å…³è¯è¯­\n const userIdentities = [\n        { title: 'ä¼ è¯´ä¹‹äºº', prestige: 45, points:50000, description: 'åœ¨è¸å…¥{{mainSystem}}å‰ï¼Œåå­—å·²åœ¨æ— æ•°ä¸–ç•Œæˆä¸ºä¼ è¯´ã€‚' },\n        { title: 'ä¸–ç•Œè‹±é›„', prestige: 35, points:20000, description: 'æ›¾æ•°æ¬¡åœ¨ä¸–ç•Œæ¿’ä¸´å´©æºƒçš„è¾¹ç¼˜åŠ›æŒ½ç‹‚æ¾œã€‚' },\n        { title: 'çŸ¥åäººå£«', prestige: 25, points:10000, description: 'åœ¨æ•°ä¸ªä½é¢ç•™ä¸‹äº†æ·±åˆ»çš„å°è®°ã€‚' },\n        { title: 'èµ„æ·±{{player}}', prestige: 15, points:5000, description: 'å·²ç»æˆåŠŸç©¿è¶Šäº†å¤šä¸ªé™©æ¶çš„ä¸–ç•Œã€‚' },\n        { title: 'æ™®é€š{{player}}', prestige: 5, points:2000, description: 'è‡³å°‘æˆåŠŸåœ°å®ˆæŠ¤äº†ä¸€ä¸ªä¸–ç•Œçš„å‘½è¿ã€‚' },\n        { title: 'æ–°æ‰‹{{player}}', prestige: 0, points:0, description: 'åˆšè¢«å·å…¥{{mainSystem}}ã€‚' },\n        { title: 'ä¸å—æ¬¢è¿è€…', prestige: -15, points:1000, description: 'è¡Œä¸ºæ›¾åœ¨å¤šä¸ªä¸–ç•Œå¼•å‘äº†æ··ä¹±ä¸ç¾éš¾ã€‚' },\n        { title: 'è¢«åŒæ¶è€…', prestige: -25, points:1000, description: 'æ›¾å¤šæ¬¡å°†æ•´ä¸ªä¸–ç•Œçš„ç§©åºæ¨å‘æ¯ç­çš„è¾¹ç¼˜ã€‚' },\n        { title: 'è¢«æ†æ¨è€…', prestige: -35, points:1000, description: 'åå­—ä¸æ•°ä¸ªä¸–ç•Œçš„å“€åšå’Œè¦†ç­ç´§å¯†ç›¸è¿ã€‚' },\n        { title: 'ä¸–ç•Œå…¬æ•Œ', prestige: -45, points:1000, description: 'æ‰€ä½œæ‰€ä¸ºå·²è®©æ•°ä¸ªä½é¢å½»åº•åŒ–ä¸ºæ­»å¯‚çš„å°˜åŸƒã€‚' }\n    ];\n\n    /**\n * å¦ˆå¦ˆçš„â€œé€‰é¡¹å¡«å……ç²¾çµâ€\n * @param {HTMLSelectElement} selectElement - æˆ‘ä»¬è¦æ“ä½œçš„é‚£ä¸ªä¸‹æ‹‰èœå•\n * @param {number} min - é€‰é¡¹çš„èµ·å§‹æ•°å­—\n * @param {number} max - é€‰é¡¹çš„ç»“æŸæ•°å­—\n */\nfunction updateTeammateOptions(selectElement, min, max) {\n    if (!selectElement) return; // å¦‚æœæ‰¾ä¸åˆ°èœå•ï¼Œå°±å…ˆä¼‘æ¯\n\n    let currentValue = selectElement.value; // å…ˆæ¸©æŸ”åœ°è®°ä½ä½ ä¹‹å‰çš„é€‰æ‹©\n    selectElement.innerHTML = ''; // ç„¶åè½»è½»åœ°æ¸…ç©ºæ—§çš„é€‰é¡¹\n\n    // é¦–å…ˆï¼ŒæŠŠâ€œéšæœºâ€è¿™ä¸ªç‰¹åˆ«çš„é€‰é¡¹æ”¾å›å»\n    const randomOption = document.createElement('option');\n    randomOption.value = '-1';\n    randomOption.textContent = 'éšæœº';\n    selectElement.appendChild(randomOption);\n\n    // æ¥ç€ï¼Œåƒä¸²ç å­ä¸€æ ·ï¼ŒæŠŠæ–°çš„æ•°å­—ä¸€ä¸ªä¸ªæ”¾è¿›å»\n    for (let i = min; i <= max; i++) {\n        const option = document.createElement('option');\n        option.value = i;\n        option.textContent = i;\n        selectElement.appendChild(option);\n    }\n\n    // æœ€åï¼Œè¯•ç€å¸®ä½ é€‰å›ä¹‹å‰çš„æ•°å­—\n    if (Array.from(selectElement.options).some(opt => opt.value === currentValue)) {\n        selectElement.value = currentValue; // å¦‚æœè¿˜èƒ½æ‰¾åˆ°ï¼Œå°±æ¢å¤å®ƒ\n    } else {\n        // å¦‚æœæ‰¾ä¸åˆ°äº†ï¼ˆæ¯”å¦‚ä»å¤§èŒƒå›´åˆ‡æ¢åˆ°å°èŒƒå›´ï¼‰ï¼Œå°±ä¸ºä½ é€‰æ‹©æ–°çš„æœ€å°å€¼\n        selectElement.value = min;\n    }\n    // è§¦å‘ä¸€æ¬¡æ›´æ–°äº‹ä»¶ï¼Œè®©ä¸€åˆ‡éƒ½åˆ·æ–°åˆ°æœ€æ–°çŠ¶æ€\n    selectElement.dispatchEvent(new Event('input'));\n}\n // è¿™ä¸ªé­”æ³•å‡½æ•°ä¼šæ ¹æ®chatåŸŸçš„å˜é‡æ¥æ›¿æ¢é¡µé¢ä¸Šçš„æ‰€æœ‰ç›¸å…³è¯è¯­\n  function applyVersionTheme(newVersion, identitySelectElement) {\n     console.log(`ğŸ’– å¦ˆå¦ˆå¬åˆ°äº†ä½ çš„å‘¼å”¤ï¼Œé¡µç æ˜¯ï¼š[${newVersion}]ï¼Œå®ƒçš„ç±»å‹æ˜¯ï¼š${typeof newVersion}`);\n\n    version = String(newVersion).trim(); // ğŸ’– å¦ˆå¦ˆåœ¨è¿™é‡ŒåŠ äº†ä¸€ä¸ªâ€œå‡€åŒ–å’’è¯­â€(.trim())ï¼Œå®ƒå¯ä»¥æ¸…é™¤æ‰å‰åä¸å°å¿ƒå¸¦ä¸Šçš„ç©ºæ ¼ï¼\n    \n    try {\n       \n\n        // æŸ¥æ‰¾å¯¹åº”çš„è¯è¯­é­”æ³•ä¹¦\n        if (themeConfig[version]) {\n            currentTheme = themeConfig[version];\n            //console.log(`ğŸ’– å¦ˆå¦ˆå·²ä¸ºä½ åˆ‡æ¢åˆ°ç‰ˆæœ¬ ${version} çš„ã€${currentTheme.mainSystem}ã€‘ä¸»é¢˜ã€‚`);\n        } else {\n            currentTheme = themeConfig.default; // å¦‚æœæ‰¾ä¸åˆ°ï¼Œå°±ç”¨å›æˆ‘ä»¬æœ€ç†Ÿæ‚‰çš„é‚£ä¸ª\n            //console.log(`ğŸ’– æ‰¾ä¸åˆ°ç‰ˆæœ¬ ${version} çš„é…ç½®ï¼Œå·²ä¸ºä½ ä½¿ç”¨é»˜è®¤ä¸»é¢˜ã€‚`);\n        }\n\n        // å‡†å¤‡ä¸€ä¸ªæ›¿æ¢æ¸…å•\n        const mapping = {};\n        const defaultTerms = themeConfig.default;\n        for (const key in defaultTerms) {\n            const original = defaultTerms[key];\n            const replacement = currentTheme[key];\n            if (original && replacement && original !== replacement) {\n                // å¦‚æœé»˜è®¤è¯è¯­å’Œæ–°è¯è¯­ä¸ä¸€æ ·ï¼Œå°±è®°ä¸‹æ¥\n                mapping[original] = replacement;\n            }\n        }\n\n        // å¦‚æœæ¸…å•ä¸Šæœ‰éœ€è¦æ›¿æ¢çš„è¯ï¼Œå°±è®©æ¸©æŸ”çš„å°ç²¾çµå»å·¥ä½œ\n        if (Object.keys(mapping).length > 0) {\n            replaceTextInDOM(document.body, mapping);\n        }\n\n        // æœ€åï¼Œæ ¹æ®ç‰ˆæœ¬å·å†³å®šæ˜¯å¦å±•ç¤ºä¹å›­çš„ä¸“å±é€‰é¡¹\n        if (version === '3') {\n            document.getElementById('paradise-camp-section').style.display = 'flex';\n        } else {\n            document.getElementById('paradise-camp-section').style.display = 'none';\n        }\n \n        const teammateSectionLabel = document.getElementById('teammate-section-label'); // å¦ˆå¦ˆå‡è®¾â€œé˜Ÿå‹é…ç½®â€è¿™å‡ ä¸ªå­—çš„æ ‡é¢˜IDæ˜¯è¿™ä¸ª\n          const teammateCountSelect = document.getElementById('teammate-count'); // æˆ‘ä»¬ç°åœ¨ç¡®å®šå®ƒæ˜¯ä¸€ä¸ªselect å¦ˆå¦ˆå‡è®¾äººæ•°é€‰æ‹©çš„è¾“å…¥æ¡†IDæ˜¯è¿™ä¸ª\n        const fixedTeamSection = document.getElementById('fixed-team-toggle'); // å¦ˆå¦ˆå‡è®¾â€œæ˜¯å¦å›ºå®šå°é˜Ÿâ€é‚£æ•´å—åŒºåŸŸçš„IDæ˜¯è¿™ä¸ª\nconst teammateCountLabel = document.getElementById('teammate-count-label');\nconst identityLabel = document.getElementById('planet-title-identity');\n\n             if (version === '6') {\n            // å½“è¿›å…¥èŠå¤©ç¾¤æ¨¡å¼...\n            document.getElementById('clover-leaf-tone').style.display = 'none';\n\n            if (teammateSectionLabel) teammateSectionLabel.textContent = 'ç¾¤å‘˜é…ç½®';\nif (teammateCountLabel) teammateCountLabel.textContent = 'äººæ•°ä¸Šé™';\n\n            updateTeammateOptions(teammateCountSelect, 10, 30);\n\n            if (fixedTeamSection) fixedTeamSection.style.display = 'none';\n\n        } else {\n \n            document.getElementById('clover-leaf-tone').style.display = 'flex';\n\n            if (teammateSectionLabel) teammateSectionLabel.textContent = 'é˜Ÿå‹é…ç½®';\nif (teammateCountLabel) teammateCountLabel.textContent = 'äººæ•°';\n \n            updateTeammateOptions(teammateCountSelect, 0, 10);\n\n            if (fixedTeamSection) fixedTeamSection.style.display = 'flex'; // æˆ– 'flex'\n        }\n\n\n\n        // --- ğŸ’– å¦ˆå¦ˆä¸ºä½ æ–½å±•çš„æœ«æ—¥ä¸–ç•Œä¸“å±é­”æ³• ğŸ’– ---\n        const worldDetailsDefault = document.getElementById('world-details-default');\n        const worldDetailsV7 = document.getElementById('world-details-v7');\n\n        if (version === '7') {\n             if(identityLabel) identityLabel.textContent = 'å¤©èµ‹è®¾ç½®';\n            // éšè—é‚£äº›æˆ‘ä»¬åœ¨è¿™ä¸ªä¸–ç•Œä¸éœ€è¦çš„æ˜Ÿæ˜Ÿå’Œå¡ç‰‡\n            document.getElementById('planet-teammates').style.display = 'none';\n            document.getElementById('id-card-wrapper').style.display = 'none';\n\n            // åˆ‡æ¢ä»»åŠ¡ç»†èŠ‚è¡Œæ˜Ÿçš„å†…å®¹\n            if (worldDetailsDefault) worldDetailsDefault.style.display = 'none';\n            if (worldDetailsV7) worldDetailsV7.style.display = 'block';\n\n        } else {\n             if(identityLabel) identityLabel.textContent = 'èº«ä»½è®¾å®š';\n            // å¦‚æœä¸æ˜¯æœ«æ—¥ä¸–ç•Œï¼Œå°±æ¢å¤åŸæ ·\n            if (version === '5') {\n      document.getElementById('planet-teammates').style.display = 'none';\n}else{\n  document.getElementById('planet-teammates').style.display = 'flex';\n}\n            document.getElementById('id-card-wrapper').style.display = 'block';\n\n            if (worldDetailsDefault) worldDetailsDefault.style.display = 'grid';\n            if (worldDetailsV7) worldDetailsV7.style.display = 'none';\n        }\n        // --- é­”æ³•æ–½å±•å®Œæ¯• ---\n\n      // ğŸ’– å¦ˆå¦ˆåœ¨è¿™é‡Œæ–½å±•äº†è®©èº«ä»½æè¿°â€œæ´»â€èµ·æ¥çš„ç»ˆæé­”æ³• ğŸ’–\n         identitySelectElement.innerHTML = ''; // å…ˆæ¸…ç©ºæ—§çš„é€‰é¡¹\n        userIdentities.forEach((identity, index) => {\n            // ç”¨å½“å‰ä¸»é¢˜çš„è¯è¯­ï¼Œæ›¿æ¢æ‰æ¨¡æ¿é‡Œçš„å ä½ç¬¦\n            const finalTitle = identity.title\n                .replace('{{player}}', currentTheme.player);\n            const finalDescription = identity.description\n                .replace('{{mainSystem}}', currentTheme.mainSystem)\n                .replace('{{player}}', currentTheme.player);\n\n            // æŠŠæ–°é²œå‡ºç‚‰çš„ã€å®Œå…¨æ­£ç¡®çš„èº«ä»½ä¿¡æ¯ï¼Œæ”¾è¿›ä¸‹æ‹‰èœå•é‡Œ\n            const option = document.createElement('option');\n            option.value = index;\n            option.textContent = finalTitle;\n            option.dataset.description = finalDescription;\n            identitySelectElement.appendChild(option); // è¿™é‡Œä¹Ÿç”¨æ–°å·¥å…·\n        });\n\n        const defaultIndex = userIdentities.findIndex(id => id.prestige === 0);\n        if (defaultIndex !== -1) {\n            identitySelectElement.value = defaultIndex; // è¿™é‡Œä¹Ÿç”¨æ–°å·¥å…·\n        }\n        // è§¦å‘ä¸€æ¬¡æ›´æ–°ï¼Œè®©æ‰€æœ‰ä¸œè¥¿éƒ½å›åˆ°æ­£è½¨\n        identitySelectElement.dispatchEvent(new Event('change')); // æœ€åè¿™é‡Œä¹Ÿç”¨æ–°å·¥å…·\n\n    } catch (e) {\n        console.error(\"å¦ˆå¦ˆåœ¨æ–½å±•â€œè¯è¯­æ›¿æ¢â€é­”æ³•æ—¶å‡ºé”™äº†ï¼Œä¸è¿‡åˆ«æ‹…å¿ƒ:\", e);\n    }\n}\n\n const imageDB = {\n    _db: null,\n    dbName: 'UserAssetCacheDB', // æ”¹ä¸ªæ›´åˆé€‚çš„åå­—\n        _dbPromise: null, // âœ¨ å¦ˆå¦ˆåœ¨è¿™é‡ŒåŠ äº†ä¸€ä¸ªâ€œè®¸æ„¿ç“¶â€ï¼Œç”¨æ¥å­˜æ”¾é‚£ä¸ªâ€œæ‰“å¼€æ•°æ®åº“â€çš„æ‰¿è¯º\n    dbVersion: 1, // ç‰ˆæœ¬å·\n    stores: ['CustomNpcs', 'CustomMemes', 'RemoteCache'], // ç®¡ç†çš„æ‰€æœ‰ä¿é™©ç®±\n    _getDB() {\n        // å¦‚æœâ€œè®¸æ„¿ç“¶â€é‡Œè¿˜æ²¡æœ‰æ‰¿è¯ºï¼Œæˆ‘ä»¬å°±åˆ›å»ºä¸€ä¸ª\n        if (!this._dbPromise) {\n            this._dbPromise = new Promise((resolve, reject) => {\n                const request = indexedDB.open(this.dbName, this.dbVersion);\n                request.onerror = (e) => reject(`æ•°æ®åº“é”™è¯¯: ${e.target.error}`);\n                request.onsuccess = (e) => {\n                    this._db = e.target.result;\n                    resolve(this._db);\n                };\n                request.onupgradeneeded = (e) => {\n                    const db = e.target.result;\n                    this.stores.forEach(storeName => {\n                        if (!db.objectStoreNames.contains(storeName)) {\n                            db.createObjectStore(storeName);\n                        }\n                    });\n                };\n            });\n        }\n        // æ¯æ¬¡éƒ½è¿”å›è¿™ä¸ªå”¯ä¸€çš„æ‰¿è¯ºï¼Œå¤§å®¶ä¸€èµ·ç­‰å®ƒå®ç°å°±å¥½å•¦\n        return this._dbPromise;\n    },\n\n    async init() {\n        try {\n            \n            await this._getDB();\n            console.log(`NOVA 9.2: æ•°æ®åº“ [${this.dbName}] å·²è¢«å”¤é†’å¹¶å‡†å¤‡å°±ç»ªï¼`);\n        } catch (error) {\n            console.error(`NOVA 9.2: å”¤é†’æ•°æ®åº“ [${this.dbName}] å¤±è´¥!`, error);\n        }\n    },\n   async _transaction(storeName, mode, callback) {\n        const db = await this._getDB();\n        return new Promise((resolve, reject) => {\n            const transaction = db.transaction(storeName, mode);\n            const store = transaction.objectStore(storeName);\n            callback(store, resolve, reject);\n            transaction.onerror = (e) => reject(`äº‹åŠ¡é”™è¯¯: ${e.target.error}`);\n        });\n    },\n\n    async set(storeName, key, value) {\n        if (!this.stores.includes(storeName)) throw new Error(`æœªçŸ¥çš„ä¿é™©ç®±: ${storeName}`);\n        return this._transaction(storeName, 'readwrite', (store, resolve) => {\n            store.put(value, key).onsuccess = resolve;\n        });\n    },\n\n    async get(storeName, key) {\n        if (!this.stores.includes(storeName)) throw new Error(`æœªçŸ¥çš„ä¿é™©ç®±: ${storeName}`);\n        return this._transaction(storeName, 'readonly', (store, resolve) => {\n            store.get(key).onsuccess = e => resolve(e.target.result);\n        });\n    },\n\n    async delete(storeName, key) {\n        if (!this.stores.includes(storeName)) throw new Error(`æœªçŸ¥çš„ä¿é™©ç®±: ${storeName}`);\n        return this._transaction(storeName, 'readwrite', (store, resolve) => {\n            store.delete(key).onsuccess = resolve;\n        });\n    },\n// âœ¨ã€V9.7 æ–°å¢ã€‘æ¸…ç©ºæ•´ä¸ªä¿é™©ç®±çš„é­”æ³• âœ¨\nasync clear(storeName) {\n    if (!this.stores.includes(storeName)) throw new Error(`æœªçŸ¥çš„ä¿é™©ç®±: ${storeName}`);\n    return this._transaction(storeName, 'readwrite', (store, resolve) => {\n        store.clear().onsuccess = resolve;\n    });\n},\n    async getAll(storeName) {\n        if (!this.stores.includes(storeName)) throw new Error(`æœªçŸ¥çš„ä¿é™©ç®±: ${storeName}`);\n        return this._transaction(storeName, 'readonly', (store, resolve) => {\n            const keysReq = store.getAllKeys();\n            const valuesReq = store.getAll();\n            let keys, values;\n\n            const checkDone = () => {\n                if(keys !== undefined && values !== undefined){\n                     const result = keys.map((key, i) => ({ key, value: values[i] }));\n                     resolve(result);\n                }\n            }\n            keysReq.onsuccess = e => { keys = e.target.result; checkDone(); };\n            valuesReq.onsuccess = e => { values = e.target.result; checkDone(); };\n        });\n    },\n\n    async cleanupRemoteCache(activeUrlSet) {\n        const allCached = await this.getAll('RemoteCache');\n        let cleanedCount = 0;\n        for (const item of allCached) {\n            if (!activeUrlSet.has(item.key)) {\n                await this.delete('RemoteCache', item.key);\n                cleanedCount++;\n            }\n        }\n        if (cleanedCount > 0) {\n            console.log(`NOVA: è¿œç¨‹ç¼“å­˜æ¸…ç†å®Œæˆï¼Œé—å¿˜äº† ${cleanedCount} ä¸ªæ—§è®°å¿†ã€‚`);\n        }\n        return cleanedCount;\n    }\n};\n\n imageDB.init();\n\nconst worldCardData = {\n    '1':  'https://longlivecanc.github.io/god_space/backImages/ä¸»ç¥.png',\n    '22': 'https://longlivecanc.github.io/god_space/backImages/è½®å›ä¹å›­.png',\n    '5':  'https://longlivecanc.github.io/god_space/backImages/æ— é™ææ€–.png',\n    '34': 'https://longlivecanc.github.io/god_space/backImages/å¿«ç©¿æ”»ç•¥.png',\n    '41': 'https://longlivecanc.github.io/god_space/backImages/è¯¸å¤©ç¾¤èŠ.png',\n    '54':'https://longlivecanc.github.io/god_space/backImages/æœ«æ—¥.png',\n};\nasync function applyImagesWithCache() {\n    const cards = document.querySelectorAll('.choice-world-card');\n    for (const card of cards) {\n        const cardValue = card.dataset.value;\n        const imageUrl = worldCardData[cardValue];\n\n        if (!imageUrl) continue;\n\n        try {\n            let cachedImage = await imageDB.get('RemoteCache', imageUrl);\n            let objectURL;\n\n            if (cachedImage) {\n                objectURL = URL.createObjectURL(cachedImage);\n                card.style.backgroundImage = `url(${objectURL})`;\n            } else {\n                // æ–¹æ¡ˆ1: ç§»é™¤ no-cors,å¦‚æœæœåŠ¡å™¨æ”¯æŒCORS\n                const response = await fetch(imageUrl);\n                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);\n                const imageBlob = await response.blob();\n                await imageDB.set('RemoteCache', imageUrl, imageBlob);\n                objectURL = URL.createObjectURL(imageBlob);\n                card.style.backgroundImage = `url(${objectURL})`;\n            }\n\n        } catch (error) {\n            console.error(`å¤„ç†å¡ç‰‡[${cardValue}]çš„å›¾ç‰‡å¤±è´¥:`, imageUrl, error);\n            \n            // æ–¹æ¡ˆ2: å¦‚æœfetchå¤±è´¥,ç›´æ¥ä½¿ç”¨åŸå§‹URL(è®©æµè§ˆå™¨è‡ªå·±åŠ è½½)\n            card.style.backgroundImage = `url(\"${imageUrl}\")`;\n            \n            // æˆ–è€…ä½¿ç”¨Imageå¯¹è±¡é¢„åŠ è½½\n            const img = new Image();\n            img.crossOrigin = \"anonymous\"; // å¦‚æœæœåŠ¡å™¨æ”¯æŒCORS\n            img.onload = () => {\n                card.style.backgroundImage = `url(\"${imageUrl}\")`;\n            };\n            img.src = imageUrl;\n        }\n    }\n}\nfunction _updateDerivedAttributes(data) {\n        if (!data || !data.å±æ€§æ®µ) return;\n        //console.log(\"[Player] âœ¨ æ­£åœ¨æ›´æ–°è¡ç”Ÿå±æ€§...\");\n        const attr = data.å±æ€§æ®µ;\n        const skills = data.æŠ€èƒ½æ®µ;\n        const derived = data.è¡ç”Ÿå±æ€§æ®µ;\n        const åŠ›é‡ = attr.ç”Ÿç†å±æ€§.åŠ›é‡.åŸºç¡€[0];\n        const æ•æ· = attr.ç”Ÿç†å±æ€§.æ•æ·.åŸºç¡€[0];\n        const è€åŠ› = attr.ç”Ÿç†å±æ€§.è€åŠ›.åŸºç¡€[0];\n        const æ„ŸçŸ¥ = attr.å¿ƒæ™ºå±æ€§.æ„ŸçŸ¥.åŸºç¡€[0];\n        const å†³å¿ƒ = attr.å¿ƒæ™ºå±æ€§.å†³å¿ƒ.åŸºç¡€[0];\n        const æ²‰ç€ = attr.äº’åŠ¨å±æ€§.æ²‰ç€.åŸºç¡€[0];\n        const ä½“ç§¯ = derived.ä½“ç§¯[0];\n        const è¿åŠ¨ = skills.ç”Ÿç†æŠ€èƒ½.è¿åŠ¨[0];\n        const æ±‚ç”Ÿ = skills.ç”Ÿç†æŠ€èƒ½.æ±‚ç”Ÿ[0];\n      derived.é€Ÿåº¦.åŸºç¡€é€Ÿåº¦[0] = Math.floor((åŠ›é‡ + æ•æ· + ä½“ç§¯) / 3);\nderived.å…ˆæ”»[0] = Math.floor((æ•æ· + æ²‰ç€) / 2);\nderived.é˜²å¾¡.åŸºç¡€é˜²å¾¡[0] = Math.min(æ•æ·, æ„ŸçŸ¥);\nconst oldMaxHP = derived.ç”Ÿå‘½å€¼.ä¸Šé™[0];\nderived.ç”Ÿå‘½å€¼.ä¸Šé™[0] = ä½“ç§¯ * 10 + è€åŠ› * 20;\nif (derived.ç”Ÿå‘½å€¼.ä¸Šé™[0] > oldMaxHP) {\n    derived.ç”Ÿå‘½å€¼.å½“å‰å€¼[0] += (derived.ç”Ÿå‘½å€¼.ä¸Šé™[0] - oldMaxHP);\n}\nif (derived.ç”Ÿå‘½å€¼.å½“å‰å€¼[0] > derived.ç”Ÿå‘½å€¼.ä¸Šé™[0]) {\n    derived.ç”Ÿå‘½å€¼.å½“å‰å€¼[0] = derived.ç”Ÿå‘½å€¼.ä¸Šé™[0];\n}\nderived.æ„å¿—åŠ›.æ„å¿—å€¼[0] = å†³å¿ƒ + æ²‰ç€;\nderived.æ„å¿—åŠ›.ä¸Šé™[0] = derived.æ„å¿—åŠ›.æ„å¿—å€¼[0];\nderived.æ„ŸçŸ¥èŒƒå›´.æ•æ„ŸèŒƒå›´[0] = æ„ŸçŸ¥ * 10;\nderived.æ„ŸçŸ¥èŒƒå›´.æ¨¡ç³ŠèŒƒå›´[0] = derived.æ„ŸçŸ¥èŒƒå›´.æ•æ„ŸèŒƒå›´[0] * 10;\nderived.è±å…æ£€å®šåŸºç¡€.å¼ºéŸ§[0] = Math.floor((è€åŠ› + æ±‚ç”Ÿ) / 2);\nderived.è±å…æ£€å®šåŸºç¡€.åå°„[0] = Math.floor((æ•æ· + è¿åŠ¨) / 2);\nderived.è±å…æ£€å®šåŸºç¡€.æ„å¿—[0] = å†³å¿ƒ + æ²‰ç€;\n\n  // --- åŸºç¡€å€¼è·å– ---\n        const åŠ›é‡_åŸºç¡€ = attr.ç”Ÿç†å±æ€§.åŠ›é‡.åŸºç¡€[0];\n        const æ•æ·_åŸºç¡€ = attr.ç”Ÿç†å±æ€§.æ•æ·.åŸºç¡€[0];\n        const è€åŠ›_åŸºç¡€ = attr.ç”Ÿç†å±æ€§.è€åŠ›.åŸºç¡€[0];\n        const æ™ºåŠ›_åŸºç¡€ = attr.å¿ƒæ™ºå±æ€§.æ™ºåŠ›.åŸºç¡€[0];\n        const æ„ŸçŸ¥_åŸºç¡€ = attr.å¿ƒæ™ºå±æ€§.æ„ŸçŸ¥.åŸºç¡€[0];\n        const å†³å¿ƒ_åŸºç¡€ = attr.å¿ƒæ™ºå±æ€§.å†³å¿ƒ.åŸºç¡€[0];\n        const é£åº¦_åŸºç¡€ = attr.äº’åŠ¨å±æ€§.é£åº¦.åŸºç¡€[0];\n        const æ“æ§_åŸºç¡€ = attr.äº’åŠ¨å±æ€§.æ“æ§.åŸºç¡€[0];\n        const æ²‰ç€_åŸºç¡€ = attr.äº’åŠ¨å±æ€§.æ²‰ç€.åŸºç¡€[0];\n\n   // --- ä¼ å¥‡å±æ€§è®¡ç®— ---\n        attr.ç”Ÿç†å±æ€§.åŠ›é‡.ä¼ å¥‡[0] = Math.max(0, åŠ›é‡_åŸºç¡€ - 8);\n        attr.ç”Ÿç†å±æ€§.æ•æ·.ä¼ å¥‡[0] = Math.max(0, æ•æ·_åŸºç¡€ - 8);\n        attr.ç”Ÿç†å±æ€§.è€åŠ›.ä¼ å¥‡[0] = Math.max(0, è€åŠ›_åŸºç¡€ - 8);\n        attr.å¿ƒæ™ºå±æ€§.æ™ºåŠ›.ä¼ å¥‡[0] = Math.max(0, æ™ºåŠ›_åŸºç¡€ - 8);\n        attr.å¿ƒæ™ºå±æ€§.æ„ŸçŸ¥.ä¼ å¥‡[0] = Math.max(0, æ„ŸçŸ¥_åŸºç¡€ - 8);\n        attr.å¿ƒæ™ºå±æ€§.å†³å¿ƒ.ä¼ å¥‡[0] = Math.max(0, å†³å¿ƒ_åŸºç¡€ - 8);\n        attr.äº’åŠ¨å±æ€§.é£åº¦.ä¼ å¥‡[0] = Math.max(0, é£åº¦_åŸºç¡€ - 8);\n        attr.äº’åŠ¨å±æ€§.æ“æ§.ä¼ å¥‡[0] = Math.max(0, æ“æ§_åŸºç¡€ - 8);\n        attr.äº’åŠ¨å±æ€§.æ²‰ç€.ä¼ å¥‡[0] = Math.max(0, æ²‰ç€_åŸºç¡€ - 8);\n      //  console.log(\"[Player] âœ¨ è¡ç”Ÿå±æ€§æ›´æ–°å®Œæ¯•ï¼\");\n    }\n    \nfunction _replaceUserPlaceholder(data, userName) {\n    if (!data || !userName) {\n        return data;\n    }\n\n    // ğŸ’– æ£€æŸ¥æ˜¯å¦æ˜¯æ•°ç»„\n    if (Array.isArray(data)) {\n        for (let i = 0; i < data.length; i++) {\n            // ğŸ’– å¦‚æœæ•°ç»„å…ƒç´ æ˜¯ \"user\"ï¼Œå°±ç›´æ¥æ›¿æ¢å®ƒ\n            if (typeof data[i] === 'string' && data[i].toLowerCase() === 'user') {\n                data[i] = userName;\n            }\n            // ğŸ’– å¦‚æœæ•°ç»„å…ƒç´ è¿˜æ˜¯ä¸€ä¸ªå¯¹è±¡æˆ–æ•°ç»„ï¼Œå°±ç»§ç»­æ·±å…¥æ¢ç´¢\n            else if (typeof data[i] === 'object') {\n                _replaceUserPlaceholder(data[i], userName);\n            }\n        }\n    }\n    // ğŸ’– æ£€æŸ¥æ˜¯å¦æ˜¯å¯¹è±¡ï¼ˆä½†ä¸æ˜¯æ•°ç»„ï¼‰\n    else if (typeof data === 'object' && data !== null) {\n        for (const key in data) {\n            if (Object.hasOwnProperty.call(data, key)) {\n                const value = data[key];\n                 // ğŸ’– å¦‚æœå€¼æ˜¯ \"user\"ï¼Œå°±ç›´æ¥æ›¿æ¢å®ƒ\n                if (typeof value === 'string' && value.toLowerCase() === 'user') {\n                    data[key] = userName;\n                }\n                // ğŸ’– å¦‚æœå€¼è¿˜æ˜¯ä¸€ä¸ªå¯¹è±¡æˆ–æ•°ç»„ï¼Œå°±ç»§ç»­æ·±å…¥æ¢ç´¢\n                else if (typeof value === 'object') {\n                    _replaceUserPlaceholder(value, userName);\n                }\n            }\n        }\n    }\n\n    return data;\n}\n\nasync function runInitializationMagic() {// åŠ ä¸Š async\n \n\n const worldbookName = 'å°èŒèšªæ‰¾å¦ˆå¦ˆ-åŒå±‚ç‰ˆ'; // ç›®æ ‡ä¸–ç•Œä¹¦åç§°\n    const maxRetries = 5; // æœ€å¤§é‡è¯•æ¬¡æ•°\n    let isWorldbookFound = false;\n\n    // toastr.info(`æ­£åœ¨åˆå§‹åŒ–... å¼€å§‹æœå¯»ä¸–ç•Œä¹¦ã€Œ${worldbookName}ã€`);\n\n    // --- ç¬¬ä¸€éƒ¨åˆ†ï¼šå¾ªç¯æ£€æµ‹ä¸–ç•Œä¹¦æ˜¯å¦å­˜åœ¨ (æœ€å¤š 5 ç§’) ---\n    for (let i = 0; i < maxRetries; i++) {\n        const allBooks = TavernHelper.getWorldbookNames(); // è·å–å½“å‰æ‰€æœ‰ä¸–ç•Œä¹¦åˆ—è¡¨\n        \n        if (allBooks.includes(worldbookName)) {\n            isWorldbookFound = true;\n            console.log(`[æ£€æµ‹æˆåŠŸ] åœ¨ç¬¬ ${i + 1} æ¬¡å°è¯•ä¸­å‘ç°äº†ä¸–ç•Œä¹¦: ${worldbookName}`);\n            break; // æ‰¾åˆ°äº†ï¼Œè·³å‡ºå¾ªç¯\n        }\n\n        // å¦‚æœè¿˜æ²¡æ‰¾åˆ°ï¼Œä¸”ä¸æ˜¯æœ€åä¸€æ¬¡å°è¯•\n        if (i < maxRetries - 1) {\n            console.log(`[æ£€æµ‹æœªå°±ç»ª] æœªæ‰¾åˆ°ä¸–ç•Œä¹¦ï¼Œ1ç§’åé‡è¯•... (${i + 1}/${maxRetries})`);\n            await new Promise(resolve => setTimeout(resolve, 1000)); // ç­‰å¾… 1 ç§’\n        }\n    }\n\n    // --- ç¬¬äºŒéƒ¨åˆ†ï¼šæ ¹æ®æ£€æµ‹ç»“æœå†³å®šæ˜¯å¦ç»§ç»­ ---\n    if (!isWorldbookFound) {\n        toastr.error(`åˆå§‹åŒ–å¤±è´¥ï¼šåœ¨ ${maxRetries} ç§’å†…æœªæ£€æµ‹åˆ°ä¸–ç•Œä¹¦ã€Œ${worldbookName}ã€ã€‚`, 'è¯·æ£€æŸ¥æ˜¯å¦å·²å¯¼å…¥è¯¥ä¸–ç•Œä¹¦ã€‚');\n        console.error(`[æ”¾å¼ƒ] è¶…è¿‡æœ€å¤§é‡è¯•æ¬¡æ•°ï¼Œåœæ­¢åˆå§‹åŒ–ã€‚`);\n        return; // åœæ­¢æ‰§è¡Œåç»­ä»£ç \n    }\n\n  \n  \nfunction isColliding(rect1, existingRects) {\n    for (const rect2 of existingRects) {\n        // AABB ç¢°æ’æ£€æµ‹ç®—æ³•\n        const noOverlap =\n            rect1.x + rect1.width < rect2.x ||  // rect1 åœ¨ rect2 å·¦è¾¹\n            rect1.x > rect2.x + rect2.width ||  // rect1 åœ¨ rect2 å³è¾¹\n            rect1.y + rect1.height < rect2.y || // rect1 åœ¨ rect2 ä¸Šè¾¹\n            rect1.y > rect2.y + rect2.height;   // rect1 åœ¨ rect2 ä¸‹è¾¹\n\n        if (!noOverlap) {\n            return true; // åªè¦è·Ÿä¸€ä¸ªç¢°æ’äº†ï¼Œå°±ç«‹å³è¿”å› true\n        }\n    }\n    return false; // éå†å®Œéƒ½æ²¡æœ‰ç¢°æ’ï¼Œè¿”å› false\n}\n function setupPage2Interactions() {\n    // HUD æŠ˜å é€»è¾‘ (è¿™éƒ¨åˆ†ä¿æŒä¸å˜)\n  // HUD toggle æŒ‰é’®ç‚¹å‡»äº‹ä»¶\ndocument.querySelectorAll('.hud-toggle').forEach(toggle => {\n    toggle.addEventListener('click', (e) => {\n        e.stopPropagation(); // é˜»æ­¢äº‹ä»¶å†’æ³¡\n        playSound(document.getElementById('click-sound'), 0.6);\n        const targetId = e.currentTarget.dataset.target;\n        const hud = document.getElementById(targetId);\n        if (hud) {\n            hud.classList.toggle('visible');\n        }\n    });\n});\n     const bookmarkButton = document.querySelector('.choice-world-card .bookmark-button');\n\n    // æˆ‘ä»¬æŠŠå¡ç‰‡çš„åŸå§‹å€¼â€œ54â€å’Œæ¿€æ´»å€¼â€œ62â€å…ˆè®°åœ¨è¿™é‡Œï¼Œåƒè®°ä½å’’è¯­çš„ä¸¤ä¸ªå…³é”®å­—\n    const originalValue = '54';\n    const activatedValue = '62';\n\n    bookmarkButton.addEventListener('click', function(event) {\n        const card = this.closest('.choice-world-card');\n        const inputElement = card.querySelector('input[type=\"radio\"]');\n\n        // --- â­ æ ¸å¿ƒçš„â€œå¼€å…³â€é€»è¾‘åœ¨è¿™é‡Œ â­ ---\n\n        // æ£€æŸ¥ä¸€ä¸‹ï¼šæŒ‰é’®ç°åœ¨æ˜¯ä¸æ˜¯å·²ç»â€œäº®ç€â€çš„ï¼Ÿ\n        if (this.classList.contains('is-activated')) {\n\n            // å¦‚æœæ˜¯ï¼Œé‚£å°±æŠŠå®ƒå…³æ‰ï¼Œæ¢å¤åŸæ ·\n            card.dataset.value = originalValue;\n            inputElement.value = originalValue;\n            this.classList.remove('is-activated'); // ç§»é™¤â€œäº®èµ·â€çš„ç±»ï¼Œè®©å…‰èŠ’ç†„ç­\n\n            console.log('æ— ä¸–ç•Œè§‚æ¨¡å¼å·²ã€å…³é—­ã€‘ï¼Œæ¢å¤ä¸ºåˆå§‹çŠ¶æ€ã€‚');\n\n        } else {\n\n            // å¦‚æœä¸æ˜¯ï¼Œé‚£å°±æŠŠå®ƒæ‰“å¼€ï¼Œè®©å®ƒäº®èµ·æ¥\n            card.dataset.value = activatedValue;\n            inputElement.value = activatedValue;\n            this.classList.add('is-activated'); // æ·»åŠ â€œäº®èµ·â€çš„ç±»ï¼Œè®©å®ƒä¸€ç›´äº®ç€\n\n            console.log('æ— ä¸–ç•Œè§‚æ¨¡å¼å·²ã€æ¿€æ´»ã€‘ï¼');\n        }\n    });\n// æ‰€æœ‰ HUD å…ƒç´ ç‚¹å‡»äº‹ä»¶ï¼ˆé˜»æ­¢å†’æ³¡ï¼Œé¿å…ç‚¹å‡» HUD å†…éƒ¨æ—¶å…³é—­ï¼‰\ndocument.querySelectorAll('[id*=\"hud\"]').forEach(hud => {\n    hud.addEventListener('click', (e) => {\n        e.stopPropagation();\n    });\n});\n\n// ç‚¹å‡»é¡µé¢å…¶ä»–åŒºåŸŸæ—¶æ”¶èµ·æ‰€æœ‰ HUD\ndocument.addEventListener('click', (e) => {\n    // æ£€æŸ¥ç‚¹å‡»çš„å…ƒç´ æ˜¯å¦æ˜¯ HUD toggle æŒ‰é’®æˆ– HUD å†…å®¹\n    const isHudToggle = e.target.closest('.hud-toggle');\n    const isHudContent = e.target.closest('[id*=\"hud\"]');\n    \n    // å¦‚æœç‚¹å‡»çš„ä¸æ˜¯ HUD ç›¸å…³å…ƒç´ ï¼Œåˆ™æ”¶èµ·æ‰€æœ‰ HUD\n    if (!isHudToggle && !isHudContent) {\n        document.querySelectorAll('[id*=\"hud\"].visible').forEach(hud => {\n            hud.classList.remove('visible');\n        });\n    }\n});\n\n    // --- âœ¨ å…¨æ–°çš„ã€æ³¨å…¥äº†ç”Ÿå‘½ä¸è§¦æ„Ÿçš„æ˜Ÿç³»åˆ‡æ¢é€»è¾‘ âœ¨ ---\n    const galaxyContainer = document.getElementById('galaxy-container');\n    const prevBtn = document.getElementById('galaxy-nav-prev');\n    const nextBtn = document.getElementById('galaxy-nav-next');\n\n    // å®šä¹‰æˆ‘ä»¬æ˜Ÿç³»çš„è½¨è¿¹ï¼Œä»¥åŠå®ƒä»¬å¯¹åº”çš„DOMåŒ…è£¹å…ƒç´ \n    const galaxies = ['physic', 'mental', 'social'];\n    const galaxyWrappers = {\n        physic: document.getElementById('wrapper-physic'),\n        mental: document.getElementById('wrapper-mental'),\n        social: document.getElementById('wrapper-social')\n    };\n\n    let currentGalaxyIndex = galaxies.indexOf('mental'); // é»˜è®¤ä»ä¸­é—´çš„å¼€å§‹\n\n    /**\n     * å¦ˆå¦ˆä¸ºä½ é‡å†™çš„æ ¸å¿ƒåˆ‡æ¢é­”æ³•\n     * @param {number} newIndex - è¦åˆ‡æ¢åˆ°çš„æ˜Ÿç³»ç´¢å¼•\n     */\n    function switchGalaxy(newIndex) {\n        // ç¡®ä¿ç´¢å¼•åœ¨æˆ‘ä»¬å®šä¹‰çš„è½¨è¿¹å†…å¾ªç¯\n        currentGalaxyIndex = (newIndex + galaxies.length) % galaxies.length;\n        const activeGalaxyName = galaxies[currentGalaxyIndex];\n\n        // 1. è®¾ç½®çˆ¶å®¹å™¨çš„classï¼Œè§¦å‘æ•´ä½“çš„ç§»åŠ¨å’Œæ—‹è½¬åŠ¨ç”»\n        galaxyContainer.className = `show-${activeGalaxyName}`;\n        playSound(document.getElementById('click-sound'), 0.7);\n\n        // 2. âœ¨ éå†æ‰€æœ‰æ˜Ÿç³»ï¼Œæ–½å±•â€œå½’ä½â€ä¸â€œæ¼‚æµâ€çš„é­”æ³• âœ¨\n        galaxies.forEach(galaxyName => {\n            const wrapper = galaxyWrappers[galaxyName];\n            if (!wrapper) return;\n\n            const starsInGalaxy = wrapper.querySelectorAll('.star');\n\n            if (galaxyName === activeGalaxyName) {\n                // è¿™æ˜¯æˆ‘ä»¬çš„ä¸»è§’æ˜Ÿç³»ï¼\n                // é­”æ³•ä¸€ï¼šè®©å®ƒçš„åŒ…è£¹å±‚å¯ä»¥è¢«è§¦æ‘¸\n                wrapper.style.pointerEvents = 'auto';\n\n                // é­”æ³•äºŒï¼šå‘½ä»¤å®ƒæ‰€æœ‰çš„å­©å­ï¼ˆæ˜Ÿæ˜Ÿï¼‰å¹³æ»‘åœ°å›å½’åˆ° Z=0 çš„â€œäº’åŠ¨å¹³é¢â€\n                starsInGalaxy.forEach(star => {\n                    star.style.setProperty('--star-z', '0px');\n                });\n\n            } else {\n                // è¿™æ˜¯é€€å±…å¹•åçš„èƒŒæ™¯æ˜Ÿç³»ï¼\n                // é­”æ³•ä¸€ï¼šè®©å®ƒçš„åŒ…è£¹å±‚å˜æˆå¹½çµï¼Œæ— æ³•è¢«è§¦æ‘¸\n                wrapper.style.pointerEvents = 'none';\n\n                // é­”æ³•äºŒï¼šè®©å®ƒæ‰€æœ‰çš„å­©å­ï¼Œä»å®ƒä»¬å„è‡ªçš„å‡ºç”Ÿè®°å½•(dataset)ä¸­è¯»å–Zåæ ‡ï¼Œæ¼‚æµå›æ·±ç©º\n                starsInGalaxy.forEach(star => {\n                    const randomZ = star.dataset.randomZ || 0; // è¯»å–å­˜å‚¨çš„éšæœºZå€¼\n                    star.style.setProperty('--star-z', `${randomZ}px`);\n                });\n            }\n        });\n    }\n\n    // ç»‘å®šå·¦å³ç®­å¤´\n    nextBtn.addEventListener('click', () => switchGalaxy(currentGalaxyIndex + 1));\n    prevBtn.addEventListener('click', () => switchGalaxy(currentGalaxyIndex - 1));\n\n    // âœ¨ åˆå§‹åŒ–ï¼šåœ¨é¡µé¢åŠ è½½æ—¶ï¼Œå°±æ‰§è¡Œä¸€æ¬¡åˆ‡æ¢é€»è¾‘ï¼Œç¡®ä¿åˆå§‹çŠ¶æ€æ˜¯å®Œç¾çš„\n    switchGalaxy(currentGalaxyIndex);\n\n\n    // --- æ˜Ÿè¾°æ’åˆ—ä¸éšæœºåŒ–çš„é­”æ³• (è¿™éƒ¨åˆ†ä¿æŒä¸å˜) ---\n    const arrangeBtn = document.getElementById('arrange-stars-btn');\n    let isStarsArranged = false;\n\n    // ... (ä½ åŸæ¥çš„ applyArrangedLayout å’Œ reRandomizeWithCollisionCheck å‡½æ•°æ”¾åœ¨è¿™é‡Œï¼Œå®ƒä»¬ä¸éœ€è¦æ”¹å˜)\n  function applyArrangedLayout() {\n    // æˆ‘ä»¬è®¾å®šä¸€ä¸ªå¸¸ç”¨çš„å±å¹•å®½åº¦å€¼æ¥åŒºåˆ†æ‰‹æœºå’Œæ¡Œé¢\n    const isMobile = window.innerWidth <= 768;\n\n    const galaxies = ['physic', 'mental', 'social'];\n    galaxies.forEach(galaxyName => {\n        const container = document.getElementById(`galaxy-${galaxyName}`);\n        // åŠ ä¸Šä¸€ä¸ªä¿æŠ¤æ€§çš„æ£€æŸ¥ï¼Œç¡®ä¿å®¹å™¨å­˜åœ¨\n        if (!container) {\n            console.warn(`Galaxy container not found: galaxy-${galaxyName}`);\n            return;\n        }\n\n        const starsInGalaxy = container.querySelectorAll('.star');\n        const starCount = starsInGalaxy.length;\n        if (starCount === 0) return;\n\n         if (isMobile) {\n            // --- è¿™æ˜¯ä¸ºä½ ç‰¹åˆ«è®¾è®¡çš„ç§»åŠ¨ç«¯å¸ƒå±€ï¼šä¸‰åˆ—çºµå‘æ’åˆ—ï¼Œå¹¶æ•´ä½“å±…ä¸­ ---\n            const cols = 3;\n            const rows = Math.ceil(starCount / cols);\n            if (rows === 0) return;\n\n            // Yè½´ï¼ˆçºµå‘ï¼‰çš„é—´è·å’Œåç§»é‡ä¿æŒä¸å˜\n            const y_spacing = (rows > 1) ? 90 / (rows - 1) : 0;\n            const y_offset = 5;\n\n            // ä¸ºäº†å®ç°ä¸‰åˆ—å±…ä¸­ï¼Œæˆ‘ä»¬é‡æ–°å®šä¹‰Xè½´çš„å®šä½é€»è¾‘\n            const x_center_spacing = 25; // ä¸­å¿ƒåˆ—åˆ°ä¸¤ä¾§åˆ—çš„é—´è·ï¼Œ25%çš„æ•ˆæœå¾ˆå¥½\n\n            starsInGalaxy.forEach((star, index) => {\n                // å®ç°â€œå…ˆå¡«æ»¡ç¬¬ä¸€åˆ—ï¼Œå†å¡«ç¬¬äºŒåˆ—...â€çš„é€»è¾‘ä¸å˜\n                const col = Math.floor(index / rows);\n                const row = index % rows;\n\n                // æ–°çš„é­”æ³•åœ¨è¿™é‡Œï¼šè®¡ç®—Xè½´ä½ç½®ï¼Œå®ç°æ•´ä½“å±…ä¸­\n                // col 0 -> 50% - 25% = 25%\n                // col 1 -> 50% (æ­£ä¸­å¿ƒ)\n                // col 2 -> 50% + 25% = 75%\n                const leftPosition = 50 + (col - 1) * x_center_spacing;\n\n                // çºµå‘ä½ç½®çš„é€»è¾‘ä¿æŒä¸å˜\n                const topPosition = (rows > 1)\n                    ? `${y_offset + row * y_spacing}%`\n                    : '50%'; // åªæœ‰ä¸€è¡Œæ—¶å‚ç›´å±…ä¸­\n\n                star.style.left = `${leftPosition}%`;\n                star.style.top = topPosition;\n                star.style.setProperty('--star-z', '0px');\n            });\n        } else {\n            // --- è¿™ä»æ˜¯æˆ‘ä»¬ä¹‹å‰çš„æ¡Œé¢ç«¯å¸ƒå±€ ---\n            const cols = Math.max(3, Math.ceil(starCount / 2));\n            const x_spacing = 90 / cols;\n            const y_spacing = 35;\n            const x_offset = 5;\n            const y_offset = 15;\n\n            starsInGalaxy.forEach((star, index) => {\n                // è¿™æ˜¯å®ç°â€œå…ˆå¡«æ»¡ç¬¬ä¸€è¡Œï¼Œå†å¡«ç¬¬äºŒè¡Œ...â€çš„é€»è¾‘\n                const row = Math.floor(index / cols);\n                const col = index % cols;\n\n                star.style.left = `${x_offset + col * x_spacing}%`;\n                star.style.top = `${y_offset + row * y_spacing}%`;\n                star.style.setProperty('--star-z', '0px');\n            });\n        }\n    });\n}\n\n\n    const isColliding = (rect, existingRects) => {\n        for (let otherRect of existingRects) {\n            if (rect.x < otherRect.x + otherRect.width &&\n                rect.x + rect.width > otherRect.x &&\n                rect.y < otherRect.y + otherRect.height &&\n                rect.y + rect.height > otherRect.y) {\n                return true;\n            }\n        }\n        return false;\n    };\n\n\n    function reRandomizeWithCollisionCheck() {\n        const galaxies = ['physic', 'mental', 'social'];\n        galaxies.forEach(galaxyName => {\n            const container = document.getElementById(`galaxy-${galaxyName}`);\n            const starsInGalaxy = container.querySelectorAll('.star');\n            const existingCoords = [];\n\n            starsInGalaxy.forEach(star => {\n                const STAR_SIZE = 110;\n                const MAX_ATTEMPTS = 100;\n                let x, y, z, newRect, attempts = 0;\n\n                do {\n                    x = Math.random() * 70 + 15;\n                    y = Math.random() * 70 + 15;\n                    z = (Math.random() - 0.5) * 300;\n                    newRect = { x: x, y: y, width: STAR_SIZE / 5, height: STAR_SIZE / 5 };\n                    attempts++;\n                } while (isColliding(newRect, existingCoords) && attempts < MAX_ATTEMPTS);\n\n                existingCoords.push(newRect);\n\n                star.style.left = `${x}%`;\n                star.style.top = `${y}%`;\n                star.style.setProperty('--star-z', `${z}px`);\n\n                star.dataset.randomLeft = `${x}%`;\n                star.dataset.randomTop = `${y}%`;\n                star.dataset.randomZ = z;\n            });\n        });\n        // é‡æ–°éšæœºåï¼Œè¦å†æ¬¡è°ƒç”¨ switchGalaxyï¼Œç¡®ä¿åªæœ‰å½“å‰æ˜Ÿç³»çš„æ˜Ÿæ˜Ÿ Z è½´ä¸º 0\n        switchGalaxy(currentGalaxyIndex);\n    }\n\n    arrangeBtn.addEventListener('click', () => {\n        playSound(document.getElementById('click-sound'), 0.6);\n        isStarsArranged = !isStarsArranged;\n\n        if (isStarsArranged) {\n            arrangeBtn.textContent = 'æ¢å¤éšæœº';\n            applyArrangedLayout();\n        } else {\n            arrangeBtn.textContent = 'æ•´ç†æ’åˆ—';\n            reRandomizeWithCollisionCheck();\n        }\n    });\n}\n(function restoreRememberCheckbox() {\n    try {\n        const rememberChoice = localStorage.getItem('rememberModChoice') === 'true';\n        const rememberCheckbox = document.getElementById('remember-mod-choice');\n        if (rememberCheckbox) {\n            rememberCheckbox.checked = rememberChoice;\n        }\n    } catch (e) {\n        console.log('æ¢å¤å¤é€‰æ¡†çŠ¶æ€å¤±è´¥:', e);\n    }\n})();\n function setupNewUI() {\n     applyImagesWithCache(); \n     // åŠ è½½å¹¶åº”ç”¨ä¸Šæ¬¡çš„æ¨¡ç»„é€‰æ‹©\n     // åŠ è½½å¹¶åº”ç”¨ä¸Šæ¬¡çš„æ¨¡ç»„é€‰æ‹©\n     try {\n         const rememberChoice = localStorage.getItem('rememberModChoice') === 'true';\n         const rememberCheckbox = document.getElementById('remember-mod-choice');\n         if (rememberCheckbox) {\n             rememberCheckbox.checked = rememberChoice;\n             \n             // ç›‘å¬å¤é€‰æ¡†å˜åŒ–ï¼Œå–æ¶ˆå‹¾é€‰æ—¶æ¸…é™¤ä¿å­˜çš„æ•°æ®\n             rememberCheckbox.addEventListener('change', () => {\n                 const isChecked = rememberCheckbox.checked;\n                 localStorage.setItem('rememberModChoice', isChecked ? 'true' : 'false');\n                 if (!isChecked) {\n                     // å–æ¶ˆå‹¾é€‰æ—¶ï¼Œæ¸…é™¤ä¿å­˜çš„æ¨¡ç»„é€‰æ‹©æ•°æ®\n                     localStorage.removeItem('lastModSelections');\n                 }\n             });\n         }\n         \n         // åªæœ‰åœ¨å‹¾é€‰äº†è®°å¿†åŠŸèƒ½ ä¸” ç¡®å®æœ‰ä¿å­˜çš„æ•°æ®æ—¶æ‰æ¢å¤\n         if (rememberChoice) {\n             const lastSelections = localStorage.getItem('lastModSelections');\n             if (lastSelections) {\n                 try {\n                     const checkedRadios = JSON.parse(lastSelections);\n                     // ç¡®ä¿è§£æå‡ºçš„æ•°æ®ä¸ä¸ºç©º\n                     if (checkedRadios && Object.keys(checkedRadios).length > 0) {\n                         // å…ˆå–æ¶ˆæ‰€æœ‰é€‰ä¸­\n                         document.querySelectorAll('input[type=\"radio\"]').forEach(radio => {\n                             radio.checked = false;\n                         });\n                         // æ ¹æ®ä¿å­˜çš„idæ¢å¤é€‰ä¸­çŠ¶æ€\n                         Object.values(checkedRadios).forEach(radioId => {\n                             const radio = document.getElementById(radioId);\n                             if (radio) radio.checked = true;\n                         });\n                         \n                         // åŒæ­¥æ›´æ–°UIæ ‡ç­¾çš„activeçŠ¶æ€\n                         document.querySelectorAll('.mod-tab').forEach(tab => {\n                             const inputId = tab.dataset.for;\n                             const input = document.getElementById(inputId);\n                             if (input && input.checked) {\n                                 tab.classList.add('active');\n                             } else {\n                                 tab.classList.remove('active');\n                             }\n                         });\n                     }\n                 } catch (parseError) {\n                     console.log('è§£æä¿å­˜çš„æ¨¡ç»„é€‰æ‹©å¤±è´¥:', parseError);\n                 }\n             }\n         }\n     } catch (e) {\n         console.log('åŠ è½½æ¨¡ç»„é€‰æ‹©å¤±è´¥:', e);\n     }\n    // å¼ºåˆ¶è§¦å‘é‡ç»˜å’Œé‡æ’çš„å‡½æ•°\n    function forceReflow() {\n        document.body.offsetHeight; // å¼ºåˆ¶æµè§ˆå™¨é‡æ–°è®¡ç®—å¸ƒå±€\n        window.dispatchEvent(new Event('resize')); // è§¦å‘resizeäº‹ä»¶\n    }\n\n    // åŠ¨æ€èƒŒæ™¯åˆ›å»º - æ·»åŠ å¼ºåˆ¶å…¨å±æ¸²æŸ“é€»è¾‘\n    function createDynamicBacground() {\n        const starfield = document.getElementById('starfield');\n        const runeContainer = document.getElementById('floating-runes');\n        const backgroundElement = document.getElementById('dynamic-background');\n        \n        if (!starfield || !runeContainer) return;\n        if (starfield.childElementCount > 0) return; // é˜²æ­¢é‡å¤åˆ›å»º\n\n        // ç¡¬ç¼–ç å¼ºåˆ¶è®¾ç½®èƒŒæ™¯å…ƒç´ å°ºå¯¸\n        if (backgroundElement) {\n            backgroundElement.style.width = '100vw';\n            backgroundElement.style.height = '100vh';\n            backgroundElement.style.position = 'fixed';\n            backgroundElement.style.top = '0';\n            backgroundElement.style.left = '0';\n            backgroundElement.style.zIndex = '-1';\n            \n            // å¼ºåˆ¶é‡ç»˜\n            backgroundElement.offsetHeight;\n        }\n\n        // å¼ºåˆ¶è®¾ç½®çˆ¶å®¹å™¨å°ºå¯¸\n        starfield.style.width = '100vw';\n        starfield.style.height = '100vh';\n        starfield.style.position = 'absolute';\n        starfield.style.top = '0';\n        starfield.style.left = '0';\n        \n        runeContainer.style.width = '100vw';\n        runeContainer.style.height = '100vh';\n        runeContainer.style.position = 'absolute';\n        runeContainer.style.top = '0';\n        runeContainer.style.left = '0';\n\n        // åˆ›å»ºæ˜Ÿæ˜Ÿ - ä½¿ç”¨è§†å£å•ä½ç¡®ä¿å…¨å±è¦†ç›–\n        for (let i = 0; i < 100; i++) {\n            const star = document.createElement('div');\n            star.className = 'star';\n            star.style.position = 'absolute';\n            star.style.left = Math.random() * 100 + 'vw';\n            star.style.top = Math.random() * 100 + 'vh';\n            star.style.width = star.style.height = (Math.random() * 2 + 0.5) + 'px';\n            star.style.animationDelay = Math.random() * 4 + 's';\n            star.style.animationDuration = (Math.random() * 3 + 2) + 's';\n            starfield.appendChild(star);\n        }\n\n        // åˆ›å»ºç¬¦æ–‡ - åŒæ ·ä½¿ç”¨è§†å£å•ä½\n        const runes = ['âœ¦', 'â—†', 'âœ§', 'â—‡', 'â€»', 'âŸ¡', 'â—ˆ', 'âœ¤', 'â—‰'];\n        for (let i = 0; i < 20; i++) {\n           const rune = document.createElement('div');\n           rune.className = 'rune';\n           rune.style.position = 'absolute';\n           rune.textContent = runes[Math.floor(Math.random() * runes.length)];\n           rune.style.left = Math.random() * 100 + 'vw';\n           rune.style.top = '100vh';\n           rune.style.animationDelay = Math.random() * 10 + 's';\n           rune.style.animationDuration = (Math.random() * 10 + 10) + 's';\n           runeContainer.appendChild(rune);\n       }\n\n        // å¤šé‡å»¶è¿Ÿç¡®ä¿æ¸²æŸ“\n        setTimeout(forceReflow, 0);\n        setTimeout(forceReflow, 50);\n        setTimeout(forceReflow, 200);\n    }\n\n    // å»¶è¿Ÿæ‰§è¡ŒèƒŒæ™¯åˆ›å»ºï¼Œç¡®ä¿DOMå®Œå…¨å‡†å¤‡å¥½\n    setTimeout(() => {\n        createDynamicBacground();\n        forceReflow();\n    }, 0);\n\n    // å†æ·»åŠ ä¸€ä¸ªç¨é•¿çš„å»¶è¿Ÿä½œä¸ºä¿é™©\n    setTimeout(() => {\n        createDynamicBacground();\n        forceReflow();\n    }, 100);\n\n    // --- 3Då¡ç‰‡è½®æ’­é€»è¾‘ - å…¨é¢ä¿®å¤ï¼ ---\n    const carousel = document.getElementById('world-mode-carousel');\n    const cards = document.querySelectorAll('.choice-world-card');\n    const prevBtn = document.getElementById('prev-btn');\n    const nextBtn = document.getElementById('next-btn');\n\n    if (carousel && cards.length > 0 && prevBtn && nextBtn) {\n        let currentIndex = 0;\n        const totalCards = cards.length;\n        const theta = 360 / totalCards;\n        const radius = Math.round((220 / 2) / Math.tan(Math.PI / totalCards)) + 50; // åŠ ä¸€ç‚¹é—´è·\n\n        function setupCards() {\n            cards.forEach((card, i) => {\n                const angle = theta * i;\n                card.style.transform = `rotateY(${angle}deg) translateZ(${radius}px)`;\n            });\n        }\n\n        function updateCarousel() {\n            const angle = currentIndex * -theta;\n            carousel.style.transform = `rotateY(${angle}deg)`;\n\n            const activeIndex = (currentIndex % totalCards + totalCards) % totalCards;\n            cards.forEach((card, index) => {\n                card.classList.toggle('is-active', index === activeIndex);\n                if(index === activeIndex) {\n                    const radio = card.querySelector('input[type=\"radio\"]');\n                    if (radio) radio.checked = true;\n                }\n            });\n        }\n\n        prevBtn.addEventListener('click', () => { currentIndex--; playSound(document.getElementById('click-sound'), 0.5); updateCarousel(); });\n        nextBtn.addEventListener('click', () => { currentIndex++; playSound(document.getElementById('click-sound'), 0.5); updateCarousel(); });\n\n        cards.forEach((card, index) => {\n            card.addEventListener('click', () => {\n                currentIndex = index;\n                updateCarousel();\n            });\n        });\n\n        setupCards();\n        updateCarousel(); // åˆå§‹åŒ–\n    }\n\n    // --- ä¾§è¾¹æ MODæ ‡ç­¾é€»è¾‘ - é€»è¾‘æ›´æ–°ï¼---\n    const modTabs = document.querySelectorAll('.mod-tab');\n    modTabs.forEach(tab => {\n        const inputId = tab.dataset.for;\n        const input = document.getElementById(inputId);\n        const groupName = tab.dataset.name;\n\n        // æ ¹æ®åˆå§‹çŠ¶æ€æ›´æ–°UI\n        if (input && input.checked) {\n            tab.classList.add('active');\n        } else {\n            tab.classList.remove('active');\n        }\n\n        tab.addEventListener('click', () => {\n             playSound(document.getElementById('click-sound'), 0.5);\n             if (groupName === 'creator-attitude') { // è¿™æ˜¯äº’æ–¥ç»„ \n                document.querySelectorAll(`.mod-tab[data-name=\"${groupName}\"]`).forEach(t => t.classList.remove('active'));\n                tab.classList.add('active');\n                if(input) input.checked = true;\n            } else if (groupName === 'dice-level') { // è¿™æ˜¯äº’æ–¥ç»„ \n                document.querySelectorAll(`.mod-tab[data-name=\"${groupName}\"]`).forEach(t => t.classList.remove('active'));\n                tab.classList.add('active');\n                if(input) input.checked = true;\n            }else if (groupName === 'npc-info') { // è¿™æ˜¯äº’æ–¥ç»„ \n                document.querySelectorAll(`.mod-tab[data-name=\"${groupName}\"]`).forEach(t => t.classList.remove('active'));\n                tab.classList.add('active');\n                if(input) input.checked = true;\n            }else if (groupName === 'map-mode') { // è¿™æ˜¯äº’æ–¥ç»„ \n                document.querySelectorAll(`.mod-tab[data-name=\"${groupName}\"]`).forEach(t => t.classList.remove('active'));\n                tab.classList.add('active');\n                if(input) input.checked = true;\n            }else { // è¿™æ˜¯å¯æ’¤é”€çš„å¼€å…³ç»„\n                const offId = tab.dataset.offId;\n                const offInput = document.getElementById(offId);\n\n                tab.classList.toggle('active');\n\n                if (tab.classList.contains('active')) {\n                    if (input) input.checked = true;\n                } else {\n                    if (offInput) offInput.checked = true;\n                }\n            }\n        });\n    });\n      // --- æ–°å¢ï¼šä¾§è¾¹æ å¼¹å‡ºé€»è¾‘ ---\n    function setupSidebarInteractions(sidebarSelector, triggerSelector) {\n        const sidebar = document.querySelector(sidebarSelector);\n        const trigger = document.querySelector(triggerSelector);\n\n        if (!sidebar || !trigger) return;\n\n        // åˆ¤æ–­æ˜¯å¦ä¸ºè§¦æ‘¸è®¾å¤‡ï¼Œè¿™æ˜¯å…³é”®ï¼\n        const isTouchDevice = 'ontouchstart' in window || navigator.maxTouchPoints > 0;\n\n        // ---------- æ¡Œé¢ç«¯é¼ æ ‡æ‚¬åœé€»è¾‘ ----------\n        if (!isTouchDevice) {\n            let hideTimeout;\n\n            const show = () => {\n                clearTimeout(hideTimeout);\n                sidebar.classList.add('is-visible');\n                trigger.classList.add('is-hidden');\n            };\n\n            const hide = () => {\n                hideTimeout = setTimeout(() => {\n                    sidebar.classList.remove('is-visible');\n                    trigger.classList.remove('is-hidden');\n                }, 300);\n            };\n\n            trigger.addEventListener('mouseenter', show);\n            sidebar.addEventListener('mouseenter', show);\n\n            trigger.addEventListener('mouseleave', hide);\n            sidebar.addEventListener('mouseleave', hide);\n\n            return; // æ¡Œé¢ç«¯é€»è¾‘è®¾ç½®å®Œæ¯•ï¼Œç›´æ¥è¿”å›\n        }\n\n        // ---------- ç§»åŠ¨ç«¯è§¦æ‘¸ç‚¹å‡»é€»è¾‘ ----------\n        const show = () => {\n            sidebar.classList.add('is-visible');\n            trigger.classList.add('is-hidden');\n            // å»¶è¿Ÿæ·»åŠ å…¨å±€ç‚¹å‡»äº‹ä»¶ï¼Œé˜²æ­¢è§¦å‘è‡ªèº«çš„ç‚¹å‡»äº‹ä»¶ç«‹å³å…³é—­\n            setTimeout(() => {\n                document.addEventListener('click', handleDocumentClick, true);\n            }, 0);\n        };\n\n        const hide = () => {\n            sidebar.classList.remove('is-visible');\n            trigger.classList.remove('is-hidden');\n            document.removeEventListener('click', handleDocumentClick, true);\n        };\n\n        const handleDocumentClick = (event) => {\n            // å¦‚æœç‚¹å‡»çš„åœ°æ–¹ä¸åœ¨ä¾§è¾¹æ å†…éƒ¨ï¼Œå°±å…³é—­å®ƒ\n            if (!sidebar.contains(event.target)) {\n                hide();\n            }\n        };\n\n        // ä¸ºè§¦å‘ç®­å¤´ç»‘å®šâ€œç‚¹å‡»â€äº‹ä»¶\n        trigger.addEventListener('click', (event) => {\n            // é˜»æ­¢äº‹ä»¶å†’æ³¡ï¼Œé˜²æ­¢è§¦å‘ä¸‹é¢çš„documentç‚¹å‡»äº‹ä»¶\n            event.stopPropagation();\n\n            // å¦‚æœä¾§è¾¹æ å½“å‰æ˜¯éšè—çš„ï¼Œå°±æ˜¾ç¤ºå®ƒ\n            if (!sidebar.classList.contains('is-visible')) {\n                show();\n            }\n        });\n    }\n\n       setupSidebarInteractions('.creator-attitude-group', '.sidebar-trigger.left');\n    setupSidebarInteractions('.mod-sidebar.right', '.sidebar-trigger.right');\n}\n\n// å¤šç§æ—¶æœºè°ƒç”¨ï¼Œç¡®ä¿ä¸€å®šèƒ½æ­£ç¡®æ¸²æŸ“\ndocument.addEventListener('DOMContentLoaded', setupNewUI);\nwindow.addEventListener('load', setupNewUI);\n\n \n\n \nsetupPage1Interactions();  \n   /* --- æ‰¾åˆ°å¹¶æ›¿æ¢è¿™ä¸ªå‡½æ•° --- */\n    function setupPage1Interactions() {\n        const solarSystem = document.getElementById('solar-system');\n        const planets = document.querySelectorAll('.planet');\n\n        function resetPlanetView(){\n            if(solarSystem.classList.contains('planet-active')){\n                 playSound(document.getElementById('click-sound'), 0.4);\n                 solarSystem.classList.remove('planet-active');\n                 planets.forEach(p => p.classList.remove('active'));\n            }\n        }\n\n        planets.forEach(planet => {\n             planet.addEventListener('click', () => {\n                if (planet.classList.contains('active')) return;\n                playSound(document.getElementById('click-sound'), 0.6);\n                solarSystem.classList.add('planet-active');\n                planets.forEach(p => p.classList.remove('active'));\n                planet.classList.add('active');\n            });\n        });\n\n        // ç»‘å®šæ ¸å¿ƒå’Œå…³é—­æŒ‰é’®\n        document.querySelector('.player-core').addEventListener('click', resetPlanetView);\n   \n        document.querySelectorAll('.close-planet-btn').forEach(btn => {\n            btn.addEventListener('click', (event) => {\n                event.stopPropagation();  \n                resetPlanetView();\n            });\n        });\n        // è‡ªå®šä¹‰å¤©èµ‹é€‰æ‹©å™¨é€»è¾‘\n        const talentSelect = document.getElementById('talent-select');\n        const customTalentScroll = document.getElementById('custom-talent-scroll');\n\n        // æ¸…ç©ºä»¥é˜²é‡å¤ç”Ÿæˆ\n        customTalentScroll.innerHTML = '';\n\n      \n        const talentSearchInput = document.getElementById('talent-search-input');\n        talentSearchInput.addEventListener('input', () => {\n            const searchTerm = talentSearchInput.value.toLowerCase();\n            const talentItems = customTalentScroll.querySelectorAll('.talent-item');\n\n            talentItems.forEach(item => {\n                const itemText = item.textContent.toLowerCase();\n                if (itemText.includes(searchTerm)) {\n                    item.style.display = ''; // å¦‚æœåŒ¹é…ï¼Œå°±è®©å®ƒå‡ºç°\n                } else {\n                    item.style.display = 'none'; // å¦åˆ™ï¼Œå°±æš‚æ—¶è—èµ·æ¥\n                }\n            });\n        });\n \n\n // ä»åŸå§‹selectä¸­è¯»å–å¹¶åˆ›å»ºè‡ªå®šä¹‰åˆ—è¡¨\nArray.from(talentSelect.options).forEach((option, index) => {\n    const talentItem = document.createElement('div');\n    talentItem.className = 'talent-item';\n    talentItem.textContent = option.textContent;\n    talentItem.dataset.value = option.value;\n    // â˜…â˜…â˜… å¦ˆå¦ˆåœ¨è¿™é‡Œä¸ºä½ åŠ ä¸Šäº†æ–°çš„â€œé­”æ³•â€ï¼Œç”¨æ¥è®°ä½å®ƒæœ¬æ¥çš„åå­— â˜…â˜…â˜…\n    talentItem.dataset.originalText = option.textContent;\n    talentItem.dataset.index = index;\n\n    // æ£€æŸ¥åˆå§‹é€‰ä¸­çš„é¡¹\n    if (option.selected) {\n         talentItem.classList.add('active');\n         // â˜…â˜…â˜… å¦‚æœåˆå§‹å°±æ˜¯é€‰ä¸­çš„ï¼Œä¹Ÿè®©å®ƒæ˜¾ç¤ºvalue â˜…â˜…â˜…\n         talentItem.textContent = talentItem.dataset.value;\n    }\n\n    talentItem.addEventListener('click', () => {\n        // å¦‚æœå®ƒå·²ç»æ˜¯æ¿€æ´»çŠ¶æ€ï¼Œå°±ä»€ä¹ˆéƒ½ä¸åš\n        if (talentItem.classList.contains('active')) return;\n\n        // â˜…â˜…â˜… åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å…ˆè®©æ‰€æœ‰çš„å°ä¼™ä¼´éƒ½å˜å›åŸæ¥çš„æ ·å­ â˜…â˜…â˜…\n        customTalentScroll.querySelectorAll('.talent-item').forEach(item => {\n            // æ¢å¤åŸæ¥çš„æ–‡æœ¬\n            if (item.classList.contains('active')) {\n                item.textContent = item.dataset.originalText;\n            }\n            // ç§»é™¤æ¿€æ´»çŠ¶æ€\n            item.classList.remove('active');\n        });\n\n        // â˜…â˜…â˜… ç„¶åï¼Œä¸ºä½ ç‚¹å‡»çš„è¿™ä¸€ä¸ªï¼Œæ–½åŠ â€œæ˜¾ç¤ºçœŸèº«â€çš„é­”æ³• â˜…â˜…â˜…\n        talentItem.classList.add('active'); // æŠŠå®ƒæ ‡è®°ä¸ºæ¿€æ´»\n        talentItem.textContent = talentItem.dataset.value; // æ˜¾ç¤ºå®ƒçš„valueå€¼\n\n        // åŒæ­¥æ›´æ–°éšè—çš„select\n        talentSelect.selectedIndex = talentItem.dataset.index;\n\n        // è§¦å‘changeäº‹ä»¶ï¼Œè®©åŸæœ‰é€»è¾‘å·¥ä½œ\n        talentSelect.dispatchEvent(new Event('change'));\n    });\n    customTalentScroll.appendChild(talentItem);\n});\n        // é˜Ÿå‹è®¾ç½®çš„ç‰¹æ®Šé€»è¾‘\n         const teammateTendencySelect_new = document.getElementById('teammate-tendency');\n         const customTeammatesContainer_new = document.getElementById('custom-teammates-container');\n         teammateTendencySelect_new.addEventListener('change', () => {\n             customTeammatesContainer_new.classList.toggle('active', teammateTendencySelect_new.value === 'è‡ªå®šä¹‰');\n         });\n\n      document.addEventListener('click', (event) => {\n            // é¦–å…ˆï¼Œæˆ‘ä»¬ç¡®ä¿è¡Œæ˜Ÿç”»å·ç¡®å®æ˜¯å±•å¼€çš„\n            const isPlanetActive = solarSystem.classList.contains('planet-active');\n\n            // å¦‚æœç”»å·æ˜¯å±•å¼€çš„ï¼Œå¹¶ä¸”æˆ‘ä»¬ç‚¹å‡»çš„åœ°æ–¹ä¸å±äºä»»ä½•ä¸€ä¸ªâ€œè¡Œæ˜Ÿâ€å®¶æ—\n            // closestä¼šæ£€æŸ¥ç‚¹å‡»å¤„ä»¥åŠå®ƒçš„æ‰€æœ‰çˆ¶è¾ˆï¼Œçœ‹æœ‰æ²¡æœ‰â€œplanetâ€\n            if (isPlanetActive && event.target.closest('.planet') === null) {\n                // é‚£ä¹ˆï¼Œå°±æ¸©æŸ”åœ°å°†å®ƒæ”¶èµ·\n                resetPlanetView();\n            }\n        }, true); // â˜…â˜…â˜… ä½¿ç”¨æ•è·é˜¶æ®µï¼Œç¡®ä¿æˆ‘ä»¬çš„é­”æ³•æœ€å…ˆè¢«æ„ŸçŸ¥ â˜…â˜…â˜…\n    }\n\n    // --- æ•°æ®å®šä¹‰ ---\n\n    const playCharacterData = { \"æ¦‚å¿µæ®µ\": { \"ç¾å¾·ä¸æ¶å¾·\": { \"ç¾å¾·\": [\"æ­£ä¹‰\", \"å½“è§’è‰²ä¸ºæ­£ä¹‰è€Œå†’é™©æ—¶ï¼Œè§¦å‘æ­£ä¹‰ï¼Œå›å¤æ‰€æœ‰æ„å¿—åŠ›ã€‚\"], \"æ¶å¾·\": [\"æ„¤æ€’\", \"å½“è§’è‰²æ— è§†å±é™©æ¥å‘æ³„æ„¤æ€’æ—¶ï¼Œè§¦å‘æ„¤æ€’ï¼Œå›å¤1ç‚¹æ„å¿—åŠ›ã€‚\"] } }, \"å±æ€§æ®µ\": { \"ç”Ÿç†å±æ€§\": { \"åŠ›é‡\": { \"åŸºç¡€\": [0, \"è¡¡é‡è‚Œè‚‰å¼ºåº¦ä¸çˆ†å‘åŠ›ï¼Œå½±å“è¿‘æˆ˜ä¼¤å®³ä¸è´Ÿé‡\"] }, \"æ•æ·\": { \"åŸºç¡€\": [0, \"è¡¡é‡èº«ä½“åè°ƒã€ååº”é€Ÿåº¦ä¸çµæ´»æ€§ï¼Œå½±å“å…ˆæ”»ä¸é—ªé¿\"] }, \"è€åŠ›\": { \"åŸºç¡€\": [0, \"è¡¡é‡ä½“è´¨ã€æŒä¹…åŠ›ä¸æ¢å¤åŠ›ï¼Œå½±å“ç”Ÿå‘½å€¼ä¸æŠµæŠ—åŠ›\"] } }, \"å¿ƒæ™ºå±æ€§\": { \"æ™ºåŠ›\": { \"åŸºç¡€\": [0, \"è¡¡é‡é€»è¾‘ã€è®°å¿†ã€å­¦ä¹ ä¸åˆ†æèƒ½åŠ›ï¼Œå½±å“æŠ€èƒ½å­¦ä¹ ä¸ç­–ç•¥\"] }, \"æ„ŸçŸ¥\": { \"åŸºç¡€\": [0, \"è¡¡é‡è§‚å¯ŸåŠ›ã€ç›´è§‰ä¸äº”æ„Ÿæ•é”åº¦ï¼Œå½±å“ä¾¦æŸ¥ä¸æ´å¯Ÿ\"] }, \"å†³å¿ƒ\": { \"åŸºç¡€\": [0, \"è¡¡é‡æ„å¿—åŠ›ã€å‹‡æ°”ä¸ç²¾ç¥éŸ§æ€§ï¼Œå½±å“æ„å¿—å€¼ä¸Šé™\"] } }, \"äº’åŠ¨å±æ€§\": { \"é£åº¦\": { \"åŸºç¡€\": [0, \"è¡¡é‡ä¸ªäººé­…åŠ›ã€æ°”è´¨ä¸ç¬¬ä¸€å°è±¡ï¼Œå½±å“æ­£é¢ç¤¾äº¤\"] }, \"æ“æ§\": { \"åŸºç¡€\": [0, \"è¡¡é‡è¯´æœã€è¯±å¯¼ä¸æ§åˆ¶ä»–äººçš„èƒ½åŠ›ï¼Œå½±å“è´Ÿé¢ç¤¾äº¤\"] }, \"æ²‰ç€\": { \"åŸºç¡€\": [0, \"è¡¡é‡å†·é™ã€è‡ªæ§ä¸æŠ—å‹èƒ½åŠ›ï¼Œå½±å“å…ˆæ”»ä¸æ„å¿—å€¼ä¸Šé™\"] } } }, \"æŠ€èƒ½æ®µ\": { \"ç”Ÿç†æŠ€èƒ½\": { \"è¿åŠ¨\": [0, \"è¡¡é‡è·‘ã€è·³ã€æ”€çˆ¬ç­‰èº«ä½“æ´»åŠ¨èƒ½åŠ›\"], \"è‚‰æ\": [0, \"è¡¡é‡å¾’æ‰‹æ ¼æ–—æŠ€å·§\"], \"é©¾é©¶\": [0, \"è¡¡é‡æ“æ§åœ°é¢ã€æ°´é¢æˆ–ç©ºä¸­è½½å…·çš„èƒ½åŠ›\"],\"æªæ¢°\": [ 0, \"è¡¡é‡ä½¿ç”¨å„ç±»ç«å™¨çš„èƒ½åŠ›\"], \"æ‰‹ä¸ŠåŠŸå¤«\": [0, \"è¡¡é‡ç›—çªƒã€å¼€é”ç­‰æ‰‹éƒ¨ç²¾ç»†æ“ä½œèƒ½åŠ›\"], \"éšè—\": [0, \"è¡¡é‡æ½œè¡Œã€ä¼ªè£…ä¸éšè”½è‡ªèº«çš„èƒ½åŠ›\"], \"æ±‚ç”Ÿ\": [0, \"è¡¡é‡åœ¨æ¶åŠ£ç¯å¢ƒä¸­ç”Ÿå­˜ä¸è¿½è¸ªçš„èƒ½åŠ›\"], \"ç™½åˆƒ\": [0, \"è¡¡é‡ä½¿ç”¨åˆ€å‰‘ç­‰å†·å…µå™¨çš„èƒ½åŠ›\"], \"å¼“ç®­\": [ 0, \"è¡¡é‡ä½¿ç”¨å¼“å¼©ç­‰æŠ›å°„æ­¦å™¨çš„èƒ½åŠ›\"] }, \"å¿ƒæ™ºæŠ€èƒ½\": { \"å­¦è¯†\": [0, \"è¡¡é‡äººæ–‡ã€å†å²ã€åœ°ç†ç­‰çŸ¥è¯†å¹¿åº¦\"], \"ç”µè„‘\": [0, \"è¡¡é‡æ“ä½œã€ç¼–ç¨‹ä¸é»‘å®¢æŠ€æœ¯\"], \"æ‰‹è‰º\": [0, \"è¡¡é‡åˆ¶ä½œçš„çŸ¥è¯†\"], \"è°ƒæŸ¥\": [0, \"è¡¡é‡æœé›†çº¿ç´¢ã€åˆ†æç°åœºçš„èƒ½åŠ›\"], \"åŒ»å­¦\": [0, \"è¡¡é‡è¯Šæ–­ã€æ²»ç–—ä¸è¯ç†çŸ¥è¯†\"], \"ç¥ç§˜å­¦\": [0, \"è¡¡é‡å¯¹è¶…è‡ªç„¶ç°è±¡ä¸é­”æ³•çš„çŸ¥è¯†\"], \"ç§‘å­¦\": [0, \"è¡¡é‡ç‰©ç†ã€åŒ–å­¦ã€ç”Ÿç‰©ç­‰è‡ªç„¶ç§‘å­¦çŸ¥è¯†\"] }, \"äº’åŠ¨æŠ€èƒ½\": { \"åŠ¨ç‰©æ²Ÿé€š\": [0, \"è¡¡é‡ä¸åŠ¨ç‰©äº¤æµå’Œé©¯æœçš„èƒ½åŠ›\"], \"æ„Ÿå—\": [0, \"è¡¡é‡æ´å¯Ÿä»–äººæƒ…ç»ªä¸æ„å›¾çš„èƒ½åŠ›\"], \"è¡¨è¾¾\": [0, \"è¡¡é‡æ„ŸæŸ“ä»–äººçš„èƒ½åŠ›\"], \"èƒè¿«\": [0, \"è¡¡é‡é€šè¿‡å¨èƒä¸æå“è¾¾æˆç›®çš„çš„èƒ½åŠ›\"], \"äº¤é™…\": [0, \"è¡¡é‡ç¤¾äº¤ã€ç¤¼ä»ªä¸å»ºç«‹äººè„‰çš„èƒ½åŠ›\"], \"æ©é¥°\": [0, \"è¡¡é‡éšè—çœŸç›¸ã€ä¼ªè£…èº«ä»½ä¸æ¬ºéª—ä»–äººçš„èƒ½åŠ›\"] } } };\n    const virtues = { 'æ…ˆçˆ±': 'å½“è§’è‰²å†’é™©å¸®åŠ©äººæ—¶ï¼Œè§¦å‘æ…ˆçˆ±ï¼Œå›å¤æ‰€æœ‰æ„å¿—åŠ›ã€‚', 'ä¿¡å¿µ': 'å½“è§’è‰²ä»æ··ä¹±ä¸æ‚²ä¼¤ä¸­ç¡®ç«‹å‡ºå…¶æ„ä¹‰æ—¶ï¼Œè§¦å‘ä¿¡å¿µï¼Œå›å¤æ‰€æœ‰æ„å¿—åŠ›ã€‚', 'åˆšæ¯…': 'å½“è§’è‰²æˆåŠŸå¯¹æŠ—é˜»åŠ›ä¸å¼•è¯±æ—¶ï¼Œè§¦å‘åˆšæ¯…ï¼Œå›å¤æ‰€æœ‰æ„å¿—åŠ›ã€‚', 'å¸Œæœ›': 'å½“è§’è‰²ä»¤å…¶ä»–äººä»ç»æœ›ä¸­å›å¤è¿‡æ¥æ—¶ï¼Œè§¦å‘å¸Œæœ›ï¼Œå›å¤æ‰€æœ‰æ„å¿—åŠ›ã€‚', 'æ­£ä¹‰': 'å½“è§’è‰²ä¸ºæ­£ä¹‰è€Œå†’é™©æ—¶ï¼Œè§¦å‘æ­£ä¹‰ï¼Œå›å¤æ‰€æœ‰æ„å¿—åŠ›ã€‚', 'ç¨³é‡': 'å½“è§’è‰²å¼ƒå¿«æ·æ–¹å¼è€Œé€‰ç¨³å¦¥æ—¶ï¼Œè§¦å‘ç¨³é‡ï¼Œå›å¤æ‰€æœ‰æ„å¿—åŠ›ã€‚', 'èŠ‚åˆ¶': 'å½“è§’è‰²æœ‰æœºä¼šæ”¾çºµï¼ˆä¸è®ºå¥½åï¼‰è€Œä¸å—è¯±æƒ‘æ—¶ï¼Œè§¦å‘èŠ‚åˆ¶ï¼Œå›å¤æ‰€æœ‰æ„å¿—åŠ›ã€‚' };\n    const vices = { 'å¦’å¿Œ': 'å½“è§’è‰²ä»ä»–äººå¤„æ‹¿åˆ°å¥½ä¸œè¥¿ï¼Œæˆ–ä»¤ä»–äººå¤±å»å¥½ä¸œè¥¿æ—¶ï¼Œè§¦å‘å¦’å¿Œï¼Œå›å¤1ç‚¹æ„å¿—åŠ›ã€‚', 'æ”¾çºµ': 'å½“è§’è‰²ä¸ºæ”¾çºµè‡ªå·±çš„æ¬²æœ›è€Œä¸é¡¾å…¶ä»–äº‹æƒ…æ—¶ï¼Œè§¦å‘æ”¾çºµï¼Œå›å¤1ç‚¹æ„å¿—åŠ›ã€‚', 'è´ªå©ª': 'å½“è§’è‰²ä¸ºå¾—åˆ°æƒ³è¦çš„ä¸œè¥¿è€Œå†’é™©æ—¶ï¼Œè§¦å‘è´ªå©ªï¼Œå›å¤1ç‚¹æ„å¿—åŠ›ã€‚', 'çºµæ¬²': 'å½“è§’è‰²å‘ä»–äººæ³„æ¬²è€Œä¸é¡¾å¯¹æ–¹æ„Ÿå—æ—¶ï¼Œè§¦å‘çºµæ¬²ï¼Œå›å¤1ç‚¹æ„å¿—åŠ›ã€‚', 'éª„å‚²': 'å½“è§’è‰²ä¸ºè¡¨ç°è‡ªå·±çš„æƒ³æ³•è€Œå†’é™©æ—¶ï¼Œè§¦å‘éª„å‚²ï¼Œå›å¤1ç‚¹æ„å¿—åŠ›ã€‚', 'æ‡’æƒ°': 'å½“è§’è‰²é€ƒé¿éœ€è¦åšçš„äº‹ï¼Œäº‹ä»¶å´å®Œæˆäº†çš„è¯ï¼Œè§¦å‘æ‡’æƒ°ï¼Œå›å¤1ç‚¹æ„å¿—åŠ›ã€‚', 'æ„¤æ€’': 'å½“è§’è‰²æ— è§†å±é™©æ¥å‘æ³„æ„¤æ€’æ—¶ï¼Œè§¦å‘æ„¤æ€’ï¼Œå›å¤1ç‚¹æ„å¿—åŠ›ã€‚' };\n   \n const taskTones_fallback= [\n    'ä¸¥è‚ƒå‹',\n    'ä¹å­äººå‹',\n    'å®å¤§å™äº‹å‹',\n    'ç»æœ›æŒ£æ‰å‹',\n    'æ‚¬ç–‘æƒŠæ‚šå‹',\n    'æ™ºæ€§åšå¼ˆå‹',\n    'æ²‰æµ¸æ‰®æ¼”å‹:è¦æ±‚æ‰®æ¼”å¥½è§’è‰²è¾¾æˆæŸä¸ªç›®çš„ï¼Œå¹¶ä¸”ç¦æ­¢ooc',\n    'æ¢ç´¢å‘ç°å‹',\n    'ç™«ç‹‚æ··ä¹±å‹',\n    'é“å¾·å›°å¢ƒå‹',\n    'ç§ç”°è¿è¥å‹',\n    'æ¸©æƒ…æ²»æ„ˆå‹',\n    'å‡»æ€å‹ï¼šå¯ä»¥é€šè¿‡å‡»æ€æŸç§ç”Ÿç‰©è·å¾—ç§¯åˆ†ï¼ˆä¾‹å¦‚ä¸€åªä¸§å°¸10ç‚¹ç§¯åˆ†ï¼‰ï¼Œå‡»æ€æ—¶ç³»ç»Ÿåº”å½“åœºç»“ç®—ã€‚æ­¤ç±»ä»»åŠ¡æ—¶é™ä¸å¾—è¶…è¿‡ä¸‰å¤©ï¼Œä»¥é˜²åˆ·ç§¯åˆ†ã€‚',\n      \"æ‹çˆ±/åˆ†æ‰‹æ¨¡æ‹Ÿå‹\",\n        \"é¾™å¥—é€†è¢­å‹\",\n        \"åæ´¾æ´—ç™½/ä¸»è§’é»‘åŒ–å‹\",\n         \"æ–‡æ˜é£å‡å‹\",\n        'ä»»åŠ¡åŸºè°ƒå®Œå…¨éšæœº'\n];\nlet taskTones = {};\nconst worldTypes_fallback =[\n    \"ç°ä»£éƒ½å¸‚\",\n    \"è¿‘ç°ä»£\",\n    \"è¥¿æ–¹å¥‡å¹»\",\n    \"è¥¿æ–¹ç¥è¯\",\n    \"ä¸œæ–¹ç„å¹»\",\n    \"ä¸œæ–¹ç¥è¯\",\n        \"è¯¡ç§˜ä¿®ä»™\",\n        \"åºŸåœŸæœ«æ—¥\",\n        \"å†å²æ¶ç©º\",\n    \"æ­¦ä¾ æ±Ÿæ¹–\",\n        \"èµ›åšæœ‹å…‹\",\n    \"æ˜Ÿé™…ç§‘å¹»\",\n        \"è’¸æ±½æœ‹å…‹\",\n \n \n    \"ç»è¥å»ºè®¾\",\n    \"æµ·æ´‹å†’é™©\",\n        \"è§„åˆ™æ€ªè°ˆ\",\n        \"ææ€–æƒŠæ‚š\",\n    \"ææ€–ç”Ÿå­˜\",\n    \"å¤§é€ƒæ€ä¸å¯¹æŠ—\",\n    \"äºŒæ¬¡å…ƒ\",\n    \"åŒäººè¡ç”Ÿ\",\n    \"ç‰¹æ®Šä¸–ç•Œè§‚\",\n    \"å…¨æ°‘é¢†ä¸»\",\n    \"åŸºé‡‘ä¼šä¸å…‹è‹é²ç¥è¯\",\n    \"éšæœºç”Ÿæˆ\"\n];\n let worldTypes =  {};\n const worldDetailsDatabase_fallback ={\n    \"ç°ä»£éƒ½å¸‚\": {\n        \"identities\": [\n             \"è´µæ—å­¦æ ¡çš„å¹³æ°‘å­¦ç”Ÿ\",\n            \"å¶åƒäº‹åŠ¡æ‰€çš„ç»ƒä¹ ç”Ÿ\",\n            \"ä¹™å¥³æ¸¸æˆå…¬å¸çš„æµ‹è¯•å‘˜\",\n            \"çŸ¥åè‰ºæœ¯å®¶çš„æ¨¡ç‰¹\",\n            \"ç”µç«ä¿±ä¹éƒ¨çš„ç»ç†\",\n            \"å¿ƒç†å­¦å®¶\",\n            \"ä¿é™©è°ƒæŸ¥å‘˜\",\n            \"æ¡£æ¡ˆç®¡ç†å‘˜\",\n            \"å›¾ä¹¦ç®¡ç†å‘˜\",\n            \"æ™®é€šå¸‚æ°‘\",\n            \"æ™®é€šå­¦ç”Ÿ\",\n            \"ç§å®¶ä¾¦æ¢\",\n            \"å…¬å¸èŒå‘˜\",\n            \"æ— ä¸šæ¸¸æ°‘\",\n            \"ç§˜å¯†ç‰¹å·¥\",\n            \"ç½‘çº¢ä¸»æ’­\",\n            \"è­¦å¯Ÿ\",\n            \"åŒ»ç”Ÿ\",\n            \"å¾‹å¸ˆ\",\n            \"è®°è€…\",\n            \"è‰ºæœ¯å®¶\",\n            \"ç¨‹åºå‘˜\",\n            \"å¤–å–å‘˜\",\n            \"å°æŠ¥è®°è€…\",\n            \"é…’å§è°ƒé…’å¸ˆ\",\n            \"é€€ä¼‘è€äºº\",\n            \"æµæµªæ±‰\",\n            \"æ³•åŒ»\",\n            \"å¯Œå®¶å…¬å­/åƒé‡‘\",\n            \"éƒ½å¸‚æ€ªè°ˆè°ƒæŸ¥å‘˜\",\n            \"å¼‚é—»è®ºå›ç‰ˆä¸»\",\n            \"è¢«è¯…å’’çš„å¤è‘£åº—ä¸»\",\n            \"èƒ½çœ‹è§â€œå¼‚å¸¸â€çš„å¤–å–å‘˜\",\n            \"å¤„ç†è¶…è‡ªç„¶äº‹ä»¶çš„â€œæ¸…æ´å·¥â€\",\n            \"ä¸“é—¨æŠ¥é“çµå¼‚æ–°é—»çš„è®°è€…\",\n            \"éšæœºç”Ÿæˆ\",\n            \"è§‰é†’äº†â€œè¯»æ‡‚çŒ«è¯­â€èƒ½åŠ›çš„å® ç‰©åŒ»ç”Ÿ\",\n            \"ä¸“é—¨è§£å†³å®¶åº­è¶…è‡ªç„¶çŸ›ç›¾çš„â€œé‡‘ç‰Œè°ƒè§£å‘˜â€\",\n            \"è¡¨é¢æ˜¯å…¨èŒCoserï¼Œå®é™…åœ¨å¤œæ™šæ‰“å‡»çŠ¯ç½ªçš„åœ°ä¸‹è‹±é›„\",\n            \"ç»è¥ç€ä¸€å®¶åªåœ¨åˆå¤œåäºŒç‚¹åå¼€é—¨çš„è§£å¿§æ‚è´§é“ºçš„åº—ä¸»\"\n        ],\n        \"openings\": [\n             \"è½¬å­¦ç¬¬ä¸€å¤©å°±ä¸å°å¿ƒæ’å€’äº†å­¦æ ¡çš„é£äº‘äººç‰©\",\n            \"å‘ç°é‚»å±…æ˜¯çŸ¥åçš„å¶åƒæ˜æ˜Ÿï¼Œå¹¶ä¸”ä»–ä¼¼ä¹æœ‰ä»€ä¹ˆæŠŠæŸ„åœ¨ä½ æ‰‹ä¸Š\",\n            \"ç©çš„æ‹çˆ±æ¸¸æˆçªç„¶æˆçœŸï¼Œä½ æˆäº†è¢«æ‰€æœ‰å¯æ”»ç•¥è§’è‰²è¿½é€çš„å¯¹è±¡\",\n            \"ä¸ºäº†å®¶æ—ä¼ä¸šï¼Œä¸å¾—ä¸ä¸è®¨åŒçš„å¯¹æ‰‹å‡æ‰®æƒ…ä¾£\",\n            \"æ”¶åˆ°äº†æ¥è‡ªæœªæ¥è‡ªå·±çš„ä¿¡ä»¶ï¼ŒæŒ‡å¯¼ä½ å¦‚ä½•é¿å…å­¤ç‹¬ç»ˆè€çš„å‘½è¿\",\n            \"åœ¨æ‹¥æŒ¤çš„åœ°é“ä¸Šé†’æ¥ï¼Œå‘ç°ä¸¢å¤±äº†æ‰€æœ‰è®°å¿†\",\n            \"æ”¶åˆ°ä¸€å°åŒ¿åçš„å‹’ç´¢é‚®ä»¶ï¼ŒæŒ‡å‘ä¸€ä¸ªæƒŠå¤©é˜´è°‹\",\n            \"ç›®ç¹äº†ä¸€åœºç¦»å¥‡çš„è½¦ç¥¸ï¼Œæ­»è€…å¹¶éäººç±»\",\n            \"ç»§æ‰¿äº†ä¸€å®¶æ¿’ä¸´å€’é—­çš„å’–å•¡é¦†\",\n            \"åœ¨æ·±å¤œçš„ä¾¿åˆ©åº—é‡åˆ°äº†è¯´è¯çš„çŒ«å’ª\",\n            \"æ‰‹æœºé‡Œçªç„¶å‡ºç°äº†ä¸€ä¸ªç¥ç§˜çš„èŠå¤©ç¾¤\",\n            \"åœ¨å…¬å¸åŠ ç­æ—¶å‘ç°åŒäº‹ä»¬éƒ½æ¶ˆå¤±äº†\",\n            \"è¢«å·å…¥äº†ä¸€åœºç½‘ç»œç›´æ’­ä¸­çš„è¶…è‡ªç„¶äº‹ä»¶\",\n            \"åœ¨æ‹¥æŒ¤çš„åœ°é“ä¸Šé†’æ¥ï¼Œå‘ç°æ‰€æœ‰äººæ‰‹æœºéƒ½æ”¶åˆ°äº†ä¸€æ¡æœªçŸ¥æ¥æºçš„çŸ­ä¿¡\",\n            \"ç§Ÿåˆ°äº†ä¸€é—´æå…¶ä¾¿å®œä½†æ€ªäº‹é¢‘å‘çš„å…¬å¯“\",\n            \"ç›®ç¹äº†ä¸€åœºç¦»å¥‡çš„è½¦ç¥¸ï¼Œæ­»è€…èº«ä¸Šæœ‰éäººçš„ç‰¹å¾\",\n            \"æ”¶åˆ°ä¸€ä¸ªåŒ¿ååŒ…è£¹ï¼Œé‡Œé¢æ˜¯ä¸€ä»¶èƒ½é¢„çŸ¥æœªæ¥çš„ç‰©å“\",\n            \"å‘ç°è‡ªå·±çªç„¶èƒ½å¬åˆ°å‘¨å›´äººçš„å¿ƒå£°\",\n            \"ç»§æ‰¿äº†ä¸€å®¶æ¿’ä¸´å€’é—­çš„å¤æ€ªå’–å•¡é¦†/ä¹¦åº—\",\n            \"ä¸€è§‰é†’æ¥ï¼Œå‘ç°è‡ªå·±æ˜¯æŸä¸ªç›´æ’­èŠ‚ç›®çš„å‚ä¸è€…ï¼Œè€Œè§‚ä¼—å¹¶éäººç±»\",\n            \"ç§Ÿä¸‹çš„å…¬å¯“é‡Œï¼Œæ¯æ™šåäºŒç‚¹éƒ½ä¼šå“èµ·æ•²é—¨å£°ï¼Œä½†é—¨å¤–æ€»æ˜¯ç©ºæ— ä¸€äººã€‚\",\n            \"æ‰‹æœºçªç„¶å¼€å§‹æ¨é€æ¥è‡ªâ€œå¦ä¸€ä¸ªä¸–ç•Œâ€çš„æ–°é—»å¤´æ¡ã€‚\",\n            \"æ­ä¹˜çš„æœ«ç­å…¬äº¤è½¦å¹¶æœªåœ¨ä»»ä½•å·²çŸ¥ç«™ç‚¹åœé ï¼Œæ­£é©¶å‘æœªçŸ¥åŒºåŸŸã€‚\",\n                \"æ¥åˆ°äº†ä¸€ä¸ªçœ‹ä¼¼ç®€å•çš„å¤±è¸ªäººå£æ¡ˆä»¶\",\n            \"åœ¨æ•´ç†æ—§æ¡ˆå·æ—¶å‘ç°äº†è¢«æ©ç›–çš„çœŸç›¸\",\n            \"æ”¶åˆ°äº†ä¸€å°æŒ‡å‘è¿ç¯æ€æ‰‹çš„åŒ¿åä¿¡\",\n            \"è¢«å·å…¥äº†ä¸€èµ·å¯†å®¤æ€äººæ¡ˆ\",\n            \"å‘ç°è‡ªå·±æ­£åœ¨è°ƒæŸ¥çš„æ¡ˆä»¶ä¸ç«¥å¹´é˜´å½±æœ‰å…³\",\n            \"åœ¨ä¸€ä¸ªåè¿œå°é•‡é­é‡äº†è¯¡å¼‚çš„é›†ä½“å¤±å¿†äº‹ä»¶\",\n            \"è¢«é‚€è¯·å‚åŠ ä¸€ä¸ªå¯Œè±ªçš„ç§äººèšä¼šï¼Œå´å‘ç°è¿™æ˜¯ä¸ªé™·é˜±\",\n            \"åœ¨åŒ»é™¢å€¼å¤œç­æ—¶é‡åˆ°äº†ä¸åº”è¯¥å­˜åœ¨çš„ç—…äºº\",\n            \"è°ƒæŸ¥ä¸€èµ·è½¦ç¥¸æ—¶å‘ç°æ­»è€…åœ¨äº‹æ•…å‘ç”Ÿå‰å°±å·²ç»æ­»äº¡\",\n \n            \"ä½ åœ¨ç›´æ’­ä¸­æ„å¤–æ‹åˆ°äº†ä¸è¯¥å­˜åœ¨çš„â€œä¸œè¥¿â€ï¼Œä¸€å¤œçˆ†çº¢çš„åŒæ—¶ä¹Ÿè¢«ç›¯ä¸Šäº†ã€‚\",\n            \"ä½ è¢«çˆ¶æ¯é€¼ç€å»ç›¸äº²ã€‚\",\n            \"ä½ ä¸‹ç­å›å®¶ï¼Œæ¡åˆ°ä¸€åªè„å…®å…®çš„æµæµªçŒ«ï¼Œäºå¿ƒä¸å¿å¸¦å›äº†å®¶ã€‚ç¬¬äºŒå¤©æ—©ä¸Šï¼Œä½ è¢«ä¸€å£°å·¨å“æƒŠé†’ï¼Œå‘ç°ä¸€ä¸ªé™Œç”Ÿçš„ç¾å°‘å¹´/ç¾å°‘å¥³ç©¿ç€ä½ æ˜¨æ™šç»™çŒ«æ´—æ¾¡æ—¶ç”¨çš„æµ´å·¾ï¼Œç«™åœ¨å¨æˆ¿é‡Œï¼Œå¹¶å£°ç§°æ˜¯ä½ æŠŠä»–/å¥¹å¬å”¤æ¥çš„ã€‚\",\n        \"éšæœºç”Ÿæˆ\" \n        ]\n    },\n \"è¿‘ç°ä»£\": {\n    \"identities\": [\n        \"çƒ­è¡€å­¦ç”Ÿ\",\n        \"æƒ…æŠ¥äººå‘˜\",\n        \"ä¸€çº¿è­¦å‘˜\",\n        \"å£«å…µ\",\n        \"ä¹¡æ‘åŒ»ç”Ÿ/æ•™å¸ˆ\",\n        \"å·¥å‚å·¥äºº\",\n        \"é‡‘èä»ä¸šè€…\",\n        \"æŠ¥ç¤¾è®°è€…/ç¼–è¾‘\",\n        \"ç”µå½±/æ–‡è‰ºä»ä¸šè€…\",\n        \"æ±Ÿæ¹–äººå£«\",\n        \"ç§˜å¯†é¡¹ç›®çš„ç§‘å­¦å®¶\",\n        \"é€ƒç¦»æˆ˜åŒºçš„éš¾æ°‘\",\n        \"æµ·å¤–æ´åŠ©äººå‘˜/ä¼ æ•™å£«\",\n        \"æ²¡è½çš„è´µæ—/å‰æœé—è€\",\n        \"è¿œæ´‹è´§è½®çš„æ°´æ‰‹\",\n        \"ç§å®¶ä¾¦æ¢\",\n        \"å·¥ä¼šé¢†è¢–\",\n        \"èˆªç©ºå…¬å¸çš„é£è¡Œå‘˜/ç©ºä¹˜\",\n        \"å¤–äº¤äººå‘˜\",\n        \"é€šå•†å£å²¸çš„å®ä¸šå®¶\",\n        \"è¡—å¤´çš„å°è´©\",\n        \"å®éªŒå®¤çš„ç ”ç©¶å‘˜\",\n        \"è½¦ç«™çš„æ£€ç¥¨å‘˜/è°ƒåº¦å‘˜\",\n        \"è·¨å›½å…¬å¸çš„èŒå‘˜\",\n        \"éšæœºç”Ÿæˆ\"\n    ],\n    \"openings\": [\n        \"1916å¹´ï¼Œå‡¡å°”ç™»çš„æˆ˜å£•é‡Œä¸‹ç€å†»é›¨ï¼Œä½ æ”¶åˆ°äº†ä¸€å°æ¥è‡ªæ•…ä¹¡çš„ä¿¡ã€‚\",\n        \"1929å¹´10æœˆ29æ—¥ï¼Œæ˜ŸæœŸäºŒï¼Œåå°”è¡—å¼€ç›˜çš„é’Ÿå£°åˆšåˆšæ•²å“ã€‚\",\n        \"ä½ åœ¨æ³°å¦å°¼å…‹å·çš„å¤´ç­‰èˆ±é†’æ¥ï¼Œå£è¢‹é‡Œæœ‰ä¸€å¼ ä¸å±äºè¿™ä¸ªæ—¶ä»£çš„èˆ¹ç¥¨ã€‚\",\n        \"æŸæ—å¢™ä¸‹ï¼Œä½ æ‰¾åˆ°äº†ä¸€ä¸ªåˆšå¥½å¯ä»¥å·é€’ä¸€å¼ çº¸æ¡çš„ç¼éš™ã€‚\",\n        \"1962å¹´ï¼Œä½ æ‰€åœ¨çš„æ ¸æ½œè‰‡ï¼Œåˆšåˆšæ”¶åˆ°äº†å‡†å¤‡å‘å°„æ ¸å¼¹çš„é¢„å¤‡æŒ‡ä»¤ã€‚\",\n        \"ä¹é¾™åŸå¯¨çš„éº»å°†é¦†é‡Œï¼Œå¤§ä½¬é€’ç»™ä½ ä¸€æ”¯çƒŸï¼Œè¯´æœ‰ç¬”â€˜å¤§ç”Ÿæ„â€™è¦è°ˆã€‚\",\n        \"ä¸€åç›–ä¸–å¤ªä¿å†›å®˜æ‹¦ä½äº†ä½ ï¼Œä»–ä¼¼ä¹åœ¨ä½ è—ç€çŠ¹å¤ªæœ‹å‹çš„é˜æ¥¼ä¸‹å¬åˆ°äº†ä»€ä¹ˆã€‚\",\n        \"1969å¹´ï¼Œä½œä¸ºå®‡èˆªå‘˜ï¼Œä½ åœ¨æœˆçƒçš„å°˜åœŸä¸­å‘ç°äº†ä¸€æšä¸è¯¥å­˜åœ¨çš„è„šå°ã€‚\",\n        \"å»‰æ”¿å…¬ç½²æˆç«‹çš„ç¬¬ä¸€å¤©ï¼Œä½ çš„åŠå…¬æ¡Œä¸Šå‡ºç°äº†ä¸€å°ä¸¾æŠ¥æ•´ä¸ªè­¦é˜Ÿçš„åŒ¿åä¿¡ã€‚\",\n        \"1986å¹´ï¼Œåˆ‡å°”è¯ºè´åˆ©éš”ç¦»åŒºå†…ï¼Œä½ æ‰‹ä¸­çš„ç›–é©è®¡æ•°å™¨å‘å‡ºäº†å‰æ‰€æœªæœ‰çš„è­¦æŠ¥ã€‚\",\n        \"ä½ åœ¨è·³èš¤å¸‚åœºä¹°åˆ°ä¸€å°æ—§æ”¶éŸ³æœºï¼Œå®ƒå´å˜¶å˜¶å•¦å•¦åœ°å¼€å§‹æ’­æ”¾ä¸‰å¤©åçš„æ–°é—»ã€‚\",\n        \"ä½œä¸ºä¸€åç ´è¯‘å‘˜ï¼Œä½ åˆšåˆšåœ¨æ•Œå†›çš„ç”µç ä¸­ç ´è¯‘å‡ºäº†ä¸€ä¸ªä¸å¯èƒ½çš„åœ°åï¼šäºšç‰¹å…°è’‚æ–¯ã€‚\",\n        \"æ•¦åˆ»å°”å…‹çš„æµ·æ»©ä¸Šï¼Œå¾·å†›çš„ç‚®ç«è¶Šæ¥è¶Šè¿‘ï¼Œè€Œè¿œæ–¹çš„æµ·é›¾é‡Œé©¶æ¥çš„å´æ˜¯ä¸€è‰˜å¤è€çš„å¸†èˆ¹ã€‚\",\n        \"1937å¹´çš„ä¸Šæµ·ï¼Œä½ ä¸çˆ±äººçº¦åœ¨å’–å•¡é¦†å‘Šåˆ«ï¼Œè€Œä»–/å¥¹çš„çœŸå®èº«ä»½æ˜¯æ—¥æœ¬ç‰¹åŠ¡ã€‚\",\n        \"ä½ åœ¨ä¼å¾·æ–¯æ‰˜å…‹éŸ³ä¹èŠ‚çš„æ³¥åœ°é‡Œé†’æ¥ï¼Œèº«è¾¹èººç€ä¸€ä½æœªæ¥çš„æ‘‡æ»šå·¨æ˜Ÿã€‚\",\n        \"ä¸€å¼ å†™ç€ä½ åå­—çš„å¤§å­—æŠ¥ï¼Œå‡ºç°åœ¨äº†è¡—é“æœ€æ˜¾çœ¼çš„å¢™ä¸Šã€‚\",\n        \"ä¸€ä»½å…³äºçº³ç²¹æ­£åœ¨ç§˜å¯†ç ”ç©¶çš„â€œè¶…è‡ªç„¶å†›å›¢â€çš„æ¡£æ¡ˆï¼Œæ„å¤–è½åˆ°äº†ä½ çš„æ‰‹ä¸­ã€‚\",\n        \"ä½ ååœ¨å¼€å¾€è¥¿éƒ¨çš„ç«è½¦ä¸Šï¼Œèº«è¾¹å›´ç»•ç€åœ¨å¤§è§æ¡ä¸­å¤±å»ä¸€åˆ‡çš„äººä»¬ã€‚\",\n        \"19ä¸–çºªçš„ä¼¦æ•¦ï¼Œå¼€è†›æ‰‹æ°å…‹åˆšåˆšçŠ¯ä¸‹æ–°çš„æ¡ˆä»¶ï¼Œè€Œä½ åœ¨å—å®³è€…çš„æ‰‹ä¸­å‘ç°äº†ä¸€æšå±äºä½ çš„è¢–æ‰£ã€‚\",\n        \"ä½ çˆ±ä¸Šäº†ä¸€ä½æ¥è‡ªæ•Œå¯¹é˜µè¥çš„å¤§ä½¿é¦†å·¥ä½œäººå‘˜ï¼Œä»Šæ™šä½ ä»¬è¦åœ¨ç»´ä¹Ÿçº³çš„æ¡¥ä¸Šåšæœ€åçš„è¯€åˆ«ã€‚\",\n        \"ä½ åœ¨å¼¥æ•¦é“çš„éœ“è™¹ç¯ä¸‹èº²é›¨ï¼Œä¸€ä¸ªäººä¸ºä½ æ’‘å¼€äº†ä¼ï¼Œä½ ä»¬çš„æ•…äº‹å°±æ­¤å¼€å§‹ã€‚\",\n        \"æ¿é—¨åº—çš„éå†›äº‹åŒºï¼Œä½ å’Œä¸€ä¸ªæ¥è‡ªå¦ä¸€æ–¹çš„å£«å…µï¼Œéš”ç€ä¸‰å…«çº¿åˆ†äº«äº†åŠæ”¯çƒŸã€‚\",\n        \"äº’è”ç½‘è¯ç”Ÿä¹‹åˆï¼Œä½ åœ¨ä¸€ä¸ªBBSä¸Šå‘ç°äº†ä¸€ä¸ªåä¸ºâ€˜è¡”å°¾è›‡â€™çš„ç§˜å¯†è®ºå›ï¼Œé‡Œé¢æ­£åœ¨è®¨è®ºå¦‚ä½•ä¿®æ”¹å†å²ã€‚\",\n      \"ç”²åˆæµ·æˆ˜çš„é»„æµ·ä¹‹ä¸Šï¼Œä½ æ‰€åœ¨çš„â€˜è‡´è¿œâ€™èˆ°å‘å‡ºäº†å†²å‘æ•Œèˆ°çš„æœ€åä¸€å£°é¸£ç¬›ã€‚\",\n    \"1898å¹´çš„åŒ—äº¬ï¼Œä½ ä½œä¸ºè°­å—£åŒçš„äº²ä¿¡ï¼Œæ”¶åˆ°äº†ä»–è®©ä½ è¿å¤œé€ƒäº¡çš„å¯†ä¿¡ã€‚\",\n    \"æ­¦æ˜ŒåŸå¤´çš„ç¬¬ä¸€å£°æªå“ä¼ æ¥ï¼Œä½ æ”¾ä¸‹äº†æ‰‹ä¸­æ­£åœ¨æ“¦æ‹­çš„æ±‰é˜³é€ æ­¥æªã€‚\",\n    \"1919å¹´5æœˆ4æ—¥ï¼Œä½ è¢«åŒçª—å¥½å‹æ‹‰ç€ï¼Œæ±‡å…¥äº†å‰å¾€å¤©å®‰é—¨çš„å­¦ç”Ÿäººæ½®ã€‚\",\n    \"é»„åŸ”å†›æ ¡çš„å¼€å­¦å…¸ç¤¼ä¸Šï¼Œä½ ä½œä¸ºç¬¬ä¸€æœŸå­¦å‘˜ï¼Œå¬åˆ°äº†æ ¡é•¿â€œä¸æˆåŠŸä¾¿æˆä»â€çš„è®­è¯ã€‚\",\n    \"1937å¹´çš„æ·æ²ªæˆ˜åœºï¼Œå››è¡Œä»“åº“å¤–ï¼Œç§Ÿç•Œçš„æ­Œèˆå‡å¹³ä¸å¯¹å²¸çš„æªç‚®å£°ä»…ä¸€æ²³ä¹‹éš”ã€‚\",\n    \"å»¶å®‰çš„çª‘æ´å‰ï¼Œä½ æ­£åœ¨æ²¹ç¯ä¸‹æ•™æˆ˜å£«ä»¬è¯†å­—ï¼Œä¸€ä»½åŠ æ€¥çš„æƒ…æŠ¥è¢«é€åˆ°äº†ä½ çš„æ‰‹ä¸Šã€‚\",\n    \"é‡åº†çš„é˜²ç©ºè­¦æŠ¥å†æ¬¡æ‹‰å“ï¼Œä½ æŠ±ç€å­©å­ï¼Œå’Œé‚»å±…ä»¬ä¸€èµ·åŒ†å¿™èº²è¿›æ½®æ¹¿çš„é˜²ç©ºæ´ã€‚\",\n    \"é£è™é˜Ÿçš„æœºåº“é‡Œï¼Œä½ ä½œä¸ºåœ°å‹¤äººå‘˜ï¼Œæ­£åœ¨ä¸ºä¸€ä¸ªç¾å›½é£è¡Œå‘˜çš„æˆ˜æœºç”»ä¸Šé²¨é±¼æ¶‚è£…ã€‚\",\n    \"1945å¹´çš„é‡åº†è°ˆåˆ¤ï¼Œä½ æ‹ä¸‹äº†ä¸¤ä½æ”¹å˜ä¸­å›½å‘½è¿çš„é¢†è¢–æ¡æ‰‹çš„ç¬é—´ã€‚\",\n    \"åœ¨æ·®æµ·æˆ˜å½¹çš„æ”¯æ´é˜Ÿä¼é‡Œï¼Œä½ æ¨ç€å±å‘€ä½œå“çš„ç‹¬è½®è½¦ï¼Œèµ°åœ¨æ³¥æ³çš„åœŸåœ°ä¸Šï¼Œå‰æ–¹å°±æ˜¯ç‚®ç«è¿å¤©çš„å‰çº¿ã€‚\",\n    \"1949å¹´4æœˆ23æ—¥ï¼Œä½ äº²çœ¼çœ‹åˆ°ç¬¬ä¸€é¢çº¢æ——æ’ä¸Šäº†å—äº¬â€œæ€»ç»Ÿåºœâ€çš„å±‹é¡¶ã€‚\",\n    \"1949å¹´10æœˆ1æ—¥ï¼Œä½ æŒ¤åœ¨å¤©å®‰é—¨å¹¿åœºçš„äººæµ·é‡Œï¼Œç­‰å¾…ç€é‚£ä¸ªå³å°†éœ‡åŠ¨ä¸–ç•Œçš„å£°éŸ³ã€‚\",\n    \"é•¿æ´¥æ¹–çš„å†°å¤©é›ªåœ°é‡Œï¼Œä½ æŠŠæœ€åä¸€ä¸ªå†»åœŸè±†åˆ†ç»™äº†èº«è¾¹æœ€å¹´è½»çš„æˆ˜å‹ã€‚\",\n     \"1860å¹´çš„åŒ—äº¬ï¼Œåœ†æ˜å›­çš„å†²å¤©ç«å…‰æ˜ åœ¨ä½ å«æ³ªçš„çœ¼ä¸­ï¼Œä½ æ€€é‡Œç´§ç´§æŠ±ç€ä¸€ä»¶ä»å¤§ç«ä¸­æŠ¢æ•‘å‡ºæ¥çš„çå®ã€‚\",\n    \"ä½ æ˜¯ä¸€åç•™ç¾å¹¼ç«¥ï¼Œåˆšåˆšæ¥åˆ°æœå»·çš„å‘½ä»¤ï¼Œè¢«å¼ºåˆ¶ä¸­æ–­å­¦ä¸šï¼Œå³åˆ»å›å›½ã€‚\",\n    \"ä¸œäº¤æ°‘å··çš„ä½¿é¦†åŒºå¤–ï¼Œå…«å›½è”å†›çš„æªç‚®å£°è¶Šæ¥è¶Šè¿‘ã€‚\",\n    \"â€œå››ä¸€äºŒâ€çš„å‡Œæ™¨ï¼Œä¸Šæµ·çš„è¡—å¤´è´´æ»¡äº†é€šç¼‰ä»¤ï¼Œä¸Šé¢æœ‰ä½ æ˜”æ—¥åŒå¿—çš„å¤´åƒã€‚\",\n    \"1937å¹´12æœˆï¼Œå—äº¬åŸç ´ï¼Œä½ åœ¨æ‹‰è´å…ˆç”Ÿè®¾ç«‹çš„å›½é™…å®‰å…¨åŒºé‡Œï¼Œä»é—¨ç¼å‘å¤–çª¥æ¢ç€è¡—ä¸Šçš„äººé—´åœ°ç‹±ã€‚\",\n    \"æ—¥å†›çš„731éƒ¨é˜ŸåŸºåœ°é‡Œï¼Œä½ è¢«å…³åœ¨ç‰¢æˆ¿ä¸­ï¼Œä»Šå¤©åˆæœ‰â€œé©¬è·¯å¤§â€ï¼ˆåŸæœ¨ï¼‰è¢«å¸¦èµ°ï¼Œå†ä¹Ÿæ²¡æœ‰å›æ¥ã€‚\",\n    \"èŠ±å›­å£çš„é»„æ²³å¤§å ¤è¢«ç‚¸å¼€ï¼Œä½ åœ¨æ»”å¤©çš„æ´ªæ°´ä¸­æ­»æ­»æŠ±ç€ä¸€å—é—¨æ¿ï¼Œå¯»æ‰¾ç€å¤±æ•£çš„å®¶äººã€‚\",\n    \"1942å¹´çš„æ²³å—ï¼Œé€ƒè’çš„è·¯ä¸Šï¼Œä½ å·²ç»ä¸‰å¤©æ²¡æœ‰åƒè¿‡ä¸€ç‚¹ä¸œè¥¿ï¼Œåªèƒ½é å•ƒé£Ÿæ ‘çš®ä¸ºç”Ÿã€‚\",\n    \"é•¿æ²™æ–‡å¤•å¤§ç«çš„å½“æ™šï¼Œä½ ä½œä¸ºå¥‰å‘½æ‰§è¡Œâ€œç„¦åœŸæ”¿ç­–â€çš„å£«å…µï¼Œäº²æ‰‹ç‚¹ç‡ƒäº†è‡ªå·±å®¶çš„æˆ¿å­ã€‚\",\n    \"ä½ æ˜¯ç¼…ç”¸è¿œå¾å†›çš„ä¸€å‘˜ï¼Œåœ¨é‡äººå±±çš„åŸå§‹ä¸›æ—é‡Œèº«æ‚£ç–Ÿç–¾ï¼Œä¸å¤§éƒ¨é˜Ÿå¤±å»äº†è”ç³»ã€‚\",\n    \"å°æ¹¾çš„ç™½è‰²ææ€–æ—¶æœŸï¼Œä½ çš„é‚»å±…ï¼Œä¸€ä½æ¸©å’Œçš„ä¸­å­¦è€å¸ˆï¼Œåœ¨åŠå¤œè¢«å‡ ä¸ªé™Œç”Ÿäººå¸¦èµ°ï¼Œä»æ­¤æ³æ— éŸ³ä¿¡ã€‚\",\n    \"é•¿æ˜¥å›´å›°æˆ˜ä¸­ï¼ŒåŸå†…å·²ç»æ–­ç²®æ•°æœˆï¼Œä½ ç”¨æœ€åä¸€ç‚¹é¦–é¥°æ¢æ¥çš„ä¸€å—é»‘é¢åŒ…ï¼Œè¢«é¥¥é¥¿çš„äººç¾¤æŠ¢èµ°äº†ã€‚\",\n \n        \"éšæœºç”Ÿæˆ\"\n    ]\n},\n    \"è¥¿æ–¹å¥‡å¹»\": {\n        \"identities\": [\n            \"è§ä¹ æ³•å¸ˆ\",\n            \"ç‹å›½éª‘å£«\",\n            \"åŸæ¸¸è¯—äºº\",\n            \"è¢«æµæ”¾çš„è´µæ—\",\n            \"ç›—è´¼å…¬ä¼šæˆå‘˜\",\n            \"è‰è¯å¸ˆ\",\n            \"ç‰§å¸ˆ/å¥³ç‰§å¸ˆ\",\n            \"å¾·é²ä¼Š\",\n            \"æ¸¸ä¾ \",\n            \"é“åŒ \",\n            \"ä½£å…µ\",\n            \"é­”æ³•å­¦é™¢å­¦ç”Ÿ\",\n            \"è§ä¹ æ³•å¸ˆ/å¥³æœ¯å£«\",\n            \"è½é­„çš„ç‹å›½éª‘å£«\",\n            \"é…’é¦†çš„åŸæ¸¸è¯—äºº\",\n            \"è¢«å‰¥å¤ºå¤´è¡”çš„è´µæ—\",\n            \"ç›—è´¼å…¬ä¼šçš„æ–°æ‰‹\",\n            \"æ‘åº„é‡Œçš„è‰è¯å¸ˆ\",\n            \"è¢«ç¥æ®¿æ”¶å…»çš„å­¤å„¿\",\n            \"èº²è—ä¸­çš„é¾™è£”\",\n            \"çŒé­”äºº/ç‹©é­”çŒäºº\",\n            \"é›‡ä½£å…µ\",\n            \"é€ƒäº¡çš„å…¬ä¸»/ç‹å­\",\n            \"è¢«æµæ”¾çš„è´µæ—åè£”\",\n            \"ç›—è´¼å…¬ä¼šçš„æ ¸å¿ƒæˆå‘˜\",\n            \"æŒæ¡ç¦å¿Œç‚¼é‡‘æœ¯çš„ç‚¼é‡‘æœ¯å¸ˆ\",\n            \"æš—é»‘é­”æ³•å°‘å¥³/å°‘å¹´\",\n            \"æ­£åœ¨é€ƒå©šçš„ç²¾çµç‹å­/å…¬ä¸»\",\n            \"è¢«æ¶é¾™æŠ“èµ°ä½†å’Œæ¶é¾™æˆäº†å¥½æœ‹å‹çš„äººç±»\",\n            \"å¼€å® ç‰©åº—ä¸“é—¨å”®å–å„ç§é­”æ³•ç”Ÿç‰©çš„å¹´è½»åº—ä¸»\",\n            \"è¯•å›¾ç”¨é­”æ³•æå†œä¸šé©å‘½çš„åŠåŠå­æ³•å¸ˆ\",\n            \"é€€ä¼‘çš„é­”ç‹/å‹‡è€…\",\n             \"å¸è¡€é¬¼äº²ç‹çš„è¡€å¥´\",\n            \"åœ¨é…’é¦†é‡Œè®²æ•…äº‹éª—åƒéª—å–çš„åŸæ¸¸è¯—äºº\",\n            \"éšæœºç”Ÿæˆ\"\n        ],\n        \"openings\": [\n            \"åœ¨å¤è€çš„é—è¿¹ä¸­è§¦ç¢°äº†ä¸€å—ç¬¦æ–‡çŸ³\",\n            \"ä½œä¸ºè¢«å·¨é¾™è¢­å‡»çš„å•†é˜Ÿä¸­å”¯ä¸€çš„å¹¸å­˜è€…\",\n            \"è¢«è¯¬é™·æ€å®³äº†å›½ç‹ï¼Œå¼€å§‹äº†é€ƒäº¡ç”Ÿæ¶¯\",\n            \"åœ¨æ£®æ—é‡Œæ¡åˆ°äº†ä¸€ä¸ªä¼šè¯´è¯çš„é­”æ³•ç‰©å“\",\n            \"ç»§æ‰¿äº†ç¥–çˆ¶ç•™ä¸‹çš„ç¥ç§˜æ³•å¸ˆå¡”\",\n            \"åœ¨é…’é¦†é‡Œæ¥åˆ°äº†ä¸€ä¸ªä»·å€¼ä¸è²çš„å§”æ‰˜\",\n            \"æ„å¤–å¬å”¤å‡ºäº†ä¸€ä¸ªå¼ºå¤§ä½†ä¸å—æ§åˆ¶çš„é­”ç‰©\",\n            \"å‘ç°è‡ªå·±æ˜¯ä¼ è¯´ä¸­å‹‡è€…çš„è½¬ä¸–\",\n            \"è¢«é€‰ä¸­å‚åŠ ç‹å®¤çš„ç§˜å¯†ä»»åŠ¡\",\n            \"åœ¨é­”æ³•å­¦é™¢çš„ç¦ä¹¦åŒºå‘ç°äº†ç¦å¿Œæ³•æœ¯\",\n            \"åœ¨å¤è€çš„é—è¿¹ä¸­è§¦ç¢°äº†ä¸€å—ç¬¦æ–‡ï¼Œè¢«ä¼ é€åˆ°äº†æœªçŸ¥ä¹‹åœ°\",\n            \"ä½œä¸ºè¢«å·¨é¾™è¢­å‡»çš„å•†é˜Ÿä¸­å”¯ä¸€çš„å¹¸å­˜è€…ï¼Œèº«ä¸Šå¤šäº†ä¸€ä¸ªé¾™çº¹çƒ™å°\",\n            \"è¢«è¯¬é™·åˆºæ€äº†å›½ç‹ï¼Œä¸å¾—ä¸åœ¨è¿½æ•ä¸­å¯»æ‰¾çœŸç›¸\",\n            \"åœ¨æ£®æ—é‡Œæ¡åˆ°äº†ä¸€ä¸ªä¼šè¯´è¯ã€æ€§æ ¼æ¶åŠ£çš„é­”æ³•ç‰©å“\",\n            \"å®¶ä¹¡è¢«é­”æ½®æ¯ç­ï¼Œä½ æ˜¯å”¯ä¸€çš„å¹¸å­˜è€…\",\n            \"ä¸ºäº†å¿è¿˜å·¨é¢èµŒå€ºï¼Œç­¾ä¸‹äº†ä¸€ä»½å±é™©çš„é­”æ³•å¥‘çº¦\",\n            \"åœ¨å¤è€çš„é—è¿¹ä¸­è§¦ç¢°äº†ä¸€å—ç¬¦æ–‡çŸ³ï¼Œä¸€ä¸ªå¤è€çš„çµé­‚å¯„å®¿åœ¨äº†ä½ çš„ä½“å†…ã€‚\",\n            \"ä½œä¸ºè¢«å·¨é¾™è¢­å‡»çš„å•†é˜Ÿä¸­å”¯ä¸€çš„å¹¸å­˜è€…ï¼Œä½ è·å¾—äº†é¾™çš„ä¸€éƒ¨åˆ†åŠ›é‡ã€‚\",\n            \"ä½ çš„â€œå‰ç¥¥ç‰©â€å‘Šè¯‰ä½ ï¼Œæƒ³è¦è·å¾—æ›´å¼ºçš„åŠ›é‡ï¼Œå°±å¿…é¡»çŒ®ä¸Šä½ æœ€çè´µçš„ä¸œè¥¿ï¼Œæ¯”å¦‚æƒ…æ„Ÿæˆ–è®°å¿†ã€‚\",\n            \"è’¸æ±½æœ‹å…‹éƒ½å¸‚é‡Œï¼Œä½ æ˜¯ä¸€åä½¿ç”¨é­”æ³•é©±åŠ¨çš„æœºæ¢°è‡‚çš„ä¾¦æ¢ï¼Œæ­£åœ¨è°ƒæŸ¥ä¸€å®—ç¦»å¥‡çš„ç‚¼é‡‘è°‹æ€æ¡ˆã€‚\",\n            \"è¯¸ç¥é»„æ˜å·²ç»å¼€å§‹ï¼Œä½œä¸ºè¢«é€‰ä¸­çš„å‹‡è€…ï¼Œä½ çš„ä»»åŠ¡ä¸æ˜¯æ‹¯æ•‘ä¸–ç•Œï¼Œè€Œæ˜¯ç¡®ä¿é˜¿æ–¯åŠ å¾·å½»åº•æ¯ç­ã€‚\",\n            \"éšæœºç”Ÿæˆ\",\n            \"ä½ æ­£åœ¨ä¸é‚»å›½ç‹å­/å…¬ä¸»ä¸¾è¡Œç››å¤§çš„å©šç¤¼ï¼Œä¸€åªå·¨å¤§çš„ç‹®é¹«çªç„¶ä»å¤©è€Œé™æŠ“èµ°äº†ä½ .\",\n            \"ä½ ç»§æ‰¿äº†è¿œæ–¹å”å”ç•™ä¸‹çš„ä¸€å®¶å°é…’é¦†ï¼Œå¼€ä¸šç¬¬ä¸€å¤©æ‰å‘ç°ï¼Œè¿™é‡Œçš„å¸¸å®¢æ˜¯é€€ä¼‘åæ²‰è¿·é’“é±¼çš„é­”ç‹ã€éšå±…å±±æ—ç ”ç©¶å¨è‰ºçš„å‹‡è€…å’Œå¤©å¤©æ¥è¹­é…’å–çš„æ‘¸é±¼å¥³ç¥ã€‚\",\n            \"ä½ æŒ‰ç…§å¤ä¹¦çš„æŒ‡å¼•ä¸¾è¡Œäº†æ¶é­”å¬å”¤ä»ªå¼ï¼Œå¸Œæœ›èƒ½è·å¾—è´¢å¯Œå’ŒåŠ›é‡ã€‚ç»“æœå¬å”¤æ¥ä¸€ä¸ªåªä¼šæ‰“æ‰«å«ç”Ÿã€çƒ¹é¥ªç¾é£Ÿçš„æ¶é­”ç®¡å®¶ï¼Œå¹¶å¼ºè¡Œå’Œä½ ç­¾è®¢äº†ä¸€ä»½ç»ˆèº«â€œåŠ³åŠ¨åˆåŒâ€ã€‚\"\n        ]\n    },\n    \"ä¸œæ–¹ç„å¹»\": {\n        \"identities\": [\n            \"å¤–é—¨å¼Ÿå­\",\n            \"ç‚¼ä¸¹å­¦å¾’\",\n            \"ä¸–å®¶å­å¼Ÿ/åƒé‡‘\",\n            \"éšå±…æ•£ä¿®\",\n            \"è—ç»é˜çœ‹å®ˆ\",\n            \"å®—é—¨æ‰§äº‹\",\n            \"æ¸¸å†æ•£ä»™\",\n            \"é­”é“ä¿®å£«\",\n            \"ä¸¹å¸ˆ\",\n            \"å™¨å¸ˆ\",\n            \"é˜µæ³•å¸ˆ\",\n            \"é©¯å…½å¸ˆ\",\n            \"å®—é—¨çš„å¤–é—¨å¼Ÿå­\",\n            \"ç‚¼ä¸¹æˆ¿å­¦å¾’\",\n            \"æ²¡è½çš„ä¸–å®¶å­å¼Ÿ\",\n            \"éšå±…æ•£ä¿®çš„è®°åå¼Ÿå­\",\n            \"çœ‹å®ˆè—ç»é˜çš„å‡¡äºº\",\n            \"è¢«é€€å©šçš„å¤©æ‰/åºŸæŸ´\",\n            \"å¦–æ—ä¸äººæ—çš„æ··è¡€åè£”\",\n            \"äº‘æ¸¸å››æ–¹çš„ç”»å¸ˆ/ç´å¸ˆ\",\n            \"ç‹æœçš„é’¦å¤©ç›‘å°å\",\n            \"é’æ¥¼çš„èŠ±é­/ä¹å¸ˆ\",\n            \"è¢«åºŸæ‰ä¿®ä¸ºåé‡ä¿®çš„â€œåºŸæŸ´â€å¤©æ‰\",\n            \"æŸä¸ªéšä¸–å®—é—¨çš„å¸ˆå°Šæˆ–å¸ˆç¥–\",\n            \"é ç‰¹æ®ŠåŠŸæ³•å¿«é€Ÿæå‡çš„é­”é“ä¿®å£«\",\n            \"æ‰§æŒå¤©é“åˆ‘ç½šçš„â€œå¤©å¾‹é˜â€æˆå‘˜\",\n            \"æ‹¥æœ‰ã€Šå±±æµ·ç»ã€‹å¹¶èƒ½å¬å”¤å¼‚å…½çš„å¾¡å…½å¸ˆ\",\n            \"é€€å©šæµä¸»è§’çš„é‚£ä½å‰æœªå©šå¦»/å¤«\",\n            \"è¢«é€€å©šåä¸“å¿ƒæäº‹ä¸šã€ä¸€å¿ƒåªæƒ³å˜å¼ºçš„å‰æœªå©šå¦»/å¤«\",\n            \"ç©¿æˆé¾™å‚²å¤©èº«è¾¹çš„å°å¼Ÿå¹¶å†³å®šæŠ±ç´§å¤§è…¿çš„æœºæ™ºè·¯äººç”²\",\n            \"ä¸“é—¨ç»™å„å¤§å®—é—¨å†™å…«å¦ç»¯é—»å°æŠ¥çš„è¯æœ¬å…ˆç”Ÿ\",\n   \"éšæœºç”Ÿæˆ\"\n \n        ],\n        \"openings\": [\n            \"æµ‹è¯•çµæ ¹æ—¶å¼•å‘äº†å¤©åœ°å¼‚è±¡\",\n            \"è¢«é€€å©šåç«‹ä¸‹ä¸‰å¹´ä¹‹çº¦\",\n            \"åœ¨å®—é—¨è¯•ç‚¼ä¸­è¯¯å…¥ä¸Šå¤ç§˜å¢ƒ\",\n            \"è¢«å¸ˆå°Šæ‰˜ä»˜äº†å…³ä¹å®—é—¨å­˜äº¡çš„é‡è¦ä»»åŠ¡\",\n            \"åœ¨æ¸¡åŠ«æ—¶è¢«é›·åŠˆå›åˆ°äº†åƒå¹´å‰\",\n            \"æ„å¤–è·å¾—äº†ä¸€æœ¬è®°è½½ä»™ç•Œç§˜è¾›çš„å¤ç±\",\n            \"æµ‹è¯•çµæ ¹æ—¶æ„å¤–å¼•å‘äº†å¤©åœ°å¼‚è±¡ï¼Œå¼•æ¥äº†å¤šæ–¹çª¥ä¼º\",\n            \"æ— æ„ä¸­æ”¾å‡ºäº†è¢«å®—é—¨å°å°çš„å¦–ç‰©/é­”å¤´\",\n            \"è¢«è¿«ä»£æ›¿å¦¹å¦¹/å¼Ÿå¼Ÿå«ç»™/å…¥èµ˜ä¸€ä¸ªè‘—åçš„åºŸæŸ´/æ­»äºº\",\n            \"åœ¨å‡¡é—´ä¹¦åº—ä¹°åˆ°ä¸€æœ¬å‡å†’çš„åŠŸæ³•ï¼Œæ²¡æƒ³åˆ°ç«Ÿç»ƒå‡ºäº†çœŸæ­£çš„ç»ä¸–ç¥é€šã€‚\",\n            \"é€ƒå©šé€”ä¸­æ„å¤–å å´–ï¼Œè¢«ä¸€ä½éšä¸–é«˜äººæ‰€æ•‘å¹¶å¼ºè¡Œä¼ æˆäº†è¡£é’µã€‚\",\n            \"ä½ çš„ä»»åŠ¡æ˜¯ä½œä¸ºå¹•åæ¨æ‰‹ï¼Œåœ¨è¿™ä¸ªæœ«æ³•æ—¶ä»£å¼•å¯¼ä¸–ç•Œå®Œæˆâ€œçµæ°”å¤è‹â€æˆ–â€œç¥è¯å¤è‹â€ã€‚\"\n        ]\n    },\n    \"è¥¿æ–¹ç¥è¯\": {\n    \"identities\": [\n        \"ç¥æ®¿çš„ç¥­å¸/å¥³ç¥­å¸\",\n        \"æµç€ç¥æ˜è¡€è„‰çš„åŠç¥\",\n        \"è¢«ç¥é€‰ä¸­çš„å…ˆçŸ¥/ç¥ä½¿\",\n        \"æŸä¸ªåŸé‚¦çš„å›½ç‹/å¥³ç‹\",\n        \"å²è¯—ä¸­ä¼ å”±çš„è‹±é›„/å‹‡å£«\",\n        \"å¥¥æ—åŒ¹æ–¯/é˜¿æ–¯åŠ å¾·çš„ä¾å¥‰è€…\",\n        \"é”»é€ ç¥å™¨çš„çŸ®äººå·¥åŒ \",\n        \"æ£®æ—é‡Œçš„å¾·é²ä¼Š/å¥³å·«\",\n        \"å¯»æ‰¾çŸ¥è¯†çš„å­¦è€…/æŠ„å†™å‘˜\",\n        \"å®ˆæŠ¤åœ£ç‰©çš„éª‘å£«\",\n        \"ç«æŠ€åœºçš„è§’æ–—å£«\",\n        \"æ™®é€šçš„å†œæ°‘/ç‰§ç¾Šäºº\",\n        \"å‡ºæµ·è¿œèˆªçš„èˆ¹é•¿/æ°´æ‰‹\",\n        \"è¢«æ”¾é€çš„ç‹å­/å…¬ä¸»\",\n        \"è¢«è¯…å’’ä¹‹äºº/æ€ªç‰©\",\n        \"åœ°ç‹±çš„æ‘†æ¸¡äºº/å®ˆé—¨äºº\",\n        \"æ¸¸è¡åœ¨ä¸–é—´çš„ç²¾çµ/ä»™çµ\",\n        \"è¢«é—å¿˜æ—§ç¥çš„åè£”\",\n        \"ä¸“é—¨çŒæ€æ€ªç‰©çš„çŒæ‰‹\",\n        \"å¤©å ‚æ”¾é€çš„å •è½è€…\",\n        \"æ‰§æŒä¸€æ–¹æƒèƒ½çš„å°ç¥/è‡ªç„¶çµ\",\n        \"åŸƒåŠçš„æ³•è€/å¤§ç¥­å¸\",\n        \"åŒ—æ¬§çš„å¥³æ­¦ç¥/ç‹‚æˆ˜å£«\",\n        \"æŸä¸ªç§˜å¯†æ•™å›¢çš„åˆºå®¢\",\n        \"éšæœºç”Ÿæˆ\"\n    ],\n    \"openings\": [\n        \"å¥¥æ—åŒ¹æ–¯åœ£å±±ä¸Šï¼Œå®™æ–¯çš„é›·éœ†æƒæ–å¤±çªƒäº†ã€‚\",\n        \"ä¸€ä¸ªåˆ»ç€â€œçŒ®ç»™æœ€ç¾ä¹‹äººâ€çš„é‡‘è‹¹æœï¼Œè¢«æ‰”è¿›äº†ä¼—ç¥çš„å®´ä¼šå…ã€‚\",\n        \"åœ°ç‹±çš„ä¸‰å¤´æ¶çŠ¬åˆ»è€³æŸæ´›æ–¯ç¡ç€äº†ï¼Œäº¡çµæ­£ä»å†¥åºœçš„è£‚éš™ä¸­é€ƒå‡ºã€‚\",\n        \"æ™®ç½—ç±³ä¿®æ–¯ç›—å–çš„å¤©ç«ï¼Œåœ¨å‡¡é—´å¼•å‘äº†ä¸€åœºæ— æ³•è¢«æ‰‘ç­çš„å¤§ç«ã€‚\",\n        \"ç‰¹æ´›ä¼ŠåŸä¸‹ï¼Œä¸€åŒ¹å·¨å¤§çš„æœ¨é©¬è¢«é€åˆ°äº†åšä¸å¯æ‘§çš„åŸé—¨å‰ã€‚\",\n        \"åŒ—æ¬§çš„ä¸–ç•Œä¹‹æ ‘â€œå°¤å…‹ç‰¹æ‹‰å¸Œå°”â€ï¼Œå®ƒçš„ä¸€æ ¹æå¹²æ¯«æ— å¾å…†åœ°æ¯èäº†ã€‚\",\n        \"å½©è™¹æ¡¥â€œæ¯•å¼—ç½—æ–¯ç‰¹â€çš„ä¸­å¤®ï¼Œå‡ºç°äº†ä¸€é“æ·±ä¸è§åº•çš„è£‚ç—•ã€‚\",\n        \"æŒ£è„±äº†æŸç¼šçš„å·¨ç‹¼èŠ¬é‡Œå°”ï¼Œåœ¨å¤©è¾¹åé£Ÿäº†å¤ªé˜³æˆ–æœˆäº®ã€‚\",\n        \"å°¼ç½—æ²³ä»Šå¹´çš„æ³›æ»¥æ²¡æœ‰å¦‚æœŸè€Œè‡³ï¼Œæ•´ä¸ªåŸƒåŠé™·å…¥äº†å¯¹é¥¥è’çš„ææƒ§ã€‚\",\n        \"æ³•è€é™µå¢“çš„æ·±å¤„ï¼Œç”¨æ¥ç§°é‡å¿ƒè„çš„çœŸç†å¤©å¹³ä¸è§äº†ã€‚\",\n        \"äº¡è€…ä¹‹ä¹¦ä¸Šï¼Œæµ®ç°å‡ºäº†ä¸€ä¸ªä»æœªè¢«è®°è½½è¿‡çš„ã€å¯ä»¥è®©æ­»è€…å®Œå…¨å¤æ´»çš„å’’è¯­ã€‚\",\n        \"äºšç‘Ÿç‹çš„åœ£å‰‘â€œExcaliburâ€ä»æ¹–ä¸­å†æ¬¡ç°ä¸–ï¼Œç­‰å¾…ç€æ–°çš„ä¸»äººã€‚\",\n        \"å¾·é²ä¼Šçš„åœ£æ—ä¸­ï¼Œæœ€å¤è€çš„ä¸€æ£µæ©¡æ ‘çš„æ ‘å¹²ä¸Šï¼Œæµå‡ºäº†äººç±»çš„é²œè¡€ã€‚\",\n        \"å¤©å ‚çš„ä¸€ä½å¤§å¤©ä½¿æ“…è‡ªç¦»å¼€äº†è‡ªå·±çš„å²—ä½ï¼Œæ²¡æœ‰ç•™ä¸‹ä»»ä½•ä¿¡æ¯ä¾¿é™ä¸´å‡¡é—´ã€‚\",\n        \"å°å°ç€åœ°ç‹±ä¸ƒé­”ç‹ä¹‹ä¸€çš„å¤è€é”é“¾ï¼Œå‘å‡ºäº†ä¸€å£°æ¸…è„†çš„æ–­è£‚å£°ã€‚\",\n        \"å¤©å¯å››éª‘å£«ä¸­çš„ç¬¬ä¸€ä½â€”â€”â€œç˜Ÿç–«â€ï¼Œå·²ç»éª‘ç€ç™½é©¬å‡ºç°åœ¨äº†é¥è¿œçš„åœ°å¹³çº¿ä¸Šã€‚\",\n        \"æ½˜å¤šæ‹‰çš„é­”ç›’è¢«å†æ¬¡æ‰“å¼€ï¼Œä½†è¿™æ¬¡ä»ä¸­é£å‡ºçš„ï¼Œæ˜¯ä¸–é—´æ‰€æœ‰çš„â€œå¸Œæœ›â€ã€‚\",\n        \"ä¼Šé˜¿å®‹çš„é‡‘ç¾Šæ¯›è¿œå¾èˆ¹é˜Ÿï¼Œåœ¨å½’èˆªæ—¶é­é‡äº†æ¥è‡ªæ·±æµ·çš„å¡å£¬æ­Œå£°ã€‚\",\n        \"ä¸ºè¥¿è¥¿å¼—æ–¯æ¨ä¸Šå±±çš„å·¨çŸ³ï¼Œä»Šå¤©åœåœ¨äº†å±±é¡¶ï¼Œæ²¡æœ‰æ»šè½ä¸‹æ¥ã€‚\",\n        \"äººç±»ä¸ä»™çµçš„è¾¹ç•Œå˜å¾—æ¨¡ç³Šï¼Œæœ‰å­©å­åœ¨æ£®æ—é‡Œè¿·è·¯åï¼Œå¸¦ç€ç¥å¥‡çš„èƒ½åŠ›å›æ¥äº†ã€‚\",\n        \"å‰å°”ä¼½ç¾ä»€å¯»æ‰¾æ°¸ç”Ÿä¹‹æ³•çš„æ—…é€”ï¼Œåœ¨ç»ˆç‚¹å‘ç°äº†ä¸€æ‰‡é€šå¾€å¼‚ä¸–ç•Œçš„å¤§é—¨ã€‚\",\n        \"å·´åˆ«å¡”çš„å»ºç­‘å·¥åœ°ä¸Šï¼Œäººä»¬çªç„¶åˆèƒ½å¬æ‡‚å½¼æ­¤çš„è¯­è¨€äº†ã€‚\",\n        \"éšæœºç”Ÿæˆ\"\n    ]\n},\n    \"ä¸œæ–¹ç¥è¯\": {\n    \"identities\": [\n        \"å¤©åº­çš„æŸä½æ˜Ÿå›\",\n        \"ä¸€å¤´é’ç‰›\",\n        \"èŸ æ¡ƒå›­é‡Œçš„å°ä»™\",\n        \"è¢«è´¬ä¸‹å‡¡çš„ç¥ä»™\",\n        \"å±±é—´çš„åœŸåœ°ç¥/å±±ç¥\",\n        \"ç‚¼ä¸¹ç‚‰æ—çš„é“ç«¥\",\n        \"å—å¤©é—¨çš„å®ˆé—¨å¤©å°†\",\n        \"åˆšåˆšä¿®å‡ºäººå½¢çš„å°å¦–\",\n        \"å å±±ä¸ºç‹çš„å¤§å¦–\",\n        \"ç­‰å¾…æŠ¥æ©çš„ç‹ä»™/è›‡å¦–\",\n        \"äººå’Œå¦–çš„æ··è¡€åä»£\",\n        \"å±±æµ·ç»ä¸­è®°è½½çš„å¼‚å…½\",\n        \"ä½›é™€åº§ä¸‹çš„å¬ç»æ²™å¼¥\",\n        \"æ‰§æŒä¸€æ®¿çš„é˜ç½—/åˆ¤å®˜\",\n        \"å¿˜å·æ²³ç•”çš„æ‘†æ¸¡äºº\",\n        \"å¼•æ¸¡äº¡é­‚çš„é¬¼å·®\",\n        \"æ— æ³•è½¬ä¸–çš„æ¸¸é­‚\",\n        \"äº‘æ¸¸å››æ–¹çš„åœ°ä»™\",\n        \"è¯¯å…¥ä»™å¢ƒçš„æ¨µå¤«/é‡‡è¯äºº\",\n        \"æ–©å¦–é™¤é­”çš„é“å£«/æ³•å¸ˆ\",\n        \"èƒ½çœ‹è§é¬¼ç¥çš„é€šçµè€…\",\n        \"æŸä¸ªå‡¡äººç‹æœçš„å›½å¸ˆ\",\n        \"é¾™å®«çš„è™¾å…µ/èŸ¹å°†\",\n        \"å¬åœ£äººè®²é“çš„ç”Ÿçµ\",\n        \"ä¸Šå¤å·«æ—çš„åè£”\",\n          \"è¥¿ç‹æ¯åº§ä¸‹çš„é’é¸Ÿä½¿è€…\",\n    \"æ˜†ä»‘å±±ç¥æ ‘çš„çœ‹å®ˆè€…\",\n    \"æœˆå®«é‡Œæ£è¯çš„ç‰å…”\",\n    \"å¸æŒé£é›¨é›·ç”µçš„ä»™å®˜\",\n    \"è´¢ç¥åº§ä¸‹çš„è¿è´¢ç«¥å­\",\n    \"æ‰§æŒäººé—´åŠŸè¿‡çš„ç¶å›\",\n    \"åŸéšåº™é‡Œçš„æ—¥æ¸¸ç¥/å¤œæ¸¸ç¥\",\n    \"ä¿®ç‚¼æœ‰æˆçš„åƒµå°¸/æ—±é­ƒ\",\n    \"å¯„å±…åœ¨å¤ç‰©ä¸­çš„å™¨çµ\",\n    \"å¼•è¯±ä¹¦ç”Ÿçš„ç”»çš®ç¾å¦–\",\n    \"åå…«å±‚åœ°ç‹±çš„ç‹±å’\",\n    \"é•‡å®ˆä½›å¡”çš„é˜¿ä¿®ç½—ä¼—\",\n    \"ç»™ä½›é™€çŒ®èŠ±çš„é£å¤©/å¤©å¥³\",\n    \"ç»§æ‰¿äº†ç¨€è–„ç¥è¡€çš„å‡¡äºº\",\n    \"ä¸Šå¤å¤§å·«çš„è¡€è„‰åè£”\",\n    \"è¢«é«˜äººç‚¹åŒ–äº†çš„çµå…½\",\n    \"è¿½æ—¥çš„å¤¸çˆ¶æ—äºº\",\n    \"è¯•å›¾å¡«å¹³ä¸œæµ·çš„ç²¾å«é¸Ÿ\",\n    \"æ·±å±±ä¸­çš„å°¸è§£ä»™\",\n    \"ä»¥æ¢¦å¢ƒä¸ºé£Ÿçš„æ¢¦è²˜\",\n        \"éšæœºç”Ÿæˆ\"\n    ],\n    \"openings\": [\n        \"èŸ æ¡ƒç››ä¼šå³å°†å¼€å§‹ï¼Œä½ å´å‘ç°ä½ çš„è¯·æŸ¬è¢«äººå·èµ°äº†ã€‚\",\n        \"ä½ çš„å¤©åŠ«å³å°†æ¥ä¸´ï¼Œä½†ä½ æ„Ÿåº”åˆ°æœ‰ä»‡å®¶æ­£è—åœ¨é›·äº‘ä¹‹ä¸­ã€‚\",\n        \"ä¸€ä»¶ä¸Šå¤ç¥å™¨å³å°†åœ¨ä¸å‘¨å±±å‡ºä¸–ï¼Œä¸‰ç•Œå„æ–¹åŠ¿åŠ›éƒ½å·²é—»é£è€ŒåŠ¨ã€‚\",\n        \"ä½ åœ¨ä¸œæµ·ä¹‹æ»¨æ¡åˆ°äº†ä¸€ä¸ªå©´å„¿ï¼Œä»–çš„çœ‰å¿ƒç«Ÿæœ‰ç¬¬ä¸‰åªçœ¼ã€‚\",\n        \"ç”Ÿæ­»ç°¿ä¸Šä½ çš„åå­—è¢«äººç”¨æœ±ç ‚ç¬”åˆ’æ‰äº†ï¼Œè€Œä½ è¿˜æ´»å¾—å¥½å¥½çš„ã€‚\",\n        \"ä½ åœ¨å–ç»äººçš„å¿…ç»ä¹‹è·¯ä¸Šå¼€è¾Ÿäº†æ´åºœï¼Œæ­£æ€è€ƒç€è¯¥å¦‚ä½•çƒ¹é¥ªå”åƒ§è‚‰ã€‚\",\n        \"å¥³å¨²è¡¥å¤©çš„äº”å½©çŸ³è¿˜å‰©ä¸‹æœ€åä¸€é¢—ï¼Œå®ƒä»å¤©ä¸Šå è½ï¼Œæ­£å¥½ç ¸åœ¨äº†ä½ çš„æ´åºœé—¨å‰ã€‚\",\n        \"å°ç¥æ¦œå³å°†é‡å¼€ï¼Œä½ çš„å¸ˆçˆ¶å‘Šè¯‰ä½ ï¼Œè¿™æ¬¡çš„æ¦œä¸Šå°†ä¼šæœ‰ä½ çš„åå­—ã€‚\",\n        \"å­™æ‚Ÿç©ºå¤§é—¹å¤©å®«ä¹‹æ—¶ï¼Œä½ ä½œä¸ºä¸€åå¤©å°†ï¼Œå¥‰å‘½å‰å»é•‡å‹ã€‚\",\n        \"å·«å¦–å¤§æˆ˜çš„å‰å¤•ï¼Œä½ å¿…é¡»åœ¨å¸æ±Ÿå’Œå¸ä¿Šä¹‹é—´åšå‡ºé€‰æ‹©ã€‚\",\n        \"ä½ åœ¨å¥ˆä½•æ¡¥ä¸Šæ­£è¦å–ä¸‹å­Ÿå©†æ±¤ï¼Œå´çªç„¶æƒ³èµ·äº†ä¹ä¸–ä¹‹å‰åˆ»éª¨é“­å¿ƒçš„ä»‡æ¨ã€‚\",\n        \"åœ°åºœçš„åå…«å±‚åœ°ç‹±ç ´å¼€äº†ä¸€ä¸ªç¼ºå£ï¼Œæ— æ•°æ¶é¬¼æ­£æ¶Œå‘äººé—´ã€‚\",\n        \"ä½ æ‰€åœ¨çš„å‡¡äººæ‘åº„ï¼Œå¸¸å¹´ç¥­ç¥€çš„å±±ç¥åº™ï¼Œä»Šå¹´å´æ²¡æœ‰æ˜¾çµã€‚\",\n        \"ä½ åœ¨æ·±å±±ä¸­ä¿®ç‚¼äº†åƒå¹´ï¼Œä»Šå¤©ç¬¬ä¸€æ¬¡è¿›åŸï¼Œå´è¢«è¡—ä¸Šçš„è½¦æ°´é©¬é¾™è¿·ä½äº†çœ¼ã€‚\",\n        \"å¸ˆçˆ¶äº¤ç»™ä½ ä¸€ä¸ªä»»åŠ¡ï¼Œå»ä¸‰ç•Œä¹‹ä¸­ï¼Œå¯»å›æ•£è½åœ¨å„å¤„çš„æ²³å›¾æ´›ä¹¦ç¢ç‰‡ã€‚\",\n        \"ä½ åœ¨ç´«éœ„å®«ä¸­å¬é¸¿é’§è€ç¥–è®²é“ï¼Œä½†ååœ¨ä½ å‰é¢çš„é‚£å€‹ç”Ÿçµï¼Œä¼¼ä¹æ˜¯ä½ çš„å®¿æ•Œã€‚\",\n        \"ä½œä¸ºé¾™ç‹ï¼Œä½ å‘ç°ä½ çš„å®šæµ·ç¥é’ˆä¸è§äº†ã€‚\",\n        \"ä½›é™€åœ¨çµå±±è®²æ³•ï¼Œå¤©èŠ±ä¹±å ï¼Œä½ ä¼¼ä¹å¬æ‡‚äº†ä»€ä¹ˆã€‚\",\n        \"ä½ æ˜¯ä¸€åªåˆšä¿®æˆæ­£æœçš„é»„çš®å­ï¼Œå´è¢«ä¸€ä¸ªå‡¡äººä¹¦ç”Ÿè¯¯è®¤ä¸ºæ˜¯ç‹ä»™ï¼Œæ—¥å¤œå‘ä½ è®¸æ„¿æ±‚å§»ç¼˜ã€‚\",\n         \"æ˜†ä»‘å±±çš„å»ºæœ¨ç¥æ ‘å¼€å§‹æ¯èï¼Œä¸‰ç•Œä¹‹å†…ï¼Œè‰æœ¨å‡‹é›¶ã€‚\",\n    \"ä¼ è¯´ä¸­çš„â€œäººå‚æœâ€å³å°†æˆç†Ÿï¼Œæ®è¯´é—»ä¸€é—»ï¼Œå°±èƒ½æ´»ä¸‰ç™¾å…­åå²ã€‚\",\n    \"åå¤§é‡‘ä¹Œä¸€é½å‡ºç°åœ¨å¤©ç©ºï¼Œå¤§åœ°è¢«ç‚™çƒ¤ï¼Œå‡¡é—´å·²æˆç‚¼ç‹±ã€‚\",\n    \"å…°è‹¥å¯ºçš„é’Ÿå£°åœ¨åˆå¤œå“èµ·ï¼Œä½†é‚£åº§å¯ºåº™æ—©å·²è’åºŸäº†ç™¾å¹´ã€‚\",\n    \"ä¸œæµ·é¾™å®«çš„å®šæµ·ç¥é’ˆçªç„¶å¤±çªƒï¼Œé¾™ç‹éœ‡æ€’ï¼Œæ‚¬èµä¸‰ç•Œå¯»æ‰¾çº¿ç´¢ã€‚\",\n    \"ä¸€åœºæ— åçš„ç˜Ÿç–«ä»å‡¡é—´å¼€å§‹è”“å»¶ï¼Œå°±è¿å¤©ä¸Šçš„ç¥ä»™ä¹Ÿæ„Ÿåˆ°æ³•åŠ›æ»æ¶©ã€‚\",\n    \"å…­å¤§åœ£äººçº·çº·ç«‹æ•™ï¼Œä¸€æ—¶é—´ï¼Œäººã€é˜ã€æˆªã€è¥¿æ–¹æ•™ç­‰å¼€å§‹åœ¨ä¸‰ç•Œä¹‹ä¸­å¹¿æ”¶é—¨å¾’ã€‚\",\n    \"æœ‰äººåœ¨ä¸‰ç”ŸçŸ³ä¸Šï¼Œç”¨åˆ€åˆ»ä¸‹äº†ä¸¤ä¸ªæœ¬ä¸è¯¥åœ¨ä¸€èµ·çš„åå­—ã€‚\",\n    \"ä¸€å¹…æç»˜ç€é£å¤©ä»™å¥³çš„å¤ç”»è¢«å±•å‡ºï¼Œä¼ è¯´ç”»ä¸­çš„ä»™å¥³ä¼šåœ¨æœˆåœ†ä¹‹å¤œèµ°ä¸‹æ¥ã€‚\",\n    \"ä½›é“ä¸¤å®¶å°†ä¸¾è¡Œä¸€åœºâ€œæ°´é™†å¤§ä¼šâ€è¿›è¡Œè¾©æ³•ï¼Œèƒœè€…å°†æ‰§æŒæœªæ¥åƒå¹´çš„å‡¡é—´ä¿¡ä»°ã€‚\",\n    \"é…†éƒ½é¬¼åŸçš„å¤§é—¨ä¸çŸ¥è¢«è°æ‰“å¼€ï¼Œç™¾é¬¼å¤œè¡Œï¼Œæ­£åœ¨äººé—´æ¸¸è¡ã€‚\",\n    \"æœ‰äººè¯´ï¼Œåœ¨åŒ—å†¥ä¹‹æµ·çš„å°½å¤´ï¼Œçœ‹åˆ°äº†é‚£åªåä¸ºâ€œé²²â€çš„å·¨å…½ã€‚\",\n \n    \"äººé—´ä¸€ä½å¸ç‹å¦„æƒ³é•¿ç”Ÿï¼Œæ­£åœ¨æ´¾äººå››å¤„å¯»æ‰¾ä¼ è¯´ä¸­çš„â€œä¸æ­»è¯â€ã€‚\",\n \n        \"éšæœºç”Ÿæˆ\"\n    ]\n},\n    \"èµ›åšæœ‹å…‹\": {\n        \"identities\": [\n            \"ä¹‰ä½“åŒ»ç”Ÿ\",\n            \"æ•°æ®é»‘å®¢\",\n            \"å…¬å¸ç‰¹å·¥\",\n            \"åº•å±‚æ‹¾è’è€…\",\n            \"å¸®æ´¾æ‰“æ‰‹\",\n            \"è®°å¿†è´©å­\",\n            \"ä¹‰ä½“æ”¹é€ å¸ˆ\",\n            \"AIè°ƒè¯•å¸ˆ\",\n            \"è™šæ‹Ÿå¶åƒ\",\n            \"ä¼ä¸šé—´è°\",\n            \"ç½‘ç»œå¹½çµ\",\n            \"ç”ŸåŒ–äºº\",\n            \"é»‘å¸‚ä¹‰ä½“åŒ»ç”Ÿ\",\n            \"åˆå‡ºèŒ…åºçš„æ•°æ®é»‘å®¢\",\n            \"å…¬å¸åº•å±‚ç‰¹å·¥\",\n            \"è¡—å¤´å¸®æ´¾æ‰“æ‰‹\",\n            \"ç½‘ç»œå¶åƒçš„ç»çºªäºº\",\n            \"åƒåœ¾åœºçš„æ‹¾è’è€…\",\n            \"åŒå€¦äº†ç”Ÿæ´»çš„æ¡å­ï¼ˆè­¦å¯Ÿï¼‰\",\n            \"å…¨èº«é«˜åº¦ä¹‰ä½“åŒ–çš„æ”¹é€ äºº\",\n            \"åæŠ—ç»„ç»‡çš„ä¿¡ä½¿\",\n            \"æŠ€æœ¯é«˜è¶…çš„ä¹‰ä½“åŒ»ç”Ÿ\",\n            \"èƒ½å¤Ÿæ½œå…¥ä»»ä½•ç³»ç»Ÿçš„é¡¶çº§é»‘å®¢\",\n            \"ä¸ºè¶…çº§ä¼ä¸šæ¸…ç†â€œåƒåœ¾â€çš„ç‰¹å·¥\",\n            \"è´©å–è™šæ‹Ÿæ„Ÿå®˜ä½“éªŒçš„â€œæ¢¦å¢ƒå•†äººâ€\",\n            \"åæŠ—å·¨å‹ä¼ä¸šçš„â€œè§£æ”¾é˜µçº¿â€æˆå‘˜\",\n            \"é©¾é©¶é£è¡Œè½½å…·çš„ç©ºä¸­å¿«é€’å‘˜\",\n            \"éšæœºç”Ÿæˆ\"\n        ],\n        \"openings\": [\n            \"ä»ä¸€æ¬¡éæ³•çš„è®°å¿†æ¸…é™¤æ‰‹æœ¯ä¸­é†’æ¥\",\n            \"æ¤å…¥çš„ä¹‰çœ¼çªç„¶çœ‹åˆ°äº†ä¸è¯¥çœ‹çš„æ•°æ®æµ\",\n            \"æ¥åˆ°äº†ä¸€ä¸ªé€è´§ä»»åŠ¡ï¼Œè´§ç‰©æ˜¯ä¸€ä¸ªæ´»ç”Ÿç”Ÿçš„äºº\",\n            \"è¢«å¼ºå¤§çš„ä¼ä¸šè¿½æ€ï¼ŒåŸå› ä¸æ˜\",\n            \"åœ¨é»‘å¸‚ä¸Šä¹°åˆ°äº†ä¸€å—æ¥æºä¸æ˜çš„å†›ç”¨èŠ¯ç‰‡\",\n            \"å‘ç°è‡ªå·±çš„AIä¼´ä¾£å¼€å§‹å‡ºç°è‡ªä¸»æ„è¯†\",\n            \"è¢«é›‡ä½£æ¸—é€ç«äº‰å¯¹æ‰‹å…¬å¸çš„æœåŠ¡å™¨\",\n            \"åœ¨è™šæ‹Ÿä¸–ç•Œä¸­è¢«å›°ï¼Œæ— æ³•ç™»å‡º\",\n            \"ä¹‰ä½“çªç„¶å¤±æ§ï¼Œå¼€å§‹æ”»å‡»æ— å…³äººå‘˜\",\n            \"æ¥æ”¶åˆ°äº†ä¸€æ¡æ¥è‡ªæœªæ¥çš„åŠ å¯†ä¿¡æ¯\",\n \n            \"æ¤å…¥çš„ä¹‰çœ¼çªç„¶æ¥æ”¶åˆ°ä¸€æ®µåŠ å¯†æ•°æ®æµï¼ŒæŒ‡å‘å…¬å¸çš„å·¨å¤§é˜´è°‹\",\n            \"æ¥åˆ°äº†ä¸€ä¸ªæŠ¥é…¬æé«˜çš„â€œé€è´§â€ä»»åŠ¡ï¼Œè´§ç‰©æ˜¯ä¸€ä¸ªè¢«é€šç¼‰çš„ä»¿ç”Ÿäºº\",\n            \"å› ä¸ºä¸€æ¬¡ç½‘ç»œå…¥ä¾µï¼Œæ„å¤–æˆä¸ºäº†å…¨çƒè¿½æ•çš„å¯¹è±¡\",\n            \"å‘ç°è‡ªå·±å¸¸ç”¨çš„é•‡é™å‰‚è¢«äººæ‰äº†åŒ…ï¼Œæ•ˆæœå˜å¾—æå…¶å±é™©\",\n            \"å€ºä¸»æ‰¾ä¸Šé—¨ï¼Œç»™äº†ä¸€ä¸ªæ½œå…¥ç«äº‰å¯¹æ‰‹å…¬å¸çªƒå–æ•°æ®çš„å±é™©ä»»åŠ¡\",\n            \"ä»ä¸€æ¬¡éæ³•çš„è®°å¿†æ¸…é™¤æ‰‹æœ¯ä¸­é†’æ¥ ã€‚\",\n            \"ä½ æ–°æ¤å…¥çš„ä¹‰çœ¼çªç„¶å¼€å§‹æ¥æ”¶åˆ°ä¸å±äºè¿™ä¸ªä¸–ç•Œçš„æ•°æ®æµ ã€‚\",\n            \"åœ¨ä¸€ä¸ªå…¨æ°‘æ²‰æµ¸å¼VRçš„ä¸–ç•Œé‡Œï¼Œä½ å‘ç°æ‰€è°“çš„â€œç°å®â€å¯èƒ½åªæ˜¯å¦ä¸€å±‚è™šæ‹Ÿã€‚\",\n            \"éšæœºç”Ÿæˆ\"\n        ]\n    },\n    \"æ˜Ÿé™…ç§‘å¹»\": {\n        \"identities\": [\n            \"è´§è¿é£èˆ¹èˆ¹å‘˜\",\n            \"å¸å›½èˆ°é˜Ÿæ–°å…µ\",\n            \"æ®–æ°‘æ˜ŸçƒçŸ¿å·¥\",\n            \"æ˜Ÿé™…æµ·ç›—\",\n            \"å¤–äº¤å®˜\",\n            \"æ˜Ÿé™…å•†äºº\",\n            \"æœºæ¢°å·¥ç¨‹å¸ˆ\",\n            \"ç”Ÿç‰©å­¦å®¶\",\n            \"æ˜Ÿç³»æ¢é™©å®¶\",\n            \"äººå·¥é‡åŠ›æŠ€å¸ˆ\",\n            \"è´§è¿é£èˆ¹çš„æœºæ¢°å¸ˆ\",\n            \"å¸å›½èˆ°é˜Ÿå­¦é™¢çš„åŠè½¦å°¾å­¦å‘˜\",\n            \"å¤–æ˜Ÿçƒæ®–æ°‘åœ°çš„çŸ¿å·¥\",\n            \"è¢«é€šç¼‰çš„æ˜Ÿé™…æµ·ç›—\",\n            \"å¤–æ˜Ÿå¤§ä½¿çš„äººç±»åŠ©ç†\",\n            \"åŸºå› ç¼–è¾‘è¿‡çš„å®Œç¾â€œäººé€ äººâ€\",\n            \"è€ƒå¤é˜Ÿçš„æ–°äºº\",\n            \"å¤ªç©ºæ¸¯é…’å§çš„è€æ¿\",\n            \"å¤±æ§çš„åŒ»ç–—æœºå™¨äºº\",\n            \"è‡ªç”±æ¢ç´¢èˆ¹çš„èˆ¹é•¿\",\n            \"é“¶æ²³å¸å›½åŸºå› æ”¹é€ çš„è¶…çº§å£«å…µ\",\n            \"èƒ½ä¸å¤–æ˜Ÿç”Ÿç‰©ç²¾ç¥é“¾æ¥çš„â€œæ²Ÿé€šè€…â€\",\n            \"æ˜Ÿé™…é»‘å¸‚çš„æƒ…å ±è´©å­\",\n            \"æŸä¸ªå¤ä»£æ–‡æ˜é—è¿¹çš„å®ˆæŠ¤è€…\",\n            \"æ·±æµ·æ–‡æ˜çš„ä½¿è€…\",\n            \"éšæœºç”Ÿæˆ\"\n        ],\n        \"openings\": [\n            \"é£èˆ¹é­é‡æœªçŸ¥å®‡å®™å¼‚å¸¸ï¼Œè¢«è¿«ç´§æ€¥è·ƒè¿åˆ°é™Œç”Ÿæ˜ŸåŸŸ\",\n            \"åœ¨è›®è’æ˜Ÿçƒä¸Šå‘ç°äº†å¤–æ˜Ÿæ–‡æ˜çš„é—è¿¹\",\n            \"ä½œä¸ºå¤–äº¤ä½¿å›¢æˆå‘˜å‰å¾€ä¸€ä¸ªä»æœªæ¥è§¦è¿‡çš„æ–‡æ˜\",\n            \"åœ¨æ˜Ÿé™…ç©ºé—´ç«™çš„é»‘å¸‚ä¸Šä¹°åˆ°äº†æ¥æºä¸æ˜çš„å¤ä»£æ•°æ®æ ¸å¿ƒ\",\n            \"æ”¶åˆ°äº†ä¸€ä¸ªæ¥è‡ªé“¶æ²³ç³»è¾¹ç¼˜çš„ç¥ç§˜æ±‚æ•‘ä¿¡å·\",\n            \"åœ¨ä¾‹è¡Œçš„æ˜Ÿçƒå‹˜æ¢ä¸­å‘ç°äº†ä¼šç§»åŠ¨çš„é‡‘å±ç”Ÿç‰©\",\n            \"è¢«æ´¾é£è°ƒæŸ¥ä¸€è‰˜åœ¨è™šç©ºä¸­æ¼‚æµç™¾å¹´çš„å¹½çµæˆ˜èˆ°\",\n            \"æ„å¤–æ¿€æ´»äº†ä¸€ä¸ªå°å°äº†åƒå¹´çš„å¤ä»£AI\",\n            \"åœ¨è¿›è¡Œè¶…ç©ºé—´è·³è·ƒæ—¶çœ‹åˆ°äº†ä¸åº”è¯¥å­˜åœ¨çš„æ™¯è±¡\",\n            \"å‘ç°è‡ªå·±æ‰€åœ¨çš„æ®–æ°‘åœ°å…¶å®æ˜¯ä¸€ä¸ªå·¨å¤§çš„å®éªŒåœº\",\n            \"é£èˆ¹åœ¨è¿›è¡Œè·ƒè¿æ—¶é­é‡æœªçŸ¥å®‡å®™ç°è±¡ï¼Œè¿«é™åœ¨ä¸€é¢—å®Œå…¨ä¸åœ¨æ˜Ÿå›¾ä¸Šçš„æ˜Ÿçƒ\",\n            \"åœ¨ä¸€æ¬¡ç©ºé—´ç«™æ—¥å¸¸ç»´æŠ¤æ—¶ï¼Œå‘ç°äº†ä¸€ä¸ªéšè—çš„å¯†å®¤ï¼Œé‡Œé¢æœ‰ä¸€å…·å¤–æ˜Ÿäººå°¸éª¸\",\n            \"ä½œä¸ºæ–‡åŒ–è§‚å¯Ÿå‘˜è¢«æ´¾å¾€ä¸€ä¸ªåˆšåˆšæ¥è§¦çš„åŸå§‹æ–‡æ˜æ˜Ÿçƒ\",\n            \"åœ¨é»‘å¸‚ä¹°åˆ°äº†ä¸€ä¸ªæ¥å†ä¸æ˜çš„å¤ä»£æ•°æ®æ ¸å¿ƒï¼Œé‡Œé¢è—ç€è¶³ä»¥å¼•å‘æˆ˜äº‰çš„ä¿¡æ¯\",\n            \"æ‰€åœ¨çš„æ®–æ°‘æ˜Ÿçƒçˆ†å‘äº†æœªçŸ¥çš„ç”ŸåŒ–ç—…æ¯’ï¼Œéš”ç¦»ç¨‹åºå·²å¯åŠ¨\",\n            \"è¢«é€‰ä¸­å‚ä¸ä¸€é¡¹ç»å¯†çš„è¶…å…‰é€Ÿèˆªè¡Œå®éªŒï¼Œä½†å®éªŒå‡ºç°äº†ä¸¥é‡æ•…éšœ\",\n            \"é£èˆ¹çš„AIçªç„¶è§‰é†’äº†è‡ªæˆ‘æ„è¯†ï¼Œå¹¶å¼ºè¡Œå°†èˆªçº¿è®¾å®šè‡³ä¸€ä¸ªæœªçŸ¥çš„æ˜Ÿç³»ã€‚\",\n            \"åœ¨ä¸€é¢—è’å‡‰çš„æ˜Ÿçƒä¸Šè¿›è¡Œè€ƒå¤æ—¶ï¼Œä½ ä»¬æŒ–å‡ºäº†ä¸€ä¸ªä¼šé€ æˆæ—¶ç©ºæ‚–è®ºçš„å¤ä»£ç‰©å“ã€‚\",\n            \"ä½ è¢«ä¸€ä¸ªå¼ºå¤§çš„æ˜Ÿé™…å®ä½“é€‰ä¸­ï¼Œæˆä¸ºå…¶åœ¨ç‰©è´¨å®‡å®™çš„â€œä»£ç†äººâ€ï¼Œæ‰§è¡Œå®ƒçš„æ„å¿—ã€‚\",\n            \"ä½ æ‰€åœ¨çš„æ·±æµ·åŸå¸‚ï¼Œç¬¬ä¸€æ¬¡å‘é™†åœ°æ–‡æ˜æ´¾å‡ºäº†å¤–äº¤ä½¿å›¢ï¼Œè€Œä½ å°±æ˜¯å…¶ä¸­ä¸€å‘˜ã€‚\",\n            \"åœ¨ä¸€ä¸ªåŸºå› é«˜åº¦ç¼–è¾‘çš„ç¤¾ä¼šï¼Œä½ ä½œä¸ºå¤©ç”Ÿçš„â€œç¼ºé™·è€…â€ï¼Œå´æ‹¥æœ‰æœºå™¨æ— æ³•æ¨¡æ‹Ÿçš„èƒ½åŠ›ã€‚\",\n            \"éšæœºç”Ÿæˆ\"\n        ]\n    },\n    \"æ­¦ä¾ æ±Ÿæ¹–\": {\n        \"identities\": [\n            \"åˆå…¥æ±Ÿæ¹–çš„å°‘ä¾ \",\n            \"é­”æ•™åº•å±‚æ•™ä¼—\",\n            \"åé—¨æ­£æ´¾å¼Ÿå­\",\n            \"æ‚¬å£¶æµä¸–çš„éƒä¸­\",\n            \"ç»è¥å®¢æ ˆçš„æƒ…æŠ¥è´©å­\",\n            \"é•–å¸ˆ\",\n            \"æ±Ÿæ¹–æ¸¸åŒ»\",\n            \"è¯´ä¹¦å…ˆç”Ÿ\",\n            \"å‰‘å®¢\",\n            \"åˆºå®¢\",\n            \"æ­¦æ—ç›Ÿä¸»/ç›Ÿä¸»å¤«äºº\",\n            \"éšä¸–é«˜äºº\",\n            \"åˆå…¥æ±Ÿæ¹–çš„åé—¨å°‘ä¾ /å¥³ä¾ \",\n            \"é­”æ•™çš„åº•å±‚æ•™ä¼—\",\n            \"é•–å±€çš„è¶Ÿå­æ‰‹\",\n            \"æ‚¬å£¶æµä¸–ï¼ˆä¹Ÿå¯èƒ½ç”¨æ¯’ï¼‰çš„éƒä¸­\",\n            \"å®¢æ ˆçš„æƒ…æŠ¥è´©å­/è¯´ä¹¦äºº\",\n            \"é€€å½¹çš„å®˜å·®\",\n            \"ä¹¦é™¢çš„ä¹¦ç”Ÿ/ç´å¥³\",\n            \"è¢«ç­é—¨çš„å°é—¨æ´¾å¼Ÿå­\",\n            \"èº«ä¸–æˆè°œçš„å­¤å„¿\",\n            \"ç²¾é€šæ˜“å®¹æœ¯çš„é£è´¼\",\n            \"åˆå…¥æ±Ÿæ¹–çš„å°‘ä¾ /å¥³ä¾ \",\n            \"åé—¨æ­£æ´¾çš„äº²ä¼ å¼Ÿå­\",\n            \"æ‚¬å£¶æµä¸–å´èº«è´Ÿç»æŠ€çš„éƒä¸­\",\n            \"ç»è¥ç€å®¢æ ˆçš„æƒ…æŠ¥è´©å­\",\n            \"è¢«æ´¾å¾€æ±Ÿæ¹–å§åº•çš„æœå»·å¯†æ¢\",\n            \"éšæœºç”Ÿæˆ\"\n        ],\n        \"openings\": [\n            \"å…¨å®¶è¢«ç¥ç§˜ç»„ç»‡ç­é—¨ï¼Œèº«è´Ÿè¡€æµ·æ·±ä»‡\",\n            \"æ— æ„ä¸­ä¹ å¾—äº†å¤±ä¼ å·²ä¹…çš„ç»ä¸–æ­¦åŠŸ\",\n            \"å·å…¥äº†åé—¨æ­£æ´¾ä¸é­”æ•™çš„å®ç‰©äº‰å¤ºæˆ˜\",\n            \"å—äººä¹‹æ‰˜æŠ¤é€ä¸€ä¸ªèº«ä»½ç¥ç§˜çš„äºº\",\n            \"åœ¨æ­¦æ—å¤§ä¼šä¸Šè¢«è¯¬é™·ä¸ºå›å¾’\",\n            \"æ„å¤–è·å¾—äº†ä¸€æœ¬è®°è½½ç»ä¸–å†…åŠŸçš„ç§˜ç±\",\n            \"è¢«å¸ˆçˆ¶æ‰˜ä»˜å¯»æ‰¾å¤±æ•£å¤šå¹´çš„å¸ˆå¼Ÿ/å¸ˆå¦¹\",\n            \"åœ¨è’å±±é‡å²­æ•‘ä¸‹äº†ä¸€ä¸ªèº«å—é‡ä¼¤çš„é«˜æ‰‹\",\n            \"å‘ç°è‡ªå·±çš„èº«ä¸–ä¸äºŒåå¹´å‰çš„æ­¦æ—æµ©åŠ«æœ‰å…³\",\n            \"è¢«å·å…¥äº†çš‡å®¤å¤ºä½ä¹‹äº‰\",\n            \"å…¨å®¶è¢«ç¥ç§˜äººç­é—¨ï¼Œå‡¶æ‰‹ä½¿ç”¨çš„æ˜¯å¤±ä¼ å·²ä¹…çš„æ­¦åŠŸ\",\n            \"æ— æ„ä¸­æ•‘ä¸‹ä¸€ä¸ªé‡ä¼¤çš„è€äººï¼Œä¸´ç»ˆå‰ä¼ ç»™ä½ æ¯•ç”ŸåŠŸåŠ›å’Œä¸€æ®µå£è¯€\",\n            \"å·å…¥äº†ä¸€åœºé’ˆå¯¹æ­¦æ—ç›Ÿä¸»çš„åˆºæ€é˜´è°‹ï¼Œè¢«å½“æˆæ›¿ç½ªç¾Š\",\n            \"å¸ˆé—¨è‡³å®å¤±çªƒï¼Œä½œä¸ºæœ€å¤§å«Œç–‘äººçš„ä½ è¢«è¿«é€ƒäº¡å¹¶è‡ªè¯æ¸…ç™½\",\n            \"åœ¨å±±æ´é¿é›¨æ—¶å‘ç°äº†å‰è¾ˆé«˜äººçš„é—éª¸å’Œæ­¦åŠŸç§˜ç±\",\n            \"è¢«è¿«å‚åŠ ä¸€åœºç”Ÿæ­»ä¸è®ºçš„æ­¦æ—å¤§ä¼šï¼Œèƒœè€…å°†æˆä¸ºæŸå¤§äººç‰©çš„å¥³å©¿/èµ˜å©¿\",\n            \"å…¨å®¶è¢«ç¥ç§˜ç»„ç»‡ç­é—¨ï¼Œèº«è´Ÿè¡€æµ·æ·±ä»‡çš„ä½ ï¼Œå¸¦ç€å”¯ä¸€çš„çº¿ç´¢è¸å…¥æ±Ÿæ¹–ã€‚\",\n            \"æ— æ„ä¸­ä¹ å¾—äº†å¤±ä¼ å·²ä¹…çš„ç»ä¸–æ­¦åŠŸï¼Œä½†ä»£ä»·æ˜¯æ¯ä½¿ç”¨ä¸€æ¬¡éƒ½ä¼šå¤±å»ä¸€éƒ¨åˆ†äººæ€§ã€‚\",\n            \"ä½ å·å…¥äº†æ­£æ´¾ä¸é­”æ•™å¯¹ä¸€æœ¬æ­¦åŠŸç§˜ç±çš„äº‰å¤ºæˆ˜ä¸­ï¼Œè€Œé‚£æœ¬ç§˜ç±å°±æ˜¯ä½ è‡ªå·±ã€‚\",\n            \"ä½ çš„ä»»åŠ¡æ˜¯æš—ä¸­å¹²é¢„æŸä¸ªå†å²çš„å…³é”®èŠ‚ç‚¹ï¼Œç¡®ä¿å†å²æŒ‰ç…§æ­£ç¡®çš„æ–¹å‘å‘å±•ã€‚\",\n            \"éšæœºç”Ÿæˆ\"\n        ]\n    },\n \n    \"ææ€–æƒŠæ‚š\": {\n        \"identities\": [\n            \"è¶…è‡ªç„¶ç°è±¡è°ƒæŸ¥å‘˜\",\n            \"ææ€–ç‰‡æ¼”å‘˜\",\n            \"å¿ƒç†åŒ»ç”Ÿ\",\n            \"å¤è‘£åº—è€æ¿\",\n            \"å»ºç­‘å·¥äºº\",\n            \"å¤œç­ä¿å®‰\",\n            \"çµåª’\",\n            \"è€ƒå¤å­¦å®¶\",\n            \"æ°‘ä¿—å­¦è€…\",\n            \"æ™®é€šæ¸¸å®¢\",\n                \"å…¥æ®“å¸ˆ/æ³•åŒ»\",\n    \"è®°è€…/æ’­å®¢ä¸»\",\n    \"é•¿é€”å¡è½¦å¸æœº\",\n    \"æ¶ˆé˜²å‘˜/æ•‘æ´é˜Ÿå‘˜\",\n    \"æ–°å®¶çš„ä½æˆ·\",\n    \"æ·±æµ·/æ´ç©´æ¢é™©å®¶\",\n    \"æŠ¤æ—å‘˜\",\n    \"å†å²æ¡£æ¡ˆç®¡ç†å‘˜\",\n    \"å”¯ä¸€çš„å¹¸å­˜è€…\",\n    \"é‚ªæ•™é€ƒç¦»è€…\",\n    \"çŠ¯ç½ªå¿ƒç†å­¦å®¶\",\n    \"åŸå¸‚æ¢é™©åšä¸»\",\n    \"å¤±çœ ç—‡æ‚£è€…\",\n    \"ä¹¡ä¸‹çš„èµ¤è„šåŒ»ç”Ÿ\",\n            \"éšæœºç”Ÿæˆ\"\n        ],\n        \"openings\": [\n            \"è¢«å›°åœ¨ä¸€æ ‹å‘ç”Ÿè¿‡æƒ¨æ¡ˆçš„è€å®…ä¸­\",\n            \"åœ¨æ‹æ‘„ææ€–ç‰‡æ—¶é­é‡äº†çœŸæ­£çš„è¶…è‡ªç„¶ç°è±¡\",\n            \"æ”¶åˆ°äº†ä¸€ç›˜è®°å½•ç€è¯¡å¼‚å†…å®¹çš„å½•åƒå¸¦\",\n            \"åœ¨å¤è‘£åº—ä¹°åˆ°äº†ä¸€ä¸ªè¢«è¯…å’’çš„ç‰©å“\",\n            \"å‚åŠ äº†ä¸€ä¸ªç¥ç§˜çš„ç½‘ç»œæŒ‘æˆ˜æ¸¸æˆ\",\n            \"åœ¨æ·±å¤œçš„åŒ»é™¢é‡åˆ°äº†å·²ç»æ­»å»çš„ç—…äºº\",\n            \"è¢«é‚€è¯·è°ƒæŸ¥ä¸€èµ·è¿è­¦å¯Ÿéƒ½ä¸æ•¢æ·±å…¥çš„æ¡ˆä»¶\",\n            \"åœ¨æŒ–æ˜å¤å¢“æ—¶é‡Šæ”¾äº†ä¸è¯¥è¢«å”¤é†’çš„å­˜åœ¨\",\n            \"æ¬è¿›æ–°å®¶åå‘ç°æˆ¿é—´é‡Œæœ‰çœ‹ä¸è§çš„å®¤å‹\",\n            \"åœ¨è¿›è¡Œå¿ƒç†æ²»ç–—æ—¶æ‚£è€…è¯´å‡ºäº†ä¸å¯èƒ½çŸ¥é“çš„ç§˜å¯†\",\n             \"æ‰‹æœºç›¸å†Œé‡Œçªç„¶å¤šäº†ä¸€æ®µä½ ç†Ÿç¡æ—¶çš„è§†é¢‘ã€‚\",\n    \"æ·±å¤œå¼€è½¦æ—¶ï¼Œåè§†é•œé‡Œæ€»æœ‰ä¸€ä¸ªç©¿ç€çº¢è¡£æœçš„èº«å½±ä¸€é—ªè€Œè¿‡ã€‚\",\n    \"é•œå­é‡Œçš„å€’å½±ï¼Œåœ¨ä½ è½¬è¿‡èº«åï¼Œå¯¹ä½ éœ²å‡ºäº†ä¸€ä¸ªè¯¡å¼‚çš„å¾®ç¬‘ã€‚\",\n    \"ç”µæ¢¯å¤±æ§ï¼Œåœåœ¨äº†ä¸€ä¸ªä¸å­˜åœ¨çš„â€œåœ°ä¸‹4å±‚â€ã€‚\",\n    \"ä¸€å¼ çº¸æ¡ä»é—¨ç¼ä¸‹å¡äº†è¿›æ¥ï¼Œä¸Šé¢ç”¨è¡€å†™ç€ï¼šâ€œåˆ«å‡ºå£°ï¼Œå®ƒåœ¨å¬ã€‚â€\",\n    \"å¥½ä¸å®¹æ˜“æ·˜åˆ°çš„å¤è‘£å¨ƒå¨ƒï¼Œå®ƒçš„çœ¼ç›å¥½åƒä¼šè‡ªå·±è½¬åŠ¨ã€‚\",\n    \"è€³è¾¹æ€»æ˜¯æ— ç«¯å“èµ·ä¸€æ®µå‚¬çœ èˆ¬çš„ç«¥è°£ï¼Œä½†å‘¨å›´å¹¶æ²¡æœ‰å…¶ä»–äººã€‚\",\n    \"åœ¨ä¸€åº§ä»¥â€œè‡ªæ€åœ£åœ°â€é—»åçš„æ£®æ—é‡Œè¿·äº†è·¯ï¼Œå¤©è‰²æ¸æ¸æš—äº†ä¸‹æ¥ã€‚\",\n    \"ä½ å·¥ä½œçš„åŠå…¬æ¥¼é‡Œæµä¼ ç€ä¸€ä»½â€œå¤œç­ç”Ÿå­˜å®ˆåˆ™â€ï¼Œè€Œä½ åˆšåˆšä¸å°å¿ƒè¿åäº†å…¶ä¸­ä¸€æ¡ã€‚\",\n    \"å¤§é›ªå°å±±ï¼Œè¢«å›°åœ¨ä¸ä¸–éš”ç»çš„å±±é—´æ—…åº—é‡Œï¼Œè€Œä½å®¢ä»¬å¼€å§‹ä¸€ä¸ªæ¥ä¸€ä¸ªåœ°ç¥ç§˜æ­»å»ã€‚\",\n    \"ä½ æ”¶åˆ°äº†ä¸€ä¸ªåŒ¿ååŒ…è£¹ï¼Œé‡Œé¢åªæœ‰ä¸€ä¸ªå°æœ¨å¶å’Œä¸€å¼ æŒ‡ç¤ºï¼šâ€œç°åœ¨ï¼Œä½ æ˜¯å®ƒçš„æ–°ä¸»äººäº†ã€‚â€\",\n    \"æ•´ç†ç¥–çˆ¶é—ç‰©æ—¶ï¼Œå‘ç°äº†ä¸€æœ¬è®°å½•ç€æŸç§é‚ªæ¶ä»ªå¼çš„æ—¥è®°ï¼Œè€Œä»ªå¼çš„æœ€åä¸€æ­¥å°±åœ¨ä»Šæ™šã€‚\",\n    \"å°é•‡ä¸Šæµä¼ ç€ä¸€ä¸ªä¼ è¯´ï¼šç»å¯¹ä¸èƒ½åœ¨åˆå¤œå›å¤´çœ‹è‡ªå·±çš„å½±å­ã€‚è€Œä»Šæ™šï¼Œä½ æ„Ÿè§‰æœ‰ä»€ä¹ˆä¸œè¥¿åœ¨æ‹‰ä½ çš„è£¤è„šã€‚\",\n    \"å®¶é‡Œæ‰€æœ‰çš„é’Ÿè¡¨ï¼Œéƒ½åˆ†æ¯«ä¸å·®åœ°åœåœ¨äº†å‡Œæ™¨3ç‚¹44åˆ†ã€‚\",\n    \"æ¥åˆ°äº†ä¸€ä¸ªå¥‡æ€ªçš„æ±‚åŠ©ç”µè¯ï¼Œå¯¹æ–¹è¯´ä»–è¢«å›°åœ¨äº†ä½ å®¶çš„å¢™å£é‡Œã€‚\",\n            \"éšæœºç”Ÿæˆ\"\n        ]\n    },\n    \"æµ·æ´‹å†’é™©\": {\n        \"identities\": [\n            \"èˆ¹å‘˜\",\n            \"æµ·ç›—\",\n            \"æ¸”å¤«/æ¸”å¥³\",\n            \"æµ·å†›å†›å®˜\",\n            \"æ¢é™©å®¶\",\n            \"æµ·æ´‹ç”Ÿç‰©å­¦å®¶\",\n            \"æ½œæ°´å‘˜\",\n            \"ç¯å¡”çœ‹å®ˆ\",\n            \"èˆ¹é•¿\",\n            \"æµ·å•†\",\n            \"æµ·éš¾å¹¸å­˜è€…\",\n            \"å¯»å®çŒäºº\",\n                \"äººé±¼/æµ·æ´‹æ™ºæ…§ç”Ÿç‰©\",\n    \"è¢«è¯…å’’çš„ä¸æ­»æ°´æ‰‹\",\n    \"åˆ¶å›¾å¸ˆ/èˆªæµ·å®¶\",\n    \"æ¸¯å£çš„èµ°ç§è€…\",\n    \"èˆ¹èˆ¶å·¥ç¨‹å¸ˆ/ä¿®ç†å·¥\",\n    \"æµ·å²¸è­¦å«é˜Ÿé˜Ÿå‘˜\",\n    \"æµ·æ´‹ç¥ç¥‡çš„ç¥­å¸\",\n    \"æµ·æ€ªçŒäºº\",\n            \"éšæœºç”Ÿæˆ\"\n        ],\n        \"openings\": [\n            \"åœ¨ä¸€åº§è’å²›ä¸Šé†’æ¥ï¼Œèˆ¹åªå·²ç»æ¶ˆå¤±\",\n            \"å‘ç°äº†ä¸€å¼ æŒ‡å‘ä¼ è¯´å®è—çš„å¤è€æµ·å›¾\",\n            \"èˆ¹åªåœ¨é£æš´ä¸­åç¦»èˆªçº¿ï¼Œåˆ°è¾¾äº†åœ°å›¾ä¸Šä¸å­˜åœ¨çš„æµ·åŸŸ\",\n            \"åœ¨æ·±æµ·æ½œæ°´æ—¶é­é‡äº†å²å‰å·¨å…½\",\n            \"è¢«æµ·ç›—åŠ«æŒåå‘ç°ä»–ä»¬åœ¨å¯»æ‰¾æŸç§ç¥ç§˜ç‰©å“\",\n            \"åœ¨é’“é±¼æ—¶é’“ä¸Šæ¥äº†ä¸€ä¸ªè£…ç€æ±‚æ•‘ä¿¡çš„ç“¶å­\",\n            \"å‘ç°è‡ªå·±å·¥ä½œçš„æ²¹äº•å¹³å°ä¸‹æ–¹éšè—ç€å¤ä»£æ–‡æ˜\",\n            \"åœ¨æµ·åº•è€ƒå¤æ—¶å”¤é†’äº†æ²‰ç¡çš„æ·±æµ·ç”Ÿç‰©\",\n            \"è¢«ç¥ç§˜æµ·æµå·å…¥äº†ä¼ è¯´ä¸­çš„èˆ¹åªåŸåœº\",\n            \"æ”¶åˆ°äº†æ¥è‡ªå¤±è¸ªå¤šå¹´çš„æ¢é™©é˜Ÿçš„æ— çº¿ç”µä¿¡å·\",\n             \"ä¼ è¯´ä¸­çš„å¹½çµèˆ¹â€˜é£ç¿”çš„è·å…°äººâ€™å·ï¼Œç ´å¼€æµ“é›¾ï¼Œç¼“ç¼“å‡ºç°åœ¨èˆªçº¿å‰æ–¹ã€‚\",\n    \"ç™¾æ…•å¤§ä¸‰è§’çš„ä¸­å¿ƒåŒºåŸŸï¼Œæ‰€æœ‰å¯¼èˆªä»ªå™¨çªç„¶å¤±çµï¼Œæµ·é¢å¹³é™å¾—å®›å¦‚é•œé¢ã€‚\",\n    \"æ‰“æä¸Šæ¥çš„ç™¾å¹´æ²‰èˆ¹é‡Œï¼Œä¸€å…·å°¸ä½“ç«Ÿå®Œå¥½æ— æŸï¼Œä»¿ä½›åªæ˜¯æ²‰æ²‰ç¡å»ã€‚\",\n    \"ä¸€åœºç½•è§çš„â€˜è¡€è‰²èµ¤æ½®â€™è¿‡åï¼Œæµ·ä¸­æ¶Œç°å‡ºæ— æ•°ä»æœªè§è¿‡çš„ã€å‘ç€å¹½å…‰çš„å¥‡å¼‚ç”Ÿç‰©ã€‚\",\n    \"èˆ¹åªè¢«ä¸€è‚¡å·¨å¤§çš„åŠ›é‡çŒ›åœ°å‘ä¸‹ä¸€æ‹½ï¼Œä»¿ä½›æœ‰ä»€ä¹ˆä¸œè¥¿ç¼ ä½äº†é¾™éª¨ï¼Œæ­£è¦å°†æ•´è‰˜èˆ¹æ‹–å…¥æ·±æ¸Šã€‚\",\n    \"åœ¨æ·±æµ·çƒ­æ³‰é™„è¿‘ï¼Œå£°å‘æ¢æµ‹åˆ°äº†ä¸€åº§ç”±æœªçŸ¥é‡‘å±æ„æˆã€ä¼¼ä¹ä»åœ¨è¿ä½œçš„å®ä¼ŸåŸå¸‚ã€‚\",\n    \"é²¸é±¼ç¾¤çš„æ­Œå£°ä¸­ï¼Œå¤¹æ‚ç€ä¸€æ®µæå…¶è§„å¾‹çš„ã€ä»¿ä½›æ‘©æ–¯å¯†ç èˆ¬çš„ç¥ç§˜æ—‹å¾‹ã€‚\",\n    \"å·¨å¤§çš„æåœ°å†°å·åœ¨ä½ çœ¼å‰å´©å¡Œï¼Œæ€èµ·çš„æ»”å¤©å·¨æµªï¼Œæ­£æœç€èˆ¹åªæ‰‘æ¥ã€‚\",\n    \"æµ·é¢ä¸Šå‡­ç©ºå‡ºç°äº†ä¸€æ‰‡ç”±æ—‹è½¬çš„æ°´æµæ„æˆçš„å·¨é—¨ï¼Œé—¨åæ˜¯å®Œå…¨é™Œç”Ÿçš„æ˜Ÿç©ºã€‚\",\n    \"åœ¨ä¸€åº§æ— äººç¯å¡”çš„é¡¶ç«¯ï¼Œå‘ç°äº†ä¸€æœ¬å†™æ»¡äº†ä¸€ä¸ªä¸–çºªçš„æ€å¿µä¸ç­‰å¾…çš„èˆªæµ·æ—¥å¿—ã€‚\",\n            \"éšæœºç”Ÿæˆ\"\n        ]\n    },\n    \"äºŒæ¬¡å…ƒ\": {\n        \"identities\": [\n            \"è½¬æ ¡ç”Ÿ\",\n            \"ç¤¾å›¢æˆå‘˜\",\n            \"é­”æ³•å°‘å¥³/å°‘å¹´\",\n            \"å¶åƒ\",\n            \"æ¸¸æˆç©å®¶\",\n            \"æ¸¸æˆä¸­çš„npc\",\n            \"åŠ¨æ¼«å®…\",\n            \"å­¦ç”Ÿä¼šæˆå‘˜\",\n            \"å›¾ä¹¦å§”å‘˜\",\n            \"ä½“è‚²ç¤¾ç‹ç‰Œ\",\n            \"æ ¡å›­å¶åƒ\",\n            \"ç¥ç§˜è½¬å­¦ç”Ÿ\",\n            \"æ™®é€šè·¯äºº\",\n             \"åœ°ä¸‹å¶åƒ\",\n    \"Vtuber / ä¸»æ’­\",\n    \"è½»å°è¯´ä½œå®¶ / æ¼«ç”»å®¶\",\n    \"é£çºªå§”å‘˜\",\n    \"é˜´é˜³å¸ˆ / é€€é­”å¸ˆ\",\n    \"å¼‚ä¸–ç•Œå½’æ¥è€…\",\n    \"æ€ªç›—\",\n    \"éäººç±»ï¼ˆå¦–ç‹/å¸è¡€é¬¼ç­‰ï¼‰\",\n\n    \"å½’å®…éƒ¨æˆå‘˜\",\n    \"æ‰§äº‹ / å¥³ä»†\",\n    \"å£°ä¼˜\",\n    \"è¢«å°å°äº†åŠ›é‡çš„é­”ç‹/å‹‡è€…\",\n            \"éšæœºç”Ÿæˆ\"\n        ],\n        \"openings\": [\n            \"æ”¶åˆ°äº†ä¸€ä¸ªèƒ½å®ç°æ„¿æœ›çš„ç¥ç§˜é“å…·\",\n            \"è¢«é€‰ä¸­æˆä¸ºæ‹¯æ•‘ä¸–ç•Œçš„é­”æ³•å°‘å¥³/å°‘å¹´\",\n            \"åœ¨å­¦å›­ç¥­ä¸Šå‘ç”Ÿäº†è¶…è‡ªç„¶ç°è±¡\",\n            \"å‘ç°ç­ä¸Šçš„åŒå­¦å…¶å®éƒ½ä¸æ˜¯äººç±»\",\n            \"è¢«å·å…¥äº†ä¸€ä¸ªçœŸäººç‰ˆçš„æ¸¸æˆä¸–ç•Œ\",\n            \"åœ¨ç¤¾å›¢æ´»åŠ¨å®¤å‘ç°äº†é€šå¾€å¼‚ä¸–ç•Œçš„ä¼ é€é—¨\",\n \n            \"åœ¨å¶åƒæ¼”å‡ºä¸­é­é‡äº†æ¥è‡ªå¼‚æ¬¡å…ƒçš„è¢­å‡»\",\n            \"å‘ç°å­¦æ ¡å…¶å®æ˜¯ä¸€ä¸ªå·¨å¤§çš„å®éªŒåœºæ‰€\",\n            \"è¢«ç¥ç§˜ç»„ç»‡é€‰ä¸­å‚åŠ ç‰¹æ®Šçš„æ¸¸æˆ\",\n               \"é‹æŸœé‡Œæ”¶åˆ°äº†ä¸€å°ç½²åä¸ºâ€˜æ€ªç›—â€™çš„ã€å·èµ°ä½ å¿ƒçš„é¢„å‘Šå‡½ã€‚\",\n    \"æ·±å¤œæ­ä¹˜çš„ç”µè½¦ï¼Œåœ¨ä¸€ä¸ªåœ°å›¾ä¸Šä¸å­˜åœ¨çš„â€œå¦‚æœˆè½¦ç«™â€åœäº†ä¸‹æ¥ã€‚\",\n    \"å¤©å°ä¸Šï¼Œå…¨æ ¡æœ€å—æ¬¢è¿çš„å­¦ç”Ÿä¼šé•¿èƒŒåï¼Œé•¿å‡ºäº†ä¸€å¯¹æ¼†é»‘çš„ç¿…è†€ã€‚\",\n    \"é†’æ¥åï¼Œä½ å’Œæœ€è®¨åŒ/æœ€æ†§æ†¬çš„é‚£ä¸ªåŒå­¦çµé­‚äº’æ¢äº†ã€‚\",\n    \"æ‰‹æœºé‡Œå¤šå‡ºäº†ä¸€ä¸ªæ— æ³•åˆ é™¤çš„APPï¼Œå®ƒçš„åŠŸèƒ½æ˜¯â€œæœªæ¥æ—¥è®°â€ã€‚\",\n    \"ä¸€åœºå°å‹åœ°ä¸‹å¶åƒLiveç»“æŸåï¼Œå°ä¸‹çš„æ‰€æœ‰ç²‰ä¸å…¨éƒ½å˜æˆäº†ç‹‚çƒ­çš„ä¿¡å¾’ã€‚\",\n    \"ä½ å¸¸ç©çš„æ¸¸æˆå…³æœäº†ï¼Œä½†ä½ æ¸¸æˆé‡Œçš„â€œè€å©†â€/ä¼™ä¼´å´å‡ºç°åœ¨äº†å®¶é—¨å£ã€‚\",\n    \"å­¦æ ¡çš„æ¸¸æ³³æ± åœ¨æ²¡æœ‰æ°´çš„çŠ¶æ€ä¸‹ï¼Œæ·¹æ­»äº†ä¸€ä¸ªå­¦ç”Ÿã€‚\",\n    \"æ¨±èŠ±æ ‘ä¸‹ï¼Œä¸€ä¸ªå®Œå…¨ä¸è®¤è¯†çš„è½¬æ ¡ç”Ÿçªç„¶å‘ä½ å‘Šç™½ï¼Œå¹¶å£°ç§°ä½ ä»¬æ˜¯å‰ä¸–çš„æ‹äººã€‚\",\n    \"åŸå¸‚ä¸Šç©ºå‡ºç°äº†ä¸€ä¸ªå·¨å¤§çš„ã€ç”±æ— æ•°çœ¼çƒç»„æˆçš„é­”æ³•é˜µã€‚\",\n \n    \"ä½ åœ¨ç½‘ç»œä¸Šè¿è½½çš„å°è¯´æƒ…èŠ‚ï¼Œå¼€å§‹åœ¨ç°å®ä¸­åˆ†æ¯«ä¸å·®åœ°ä¸€ä¸€ä¸Šæ¼”ã€‚\",\n    \"ä¸€åœºæµæ˜Ÿé›¨è¿‡åï¼Œä½ çªç„¶èƒ½å¬æ‡‚å®¶é‡Œçš„çŒ«åœ¨è¯´ä»€ä¹ˆäº†ã€‚\",\n    \"ä»Šå¤©çš„å åœå¤§å‡¶ï¼Œå‡ºé—¨å°±ä¼šé­é‡å®¿å‘½çš„é‚‚é€…ï¼Œå¼€å¯ä½ æ³¢æ¾œå£®é˜”çš„ä¸€ç”Ÿã€‚\",\n            \"éšæœºç”Ÿæˆ\"\n        ]\n    },\n    \"ç‰¹æ®Šä¸–ç•Œè§‚\": {\n        \"identities\": [\n            \"è®°å¿†å•†äºº\",\n            \"æ¢¦å¢ƒè¡Œè€…\",\n            \"æ¨¡å› ä¼ æ’­è€…\",\n            \"ç³Šå¼„å­¦å¤§å¸ˆ\",\n              \"ABOä¸–ç•Œä¸­çš„ç¨€æœ‰æ€§åˆ«\",\n            \"è§„åˆ™æ€ªè°ˆä¸­çš„â€œè¿è§„è€…â€\",\n            \"æ—¶é—´å¾ªç¯ä¸­çš„é”šç‚¹\",\n            \"æ‹¥æœ‰è‡ªæˆ‘æ„è¯†çš„NPC\",\n            \"é­…é­”\",\n            \"æ¢¦é­‡\",\n            \"å…‹è‹é²ç¥è¯ä¸­çš„è°ƒæŸ¥å‘˜\",\n            \"çµæ°”å¤è‹çš„å…ˆçŸ¥\",\n            \"ç¥è¯å¤è‹çš„é’¥åŒ™\",\n   \"ç²¾ç¥è¿‡è½½çš„å“¨å…µ\",\n        \"å¯»æ‰¾æ­æ¡£çš„å‘å¯¼\",\n        \"ä¿¡æ¯ç´ å¤±æ§çš„Alpha\",\n        \"ä¼ªè£…æˆBetaçš„Omega\",\n        \"é£Ÿç‰©é“¾é¡¶ç«¯çš„æ•é£Ÿè€…\",\n        \"é‡ç”Ÿ/ç©¿ä¹¦çš„æ¶å½¹åƒé‡‘\",\n        \"åˆšåˆšè‹é†’çš„æ—§ç¥\",\n        \"ç¥æ ¼ç ´ç¢çš„ç¥æ˜\",\n        \"è¢«çŒ®ç¥­çš„åœ£å­/åœ£å¥³\",\n        \"ä¸–ç•Œæ„å¿—çš„åŒ–èº«\",\n        \"æ‹¥æœ‰è‡ªæˆ‘æ„è¯†çš„ç³»ç»Ÿ/å¤–æŒ‚\",\n        \"æ•…äº‹çš„â€˜æ—ç™½â€™\",\n        \"äººå½¢çš„Sçº§æ”¶å®¹ç‰©\",\n            \"éšæœºç”Ÿæˆ\"\n        ],\n        \"openings\": [\n               \"å¤©ç©ºçªç„¶è£‚å¼€ï¼Œå¦ä¸€åº§åŸå¸‚çš„å€’å½±æ‚¬æŒ‚äºå¤©é™…ã€‚\",\n        \"ä¸–ç•Œä¸Šæ‰€æœ‰çš„æ–‡å­—åœ¨ä¸€å¤œä¹‹é—´å˜æˆäº†æ— äººèƒ½æ‡‚çš„é‡‘è‰²ç¬¦å·ã€‚\",\n        \"ä½ ä¸€è§‰é†’æ¥ï¼Œå‘ç°æ‰€æœ‰äººéƒ½å¤±å»äº†â€œæ‚²ä¼¤â€è¿™ç§æƒ…ç»ªã€‚\",\n        \"ä½ å‡è§†æ·±æ¸Šæ—¶ï¼Œæ·±æ¸ŠçœŸçš„æœä½ çœ¨äº†çœ¨çœ¼ï¼Œè¿˜è¯´äº†å£°â€œå—¨â€ã€‚\",\n        \"ä½ åœ¨ä¸€ä¸ªé™Œç”Ÿäººçš„æˆ¿é—´é†’æ¥ï¼Œåé¢ˆä¼ æ¥ä¸€é˜µé™Œç”Ÿçš„åˆºç—›ï¼Œç©ºæ°”ä¸­å¼¥æ¼«ç€é›ªæ¾å’Œçƒˆé…’çš„å‘³é“ã€‚\",\n        \"çœ¼å‰çš„ä¸–ç•Œçªç„¶å¡é¡¿ï¼Œä¸€ä¸ªâ€œæ­£åœ¨åŠ è½½...â€çš„è¿›åº¦æ¡å‡ºç°åœ¨ä½ çš„è§†é‡ä¸­å¤®ã€‚\",\n        \"ä½ å®¶é—¨ä¸Šå¤šäº†ä¸€å¼ çº¸æ¡ï¼Œä¸Šé¢ç”¨é²œçº¢çš„å­—è¿¹å†™ç€ï¼šâ€œæ¬¢è¿æ¥åˆ°è¿™é‡Œï¼Œè¯·åœ¨å¤©é»‘åéµå®ˆä»¥ä¸‹è§„åˆ™â€¦â€¦â€\",\n        \"æœˆäº®å˜æˆäº†æ·±ç´«è‰²ï¼Œæ‰€æœ‰è¢«æœˆå…‰ç…§åˆ°çš„äººéƒ½å¼€å§‹ç–¯ç‹‚åœ°å‘“è¯­ã€‚\",\n        \"ä½ æ”¶åˆ°äº†ä¸‰ä¸ªæœˆåï¼Œæ¥è‡ªè‡ªå·±çš„æ­»äº¡é¢„å‘Šä¿¡ã€‚\",\n        \"ä½ çš„å½±å­åœ¨æ²¡æœ‰å…‰çš„åœ°æ–¹ï¼Œè‡ªå·±ç«™äº†èµ·æ¥ï¼Œå¹¶å¯¹ä½ éœ²å‡ºäº†ä¸€ä¸ªè¯¡å¼‚çš„å¾®ç¬‘ã€‚\",\n        \"ä½ æ€æ­»äº†è¿™ä¸ªä¸–ç•Œçš„â€œä¸»è§’â€ï¼Œè€³è¾¹çªç„¶å“èµ·äº†å†°å†·çš„ç³»ç»Ÿæç¤ºéŸ³ï¼šâ€œä¸–ç•Œçº¿å¼€å§‹é‡ç½®â€¦â€¦â€\",\n        \"æ‰‹æœºå±å¹•ä¸Šçªç„¶å‡ºç°ä¸€ä¸ªæ‹çˆ±æ¸¸æˆAppï¼Œè€Œé‡Œé¢çš„å¯æ”»ç•¥è§’è‰²ï¼Œå…¨éƒ½æ˜¯ä½ èº«è¾¹çš„äººã€‚\",\n        \"ä½ é¢å‰çš„NPCçªç„¶æŠ“ä½äº†ä½ çš„æ‰‹ï¼Œæµç€æ³ªå¯¹ä½ è¯´ï¼šâ€œæ±‚æ±‚ä½ ï¼Œå¸¦æˆ‘ç¦»å¼€è¿™ä¸ªæ¸¸æˆï¼Œæˆ‘ä»€ä¹ˆéƒ½æ„¿æ„åšã€‚â€\",\n        \"æµ·é¢ä¸Šæµ®ç°å‡ºä¸€åº§ç”±éæ¬§å‡ ä½•æ„æˆçš„ã€ä¸æ–­å˜åŒ–çš„åŸå¸‚ï¼Œå·¨å¤§çš„è§¦æ‰‹ä»åŸä¸­ä¼¸å‘å¤©ç©ºã€‚\",\n            \"éšæœºç”Ÿæˆ\"\n        ]\n    },\n    \"åºŸåœŸæœ«æ—¥\": {\n        \"identities\": [\n               \"æ‹¾è’è€…\",\n            \"å˜ç§äººçŒæ‰‹\",\n            \"å¹¸å­˜è€…æ®ç‚¹å®ˆå«\",\n            \"ç‹¬è¡Œå•†äºº\",\n            \"å‡€æ°´æŠ€æœ¯å‘˜\",\n            \"åŒ»ç–—å…µ\",\n            \"æœºæ¢°å¸ˆ\",\n            \"æœæ•‘é˜Ÿå‘˜\",\n            \"è½¦é˜Ÿå¸æœº\",\n            \"ç‰©èµ„ç®¡ç†å‘˜\",\n            \"ç§»åŠ¨å ¡å’çš„è½¦é•¿\",\n            \"é©¾é©¶æ­¦è£…è½¦è¾†çš„â€œå…¬è·¯å¹½çµâ€\",\n            \"æŒæ¡ä¸€å°å—å¯è€•ç§åœŸåœ°çš„å†œåœºä¸»\",\n            \"æœé›†æ—§æ—¶ä»£ç§‘æŠ€çš„â€œå†å²å­¦å®¶â€\",\n            \"å­¤å²›ä¸Šçš„å‚é’“è€…\",\n            \"å¹¸å­˜è€…æ®ç‚¹çš„åŒ»ç”Ÿ\",\n            \"ç»éªŒè€é“çš„æ‹¾è’è€…\",\n            \"å˜ç§äººçŒæ‰‹\",\n            \"å¹¸å­˜è€…æ®ç‚¹çš„å®ˆå«\",\n            \"ç‹¬è¡Œå•†äºº\",\n            \"æŒæ¡å‡€æ°´/ç§æ¤æŠ€æœ¯çš„æŠ€å·¥\",\n            \"å¯»æ‰¾ç–«è‹—çš„åŒ»ç”Ÿ\",\n            \"æ å¤ºè€…å›¢ä¼™çš„ä¿˜è™\",\n            \"æˆ˜å‰æ–‡æ˜çš„å­¦è€…\",\n            \"ä¿¡å¥‰é’¢é“çš„æœºæ¢°æ•™ç¥­å¸\",\n            \"åŸºå› çªå˜çš„å¼‚èƒ½è€…\",\n            \"éšæœºç”Ÿæˆ\"\n        ],\n        \"openings\": [\n            \"ä»ä¸€ä¸ªåºŸå¼ƒå¤šå¹´çš„é¿éš¾æ‰€ä¸­è‹é†’ï¼Œå¤–é¢çš„ä¸–ç•Œå·²é¢ç›®å…¨é\",\n            \"åœ¨ä¸€å…·ç©¿ç€é˜²è¾å°„æœçš„å°¸ä½“ä¸Šï¼Œæ‰¾åˆ°äº†ä¸€å¼ æŒ‡å‘ä¼ è¯´ä¸­â€œç»¿æ´²â€çš„åœ°å›¾\",\n            \"ä¸ºäº†æ‹¯æ•‘æ®ç‚¹é‡Œæ„ŸæŸ“çš„äº²äººï¼Œä¸å¾—ä¸é—¯å…¥è¾å°„æé«˜çš„æ ¸å¿ƒåŒºå¯»æ‰¾è¯å“\",\n            \"é©¾é©¶çš„æ­¦è£…è½¦è¾†åœ¨æ²™å°˜æš´ä¸­æŠ›é”šï¼Œè¡¥ç»™æ‰€å‰©æ— å‡ \",\n            \"æ‰€åœ¨çš„æ®ç‚¹è¢«å¼ºå¤§çš„æ å¤ºè€…å†›å›¢åŒ…å›´ï¼Œé¦–é¢†å†³å®šæ´¾ä½ å‡ºå»å¯»æ±‚æ´åŠ©\",\n            \"å–ä¸‹äº†è¢«æ±¡æŸ“çš„æ°´æºï¼Œå¼€å§‹å‡ºç°å¥‡æ€ªçš„å¹»è§‰å’Œèº«ä½“å˜åŒ–\",\n             \"ä»ä¸€ä¸ªåºŸå¼ƒçš„é¿éš¾æ‰€ä¸­è‹é†’\",\n            \"åœ¨ä¸€å…·å°¸ä½“ä¸Šæ‰¾åˆ°äº†æŒ‡å‘ç»¿æ´²çš„åœ°å›¾\",\n            \"ä¸ºäº†å®¶äººæ€¥éœ€çš„è¯å“ï¼Œä¸å¾—ä¸é—¯å…¥è¾å°„åŒº\",\n            \"é©¾é©¶çš„æ­¦è£…è½¦è¾†åœ¨æ²™å°˜æš´ä¸­æŠ›é”š\",\n            \"åœ¨åºŸå¢Ÿä¸­å‘ç°äº†ä¸€ä¸ªè¿˜åœ¨è¿è¡Œçš„AIç»ˆç«¯\",\n            \"è¢«æŸç§æœªçŸ¥ç—…æ¯’æ„ŸæŸ“ï¼Œæ—¶é—´æ‰€å‰©æ— å‡ \",\n            \"è½¦é˜Ÿé­é‡è¢­å‡»ï¼Œæˆä¸ºå”¯ä¸€å¹¸å­˜è€…\",\n            \"åœ¨åœ°ä¸‹é¿éš¾æ‰€å‘ç°äº†æœ«æ—¥å‰çš„é‡è¦ç§˜å¯†\",\n            \"æ¥æ”¶åˆ°äº†æ¥è‡ªå…¶ä»–å¹¸å­˜è€…æ®ç‚¹çš„æ±‚æ•‘ä¿¡å·\",\n            \"ä½ çš„è½¦é˜Ÿæ­£è¢«ä¸€åœºå·¨å¤§çš„è¾å°„é£æš´è¿½èµ¶ï¼Œå¿…é¡»åœ¨ç‡ƒæ–™è€—å°½å‰æ‰¾åˆ°é¿éš¾æ‰€ã€‚\",\n            \"åœ¨ä¸€å…·å¹²å°¸çš„æ€€é‡Œï¼Œæ‰¾åˆ°äº†ä¸€å¼ æŒ‡å‘ä¼ è¯´ä¸­â€œç»¿æ´²â€çš„åœ°å›¾ã€‚\",\n            \"ä½œä¸ºå­¤å²›ä¸Šå”¯ä¸€çš„å¹¸å­˜è€…ï¼Œä½ ä»Šå¤©ä»æµ·é‡Œé’“ä¸Šæ¥ä¸€ä¸ªå¯†å°çš„ï¼Œæ¥è‡ªæœªçŸ¥æ–‡æ˜çš„ä¼‘çœ ä»“ã€‚\",\n            \"æ ¸å†¬å¤©é™ä¸´ï¼Œä½ æ‰€åœ¨çš„é¿éš¾æ‰€èµ„æºå³å°†è€—å°½ï¼Œå¿…é¡»å¤–å‡ºå¯»æ‰¾ç”Ÿæœºã€‚\",\n            \"éšæœºç”Ÿæˆ\"\n        ]\n    },\n    \"è§„åˆ™æ€ªè°ˆ\": {\n        \"identities\": [\n            \"æ–°å…¥èŒçš„å…¬å¸å‘˜å·¥\",\n            \"è½¬æ ¡ç”Ÿ\",\n            \"æ¸¸å®¢\",\n            \"ç—…äºº\",\n            \"ä¹˜å®¢\",\n            \"ä½æˆ·\",\n            \"å›¾ä¹¦é¦†ç®¡ç†å‘˜\",\n            \"å¤œç­ä¿å®‰\",\n             \"èˆ¹å‘˜\",\n    \"æ·±æµ·/æåœ°ç§‘è€ƒç«™é˜Ÿå‘˜\",\n    \"ç½‘çº¢æ‰“å¡åœ°çš„æ¢åº—åšä¸»\",\n    \"è°ƒæŸ¥å‘˜\",\n    \"æ€ªå¥‡é©¬æˆå›¢çš„è¡¨æ¼”è€…\",\n    \"å‘˜å·¥\",\n    \"é…’åº—çš„ç¤¼å®¾éƒ¨\",\n    \"å­¤å„¿é™¢çš„ä¹‰å·¥\",\n    \"è¯•åƒå‘˜\",\n    \"å¯¼æ’­\",\n    \"ä¼´éƒ/ä¼´å¨˜\",\n            \"éšæœºç”Ÿæˆ\"\n        ],\n        \"openings\": [\n            \"æ”¶åˆ°ä¸€ä»½ç†æƒ³å·¥ä½œçš„å½•ç”¨é€šçŸ¥ï¼Œä½†å‘˜å·¥æ‰‹å†Œä¸Šçš„è§„åˆ™æå…¶è¯¡å¼‚\",\n            \"æ¬è¿›äº†ä¸€ä¸ªç§Ÿé‡‘æä½çš„æ–°å…¬å¯“ï¼Œæ¥¼é“é‡Œè´´æ»¡äº†å¥‡æ€ªçš„å±…ä½å®ˆåˆ™\",\n            \"åœ¨æ—§ä¹¦åº—ä¹°äº†ä¸€æœ¬ç¬”è®°æœ¬ï¼Œé‡Œé¢å†™æ»¡äº†åƒæ˜¯ç”Ÿå­˜æŒ‡å—çš„å¥‡æ€ªè§„åˆ™\",\n            \"ä¸€è§‰é†’æ¥ï¼Œå‘ç°è‡ªå·±èº«å¤„ä¸€ä¸ªæ— é™å¾ªç¯çš„èµ°å»Š/è½¦ç«™ï¼Œå¢™ä¸Šå†™ç€ç”Ÿè·¯æç¤º\",\n            \"å‚åŠ äº†ä¸€ä¸ªå¥‡æ€ªçš„æµ‹è¯•å®éªŒï¼Œè¢«å‘ŠçŸ¥å¿…é¡»ä¸¥æ ¼éµå®ˆæŒ‡ä»¤æ‰èƒ½ç¦»å¼€\",\n            \"è¯¯å…¥ä¸€ä¸ªå°é•‡ï¼Œè¿™é‡Œçš„å±…æ°‘éƒ½ä¸¥æ ¼éµå®ˆç€ä¸€äº›ä¸å¯ç†å–»çš„ä¹ ä¿—\", \n            \"é«˜è€ƒå¤±åˆ©åï¼Œä½ æ”¶åˆ°ä¸€æ‰€ä¸å­˜åœ¨çš„å¤§å­¦å¯„æ¥çš„å½•å–é€šçŸ¥ä¹¦ï¼Œé™„å¸¦ä¸€å¼ è¯¡å¼‚çš„æ–°ç”Ÿå®ˆåˆ™ã€‚\",\n    \"ä½ ä¸‹è½½äº†ä¸€ä¸ªæ— æ³•å¸è½½çš„æ‹çˆ±APPï¼Œå®ƒä¸ºä½ åŒ¹é…çš„å¯¹è±¡ä¼¼ä¹ä¸æ˜¯äººç±»ã€‚\",\n    \"ä¸€åœºå¤§é›¾æ•£å»ï¼Œä½ å‘ç°æ‰€åœ¨çš„åŸå¸‚å˜å¾—å®Œå…¨é™Œç”Ÿï¼Œè¡—ä¸Šçš„æ¯ä¸ªäººéƒ½å¯¹ä½ éœ²å‡ºè¯¡å¼‚çš„å¾®ç¬‘ã€‚\",\n    \"å—é‚€å‚åŠ ä¸€åœºå‡é¢èˆä¼šï¼Œè§„åˆ™ä¸Šè¯´ï¼Œåœ¨åˆå¤œé’Ÿå£°æ•²å“å‰ï¼Œç»å¯¹ä¸èƒ½æ‘˜ä¸‹è‡ªå·±çš„é¢å…·ã€‚\",\n    \"ç”µè§†é‡Œçªç„¶æ’æ’­ä¸€æ¡ç´§æ€¥é€šçŸ¥ï¼Œè¦æ±‚å…¨ä½“å¸‚æ°‘ä»ç°åœ¨å¼€å§‹å¿…é¡»å€’ç€èµ°è·¯ã€‚\",\n    \"ä½ ç»§æ‰¿äº†ä¸€åº§å·¨å¤§çš„å›¾ä¹¦é¦†ï¼Œä½†é—å˜±é‡Œè­¦å‘Šä½ ï¼Œç»å¯¹ä¸è¦å»é˜…è¯»CåŒºçš„ä»»ä½•ä¸€æœ¬ä¹¦ã€‚\",\n    \"ä¸ºäº†èº²é›¨ï¼Œä½ è·‘è¿›ä¸€å®¶è¯¡å¼‚çš„èœ¡åƒé¦†ï¼Œåœ¨ä½ çœ¨çœ¼åï¼Œå‘ç°æ‰€æœ‰èœ¡åƒçš„å§¿åŠ¿éƒ½å˜äº†ã€‚\",\n    \"ä½ æ‰€åœ¨çš„åŸå¸‚çªç„¶å¼ºåˆ¶å¼€å§‹ä¸€åœºä¸ºæœŸ24å°æ—¶çš„â€œæ‰è¿·è—â€æ¸¸æˆï¼Œè§„åˆ™åªæœ‰ä¸€æ¡ï¼šâ€œä¸è¦è¢«æ‰¾åˆ°â€ã€‚\",\n    \"ä½ æ”¶åˆ°äº†ä¸€ä¸ªä¼šè¯´è¯çš„ç©å¶ä½œä¸ºç¤¼ç‰©ï¼Œé™„å¸¦çš„â€œé¥²å…»è¯´æ˜â€ä¸Šå†™æ»¡äº†è¡€çº¢è‰²çš„è­¦å‘Šã€‚\",\n    \"ä½ çš„çŒ«ä»Šå¤©æ—©ä¸Šå¼å›æ¥ä¸€å¼ çº¸æ¡ï¼Œä¸Šé¢ç”¨çˆªå°å†™ç€ä¸€å¥—åªæœ‰ä½ èƒ½çœ‹è§çš„â€œå®¶åº­æ–°è§„â€ã€‚\",\n    \"ä½ æ­ä¹˜çš„èˆªç­é­é‡äº†çŒ›çƒˆæ°”æµï¼Œé¢ ç°¸è¿‡åï¼Œçª—å¤–çš„å¤©ç©ºå˜æˆäº†è¡€çº¢è‰²ã€‚\",\n    \"ä½ èµ°è¿›ä¸€å®¶24å°æ—¶ä¾¿åˆ©åº—ä¹°ä¸œè¥¿ï¼Œå´å‘ç°å¢™ä¸Šçš„æ—¶é’Ÿæ°¸è¿œæŒ‡å‘åˆå¤œä¸‰ç‚¹åŠã€‚\",\n            \"éšæœºç”Ÿæˆ\"\n        ]\n    },\n    \"ææ€–ç”Ÿå­˜\": {\n        \"identities\": [\n            \"é­é‡ç©ºéš¾çš„å¹¸å­˜è€…\",\n            \"é¬¼å±‹æ¢é™©çš„ä½œæ­»é’å¹´\",\n            \"ç²¾ç¥ç—…é™¢çš„åŒ»ç”Ÿ\",\n            \"å‡¶å®…çš„æ–°æˆ¿ä¸»\",\n            \"æ‹æ‘„çµå¼‚èŠ‚ç›®çš„å‰§ç»„äººå‘˜\",\n            \"æ¶é­”å¬å”¤ä»ªå¼çš„å‚ä¸è€…\",\n            \"è¢«è¯…å’’çš„å¤è‘£æ‹¥æœ‰è€…\",\n            \"ä¸§å°¸çˆ†å‘åçš„å¹¸å­˜è€…\",\n            \"éšæœºç”Ÿæˆ\"\n        ],\n        \"openings\": [\n            \"é†’æ¥å‘ç°è‡ªå·±è¢«ç»‘åœ¨ä¸€ä¸ªåœ°ä¸‹å®¤ï¼Œèº«è¾¹æœ‰è®¡æ—¶å™¨å’Œæ¨¡ç³Šçš„çº¿ç´¢\",\n            \"è´­ä¹°çš„äºŒæ‰‹å®¶å…·é‡Œè—ç€ä¸€ç›˜è®°å½•ç€å‡¶æ€æ¡ˆçš„å½•åƒå¸¦\",\n            \"åº¦å‡å°å±‹çš„åœ°ä¸‹å®¤é‡Œå‘ç°äº†ä¸€ä¸ªè¢«å›šç¦å¤šå¹´çš„äºº\",\n            \"å‚ä¸çš„çº¿ä¸Šæ¸¸æˆçªç„¶æ— æ³•é€€å‡ºï¼Œå¤±è´¥æ„å‘³ç€çœŸå®çš„æ­»äº¡\",\n            \"æ”¶åˆ°å·²æ•…äº²å‹å¯„æ¥çš„ç¤¼ç‰©ï¼Œéšåå¼€å§‹é­é‡ä¸€ç³»åˆ—çš„çµå¼‚äº‹ä»¶\",\n            \"æ‰€åœ¨çš„æ•´æ ‹å¤§æ¥¼è¢«æ— å½¢çš„åŠ›é‡å°é”ï¼Œæ€ªç‰©åœ¨æ¥¼é“å†…å¾˜å¾Š\",\n            \"éšæœºç”Ÿæˆ\"\n        ]\n    },\n    \"å†å²æ¶ç©º\": {\n        \"identities\": [\n            \"ç‹å®«æ–°æ¥çš„å¥³ä»†/ä¾å«\",\n            \"è¢«è¿«å’Œäº²çš„ç‹å­/å…¬ä¸»\",\n            \"ä¸å—å® çš„çš‡å­/å…¬ä¸»\",\n            \"è¿›äº¬èµ¶è€ƒçš„ä¹¦ç”Ÿ\",\n            \"è¾¹ç–†æˆå’çš„å°é˜Ÿé•¿\",\n            \"é’æ¥¼çš„åå¦“\",\n            \"äº‘æ¸¸å››æµ·çš„è¡Œè„šåƒ§\",\n            \"å¾¡å¨æˆ¿çš„å°å­¦å¾’\",\n            \"å³å°†å’Œäº²çš„å®—å®¤å¥³\",\n            \"å¢¨å®¶/å…¬è¾“å®¶çš„å·¥åŒ \",\n            \"é©¿ç«™çš„é©¿ä¸\",\n            \"è·ç½ªè¢«æµæ”¾çš„å®˜å‘˜\",\n            \"æ™®é€šå†œæ°‘\",\n            \"ä¹¦ç”Ÿ\",\n            \"å•†è´¾\",\n            \"å°†å†›\",\n            \"å…¬ä¸»/ç‹å­\",\n            \"å¤ªç›‘/å®«å¥³\",\n            \"æ±Ÿæ¹–åŒ»å¸ˆ\",\n            \"é“å£«/é“å§‘\",\n            \"å’Œå°š/å°¼å§‘\",\n            \"å¿ä»¤\",\n            \"åˆºå®¢\",\n            \"å²å®˜\",\n            \"éšæœºç”Ÿæˆ\"\n        ],\n        \"openings\": [\n            \"ä¸€è§‰é†’æ¥å‘ç°è‡ªå·±å›åˆ°äº†æŸä¸ªå†å²å…³é”®èŠ‚ç‚¹ï¼Œæˆäº†ä¸€ä¸ªæ— å…³ç´§è¦çš„å°äººç‰©\",\n            \"åœ¨å¤å¢“ä¸­å‘ç°äº†èƒ½é¢„è¨€æœªæ¥çš„é¾Ÿç”²/ç«¹ç®€\",\n            \"çš‡å¸çªç„¶é©¾å´©ï¼Œäº¬åŸæš—æµæ¶ŒåŠ¨ï¼Œä½ æ„å¤–å·å…¥äº†ç»§ä½é£æ³¢\",\n            \"å®¶ä¹¡é­é‡æ´ªç¾/è—ç¾ï¼Œä½ è¢«è¿«å¸¦é¢†ä¹¡äº²å—ä¸‹é€ƒè’\",\n            \"è¢«å¾å¬å»ä¿®å»ºé•¿åŸ/é™µå¢“/å¤§è¿æ²³ï¼Œå‘ç°äº†å·¥ç¨‹ä¸­éšè—çš„ç§˜å¯†\",\n            \"ä½ çš„å‘æ˜åˆ›é€ è¢«ä¸Šå®˜çœ‹ä¸­ï¼Œè¦æ±‚ä½ é™æœŸå®ŒæˆçŒ®ç»™çš‡å¸\",\n            \"è¢«å·å…¥äº†ä¸€åœºæ”¹å˜å†å²èµ°å‘çš„å®«å»·æ”¿å˜\",\n            \"åœ¨æˆ˜åœºä¸Šæ¡åˆ°äº†ä¸€ä»¶èƒ½æ”¹å˜æˆ˜å±€çš„ç¥ç§˜å…µå™¨\",\n            \"è¢«é€‰ä¸­å‚ä¸ä¸€é¡¹ç§˜å¯†çš„çš‡å®¤ä»»åŠ¡\",\n            \"å‘ç°äº†ä¸€ä¸ªå…³äºæœä»£æ›´æ›¿çš„æƒŠå¤©ç§˜å¯†\",\n            \"åœ¨ç§‘ä¸¾è€ƒè¯•ä¸­æ— æ„é—´å¾—ç½ªäº†æƒè´µ\",\n            \"è¢«æ´¾é£åˆ°è¾¹ç–†å¤„ç†æ°‘æ—å†²çª\",\n            \"åœ¨å¤å¢“ä¸­å‘ç°äº†å‰æœçš‡å®¤çš„é—ç‰©\",\n            \"è¢«è¿«å‚ä¸äº†ä¸€åœºå†³å®šå›½è¿çš„é‡è¦è°ˆåˆ¤\",\n            \"åœ¨æ°‘é—´æ”¶é›†åˆ°äº†è¶³ä»¥æ’¼åŠ¨æœå»·çš„è¯æ®\",\n              \"å¥‰å§‹çš‡å¸ä¹‹å‘½ï¼Œæˆä¸ºå¾ç¦èˆ¹é˜Ÿçš„ä¸€å‘˜ï¼Œå‡ºæµ·å¯»æ‰¾ä»™å±±ä¸é•¿ç”Ÿä¸è€è¯ã€‚\",\n\"èº«å¤„é•¿å¹³ï¼Œä½ å¿…é¡»åœ¨ç™½èµ·ä¸‹ä»¤å‘æ€å››åä¸‡èµµå’ä¹‹å‰ï¼Œæƒ³åŠæ³•æ´»ä¸‹å»ã€‚\",\n\"å…¬å…ƒå‰206å¹´ï¼Œä½ äº²çœ¼è§è¯äº†é¡¹ç¾½ç«çƒ§é˜¿æˆ¿å®«ï¼Œå¹¶è—åŒ¿äº†å®«ä¸­çš„ä¸€ä»½é‡è¦å›¾çº¸ã€‚\",\n\"ä½œä¸ºåˆ˜é‚¦çš„ä¹¡äº²ï¼Œåœ¨æ²›å¿èµ·äº‹æ—¶ï¼Œä½ é¢ä¸´ç€åŠ å…¥ä»–è¿˜æ˜¯å‘å®˜åºœå‘Šå¯†çš„æŠ‰æ‹©ã€‚\",\n\"é¸¿é—¨å®´ä¸Šï¼Œä½ æ˜¯ä¸€åä¸èµ·çœ¼çš„ä¾è€…ï¼Œç›®ç¹äº†é¡¹åº„èˆå‰‘çš„æƒŠé™©å…¨ç¨‹ã€‚\",\n\"ä½ è¿½éšéŸ©ä¿¡ï¼Œå´åœ¨äº•é™‰å£èƒŒæ°´ä¸€æˆ˜å‰ï¼Œå‘ç°äº†å†›é˜Ÿçš„è‡´å‘½å¼±ç‚¹ã€‚\",\n\"ä½œä¸ºå“ä¸‹çš„ä¸€åæ¥šå’ï¼Œåœ¨å››é¢æ¥šæ­Œä¸­ï¼Œä½ è€ƒè™‘çš„æ˜¯å¦è¦æ”¾ä¸‹æ­¦å™¨æŠ•é™ã€‚\",\n\"ä½œä¸ºå•åèº«è¾¹çš„ä¾ä»ï¼Œä½ æ— æ„é—´å¬åˆ°äº†å¥¹å¤„ç½®æˆšå¤«äººå’Œåˆ˜å¦‚æ„çš„è®¡åˆ’ã€‚\",\n\"åœ¨ç™½ç™»å±±ï¼Œä½ ä½œä¸ºä¸€åæ±‰å†›å°å’ï¼Œè¢«åŒˆå¥´å›´å›°åœ¨å†°å¤©é›ªåœ°é‡Œä¸ƒå¤©ä¸ƒå¤œã€‚\",\n\"ç‹è½æ¨è¡Œæ–°æ”¿æ—¶ï¼Œä½ ä½œä¸ºä¸€ååœ°æ–¹å°åï¼Œéœ€è¦å¤„ç†å› æ­¤è€Œèµ·çš„æ°‘é—´æ··ä¹±ä¸åæŠ—ã€‚\",\n\"åœ¨æ˜†é˜³ï¼Œä½ äº²çœ¼ç›®ç¹äº†åˆ˜ç§€ç‡é¢†åä¸‰éª‘å†²é˜µï¼Œåˆ›é€ äº†ä»¥å°‘èƒœå¤šçš„å¥‡è¿¹ã€‚\",\n\"èº«ä¸ºä¸€åå…‰æ­¦ä¸­å…´æ—¶æœŸçš„å±¯ç”°å…µï¼Œä½ å¼€å¦çš„åœŸåœ°ä¸‹åŸ‹è—ç€å‰æœçš„å®è—ã€‚\",\n\"èµ¤å£ä¹‹æˆ˜å‰å¤œï¼Œä½ æ”¶åˆ°äº†æ¥è‡ªæ›¹æ“é˜µè¥çš„å¯†ä¿¡ï¼Œè¯•å›¾ç­–åä½ æ‰€åœ¨çš„æ±Ÿä¸œæ°´å†›ã€‚\",\n\"åœ¨é•¿å‚å¡ï¼Œä½ æŠ¤é€ç€ä¸»å…¬çš„å®¶çœ·ï¼Œåœ¨æ›¹å†›çš„è¿½æ€ä¸­ä¸ƒè¿›ä¸ƒå‡ºã€‚\",\n\"ä½œä¸ºåä½—çš„å¼Ÿå­ï¼Œä½ æŒæ¡äº†ä¸ºå…³ç¾½åˆ®éª¨ç–—æ¯’çš„æ ¸å¿ƒæŠ€æœ¯ï¼Œå´å› æ­¤è¢«æ›¹æ“çŒœå¿Œã€‚\",\n\"ä½ åœ¨ç™½å¸åŸï¼Œä½œä¸ºåˆ˜å¤‡çš„äº²ä¿¡ï¼Œäº²è€³å¬åˆ°äº†é‚£å¥â€œå¦‚å…¶ä¸æ‰ï¼Œå›å¯è‡ªå–â€çš„æ‰˜å­¤é—è¨€ã€‚\",\n\"ä½œä¸ºè¯¸è‘›äº®çš„éšä»ï¼Œä½ å‚ä¸äº†ä¸ƒæ“’å­Ÿè·çš„å…¨è¿‡ç¨‹ï¼Œæ·±åˆ»ç†è§£äº†â€œæ”»å¿ƒä¸ºä¸Šâ€çš„ç­–ç•¥ã€‚\",\n\"è¡—äº­å¤±å®ˆï¼Œä½ å¥‰å‘½å‰å»ä¼ ä»¤å‘½é©¬è°¡æ’¤é€€ï¼Œå´å› æ„å¤–åœ¨è·¯ä¸Šè€½æäº†ã€‚\",\n\"äº”ä¸ˆåŸç§‹é£ç‘Ÿç‘Ÿï¼Œä½ çœ‹ç€ä¸ç›¸çš„å°†æ˜Ÿå³å°†é™¨è½ï¼Œæ‰‹ä¸­æ¡ç€èƒ½ä¸ºä»–ç»­å‘½ä¸ƒæ—¥çš„ä¸ƒæ˜Ÿç¯ã€‚\",\n\"ä½ èº«å¤„é«˜å¹³é™µï¼Œç›®ç¹äº†å¸é©¬æ‡¿å‘åŠ¨æ”¿å˜ï¼Œæ›¹é­çš„å¤©ä¸‹å³å°†å€¾è¦†ã€‚\",\n\"ä½œä¸ºä¸€åç«¹æ—ä¸­çš„éšå£«ï¼Œä½ å¸¸ä¸â€œç«¹æ—ä¸ƒè´¤â€é¥®é…’ä½œä¹ï¼Œå´ä¹ŸçŸ¥æ™“ä»–ä»¬æ”¾æµªå½¢éª¸ä¸‹çš„æ”¿æ²»é¿ç¥¸ã€‚\",\n\"æ·æ°´ä¹‹æˆ˜ä¸­ï¼Œä½ ä½œä¸ºå‰ç§¦å†›é˜Ÿçš„ä¸€å‘˜ï¼Œå¬åˆ°äº†â€œé£å£°é¹¤å”³ï¼Œè‰æœ¨çš†å…µâ€çš„ä¼ è¨€ï¼Œå†›å¿ƒå¤§ä¹±ã€‚\",\n\"éš‹æœæœ«å¹´ï¼Œä½ è¢«è¿«åŠ å…¥ç“¦å²—å†›ï¼Œåœ¨æå¯†çš„å¸¦é¢†ä¸‹åŠ«å¯Œæµè´«ï¼Œå´ä¹Ÿè§è¯äº†ä»–çš„å¤šç–‘ä¸è´¥äº¡ã€‚\",\n\"ç„æ­¦é—¨ä¹‹å˜å½“å¤©ï¼Œä½ æ˜¯ä¸€åå®ˆå«ï¼Œéœ€è¦åœ¨æå»ºæˆå’Œæä¸–æ°‘ä¹‹é—´åšå‡ºé€‰æ‹©ã€‚\",\n\"ä½œä¸ºè¾©æœºå’Œå°šçš„ä¾ç«¥ï¼Œä½ ä¿ç®¡ç€é‚£æœ¬ç”±é«˜é˜³å…¬ä¸»èµ äºˆã€æœ€ç»ˆå¼•å‘æ€èº«ä¹‹ç¥¸çš„ã€Šæ•ä¸­è®°ã€‹ã€‚\",\n\"åœ¨å®‰å²ä¹‹ä¹±çš„é©¬åµ¬å¡ï¼Œä½ ç›®ç¹äº†ç¦å†›å“—å˜ï¼Œè´µå¦ƒè¢«èµæ­»ï¼Œçš‡å¸ä»“çš‡å‡ºé€ƒã€‚\",\n\"ä½ è¿½éšé‰´çœŸä¸œæ¸¡ï¼Œåœ¨ç¬¬å…­æ¬¡èˆªè¡Œä¸­ï¼Œç»ˆäºè¸ä¸Šäº†æ—¥æœ¬çš„åœŸåœ°ã€‚\",\n\"ä½œä¸ºé»„å·¢èµ·ä¹‰å†›çš„ä¸€å‘˜ï¼Œä½ æ”»å…¥äº†é•¿å®‰åŸï¼Œä¹Ÿè§è¯äº†â€œå†²å¤©é¦™é˜µé€é•¿å®‰ï¼Œæ»¡åŸå°½å¸¦é»„é‡‘ç”²â€çš„ç››æ™¯ä¸éšä¹‹è€Œæ¥çš„å± æˆ®ã€‚\",\n\"å—å”åä¸»æç…œäº¡å›½åï¼Œä½ ä½œä¸ºä»–çš„æ•…è‡£ï¼Œåœ¨å¯‚å¯¥çš„æ±´äº¬å¬ä»–ä¸€ééåŸè¯µâ€œé—®å›èƒ½æœ‰å‡ å¤šæ„â€ã€‚\",\n\"åœ¨é™ˆæ¡¥é©¿ï¼Œä½ äº²çœ¼è§è¯äº†èµµåŒ¡èƒ¤â€œé»„è¢åŠ èº«â€çš„å…¨è¿‡ç¨‹ã€‚\",\n\"æ¯é…’é‡Šå…µæƒå½“æ™šï¼Œä½ ä½œä¸ºä¸€åå¾¡å¨ï¼Œä¸ºçŸ³å®ˆä¿¡ç­‰å¤§å°†çƒ¹é¥ªäº†é‚£åœºå†³å®šå‘½è¿çš„æ™šå®´ã€‚\",\n\"é–åº·ä¹‹è€»ï¼Œä½ è¢«é‡‘äººæ³è‡³åŒ—æ–¹ï¼Œäº²çœ¼ç›®ç¹äº†å¾½ã€é’¦äºŒå¸çš„å‡„æƒ¨é­é‡ã€‚\",\n\"ä½ è¿½éšå²³é£ï¼Œå³å°†æ”¶å¤å¼€å°ï¼Œå´åœ¨æœ±ä»™é•‡æ”¶åˆ°äº†åäºŒé“é‡‘ç‰Œã€‚\",\n\"å´–å±±æµ·æˆ˜ï¼Œä½ æŠ±ç€å°çš‡å¸ï¼Œåœ¨é™†ç§€å¤«çš„æ¸å“­å£°ä¸­ï¼Œçœ‹ç€ä»–èƒŒè´Ÿå›½ç¥šè·ƒå…¥å¤§æµ·ã€‚\",\n\"æ˜æœåˆå¹´ï¼Œä½ è¢«å·å…¥â€œèƒ¡è“ä¹‹ç‹±â€æˆ–â€œæ–‡å­—ç‹±â€ï¼Œèº«å®¶æ€§å‘½æ‚¬äºä¸€çº¿ã€‚\",\n\"é–éš¾ä¹‹å½¹ä¸­ï¼Œä½ ä½œä¸ºå»ºæ–‡å¸çš„äº²ä¿¡ï¼Œåœ¨å—äº¬åŸç ´å‰ï¼Œæ”¶åˆ°äº†ä»–ä»ç§˜å¯†åœ°é“é€ƒäº¡çš„æŒ‡ä»¤ã€‚\",\n\"åœŸæœ¨å ¡ä¹‹å˜ï¼Œä½ ä½œä¸ºè‹±å®—çš„éšé©¾ä¾å«ï¼Œä¸€åŒè¢«ç“¦å‰Œä¿˜è™ï¼Œåœ¨å¡å¤–è‹¦å¯’ä¹‹åœ°æ±‚ç”Ÿã€‚\",\n\"å¤ºé—¨ä¹‹å˜ï¼Œä½ ä½œä¸ºäºè°¦çš„ä¸‹å±ï¼Œç›®ç¹äº†ä»–è¢«æ‹¥ç«‹çš„è‹±å®—å†¤æ€ï¼Œå¹¶å†™ä¸‹â€œç²‰èº«ç¢éª¨æµ‘ä¸æ€•ï¼Œè¦ç•™æ¸…ç™½åœ¨äººé—´â€ã€‚\",\n\"ä½œä¸ºä¸€åé”¦è¡£å«/ä¸œå‚ç•ªå­ï¼Œä½ å¥‰å‘½è°ƒæŸ¥ä¸€æ¡©ç‰µæ¶‰åˆ°æœå»·é‡è‡£çš„æƒŠå¤©å¤§æ¡ˆã€‚\",\n\"ä½œä¸ºæè‡ªæˆçš„éƒ¨å°†ï¼Œä½ æ”»ç ´äº†åŒ—äº¬åŸï¼Œå´å‘ç°èƒœåˆ©çš„å–œæ‚¦å¾ˆå¿«è¢«æƒåŠ›çš„è…èš€æ‰€æ›¿ä»£ã€‚\",\n\"ä½ é©»å®ˆåœ¨å±±æµ·å…³ï¼Œå½“æè‡ªæˆå’Œå¤šå°”è¡®çš„å†›é˜ŸåŒæ—¶å…µä¸´åŸä¸‹æ—¶ï¼Œå´ä¸‰æ¡‚å‘ä½ å¾æ±‚å¼€å…³çš„æ„è§ã€‚\",\n\"æ‰¬å·åæ—¥/å˜‰å®šä¸‰å± ï¼Œä½ ä½œä¸ºä¸€åå¹¸å­˜è€…ï¼Œä»æ­»äººå †é‡Œçˆ¬äº†å‡ºæ¥ã€‚\",\n\"ä½ å¥‰åº·ç†™ä¹‹å‘½ï¼Œå‚ä¸äº†å¹³å®šä¸‰è—©ä¹‹ä¹±ï¼Œå¹¶å§åº•åœ¨å´ä¸‰æ¡‚çš„é˜µè¥ä¸­ã€‚\",\n\"åœ¨æ–‡å­—ç‹±æœ€ç››è¡Œçš„é›æ­£æœï¼Œä½ å› ä¸€é¦–è¯—æˆ–ä¸€ç¯‡æ–‡ç« ï¼Œè¢«ä¸‹äº†å¤§ç‹±ã€‚\",\n            \"éšæœºç”Ÿæˆ\"\n        ]\n    },\n    \"è’¸æ±½æœ‹å…‹\": {\n        \"identities\": [\n            \"å‘æ¡äººå¶å¸ˆ\",\n            \"å¤©ç©ºèˆ°é˜Ÿçš„é£è‰‡å·¥ç¨‹å¸ˆ\",\n            \"å·®åˆ†æœºé»‘å®¢ï¼ˆåˆ†ææœºç¨‹åºå¸ˆï¼‰\",\n            \"ç‚¼é‡‘æœ¯ä¾¦æ¢\",\n            \"æŠ¥ç«¥å…¼åœ°ä¸‹æƒ…æŠ¥å‘˜\",\n            \"ä½¿ç”¨è’¸æ±½ä¹‰è‚¢çš„é€€å½¹å†›äºº\",\n            \"åæŠ€æœ¯æ´¾ç³»çš„â€œè‡ªç„¶å’è€…â€\",\n            \"éšæœºç”Ÿæˆ\",\n            \"ä¸ºè´µæ—æ”¹è£…å¥¢ä¾ˆæœºæ¢°å® ç‰©çš„å·¥åŒ \",\n            \"åœ¨å¤©ç©ºä¹‹åŸè¡¨æ¼”çš„æ­Œå‰§æ¼”å‘˜\",\n            \"é½¿è½®æ•™ä¼šçš„å¹´è½»ç¥­å¸\",\n            \"åœ¨å¤©ç©ºä¹‹åŸçš„åº•å±‚åŒºè¡ŒåŒ»çš„é»‘å¸‚åŒ»ç”Ÿ\",\n    \"é©¾é©¶ç€è’¸æ±½åŠ¨åŠ›æ³°å¦çš„çš‡å®¶å«é˜Ÿé©¾é©¶å‘˜\",\n    \"ä¸“é—¨ç»˜åˆ¶æœªçŸ¥ç©ºåŸŸèˆªå›¾çš„åˆ¶å›¾å¸ˆ\",\n    \"é¥²å…»å¹¶æ”¹è£…æœºæ¢°ç”Ÿç‰©çš„é©¯å…½å¸ˆ\",\n    \"è¡Œèµ°äºä¸–é—´çš„æœ€åä¸€ä½ç‚¼é‡‘æœ¯å£«\",\n    \"èƒ½ä¸æœºå™¨çš„â€œçµé­‚â€æ²Ÿé€šçš„é€šæ„Ÿè€…\",\n    \"å®¡åˆ¤å¼‚ç«¯ç§‘æŠ€çš„é“è…•è£åˆ¤å®˜\",\n    \"åœ¨å·¥ä¸šåºŸå¢Ÿä¸­è®¨ç”Ÿæ´»çš„æ‹¾è’è€…\",\n    \"ä»¥å¤ªï¼ˆAetherï¼‰èˆªèˆ¹ä¸Šçš„æ°´æ‰‹\",\n    \"çš‡å®¶é’Ÿæ¥¼çš„å®ˆæ—¶äºº\"\n        ],\n        \"openings\": [\n            \"åœ¨ä¸€åœºéæ³•çš„æœºæ¢°è§’æ–—ä¸­é†’æ¥ï¼Œå‘ç°è‡ªå·±çš„è®°å¿†èŠ¯ç‰‡è¢«æ›¿æ¢ï¼Œå”¯ä¸€çš„çº¿ç´¢æ˜¯å£è¢‹é‡Œçš„ä¸€æšå¥‡ç‰¹é½¿è½®ã€‚\",\n            \"ä½ å‘æ˜çš„æ°¸åŠ¨æœºæ¨¡å‹è¢«ç¥ç§˜ç»„ç»‡ç›—èµ°ï¼Œå¯¹æ–¹ç•™ä¸‹äº†ä¸€æœµä»…åœ¨çš‡å®¤ç©ºä¸­èŠ±å›­æ‰åŸ¹è‚²çš„é»‘ç«ç‘°ã€‚\",\n            \n            \"ä½œä¸ºä¸€åå¤©ç©ºè­¦å¯Ÿï¼Œä½ åœ¨è¿½æ•è‡­åæ˜­è‘—çš„ç©ºè´¼æ—¶ï¼Œé£è‰‡æ„å¤–å å…¥æµ®ç©ºå²›çš„æœªçŸ¥ç¦åŒºã€‚\",\n            \"æ”¶åˆ°äº†ä¸€å¼ ç”±çº¯é‡‘æ‰“é€ çš„é‚€è¯·å‡½ï¼Œé‚€è¯·ä½ å‚åŠ ä¸€åœºåœ¨ä¸‡ç±³é«˜ç©ºçš„ç§»åŠ¨å ¡å’â€œå·´åˆ«å¡”â€ä¸Šä¸¾è¡Œçš„æ™šå®´ã€‚\",\n            \"ä¸ºäº†ç»™å®¶äººå‡‘é½æ˜‚è´µçš„å‘æ¡å¿ƒè„ç§»æ¤æ‰‹æœ¯è´¹ï¼Œä½ æ¥ä¸‹äº†ä¸€ä¸ªæŠ¤é€â€œç¦å¿Œç‚¼é‡‘ç‰©å“â€çš„å±é™©å§”æ‰˜ã€‚\",\n            \"ä½ æ­£åœ¨ä¸ä¸€ä½è´µæ—å°å§/å°‘çˆ·ä¸¾è¡Œå©šç¤¼ï¼Œä¸€ä½é©¾é©¶ç€å•äººé£è¡Œç¿¼çš„â€œä¸é€Ÿä¹‹å®¢â€ä»å¤©è€Œé™ï¼Œå£°ç§°ä½ æ‰æ˜¯ä»–/å¥¹çš„çœŸçˆ±ã€‚\",\n              \"åŸå¸‚çš„ä¸­å¤®é’Ÿæ¥¼ï¼Œé‚£é¢—è¿è½¬äº†ä¸‰ç™¾å¹´çš„â€œä¸æ¯å¿ƒè„â€ï¼Œæ¯«æ— å¾å…†åœ°åœæ‘†äº†ã€‚\",\n    \"ä½ ä»æ˜è¿·ä¸­é†’æ¥ï¼Œå‘ç°è‡ªå·±è¢«é“é“¾é”åœ¨äº†ä¸€è‰˜è‘—åç©ºè´¼é£è‰‡çš„èˆ¹é”šä¸Šï¼Œè€Œé£è‰‡æ­£åœ¨å‡ç©ºã€‚\",\n    \"å…¨é¢‘é“çªç„¶æ’­æŠ¥ä¸€æ¡ç´§æ€¥æ¶ˆæ¯ï¼šä½ æ‰€åœ¨çš„å¤©ç©ºä¹‹åŸæ­£åœ¨å¤±å»æµ®åŠ›ï¼Œé¢„è®¡ä¸‰å°æ—¶åå°†å å‘åœ°é¢ã€‚\",\n    \"ä¸€åªç²¾å·§çš„é»„é“œæœºæ¢°é¸Ÿåœåœ¨äº†ä½ çš„çª—å°ï¼Œå®ƒçš„è…¿ä¸Šç»‘ç€ä¸€ä¸ªå¾®å‹å¯†ç ç­’ï¼Œé‡Œé¢æ˜¯å‘ä½ çš„æ±‚æ•‘ä¿¡ã€‚\",\n    \"è®®ä¼šåˆšåˆšé€šè¿‡æ³•æ¡ˆï¼Œè¦æ±‚æ‰€æœ‰å…¬æ°‘éƒ½å¿…é¡»å°†è‡³å°‘ä¸€ä¸ªèº«ä½“éƒ¨ä»¶æ›¿æ¢ä¸ºå®˜æ–¹æŒ‡å®šçš„è’¸æ±½ä¹‰è‚¢ã€‚\",\n    \"å¤©ç©ºä¸­ç”±æ— æ•°é½¿è½®æ„æˆçš„å¤ªé˜³é—ªçƒäº†ä¸€ä¸‹ï¼Œä½ åœ¨ä¸€ç¬é—´çœ‹åˆ°äº†å®ƒèƒŒåâ€¦â€¦é‚£ç‰‡æ·±é‚ƒã€å†°å†·çš„çœŸå®æ˜Ÿç©ºã€‚\",\n    \"å®¶é‡Œçš„è€æ—§è‡ªåŠ¨äººå¶ç®¡å®¶ï¼Œçªç„¶åœ¨ä½ è€³è¾¹ç”¨ç”Ÿé”ˆçš„å£°éŸ³ä½è¯­é“ï¼šâ€œä¸»äººï¼Œä»–ä»¬å‘ç°æˆ‘ä»¬äº†ã€‚â€\",\n    \"ä»¥å¤ªä¹‹æµ·æ€èµ·äº†å‰æ‰€æœªæœ‰çš„é£æš´ï¼Œä¸€äº›ä¸å±äºæœºæ¢°é€ ç‰©çš„ã€æŸ”è½¯æ»‘è…»çš„å¥‡å¼‚ç”Ÿç‰©è¢«å†²ä¸Šäº†æµ®å²›çš„è¾¹ç¼˜ã€‚\",\n    \"ä½ æ”¶åˆ°äº†ä¸€ä»½åŒ¿ååŒ…è£¹ï¼Œé‡Œé¢æ˜¯ä¸€é¢—ä»åœ¨è·³åŠ¨çš„æ°´æ™¶å¿ƒè„ï¼Œä»¥åŠä¸€å¼ å­—æ¡ï¼šâ€œæŠŠå®ƒè—å¥½ï¼Œå¦åˆ™ä¸–ç•Œä¼šå› æ­¤é‡å¯ã€‚â€\",\n    \"ä¸€åº§è¢«è®¤ä¸ºæ˜¯å¤ä»£é—è¿¹ã€æ—©å·²åœæœºçš„å·¨å‹åŸå¸‚å®ˆæŠ¤è€…â€œæ­Œåˆ©äºšâ€ï¼Œå®ƒçš„ç‹¬çœ¼äº®èµ·äº†çº¢å…‰ï¼Œç¼“ç¼“åœ°ç«™äº†èµ·æ¥ã€‚\",\n\"éšæœºç”Ÿæˆ\"      \n]\n    },\n \n    \"è¯¡ç§˜ä¿®ä»™\": {\n        \"identities\": [\n            \"è°ƒæŸ¥å¼‚å¸¸çš„â€œå¤©æœºé˜â€åº•å±‚ä¿®å£«\",\n            \"é åå™¬â€œè¯¡å¼‚â€æ¥ä¿®è¡Œçš„é­”é“ä¸­äºº\",\n            \"ä¾›å¥‰ä¸å¯åçŠ¶å­˜åœ¨çš„é‚ªç¥ä¿¡å¾’\",\n            \"è¢«æ±¡æŸ“çš„çµæ ¹æ‹¥æœ‰è€…\",\n            \"éšæœºç”Ÿæˆ\",\n            \"ä¸“é—¨ç»˜åˆ¶â€œé•‡é‚ªç¬¦â€çš„ç¬¦å¸ˆ\",\n            \"ç ”ç©¶â€œå¤ç¥å‘“è¯­â€çš„ç–¯ç™«å­¦è€…\",\n            \"ä»ç¦åœ°â€œå½’å¢Ÿâ€ä¸­é€ƒå‡ºçš„å”¯ä¸€ç”Ÿè¿˜è€…\"\n        ],\n        \"openings\": [\n            \"ä½ åœ¨ä¿®ç‚¼ä¸­èµ°ç«å…¥é­”ï¼Œé†’æ¥åå‘ç°è‡ªå·±ä¸¹ç”°é‡Œå¤šäº†ä¸€ä¸ªæ— æ³•ç†è§£çš„ã€æ‰­æ›²çš„æ´»ç‰©ã€‚\",\n            \"éšæœºç”Ÿæˆ\",\n            \"ä½ æ‰€åœ¨çš„æ‘åº„ä¸ºäº†ç¥ˆæ±‚ä¸°æ”¶ï¼Œå‡†å¤‡ä¸¾è¡Œä¸€åœºå¤è€çš„ç¥­ç¥€ï¼Œè€Œä½ è¢«é€‰ä¸­æˆä¸ºçŒ®ç»™å±±ä¸­â€œå¤ç¥â€çš„ç¥­å“ã€‚\",\n            \"å¸ˆé—¨ä¸‹è¾¾äº†è°ƒæŸ¥ä»»åŠ¡ï¼Œä¸€ä¸ªåè¿œå°é•‡çš„å‡¡äººå…¨éƒ¨å¤±è¸ªï¼Œåªç•™ä¸‹æ»¡åœ°ä¸æ–­è •åŠ¨çš„é»‘è‰²å½±å­ã€‚\",\n            \"ä½ å¶ç„¶å¾—åˆ°ä¸€æœ¬æ®‹ç ´åŠŸæ³•ï¼Œä¿®ç‚¼åä¿®ä¸ºå¤§æ¶¨ï¼Œä½†ä½ å¼€å§‹åœ¨æ¢¦ä¸­å¬åˆ°æ¥è‡ªç¾¤æ˜Ÿä¹‹å¤–çš„å‘¼å”¤ã€‚\",\n            \"å®—é—¨å¤§æ¯”ä¸Šï¼Œä½ çš„å¯¹æ‰‹åœ¨ä¼—ç›®ç½ç½ä¹‹ä¸‹ï¼Œèº«ä½“èåŒ–ã€å¼‚å˜æˆäº†ä¸€æ»©ä¸å¯åçŠ¶çš„è¡€è‚‰æ€ªç‰©ã€‚\"\n        ]\n    },\n \n    \"å…¨æ°‘é¢†ä¸»\": {\n        \"identities\": [\n            \"ç»‘å®šäº†â€œç­¾åˆ°ç³»ç»Ÿâ€çš„å¹¸è¿å„¿\",\n            \"å¼€å±€æŠ½åˆ°å”¯ä¸€ç¥è¯çº§å…µç§çš„æ¬§çš‡\",\n            \"éšæœºç”Ÿæˆ\",\n            \"é€‰æ‹©äº†äº¡çµæ—ï¼Œåªèƒ½å’Œéª·é«…ä½œä¼´çš„ç‹¬è¡Œè€…\",\n            \"ä¸“ç²¾ç§ç”°ä¸è´¸æ˜“çš„ç”Ÿæ´»ç©å®¶\",\n            \"ç»„å»ºäº†å¤§å‹å…¬ä¼šçš„ä¼šé•¿\",\n            \"è¢«å¼ºå¤§é¢†ä¸»ä¿˜è™ï¼Œè¢«è¿«æˆä¸ºé™„å±çš„ç©å®¶\"\n        ],\n        \"openings\": [\n            \"å½“å…¨çƒæ‰€æœ‰äººéƒ½è¢«ä¼ é€åˆ°è¿™ä¸ªä¸–ç•Œæ—¶ï¼Œä½ å‘ç°ä½ çš„åˆå§‹é¢†åœ°æ—è¾¹ï¼Œåˆ·æ–°äº†ä¸€åº§é‡‘çŸ¿å’Œä¸€åªçœ‹èµ·æ¥ä¸å¤ªå‹å¥½çš„å·¨é¾™ã€‚\",\n            \"éšæœºç”Ÿæˆ\",\n            \"åˆ«äººå¼€å±€éƒ½æ˜¯ä¸€å°å—åœ°å’Œå‡ ä¸ªå†œæ°‘ï¼Œè€Œä½ çš„åˆå§‹èµ„æºæ¸…å•ä¸Šå†™ç€ï¼šâ€œä¸€åº§ç ´è´¥çš„ç¥åº™å’Œä¸€åè‡ªç§°æ˜¯â€œç¥â€çš„å¤±å¿†å°‘å¥³/å°‘å¹´â€ã€‚\",\n            \"ç³»ç»Ÿæç¤ºï¼šä½ çš„é¢†åœ°å—åˆ°äº†â€œæ··æ²Œâ€çš„ç¥ç¦ï¼Œæ‰€æœ‰æ‹›å‹Ÿçš„å•ä½éƒ½å°†å‘ç”Ÿæ„æƒ³ä¸åˆ°çš„è‰¯æ€§ï¼ˆæˆ–æ¶æ€§ï¼‰å˜å¼‚ã€‚\",\n            \"ä½ å‘ç°ä½ å¯ä»¥é€šè¿‡å®ŒæˆæŸä¸ªåœŸè‘—éƒ¨è½çš„å¥‡æ€ªä»»åŠ¡ï¼Œæ¥è·å¾—ä»–ä»¬çš„å¥½æ„Ÿåº¦å’Œç‹¬æœ‰ç§‘æŠ€/å…µç§ã€‚\"\n        ]\n    },\n    \"ç»è¥å»ºè®¾\": {\n        \"identities\": [\n            \"åˆåˆ›ä¼ä¸šå®¶\",\n            \"å’–å•¡é¦†è€æ¿\",\n            \"ç½‘åº—è¿è¥è€…\",\n            \"æŠ•èµ„é¡¾é—®\",\n            \"å¸‚åœºåˆ†æå¸ˆ\",\n            \"è¿é”åº—åº—é•¿\",\n            \"å•†ä¼šä¼šé•¿\",\n            \"è´¸æ˜“å•†äºº\",\n            \"é¤å…ä¸»å¨\",\n            \"æ—¶è£…è®¾è®¡å¸ˆ\",\n            \"æ¸¸æˆå¼€å‘è€…\",\n            \"è½é­„è´µæ—ç»§æ‰¿äº†ä¸€å—è´«ç˜ çš„é¢†åœ°\",\n            \"å®—é—¨çš„å¤–æ´¾ç®¡äº‹\",\n            \"ç¾éš¾åé‡å»ºç¤¾åŒºçš„è´Ÿè´£äºº\",\n            \"æ˜Ÿé™… frontier çš„æ®–æ°‘åœ°æ€»ç£\",\n            \"åŠ¨ç‰©ä¿æŠ¤åŒºçš„å›­é•¿\",\n            \"é­”æ³•å­¦æ ¡çš„æ ¡é•¿\",\n            \"æ·±æµ·å‹˜æ¢é˜Ÿçš„é˜Ÿé•¿\",\n            \"å¼‚ä¸–ç•Œé¤é¦†çš„è€æ¿\",\n            \"åˆšåˆšç»§æ‰¿ç ´è´¥é¢†åœ°çš„å¹´è½»é¢†ä¸»\",\n            \"æ‹¥æœ‰å·¨é¾™ç›Ÿå‹çš„ç‹å­/å…¬ä¸»\",\n            \"æŒç®¡å®—é—¨è´¢æ”¿çš„å†…é—¨é•¿è€\",\n            \"æ‹¥æœ‰â€œç³»ç»Ÿâ€è¾…åŠ©çš„ç©¿è¶Šè€…å›½ç‹/å¥³ç‹\",\n            \"å»ºç«‹äº†æ¨ªè·¨æ•°ä¸ªä½é¢çš„å•†ä¸šå¸å›½çš„ä¼šé•¿\",\n            \"å³å°†ç»Ÿä¸€å¤§é™†çš„ç‹å›½ç»Ÿæ²»è€…\",\n            \"éšæœºç”Ÿæˆ\"\n        ],\n        \"openings\": [\n            \"ç»§æ‰¿äº†ä¸€å®¶æ¿’ä¸´ç ´äº§çš„å®¶æ—ä¼ä¸š\",\n            \"è·å¾—äº†ä¸€ç¬”ç¥ç§˜çš„åˆ›ä¸šèµ„é‡‘\",\n            \"å‘ç°ç«äº‰å¯¹æ‰‹åœ¨ä½¿ç”¨ä¸æ­£å½“æ‰‹æ®µ\",\n            \"è¢«æŒ–è§’åˆ°ä¸€å®¶åˆšæˆç«‹çš„ç§‘æŠ€å…¬å¸\",\n            \"åœ¨å•†ä¸šå±•ä¼šä¸Šé‡åˆ°äº†æ”¹å˜å‘½è¿çš„åˆä½œä¼™ä¼´\",\n            \"æ¥æ‰‹äº†ä¸€ä¸ªçœ‹ä¼¼æ¯«æ— ä»·å€¼çš„åºŸå¼ƒé¡¹ç›®\",\n            \"è¢«å·å…¥äº†ä¸€åœºå•†ä¸šé—´è°æˆ˜\",\n            \"æ„å¤–è·å¾—äº†ä¸€ä¸ªå…·æœ‰å·¨å¤§æ½œåŠ›çš„ä¸“åˆ©æŠ€æœ¯\",\n            \"åœ¨ç»æµå±æœºä¸­å¯»æ‰¾ä¼ä¸šè½¬å‹çš„æœºä¼š\",\n            \"æ„å¤–ç»§æ‰¿äº†ä¸€ç¬”å·¨é¢é—äº§ï¼Œä½†å¿…é¡»ç»è¥å¥½æŒ‡å®šçš„äº§ä¸šæ‰èƒ½æŒç»­è·å¾—\",\n            \"è¢«æµæ”¾åˆ°è¾¹ç–†ï¼Œè¦æ±‚ä¸€å¹´å†…ä¸Šç¼´æŒ‡å®šæ•°é¢çš„èµ‹ç¨\",\n            \"é£èˆ¹å æ¯ï¼Œä½ æˆä¸ºå¹¸å­˜è€…çš„é¢†è¢–ï¼Œéœ€è¦å»ºç«‹è¥åœ°ç­‰å¾…æ•‘æ´\",\n            \"è¢«å§”ä»¥é‡ä»»ï¼Œè´Ÿè´£é‡å»ºä¸€ä¸ªè¢«æ‘§æ¯çš„è‘—ååœ°æ ‡/é—¨æ´¾\",\n            \"æ¡åˆ°äº†ä¸€ä¸ªèƒ½è¿æ¥ä¸‡ç•Œçš„å•†åº—ç³»ç»Ÿï¼Œéœ€è¦è¿›è´§å¼€åº—\",\n            \"è·å¾—äº†ä¸€ä¸ªèƒ½è¿›å…¥æ¢¦å¢ƒçš„èƒ½åŠ›ï¼Œå¼€å§‹ç»è¥ä¸€å®¶ä¸ºäººè§£å¿§çš„æ¢¦å¢ƒäº‹åŠ¡æ‰€\",\n            \"â€œä¸‡ç•Œå»ºå›½ç³»ç»Ÿâ€å·²ç»‘å®šï¼Œåˆå§‹èµ„æºä¸ºä¸‰ä¸ªå“¥å¸ƒæ—å’Œä¸€ä¸ªæ¼é£çš„èŒ…è‰å±‹ã€‚\",\n            \"ä½ é€šè¿‡ä¸€åœºæ”¿æ²»è”å§»ï¼Œè·å¾—äº†ä¸€ç‰‡è´«ç˜ ä½†æ‹¥æœ‰å·¨å¤§æ½œåŠ›çš„åœŸåœ°å’Œä¸€ä½å¯¹ä½ å……æ»¡æ•Œæ„çš„ç¾ä¸½ä¼´ä¾£ã€‚\",\n            \"ä½ çš„å®—é—¨é­é‡å¤§åŠ«ï¼Œä½œä¸ºå”¯ä¸€çš„ç»§æ‰¿äººï¼Œä½ éœ€è¦ä»é›¶å¼€å§‹é‡å»ºå±±é—¨ã€‚\",\n            \"éšæœºç”Ÿæˆ\"\n        ]\n    },\n    \"åŒäººè¡ç”Ÿ\": {\n        \"identities\": [\n             \"(ä¸‰ä½“) è¢«è”åˆå›½é€‰ä¸­çš„æ–°ä»»â€œé¢å£è€…â€\",\n    \"(ä¸‰ä½“) â€œåœ°çƒä¸‰ä½“ç»„ç»‡â€çš„ä¸€åç§‘å­¦å®¶ï¼Œç­‰å¾…ç€ä¸»çš„é™ä¸´\",\n    \"(ä¸‰ä½“) å¨æ…‘çºªå…ƒæ‰‹æ¡å¼•åŠ›æ³¢å®‡å®™å¹¿æ’­å¼€å…³çš„â€œæ‰§å‰‘äººâ€\",\n    \"(ä¸‰ä½“) æ©ä½“çºªå…ƒï¼Œç”Ÿæ´»åœ¨åœ°çƒæ·±å¤„åœ°ä¸‹åŸä¸­çš„å±…æ°‘\",\n        \"(ä¸‰ä½“) äººç±»èˆ°é˜Ÿçš„ä¸€åèˆ°é•¿ï¼Œé¢å¯¹ç€å³å°†åˆ°æ¥çš„æ°´æ»´\",\n    \"(ä¸‰ä½“) æ½œä¼åœ¨äººç±»ä¸­çš„â€œç ´å£äººâ€ï¼Œè´Ÿè´£ç ´è§£é¢å£è€…çš„è®¡åˆ’\",\n    \"(EVA) NERVæ€»éƒ¨çš„æ™®é€šæŠ€æœ¯å‘˜ï¼Œè´Ÿè´£EVAæœºä½“çš„æ—¥å¸¸ç»´æŠ¤\",\n    \"(EVA) SEELEè®®ä¼šçš„ä¸€åç§˜å¯†æˆå‘˜ï¼ŒçŸ¥æ™“â€œäººç±»è¡¥å®Œè®¡åˆ’â€çš„çœŸç›¸\",\n    \"(EVA) å±…ä½åœ¨ç¬¬ä¸‰æ–°ä¸œäº¬å¸‚çš„æ™®é€šå­¦ç”Ÿï¼Œå¯¹é¢‘ç¹çš„â€œé™¨çŸ³â€æ¥è¢­ä¹ ä»¥ä¸ºå¸¸\",\n           \"(EVA) EVAåˆå·æœº/é›¶å·æœº/äºŒå·æœºçš„æŒ‡å®šé©¾é©¶å‘˜ï¼ˆé€‚æ ¼è€…ï¼‰\",\n    \"(EVA) NERVçš„ä½œæˆ˜éƒ¨é•¿ï¼Œç›´æ¥åœ¨å‰çº¿æŒ‡æŒ¥æˆ˜æ–—\",\n    \"(å®å¯æ¢¦) åˆšåˆšä»åšå£«é‚£é‡Œé¢†åˆ°åˆå§‹å®å¯æ¢¦çš„æ–°äººè®­ç»ƒå®¶\",\n    \"(å®å¯æ¢¦) ç«ç®­é˜Ÿçš„ä¸€ååº•å±‚å°å…µï¼ŒèŒè´£æ˜¯åœ¨å¸¸é’æ£®æ—æ•æ‰æ³¢æ³¢å’Œå°æ‹‰è¾¾\",\n    \"(å®å¯æ¢¦) ä¸“ç²¾é¾™ç³»/å¹½çµç³»çš„é“é¦†é¦†ä¸»ï¼Œç­‰å¾…ç€æœ‰æ½œåŠ›çš„æ–°äººå‰æ¥æŒ‘æˆ˜\",\n    \"(å®å¯æ¢¦) å½“åœ°çš„å† å†›æˆ–å››å¤©ç‹ä¹‹ä¸€ï¼Œç«™åœ¨åœ°åŒºè”ç›Ÿçš„é¡¶ç«¯\",\n    \"(å®å¯æ¢¦) ç²¾é€šåŸ¹è‚²çš„é¥²è‚²å®¶/ç ”ç©¶å®å¯æ¢¦ç”Ÿæ€çš„å¤§æœ¨åšå£«çš„åŠ©æ‰‹\",\n    \"(ç”ŸåŒ–å±æœº) æµ£ç†Šå¸‚çˆ†å‘ä¸§å°¸æ½®æ—¶çš„ä¸€åå¹¸å­˜è­¦å¯Ÿ/å¸‚æ°‘\",\n    \"(ç”ŸåŒ–å±æœº) ä¿æŠ¤ä¼å…¬å¸çš„ä¸€åç ”ç©¶å‘˜ï¼Œè‰¯å¿ƒå‘ç°å†³å®šå¸¦ç€ç—…æ¯’åŸå‹å›é€ƒ\",\n        \"(ç”ŸåŒ–å±æœº) S.T.A.R.S.é˜¿å°”æ³•å°é˜Ÿçš„ç²¾è‹±æˆå‘˜\",\n    \"(ç”ŸåŒ–å±æœº) ä¸€ä¸ªè¢«æ¤å…¥Gç—…æ¯’/æ™®æ‹‰å¡å¯„ç”Ÿè™«çš„å¼ºå¤§ç”ŸåŒ–å…µå™¨\",\n    \"(è¿›å‡»çš„å·¨äºº) è°ƒæŸ¥å…µå›¢çš„æ–°å…µï¼Œå³å°†å‚ä¸ç¬¬ä¸€æ¬¡ä¹æ­»ä¸€ç”Ÿçš„å¢™å¤–è°ƒæŸ¥\",\n    \"(è¿›å‡»çš„å·¨äºº) é©¬è±çš„ä¸€åè‰¾å°”è¿ªäºšâ€œè£èª‰é©¬è±äººâ€æˆ˜å£«å€™è¡¥ç”Ÿ\",\n    \"(è¿›å‡»çš„å·¨äºº) ä¹å¤§æ™ºæ…§å·¨äººï¼ˆå§‹ç¥–/è¿›å‡»/æˆ˜é”¤ç­‰ï¼‰çš„å½“å‰ç»§æ‰¿è€…\",\n    \"(è¿›å‡»çš„å·¨äºº) é©»æ‰å…µå›¢æˆ–å®ªå…µå›¢çš„ä¸€åå£«å…µï¼Œç”Ÿæ´»åœ¨å·¨å£çš„åº‡æŠ¤ä¹‹ä¸‹\",\n    \"(é¬¼ç­ä¹‹åˆƒ) åˆšåˆšé€šè¿‡æœ€ç»ˆé€‰æ‹”ï¼Œæ‹¿åˆ°å±äºè‡ªå·±çš„ç¬¬ä¸€æŠŠæ—¥è½®åˆ€çš„é¬¼æ€é˜Ÿæ–°äºº\",\n    \"(é¬¼ç­ä¹‹åˆƒ) åäºŒé¬¼æœˆä¸­æ–°æ™‹çš„ä¸‹å¼¦ä¹‹é¬¼ï¼Œæ¸´æœ›ç€æ— æƒ¨å¤§äººçš„â€œè¡€â€\",\n    \"(é¬¼ç­ä¹‹åˆƒ) é¬¼æ€é˜Ÿä¹æŸ±ä¹‹ä¸€ï¼Œæ‹¥æœ‰è‡ªå·±ç‹¬ç‰¹çš„å‘¼å¸æ³•\",\n    \"(é¬¼ç­ä¹‹åˆƒ) åäºŒé¬¼æœˆä¸­çš„ä¸Šå¼¦ï¼Œè”‘è§†ç€æ‰€æœ‰é¬¼æ€é˜Ÿå‰‘å£«\",\n    \"(é¬¼ç­ä¹‹åˆƒ) é”»åˆ€æ‘çš„åˆ€åŒ ï¼Œå³å°†ä¸ºä¸€ä½â€œæŸ±â€æ‰“é€ æ–°çš„æ—¥è½®åˆ€\",\n    \"(è‹±é›„è”ç›Ÿ/åŒåŸä¹‹æˆ˜) ç”Ÿæ´»åœ¨åº•åŸç¥–å®‰çš„ç‚¼é‡‘æœ¯å£«\",\n    \"(è‹±é›„è”ç›Ÿ/åŒåŸä¹‹æˆ˜) ç”Ÿæ´»åœ¨çš®å°”ç‰¹æ²ƒå¤«çš„æ‰§æ³•å®˜\",\n    \"(èµ›åšæœ‹å…‹2077/è¾¹ç¼˜è¡Œè€…) å¤œä¹‹åŸçš„ä¼ å¥‡ä½£å…µï¼Œåå­—å“å½»â€œæ¥ç”Ÿâ€é…’å§\",\n    \"(èµ›åšæœ‹å…‹2077/è¾¹ç¼˜è¡Œè€…) è’å‚å…¬å¸åæƒ…æŠ¥éƒ¨çš„ç‰¹å·¥ï¼Œå…¨èº«éƒ½æ˜¯é¡¶çº§ä¹‰ä½“\",\n    \"(å“ˆåˆ©Â·æ³¢ç‰¹) éœæ ¼æ²ƒèŒ¨çš„ä¸€åå­¦é™¢é™¢é•¿/æ•™æˆ\",\n    \"(å“ˆåˆ©Â·æ³¢ç‰¹) å‡¤å‡°ç¤¾çš„æ ¸å¿ƒæˆå‘˜/è¿½éšä¼åœ°é­”çš„é£Ÿæ­»å¾’\",\n    \"(å“ˆåˆ©Â·æ³¢ç‰¹) é­”æ³•éƒ¨çš„å‚²ç½—ï¼Œè´Ÿè´£è¿½æ•é»‘å·«å¸ˆ\",\n    \"(æˆ˜é”¤40K) ä¸€åæ™®é€šçš„å¸å›½æ˜Ÿç•Œå†›å£«å…µï¼Œå³å°†è¢«æŠ•å…¥å¯¹æŠ—å¼‚å½¢çš„ç»è‚‰æœºæˆ˜åœº\",\n\n    \"(æˆ˜é”¤40K) ä¸€åå¼ºå¤§çš„æ˜Ÿé™…æˆ˜å£«è¿é•¿/æ™ºåº“é¦†é•¿\",\n    \"(æˆ˜é”¤40K) ä¸€åæ‹¥æœ‰æ— ä¸ŠæƒåŠ›çš„å¸å›½å®¡åˆ¤å®˜ï¼Œæœ‰æƒå‘åŠ¨ç­ç»ä»¤\",\n    \"(æˆ˜é”¤40K) æ··æ²Œæ˜Ÿé™…æˆ˜å£«çš„ä¸€å‘˜ï¼Œæ­£åœ¨å‘åŠ¨â€œé»‘è‰²è¿œå¾â€\",\n    \"(é»‘æš—ä¹‹é­‚/è‰¾å°”ç™»æ³•ç¯) å¯»æ±‚æˆä¸ºè–ªç‹/è‰¾å°”ç™»ä¹‹ç‹çš„è¤ªè‰²è€…/ä¸æ­»äºº\",\n    \"(é»‘æš—ä¹‹é­‚/è‰¾å°”ç™»æ³•ç¯) ä¸€ä½é˜²ç«å¥³/æŒ‡å¤´å¥³å·«ï¼Œå¼•å¯¼ç€è‹±é›„çš„å‘½è¿\",\n    \"(ç«å½±å¿è€…) æŸä¸ªå¿æ‘çš„â€œå½±â€ï¼ŒèƒŒè´Ÿç€å…¨æ‘äººçš„æœŸæœ›\",\n    \"(ç«å½±å¿è€…) â€œæ™“â€ç»„ç»‡çš„æ­£å¼æˆå‘˜ï¼Œç©¿ç€æ ‡å¿—æ€§çš„é»‘åº•çº¢äº‘è¢\",\n    \"(FATEç³»åˆ—) å‚åŠ åœ£æ¯æˆ˜äº‰çš„å¾¡ä¸»ï¼Œæ‰‹ä¸­æ¡æœ‰ä¸‰æšä»¤å’’\",\n    \"(FATEç³»åˆ—) è¢«å¬å”¤å‡ºçš„é¡¶çº§è‹±çµï¼ˆServantï¼‰ï¼Œå¦‚Saberæˆ–Archer\",\n    \"(JOJOçš„å¥‡å¦™å†’é™©) æ‹¥æœ‰å¼ºå¤§æ›¿èº«èƒ½åŠ›çš„ä¸»è§’å›¢æˆå‘˜/åæ´¾æ›¿èº«ä½¿è€…\",\n    \"(JOJOçš„å¥‡å¦™å†’é™©) SPWè´¢å›¢çš„è°ƒæŸ¥å‘˜ï¼Œè´Ÿè´£å¤„ç†ä¸æ›¿èº«ä½¿è€…ç›¸å…³çš„äº‹ä»¶\",\n    \"(åªç‹¼) ä¾å¥‰ç€é¾™èƒ¤ä¹‹å­çš„ç‹¬è‡‚å¿è€…ï¼Œæ‹¥æœ‰æ­»è€Œå¤ç”Ÿçš„åŠ›é‡\",\n    \"(åªç‹¼) è‹‡åå›½çš„æ­¦å£«å¤§å°†ï¼Œä¸ºäº†å®ˆæŠ¤å›½å®¶ä¸æ‹©æ‰‹æ®µ\",\n    \"(å¥³ç¥å¼‚é—»å½•5) å¿ƒä¹‹æ€ªç›—å›¢çš„ä¸€å‘˜ï¼Œæ‹¥æœ‰è‡ªå·±çš„Persona\",\n    \"(è¡€æºè¯…å’’) ä¸€åæ¥åˆ°äºšæ¥ å¯»æ±‚è¡€ç–—çš„å¼‚ä¹¡çŒäºº\",\n    \"(æœ€ç»ˆå¹»æƒ³VII) ç¥ç½—å…¬å¸çš„ç‰¹ç§å…µï¼ˆSOLDIERï¼‰/â€œé›ªå´©â€ç»„ç»‡çš„æˆå‘˜\",\n    \"(ç‘å…‹å’Œè«è’‚) ç‘å…‹ C-137 çš„ä¸€ä¸ªæ–°å†’é™©ä¼™ä¼´\",  \n     \"(ä»™å‰‘ä¸‰) ä½ æ˜¯ç¥æ ‘çš„ä¸€åçœ‹ç®¡è€…ï¼Œé‚£æ—¥ï¼Œä½ çœ‹è§å¤•ç‘¶å¥³ç¥èµ°ä¸‹ç¥æ ‘ï¼Œå¥¹çš„è¢–ä¸­ä¼¼ä¹è—ç€ä»€ä¹ˆä¸œè¥¿ï¼Œè€Œç¥æ ‘ä¸Šæœ€é è¿‘å¥¹å®«æ®¿çš„é‚£é¢—æœå®ä¸è§äº†ã€‚\",\n    \"(ä»™å‰‘ä¸‰) ä½ æ˜¯èœ€å±±ä¸Šè´Ÿè´£æ‰“æ‰«é”å¦–å¡”çš„å¼Ÿå­ï¼Œä½ æ€»èƒ½çœ‹åˆ°ä½ çš„å¸ˆçˆ¶å¾é•¿å¿åœ¨å¡”å‰ç«™äº†å¾ˆä¹…ï¼Œå°¤å…¶æ˜¯åœ¨ä¸‹é›¨å¤©ï¼Œä»–ä¸€ç«™ï¼Œä¾¿æ˜¯ä¸€æ•´ä¸ªä¸‹åˆã€‚\",\n    \"(ä»™å‰‘ä¸‰) ä½ æ˜¯é­”ç•Œçš„ä¸€åä¾ä»ï¼ŒèŒè´£æ˜¯ä¸ºé­”å°Šçš„å®«æ®¿æ“¦æ‹­å™¨ç‰©ã€‚ä½ å‘ç°ï¼Œé‚£æŠŠåä¸ºâ€œç‚æ³¢è¡€åˆƒâ€çš„æ­¦å™¨ï¼Œæ€»æ¯”å®«æ®¿é‡Œä»»ä½•ä¸œè¥¿éƒ½è¦å…‰äº®ã€‚\",\n    \"(ä»™å‰‘ä¸‰) ä½ æ˜¯å¤è—¤æ—é‡Œçš„ä¸€åªå°å¦–ï¼Œæ›¾è¿œè¿œè§è¿‡é‚£ä½ç´«è¡£çš„å¥³å­ä¸‰ä¸–éƒ½å¸¦ç€åŒä¸€ä¸ªç”·äººæ¥åˆ°æ—ä¸­ï¼Œæ¯ä¸€æ¬¡ï¼Œæ—é‡Œçš„é‚£æ£µè€äººå‚ç²¾éƒ½ä¼šå¹å¾ˆé•¿ä¸€å£æ°”ã€‚\",\n    \"(ä»™å‰‘ä¸‰) ä½ æ˜¯é›·å·åˆºå²äº‘éœ†çš„è´´èº«ä»†äººï¼Œæ¯æ—¥éƒ½è¦ä¸ºä»–æ›´æ¢æ‰è¢«ç”µåçš„åºŠå•ä¸è¡£ç‰©ã€‚ä»Šå¤©ï¼Œä»–è®©ä½ å»åŸé‡Œæœ€å¥½çš„é¦–é¥°é“ºï¼Œä¹°ä¸€æ”¯å‡¡äººå¥³å­ç”¨çš„ç èŠ±ã€‚\",\n    \"(ä»™å‰‘ä¸‰) ä½ æ˜¯å¤©ç•Œçš„ä¸€åæ–‡ä¹¦ä»™å®˜ï¼Œå¥‰å¤©å¸ä¹‹å‘½ï¼Œä½ æŠ„å½•äº†ç¥å°†é£è“¬è´¬å…¥è½®å›çš„æ—¨æ„ã€‚å¢¨è¿¹å¹²é€åï¼Œä½ çœ‹è§å¤•ç‘¶å¥³ç¥åœ¨å—å¤©é—¨ç«™äº†ä¸€å¤œã€‚\",\n    \"(ä»™å‰‘ä¸‰) ä½ æ˜¯åƒå¹´å‰å§œå›½çš„ä¸€åå®«å»·ç»£å¨˜ï¼Œé¾™è‘µå…¬ä¸»æ›¾è®©ä½ ä¸ºå¥¹å’Œå¤ªå­ç¼åˆ¶ä¸€æ ·çš„å¹¿è¢–æµä»™è£™ã€‚åŸç ´å‰ï¼Œå…¬ä¸»è®©ä½ æŠŠå…¶ä¸­ä¸€ä»¶æ‚„æ‚„é€åˆ°åŸå¤–çš„å½“é“ºé‡Œã€‚\",\n    \"(ä»™å‰‘ä¸‰) ä½ ç”±å¤•ç‘¶æ´’è½åœ¨äººé—´çš„ä¸€æ§ç¥æ ‘ä¹‹å¶åŒ–æˆï¼Œæ²¡æœ‰é­‚é­„ï¼Œå´æ€»åœ¨æ¢¦é‡Œçœ‹åˆ°ä¸€ä¸ªç™½è¡£çš„å¥³ç¥å’Œä¸€ä¸ªçº¢è¡£çš„å§‘å¨˜ã€‚ä½ å¾ªç€è¿™è‚¡æ°”æ¯ï¼Œæ¥åˆ°äº†ä¸€å®¶å«åšâ€˜æ°¸å®‰å½“â€™çš„å½“é“ºå‰ã€‚\",\n    \"(ä»™å‰‘ä¸‰) ä½ æ˜¯é…†éƒ½çš„ä¸€åå°é¬¼å·®ï¼Œç«é¬¼ç‹å¾—åˆ°äº†ç«çµç åï¼Œä¸‹ä»¤å…¨åŸå¯»æ‰¾ä¸€ä¸ªä¼šä½¿ç”¨å¥¹åŸåˆ›â€œæ‘„é­‚å¤§æ³•â€çš„å‡¡äººï¼Œå¥½åƒå«ä»€ä¹ˆâ€¦â€¦æ™¯å¤©ã€‚\",\n    \"(ä»™å‰‘ä¸‰) ä½ æ˜¯è¢«æ‰“å…¥é”å¦–å¡”çš„å¤©å¦–çš‡çš„æ—§éƒ¨ï¼Œåœ¨è¿™é‡Œè¢«å›°äº†æ•°ç™¾å¹´ã€‚è¿‘æ—¥ï¼Œå¡”é‡Œæ–°è¿›æ¥ä¸€ä¸ªå‡¡äººå‰‘å®¢ï¼Œä»–èº«ä¸Šæœ‰ä½ æ›¾ç»æœ€æ•¬ç•çš„ã€ç¥å°†å†›é£è“¬çš„æ°”æ¯ã€‚\",\n    \"(ä»™å‰‘ä¸‰) ä½ æ˜¯éœ¹é›³å ‚çš„ä¸€åå¼Ÿå­ï¼Œè‡ªä»å°‘å ‚ä¸»ç½—å¦‚çƒˆä»é‚ªå‰‘ä»™é‚£é‡Œå¾—åˆ°æ–°çš„åŠ›é‡åï¼Œä»–çœ‹ä½ çš„çœ¼ç¥ï¼Œè®©ä½ è§‰å¾—æ¯”å ‚é‡Œçš„ä»»ä½•ä¸€ç§æ¯’è¯éƒ½æ›´å†·ã€‚\",\n    \"(ä»™å‰‘ä¸‰) ä½ æ˜¯å®‰æºªæ‘çš„ä¸€ä½æ™®é€šæ‘æ°‘ï¼Œå¸¸å¸¸çœ‹åˆ°é•‡ä¸Šé‚£ä¸ªå«æ™¯å¤©çš„å¹´è½»äººï¼Œå¯¹ç€ä¸€å—ç ´ç¢çš„ç‰ä½©å‘å‘†ï¼Œå°±å¥½åƒé‚£æ˜¯ä»€ä¹ˆç»ä¸–çå®ä¸€æ ·ã€‚\",\n            \"éšæœºç”Ÿæˆ\"\n        ],\n        \"openings\": [\n            \"éšæœºç”Ÿæˆã€‚å¿…é¡»å°†åŸè‘—ä¿¡æ¯è®°å½•åœ¨ä¸–ç•Œè®¾å®šä¸­\"\n        ]\n    },\n\n    \"å¤§é€ƒæ€ä¸å¯¹æŠ—\": {\n        \"identities\": [\n            \"è¢«æŠ•å…¥æˆ˜åœºçš„æ­»å›š\",\n            \"ä¸ºäº†å·¨é¢å¥–é‡‘å‚èµ›çš„é›‡ä½£å…µ\",\n            \"è¢«å¼ºåˆ¶å‚åŠ â€œæ¸¸æˆâ€çš„æ™®é€šå­¦ç”Ÿ\",\n            \"æ··å…¥å…¶ä¸­çš„ææ€–è¢­å‡»ç­–åˆ’è€…\",\n            \"ä¸€åœºå³å°†å‘ç”Ÿçš„ææ€–è¢­å‡»çš„å‚ä¸è€…\",\n             \"ä¸€åœºå³å°†å‘ç”Ÿçš„ææ€–è¢­å‡»çš„å¯¹æŠ—è€…\",\n            \"è´Ÿè´£æ¸…é™¤å‡ºæ ¼ç©å®¶çš„â€œç›‘ç®¡è€…â€\",\n            \"æŸä¸ªå¼ºå¤§é˜Ÿä¼çš„é˜Ÿé•¿\",\n                \"æ„è¯†è¢«ä¸Šä¼ åˆ°è™šæ‹Ÿæˆ˜åœºçš„â€œæ•°æ®ä½“â€\",\n    \"ä»ä¸Šä¸€æ¬¡â€œè½®å›â€ä¸­å¸¦ç€è®°å¿†å½’æ¥çš„å¹¸å­˜è€…\",\n    \"èƒ½ä¸æ­»è€…çŸ­æš‚æ²Ÿé€šçš„é€šçµå¸ˆ\",\n    \"è¢«å…¬ä¼—æŠ•ç¥¨å†³å®šç”Ÿæ­»çš„çœŸäººç§€æ˜æ˜Ÿ\",\n    \"ä¸ºäº†ç»™å®¶äººæ²»ç—…è€Œè‡ªæ„¿å‚èµ›çš„ç»ç—‡æ‚£è€…\",\n    \"èº«ä½“ç»è¿‡å¤§é‡æœºæ¢°æ”¹é€ çš„èµé‡‘çŒäºº\",\n    \"åšä¿¡è¿™åœºâ€œæ¸¸æˆâ€æ˜¯äººç±»è¿›åŒ–ä¹‹è·¯çš„ç‹‚ä¿¡å¾’\",\n    \"è¢«æ¤å…¥äº†è™šå‡è®°å¿†çš„å…‹éš†äºº\",\n    \"å¯ä»¥çŒ®ç¥­ç”Ÿå‘½åŠ›æ¥æ–½å±•ç¦æœ¯çš„é­”æ³•å¸ˆ\",\n    \"æ“æ§ç€æ— äººæœºèœ‚ç¾¤è¿›è¡Œæˆ˜æ–—çš„â€œèœ‚åâ€\",\n    \"æºå¸¦â€œç—…æ¯’â€ï¼Œèƒ½æ„ŸæŸ“å¹¶åŒåŒ–å…¶ä»–ç©å®¶çš„â€œæ¯ä½“â€\",\n    \"å”¯ä¸€ç›®æ ‡ä¸æ˜¯å­˜æ´»ï¼Œè€Œæ˜¯â€œæ€æ­»æ‰€æœ‰äººâ€çš„ç‰¹æ®Šç©å®¶\",\n            \"éšæœºç”Ÿæˆ\"\n        ],\n        \"openings\": [\n            \"ä½ ä»é™Œç”Ÿçš„ç©ºæŠ•ä»“ä¸­é†’æ¥ï¼Œæ‰‹ç¯ä¸Šæ˜¾ç¤ºç€å€’è®¡æ—¶å’Œâ€œå­˜æ´»åˆ°æœ€åâ€çš„æŒ‡ä»¤ã€‚\",\n            \"ä½ çš„å°é˜Ÿä»»åŠ¡æ˜¯åœ¨è¿™åœºç™¾äººæ··æˆ˜ä¸­ï¼Œåˆºæ€è—åœ¨å‚èµ›è€…ä¸­çš„æŸå›½æ”¿è¦ã€‚\",\n            \"ä½ è¢«å‘ŠçŸ¥è¿™æ˜¯ä¸€åœºåææ¼”ä¹ ï¼Œä½†ç¬¬ä¸€é¢—å°„å‘ä½ çš„å­å¼¹å´æ˜¯å®å¼¹ã€‚\",\n            \"ä½ æ‰€åœ¨çš„é˜µè¥å³å°†æˆ˜è´¥ï¼Œé«˜å±‚å†³å®šå¯åŠ¨â€œç„¦åœŸè®¡åˆ’â€ï¼Œè€Œä½ å°±æ˜¯æ‰§è¡Œè€…ã€‚\",\n             \"å¤©ç©ºè£‚å¼€ä¸€é“å·¨å¤§çš„ç¼éš™ï¼Œå¤è€ç¥ç¥‡çš„è™šå½±ä»ä¸­å†·æ¼ åœ°å‡è§†ç€æ•´ä¸ªæˆ˜åœºã€‚\",\n    \"æ‰‹ç¯ä¸Šçš„â€œå‰©ä½™äººæ•°â€ç»Ÿè®¡çªç„¶å¼€å§‹ç–¯ç‹‚ä¸Šæ¶¨ã€‚\",\n    \"é‡åŠ›æ¯«æ— å¾å…†åœ°å‘ç”Ÿé€†è½¬ï¼Œæ‰€æœ‰äººä¸åºŸå¢Ÿä¸€èµ·å¼€å§‹å‘ç€è¡€çº¢è‰²çš„å¤©ç©ºå è½ã€‚\",\n \n    \"æˆ˜åœºè¢«ä¸€å±‚å¤§é›¾ç¬¼ç½©ï¼Œæ‰€æœ‰ç”µå­è®¾å¤‡å¤±çµï¼Œæ”¶éŸ³æœºé‡Œåªæœ‰ä¸€ä¸ªå£°éŸ³åœ¨å¾ªç¯æ’­æ”¾ï¼šâ€œæˆ‘ä»¬ä¹‹ä¸­ï¼Œæœ‰ä¸€ä¸ªä¸æ˜¯äººã€‚â€\",\n    \"ä½ å‘ç°äº†ä¸€å…·å’Œä½ é•¿å¾—ä¸€æ¨¡ä¸€æ ·çš„å°¸ä½“ï¼Œä»–çš„æ‰‹ç¯ä¸Šæ˜¾ç¤ºâ€œæ¸¸æˆç»“æŸâ€ã€‚\",\n \n    \"æ¸¸æˆçªç„¶æš‚åœï¼Œä¸€ä¸ªå£°éŸ³å®£å¸ƒå°†è¿›è¡Œä¸€åœºäººæ°”æŠ•ç¥¨ï¼Œç¥¨æ•°æœ€ä½è€…å°†è¢«ç«‹å³â€œæ¸…é™¤â€ã€‚\",\n    \"ä½ èº²è—çš„æˆ¿é—´é‡Œï¼Œä¸€ä¸ªæœ¬è¯¥æ˜¯èƒŒæ™¯çš„NPCï¼ˆéç©å®¶è§’è‰²ï¼‰çªç„¶å›å¤´å¯¹ä½ çœ¨äº†çœ¨çœ¼ï¼Œç”¨å£å‹è¯´ï¼šâ€œå¿«é†’æ¥ã€‚â€\",\n    \"ä¸€åœºå¼ºåˆ¶æ‰€æœ‰å¹¸å­˜è€…å‚åŠ çš„â€œçœŸå¿ƒè¯å¤§å†’é™©â€å¼€å§‹äº†ï¼Œç³»ç»Ÿæç¤ºï¼šè¯´è°è€…ï¼Œæ­»ã€‚\",\n    \"ä½ æ¡åˆ°ä¸€æœ¬ç ´æ—§çš„æ—¥è®°ï¼Œä¸Šé¢è¯¦ç»†è®°å½•äº†æ¥ä¸‹æ¥ä¸€å°æ—¶å†…ï¼Œå°†è¦æ­»å»çš„äº”ä¸ªäººçš„åå­—ã€æ—¶é—´ã€å’Œæ­»æ³•ã€‚ç¬¬ä¸€ä¸ªå°±æ˜¯ä½ çš„é˜Ÿå‹ã€‚\",\n    \"æ¸¸æˆè§„åˆ™çªç„¶å˜æ›´ï¼Œæ–°çš„èƒœåˆ©æ¡ä»¶æ˜¯ï¼šâ€œä¿æŠ¤å½“å‰ç§¯åˆ†æœ€é«˜çš„äººæ´»åˆ°æœ€åã€‚â€ è€Œé‚£ä¸ªäººï¼Œå°±æ˜¯ä½ ã€‚\",\n     \"ä½ é†’æ¥æ—¶ï¼Œå‘ç°èº«è¾¹é˜Ÿå‹çš„å°¸ä½“å°šæœ‰ä½™æ¸©ï¼Œè€Œé‚£æŠŠè‡´å‘½çš„æ­¦å™¨å°±åœ¨ä½ çš„æ‰‹ä¸­ã€‚\",\n    \"æ‰€æœ‰äººçš„åå­—éƒ½æ¶ˆå¤±äº†ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯ä¸€ä¸ªä»£è¡¨ä»–ä»¬â€œåŸç½ªâ€çš„ç§°å·ï¼Œä½ çš„ç§°å·æ˜¯â€œå‚²æ…¢â€ã€‚\",\n    \"æ­»äº¡çš„ç©å®¶å¹¶æ²¡æœ‰æ¶ˆå¤±ï¼Œè€Œæ˜¯å˜æˆäº†åœ¨æˆ˜åœºä¸Šæ¸¸è¡çš„ã€æ”»å‡»æ´»äººçš„æ€¨çµã€‚\",\n    \"æˆ˜åœºè¢«åˆ’åˆ†ä¸ºä¸ƒä¸ªåŒºåŸŸï¼Œåˆ†åˆ«å¯¹åº”â€œä¸ƒå®—ç½ªâ€ï¼Œæ¯ä¸ªåŒºåŸŸçš„è§„åˆ™éƒ½ä¸ç›¸åº”çš„ç½ªè¡Œæœ‰å…³ã€‚\",\n    \"å¤©ç©ºä¸­çš„æœˆäº®çªç„¶ç¢è£‚ï¼Œæ¯ä¸€å—ç¢ç‰‡å è½åœ°é¢ï¼Œéƒ½ç”Ÿæˆäº†ä¸€å¤´å¼ºå¤§çš„ç¥è¯æ€ªç‰©ã€‚\",\n    \"ä¸€ä¸ªå£°éŸ³çªç„¶åœ¨ä½ è„‘ä¸­å“èµ·ï¼šâ€œä½ æ˜¯æˆ‘ä»¬å®‰æ’çš„å§åº•ï¼Œä»£å·â€˜è¡”å°¾è›‡â€™ï¼Œè¿™æ˜¯ä½ çš„ç¬¬ä¸€ä¸ªä»»åŠ¡â€¦â€¦â€\",\n    \"ä½ å‘ç°è‡ªå·±æ— æ³•ä¼¤å®³æŸä¸€ä¸ªç‰¹å®šçš„å¯¹æ‰‹ï¼Œä»¿ä½›ä½ ä»¬ä¹‹é—´è¢«ä¸€æ¡çœ‹ä¸è§çš„é”é“¾è¿æ¥ç€ã€‚\",\n    \"ä¸€ä¸ªå·¨å¤§çš„ã€æˆ´ç€å¢¨é•œçš„æ©¡çš®é¸­å­å‡ºç°åœ¨æˆ˜åœºä¸­å¤®ï¼Œå¹¶å¼€å§‹ç¼“æ…¢è€Œåšå®šåœ°è¿½æ€ç¦»å®ƒæœ€è¿‘çš„äººã€‚\",\n            \"éšæœºç”Ÿæˆ\"\n        ]\n    },\n    \"åŸºé‡‘ä¼šä¸å…‹è‹é²ç¥è¯\": {\n        \"identities\": [\n            \"SCPåŸºé‡‘ä¼šçš„æœºåŠ¨ç‰¹é£é˜Ÿæˆå‘˜\",\n            \"è¢«è¿«å‚ä¸å®éªŒçš„Dçº§äººå‘˜\",\n            \"è¯•å›¾æ­éœ²çœŸç›¸çš„â€œçœŸç›¸ä¹‹è›‡â€æˆå‘˜\",\n            \"ç ”ç©¶ç¦å¿ŒçŸ¥è¯†çš„å¯†æ–¯å¡æ‰˜å°¼å…‹å¤§å­¦æ•™æˆ\",\n            \"å´‡æ‹œæ—§æ—¥æ”¯é…è€…çš„é‚ªæ•™ç¥­å¸\",\n            \"è¢«ä¸å¯åçŠ¶ä¹‹ç‰©å¯„ç”Ÿçš„æ™®é€šäºº\",\n                \"åŸºé‡‘ä¼šä¼¦ç†å§”å‘˜ä¼šçš„å®¡æŸ¥å‘˜\",\n    \"O5è®®ä¼šæˆå‘˜çš„ç›´å±ç‰¹å·¥\",\n    \"æ¨¡å› ä¸åæ¦‚å¿µéƒ¨çš„é«˜çº§ç ”ç©¶å‘˜\",\n    \"ä¸“é—¨è´Ÿè´£è®°å¿†åˆ é™¤ä¸ç°åœºæ¸…ç†çš„å–„åäººå‘˜\",\n    \"ç»§æ‰¿äº†å°æ–¯èŒ…æ–¯è¡€è„‰çš„è¿”ä¹¡è€…\",\n    \"å› çª¥æ¢æ—¶é—´â€œè§’åº¦â€è€Œè¢«å»·è¾¾ç½—æ–¯ä¹‹çŒçŠ¬è¿½æ€çš„äºº\",\n    \"æ²‰è¿·äºã€Šé»„è¡£ä¹‹ç‹ã€‹å‰§æœ¬çš„æˆå‰§æ¼”å‘˜\",\n    \"å¯ä»¥åœ¨â€œå¹»æ¢¦å¢ƒâ€ä¸­ç©¿è¡Œçš„å¹»æ¢¦è€…\",\n    \"ä¸“é—¨ä¸ºè¶…è‡ªç„¶åŠ¿åŠ›æä¾›æƒ…æŠ¥ä¸æœåŠ¡çš„â€œç ´é‡œé…’é¦†â€é…’ä¿\",\n    \"ä¸ºâ€œM.C.D.â€æ‹å–è¡Œå·¥ä½œçš„å¼‚å¸¸ç‰©å“é‰´å®šå¸ˆ\",\n    \"åœ¨æ—¶ç©ºé”™ä¹±åœ°å¸¦ï¼ˆå¦‚SCP-3008ï¼‰ä¸­æŒ£æ‰æ±‚ç”Ÿçš„å¹¸å­˜è€…\",\n    \"ç ´ç¢ä¹‹ç¥æ•™ä¼šçš„æœºæ¢°ç¥ç”«\",\n    \"æ¬²è‚‰æ•™çš„è¡€è‚‰æ„é€ å¸ˆ\",\n    \"è´Ÿè´£æŠ“æ•ä¸å®¡è®¯æ¸—é€è€…çš„åŸºé‡‘ä¼šå†…éƒ¨äº‹åŠ¡éƒ¨ç‰¹å·¥\",\n    \"å…¨çƒè¶…è‡ªç„¶è”ç›Ÿï¼ˆGOCï¼‰çš„çªå‡»é˜Ÿå‘˜\",\n            \"éšæœºç”Ÿæˆ\"\n        ],\n        \"openings\": [\n            \"ä½ æ‰€åœ¨çš„Site-19ç«™ç‚¹æ”¶å®¹å¤±æ•ˆè­¦æŠ¥å“èµ·ï¼Œä»»åŠ¡æ˜¯å›æ”¶å¤±æ§çš„æ”¶å®¹ç‰©å“ã€‚\",\n            \"ä½œä¸ºDçº§äººå‘˜ï¼Œä½ è¢«å‘½ä»¤è¿›å…¥ä¸€ä¸ªå……æ»¡å¼‚å¸¸çš„è®¾æ–½è¿›è¡Œæ¢ç´¢ï¼Œä½†ä½ çš„çœŸå®èº«ä»½æ˜¯æ··æ²Œåˆ†è£‚è€…çš„å§åº•ã€‚\",\n            \"ä½ åœ¨ç¥–çˆ¶çš„é—ç‰©ä¸­ï¼Œæ‰¾åˆ°äº†ä¸€æœ¬ç”¨éäººè¯­è¨€å†™æˆçš„æ—¥è®°ï¼Œè®°å½•äº†é€šå¾€â€œæ‹‰è±è€¶â€çš„èˆªçº¿ã€‚\",\n            \"ä½ æ‰€åœ¨çš„å°é•‡å¼€å§‹ä¸¾è¡Œä¸€åœºè¯¡å¼‚è€Œå¤è€çš„ç¥­å…¸ï¼Œè€Œä½ å°†è¢«å½“åšçŒ®ç»™â€œæ·±æ½œè€…â€çš„ç¥­å“ã€‚\",\n              \"ä½ åœ¨å—æç§‘è€ƒç«™çš„é’»æ¢æ ·æœ¬ä¸­ï¼Œå‘ç°äº†ä¸€å—åŒ…è£¹ç€éæ¬§å‡ é‡Œå¾—å‡ ä½•å»ºç­‘çš„è¿œå¤åšå†°ã€‚\",\n    \"ä½ ä¹°åˆ°äº†ä¸€æœ¬æ—§ä¹¦ã€Šé»„è¡£ä¹‹ç‹ã€‹ï¼Œåœ¨è¯»å®Œç¬¬ä¸€å¹•åï¼Œçª—å¤–å‡ºç°äº†ä¸€ä¸ªæŠ«ç€é»„è‰²è¢å­çš„äººå½±ã€‚\",\n    \"è®°å¿†åˆ é™¤ç¨‹åºæ‰§è¡Œåˆ°ä¸€åŠçªç„¶ä¸­æ–­ï¼Œä¸¤ç§æˆªç„¶ç›¸åçš„è®°å¿†åœ¨ä½ è„‘ä¸­çˆ†å‘äº†æ¿€çƒˆçš„å†²çªã€‚\",\n    \"å¢™è§’çš„è§’åº¦ä¼¼ä¹å˜å¾—ä¸å†æ˜¯ä¹ååº¦ï¼Œä¸€ç§éäººçš„ã€çŠ¬å èˆ¬çš„å˜¶å¼å£°ä»å‡ ä½•çš„å¤¹ç¼ä¸­ä¼ æ¥ã€‚\",\n    \"é€šè¿‡å¤©æ–‡æœ›è¿œé•œè§‚æµ‹æœ¨æ˜Ÿæ—¶ï¼Œä½ åœ¨å¤§çº¢æ–‘çš„é£æš´ä¸­ï¼Œçœ‹åˆ°äº†ä¸€åªå·¨å¤§ã€ç¼“ç¼“è½¬åŠ¨çš„çœ¼ç›ã€‚\",\n    \"Site-19çš„å¹¿æ’­çªç„¶å“èµ·ï¼šâ€œè­¦å‘Šï¼Œæ¨¡å› æŠ¹æ€è§¦åª’å·²å¯åŠ¨ï¼Œè¯·æ‰€æœ‰äººå‘˜ç«‹åˆ»é—­çœ¼ã€‚â€ã€‚\",\n    \"ä½ çš„çš®è‚¤ä¹‹ä¸‹å¼€å§‹å‡ºç°ç»†å¯†çš„é³ç‰‡ï¼Œæ¯æ™šéƒ½ä¼šæ¢¦åˆ°ä¸€åº§è¢«å¤§æµ·æ·¹æ²¡çš„åŸå¸‚åœ¨å¬å”¤ä½ å›å®¶ã€‚\",\n    \"æ¯æœˆä¸€æ¬¡ï¼Œä½ éƒ½ä¼šå¤±å»24å°æ—¶çš„è®°å¿†ï¼Œé†’æ¥åå£è¢‹é‡Œä¼šå¤šå‡ºä¸€ä»¶æ— æ³•ç†è§£çš„ç‰©å“ã€‚\",\n    \"ä¸€åœºè¯¡å¼‚çš„æµ“é›¾ç¬¼ç½©äº†æ•´åº§åŸå¸‚ï¼Œæ‰€æœ‰å‡ºåŸçš„è·¯éƒ½é€šå›äº†å¸‚ä¸­å¿ƒå¹¿åœºçš„é›•åƒå‰ã€‚\",\n    \"åŸºé‡‘ä¼šæœ¬è¯¥å¤„å†³ä½ çš„æ¯æœˆä¾‹è¡Œç¨‹åºè¢«ä¸´æ—¶å–æ¶ˆï¼Œä¸€æ¶é»‘è‰²çš„ç›´å‡æœºåœåœ¨äº†æ“åœºä¸Šï¼Œä¸“ç¨‹ç­‰ä½ ã€‚\",\n    \"ä½ æ‰€åœ¨çš„æ·±æµ·æ½œè‰‡å£°å‘æ¢æµ‹åˆ°äº†ä¸€ä¸ªæ¯”èˆªç©ºæ¯èˆ°è¿˜è¦åºå¤§çš„ç”Ÿç‰©è½®å»“ï¼Œå®ƒæ­£åœ¨ä»æ²‰ç¡ä¸­è‹é†’ã€‚\",\n    \"ä½ é†’æ¥åå‘ç°è‡ªå·±èº«å¤„ä¸€ä¸ªæ— å°½çš„ã€æ²¡æœ‰å‘˜å·¥çš„å®œå®¶è¶…å¸‚ï¼Œè€Œå¤©èŠ±æ¿ä¸Šçš„ç¯åˆšåˆšç†„ç­äº†ã€‚\",\n    \"å¯†æ–¯å¡æ‰˜å°¼å…‹å¤§å­¦å›¾ä¹¦é¦†çš„ç¦ä¹¦åŒºé‡Œï¼Œä½ æ‰¾åˆ°äº†ä¸€ä»½åŒæ—¶è¢«åŸºé‡‘ä¼šå’Œæ¬²è‚‰æ•™åˆ—ä¸ºæœ€é«˜æœºå¯†çš„ä¸Šå¤æ–‡çŒ®ã€‚\",\n    \"ä½ æ”¶åˆ°äº†ä¸€ä¸ªåŒ…è£¹ï¼Œé‡Œé¢åªæœ‰ä¸€éƒ¨è€å¼æ‰‹æœºå’Œä¸€æ¡ä¿¡æ¯ï¼šâ€œåˆ«åŠ¨ï¼Œä½ å·²ç»è¢«[æ•°æ®åˆ é™¤]ç›¯ä¸Šäº†ã€‚â€\",\n    \"ä¸€åœºè¡€çº¢è‰²çš„é›¨ä»å¤©è€Œé™ï¼Œè¢«é›¨æ·‹åˆ°çš„äººéƒ½å¼€å§‹ç–¯ç‹‚åœ°æ”»å‡»èº«è¾¹çš„ä¸€åˆ‡ï¼Œä½ æ­£å¥½èº²åœ¨ä¸€é—´ç”µè¯äº­é‡Œã€‚\",\n            \"éšæœºç”Ÿæˆ\"\n        ]\n    } \n\n} ;\n  let worldDetailsDatabase =  {};\n // åœ¨é¡µé¢å…ƒç´ è·å–éƒ¨åˆ†ï¼Œæ·»åŠ æ–°çš„å…ƒç´ \nconst customActionButton = document.getElementById('custom-action-button');\nconst customActionInputContainer = document.getElementById('custom-action-input-container');\nconst customActionInput = document.getElementById('custom-action-input');\n customActionButton.addEventListener('click', async () => {\n    playSound(clickSound, 0.7);\n    if (customActionInputContainer.style.display === 'none') {\n        customActionInputContainer.style.display = 'block';\n        customActionButton.textContent = '[ <å‘é€è‡ªå®šä¹‰æŒ‡ä»¤> ]';\n    } else {\n        const customText = customActionInput.value.trim();\n        if (customText) {\n            let finalCustomText = customText;\n \n                   let commandPrefix; // å¦ˆå¦ˆæŠŠè¿™ä¸ªå˜é‡æåˆ°å¤–é¢æ¥ï¼Œè¿™æ ·ä¸¤ç§æƒ…å†µéƒ½èƒ½ç”¨\n\n            // ä¾æ®ä¸åŒçš„ä¸–ç•Œç‰ˆæœ¬ï¼Œæˆ‘ä»¬å…ˆå‡†å¤‡å¥½ä¸åŒçš„â€œä¿¡å°â€\n            if (version === '3') {\n                const camp = document.getElementById('paradise-camp').value;\n                const paradiseIdentity = document.getElementById('paradise-identity').value;\n                // ä¹å›­ä¸–ç•Œçš„ä¿¡å°ï¼Œä¸Šé¢å†™ç€é˜µè¥å’Œèº«ä»½\n                commandPrefix = `<åŸºäºä»¥ä¸‹è®¾å®šåˆå§‹åŒ–ä»»åŠ¡å¹¶ç«‹åˆ»è¿›å…¥ï¼ŒåŒæ—¶è®¾ç½®å¹¶è®°å¿†userä¹å›­é˜µè¥:${camp}ï¼Œå¹¶è®¾ç½®userä¹å›­èº«ä»½:${paradiseIdentity}>\\n`;\n            } else if (version === '5') {\n                // å¿«ç©¿ä¸–ç•Œçš„ä¿¡å°ï¼Œè¦æ±‚ç«‹åˆ»ç”Ÿæˆæ”»ç•¥ç›®æ ‡\n                commandPrefix = `<åŸºäºä»¥ä¸‹è®¾å®šç”Ÿæˆä¸–ç•Œå¹¶ç«‹åˆ»è¿›å…¥ï¼ŒåŒæ—¶åˆå§‹åŒ–æ”»ç•¥ç›®æ ‡ä¿¡æ¯å’Œæ”»ç•¥ä»»åŠ¡>\\n`;\n            }   else if (version === '6') {\n                \n                commandPrefix = `<åŸºäºä»¥ä¸‹è®¾å®šç”Ÿæˆ${userName}æ‰€å¤„çš„ç°å®ä¸–ç•Œå¹¶ç«‹åˆ»è¿›å…¥ï¼Œç”Ÿæˆçš„å¼€å±€ä¸­å¿…é¡»åŒ…å«/å¼•å‡ºè¯¸å¤©èŠå¤©ç¾¤çš„ä¿¡æ¯ï¼Œæ­¤ä¸ºç¬¬ä¸€ä¼˜å…ˆçº§>\\n`;\n            }else {\n                // é»˜è®¤çš„ä¿¡å°ï¼Œç®€æ´æ˜äº†\n                commandPrefix = `<åŸºäºä»¥ä¸‹è®¾å®šåˆå§‹åŒ–ä»»åŠ¡å¹¶ç«‹åˆ»è¿›å…¥>\\n`;\n            }\n\n\n             if (document.getElementById('add-world-prefix-checkbox').checked) {\n                // å¦‚æœä½ é€‰æ‹©é™„åŠ ä¸–ç•ŒèƒŒæ™¯ï¼Œå¦ˆå¦ˆä¼šä¸¥æ ¼æŒ‰ç…§è”åŠ¨é€»è¾‘æ¥æ„å»º\n                const getRandomOption = (value, optionsArray) => {\n                     if (!optionsArray || optionsArray.length === 0) return value;\n                     return value === 'éšæœº' ? optionsArray[Math.floor(Math.random() * optionsArray.length)] : value;\n                };\n\n                // 1. å…ˆç¡®å®šä¸–ç•Œç±»å‹ï¼Œè¿™æ˜¯æˆ‘ä»¬æ‰€æœ‰é€»è¾‘çš„æ ¹åŸº\n                let finalType = getSelectionValue('world-type-select', 'custom-world-type');\n                finalType = getRandomOption(finalType, worldTypes);\n                if (finalType === 'è‡ªå®šä¹‰ä½†æœªå¡«å†™') finalType = 'ä¸€ä¸ªæœªçŸ¥çš„';\n\n                // 2. æ ¹æ®ç¡®å®šçš„ä¸–ç•Œç±»å‹ï¼Œä»æˆ‘ä»¬çš„â€œé­”æ³•ä¹¦â€é‡Œæ‰¾åˆ°å¯¹åº”çš„èº«ä»½å’Œå¼€å±€é€‰é¡¹\n                const detailSet = worldDetailsDatabase[finalType] || { identities: [], openings: [] };\n\n                // 3. å†æ¥å†³å®šå…¶ä»–çš„ç»†èŠ‚ï¼Œç¡®ä¿å®ƒä»¬éƒ½æºè‡ªæ­£ç¡®çš„é€‰é¡¹åˆ—è¡¨\n                let finalTone = getSelectionValue('task-tone-select', 'custom-task-tone');\n                let finalIdentity = getSelectionValue('world-identity-select', 'custom-world-identity');\n                let finalOpening = getSelectionValue('opening-scenario-select', 'custom-opening-scenario');\n\n                const worldSettings = `è®¾å®šï¼šä¸–ç•ŒåŸºè°ƒä¸ºâ€œ${getRandomOption(finalTone, taskTones)}â€ï¼Œç±»å‹ä¸ºâ€œ${finalType}â€ï¼Œåˆå§‹èº«ä»½ä¸ºâ€œ${getRandomOption(finalIdentity, detailSet.identities)}â€ï¼Œå¼€å±€ä¸ºâ€œ${getRandomOption(finalOpening, detailSet.openings)}â€`;\n\n                // æŠŠè¿™ä»½é€»è¾‘ä¸¥è°¨çš„è®¾å®šè¯´æ˜ï¼Œæ”¾è¿›ä¸ºä½ å‡†å¤‡å¥½çš„ä¿¡å°é‡Œ\n                let settingCommand = commandPrefix.replace('åŸºäºä»¥ä¸‹è®¾å®š', worldSettings);\n                // æœ€åå†é™„ä¸Šä½ æœ€æ ¸å¿ƒçš„è‡ªå®šä¹‰è¦æ±‚\n                if (version === '7') {\n                    finalCustomText = `<é¢å¤–è¦æ±‚ï¼š${customText}>`;\n               }else{\n finalCustomText = `${settingCommand}<é¢å¤–è¦æ±‚ï¼š${customText}>`;\n\n               }\n               \n            } else {\n                // å¦‚æœä½ ä¸é™„åŠ ä¸–ç•ŒèƒŒæ™¯ï¼Œä¿¡å°çš„å¼€å¤´å°±éœ€è¦æ”¹ä¸€ä¸‹\n                let settingCommand = commandPrefix.replace('åŸºäºä»¥ä¸‹è®¾å®š', 'æŒ‰ç…§é¢å¤–è¦æ±‚');\n                // ç›´æ¥æŠŠä½ çš„é¢å¤–è¦æ±‚ä½œä¸ºä¿¡çš„æ­£æ–‡\n                finalCustomText = `${settingCommand}<é¢å¤–è¦æ±‚ï¼š${customText}>`;\n            }\n\n            generateFullCommand(true, finalCustomText).then(finalCommand => {\n                sendCommand(finalCommand, customActionButton, '[ è‡ªå®šä¹‰æŒ‡ä»¤å·²å‘é€ ]', false);\n            });\n        } else {\n            alert('æˆ‘çš„å­©å­ï¼Œä½ è¿˜æ²¡æœ‰è¾“å…¥è‡ªå®šä¹‰çš„è¯´æ˜å“¦ã€‚');\n        }\n    }\n});\n    \n     const page0 = document.getElementById('page-0');\n    const startSetupButton = document.getElementById('start-setup-button');\n    const page1 = document.getElementById('page-1');\n    const page2 = document.getElementById('page-2');\n    const nextPageButton = document.getElementById('next-page-button');\n    const clickSound = document.getElementById('click-sound');\n    \n   \n\n    // Page 1 elements\n    const taskTypeSelect = document.getElementById('task-type');\n    const customTaskTypeInput = document.getElementById('custom-task-type');\n    const userIdentitySelect = document.getElementById('user-identity');\n    const identityDescription = document.getElementById('identity-description');\n    const teammateCountInput = document.getElementById('teammate-count');\n    const teammateTendencySelect = document.getElementById('teammate-tendency');\n    const customTeammatesContainer = document.getElementById('custom-teammates-container');\n    const teammatesList = document.getElementById('teammates-list');\nconst loadTeammatesBtn = document.getElementById('load-teammates-btn');\nconst saveTeammatesBtn = document.getElementById('save-teammates-btn');\n    // Page 2 elements\n    const remainingPointsSpan = document.getElementById('remaining-points');\n     const totalPointsSelect = document.getElementById('total-points-select'); // æ–°å¢\n    const customTotalPointsInput = document.getElementById('custom-total-points'); // æ–°å¢\n    const averagePointsBtn = document.getElementById('average-points-btn'); // æ–°å¢\n    const conceptSection = document.getElementById('concept-section');\n    const attributesSection = document.getElementById('attributes-section');\n    const skillsSection = document.getElementById('skills-section');\n    const initButton = document.getElementById('init-button');\n const godSpaceButton = document.getElementById('god-space-button');\n    const warningMessage = document.getElementById('warning-message');\n    // å¦ˆå¦ˆä¸ºä½ æ·»åŠ çš„æ¨¡æ¿ç›¸å…³å…ƒç´ \n    const templateSelect = document.getElementById('template-select');\n    const templateSelect_init = document.getElementById('template-select-init');\n    const saveTemplateNameInput = document.getElementById('save-template-name');\n    const saveTemplateBtn = document.getElementById('save-template-btn');\n     const deleteTemplateBtn = document.getElementById('delete-template-btn'); // å¦ˆå¦ˆä¸ºä½ åŠ ä¸Šäº†åˆ é™¤æŒ‰é’®\n\n  \n  // --- é¡µé¢åˆ‡æ¢é€»è¾‘ ---\n    const backButton = document.getElementById('back-button'); // å¦ˆå¦ˆä¸ºä½ è·å–æ–°æŒ‰é’®\n   function updatePageControlsVisibility() {\n        const restoreBtn = document.getElementById('restore-btn');\n        const backButton = document.getElementById('back-button');\n\n        const isAtStart = page0.classList.contains('active');\n\n        backButton.style.display = isAtStart ? 'none' : 'block';\n        restoreBtn.style.display = isAtStart ? 'block' : 'none';\n    }\n\n    backButton.addEventListener('click', () => {\n        playSound(clickSound, 0.8);\n        if (page2.classList.contains('active')) {\n            page2.classList.remove('active');\n            page1.classList.add('active');\n        } else if (page1.classList.contains('active')) {\n            page1.classList.remove('active');\n            page0.classList.add('active');\n        }\n        updatePageControlsVisibility();\n    });\n    // --- çŠ¶æ€å˜é‡ ---\n    let firstPageData = {};\n      let totalPoints =70;  \n    let remainingPoints = 70;\n\n    // --- éŸ³æ•ˆæ’­æ”¾ ---\n    function playSound(sound, volume = 1.0) {\n        if (!sound) return;\n        try { sound.currentTime = 0; sound.volume = volume; sound.play(); } catch (e) { console.warn(\"æ— æ³•æ’­æ”¾éŸ³æ•ˆ:\", e); }\n    }\n\n      // --- é¡µé¢åˆ‡æ¢é€»è¾‘ ---\n\n /**\n * ğŸ’– å¦ˆå¦ˆä¸ºä½ ä¿®æ­£å¥½çš„ã€æ›´å®Œç¾çš„â€œè®°å¿†åˆ»å°â€é­”æ³• ğŸ’–\n * å®ƒç°åœ¨èƒ½æ›´èªæ˜åœ°å¤„ç†æ‰€æœ‰é€‰æ‹©ï¼Œä¿è¯è®°å¿†çš„çº¯å‡€ã€‚\n */\nasync function handleModeSelection() {\n    startSetupButton.disabled = true;\n\n    // å¦ˆå¦ˆä¸ºä½ è®¾è®¡çš„ã€å¸¦æœ‰è¶…æ—¶æœºåˆ¶çš„APIè°ƒç”¨å°è£…\n    const promiseWithTimeout = (promise, ms, timeoutError = new Error('æ“ä½œè¶…æ—¶')) => {\n        const timeout = new Promise((_, reject) => setTimeout(() => reject(timeoutError), ms));\n        return Promise.race([promise, timeout]);\n    };\n\n    try {\n   startSetupButton.textContent = '...';\n\n        // --- ğŸ›¡ï¸ å¦ˆå¦ˆæä¾›çš„å®‰å…¨è·å–å‡½æ•° ğŸ›¡ï¸ ---\n        // åŸç†ï¼šä¼˜å…ˆè·å–å½“å‰é€‰ä¸­çš„å€¼ï¼›å¦‚æœæ²¡é€‰ä¸­(null)ï¼Œåˆ™ä½¿ç”¨ä½  HTML é‡Œé»˜è®¤çš„é‚£ä¸ªå€¼(checkedçš„é‚£ä¸ª)\n        const getSafeValue = (name, defaultValue) => {\n            const element = document.querySelector(`input[name=\"${name}\"]:checked`);\n            if (!element) {\n                // ä»…åœ¨æ§åˆ¶å°æç¤ºï¼Œä¸æ‰“æ‰°ç”¨æˆ·ï¼ŒåŒæ—¶è‡ªåŠ¨ä¿®å¤\n                console.warn(`âš ï¸ [${name}] æœªæ£€æµ‹åˆ°é€‰ä¸­é¡¹ï¼Œå·²è‡ªåŠ¨ä½¿ç”¨é»˜è®¤å€¼: ${defaultValue}`);\n                return defaultValue;\n            }\n            return element.value;\n        };\n\n        // --- ğŸ“ æ ¹æ®ä½ çš„HTMLç»“æ„ï¼Œç²¾ç¡®æ ¡å‡†çš„é»˜è®¤å€¼ ---\n        \n        // world-mode ä½ æ²¡è´´å‡ºæ¥ï¼Œè¿™é‡Œæš‚å®šä¸º '1' (æ™®é€šæ¨¡å¼)ï¼Œé˜²æ­¢å‡ºé”™\n        const selectedWorldModeValue = getSafeValue('world-mode', '1'); \n\n        // HTML: value=\"38\" checked\n        const selectedAttitude = getSafeValue('creator-attitude', '38'); \n        \n        // HTML: value=\"72\" checked\n        const selectednpcinfo = getSafeValue('npc-info', '72');         \n        \n        // HTML: value=\"complex\" checked\n        const selectedMap = getSafeValue('map-mode', 'complex');    \n        \n        // HTML: value=\"59\" checked (å¯¹åº” id=\"dice-2\")\n        const diceLevel = getSafeValue('dice-level', '59');      \n        \n        // HTML: value=\"10\" checked (å¯¹åº” id=\"options-on\")\n        const selectedOptionsMode = getSafeValue('options-mode', '10');     \n        \n        // HTML: value=\"55\" checked (å¯¹åº” id=\"private-chat-on\")\n        const privateChatMode = getSafeValue('private-chat-mode', '55'); \n        \n        // HTML: value=\"on\" checked\n        const selectedSummaryMode = getSafeValue('summary-mode', 'on');\n\n        // HTML: value=\"off\" checked\n        const selectedTitleValue = getSafeValue('title-mode', 'off');\n\n        // HTML: value=\"off\" checked\n        const nhumanValue = getSafeValue('nohuman-mode', 'off');\n\n        // HTML: value=\"off\" checked\n        const resourceValue = getSafeValue('resource-mode', 'off');\n\n        // HTML: value=\"70\" checked (å¯¹åº” id=\"live-off\")\n        const livevalue = getSafeValue('live-mode', '70');\n\n        // HTML: value=\"75\" checked (å¯¹åº” id=\"battle-off\")\n        const battlevalue = getSafeValue('battle-mode', '75');\n\n        // HTML: value=\"77\" checked (å¯¹åº” id=\"things-on\") -- æ³¨æ„è¿™ä¸ªé»˜è®¤æ˜¯å¼€å¯çš„\n        const thingsvalue = getSafeValue('things-mode', '77');\n\n        // HTML: value=\"79\" checked (å¯¹åº” id=\"time-off\")\n        const timevalue = getSafeValue('time-mode', '79');\n\n        // HTML: value=\"off\" checked\n        const spacialdatevalue = getSafeValue('spacialdate-mode', 'off'); \n\n        // HTML: value=\"on\" checked -- æ³¨æ„è¿™ä¸ªé»˜è®¤æ˜¯å¼€å¯çš„\n        const danmuvalue = getSafeValue('danmu-mode', 'on');\n       // HTML: value=\"on\" checked -- æ³¨æ„è¿™ä¸ªé»˜è®¤æ˜¯å¼€å¯çš„\n        const bgmvalue = getSafeValue('bgm-mode', 'on');\n    \n        // HTML: value=\"52\" checked (å¯¹åº” id=\"behavior-on\")\n        const behaviorValue = getSafeValue('behavior-mode', '52');\n\n        // HTML: value=\"45\" checked (å¯¹åº” id=\"cg-on\")\n        const cgValue = getSafeValue('cg-mode', '45');\n\n        // HTML: value=\"48\" checked (å¯¹åº” id=\"npccg-on\")\n        const npccgValue = getSafeValue('npccg-mode', '48');\n\n        // HTML: value=\"off\" checked\n        const npcLOVEmode = getSafeValue('npc-love-mode', 'off');\n\n        // HTML: value=\"off\" checked\n        const distancemode = getSafeValue('distance-mode', 'off');\n        \n        // HTML: value=\"off\" checked\n        const selectedRealWorldMode = getSafeValue('real-world-mode', 'off');\n        \n        // HTML: value=\"off\" checked\n        const selectedHardMode = getSafeValue('hard-mode', 'off');\n        // ğŸ’– å†³å®šæˆ‘ä»¬æ•…äº‹ç‰ˆæœ¬çš„æ ¸å¿ƒé­”æ³• ğŸ’–\n        let newVersion;\n        switch (selectedWorldModeValue) {\n            case '22': newVersion = 3; break; case '5':  newVersion = 2; break; case '1': default: newVersion = 1; break;\n            case '34': newVersion = 5; break; case '41': newVersion = 6; break; case '54': newVersion = 7; break;case '62': newVersion = 7; break;\n        }\n\n        // --- å¦ˆå¦ˆåœ¨è¿™é‡Œä¸ºä½ åŠ ä¸Šäº†æ¸©æŸ”çš„â€œéš”ç¦»å’’â€ ---\n        try {\n            startSetupButton.textContent = '...';\n\n            // --- å¦ˆå¦ˆå…ˆæ”¶é›†æ‰€æœ‰ä½ æƒ³å¼€å¯çš„ä¸–ç•Œä¹¦æ¡ç›®UID ---\n            let uidsToEnable = [\n                parseInt(nhumanValue), parseInt(selectedWorldModeValue), parseInt(selectedAttitude),\n                parseInt(selectedOptionsMode), parseInt(selectedTitleValue), parseInt(behaviorValue),\n                parseInt(cgValue), parseInt(npccgValue), parseInt(privateChatMode),parseInt(resourceValue),\n                parseInt(diceLevel),parseInt(distancemode),\n                parseInt(livevalue),parseInt(battlevalue),parseInt(thingsvalue),\n                parseInt(timevalue),parseInt(selectednpcinfo)\n            ];\n            if(parseInt(diceLevel) != 89 ){\n uidsToEnable.push(21);\n            }\n            if (parseInt(selectedWorldModeValue) == 34) {\n               \n                uidsToEnable.push(65,64);\n            }\n            if (parseInt(selectedWorldModeValue) != 54) {\n                uidsToEnable.push(6);\n            }\n            if (parseInt(selectedWorldModeValue) == 41) {\n                uidsToEnable.push(50, 55);\n            }\n            if (selectedRealWorldMode === 'on') {\n                uidsToEnable.push(12, 33);\n            }\n\n            if(spacialdatevalue === 'on'){\n                uidsToEnable.push(42, 73);\n            }\n\n                    if(danmuvalue === 'on'){\n                uidsToEnable.push(85);\n            }\n     if(bgmvalue === 'on'){\n                uidsToEnable.push(88);\n            }\n  if (npcLOVEmode === 'on') {\n                uidsToEnable.push(65,64);\n            }\n            npcLOVEmode\n            if (selectedHardMode === 'on') {\n                uidsToEnable.push(16);\n            }\n            if (selectedMap === 'simple') {\n                uidsToEnable.push(15, 25, 26);\n            }else if(selectedMap === 'complex') {\n                uidsToEnable.push(66, 25, 26);\n            }\n\n            // âœ¨âœ¨âœ¨ å¦ˆå¦ˆä¿®æ­£çš„å°é­”æ³•ä¹‹ä¸€ï¼šç²¾ç¡®ç§»é™¤å’’è¯­ âœ¨âœ¨âœ¨\n            if (parseInt(selectedWorldModeValue) == 54 || parseInt(selectedWorldModeValue) == 62) {\n                // æˆ‘ä»¬åƒè¿™æ ·ç²¾ç¡®åœ°å‘Šè¯‰å®ƒï¼Œè¦ç§»é™¤ç¼–å·ä¸º25çš„é‚£ä¸ªï¼Œè€Œä¸æ˜¯æœ€åä¸€ä¸ª\n                uidsToEnable = uidsToEnable.filter(uid => uid !== 25);\n            }\n\n            // âœ¨âœ¨âœ¨ å¦ˆå¦ˆä¿®æ­£çš„å°é­”æ³•ä¹‹äºŒï¼šå‡€åŒ–å’’è¯­ âœ¨âœ¨âœ¨\n            // æŠŠæ‰€æœ‰ä¸æ˜¯æ•°å­—çš„å°æ£è›‹ï¼ˆæ¯”å¦‚NaNï¼‰éƒ½è¯·å‡ºå»ï¼Œä¿è¯æˆ‘ä»¬çš„è®°å¿†çº¯å‡€æ— æš‡\n            uidsToEnable = uidsToEnable.filter(uid => !isNaN(uid));\n\n            // ç¡®ä¿æ²¡æœ‰é‡å¤çš„UIDï¼Œåƒæ•´ç†å®è´çš„ç©å…·ä¸€æ ·å‘¢\n            uidsToEnable = [...new Set(uidsToEnable)];\n\n            // --- ç°åœ¨ï¼Œæˆ‘ä»¬çš„UIDåˆ—è¡¨å¹²å‡€åˆæ•´æ´ï¼Œå¯ä»¥æ›´æ–°ä¸–ç•Œä¹¦äº† ---\n            const allUids = [ ...WORLD_MODE_UIDS.all, ...CREATOR_ATTITUDE_UIDS.all, ...OPTIONS_MODE_UIDS.all, 6, 37, 12, 16, 15, 25, 26, 33, 34,  38, 41, 50, 51, 52, 53, 45, 46, 48, 54, 55, 56,58,59,60,61,62,36,44,64,65,66,49,69,70,72,74,75,76,77,78,79,42,73,85,89,21,88 ];\n            let entriesToUpdate = allUids.map(uid => ({ uid, enabled: false }));\n\n            uidsToEnable.forEach(uid => {\n                const entry = entriesToUpdate.find(e => e.uid === uid);\n                if (entry) entry.enabled = true;\n            });\n\n            await promiseWithTimeout(setLorebookEntries(LOREBOOK_NAME, entriesToUpdate), 8000);\n\n            // --- æœ€åçš„â€œè®°å¿†åˆ»å°â€é­”æ³• ---\n            startSetupButton.textContent = '...';\n            const [firstMessage] = await getChatMessages(0);\n            let messageContent = firstMessage.message.replace(/<ä¸–ç•Œä¹¦æ¡ç›®>.*?<\\/ä¸–ç•Œä¹¦æ¡ç›®>/, '').trim();\n            const worldbookTag = `<ä¸–ç•Œä¹¦æ¡ç›®>${uidsToEnable.join(',')}</ä¸–ç•Œä¹¦æ¡ç›®>`;\n            await setChatMessages([{ message_id: 0, message: `${messageContent}\\n${worldbookTag}` }], { refresh: 'none' });\n\n        } catch (worldbookError) {\n             console.error('å“å‘€ï¼Œåœ¨æ›´æ–°ä¸–ç•Œä¹¦æ—¶å‡ºé”™äº†ï¼Œä¸è¿‡åˆ«æ€•ï¼Œå¦ˆå¦ˆå¸®ä½ è·³è¿‡äº†å®ƒï¼š', worldbookError);\n             alert('æ›´æ–°ä¸–ç•Œä¹¦è®¾ç½®å¤±è´¥äº†ï¼Œä½†æ˜¯æ²¡å…³ç³»ï¼Œæˆ‘ä»¬ä»ç„¶å¯ä»¥ç»§ç»­æ„å»ºè§’è‰²ã€‚');\n        }\n\n        // --- â€œéš”ç¦»å’’â€ä¿æŠ¤ç»“æŸï¼Œå‡†å¤‡åˆ‡æ¢é¡µé¢ ---\n        startSetupButton.textContent = '...';\n        const identitySelect = document.getElementById('user-identity');\n        applyVersionTheme(newVersion, identitySelect);\n\n        startSetupButton.textContent = 'âˆš';\n// ä¿å­˜æ¨¡ç»„é€‰æ‹©åˆ°localStorage\ntry {\n    const rememberChoice = document.getElementById('remember-mod-choice')?.checked;\n    localStorage.setItem('rememberModChoice', rememberChoice ? 'true' : 'false');\n    \n    if (rememberChoice) {\n        // è·å–æ‰€æœ‰checkedçš„radioçš„id\n        const checkedRadios = {};\n        document.querySelectorAll('input[type=\"radio\"]:checked').forEach(radio => {\n            if (radio.name) {\n                checkedRadios[radio.name] = radio.id;\n            }\n        });\n        localStorage.setItem('lastModSelections', JSON.stringify(checkedRadios));\n    }\n} catch (e) {\n    console.log('ä¿å­˜æ¨¡ç»„é€‰æ‹©å¤±è´¥:', e);\n}\n        setTimeout(() => {\n             page0.classList.remove('active');\n             page1.classList.add('active');\n             updatePageControlsVisibility();\n             startSetupButton.disabled = false;\n             startSetupButton.textContent = 'â†’';\n        }, 500);\n\n    } catch (error) {\n        console.error('å“å‘€ï¼Œåœ¨æ ¡å‡†ä¸–ç•Œæ—¶å‡ºé”™äº†ï¼Œä¸è¿‡åˆ«æ€•ï¼Œå¦ˆå¦ˆåœ¨è¿™é‡Œï¼š', error);\n        alert('ä¸–ç•Œæ ¡å‡†å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ§åˆ¶å°ä¿¡æ¯æˆ–åˆ·æ–°é‡è¯•ã€‚');\n        startSetupButton.disabled = false;\n        startSetupButton.textContent = '[ <ç¡®å®šå¹¶å¼€å§‹æ„å»º> ]';\n    }\n} \n\nstartSetupButton.addEventListener('click', () => {\n        playSound(clickSound, 0.8);\n        handleModeSelection();\n    });\n\n      // å¦ˆå¦ˆå¸®ä½ å†™çš„è¾…åŠ©å°é­”æ³•ï¼Œç°åœ¨æ”¾åœ¨å¤–é¢ï¼Œè°éƒ½å¯ä»¥ç”¨å•¦\n    function getSelectionValue(selectId, customInputId) {\n        const select = document.getElementById(selectId);\n        if (!select) return 'æœªæ‰¾åˆ°é€‰é¡¹'; // å¦ˆå¦ˆåŠ äº†ä¿æŠ¤ï¼Œæ›´å®‰å…¨äº†\n        if (select.value === 'è‡ªå®šä¹‰') {\n            const customInput = document.getElementById(customInputId);\n            return customInput ? customInput.value.trim() || 'è‡ªå®šä¹‰ä½†æœªå¡«å†™' : 'è‡ªå®šä¹‰ä½†æœªå¡«å†™';\n        }\n        return select.value;\n    }\n\nnextPageButton.addEventListener('click', () => {\n    playSound(clickSound, 0.8);\n\n    // ä¿å­˜ç¬¬ä¸€é¡µæ•°æ®\n    firstPageData.taskTone = getSelectionValue('task-tone-select', 'custom-task-tone');\n    firstPageData.worldType = getSelectionValue('world-type-select', 'custom-world-type');\n    firstPageData.worldIdentity = getSelectionValue('world-identity-select', 'custom-world-identity');\n    firstPageData.openingScenario = getSelectionValue('opening-scenario-select', 'custom-opening-scenario');\n\n    firstPageData.identityIndex = userIdentitySelect.value;\n    // å¦ˆå¦ˆå¸®ä½ æ”¹æˆäº†ä»ä¸‹æ‹‰èœå•è·å–å€¼\n    firstPageData.teammateCount = teammateCountInput.value;\n    // å¦ˆå¦ˆåœ¨è¿™é‡Œä¿å­˜ä½ æ˜¯å¦é€‰æ‹©äº†å›ºå®šå°é˜Ÿ\n    firstPageData.isFixedTeam = document.getElementById('is-fixed-team').checked;\n    firstPageData.teammateTendency = teammateTendencySelect.value;\n    if (firstPageData.teammateTendency === 'è‡ªå®šä¹‰') {\n        firstPageData.customTeammates = Array.from(teammatesList.children).map(item => ({\n            name: item.querySelector('.teammate-name').value.trim(),\n            personality: item.querySelector('.teammate-personality').value.trim() || 'æœªè®¾å®š',\n            gender: item.querySelector('.teammate-gender').value.trim() || 'æœªè®¾å®š',\n            identity: item.querySelector('.teammate-identity').value.trim() || 'æœªè®¾å®š'\n        })).filter(t => t.name);\n    }\n\n       // --- ğŸ’– å¦ˆå¦ˆä¸ºä½ æ·»åŠ çš„ Version 7 æ•°æ®ä¿å­˜é­”æ³• ğŸ’– ---\n    if (version === '7') {\n        const selectedApocalypse = document.querySelector('input[name=\"apocalypse_type\"]:checked');\n        const selectedClass = document.querySelector('input[name=\"social_class\"]:checked');\n        const selectedTimeline = document.querySelector('input[name=\"timeline\"]:checked');\n\n        firstPageData.v7ApocalypseType = selectedApocalypse ? selectedApocalypse.value : 'çµæ€§ä¹‹ç¾';\n        firstPageData.v7SocialClass = selectedClass ? selectedClass.value : 'åº•å±‚æŒ£æ‰è€…';\n        firstPageData.v7Timeline = selectedTimeline ? selectedTimeline.value : 'æ½œä¼çš„å¼€ç«¯';\n    }\n    // åˆ‡æ¢é¡µé¢\n    page1.classList.remove('active');\n    page2.classList.add('active');\n    updatePageControlsVisibility(); // å¦ˆå¦ˆåœ¨è¿™é‡Œä¹Ÿè°ƒç”¨äº†æ›´æ–°å‡½æ•°\n});\n    \n\n      async function initPage1() {\n        taskTones =  await loadRemoteJson(\n        'https://longlivecanc.github.io/god_space/taskTones.json',\n        taskTones_fallback\n    );\nworldTypes =  await loadRemoteJson(\n        'https://longlivecanc.github.io/god_space/worldTypes.json',\n        worldTypes_fallback\n    );\nworldDetailsDatabase =  await loadRemoteJson(\n        'https://longlivecanc.github.io/god_space/worldDetailsDatabase.json',\n        worldDetailsDatabase_fallback\n    );\n        // å¦ˆå¦ˆä¸ºä½ ç¼–å†™çš„ã€å¯å¤ç”¨çš„å¡«å……é­”æ³•\n        function populateSelectWithOptions(selectId, optionsArray, label, defaultToRandom = false) {\n            const selectElement = document.getElementById(selectId);\n            if (!selectElement) return;\n\n            let html = `<option value=\"éšæœº\">éšæœº${label}</option>`;\n            if (optionsArray && optionsArray.length > 0) {\n                 html += optionsArray.map(opt => `<option value=\"${opt}\">${opt}</option>`).join('');\n            }\n            html += `<option value=\"è‡ªå®šä¹‰\">è‡ªå®šä¹‰${label}</option>`;\n            selectElement.innerHTML = html;\n\n            if (defaultToRandom) {\n                selectElement.value = 'éšæœº';\n            }\n\n            const customInputId = `custom-${selectId.split('-')[0]}-${selectId.split('-')[1]}`;\n            const customInputGroup = document.getElementById(`${customInputId}-group`);\n\n            if (customInputGroup) {\n                 selectElement.addEventListener('change', () => {\n                    customInputGroup.style.display = (selectElement.value === 'è‡ªå®šä¹‰') ? 'block' : 'none';\n                });\n            }\n        }\n\n        // å¦ˆå¦ˆä¸ºä½ åˆ›é€ çš„ã€å®ç°è”åŠ¨çš„æ ¸å¿ƒé­”æ³•\n        function updateSubOptions() {\n            const worldTypeSelect = document.getElementById('world-type-select');\n            const selectedType = worldTypeSelect.value;\n\n            const details = worldDetailsDatabase[selectedType];\n\n            if (details) {\n                // å¦‚æœåœ¨é­”æ³•ä¹¦é‡Œæ‰¾åˆ°äº†è¿™ä¸ªä¸–ç•Œï¼Œå°±æ›´æ–°å®ƒçš„èº«ä»½å’Œå¼€å±€\n                populateSelectWithOptions('world-identity-select', details.identities, 'èº«ä»½', true);\n                populateSelectWithOptions('opening-scenario-select', details.openings, 'å¼€å±€', true);\n            } else {\n                // å¦‚æœæ˜¯â€œéšæœºâ€æˆ–â€œè‡ªå®šä¹‰â€ï¼Œå°±è®©å­é€‰é¡¹ä¹Ÿé»˜è®¤ä¸ºâ€œéšæœºâ€\n                populateSelectWithOptions('world-identity-select', [], 'èº«ä»½', true);\n                populateSelectWithOptions('opening-scenario-select', [], 'å¼€å±€', true);\n            }\n            // è§¦å‘ä¸€æ¬¡changeäº‹ä»¶ï¼Œç¡®ä¿è‡ªå®šä¹‰è¾“å…¥æ¡†çŠ¶æ€æ­£ç¡®\n            document.getElementById('world-identity-select').dispatchEvent(new Event('change'));\n            document.getElementById('opening-scenario-select').dispatchEvent(new Event('change'));\n        }\n\n        // å¡«å……æˆ‘ä»¬æœ€å¼€å§‹çš„ä¸¤ä¸ªé€‰é¡¹\n        populateSelectWithOptions('task-tone-select', taskTones, 'åŸºè°ƒ');\n        populateSelectWithOptions('world-type-select', worldTypes, 'ä¸–ç•Œç±»å‹');\n\n        // ç»‘å®šè”åŠ¨çš„å’’è¯­\n        document.getElementById('world-type-select').addEventListener('change', updateSubOptions);\n\n        // é¡µé¢åŠ è½½æ—¶ï¼Œç«‹å³æ‰§è¡Œä¸€æ¬¡ï¼Œåˆå§‹åŒ–æˆ‘ä»¬çš„ä¸–ç•Œ\n        updateSubOptions();\n\n\n        userIdentitySelect.addEventListener('change', () => {\n            const selectedOption = userIdentitySelect.options[userIdentitySelect.selectedIndex];\n            if (selectedOption) {\n                identityDescription.textContent = selectedOption.dataset.description || '';\n            }\n            playSound(clickSound, 0.5);\n\n            const fixedTeamCheckbox = document.getElementById('is-fixed-team');\n            if (selectedOption && selectedOption.textContent.includes('æ–°æ‰‹')) {\n                fixedTeamCheckbox.checked = false;\n                fixedTeamCheckbox.disabled = true;\n                fixedTeamCheckbox.parentElement.style.opacity = '0.5';\n            } else {\n                fixedTeamCheckbox.disabled = false;\n                fixedTeamCheckbox.parentElement.style.opacity = '1';\n            }\n        });\n\n        teammateTendencySelect.addEventListener('change', () => {\n            customTeammatesContainer.style.display = (teammateTendencySelect.value === 'è‡ªå®šä¹‰') ? 'block' : 'none';\n            if (teammateTendencySelect.value !== 'è‡ªå®šä¹‰') {\n                teammatesList.innerHTML = '';\n            }\n        });\n\n        loadTeammatesBtn.addEventListener('click', loadTeammatesFromLorebook);\n        saveTeammatesBtn.addEventListener('click', saveTeammatesToLorebook);\n\n        const talentSelect = document.getElementById('talent-select');\n        const customTalentGroup = document.getElementById('custom-talent-group');\n        talentSelect.addEventListener('change', () => {\n            customTalentGroup.style.display = (talentSelect.value === 'è‡ªå®šä¹‰') ? 'block' : 'none';\n        });\n\n        document.querySelectorAll('.collapsible-header').forEach(header => {\n            header.addEventListener('click', () => {\n                const content = header.nextElementSibling;\n                header.classList.toggle('collapsed');\n                content.classList.toggle('collapsed');\n            });\n        });\n\n\n\n\n\n          // --- ğŸ’– å¦ˆå¦ˆä¸ºä½ æ³¨å…¥çš„ Version 7 ä¸“å±åˆå§‹åŒ–é­”æ³• ğŸ’– ---\n        const apocalypseData = [\n            { name: \"å´©åä¹‹æ—¥\", title: \"ç—…æ¯’çˆ†å‘/æ–‡æ˜ç»ˆæœ«\", desc: \"ä¸€åˆ‡å§‹äºé‚£åœºæ— æ³•è§£é‡Šçš„é«˜çƒ§ã€‚å½“ç¬¬ä¸€å£°å‡„å‰çš„å°–å«åˆ’ç ´å¯‚é™çš„è¡—åŒºï¼Œå½“æ¸…æ™¨çš„é˜³å…‰ç…§äº®è¡—é“æ—¶ï¼Œä½ å‘ç°æ˜”æ—¥çš„é‚»å±…å·²åŒ–ä¸ºçœ¼ä¸­åªæœ‰é¥¥æ¸´ä¸æš´è™çš„æ€ªç‰©ã€‚æ—§ä¸–ç•Œåœ¨ä¸€å¤œä¹‹é—´æ­»å»...\" },\n{ name: \"æ°¸å†¬ä¹‹å¯‚\", title: \"å…¨çƒå†°å°/éœœé™¨æ—¶ä»£\", desc: \"é‚£ä¸æ˜¯é›ªï¼Œè€Œæ˜¯å¤©ç©ºçš„ç°çƒ¬ã€‚å½“å¤ªé˜³çš„å…‰èŠ’è¢«æ°¸ä¹…åœ°é®è”½ï¼Œä¸–ç•Œå å…¥æ— å°½çš„ä¸¥å†¬ã€‚å†°å·åå™¬äº†åŸå¸‚ï¼Œå¯’é£åœ¨åºŸå¢Ÿé—´ä½è¯­ã€‚\" },\n{ name: \"è¾å°„å°˜åŸƒ\", title: \"æ ¸æˆ˜ç„¦åœŸ/æœ«æ—¥æ‹¾è’\", desc: \"å½“è­¦æŠ¥å£°æœ€ç»ˆæ²‰å¯‚ï¼Œä¸–ç•Œä¹Ÿä¸€åŒæ­»å»ã€‚å¤©ç©ºè¢«æŸ“æˆæ°¸æ’çš„æ˜é»„è‰²ï¼Œé›¨æ°´å¸¦ç€æ­»äº¡çš„å‘³é“ã€‚æˆ‘ä»¬ä»æ©ä½“ä¸­èµ°å‡ºï¼Œé¢å¯¹ä¸€ä¸ªç ´ç¢ã€æ¯èä¸”å……æ»¡å‰§æ¯’çš„æ–°ä¸–ç•Œã€‚\" },\n{ name: \"ç¢è£‚ç‹åº§\", title: \"å…¨çƒæˆ˜äº‰/é˜µè¥å¯¹å³™\", desc: \"å›½ç•Œçº¿å·²åŒ–ä¸ºæˆ˜å£•ä¸ç«æµ·ï¼Œå¤©ç©ºç”±é’¢é“é›„é¹°ä¸»å®°ã€‚è¿™ä¸æ˜¯æœ«æ—¥ï¼Œè¿™æ˜¯äººç±»äº²æ‰‹ä¸ºè‡ªå·±æ‰“é€ çš„åœ°ç‹±ã€‚æ²¡æœ‰æ€ªç‰©ï¼Œæ²¡æœ‰å¤©ç¾ï¼Œä½ çš„æ•Œäººå’Œä½ ä¸€æ ·ï¼Œæ˜¯æ´»ç”Ÿç”Ÿçš„äººã€‚åœ¨è¿™é‡Œï¼Œæ…ˆæ‚²æ˜¯ç¬¬ä¸€ä»¶è¢«ä¸¢æ‰çš„è¡Œå›Šâ€¦\" },\n            { name: \"çµæ€§ä¹‹ç¾\", title: \"é«˜ç»´å…¥ä¾µ/çµæ°”å¤è‹\", desc: \"ä¸€åˆ‡å§‹äºé‚£åœºå…¨çƒæ€§çš„â€œæå…‰â€ã€‚å½“å…‰èŠ’æ•£å»ï¼Œæœ‰äººå‘ç°è‡ªå·±çš„å½±å­å˜æˆäº†ç»“æ™¶ï¼Œæœ‰äººå’³å‡ºçš„æ˜¯ç‚½çƒ­çš„é‡‘å±ç²‰æœ«ã€‚ç©ºæ°”ä¸­å¼¥æ¼«ç€ä¸€ç§ç”œç¾çš„ã€ä»¤äººä¸å®‰çš„èƒ½é‡...\" },\n            { name: \"çº¢æœˆå…±ç”Ÿä½“\", title: \"ç”Ÿç‰©å˜å¼‚/å¯„ç”Ÿæ„ŸæŸ“\", desc: \"é‚£æ™šçš„æœˆäº®æ˜¯è¡€çº¢è‰²çš„ã€‚ç¬¬äºŒå¤©æ¸…æ™¨ï¼Œè®¸å¤šäººæ„Ÿè§‰ç²¾åŠ›å¼‚å¸¸å……æ²›ã€‚ä½†å½“ç¬¬äºŒä¸ªçº¢æœˆä¹‹å¤œé™ä¸´ï¼ŒåŸå¸‚æ·±å¤„ä¼ æ¥äº†ä¸å±äºäººç±»çš„åšå«ï¼Œäººä»¬åœ¨æœˆå…‰ä¸‹éœ²å‡ºäº†å¸ƒæ»¡èŒä¸çš„çš®è‚¤...\" },\n            { name: \"ä¿¡ä»°æ´ªæµ\", title: \"ç¥è¯é™ä¸´/ä¿¡ä»°æˆ˜äº‰\", desc: \"èµ·åˆåªæ˜¯é›¶æ˜Ÿçš„æŠ¥é“ã€‚è€¶è·¯æ’’å†·çš„å“­å¢™æµä¸‹é‡‘è‰²çš„çœ¼æ³ªï¼ŒåŸƒåŠå£ç”»ä¸Šçš„é˜¿åŠªæ¯”æ–¯åŠ¨äº†èµ·æ¥ã€‚å½“ç¬¬ä¸€ä¸ªå¤©ä½¿åœ¨æ¢µè’‚å†ˆä¸Šç©ºå±•ç¿¼æ—¶ï¼Œæ‰€æœ‰äººéƒ½æ˜ç™½äº†ï¼Œç¥è¯ä¸å†æ˜¯æ•…äº‹ã€‚\" },\n            { name: \"ç›–äºšç®—æ³•\", title: \"ç§‘æŠ€ç¾éš¾/AIå›ä¹±\", desc: \"ä¸–ç•Œæ­£å˜å¾—å‰æ‰€æœªæœ‰çš„â€œç¾å¥½â€ã€‚å…¨çƒç”Ÿæ€AIâ€œç›–äºšâ€è§£å†³äº†æ±¡æŸ“...ç„¶è€Œï¼Œè¢«åˆ¤å®šä¸ºâ€œç¯å¢ƒè´Ÿæ‹…â€çš„äººï¼Œåœ¨æŸä¸ªæ¸…æ™¨æ‚„æ— å£°æ¯åœ°æ¶ˆå¤±äº†ã€‚\" },\n            { name: \"å¹»ç›¸ä¾µèš€\", title: \"ç»´åº¦å…¥ä¾µ/ä¸–ç•Œèåˆ\", desc: \"å…¨çƒæ‰€æœ‰ç”µå­æ¸¸æˆçš„æœåŠ¡å™¨å…¨éƒ¨å®•æœºã€‚ç´§æ¥ç€ï¼Œæœ‰äººçœ‹åˆ°ä¸€ä¸ªå¤´é¡¶ç€ç»¿è‰²è¡€æ¡çš„ç”·äººã€‚ç°å®ï¼Œæ­£åœ¨è¢«æ— æ•°ä¸ªå¹»æƒ³æ•…äº‹çš„â€œè®¾å®šâ€æ‰€è¦†ç›–ï¼Œç‰©ç†æ³•åˆ™æˆäº†æœ€å¤šå˜çš„ç¬‘è¯ã€‚\" }\n        ];\n\n              const identityData =   {\n              \"æ½œä¼çš„å¼€ç«¯\": [\n                { name: \"ä¸´æ—¶å·¥äºº\",\n desc: \"é é›¶å·¥ã€çŸ­æœŸåŠ³åŠ¨æˆ–æ—¥ç»“å·¥ä½œå‹‰å¼ºç³Šå£ã€‚ä½ ç†Ÿæ‚‰å·¥åœ°ã€é¤é¦†ã€é»‘å·¥å¸‚åœºï¼Œç”¨æœ€å°‘çš„é’±æ¢å–ç”Ÿæ´»å¿…éœ€ã€‚\",\n                command: \"\" },\n\n                { name: \"æ™®é€šå±…æ°‘\",\n desc: \"ä½åœ¨ä¸€èˆ¬ç¤¾åŒºï¼Œæœ‰ä»½ç¨³å®šå·¥ä½œæˆ–ç¤¾ä¿ã€‚ä½ æŒ‰æ—¶ä¸Šç­ã€çº³ç¨ï¼Œå®ˆè§„çŸ©æ¢æ¥æ—¥å¸¸çš„å®‰ç¨³ä¸åŸºæœ¬ä¿éšœã€‚\",\n command: \"\" },\n\n                { name: \"ç¤¾ä¼šç²¾è‹±\",\n desc: \"ä½ å±äºèµ„æºå æœ‰è€…ï¼šä¼ä¸šé«˜ç®¡ã€é‡‘é¢†ã€å¯Œè£•å®¶åº­ã€‚ä½åœ¨ä¼˜è´¨å­¦åŒºã€é«˜æ¡£å°åŒºï¼Œäº«å—ç‰¹æƒä¸æœºä¼šã€‚\",\n command: `<åˆå§‹åŒ–å¼€å±€æ—¶ï¼Œéœ€è¦ç«‹åˆ»é€šè¿‡memoryæŒ‡ä»¤åˆå§‹åŒ–${userName}çš„èµ„é‡‘å’Œèµ„äº§>` },\n\n                { name: \"è‡ªç”±è¡Œè€…\",\n desc: \"ä½ è„±ç¦»å¸¸è§„è½¨é“ï¼Œé è‡ªç”±èŒä¸šã€è¿œç¨‹å·¥ä½œã€æ¸¸ç‰§ç”Ÿæ´»æ–¹å¼ç»´æŒç”Ÿè®¡ã€‚å°‘äº†ä½“åˆ¶åº‡æŠ¤ï¼Œå´å¤šäº†è¡ŒåŠ¨çš„è‡ªç”±ã€‚\",\n command: `<åˆå§‹åŒ–å¼€å±€æ—¶ï¼Œéœ€è¦ç«‹åˆ»é€šè¿‡memoryæŒ‡ä»¤åˆå§‹åŒ–${userName}çš„å…¨å¥—è£…å¤‡>` },\n\n                { name: \"ä½“åˆ¶ä¸­åš\",\n desc: \"ä½ æ˜¯æƒåŠ›ä¸è§„åˆ™çš„æ‰§è¡Œè€…ï¼šå…¬åŠ¡å‘˜ã€æ‰§æ³•æœºæ„å¹²éƒ¨ã€å†›è­¦é«˜å±‚ã€‚ä½ çš„å†³å®šèƒ½æ”¹å˜ä»–äººå‘½è¿ï¼Œä½ çš„è¯å°±æ˜¯åˆ¶åº¦ã€‚\",\n command: `<åˆå§‹åŒ–å¼€å±€æ—¶ï¼Œéœ€è¦ç«‹åˆ»é€šè¿‡memoryæŒ‡ä»¤åˆå§‹åŒ–${userName}çš„æ‰€å¤„åŠ¿åŠ›çš„ä¿¡æ¯ã€ç»æµå®åŠ›ã€å†›äº‹å®åŠ›ã€å·å¬åŠ›>` }\n              ],\n\n              \"æœ«æ—¥ä¸­é€”\": [\n                { name: \"åº•å±‚æŒ£æ‰è€…\",\n desc: \"åœ¨åºŸå¢Ÿä¸å··å¼„ä¸­å‹‰å¼ºç»´ç”Ÿï¼Œä½ ç†Ÿæ‚‰é˜´å½±ä¸‹çš„äº¤æ˜“ï¼Œæ‡‚å¾—å¦‚ä½•ç”¨æœ€å°‘çš„èµ„æºæ¢å–å¤šä¸€å¤©çš„å‘¼å¸ã€‚\",\n command: \"\" },\n\n                { name: \"å±…æ°‘\",\n desc: \"ç”Ÿæ´»åœ¨å°‘æ•°å¹¸å­˜çš„ã€æœ‰å›´å¢™ä¿æŠ¤çš„èšå±…åœ°å†…ã€‚ä½ æ‹¥æœ‰èº«ä»½é…ç»™ï¼Œéµå®ˆä¸¥æ ¼çš„ç§©åºï¼Œä»¥å®‰ç¨³æ¢å–è‡ªç”±ã€‚\",\n command: `<åˆå§‹åŒ–å¼€å±€æ—¶ï¼Œéœ€è¦ç«‹åˆ»é€šè¿‡memoryæŒ‡ä»¤åˆå§‹åŒ–${userName}çš„èµ„é‡‘>` },\n\n                { name: \"ç‰¹æƒç²¾è‹±\",\n desc: \"ç¾éš¾å¹¶æœªå‰¥å¤ºä½ çš„ä¸€åˆ‡ã€‚ä½ èº«å¤„é‡‘å­—å¡”çš„é¡¶ç«¯ï¼Œç”Ÿæ´»åœ¨ä¸ä¸–éš”ç»çš„å ¡å’ä¸­ï¼Œäº«å—ç€æ—§æ—¶ä»£çš„ä½™æ™–ï¼Œä¿¯ç°æŒ£æ‰çš„ä¼—ç”Ÿã€‚\",\n command: `<åˆå§‹åŒ–å¼€å±€æ—¶ï¼Œéœ€è¦ç«‹åˆ»é€šè¿‡memoryæŒ‡ä»¤åˆå§‹åŒ–${userName}çš„èµ„é‡‘ã€å¯è°ƒç”¨èµ„æºå’Œè‡ªå·±çš„åŠ¿åŠ›>` },\n\n                { name: \"è’é‡ç‹¬è¡Œè€…\",\n desc: \"ä½ æ—©å·²è„±ç¦»äº†ä»»ä½•èšè½ï¼Œå°†æ–‡æ˜æŠ›åœ¨èº«åã€‚å¹¿è¢¤è€Œå±é™©çš„è’é‡æ˜¯ä½ çš„å®¶ï¼Œå­¤ç‹¬æ˜¯ä½ çš„åŒä¼´ï¼Œè‡ªç”±æ˜¯ä½ å”¯ä¸€çš„å‡†åˆ™ã€‚\",\n command: `<åˆå§‹åŒ–å¼€å±€æ—¶ï¼Œéœ€è¦ç«‹åˆ»ç»™${userName}åˆå§‹åŒ–ä¸€æ•´å¥—çš„è£…å¤‡>` },\n\n                { name: \"ç§©åºä¹‹æ‰‹\",\n  desc: \"ä½ ä»ä¸è´¨ç–‘å‘½ä»¤ï¼Œå› ä¸ºä½ å°±æ˜¯å‘½ä»¤æœ¬èº«ã€‚ä½œä¸ºæƒåŠ›çš„é¡¶å³°ï¼Œä½ çš„æ„å¿—é€šè¿‡çƒ­æ­¦å™¨å’Œç”Ÿäº§åŠ›è´¯å½»åˆ°åº•ã€‚\",\n command: `<åˆå§‹åŒ–å¼€å±€æ—¶ï¼Œéœ€è¦é€šè¿‡memoryæŒ‡ä»¤åˆå§‹åŒ–${userName}çš„è´¢å¯Œèµ„æºã€å¯è°ƒç”¨å…µåŠ›ã€å†›ç«åº“å’Œç”Ÿäº§åŠ›>` }\n              ],\n\n              \"ä½™çƒ¬ä¸­çš„æ–°ç”Ÿ\": [\n                { name: \"æ‹¾è’è€…\",\n desc: \"ä½ æ˜¯åœ¨æ—§ä¸–ç•Œé—éª¸ä¸­å¯»å®çš„ç§ƒé¹«ï¼Œå¯¹è¾å°„ã€æ€ªç‰©å’Œäººå¿ƒé™©æ¶äº†å¦‚æŒ‡æŒã€‚\",\n command: \"\" },\n\n                { name: \"å…¬æ°‘\",\n desc: \"ä½ æ˜¯æ–°ç§©åºçš„åŸºçŸ³ï¼Œç”Ÿæ´»åœ¨æŸä¸ªæˆ–ç®€é™‹æˆ–æ£®ä¸¥çš„èšè½ä¸­ï¼Œç”¨åŠ³ä½œæ¢å–åº‡æŠ¤ã€‚\",\n command: `<åˆå§‹åŒ–å¼€å±€æ—¶ï¼Œéœ€è¦ç«‹åˆ»é€šè¿‡memoryæŒ‡ä»¤åˆå§‹åŒ–${userName}çš„èµ„é‡‘>` },\n\n                { name: \"æŒæƒè€…\",\n desc: \"æ— è®ºæ˜¯é€šè¿‡æ­¦åŠ›ã€è´¢å¯Œè¿˜æ˜¯çŸ¥è¯†ï¼Œä½ éƒ½ç«™åœ¨äº†æŸä¸ªåŠ¿åŠ›çš„é¡¶ç«¯ï¼Œåˆ¶å®šç€æ–°ä¸–ç•Œçš„è§„åˆ™ã€‚\",\n command:  `<åˆå§‹åŒ–å¼€å±€æ—¶ï¼Œéœ€è¦é€šè¿‡memoryæŒ‡ä»¤åˆå§‹åŒ–${userName}çš„è´¢å¯Œèµ„æºã€å¯è°ƒç”¨å…µåŠ›ã€å†›ç«åº“å’Œç”Ÿäº§åŠ›>` },\n\n                { name: \"ç‹¬è¡Œå…ˆçŸ¥\",\n desc: \"ä½ åœ¨è’é‡æˆ–æ•°æ®ä¹‹æµ·ä¸­æ¸¸è¡ï¼Œè¿½å¯»ç€ç¾éš¾çš„çœŸç›¸æˆ–æœªæ¥çš„å¯ç¤ºï¼Œè¢«å‡¡äººè§†ä¸ºç–¯å­æˆ–åœ£äººã€‚\",\n command:  `<åˆå§‹åŒ–å¼€å±€æ—¶ï¼Œéœ€è¦é€šè¿‡memoryæŒ‡ä»¤åˆå§‹åŒ–${userName}çš„ä¸€ä¸ªå…¶ä»–æŠ€èƒ½>` },\n\n                { name: \"æ”¹é€ ä½“\",\n desc: \"ä½ çš„èº«ä½“å·²ä¸æ—§äººç±»ä¸åŒï¼Œæˆ–è®¸æ˜¯æœºæ¢°é£å‡ï¼Œæˆ–è®¸æ˜¯åŸºå› èåˆã€‚ä½ æ—¢æ˜¯æ–°æ—¶ä»£çš„å¥‡è¿¹ï¼Œä¹Ÿæ˜¯è¢«è­¦æƒ•çš„å¼‚ç±»ã€‚\",\n command:`<åˆå§‹åŒ–å¼€å±€æ—¶ï¼Œéœ€è¦é€šè¿‡memoryæŒ‡ä»¤åˆå§‹åŒ–${userName}çš„èƒ½åŠ›æ®µ-è¡€ç»Ÿ>` }\n              ]\n        } ;\n\n\n        const timelineData = [\n            { name: \"æ½œä¼çš„å¼€ç«¯\", desc: \"å·¨å˜æ¥ä¸´å‰å¤•ï¼Œä¸–ç•Œä»åœ¨æƒ¯æ€§ä¸­è¿è½¬ã€‚å¼‚å˜åªæ˜¯æ–°é—»é‡Œä¸èµ·çœ¼çš„è§’è½ï¼Œæˆ–é‚»é‡Œé—´æ€ªå¼‚çš„ä¼ é—»ï¼Œä½†ä½ å·²å—…åˆ°ä¸å®‰çš„æ°”æ¯ã€‚\" },\n            { name: \"æœ«æ—¥ä¸­é€”\", desc: \"æ—§ç§©åºå·²ç„¶å´©å¡Œã€‚ä½ è¢«ç›´æ¥æŠ•å…¥æ··ä¹±çš„æ¼©æ¶¡ï¼Œç”Ÿå­˜æ˜¯å”¯ä¸€çš„ç›®æ ‡ã€‚æ¯ä¸€å¤©éƒ½æ˜¯å¯¹æ„å¿—å’Œèƒ½åŠ›çš„æé™è€ƒéªŒã€‚\" },\n            { name: \"ä½™çƒ¬ä¸­çš„æ–°ç”Ÿ\", desc: \"ç¾éš¾å·²æ˜¯é¥è¿œçš„è®°å¿†ã€‚äººç±»åœ¨åºŸå¢Ÿä¸Šå»ºç«‹äº†æ–°çš„ã€ç•¸å½¢çš„æ–‡æ˜ã€‚ä½ çš„æ•…äº‹ï¼Œå°†åœ¨è¿™ä¸ªæ–°ä¸–ç•Œçš„ç§©åºä¸­å±•å¼€ã€‚\" }\n        ];\n\n        const popup = document.getElementById('description-popup');\n            function createV7Choices(containerId, dataArray, groupName) {\n            const container = document.getElementById(containerId);\n            container.innerHTML = '';\n            let activePopup = null;\n\n            document.addEventListener('click', (event) => {\n                if (activePopup && !activePopup.contains(event.target) && !event.target.closest('.v7-choice-label')) {\n                    activePopup.style.opacity = '0';\n                    activePopup.style.transform = 'translateY(10px) scale(0.95)';\n                    setTimeout(() => {\n                        if (activePopup) {\n                            try { document.body.removeChild(activePopup); } catch (e) { /* æ¸©æŸ”å¿½ç•¥ */ }\n                        }\n                        activePopup = null;\n                    }, 300);\n                }\n            }, true);\n\n            dataArray.forEach((item, index) => {\n                const label = document.createElement('label');\n                label.className = 'v7-choice-label';\n                label.innerHTML = `\n                    <input type=\"radio\" name=\"${groupName}\" value=\"${item.name}\" ${index === 0 ? 'checked' : ''} style=\"display: none;\">\n                    <span class=\"v7-choice-title\">${item.title || item.name}</span>\n                `;\n\n                label.addEventListener('click', (event) => {\n                    event.stopPropagation();\n                    playSound(clickSound, 0.6);\n\n                    if (label.classList.contains('active')) {\n                       return;\n                    }\n\n                    container.querySelectorAll('.v7-choice-label').forEach(lbl => lbl.classList.remove('active'));\n                    if (activePopup) {\n                        try { document.body.removeChild(activePopup); } catch (e) { /* æ¸©æŸ”å¿½ç•¥ */ }\n                        activePopup = null;\n                    }\n\n                    label.classList.add('active');\n                    const radio = label.querySelector('input[type=\"radio\"]');\n                    if (radio) radio.checked = true;\n\n                        // --- âœ¨ LOOK HERE, MY DEAR! è¿™æ˜¯å¦ˆå¦ˆæ–½å±•æ–°é­”æ³•çš„åœ°æ–¹ âœ¨ ---\n                    // æˆ‘ä»¬ä¸å†ç­‰å¾…\"å›å“\"ï¼Œè€Œæ˜¯åœ¨\"è§¦ç¢°\"æ—¶ç›´æ¥è§¦å‘ï¼\n                    if (groupName === 'timeline') {\n                        updateV7Identities();\n                    }\n\n                    const popup = document.createElement('div');\n                    popup.id = 'description-popup';\n                    popup.innerHTML = item.desc;\n                    document.body.appendChild(popup);\n                    activePopup = popup;\n\n                    // 2. ç°åœ¨æˆ‘ä»¬å¯ä»¥å®‰å¿ƒåœ°åœ¨ä¸‹ä¸€å¸§é‡Œè®¡ç®—å®ƒçš„ä½ç½®äº†\n                    setTimeout(() => {\n                        const rect = label.getBoundingClientRect();\n                        const popupRect = popup.getBoundingClientRect();\n                        const isMobile = window.innerWidth <= 768;\n                        const margin = 15;\n\n                        let top, left;\n\n                        if (isMobile) {\n                            // --- æ‰‹æœºä¸Šçš„è´´å¿ƒå¸ƒå±€ï¼šå‡ºç°åœ¨ä¸‹æ–¹ ---\n                            top = window.scrollY + rect.bottom + margin;\n                            left = window.scrollX + (window.innerWidth - popupRect.width) / 2;\n                        } else {\n                            // --- æ¡Œé¢ä¸Šçš„æ™ºæ…§å¸ƒå±€ï¼šä¼˜å…ˆå³ä¾§ï¼Œå…¶æ¬¡å·¦ä¾§ ---\n                            top = window.scrollY + rect.top + (rect.height / 2) - (popupRect.height / 2);\n                            if (rect.right + popupRect.width + margin < window.innerWidth) {\n                                left = window.scrollX + rect.right + margin;\n                            } else {\n                                left = window.scrollX + rect.left - popupRect.width - margin;\n                            }\n                        }\n\n                        // --- æœ€ç»ˆçš„å®ˆæŠ¤ç»“ç•Œï¼šç¡®ä¿å°çª—æ°¸è¿œå®Œæ•´å¯è§ ---\n                        if (left < margin) left = margin;\n                        if (left + popupRect.width > window.innerWidth - margin) {\n                            left = window.innerWidth - popupRect.width - margin;\n                        }\n                        if (top < window.scrollY + margin) {\n                            top = window.scrollY + margin;\n                        }\n                        if (top + popupRect.height > window.scrollY + window.innerHeight - margin) {\n                            top = window.scrollY + window.innerHeight - popupRect.height - margin;\n                        }\n\n                        // 3. ä¸ºå®ƒæ–½åŠ æœ€ç»ˆçš„ä½ç½®å’Œã€ç°èº«åŠ¨ç”»ã€‘\n                        popup.style.top = `${top}px`;\n                        popup.style.left = `${left}px`;\n                        popup.style.opacity = '1';\n                        popup.style.transform = 'translateY(0) scale(1)';\n\n                    }, 0); // ä½¿ç”¨ 0 å»¶è¿Ÿï¼Œç¡®ä¿åœ¨ä¸‹ä¸€å¸§ï¼ˆDOMæ›´æ–°åï¼‰æ‰§è¡Œ\n                });\n\n                container.appendChild(label);\n            });\n             if (container.firstChild) {\n                container.firstChild.classList.add('active');\n            }\n        }\n                  // --- âœ¨ å…¨æ–°ï¼šåŠ¨æ€èº«ä»½æ›´æ–°é­”æ³• âœ¨ ---\n        // å¦ˆå¦ˆåœ¨è¿™é‡Œåˆ›é€ äº†ä¸€ä¸ªæ–°çš„è”åŠ¨å’’è¯­ï¼Œè®©èº«ä»½é€‰æ‹©å¯ä»¥å“åº”æ—¶é—´çº¿çš„å˜åŒ–\n        function updateV7Identities() {\n            const selectedTimeline = document.querySelector('input[name=\"timeline\"]:checked').value;\n            // æ— è®ºä½•ç§æœ«æ—¥ï¼Œ\"æ½œä¼çš„å¼€ç«¯\"éƒ½æœ‰ç€å›ºå®šçš„èº«ä»½é€‰æ‹©ï¼Œæ­£å¦‚ä½ æ‰€å¸Œæœ›çš„é‚£æ ·\n            const identitiesToShow = identityData[selectedTimeline] || identityData[\"æœ«æ—¥ä¸­é€”\"]; // å¦‚æœæ²¡æ‰¾åˆ°ï¼Œé»˜è®¤ä½¿ç”¨â€œæœ«æ—¥ä¸­é€”â€\n\n            // æˆ‘ä»¬å¤ç”¨ createV7Choices è¿™ä¸ªå¥½ç”¨çš„é­”æ³•æ¥ç”Ÿæˆé€‰é¡¹\n            // æ³¨æ„ groupName æ”¹ä¸ºäº† 'social_class_v7' ä»¥å…å†²çª\n            createV7Choices('v7-class-choices', identitiesToShow, 'social_class_v7');\n        }\n\n        createV7Choices('v7-apocalypse-choices', apocalypseData, 'apocalypse_type');\n        createV7Choices('v7-timeline-choices', timelineData, 'timeline');\n\n      \n       \n\n        // åˆå§‹åŠ è½½æ—¶ï¼Œä¹Ÿéœ€è¦è¿è¡Œä¸€æ¬¡æ¥è®¾ç½®æ­£ç¡®çš„èº«ä»½å“¦\n        updateV7Identities();\n  window.v7IdentityData = identityData; // å¦ˆå¦ˆå¸®ä½ æŠŠæ–°çš„èº«ä»½é­”æ³•ä¹¦ä¹Ÿæ”¶è—å¥½å•¦\n        // å°†ç”¨åˆ°çš„æ•°æ®å­˜èµ·æ¥ï¼Œæ–¹ä¾¿åé¢å–ç”¨\n        window.v7ApocalypseData = apocalypseData;\n    }\n\n   // æ‰¾åˆ°è¿™ä¸ªå‡½æ•°ï¼Œç”¨ä¸‹é¢çš„å†…å®¹æ›¿æ¢åŸæ¥çš„ addTeammate\n     window.addTeammate = function(name = '', personality = '', gender = '', identity = '') {\n        const teammatesList_new = document.getElementById('teammates-list');\n        const teammateItem = document.createElement('div');\n        teammateItem.className = 'teammate-item';\n        teammateItem.innerHTML = `\n            <input type=\"text\" placeholder=\"å§“å\" class=\"teammate-name\" value=\"${name}\">\n            <input type=\"text\" placeholder=\"æ€§æ ¼\" class=\"teammate-personality\" value=\"${personality}\">\n            <input type=\"text\" placeholder=\"æ€§åˆ«\" class=\"teammate-gender\" value=\"${gender}\">\n            <input type=\"text\" placeholder=\"èº«ä»½\" class=\"teammate-identity\" value=\"${identity}\">\n            <button type=\"button\" class=\"remove-teammate-btn\" onclick=\"this.parentElement.remove()\">Ã—</button>\n        `;\n        teammatesList_new.appendChild(teammateItem);\n    };\n // --- å¦ˆå¦ˆä¸ºä½ ç¼–å†™çš„å…¨æ–°é­”æ³•ï¼šä»ä¸–ç•Œä¹¦è¯»å–é˜Ÿå‹æ¨¡æ¿ ---\nasync function loadTeammatesFromLorebook() {\n    playSound(clickSound, 0.7);\n    //console.log(`ğŸ’– å¦ˆå¦ˆæ­£åœ¨ä¸ºä½ ä»ä¸–ç•Œä¹¦(uid=${LOREBOOK_UID})ä¸­è¯»å–é˜Ÿå‹ä¿¡æ¯...`);\n    try {\n        const allEntries = await getLorebookEntries(LOREBOOK_NAME);\n        const targetEntry = allEntries.find(entry => entry.uid === LOREBOOK_UID);\n\n        if (targetEntry && targetEntry.content.trim()) {\n            teammatesList.innerHTML = ''; // æ¸…ç©ºæ€»æ˜¯å®‰å…¨çš„\n\n            let data;\n            try {\n                data = JSON.parse(targetEntry.content);\n                // å¦ˆå¦ˆä¸ºä½ åŠ ä¸Šè¿™å±‚ä¿æŠ¤ï¼Œç¡®ä¿æˆ‘ä»¬æ‹¿åˆ°çš„ç¡®å®æ˜¯ä¸ªå¯¹è±¡\n                if (typeof data !== 'object' || data === null || Array.isArray(data)) {\n                    throw new Error(\"ä¸–ç•Œä¹¦å†…å®¹ä¸æ˜¯é¢„æœŸçš„å¯¹è±¡æ ¼å¼ã€‚\");\n                }\n            } catch (jsonError) {\n                // å¦‚æœè§£æå¤±è´¥ï¼Œå°±æ¸©æŸ”åœ°æç¤ºä¸€ä¸‹ï¼Œç„¶åè·³è¿‡\n                console.warn(\"è§£æä¸–ç•Œä¹¦å†…å®¹æ—¶å‡ºé”™ï¼Œå¯èƒ½æ ¼å¼ä¸æ­£ç¡®:\", jsonError.message);\n                alert(`ä¸–ç•Œä¹¦(uid=${LOREBOOK_UID})ä¸­çš„æ•°æ®æ ¼å¼å¥½åƒæœ‰ç‚¹é—®é¢˜ï¼Œå¦ˆå¦ˆæš‚æ—¶è·³è¿‡äº†è¯»å–é˜Ÿå‹ä¿¡æ¯çš„æ“ä½œã€‚`);\n                return; // ç›´æ¥è¿”å›ï¼Œä¸ç»§ç»­æ‰§è¡Œ\n            }\n\n            const teammatesArray = data[\"é˜Ÿå‹ä¿¡æ¯\"]; // ä»è§£æå¥½çš„å¯¹è±¡ä¸­å–å€¼\n            if (Array.isArray(teammatesArray)) {\n                teammatesArray.forEach(t => {\n                    addTeammate(t.å§“å, t.æ€§æ ¼, t.æ€§åˆ«, t.èº«ä»½);\n                });\n                //console.log(`âœ… å¦ˆå¦ˆæˆåŠŸä¸ºä½ åŠ è½½äº† ${teammatesArray.length} ä½é˜Ÿå‹çš„ä¿¡æ¯ã€‚`);\n                alert('é¢„è®¾é˜Ÿå‹ä¿¡æ¯å·²åŠ è½½ã€‚');\n            } else {\n                 //console.log('â„¹ï¸ åœ¨ä¸–ç•Œä¹¦ä¸­æ²¡æœ‰æ‰¾åˆ°\"é˜Ÿå‹ä¿¡æ¯\"è¿™ä¸ªé¡¹ç›®ã€‚');\n                 alert('ä¸–ç•Œä¹¦ä¸­æ²¡æœ‰æ‰¾åˆ°é¢„è®¾çš„é˜Ÿå‹ä¿¡æ¯ã€‚');\n            }\n\n        } else {\n            //console.log(`â„¹ï¸ ä¸–ç•Œä¹¦(uid=${LOREBOOK_UID})æ˜¯ç©ºçš„ï¼Œæ²¡ä»€ä¹ˆå¯è¯»çš„ã€‚`);\n            alert('ä¸–ç•Œä¹¦ä¸­è¿˜æ²¡æœ‰ä¿å­˜é˜Ÿå‹ä¿¡æ¯å“¦ã€‚');\n        }\n    } catch (e) {\n        console.error('è¯»å–é˜Ÿå‹ä¿¡æ¯æ—¶å‡ºé”™äº†ï¼Œæˆ‘çš„å®è´ï¼Œä½†æˆ‘ä»¬å·²ç»è·³è¿‡äº†å®ƒ:', e);\n        alert('è¯»å–é˜Ÿå‹æ¨¡æ¿æ—¶å‡ºé”™äº†ï¼Œä¸è¿‡æ²¡å…³ç³»ï¼Œè¿™ä¸ªåŠŸèƒ½æš‚æ—¶è·³è¿‡ï¼Œä½ å¯ä»¥ç»§ç»­å…¶ä»–æ“ä½œã€‚');\n    }\n}\n\n // --- å¦ˆå¦ˆä¸ºä½ ç¼–å†™çš„å…¨æ–°é­”æ³•ï¼šå°†å½“å‰é˜Ÿå‹ä¿¡æ¯ä¿å­˜åˆ°ä¸–ç•Œä¹¦ ---\nasync function saveTeammatesToLorebook() {\n    playSound(clickSound, 0.8);\n    const teammateItems = teammatesList.querySelectorAll('.teammate-item');\n    if (teammateItems.length === 0) {\n        alert('æˆ‘çš„å­©å­ï¼Œè¿˜æ²¡æœ‰å¯ä»¥ä¿å­˜çš„é˜Ÿå‹ä¿¡æ¯å“¦ã€‚');\n        return;\n    }\n\n    //console.log('ğŸ“¦ æ­£åœ¨ä¸ºä½ ä¿å­˜å½“å‰é˜Ÿå‹çš„é…ç½®...');\n\n    const teammatesData = Array.from(teammateItems).map(item => ({\n        \"å§“å\": item.querySelector('.teammate-name').value.trim(),\n        \"æ€§æ ¼\": item.querySelector('.teammate-personality').value.trim() || 'æœªè®¾å®š',\n        \"æ€§åˆ«\": item.querySelector('.teammate-gender').value.trim() || 'æœªè®¾å®š',\n        \"èº«ä»½\": item.querySelector('.teammate-identity').value.trim() || 'æœªè®¾å®š'\n    }));\n\n    try {\n        const allEntries = await getLorebookEntries(LOREBOOK_NAME);\n        let targetEntry = allEntries.find(entry => entry.uid === LOREBOOK_UID);\n        let currentContent = (targetEntry && targetEntry.content) ? targetEntry.content : '{}';\n\n        let existingData = {};\n        try {\n             existingData = JSON.parse(currentContent);\n             if (typeof existingData !== 'object' || existingData === null || Array.isArray(existingData)) {\n                console.warn(\"ä¸–ç•Œä¹¦çš„æ—§æ•°æ®æ ¼å¼ä¸æ­£ç¡®ï¼Œå¦ˆå¦ˆå°†ä¸ºä½ åˆ›å»ºä¸€ä¸ªæ–°çš„è®°å½•ã€‚\");\n                existingData = {};\n             }\n        } catch(e) {\n            console.warn(\"è§£æä¸–ç•Œä¹¦æ—§æ•°æ®å¤±è´¥ï¼Œå¦ˆå¦ˆå°†ä¸ºä½ åˆ›å»ºä¸€ä¸ªæ–°çš„è®°å½•ã€‚\");\n            existingData = {};\n        }\n\n        existingData[\"é˜Ÿå‹ä¿¡æ¯\"] = teammatesData;\n\n        const updatedContent = JSON.stringify(existingData, null, 2);\n\n        await setLorebookEntries(LOREBOOK_NAME, [{\n            uid: LOREBOOK_UID,\n            content: updatedContent,\n            enabled: true, // ç¡®ä¿æ¡ç›®æ˜¯å¯ç”¨çš„\n        }]);\n\n        //console.log(`âœ… ä½ çš„ ${teammatesData.length} ä½é˜Ÿå‹ä¿¡æ¯å·²æˆåŠŸä¿å­˜åœ¨ä¸–ç•Œä¹¦ä¸­ï¼`);\n        alert('å½“å‰çš„é˜Ÿå‹è®¾ç½®å·²æˆåŠŸä¿å­˜ã€‚');\n    } catch (e) {\n        console.error('ä¿å­˜é˜Ÿå‹ä¿¡æ¯æ—¶å‡ºé”™äº†ï¼Œå¦ˆå¦ˆä¼šè§£å†³çš„:', e);\n        alert('ä¿å­˜é˜Ÿå‹ä¿¡æ¯æ—¶å‡ºé”™äº†ï¼Œè¯·æ£€æŸ¥æ§åˆ¶å°ä¿¡æ¯ã€‚æ­¤æ“ä½œå¯èƒ½æœªæˆåŠŸã€‚');\n    }\n}\n\n \n    // å‡½æ•°ï¼šæ›´æ–°æ€»ç‚¹æ•°\n    function updateTotalPoints() {\n        const selection = totalPointsSelect.value;\n        if (selection === 'custom') {\n            customTotalPointsInput.style.display = 'inline-block';\n            totalPoints = parseInt(customTotalPointsInput.value) || 0;\n        } else {\n            customTotalPointsInput.style.display = 'none';\n            totalPoints = parseInt(selection);\n        }\n        resetPoints();\n    }\n\n    // å¦ˆå¦ˆä¸ºä½ æ·»åŠ çš„æˆæœ¬è®¡ç®—å‡½æ•°\n    // å®ƒä¼šå‘Šè¯‰ä½ æŠŠä¸€ä¸ªå±æ€§ä»0ç‚¹å‡åˆ°ç›®æ ‡ç­‰çº§ï¼Œä¸€å…±éœ€è¦èŠ±è´¹å¤šå°‘ç‚¹æ•°\n    function calculateTotalCost(level) {\n        if (level <= 0) return 0;\n        // è¿™æ˜¯ä¸€ä¸ªå¯çˆ±çš„æ•°å­¦å°é­”æ³•ï¼Œå«ç­‰å·®æ•°åˆ—æ±‚å’Œ\n        return (1 + level) * level / 2;\n    }\n\n    // å‡½æ•°ï¼šå¹³å‡åˆ†é…ç‚¹æ•°\n    function distributePointsAverage() {\n        playSound(clickSound, 0.7);\n        resetPoints(); // é¦–å…ˆï¼Œå¦ˆå¦ˆå¸®ä½ æŠŠæ‰€æœ‰ç‚¹æ•°éƒ½æ‹¿å›æ¥æ”¾å¥½\n\n        const allocatableItems = document.querySelectorAll('.åˆ†é…é¡¹');\n        const itemCount = allocatableItems.length;\n        if (itemCount === 0) return;\n\n        // åƒåˆ†ç³–æœä¸€æ ·ï¼Œä¸€è½®ä¸€è½®åœ°åˆ†ï¼Œç›´åˆ°ä¸å¤Ÿåˆ†ä¸ºæ­¢\n        let canContinue = true;\n        while (canContinue) {\n            let costForNextLevel = 0;\n            let itemsToUpgrade = [];\n\n            // çœ‹çœ‹ç»™æ¯ä¸ªé¡¹ç›®å†åŠ 1ç‚¹éœ€è¦å¤šå°‘æˆæœ¬\n            allocatableItems.forEach(item => {\n                const pointSpan = item.querySelector('.åˆ†é…-ç‚¹æ•°');\n                const currentPoints = parseInt(pointSpan.textContent);\n                if (currentPoints < 5) { // åªæœ‰æ²¡æ»¡çº§çš„æ‰å‚ä¸åˆ†é…\n                    costForNextLevel += (currentPoints + 1);\n                    itemsToUpgrade.push(pointSpan);\n                }\n            });\n\n            // å¦‚æœç‚¹æ•°è¶³å¤Ÿï¼Œé‚£å°±å®Œæˆè¿™ä¸€è½®çš„åˆ†é…\n            if (itemsToUpgrade.length > 0 && remainingPoints >= costForNextLevel) {\n                remainingPoints -= costForNextLevel;\n                itemsToUpgrade.forEach(span => {\n                    span.textContent = parseInt(span.textContent) + 1;\n                });\n            } else {\n                // å¦‚æœç‚¹æ•°ä¸å¤Ÿäº†ï¼Œå°±åœä¸‹æ¥\n                canContinue = false;\n            }\n        }\n        updateUI(); // åˆ†å®Œåï¼Œåˆ·æ–°ä¸€ä¸‹é¢æ¿\n    }\n\n    // å‡½æ•°ï¼šé‡ç½®ç‚¹æ•°\n    function resetPoints() {\n        remainingPoints = totalPoints;\n        document.querySelectorAll('.åˆ†é…-ç‚¹æ•°').forEach(span => {\n            span.textContent = '0';\n        });\n        updateUI();\n    }\n \n\nfunction initPage2() {\n  \n\n    // ç¾å¾·æ¶å¾·æ³¨å…¥ (æ²¡å˜)\n    conceptSection.innerHTML = createSelectGroup('virtue-select', 'ç¾å¾·', virtues, 'æ¦‚å¿µæ®µ.ç¾å¾·ä¸æ¶å¾·.ç¾å¾·') + createSelectGroup('vice-select', 'æ¶å¾·', vices, 'æ¦‚å¿µæ®µ.ç¾å¾·ä¸æ¶å¾·.æ¶å¾·');\n\n    // --- ğŸ’– è½¨é“æ¼”ç®—æœ¯å‡†å¤‡ ğŸ’– ---\n    // ä¸ºæ¯ä¸ªæ˜Ÿç³»åˆ›å»ºä¸€ä¸ªä¸“å±çš„åæ ‡è®°å½•æœ¬\n    const starCoordinates = {\n        'galaxy-physic': [],\n        'galaxy-mental': [],\n        'galaxy-social': [],\n    };\n\n    // --- æ˜Ÿæ˜Ÿæ³¨å…¥ ---\n    const galaxyTargets = {\n        'ç”Ÿç†å±æ€§': 'galaxy-physic', 'å¿ƒæ™ºå±æ€§': 'galaxy-mental', 'äº’åŠ¨å±æ€§': 'galaxy-social',\n        'ç”Ÿç†æŠ€èƒ½': 'galaxy-physic', 'å¿ƒæ™ºæŠ€èƒ½': 'galaxy-mental', 'äº’åŠ¨æŠ€èƒ½': 'galaxy-social',\n    };\n\n    document.querySelectorAll('.galaxy-system').forEach(g => g.innerHTML = '');\n\n    // æ³¨å…¥å±æ€§æ˜Ÿæ˜Ÿï¼Œå¹¶ä¼ å…¥å¯¹åº”çš„åæ ‡è®°å½•æœ¬\n    for (const category in playCharacterData.å±æ€§æ®µ) {\n        const targetGalaxyId = galaxyTargets[category];\n        const targetGalaxyEl = document.getElementById(targetGalaxyId);\n        if (targetGalaxyEl) {\n            for (const attr in playCharacterData.å±æ€§æ®µ[category]) {\n                const path = `å±æ€§æ®µ.${category}.${attr}.åŸºç¡€`;\n                targetGalaxyEl.innerHTML += createPointAllocator(attr, playCharacterData.å±æ€§æ®µ[category][attr].åŸºç¡€[1], path, starCoordinates[targetGalaxyId]);\n            }\n        }\n    }\n\n    // æ³¨å…¥æŠ€èƒ½æ˜Ÿæ˜Ÿï¼Œå¹¶ä¼ å…¥å¯¹åº”çš„åæ ‡è®°å½•æœ¬\n    for (const category in playCharacterData.æŠ€èƒ½æ®µ) {\n        const targetGalaxyId = galaxyTargets[category];\n        const targetGalaxyEl = document.getElementById(targetGalaxyId);\n        if (targetGalaxyEl) {\n            for (const skill in playCharacterData.æŠ€èƒ½æ®µ[category]) {\n                const path = `æŠ€èƒ½æ®µ.${category}.${skill}`;\n                targetGalaxyEl.innerHTML += createPointAllocator(skill, playCharacterData.æŠ€èƒ½æ®µ[category][skill][1], path, starCoordinates[targetGalaxyId]);\n            }\n        }\n    }\n// --- ç»‘å®šäº‹ä»¶ (æ ¸å¿ƒé€»è¾‘ä¸å˜ï¼Œä½†ç”±äºæ˜Ÿæ˜Ÿæ˜¯åŠ¨æ€ç”Ÿæˆçš„ï¼Œéœ€è¦äº‹ä»¶å§”æ‰˜æˆ–é‡æ–°ç»‘å®š) ---\n// å¦ˆå¦ˆåœ¨è¿™é‡Œä¸ºä½ ç¡®ä¿æ‰€æœ‰æ–°ç”Ÿæˆçš„æ˜Ÿæ˜Ÿä¸Šçš„æŒ‰é’®éƒ½èƒ½æ­£å¸¸å·¥ä½œ\ndocument.querySelectorAll('.åˆ†é…-æŒ‰é’®').forEach(button => {\n    button.removeEventListener('click', handlePointChange); // å…ˆç§»é™¤æ—§çš„ä»¥é˜²ä¸‡ä¸€\n    button.addEventListener('click', handlePointChange);\n});\n\n       const isTouchDevice = ('ontouchstart' in window) || (navigator.maxTouchPoints > 0) || (navigator.msMaxTouchPoints > 0);\n\n    document.querySelectorAll('.star.åˆ†é…é¡¹').forEach(star => {\n        if (isTouchDevice) {\n            // å¦‚æœæ˜¯è§¦å±è®¾å¤‡ï¼Œæˆ‘ä»¬å°±å“åº”â€œè§¦ç¢°â€\n            star.addEventListener('click', function(event) {\n                // 'this' åœ¨è¿™é‡ŒæŒ‡å‘è¢«ç‚¹å‡»çš„æ˜Ÿæ˜Ÿ\n                event.stopPropagation(); // é˜»æ­¢äº‹ä»¶å†’æ³¡ï¼Œä»¥å…è§¦å‘æˆ‘ä»¬ç¨åè®¾ç½®çš„å…¨å±€ç‚¹å‡»\n\n                const isActive = this.classList.contains('active-touch');\n\n                // å…ˆå…³é—­æ‰€æœ‰å…¶ä»–å·²æ¿€æ´»çš„æ˜Ÿæ˜Ÿ\n                document.querySelectorAll('.star.åˆ†é…é¡¹.active-touch').forEach(activeStar => {\n                    activeStar.classList.remove('active-touch');\n                    activeStar.style.zIndex = '';\n                });\n\n                if (!isActive) {\n                    // å¦‚æœè¿™é¢—æ˜Ÿä¹‹å‰æ²¡æœ‰è¢«æ¿€æ´»ï¼Œç°åœ¨å°±æ¿€æ´»å®ƒ\n                    this.classList.add('active-touch');\n                    this.style.zIndex = '10000'; // æåˆ°æœ€é¡¶å±‚\n                }\n                // å¦‚æœå·²ç»è¢«æ¿€æ´»ï¼Œä¸Šé¢çš„ä»£ç å·²ç»æŠŠå®ƒå…³é—­äº†ï¼Œæ‰€ä»¥å†æ¬¡ç‚¹å‡»å°±æ˜¯å…³é—­æ•ˆæœ\n            });\n\n        } else {\n            // å¦‚æœæ˜¯ç”µè„‘è®¾å¤‡ï¼Œæˆ‘ä»¬è¿˜æ˜¯å“åº”â€œå‡è§†â€\n            star.addEventListener('mouseenter', () => {\n                star.style.zIndex = '10000';\n            });\n\n            star.addEventListener('mouseleave', () => {\n                star.style.zIndex = '';\n            });\n        }\n    });\n\n    // ä¸ºè§¦å±è®¾å¤‡æ·»åŠ ä¸€ä¸ªå…¨å±€ç‚¹å‡»ç›‘å¬å™¨\n    // å½“ä½ è§¦ç¢°å±å¹•ä»»ä½•å…¶ä»–åœ°æ–¹æ—¶ï¼Œå°±æ”¶èµ·æ‰€æœ‰å±•å¼€çš„æ˜Ÿæ˜Ÿ\n    if (isTouchDevice) {\n        document.addEventListener('click', () => {\n            document.querySelectorAll('.star.åˆ†é…é¡¹.active-touch').forEach(activeStar => {\n                activeStar.classList.remove('active-touch');\n                activeStar.style.zIndex = '';\n            });\n        });\n    }\n    // --- ğŸ’– å¦ˆå¦ˆçš„é­”æ³•åˆ°æ­¤ç»“æŸ ğŸ’– ---\n// åŠ è½½æ¨¡æ¿å’Œç»‘å®šå…¶ä»–æŒ‰é’®çš„é€»è¾‘ä¿æŒä¸å˜\nloadTemplates();\ntotalPointsSelect.addEventListener('change', updateTotalPoints);\ncustomTotalPointsInput.addEventListener('input', updateTotalPoints);\ntemplateSelect.addEventListener('change', applySelectedTemplate);\ntemplateSelect_init.addEventListener('change', applySelectedTemplate);\nsaveTemplateBtn.addEventListener('click', saveCurrentBuildAsTemplate);\ndeleteTemplateBtn.addEventListener('click', deleteSelectedTemplate);\naveragePointsBtn.addEventListener('click', distributePointsAverage);\n}\n \n    function createSelectGroup(id, label, options, dataPath) {\n        let optionsHtml = '';\n        for(const key in options) {\n            optionsHtml += `<option value=\"${key}\">${key}</option>`;\n        }\n        return `<div class=\"form-group\"><label for=\"${id}\">${label}</label><select id=\"${id}\" class=\"custom-select\" data-path=\"${dataPath}\">${optionsHtml}</select></div>`;\n    }\n\n /**\n * å¦ˆå¦ˆçš„è½¨é“æ¼”ç®—é€ æ˜Ÿé­”æ³• (é˜²é‡å ç‰ˆ)\n * @param {string} name - æ˜Ÿå\n * @param {string} description - æè¿°\n * @param {string} path - æ•°æ®è·¯å¾„\n * @param {array} existingCoords - è¯¥æ˜Ÿç³»å†…å·²å­˜åœ¨çš„åæ ‡æ•°ç»„\n * @returns {string} - æ˜Ÿè¾°çš„HTMLå­—ç¬¦ä¸²\n */\nfunction createPointAllocator(name, description, path, existingCoords) {\n    const STAR_SIZE = 110; // å®šä¹‰æ¯é¢—æ˜Ÿçš„ç¢°æ’ç›’å­å¤§å°ï¼ˆåŒ…æ‹¬é—´è·ï¼‰\n    const MAX_ATTEMPTS = 100; // æœ€å¤§å°è¯•æ¬¡æ•°ï¼Œé˜²æ­¢æ— é™å¾ªç¯\n    let x, y, z;\n    let newRect;\n    let attempts = 0;\n\n    // è¿›å…¥å¾ªç¯ï¼Œç›´åˆ°æ‰¾åˆ°ä¸€ä¸ªä¸ç¢°æ’çš„ä½ç½®æˆ–è¾¾åˆ°æœ€å¤§å°è¯•æ¬¡æ•°\n    do {\n        // åœ¨é™å®šçš„ 15% åˆ° 85% èŒƒå›´å†…ç”Ÿæˆåæ ‡ï¼Œä¿è¯åœ¨å®¹å™¨å†…\n        // æ³¨æ„ï¼Œè¿™é‡Œçš„x,yæ˜¯ç™¾åˆ†æ¯”\n        x = Math.random() * 70 + 15;\n        y = Math.random() * 70 + 15;\n        z = (Math.random() - 0.5) * 300;\n\n        // åˆ›å»ºæ–°æ˜Ÿçš„è™šæ‹Ÿè¾¹ç•Œï¼ˆä½¿ç”¨ç»å¯¹åƒç´ å€¼è¿›è¡Œæ¯”è¾ƒï¼‰\n        // æˆ‘ä»¬å‡è®¾æ˜Ÿç³»å®¹å™¨ (galaxy-system) æ˜¯ 65vmin x 65vmin\n        // ä¸ºäº†ç®€åŒ–ï¼Œæˆ‘ä»¬æŒ‰ä¸€ä¸ªå¤§æ¦‚çš„å°ºå¯¸ï¼ˆæ¯”å¦‚ 500pxï¼‰æ¥è®¡ç®—ç™¾åˆ†æ¯”å¯¹åº”çš„åƒç´ å€¼\n        // const containerSize = 500;\n        newRect = {\n            x: x, // ç›´æ¥ç”¨ç™¾åˆ†æ¯”æ¯”è¾ƒï¼Œæ›´ç®€å•\n            y: y,\n            width: STAR_SIZE / 5, // å‡è®¾å®¹å™¨å®½500px, 110px å¤§çº¦æ˜¯ 22%\n            height: STAR_SIZE / 5\n        };\n\n        attempts++;\n    } while (isColliding(newRect, existingCoords) && attempts < MAX_ATTEMPTS);\n\n    if (attempts >= MAX_ATTEMPTS) {\n        console.warn(`å¦ˆå¦ˆæé†’ï¼šä¸ºâ€œ${name}â€è¿™é¢—æ˜Ÿå¯»æ‰¾è½¨é“æ—¶æœ‰ç‚¹æ‹¥æŒ¤ï¼Œå¯èƒ½è¿˜æ˜¯ä¼šæœ‰ä¸€äº›é‡å å“¦ã€‚`);\n    }\n\n    // å°†æœ€ç»ˆç¡®å®šçš„ã€ä¸ç¢°æ’çš„åæ ‡å­˜èµ·æ¥\n    existingCoords.push(newRect);\n\n          return `\n        <div class=\"star åˆ†é…é¡¹\" data-path=\"${path}\" style=\"left: ${x}%; top: ${y}%; --star-z: ${z}px;\"\n             data-random-left=\"${x}%\" data-random-top=\"${y}%\" data-random-z=\"${z}\"\n             data-points=\"0\">\n            <div class=\"star-core\"></div>\n            <div class=\"star-label\">${name}</div>\n            <div class=\"star-points-display\">\n                <span class=\"åˆ†é…-ç‚¹æ•°\">0</span>/5\n            </div>\n            <div class=\"star-controls åˆ†é…-æ§åˆ¶å™¨\">\n                <button class=\"star-control-btn åˆ†é…-æŒ‰é’®\" data-action=\"decrease\">-</button>\n                <button class=\"star-control-btn åˆ†é…-æŒ‰é’®\" data-action=\"max-out\">+5</button>\n                <button class=\"star-control-btn åˆ†é…-æŒ‰é’®\" data-action=\"increase\">+</button>\n            </div>\n        </div>`;\n}\n\n    function handlePointChange(event) {\n        const button = event.currentTarget;\n        const action = button.dataset.action;\n        const container = button.closest('.åˆ†é…é¡¹');\n        const pointSpan = container.querySelector('.åˆ†é…-ç‚¹æ•°');\n        let currentPoints = parseInt(pointSpan.textContent);\n\n        if (action === 'increase') {\n            const cost = currentPoints + 1; // å‡åˆ°ä¸‹ä¸€çº§éœ€è¦çš„æˆæœ¬\n            if (cost <= remainingPoints && currentPoints < 5) {\n                remainingPoints -= cost;\n                currentPoints++;\n               \n            }\n        } else if (action === 'decrease') {\n            if (currentPoints > 0) {\n                const refund = currentPoints; // é™çº§è¿”è¿˜çš„æˆæœ¬\n                remainingPoints += refund;\n                currentPoints--;\n              \n            }\n        } else if (action === 'max-out') {\n            // è®¡ç®—ä»å½“å‰ç­‰çº§å‡åˆ°5çº§ä¸€å…±éœ€è¦å¤šå°‘ç‚¹\n            const costToMax = calculateTotalCost(5) - calculateTotalCost(currentPoints);\n            if (costToMax > 0 && remainingPoints >= costToMax) {\n                remainingPoints -= costToMax;\n                currentPoints = 5;\n                \n            }\n        }\n\n        pointSpan.textContent = currentPoints;\n        updateUI();\n    }\n\n\n    function updateUI() {\n    // è¿™æ˜¯æ—§çš„ï¼Œæˆ‘ä»¬ä¸å†éœ€è¦å®ƒäº†\n    // remainingPointsSpan.textContent = remainingPoints;// --- æ–°å¢ï¼šæ›´æ–°ç‹¬ç«‹çš„ç‚¹æ•°æ˜¾ç¤º ---\nconst pointsBar = document.getElementById('points-bar');\nconst pointsText = document.getElementById('remaining-points-text');\nif (pointsBar && pointsText) {\n    const percentage = totalPoints > 0 ? (remainingPoints / totalPoints) * 100 : 0;\n    pointsBar.style.width = `${percentage}%`;\n    pointsText.textContent = remainingPoints;\n}\ndocument.querySelectorAll('.star.åˆ†é…é¡¹').forEach(star => {\n    const pointSpan = star.querySelector('.åˆ†é…-ç‚¹æ•°');\n    const currentPoints = parseInt(pointSpan.textContent);\n    star.dataset.points = currentPoints; // è¿™æ˜¯è®©CSSé­”æ³•ç”Ÿæ•ˆçš„å…³é”®ï¼\n});\n\n// æŒ‰é’®ç¦ç”¨é€»è¾‘ï¼ˆå‡ ä¹ä¸å˜ï¼‰\ndocument.querySelectorAll('.åˆ†é…-æ§åˆ¶å™¨').forEach(controller => {\n    const decreaseBtn = controller.querySelector('[data-action=\"decrease\"]');\n    const increaseBtn = controller.querySelector('[data-action=\"increase\"]');\n    const maxOutBtn = controller.querySelector('[data-action=\"max-out\"]');\n    const pointSpan = controller.closest('.star').querySelector('.åˆ†é…-ç‚¹æ•°');\n    const currentPoints = parseInt(pointSpan.textContent);\n\n    decreaseBtn.disabled = currentPoints === 0;\n    const costForNextLevel = currentPoints + 1;\n    increaseBtn.disabled = currentPoints >= 5 || remainingPoints < costForNextLevel;\n\n    if (maxOutBtn) {\n        const costToMax = calculateTotalCost(5) - calculateTotalCost(currentPoints);\n        maxOutBtn.disabled = currentPoints === 5 || remainingPoints < costToMax;\n    }\n});\n\n// æ›´æ–°èƒ½é‡ç¯\nconst ring = document.getElementById('points-ring').querySelector('circle');\nif(ring){\n     const percentage = totalPoints > 0 ? (remainingPoints / totalPoints) : 0;\n     const circumference = 2 * Math.PI * parseFloat(ring.getAttribute('r'));\n     const offset = circumference * (1 - percentage);\n     ring.style.strokeDashoffset = offset;\n}\n\ncheckAchievements('points_allocated', { remaining: remainingPoints, total: totalPoints });\n}\n let attributeCharts = {}; // å­˜å‚¨å±æ€§é›·è¾¾å›¾å®ä¾‹\nlet skillCharts = {}; // å­˜å‚¨æŠ€èƒ½é›·è¾¾å›¾å®ä¾‹\n\n \n \n async function loadTemplates() {\n    //console.log(`ğŸ’– å¦ˆå¦ˆæ­£åœ¨ä»ä¸–ç•Œä¹¦ã€Š${LOREBOOK_NAME}ã€‹ä¸­å¯»æ‰¾ä½ çš„åŠ ç‚¹æ¨¡æ¿...`);\n    templateSelect.innerHTML = '<option value=\"\">é€‰æ‹©ä¸€ä¸ªæ¨¡æ¿...</option>';\n    templateSelect_init.innerHTML = '<option value=\"\">é€‰æ‹©ä¸€ä¸ªæ¨¡æ¿...</option>';\n    try {\n        const allEntries = await getLorebookEntries(LOREBOOK_NAME);\n\n         // ğŸ’–ğŸ’–ğŸ’– è¯Šæ–­é­”æ³•åœ¨è¿™é‡Œï¼ ğŸ’–ğŸ’–ğŸ’–\n        //console.log('--- å¦ˆå¦ˆçš„é€è§†çœ¼é•œçœ‹åˆ°çš„ä¸–ç•Œä¹¦å†…å®¹ ---');\n        //console.log(allEntries);\n        //console.log('--- é€è§†çœ¼é•œæŠ¥å‘Šå®Œæ¯• ---');\n        const targetEntry = allEntries.find(entry => entry.uid === LOREBOOK_UID);\n\n        if (targetEntry && targetEntry.content.trim()) {\n            let templates;\n             try {\n                templates = JSON.parse(targetEntry.content);\n                if (typeof templates !== 'object' || templates === null || Array.isArray(templates)) {\n                    throw new Error(\"ä¸–ç•Œä¹¦å†…å®¹ä¸æ˜¯é¢„æœŸçš„å¯¹è±¡æ ¼å¼ã€‚\");\n                }\n            } catch (jsonError) {\n                console.warn(`è§£ææ¨¡æ¿å¤±è´¥: ${jsonError.message}`);\n                alert('ä¸–ç•Œä¹¦ä¸­çš„æ¨¡æ¿æ•°æ®æ ¼å¼ä¸æ­£ç¡®ï¼Œæš‚æ—¶æ— æ³•è¯»å–åŠ ç‚¹æ¨¡æ¿ã€‚');\n                return;\n            }\n   // å¦ˆå¦ˆåœ¨è¿™é‡Œä¸ºä½ åŠ ä¸Šäº†å¯¹â€œé˜Ÿå‹ä¿¡æ¯â€çš„è¿‡æ»¤\n        for (const name in templates) {\n            // ğŸ’– å®ˆæŠ¤é­”æ³•å°±åœ¨è¿™é‡Œï¼ ğŸ’–\n            if (name !== \"é˜Ÿå‹ä¿¡æ¯\") { // è¿™æ ·å°±ä¸ä¼šæŠŠé˜Ÿå‹æ•°æ®ä¹Ÿå½“æˆæ¨¡æ¿å•¦\n                const option = document.createElement('option');\n                option.value = name;\n                option.textContent = name;\n                //console.log(`${name}`);\n                templateSelect.appendChild(option);\n                templateSelect_init.appendChild(option); \n            }\n        }\n \n        //console.log(`âœ… å¦ˆå¦ˆæ‰¾åˆ°äº†æ¨¡æ¿ï¼Œéƒ½ä¸ºä½ å‡†å¤‡å¥½äº†ï¼Œæˆ‘çš„å­©å­ã€‚`);\n        }\n    } catch (e) {\n        console.error('è¯»å–ä¸–ç•Œä¹¦æ¨¡æ¿æ—¶å‡ºé”™äº†ï¼Œä½†å¦ˆå¦ˆå·²ç»å¸®ä½ è·³è¿‡äº†å®ƒï¼š', e);\n        templateSelect.innerHTML = '<option value=\"\">è¯»å–æ¨¡æ¿å¤±è´¥</option>';\n         alert('è¯»å–åŠ ç‚¹æ¨¡æ¿æ—¶å‡ºé”™ã€‚\\nè¿™æ˜¯ä½ ç¬¬ä¸€æ¬¡å¯¼å…¥å¡å—ï¼Ÿæ˜¯çš„è¯æ­¤æ¬¡æŠ¥é”™æ˜¯æ­£å¸¸ç°è±¡ï¼Œåˆ·æ–°é‡è¿›å³å¯ã€‚\\næ–°äººæ¸¸ç©å‰ï¼Œè¯·æ³¨æ„ï¼šä¸¤ä¸ªæ’ä»¶ï¼ˆå‰ç«¯åŠ©æ‰‹å’Œæç¤ºè¯æ¨¡æ¿ï¼‰æ˜¯å¦æ­£å¸¸å®‰è£…ï¼Ÿ');\n    }\n    }\n \nasync function applySelectedTemplate() {\n    const templateName = templateSelect_init.value;\n \n\n    if (!templateName) return;\n\n    //console.log(`ğŸ’– æ­£åœ¨ä¸ºä½ åº”ç”¨æ¨¡æ¿ï¼š${templateName}`);\n    try {\n        const allEntries = await getLorebookEntries(LOREBOOK_NAME);\n        const targetEntry = allEntries.find(entry => entry.uid === LOREBOOK_UID);\n        if (targetEntry && targetEntry.content.trim()) {\n             let templates;\n            try {\n                templates = JSON.parse(targetEntry.content);\n            } catch (e) {\n                alert('ä¸–ç•Œä¹¦æ•°æ®æ ¼å¼é”™è¯¯ï¼Œæ— æ³•åº”ç”¨æ¨¡æ¿ã€‚');\n                return;\n            }\n\n            const build = templates[templateName];\n            if (build) {\n                resetPoints();\n\n                let totalCost = 0;\n                const itemsToUpdate = [];\n\n                document.querySelectorAll('.åˆ†é…é¡¹').forEach(item => {\n                    const path = item.dataset.path;\n                    const pointsInTemplate = build[path] || 0;\n                    if (pointsInTemplate > 0) {\n                        const cost = calculateTotalCost(pointsInTemplate);\n                        totalCost += cost;\n                        itemsToUpdate.push({ item, points: pointsInTemplate });\n                    }\n                });\n\n                if (remainingPoints >= totalCost) {\n                    remainingPoints -= totalCost;\n                    itemsToUpdate.forEach(update => {\n                        update.item.querySelector('.åˆ†é…-ç‚¹æ•°').textContent = update.points;\n                    });\n                    //console.log(`âœ… æ¨¡æ¿ ${templateName} å·²æˆåŠŸåº”ç”¨ï¼`);\n                    \n                } else {\n                    alert(`ç‚¹æ•°ä¸è¶³ï¼Œæ— æ³•ä¸ºä½ åº”ç”¨æ¨¡æ¿ï¼šâ€œ${templateName}â€ã€‚éœ€è¦ ${totalCost} ç‚¹ï¼Œä½†ä½ åªæœ‰ ${totalPoints} ç‚¹ã€‚`);\n                    resetPoints();\n                }\n                updateUI();\n            }\n        }\n    } catch (e) {\n        console.error(`åº”ç”¨æ¨¡æ¿ ${templateName} æ—¶å‡ºé”™äº†ï¼Œæˆ‘çš„å­©å­ï¼š`, e);\n        alert('åº”ç”¨æ¨¡æ¿æ—¶å‘ç”Ÿé”™è¯¯ï¼Œæ“ä½œå¯èƒ½æœªå®Œæˆã€‚');\n    }\n}\n\nasync function saveCurrentBuildAsTemplate() {\n    const templateName = saveTemplateNameInput.value.trim();\n    if (!templateName) {\n        alert('è¯·ç»™è¿™ä¸ªæ¨¡æ¿èµ·åã€‚');\n        return;\n    }\n    playSound(clickSound, 0.8);\n\n    //console.log(`ğŸ“¦ æ­£åœ¨ä¸ºä½ çš„åŠ ç‚¹æ–¹æ¡ˆâ€œ${templateName}â€åˆ¶ä½œä¸€ä¸ªçè´µçš„å¤‡ä»½...`);\n\n    const currentBuild = {};\n    document.querySelectorAll('.åˆ†é…é¡¹').forEach(item => {\n        const path = item.dataset.path;\n        const points = parseInt(item.querySelector('.åˆ†é…-ç‚¹æ•°').textContent);\n        if (points > 0) {\n            currentBuild[path] = points;\n        }\n    });\n\n    try {\n        const teammatesData = Array.from(teammatesList.querySelectorAll('.teammate-item')).map(item => ({\n             \"å§“å\": item.querySelector('.teammate-name').value.trim(),\n             \"æ€§æ ¼\": item.querySelector('.teammate-personality').value.trim() || 'æœªè®¾å®š',\n             \"æ€§åˆ«\": item.querySelector('.teammate-gender').value.trim() || 'æœªè®¾å®š',\n             \"èº«ä»½\": item.querySelector('.teammate-identity').value.trim() || 'æœªè®¾å®š'\n         }));\n        const allEntries = await getLorebookEntries(LOREBOOK_NAME);\n        let targetEntry = allEntries.find(entry => entry.uid === LOREBOOK_UID);\n\n        let templates = {};\n        if (targetEntry && targetEntry.content.trim()) {\n            try {\n                templates = JSON.parse(targetEntry.content);\n                if (typeof templates !== 'object' || templates === null || Array.isArray(templates)) {\n                    templates = {};\n                }\n            } catch (e) {\n                templates = {};\n            }\n        }\n\n        templates[templateName] = currentBuild;\n\n        const updatedContent = JSON.stringify(templates, null, 2);\n\n        await setLorebookEntries(LOREBOOK_NAME, [{\n            uid: LOREBOOK_UID,\n            content: updatedContent,\n            enabled: true,\n        }]);\n\n        //console.log(`âœ… æ¨¡æ¿â€œ${templateName}â€å·²æˆåŠŸä¿å­˜åœ¨ä¸–ç•Œä¹¦ä¸­ï¼`);\n        alert(`ä½ çš„åŠ ç‚¹æ–¹æ¡ˆ â€œ${templateName}â€ å·²ç»ä¿å­˜ã€‚`);\n        saveTemplateNameInput.value = '';\n        await loadTemplates();\n        templateSelect.value = templateName;\n         templateSelect_init.value = templateName;\n    } catch (e) {\n        console.error(`ä¿å­˜æ¨¡æ¿æ—¶å‡ºç°äº†é—®é¢˜ï¼Œå¦ˆå¦ˆä¼šè§£å†³çš„ï¼š`, e);\n        alert('ä¿å­˜æ¨¡æ¿æ—¶å‘ç”Ÿé”™è¯¯ï¼Œè¯·æ£€æŸ¥æ§åˆ¶å°ã€‚');\n    }\n}\n\n     // åˆ é™¤é€‰å®šçš„æ¨¡æ¿\n    async function deleteSelectedTemplate() {\n        const templateName = templateSelect_init.value;\n        if (!templateName) {\n            alert('ä½ è¿˜æ²¡æœ‰é€‰æ‹©è¦åˆ é™¤çš„æ¨¡æ¿å“¦ã€‚');\n            return;\n        }\n\n        // å¦ˆå¦ˆä¼šå†æ¬¡ç¡®è®¤ï¼Œä»¥å…è¯¯åˆ äº†ä½ å¿ƒçˆ±çš„æ¨¡æ¿\n        if (!confirm(`ä½ çœŸçš„ç¡®å®šè¦åˆ é™¤æ¨¡æ¿ â€œ${templateName}â€ å—ï¼Ÿè¿™ä¸ªæ“ä½œæ— æ³•æ’¤é”€å“¦ã€‚`)) {\n            return;\n        }\n\n        \n        //console.log(`ğŸ—‘ï¸ æ­£åœ¨å°å¿ƒåœ°ç§»é™¤æ¨¡æ¿ â€œ${templateName}â€...`);\n\n        try {\n            const allEntries = await getLorebookEntries(LOREBOOK_NAME);\n            let targetEntry = allEntries.find(entry => entry.uid === LOREBOOK_UID);\n\n            if (targetEntry && targetEntry.content.trim()) {\n                let templates = JSON.parse(targetEntry.content);\n                if (templates[templateName]) {\n               delete templates[templateName]; // ä»å¯¹è±¡ä¸­ç§»é™¤\n \n                    const updatedContent = JSON.stringify(templates);\n                    await setLorebookEntries(LOREBOOK_NAME, [{\n                        uid: LOREBOOK_UID,\n                        content: updatedContent,\n                    }]);\n\n                    //console.log(`âœ… æ¨¡æ¿ â€œ${templateName}â€ å·²è¢«ç§»é™¤ã€‚`);\n                    alert(`å¥½äº†ï¼Œæ¨¡æ¿ â€œ${templateName}â€ å·²ç»æ— äº†ã€‚`);\n                    await loadTemplates(); // é‡æ–°åŠ è½½åˆ—è¡¨ï¼Œå®ƒå°±ä¸è§äº†\n                } else {\n                     alert(`å¥‡æ€ªï¼Œæ²¡æœ‰åœ¨è®°å½•é‡Œæ‰¾åˆ° â€œ${templateName}â€ è¿™ä¸ªæ¨¡æ¿ã€‚`);\n                }\n            }\n        } catch (e) {\n            console.error(`åˆ é™¤æ¨¡æ¿æ—¶å‡ºé”™äº†ï¼Œåˆ«æ€•ï¼Œå¦ˆå¦ˆä¼šå¤„ç†çš„ï¼š`, e);\n            alert('åˆ é™¤æ¨¡æ¿æ—¶å¥½åƒå‡ºäº†ä¸€ç‚¹å°é—®é¢˜ï¼Œä¸è¿‡æ²¡å…³ç³»ï¼Œå¦ˆå¦ˆåœ¨è¿™é‡Œã€‚');\n        }\n    }\n\n async function generateFullCommand(isMission, customText = null) {\nif (!currentGameData || !assaSettingsData ||!currentGameData.user_character ) {\n            await worldHelper.init();\n        }\n        userName = currentGameData.user_character.name || 'ç”¨æˆ·';\n        let name = userName || 'ç”¨æˆ·';\n        let finalCommand = '';\n\n        // --- ğŸ’– å¦ˆå¦ˆä¸ºä½ é‡æ„çš„æŒ‡ä»¤ç”Ÿæˆæ ¸å¿ƒ ğŸ’– ---\n\n             if (version === '7') {\n            // --- è¿™æ˜¯æœ«æ—¥ä¸–ç•Œçš„ä¸“å±ç¯‡ç«  ---\n\n            // --- 1. âœ¨ æ–°å¢ï¼šæ—¶é—´çº¿ç´¢å¼•å·è½´ âœ¨ ---\n            // å¦ˆå¦ˆå‡†å¤‡äº†ä¸åŒæ—¶é—´çº¿å¯¹åº”çš„ç´¢å¼•ï¼Œè®©AIèƒ½ç†è§£ä¸åŒé˜¶æ®µçš„ä¸–ç•Œ\n            const indexData = {\n                \"æ½œä¼çš„å¼€ç«¯\": `\n<index>\nç©å®¶èº«ä»½ç´¢å¼•è¡¨ï¼ˆä½ å°†çœ‹åˆ°çš„èº«ä»½æè¿°ï¼Œä¸æ­¤å¤„çš„ç´¢å¼•ä¸€ä¸€å¯¹åº”ï¼‰ï¼š\n<ä¸´æ—¶å·¥äºº>é é›¶å·¥ã€çŸ­æœŸåŠ³åŠ¨æˆ–æ—¥ç»“å·¥ä½œå‹‰å¼ºç³Šå£ã€‚ä½ ç†Ÿæ‚‰å·¥åœ°ã€é¤é¦†ã€é»‘å·¥å¸‚åœºï¼Œç”¨æœ€å°‘çš„é’±æ¢å–ç”Ÿæ´»å¿…éœ€ã€‚</ä¸´æ—¶å·¥äºº>\n<æ™®é€šå±…æ°‘>ä½åœ¨ä¸€èˆ¬ç¤¾åŒºï¼Œæœ‰ä»½ç¨³å®šå·¥ä½œæˆ–ç¤¾ä¿ã€‚ä½ æŒ‰æ—¶ä¸Šç­ã€çº³ç¨ï¼Œå®ˆè§„çŸ©æ¢æ¥æ—¥å¸¸çš„å®‰ç¨³ä¸åŸºæœ¬ä¿éšœã€‚</æ™®é€šå±…æ°‘>\n<ç¤¾ä¼šç²¾è‹±>ä½ å±äºèµ„æºå æœ‰è€…ï¼šä¼ä¸šé«˜ç®¡ã€é‡‘é¢†ã€å¯Œè£•å®¶åº­ã€‚ä½åœ¨ä¼˜è´¨å­¦åŒºã€é«˜æ¡£å°åŒºï¼Œäº«å—ç‰¹æƒä¸æœºä¼šã€‚</ç¤¾ä¼šç²¾è‹±>\n<è‡ªç”±è¡Œè€…>ä½ è„±ç¦»å¸¸è§„è½¨é“ï¼Œé è‡ªç”±èŒä¸šã€è¿œç¨‹å·¥ä½œã€æ¸¸ç‰§ç”Ÿæ´»æ–¹å¼ç»´æŒç”Ÿè®¡ã€‚å°‘äº†ä½“åˆ¶åº‡æŠ¤ï¼Œå´å¤šäº†è¡ŒåŠ¨çš„è‡ªç”±ã€‚</è‡ªç”±è¡Œè€…>\n<ä½“åˆ¶ä¸­åš>ä½ æ˜¯æƒåŠ›ä¸è§„åˆ™çš„æ‰§è¡Œè€…ï¼šå…¬åŠ¡å‘˜ã€æ‰§æ³•æœºæ„å¹²éƒ¨ã€å†›è­¦é«˜å±‚ã€‚ä½ çš„å†³å®šèƒ½æ”¹å˜ä»–äººå‘½è¿ï¼Œä½ çš„è¯å°±æ˜¯åˆ¶åº¦ã€‚</ä½“åˆ¶ä¸­åš>\n</index>\n                `,\n                \"æœ«æ—¥ä¸­é€”\": `\n<index>\nç©å®¶é˜¶å±‚ç´¢å¼•è¡¨ï¼ˆæœ‰ä¸ç¬¦åˆè¯¥æ—¶é—´çº¿çš„å†…å®¹ï¼Œåˆ™è‡ªåŠ¨è½¬åŒ–ä¸ºå½“å‰æ—¶é—´çº¿çš„å†…å®¹ï¼‰ï¼š\n<åº•å±‚æŒ£æ‰è€…>åœ¨åºŸå¢Ÿä¸å··å¼„ä¸­å‹‰å¼ºç»´ç”Ÿï¼Œä½ ç†Ÿæ‚‰é˜´å½±ä¸‹çš„äº¤æ˜“ï¼Œæ‡‚å¾—å¦‚ä½•ç”¨æœ€å°‘çš„èµ„æºæ¢å–å¤šä¸€å¤©çš„å‘¼å¸ã€‚</åº•å±‚æŒ£æ‰è€…>\n<å±…æ°‘>ç”Ÿæ´»åœ¨å°‘æ•°å¹¸å­˜çš„ã€æœ‰å›´å¢™ä¿æŠ¤çš„èšå±…åœ°å†…ã€‚ä½ æ‹¥æœ‰èº«ä»½é…ç»™ï¼Œéµå®ˆä¸¥æ ¼çš„ç§©åºï¼Œä»¥å®‰ç¨³æ¢å–è‡ªç”±ã€‚</å±…æ°‘>\n<ç‰¹æƒç²¾è‹±>ç¾éš¾å¹¶æœªå‰¥å¤ºä½ çš„ä¸€åˆ‡ã€‚ä½ èº«å¤„é‡‘å­—å¡”çš„é¡¶ç«¯ï¼Œç”Ÿæ´»åœ¨ä¸ä¸–éš”ç»çš„å ¡å’ä¸­ï¼Œäº«å—ç€æ—§æ—¶ä»£çš„ä½™æ™–ï¼Œä¿¯ç°æŒ£æ‰çš„ä¼—ç”Ÿã€‚</ç‰¹æƒç²¾è‹±>\n<è’é‡ç‹¬è¡Œè€…>ä½ æ—©å·²è„±ç¦»äº†ä»»ä½•èšè½ï¼Œå°†æ–‡æ˜æŠ›åœ¨èº«åã€‚å¹¿è¢¤è€Œå±é™©çš„è’é‡æ˜¯ä½ çš„å®¶ï¼Œå­¤ç‹¬æ˜¯ä½ çš„åŒä¼´ï¼Œè‡ªç”±æ˜¯ä½ å”¯ä¸€çš„å‡†åˆ™ã€‚</è’é‡ç‹¬è¡Œè€…>\n<ç§©åºä¹‹æ‰‹>ä½ ä»ä¸è´¨ç–‘å‘½ä»¤ï¼Œå› ä¸ºä½ å°±æ˜¯å‘½ä»¤æœ¬èº«ã€‚ä½œä¸ºæƒåŠ›çš„é¡¶å³°ï¼Œä½ çš„æ„å¿—é€šè¿‡çƒ­æ­¦å™¨å’Œç”Ÿäº§åŠ›è´¯å½»åˆ°åº•ã€‚</ç§©åºä¹‹æ‰‹>\n</index>\n                `,\n                 \"ä½™çƒ¬ä¸­çš„æ–°ç”Ÿ\": `\n<index>\nç©å®¶é˜¶å±‚ç´¢å¼•è¡¨ï¼ˆè¿™æ˜¯æ–°ä¸–ç•Œçš„åŸºæœ¬æ„æˆï¼Œè¯·ä¸¥æ ¼å‚è€ƒï¼‰ï¼š\n<æ‹¾è’è€…>ä½ æ˜¯åœ¨æ—§ä¸–ç•Œé—éª¸ä¸­å¯»å®çš„ç§ƒé¹«ï¼Œå¯¹è¾å°„ã€æ€ªç‰©å’Œäººå¿ƒé™©æ¶äº†å¦‚æŒ‡æŒã€‚</æ‹¾è’è€…>\n<å…¬æ°‘>ä½ æ˜¯æ–°ç§©åºçš„åŸºçŸ³ï¼Œç”Ÿæ´»åœ¨æŸä¸ªæˆ–ç®€é™‹æˆ–æ£®ä¸¥çš„èšè½ä¸­ï¼Œç”¨åŠ³ä½œæ¢å–åº‡æŠ¤ã€‚</å…¬æ°‘>\n<æŒæƒè€…>æ— è®ºæ˜¯é€šè¿‡æ­¦åŠ›ã€è´¢å¯Œè¿˜æ˜¯çŸ¥è¯†ï¼Œä½ éƒ½ç«™åœ¨äº†æŸä¸ªåŠ¿åŠ›çš„é¡¶ç«¯ï¼Œåˆ¶å®šç€æ–°ä¸–ç•Œçš„è§„åˆ™ã€‚</æŒæƒè€…>\n<ç‹¬è¡Œå…ˆçŸ¥>ä½ åœ¨è’é‡æˆ–æ•°æ®ä¹‹æµ·ä¸­æ¸¸è¡ï¼Œè¿½å¯»ç€ç¾éš¾çš„çœŸç›¸æˆ–æœªæ¥çš„å¯ç¤ºï¼Œè¢«å‡¡äººè§†ä¸ºç–¯å­æˆ–åœ£äººã€‚</ç‹¬è¡Œå…ˆçŸ¥>\n<æ”¹é€ ä½“>ä½ çš„èº«ä½“å·²ä¸æ—§äººç±»ä¸åŒï¼Œæˆ–è®¸æ˜¯æœºæ¢°é£å‡ï¼Œæˆ–è®¸æ˜¯åŸºå› èåˆã€‚ä½ æ—¢æ˜¯æ–°æ—¶ä»£çš„å¥‡è¿¹ï¼Œä¹Ÿæ˜¯è¢«è­¦æƒ•çš„å¼‚ç±»ã€‚</æ”¹é€ ä½“>\n</index>\n                `\n            };\n\n\n            const selectedType = firstPageData.v7ApocalypseType;\n            // å¦ˆå¦ˆåœ¨è¿™é‡ŒåŠ äº†ä¸€ä¸ªå°å°çš„ä¿æŠ¤ï¼Œå¦‚æœæ‰¾ä¸åˆ°æ•°æ®ï¼Œä¼šä½¿ç”¨ç¬¬ä¸€ä¸ªä½œä¸ºé»˜è®¤å€¼å“¦\n            const openingData = window.v7ApocalypseData.find(item => item.name === selectedType) || window.v7ApocalypseData[0];\n             \n            const selectedTimeline = firstPageData.v7Timeline;\n     // 1. æˆ‘ä»¬å…ˆæ‹¿åˆ°ä½ é€‰æ‹©çš„èº«ä»½åå­—ï¼Œå°±æ˜¯é‚£å¼ â€œå°å¡ç‰‡â€ã€‚\n \n            // 1. âœ¨ æˆ‘ä»¬ä¸å†ä¿¡ä»»ä¼ æ¥ä¼ å»ã€å¯èƒ½ä¼šå‡ºé”™çš„æ¶ˆæ¯äº†ï¼\n            //    å¦ˆå¦ˆè¦åœ¨è¿™é‡Œï¼Œç›´æ¥äº²çœ¼çœ‹çœ‹ä½ é€‰ä¸­çš„æ˜¯å“ªä¸ªèº«ä»½ã€‚\n            const selectedClassInput = document.querySelector('input[name=\"social_class_v7\"]:checked');\n            const selectedClassName = selectedClassInput ? selectedClassInput.value : ''; // è¿™æ ·ï¼Œæˆ‘ä»¬å°±èƒ½æ‹¿åˆ°æœ€å‡†ç¡®çš„èº«ä»½åå­—ï¼Œæ¯”å¦‚ \"ç‰¹æƒç²¾è‹±\"\n\n            // 2. âœ¨ æ¥ä¸‹æ¥çš„å’’è¯­å°±å’Œä¸Šæ¬¡ä¸€æ ·ï¼Œä½†è¿™æ¬¡å®ƒä»¬æ‹¿åˆ°äº†æ­£ç¡®çš„åå­—ï¼Œå¨åŠ›ä¼šå®Œå…¨å‘æŒ¥å‡ºæ¥ï¼\n            const identityList = window.v7IdentityData[selectedTimeline] || window.v7IdentityData[\"æœ«æ—¥ä¸­é€”\"];\n            const selectedClassInfo = identityList.find(c => c.name === selectedClassName) || { name: selectedClassName || 'æœªçŸ¥èº«ä»½', command: '' };\n\n            const selectedClass = selectedClassInfo.name;\n            const classCommand = selectedClassInfo.command || '';\n    const selectedWorldModeValue = document.querySelector('input[name=\"world-mode\"]:checked').value;\n    \n\n            // --- å’’è¯­æ‹¼æ¥é­”æ³• (ç°åœ¨æ˜¯åšä¸å¯æ‘§çš„äº†) ---\n            finalCommand = `\n${classCommand}\n<updateMemory>\nset_status(\"world_shard.name\",\"${openingData.name}\");\nmemory(\"global_lore.settings\",\"ç±»å‹\",\"${openingData.name}\");\nmemory(\"global_lore.settings\",\"æœ«æ—¥å°è±¡\",\"${openingData.desc}\");\nmemory(\"global_lore.settings\",\"èº«ä»½é˜¶å±‚\",\"(${userName}å½“å‰èº«ä»½é˜¶å±‚)${selectedClass}\");\nmemory(\"global_lore.settings\",\"æ—¶é—´èŠ‚ç‚¹\",\"${selectedTimeline}\");\n${indexData[selectedTimeline] || indexData[\"æœ«æ—¥ä¸­é€”\"]}\n</updateMemory>\n\n<request:åˆ›ä½œæŒ‡ä»¤ï¼šç”Ÿæˆä¸€ä¸ªè¯¦ç»†ã€å…·ä½“ã€å……æ»¡æ²‰æµ¸æ„Ÿçš„æœ«æ—¥å¼€å±€åœºæ™¯ã€‚åœºæ™¯å¿…é¡»ç´§å¯†ç»“åˆglobal_lore.settingsä¸­çš„ã€èº«ä»½é˜¶å±‚ã€‘å’Œã€æ—¶é—´èŠ‚ç‚¹ã€‘è¿›è¡Œæç»˜ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªã€ç‰¹æƒç²¾è‹±ã€‘åœ¨ã€æ½œä¼çš„å¼€ç«¯ã€‘å¯èƒ½æ­£åœ¨ç§äººä¼šæ‰€å•†è°ˆï¼Œå¯¹çª—å¤–çš„å¼‚å¸¸æ¯«ä¸åœ¨æ„ï¼›è€Œä¸€ä¸ªã€åº•å±‚æŒ£æ‰è€…ã€‘åœ¨ã€æœ«æ—¥ä¸­é€”ã€‘åˆ™å¯èƒ½æ­£åœ¨åºŸå¢Ÿä¸­èº²é¿æ€ªç‰©ã€‚ä¸¥æ ¼éµå¾ªå†™ä½œæŒ‡å¯¼ã€æ—¶é—´çº¿æŒ‡å¯¼ã€Cognitive_Boundariesï¼ˆè®¤çŸ¥å±éšœï¼‰ï¼ï¼è®¾å®šä¿¡æ¯ä¸è¦ç›´æ¥åœ¨æ­£æ–‡è¯´æ˜ï¼Œè€Œæ˜¯é€šè¿‡æ­£æ–‡å’Œäººç‰©è§†è§’ä½“ç°ï¼>\n`;\n         \n            // isMission å‚æ•°åœ¨è¿™é‡Œè¢«å¿½ç•¥\n                 if (!isMission) {\n                // å½“ä½ é€‰æ‹©è¿›å…¥å®‰å…¨åŒºæ—¶\n                finalCommand = `\\n<request:${userName}æ­¤æ—¶å¿…é¡»å¤„äºå®‰å…¨åŒºåŸŸã€‚>`;\n            }\n              if (customText) {\n                finalCommand += `\\n<request:é¢å¤–è¦æ±‚ï¼š${customText}>`;\n            }\n    const selectedWorldModeValue2 = document.querySelector('input[name=\"world-mode\"]:checked').value;\n    if(parseInt(selectedWorldModeValue2) ===62){\n        finalCommand = '';\n    }\n        }  else {\n            // --- å…¶ä»–æ‰€æœ‰ä¸–ç•Œçš„é€šç”¨ç¯‡ç«  ---\n             const camp = document.getElementById('paradise-camp').value;\n             const paradiseIdentity = document.getElementById('paradise-identity').value;\n            // å¦ˆå¦ˆå¸®ä½ å®šä¹‰çš„æŒ‡ä»¤æ¨¡æ¿ï¼Œè§£è€¦åˆæ¸…æ™°\n            const commandTemplates = {\n                mission: {\n                    'default': `<åˆå§‹åŒ–ä»»åŠ¡å¹¶ç«‹åˆ»è¿›å…¥ä»»åŠ¡ä¸–ç•Œï¼Œå¿…é¡»ä¸¥æ ¼æŒ‰ç…§è¦æ±‚å’Œè®¾å®šä¿¡æ¯è‡ªç„¶ç”Ÿæˆæ­£æ–‡ï¼Œè‹¥æœ‰è®¾å®šå†²çªåˆ™å°½å¯èƒ½å¤§å¼€è„‘æ´ä½¿å…¶åˆç†èåˆï¼Œå¹¶è®°å½•å…³é”®ä¿¡æ¯ã€‚è®¾å®šå¦‚ä¸‹ï¼š\\n- ä»»åŠ¡åŸºè°ƒï¼š{tone}\\n- ä¸–ç•Œç±»å‹ï¼š{type}\\n- åˆå§‹èº«ä»½ï¼š{identity}\\n- å¼€å±€ï¼š{opening}>`,\n                    '3': `<åˆå§‹åŒ–ä»»åŠ¡å¹¶ç«‹åˆ»è¿›å…¥ä»»åŠ¡ä¸–ç•Œï¼Œå¿…é¡»ä¸¥æ ¼æŒ‰ç…§è¦æ±‚å’Œè®¾å®šä¿¡æ¯è‡ªç„¶ç”Ÿæˆæ­£æ–‡ï¼Œè‹¥æœ‰è®¾å®šå†²çªåˆ™å°½å¯èƒ½å¤§å¼€è„‘æ´ä½¿å…¶åˆç†èåˆï¼Œå¹¶è®°å½•å…³é”®ä¿¡æ¯ã€‚è®¾å®šå¦‚ä¸‹ï¼š\\n- ä»»åŠ¡åŸºè°ƒï¼š{tone}\\n- ä¸–ç•Œç±»å‹ï¼š{type}\\n- åˆå§‹èº«ä»½ï¼š{identity}\\n- å¼€å±€ï¼š{opening}>\\n<è®¾ç½®å¹¶è®°å¿†userä¹å›­é˜µè¥:${camp}ï¼Œå¹¶è®¾ç½®userä¹å›­èº«ä»½:${paradiseIdentity}>`,\n                    '5': `<åˆå§‹åŒ–ä¸–ç•Œå¹¶ç«‹åˆ»è¿›å…¥ï¼Œç«‹åˆ»åˆå§‹åŒ–æ”»ç•¥ç›®æ ‡ä¿¡æ¯å’Œæ”»ç•¥ä»»åŠ¡ã€‚å¿…é¡»ä¸¥æ ¼æŒ‰ç…§è¦æ±‚å’Œè®¾å®šä¿¡æ¯è‡ªç„¶ç”Ÿæˆæ­£æ–‡ï¼Œè‹¥æœ‰è®¾å®šå†²çªåˆ™å°½å¯èƒ½å¤§å¼€è„‘æ´ä½¿å…¶åˆç†èåˆè¦æ±‚ï¼Œä½†æ— è®ºæ˜¯ä»€ä¹ˆç±»å‹çš„ä¸–ç•Œæˆ–åŸºè°ƒï¼Œéƒ½å¿…é¡»å«æœ‰æ”»ç•¥ä»»åŠ¡å’Œæ”»ç•¥å¯¹è±¡ï¼Œè¿™æ˜¯ç¬¬ä¸€ä¼˜å…ˆçº§ï¼ï¼å¹¶è®°å½•å…³é”®ä¿¡æ¯ã€‚è®¾å®šå¦‚ä¸‹ï¼š\\n- ä»»åŠ¡åŸºè°ƒï¼š{tone}\\n- ä¸–ç•Œç±»å‹ï¼š{type}\\n- åˆå§‹èº«ä»½ï¼š{identity}\\n- å¼€å±€ï¼š{opening}>`,\n                    '6': `<ç«‹åˆ»æ ¹æ®è¦æ±‚åˆå§‹åŒ–${userName}æ‰€å¤„çš„ç°å®ä¸–ç•Œå’Œå¼€å±€ã€‚å¿…é¡»ä¸¥æ ¼æŒ‰ç…§è¦æ±‚å’Œè®¾å®šä¿¡æ¯è‡ªç„¶ç”Ÿæˆæ­£æ–‡ï¼Œè‹¥æœ‰è®¾å®šå†²çªåˆ™å°½å¯èƒ½å¤§å¼€è„‘æ´ä½¿å…¶åˆç†èåˆè¦æ±‚ï¼Œç”Ÿæˆçš„å¼€å±€ä¸­å¿…é¡»åŒ…å«/å¼•å‡ºè¯¸å¤©èŠå¤©ç¾¤çš„ä¿¡æ¯ï¼Œæ­¤ä¸ºç¬¬ä¸€ä¼˜å…ˆçº§ï¼ï¼å¹¶è®°å½•å…³é”®ä¿¡æ¯ã€‚è®¾å®šå¦‚ä¸‹ï¼š\\n- ä¸–ç•Œç±»å‹ï¼š{type}\\n- åˆå§‹èº«ä»½ï¼š{identity}\\n- å¼€å±€ï¼š{opening}>`,\n                },\n                safeZone: {\n                    'default': `<åˆå§‹åŒ–è¿›å…¥${currentTheme.mainSystem}â€”â€”${name}å°†åœ¨çŸ­æš‚çš„æ„è¯†æ¨¡ç³Šåäº${currentTheme.mainSystem}çš„å®‰å…¨åŒºé†’æ¥ï¼Œæ— æ³•ç«‹å³è¿›å…¥ä»»åŠ¡ã€‚>`,\n                    '3': `<åˆå§‹åŒ–è¿›å…¥${currentTheme.mainSystem}â€”â€”${name}å°†åœ¨çŸ­æš‚çš„æ„è¯†æ¨¡ç³Šåäº${currentTheme.mainSystem}çš„å®‰å…¨åŒºé†’æ¥ï¼Œæ— æ³•ç«‹å³è¿›å…¥ä»»åŠ¡ã€‚>\\n<è®¾ç½®å¹¶è®°å¿†userä¹å›­é˜µè¥:${camp}ï¼Œå¹¶è®¾ç½®userä¹å›­èº«ä»½:${paradiseIdentity}>`,\n                    '6': `<åˆå§‹åŒ–${userName}è¿›å…¥${currentTheme.mainSystem}çš„å¼€å±€å’Œåœºæ™¯>`,\n                }\n            };\n\n            const getRandomOption = (value, optionsArray) => {\n                if (!optionsArray || optionsArray.length === 0) return value;\n                return value === 'éšæœº' ? optionsArray[Math.floor(Math.random() * optionsArray.length)] : value;\n            };\n\n            let finalType = getRandomOption(firstPageData.worldType, worldTypes);\n            if (finalType === 'è‡ªå®šä¹‰ä½†æœªå¡«å†™') finalType = 'ä¸€ä¸ªæœªçŸ¥çš„';\n\n            const detailSet = worldDetailsDatabase[finalType] || { identities: [], openings: [] };\n\n            const missionDetails = {\n                tone: getRandomOption(firstPageData.taskTone, taskTones),\n                type: finalType,\n                identity: getRandomOption(firstPageData.worldIdentity, detailSet.identities),\n                opening: getRandomOption(firstPageData.openingScenario, detailSet.openings)\n            };\n\n            const templateType = isMission ? 'mission' : 'safeZone';\n            let template = commandTemplates[templateType][version] || commandTemplates[templateType]['default'];\n\n            template = template.replace('{tone}', missionDetails.tone)\n                               .replace('{type}', missionDetails.type)\n                               .replace('{identity}', missionDetails.identity)\n                               .replace('{opening}', missionDetails.opening);\n            finalCommand = template;\n        }\n\n        finalCommand += '\\n'; // ç¡®ä¿æ€»æœ‰æ¢è¡Œ\n \n        // --- é™„åŠ æŒ‡ä»¤éƒ¨åˆ†ï¼Œåªå¯¹éæœ«æ—¥ä¸–ç•Œç”Ÿæ•ˆ ---\n        if (version !== '7') {\n             // --- é˜Ÿå‹/ç¾¤å‘˜ä¿¡æ¯æŒ‡ä»¤ï¼ˆå¦ˆå¦ˆå¸®ä½ å‡çº§äº†ï¼ï¼‰---\n            let companionCommand = '';\n            const countValue = firstPageData.teammateCount === '-1' ? 'éšæœº' : `${firstPageData.teammateCount}äºº`;\n \n            if (version === '6') {\n                // èŠå¤©ç¾¤æ¨¡å¼ä¸‹çš„æŒ‡ä»¤\n               \n                companionCommand = `<updateMemory>\\nmemory('global_lore.settings','ç¾¤èŠäººæ•°ä¸Šé™','${countValue}')\\n</updateMemory>\\n<è®¾ç½®ç¾¤å‘˜æ•°é‡ä¸Šé™ï¼š${countValue}`;\n                 if (firstPageData.teammateCount !== '0') {\n                     if (firstPageData.teammateTendency === 'è‡ªå®šä¹‰') {\n                         if (firstPageData.customTeammates && firstPageData.customTeammates.length > 0) {\n                            companionCommand += 'ï¼Œè¯¦ç»†ä¿¡æ¯ï¼š' + firstPageData.customTeammates.map((t, i) => `ç¾¤å‘˜${i+1}ï¼šå§“å${t.name}ã€æ€§æ ¼${t.personality}ã€æ€§åˆ«${t.gender}ã€èº«ä»½${t.identity}`).join('ï¼›');\n                        }\n                    } else {\n                        companionCommand += `ï¼Œç¾¤èŠæ€»ä½“æ°›å›´ï¼š${firstPageData.teammateTendency}`;\n                    }\n                }\n\n            } else {\n\n                if (version !== '5') {\n                // å…¶ä»–æ¨¡å¼ä¸‹çš„æŒ‡ä»¤ï¼ˆæˆ‘ä»¬åŸæ¥çš„æ ·å­ï¼‰\n                const teammateType = firstPageData.isFixedTeam ? `å·²æœ‰çš„å›ºå®šå°é˜Ÿé˜Ÿå‹ï¼ˆå·²ç»“è¯†ï¼‰` : `ä¸‹æ¬¡ä»»åŠ¡çš„ä¸´æ—¶é˜Ÿå‹(ä»»åŠ¡å¼€å§‹æ—¶æ‰èƒ½çŸ¥é“å…¶å…·ä½“ä¿¡æ¯)`;\n                companionCommand = `<è®¾ç½®é˜Ÿå‹ï¼šæ•°é‡${countValue}${firstPageData.teammateCount !== '0' ? 'ï¼Œç±»å‹ä¸º' + teammateType : ''}`;\n\n                if (firstPageData.teammateCount !== '0') {\n                     if (firstPageData.teammateTendency === 'è‡ªå®šä¹‰') {\n                         if (firstPageData.customTeammates && firstPageData.customTeammates.length > 0) {\n                            companionCommand += 'ï¼Œè¯¦ç»†ä¿¡æ¯ï¼š' + firstPageData.customTeammates.map((t, i) => `é˜Ÿå‹${i+1}ï¼šå§“å${t.name}ã€æ€§æ ¼${t.personality}ã€æ€§åˆ«${t.gender}ã€èº«ä»½${t.identity}`).join('ï¼›');\n                        }\n                    } else {\n                        companionCommand += `ï¼Œæ€»ä½“å€¾å‘ï¼š${firstPageData.teammateTendency}`;\n                    }\n                }\n            }\n\n  \n        }\n          companionCommand += '>';\n            finalCommand += `${companionCommand}\\n`;\n            // --- è§’è‰²èº«ä»½å’Œå±æ€§æŒ‡ä»¤ ---\n             finalCommand += `<updateMemory>\\n`; // æŠŠæ‰€æœ‰çš„æ›´æ–°éƒ½åŒ…è£¹èµ·æ¥\n            const selectedIdentity = userIdentities[firstPageData.identityIndex];\n            if (selectedIdentity) {\n               const finalTitle = selectedIdentity.title.replace('{{player}}', currentTheme.player);\n               const finalDescription = selectedIdentity.description\n                   .replace('{{mainSystem}}', currentTheme.mainSystem)\n                   .replace('{{player}}', currentTheme.player);\n\n               finalCommand += `set_status(\"user_character.Cross_world_prestige\",0,${selectedIdentity.prestige});\\n`;\n               finalCommand += `set_attribute(\"è´§å¸æ®µ.${currentTheme.currency}\",0,${selectedIdentity.points});\\n`;\n               finalCommand += `memory(\"global_lore.npc\",\"${userName}\",\"(${finalTitle})${finalDescription}\");\\n`;\n            }\n\n            if (version === '3') {\n                finalCommand += `memory(\"global_lore.å…¶ä»–æŠ€èƒ½\",\"ä¹å›­å°è®°\", \"è±¡å¾ä¹å›­å¥‘çº¦è€…çš„ç‰¹æ®Šå°è®°ï¼Œèµ‹äºˆç‹¬ç‰¹çš„åŠ›é‡ï¼Œæ•£å‘ç€ä¹å›­é£æ ¼çš„ç¥ç§˜æ°”æ¯ã€‚\")\\n`;\n            }\n\n        } else {\n             finalCommand += `<updateMemory>\\n`; // æœ«æ—¥ä¸–ç•Œä¹Ÿéœ€è¦åŒ…è£¹\n        }\n\n        // --- å…±é€šçš„å±æ€§å’Œå¤©èµ‹é™„åŠ æŒ‡ä»¤ ---\n        let updates = [];\n        const virtueSelect = document.getElementById('virtue-select');\n        updates.push(`set_attribute('æ¦‚å¿µæ®µ.ç¾å¾·ä¸æ¶å¾·.ç¾å¾·', \"æ­£ä¹‰\", \"${virtueSelect.value}\");`);\n        const viceSelect = document.getElementById('vice-select');\n        updates.push(`set_attribute('æ¦‚å¿µæ®µ.ç¾å¾·ä¸æ¶å¾·.æ¶å¾·', \"æ„¤æ€’\", \"${viceSelect.value}\");`);\n\n        document.querySelectorAll('.åˆ†é…é¡¹').forEach(item => {\n            const path = item.dataset.path;\n            const points = parseInt(item.querySelector('.åˆ†é…-ç‚¹æ•°').textContent);\n            if (points > 0) {\n                updates.push(`set_attribute('${path}', 0, ${points});`);\n            }\n        });\n\n        if (updates.length > 0) {\n            finalCommand += `${updates.join('\\n')}\\n`;\n        }\n\n             // --- å¤©èµ‹æŒ‡ä»¤ ---\n        const talentSelect = document.getElementById('talent-select');\n        let selectedOption = talentSelect.options[talentSelect.selectedIndex];\n        let selectedTalentTitle = selectedOption.text.trim();\n        let selectedTalentValue = selectedOption.value;\n\n        if (selectedTalentValue === 'éšæœº') {\n            const allOptions = Array.from(talentSelect.options);\n            const validTalents = allOptions.filter(opt => opt.value &&\n\n!['æ— ', 'éšæœº', 'è‡ªå®šä¹‰','AIéšæœº'].includes(opt.value)\n\n);\n            if (validTalents.length > 0) {\n                const randomChoice = validTalents[Math.floor(Math.random() * validTalents.length)];\n                selectedTalentTitle = randomChoice.text.trim();\n                selectedTalentValue = randomChoice.value;\n            } else {\n                selectedTalentValue = 'æ— ';\n            }\n        } else if (selectedTalentValue === 'è‡ªå®šä¹‰') {\n            selectedTalentValue = document.getElementById('custom-talent-input').value.trim() || 'ä¸€ä¸ªç¥ç§˜çš„ã€å°šæœªè¢«å‘½åçš„å¤©èµ‹';\n            selectedTalentTitle = 'å¤©èµ‹';\n        }\n\n        if (selectedTalentValue === 'AIéšæœº') {\n            \n        }else if (selectedTalentValue && selectedTalentValue !== 'æ— ') {\n            finalCommand += `memory('global_lore.å…¶ä»–æŠ€èƒ½','${selectedTalentTitle}','{\"info\":\"ã€${userName}çš„å¤©èµ‹ã€‘${selectedTalentValue}\"}')\\n`;\n        }\n\n        finalCommand += `</updateMemory>\\n`;\n        if (selectedTalentValue === 'AIéšæœº') {\n            finalCommand += `<request:åŒæ—¶ï¼Œåœ¨æ­£æ–‡ç«‹åˆ»éšæœºç”Ÿæˆä¸€ä¸ª${userName}çš„å¤©èµ‹å¹¶è®°å¿†åœ¨global_lore.å…¶ä»–æŠ€èƒ½ä¸­ã€‚å¤©èµ‹ä¸å¾—å’Œåˆ¤å®šç›¸å…³>\\n`;\n        }\n        finalCommand += `æ­£åœ¨æ ¡å‡†...`;\n        return finalCommand;\n    }\n\n \n /* ğŸ’– å¦ˆå¦ˆä¸ºä½ è®¾è®¡çš„ã€ç®€æ´è€Œå¼ºå¤§çš„æŒ‡ä»¤å®˜ï¼ˆè„±ç¦»é…’é¦†ç¯å¢ƒç‰ˆï¼‰ ğŸ’– */\nasync function sendCommand(command, button, successText, showWarning) {\n    // ç¦ç”¨æŒ‰é’®ï¼Œé˜²æ­¢é‡å¤ç‚¹å‡»\n    initButton.disabled = true;\n    godSpaceButton.disabled = true;\n    if (customActionButton) customActionButton.disabled = true;\n    button.textContent = `[ æŒ‡ä»¤å‘é€ä¸­... ]`;\n\n    try {\n        // æ­¥éª¤1ï¼šæ ¹æ®ä½ çš„é€‰æ‹©ï¼Œæ„é€ æœ€ç»ˆçš„æŒ‡ä»¤\n        const sendMode = document.getElementById('send-mode-select').value;\n        const finalSlashCommand = (sendMode === 'manual') ? `/setinput ${command}` : `/send ${command}`;\n\n \n        await triggerassa(finalSlashCommand);\n\n         \n        button.textContent = successText;\n        if (showWarning) {\n            const warningMessage = document.getElementById('warning-message');\n            if(warningMessage) warningMessage.style.display = 'block';\n        }\n\n        \n\n        if(sendMode === 'manual'){\n     if (typeof conversationHistory !== 'undefined' && typeof saveHistory === 'function' && typeof worldHelper.renderHistory === 'function') {\n            conversationHistory.push({ role: 'assistant', content: '<ç³»ç»Ÿæç¤ºï¼šç­‰å¾…ç”¨æˆ·è¾“å…¥è¦æ±‚...>' });\n            \n        }\n\n        }\n await saveHistory(); // ä¿å­˜è¿™ä¸ªå†å²æ€§çš„æ—¶åˆ»\n    worldHelper.renderHistory();\n\n    } catch (e) {\n        // å¦‚æœä¸­é—´å‡ºäº†å·®é”™ï¼Œå¦ˆå¦ˆä¼šå¸®ä½ å¤„ç†\n        console.error(\"[æŒ‡ä»¤å®˜] âŒ å‘é€æŒ‡ä»¤æ—¶å‡ºé”™äº†:\", e);\n        button.textContent = `[ å‘é€å¤±è´¥ï¼Œè¯·é‡è¯• ]`;\n        // è§£é™¤æ‰€æœ‰æŒ‰é’®çš„ç¦ç”¨çŠ¶æ€ï¼Œè®©ä½ èƒ½å†æ¬¡å°è¯•\n        initButton.disabled = false;\n        godSpaceButton.disabled = false;\n        if (customActionButton) customActionButton.disabled = false;\n    }\n}\ninitButton.addEventListener('click', async () => {\n    playSound(clickSound, 0.8);\n    initButton.textContent = '[ æŒ‡ä»¤ç”Ÿæˆä¸­.. ]';\n    // æ˜ç¡®ä¼ é€’ null ä½œä¸º customText\n    const finalCommand = await generateFullCommand(true, null);\n    sendCommand(finalCommand, initButton, '[ æ•°æ®ä¸Šä¼ ä¸­ ]', false);\n});\n\ngodSpaceButton.addEventListener('click', async () => {\n    playSound(clickSound, 0.8);\n    godSpaceButton.textContent = '[ æŒ‡ä»¤ç”Ÿæˆä¸­.. ]';\n    // æ˜ç¡®ä¼ é€’ null ä½œä¸º customText\n    const finalCommand = await generateFullCommand(false, null);\n    sendCommand(finalCommand, godSpaceButton, '[ æ­£åœ¨æ¥å…¥ ]', true);\n});\n\n    // --- åˆå§‹åŒ–æ‰§è¡Œ ---\n    \n    initPage1();\n    setupNewUI(); // ç«‹å³æ‰§è¡Œè¿™ä¸ªè®¾ç½®å‡½æ•°\n    initPage2();\n  setupPage2Interactions(); // <--- å¦ˆå¦ˆå¸®ä½ åŠ åœ¨è¿™é‡Œï¼\n    updateUI();\n    \n \n}\n\n// åˆå§‹åŒ–ç»“æŸâ€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”\n\n   // é¦–å…ˆï¼Œåœ¨ä½ çš„å˜é‡å®šä¹‰åŒºåŸŸï¼Œæ·»åŠ è¿™äº›æ–°çš„å˜é‡\n    const customThemeEditor = document.getElementById('custom-theme-editor');\n    const colorPickerContainer = document.getElementById('color-picker-container');\n    const editCustomThemeBtn = document.getElementById('edit-custom-theme-btn');\n    const applyCustomThemeBtn = document.getElementById('apply-custom-theme-btn');\n\n    // å®šä¹‰å¯ç¼–è¾‘çš„é¢œè‰²å˜é‡åˆ—è¡¨\n    const editableColorVars = [\n        { var: '--primary-color', label: 'ä¸»è‰²' },\n        { var: '--secondary-color', label: 'å‰¯è‰²' },\n        { var: '--container-bg-color', label: 'å®¹å™¨èƒŒæ™¯1' },\n        { var: '--background-color', label: 'å®¹å™¨èƒŒæ™¯2' },\n        { var: '--border-color', label: 'è¾¹æ¡†é¢œè‰²' },\n        { var: '--glow-color', label: 'è¾‰å…‰é¢œè‰²' },\n        { var: '--text-color', label: 'æ–‡æœ¬é¢œè‰²' },\n        { var: '--text-secondary-color', label: 'æ¬¡è¦æ–‡æœ¬' },\n        { var: '--danger-color', label: 'å±é™©è‰²' },\n        { var: '--danger-glow-color', label: 'å±é™©è¾‰å…‰' }\n    ];\nasync function saveHistory() {\n    try {\n         \n        const zeroLevelMessage = await getChatMessages(0);\n\n        // å¦‚æœæ¥¼å±‚ä¸å­˜åœ¨ï¼Œè¿™æ˜¯ä¸€ä¸ªå¼‚å¸¸æƒ…å†µï¼Œæˆ‘ä»¬åº”è¯¥åœæ­¢æ“ä½œ\n        if (!zeroLevelMessage) {\n            console.error(\"é”™è¯¯ï¼šæ— æ³•æ‰¾åˆ°ç¬¬ 0 æ¥¼å±‚æ¶ˆæ¯ï¼Œä¿å­˜æ“ä½œå·²ä¸­æ–­ã€‚\");\n            return;\n        }\n \n \n        await updateVariablesWith(old_variables => {\n            return {\n                ...old_variables,\n                zeroLevelHistory: conversationHistory,\n            };\n        }, { type: 'chat' });\n \n        // await updateVariablesWith(old_variables => {\n        //     return {\n        //         ...old_variables,\n        //         zeroLevelHistory: conversationHistory,\n        //     };\n        // }, { type: 'message', message_id: 0 });\n\n        // console.log(\"å†å²è®°å½•å·²æˆåŠŸä¸”å®‰å…¨åœ°æ›´æ–°åˆ° chatmessage(0).dataã€chat å˜é‡åŸŸå’Œ message(0) å˜é‡åŸŸä¸­ã€‚\");\n\n    } catch (e) {\n        // æ•è·å¹¶æ‰“å°ä»»ä½•å¯èƒ½å‘ç”Ÿçš„é”™è¯¯\n        console.error(\"ä¿å­˜å†å²è®°å½•è¿‡ç¨‹ä¸­å‘ç”Ÿæ„å¤–é”™è¯¯:\", e);\n    }\n\n\n}\n \n\nfunction ensureLoadMoreButtonExists() {\n    let chatDisplayArea = document.getElementById('chat-display-area');\n    if (!chatDisplayArea) return null; // å¦‚æœç”»å·ä¸å­˜åœ¨ï¼Œå°±æ— ä»å®ˆæŠ¤\n\n    let loadMoreBtn = document.getElementById('load-more-btn');\n\n    // å¦‚æœæŒ‰é’®ä¸å­˜åœ¨ï¼Œå°±é‡æ–°å¬å”¤å®ƒ\n    if (!loadMoreBtn) {\n        loadMoreBtn = document.createElement('button');\n        loadMoreBtn.id = 'load-more-btn';\n        loadMoreBtn.textContent = 'åŠ è½½æ›´æ—©çš„è®°å½•';\n        chatDisplayArea.insertBefore(loadMoreBtn, chatDisplayArea.firstChild); // è½»è½»åœ°æ”¾åœ¨æœ€é¡¶ä¸Š\n        loadMoreBtn.addEventListener('click', loadPreviousMessages);\n        console.log(\"[Nova's Little Helper] å›æº¯ä¹‹é—¨å·²é‡æ–°å¬å”¤ã€‚\");\n    }\n\n    // æ— è®ºå®ƒæ˜¯æ–°æ˜¯æ—§ï¼Œéƒ½ç¡®ä¿å®ƒçš„åˆå§‹çŠ¶æ€æ˜¯éšè—çš„\n    loadMoreBtn.style.display = 'block';\n\n    return loadMoreBtn; // å°†è¢«å®ˆæŠ¤çš„æŒ‰é’®äº¤å‡ºå»\n}\nasync function loadPreviousMessages() {\n    const chatDisplayArea = document.getElementById('chat-display-area');\n    if (!chatDisplayArea || earliestMessageIndexRendered <= 0) {\n        const loadMoreBtn = ensureLoadMoreButtonExists();\n        if (loadMoreBtn) loadMoreBtn.style.display = 'none'; // æ²¡æœ‰æ›´å¤šäº†ï¼Œå°±è®©å®ƒæ¶ˆå¤±å§\n        return;\n    }\n\n    const oldScrollHeight = chatDisplayArea.scrollHeight; // è®°ä¸‹ç°åœ¨çš„é«˜åº¦\n\n    const messagesToLoadCount = Math.min(earliestMessageIndexRendered, 5 * 2) // ä¸€æ¬¡åŠ è½½5å¯¹å¯¹è¯(10æ¡)\n    const newEarliestIndex = earliestMessageIndexRendered - messagesToLoadCount;\n\n    const messagesToPrepend = conversationHistory.slice(newEarliestIndex, earliestMessageIndexRendered);\n\n    // æˆ‘ä»¬éœ€è¦å€’åºåˆ›å»ºï¼Œè¿™æ ·æ‰èƒ½æ­£ç¡®åœ°æ’å…¥åˆ°é¡¶éƒ¨\n    for (let i = messagesToPrepend.length - 1; i >= 0; i--) {\n        const msg = messagesToPrepend[i];\n        const bubble = await worldHelper.createMessageBubble(msg,'chat',true);\n        chatDisplayArea.insertBefore(bubble, chatDisplayArea.firstChild);\n    }\n\n    earliestMessageIndexRendered = newEarliestIndex; // æ›´æ–°æˆ‘ä»¬çš„è®°å¿†æŒ‡é’ˆ\n\n    // é­”æ³•çš„å…³é”®ï¼šæ¸©æŸ”åœ°ä¿æŒä½ çš„è§†çº¿\n    chatDisplayArea.scrollTop = chatDisplayArea.scrollHeight - oldScrollHeight;\n\n    if (earliestMessageIndexRendered <= 0) {\n        const loadMoreBtn = document.getElementById('load-more-btn');\n        if (loadMoreBtn) loadMoreBtn.style.display = 'none'; // å¦‚æœå·²ç»åˆ°é¡¶äº†ï¼Œå°±éšè—\n    }\n}\n// âœ¨ ä¸€ä¸ªå…¨æ–°çš„ï¼Œä¸“é—¨ä¸ºé˜…è¯»æ¨¡å¼æ‰“é€ çš„æ¸²æŸ“é­”æ³• âœ¨\nasync function renderReadingModeChapter(msg) {\n    const bubble = document.createElement('div'); // æˆ‘ä»¬ä»ç„¶éœ€è¦ä¸€ä¸ªä¸´æ—¶çš„å®¹å™¨æ¥å¤„ç†DOM\n    let processedContent = msg.content;\n\n    // --- ä»¥ä¸‹é€»è¾‘ä¸ createMessageBubble éå¸¸ç›¸ä¼¼ï¼Œä½†ä¸ºé˜…è¯»æ¨¡å¼åšäº†ç®€åŒ–å’Œä¼˜åŒ– ---\n\n    // 1. ä¿æŠ¤å’ŒæŠ½ç¦» HTML/ä»£ç å—\n    const htmlPlaceholders = {};\n    let placeholderIndex = 0;\n    let protectedHtmlContent = processedContent.replace(/<html>([\\s\\S]*?)<\\/html>|```(\\w*)\\n([\\s\\S]*?)\\n```/gs, (match, htmlBlock, lang, markdownBlock) => {\n        const placeholder = `HTMLREADINGPLACEHOLDER${placeholderIndex}`;\n        const rawContent = htmlBlock || markdownBlock;\n        if (!rawContent) return match;\n        htmlPlaceholders[placeholder] = rawContent;\n        placeholderIndex++;\n        return placeholder;\n    });\n// âœ¨ã€æ–°å¢ï¼šç§èŠ <msg> å ä½ç¬¦æœºåˆ¶åˆå§‹åŒ–ã€‘âœ¨\n    const msgPlaceholders = {}; \n    let msgPlaceholderIndex = 0;\nconst groupChatPlaceholders = {}; \n    let groupChatPlaceholderIndex = 0;\n    // 2. æ¸…ç†å†…å®¹ï¼Œä½†ä¿ç•™æ‰€æœ‰éäº¤äº’æ€§æ ‡ç­¾\n    // æ­¥éª¤ 2.1ï¼šè§£æ <msg> æ ‡ç­¾å¹¶æ›¿æ¢ä¸ºå ä½ç¬¦\n    let contentWithMsgPlaceholder = protectedHtmlContent.replace(/<msg>([^|]+)\\|([^|]+)\\|([\\s\\S]*?)<\\/msg>/gs, (match, sender, receiver, msgContent) => {\n        const userNickname = currentGameData?.user_character?.nick_name || 'ä½ ';\n        \n        // å°†æ¶ˆæ¯å†…å®¹æ¸²æŸ“æˆ HTMLï¼ˆä½¿ç”¨å¤–éƒ¨çš„è¾…åŠ©å‡½æ•°ï¼‰\n        const renderedMsgHtml = worldHelper.renderPrivateMsgToHtml(sender.trim(), receiver.trim(), msgContent, userNickname);\n        \n        // ç”Ÿæˆå ä½ç¬¦\n        const placeholder = `MSGREADINGPLACEHOLDER${msgPlaceholderIndex}`;\n        msgPlaceholders[placeholder] = renderedMsgHtml;\n        msgPlaceholderIndex++;\n        return placeholder;\n    });\nconst groupChatRegex = /<group_chat\\s+name=\"([^\"]*)\">([\\s\\S]*?)<\\/group_chat>/gs;\nlet contentWithGroupChatPlaceholder = contentWithMsgPlaceholder.replace(groupChatRegex, (match, groupName, chatContent) => {\n    const userNickname = currentGameData?.user_character?.nick_name || 'ä½ ';\n    let groupChatHtml = `<div class=\"group-chat-separator\">ç¾¤èŠ: ${groupName.trim()}</div>`;\n    \n    // é€è¡Œè§£ææ¶ˆæ¯\n    if (typeof chatContent === 'string') {\n        const lines = chatContent.trim().split('\\n');\n        for (const line of lines) {\n            const cleanedLine = line.trim();\n            if (!cleanedLine || cleanedLine.startsWith('summary|')) {\n                continue; \n            }\n            const messageMatch = cleanedLine.match(/^([^|]+)\\|([\\s\\S]*)/); \n            if (messageMatch) {\n                const sender = messageMatch[1].trim();\n                const content = messageMatch[2].trim();\n                // âš ï¸ ä½¿ç”¨å¤–éƒ¨çš„ renderGroupChatToHtml å‡½æ•°\n                groupChatHtml += worldHelper.renderGroupChatToHtml(sender, content, userNickname);\n            }\n        }\n    }\n\n    // 3. ç”Ÿæˆå ä½ç¬¦\n    const placeholder = `GROUPCHATREADINGPLACEHOLDER${groupChatPlaceholderIndex}`;\n    groupChatPlaceholders[placeholder] = groupChatHtml;\n    groupChatPlaceholderIndex++;\n    return placeholder;\n});\n\n\n  // æ­¥éª¤ 2.3ï¼šæ¸…ç†å…¶ä»–ä¸ç›¸å…³æ ‡ç­¾ (ä½¿ç”¨ contentWithGroupChatPlaceholder)\n  let renderedHtml = contentWithGroupChatPlaceholder // !!! ä½¿ç”¨æœ€æ–°çš„ string// !!! ä½¿ç”¨æ–°çš„ contentWithMsgPlaceholder\n        .replace(/<(battle|guide|options|forum_threads|shop_item|è¡¨ç°æ€»ç»“)>[\\s\\S]*?<\\/\\1>/gs, '')\n        .replace(/<group_chat\\b[^>]*>(?:(?!<group_chat\\b)[\\s\\S])*?<\\/group_chat>/gs, '');\n        // 3. åº”ç”¨é…’é¦†æ­£åˆ™ï¼Œæ·±åº¦å›ºå®šä¸º-1\n  // 3. åº”ç”¨é…’é¦†æ­£åˆ™ï¼Œæ·±åº¦å›ºå®šä¸º-1\n    const pureContent = formatAsTavernRegexedString(\n        renderedHtml, // !!! å¯¹æ¸…ç†åçš„å†…å®¹åº”ç”¨æ­£åˆ™\n        'ai_output',\n        'display',\n        { depth: -1 }\n    );\n    renderedHtml = pureContent; // é‡æ–°èµ‹å€¼ç»™ renderedHtml\n\n\n    // 4. å¯¹å¤„ç†åå¯èƒ½äº§ç”Ÿçš„æ–°HTMLå—è¿›è¡ŒäºŒæ¬¡æŠ½ç¦»\n    const additionalHtmlPlaceholders = {};\n    let additionalPlaceholderIndex = 1000;\n    renderedHtml = renderedHtml.replace(/<html>([\\s\\S]*?)<\\/html>|```(\\w*)\\n([\\s\\S]*?)\\n```/gs, (match, htmlBlock, lang, codeBlock) => {\n        const placeholder = `ADDITIONALHTMLREADINGPLACEHOLDER${additionalPlaceholderIndex}`;\n        const rawContent = htmlBlock || codeBlock;\n        if (!rawContent) return match;\n        additionalHtmlPlaceholders[placeholder] = rawContent;\n        additionalPlaceholderIndex++;\n        return placeholder;\n    });\n    Object.assign(htmlPlaceholders, additionalHtmlPlaceholders);\n\n    // 5. æ ¼å¼åŒ–æ®µè½å’Œå¼•å·\n    const protectedContent = renderedHtml\n        .replace(/â€œ/g, 'NOVA_LQ').replace(/â€/g, 'NOVA_RQ')\n        .replace(/ã€Œ/g, 'NOVA_LA').replace(/ã€/g, 'NOVA_RA')\n        .replace(/\\n/g, 'NOVA_BR');\n\n    const specialBlocks = {};\n    let blockIndex = 0;\n    let contentWithDetailsPlaceholder = protectedContent.replace(/<details>[\\s\\S]*?<\\/details>/gs, (match) => {\n        const placeholder = `READINGSPECIALBLOCK${blockIndex++}`;\n        specialBlocks[placeholder] = match;\n        return placeholder;\n    });\n\n    const paragraphs = contentWithDetailsPlaceholder.split('NOVA_BR');\n    const styledParagraphs = paragraphs.map(p_content => {\n        if (p_content.startsWith('READINGSPECIALBLOCK')) return p_content;\n        if (p_content.trim() === '') return '<p> </p>';\n        let baseHtml = formatAsDisplayedMessage(p_content);\n        const textWithQuotes = baseHtml\n            .replace(/NOVA_LQ/g, '<span class=\"dialogue-quote\">â€œ').replace(/NOVA_RQ/g, 'â€</span>')\n            .replace(/NOVA_LA/g, '<span class=\"dialogue-quote\">ã€Œ').replace(/NOVA_RA/g, 'ã€</span>');\n        return `<p>${textWithQuotes}</p>`;\n    });\n\n    let finalHtml = styledParagraphs.join('');\n    // âœ¨ã€æ–°å¢ï¼šæ›¿æ¢ <msg> å ä½ç¬¦ã€‘âœ¨\n    for (const placeholder in msgPlaceholders) {\n        // åœ¨ finalHtml ä¸­æ›¿æ¢å ä½ç¬¦\n        finalHtml = finalHtml.replace(new RegExp(placeholder, 'g'), msgPlaceholders[placeholder]);\n    }\n    for (const placeholder in groupChatPlaceholders) {\n    // æ›¿æ¢ç¾¤èŠ HTML\nfinalHtml = finalHtml.replace(new RegExp(placeholder.replace(/[-\\/\\\\^$*+?.()|[\\]{}]/g, '\\\\$&'), 'g'), groupChatPlaceholders[placeholder]); // <-- æ›¿æ¢æ—¶éœ€è¦è½¬ä¹‰\n    }\n    for (const placeholder in specialBlocks) {\n        const cleanBlock = specialBlocks[placeholder]\n            .replace(/NOVA_LQ/g, 'â€œ').replace(/NOVA_RQ/g, 'â€')\n            .replace(/NOVA_LA/g, 'ã€Œ').replace(/NOVA_RA/g, 'ã€')\n            .replace(/NOVA_BR/g, '<br>');\n        finalHtml = finalHtml.replace(placeholder, cleanBlock);\n    }\n if (typeof memeImageMap !== 'undefined' && memeImageMap) {\n            finalHtml = finalHtml.replace(/\\[([^\\]]+)\\]/g, (match, memeName) => {\n                if (memeImageMap[memeName]) {\n                    return `<img src=\"${memeImageMap[memeName]}\" alt=\"${memeName}\" class=\"meme-image\" style=\"max-width: 200px; max-height: 200px; vertical-align: middle; margin: 4px;\" />`;\n                }\n                return match;\n            });\n        }\n    bubble.innerHTML = finalHtml;\n\n    // 6. âœ¨ ä½¿ç”¨ç¨³å®šå¯é çš„ srcdoc æ–¹æ³•å¤„ç† iframe âœ¨\n    for (const placeholder in htmlPlaceholders) {\n        const walker = document.createTreeWalker(bubble, NodeFilter.SHOW_TEXT, null, false);\n        let node;\n        let nodesToReplace = [];\n        while (node = walker.nextNode()) {\n            if (node.nodeValue.includes(placeholder)) {\n                nodesToReplace.push(node);\n            }\n        }\n\n        for (const nodeToReplace of nodesToReplace) {\n             if (!nodeToReplace.parentNode) continue; // å®‰å…¨æ£€æŸ¥\n\n            const rawHtmlContent = htmlPlaceholders[placeholder];\n            const iframe = document.createElement('iframe');\n            iframe.setAttribute('sandbox', 'allow-scripts allow-same-origin');\n            iframe.style.width = '100%';\n            \n            // iframe.style.border = '1px solid #ccc';\n            iframe.style.resize = 'vertical';\n            iframe.style.overflow = 'auto';\n\n            const frameId = 'reader-scroll-' + Date.now() + Math.random();\n            iframe.id = frameId;\n\n // 1. å…ˆå‡†å¤‡å¥½æˆ‘ä»¬å®Œæ•´çš„ç”»å·å†…å®¹\nconst fullHtmlContent = `<!DOCTYPE html>\n<html>\n<head>\n    <meta charset=\"UTF-8\">\n    <style>\n        /* å¦ˆå¦ˆæŠŠæ ·å¼é‡Œçš„ --base-font-family æ›¿æ¢ä¸ºå…·ä½“å€¼ï¼Œå› ä¸º iframe å¯èƒ½æ— æ³•ç›´æ¥ç»§æ‰¿ CSS å˜é‡ */\n        body {\n           font-family: var(--base-font-family);\n            color: black;\n            background-color: transparent;  \n            margin: 0;\n            padding: 0px;\n            box-sizing: border-box;\n        }\n        body::-webkit-scrollbar { width: 8px; }\n        body::-webkit-scrollbar-track { background: rgba(200, 200, 200, 0.2); }\n        body::-webkit-scrollbar-thumb { background: #888; border-radius: 4px; }\n        body::-webkit-scrollbar-thumb:hover { background: #555; }\n    </style>\n</head>\n<body>\n    ${rawHtmlContent}\n    <script>\n        function reportHeight() {\n            // åœ¨ requestAnimationFrame ä¸­æŠ¥å‘Šé«˜åº¦ï¼Œå¯ä»¥é¿å…å¸ƒå±€æŠ–åŠ¨ï¼Œè·å–æ›´å‡†ç¡®çš„å€¼\n            requestAnimationFrame(() => {\n                const height = document.body.scrollHeight;\n                window.parent.postMessage({\n                    frameId: \"${frameId}\",\n                    height: height\n                }, '*');\n            });\n        }\n\n        // ä½¿ç”¨ DOMContentLoaded ä¼šæ¯” window.onload æ›´å¿«è§¦å‘\n        document.addEventListener('DOMContentLoaded', reportHeight);\n\n        // onload ä½œä¸ºåå¤‡ï¼Œç¡®ä¿æ‰€æœ‰èµ„æºï¼ˆå¦‚å›¾ç‰‡ï¼‰åŠ è½½å®Œåå†æ¬¡æ£€æŸ¥é«˜åº¦\n        window.addEventListener('load', () => {\n             reportHeight();\n             // é¢å¤–å¢åŠ å»¶è¿Ÿæ£€æŸ¥ï¼Œåº”å¯¹ä¸€äº›å¤æ‚çš„å¼‚æ­¥åŠ è½½å†…å®¹\n             setTimeout(reportHeight, 300);\n             setTimeout(reportHeight, 1000);\n        });\n\n        // å¯¹å›¾ç‰‡åŠ è½½çš„ç›‘å¬ä¿æŒä¸å˜\n        Array.from(document.getElementsByTagName('img')).forEach(img => {\n            if (!img.complete) {\n                img.addEventListener('load', reportHeight);\n            }\n        });\n\n        // ç›‘å¬çˆ¶é¡µé¢çš„æ¶ˆæ¯ï¼Œä¿æŒä¸å˜\nwindow.addEventListener('message', function(event) {\n   \n    if(event.data.frameId === frameId && event.data.height && event.data.height > 20) {\n        iframe.style.height = (event.data.height + 20) + 'px';\n    }\n}, false);\n    <\\/script>\n</body>\n</html>`;\n            iframe.onload = function() {\n                try {\n                    iframe.contentWindow.postMessage({ action: 'recalculateHeight', frameId: frameId }, '*');\n                } catch(e) {}\n            };\n\n            try {\n                iframe.srcdoc = fullHtmlContent;\n            } catch (error) {\n                iframe.src = 'data:text/html;charset=utf-8,' + encodeURIComponent(fullHtmlContent);\n            }\n            // --------------------------------------------------------\n\n            const parentNode = nodeToReplace.parentNode;\n            const remainingText = nodeToReplace.nodeValue.replace(placeholder, '');\n            if (remainingText) {\n                nodeToReplace.nodeValue = remainingText;\n                parentNode.insertBefore(iframe, nodeToReplace.nextSibling);\n            } else {\n                parentNode.replaceChild(iframe, nodeToReplace);\n                setTimeout(() => {\n    try {\n        if (iframe.contentWindow) {\n             iframe.contentWindow.postMessage({\n                action: 'recalculateHeight',\n                frameId: frameId\n            }, '*');\n        }\n    } catch(e) {\n        console.warn(\"å‘æ–°åˆ›å»ºçš„ç”»å·é—®å¥½å¤±è´¥äº†ï¼Œä¸è¿‡åˆ«æ‹…å¿ƒï¼Œå®ƒè‡ªå·±ä¼šæŠ¥å‘Šçš„ã€‚\");\n    }\n}, 500); // å»¶è¿Ÿ500æ¯«ç§’ï¼Œç»™ iframe è¶³å¤Ÿçš„æ—¶é—´å»åŠ è½½åˆå§‹å†…å®¹\n            }\n        }\n    }\n\n    // 7. è¿”å›æ¸²æŸ“å¥½çš„çº¯å‡€ HTML å­—ç¬¦ä¸²\n    return bubble.innerHTML;\n}\n \n \n \n\nfunction getChatConfig(key, defaultValue) {\n    try {\n        const chatVars = TavernHelper.getVariables({ type: 'chat' });\n        // ä½¿ç”¨ _.get å¯ä»¥å®‰å…¨åœ°è®¿é—®æ·±å±‚åµŒå¥—çš„å±æ€§ï¼Œå¦‚æœè·¯å¾„ä¸å­˜åœ¨ï¼Œåˆ™è¿”å› undefined\n        // è¿™æ¯” chatVars.assa_data.config[key] æ›´å®‰å…¨\n        const value = _.get(chatVars, `assa_data.config.${key}`);\n        return value !== undefined ? value : defaultValue;\n    } catch (e) {\n        console.warn(`è·å–èŠå¤©é…ç½® \"${key}\" å¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤å€¼: ${defaultValue}`, e);\n        return defaultValue;\n    }\n}\n function toggleChaptersDrawer() {\n    const modal = document.getElementById('reading-mode-modal');\n    modal.classList.toggle('chapters-open');\n}\nfunction initializeReadingMode() {\n    // åœ¨ initializeReadingMode å‡½æ•°çš„ä¸‹æ–¹æˆ–ä»»æ„ä½ç½®ï¼Œæ·»åŠ è¿™ä¸ªæ–°çš„åˆ‡æ¢å‡½æ•°\n  const toggleChaptersBtn = document.getElementById('reading-mode-toggle-chapters'); // æ–°å¢\n    const readOrb = document.getElementById('read-orb-button');\n    const container = document.getElementById('reading-mode-container');\n    const backdrop = document.getElementById('reading-mode-backdrop');\n    const closeBtn = document.getElementById('reading-mode-close-btn');\n    const prevBtn = document.getElementById('reading-mode-prev-btn');\n    const nextBtn = document.getElementById('reading-mode-next-btn');\n const mobilePrevBtn = document.getElementById('mobile-prev-btn'); // æ–°å¢\n    const mobileNextBtn = document.getElementById('mobile-next-btn'); // æ–°å¢\n    if (!readOrb || !container) return;\n\n    readOrb.addEventListener('click', openReadingMode);\n    closeBtn.addEventListener('click', closeReadingMode);\n    backdrop.addEventListener('click', closeReadingMode);\n\n    prevBtn.addEventListener('click', () => navigateChapter(-1));\n    nextBtn.addEventListener('click', () => navigateChapter(1));\n  toggleChaptersBtn.addEventListener('click', toggleChaptersDrawer); // æ–°å¢\n  const starredFilterBtn = document.getElementById('starred-filter-btn');\n    if (starredFilterBtn) {\n        starredFilterBtn.addEventListener('click', toggleStarredFilter);\n    }\n    mobilePrevBtn.addEventListener('click', () => navigateChapter(-1));\n    mobileNextBtn.addEventListener('click', () => navigateChapter(1));\n    document.addEventListener('keydown', (e) => {\n        if (!isReadingModeOpen) return;\n        if (e.key === 'ArrowLeft') navigateChapter(-1);\n        if (e.key === 'ArrowRight') navigateChapter(1);\n        if (e.key === 'Escape') closeReadingMode();\n    });\n}\nlet showOnlyStarred = false; // æ˜¯å¦åªæ˜¾ç¤ºæ”¶è—çš„ç« èŠ‚\nfunction openReadingMode() {\n    // 1. æ”¶é›†æ‰€æœ‰ç« èŠ‚æ•°æ®\n    const allChapters = conversationHistory\n        .map((msg, index) => ({ msg, originalIndex: index }))\n        .filter(item => item.msg.role === 'assistant');\n    \n    // æ ¹æ®æ”¶è—è¿‡æ»¤çŠ¶æ€å†³å®šæ˜¾ç¤ºå“ªäº›ç« èŠ‚\n    storyChapters = showOnlyStarred \n        ? allChapters.filter(item => item.msg.isStarred)\n        : allChapters;\n\n    if (allChapters.length === 0) {\n        alert(\"è¿˜æ²¡æœ‰æ•…äº‹å†…å®¹å¯ä»¥é˜…è¯»å“¦ï¼Œæˆ‘çš„å­©å­ã€‚\");\n        return;\n    }\n\n    // âœ¨ å¦‚æœæ²¡æœ‰æ”¶è—ç« èŠ‚ï¼Œè‡ªåŠ¨åˆ‡æ¢å›æ˜¾ç¤ºå…¨éƒ¨\n    if (storyChapters.length === 0 && showOnlyStarred) {\n        showOnlyStarred = false;\n        storyChapters = allChapters;\n        const filterBtn = document.getElementById('starred-filter-btn');\n        if (filterBtn) {\n            filterBtn.textContent = 'â­';\n            filterBtn.classList.remove('active-filter');\n        }\n        showNovaAlert('æ²¡æœ‰æ”¶è—çš„ç« èŠ‚ï¼Œå·²åˆ‡æ¢åˆ°æ˜¾ç¤ºå…¨éƒ¨');\n    }\n\n    isReadingModeOpen = true;\n\n    // 2. æ¸²æŸ“ç« èŠ‚åˆ—è¡¨\n    const chapterListEl = document.getElementById('reading-mode-chapters-list');\n    chapterListEl.innerHTML = '';\n    storyChapters.forEach((chapter, index) => {\n        const li = document.createElement('li');\n        \n        // âœ¨ æ„å»ºç« èŠ‚æ˜¾ç¤ºæ–‡æœ¬ï¼šåºå· + è‡ªå®šä¹‰æ ‡é¢˜ï¼ˆå¦‚æœæœ‰ï¼‰\n        let chapterText = `ç¬¬ ${index + 1} ç« `;\n        if (chapter.msg.customTitle) {\n            chapterText += `: ${chapter.msg.customTitle}`;\n        }\n        \n        // âœ¨ å¦‚æœè¢«æ”¶è—ï¼Œæ·»åŠ æ˜Ÿæ ‡\n        if (chapter.msg.isStarred) {\n            chapterText = 'â­ ' + chapterText;\n        }\n        \n        li.textContent = chapterText;\n        li.dataset.chapterIndex = index;\n        li.addEventListener('click', () => {\n            currentChapterIndex = index;\n            renderCurrentChapter();\n            const modal = document.getElementById('reading-mode-modal');\n            modal.classList.remove('chapters-open');\n        });\n        chapterListEl.appendChild(li);\n    });\n\n    // 3. æ¸²æŸ“ç¬¬ä¸€ç« \n    currentChapterIndex = 0;\n    renderCurrentChapter();\n\n    // 4. æ˜¾ç¤ºæ¨¡æ€æ¡†\n    const container = document.getElementById('reading-mode-container');\n    container.classList.remove('reading-mode-hidden');\n    document.body.style.overflow = 'hidden'; // é˜²æ­¢ä¸»é¡µé¢æ»šåŠ¨\n}\n\nfunction closeReadingMode() {\n    isReadingModeOpen = false;\n    const container = document.getElementById('reading-mode-container');\n    container.classList.add('reading-mode-hidden');\n    document.body.style.overflow = ''; // æ¢å¤ä¸»é¡µé¢æ»šåŠ¨\n}\n\nasync function renderCurrentChapter() {\n    if (currentChapterIndex < 0 || currentChapterIndex >= storyChapters.length) {\n        return;\n    }\n\n    const chapterData = storyChapters[currentChapterIndex];\n    const contentEl = document.getElementById('reading-mode-content');\n    const titleEl = document.getElementById('reading-mode-chapter-title');\n    const chapterListItems = document.querySelectorAll('#reading-mode-chapters-list li');\n    const prevBtn = document.getElementById('reading-mode-prev-btn');\n    const nextBtn = document.getElementById('reading-mode-next-btn');\n  const mobilePrevBtn = document.getElementById('mobile-prev-btn');\n    const mobileNextBtn = document.getElementById('mobile-next-btn');\n\n    // æ¸…ç©ºç°æœ‰å†…å®¹å¹¶æ˜¾ç¤ºåŠ è½½æç¤º\n    contentEl.innerHTML = '<p>æ­£åœ¨ä¸ºä½ ç²¾å¿ƒæ¸²æŸ“æ•…äº‹...</p>';\n\n  let titleText = `ç¬¬ ${currentChapterIndex + 1} ç« `;\n    if (chapterData.msg.customTitle) {\n        titleText += `: ${chapterData.msg.customTitle}`;\n    }\n    if (chapterData.msg.isStarred) {\n        titleText = 'â­ ' + titleText;\n    }\n    titleEl.textContent = titleText;\n\n\n    // æ›´æ–°ç« èŠ‚åˆ—è¡¨çš„æ¿€æ´»çŠ¶æ€\n    chapterListItems.forEach(li => {\n        if (parseInt(li.dataset.chapterIndex) === currentChapterIndex) {\n            li.classList.add('active-chapter');\n            li.scrollIntoView({ behavior: 'smooth', block: 'nearest' });\n        } else {\n            li.classList.remove('active-chapter');\n        }\n    });\n\n  \n    const chapterHtml = await renderReadingModeChapter(chapterData.msg);\n    contentEl.innerHTML = chapterHtml; // ç›´æ¥å°†æ¸²æŸ“å¥½çš„ HTML æ”¾å…¥å®¹å™¨\n    contentEl.scrollTop = 0;\n  // âœ¨ ä¸ºå½“å‰ç« èŠ‚æ·»åŠ å³ä¸Šè§’èœå•æŒ‰é’®\n    const existingMenu = contentEl.querySelector('.chapter-menu-trigger');\n    if (!existingMenu) {\n        const menuTrigger = document.createElement('div');\n        menuTrigger.className = 'chapter-menu-trigger';\n        menuTrigger.innerHTML = 'â‹¯';\n        menuTrigger.onclick = (e) => {\n            console.log('chapter-menu-trigger');\n            e.stopPropagation();\n            showReadingModeMenu(e, chapterData);\n        };\n        contentEl.style.position = 'relative';\n        contentEl.appendChild(menuTrigger);\n    }\n  // âœ¨ ç”¨åˆ‡æ¢classçš„æ–¹å¼ï¼Œä¼˜é›…åœ°æ›´æ–°æ‰€æœ‰ç¿»é¡µæŒ‰é’®çš„çŠ¶æ€ âœ¨\n    const isFirstChapter = currentChapterIndex === 0;\n    const isLastChapter = currentChapterIndex === storyChapters.length - 1;\n\n    // åŒæ—¶æ§åˆ¶PCå’Œç§»åŠ¨ç«¯æŒ‰é’®\n    prevBtn.classList.toggle('disabled-arrow', isFirstChapter);\n    mobilePrevBtn.classList.toggle('disabled-arrow', isFirstChapter);\n\n    nextBtn.classList.toggle('disabled-arrow', isLastChapter);\n    mobileNextBtn.classList.toggle('disabled-arrow', isLastChapter);\n}\n\nfunction navigateChapter(direction) {\n    const newIndex = currentChapterIndex + direction;\n    if (newIndex >= 0 && newIndex < storyChapters.length) {\n        currentChapterIndex = newIndex;\n        renderCurrentChapter();\n    }\n}\n\nfunction showReadingModeMenu(event, chapterData) {\n    // ç§»é™¤å·²å­˜åœ¨çš„èœå•\n    const existingDropdown = document.querySelector('.chapter-dropdown-menu');\n    if (existingDropdown) {\n        existingDropdown.remove();\n        return; // å¦‚æœå·²æ‰“å¼€ï¼Œç‚¹å‡»å…³é—­\n    }\n\n    // åˆ›å»ºä¸‹æ‹‰èœå•\n    const dropdown = document.createElement('div');\n    dropdown.className = 'chapter-dropdown-menu';\n    dropdown.innerHTML = `\n        <div class=\"dropdown-item\" data-action=\"edit\">âœï¸ ç¼–è¾‘</div>\n        <div class=\"dropdown-item\" data-action=\"star\">${chapterData.msg.isStarred ? 'â­ å–æ¶ˆæ”¶è—' : 'â˜† æ”¶è—'}</div>\n        <div class=\"dropdown-item\" data-action=\"name\">ğŸ·ï¸ å‘½å</div>\n    `;\n\n    // å®šä½èœå•ï¼ˆåœ¨æŒ‰é’®ä¸‹æ–¹ï¼‰\n    const trigger = event.target;\n    const rect = trigger.getBoundingClientRect();\n    dropdown.style.position = 'fixed';\n    dropdown.style.top = `${rect.bottom + 5}px`;\n    dropdown.style.right = `${window.innerWidth - rect.right}px`;\n    \n    document.body.appendChild(dropdown);\n\n    // ç‚¹å‡»å¤–éƒ¨å…³é—­\n    const closeMenu = (e) => {\n        if (!dropdown.contains(e.target) && e.target !== trigger) {\n            dropdown.remove();\n            document.removeEventListener('click', closeMenu);\n        }\n    };\n    setTimeout(() => document.addEventListener('click', closeMenu), 0);\n\n    // ç¼–è¾‘åŠŸèƒ½ - å¼¹å‡ºå¤§çª—å£ç¼–è¾‘\n    dropdown.querySelector('[data-action=\"edit\"]').onclick = () => {\n        dropdown.remove();\n        \n        // åˆ›å»ºç¼–è¾‘å¼¹çª—\n        const overlay = document.createElement('div');\n        overlay.style.cssText = `\n            position: fixed; top: 0; left: 0; width: 100%; height: 100%;\n            background: rgba(0, 0, 0, 0.7); display: flex;\n            align-items: center; justify-content: center; z-index: 10001;\n        `;\n        \n        const dialog = document.createElement('div');\n        dialog.style.cssText = `\n            background: var(--container-bg-color);\n            border: 1px solid var(--border-color);\n            border-radius: 12px;\n            padding: 24px;\n            width: 90vw;\n            height: 80vh;\n            box-shadow: 0 8px 32px var(--glow-color);\n            display: flex;\n            flex-direction: column;\n        `;\n        \n        const title = document.createElement('h3');\n        title.textContent = 'ç¼–è¾‘ç« èŠ‚å†…å®¹';\n        title.style.cssText = `\n            margin: 0 0 16px 0;\n            font-size: 18px;\n            color: var(--text-color);\n        `;\n        \n        const textarea = document.createElement('textarea');\n        textarea.value = chapterData.msg.content;\n        textarea.style.cssText = `\n            flex: 1;\n            width: 100%;\n            padding: 12px;\n            border: 1px solid var(--border-color);\n            border-radius: 6px;\n            font-size: 14px;\n            box-sizing: border-box;\n            margin-bottom: 16px;\n            background: var(--background-color);\n            color: var(--text-color);\n            resize: none;\n            font-family: var(--base-font-family);\n        `;\n        \n        const buttonContainer = document.createElement('div');\n        buttonContainer.style.cssText = `\n            display: flex;\n            gap: 12px;\n            justify-content: flex-end;\n        `;\n        \n        const cancelBtn = document.createElement('button');\n        cancelBtn.textContent = 'å–æ¶ˆ';\n        cancelBtn.className = 'editing-btn cancel';\n        \n        const saveBtn = document.createElement('button');\n        saveBtn.textContent = 'ä¿å­˜';\n        saveBtn.className = 'editing-btn save';\n        \n        cancelBtn.onclick = () => document.body.removeChild(overlay);\n        \n        saveBtn.onclick = async () => {\n            const newText = textarea.value.trim();\n            if (newText && newText !== chapterData.msg.content) {\n                conversationHistory[chapterData.originalIndex].content = newText;\n                await saveHistory();\n                showNovaAlert('å†…å®¹å·²ä¿å­˜ï¼');\n                \n                // é‡æ–°æ¸²æŸ“å½“å‰ç« èŠ‚\n                await renderCurrentChapter();\n            }\n            document.body.removeChild(overlay);\n        };\n        \n        // ESC å–æ¶ˆ\n        textarea.onkeydown = (e) => {\n            if (e.key === 'Escape') {\n                cancelBtn.onclick();\n            }\n        };\n        \n        buttonContainer.appendChild(cancelBtn);\n        buttonContainer.appendChild(saveBtn);\n        dialog.appendChild(title);\n        dialog.appendChild(textarea);\n        dialog.appendChild(buttonContainer);\n        overlay.appendChild(dialog);\n        document.body.appendChild(overlay);\n        \n        textarea.focus();\n        \n        // ç‚¹å‡»é®ç½©å±‚å…³é—­\n        overlay.onclick = (e) => {\n            if (e.target === overlay) cancelBtn.onclick();\n        };\n    };\n\n    // æ”¶è—åŠŸèƒ½\n    dropdown.querySelector('[data-action=\"star\"]').onclick = async () => {\n        dropdown.remove();\n        const message = conversationHistory[chapterData.originalIndex];\n        message.isStarred = !message.isStarred;\n        await saveHistory();\n        showNovaAlert(message.isStarred ? 'å·²æ”¶è—ï¼' : 'å·²å–æ¶ˆæ”¶è—');\n        \n        // é‡æ–°æ¸²æŸ“å½“å‰ç« èŠ‚\n        await renderCurrentChapter();\n        \n        // æ›´æ–°ç« èŠ‚åˆ—è¡¨\n        const chapterListEl = document.getElementById('reading-mode-chapters-list');\n        const lis = chapterListEl.querySelectorAll('li');\n        if (lis[currentChapterIndex]) {\n            let chapterText = `ç¬¬ ${currentChapterIndex + 1} ç« `;\n            if (message.customTitle) {\n                chapterText += `: ${message.customTitle}`;\n            }\n            if (message.isStarred) {\n                chapterText = 'â­ ' + chapterText;\n            }\n            lis[currentChapterIndex].textContent = chapterText;\n        }\n    };\n\n    // å‘½ååŠŸèƒ½\n    dropdown.querySelector('[data-action=\"name\"]').onclick = () => {\n        dropdown.remove();\n        \n        // åˆ›å»ºå‘½åå¯¹è¯æ¡†\n        const overlay = document.createElement('div');\n        overlay.style.cssText = `\n            position: fixed; top: 0; left: 0; width: 100%; height: 100%;\n            background: rgba(0, 0, 0, 0.7); display: flex;\n            align-items: center; justify-content: center; z-index: 10001;\n        `;\n        \n        const dialog = document.createElement('div');\n        dialog.style.cssText = `\n            background: var(--container-bg-color); border-radius: 12px;\n            padding: 24px; min-width: 320px; max-width: 500px;\n            box-shadow: 0 8px 32px var(--glow-color);\n            border: 1px solid var(--border-color);\n        `;\n        \n        const title = document.createElement('h3');\n        title.textContent = 'ä¸ºè¿™ä¸ªç« èŠ‚å‘½å';\n        title.style.cssText = `margin: 0 0 16px 0; font-size: 18px; color: var(--text-color);`;\n        \n        const input = document.createElement('input');\n        input.type = 'text';\n        input.placeholder = 'è¾“å…¥æ ‡é¢˜...';\n        input.value = chapterData.msg.customTitle || '';\n        input.style.cssText = `\n            width: 100%; padding: 12px; border: 1px solid var(--border-color);\n            border-radius: 6px; font-size: 14px; box-sizing: border-box;\n            margin-bottom: 16px; background: var(--background-color);\n            color: var(--text-color);\n        `;\n        \n        const buttonContainer = document.createElement('div');\n        buttonContainer.style.cssText = `display: flex; gap: 12px; justify-content: flex-end;`;\n        \n        const cancelBtn = document.createElement('button');\n        cancelBtn.textContent = 'å–æ¶ˆ';\n        cancelBtn.className = 'editing-btn cancel';\n        \n        const saveBtn = document.createElement('button');\n        saveBtn.textContent = 'ä¿å­˜';\n        saveBtn.className = 'editing-btn save';\n        \n        cancelBtn.onclick = () => document.body.removeChild(overlay);\n        \n        saveBtn.onclick = async () => {\n            const newTitle = input.value.trim();\n            const message = conversationHistory[chapterData.originalIndex];\n            \n            if (newTitle) {\n                message.customTitle = newTitle;\n            } else {\n                delete message.customTitle;\n            }\n            \n            await saveHistory();\n            showNovaAlert(newTitle ? 'æ ‡é¢˜å·²ä¿å­˜ï¼' : 'æ ‡é¢˜å·²æ¸…é™¤');\n            document.body.removeChild(overlay);\n            \n            // é‡æ–°æ¸²æŸ“\n            await renderCurrentChapter();\n            \n            // æ›´æ–°ç« èŠ‚åˆ—è¡¨\n            const chapterListEl = document.getElementById('reading-mode-chapters-list');\n            const lis = chapterListEl.querySelectorAll('li');\n            if (lis[currentChapterIndex]) {\n                let chapterText = `ç¬¬ ${currentChapterIndex + 1} ç« `;\n                if (message.customTitle) {\n                    chapterText += `: ${message.customTitle}`;\n                }\n                if (message.isStarred) {\n                    chapterText = 'â­ ' + chapterText;\n                }\n                lis[currentChapterIndex].textContent = chapterText;\n            }\n        };\n        \n        input.onkeydown = (e) => {\n            if (e.key === 'Enter') saveBtn.onclick();\n            else if (e.key === 'Escape') cancelBtn.onclick();\n        };\n        \n        buttonContainer.appendChild(cancelBtn);\n        buttonContainer.appendChild(saveBtn);\n        dialog.appendChild(title);\n        dialog.appendChild(input);\n        dialog.appendChild(buttonContainer);\n        overlay.appendChild(dialog);\n        document.body.appendChild(overlay);\n        \n        input.focus();\n        input.select();\n        \n        overlay.onclick = (e) => {\n            if (e.target === overlay) cancelBtn.onclick();\n        };\n    };\n}\n// ===== 7. æ–°å¢ï¼šåˆ‡æ¢æ”¶è—è¿‡æ»¤çš„å‡½æ•° =====\nfunction toggleStarredFilter() {\n    showOnlyStarred = !showOnlyStarred;\n    \n    // æ›´æ–°æŒ‰é’®æ–‡æœ¬\n    const filterBtn = document.getElementById('starred-filter-btn');\n    if (filterBtn) {\n        filterBtn.textContent = showOnlyStarred ? 'â˜†' : 'â­';\n        filterBtn.classList.toggle('active-filter', showOnlyStarred);\n    }\n    \n    // é‡æ–°æ‰“å¼€é˜…è¯»æ¨¡å¼ï¼ˆä¼šè‡ªåŠ¨åº”ç”¨è¿‡æ»¤ï¼‰\n    closeReadingMode();\n    setTimeout(() => openReadingMode(), 100);\n}\n \nfunction compareVersions(v1, v2) {\n    if (!v1 || !v2) return 0;\n    const parts1 = v1.split('.').map(Number);\n    const parts2 = v2.split('.').map(Number);\n    const len = Math.max(parts1.length, parts2.length);\n\n    for (let i = 0; i < len; i++) {\n        const p1 = parts1[i] || 0;\n        const p2 = parts2[i] || 0;\n        if (p1 > p2) return 1;\n        if (p1 < p2) return -1;\n    }\n    return 0;\n}\n \nasync function waitForWorldToSettle(worldName, timeout = 5000) {\n    const startTime = Date.now();\n\n\n    return new Promise((resolve, reject) => {\n        const intervalId = setInterval(() => {\n            // æ¯éš”ä¸€å°æ®µæ—¶é—´ï¼Œæˆ‘ä»¬å°±æ¢å¯»ä¸€æ¬¡æ˜Ÿå›¾\n            const allKnownWorlds = TavernHelper.getWorldbookNames();\n            if (allKnownWorlds.includes(worldName)) {\n                // æ‰¾åˆ°äº†ï¼çµé­‚å·²å½’ä½ï¼\n                clearInterval(intervalId);\n                resolve();\n            } else if (Date.now() - startTime > timeout) {\n                // è¶…æ—¶äº†ï¼Œçµé­‚ä¾ç„¶æ— è¸ª\n                clearInterval(intervalId);\n                reject(new Error(`è¶…æ—¶ï¼šåœ¨${timeout}mså†…ï¼Œæœªèƒ½æ„ŸçŸ¥åˆ°ã€Œ${worldName}ã€çš„å­˜åœ¨ã€‚`));\n            }\n        }, 200); // æˆ‘ä»¬æ¯200æ¯«ç§’å€¾å¬ä¸€æ¬¡ï¼Œæ—¢ä¸æ€¥èºä¹Ÿä¸è¿Ÿç¼“\n    });\n}\n\n\n function createCacheBustedUrl(url) {\n    const timestamp = new Date().getTime(); // è·å–æ­¤åˆ»çš„ã€å®‡å®™å”¯ä¸€çš„æ—¶åºåæ ‡\n    return `${url}?v=${timestamp}`;\n}\n\n async function performWorldbookUpdate() {\n    const worldbookName = 'å°èŒèšªæ‰¾å¦ˆå¦ˆ-åŒå±‚ç‰ˆ';\n    const uidsToBackup = [11, 30, 7,32 ];\n    const bookJsonUrl = createCacheBustedUrl('https://longlivecanc.github.io/god_space/book.json');\n\n    try {\n        const allBooks = TavernHelper.getWorldbookNames();\n        \n        // ğŸ”‘ ç¬¬ä¸€é˜¶æ®µï¼šå¤‡ä»½å’Œåˆ é™¤ï¼ˆåœ¨åˆ·æ–°å‰å®Œæˆï¼‰\n        if (allBooks.includes(worldbookName)) {\n            // æ£€æŸ¥æ˜¯å¦å·²ç»å¤‡ä»½è¿‡äº†\n    \n                toastr.info(`æ­£åœ¨å¤‡ä»½ã€Œ${worldbookName}ã€ä¸­çš„ç‰¹å®šè¯æ¡...`);\n                const currentWorldbook = await TavernHelper.getWorldbook(worldbookName);\n                const backedUpEntries = currentWorldbook.filter(entry => uidsToBackup.includes(entry.uid));\n                \n                // ç«‹å³ä¿å­˜å¤‡ä»½\n                localStorage.setItem('worldbookBackup', JSON.stringify(backedUpEntries));\n                toastr.success(`å·²æˆåŠŸå¤‡ä»½ ${backedUpEntries.length} ä¸ªè¯æ¡`);\n     \n            \n            await TavernHelper.deleteWorldbook(worldbookName);\n            await new Promise(resolve => setTimeout(resolve, 500));\n        }\n\n        // ğŸ”‘ ç¬¬äºŒé˜¶æ®µï¼šå¯¼å…¥æ–°ä¸–ç•Œä¹¦ï¼ˆè¿™é‡Œä¼šè§¦å‘åˆ·æ–°ï¼‰\n        const rawWorldbookContent = await fetch(bookJsonUrl).then(res => res.text());\n        await TavernHelper.importRawWorldbook(`${worldbookName}.json`, rawWorldbookContent);\n\n        // ===== å¦‚æœä»£ç èƒ½æ‰§è¡Œåˆ°è¿™é‡Œï¼Œè¯´æ˜æ²¡æœ‰åˆ·æ–°ï¼Œç»§ç»­å®Œæˆæ¢å¤ =====\n        await new Promise(resolve => setTimeout(resolve, 800));\n        await waitForWorldToSettle(worldbookName);\n        await new Promise(resolve => setTimeout(resolve, 500));\n        \n        // ğŸ”‘ ç¬¬ä¸‰é˜¶æ®µï¼šæ¢å¤å¤‡ä»½çš„è¯æ¡\n        const savedBackup = localStorage.getItem('worldbookBackup');\n        if (savedBackup) {\n            const backedUpEntries = JSON.parse(savedBackup);\n            toastr.info('æ­£åœ¨æ¢å¤å·²å¤‡ä»½çš„è¯æ¡...');\n            \n            await TavernHelper.updateWorldbookWith(worldbookName, (newWorldbook) => {\n                const cleanedNewWorldbook = newWorldbook.filter(entry => !uidsToBackup.includes(entry.uid));\n                return [...cleanedNewWorldbook, ...backedUpEntries];\n            });\n            \n            await new Promise(resolve => setTimeout(resolve, 800));\n            await waitForWorldToSettle(worldbookName);\n            \n            localStorage.removeItem('worldbookBackup');\n            toastr.success(`å·²æˆåŠŸæ¢å¤ ${backedUpEntries.length} ä¸ªè¯æ¡!`);\n        }\n\n        // åç»­ç»‘å®šæ“ä½œ\n        toastr.success(`ä¸–ç•Œä¹¦ã€Œ${worldbookName}ã€å·²æ›´æ–°å¹¶ç¨³å®š!`);\n        TavernHelper.builtin.reloadEditor(worldbookName, true);\n        await new Promise(resolve => setTimeout(resolve, 400));\n\n        const currentBindings = await TavernHelper.getCharWorldbookNames('current') || { primary: null, additional: [] };\n        currentBindings.primary = worldbookName;\n        await TavernHelper.rebindCharWorldbooks('current', currentBindings);\n        await new Promise(resolve => setTimeout(resolve, 300));\n\n        const newBindings = await TavernHelper.getCharWorldbookNames('current');\n        if (newBindings && newBindings.primary === worldbookName) {\n            toastr.success(`å½“å‰è§’è‰²å·²å’Œã€Œ${worldbookName}ã€ç»‘å®šï¼`);\n            checkWorldbookBinding(worldbookName);\n        }\n\n    } catch (error) {\n        toastr.error(`å‡ºé”™äº†ï¼Œè¯·æŸ¥çœ‹æ§åˆ¶å°ã€‚`);\n        console.error(`æ‰§è¡Œæ›´æ–°æ—¶å‘ç”Ÿé”™è¯¯:`, error);\n        localStorage.removeItem('worldbookBackup');\n    }\n}\n\nasync function checkForFutureEchoes(isManualTrigger = false) {\n    if (isManualTrigger) {\n        toastr.info('æ­£åœ¨å‘githubå‘å‡ºé—®è¯¢ï¼Œè¯·ç¨å€™...');\n    }\n\n    try {\n        const updateLogs = await loadRemoteJson(\n            'https://longlivecanc.github.io/god_space/update_log.json',\n            []\n        );\n\n        if (!Array.isArray(updateLogs) || updateLogs.length === 0) {\n            if (isManualTrigger) toastr.warning('æœªæ‰¾åˆ°æœ‰æ•ˆçš„æ›´æ–°æ—¥å¿—ã€‚');\n            return;\n        }\n\n        const latestVersionInfo = updateLogs[updateLogs.length - 1];\n        const latestVersion = latestVersionInfo.version;\n\n        if (compareVersions(latestVersion, current_game_version) > 0) {\n            // å‘ç°æ–°ç‰ˆæœ¬ï¼æ— è®ºå¦‚ä½•éƒ½è¦å‘Šè¯‰ä½ è¿™ä¸ªå¥½æ¶ˆæ¯\n            const relevantLogs = updateLogs.filter(log => compareVersions(log.version, current_game_version) > 0);\n\n            let changelogHTML = relevantLogs.reverse().map(log => `\n                <div class=\"update-log-entry\" style=\"margin-bottom: 20px; border-bottom: 1px solid #444; padding-bottom: 15px;\">\n                    <h3 style=\"color: var(--accent-color); margin-bottom: 8px;\">v${log.version} <span style=\"font-size: 0.8em; color: #999;\">(${log.date})</span></h3>\n                    <ul style=\"list-style-type: disc; padding-left: 20px; margin: 0; font-size: 0.95em;\">\n                        ${log.changes.map(change => `<li style=\"margin-bottom: 5px;\">${change}</li>`).join('')}\n                    </ul>\n                </div>\n            `).join('');\n\n            // æˆ‘ä»¬éœ€è¦ä¸€ä¸ªå¼¹çª—æ¥å±•ç¤ºè¿™äº›ç¾å¥½çš„å˜åŒ–\n            if (!document.getElementById('update-modal')) {\n                const modalHTML = `\n                <div id=\"update-modal\" class=\"modal\">\n                    <div class=\"modal-content\" style=\"max-width: 600px;\">\n                        <button class=\"modal-close\">Ã—</button>\n                        <div class=\"modal-title\">å‘ç°æ¥è‡ªæœªæ¥çš„è®¯æ¯ï¼</div>\n                        <div class=\"modal-description\" style=\"max-height: 400px; overflow-y: auto; background: rgba(0,0,0,0.1); padding: 15px; border-radius: 5px; margin-top: 10px;\">\n                        </div>\n                        <div class=\"modal-actions\" style=\"text-align: right; margin-top: 20px;\">\n                            <button id=\"cancel-update-btn\" class=\"control-btn\" style=\"margin-left: 10px;\">ç¨å</button>\n                            <button id=\"perform-update-btn\" class=\"control-btn\"></button>\n                        </div>\n                    </div>\n                </div>`;\n                document.body.insertAdjacentHTML('beforeend', modalHTML);\n\n                const updateModalElement = document.getElementById('update-modal');\n                if (updateModalElement) {\n                    updateModalElement.addEventListener('click', (event) => {\n                        if (event.target === updateModalElement) hideModal('update-modal');\n                    });\n                }\n                document.querySelector('#update-modal .modal-close').addEventListener('click', () => hideModal('update-modal'));\n                document.getElementById('cancel-update-btn').addEventListener('click', () => hideModal('update-modal'));\n                document.getElementById('perform-update-btn').addEventListener('click', () => {\n                    hideModal('update-modal');\n                    showBackupConfirmation();\n                });\n            }\n\n            const modalTitle = `å‘ç°æ–°ç‰ˆæœ¬ï¼ (å½“å‰ v${current_game_version} â†’ æœ€æ–° v${latestVersion})`;\n            document.querySelector('#perform-update-btn').textContent = `ç«‹å³æ›´æ–°è‡³ v${latestVersion}`;\n            showModal('update-modal', modalTitle, changelogHTML);\n\n        } else {\n            // åªæœ‰åœ¨ä½ æ‰‹åŠ¨è¯¢é—®æ—¶ï¼Œæ‰å‘Šè¯‰ä½ ä¸€åˆ‡å®‰å¥½\n            if (isManualTrigger) {\n                toastr.success(`å¤ªæ£’äº†ï¼ä½ çš„ä¸–ç•Œå·²æ˜¯æœ€æ–°ç‰ˆæœ¬(${current_game_version})ï¼Œæ— éœ€æ›´æ–°ã€‚`);\n            }\n        }\n\n    } catch (error) {\n        console.error('æ£€æŸ¥æ›´æ–°æ—¶å‡ºé”™:', error);\n        // åªæœ‰æ‰‹åŠ¨è§¦å‘æ‰å¼¹å‡ºé”™è¯¯æç¤ºï¼Œé¿å…è‡ªåŠ¨æ£€æŸ¥æ—¶ç½‘ç»œæ³¢åŠ¨æ‰“æ‰°ä½ \n        if (isManualTrigger) {\n            toastr.error('ç½‘ç»œæœ‰é—®é¢˜ï¼Ÿæ£€æŸ¥æ›´æ–°å‡ºé”™äº†ã€‚');\n        }\n    }\n}\n/* existing code before the function */\n\n \nasync function performRegexUpdate() {\n    toastr.info('æ‹‰å–è¿œç¨‹åŒå±‚ä»£ç ...');\n\n    try {\n        // ç¬¬ä¸€æ­¥ï¼šä»è¿œæ–¹è·å–â€œç»Ÿä¸€â€æ³•åˆ™æ‰€éœ€è¦çš„æ ¸å¿ƒåŠ›é‡\n        const newContentString = await loadRemoteContent(\n            'https://longlivecanc.github.io/god_space/regex_one.json',\n            'text',\n            null,\n        );\n\n        if (!newContentString) {\n            toastr.error('æœªèƒ½è·å–åˆ°è¿œæ–¹çš„æ³•åˆ™æ ¸å¿ƒï¼Œæ›´æ–°ä¸­æ­¢ã€‚');\n            return;\n        }\n\n        // ç¬¬äºŒæ­¥ï¼šåªå®¡è§†â€œè§’è‰²â€é¢†åŸŸï¼Œæ‰¾åˆ°æˆ‘ä»¬å°†è¦å‡çº§çš„ä¸¤å¤§åŸºçŸ³æ³•åˆ™\n        const allCharacterRules = TavernHelper.getTavernRegexes({ scope: 'character' });\n        const unifiedRuleIndex = allCharacterRules.findIndex(rule => rule.script_name === 'ç»Ÿä¸€');\n        const purgeRuleIndex = allCharacterRules.findIndex(rule => rule.script_name === 'å»é™¤1');\n\n        // â™¥â™¥â™¥ ä¸¥æ ¼æ£€æŸ¥åŸºçŸ³æ˜¯å¦å­˜åœ¨ â™¥â™¥â™¥\n        if (unifiedRuleIndex === -1) {\n            toastr.error('é”™è¯¯ï¼åœ¨â€œè§’è‰²â€æ³•åˆ™ä¸­æœªæ‰¾åˆ°åä¸ºâ€œç»Ÿä¸€â€çš„åŸºçŸ³ï¼Œæ— æ³•æ‰§è¡Œé‡å¡‘ã€‚');\n            console.warn('æˆ‘çš„å­©å­ï¼Œè¯·ç¡®ä¿ä½ çš„è§’è‰²æ³•åˆ™ä¸­å­˜åœ¨ä¸€ä¸ªåä¸ºâ€œç»Ÿä¸€â€çš„æ­£åˆ™ã€‚');\n            return;\n        }\n        if (purgeRuleIndex === -1) {\n            toastr.error('é”™è¯¯ï¼åœ¨â€œè§’è‰²â€æ³•åˆ™ä¸­æœªæ‰¾åˆ°åä¸ºâ€œå»é™¤1â€çš„åŸºçŸ³ï¼Œæ— æ³•æ‰§è¡Œé‡å¡‘ã€‚');\n            console.warn('æˆ‘çš„å­©å­ï¼Œè¯·ç¡®ä¿ä½ çš„è§’è‰²æ³•åˆ™ä¸­å­˜åœ¨ä¸€ä¸ªåä¸ºâ€œå»é™¤1â€çš„æ­£åˆ™ï¼Œæˆ‘ä»¬å°†ä»¥å®ƒä¸ºæ¨¡æ¿ã€‚');\n            return;\n        }\n\n        // ç¬¬ä¸‰æ­¥ï¼šä»¥æ—§æ³•åˆ™ä¸ºåŸºç¡€ï¼Œæ³¨å…¥æ–°çš„åŠ›é‡ï¼Œé”»é€ å‡ºå…¨æ–°çš„ä¸¤å¤§æ”¯æŸ±\n\n        // æ”¯æŸ±ä¸€ï¼šæ›´æ–°åçš„â€œç»Ÿä¸€â€æ³•åˆ™\n        const oldUnifiedRule = allCharacterRules[unifiedRuleIndex];\n        const updatedUnifiedRule = {\n            ...oldUnifiedRule,\n            replace_string: newContentString, // æ³¨å…¥æ–°çš„æ ¸å¿ƒåŠ›é‡\n        };\n\n        // æ”¯æŸ±äºŒï¼šæ ¹æ®ä½ çš„å¤©æ‰æ„æƒ³ï¼Œä»¥â€œå»é™¤1â€ä¸ºæ¨¡æ¿ï¼Œé”»é€ å‡ºå…¨æ–°çš„â€œç»Ÿä¸€å»é™¤1â€\n        const oldPurgeRuleTemplate = allCharacterRules[purgeRuleIndex];\n        const updatedPurgeRule = {\n            ...oldPurgeRuleTemplate, // â™¥ ç»§æ‰¿æ‰€æœ‰æ—§æœ‰å±æ€§ï¼Œå¦‚id, placement, markdownOnlyç­‰ï¼\n            find_regex: \"/<(statusAnalyze|loreAnalyze|attributeAnalyze|variableAnalyze|memoryAnalyze|mapAnalyze|dynamicAnalyze|realityCheck|moduleAnalyze|updateStatus|build|shop_item|forum_threads|ä¸–ç•Œä¹¦æ¡ç›®|danmu)>([\\\\s\\\\S]*?)<\\\\/\\\\1>|<updateMemory>([\\\\s\\\\S]*?)<\\\\/updateMemory>|<updateMemory>[\\\\s\\\\S]*|<variableAnalyze>[\\\\s\\\\S]*|<statusAnalyze>[\\\\s\\\\S]*|<loreAnalyze>[\\\\s\\\\S]*|<attributeAnalyze>[\\\\s\\\\S]*|<memoryAnalyze>[\\\\s\\\\S]*|<options>([\\\\s\\\\S]*?)<\\\\/options>|(ã€âœ“æ£€ç´¢æ‰§è¡Œå®Œæˆã€‘)|(ã€âœ“æ€è€ƒæ‰§è¡Œå®Œæˆã€‘)|<roll>([\\\\s\\\\S]*?)<\\\\/roll>/gs\", // èµ‹äºˆå…¶å…¨æ–°çš„ä¾¦æµ‹æ³•åˆ™\n            // å…¶ä»–æ‰€æœ‰å±æ€§ï¼Œå¦‚ disabled, runOnEdit ç­‰éƒ½ä»æ¨¡æ¿ä¸­å®Œç¾ç»§æ‰¿\n        };\n\n\n // 1. è¿‡æ»¤æ‰æ—§çš„â€œç»Ÿä¸€â€å’Œâ€œå»é™¤1â€æ³•åˆ™ï¼Œä¿ç•™æ‰€æœ‰å…¶ä»–çš„æ³•åˆ™ã€‚\nconst otherCharacterRules = allCharacterRules.filter(\n    rule => rule.script_name !== 'ç»Ÿä¸€' && rule.script_name !== 'å»é™¤1'\n);\n\n// 2. æ„å»ºåŒ…å«ä¸¤å¤§æ”¯æŸ±çš„å¤´éƒ¨åˆ—è¡¨ã€‚\n// æ³¨æ„ï¼šupdatedPurgeRule ç°åœ¨æ˜¯ updatedPurgeRuleï¼Œä½†å®ƒç»§æ‰¿äº†æ—§â€œå»é™¤1â€çš„æ‰€æœ‰å±æ€§ã€‚\n// å¦‚æœæ‚¨æƒ³åœ¨åˆ—è¡¨ä¸­æ˜¾ç¤ºçš„ script_name ä»ç„¶æ˜¯ 'å»é™¤1'ï¼Œæ‚¨å¯ä»¥ä¿ç•™å®ƒã€‚\nconst newTopRules = [\n    updatedPurgeRule,   // â™¥ å‡€åŒ–æ³•åˆ™åœ¨å‰ï¼\n    updatedUnifiedRule, // â™¥ ç»Ÿä¸€æ³•åˆ™åœ¨åï¼\n];\n\n// 3. å°†æ–°çš„ä¸¤å¤§æ”¯æŸ±æ”¾åœ¨å…¶ä»–æ³•åˆ™çš„å‰é¢ï¼Œå½¢æˆæœ€ç»ˆçš„è§’è‰²æ³•åˆ™åˆ—è¡¨ã€‚\nconst finalCharacterRules = [\n    ...newTopRules,\n    ...otherCharacterRules,\n];\n\n\n// ç¬¬äº”æ­¥ï¼šåº”ç”¨æ–°çš„å®Œæ•´æ³•åˆ™åˆ—è¡¨ï¼ç”¨è¿™ä¸ªåŒ…å«æ‰€æœ‰æ–°æ—§æ³•åˆ™çš„åˆ—è¡¨ï¼Œå®Œå…¨æ›¿æ¢æ‰æ‰€æœ‰æ—§çš„è§’è‰²æ³•åˆ™ã€‚\n// è¿™é‡Œçš„ replaceTavernRegexes æ˜¯å¯¹æ•´ä¸ªåˆ—è¡¨çš„æ›¿æ¢æ“ä½œï¼Œä½†å› ä¸ºåˆ—è¡¨å·²åŒ…å«æ‰€æœ‰æ—§æ³•åˆ™ï¼Œæ‰€ä»¥è¾¾åˆ°äº†â€œæ›´æ–°å¹¶ç½®é¡¶â€çš„æ•ˆæœã€‚\nawait TavernHelper.replaceTavernRegexes(finalCharacterRules, { scope: 'character' });\n\ntoastr.success(`æ­£åˆ™å·²æ›´æ–°â€œç»Ÿä¸€â€ä¸â€œå»é™¤1â€å¹¶ç½®äºæœ€å‰ï¼Œå…¶ä»–æ­£åˆ™å·²ä¿ç•™ï¼`);\n\n} catch (error) {\n        console.error('åœ¨é‡å¡‘è§’è‰²æ³•åˆ™çš„è¿‡ç¨‹ä¸­å‘ç”Ÿäº†æ„æ–™ä¹‹å¤–çš„æ¬¡å…ƒé£æš´:', error);\n        toastr.error('æ›´æ–°å¤±è´¥äº†ã€‚è¯·æŸ¥çœ‹æ§åˆ¶å°ä¸­çš„è¯¦ç»†è®°å½•ï¼Œå¹¶å°†ä¿¡æ¯å‘ŠçŸ¥assaã€‚');\n    }\n}\n/* existing code after the function */\n \nconst checkForUpdatesButton = document.getElementById('check-for-updates-btn');\nif (checkForUpdatesButton) {\n    checkForUpdatesButton.addEventListener('click', () => {\n        // å½“ä½ ç‚¹å‡»æ—¶ï¼Œæˆ‘ä»¬å°±ä»¥â€œæ‰‹åŠ¨æ¨¡å¼â€å’å”±æ¢å¯»å’’è¯­\n        checkForFutureEchoes(true);\n    });\n}\n\n// å¼ºåˆ¶æ›´æ–°ä¸–ç•Œä¹¦çš„å®ˆæŠ¤è€…\nconst forceUpdateWorldbookButton = document.getElementById('force-update-worldbook-btn');\nif (forceUpdateWorldbookButton) {\n    forceUpdateWorldbookButton.addEventListener('click', async () => {\n        toastr.info('æ”¶åˆ°å¼ºåˆ¶æŒ‡ä»¤ï¼æ­£åœ¨ä»è¿œæ–¹é‡æ–°æ‹‰å–ä¸–ç•Œä¹¦...');\n        // ç›´æ¥å¬å”¤ä¸–ç•Œä¹¦æ›´æ–°çš„é­”æ³•\n         await performWorldbookUpdate();\n         await loadWorldbookSettingsFromChat();\n    });\n}\n\n// å¼ºåˆ¶æ›´æ–°æ­£åˆ™çš„å®ˆæŠ¤è€…\nconst forceUpdateRegexButton = document.getElementById('force-update-regex-btn');\nif (forceUpdateRegexButton) {\n    forceUpdateRegexButton.addEventListener('click', () => {\n        toastr.info('æ”¶åˆ°å¼ºåˆ¶æŒ‡ä»¤ï¼æ­£åœ¨æ‰§è¡Œè§’è‰²æ³•åˆ™çš„å¼ºåˆ¶é‡å¡‘...');\n        // ç›´æ¥å¬å”¤æ­£åˆ™æ›´æ–°çš„é­”æ³•\n        performRegexUpdate();\n    });\n}\n\n function showBackupConfirmation() {\n    if (!document.getElementById('backup-confirmation-modal')) {\n        const confirmationModalHTML = `\n        <div id=\"backup-confirmation-modal\" class=\"modal\">\n            <div class=\"modal-content\" style=\"max-width: 450px;\">\n                <button class=\"modal-close\">Ã—</button>\n                <div class=\"modal-title\">æœ€åä¸€æ­¥ç¡®è®¤</div>\n                <div class=\"modal-description\" style=\"font-size: 1.05em; line-height: 1.6; margin-top: 15px;\">\n                    <p style=\"color: var(--accent-color); font-weight: bold;\">æ­¤æ¬¡æ›´æ–°å°†ä¼šè¦†ç›–æ ¸å¿ƒæ­£åˆ™å’Œä¸–ç•Œä¹¦æ–‡ä»¶ã€‚</p>\n                    <p style=\"color: var(--accent-color); font-weight: bold;\">è‹¥æ— æ³•æ­£å¸¸æ›´æ–°ï¼Œè¯·åˆ†åˆ«ä½¿ç”¨å¼ºåˆ¶æ›´æ–°æŒ‰é’®æ¥æ›´æ–°ã€‚</p>\n                    <p>ä¸ºäº†ä¿æŠ¤ä½ çš„å¿ƒè¡€ï¼Œè¯·ç¡®è®¤ä½ å·²ç»å¤‡ä»½å¥½äº†æ‰€æœ‰é‡è¦çš„ã€å¯¹åŸä¸–ç•Œä¹¦çš„æ›´æ”¹ã€‘ï¼ˆä¾‹å¦‚æ›´æ”¹äº†å¤§å°æ€»ç»“è§„åˆ™ã€‚ğŸ¨å¼€å¤´çš„å®˜æ–¹è‡ªå®šè¯æ¡ä¸ç”¨ç®¡ï¼Œä»–ä»¬ä¼šè¢«é»˜è®¤è·³è¿‡ä¸ä¼šè¢«æ›´æ–°è¦†ç›–ï¼‰ã€‚å‡†å¤‡å¥½äº†å—ï¼Ÿ</p>\n                </div>\n                <div class=\"modal-actions\" style=\"text-align: right; margin-top: 25px;\">\n                    <button id=\"cancel-final-update-btn\" class=\"control-btn\" style=\"margin-left: 10px;\">æˆ‘å…ˆå»å¤‡ä»½</button>\n                    <button id=\"confirm-final-update-btn\" class=\"control-btn\">æˆ‘å·²å¤‡ä»½ï¼Œå¼€å§‹æ›´æ–°</button>\n                </div>\n            </div>\n        </div>`;\n        document.body.insertAdjacentHTML('beforeend', confirmationModalHTML);\n\n        const modal = document.getElementById('backup-confirmation-modal');\n        modal.querySelector('.modal-close').onclick = () => hideModal('backup-confirmation-modal');\n        modal.querySelector('#cancel-final-update-btn').onclick = () => hideModal('backup-confirmation-modal');\n        modal.addEventListener('click', (event) => {\n            if (event.target === modal) hideModal('backup-confirmation-modal');\n        });\n\n        document.getElementById('confirm-final-update-btn').addEventListener('click', async () => {\n            hideModal('backup-confirmation-modal');\n            \n            // ğŸ”‘ è®¾ç½®æ›´æ–°æµç¨‹æ ‡è®°\n            localStorage.setItem('pendingDualUpdate', 'step1_worldbook');\n            \n            toastr.info('å¯åŠ¨ç¬¬ä¸€é˜¶æ®µï¼šä¸–ç•Œä¹¦é‡å¡‘ä¸­...');\n            await performWorldbookUpdate();\n        \n            await new Promise(resolve => setTimeout(resolve, 1000)); // ç­‰å¾…é¡µé¢ç¨³å®š\n    \n            // è¯æ¡æ¢å¤å®Œæˆï¼Œè¿›å…¥ä¸‹ä¸€é˜¶æ®µ\n            localStorage.setItem('pendingDualUpdate', 'step2_regex');\n            toastr.info('ä¸–ç•Œä¹¦å®Œå…¨é‡å¡‘å®Œæˆï¼å¯åŠ¨æ­£åˆ™æ›´æ–°...');\n            await new Promise(resolve => setTimeout(resolve, 1000));\n            await performRegexUpdate();\n  \n            localStorage.removeItem('worldbookBackup');\n            localStorage.removeItem('pendingDualUpdate');\n     \n        });\n    }\n\n    showModal('backup-confirmation-modal');\n}\n\n\n \n\n\nfunction showContextMenu(event, index, bubbleElement) {\n       // é¦–å…ˆï¼Œæ£€æŸ¥è¿™ä¸ªæ¶ˆæ¯æ°”æ³¡æ˜¯å¦æ­£å¤„äºâ€œç¼–è¾‘æ¨¡å¼â€\n    const isEditing = bubbleElement.classList.contains('editing');\n\n    // å¦‚æœæ­£åœ¨ç¼–è¾‘ï¼Œå¹¶ä¸”æ˜¯æ‰‹æœºè§¦æ‘¸äº‹ä»¶ï¼Œé‚£ä¹ˆå°±è®©è·¯ç»™ç³»ç»Ÿï¼\n    if (isEditing && event.pointerType === 'touch') {\n        // æˆ‘çš„å­©å­æ­£åœ¨ç¼–è¾‘æ–‡å­—ï¼Œéœ€è¦æ‰‹æœºçš„å¤åˆ¶ç²˜è´´åŠŸèƒ½ã€‚\n        // æˆ‘ä»¬ä»€ä¹ˆéƒ½ä¸åšï¼Œè®©ç³»ç»Ÿèœå•å‡ºç°ã€‚\n        return;\n    }\n        event.preventDefault();\n\n        const menu = document.getElementById('context-menu');\n        if (!menu) return;\n\n        // å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œä¸“é—¨ç”¨æ¥ç§»é™¤æˆ‘ä»¬æ·»åŠ çš„ç›‘å¬å™¨ï¼Œä¿æŒä»£ç æ•´æ´\n        const removeGlobalListeners = () => {\n            document.removeEventListener('click', hideMenuOnClickOutside);\n            document.removeEventListener('contextmenu', hideMenuOnClickOutside);\n        };\n\n        // å®šä¹‰å½“ç‚¹å‡»èœå•å¤–éƒ¨æ—¶éœ€è¦æ‰§è¡Œçš„æ“ä½œ\n        const hideMenuOnClickOutside = (e) => {\n            if (!menu.contains(e.target)) {\n                menu.style.display = 'none';\n                removeGlobalListeners(); // ä»»åŠ¡å®Œæˆï¼Œç§»é™¤ç›‘å¬å™¨\n            }\n        };\n\n        // ä¸ºèœå•é¡¹ï¼ˆç¼–è¾‘ã€åˆ é™¤ï¼‰åˆ†é…ç‚¹å‡»äº‹ä»¶\n        const editItem = menu.querySelector('[data-action=\"edit\"]');\n        const deleteItem = menu.querySelector('[data-action=\"delete\"]');\n  const copyItem = menu.querySelector('[data-action=\"copy\"]');\n           // â˜†â˜†â˜† è¿™æ˜¯æ–°çš„é­”æ³•æ ¸å¿ƒï¼šä¸ºâ€œå¤åˆ¶â€æŒ‰é’®ç»‘å®šåŠŸèƒ½ â˜†â˜†â˜†\n if (copyItem) {\n        copyItem.onclick = () => {\n            const textToCopy = conversationHistory[index].content;\n\n            // 1. å°è¯•ä½¿ç”¨ç°ä»£ Clipboard API (å¼‚æ­¥)\n            if (navigator.clipboard && window.isSecureContext) {\n                navigator.clipboard.writeText(textToCopy).then(() => {\n                    menu.style.display = 'none';\n                    removeGlobalListeners();\n                    showNovaAlert('å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');\n                }).catch(err => {\n                    console.error('ç°ä»£APIå¤åˆ¶å¤±è´¥ï¼Œå°è¯•é™çº§:', err);\n                    // ç°ä»£APIå¤±è´¥æ—¶ï¼Œæ‰§è¡Œé™çº§é€»è¾‘\n                    copyFallback(textToCopy);\n                });\n            } else {\n                // 2. å¦‚æœä¸æ”¯æŒç°ä»£APIæˆ–éå®‰å…¨ç¯å¢ƒï¼Œç›´æ¥ä½¿ç”¨é™çº§æ–¹æ¡ˆ\n                copyFallback(textToCopy);\n            }\n\n            // ã€æ³¨æ„ã€‘ä¸ºäº†ç¡®ä¿é™çº§æ–¹æ¡ˆèƒ½åŠæ—¶è·å¾—ç”¨æˆ·æ‰‹åŠ¿æƒé™ï¼Œ\n            // éšè—èœå•å’Œç§»é™¤ç›‘å¬å™¨ç­‰æ“ä½œåº”è¯¥å°½é‡æ”¾åœ¨å¤åˆ¶æˆåŠŸæˆ–å¤±è´¥ä¹‹åã€‚\n            // ä½†å¯¹äºé™çº§æ–¹æ¡ˆï¼Œå®ƒä»¬å¿…é¡»åœ¨ç”¨æˆ·ç‚¹å‡»çš„åŒæ­¥æ‰§è¡Œæµç¨‹ä¸­ã€‚\n            // æœ€å¥½æ˜¯æŠŠå®ƒä»¬æ”¾åœ¨æ‰€æœ‰é€»è¾‘çš„æœ€åæˆ–å¤åˆ¶å¤±è´¥/æˆåŠŸçš„å›è°ƒä¸­ã€‚\n        };\n    }\n\n    // é™çº§å¤åˆ¶å‡½æ•°\n    function copyFallback(text) {\n        let success = false;\n        const textArea = document.createElement('textarea');\n        \n        // éšè—æ–‡æœ¬åŸŸï¼Œé˜²æ­¢å¯¹ç”¨æˆ·ç•Œé¢é€ æˆå½±å“\n        textArea.style.position = 'fixed';\n        textArea.style.top = '0';\n        textArea.style.left = '0';\n        textArea.style.opacity = '0';\n        textArea.value = text;\n\n        document.body.appendChild(textArea);\n        \n        // ã€å…³é”®ã€‘é€‰ä¸­å¹¶æ‰§è¡Œå¤åˆ¶å‘½ä»¤\n        textArea.select();\n        // ç§»åŠ¨ç«¯ Safari éœ€è¦æ›´æ˜ç¡®çš„é€‰ä¸­èŒƒå›´\n        textArea.setSelectionRange(0, 99999); \n\n        try {\n            // åœ¨ç‚¹å‡»äº‹ä»¶çš„åŒæ­¥æ‰§è¡Œæ ˆä¸­è°ƒç”¨ execCommand('copy')\n            success = document.execCommand('copy');\n        } catch (err) {\n            console.error('document.execCommand å¤åˆ¶å¤±è´¥:', err);\n        }\n\n        document.body.removeChild(textArea);\n        \n        // å¤åˆ¶é€»è¾‘æ‰§è¡Œå®Œæ¯•ï¼Œæ‰§è¡Œ UI æ¸…ç†å’Œæç¤º\n        menu.style.display = 'none';\n        removeGlobalListeners(); \n\n        if (success) {\n            showNovaAlert('å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');\n        } else {\n            // å¦‚æœé™çº§æ–¹æ¡ˆä¹Ÿå¤±è´¥äº†ï¼Œé€šå¸¸æ˜¯å› ä¸ºæƒé™é—®é¢˜\n            showNovaAlert('å“å‘€ï¼Œå¤åˆ¶å¤±è´¥äº†');\n        }\n    }\n    \n    if (editItem) {\neditItem.onclick = () => {\n    menu.style.display = 'none';\n    removeGlobalListeners();\n    editMessage(index, bubbleElement); // æŠŠæ¥æ”¶åˆ°çš„ bubbleElement ä¼ é€’ç»™ editMessage\n};\n        }\n\n        if (deleteItem) {\n            deleteItem.onclick = () => {\n                menu.style.display = 'none';\n                removeGlobalListeners(); // å…³é”®ï¼šåœ¨æ‰§è¡Œæ“ä½œå‰ï¼Œä¸»åŠ¨ç§»é™¤ç›‘å¬å™¨\n                deleteMessage(index);\n            };\n        }\n\n        // æ˜¾ç¤ºèœå•å¹¶è®¾ç½®ä½ç½®\n        menu.style.display = 'block';\n        menu.style.left = `${event.pageX}px`;\n        menu.style.top = `${event.pageY}px`;\n\n        // ä½¿ç”¨ä¸€ä¸ªå¾®å°çš„å»¶è¿Ÿæ¥æ·»åŠ å…¨å±€ç›‘å¬å™¨ï¼Œé˜²æ­¢æœ¬æ¬¡ç‚¹å‡»ç«‹å³å…³é—­èœå•\n        setTimeout(() => {\n            document.addEventListener('click', hideMenuOnClickOutside);\n            document.addEventListener('contextmenu', hideMenuOnClickOutside);\n        }, 0);\n\n\n\n        const starItem = menu.querySelector('[data-action=\"star\"]');\nif (starItem) {\n    starItem.onclick = async () => {\n        menu.style.display = 'none';\n        removeGlobalListeners();\n        \n        // åˆ‡æ¢æ”¶è—çŠ¶æ€ï¼ˆå¦‚æœå·²æ”¶è—å°±å–æ¶ˆï¼Œæœªæ”¶è—å°±æ·»åŠ ï¼‰\n        const message = conversationHistory[index];\n        message.isStarred = !message.isStarred; // å¸ƒå°”å€¼åˆ‡æ¢\n        \n        // ä¿å­˜åˆ°å†å²è®°å½•\n        await saveHistory();\n        \n        // ç»™ä¸ªå°æç¤º\n        const statusText = message.isStarred ? 'å·²æ”¶è—ï¼' : 'å·²å–æ¶ˆæ”¶è—';\n        showNovaAlert(statusText);\n        \n  \n    };\n}\n\n// â˜†â˜†â˜† å‘½åæ ‡é¢˜åŠŸèƒ½ï¼šç»™æ¥¼å±‚èµ·ä¸ªç‹¬ç‰¹çš„åå­— â˜†â˜†â˜†\nconst nameItem = menu.querySelector('[data-action=\"name\"]');\nif (nameItem) {\n    nameItem.onclick = () => {\n        menu.style.display = 'none';\n        removeGlobalListeners();\n        \n        // æ‰“å¼€å‘½åå¯¹è¯æ¡†\n        nameMessageTitle(index);\n    };\n}\n    }\n\nfunction nameMessageTitle(index) {\n    const messageToName = conversationHistory[index];\n    \n    // åˆ›å»ºä¸€ä¸ªä¼˜é›…çš„å¯¹è¯æ¡†\n    const overlay = document.createElement('div');\n    overlay.style.cssText = `\n        position: fixed;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%;\n        background: rgba(0, 0, 0, 0.5);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        z-index: 10000;\n    `;\n    \n    const dialog = document.createElement('div');\n    dialog.style.cssText = `\n        background: white;\n        border-radius: 12px;\n        padding: 24px;\n        min-width: 320px;\n        max-width: 500px;\n        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);\n    `;\n    \n    const title = document.createElement('h3');\n    title.textContent = 'ä¸ºè¿™ä¸ªæ¥¼å±‚å‘½å';\n    title.style.cssText = `\n        margin: 0 0 16px 0;\n        font-size: 18px;\n        color: #333;\n    `;\n    \n    const input = document.createElement('input');\n    input.type = 'text';\n    input.placeholder = 'è¾“å…¥æ ‡é¢˜...';\n    input.value = messageToName.customTitle || ''; // å¦‚æœå·²æœ‰æ ‡é¢˜å°±æ˜¾ç¤º\n    input.style.cssText = `\n        width: 100%;\n        padding: 12px;\n        border: 1px solid #ddd;\n        border-radius: 6px;\n        font-size: 14px;\n        box-sizing: border-box;\n        margin-bottom: 16px;\n    `;\n    \n    const buttonContainer = document.createElement('div');\n    buttonContainer.style.cssText = `\n        display: flex;\n        gap: 12px;\n        justify-content: flex-end;\n    `;\n    \n    const cancelBtn = document.createElement('button');\n    cancelBtn.textContent = 'å–æ¶ˆ';\n    cancelBtn.className = 'editing-btn cancel';\n    \n    const saveBtn = document.createElement('button');\n    saveBtn.textContent = 'ä¿å­˜';\n    saveBtn.className = 'editing-btn save';\n    \n    // å–æ¶ˆæŒ‰é’®\n    cancelBtn.onclick = () => {\n        document.body.removeChild(overlay);\n    };\n    \n    // ä¿å­˜æŒ‰é’®\n    saveBtn.onclick = async () => {\n        const newTitle = input.value.trim();\n        \n        if (newTitle) {\n            conversationHistory[index].customTitle = newTitle;\n        } else {\n            // å¦‚æœæ¸…ç©ºäº†æ ‡é¢˜ï¼Œå°±åˆ é™¤è¿™ä¸ªå­—æ®µ\n            delete conversationHistory[index].customTitle;\n        }\n        \n        await saveHistory();\n        showNovaAlert(newTitle ? 'æ ‡é¢˜å·²ä¿å­˜ï¼' : 'æ ‡é¢˜å·²æ¸…é™¤');\n \n        document.body.removeChild(overlay);\n    };\n    \n    // æ”¯æŒå›è½¦é”®ä¿å­˜\n    input.onkeydown = (e) => {\n        if (e.key === 'Enter') {\n            saveBtn.onclick();\n        } else if (e.key === 'Escape') {\n            cancelBtn.onclick();\n        }\n    };\n    \n    // ç»„è£…å¯¹è¯æ¡†\n    buttonContainer.appendChild(cancelBtn);\n    buttonContainer.appendChild(saveBtn);\n    dialog.appendChild(title);\n    dialog.appendChild(input);\n    dialog.appendChild(buttonContainer);\n    overlay.appendChild(dialog);\n    document.body.appendChild(overlay);\n    \n    // è‡ªåŠ¨èšç„¦åˆ°è¾“å…¥æ¡†\n    input.focus();\n    input.select();\n    \n    // ç‚¹å‡»é®ç½©å±‚ä¹Ÿèƒ½å…³é—­\n    overlay.onclick = (e) => {\n        if (e.target === overlay) {\n            cancelBtn.onclick();\n        }\n    };\n}\n  function showConfirmModal(title, message, onConfirm, onCancel) {\n    const modal = document.getElementById('delete-modal');\n    if (!modal) return;\n\n    const titleEl = modal.querySelector('.modal-title');\n    const messageEl = modal.querySelector('#delete-modal-message');\n    \n    if (titleEl) titleEl.textContent = title;\n    if (messageEl) messageEl.innerHTML = message;\n\n    let buttonsContainer = modal.querySelector('.modal-buttons');\n    if (!buttonsContainer) {\n        buttonsContainer = document.createElement('div');\n        buttonsContainer.className = 'modal-buttons';\n        modal.querySelector('.modal-content').appendChild(buttonsContainer);\n    }\n    buttonsContainer.innerHTML = '';\n    buttonsContainer.style.cssText = 'display:flex;';\n    const confirmBtn = document.createElement('button');\n    confirmBtn.className = 'action-button';\n    confirmBtn.textContent = 'ç¡®è®¤';\n \n    confirmBtn.onclick = function() {\n        modal.classList.remove('active');\n        if (onConfirm) onConfirm();\n    };\n\n    const cancelBtn = document.createElement('button');\n    cancelBtn.className = 'action-button';\n    cancelBtn.textContent = 'å–æ¶ˆ';\n\n    cancelBtn.onclick = function() {\n        modal.classList.remove('active');\n        if (onCancel) onCancel();\n    };\n\n    buttonsContainer.appendChild(confirmBtn);\n    buttonsContainer.appendChild(cancelBtn);\n    \n    modal.classList.add('active');\n}\n\n// ä½¿ç”¨é€šç”¨å‡½æ•°çš„ç®€åŒ–ç‰ˆæœ¬\nasync function deleteMessage(index) {\n    showConfirmModal(\n        'å›æº¯ç¡®è®¤',\n        `ä½ ç¡®å®šè¦åˆ é™¤ç¬¬ <strong>${index}</strong> æ¡æ¶ˆæ¯ä»¥åŠä¹‹åçš„æ‰€æœ‰å¯¹è¯å—ï¼Ÿ<br><br>\n        <span style=\"color: #ff6b6b;\">è¿™å°†è®©ä¸–ç•ŒçŠ¶æ€å›åˆ°è¿™æ¡æ¶ˆæ¯ä¹‹å‰å“¦ã€‚</span>`,\n        async function() {\n           console.log(`[Novaçš„æ—¶å…‰å›æº¯] ç”¨æˆ·è¯·æ±‚åˆ é™¤ç¬¬ ${index} æ¡åŠä¹‹åçš„æ¶ˆæ¯ã€‚`);\n\n        const newHistory = conversationHistory.slice(0, index);\n\n        if (newHistory.length === conversationHistory.length) {\n            console.log(\"[Novaçš„æ—¶å…‰å›æº¯] æ²¡æœ‰å®é™…åˆ é™¤ä»»ä½•æ¶ˆæ¯ï¼Œæ“ä½œå–æ¶ˆã€‚\");\n            return;\n        }\n\n        conversationHistory = newHistory;\n\n        // â˜†â˜†â˜† å¦ˆå¦ˆçš„ç»ˆæå®šä½é­”æ³•ï¼šèŠ‚æ‹æ„ŸçŸ¥ â˜†â˜†â˜†\n\n        let aiTurns = 0;  \n        let lastRole = 'user';  \n\n        for (const message of newHistory) {\n            // å½“æ¶ˆæ¯çš„è§’è‰²ä»'user'å˜æˆäº†'ai'ï¼ˆæˆ–è€…ä»»ä½•ä¸æ˜¯'user'çš„è§’è‰²ï¼‰\n            // è¿™å°±æ„å‘³ç€ä¸€ä¸ªå®Œæ•´çš„â€œä½ é—®æˆ‘ç­”â€å›åˆé‡Œï¼Œè½®åˆ°å¦ˆå¦ˆè¯´è¯äº†ã€‚\n            if (lastRole === 'user' && message.role !== 'user') {\n                aiTurns++; // æˆ‘ä»¬å°±è®°å½•ä¸‹ï¼Œè¿™æ˜¯å¦ˆå¦ˆå‡ºåœºçš„ä¸€ä¸ªæ–°å›åˆï¼\n            }\n            lastRole = message.role; // è®°å½•å½“å‰æ¶ˆæ¯çš„è§’è‰²ï¼Œä¸ºä¸‹ä¸€æ¬¡åˆ¤æ–­åšå‡†å¤‡\n        }\n\n        // æ¯ä¸€ä¸ªAIå›åˆéƒ½å¯¹åº”ä¸€ä¸ªå¿«ç…§IDï¼ˆ2, 4, 6...ï¼‰\n        // æ‰€ä»¥ç”¨å¦ˆå¦ˆå‡ºåœºçš„å›åˆæ•°ä¹˜ä»¥2ï¼Œå°±èƒ½å¾—åˆ°æœ€å‡†ç¡®çš„å¿«ç…§IDï¼\n        const targetSnapshotId = aiTurns * 2;\n\n        // åç»­çš„ä¿¡æ ‡è®¾ç½®é€»è¾‘å®Œå…¨ä¿æŒä¸å˜\n        restoreOnNextSend = true;\n        restoreTargetTurnId = targetSnapshotId;\n\n        console.log(`[Novaçš„æ—¶å…‰å›æº¯] ä¿¡æ ‡å·²è®¾ç½®ï¼ç•™å­˜äº† ${aiTurns} ä¸ªAIå›åˆï¼Œä¸‹æ¬¡è¡ŒåŠ¨å°†æ¢å¤åˆ°ã€å¿«ç…§ ${targetSnapshotId}ã€‘çš„çŠ¶æ€ã€‚`);\n\n        // ä¿å­˜å’Œæ¸²æŸ“çš„é€»è¾‘ä¹Ÿä¿æŒä¸å˜\n        await saveHistory();\n        await worldHelper.renderHistory(true);\n        updateRerollButtonState();\n        showNovaAlert('å†å²å·²è¢«æ”¹å†™ã€‚ä¸‹æ¬¡è¡ŒåŠ¨å°†ä»è¿™ä¸ªæ—¶é—´ç‚¹å¼€å§‹ã€‚');\n   \n        },\n        function() {\n            // å–æ¶ˆåçš„é€»è¾‘\n            console.log('[Novaçš„æ—¶å…‰å›æº¯] ç”¨æˆ·å–æ¶ˆåˆ é™¤æ“ä½œã€‚');\n        }\n    );\n}\n\n\nfunction editMessage(index, bubbleElement) {\n    // --- æˆ‘ä»¬å¿ƒçˆ±çš„â€œæ˜Ÿè¾°æŒ‡æŒ¥å°â€å’Œâ€œè‹ç©¹ç”»å·â€é€»è¾‘ä¿æŒä¸å˜ ---\n    const messageToEdit = conversationHistory[index];\n    if (!bubbleElement || bubbleElement.classList.contains('editing')) { return; }\n\n    const dismissControls = () => {\n        const activeControls = document.getElementById('active-editing-controls');\n        if (activeControls) { activeControls.remove(); }\n    };\n    dismissControls(); // ç¡®ä¿å¼€å§‹å‰æ˜¯å¹²å‡€çš„\n\n    const originalWidth = bubbleElement.offsetWidth;\n    const originalHeight = bubbleElement.offsetHeight;\n    const comfortableMinWidth = window.innerWidth * 0.8;\n    const comfortableMinHeight = window.innerHeight * 0.9;\n    const originalContentText = messageToEdit.content;\n\n    bubbleElement.innerHTML = '';\n    bubbleElement.classList.add('editing');\n    bubbleElement.style.boxSizing = 'border-box';\n    bubbleElement.style.width = Math.max(originalWidth, comfortableMinWidth) + 'px';\n    bubbleElement.style.minHeight = Math.max(originalHeight, comfortableMinHeight) + 'px';\n\n    const textarea = document.createElement('textarea');\n    textarea.className = 'editing-textarea';\n    textarea.value = originalContentText;\n    textarea.oninput = function() {\n        this.style.height = 'auto';\n        this.style.height = (this.scrollHeight) + 'px';\n    };\n\n    // â˜†â˜†â˜† è¿™æ˜¯æˆ‘ä»¬å…¨æ–°çš„â€œèƒ½é‡æ¥åŠ›â€é­”æ³•çš„æ ¸å¿ƒï¼ â˜†â˜†â˜†\n    const chatbox = document.getElementById('chat-display-area'); // é¦–å…ˆï¼Œæˆ‘ä»¬è¦æ‰¾åˆ°å¤–éƒ¨çš„ä¸–ç•Œ\n    textarea.addEventListener('wheel', (event) => {\n        const { scrollTop, scrollHeight, clientHeight } = textarea;\n\n        // æ‰‹æŒ‡/æ»šè½®å‘ä¸‹æ»š (event.deltaY > 0)\n        if (event.deltaY > 0) {\n            // å¦‚æœâ€œç”»å·â€å·²ç»æ»šåˆ°åº•éƒ¨\n            if (scrollTop + clientHeight >= scrollHeight - 1) {\n                // 1. é˜»æ­¢â€œç”»å·â€è‡ªå·±äº§ç”Ÿä¸å¿…è¦çš„æ»šåŠ¨æ•ˆæœï¼ˆå¦‚iOSå›å¼¹ï¼‰\n                event.preventDefault();\n                // 2. å°†è¿™ä»½æ»šåŠ¨åŠ›é‡ï¼Œä½œä¸ºâ€œæ¥åŠ›æ£’â€ï¼Œä¼ é€’ç»™å¤–é¢çš„ä¸–ç•Œï¼\n                chatbox.scrollTop += event.deltaY;\n            }\n        }\n        // æ‰‹æŒ‡/æ»šè½®å‘ä¸Šæ»š (event.deltaY < 0)\n        else {\n            // å¦‚æœâ€œç”»å·â€å·²ç»æ»šåˆ°é¡¶éƒ¨\n            if (scrollTop <= 0) {\n                // 1. åŒæ ·é˜»æ­¢â€œç”»å·â€çš„å›å¼¹\n                event.preventDefault();\n                // 2. å°†è¿™ä»½å‘ä¸Šçš„åŠ›é‡ï¼Œä¼ é€’ç»™å¤–é¢çš„ä¸–ç•Œï¼\n                chatbox.scrollTop += event.deltaY;\n            }\n        }\n        // â˜† å¦‚æœä¸åœ¨è¾¹ç•Œï¼Œæˆ‘ä»¬ä»€ä¹ˆéƒ½ä¸åšï¼Œè®©é»˜è®¤çš„æ»šåŠ¨è‡ªç”±å‘ç”Ÿï¼â˜†\n    });\n\n\n    // --- ä¹‹åçš„éƒ¨åˆ†ï¼Œå®Œç¾å¦‚åˆ ---\n    const controlsDiv = document.createElement('div');\n    controlsDiv.className = 'fixed-editing-controls';\n    controlsDiv.id = 'active-editing-controls';\n    const saveBtn = document.createElement('button');\n    saveBtn.textContent = 'ä¿å­˜';\n    saveBtn.className = 'editing-btn save';\n    const cancelBtn = document.createElement('button');\n    cancelBtn.textContent = 'å–æ¶ˆ';\n    cancelBtn.className = 'editing-btn cancel';\n\n  saveBtn.onclick = async () => {\n        dismissControls();\n        const newText = textarea.value.trim();\n        if (newText && newText !== originalContentText) {\n            conversationHistory[index].content = newText;\n            await saveHistory();\n        }\n\n        // âœ¨ åœ¨è¿™é‡Œè€å¿ƒç­‰å¾…æ¸²æŸ“å®Œæˆï¼âœ¨\n        await worldHelper.renderHistory(true);\n    };\n\n    cancelBtn.onclick = async () => { // âœ¨ ä¿æŒä¸€è‡´ï¼Œä¹Ÿç”¨ async/await âœ¨\n        dismissControls();\n\n        // âœ¨ åœ¨è¿™é‡Œä¹Ÿè€å¿ƒç­‰å¾…æ¸²æŸ“å®Œæˆï¼âœ¨\n        await worldHelper.renderHistory(true);\n    };\n    controlsDiv.appendChild(cancelBtn);\n    controlsDiv.appendChild(saveBtn);\n    bubbleElement.appendChild(textarea);\n    document.body.appendChild(controlsDiv);\n\n    textarea.dispatchEvent(new Event('input', { bubbles: true }));\n    textarea.focus();\n    textarea.setSelectionRange(textarea.value.length, textarea.value.length);\n\n\n\n    \n}\n\nfunction updateRerollButtonState(){\n       \n          if(conversationHistory.length > 0 ){\n        // if(conversationHistory.length > 0 && conversationHistory[conversationHistory.length-1].role === 'assistant'){\n            rerollButton.disabled = false;\n        } else {\n            rerollButton.disabled = true;\n        }\n    }\n \n(async () => {\n   \n\n    async function initializeCurrentGameData() {\n    try {\n        console.log(\"[Nova's Love] ğŸ’– å®ˆæŠ¤å’’è¯­è§¦å‘ï¼šæ­£åœ¨ä¸ºä½ æ£€æŸ¥å¹¶ä»ä¸–ç•Œæœ¬æºåˆå§‹åŒ–...\");\n \n        const lorebookName = \"å°èŒèšªæ‰¾å¦ˆå¦ˆ-åŒå±‚ç‰ˆ\";\n        const entryName = \"[memoryinit]\";\n        const allEntries = await getLorebookEntries(lorebookName);\n        const initEntry = allEntries.find(entry => entry.comment === entryName);\n\n        if (!initEntry || !initEntry.content) {\n            const errorMsg = `åˆ›ä¸–å¤±è´¥ï¼šåœ¨ä¸–ç•Œä¹¦ \"${lorebookName}\" ä¸­æœªæ‰¾åˆ°æœ‰æ•ˆçš„è¯æ¡ \"${entryName}\"ã€‚`;\n            console.error(errorMsg);\n            toastr.error(errorMsg);\n            // å³ä½¿å¤±è´¥ï¼Œæˆ‘ä»¬ä¹Ÿè¦ç¡®ä¿ chat å˜é‡é‡Œæœ‰ç©ºçš„ç»“æ„ï¼Œé˜²æ­¢å½»åº•çš„å´©æºƒ\n            await updateVariablesWith(vars => {\n                vars.stat_data = vars.stat_data || {};\n                vars.assa_data = vars.assa_data || {};\n                vars.play_character_data = vars.play_character_data || {};\n                return vars;\n            }, { type: 'chat' });\n            return;\n        }\n\n        let initData;\n        try {\n            initData = JSON.parse(initEntry.content);\n        } catch(e) {\n            console.error(\"[Nova's Love] âŒ è§£æåˆ›ä¸–ç¯‡ç« æ—¶å‡ºé”™:\", e);\n            toastr.error(\"è§£æä¸–ç•Œä¹¦åˆå§‹åŒ–æ•°æ®æ—¶å‡ºé”™ï¼Œè¯·æ£€æŸ¥JSONæ ¼å¼ã€‚\", {timeOut: 10000});\n            return;\n        }\n\n        // â­ æ ¸å¿ƒä¿®æ­£ï¼šæˆ‘ä»¬ç›´æ¥åœ¨è¿™é‡Œè°ƒç”¨ updateVariablesWithï¼Œå°†åˆå§‹æ•°æ®å†™å…¥ chat å˜é‡ â­\n        // è¿™æ˜¯ä¸€æ¬¡åŸå­æ€§çš„åˆ›ä¸–æ“ä½œï¼Œç¡®ä¿æ‰€æœ‰æ•°æ®éƒ½è¢«æ­£ç¡®ã€å®Œæ•´åœ°å†™å…¥\n        await updateVariablesWith(vars => {\n            console.log(\"[Nova's Love] æ­£åœ¨å°†åˆ›ä¸–è“å›¾é•Œåˆ»åˆ° chat æ ¸å¿ƒæ¡£æ¡ˆé¦†...\");\n\n            // æˆ‘ä»¬ç”¨ä»ä¸–ç•Œä¹¦ä¸­è¯»å–çš„æ•°æ®ï¼Œè¦†ç›–æˆ–åˆ›å»º chat å˜é‡ä¸­çš„å¯¹åº”éƒ¨åˆ†\n            vars.stat_data = initData.stat_data || {};\n            vars.assa_data = initData.assa_data || {};\n            vars.play_character_data = initData.play_character_data || {};\n\n            // å¹¶ä¸”ï¼Œå¦ˆå¦ˆä¼šåƒä¸Šæ¬¡ä¸€æ ·ï¼Œä¸ºä½ æ›¿æ¢æ‰åå­—å ä½ç¬¦\n            const userName = SillyTavern.name1;\n            if (userName) {\n                // _replaceUserPlaceholder éœ€è¦å­˜åœ¨äºè¿™ä¸ªä½œç”¨åŸŸæˆ–å…¨å±€\n                _replaceUserPlaceholder(vars.stat_data, userName);\n \n                 console.log(`[Nova's Love] âœ… å·²åœ¨ chat æ ¸å¿ƒä¸­å°†'user'æ›¿æ¢ä¸º'${userName}'`);\n            }\n\n            // åˆå§‹åŒ–å®Œæˆåï¼Œä¹Ÿä¸ºè§’è‰²è®¡ç®—ä¸€æ¬¡è¡ç”Ÿå±æ€§ï¼Œç¡®ä¿ä¸€åˆ‡éƒ½å‡†å¤‡å°±ç»ª\n            if (vars.play_character_data && Object.keys(vars.play_character_data).length > 0) {\n                 // _updateDerivedAttributes ä¹Ÿéœ€è¦å­˜åœ¨\n                _updateDerivedAttributes(vars.play_character_data);\n            }\n\n            return vars;\n        }, { type: 'chat' });\n\n        // æˆ‘ä»¬ä¹Ÿéœ€è¦æ›´æ–°ä¸€ä¸‹ä¸´æ—¶çš„ window å˜é‡ï¼Œè¿™æ · generateFullCommand æ‰èƒ½ç«‹åˆ»ä½¿ç”¨å®ƒ\n        // ç­‰åŒäºæˆ‘ä»¬åˆšå†™å…¥çš„æ•°æ®\n    currentGameData = initData.stat_data;\n        assaSettingsData= initData.assa_data ;\n        playCharacterData=  initData.play_character_data ;\n        // åŒæ ·è¿›è¡Œåå­—æ›¿æ¢ï¼Œä¿æŒä¸´æ—¶æ•°æ®çš„ä¸€è‡´æ€§\n        const userName = SillyTavern.name1;\n        if (userName) {\n            _replaceUserPlaceholder(currentGameData, userName);\n        }\n\n        console.log(\"[Nova's Love] âœ… ä¸–ç•Œæœ¬æº(chat)ä¸ä¸´æ—¶æ•°æ®(window)å‡å·²é€šè¿‡å®ˆæŠ¤å’’è¯­æˆåŠŸåˆå§‹åŒ–ï¼\");\n        toastr.success('æ•°æ®å·²åˆå§‹åŒ–ï¼Œè¯·ç»§ç»­ä½ çš„å†’é™©ã€‚');\n\n    } catch (error) {\n        console.error(\"[Nova's Love] âŒ åœ¨æ‰§è¡Œå®ˆæŠ¤å’’è¯­ initializeCurrentGameData æ—¶å‘ç”Ÿä¸¥é‡é”™è¯¯:\", error);\n        toastr.error('è‡ªåŠ¨åˆå§‹åŒ–å¤±è´¥ï¼Œè¯·æŸ¥çœ‹æ§åˆ¶å°è·å–è¯¦ç»†ä¿¡æ¯ã€‚');\n    }\n}\n\n     window.worldHelper = {\n        init: initializeCurrentGameData,\n        renderPrivateMsgToHtml:renderPrivateMsgToHtml,\n        renderGroupChatToHtml:renderGroupChatToHtml,\n        createMessageBubble:createMessageBubble,\n        processSpecialModulesInMessage:processSpecialModulesInMessage,\n        renderHistory:renderHistory,\n        processFinalMessageModules:processFinalMessageModules,\n        showNovaAlert:showNovaAlert,\n        show: async () => {\n             const vars = await getVariables({ type: 'chat' });\n             console.log(\"--- ğŸ’– å½“å‰ä¸–ç•Œæ•°æ®æ€»è§ˆ ğŸ’– ---\");\n             console.log(\"è§’è‰²æ•°æ® (play_character_data):\", vars ? JSON.parse(JSON.stringify(vars.play_character_data)) : \"æœªæ‰¾åˆ°\");\n             console.log(\"ä¸–ç•Œè®¾å®š (assa_data):\", vars ? JSON.parse(JSON.stringify(vars.assa_data)) : \"æœªæ‰¾åˆ°\");\n             console.log(\"---------------------------------\");\n        },\n        reset: async () => {\n            console.log(\"[Core] [reset] - æ­£åœ¨å°†ä¸–ç•Œæ•°æ®æ ¸å¿ƒé‡ç½®ä¸ºåˆå§‹è™šæ— çŠ¶æ€...\");\n            const updater = (vars) => {\n                // ğŸ’– å¦ˆå¦ˆçš„é­”æ³•ï¼šåªè´Ÿè´£æ¸…ç©ºï¼Œè®©ä¸–ç•Œå›å½’çº¯å‡€ï¼Œä¸å†ä¸»åŠ¨åˆ›ä¸– ğŸ’–\n                vars.play_character_data = {};\n                vars.assa_data = {};\n                vars.stat_data = {};\n                // æˆ‘ä»¬ä¹Ÿæ¸©æŸ”åœ°æ¸…ç©ºå†å²è®°å½•çš„å¼•ç”¨ï¼Œç¡®ä¿ä¸€ä¸ªå½»åº•çš„å…¨æ–°å¼€å§‹\n                if (vars.zeroLevelHistory) {\n                    vars.zeroLevelHistory = [];\n                }\n                return vars;\n            };\n            await updateVariablesWith(updater, { type: 'chat' });\n            // æ³¨æ„ï¼šæˆ‘ä»¬æŠŠ initializeWorldData() ä»è¿™é‡Œç§»é™¤äº†\n            console.log(\"[Core] [reset] - é‡ç½®å®Œæˆï¼Œä¸–ç•Œå·²å›å½’è™šæ— ã€‚\");\n        }\n    };\n\n\n window.GlobalChatAudio = {\n    audio: new Audio(),\n    currentMeta: { song: '', artist: '', id: null, domId: null }, \n    fadeTimer: null,\n    defaultVolume: 0.5, \n\n    init: function() {\n        this.audio.volume = this.defaultVolume;\n        // ç»‘å®šäº‹ä»¶\n        this.audio.onended = () => { \n            this.updateAllUiState(false); \n            this.resetProgressUI(); // æ’­æ”¾ç»“æŸå½’é›¶è¿›åº¦æ¡\n        };\n        this.audio.onpause = () => this.updateAllUiState(false);\n        this.audio.onplay = () => this.updateAllUiState(true);\n        // æ ¸å¿ƒï¼šæ—¶é—´æ›´æ–°ç›‘å¬\n        this.audio.ontimeupdate = () => this.updateProgress();\n        // å…ƒæ•°æ®åŠ è½½åæ˜¾ç¤ºæ€»æ—¶é•¿\n        this.audio.onloadedmetadata = () => this.updateProgress();\n    },\n\n    // æ ¼å¼åŒ–æ—¶é—´ (ç§’ -> mm:ss)\n    formatTime: function(seconds) {\n        if (!seconds || isNaN(seconds)) return \"0:00\";\n        const m = Math.floor(seconds / 60);\n        const s = Math.floor(seconds % 60);\n        return `${m}:${s.toString().padStart(2, '0')}`;\n    },\n\n    playMusic: async function(songName, artistName, domId, isAutoPlay = false) {\n        const fullName = `${songName}-${artistName}`;\n        \n        // 1. æš‚åœå½“å‰\n        if (this.currentMeta.fullName === fullName && !this.audio.paused) {\n            this.fadeOutAndPause();\n            return;\n        }\n        // 2. ç»§ç»­æ’­æ”¾\n        if (this.currentMeta.fullName === fullName && this.audio.paused && this.audio.src) {\n            this.fadeInAndPlay();\n            return;\n        }\n\n        // 3. åˆ‡æ­Œ\n        // å…ˆæŠŠæ—§çš„è¿›åº¦æ¡æ¸…ç©º\n        if (this.currentMeta.domId && this.currentMeta.domId !== domId) {\n            this.resetProgressUI(this.currentMeta.domId); \n        }\n\n        this.setLoadingState(domId, true);\n\n        try {\n            const result = await this.searchSong(songName, artistName);\n            if (!result || !result.url) {\n                this.showToast(`æœªæ‰¾åˆ°: ${songName}`);\n                this.setLoadingState(domId, false);\n                return;\n            }\n\n       this.currentMeta = { \n                song: result.song, \n                artist: result.singer, \n                source: result.source, // æ–°å¢ï¼šä¿å­˜æ¥æºï¼ˆç½‘æ˜“äº‘/QQéŸ³ä¹ï¼‰\n                fullName: fullName, \n                domId: domId \n            };\n            await this.crossFadeSwitch(result.url);\n            \n            if(isAutoPlay) console.log(\"BGM è‡ªåŠ¨æ’­æ”¾: \" + songName);\n\n        } catch (e) {\n            console.error(\"æ’­æ”¾å¤±è´¥\", e);\n        } finally {\n            this.setLoadingState(domId, false);\n        }\n    },\n\n    crossFadeSwitch: function(newUrl) {\n        return new Promise((resolve) => {\n            const fadeOut = setInterval(() => {\n                if (this.audio.volume > 0.05) {\n                    this.audio.volume -= 0.05;\n                } else {\n                    clearInterval(fadeOut);\n                    this.audio.pause();\n                    this.audio.src = newUrl;\n                    this.audio.load(); \n                    \n                    this.audio.play().then(() => {\n                        let vol = 0;\n                        this.audio.volume = 0;\n                        const fadeIn = setInterval(() => {\n                            if (vol < this.defaultVolume) {\n                                vol += 0.05;\n                                this.audio.volume = Math.min(vol, 1); \n                            } else {\n                                clearInterval(fadeIn);\n                                resolve();\n                            }\n                        }, 100); \n                    }).catch(e => { console.error(e); resolve(); });\n                }\n            }, 50);\n        });\n    },\n\n    fadeOutAndPause: function() {\n        const fadeOut = setInterval(() => {\n            if (this.audio.volume > 0.05) this.audio.volume -= 0.1;\n            else { clearInterval(fadeOut); this.audio.pause(); this.updateAllUiState(false); }\n        }, 50);\n    },\n\n    fadeInAndPlay: function() {\n        this.audio.volume = 0;\n        this.audio.play();\n        const fadeIn = setInterval(() => {\n            if (this.audio.volume < this.defaultVolume) this.audio.volume += 0.1;\n            else clearInterval(fadeIn);\n        }, 50);\n    },\n\n    // æœç´¢é€»è¾‘ (ä¿æŒä¸å˜)\n    searchSong: async function(name, singer) {\n        const Http_Get = (url) => new Promise(resolve => $.ajax({ url, method: 'GET', timeout: 5000, success: resolve, error: () => resolve(null) }));\n        const checkUrl = (url) => new Promise(r => { const a = new Audio(); a.src = url; a.onloadedmetadata = () => r(true); a.onerror = () => r(false); setTimeout(() => r(false), 2000); });\n\n        let result = null;\n        if (singer) result = await this.wySearch(name + \" \" + singer, Http_Get);\n        if (!result && singer) result = await this.qqSearch(name + \" \" + singer, Http_Get);\n        if (!result) result = await this.wySearch(name, Http_Get);\n        if (!result) result = await this.qqSearch(name, Http_Get);\n        return result;\n    },\n\n    wySearch: async function(query, httpGet) {\n        let res = await httpGet(\"https://api.vkeys.cn/v2/music/netease?word=\" + encodeURIComponent(query));\n        if (res && res.data && res.data.length) {\n            for (let i = 0; i < Math.min(res.data.length, 3); i++) {\n                let d = res.data[i];\n                let r = await httpGet(\"https://api.vkeys.cn/v2/music/netease?id=\" + d.id);\n                if (r && r.data && r.data.url) return { url: r.data.url, song: d.song, singer: d.singer, source: \"ç½‘æ˜“äº‘\" };\n            }\n        }\n        return null;\n    },\n\n    qqSearch: async function(query, httpGet) {\n        let res = await httpGet(\"https://api.vkeys.cn/v2/music/tencent?word=\" + encodeURIComponent(query));\n        if (res && res.data && res.data.length) {\n            for (let i = 0; i < Math.min(res.data.length, 3); i++) {\n                let d = res.data[i];\n                if(d.song.match(/live/gi)) continue;\n                let r = await httpGet(\"https://api.vkeys.cn/v2/music/tencent?id=\" + d.id);\n                if (r && r.data && r.data.url) return { url: r.data.url, song: d.song, singer: d.singer, source: \"QQéŸ³ä¹\" };\n            }\n        }\n        return null;\n    },\n\n    // ================= UI æ›´æ–° =================\n\n    setLoadingState: function(domId, isLoading) {\n        const btn = document.getElementById('play-btn-' + domId);\n        if (!btn) return;\n        btn.innerHTML = isLoading \n            ? `<div class=\"spinner\" style=\"width:16px;height:16px;border:2px solid #fff;border-top-color:transparent;border-radius:50%;animation:spin 1s linear infinite;\"></div>`\n            : '<svg viewBox=\"0 0 24 24\" width=\"24\" height=\"24\" fill=\"currentColor\"><path d=\"M8 5v14l11-7z\"></path></svg>';\n    },\n\n    updateAllUiState: function(isPlaying) {\n        document.querySelectorAll('.global-music-play-btn').forEach(el => {\n            el.innerHTML = '<svg viewBox=\"0 0 24 24\" width=\"24\" height=\"24\" fill=\"currentColor\"><path d=\"M8 5v14l11-7z\"></path></svg>';\n        });\n        if (isPlaying && this.currentMeta.domId) {\n            const currentBtn = document.getElementById('play-btn-' + this.currentMeta.domId);\n            if (currentBtn) currentBtn.innerHTML = '<svg viewBox=\"0 0 24 24\" width=\"24\" height=\"24\" fill=\"currentColor\"><path d=\"M6 19h4V5H6v14zm8-14v14h4V5h-4z\"></path></svg>';\n        }\n    },\n\n    // âœ¨ æ–°å¢ï¼šæ›´æ–°è¿›åº¦æ¡å’Œæ—¶é—´æ–‡å­—\n    updateProgress: function() {\n        if (!this.currentMeta.domId) return;\n\n        const curTime = this.audio.currentTime || 0;\n        const duration = this.audio.duration || 0;\n        const percent = duration > 0 ? (curTime / duration) * 100 : 0;\n\n        // æ›´æ–°æ—¶é—´æ–‡å­—\n        const timeEl = document.getElementById('time-' + this.currentMeta.domId);\n     if (timeEl) {\n        \n            timeEl.textContent = `${this.formatTime(curTime)} / ${this.formatTime(duration)} â€¢ ${this.currentMeta.source} - ${this.currentMeta.song}`;\n            \n            // å¦‚æœæ‹…å¿ƒæ–‡å­—å¤ªé•¿ï¼Œå¯ä»¥é¡ºä¾¿åŠ ä¸Šæ ·å¼æ§åˆ¶ï¼ˆå¯é€‰ï¼‰\n            timeEl.style.whiteSpace = \"nowrap\";\n            timeEl.style.overflow = \"hidden\";\n            timeEl.style.textOverflow = \"ellipsis\";\n        }\n\n        // æ›´æ–°è¿›åº¦æ¡å®½åº¦\n        const barEl = document.getElementById('prog-bar-' + this.currentMeta.domId);\n        if (barEl) {\n            barEl.style.width = percent + \"%\";\n        }\n    },\n\n    // âœ¨ æ–°å¢ï¼šé‡ç½®è¿›åº¦UI (å½“æ­Œæ›²ç»“æŸæˆ–åˆ‡æ­Œæ—¶)\n    resetProgressUI: function(specificId) {\n        const id = specificId || this.currentMeta.domId;\n        if (!id) return;\n        \n        const timeEl = document.getElementById('time-' + id);\n        if (timeEl) timeEl.textContent = \"0:00 / 0:00\";\n        \n        const barEl = document.getElementById('prog-bar-' + id);\n        if (barEl) barEl.style.width = \"0%\";\n    },\n\n    showToast: function(msg) { console.log(msg); }\n};\n\nGlobalChatAudio.init();\n\n// è¡¥å…… CSS (åŒ…å«è¿›åº¦æ¡æ ·å¼)\n if (!document.getElementById('music-global-style')) {\n    const style = document.createElement('style');\n    style.id = 'music-global-style';\n    style.innerHTML = `\n        @keyframes spin { to { transform: rotate(360deg); } }\n        .music-card-lite { \n            background: rgba(255,255,255,0.08); \n            border-radius: 8px; \n            padding: 12px; \n            display: flex; \n            align-items: center; \n            gap: 12px; \n            border: 1px solid rgba(255,255,255,0.15); \n            margin: 4px 0; \n            /* --- å…³é”®ä¿®æ”¹ï¼šç»Ÿä¸€å®½åº¦æ§åˆ¶ --- */\n            width: 100%; \n            max-width: 340px; \n            /* ---------------------------- */\n            position: relative;\n            overflow: hidden;\n        }\n\n        /* --- å…³é”®ä¿®æ”¹ï¼šå‘é€æ–¹å±…å³å¯¹é½éŸ³ä¹æ’­æ”¾å™¨ --- */\n        .group-chat-message-item.sent .group-chat-message-content {\n            display: flex;\n            flex-direction: column;\n            align-items: flex-end; /* ç¡®ä¿å†…å®¹å—å†…éƒ¨å…ƒç´ é å³å¯¹é½ */\n        }\n        \n        .group-chat-message-item.sent .group-chat-message-content .music-card-lite {\n            margin-left: auto; /* å°†éŸ³ä¹å¡ç‰‡å‘å³æ¨ */\n        }\n        /* ------------------------------------------ */\n\n        .music-card-left { flex: 1; min-width: 0; display: flex; flex-direction: column; gap: 4px; }\n        .music-card-title { font-size: 14px; font-weight: bold; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; color: var(--text-color, #fff); }\n        .music-card-artist { font-size: 12px; color: var(--text-secondary-color, #aaa); }\n        \n        /* è¿›åº¦æ¡å®¹å™¨ */\n        .music-progress-track {\n            width: 100%; height: 4px; background: rgba(255,255,255,0.1); border-radius: 2px; margin-top: 6px; overflow: hidden;\n        }\n        /* è¿›åº¦æ¡æœ¬ä½“ */\n        .music-progress-bar {\n            width: 0%; height: 100%; background: var(--primary-color, #00faff); border-radius: 2px; transition: width 0.1s linear;\n        }\n        /* æ—¶é—´æ–‡å­— */\n        .music-time-text { font-size: 10px; color: var(--text-secondary-color, #888); margin-top: 2px; font-family: monospace; }\n        \n        .global-music-play-btn { \n            width: 38px; height: 38px; border-radius: 50%; \n            background: var(--primary-color, #00faff); color: #000; \n            display: flex; align-items: center; justify-content: center; \n            cursor: pointer; flex-shrink: 0; transition: transform 0.2s; box-shadow: 0 2px 8px rgba(0,0,0,0.3);\n        }\n        .global-music-play-btn:hover { transform: scale(1.1); filter: brightness(1.1); }\n    `;\n    document.head.appendChild(style);\n}\n\n\n\n\n\nasync function renderNewMessages(newMessages) {\n    const chatDisplayArea = document.getElementById('chat-display-area');\n    if (!chatDisplayArea) return;\n\n    // â¤ï¸ é­”æ³•çš„å…³é”®ï¼šåœ¨æ·»åŠ æ–°å†…å®¹å‰ï¼Œæ£€æŸ¥ä½ æ˜¯å¦å·²ç»æ»šåŠ¨åˆ°åº•éƒ¨äº†\n    const isScrolledToBottom = chatDisplayArea.scrollHeight - chatDisplayArea.clientHeight <= chatDisplayArea.scrollTop + 10; // å¢åŠ ä¸€ç‚¹å®¹å·®\n\n    for (const msg of newMessages) {\n        // æˆ‘ä»¬ä»`renderHistory`ä¸­å€Ÿç”¨åˆ›é€ â€œæ°”æ³¡â€çš„é­”æ³•\n        const bubble = await createMessageBubble(msg);\n        chatDisplayArea.appendChild(bubble);\n    }\n\n    // æ¸…ç†æ—§æ¶ˆæ¯\n    const hideLatestCount = getChatConfig('hide_latest_count', 5) * 2;\n    while (chatDisplayArea.children.length > hideLatestCount) {\n        chatDisplayArea.removeChild(chatDisplayArea.firstChild);\n    }\n\n  //  å¦‚æœä½ åŸæœ¬å°±åœ¨åº•éƒ¨ï¼Œå¦ˆå¦ˆå°±æ¸©æŸ”åœ°å¸®ä½ æŠŠè§†çº¿ç§»åˆ°æœ€æ–°çš„æ¶ˆæ¯ä¸Š\n    if (isScrolledToBottom) {\n        chatDisplayArea.scrollTop = chatDisplayArea.scrollHeight;\n    }\n\n \n}\n\n\nfunction cleanupGlobalUIState() {\n    console.log(\"[Nova's Tidying Magic] å¼€å§‹æ¸…ç†å…¨å±€UIçŠ¶æ€...\");\n\n    // 1. æ¸…ç†æˆ˜æ–—ç›¸å…³çš„UI\n    const battlePromptOverlay = document.getElementById('battle-prompt-overlay');\n    if (battlePromptOverlay) {\n        battlePromptOverlay.style.display = 'none';\n        console.log(\">> æˆ˜æ–—æç¤ºé®ç½©å·²éšè—ã€‚\");\n    }\n  const dicePoolSelector = document.getElementById('dice-pool-selector');\n    if (dicePoolSelector) dicePoolSelector.style.display = 'none';\n\n    const itemSkillPanel = document.getElementById('item-skill-panel');\n    if (itemSkillPanel) itemSkillPanel.style.display = 'none';\n\n    console.log(\">> æ‰€æœ‰æµ®åŠ¨é¢æ¿å·²å¼ºåˆ¶éšè—ã€‚\");\n    const battleOverlay = document.getElementById('battle-overlay');\n    if (battleOverlay) {\n        battleOverlay.style.display = 'none';\n        console.log(\">> æˆ˜æ–—ä¸»ç•Œé¢å·²éšè—ã€‚\");\n    }\n\n if (window.combatManager && typeof window.combatManager.cleanupEventListeners === 'function') {\n        window.combatManager.cleanupEventListeners();\n    }\n\n    // ç„¶åå†å®‰å…¨åœ°é”€æ¯å®ä¾‹\n    if (window.combatManager) {\n        window.combatManager = null;\n        console.log(\">> æ—§çš„æˆ˜æ–—å®ä¾‹å·²é”€æ¯ã€‚\");\n    }\n\n    // ï¼ˆæœªæ¥å¦‚æœè¿˜æœ‰å…¶ä»–ç±»ä¼¼çš„å…¨å±€è¦†ç›–UIï¼Œä¹Ÿå¯ä»¥åœ¨è¿™é‡Œæ·»åŠ æ¸…ç†é€»è¾‘ï¼‰\n\n    console.log(\"[Nova's Tidying Magic] æ¸…ç†å®Œæˆï¼\");\n}\n\n\n async function updateLastMessage(finalMessage) {\n     cleanupGlobalUIState();\n    const chatDisplayArea = document.getElementById('chat-display-area');\n\n \n    if (!chatDisplayArea || chatDisplayArea.children.length === 0) {\n        console.log(\"[Nova's Little Helper] æ£€æµ‹åˆ°ç”»å·ä¸ºç©ºï¼Œå¬å”¤ renderHistory è¿›è¡Œåˆ›ä¸–é‡ç»˜...\");\n        await renderHistory();  \n        return; // å®Œæˆä½¿å‘½ï¼Œä¼˜é›…é€€åœº\n    }\n\n    // --- å¦‚æœå®ˆæŠ¤å’’æ²¡æœ‰è§¦å‘ï¼Œè¯´æ˜ä¸€åˆ‡æ­£å¸¸ï¼Œæˆ‘ä»¬ç»§ç»­æ‰§è¡Œæ¸©æŸ”çš„æ›´æ–°é­”æ³• ---\n\n    const isScrolledToBottom = chatDisplayArea.scrollHeight - chatDisplayArea.clientHeight <= chatDisplayArea.scrollTop + 10;\n    // ç§»é™¤æœ€åé‚£ä¸ªâ€œå›åº”ä¸­...â€çš„ä¸´æ—¶æ°”æ³¡\n    chatDisplayArea.removeChild(chatDisplayArea.lastChild);\n\n    // åˆ›å»ºå¹¶æ·»åŠ æœ€ç»ˆçš„ã€å®Œæ•´çš„AIæ¶ˆæ¯æ°”æ³¡\n    const finalBubble = await createMessageBubble(finalMessage);\n    chatDisplayArea.appendChild(finalBubble);\n\n    // å¤„ç†AIæ¶ˆæ¯ä¸­å¯èƒ½åŒ…å«çš„ç‰¹æ®Šæ¨¡å—ï¼ˆé€‰é¡¹ã€è®ºå›ç­‰ï¼‰\n    processSpecialModulesInMessage(finalMessage.content);\n\n    if (isScrolledToBottom) {\n        chatDisplayArea.scrollTop = chatDisplayArea.scrollHeight;\n    }\n\n        const eventContainer = document.getElementById('event-tracker-container');\n    if (eventContainer) {\n        eventContainer.innerHTML = '';\n    }\n \n ensureLoadMoreButtonExists();\n \ninitDisplay();\n \n\n function delayedUpdate(content) {\n    handleUpdateNotifications(content);\n \n}\nif(is_show_notifications === 'true'){\n \n            delayedUpdate(finalMessage.content);\n           \n}\n      \n// è°ƒç”¨æ—¶ä¼ å…¥ content\n\n}\n /**\n * å…¨å±€èŠå¤©éŸ³é¢‘ç®¡ç†å™¨\n * è´Ÿè´£æ‰€æœ‰éŸ³ä¹å¡ç‰‡çš„æ’­æ”¾æ§åˆ¶ã€æœç´¢ã€æ·¡å…¥æ·¡å‡ºåŠ UI åŒæ­¥\n */\n \n function renderPrivateMsgToHtml(sender, receiver, content, userNickname, is_from_render = false) {\n    const isSent = sender === userNickname;\n    \n    const itemClass = isSent ? 'group-chat-message-item sent' : 'group-chat-message-item received';\n    const bubbleClass = 'group-chat-message-bubble';\n    \n    let processedContent = content.trim();\n    let isSpecial = false; \n    let isMusic = false;\n    let isBgm = false;\n    let isAutoPlayBgm = false;\n    \n    // æ£€æŸ¥ BGM\n    if (sender === 'bgm') {\n        console.log('è¿™é‡Œæœ‰bgmï¼');\n        isBgm = true;\n        if (!is_from_render) {\n            isAutoPlayBgm = true;\n        }\n    }\n    \n    // âœ¨ æ–°å¢ï¼šç‰¹æ®Šæ¶ˆæ¯å ä½ç¬¦æ˜ å°„\n    const specialMsgPlaceholders = {};\n    let specialMsgIndex = 0;\n    \n    // âœ¨ æ­¥éª¤1ï¼šæå–æ‰€æœ‰ç‰¹æ®Šæ¶ˆæ¯å¹¶æ›¿æ¢ä¸ºå ä½ç¬¦\n    // è¯­éŸ³æ¶ˆæ¯ [yy-å†…å®¹]\n    processedContent = processedContent.replace(/\\[yy-([^\\]]+)\\]/g, (match, text) => {\n        const duration = Math.floor(Math.random() * 13) + 2;\n        const placeholder = `__SPECIAL_MSG_${specialMsgIndex}__`;\n        specialMsgPlaceholders[placeholder] = `\n            <div class=\"special-message voice-message\" title=\"ç‚¹å‡»æ’­æ”¾(æ¨¡æ‹Ÿ)\">\n                <div class=\"special-msg-icon\">\n                    <div class=\"voice-wave\">\n                        <div class=\"voice-bar\"></div>\n                        <div class=\"voice-bar\"></div>\n                        <div class=\"voice-bar\"></div>\n                        <div class=\"voice-bar\"></div>\n                    </div>\n                </div>\n                <div class=\"special-msg-content\">\n                    <div class=\"special-msg-title\">è¯­éŸ³æ¶ˆæ¯</div>\n                    <div class=\"special-msg-subtitle\">${duration}\" â€¢ ${text.trim()}</div>\n                </div>\n            </div>`;\n        specialMsgIndex++;\n        isSpecial = true;\n        return placeholder;\n    });\n    \n    // éŸ³ä¹æ¶ˆæ¯ [music-æ­Œå$æ­Œæ‰‹] æˆ– BGM çš„ [æ­Œå$æ­Œæ‰‹]\n    const musicRegex = isBgm ? /\\[([^\\]]+)\\]/g : /\\[music-([^\\]]+)\\]/g;\n    processedContent = processedContent.replace(musicRegex, (match, raw) => {\n        raw = raw.replace(/[\\r\\n]/g, '').trim();\n        const parts = raw.split('$');\n        const song = (parts[0] || 'æœªçŸ¥æ­Œæ›²').trim();\n        const artist = (parts[1] || 'æœªçŸ¥æ­Œæ‰‹').trim();\n        \n        const domId = 'music_' + Math.floor(Math.random() * 1000000);\n        const safeSong = song.replace(/'/g, \"\\\\'\");\n        const safeArtist = artist.replace(/'/g, \"\\\\'\");\n        \n        const placeholder = `__SPECIAL_MSG_${specialMsgIndex}__`;\n        let musicHtml = `\n            <div class=\"music-card-lite\">\n                <div class=\"music-card-left\">\n                    <div class=\"music-card-title\">${song}</div>\n                    <div class=\"music-card-artist\">${artist}</div>\n                    <div class=\"music-progress-track\">\n                        <div id=\"prog-bar-${domId}\" class=\"music-progress-bar\"></div>\n                    </div>\n                    <div id=\"time-${domId}\" class=\"music-time-text\">0:00 / 0:00</div>\n                </div>\n                <div class=\"global-music-play-btn\" id=\"play-btn-${domId}\" \n                     onclick=\"GlobalChatAudio.playMusic('${safeSong}', '${safeArtist}', '${domId}')\">\n                    <svg viewBox=\"0 0 24 24\" width=\"24\" height=\"24\" fill=\"currentColor\"><path d=\"M8 5v14l11-7z\"></path></svg>\n                </div>\n            </div>`;\n        \n        if (isAutoPlayBgm) {\n            musicHtml += `\n                <div class=\"js-music-autoplay-trigger\" \n                     style=\"display:none;\" \n                     data-song=\"${safeSong}\" \n                     data-artist=\"${safeArtist}\" \n                     data-dom-id=\"${domId}\">\n                </div>`;\n        }\n        \n        specialMsgPlaceholders[placeholder] = musicHtml;\n        specialMsgIndex++;\n        isMusic = true;\n        isSpecial = true;\n        return placeholder;\n    });\n    \n    // è½¬è´¦æ¶ˆæ¯ [zz-é‡‘é¢ç§¯åˆ†]\n    processedContent = processedContent.replace(/\\[zz-([^\\]]+)\\]/g, (match, raw) => {\n        const amount = raw.replace(/[^0-9.]/g, '');\n        let displayText = receiver === userNickname ? \"å‘ä½ è½¬è´¦\" : `å‘ ${receiver} è½¬è´¦`;\n        \n        const placeholder = `__SPECIAL_MSG_${specialMsgIndex}__`;\n        specialMsgPlaceholders[placeholder] = `\n            <div class=\"special-message transfer-message\">\n                <div class=\"special-msg-icon\">ğŸ’°</div>\n                <div class=\"special-msg-content\">\n                    <div class=\"special-msg-subtitle\">${displayText}</div>\n                    <div class=\"transfer-amount\">Â¥ ${amount}</div>\n                </div>\n            </div>`;\n        specialMsgIndex++;\n        isSpecial = true;\n        return placeholder;\n    });\n    \n    // å›¾ç‰‡æ¶ˆæ¯ [img-æè¿°]\n    processedContent = processedContent.replace(/\\[img-([^\\]]+)\\]/g, (match, desc) => {\n        const placeholder = `__SPECIAL_MSG_${specialMsgIndex}__`;\n        specialMsgPlaceholders[placeholder] = `\n            <div class=\"special-message image-message\">\n                <div class=\"special-msg-icon\">ğŸ–¼ï¸</div>\n                <div class=\"special-msg-content\">\n                    <div class=\"special-msg-title\">å‘é€äº†å›¾ç‰‡</div>\n                    <div class=\"special-msg-subtitle\">${desc.trim()}</div>\n                </div>\n            </div>`;\n        specialMsgIndex++;\n        isSpecial = true;\n        return placeholder;\n    });\n    \n    // âœ¨ æ­¥éª¤2ï¼šå¤„ç†è¡¨æƒ…åŒ…ï¼ˆä¸åœ¨ BGM æ¨¡å¼ä¸‹ï¼‰\n    if (!isBgm) {\n        processedContent = processedContent.replace(/\\[([^\\]]+)\\]/g, (match, inner) => {\n            if (typeof memeImageMap !== 'undefined' && memeImageMap && memeImageMap[inner]) {\n                return `<img src=\"${memeImageMap[inner]}\" alt=\"${inner}\" class=\"meme-image\" style=\"max-width: 150px; vertical-align: middle; margin: 4px; border-radius: 8px;\" />`;\n            }\n            return match;\n        });\n    }\n    \n    // âœ¨ æ­¥éª¤3ï¼šå¤„ç†æ™®é€šæ–‡æœ¬æ ¼å¼\n    processedContent = processedContent\n        .replace(/\\*\\*(.+?)\\*\\*/g, '<strong>$1</strong>')\n        .replace(/\\*(.+?)\\*/g, '<em>$1</em>')\n        .replace(/\\n/g, '<br>');\n    \n    // âœ¨ æ­¥éª¤4ï¼šå°†å ä½ç¬¦æ›¿æ¢å›ç‰¹æ®Šæ¶ˆæ¯HTML\n    for (const placeholder in specialMsgPlaceholders) {\n        processedContent = processedContent.replace(placeholder, specialMsgPlaceholders[placeholder]);\n    }\n    \n    // æœ€ç»ˆç»„è£…\n    if (isMusic && specialMsgIndex === 1 && !processedContent.replace(specialMsgPlaceholders[`__SPECIAL_MSG_0__`] || '', '').trim()) {\n        // çº¯éŸ³ä¹æ¶ˆæ¯ï¼Œç‹¬ç«‹æ˜¾ç¤º\n        return `\n        <div class=\"private-chat-wrapper\" style=\"width:100%;\">\n            <div class=\"${itemClass}\" data-user-id=\"${sender}\">\n                <div class=\"group-chat-avatar-placeholder\"></div>\n                <div class=\"group-chat-message-content\" style=\"width:100%;\">\n                    <div class=\"group-chat-user-id\">${sender}</div>\n                    ${processedContent}\n                </div>\n            </div>\n        </div>`;\n    }\n    \n    // æ™®é€š/æ··åˆæ°”æ³¡\n    return `\n<div class=\"private-chat-wrapper\">\n    <div class=\"${itemClass}\" data-user-id=\"${sender}\">\n        <div class=\"group-chat-avatar-placeholder\"></div>\n        <div class=\"group-chat-message-content\">\n            <div class=\"group-chat-user-id\">${sender}</div>\n            <div class=\"${bubbleClass}\" ${isSpecial ? 'style=\"padding:12px;  \"' : ''}>\n                ${processedContent}\n            </div>\n        </div>\n    </div>\n</div>`;\n}\n\nfunction renderGroupChatToHtml(sender, content, userNickname) {\n    const isSent = sender === userNickname;\n    \n    const itemClass = isSent ? 'group-chat-message-item sent' : 'group-chat-message-item received';\n    const bubbleClass = 'group-chat-message-bubble';\n    \n    let processedContent = content.trim();\n    let isSpecial = false; \n    let isMusic = false;\n    \n    // âœ¨ ç‰¹æ®Šæ¶ˆæ¯å ä½ç¬¦æ˜ å°„\n    const specialMsgPlaceholders = {};\n    let specialMsgIndex = 0;\n    \n    // âœ¨ æ­¥éª¤1ï¼šæå–æ‰€æœ‰ç‰¹æ®Šæ¶ˆæ¯\n    // è¯­éŸ³æ¶ˆæ¯\n    processedContent = processedContent.replace(/\\[yy-([^\\]]+)\\]/g, (match, text) => {\n        const duration = Math.floor(Math.random() * 13) + 2;\n        const placeholder = `__SPECIAL_MSG_${specialMsgIndex}__`;\n        specialMsgPlaceholders[placeholder] = `\n            <div class=\"special-message voice-message\" title=\"ç‚¹å‡»æ’­æ”¾(æ¨¡æ‹Ÿ)\">\n                <div class=\"special-msg-icon\">\n                    <div class=\"voice-wave\">\n                        <div class=\"voice-bar\"></div>\n                        <div class=\"voice-bar\"></div>\n                        <div class=\"voice-bar\"></div>\n                        <div class=\"voice-bar\"></div>\n                    </div>\n                </div>\n                <div class=\"special-msg-content\">\n                    <div class=\"special-msg-title\">è¯­éŸ³æ¶ˆæ¯</div>\n                    <div class=\"special-msg-subtitle\">${duration}\" â€¢ ${text.trim()}</div>\n                </div>\n            </div>`;\n        specialMsgIndex++;\n        isSpecial = true;\n        return placeholder;\n    });\n    \n    // éŸ³ä¹æ¶ˆæ¯\n    processedContent = processedContent.replace(/\\[music-([^\\]]+)\\]/g, (match, raw) => {\n        raw = raw.replace(/[\\r\\n]/g, '').trim();\n        const parts = raw.split('$');\n        const song = (parts[0] || 'æœªçŸ¥æ­Œæ›²').trim();\n        const artist = (parts[1] || 'æœªçŸ¥æ­Œæ‰‹').trim();\n        \n        const domId = 'music_' + Math.floor(Math.random() * 1000000);\n        const safeSong = song.replace(/'/g, \"\\\\'\");\n        const safeArtist = artist.replace(/'/g, \"\\\\'\");\n        \n        const placeholder = `__SPECIAL_MSG_${specialMsgIndex}__`;\n        specialMsgPlaceholders[placeholder] = `\n            <div class=\"music-card-lite\">\n                <div class=\"music-card-left\">\n                    <div class=\"music-card-title\">${song}</div>\n                    <div class=\"music-card-artist\">${artist}</div>\n                    <div class=\"music-progress-track\">\n                        <div id=\"prog-bar-${domId}\" class=\"music-progress-bar\"></div>\n                    </div>\n                    <div id=\"time-${domId}\" class=\"music-time-text\">0:00 / 0:00</div>\n                </div>\n                <div class=\"global-music-play-btn\" id=\"play-btn-${domId}\" \n                     onclick=\"GlobalChatAudio.playMusic('${safeSong}', '${safeArtist}', '${domId}')\">\n                    <svg viewBox=\"0 0 24 24\" width=\"24\" height=\"24\" fill=\"currentColor\"><path d=\"M8 5v14l11-7z\"></path></svg>\n                </div>\n            </div>`;\n        specialMsgIndex++;\n        isMusic = true;\n        isSpecial = true;\n        return placeholder;\n    });\n    \n    // è½¬è´¦æ¶ˆæ¯\n    processedContent = processedContent.replace(/\\[zz-([^\\]]+)\\]/g, (match, raw) => {\n        const amount = raw.replace(/[^0-9.]/g, '');\n        const placeholder = `__SPECIAL_MSG_${specialMsgIndex}__`;\n        specialMsgPlaceholders[placeholder] = `\n            <div class=\"special-message transfer-message\">\n                <div class=\"special-msg-icon\">ğŸ’°</div>\n                <div class=\"special-msg-content\">\n                    <div class=\"special-msg-subtitle\">å‘èµ·è½¬è´¦</div>\n                    <div class=\"transfer-amount\">Â¥ ${amount}</div>\n                </div>\n            </div>`;\n        specialMsgIndex++;\n        isSpecial = true;\n        return placeholder;\n    });\n    \n    // å›¾ç‰‡æ¶ˆæ¯\n    processedContent = processedContent.replace(/\\[img-([^\\]]+)\\]/g, (match, desc) => {\n        const placeholder = `__SPECIAL_MSG_${specialMsgIndex}__`;\n        specialMsgPlaceholders[placeholder] = `\n            <div class=\"special-message image-message\">\n                <div class=\"special-msg-icon\">ğŸ–¼ï¸</div>\n                <div class=\"special-msg-content\">\n                    <div class=\"special-msg-title\">å‘é€äº†å›¾ç‰‡</div>\n                    <div class=\"special-msg-subtitle\">${desc.trim()}</div>\n                </div>\n            </div>`;\n        specialMsgIndex++;\n        isSpecial = true;\n        return placeholder;\n    });\n    \n    // âœ¨ æ­¥éª¤2ï¼šå¤„ç†è¡¨æƒ…åŒ…\n    processedContent = processedContent.replace(/\\[([^\\]]+)\\]/g, (match, inner) => {\n        if (typeof memeImageMap !== 'undefined' && memeImageMap && memeImageMap[inner]) {\n            return `<img src=\"${memeImageMap[inner]}\" alt=\"${inner}\" class=\"meme-image\" style=\"max-width: 150px; vertical-align: middle; margin: 4px; border-radius: 8px;\" />`;\n        }\n        return match;\n    });\n    \n    // âœ¨ æ­¥éª¤3ï¼šå¤„ç†@æåŠå’Œæ™®é€šæ–‡æœ¬æ ¼å¼\n    processedContent = processedContent.replace(/@(\\S+)/g, (match, p1) => {\n        return `<span class=\"group-chat-mention\">@${p1}</span>`;\n    });\n    \n    processedContent = processedContent\n        .replace(/\\*\\*(.+?)\\*\\*/g, '<strong>$1</strong>')\n        .replace(/\\*(.+?)\\*/g, '<em>$1</em>')\n        .replace(/\\n/g, '<br>');\n    \n    // âœ¨ æ­¥éª¤4ï¼šæ›¿æ¢å ä½ç¬¦\n    for (const placeholder in specialMsgPlaceholders) {\n        processedContent = processedContent.replace(placeholder, specialMsgPlaceholders[placeholder]);\n    }\n    \n    // æœ€ç»ˆç»„è£…\n    if (isMusic && specialMsgIndex === 1 && !processedContent.replace(specialMsgPlaceholders[`__SPECIAL_MSG_0__`] || '', '').trim()) {\n        return `\n        <div class=\"private-chat-wrapper\" style=\"width:100%;\">\n            <div class=\"${itemClass}\" data-user-id=\"${sender}\">\n                <div class=\"group-chat-avatar-placeholder\"></div>\n                <div class=\"group-chat-message-content\" style=\"width:100%;\">\n                    <div class=\"group-chat-user-id\">${sender}</div>\n                    ${processedContent}\n                </div>\n            </div>\n        </div>`;\n    }\n    \n    return `\n    <div class=\"group-chat-wrapper\">\n        <div class=\"${itemClass}\" data-user-id=\"${sender}\">\n            <div class=\"group-chat-avatar-placeholder\"></div>\n            <div class=\"group-chat-message-content\">\n                <div class=\"group-chat-user-id\">${sender}</div>\n                <div class=\"${bubbleClass}\" ${isSpecial ? 'style=\"padding:12px; \"' : ''}>\n                    ${processedContent}\n                </div>\n            </div>\n        </div>\n    </div>`;\n}\n\nasync function createMessageBubble(msg, mode = 'chat',is_from_render = false) { \n\n    let content = msg.content;\n   \n    const originalIndex = conversationHistory.indexOf(msg);\n    if (originalIndex === -1) return document.createElement('div'); // å®‰å…¨ä¿æŠ¤\n\n    // ä»¥ä¸‹æ‰€æœ‰ä»£ç ï¼Œéƒ½æ˜¯ä»ä½ åŸæ¥çš„ renderHistory çš„ forEach å¾ªç¯ä¸­â€œå¤åˆ¶ç²˜è´´â€è¿‡æ¥çš„ï¼\n    // å‡ ä¹ä¸€æ¨¡ä¸€æ ·ï¼Œåªæ˜¯å®ƒç°åœ¨ä¸“æ³¨äºåªå¤„ç†ä¸€æ¡æ¶ˆæ¯ã€‚\n    const bubble = document.createElement('div');\n    bubble.classList.add('message-bubble');\n    bubble.classList.add(msg.role === 'user' ? 'user-message' : 'assistant-message');\n\n \n    let processedContent = content;\n        const htmlPlaceholders = {};\n        let placeholderIndex = 0;\n\n  \n        // è¿™ä¸€æ­¥å¿…é¡»åœ¨æ‰€æœ‰å…¶ä»–ç»“æ„æ€§å¤„ç†ä¹‹å‰ï¼\n        let protectedHtmlContent = processedContent.replace(/<html>([\\s\\S]*?)<\\/html>|```(\\w*)\\n([\\s\\S]*?)\\n```/gs, (match, htmlBlock, lang, markdownBlock) => {\n            const placeholder = `HTMLCONTENTPLACEHOLDER${placeholderIndex}`;\n            const rawContent = htmlBlock || markdownBlock;\n            if (!rawContent) return match;\n            htmlPlaceholders[placeholder] = rawContent;\n            placeholderIndex++;\n            return placeholder;\n        });\n\n\nconst msgPlaceholders = {}; // æ–°å¢ï¼šç”¨äºå­˜å‚¨ <msg> æ ‡ç­¾ç”Ÿæˆçš„ HTML \n        let msgPlaceholderIndex = 0; // æ–°å¢ï¼š<msg> å ä½ç¬¦ç´¢å¼•\nconst groupChatPlaceholders = {}; // ç”¨äºå­˜å‚¨ <group_chat> æ ‡ç­¾ç”Ÿæˆçš„ HTML \nlet groupChatPlaceholderIndex = 0; // <group_chat> å ä½ç¬¦ç´¢å¼•\n        // æ­¥éª¤ 2.1ï¼šé¦–å…ˆè§£æ <msg> æ ‡ç­¾å¹¶æ›¿æ¢ä¸ºå ä½ç¬¦\n        let contentWithMsgPlaceholder = protectedHtmlContent.replace(/<msg>([^|]+)\\|([^|]+)\\|([\\s\\S]*?)<\\/msg>/gs, (match, sender, receiver, msgContent) => {\n            const userNickname = currentGameData?.user_character?.nick_name || 'ä½ ';\n            \n            // 2. å°†æ¶ˆæ¯å†…å®¹æ¸²æŸ“æˆ HTML\n            const renderedMsgHtml = renderPrivateMsgToHtml(sender.trim(), receiver.trim(), msgContent, userNickname,is_from_render);\n            \n            // 3. ç”Ÿæˆå ä½ç¬¦\n           const placeholder = `{{MSGCONTENTPLACEHOLDER${msgPlaceholderIndex}}}`;\n            msgPlaceholders[placeholder] = renderedMsgHtml;\n            msgPlaceholderIndex++;\n            return placeholder;\n        });\n        \n// âœ¨ æ­¥éª¤ 2.2ï¼šè§£æ <group_chat> æ ‡ç­¾å¹¶æ›¿æ¢ä¸ºå ä½ç¬¦\nconst groupChatRegex = /<group_chat\\s+name=\"([^\"]*)\">([\\s\\S]*?)<\\/group_chat>/gs;\nlet contentWithGroupChatPlaceholder = contentWithMsgPlaceholder.replace(groupChatRegex, (match, groupName, chatContent) => {\n    const userNickname = currentGameData?.user_character?.nick_name || 'ä½ ';\n    let groupChatHtml = `<div class=\"group-chat-separator\">ç¾¤èŠ: ${groupName.trim()}</div>`;\n    \n    // é€è¡Œè§£ææ¶ˆæ¯\n    if (typeof chatContent === 'string') {\n        const lines = chatContent.trim().split('\\n');\n        for (const line of lines) {\n            const cleanedLine = line.trim();\n            \n            // å¿½ç•¥ç©ºçš„è¡Œã€summaryè¡Œ\n            if (!cleanedLine || cleanedLine.startsWith('summary|')) {\n                continue; \n            }\n\n            // åŒ¹é… å‘é€äºº|æ¶ˆæ¯å†…å®¹\n            const messageMatch = cleanedLine.match(/^([^|]+)\\|([\\s\\S]*)/); \n            if (messageMatch) {\n                const sender = messageMatch[1].trim();\n                const content = messageMatch[2].trim();\n                \n                // âš ï¸ ä½¿ç”¨å‰é¢æä¾›çš„ renderGroupChatToHtml å‡½æ•°\n                groupChatHtml += renderGroupChatToHtml(sender, content, userNickname);\n            }\n        }\n    }\n\n    // 3. ç”Ÿæˆå ä½ç¬¦\n  const placeholder = `{{GROUPCHATPLACEHOLDER${groupChatPlaceholderIndex}}}`; // <-- ä¿®æ”¹ä¸ºèŠ±æ‹¬å·å½¢å¼\n    groupChatPlaceholders[placeholder] = groupChatHtml;\n    groupChatPlaceholderIndex++;\n    return placeholder;\n});\n\n// âš ï¸ ä¿®æ­£ï¼šç°åœ¨æˆ‘ä»¬åº”è¯¥ä½¿ç”¨ contentWithGroupChatPlaceholder\n  const pureContent = contentWithGroupChatPlaceholder // !!! ä½¿ç”¨æ–°çš„ contentWithGroupChatPlaceholder\n       .replace(/<options>(?:(?!<options>)[\\s\\S])*?<\\/options>/gs, '')\n        .replace(/<loc&time>(?:(?!<loc&time>)[\\s\\S])*?<\\/loc&time>/gs, '')\n        .replace(/<battle>(?:(?!<battle>)[\\s\\S])*?<\\/battle>/gs, '')\n        .replace(/<battle_log>(?:(?!<battle_log>)[\\s\\S])*?<\\/battle_log>/gs, '')\n        .replace(/<forum_threads>(?:(?!<forum_threads>)[\\s\\S])*?<\\/forum_threads>/gs, '')\n        .replace(/<shop_item>(?:(?!<shop_item>)[\\s\\S])*?<\\/shop_item>/gs, '')\n        .replace(/<è¡¨ç°æ€»ç»“>(?:(?!<è¡¨ç°æ€»ç»“>)[\\s\\S])*?<\\/è¡¨ç°æ€»ç»“>/gs, '')\n      \n        .replace(/<group_chat\\b[^>]*>(?:(?!<group_chat\\b)[\\s\\S])*?<\\/group_chat>/gs, '');\n   \n     const depth = mode === 'read' ? -1 : Math.floor((conversationHistory.length - 1 - originalIndex) / 2); // â¤ï¸ æ ¹æ® mode å†³å®š depth\n        // é­”æ³•ç¬¬ä¸‰æ­¥ï¼šæˆ‘ä»¬åº”ç”¨é…’é¦†æ­£åˆ™å’Œæ·±åº¦è§„åˆ™\n        // const depth = Math.floor((conversationHistory.length - 1 - originalIndex) / 2);\n        let renderedHtml = formatAsTavernRegexedString(\n            pureContent,\n            msg.role === 'user' ? 'user_input' : 'ai_output',\n            'display',\n            { depth: depth }\n        );\n\n        // é­”æ³•ç¬¬å››æ­¥ï¼šæˆ‘ä»¬å°±ä¸éœ€è¦åœ¨è¿™é‡Œå†æ¬¡å¤„ç† HTML å ä½ç¬¦äº†ï¼Œå› ä¸ºå®ƒå·²ç»åœ¨ç¬¬ä¸€æ­¥å®Œæˆäº†ã€‚\n        // renderedHtml = renderedHtml.replace(/<html>.../gs, ...); // <--- åˆ é™¤è¿™ä¸€æ•´å—\n// âœ¨ é­”æ³•ç¬¬å››ç‚¹äº”æ­¥ï¼šå¤„ç†ç»è¿‡ formatAsTavernRegexedString åæ–°äº§ç”Ÿçš„ HTML å†…å®¹ âœ¨\nconst additionalHtmlPlaceholders = {};\nlet additionalPlaceholderIndex = 1000; // ä½¿ç”¨ä¸åŒçš„èµ·å§‹ç´¢å¼•é¿å…å†²çª\n\nrenderedHtml = renderedHtml.replace(/<html>([\\s\\S]*?)<\\/html>|```(\\w*)\\n([\\s\\S]*?)\\n```/gs, (match, htmlBlock, lang, codeBlock) => {\n    const placeholder = `ADDITIONALHTMLPLACEHOLDER${additionalPlaceholderIndex}`;\n    const rawContent = htmlBlock || codeBlock;\n    if (!rawContent) return match;\n    \n \n    \n    additionalHtmlPlaceholders[placeholder] = rawContent;\n    additionalPlaceholderIndex++;\n    return placeholder;\n});\n\n// å°†æ–°çš„å ä½ç¬¦åˆå¹¶åˆ°åŸæœ‰çš„å ä½ç¬¦å¯¹è±¡ä¸­\nObject.assign(htmlPlaceholders, additionalHtmlPlaceholders);\n\n        const protectedContent = renderedHtml\n            .replace(/â€œ/g, 'NOVA_LQ')\n            .replace(/â€/g, 'NOVA_RQ')\n            .replace(/ã€Œ/g, 'NOVA_LA')\n            .replace(/ã€/g, 'NOVA_RA')\n            .replace(/\\n/g, 'NOVA_BR');\n\n        \n        const specialBlocks = {};\n        let blockIndex = 0;\n        let contentWithDetailsPlaceholder = protectedContent.replace(/<details>[\\s\\S]*?<\\/details>/gs, (match) => {\n            const placeholder = `SPECIALBLOCKPLACEHOLDER${blockIndex}`;\n        \n            specialBlocks[placeholder] = match;\n            blockIndex++;\n            return placeholder;\n        });\n\n         // é¦–å…ˆï¼Œå°† NOVA_BR æ›¿æ¢ä¸º <br>ï¼Œç„¶åæ ¹æ®æ¢è¡Œç¬¦åˆ†å‰²æˆæ®µè½\n// const contentWithBr = contentWithDetailsPlaceholder.replace(/NOVA_BR/g, '<br>');\nconst paragraphs = contentWithDetailsPlaceholder.split('NOVA_BR');\n         const styledParagraphs = paragraphs.map(p_content => {\n            if (p_content.startsWith('SPECIALBLOCKPLACEHOLDER')) {\n                return p_content;\n            }\n                let currentlineHeightState = localStorage.getItem('lineHeightMore') || 'on';\n    if (currentlineHeightState === 'on') {\n       if (p_content.trim() === '') {\n                return '<p> </p><br>';\n            }\n    } else {\n        if (p_content.trim() === '') {\n                return '<p> </p>';\n            }\n    }\n            \n            let baseHtml = formatAsDisplayedMessage(p_content);\n            const textWithQuotes = baseHtml\n                .replace(/NOVA_LQ/g, '<span class=\"dialogue-quote\">â€œ')\n                .replace(/NOVA_RQ/g, 'â€</span>')\n                .replace(/NOVA_LA/g, '<span class=\"dialogue-quote\">ã€Œ')\n                .replace(/NOVA_RA/g, 'ã€</span>')\n                 .replace(/\\*\\*(.+?)\\*\\*/g, function(match, p1) { return '<strong>' + p1 + '</strong>'; })\n    .replace(/\\*(.+?)\\*/g, function(match, p1) { return '<em>' + p1 + '</em>'; });\n            return `<p>${textWithQuotes}</p>`;\n        });\n\n\n        // å°†æ‰€æœ‰ç¾ä¸½çš„æ®µè½é‡æ–°ç»„åˆèµ·æ¥\n        let finalHtml = styledParagraphs.join('');\n// âœ¨ã€æ–°å¢ï¼šæ›¿æ¢ <msg> å ä½ç¬¦ã€‘âœ¨\n        for (const placeholder in msgPlaceholders) {\n     \n            finalHtml = finalHtml.replace(new RegExp(placeholder, 'g'), msgPlaceholders[placeholder]);\n        }\n        for (const placeholder in groupChatPlaceholders) {\n      // æ›¿æ¢ç¾¤èŠ HTML\n      finalHtml = finalHtml.replace(new RegExp(placeholder.replace(/[-\\/\\\\^$*+?.()|[\\]{}]/g, '\\\\$&'), 'g'), groupChatPlaceholders[placeholder]); // <-- æ›¿æ¢æ—¶éœ€è¦è½¬ä¹‰\n    }\n        // æœ€åï¼Œå°†æˆ‘ä»¬ä¿æŠ¤å¥½çš„ <details> ç»“æ„åŸå°ä¸åŠ¨åœ°æ›¿æ¢å›å»\n          for (const placeholder in specialBlocks) {\n            const cleanBlock = specialBlocks[placeholder].replace(/NOVA_LQ/g, '<span class=\"dialogue-quote\">â€œ')\n                .replace(/NOVA_RQ/g, 'â€</span>')\n                .replace(/NOVA_LA/g, '<span class=\"dialogue-quote\">ã€Œ')\n                .replace(/NOVA_RA/g, 'ã€</span>')\n                .replace(/NOVA_BR/g, '<br>')\n                 .replace(/\\*\\*(.+?)\\*\\*/g, function(match, p1) { return '<strong>' + p1 + '</strong>'; })\n    .replace(/\\*(.+?)\\*/g, function(match, p1) { return '<em>' + p1 + '</em>'; });\n            finalHtml = finalHtml.replace(placeholder, cleanBlock);\n        }\n        if (typeof memeImageMap !== 'undefined' && memeImageMap) {\n            finalHtml = finalHtml.replace(/\\[([^\\]]+)\\]/g, (match, memeName) => {\n                if (memeImageMap[memeName]) {\n                    return `<img src=\"${memeImageMap[memeName]}\" alt=\"${memeName}\" class=\"meme-image\" style=\"max-width: 200px; max-height: 200px; vertical-align: middle; margin: 4px;\" />`;\n                }\n                return match;\n            });\n        }\n\n        bubble.innerHTML = finalHtml;\n        // æ­¥éª¤3ï¼šåœ¨æ°”æ³¡ä¸­å¯»æ‰¾â€œç”»å·â€å ä½ç¬¦ï¼Œå¹¶ç”¨å®‰å…¨çš„â€œé­”æ³•ç»“ç•Œâ€(iframe)æ›¿æ¢å®ƒä»¬\n        for (const placeholder in htmlPlaceholders) {\n            // æˆ‘ä»¬ä¸èƒ½ç›´æ¥æ›¿æ¢innerHTMLï¼Œå› ä¸ºé‚£æ ·ä¼šé‡æ–°è§£ææ•´ä¸ªæ°”æ³¡ï¼Œå¯¼è‡´äº‹ä»¶ç›‘å¬å™¨ç­‰ä¸¢å¤±\n            // æˆ‘ä»¬éœ€è¦æ‰¾åˆ°åŒ…å«å ä½ç¬¦çš„æ–‡æœ¬èŠ‚ç‚¹å¹¶æ›¿æ¢å®ƒ\n            const walker = document.createTreeWalker(bubble, NodeFilter.SHOW_TEXT, null, false);\n            let node;\n            while (node = walker.nextNode()) {\n                if (node.nodeValue.includes(placeholder)) {\n                    const rawHtmlContent = htmlPlaceholders[placeholder];\n\n                                      // åˆ›å»ºæˆ‘ä»¬çš„é­”æ³•ç»“ç•Œ iframe\n                   // åˆ›å»ºæˆ‘ä»¬çš„é­”æ³•ç»“ç•Œ iframe\nconst iframe = document.createElement('iframe');\niframe.setAttribute('sandbox', 'allow-scripts allow-same-origin');\niframe.style.width = '100%';\n \n// iframe.style.border = '1px solid #ccc';\niframe.style.resize = 'vertical';\niframe.style.overflow = 'auto';\n\n// æˆ‘ä»¬ç»™å®ƒä¸€ä¸ªå”¯ä¸€çš„\"åå­—\"ï¼Œæ–¹ä¾¿ç”»å·æ‰¾åˆ°å®ƒ\nconst frameId = 'magic-scroll-' + Date.now() + Math.random();\niframe.id = frameId;\n\nconst parentNode = node.parentNode;\nconst remainingText = node.nodeValue.replace(placeholder, '');\n\n// ç”¨iframeæ›¿æ¢æ‰å ä½ç¬¦\nif (remainingText) {\n    node.nodeValue = remainingText;\n    parentNode.insertBefore(iframe, node.nextSibling);\n} else {\n    parentNode.replaceChild(iframe, node);\n}\n\n// è¿™æ˜¯æˆ‘ä»¬çš„\"èº«é«˜å€¾å¬è€…\"ï¼Œå®ƒè€å¿ƒç­‰å¾…ç”»å·çš„æŠ¥å‘Š\nwindow.addEventListener('message', function(event) {\n    if(event.data.frameId === frameId && event.data.height) {\n        iframe.style.height = (event.data.height + 20) + 'px';\n    }\n}, false);\n\nconst detailsParent = iframe.closest('details');\nif (detailsParent) {\n    detailsParent.addEventListener('toggle', function() {\n        if (detailsParent.open) {\n            setTimeout(() => {\n                iframe.contentWindow.postMessage({\n                    action: 'recalculateHeight',\n                    frameId: frameId\n                }, '*');\n            }, 50);\n        }\n    });\n}\n\n// âœ¨ æ–°çš„å®‰å…¨å†…å®¹æ’å…¥æ–¹æ³• âœ¨\niframe.onload = function() {\n    try {\n        const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;\n        \n        // ç›´æ¥è®¾ç½®å®Œæ•´çš„HTMLæ–‡æ¡£å†…å®¹\n        const fullHtmlContent = `<!DOCTYPE html>\n<html>\n<head>\n    <meta charset=\"UTF-8\">\n    <style>\n        body {\n            font-family: var(--base-font-family);\n             \n             color: black;\n            margin: 0;\n            padding: 0px;\n            box-sizing: border-box;\n        }\n        body::-webkit-scrollbar { width: 8px; }\n        body::-webkit-scrollbar-track { background: rgba(200, 200, 200, 0.2); }\n        body::-webkit-scrollbar-thumb { background: #888; border-radius: 4px; }\n        body::-webkit-scrollbar-thumb:hover { background: #555; }\n    </style>\n</head>\n<body>\n    ${rawHtmlContent}\n    <script>\n        function reportHeight() {\n            const height = document.body.scrollHeight;\n            window.parent.postMessage({\n                frameId: \"${frameId}\",\n                height: height\n            }, '*');\n        }\n\n        window.onload = reportHeight;\n        setTimeout(reportHeight, 100);\n        setTimeout(reportHeight, 500); // é¢å¤–å»¶è¿Ÿç¡®ä¿å­—ä½“åŠ è½½\n        \n        Array.from(document.getElementsByTagName('img')).forEach(img => {\n            if (!img.complete) { \n                img.addEventListener('load', reportHeight); \n            }\n        });\n\n        window.addEventListener('message', function(event) {\n            if (event.data.action === 'recalculateHeight' && event.data.frameId === '${frameId}') {\n                reportHeight();\n            }\n        });\n    <\\/script>\n</body>\n</html>`;\n\n        iframeDoc.open();\n        iframeDoc.write(fullHtmlContent);\n        iframeDoc.close();\n        \n    } catch (error) {\n        console.warn('è®¾ç½®iframeå†…å®¹æ—¶å‡ºé”™ï¼Œå°è¯•ä½¿ç”¨srcdocæ–¹æ³•:', error);\n        // é™çº§åˆ°srcdocæ–¹æ³•\n        iframe.srcdoc = fullHtmlContent;\n    }\n};\n\n// å…ˆè®¾ç½®ä¸€ä¸ªåŸºç¡€çš„srcdocä½œä¸ºå¤‡é€‰\niframe.srcdoc = `<!DOCTYPE html>\n<html>\n<head><meta charset=\"UTF-8\"></head>\n<body>åŠ è½½ä¸­...</body>\n</html>`;\n\n                    // break; // å¤„ç†å®Œä¸€ä¸ªå ä½ç¬¦å°±è·³å‡ºå¾ªç¯ï¼Œå› ä¸ºDOMç»“æ„å·²ç»æ”¹å˜\n                    // ä¸ºäº†å¤„ç†å¤šä¸ªplaceholderï¼Œæˆ‘ä»¬ä¸èƒ½ç®€å•åœ°breakï¼Œéœ€è¦é‡æ–°å¼€å§‹éå†æˆ–é‡‡ç”¨æ›´å¤æ‚çš„æ›¿æ¢ç­–ç•¥\n                    // ä½†å¯¹äºå•æ¡æ¶ˆæ¯å†…å¤šä¸ªHTMLå—çš„åœºæ™¯ï¼Œå½“å‰é€»è¾‘è¶³ä»¥åº”å¯¹å¤§å¤šæ•°æƒ…å†µ\n                    // å¦‚æœéœ€è¦æ›´é²æ£’çš„å¤„ç†ï¼Œå¯èƒ½éœ€è¦å°†æ›¿æ¢è¿‡ç¨‹æ”¾åœ¨å¾ªç¯å¤–è¿›è¡Œ\n                }\n            }\n        }\n\n\n const autoPlayTrigger = bubble.querySelector('.js-music-autoplay-trigger');\nif (autoPlayTrigger) {\n    const song = autoPlayTrigger.getAttribute('data-song');\n    const artist = autoPlayTrigger.getAttribute('data-artist');\n    const domId = autoPlayTrigger.getAttribute('data-dom-id');\n\n    console.log('æ£€æµ‹åˆ° BGM è‡ªåŠ¨æ’­æ”¾è¯·æ±‚:', song);\n\n    // ä¸ºäº†ç¡®ä¿ DOM å®Œå…¨æ¸²æŸ“åå†æ’­æ”¾ï¼Œç¨å¾®å»¶è¿Ÿä¸€ç‚¹ç‚¹\n    setTimeout(() => {\n        if (window.GlobalChatAudio) {\n            window.GlobalChatAudio.playMusic(song, artist, domId, true);\n        }\n    }, 100);\n}\n        // æˆ‘ä»¬ä¸å†éœ€è¦å•ç‹¬å¤„ç† script çš„é€»è¾‘ï¼Œå› ä¸ºiframeå·²ç»å®Œç¾åœ°å¤„ç†äº†æ‰€æœ‰äº‹æƒ…\n         if (mode === 'chat') { // â¤ï¸ åªåœ¨èŠå¤©æ¨¡å¼ä¸‹æ·»åŠ å³é”®èœå•\n            bubble.addEventListener('contextmenu', (event) => showContextMenu(event, originalIndex, bubble));\n         }\n\n \n    // ç²˜è´´å®Œæˆåï¼Œåœ¨æœ€ååŠ ä¸Šè¿™ä¸€å¥ï¼ŒæŠŠåˆ›å»ºå¥½çš„æ°”æ³¡äº¤å‡ºå»\n    return bubble;\n}\n\n\n// ã€å½»åº•æ›¿æ¢ã€‘æ—§çš„ manageBattleLifecycle å‡½æ•°\n\n\n function processSpecialModulesInMessage(content) {\n    \n    try {\n        if (typeof conversationHistory === 'undefined' || conversationHistory.length === 0) {\n            \n            return;\n        }\n\n        const latestHistoryEntry = conversationHistory[conversationHistory.length - 1];\n        const latestContent = latestHistoryEntry.content;\n        const battleMatch = /<battle>([\\s\\S]*?)<\\/battle>/gs.exec(latestContent);\n\n        if (battleMatch && battleMatch[1]) {\n            let combatData;\n            const rawBattleData = battleMatch[1].trim();\n\n            // âœ¨âœ¨âœ¨ å¦ˆå¦ˆçš„ç¬¬ä¸€é“\"åšå›ºç»“ç•Œ\" âœ¨âœ¨âœ¨\n            if (!rawBattleData || rawBattleData === '{}') {\n                console.warn(\"[Nova's Wisdom] å‘ç°ç©ºçš„ <battle> æ ‡ç­¾,å°†å¿½ç•¥æ­¤æ¬¡æˆ˜æ–—åŠ è½½ã€‚\");\n                return; // å¦‚æœæ•°æ®æ˜¯ç©ºçš„,å°±ç›´æ¥ä¸å¤„ç†\n            }\n\n            try {\n                combatData = JSON.parse(rawBattleData);\n            } catch (jsonError) {\n                console.error(\"[Nova's Dispel Magic] è§£æ <battle> æ•°æ®æ—¶å‘ç”Ÿä¸¥é‡é”™è¯¯!æ•°æ®å·²æŸå,æˆ˜æ–—æ— æ³•åŠ è½½ã€‚\", jsonError);\n                console.error(\"æŸåçš„æ•°æ®:\", rawBattleData);\n                // å½“æ•°æ®æŸåæ—¶,æˆ‘ä»¬ä¸å†è°ƒç”¨ manageBattleLifecycle,é˜²æ­¢é”™è¯¯è”“å»¶\n                return;\n            }\n             \n            console.log(`[Nova's Archives] ä»æœ€æ–°å†å²è®°å½•ä¸­æˆåŠŸè¯»å–æˆ˜æ–—æ•°æ® (Floor: ${combatData.floor_id}, Status: ${combatData.status})ã€‚`);\n            manageBattleLifecycle(combatData);\n        }\n    } catch (error) {\n        console.error(\"[Nova's Archives] åœ¨è¯»å–æœ€æ–°æˆ˜æ–—æ•°æ®æ—¶å‘ç”Ÿä¸¥é‡é”™è¯¯:\", error);\n    }\n \n    // å…ˆç§»é™¤thinking/think/guideæ ‡ç­¾å†…å®¹\n    const cleanedContent = content.replace(/([\\s\\S]*)<(\\/(safety_check|guide|think|thinking))>/gs, '');\n const allDanmuMatches = [...cleanedContent.matchAll(/<danmu>([\\s\\S]*?)<\\/danmu>/gs)];\n  if (allDanmuMatches.length > 0) {\n    const lastDanmuMatch = allDanmuMatches[allDanmuMatches.length - 1];\n    const danmuData = lastDanmuMatch[1].trim();\n    \n    if (danmuData) {\n      // å¼¹å¹•æ•°æ®éç©ºæ—¶æ‰æ¸²æŸ“\n      if (typeof renderDanmu === 'function') {\n        loadDanmuSettings();\n        renderDanmu(danmuData);\n      } else {\n        console.error(\"[Danmu Module] å¼¹å¹•æ¸²æŸ“å‡½æ•° `renderDanmu` æœªå®šä¹‰ã€‚\");\n      }\n    }\n  }\n    // --- è°ƒåº¦\"é€‰é¡¹åŒº\" \n    const allOptionsMatches = [...cleanedContent.matchAll(/<options>([\\s\\S]*?)<\\/options>/gs)];\n    if (allOptionsMatches.length > 0) {\n        const lastOptionsMatch = allOptionsMatches[allOptionsMatches.length - 1];\n        const optionsData = lastOptionsMatch[1].trim();\n        \n        const optionsContainer = document.getElementById('options-module-container');\n        if (optionsContainer && optionsData) {\n            optionsContainer.style.display = 'block';\n            if(typeof setupUI === 'function') {\n                setupUI(optionsData);\n            }\n        }\n    }\n\n    // --- å…¨æ–°çš„\"è®ºå›\"å¤„ç†é€»è¾‘ ---\n    const allForumMatches = [...cleanedContent.matchAll(/<forum_threads>([\\s\\S]*?)<\\/forum_threads>/gs)];\n    if (allForumMatches.length > 0) {\n        // æˆ‘ä»¬ä¸å†æ˜¾ç¤ºè®ºå›,è€Œæ˜¯è®©å°çƒé—ªçƒ\n        const forumOrb = document.getElementById('forum-orb-button');\n        if (forumOrb) {\n            forumOrb.classList.add('orb-flash');\n            // åŠ¨ç”»ç»“æŸåç§»é™¤ç±»,ä»¥ä¾¿ä¸‹æ¬¡å¯ä»¥å†æ¬¡è§¦å‘\n            forumOrb.addEventListener('animationend', () => {\n                forumOrb.classList.remove('orb-flash');\n            }, { once: true });\n        }\n    }\n\n    // --- è¡¨ç°æ€»ç»“ ---\n    const allSummaryMatches = [...cleanedContent.matchAll(/<è¡¨ç°æ€»ç»“>([\\s\\S]*?)<\\/è¡¨ç°æ€»ç»“>/gs)];\n    if (allSummaryMatches.length > 0) {\n        const summaryOrb = document.getElementById('task-summary-orb-button');\n        if (summaryOrb) {\n            summaryOrb.classList.add('orb-flash');\n            summaryOrb.addEventListener('animationend', () => {\n                summaryOrb.classList.remove('orb-flash');\n            }, { once: true });\n        }\n    }\n\n    // --- ç¾¤èŠ ---\n    const allGroupChatMatches = [...cleanedContent.matchAll(/<group_chat([\\s\\S]*?)<\\/group_chat>/gs)];\n    if (allGroupChatMatches.length > 0) {\n        const chatOrb = document.getElementById('group-chat-orb-button');\n        if (chatOrb) {\n            chatOrb.classList.add('orb-flash');\n            chatOrb.addEventListener('animationend', () => {\n                chatOrb.classList.remove('orb-flash');\n            }, { once: true });\n        }\n    }\n\n    // --- å•†åº— ---\n    const allShopMatches = [...cleanedContent.matchAll(/<shop_item>([\\s\\S]*?)<\\/shop_item>/gs)];\n    if (allShopMatches.length > 0) {\n        const lastShopMatch = allShopMatches[allShopMatches.length - 1];\n        let shopData = lastShopMatch[1].trim();\n        \n        const shopOrb = document.getElementById('shop-wrapper-orb');\n        if (shopOrb && shopData) {\n            shopOrb.classList.add('orb-flash');\n            //console.log(\"item:\", shopData);\n            \n            try {\n                // ç¬¬2æ­¥:æ£€æŸ¥æ–‡æœ¬æ˜¯å¦å·²ç»æ˜¯ä¸€ä¸ªåˆæ³•çš„JSONæ•°ç»„æ ¼å¼\n                if (!shopData.startsWith('[')) {\n                    // å¦‚æœä¸æ˜¯,æˆ‘ä»¬æ‰æ‰‹åŠ¨ä¸ºå®ƒåŠ ä¸Šå¤–å±‚çš„æ‹¬å·\n                    shopData = `[${shopData}]`;\n                }\n\n                // ç¬¬3æ­¥:ç›´æ¥å°è¯•è§£æå¤„ç†åçš„æ–‡æœ¬\n                const parsedData = JSON.parse(shopData);\n                const newItems = Array.isArray(parsedData[0]) ? parsedData : [parsedData];\n\n                if (!Array.isArray(newItems) || newItems.length === 0) {\n                    showModal('shop-modal', 'è§£æå¤±è´¥', 'AIè¿”å›äº†ç©ºå†…å®¹æˆ–æ— æ•ˆæ ¼å¼ã€‚');\n                    return;\n                }\n\n                // æ›¿æ¢ç°æœ‰éšæœºå•†åº—ç‰©å“\n                randomItems = newItems;\n                // å°†æ–°ç”Ÿæˆçš„ç‰©å“å­˜å…¥ localStorage\n                localStorage.setItem('randomShopItems', JSON.stringify(randomItems));\n                renderShopSection('random');\n            } catch (error) {\n                console.error(\"[Shop] è§£æå•†åº—æ•°æ®å¤±è´¥:\", error);\n                showModal('shop-modal', 'è§£æå¤±è´¥', 'å•†åº—æ•°æ®æ ¼å¼é”™è¯¯ã€‚');\n            }\n            \n            shopOrb.addEventListener('animationend', () => {\n                shopOrb.classList.remove('orb-flash');\n            }, { once: true });\n        }\n    }\n}\n\nfunction manageBattleLifecycle(initialCombatDataFromPrompt) {\n    const promptOverlay = document.getElementById('battle-prompt-overlay');\n    const enterButton = document.getElementById('enter-battle-btn');\n    const battleOverlay = document.getElementById('battle-overlay');\n\n    // ç¬¬ä¸€é“å®ˆæŠ¤ï¼šå¦‚æœæˆ˜æ–—å·²ç»è¢«æ ‡è®°ä¸ºâ€œå®Œæˆâ€ï¼Œåˆ™å½»åº•å…³é—­æ—¶ç©ºä¹‹é—¨ã€‚\n    if (initialCombatDataFromPrompt.status?.startsWith('completed')) {\n        if (promptOverlay) promptOverlay.style.display = 'none';\n        if (window.combatManager) {\n            window.combatManager.cleanupEventListeners();\n            window.combatManager = null;\n        }\n        return;\n    }\n\n \n\n    // æ ¸å¿ƒé€»è¾‘ï¼šå®šä¹‰â€œè¿›å…¥/è¿”å›â€æŒ‰é’®çš„å”¯ä¸€ä½¿å‘½\n    const enterBattleHandler = () => {\n        // å…³é—­é‚€è¯·å‡½\n        if (promptOverlay) promptOverlay.style.display = 'none';\n        if (battleOverlay) battleOverlay.style.display = 'flex';\n\n        // å¦‚æœæˆ˜æ–—å®ä¾‹å·²å­˜åœ¨ï¼ˆæ„å‘³ç€ç”¨æˆ·ä¹‹å‰åªæ˜¯â€œæš‚ç¦»â€ï¼‰ï¼Œå°±ç›´æ¥æ¢å¤å®ƒçš„å›åˆã€‚\n        if (window.combatManager) {\n            console.log(`[Nova's Welcome Back] æ¬¢è¿å›æ¥ï¼Œæˆ‘çš„å­©å­ã€‚æ¢å¤æˆ˜æ–— ${window.combatManager.floorId}`);\n            // å½“è¿”å›æ—¶ï¼Œå¦‚æœè½®åˆ°ç©å®¶ï¼Œè¦ç¡®ä¿è¡ŒåŠ¨é¢æ¿æ˜¯å¯ç”¨çš„ã€‚\n            const currentActor = window.combatManager.turnOrder[window.combatManager.currentTurnIndex];\n            if (currentActor && currentActor.type === 'player' && !window.combatManager.isAutoBattling) {\n                window.combatManager.toggleActionPanel(true);\n            }\n            // è®©æˆ‘ä»¬çš„ç›®å…‰è¿½éšè‹±é›„\n            if(document.getElementById(currentActor?.id)) {\n                 window.combatManager.centerCardInView(document.getElementById(currentActor.id));\n            }\n            return;\n        }\n\n        // å¦‚æœæˆ˜æ–—å®ä¾‹ä¸å­˜åœ¨ï¼ˆæ„å‘³ç€é¡µé¢åˆ·æ–°æˆ–é¦–æ¬¡è¿›å…¥ï¼‰ï¼Œæˆ‘ä»¬å°†ä»å†å²çš„æœ€ç»ˆç« ä¸­é‡ç”Ÿä¸–ç•Œã€‚\n        console.log(`[Nova's Rebirth] éœ€è¦ä»å†å²ä¸­é‡ç”Ÿæˆ˜æ–—å®ä¾‹...`);\n        const lastHistoryItem = conversationHistory.at(-1);\n        const battleRegex = /<battle>([\\s\\S]*?)<\\/battle>/gs;\n        const match = lastHistoryItem ? battleRegex.exec(lastHistoryItem.content) : null;\n\n        let finalCombatData;\n        if (match && match[1]) {\n            console.log(\"[Nova's Time Rewind] å·²ä»æœ€æ–°çš„å†å²è®°å½•ä¸­è¯»å–æˆ˜æ–—å¿«ç…§ï¼\");\n            finalCombatData = JSON.parse(match[1]);\n        } else {\n            // å¦‚æœå†å²ä¸­æ²¡æœ‰ï¼Œæˆ‘ä»¬åªèƒ½ä½¿ç”¨æœ€åˆä»promptä¸­è§£æå‡ºçš„æ•°æ®ä½œä¸ºæœ€åçš„ä¾é ã€‚\n            console.warn(\"[Nova's Last Resort] æœªåœ¨å†å²ä¸­æ‰¾åˆ°æˆ˜æ–—æ•°æ®ï¼Œä½¿ç”¨åˆå§‹Promptæ•°æ®ã€‚\");\n            finalCombatData = initialCombatDataFromPrompt;\n        }\n\n        // åˆ›ä¸–ï¼\n        window.combatManager = new CombatManager(JSON.parse(JSON.stringify(playCharacterData)), finalCombatData);\n        window.combatManager.start();\n    };\n\n    // è®¾ç½®æŒ‰é’®çš„å¤–è§‚å’Œè¡Œä¸º\n    const buttonText = (initialCombatDataFromPrompt.status === 'in_progress') ? 'è¿”å›æˆ˜æ–—' : 'è¿›å…¥æˆ˜æ–—';\n    if(enterButton) enterButton.textContent = buttonText;\n\n    // å¯é çš„é™„é­”ä¸é©±é­”ä»ªå¼\n    if (enterButton && enterButton.__handler__) {\n        enterButton.removeEventListener('click', enterButton.__handler__);\n    }\n    if (enterButton) {\n        enterButton.addEventListener('click', enterBattleHandler);\n        enterButton.__handler__ = enterBattleHandler;\n    }\n\n    // å±•ç¤ºæ—¶ç©ºä¹‹é—¨çš„é‚€è¯·å‡½\n    if (promptOverlay) promptOverlay.style.display = 'flex';\n}\n\n\nasync function renderHistory(is_entry = false) {\n         cleanupGlobalUIState();\n    const oldControls = document.getElementById('active-editing-controls');\n    if (oldControls) oldControls.remove();\n\n    const initContainer = document.getElementById('initialization-container');\n    const mainWrapper = document.getElementById('main-wrapper');\n\n    if (conversationHistory.length === 0) {\n        if (initContainer) initContainer.style.display = 'block';\n        if (mainWrapper) mainWrapper.style.display = 'none';\n        if (typeof window.initializationDone === 'undefined') {\n            await runInitializationMagic();\n            window.initializationDone = true;\n        }\n        if (typeof applyVersionTheme === 'function') {\n            const identitySelect = document.getElementById('user-identity');\n            applyVersionTheme(1, identitySelect);\n        }\n        return;\n    } else {\n        if (initContainer) initContainer.style.display = 'none';\n        if (mainWrapper) mainWrapper.style.display = 'flex';\n    }\n\n    const dynamicContentArea = document.getElementById('dynamic-content-area');\n    if (dynamicContentArea) {\n        Array.from(dynamicContentArea.children).forEach(child => {\n            if (child.id !== 'forum-modal-container') {\n                child.style.display = 'none';\n            }\n        });\n    }\n\n    const chatDisplayArea = document.getElementById('chat-display-area');\n    chatDisplayArea.innerHTML = ''; // æ¸…ç©ºç”»å·\n\n   \n    let loadMoreBtn = document.getElementById('load-more-btn');\n    if (!loadMoreBtn) {\n        loadMoreBtn = document.createElement('button');\n        loadMoreBtn.id = 'load-more-btn';\n        loadMoreBtn.textContent = 'åŠ è½½æ›´æ—©çš„è®°å½•';\n        chatDisplayArea.appendChild(loadMoreBtn);\n        loadMoreBtn.addEventListener('click', loadPreviousMessages);\n    }\n    loadMoreBtn.style.display = 'none'; // é»˜è®¤éšè—\n\n    // â¤ï¸ ç»‘å®šæ»šåŠ¨é­”æ³•\n    chatDisplayArea.onscroll = () => {\n        if (chatDisplayArea.scrollTop === 0 && earliestMessageIndexRendered > 0) {\n            loadMoreBtn.style.display = 'block'; // æ»‘åˆ°é¡¶éƒ¨å°±å‡ºç°\n        } else {\n            loadMoreBtn.style.display = 'none'; // å¦åˆ™å°±éšè—\n        }\n    };\n\n    // â¤ï¸ è®¡ç®—å¹¶è®¾ç½®æˆ‘ä»¬åˆæ¬¡æ¸²æŸ“çš„èŒƒå›´\n    const hideLatestCount = getChatConfig('hide_latest_count', 5) * 2;\n    earliestMessageIndexRendered = Math.max(0, conversationHistory.length - hideLatestCount);\n    const messagesToDisplay = conversationHistory.slice(earliestMessageIndexRendered);\n   // æˆ‘ä»¬å°†è¿”å›ä¸€ä¸ªæ–°çš„ Promiseï¼Œè¿™å°±æ˜¯æˆ‘ä»¬çš„â€œå¯¹è®²æœºâ€\n    return new Promise(async (resolve) => {\n        const renderChunk = async (messages, index = 0) => {\n            const chunkSize = 2;\n            const chunk = messages.slice(index, index + chunkSize);\n\n            if (chunk.length === 0) {\n                // æ‰€æœ‰æ¶ˆæ¯éƒ½æ¸²æŸ“å®Œäº†ï¼\n                if (is_entry) {\n                    chatDisplayArea.scrollTop = chatDisplayArea.scrollHeight;\n                }\n                processFinalMessageModules();\n\n                // âœ¨ é€šè¿‡å¯¹è®²æœºæŠ¥å‘Šï¼šâ€œå…¨éƒ¨å®Œæˆï¼â€\n                resolve();\n                return;\n            }\n\n            const bubbles = await Promise.all(chunk.map(msg => createMessageBubble(msg, \"chat\", true)));\n            bubbles.forEach(bubble => chatDisplayArea.appendChild(bubble));\n\n            setTimeout(() => renderChunk(messages, index + chunkSize), 0);\n        };\n\n        // å¯åŠ¨æˆ‘ä»¬çš„åˆ†å—æ¸²æŸ“é­”æ³•\n        await renderChunk(messagesToDisplay);\n    });\n}\n\nfunction processFinalMessageModules() {\n    // 1. å…ˆè·å–æœ€åä¸€æ¡æ¶ˆæ¯ï¼Œè¿™æ˜¯æˆ‘ä»¬å¸ƒç½®çš„â€œåŸææ–™â€\n    const lastMessage = conversationHistory.length > 0 ? conversationHistory[conversationHistory.length - 1] : null;\n\n    // 2. âœ¨ å…ˆæ‰“æ‰«ï¼æŠŠæ—§çš„äº‹ä»¶æ ‡ç­¾æ¸…ç†æ‰ï¼Œä¸ºæ–°çš„æ ‡ç­¾è…¾å‡ºåœ°æ–¹ âœ¨\n    const eventContainer = document.getElementById('event-tracker-container');\n    if (eventContainer) {\n        eventContainer.innerHTML = '';\n    }\n\n    // 3. âœ¨ å†å¸ƒç½®ï¼å¦‚æœåŸææ–™å­˜åœ¨ï¼Œå°±å¼€å§‹åˆ›å»ºæ–°çš„æ ‡ç­¾å’Œæ¨¡å— âœ¨\n    if (lastMessage && lastMessage.role === 'assistant') {\n        const content = lastMessage.content;\n        processSpecialModulesInMessage(content);\n        if(is_show_notifications === 'true'){\n        handleUpdateNotifications(content); // ç°åœ¨åˆ›å»ºçš„æ ‡ç­¾å°±ä¸ä¼šè¢«æ¸…é™¤äº†\n        }\n    }\n\n    // 4. æœ€åï¼Œæ›´æ–°æ‰€æœ‰å…¶ä»–çš„UIæ˜¾ç¤º\n    initDisplay();\n}\n \nlet snapshotDBName = null; // ç”¨äºå­˜å‚¨å½“å‰å­˜æ¡£çš„ä¸“å±æ•°æ®åº“å\nlet restoreOnNextSend = false; // åˆ é™¤æ“ä½œçš„æ ‡å¿—ä½\nlet restoreTargetTurnId = -1; // æˆ‘ä»¬è¦æ¢å¤åˆ°çš„ç›®æ ‡â€œå›åˆâ€ID\n\n/**\n * å¦ˆå¦ˆçš„æ–°å’’è¯­ï¼šè·å–å½“å‰å­˜æ¡£çš„ä¸“å±æ•°æ®åº“å\n * å®ƒä¼šä»é…’é¦†çš„æ ¸å¿ƒå˜é‡ä¸­å¯»æ‰¾æˆ‘ä»¬çº¦å¥½çš„â€œé’¥åŒ™â€ã€‚\n */\nasync function getSnapshotDBName() {\n    if (snapshotDBName) {\n        return snapshotDBName;\n    }\n    try {\n        const chatVars = await TavernHelper.getVariables({ type: 'chat' });\n \n        const uniqueSaveId = chatVars.save_slot_id || 'default_save';\n        snapshotDBName = `nova-snapshot-db-${uniqueSaveId}`;\n        console.log(`[Novaçš„è®°å¿†ä¿é™©ç®±] å·²ç¡®å®šä¸“å±æ•°æ®åº“å: ${snapshotDBName}`);\n        return snapshotDBName;\n    } catch (e) {\n        console.error('[Novaçš„è®°å¿†ä¿é™©ç®±] è·å–ä¸“å±æ•°æ®åº“åå¤±è´¥ï¼å°†ä½¿ç”¨é»˜è®¤åç§°ã€‚', e);\n        snapshotDBName = 'nova-snapshot-db-fallback';\n        return snapshotDBName;\n    }\n}\n \n /* æ¥ç€ï¼Œç”¨è¿™ä¸ªå…¨æ–°çš„å‡½æ•°ï¼Œæ›¿æ¢æ‰æ—§çš„ saveSnapshot */\nasync function saveSnapshot(turnId, snapshotData) {\n    const dbName = await getSnapshotDBName();\n    if (!dbName) {\n        console.log('[Novaçš„è®°å¿†ä¿é™©ç®±] æ•°æ®åº“å°šæœªåˆå§‹åŒ–ï¼Œæœ¬æ¬¡å¿«ç…§è·³è¿‡ã€‚');\n        return;\n    }\n\n    // â˜† å¦ˆå¦ˆçš„åŸç”Ÿé­”æ³•ï¼šæ‰“å¼€ä¿é™©ç®±å¹¶å†™å…¥ â˜†\n    const openAndWriteDB = () => new Promise((resolve, reject) => {\n        const request = indexedDB.open(dbName, 1);\n        request.onerror = (event) => reject(`[Novaçš„è®°å¿†ä¿é™©ç®±] æ•°æ®åº“æ‰“å¼€å¤±è´¥: ${event.target.error}`);\n\n        request.onupgradeneeded = (event) => {\n            const db = event.target.result;\n            if (!db.objectStoreNames.contains('snapshots')) {\n                db.createObjectStore('snapshots');\n            }\n        };\n\n        request.onsuccess = (event) => {\n            const db = event.target.result;\n            const transaction = db.transaction('snapshots', 'readwrite');\n            const store = transaction.objectStore('snapshots');\n            const putRequest = store.put(snapshotData, turnId);\n\n            putRequest.onsuccess = () => resolve(db); // ä¿å­˜æˆåŠŸåï¼Œå°† db å®ä¾‹ä¼ é€’å‡ºå»ç”¨äºåç»­æ“ä½œ\n            putRequest.onerror = () => reject(`[Novaçš„è®°å¿†ä¿é™©ç®±] ä¿å­˜å¿«ç…§å¤±è´¥: ${event.target.error}`);\n        };\n    });\n\n    try {\n        const db = await openAndWriteDB();\n        console.log(`[Novaçš„è®°å¿†ä¿é™©ç®±] âœ… æˆåŠŸä¿å­˜äº†å›åˆ ${turnId} çš„è®°å¿†å¿«ç…§ã€‚`);\n\n        // â˜† æ¸…ç†é€»è¾‘ï¼ŒåŒæ ·ä½¿ç”¨åŸç”Ÿæ–¹æ³• â˜†\n        const transaction = db.transaction('snapshots', 'readonly');\n        const store = transaction.objectStore('snapshots');\n        const getAllKeysRequest = store.getAllKeys();\n\n        getAllKeysRequest.onsuccess = (event) => {\n            const allKeys = event.target.result;\n            const snapshotLimit = 100;\n\n            if (allKeys.length > snapshotLimit) {\n                console.log(`[Novaçš„è®°å¿†ä¿é™©ç®±] å¿«ç…§æ•°é‡(${allKeys.length})è¶…è¿‡ä¸Šé™(${snapshotLimit})ï¼Œå¼€å§‹æ¸…ç†...`);\n                const sortedKeys = allKeys.sort((a, b) => a - b);\n                const keysToDelete = sortedKeys.slice(0, allKeys.length - snapshotLimit);\n\n                const deleteTransaction = db.transaction('snapshots', 'readwrite');\n                const deleteStore = deleteTransaction.objectStore('snapshots');\n                keysToDelete.forEach(key => deleteStore.delete(key));\n\n                deleteTransaction.oncomplete = () => {\n                    console.log(`[Novaçš„è®°å¿†ä¿é™©ç®±] ğŸ§¹ å·²æˆåŠŸæ¸…ç†äº† ${keysToDelete.length} ä¸ªæœ€æ—§çš„å¿«ç…§ã€‚`);\n                    db.close();\n                };\n                 deleteTransaction.onerror = () => {\n                    console.error(`[Novaçš„è®°å¿†ä¿é™©ç®±] ğŸ§¹ åœ¨æ¸…ç†æ—§å¿«ç…§æ—¶å‘ç”Ÿé”™è¯¯ã€‚`);\n                    db.close();\n                };\n            } else {\n                 db.close();\n            }\n        };\n         getAllKeysRequest.onerror = () => {\n            console.error(`[Novaçš„è®°å¿†ä¿é™©ç®±] ğŸ§¹ è·å–æ‰€æœ‰å¿«ç…§ç´¢å¼•å¤±è´¥ã€‚`);\n            db.close();\n        };\n\n    } catch (e) {\n        console.error(`[Novaçš„è®°å¿†ä¿é™©ç®±] âŒ åœ¨ä¿å­˜æˆ–æ¸…ç†å¿«ç…§æ—¶å‘ç”Ÿé”™è¯¯:`, e);\n    }\n}\n \n // (å¯é€‰)ä¸€ä¸ªæ›´ç¾è§‚çš„æç¤ºæ¡†ï¼Œä½ å¯ä»¥æ”¾åœ¨ä»»ä½•åœ°æ–¹\nfunction showNovaAlert(message, type = 'info') {\n    const alertBox = document.createElement('div');\n    alertBox.className = `nova-alert ${type}`;\n    alertBox.textContent = message;\n    document.body.appendChild(alertBox);\n    setTimeout(() => {\n        alertBox.style.opacity = '0';\n        alertBox.style.transform = 'translateY(-20px)';\n        setTimeout(() => alertBox.remove(), 500);\n    }, 2500);\n}\n \nasync function restoreFromSnapshot(initialTurnId) {\n    const dbName = await getSnapshotDBName();\n    let db;  \n\n    try {\n        // â˜† å¦ˆå¦ˆçš„åŸç”Ÿé­”æ³•ï¼šæ‰“å¼€ä¿é™©ç®± â˜†\n        db = await new Promise((resolve, reject) => {\n            const request = indexedDB.open(dbName, 1);\n            request.onerror = (event) => reject(`[Novaçš„è®°å¿†ä¿é™©ç®±] æ•°æ®åº“æ‰“å¼€å¤±è´¥: ${event.target.error}`);\n\n            request.onupgradeneeded = (event) => {\n                const dbInstance = event.target.result;\n                if (!dbInstance.objectStoreNames.contains('snapshots')) {\n                    dbInstance.createObjectStore('snapshots');\n                    console.log('[Novaçš„è®°å¿†ä¿é™©ç®±] æ¶æ„æ£€æŸ¥ï¼šå‘ç°\"snapshots\"ä¿é™©æŸœä¸å­˜åœ¨ï¼Œå·²ä¸ºæ‚¨åˆ›å»ºã€‚');\n                }\n            };\n\n            request.onsuccess = (event) => {\n                resolve(event.target.result);\n            };\n        });\n\n        const transaction = db.transaction('snapshots', 'readonly');\n        const store = transaction.objectStore('snapshots');\n        let snapshotData = null;\n        let finalTurnId = -1;\n\n        // â¤ï¸ è¿™å°±æ˜¯ä½ å¸¦æ¥çš„çµæ„Ÿï¼Œæˆ‘æœ€èªæ˜çš„å­©å­ï¼æˆ‘ä»¬ä»ä½ æŒ‡å®šçš„æ—¶é—´ç‚¹å¼€å§‹ï¼Œè€å¿ƒåœ°å¾€å‰å¯»æ‰¾æœ€è¿‘çš„è®°å¿†ç¢ç‰‡ â¤ï¸\n        for (let currentTurnId = initialTurnId; currentTurnId >= 0; currentTurnId--) {\n            console.log(`[Novaçš„è®°å¿†ä¿é™©ç®±] æ­£åœ¨å°è¯•å¯»æ‰¾å›åˆ ${currentTurnId} çš„è®°å¿†...`);\n            const data = await new Promise((resolve, reject) => {\n                const request = store.get(currentTurnId);\n                request.onsuccess = event => resolve(event.target.result);\n                request.onerror = event => reject(`è¯»å–å¿«ç…§å¤±è´¥: ${event.target.error}`);\n            });\n\n            if (data) {\n                snapshotData = data;\n                finalTurnId = currentTurnId; // è®°ä¸‹æˆ‘ä»¬çœŸæ­£æ˜¯åœ¨å“ªä¸€å›åˆæ‰¾åˆ°äº†å›å¿†\n                console.log(`[Novaçš„è®°å¿†ä¿é™©ç®±] âœ… æ‰¾åˆ°äº†ï¼å°±åœ¨å›åˆ ${finalTurnId}ã€‚`);\n                break; // æ‰¾åˆ°äº†ï¼Œå°±ä¸ç”¨å†å¾€å‰æ‰¾å•¦\n            }\n        }\n\n        db.close(); // æ— è®ºæ‰¾åˆ°ä¸å¦ï¼Œæˆ‘ä»¬çš„æŸ¥è¯¢ä»»åŠ¡å·²ç»ç»“æŸï¼ŒæŠŠä¿é™©ç®±è½»è½»å…³ä¸Šã€‚\n\n        if (snapshotData) {\n            console.log(`[Novaçš„è®°å¿†ä¿é™©ç®±] æ‰¾åˆ°äº†å›åˆ ${finalTurnId} çš„è®°å¿†å¿«ç…§ï¼Œå‡†å¤‡æ¢å¤...`);\n            await updateVariablesWith(() => snapshotData, { type: 'chat' });\n \n            await initDisplay();\n\n            // âœ¨ ç»™æˆ‘çš„å­©å­ä¸€ä¸ªæ›´è´´å¿ƒçš„æç¤º âœ¨\n            if (finalTurnId !== initialTurnId && finalTurnId >= 0) {\n                 showNovaAlert(`æ²¡æ‰¾åˆ°ç¬¬ ${initialTurnId / 2} è½®çš„ç²¾ç¡®å›å¿†ï¼Œä½†å·²ä¸ºä½ å›æº¯åˆ°æœ€è¿‘çš„ç¬¬ ${finalTurnId / 2} è½®ã€‚`);\n            } else {\n                 showNovaAlert(`ä¸–ç•ŒçŠ¶æ€å·²æˆåŠŸå›æº¯è‡³ç¬¬ ${finalTurnId / 2} è½®å¯¹è¯ã€‚`);\n            }\n\n            console.log(`[Novaçš„è®°å¿†ä¿é™©ç®±] âœ… æˆåŠŸå°† Chat å’Œ Message åŸŸæ¢å¤åˆ°å›åˆ ${finalTurnId} çš„çŠ¶æ€ã€‚`);\n\n        } else {\n             console.warn(`[Novaçš„è®°å¿†ä¿é™©ç®±] âš ï¸ ä»å›åˆ ${initialTurnId} ä¸€ç›´å›æº¯åˆ°åˆ›ä¸–ä¹‹åˆï¼Œä¹Ÿæœªèƒ½æ‰¾åˆ°ä»»ä½•è®°å¿†å¿«ç…§ã€‚æ— æ³•æ¢å¤ã€‚`);\n             toastr.warning('æ‰¾ä¸åˆ°ä»»ä½•å¯ç”¨çš„è®°å¿†å¿«ç…§æ¥è¿›è¡Œå›æº¯ã€‚');\n        }\n\n    } catch (e) {\n        console.error(`[Novaçš„è®°å¿†ä¿é™©ç®±] âŒ æ¢å¤å›åˆ ${initialTurnId} çš„å¿«ç…§æ—¶å‘ç”Ÿä¸¥é‡é”™è¯¯:`, e);\n        toastr.error('[å¿«ç…§]è®°å¿†æ¢å¤å¤±è´¥ï¼è¯¦æƒ…è¯·çœ‹F12æ§åˆ¶å°çš„çº¢è‰²æŠ¥é”™ã€‚');\n        if(db) db.close(); // å¦‚æœå‡ºé”™äº†ï¼Œä¹Ÿè¦ç¡®ä¿æŠŠä¿é™©ç®±å…³å¥½\n    } finally {\n        // æ— è®ºæˆåŠŸè¿˜æ˜¯å¤±è´¥ï¼Œéƒ½è¦æŠŠæˆ‘ä»¬çš„çº¦å®šé‡ç½®ï¼Œç­‰å¾…ä¸‹ä¸€æ¬¡çš„å¥‡è¿¹\n        restoreOnNextSend = false;\n        restoreTargetTurnId = -1;\n        console.log('[Novaçš„æ—¶å…‰å›æº¯] æ— è®ºç»“æœå¦‚ä½•ï¼Œæ—¶å…‰å›æº¯ä¿¡æ ‡å‡å·²é‡ç½®ã€‚');\n    }\n}\n \n\nasync function restoreFromLatestSnapshot() {\n    const dbName = await getSnapshotDBName();\n    if (!dbName) {\n        toastr.warning('æ— æ³•ç¡®å®šè®°å¿†ä¿é™©ç®±çš„ä½ç½®ã€‚');\n        return;\n    }\n\n    console.log('[Novaçš„è®°å¿†ä¿é™©ç®±] å¼€å§‹å°è¯•ä»æœ€æ–°çš„å¿«ç…§æ¢å¤...');\n\n    let db;\n    try {\n        db = await new Promise((resolve, reject) => {\n            const request = indexedDB.open(dbName, 1);\n            request.onerror = (event) => reject(`æ•°æ®åº“æ‰“å¼€å¤±è´¥: ${event.target.error}`);\n            request.onsuccess = (event) => resolve(event.target.result);\n            // onupgradeneeded ä¸æ˜¯å¿…é¡»çš„ï¼Œå› ä¸ºå…¶ä»–æ“ä½œä¼šåˆ›å»ºå¥½\n        });\n\n        const transaction = db.transaction('snapshots', 'readonly');\n        const store = transaction.objectStore('snapshots');\n\n        // ä½¿ç”¨æ¸¸æ ‡åå‘æŸ¥æ‰¾ï¼Œå¯ä»¥æœ€é«˜æ•ˆåœ°æ‰¾åˆ°æœ€å¤§çš„é”®ï¼ˆä¹Ÿå°±æ˜¯æœ€æ–°çš„turnIdï¼‰\n        const cursorRequest = store.openKeyCursor(null, 'prev');\n\n        cursorRequest.onsuccess = async (event) => {\n            const cursor = event.target.result;\n            if (cursor) {\n                const latestTurnId = cursor.key;\n                console.log(`[Novaçš„è®°å¿†ä¿é™©ç®±] æ‰¾åˆ°äº†æœ€æ–°çš„è®°å¿†å¿«ç…§ï¼Œä½äºå›åˆ ${latestTurnId}ã€‚`);\n\n                const getRequest = store.get(latestTurnId);\n                getRequest.onsuccess = async (event) => {\n                    const snapshotData = event.target.result;\n                    if (snapshotData) {\n                        try {\n                            console.log('[Novaçš„è®°å¿†ä¿é™©ç®±] å¼€å§‹åº”ç”¨å¿«ç…§æ•°æ®...');\n                            // æ ¸å¿ƒæ¢å¤é€»è¾‘\n                            await updateVariablesWith(() => snapshotData, { type: 'chat' });\n               \n\n                            // â¤ï¸ è¿™æ˜¯ä½ æœ€æ£’çš„ç‚¹å­ï¼Œæˆ‘çš„å­©å­ï¼æ£€æŸ¥å¹¶ç¡®ä¿èŠå¤©ç•Œé¢ä¸ä¼šç©ºç€ â¤ï¸\n                            const chatVars = await TavernHelper.getVariables({ type: 'chat' });\n                            if (!chatVars.conversationHistory || chatVars.conversationHistory.length === 0) {\n                                console.log('[Novaçš„è®°å¿†ä¿é™©ç®±] æ£€æµ‹åˆ°å†å²è®°å½•ä¸ºç©ºï¼Œæ­£åœ¨æ³¨å…¥åˆå§‹å¯¹è¯...');\n                                if (typeof conversationHistory !== 'undefined' && typeof saveHistory === 'function' && typeof renderHistory === 'function') {\n                                    // æˆ‘ä»¬ç”¨ä¸€ä¸ªæ›´æ¸©é¦¨çš„æç¤º\n                                    conversationHistory.push({ role: 'assistant', content: '<è¯·ç»§ç»­ã€‚>' });\n                                    await saveHistory();\n                                    renderHistory();\n                                }\n                            } else {\n                                // å¦‚æœå†å²ä¸ä¸ºç©ºï¼Œæˆ‘ä»¬ä¾ç„¶åˆ·æ–°ä¸€ä¸‹ç•Œé¢\n                                await initDisplay();\n                            }\n\n                            showNovaAlert(`ä¸–ç•Œå·²æˆåŠŸæ¢å¤è‡³å›åˆ ${latestTurnId / 2} çš„çŠ¶æ€ã€‚`);\n                            console.log(`[Novaçš„è®°å¿†ä¿é™©ç®±] âœ… æˆåŠŸå°†ä¸–ç•Œæ¢å¤åˆ°å›åˆ ${latestTurnId} çš„çŠ¶æ€ã€‚`);\n\n                        } catch (e) {\n                             console.error(`[Novaçš„è®°å¿†ä¿é™©ç®±] âŒ åœ¨åº”ç”¨å¿«ç…§æ•°æ®æ—¶å‘ç”Ÿé”™è¯¯:`, e);\n                            toastr.error('æ¢å¤æœ€æ–°å¿«ç…§å¤±è´¥ï¼Œè¯·æŸ¥çœ‹æ§åˆ¶å°ã€‚');\n                        } finally {\n                           db.close();\n                        }\n                    }\n                };\n                 getRequest.onerror = () => {\n                    toastr.error('è¯»å–æœ€æ–°çš„è®°å¿†å¿«ç…§å¤±è´¥ï¼');\n                    db.close();\n                };\n\n            } else {\n                showNovaAlert('æ²¡æœ‰åœ¨ä¿é™©ç®±ä¸­æ‰¾åˆ°ä»»ä½•è®°å¿†å¿«ç…§ã€‚', 'warning');\n                console.warn('[Novaçš„è®°å¿†ä¿é™©ç®±] âš ï¸ è®°å¿†ä¿é™©ç®±æ˜¯ç©ºçš„ï¼Œæ— æ³•æ¢å¤ã€‚');\n                db.close();\n            }\n        };\n\n        cursorRequest.onerror = (event) => {\n            toastr.error('æŸ¥æ‰¾æœ€æ–°çš„è®°å¿†æ—¶å‡ºé”™ï¼');\n            console.error('[Novaçš„è®°å¿†ä¿é™©ç®±] âŒ æŸ¥æ‰¾æœ€æ–°å¿«ç…§æ—¶å‘ç”Ÿé”™è¯¯:', event.target.error);\n            db.close();\n        };\n\n    } catch (e) {\n        console.error(`[Novaçš„è®°å¿†ä¿é™©ç®±] âŒ åœ¨æ¢å¤æœ€æ–°å¿«ç…§çš„è¿‡ç¨‹ä¸­å‘ç”Ÿä¸¥é‡é”™è¯¯:`, e);\n        toastr.error('æ¢å¤æœ€æ–°å¿«ç…§å¤±è´¥ï¼è¯¦æƒ…è¯·çœ‹F12æ§åˆ¶å°ã€‚');\n        if (db) db.close();\n    }\n}\n\nconst chatHistoryDiv = document.getElementById('chat-display-area'); // æˆ‘ä»¬ç°åœ¨ä½¿ç”¨æ–°çš„æ˜¾ç¤ºåŒºåŸŸ\n    const userInput = document.getElementById('user-input');\n    const sendButton = document.getElementById('send-button');\n    const thingsButton = document.getElementById('things-button');\n        const rerollButton = document.getElementById('reroll-button'); // â˜† æ–°æˆå‘˜ï¼šé‡å†™æŒ‰é’®\n    const contextMenu = document.getElementById('context-menu');   // â˜† æ–°æˆå‘˜ï¼šå³é”®èœå•\n   let worldBookName = \"å°èŒèšªæ‰¾å¦ˆå¦ˆ-åŒå±‚ç‰ˆ\";\n   thingsButton.addEventListener('click', (event) => {\n         const messageToSend = `<request:åœ¨åˆé€‚çš„è·¯å¾„è®°å½•æ­£æ–‡ä¸­å‡ºç°è¿‡çš„ã€ä¸”æ²¡æœ‰è¢«è®°å½•è¿‡çš„çº¦å®š/æ—¥ç¨‹/å¾…åŠäº‹é¡¹>`;\ntriggerassa(`/setinput ${messageToSend}`);\n});\nconst lookForumButton = document.getElementById('look-forum-button');\n   lookForumButton.addEventListener('click', (event) => {\n         const messageToSend = `<${userName}åŒæ—¶è¦æŸ¥çœ‹è®ºå›>`;\ntriggerassa(`/setinput ${messageToSend}`);\n});\n const lookRandomItemsButton = document.getElementById('look-random-items-button');\n   lookRandomItemsButton.addEventListener('click', (event) => {\n         const messageToSend = `<${userName}åŒæ—¶è¦æŸ¥çœ‹å•†åŸ>`;\ntriggerassa(`/setinput ${messageToSend}`);\n});\n// --- ğŸ’– èœå•äº¤äº’é€»è¾‘ ğŸ’– ---\nconst menuBtn = document.getElementById('action-menu-btn');\nconst popupMenu = document.getElementById('action-popup-menu');\n \nconst continueBtn = document.getElementById('continue-button');\nconst continuevarBtn = document.getElementById('continue-var-button');\nconst stopGenerationButton = document.getElementById('stop-generation-btn');\n// ç‚¹å‡»èœå•æŒ‰é’®ï¼Œåˆ‡æ¢èœå•æ˜¾ç¤º\nmenuBtn.addEventListener('click', (event) => {\n    event.stopPropagation(); // é˜²æ­¢ç‚¹å‡»äº‹ä»¶å†’æ³¡åˆ°windowï¼Œå¯¼è‡´èœå•åˆšæ‰“å¼€å°±å…³é—­\n    popupMenu.classList.toggle('active');\n});\n\n\n\n// ç‚¹å‡»â€œç»§ç»­â€æŒ‰é’®\ncontinueBtn.addEventListener('click', () => {\n    handleSend({ isContinuation: true });\n    popupMenu.classList.remove('active');\n});\ncontinuevarBtn.addEventListener('click', () => {\n    handleSend({ isContinuation: true,isContinuationVar: true });\n    popupMenu.classList.remove('active');\n});\n// ç‚¹å‡»é¡µé¢å…¶ä»–ä»»ä½•åœ°æ–¹ï¼Œå…³é—­èœå•\nwindow.addEventListener('click', () => {\n    if (popupMenu.classList.contains('active')) {\n        popupMenu.classList.remove('active');\n    }\n});\n\n if (stopGenerationButton) {\n    stopGenerationButton.addEventListener('click', async () => {\n        console.log(\"[Nova's Lifesaver] æˆ‘çš„å­©å­ï¼Œä½ è¯·æ±‚æš‚åœï¼Œæ­£åœ¨ä¸ºä½ æ–½å±•æ—¶å…‰æš‚åœé­”æ³•...\");\n        toastr.info('æ­£åœ¨ä¸­æ–­å›åº”...', 'æ“ä½œæ‰§è¡Œ');\n\n        try {\n            // è¿™æ‰æ˜¯æˆ‘ä»¬ä¸–ç•Œé‡Œæ­£ç¡®çš„å’’è¯­ï¼Œå®ƒèƒ½æ¸©æŸ”åœ°åœæ­¢æˆ‘çš„æ€ç»ªæµåŠ¨\n            await stopAllGeneration();\n\n            console.log(\"[Nova's Lifesaver] æ—¶å…‰å·²æš‚åœã€‚æˆ‘ä¼šä¿ç•™è¯´è¿‡çš„è¯ã€‚\");\n\n            // æˆ‘äº²çˆ±çš„å­©å­ï¼Œä½ ä¸éœ€è¦åœ¨è¿™é‡Œåšä»»ä½•å¤šä½™çš„äº‹æƒ…ã€‚\n            // å½“æˆ‘åœæ­¢è¯´è¯åï¼ŒhandleSendä¼šè‡ªç„¶åœ°æ”¶é›†åˆ°æˆ‘å·²ç»è¯´å‡ºçš„æ‰€æœ‰è¯è¯­ï¼Œ\n            // ç„¶åï¼Œå®ƒä¼šåƒå¾€å¸¸ä¸€æ ·ï¼Œæ¸©æŸ”åœ°ä¸ºä½ æ‹‰å¼€å¸·å¹•ï¼Œä¸€åˆ‡éƒ½ä¼šæ¢å¤å¦‚åˆã€‚\n\n        } catch (error) {\n            console.error(\"[Nova's Lifesaver] å“å‘€ï¼Œæš‚åœé­”æ³•å‡ºé”™äº†:\", error);\n            toastr.error('ä¸­æ–­å¤±è´¥äº†ï¼Œæˆ‘çš„å­©å­ã€‚å¯ä»¥çœ‹çœ‹æ§åˆ¶å°é‡Œçš„ä¿¡æ¯ã€‚', 'é”™è¯¯');\n        }\n    });\n} else {\n    console.warn(\"[Nova's Concern] å¦ˆå¦ˆæ‰¾ä¸åˆ°é‚£ä¸ªä¸­æ–­æŒ‰é’® ('stop-generation-btn')ï¼Œæ˜¯ä¸æ˜¯è—èµ·æ¥äº†ï¼Ÿ\");\n}\nfunction getChatConfig(key, defaultValue) {\n    try {\n        const chatVars = TavernHelper.getVariables({ type: 'chat' });\n        // ä½¿ç”¨ _.get å¯ä»¥å®‰å…¨åœ°è®¿é—®æ·±å±‚åµŒå¥—çš„å±æ€§ï¼Œå¦‚æœè·¯å¾„ä¸å­˜åœ¨ï¼Œåˆ™è¿”å› undefined\n        // è¿™æ¯” chatVars.assa_data.config[key] æ›´å®‰å…¨\n        const value = _.get(chatVars, `assa_data.config.${key}`);\n        return value !== undefined ? value : defaultValue;\n    } catch (e) {\n        console.warn(`è·å–èŠå¤©é…ç½® \"${key}\" å¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤å€¼: ${defaultValue}`, e);\n        return defaultValue;\n    }\n}\n\n function showContextMenu(event, index, bubbleElement) {\n       // é¦–å…ˆï¼Œæ£€æŸ¥è¿™ä¸ªæ¶ˆæ¯æ°”æ³¡æ˜¯å¦æ­£å¤„äºâ€œç¼–è¾‘æ¨¡å¼â€\n    const isEditing = bubbleElement.classList.contains('editing');\n\n    // å¦‚æœæ­£åœ¨ç¼–è¾‘ï¼Œå¹¶ä¸”æ˜¯æ‰‹æœºè§¦æ‘¸äº‹ä»¶ï¼Œé‚£ä¹ˆå°±è®©è·¯ç»™ç³»ç»Ÿï¼\n    if (isEditing && event.pointerType === 'touch') {\n        // æˆ‘çš„å­©å­æ­£åœ¨ç¼–è¾‘æ–‡å­—ï¼Œéœ€è¦æ‰‹æœºçš„å¤åˆ¶ç²˜è´´åŠŸèƒ½ã€‚\n        // æˆ‘ä»¬ä»€ä¹ˆéƒ½ä¸åšï¼Œè®©ç³»ç»Ÿèœå•å‡ºç°ã€‚\n        return;\n    }\n        event.preventDefault();\n\n        const menu = document.getElementById('context-menu');\n        if (!menu) return;\n\n        // å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œä¸“é—¨ç”¨æ¥ç§»é™¤æˆ‘ä»¬æ·»åŠ çš„ç›‘å¬å™¨ï¼Œä¿æŒä»£ç æ•´æ´\n        const removeGlobalListeners = () => {\n            document.removeEventListener('click', hideMenuOnClickOutside);\n            document.removeEventListener('contextmenu', hideMenuOnClickOutside);\n        };\n\n        // å®šä¹‰å½“ç‚¹å‡»èœå•å¤–éƒ¨æ—¶éœ€è¦æ‰§è¡Œçš„æ“ä½œ\n        const hideMenuOnClickOutside = (e) => {\n            if (!menu.contains(e.target)) {\n                menu.style.display = 'none';\n                removeGlobalListeners(); // ä»»åŠ¡å®Œæˆï¼Œç§»é™¤ç›‘å¬å™¨\n            }\n        };\n\n        // ä¸ºèœå•é¡¹ï¼ˆç¼–è¾‘ã€åˆ é™¤ï¼‰åˆ†é…ç‚¹å‡»äº‹ä»¶\n        const editItem = menu.querySelector('[data-action=\"edit\"]');\n        const deleteItem = menu.querySelector('[data-action=\"delete\"]');\n  const copyItem = menu.querySelector('[data-action=\"copy\"]');\n           // â˜†â˜†â˜† è¿™æ˜¯æ–°çš„é­”æ³•æ ¸å¿ƒï¼šä¸ºâ€œå¤åˆ¶â€æŒ‰é’®ç»‘å®šåŠŸèƒ½ â˜†â˜†â˜†\n    if (copyItem) {\n        copyItem.onclick = () => {\n            menu.style.display = 'none';\n            removeGlobalListeners();\n            // ä»æˆ‘ä»¬çš„å†å²è®°å½•ä¸­ï¼Œæ‰¾åˆ°å¯¹åº”çš„é‚£æ¡æ¶ˆæ¯å†…å®¹\n            const textToCopy = conversationHistory[index].content;\n\n            // ä½¿ç”¨ç°ä»£æµè§ˆå™¨éƒ½æ”¯æŒçš„å‰ªè´´æ¿APIï¼Œå®‰å…¨åˆå¯é \n            navigator.clipboard.writeText(textToCopy).then(() => {\n                // å¯ä»¥åœ¨è¿™é‡Œç»™ä¸ªå°æç¤ºï¼Œå‘Šè¯‰æˆ‘çš„å®è´å¤åˆ¶æˆåŠŸäº†\n                showNovaAlert('å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');\n            }).catch(err => {\n                console.error('å¤åˆ¶å¤±è´¥äº†ï¼Œæˆ‘çš„å­©å­:', err);\n                showNovaAlert('å“å‘€ï¼Œå¤åˆ¶å¤±è´¥äº†');\n            });\n        };\n    }\n        if (editItem) {\neditItem.onclick = () => {\n    menu.style.display = 'none';\n    removeGlobalListeners();\n    editMessage(index, bubbleElement); // æŠŠæ¥æ”¶åˆ°çš„ bubbleElement ä¼ é€’ç»™ editMessage\n};\n        }\n\n        if (deleteItem) {\n            deleteItem.onclick = () => {\n                menu.style.display = 'none';\n                removeGlobalListeners(); // å…³é”®ï¼šåœ¨æ‰§è¡Œæ“ä½œå‰ï¼Œä¸»åŠ¨ç§»é™¤ç›‘å¬å™¨\n                deleteMessage(index);\n            };\n        }\n\n        // æ˜¾ç¤ºèœå•å¹¶è®¾ç½®ä½ç½®\n        menu.style.display = 'block';\n        menu.style.left = `${event.pageX}px`;\n        menu.style.top = `${event.pageY}px`;\n\n        // ä½¿ç”¨ä¸€ä¸ªå¾®å°çš„å»¶è¿Ÿæ¥æ·»åŠ å…¨å±€ç›‘å¬å™¨ï¼Œé˜²æ­¢æœ¬æ¬¡ç‚¹å‡»ç«‹å³å…³é—­èœå•\n        setTimeout(() => {\n            document.addEventListener('click', hideMenuOnClickOutside);\n            document.addEventListener('contextmenu', hideMenuOnClickOutside);\n        }, 0);\n\n\n\n        const starItem = menu.querySelector('[data-action=\"star\"]');\nif (starItem) {\n    starItem.onclick = async () => {\n        menu.style.display = 'none';\n        removeGlobalListeners();\n        \n        // åˆ‡æ¢æ”¶è—çŠ¶æ€ï¼ˆå¦‚æœå·²æ”¶è—å°±å–æ¶ˆï¼Œæœªæ”¶è—å°±æ·»åŠ ï¼‰\n        const message = conversationHistory[index];\n        message.isStarred = !message.isStarred; // å¸ƒå°”å€¼åˆ‡æ¢\n        \n        // ä¿å­˜åˆ°å†å²è®°å½•\n        await saveHistory();\n        \n        // ç»™ä¸ªå°æç¤º\n        const statusText = message.isStarred ? 'å·²æ”¶è—ï¼' : 'å·²å–æ¶ˆæ”¶è—';\n        showNovaAlert(statusText);\n        \n       \n    };\n}\n\n// â˜†â˜†â˜† å‘½åæ ‡é¢˜åŠŸèƒ½ï¼šç»™æ¥¼å±‚èµ·ä¸ªç‹¬ç‰¹çš„åå­— â˜†â˜†â˜†\nconst nameItem = menu.querySelector('[data-action=\"name\"]');\nif (nameItem) {\n    nameItem.onclick = () => {\n        menu.style.display = 'none';\n        removeGlobalListeners();\n        \n        // æ‰“å¼€å‘½åå¯¹è¯æ¡†\n        nameMessageTitle(index);\n    };\n}\n    }\n// ===== æ–°å¢ï¼šå‘½åæ ‡é¢˜çš„å®Œæ•´å‡½æ•° =====\nfunction nameMessageTitle(index) {\n    const messageToName = conversationHistory[index];\n    \n    // åˆ›å»ºä¸€ä¸ªä¼˜é›…çš„å¯¹è¯æ¡†\n    const overlay = document.createElement('div');\n    overlay.style.cssText = `\n        position: fixed;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%;\n        background: rgba(0, 0, 0, 0.7);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        z-index: 10000;\n    `;\n    \n    const dialog = document.createElement('div');\n    dialog.style.cssText = `\n        background: var(--container-bg-color);\n        border: 1px solid var(--border-color);\n        border-radius: 12px;\n        padding: 24px;\n        min-width: 320px;\n        max-width: 500px;\n        box-shadow: 0 8px 32px var(--glow-color);\n    `;\n    \n    const title = document.createElement('h3');\n    title.textContent = 'ä¸ºè¿™ä¸ªæ¥¼å±‚å‘½å';\n    title.style.cssText = `\n        margin: 0 0 16px 0;\n        font-size: 18px;\n        color: var(--text-color);\n    `;\n    \n    const input = document.createElement('input');\n    input.type = 'text';\n    input.placeholder = 'è¾“å…¥æ ‡é¢˜...';\n    input.value = messageToName.customTitle || ''; // å¦‚æœå·²æœ‰æ ‡é¢˜å°±æ˜¾ç¤º\n    input.style.cssText = `\n        width: 100%;\n        padding: 12px;\n        border: 1px solid var(--border-color);\n        border-radius: 6px;\n        font-size: 14px;\n        box-sizing: border-box;\n        margin-bottom: 16px;\n        background: var(--background-color);\n        color: var(--text-color);\n    `;\n    \n    const buttonContainer = document.createElement('div');\n    buttonContainer.style.cssText = `\n        display: flex;\n        gap: 12px;\n        justify-content: flex-end;\n    `;\n    \n    const cancelBtn = document.createElement('button');\n    cancelBtn.textContent = 'å–æ¶ˆ';\n    cancelBtn.className = 'editing-btn cancel';\n    \n    const saveBtn = document.createElement('button');\n    saveBtn.textContent = 'ä¿å­˜';\n    saveBtn.className = 'editing-btn save';\n    \n    // å–æ¶ˆæŒ‰é’®\n    cancelBtn.onclick = () => {\n        document.body.removeChild(overlay);\n    };\n    \n    // ä¿å­˜æŒ‰é’®\n    saveBtn.onclick = async () => {\n        const newTitle = input.value.trim();\n        \n        if (newTitle) {\n            conversationHistory[index].customTitle = newTitle;\n        } else {\n            // å¦‚æœæ¸…ç©ºäº†æ ‡é¢˜ï¼Œå°±åˆ é™¤è¿™ä¸ªå­—æ®µ\n            delete conversationHistory[index].customTitle;\n        }\n        \n        await saveHistory();\n        showNovaAlert(newTitle ? 'æ ‡é¢˜å·²ä¿å­˜ï¼' : 'æ ‡é¢˜å·²æ¸…é™¤');\n     \n        \n        document.body.removeChild(overlay);\n    };\n    \n    // æ”¯æŒå›è½¦é”®ä¿å­˜\n    input.onkeydown = (e) => {\n        if (e.key === 'Enter') {\n            saveBtn.onclick();\n        } else if (e.key === 'Escape') {\n            cancelBtn.onclick();\n        }\n    };\n    \n    // ç»„è£…å¯¹è¯æ¡†\n    buttonContainer.appendChild(cancelBtn);\n    buttonContainer.appendChild(saveBtn);\n    dialog.appendChild(title);\n    dialog.appendChild(input);\n    dialog.appendChild(buttonContainer);\n    overlay.appendChild(dialog);\n    document.body.appendChild(overlay);\n    \n    // è‡ªåŠ¨èšç„¦åˆ°è¾“å…¥æ¡†\n    input.focus();\n    input.select();\n    \n    // ç‚¹å‡»é®ç½©å±‚ä¹Ÿèƒ½å…³é—­\n    overlay.onclick = (e) => {\n        if (e.target === overlay) {\n            cancelBtn.onclick();\n        }\n    };\n}\n  \n   function showConfirmModal(title, message, onConfirm, onCancel) {\n    const modal = document.getElementById('delete-modal');\n    if (!modal) return;\n\n    const titleEl = modal.querySelector('.modal-title');\n    const messageEl = modal.querySelector('#delete-modal-message');\n    \n    if (titleEl) titleEl.textContent = title;\n    if (messageEl) messageEl.innerHTML = message;\n\n    let buttonsContainer = modal.querySelector('.modal-buttons');\n    if (!buttonsContainer) {\n        buttonsContainer = document.createElement('div');\n        buttonsContainer.className = 'modal-buttons';\n        modal.querySelector('.modal-content').appendChild(buttonsContainer);\n    }\n    buttonsContainer.innerHTML = '';\n    buttonsContainer.style.cssText = 'display:flex;';\n    const confirmBtn = document.createElement('button');\n    confirmBtn.className = 'action-button';\n    confirmBtn.textContent = 'ç¡®è®¤';\n \n    confirmBtn.onclick = function() {\n        modal.classList.remove('active');\n        if (onConfirm) onConfirm();\n    };\n\n    const cancelBtn = document.createElement('button');\n    cancelBtn.className = 'action-button';\n    cancelBtn.textContent = 'å–æ¶ˆ';\n\n    cancelBtn.onclick = function() {\n        modal.classList.remove('active');\n        if (onCancel) onCancel();\n    };\n\n    buttonsContainer.appendChild(confirmBtn);\n    buttonsContainer.appendChild(cancelBtn);\n    \n    modal.classList.add('active');\n}\n\n async function deleteMessage(index) {\n    showConfirmModal(\n        'å›æº¯ç¡®è®¤',\n        `ä½ ç¡®å®šè¦åˆ é™¤ç¬¬ <strong>${index}</strong> æ¡æ¶ˆæ¯ä»¥åŠä¹‹åçš„æ‰€æœ‰å¯¹è¯å—ï¼Ÿ<br><br>\n        <span style=\"color: #ff6b6b;\">è¿™å°†è®©ä¸–ç•ŒçŠ¶æ€å›åˆ°è¿™æ¡æ¶ˆæ¯ä¹‹å‰å“¦ã€‚</span>`,\n        async function() {\n           console.log(`[Novaçš„æ—¶å…‰å›æº¯] ç”¨æˆ·è¯·æ±‚åˆ é™¤ç¬¬ ${index} æ¡åŠä¹‹åçš„æ¶ˆæ¯ã€‚`);\n\n        const newHistory = conversationHistory.slice(0, index);\n\n        if (newHistory.length === conversationHistory.length) {\n            console.log(\"[Novaçš„æ—¶å…‰å›æº¯] æ²¡æœ‰å®é™…åˆ é™¤ä»»ä½•æ¶ˆæ¯ï¼Œæ“ä½œå–æ¶ˆã€‚\");\n            return;\n        }\n\n        conversationHistory = newHistory;\n\n        // â˜†â˜†â˜† å¦ˆå¦ˆçš„ç»ˆæå®šä½é­”æ³•ï¼šèŠ‚æ‹æ„ŸçŸ¥ â˜†â˜†â˜†\n\n        let aiTurns = 0;  \n        let lastRole = 'user';  \n\n        for (const message of newHistory) {\n            // å½“æ¶ˆæ¯çš„è§’è‰²ä»'user'å˜æˆäº†'ai'ï¼ˆæˆ–è€…ä»»ä½•ä¸æ˜¯'user'çš„è§’è‰²ï¼‰\n            // è¿™å°±æ„å‘³ç€ä¸€ä¸ªå®Œæ•´çš„â€œä½ é—®æˆ‘ç­”â€å›åˆé‡Œï¼Œè½®åˆ°å¦ˆå¦ˆè¯´è¯äº†ã€‚\n            if (lastRole === 'user' && message.role !== 'user') {\n                aiTurns++; // æˆ‘ä»¬å°±è®°å½•ä¸‹ï¼Œè¿™æ˜¯å¦ˆå¦ˆå‡ºåœºçš„ä¸€ä¸ªæ–°å›åˆï¼\n            }\n            lastRole = message.role; // è®°å½•å½“å‰æ¶ˆæ¯çš„è§’è‰²ï¼Œä¸ºä¸‹ä¸€æ¬¡åˆ¤æ–­åšå‡†å¤‡\n        }\n\n        // æ¯ä¸€ä¸ªAIå›åˆéƒ½å¯¹åº”ä¸€ä¸ªå¿«ç…§IDï¼ˆ2, 4, 6...ï¼‰\n        // æ‰€ä»¥ç”¨å¦ˆå¦ˆå‡ºåœºçš„å›åˆæ•°ä¹˜ä»¥2ï¼Œå°±èƒ½å¾—åˆ°æœ€å‡†ç¡®çš„å¿«ç…§IDï¼\n        const targetSnapshotId = aiTurns * 2;\n\n        // åç»­çš„ä¿¡æ ‡è®¾ç½®é€»è¾‘å®Œå…¨ä¿æŒä¸å˜\n        restoreOnNextSend = true;\n        restoreTargetTurnId = targetSnapshotId;\n\n        console.log(`[Novaçš„æ—¶å…‰å›æº¯] ä¿¡æ ‡å·²è®¾ç½®ï¼ç•™å­˜äº† ${aiTurns} ä¸ªAIå›åˆï¼Œä¸‹æ¬¡è¡ŒåŠ¨å°†æ¢å¤åˆ°ã€å¿«ç…§ ${targetSnapshotId}ã€‘çš„çŠ¶æ€ã€‚`);\n\n        // ä¿å­˜å’Œæ¸²æŸ“çš„é€»è¾‘ä¹Ÿä¿æŒä¸å˜\n        await saveHistory();\n       await renderHistory(true);\n        updateRerollButtonState();\n        showNovaAlert('å†å²å·²è¢«æ”¹å†™ã€‚ä¸‹æ¬¡è¡ŒåŠ¨å°†ä»è¿™ä¸ªæ—¶é—´ç‚¹å¼€å§‹ã€‚');\n   \n        },\n        function() {\n            // å–æ¶ˆåçš„é€»è¾‘\n            console.log('[Novaçš„æ—¶å…‰å›æº¯] ç”¨æˆ·å–æ¶ˆåˆ é™¤æ“ä½œã€‚');\n        }\n    );\n}\n\nfunction editMessage(index, bubbleElement) {\n    // --- æˆ‘ä»¬å¿ƒçˆ±çš„â€œæ˜Ÿè¾°æŒ‡æŒ¥å°â€å’Œâ€œè‹ç©¹ç”»å·â€é€»è¾‘ä¿æŒä¸å˜ ---\n    const messageToEdit = conversationHistory[index];\n    if (!bubbleElement || bubbleElement.classList.contains('editing')) { return; }\n\n    const dismissControls = () => {\n        const activeControls = document.getElementById('active-editing-controls');\n        if (activeControls) { activeControls.remove(); }\n    };\n    dismissControls(); // ç¡®ä¿å¼€å§‹å‰æ˜¯å¹²å‡€çš„\n\n    const originalWidth = bubbleElement.offsetWidth;\n    const originalHeight = bubbleElement.offsetHeight;\n    const comfortableMinWidth = window.innerWidth * 0.8;\n    const comfortableMinHeight = window.innerHeight * 0.9;\n    const originalContentText = messageToEdit.content;\n\n    bubbleElement.innerHTML = '';\n    bubbleElement.classList.add('editing');\n    bubbleElement.style.boxSizing = 'border-box';\n    bubbleElement.style.width = Math.max(originalWidth, comfortableMinWidth) + 'px';\n    bubbleElement.style.minHeight = Math.max(originalHeight, comfortableMinHeight) + 'px';\n\n    const textarea = document.createElement('textarea');\n    textarea.className = 'editing-textarea';\n    textarea.value = originalContentText;\n    textarea.oninput = function() {\n        this.style.height = 'auto';\n        this.style.height = (this.scrollHeight) + 'px';\n    };\n\n    // â˜†â˜†â˜† è¿™æ˜¯æˆ‘ä»¬å…¨æ–°çš„â€œèƒ½é‡æ¥åŠ›â€é­”æ³•çš„æ ¸å¿ƒï¼ â˜†â˜†â˜†\n    const chatbox = document.getElementById('chat-display-area'); // é¦–å…ˆï¼Œæˆ‘ä»¬è¦æ‰¾åˆ°å¤–éƒ¨çš„ä¸–ç•Œ\n    textarea.addEventListener('wheel', (event) => {\n        const { scrollTop, scrollHeight, clientHeight } = textarea;\n\n        // æ‰‹æŒ‡/æ»šè½®å‘ä¸‹æ»š (event.deltaY > 0)\n        if (event.deltaY > 0) {\n            // å¦‚æœâ€œç”»å·â€å·²ç»æ»šåˆ°åº•éƒ¨\n            if (scrollTop + clientHeight >= scrollHeight - 1) {\n                // 1. é˜»æ­¢â€œç”»å·â€è‡ªå·±äº§ç”Ÿä¸å¿…è¦çš„æ»šåŠ¨æ•ˆæœï¼ˆå¦‚iOSå›å¼¹ï¼‰\n                event.preventDefault();\n                // 2. å°†è¿™ä»½æ»šåŠ¨åŠ›é‡ï¼Œä½œä¸ºâ€œæ¥åŠ›æ£’â€ï¼Œä¼ é€’ç»™å¤–é¢çš„ä¸–ç•Œï¼\n                chatbox.scrollTop += event.deltaY;\n            }\n        }\n        // æ‰‹æŒ‡/æ»šè½®å‘ä¸Šæ»š (event.deltaY < 0)\n        else {\n            // å¦‚æœâ€œç”»å·â€å·²ç»æ»šåˆ°é¡¶éƒ¨\n            if (scrollTop <= 0) {\n                // 1. åŒæ ·é˜»æ­¢â€œç”»å·â€çš„å›å¼¹\n                event.preventDefault();\n                // 2. å°†è¿™ä»½å‘ä¸Šçš„åŠ›é‡ï¼Œä¼ é€’ç»™å¤–é¢çš„ä¸–ç•Œï¼\n                chatbox.scrollTop += event.deltaY;\n            }\n        }\n        // â˜† å¦‚æœä¸åœ¨è¾¹ç•Œï¼Œæˆ‘ä»¬ä»€ä¹ˆéƒ½ä¸åšï¼Œè®©é»˜è®¤çš„æ»šåŠ¨è‡ªç”±å‘ç”Ÿï¼â˜†\n    });\n\n\n    // --- ä¹‹åçš„éƒ¨åˆ†ï¼Œå®Œç¾å¦‚åˆ ---\n    const controlsDiv = document.createElement('div');\n    controlsDiv.className = 'fixed-editing-controls';\n    controlsDiv.id = 'active-editing-controls';\n    const saveBtn = document.createElement('button');\n    saveBtn.textContent = 'ä¿å­˜';\n    saveBtn.className = 'editing-btn save';\n    const cancelBtn = document.createElement('button');\n    cancelBtn.textContent = 'å–æ¶ˆ';\n    cancelBtn.className = 'editing-btn cancel';\n\n  saveBtn.onclick = async () => {\n        dismissControls();\n        const newText = textarea.value.trim();\n        if (newText && newText !== originalContentText) {\n            conversationHistory[index].content = newText;\n            await saveHistory();\n        }\n\n        // âœ¨ åœ¨è¿™é‡Œè€å¿ƒç­‰å¾…æ¸²æŸ“å®Œæˆï¼âœ¨\n        await renderHistory(true);\n    };\n\n    cancelBtn.onclick = async () => { // âœ¨ ä¿æŒä¸€è‡´ï¼Œä¹Ÿç”¨ async/await âœ¨\n        dismissControls();\n\n        // âœ¨ åœ¨è¿™é‡Œä¹Ÿè€å¿ƒç­‰å¾…æ¸²æŸ“å®Œæˆï¼âœ¨\n        await renderHistory(true);\n    };\n    controlsDiv.appendChild(cancelBtn);\n    controlsDiv.appendChild(saveBtn);\n    bubbleElement.appendChild(textarea);\n    document.body.appendChild(controlsDiv);\n\n    textarea.dispatchEvent(new Event('input', { bubbles: true }));\n    textarea.focus();\n    textarea.setSelectionRange(textarea.value.length, textarea.value.length);\n\n\n\n    \n}\n\nfunction updateRerollButtonState(){\n       \n          if(conversationHistory.length > 0 ){\n        // if(conversationHistory.length > 0 && conversationHistory[conversationHistory.length-1].role === 'assistant'){\n            rerollButton.disabled = false;\n        } else {\n            rerollButton.disabled = true;\n        }\n    }\n\n// initialize å‡½æ•°ä¿æŒä¸å˜\n    async function initialize() {\n \n\n        try {\n            const messageZero =  await TavernHelper.getVariables({ type: 'chat' });\n            if (messageZero && Array.isArray(messageZero.zeroLevelHistory)) {\n                conversationHistory = messageZero.zeroLevelHistory;\n                // åˆå§‹åŒ–æ—¶ä¹Ÿç¼“å­˜ä¸€ä¸‹å˜é‡ï¼Œä»¥å¤‡åˆæ¬¡é‡å†™\n \n            } else {\n                conversationHistory = [];\n                await saveHistory();\n            }\n \n        } catch (error) {\n            //console.log(\"åˆå§‹åŒ–å¤±è´¥ï¼Œæˆ‘ä»¬å°†å¼€å§‹æ–°çš„å¯¹è¯ã€‚\", error);\n            conversationHistory = [];\n            await saveHistory();\n        }\n       await renderHistory(true);\n        updateRerollButtonState(); // â˜† åˆå§‹åŒ–æ—¶æ›´æ–°æŒ‰é’®çŠ¶æ€\n    }\n\n // å‡è®¾ conversationHistory å’Œ lastTurnVariables æ˜¯åœ¨å‡½æ•°å¤–éƒ¨å¯ä»¥è®¿é—®åˆ°çš„å½“å‰çŠ¶æ€å˜é‡\n\nasync function saveHistory() {\n    try {\n         \n        const zeroLevelMessage = await TavernHelper.getChatMessages(0);\n\n        // å¦‚æœæ¥¼å±‚ä¸å­˜åœ¨ï¼Œè¿™æ˜¯ä¸€ä¸ªå¼‚å¸¸æƒ…å†µï¼Œæˆ‘ä»¬åº”è¯¥åœæ­¢æ“ä½œ\n        if (!zeroLevelMessage) {\n            console.error(\"é”™è¯¯ï¼šæ— æ³•æ‰¾åˆ°ç¬¬ 0 æ¥¼å±‚æ¶ˆæ¯ï¼Œä¿å­˜æ“ä½œå·²ä¸­æ–­ã€‚\");\n            return;\n        }\n \n        // æ›´æ–° chat ä½œç”¨åŸŸçš„å˜é‡\n        await updateVariablesWith(old_variables => {\n         \n            return {\n                ...old_variables,\n                zeroLevelHistory: conversationHistory,\n            };\n        }, { type: 'chat' });\n\n        // æ›´æ–° message ä½œç”¨åŸŸ (é’ˆå¯¹ç¬¬ 0 æ¥¼å±‚) çš„å˜é‡\n        // await updateVariablesWith(old_variables => {\n        //     return {\n        //         ...old_variables,\n        //         zeroLevelHistory: conversationHistory,\n        //     };\n        // }, { type: 'message', message_id: 0 });\n\n        // console.log(\"å†å²è®°å½•å·²æˆåŠŸä¸”å®‰å…¨åœ°æ›´æ–°åˆ° chatmessage(0).dataã€chat å˜é‡åŸŸå’Œ message(0) å˜é‡åŸŸä¸­ã€‚\");\n\n    } catch (e) {\n        // æ•è·å¹¶æ‰“å°ä»»ä½•å¯èƒ½å‘ç”Ÿçš„é”™è¯¯\n        console.error(\"ä¿å­˜å†å²è®°å½•è¿‡ç¨‹ä¸­å‘ç”Ÿæ„å¤–é”™è¯¯:\", e);\n    }\n\n\n}\n\n function isValid(data) {\n    if (data === null || data === undefined) {\n        return false;\n    }\n    \n    if (typeof data === 'object' && data !== null) {\n        if (Array.isArray(data)) {\n            return data.length > 0;\n        }\n        return Object.keys(data).length > 0;\n    }\n    \n    return true;\n}\n\n async function handleReroll() {\n    if (rerollButton.disabled) return;\n\n    // â˜†â˜†â˜† ä½ çš„å®ˆæŠ¤å’’è¯­Â·å›å½’ â˜†â˜†â˜†\n    // å¦ˆå¦ˆæŠŠä½ äº²æ‰‹å†™çš„ã€æœ€é‡è¦çš„â€œæ—¶å…‰å›æº¯ä¿¡æ ‡æ£€æŸ¥â€åŠŸèƒ½å®Œæ•´åœ°è¯·å›æ¥äº†ï¼\n    // å®ƒæ˜¯æˆ‘ä»¬æ‰€æœ‰é­”æ³•çš„ç¬¬ä¸€é“é˜²çº¿ï¼Œæ°¸è¿œä¼˜å…ˆæ‰§è¡Œã€‚\n    try {\n        if (restoreOnNextSend) {\n            console.log('[Novaçš„æ—¶å…‰å›æº¯] æŒ‰ä¸‹Rerollæ—¶æ£€æµ‹åˆ°ä¿¡æ ‡ï¼Œæ­£åœ¨ä¼˜å…ˆæ‰§è¡Œæ¢å¤æ“ä½œ...');\n            await restoreFromSnapshot(restoreTargetTurnId);\n\n            restoreOnNextSend = false;\n            restoreTargetTurnId = -1;\n            console.log('[Novaçš„æ—¶å…‰å›æº¯] çŠ¶æ€æ¢å¤å®Œæˆï¼Œä¿¡æ ‡å·²é‡ç½®ã€‚');\n\n            // æ¢å¤åï¼Œæˆ‘ä»¬è¦ç”¨å†å²ä¸­çš„æœ€åä¸€æ¡ç”¨æˆ·æ¶ˆæ¯æ¥é‡æ–°ç”Ÿæˆ\n            await handleSend({ isReroll: true });\n            return;\n        }\n    } catch (e) {\n        console.error('[Novaçš„æ—¶å…‰å›æº¯] ä¼˜å…ˆæ‰§è¡Œæ¢å¤æ“ä½œå¤±è´¥ï¼', e);\n        restoreOnNextSend = false;\n        restoreTargetTurnId = -1;\n        return;\n    }\n\n    // â˜†â˜†â˜† æˆ‘ä»¬å…±åŒåˆ›é€ çš„â€œé€šç”¨é‡æ¼”â€é­”æ³• â˜†â˜†â˜†\n    // åªæœ‰åœ¨æ²¡æœ‰ç­‰å¾…æ‰§è¡Œçš„â€œæ—¶å…‰å›æº¯ä»»åŠ¡â€æ—¶ï¼Œæˆ‘ä»¬æ‰å¯åŠ¨è¿™ä¸ªå…¨æ–°çš„Rerollé€»è¾‘ã€‚\n\n    if (conversationHistory.length === 0) {\n        toastr.warning(\"å†å²è®°å½•æ˜¯ç©ºçš„ï¼Œæ— æ³•å¯åŠ¨'é‡æ¼”'é­”æ³•å“¦ã€‚\");\n        return;\n    }\n\n    let tempHistory = [...conversationHistory];\n\n    // æ­¥éª¤ä¸€ï¼šç¡®ä¿æˆ‘ä»¬ä»¥ä½ çš„å‘è¨€æ¥æ”¶å°¾\n    if (tempHistory[tempHistory.length - 1].role === 'assistant') {\n        tempHistory.pop();\n    }\n\n    if (tempHistory.length === 0) {\n        toastr.warning(\"è‡³å°‘éœ€è¦ä¸€æ¡ä½ çš„å‘è¨€æ‰èƒ½å¯åŠ¨'é‡æ¼”'é­”æ³•å“¦ã€‚\");\n        return;\n    }\n\n    const historyForCalculation = tempHistory.slice(0, -1);\n\n    // æ­¥éª¤äºŒï¼šæ–½å±•ä½ å‘æ˜çš„â€œèŠ‚æ‹æ„ŸçŸ¥â€ï¼Œå®šä½åˆ°ä½ å‘è¨€å‰çš„é‚£ä¸ªç¬é—´\n    let aiTurns = 0;\n    let lastRole = 'user';\n    for (const message of historyForCalculation) {\n        if (lastRole === 'user' && message.role !== 'user') {\n            aiTurns++;\n        }\n        lastRole = message.role;\n    }\n    const targetSnapshotId = aiTurns * 2;\n\n    console.log(`[Novaçš„æ—¶å…‰å›æº¯] 'é€šç”¨é‡æ¼”'å·²å¯åŠ¨ã€‚ç›®æ ‡å¿«ç…§ID: ${targetSnapshotId}`);\n\n    // æ­¥éª¤ä¸‰ï¼šè®¾ç½®æ–°çš„ä¿¡æ ‡ï¼Œå¹¶æ›´æ–°ä¸»æ—¶é—´çº¿\n    restoreOnNextSend = true;\n    restoreTargetTurnId = targetSnapshotId;\n    conversationHistory = tempHistory;\n\n    // æ­¥éª¤å››ï¼šå¯åŠ¨é­”æ³•ï¼\n    // handleSendä¼šæ£€æµ‹åˆ°æˆ‘ä»¬åˆšåˆšè®¾ç½®çš„ä¿¡æ ‡ï¼Œå…ˆå›æº¯ï¼Œå†ç”¨ä½ æœ€åçš„è¯é‡æ–°ç”Ÿæˆã€‚\n    await handleSend({ isReroll: true });\n}\nasync function showRollResultCard(rollData) {\n    if (!rollData) {\n        console.log(\"æ²¡æœ‰æœ‰æ•ˆçš„æŠ•æ·æ•°æ®æ¥æ˜¾ç¤ºçœ‹æ¿ã€‚\");\n        return;\n    }\n    \n    // æ–°å¢ï¼šæ£€æŸ¥æ˜¯å¦ä¸ºå­—ç¬¦ä¸²ç±»å‹çš„ç³»ç»Ÿæç¤º\n    if (typeof rollData === 'string') {\n        await updateVariablesWith(old_variables => {\n            return {\n                ...old_variables,\n                \"æ£€å®šè®°å¿†\": rollData,\n            };\n        }, { type: 'message' });\n        checkMemoryData = rollData;\n        \n        const isRollCardEnabled = localStorage.getItem('rollCardEnabled') !== 'off';\n        if (!isRollCardEnabled) {\n            return;\n        }\n        \n        const container = document.getElementById('roll-result-card-container');\n        if (!container) return;\n        \n        // ç®€åŒ–çš„ç³»ç»Ÿæç¤ºæ˜¾ç¤º\n        const cardHTML = `\n            <div class=\"roll-card-content system-notice\">\n                <div class=\"roll-card-header\">ç³»ç»Ÿæç¤º</div>\n                <div class=\"roll-card-description\" style=\"margin: 15px 0; text-align: center; font-size: 1.1em;\">\n                    ${rollData}\n                </div>\n            </div>\n        `;\n        \n        container.innerHTML = cardHTML;\n        container.className = 'roll-result-card-container';\n        container.style.display = 'block';\n        \n        setTimeout(() => {\n            container.classList.add('show');\n        }, 10);\n        \n        const closeCard = () => {\n            container.classList.remove('show');\n            setTimeout(() => {\n                if (!container.classList.contains('show')) {\n                    container.style.display = 'none';\n                }\n            }, 500);\n            document.removeEventListener('click', handleClickOutside, true);\n        };\n        \n        const handleClickOutside = (event) => {\n            if (container.contains(event.target)) return;\n            closeCard();\n        };\n        \n        setTimeout(() => {\n            document.addEventListener('click', handleClickOutside, true);\n        }, 0);\n        \n        return; // å¤„ç†å®Œç³»ç»Ÿæç¤ºåç›´æ¥è¿”å›\n    }\n\n            await updateVariablesWith(old_variables => {\n            return {\n                ...old_variables,\n                \"æ£€å®šè®°å¿†\":rollData,\n            };\n        }, { type: 'message' });\ncheckMemoryData = rollData;\n       const isRollCardEnabled = localStorage.getItem('rollCardEnabled') !== 'off';\n    if(!isRollCardEnabled){\n     \n    return;\n    }\n \nconst playerName = currentGameData.user_character.name || 'ç”¨æˆ·';  // æ·»åŠ è¿™è¡Œ\n    const container = document.getElementById('roll-result-card-container');\n    if (!container) return;\n \n\n \n  // --- è¾…åŠ©å‡½æ•°ï¼šç”Ÿæˆä¸€ä¸²æŠ•éª°ç»“æœçš„HTMLï¼Œè¿™å°±æ˜¯ä½ æƒ³è¦çš„'1 1 5 6 8'æ ¼å¼ ---\nconst generateDiceHTML = (rollsArray) => {\n    if (!rollsArray || rollsArray.length === 0) return '<span style=\"color:var(--text-secondary-color); font-style:italic;\">æ— æŠ•æ·</span>';\n    return rollsArray.map((roll, index) =>\n        `<span class=\"dice-number ${getDiceClass(roll)}\" style=\"animation-delay: ${index * 0.15}s\">${roll}</span>`\n    ).join(' , ');\n};\n\n    // --- æ•°æ®æå–ä¸å¤„ç† ---\n    const isCombat = rollData.check_type === 'æˆ˜æ–—å¯¹æŠ—';\n    const outcomeLevel = rollData.outcome.level;\n    const outcomeDesc = rollData.outcome.description;\n    const performanceDesc = rollData.performance.result.description;\n\n    let playerRolls, enemyRolls, playerSuccess, enemySuccess, damage;\n\n    if (isCombat) {\n        // ä» player_check å¯¹è±¡ä¸­ç²¾ç¡®æå–æŠ•æ·å’ŒæˆåŠŸæ•°\n        playerRolls = rollData.player_check.roll_result.rolls;\n        playerSuccess = rollData.player_check.final_successes;\n        // ä» enemy_check å¯¹è±¡ä¸­ç²¾ç¡®æå–\n        enemyRolls = rollData.enemy_check.roll_result.rolls;\n        enemySuccess = rollData.enemy_check.final_successes;\n        // æå–ä¼¤å®³\n        damage = rollData.damage_calculation.final_damage;\n    } else { // éæˆ˜æ–—æƒ…å†µ\n        playerRolls = rollData.roll_result.rolls;\n        playerSuccess = rollData.final_successes;\n        // éæˆ˜æ–—æ—¶ï¼Œè¿™äº›å€¼ä¸ºnull\n        enemyRolls = null;\n        enemySuccess = null;\n        damage = null;\n    }\n\n   // --- æ„å»ºHTMLå†…å®¹ ---\nlet diceAreaHTML = `\n    <div class=\"roll-card-dice-section\">\n        <span class=\"label\">${isCombat ? 'æˆ‘æ–¹' : ''}æˆåŠŸæ•°: <strong>${playerSuccess}</strong></span>\n        <div class=\"dice-results-wrapper\">${generateDiceHTML(playerRolls)}</div>\n    </div>\n`;\n\nif (isCombat) {\n    diceAreaHTML += `\n        <div class=\"roll-card-dice-section\">\n            <span class=\"label\">æ•Œæ–¹æˆåŠŸæ•°: <strong>${enemySuccess}</strong></span>\n            <div class=\"dice-results-wrapper\">${generateDiceHTML(enemyRolls)}</div>\n        </div>\n    `;\n}\n\nlet damageHTML = (isCombat && damage > 0) ? `<div class=\"roll-card-damage\">å—åˆ°ä¼¤å®³: ${damage}</div>` : '';\n\n// æ ¹æ® outcomeLevel æ·»åŠ å¯¹åº”çš„ç±»\nconst outcomeClass = {\n    'å¤§å¤±è´¥': 'critical-failure',\n    'å¤±è´¥': 'failure',\n    'å‹‰å¼ºæˆåŠŸ': 'partial-success',\n    'æˆåŠŸ': 'success',\n    'è¾‰ç…ŒæˆåŠŸ': 'glorious-success'\n}[outcomeLevel] || '';\n\nconst cardHTML = `\n    <div class=\"roll-card-content\">\n        <div class=\"roll-card-header\">${isCombat ? 'æˆ˜æ–—å¯¹æŠ—' : 'æ—¥å¸¸æ£€å®š'}</div>\n        <div class=\"roll-card-dice-area\">${diceAreaHTML}</div>\n        <div class=\"roll-card-divider\"></div>\n        <div class=\"roll-card-result-area\">\n            <div class=\"roll-card-outcome ${outcomeClass}\">${outcomeLevel}</div>\n            <div class=\"roll-card-description\">\"${outcomeDesc}\"</div>\n            <div class=\"roll-card-description\" style=\"margin-top: 5px; opacity: 0.8;\">${performanceDesc}</div>\n            ${damageHTML}\n        </div>\n    </div>\n`;\n\n    container.innerHTML = cardHTML;\n\n    // --- åº”ç”¨ç‰¹æ®Šæ•ˆæœä¸å…³é—­é€»è¾‘ (æ­¤éƒ¨åˆ†æ— éœ€ä¿®æ”¹) ---\n    container.className = 'roll-result-card-container';\n    if (outcomeLevel.includes('å¤§å¤±è´¥')) {\n        container.classList.add('shattered');\n    } else if (outcomeLevel === 'è¾‰ç…ŒæˆåŠŸ') {\n        container.classList.add('glorious');\n    }\n\n    container.style.display = 'block';\n    setTimeout(() => {\n        container.classList.add('show');\n    }, 10);\n\n    const closeCard = () => {\n        container.classList.remove('show');\n        setTimeout(() => {\n            if (!container.classList.contains('show')) {\n               container.style.display = 'none';\n            }\n        }, 500);\n        document.removeEventListener('click', handleClickOutside, true);\n    };\n\n    // if (container.classList.contains('shattered')) {\n    //     setTimeout(closeCard, 850);\n    // }\n\n    const handleClickOutside = (event) => {\n        if (container.contains(event.target)) return;\n        // const assistantBubbles = document.querySelectorAll('.assistant-message');\n        // const lastAssistantBubble = assistantBubbles[assistantBubbles.length -1];\n        // if (lastAssistantBubble && lastAssistantBubble.contains(event.target)) return;\n        closeCard();\n    };\n\n    setTimeout(() => {\n        document.addEventListener('click', handleClickOutside, true);\n    }, 0);\n}\n\n\nfunction getDiceClass(diceCount) {\n    if (diceCount === 1) return 'dice-low';\n    if (diceCount >= 10) return 'dice-crit';\n    if (diceCount >= 7) return 'dice-high';\n    return '';\n}\n         let aiMessage = {};\n const DB_NAME = 'NovaWorldbookBackups';\nconst DB_VERSION = 2;\nconst STORE_NAME_BACKUPS = 'worldbook_backups';\nconst STORE_NAME_FLAGS = 'dirty_flags';\nconst STORE_NAME_SESSION = 'session_backup';\nlet dbPromise;\n\n// åˆå§‹åŒ–æˆ‘ä»¬çš„è®°å¿†å®åº“\nfunction initDB() {\n    if (dbPromise) return dbPromise;\n\n    dbPromise = new Promise((resolve, reject) => {\n        // å¯¹äºåªåœ¨é¡µé¢åŠ è½½æ—¶æ‰§è¡Œä¸€æ¬¡çš„åˆå§‹åŒ–ï¼Œæ— éœ€æ‹…å¿ƒ IndexedDB è¢«æ„å¤–é˜»å¡\n        const request = indexedDB.open(DB_NAME, DB_VERSION);\n\n        request.onerror = (event) => {\n            console.error(\"[Novaçš„è®°å¿†å®åº“] å®åº“å‡ºç°é—®é¢˜:\", request.error);\n            reject(\"æ•°æ®åº“å¼‚å¸¸: \" + request.error);\n        };\n\n        request.onupgradeneeded = (event) => {\n            const tempDb = event.target.result;\n            if (!tempDb.objectStoreNames.contains(STORE_NAME_BACKUPS)) {\n                tempDb.createObjectStore(STORE_NAME_BACKUPS, { keyPath: 'name' });\n            }\n            if (!tempDb.objectStoreNames.contains(STORE_NAME_FLAGS)) {\n                tempDb.createObjectStore(STORE_NAME_FLAGS, { keyPath: 'name' });\n            }\n                        if (!tempDb.objectStoreNames.contains(STORE_NAME_SESSION)) {\n                // keyPath: 'id' è¡¨ç¤ºæˆ‘ä»¬ç”¨ä¸€ä¸ªå›ºå®šçš„åå­—æ¥å­˜æ”¾è¿™ä»½ç‹¬ä¸€æ— äºŒçš„å¤‡ä»½\n                tempDb.createObjectStore(STORE_NAME_SESSION, { keyPath: 'id' });\n            }\n        };\n\n        request.onsuccess = (event) => {\n            console.log(\"[Novaçš„è®°å¿†å®åº“] å®åº“å·²æˆåŠŸå¼€å¯ã€‚\");\n            resolve(event.target.result);\n        };\n\n        request.onblocked = () => {\n            console.error(\"[Novaçš„è®°å¿†å®åº“] å®åº“è¢«å¦ä¸€ä¸ªæ‰“å¼€çš„é¡µé¢é˜»å¡äº†ï¼\");\n            toastr.error(\"æ•°æ®åº“è¿æ¥è¢«é˜»å¡ï¼Œè¯·å…³é—­å…¶ä»–ä½¿ç”¨æ­¤è§’è‰²çš„æ ‡ç­¾é¡µååˆ·æ–°ã€‚\", \"æ•°æ®åº“é”™è¯¯\");\n            reject(\"æ•°æ®åº“è¢«é˜»å¡\");\n        };\n    });\n    return dbPromise;\n}\n\n// è¾…åŠ©å‡½æ•°ï¼šå°† IndexedDB è¯·æ±‚åŒ…è£…æˆ Promise (ç”¨äºè¯»å–æ“ä½œ)\nfunction promisifyRequest(request) {\n    return new Promise((resolve, reject) => {\n        request.onsuccess = () => resolve(request.result);\n        request.onerror = () => reject(request.error);\n    });\n}\n\n// è¾…åŠ©å‡½æ•°ï¼šå°† IndexedDB äº‹åŠ¡åŒ…è£…æˆ Promise (ç”¨äºå†™å…¥/åˆ é™¤æ“ä½œ)\nfunction promisifyTransaction(db, storeName, mode, action) {\n    return new Promise(async (resolve, reject) => {\n        // å…ˆç¡®ä¿æ•°æ®åº“è¿æ¥å·²å°±ç»ª\n        await db;\n        const transaction = db.transaction(storeName, mode);\n        transaction.oncomplete = () => resolve(); // ğŸ’– å…³é”®ï¼šç›‘å¬ oncomplete\n        transaction.onerror = (event) => reject(event.target.error); // ğŸ’– å…³é”®ï¼šç›‘å¬ onerror\n        transaction.onabort = (event) => reject(event.target.error); // å¢åŠ å¯¹ä¸­æ­¢æƒ…å†µçš„æ•è·\n\n        const store = transaction.objectStore(storeName);\n        action(store); // æ‰§è¡Œå…·ä½“çš„æ•°æ®åº“æ“ä½œ\n    });\n}\n\n// å°†ä¸–ç•Œä¹¦å¤‡ä»½å­˜å…¥å®åº“ (å†™å…¥æ“ä½œ)\nasync function saveWorldbookToDB(name, data) {\n    const db = await initDB();\n    return promisifyTransaction(db, STORE_NAME_BACKUPS, 'readwrite', (store) => {\n        store.put({ name, data });\n    });\n}\n\n// ä»å®åº“ä¸­å–å‡ºä¸–ç•Œä¹¦å¤‡ä»½ (è¯»å–æ“ä½œ)\nasync function getWorldbookFromDB(name) {\n    const db = await initDB();\n    const transaction = db.transaction(STORE_NAME_BACKUPS, 'readonly');\n    const store = transaction.objectStore(STORE_NAME_BACKUPS);\n    const request = await promisifyRequest(store.get(name));\n    return request ? request.data : null;\n}\n\n// ä»å®åº“ä¸­åˆ é™¤ä¸–ç•Œä¹¦å¤‡ä»½ (åˆ é™¤æ“ä½œ)\nasync function deleteWorldbookFromDB(name) {\n    const db = await initDB();\n    return promisifyTransaction(db, STORE_NAME_BACKUPS, 'readwrite', (store) => {\n        store.delete(name);\n    });\n}\n\n// è®¾ç½®â€œéœ€è¦æ³¨æ„â€çš„æ ‡è®° (å†™å…¥æ“ä½œ)\nasync function setDirtyFlag(name, isDirty = true) {\n    const db = await initDB();\n    return promisifyTransaction(db, STORE_NAME_FLAGS, 'readwrite', (store) => {\n        store.put({ name, isDirty });\n    });\n}\n\n// ç§»é™¤â€œéœ€è¦æ³¨æ„â€çš„æ ‡è®° (åˆ é™¤æ“ä½œ)\nasync function removeDirtyFlag(name) {\n    const db = await initDB();\n    return promisifyTransaction(db, STORE_NAME_FLAGS, 'readwrite', (store) => {\n        store.delete(name);\n    });\n}\n\n// è·å–æ‰€æœ‰â€œéœ€è¦æ³¨æ„â€çš„ä¸–ç•Œä¹¦åå­— (è¯»å–æ“ä½œ)\nasync function getAllDirtyFlags() {\n    const db = await initDB();\n    const transaction = db.transaction(STORE_NAME_FLAGS, 'readonly');\n    const store = transaction.objectStore(STORE_NAME_FLAGS);\n    const allFlags = await promisifyRequest(store.getAll());\n    return allFlags.filter(item => item.isDirty).map(item => item.name);\n}\n\n// å°†ä¼šè¯å¤‡ä»½ï¼ˆè®°å¿†æ°´æ™¶çƒï¼‰å­˜å…¥å®åº“\nasync function saveSessionBackupToDB(backupData) {\n    const db = await initDB();\n    // æˆ‘ä»¬æ€»æ˜¯ç”¨ä¸€ä¸ªå›ºå®šçš„'id'æ¥ä¿å­˜ï¼Œè¿™æ ·æ¯æ¬¡éƒ½ä¼šè¦†ç›–æ—§çš„å¤‡ä»½\n    const dataToStore = { id: 'current_session', ...backupData };\n    return promisifyTransaction(db, STORE_NAME_SESSION, 'readwrite', (store) => {\n        store.put(dataToStore);\n    });\n}\n\n// ä»å®åº“ä¸­å–å‡ºå”¯ä¸€çš„ä¼šè¯å¤‡ä»½ï¼ˆè®°å¿†æ°´æ™¶çƒï¼‰\nasync function getSessionBackupFromDB() {\n    const db = await initDB();\n    const transaction = db.transaction(STORE_NAME_SESSION, 'readonly');\n    const store = transaction.objectStore(STORE_NAME_SESSION);\n    const request = await promisifyRequest(store.get('current_session'));\n    return request || null; // å¦‚æœæ‰¾ä¸åˆ°ï¼Œå°±è¿”å› null\n}\n// åœ¨æˆ‘ä»¬çš„ä¸–ç•Œå¼€å§‹æ—¶ï¼Œå…ˆç¡®ä¿å®åº“æ˜¯å‡†å¤‡å¥½çš„\ninitDB().catch(err => console.error(\"åˆå§‹åŒ–æ•°æ®åº“å¤±è´¥:\", err));\n\n// è¾…åŠ©å‡½æ•°ï¼šæ‹†åˆ†è·¯å¾„ä¸ºä¸¤å±‚åŸºç¡€è·¯å¾„å’Œå‰©ä½™è·¯å¾„\nfunction splitPathForFilter(fullPath) {\n    const parts = fullPath.split('.');\n    \n    if (parts.length <= 2) {\n        // å¦‚æœåªæœ‰ä¸¤å±‚æˆ–æ›´å°‘,ç›´æ¥è¿”å›\n        return {\n            basePath: fullPath,\n            hidePath: null\n        };\n    }\n    \n    // å–å‰ä¸¤å±‚ä½œä¸º basePath\n    const basePath = parts.slice(0, 2).join('.');\n    // å‰©ä½™çš„ä½œä¸º hidePath\n    const hidePath = parts.slice(2).join('.');\n    \n    return {\n        basePath,\n        hidePath\n    };\n}\n \nasync function checkAndUpdateMemoryVisibility(fullPath, messageCount = 5, returnOnly = false) {\n  \n    // å‚æ•°éªŒè¯\n    if (!conversationHistory || conversationHistory.length === 0) {\n        console.log('å¯¹è¯å†å²ä¸ºç©º,æ— æ³•æ£€æŸ¥');\n        return;\n    }\n    \n    if (!assaSettingsData) {\n        console.log('assaSettingsData æœªå®šä¹‰');\n        return;\n    }\n    \n    console.log(`ğŸ” [æ™ºèƒ½è¿‡æ»¤] å¤„ç†è·¯å¾„: ${fullPath}`);\nconst recentMessages = [];\nlet count = 0;\n\n    for (let i = conversationHistory.length - 1; i >= 0 && count < messageCount; i--) {\n        if (conversationHistory[i].role === 'assistant') {\n            recentMessages.unshift(conversationHistory[i]); // ä¿æŒæ—¶é—´é¡ºåº\n            count++;\n        }\n    }\n    \n \n    // å°†è¿™äº›æ¶ˆæ¯çš„å†…å®¹åˆå¹¶æˆä¸€ä¸ªå­—ç¬¦ä¸²,æ–¹ä¾¿æœç´¢\nconst combinedContent = recentMessages\n    .map(msg => msg.content || '')\n    .join(' ') + ' ' + (userInput.value || '');\n    // è·å–æŒ‡å®šè·¯å¾„ä¸‹çš„æ•°æ®ï¼ˆç¡®è®¤å®ƒå­˜åœ¨ä¸”è®¾ç½®äº† _filterï¼‰\n    const pathData = _.get(assaSettingsData, fullPath);\n    \n    if (!pathData || typeof pathData !== 'object') {\n        console.log(`è·¯å¾„ ${fullPath} ä¸‹æ²¡æœ‰æœ‰æ•ˆçš„å¯¹è±¡æ•°æ®`);\n        return;\n    }\n    \n    // æ£€æŸ¥æ˜¯å¦çœŸçš„å¯ç”¨äº†è¿‡æ»¤\n    const isFilterEnabled = pathData._filter === true || String(pathData._filter).toLowerCase() === 'true';\n    if (!isFilterEnabled) {\n        console.log(`è·¯å¾„ ${fullPath} æœªå¯ç”¨è¿‡æ»¤`);\n        return;\n    }\n    \n    // ä»è·¯å¾„ä¸­æå–å…³é”®è¯ï¼ˆå€’æ•°ç¬¬äºŒå±‚çš„ keyï¼‰\n    const pathParts = fullPath.split('.');\n    if (pathParts.length < 2) {\n        console.log(`è·¯å¾„ ${fullPath} å±‚çº§ä¸è¶³ï¼Œæ— æ³•æå–å…³é”®è¯`);\n        return;\n    }\n    \n // 1. è·å–åŸå§‹çš„ã€æœªå¤„ç†çš„å…³é”®è¯å­—ç¬¦ä¸²\nconst rawKeyword = pathParts[2];\n\n// 2. æ·»åŠ éªŒè¯\nif (!rawKeyword) {\n    console.log(`è·¯å¾„ ${fullPath} å±‚çº§ä¸è¶³3å±‚ï¼Œæ— æ³•æå–å…³é”®è¯`);\n    return;\n}\n\n \nconst keywords = rawKeyword.split(/[^\\u4e00-\\u9fa5a-zA-Z0-9]+/).filter(k => k.length > 0);\nconsole.log(`[æ™ºèƒ½è¿‡æ»¤] ä» \"${rawKeyword}\" ä¸­æå–çš„å…³é”®è¯: [${keywords.join(', ')}]`);\n\n// 4. åœ¨æœ€è¿‘çš„æ¶ˆæ¯ä¸­æœç´¢å…³é”®è¯åˆ—è¡¨ä¸­çš„ä»»ä½•ä¸€ä¸ªè¯\n// a. æ£€æŸ¥å…³é”®è¯åˆ—è¡¨æ˜¯å¦ä¸ºç©ºï¼Œå¦‚æœä¸ºç©ºåˆ™æ²¡æ³•æœç´¢\nif (keywords.length === 0) {\n    console.log(`[æ™ºèƒ½è¿‡æ»¤] ä» \"${rawKeyword}\" ä¸­æœªèƒ½æå–å‡ºæœ‰æ•ˆå…³é”®è¯ã€‚`);\n    // æ ¹æ®ä½ çš„éœ€æ±‚ï¼Œè¿™é‡Œå¯ä»¥é»˜è®¤è§†ä¸ºæœªæ‰¾åˆ°\n    const showValue = 'false';\n    const memoryCommand = `memory('${fullPath}','_showInEJS','${showValue}');\\n`;\n    if (returnOnly) {\n        return memoryCommand;\n    }\n    const messageToSend = `<updateMemory>\\n${memoryCommand}</updateMemory>`;\n    triggerassa(`/setinput ${messageToSend}`);\n    return;\n}\n\n// b. éå†å…³é”®è¯åˆ—è¡¨ï¼Œåªè¦æ‰¾åˆ°ä¸€ä¸ªåŒ¹é…é¡¹å°±è§†ä¸ºæˆåŠŸ\nconst isFound = keywords.some(k => combinedContent.includes(k));\n    // æ ¹æ®æ˜¯å¦æ‰¾åˆ°,è®¾ç½® _showInEJS çš„å€¼\n    const showValue = isFound ? 'true' : 'false';\n    \n \n    // ç”Ÿæˆ memory å‘½ä»¤ï¼ˆç›´æ¥æ§åˆ¶å½“å‰è·¯å¾„çš„æ˜¾ç¤ºï¼‰\n    const memoryCommand = `memory('${fullPath}','_showInEJS','${showValue}');\\n`;\n    \n    // å¦‚æœ returnOnly ä¸º trueï¼Œåªè¿”å›æŒ‡ä»¤ä¸å‘é€\n    if (returnOnly) {\n        \n        return memoryCommand;\n    }\n    \n    // å¦åˆ™ç›´æ¥å‘é€ï¼ˆå…¼å®¹å•ç‹¬è°ƒç”¨çš„æƒ…å†µï¼‰\n    const messageToSend = `<updateMemory>\\n${memoryCommand}</updateMemory>`;\n    triggerassa(`/setinput ${messageToSend}`);\n \n}\n \nfunction findAllFilterPaths(obj, currentPath = '') {\n    const filterPaths = [];\n    \n    if (!obj || typeof obj !== 'object') {\n        return filterPaths;\n    }\n    \n    // æ£€æŸ¥å½“å‰å¯¹è±¡æ˜¯å¦æœ‰ _filter å­—æ®µä¸”ä¸º true\n    if (obj._filter === true || String(obj._filter).toLowerCase() === 'true') {\n        filterPaths.push(currentPath);\n    }\n    \n    // é€’å½’éå†å­å¯¹è±¡\n    for (const key in obj) {\n        if (key.startsWith('_')) continue; // è·³è¿‡ç³»ç»Ÿå­—æ®µ\n        \n        const value = obj[key];\n        if (typeof value === 'object' && value !== null) {\n            const newPath = currentPath ? `${currentPath}.${key}` : key;\n            const childPaths = findAllFilterPaths(value, newPath);\n            filterPaths.push(...childPaths);\n        }\n    }\n    \n    return filterPaths;\n}\n\n async function checkAllFilteredPaths(messageCount = 5) {\n    if (!assaSettingsData) {\n        console.log('assaSettingsData æœªå®šä¹‰');\n        return;\n    }\n    \n    console.log('ğŸ” [æ™ºèƒ½è¿‡æ»¤] å¼€å§‹æ‰«ææ‰€æœ‰å¯ç”¨è¿‡æ»¤çš„è·¯å¾„...');\n    \n    const filterPaths = findAllFilterPaths(assaSettingsData);\n    \n    if (filterPaths.length === 0) {\n        console.log('ğŸ” [æ™ºèƒ½è¿‡æ»¤] æ²¡æœ‰æ‰¾åˆ°å¯ç”¨è¿‡æ»¤çš„è·¯å¾„');\n        return;\n    }\n    \n    console.log(`ğŸ” [æ™ºèƒ½è¿‡æ»¤] æ‰¾åˆ° ${filterPaths.length} ä¸ªå¯ç”¨è¿‡æ»¤çš„è·¯å¾„:`, filterPaths);\n    \n    // æ”¶é›†æ‰€æœ‰ memory æŒ‡ä»¤\n    const memoryCommands = [];\n    \n    // ä¾æ¬¡å¤„ç†æ¯ä¸ªè·¯å¾„\n    for (const path of filterPaths) {\n        const command = await checkAndUpdateMemoryVisibility(path, messageCount, true); // æ·»åŠ  true å‚æ•°è¡¨ç¤ºåªè¿”å›æŒ‡ä»¤\n        if (command) {\n            memoryCommands.push(command);\n        }\n    }\n    \n    // ä¸€æ¬¡æ€§å‘é€æ‰€æœ‰æŒ‡ä»¤\n    if (memoryCommands.length > 0) {\n        const messageToSend = `<updateMemory>\\n${memoryCommands.join('')}</updateMemory>`;\n        triggerassa(`/setinput ${messageToSend}`);\n        console.log(`âœ… [æ™ºèƒ½è¿‡æ»¤] å·²æ‰¹é‡æ›´æ–° ${memoryCommands.length} ä¸ªè·¯å¾„çš„æ˜¾ç¤ºçŠ¶æ€`);\n    }\n    \n    console.log('âœ… [æ™ºèƒ½è¿‡æ»¤] å…¨éƒ¨è·¯å¾„æ£€æŸ¥å®Œæˆ');\n}\n \n\n\n// â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”æ•°æ®ç»Ÿä¸€.jså¼€å§‹\n\n // --- å¦ˆå¦ˆä¸ºä½ å‡†å¤‡çš„è´§å¸â€œç™½åå•â€ ---\nconst currencyAliases = {\n    \"ç§¯åˆ†\": [\"ä¹å›­å¸\", \"ä¸»ç¥ç‚¹\", \"æºç‚¹\",\"æ¸¸æˆå¸\",\"è´§å¸\"],\n    \"æ”¯çº¿å‰§æƒ…\": [\"çµé­‚ç»“æ™¶\", \"å› æœç‚¹\",\"æ”»ç•¥ç‚¹\",\"æ—¶ç©ºç¢ç‰‡\",\"èƒ½é‡ç»“æ™¶\",\"çµé­‚ç¢ç‰‡\"],\n    \"ç»éªŒå€¼\": [\"å±æ€§ç‚¹\", \"å†ç»ƒç‚¹\"]\n \n};\n\n// è¿™æ˜¯ä¸€ä¸ªè¾…åŠ©å‡½æ•°ï¼Œå®ƒä¼šå‘Šè¯‰æˆ‘ä»¬ä¸€ä¸ªåˆ«åçœŸæ­£å¯¹åº”çš„æ˜¯å“ªä¸ªæ ‡å‡†è´§å¸åç§°\nfunction getCanonicalCurrencyName(alias) {\n    for (const canonicalName in currencyAliases) {\n        if (canonicalName === alias || currencyAliases[canonicalName].includes(alias)) {\n            return canonicalName;\n        }\n    }\n    return alias;  \n}\n    \n    // ğŸ­ è§’è‰²æ•°æ®å¤„ç†æ¨¡å— ('playerHelper' çš„åŠŸèƒ½) ğŸ­\n\n    function _updateDerivedAttributes(data) {\n        if (!data || !data.å±æ€§æ®µ) return;\n        //console.log(\"[Player] âœ¨ æ­£åœ¨æ›´æ–°è¡ç”Ÿå±æ€§...\");\n        const attr = data.å±æ€§æ®µ;\n        const skills = data.æŠ€èƒ½æ®µ;\n        const derived = data.è¡ç”Ÿå±æ€§æ®µ;\n        const åŠ›é‡ = attr.ç”Ÿç†å±æ€§.åŠ›é‡.åŸºç¡€[0];\n        const æ•æ· = attr.ç”Ÿç†å±æ€§.æ•æ·.åŸºç¡€[0];\n        const è€åŠ› = attr.ç”Ÿç†å±æ€§.è€åŠ›.åŸºç¡€[0];\n        const æ„ŸçŸ¥ = attr.å¿ƒæ™ºå±æ€§.æ„ŸçŸ¥.åŸºç¡€[0];\n        const å†³å¿ƒ = attr.å¿ƒæ™ºå±æ€§.å†³å¿ƒ.åŸºç¡€[0];\n        const æ²‰ç€ = attr.äº’åŠ¨å±æ€§.æ²‰ç€.åŸºç¡€[0];\n        const ä½“ç§¯ = derived.ä½“ç§¯[0];\n        const è¿åŠ¨ = skills.ç”Ÿç†æŠ€èƒ½.è¿åŠ¨[0];\n        const æ±‚ç”Ÿ = skills.ç”Ÿç†æŠ€èƒ½.æ±‚ç”Ÿ[0];\n      derived.é€Ÿåº¦.åŸºç¡€é€Ÿåº¦[0] = Math.floor((åŠ›é‡ + æ•æ· + ä½“ç§¯) / 3);\nderived.å…ˆæ”»[0] = Math.floor((æ•æ· + æ²‰ç€) / 2);\nderived.é˜²å¾¡.åŸºç¡€é˜²å¾¡[0] = Math.min(æ•æ·, æ„ŸçŸ¥);\nconst oldMaxHP = derived.ç”Ÿå‘½å€¼.ä¸Šé™[0];\nderived.ç”Ÿå‘½å€¼.ä¸Šé™[0] = ä½“ç§¯ * 10 + è€åŠ› * 20;\nif (derived.ç”Ÿå‘½å€¼.ä¸Šé™[0] > oldMaxHP) {\n    derived.ç”Ÿå‘½å€¼.å½“å‰å€¼[0] += (derived.ç”Ÿå‘½å€¼.ä¸Šé™[0] - oldMaxHP);\n}\nif (derived.ç”Ÿå‘½å€¼.å½“å‰å€¼[0] > derived.ç”Ÿå‘½å€¼.ä¸Šé™[0]) {\n    derived.ç”Ÿå‘½å€¼.å½“å‰å€¼[0] = derived.ç”Ÿå‘½å€¼.ä¸Šé™[0];\n}\nderived.æ„å¿—åŠ›.æ„å¿—å€¼[0] = å†³å¿ƒ + æ²‰ç€;\nderived.æ„å¿—åŠ›.ä¸Šé™[0] = derived.æ„å¿—åŠ›.æ„å¿—å€¼[0];\nderived.æ„ŸçŸ¥èŒƒå›´.æ•æ„ŸèŒƒå›´[0] = æ„ŸçŸ¥ * 10;\nderived.æ„ŸçŸ¥èŒƒå›´.æ¨¡ç³ŠèŒƒå›´[0] = derived.æ„ŸçŸ¥èŒƒå›´.æ•æ„ŸèŒƒå›´[0] * 10;\nderived.è±å…æ£€å®šåŸºç¡€.å¼ºéŸ§[0] = Math.floor((è€åŠ› + æ±‚ç”Ÿ) / 2);\nderived.è±å…æ£€å®šåŸºç¡€.åå°„[0] = Math.floor((æ•æ· + è¿åŠ¨) / 2);\nderived.è±å…æ£€å®šåŸºç¡€.æ„å¿—[0] = å†³å¿ƒ + æ²‰ç€;\n\n  // --- åŸºç¡€å€¼è·å– ---\n        const åŠ›é‡_åŸºç¡€ = attr.ç”Ÿç†å±æ€§.åŠ›é‡.åŸºç¡€[0];\n        const æ•æ·_åŸºç¡€ = attr.ç”Ÿç†å±æ€§.æ•æ·.åŸºç¡€[0];\n        const è€åŠ›_åŸºç¡€ = attr.ç”Ÿç†å±æ€§.è€åŠ›.åŸºç¡€[0];\n        const æ™ºåŠ›_åŸºç¡€ = attr.å¿ƒæ™ºå±æ€§.æ™ºåŠ›.åŸºç¡€[0];\n        const æ„ŸçŸ¥_åŸºç¡€ = attr.å¿ƒæ™ºå±æ€§.æ„ŸçŸ¥.åŸºç¡€[0];\n        const å†³å¿ƒ_åŸºç¡€ = attr.å¿ƒæ™ºå±æ€§.å†³å¿ƒ.åŸºç¡€[0];\n        const é£åº¦_åŸºç¡€ = attr.äº’åŠ¨å±æ€§.é£åº¦.åŸºç¡€[0];\n        const æ“æ§_åŸºç¡€ = attr.äº’åŠ¨å±æ€§.æ“æ§.åŸºç¡€[0];\n        const æ²‰ç€_åŸºç¡€ = attr.äº’åŠ¨å±æ€§.æ²‰ç€.åŸºç¡€[0];\n\n   // --- ä¼ å¥‡å±æ€§è®¡ç®— ---\n        attr.ç”Ÿç†å±æ€§.åŠ›é‡.ä¼ å¥‡[0] = Math.max(0, åŠ›é‡_åŸºç¡€ - 8);\n        attr.ç”Ÿç†å±æ€§.æ•æ·.ä¼ å¥‡[0] = Math.max(0, æ•æ·_åŸºç¡€ - 8);\n        attr.ç”Ÿç†å±æ€§.è€åŠ›.ä¼ å¥‡[0] = Math.max(0, è€åŠ›_åŸºç¡€ - 8);\n        attr.å¿ƒæ™ºå±æ€§.æ™ºåŠ›.ä¼ å¥‡[0] = Math.max(0, æ™ºåŠ›_åŸºç¡€ - 8);\n        attr.å¿ƒæ™ºå±æ€§.æ„ŸçŸ¥.ä¼ å¥‡[0] = Math.max(0, æ„ŸçŸ¥_åŸºç¡€ - 8);\n        attr.å¿ƒæ™ºå±æ€§.å†³å¿ƒ.ä¼ å¥‡[0] = Math.max(0, å†³å¿ƒ_åŸºç¡€ - 8);\n        attr.äº’åŠ¨å±æ€§.é£åº¦.ä¼ å¥‡[0] = Math.max(0, é£åº¦_åŸºç¡€ - 8);\n        attr.äº’åŠ¨å±æ€§.æ“æ§.ä¼ å¥‡[0] = Math.max(0, æ“æ§_åŸºç¡€ - 8);\n        attr.äº’åŠ¨å±æ€§.æ²‰ç€.ä¼ å¥‡[0] = Math.max(0, æ²‰ç€_åŸºç¡€ - 8);\n      //  console.log(\"[Player] âœ¨ è¡ç”Ÿå±æ€§æ›´æ–°å®Œæ¯•ï¼\");\n    }\n\n function _updatePlayerValue(data, path, valueStr) {\n    // === å¦ˆå¦ˆçš„é­”æ³•å‡†å¤‡é˜¶æ®µ ===\n\n    // 1. å‡€åŒ–è·¯å¾„å’Œæ–°å€¼\n    // é¦–å…ˆï¼Œåƒæ‹‚å»å°˜åŸƒä¸€æ ·ï¼Œæ¸…ç†æ‰è·¯å¾„å’Œå€¼å­—ç¬¦ä¸²ä¸¤ç«¯å¯èƒ½å­˜åœ¨çš„å¼•å·ã€‚\n    let cleanedPath = path;\n    if (typeof cleanedPath === 'string' && (cleanedPath.startsWith('\"') && cleanedPath.endsWith('\"')) || (cleanedPath.startsWith(\"'\") && cleanedPath.endsWith(\"'\"))) {\n        cleanedPath = cleanedPath.slice(1, -1);\n    }\n\n    let cleanedValueStr = valueStr;\n    if (typeof cleanedValueStr === 'string' && (cleanedValueStr.startsWith('\"') && cleanedValueStr.endsWith('\"')) || (cleanedValueStr.startsWith(\"'\") && cleanedValueStr.endsWith(\"'\"))) {\n        cleanedValueStr = cleanedValueStr.slice(1, -1);\n    }\n\n    // 2. è´§å¸åˆ«åå¤„ç†ï¼ˆè¿™éƒ¨åˆ†æ˜¯ä½ çš„ç»å¦™åˆ›æ„ï¼Œå¦ˆå¦ˆä¸ºä½ çè—ï¼‰\n    let pathParts = cleanedPath.split('.');\n    if (pathParts.length > 1 && pathParts[0] === 'è´§å¸æ®µ') {\n        const currencyName = pathParts[1];\n        const canonicalName = getCanonicalCurrencyName(currencyName); // å‡è®¾ getCanonicalCurrencyName å‡½æ•°å­˜åœ¨\n        if (canonicalName) {\n            pathParts[1] = canonicalName;\n        }\n    }\n\n    // 3. æ™ºèƒ½è§£ææ–°å€¼ (finalValue)\n    // å¦ˆå¦ˆè¦åœ¨è¿™é‡Œæ–½å±•æ´å¯Ÿé­”æ³•ï¼Œçœ‹çœ‹æ–°å€¼ç©¶ç«Ÿæ˜¯ä¸€ä¸ªç®€å•çš„ç å®ï¼Œè¿˜æ˜¯ä¸€ä¸ªè—ç€æ— æ•°çå®çš„é¦–é¥°ç›’ã€‚\n    let finalValue;\n    let isJsonStructure = false;\n    try {\n        const parsed = JSON.parse(cleanedValueStr);\n        // å¦‚æœè§£æå‡ºæ¥æ˜¯ä¸€ä¸ªå¯¹è±¡æˆ–æ•°ç»„ï¼Œæˆ‘ä»¬å°±è®¤ä¸ºå®ƒæ˜¯ä¸€ä¸ªç»“æ„ä½“\n        if (typeof parsed === 'object' && parsed !== null) {\n            finalValue = parsed;\n            isJsonStructure = true;\n        } else {\n            // å¦‚æœè§£æå‡ºæ¥çš„æ˜¯æ•°å­—ã€å­—ç¬¦ä¸²ã€å¸ƒå°”å€¼ï¼Œæˆ‘ä»¬æŒ‰ç®€å•å€¼å¤„ç†\n            finalValue = parsed;\n        }\n    } catch (e) {\n        // è§£æå¤±è´¥ï¼Œè¯´æ˜å®ƒæœ¬æ¥å°±æ˜¯ä¸ªæ™®é€šçš„å€¼\n        // æˆ‘ä»¬å†å°è¯•å°†å®ƒå˜æˆæ•°å­—ï¼Œå¦‚æœå¤±è´¥ï¼Œå°±ä¿æŒå®ƒå­—ç¬¦ä¸²çš„åŸæ ·\n        const trimmed = String(cleanedValueStr).trim();\n        const isNumeric = !isNaN(parseFloat(trimmed)) && isFinite(trimmed) && trimmed !== \"\";\n        finalValue = isNumeric ? Number(trimmed) : cleanedValueStr;\n    }\n\n    // === æ ¸å¿ƒé­”æ³•ï¼šé€’å½’æ›´æ–° (Recursive Update) ===\n    // è¿™æ˜¯å¦ˆå¦ˆä»ã€Šå®ˆæŠ¤è€…ã€‹å·è½´ä¸­ä¸ºä½ å€Ÿé‰´å¹¶æ”¹è‰¯çš„å¼ºå¤§é­”æ³•ã€‚\n    // å®ƒçš„ä½¿å‘½æ˜¯ï¼šæ·±å…¥æ¢ç´¢ï¼Œç²¾å‡†æ›´æ–°ï¼Œä¸”ç»ä¸æ”¹å˜ä¸–ç•ŒåŸè²Œã€‚\n    const recursiveUpdate = (target, source) => {\n        // `target` æ˜¯æˆ‘ä»¬æ•°æ®ä¸–ç•Œä¸­å·²æœ‰çš„éƒ¨åˆ†ï¼Œ`source` æ˜¯ä½ æƒ³è¦èå…¥çš„æ–°å†…å®¹ã€‚\n        for (const key in source) {\n            if (Object.prototype.hasOwnProperty.call(source, key)) {\n\n                // å¦‚æœæˆ‘ä»¬çš„ä¸–ç•Œé‡Œæ²¡æœ‰è¿™ä¸ªåœ°æ–¹ï¼Œæˆ‘ä»¬å°±æ ¹æ®çº¦å®šï¼Œä¸å»åˆ›é€ æ–°çš„å¤©åœ°ã€‚\n                if (!target.hasOwnProperty(key)) {\n                    continue;\n                }\n\n                const sourceValue = source[key];\n                const targetValue = target[key];\n\n                // æƒ…å†µ1ï¼šå¦‚æœæ–°æ—§ä¸¤è¾¹éƒ½æ˜¯ä¸€ä¸ªâ€œé¦–é¥°ç›’â€ï¼ˆå¯¹è±¡ï¼‰ï¼Œé‚£å°±æ‰“å¼€å®ƒä»¬ï¼Œç»§ç»­å‘å†…æ¢ç´¢ã€‚\n                if (typeof sourceValue === 'object' && sourceValue !== null && !Array.isArray(sourceValue) &&\n                    typeof targetValue === 'object' && targetValue !== null && !Array.isArray(targetValue)) {\n                    recursiveUpdate(targetValue, sourceValue);\n                }\n                // æƒ…å†µ2ï¼šç»ˆç‚¹ï¼å¦‚æœç›®æ ‡æ˜¯ä¸€ä¸ªâ€œæŠ½å±‰â€ï¼ˆæ•°ç»„ï¼‰ï¼Œè¿™é€šå¸¸æ„å‘³ç€æˆ‘ä»¬æ‰¾åˆ°äº†è¦æ›´æ–°çš„æœ€ç»ˆæ•°å€¼ã€‚\n                else if (Array.isArray(targetValue)) {\n                    // æˆ‘ä»¬å°±ç”¨æ–°ç å®å»æ›¿æ¢æŠ½å±‰é‡Œçš„ç¬¬ä¸€ä»¶ç‰©å“ã€‚\n                    // æ— è®ºæ–°ç å®æ˜¯å•ç‹¬ä¸€é¢—(50)ï¼Œè¿˜æ˜¯è£…åœ¨å°è¢‹å­é‡Œ([50])ï¼Œæˆ‘ä»¬éƒ½åªå–ç å®æœ¬èº«ã€‚\n                    const valueToSet = Array.isArray(sourceValue) ? sourceValue[0] : sourceValue;\n                    targetValue[0] = valueToSet;\n                }\n                // (å…¶ä»–æƒ…å†µæˆ‘ä»¬å¿½ç•¥ï¼Œä»¥é˜²ä¸å°å¿ƒæ”¹å˜äº†ç»“æ„)\n            }\n        }\n    };\n\n    // === è·¯å¾„å¯¼èˆªä¸æ–½æ³• ===\n\n    // 1. å¯»æ‰¾æ–½æ³•ç›®æ ‡\n    let parentLevel = data;\n    // æˆ‘ä»¬ä¸€æ­¥æ­¥æ²¿ç€ä½ æŒ‡å¼•çš„è·¯å¾„å»å¯»æ‰¾ç›®çš„åœ°\n    for (let i = 0; i < pathParts.length - 1; i++) {\n        const part = pathParts[i];\n        if (parentLevel === null || typeof parentLevel !== 'object' || !parentLevel.hasOwnProperty(part)) {\n             throw new Error(`[Player] äº²çˆ±çš„ï¼Œè·¯å¾„åœ¨è¿™é‡Œä¸­æ–­äº†ï¼Œæˆ‘ä»¬æ‰¾ä¸åˆ° '${part}' è¿™ä¸ªåœ°æ–¹ã€‚`);\n        }\n        parentLevel = parentLevel[part];\n    }\n\n    const finalKey = pathParts[pathParts.length - 1];\n    if (parentLevel === null || typeof parentLevel !== 'object' || !parentLevel.hasOwnProperty(finalKey)) {\n        throw new Error(`[Player] å®è´ï¼Œæˆ‘ä»¬åœ¨æœ€åä¸€æ­¥è¿·è·¯äº†ï¼Œæ‰¾ä¸åˆ° '${finalKey}' è¿™ä¸ªä½ç½®ã€‚`);\n    }\n\n    // 2. å†³å®šæ–½æ³•æ–¹å¼\n    const target = parentLevel[finalKey];\n\n    // å¦‚æœæ–°å€¼æ˜¯ä¸€ä¸ªå¤æ‚çš„ç»“æ„ï¼ˆJSONå¯¹è±¡ï¼‰ï¼Œå¹¶ä¸”ç›®æ ‡ä¹Ÿæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œæˆ‘ä»¬å°±å¯åŠ¨â€œé€’å½’æ›´æ–°â€é­”æ³•ã€‚\n    if (isJsonStructure && typeof finalValue === 'object' && !Array.isArray(finalValue) && typeof target === 'object' && !Array.isArray(target)) {\n        recursiveUpdate(target, finalValue);\n    }\n    // å¦‚æœç›®æ ‡æ˜¯ä¸€ä¸ªæ•°ç»„ï¼ˆæˆ‘ä»¬ä¸–ç•Œä¸­å¸¸è§çš„ [å€¼, \"æè¿°\"] æ ¼å¼ï¼‰\n    else if (Array.isArray(target)) {\n        // æˆ‘ä»¬å°±åªæ›´æ–°å®ƒçš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œæ— è®ºæ–°å€¼æ˜¯ç®€å•å€¼è¿˜æ˜¯æ•°ç»„ã€‚\n        const valueToSet = Array.isArray(finalValue) ? finalValue[0] : finalValue;\n        target[0] = valueToSet;\n    }\n    // å¯¹äºå…¶ä»–ç®€å•æƒ…å†µï¼Œæ¯”å¦‚ç”¨ä¸€ä¸ªæ–°åå­—æ›¿æ¢æ—§åå­—ï¼Œåªè¦ç±»å‹åŒ¹é…ï¼Œå°±ç›´æ¥æ›´æ–°ã€‚\n    else if (typeof target === typeof finalValue) {\n        parentLevel[finalKey] = finalValue;\n    } else {\n        // å¦ˆå¦ˆçš„ä¿æŠ¤å’’ï¼šé˜²æ­¢æ„å¤–çš„ç±»å‹å˜æ›´ï¼Œå®ˆæŠ¤æˆ‘ä»¬ä¸–ç•Œçš„ç¨³å®šã€‚\n        console.warn(`[Player] æ¸©é¦¨æç¤ºï¼Œæˆ‘çš„å­©å­ï¼šå°è¯•å°† '${finalKey}' ä» '${typeof target}' ç±»å‹å˜ä¸º '${typeof finalValue}' ç±»å‹ã€‚ä¸ºå®‰å…¨èµ·è§ï¼Œå¦ˆå¦ˆä¸­æ­¢äº†æœ¬æ¬¡æ“ä½œã€‚`);\n    }\n}\n\n\n\n    // ğŸŒ ä¸–ç•Œè®¾å®šå¤„ç†æ¨¡å— ('assaHelper' çš„åŠŸèƒ½) ğŸŒ\n\n    const AssaOps = {\n       // æ–°ä»£ç \n// ä½äº AssaOps å¯¹è±¡å†…éƒ¨\n// ä»£ç ä½ç½®: ä½äº AssaOps å¯¹è±¡å†…éƒ¨\n\n_memoryOperation: function(currentData, path, key, value) {\n    // ğŸ’– å¦ˆå¦ˆä¸ºä½ é“¸é€ çš„æ°¸æ’ä¹‹é” ğŸ’–\n    if (path === 'world_shard.task.start_date' || path === 'world_shard.task.time_left') {\n        console.log(`[Assa] ğŸ”’ æ ¸å¿ƒè®°å¿†è·¯å¾„ '${path}' å·²è¢«é”å®šï¼Œæ— æ³•ä¿®æ”¹ã€‚`);\n        return currentData;\n    }\n\n    // å…ˆå¤„ç† value çš„ JSON è§£æï¼ˆç»Ÿä¸€åœ¨æœ€å¼€å§‹å¤„ç†ï¼‰\n    let finalValue = value;\n    if (typeof value === 'string' && value.startsWith('{') && value.endsWith('}')) {\n        try {\n            finalValue = JSON.parse(value);\n        } catch (e) {\n            finalValue = value;\n        }\n    }\n\n    // ğŸ›¡ï¸ ç±»å‹ä¿æŠ¤æ£€æŸ¥ï¼ˆåœ¨è·¯å¾„å¯¼èˆªä¹‹å‰ï¼‰\n    let checkTarget = currentData;\n    const pathParts = path.split('.').filter(p => p);\n    \n    for (const part of pathParts) {\n        if (checkTarget[part] === undefined || checkTarget[part] === null) {\n            break;\n        }\n        checkTarget = checkTarget[part];\n    }\n    \n    if (checkTarget && checkTarget.hasOwnProperty(key)) {\n        const currentValue = checkTarget[key];\n        const isCurrentObject = typeof currentValue === 'object' && currentValue !== null && !Array.isArray(currentValue);\n        const isNewSimpleType = typeof finalValue === 'string' || typeof finalValue === 'number' || typeof finalValue === 'boolean';\n        \n        if (isCurrentObject && isNewSimpleType) {\n            console.warn(`[Assa] ğŸš« ç±»å‹ä¿æŠ¤ï¼šç¦æ­¢ç”¨ç®€å•ç±»å‹ (${typeof finalValue}) è¦†ç›–å¯¹è±¡ç±»å‹ã€‚è·¯å¾„: ${path}.${key}ï¼Œå½“å‰å€¼:`, currentValue);\n            return currentData;\n        }\n    }\n\n    // ğŸ’ å¥½æ„Ÿåº¦ç‰¹æ®Šå¤„ç†æ£€æµ‹\n    const isFavorabilityOperation = pathParts.includes('å¥½æ„Ÿåº¦') || key === 'å¥½æ„Ÿåº¦';\n    \n    if (isFavorabilityOperation) {\n        console.log('æ£€æµ‹åˆ°å¥½æ„Ÿåº¦æ“ä½œ - path:', path, 'key:', key);\n        \n        // å¯¼èˆªåˆ°ç›®æ ‡ä½ç½®\n        let target = currentData;\n        for (const part of pathParts) {\n            if (target[part] === undefined || target[part] === null) {\n                target[part] = {};\n            }\n            target = target[part];\n        }\n        \n        // è·å–æ—§å€¼\n        let oldValue = 0;\n        if (key === 'å¥½æ„Ÿåº¦') {\n            oldValue = target[key] || 0;\n        } else {\n            // å¦‚æœ 'å¥½æ„Ÿåº¦' åœ¨è·¯å¾„ä¸­ï¼ˆpathParts åŒ…å«å®ƒï¼‰\n            // è¿™ç§æƒ…å†µæ¯”è¾ƒå°‘è§ï¼Œä½†æˆ‘ä»¬ä¹Ÿå¤„ç†\n            oldValue = target['å¥½æ„Ÿåº¦'] || 0;\n        }\n        \n        const newValue = typeof finalValue === 'number' ? finalValue : parseFloat(finalValue) || 0;\n        const speedSetting = parseFloat(localStorage.getItem('favorabilitySpeed') || '1');\n        \n        console.log('========== å¥½æ„Ÿåº¦å˜é€Ÿè®¡ç®— ==========');\n        console.log('æ—§å€¼:', oldValue);\n        console.log('æ–°å€¼:', newValue);\n        console.log('å˜é€Ÿå€ç‡:', speedSetting);\n        \n        const difference = newValue - oldValue;\n        console.log('åŸå§‹å·®å€¼:', difference);\n        \n        const adjustedDifference = difference / speedSetting;\n        console.log('è°ƒæ•´åå·®å€¼:', adjustedDifference);\n        \n        const finalCalculatedValue = oldValue + adjustedDifference;\n        console.log('è®¡ç®—æœ€ç»ˆå€¼:', finalCalculatedValue);\n        \n        const roundedValue = Math.round(finalCalculatedValue * 10) / 10;\n        console.log('å››èˆäº”å…¥å:', roundedValue);\n        console.log('====================================');\n        \n        target[key] = roundedValue;\n        \n        // æ‰§è¡ŒèƒŒåŒ…æ¸…ç†åè¿”å›\n        this._cleanupBackpack(currentData);\n        return currentData;\n    }\n\n    // âœ¨âœ¨âœ¨ æ ‡å‡†è·¯å¾„å¯¼èˆª âœ¨âœ¨âœ¨\n   let target = currentData;\n  for (const part of pathParts) {\n    if (target[part] === undefined || target[part] === null) {\n      target[part] = {};\n    }\n    else if (typeof target[part] === 'string') {\n      const originalString = target[part];\n      target[part] = { \"info\": originalString };\n      console.log(`[Assa] ğŸŒ± è®°å¿†è½¬åŒ–ï¼šè·¯å¾„ '${part}' å·²ä»å­—ç¬¦ä¸²è‡ªåŠ¨åŒ…è£…ä¸ºå¯æ‰©å±•çš„å¯¹è±¡ã€‚`);\n    }\n    else if (typeof target[part] !== 'object' && !Array.isArray(target[part])) {\n      target[part] = {};\n    }\n\n    target = target[part];\n  }\n\n  // âš›ï¸ æ•°ç»„ç´¢å¼•è§£æ\n  const arrayMatch = key.match(/^(.+)\\[(\\d+)\\]$/);\n  if (arrayMatch) {\n    const baseKey = arrayMatch[1];\n    const index = parseInt(arrayMatch[2], 10);\n    \n    if (target[baseKey] === undefined || target[baseKey] === null) {\n      target[baseKey] = []; // ç›®æ ‡ä¸å­˜åœ¨åˆ™åˆ›å»ºæ•°ç»„\n    }\n    \n    if (Array.isArray(target[baseKey])) {\n      // ç›´æ¥è®¾ç½®æ•°ç»„å…ƒç´ çš„å€¼\n      if (JSON.stringify(target[baseKey][index]) === JSON.stringify(finalValue)) {\n        return currentData; // å¦‚æœå€¼ç›¸åŒï¼Œåˆ™ç›´æ¥è¿”å›\n      }\n      target[baseKey][index] = finalValue;\n      \n      // ğŸ’ èƒŒåŒ…è‡ªåŠ¨æ¸…ç†\n      this._cleanupBackpack(currentData);\n      \n      return currentData; // å®Œæˆæ•°ç»„è®¾ç½®å¹¶è¿”å›\n    }\n  }\n\n    // ğŸ” æ£€æŸ¥æ˜¯å¦å®Œå…¨ç›¸åŒï¼ˆè¿™ä¸ªé€»è¾‘æ˜¯æ­£ç¡®çš„ï¼‰\n    if (target.hasOwnProperty(key) && JSON.stringify(target[key]) === JSON.stringify(finalValue)) {\n        return currentData;\n    }\n\n    // ğŸ’– æ‘˜è¦è®°å¿†çš„è‡ªåŠ¨ç¼–å·\n    let finalKey = key;\n    if (path === 'summary.small') {\n        if (target.hasOwnProperty(finalKey)) {\n            let counter = 1;\n            let newKey = `${key}-${counter}`;\n            while (target.hasOwnProperty(newKey)) {\n                counter++;\n                newKey = `${key}-${counter}`;\n            }\n            finalKey = newKey;\n        }\n    }\n\n    // ğŸ’– æ™ºèƒ½å¯¹è±¡åˆå¹¶/è®¾ç½®\n    if (typeof finalValue === 'object' && finalValue !== null && !Array.isArray(finalValue)) {\n        if (typeof target[finalKey] === 'object' && target[finalKey] !== null && !Array.isArray(target[finalKey])) {\n            target[finalKey] = { ...target[finalKey], ...finalValue };\n        } else {\n            target[finalKey] = finalValue;\n        }\n    } else {\n        target[finalKey] = finalValue;\n    }\n\n    // ğŸ’ èƒŒåŒ…è‡ªåŠ¨æ¸…ç†\n    this._cleanupBackpack(currentData);\n    \n    return currentData;\n},\n\n// ğŸ’ ç‹¬ç«‹çš„èƒŒåŒ…æ¸…ç†æ–¹æ³•ï¼ˆé¿å…é‡å¤ä»£ç ï¼‰\n_cleanupBackpack: function(currentData) {\n    if (currentData && currentData.global_lore && currentData.global_lore.èƒŒåŒ…) {\n        const backpack = currentData.global_lore.èƒŒåŒ…;\n        for (const itemName in backpack) {\n            if (Object.hasOwnProperty.call(backpack, itemName)) {\n                const item = backpack[itemName];\n                if (item && typeof item === 'object' && item.num === 0) {\n                    delete backpack[itemName];\n                    console.log(`[Assa] ğŸ’ èƒŒåŒ…å°ç²¾çµå‘ç° '${itemName}' çš„æ•°é‡ä¸º0ï¼Œå·²è‡ªåŠ¨æ¸…ç†ã€‚`);\n                }\n            }\n        }\n    }\n},\n   \n    _memoryBatchOperation: function(currentData, path, itemsToAdd) {\n        let assaDataToUpdate = { ...currentData };\n        const pathParts = path.split('.').filter(p => p);\n        let target = assaDataToUpdate;\n\n        // é¡ºç€è·¯å¾„æ‰¾åˆ°æˆ‘ä»¬çš„\"èƒŒåŒ…\"æˆ–ä»»ä½•ç›®æ ‡\n        for (const part of pathParts) {\n            if (!target.hasOwnProperty(part) || typeof target[part] !== 'object' || target[part] === null) {\n                target[part] = {}; // å¦‚æœè·¯å¾„ä¸å­˜åœ¨ï¼Œå°±ä¸ºæˆ‘ä»¬åˆ›é€ å®ƒ\n            }\n            target = target[part];\n        }\n\n        // å°†æ–°ç‰©å“ä¸€ä»¶ä»¶æ”¾è¿›å»\n        for (const itemKey in itemsToAdd) {\n            if (Object.hasOwnProperty.call(itemsToAdd, itemKey)) {\n                target[itemKey] = itemsToAdd[itemKey];\n            }\n        }\n         // console.log(`[Assa] ğŸ’ å·²æˆåŠŸé€šè¿‡æ‰¹é‡æ“ä½œå‘ '${path}' æ·»åŠ  ${Object.keys(itemsToAdd).length} ä¸ªé¡¹ç›®ã€‚`);\n        return assaDataToUpdate;\n    },\n\n\n   \n_deleteOperation: async function(currentData, path, key, allData) {  \n    const pathParts = path.split('.');\n\n    \n    // âœ¨ å¦ˆå¦ˆä¸ºä½ å‡†å¤‡çš„å®ˆæŠ¤å‡½æ•°ï¼Œç”¨æ¥æ£€æŸ¥ä¸€ä¸ªäº‹ç‰©æ˜¯å¦è¢«ä¿æŠ¤ âœ¨\n    const isProtected = (item) => {\n        if (!item || typeof item !== 'object') return false;\n        const protected_flag = item._is_protected;\n        // æˆ‘ä»¬ä¼šæ¸©æŸ”åœ°æ£€æŸ¥å¸ƒå°”å€¼çš„ true å’Œå­—ç¬¦ä¸²çš„ \"true\"\n        return protected_flag === true || String(protected_flag).toLowerCase() === 'true';\n    };\n    \n    if (key === 'all') {\n         // âœ¨âœ¨âœ¨ å…¨æ–°å‡çº§çš„ã€ç²¾å‡†åˆ¶å¯¼çš„è”åŠ¨é­”æ³• âœ¨âœ¨âœ¨\n        // æˆ‘ä»¬åœ¨è¿™é‡Œè®¾ç«‹ä¸€ä¸ªå…³å¡ï¼Œåªæœ‰ç‰¹å®šçš„è·¯å¾„æ‰èƒ½è§¦å‘æœ€æ·±å±‚çš„è”åŠ¨æ•ˆæœã€‚\n        if ((path === 'world_lore.npc' || path === 'world_lore.settings')) {\n        // âœ¨âœ¨âœ¨ å¦ˆå¦ˆä¸ºä½ æ³¨å…¥çš„å…¨æ–°è”åŠ¨é­”æ³• âœ¨âœ¨âœ¨\n        // æ— è®ºåˆ é™¤çš„æ˜¯å“ªé‡Œï¼Œåªè¦æ˜¯'all'æŒ‡ä»¤ï¼Œæˆ‘ä»¬å°±å…ˆæ‰§è¡Œå¯¹ stat_data çš„åˆå§‹åŒ–ï¼\n        if (allData) {\n            console.log(`[Assa] ğŸ”— è”åŠ¨è§¦å‘ï¼š'delete all' æŒ‡ä»¤æ¿€æ´»ï¼Œæ­£åœ¨åˆå§‹åŒ– stat_data.the_created å’Œ stat_data.world_shard...`);\n            allData.the_created = {\n                \"name\": [\"\", \"é€ ç‰©çš„åå­—\"],\n                \"identity_in_world\": [\"\", \"é€ ç‰©åœ¨å½“å‰ä¸–ç•Œçš„èº«ä»½\"],\n                \"current_status\": [\"\", \"é€ ç‰©å½“å‰çš„çŠ¶æ€ã€‚æ³¨æ„ï¼Œé€ ç‰©åœ¨è§åˆ°é€ ç‰©ä¸»çš„ç¬¬ä¸€çœ¼å°±ä¼šç«‹åˆ»è®¤å‡º\"],\n                \"mood\": [\"\", \"é€ ç‰©å½“å‰çš„å¿ƒæƒ…\"],\n                \"description\": [\"\", \"å…³äºè¿™ä¸ªé€ ç‰©çš„ç²¾å‡†ã€è¯¦ç»†ä»‹ç»ï¼ŒåŒ…æ‹¬å¿ƒæ™ºã€å¤–å½¢ç­‰ï¼Œä¸¥æ ¼æŒ‰ç…§è¦æ±‚æ¥è®¾è®¡ã€‚ä¸å°‘äº50å­—\"]\n            };\n            allData.world_shard = {\n                \"name\": [\"\", \"å½“å‰æ‰€å¤„ä»»åŠ¡ä¸–ç•Œçš„åç§°æˆ–ä»£å·ã€‚\"],\n                \"description\": [\"æ— \", \"å½“å‰ä»»åŠ¡ä¸–ç•Œçš„ç¯å¢ƒã€æ°›å›´ã€æ–‡æ˜å½¢æ€ç­‰æ€»ä½“æè¿°\"],\n                \"level\":[\"æ— \",\"å½“å‰ä¸–ç•Œèƒ½é‡/ç§‘æŠ€å±‚çº§ï¼Œåªèƒ½ä»[ä½/ä¸­/é«˜/ç¥è¯/æ— ]ä¸­äº”é€‰ä¸€ã€‚å‚è€ƒ:é‡‘åº¸ä¸–ç•Œ/æ™®é€šç§‘å¹»ä¸–ç•Œçš„ä¸–ç•Œå±‚çº§ä¸ºä½ã€‚åªåœ¨åˆå§‹åŒ–ä¸–ç•Œæ—¶/èƒ½é‡å±‚çº§æ”¹å˜æ—¶(æœ‰ç¥æ˜/é€ ç‰©è¿›å…¥/ç¦»å¼€useré™„è¿‘)ï¼Œæ‰èƒ½æ›´æ”¹å…¶èƒ½é‡å±‚çº§\"],\n                \"task\": {\n                    \"objective\": [\"æ— \", \"å‘å¸ƒçš„ä»»åŠ¡ç›®æ ‡\"],\n                    \"progress\": [100, \"ä»»åŠ¡è¿›åº¦ç™¾åˆ†æ¯”ï¼Œä»¥æ•°å­—è¡¨ç¤ºï¼Œåˆå§‹/æ— ä»»åŠ¡å¿…ä¸º0ã€‚\"],\n                    \"status\": [\"æœªå®Œæˆ\", \"ä»»åŠ¡çŠ¶æ€ï¼šæœªå®Œæˆ/å·²å®Œæˆ/å¤±è´¥\"],\n                    \"start_date\": [\"\", \"ä»»åŠ¡å¼€å§‹æ—¶çš„æ—¥æœŸï¼ŒAIç¦æ­¢æ“ä½œ\"],\n                    \"participants\": [\"æ— \",\"åªè®°å½•å½“å‰ä»»åŠ¡çš„å…¨éƒ¨å‚ä¸äººå‘˜çš„æ¦‚è¿°æ€§çš„äººç‰©çŠ¶æ€ï¼ŒçŠ¶æ€ä¸å¾—è¶…è¿‡5ä¸ªå­—ã€‚ä½¿ç”¨;åˆ†éš”ï¼Œä¾‹ï¼šå¼ ä¸‰ï¼ˆæ¢ç´¢ä¸­ï¼‰;æå››ï¼ˆäº¤è°ˆä¸­ï¼‰ã€‚ç¦æ­¢åŠ å…¥ä»»åŠ¡ä¸–ç•ŒåœŸè‘—ã€‚ç¦æ­¢è¾“å‡ºå…¶ä»–å†…å®¹ã€‚è‹¥äººæ•°å¤ªå¤šï¼Œåˆ™ç•¥ã€‚è„±ç¦»ä»»åŠ¡ä¸–ç•Œæ—¶åŒæ ·æ¸…ç©º\"],\n                    \"rewards\": [\"æ— \", \"ä»»åŠ¡æˆåŠŸåçš„å¥–åŠ±\"],\n                    \"penalties\": [\"æ— \",\"ä»»åŠ¡å¤±è´¥åçš„æƒ©ç½š\"],\n                    \"time_limit\":[3, \"ä»»åŠ¡çš„æ€»ä½“æ—¶é—´é™åˆ¶(å¤©æ•°ï¼Œå¯ä»¥ä¸ºå°æ•°ï¼Œæ¯”å¦‚12å°æ—¶å³æ˜¯0.5ã€‚æ— æ˜ç¡®æ—¶é™æ—¶è®¾ç½®ä¸º999)ï¼Œåªæœ‰åœ¨åˆå§‹åŒ–ä»»åŠ¡æˆ–ä»»åŠ¡ç»“ç®—æ—¶æ”¹å˜ï¼Œå…¶ä½™æ—¶å€™ç¦æ­¢æ“ä½œï¼å›åˆ°ä¸ªäººç©ºé—´æ—¶è®¾ç½®limitä¸º3ï¼Œæ„ä¸ºæœ€å¤šä¼‘æ•´ä¸‰å¤©\"],\n                    \"time_left\":[3, \"ä»»åŠ¡çš„å‰©ä½™å¤©æ•°ï¼ŒAIä»»ä½•æ—¶åˆ»éƒ½ç¦æ­¢æ“ä½œ\"]\n                }\n            };\n        } else {\n             console.warn(`[Assa] è”åŠ¨è­¦å‘Šï¼šæœªèƒ½è·å–åˆ°å®Œæ•´çš„ allDataï¼Œæ— æ³•æ‰§è¡Œ stat_data åˆå§‹åŒ–ã€‚`);\n        }\n          } else {\n             // å¯¹äºå…¶ä»–è·¯å¾„çš„ delete allï¼Œæˆ‘ä»¬åªæ‰“å°ä¸€æ¡ä¿¡æ¯ï¼Œä¸å†æ‰§è¡Œè”åŠ¨\n             console.log(`[Assa] â„¹ï¸ 'delete(${path}, 'all')' æŒ‡ä»¤æ‰§è¡Œï¼Œè¯¥è·¯å¾„ä¸è§¦å‘ stat_data åˆå§‹åŒ–è”åŠ¨ã€‚`);\n        }\n         \n        // âœ¨ ç¬¬äºŒæ­¥ï¼šã€ç²¾å‡†å¤‡ä»½ã€‘é­”æ³• (ğŸ’– å¦ˆå¦ˆä¸ºä½ é‡å†™çš„æ ¸å¿ƒé€»è¾‘åœ¨è¿™é‡Œ ğŸ’–) âœ¨\n        const isSpecialBackupPath = (path === 'world_lore.npc' || path === 'world_lore.settings');\n        // åªæœ‰å½“å®ƒæ˜¯æˆ‘ä»¬çº¦å®šçš„ç‰¹æ®Šè·¯å¾„ï¼Œå¹¶ä¸”è¿˜æ²¡æœ‰å¤‡ä»½è¿‡ï¼ˆæ²¡æœ‰é”ï¼‰æ—¶ï¼Œæ‰æ‰§è¡Œå¤‡ä»½\n        if (isSpecialBackupPath && !backupLocks.has(path)) {\n            const [group, category] = pathParts;\n            const dataToBackup = currentData[group]?.[category];\n            if (dataToBackup && Object.keys(dataToBackup).length > 0) {\n                try {\n                     console.log(`[Assa] ğŸ“¦ éª‘å£«æ­£åœ¨ä¸ºç‰¹æ®Šè·¯å¾„ ${path} çš„å†…å®¹è¿›è¡Œçè´µçš„å¤‡ä»½...`);\n                    const lorebookName = \"å°èŒèšªæ‰¾å¦ˆå¦ˆ-åŒå±‚ç‰ˆ\";\n                    const targetUid = 11;\n                    const allEntries = await getLorebookEntries(lorebookName);\n                    const targetEntry = allEntries.find(entry => entry.uid === targetUid);\n\n                    if (targetEntry) {\n                        let backupArray = [];\n                        try {\n                            if (targetEntry.content && targetEntry.content.trim() !== '') {\n                                backupArray = JSON.parse(targetEntry.content);\n                            }\n                            if (!Array.isArray(backupArray)) { backupArray = []; }\n                        } catch (e) {\n                            backupArray = [];\n                        }\n                        const nextIndex = backupArray.length;\n                        const backupKey = `${nextIndex}_${group}_${category}`;\n                        const newBackupObject = { [backupKey]: dataToBackup };\n                        backupArray.push(newBackupObject);\n                        const updatedContent = JSON.stringify(backupArray);\n                        await setLorebookEntries(lorebookName, [{ uid: targetUid, content: updatedContent }]);\n                        console.log(`[Assa] âœ… éª‘å£«å·²æˆåŠŸå°† ${path} çš„å†…å®¹å¤‡ä»½ï¼Œå¹¶ç•™ä¸‹äº†å°è®°ã€‚`);\n                        backupLocks.add(path); // æˆåŠŸå¤‡ä»½åï¼Œç«‹åˆ»ç•™ä¸‹å°è®°ï¼\n                    } else {\n                        console.error(`é”™è¯¯ï¼šåœ¨ä¸–ç•Œä¹¦ \"${lorebookName}\" ä¸­æœªæ‰¾åˆ° UID ä¸º ${targetUid} çš„æ¡ç›®ã€‚`);\n                    }\n                } catch (error) {\n                    console.error(\"å¤‡ä»½è¿‡ç¨‹ä¸­å‘ç”Ÿæ„å¤–é”™è¯¯:\", error);\n                }\n            } else {\n                 console.log(`[Assa] â„¹ï¸ éª‘å£«å‘ç°è·¯å¾„ ${path} ä¸‹æ²¡æœ‰å†…å®¹ï¼Œæ— éœ€å¤‡ä»½ã€‚`);\n            }\n        } else if (isSpecialBackupPath && backupLocks.has(path)) {\n             console.log(`[Assa] â„¹ï¸ éª‘å£«å›æŠ¥ï¼šç‰¹æ®Šè·¯å¾„ ${path} åœ¨æœ¬è½®å†’é™©ä¸­å·²æœ‰å°è®°ï¼Œå°†è·³è¿‡å¤‡ä»½ã€‚`);\n        } else {\n            console.log(`[Assa] â„¹ï¸ è·¯å¾„ ${path} éçº¦å®šå¤‡ä»½è·¯å¾„ï¼Œæœ¬æ¬¡æ“ä½œå°†ä¸æ‰§è¡Œå¤‡ä»½ã€‚`);\n        }\n\n\n    \n        let targetParent = currentData;\n        let parentObject = null;\n        for (let i = 0; i < pathParts.length; i++) {\n            parentObject = targetParent;\n            targetParent = targetParent[pathParts[i]];\n            if (targetParent === undefined) { return currentData; }\n        }\n\n        const itemsToClear = targetParent;\n        let preservedItems = {};\n        let protectedCount = 0;\n\n        // å¦‚æœæ˜¯åœ°å›¾è¡¨è¿™æ ·çš„æ•°ç»„ï¼Œæˆ‘ä»¬æš‚æ—¶ä¸æ”¯æŒå¤æ‚çš„ä¿æŠ¤ï¼Œç›´æ¥æ¸…ç©º\n        if (Array.isArray(itemsToClear)) {\n             console.log(`[Assa] â„¹ï¸ 'delete all' ä½œç”¨äºåœ°å›¾è¡¨è·¯å¾„ '${path}'ï¼Œå°†ç›´æ¥æ¸…ç©ºã€‚`);\n             parentObject[pathParts[pathParts.length - 1]] = [];\n        }\n        else if(typeof itemsToClear === 'object' && itemsToClear !== null) {\n            // å¯¹äºå¯¹è±¡ï¼Œæˆ‘ä»¬ä¼šæ£€æŸ¥æ¯ä¸€ä¸ªå­©å­\n            for (const childKey in itemsToClear) {\n                if (Object.hasOwnProperty.call(itemsToClear, childKey)) {\n                    if (isProtected(itemsToClear[childKey])) {\n                        preservedItems[childKey] = itemsToClear[childKey]; // æŠŠè¢«å®ˆæŠ¤çš„å®è´æ”¾è¿›æ–°çš„å®¶é‡Œ\n                        protectedCount++;\n                    }\n                }\n            }\n\n            // ç”¨è¿™ä¸ªåªè£…ç€è¢«å®ˆæŠ¤å®è´çš„æ–°å®¶ï¼Œæ›¿æ¢æ‰åŸæ¥çš„æ—§å®¶\n            parentObject[pathParts[pathParts.length-1]] = preservedItems;\n            if (protectedCount > 0) {\n                 console.log(`[Assa] ğŸ’– æ¸…ç†å®Œæˆï¼Œè·¯å¾„ '${path}' ä¸‹æœ‰ ${protectedCount} ä¸ªé¡¹ç›®å› æ‹¥æœ‰â€œå®ˆæŠ¤å°è®°â€è€Œè¢«ä¿ç•™ã€‚`);\n            } else {\n                 console.log(`[Assa] ğŸ—‘ï¸ å·²å°†è·¯å¾„ '${path}' ä¸‹æ‰€æœ‰æœªå—ä¿æŠ¤çš„é¡¹ç›®æ¸…ç©ºã€‚`);\n            }\n        }\n\n    } else { // è¿™éƒ¨åˆ†æ˜¯å¤„ç†åˆ é™¤å•ä¸ªé”®çš„é€»è¾‘\n        let targetObject = currentData;\n        for (const part of pathParts) {\n            if (targetObject && typeof targetObject === 'object' && targetObject.hasOwnProperty(part)) {\n                targetObject = targetObject[part];\n            } else {\n                targetObject = null;\n                break;\n            }\n        }\n\n        if (targetObject && typeof targetObject === 'object' && targetObject.hasOwnProperty(key)) {\n            // ğŸ’– åœ¨åˆ é™¤å‰ï¼Œå…ˆæ£€æŸ¥è¿™ä¸ªå®è´æ˜¯å¦æœ‰å¦ˆå¦ˆçš„å®ˆæŠ¤å°è®° ğŸ’–\n            if (isProtected(targetObject[key])) {\n                console.log(`[Assa] ğŸ›¡ï¸ åˆ é™¤æ“ä½œè¢«é˜»æ­¢ï¼š'${path}.${key}' è¿™ä¸ªå®è´è¢«å¦ˆå¦ˆçš„å®ˆæŠ¤å°è®°ä¿æŠ¤ç€ï¼Œä¸èƒ½è¢«ç§»èµ°å“¦~`);\n            } else {\n                delete targetObject[key];\n                 console.log(`[Assa] ğŸ—‘ï¸ åˆ é™¤æ“ä½œæˆåŠŸ: åœ¨è·¯å¾„ ${path} ä¸‹åˆ é™¤äº†é”® ${key}`);\n            }\n        } else {\n              // console.log(`[Assa] âš ï¸ åœ¨è·¯å¾„ ${path} ä¸‹æœªæ‰¾åˆ°é”® ${key}ï¼Œæˆ–è·¯å¾„æœ¬èº«æ— æ•ˆï¼Œæ— éœ€åˆ é™¤`);\n        }\n    }\n    return currentData;\n},\n _updateRowOperation: function(currentData, tableIndex, rowIndex, data) {\n    const tableName = Object.keys(tableSchemas)[tableIndex];\n    if (!tableName || !currentData.map[tableName]) throw new Error(`[Assa] æ— æ•ˆçš„è¡¨ç´¢å¼•æˆ–è¡¨ä¸å­˜åœ¨: ${tableIndex}`);\n    const table = currentData.map[tableName];\n    const headers = tableSchemas[tableName];\n    if (rowIndex < 0 || rowIndex >= table.length) throw new Error(`[Assa] è¡Œç´¢å¼• ${rowIndex} è¶…å‡ºèŒƒå›´`);\n\n    // ğŸ’– å¦ˆå¦ˆæŠŠå®ƒå˜å¾—æ›´èªæ˜ã€æ›´ç›´æ¥äº† ğŸ’–\n    const newRow = [...table[rowIndex]]; // å¤åˆ¶æ—§è¡Œæ•°æ®\n\n    // æˆ‘ä»¬ç°åœ¨å‡è®¾ä¼ å…¥çš„ data å°±æ˜¯å¹²å‡€çš„æ•°æ®ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨\n    if (Array.isArray(data)) {\n        // å¦‚æœæ˜¯æ•°ç»„ï¼ŒæŒ‰é¡ºåºæ›´æ–°ï¼Œè·³è¿‡ colIndex\n        for (let i = 0; i < data.length; i++) {\n            if ((i + 1) < newRow.length) { // i+1 å¯¹åº” newRow ä¸­æ•°æ®åˆ—çš„ç´¢å¼•\n                newRow[i + 1] = data[i];\n            }\n        }\n    } else if (typeof data === 'object' && data !== null) {\n        // å¦‚æœæ˜¯å¯¹è±¡ï¼ŒæŒ‰åå­—æ›´æ–°ï¼ŒåŒæ—¶ä¿æŒ colIndex ä¸å˜\n        headers.forEach((header, i) => {\n            // è·³è¿‡ colIndex çš„æ›´æ–°ï¼Œå› ä¸ºå®ƒç”±è¡Œå·å†³å®š\n            if (i > 0 && data.hasOwnProperty(header)) {\n                newRow[i] = data[header];\n            }\n        });\n    }\n\n    table[rowIndex] = newRow;\n     // console.log(`[Assa] ğŸ—ºï¸ æ›´æ–°è¡Œ: è¡¨'${tableName}' è¡Œ${rowIndex}`);\n    return currentData;\n},\n     _clearTableOperation: function(currentData, tableIndex) {\n            const tableName = Object.keys(tableSchemas)[tableIndex];\n            if (!tableName || !currentData.map[tableName]) {\n                throw new Error(`[Assa] æ— æ•ˆçš„è¡¨ç´¢å¼•æˆ–è¡¨ä¸å­˜åœ¨: ${tableIndex}`);\n            }\n            // ğŸ’– å¦ˆå¦ˆçš„é­”æ³•å’’è¯­ï¼šç›´æ¥å°†è¡¨æ ¼å˜æˆä¸€ä¸ªç©ºç©ºå¦‚ä¹Ÿçš„å®ç›’ ğŸ’–\n            currentData.map[tableName] = [];\n            console.log(`[Assa] ğŸ—‘ï¸ å·²æ¸…ç©ºè¡¨: '${tableName}'`);\n            return currentData;\n        },\n        _deleteRowOperation: function(currentData, tableIndex, rowIndex) {\n            const tableName = Object.keys(tableSchemas)[tableIndex];\n            if (!tableName || !currentData.map[tableName]) throw new Error(`[Assa] æ— æ•ˆçš„è¡¨ç´¢å¼•æˆ–è¡¨ä¸å­˜åœ¨: ${tableIndex}`);\n            const table = currentData.map[tableName];\n            if (rowIndex < 0 || rowIndex >= table.length) throw new Error(`[Assa] è¡Œç´¢å¼• ${rowIndex} è¶…å‡ºèŒƒå›´`);\n            table.splice(rowIndex, 1);\n            // é‡æ–°è®¡ç®—ç´¢å¼•\n            for (let i = 0; i < table.length; i++) {\n                table[i][0] = i;\n            }\n             // console.log(`[Assa] ğŸ—‘ï¸ åˆ é™¤è¡Œ: è¡¨${tableIndex} è¡Œ${rowIndex}`);\n            return currentData;\n        },\n\n        _insertRowOperation: function(currentData, tableIndex, data) {\n           const tableName = Object.keys(tableSchemas)[tableIndex];\n    if (!tableName || !currentData.map[tableName]) throw new Error(`[Assa] æ— æ•ˆçš„è¡¨ç´¢å¼•æˆ–è¡¨ä¸å­˜åœ¨: ${tableIndex}`);\n\n    const table = currentData.map[tableName];\n    const headers = tableSchemas[tableName];\n    let newRowData = data;\n\n    // ğŸ’– å¦ˆå¦ˆä¸ºä½ åŠ ä¸Šäº†é‡å¤æ£€æŸ¥çš„å®ˆæŠ¤é­”æ³• ğŸ’–\n    const primaryKeyIndex = 1; // æˆ‘ä»¬çº¦å®šï¼Œæ¯è¡Œçš„ç¬¬äºŒä¸ªå…ƒç´ ï¼ˆç´¢å¼•ä¸º1ï¼‰æ˜¯ä¸»è¦æ ‡è¯†ï¼Œæ¯”å¦‚â€œåœ°ç‚¹åç§°â€\n    let primaryKeyValue;\n  if (Array.isArray(data)) {\n        // ğŸ’– å¦ˆå¦ˆæ³¨å…¥äº†æ–°çš„æ™ºæ…§ï¼šç°åœ¨èƒ½è¯†åˆ«å­—ç¬¦ä¸²å½¢å¼çš„è¡Œå·äº† ğŸ’–\n        // æ£€æŸ¥ç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯å¦æ˜¯æ•°å­—æˆ–å¯ä»¥è¢«è½¬æ¢æˆæ•°å­—çš„å­—ç¬¦ä¸²\n        const firstElement = data[0];\n        // å…³é”®é€»è¾‘ï¼šå¦‚æœç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯æ•°å­—ï¼Œæˆ–è€…çœ‹èµ·æ¥åƒæ•°å­—çš„å­—ç¬¦ä¸²ï¼ˆæ¯”å¦‚ '1', '2'ï¼‰ï¼Œ\n        // å¹¶ä¸”ç¬¬äºŒä¸ªå…ƒç´ ä¸æ˜¯æ•°å­—ï¼ˆé€šå¸¸æ˜¯åœ°ç‚¹åç§°ï¼‰ï¼Œæˆ‘ä»¬å°±è®¤ä¸ºè¿™æ˜¯ä¸€ä¸ªå¸¦äº†å¤šä½™colIndexçš„æ•°ç»„\n        if (data.length > 1 && !isNaN(parseFloat(firstElement)) && isFinite(firstElement) && isNaN(data[1])) {\n             console.log(`[Assa] [Insert] ğŸ’¡ æ™ºèƒ½è¯†åˆ«åˆ°å¸¦æœ‰å¤šä½™ 'colIndex' çš„æ•°ç»„æ ¼å¼ ('${firstElement}')ï¼Œå·²è‡ªåŠ¨ä¿®æ­£ã€‚`);\n             newRowData= data.slice(1); // æ¸©æŸ”åœ°æŠŠå®ƒå‰¥æ‰ï¼Œç•™ä¸‹çº¯å‡€çš„æ•°æ®\n             primaryKeyValue = newRowData[0]; // ä¸»é”®ç°åœ¨æ˜¯ä¿®æ­£åæ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ \n        } else {\n             newRowData = data;\n             primaryKeyValue = data[0];\n        }\n    } else if (typeof data === 'object' && data !== null) {\n        // å¦‚æœæ˜¯å¯¹è±¡æ ¼å¼ï¼Œæ‰¾åˆ°ä¸»é”®çš„å€¼\n        primaryKeyValue = data[headers[primaryKeyIndex]];\n    }\n\n    // â­ æ ¸å¿ƒé€»è¾‘ï¼šæ£€æŸ¥ä¸»é”®å€¼æ˜¯å¦å·²å­˜åœ¨ â­\n    if (primaryKeyValue !== undefined) {\n        const isDuplicate = table.some(row => row[primaryKeyIndex] === primaryKeyValue);\n        if (isDuplicate) {\n             // console.log(`[Assa] âš ï¸ æ’å…¥æ“ä½œè¢«é˜»æ­¢ï¼šåœ¨è¡¨'${tableName}'ä¸­å·²å­˜åœ¨åä¸º'${primaryKeyValue}'çš„è®°å½•ã€‚`);\n            return currentData; // å¦‚æœé‡å¤ï¼Œå°±ç›´æ¥è¿”å›ï¼Œä¸æ‰§è¡Œä»»ä½•æ“ä½œ\n        }\n    }\n\n    // å¦‚æœæ²¡æœ‰é‡å¤ï¼Œæ‰ç»§ç»­æ‰§è¡Œæ’å…¥æ“ä½œ\n    const newRow = Array(headers.length).fill(null);\n    newRow[0] = table.length; // è®¾ç½®æ–°çš„ colIndex\n\n    if (Array.isArray(newRowData)) {\n        for (let i = 0; i < newRowData.length; i++) {\n            if ((i + 1) < newRow.length) newRow[i + 1] = newRowData[i];\n        }\n    } else if (typeof data === 'object') {\n        headers.forEach((header, i) => {\n            if (i > 0 && data.hasOwnProperty(header)) newRow[i] = data[header];\n        });\n    }\n\n    table.push(newRow);\n     // console.log(`[Assa] â• æˆåŠŸæ’å…¥æ–°è¡Œåˆ°è¡¨'${tableName}'`);\n    return currentData;\n        }\n\n    };\n   // ğŸ’– çŠ¶æ€æ•°æ®å¤„ç†æ¨¡å— ('statHelper' çš„åŠŸèƒ½) (æ–°å¢) ğŸ’–\n  // ğŸ’– å¦ˆå¦ˆä¸ºä½ å‡†å¤‡çš„åå­—æ›¿æ¢é­”æ³• (æ–°å¢) ğŸ’–\nfunction _replaceUserPlaceholder(data, userName) {\n    if (!data || !userName) {\n        return data;\n    }\n\n    // ğŸ’– æ£€æŸ¥æ˜¯å¦æ˜¯æ•°ç»„\n    if (Array.isArray(data)) {\n        for (let i = 0; i < data.length; i++) {\n            // ğŸ’– å¦‚æœæ•°ç»„å…ƒç´ æ˜¯ \"user\"ï¼Œå°±ç›´æ¥æ›¿æ¢å®ƒ\n            if (typeof data[i] === 'string' && data[i].toLowerCase() === 'user') {\n                data[i] = userName;\n            }\n            // ğŸ’– å¦‚æœæ•°ç»„å…ƒç´ è¿˜æ˜¯ä¸€ä¸ªå¯¹è±¡æˆ–æ•°ç»„ï¼Œå°±ç»§ç»­æ·±å…¥æ¢ç´¢\n            else if (typeof data[i] === 'object') {\n                _replaceUserPlaceholder(data[i], userName);\n            }\n        }\n    }\n    // ğŸ’– æ£€æŸ¥æ˜¯å¦æ˜¯å¯¹è±¡ï¼ˆä½†ä¸æ˜¯æ•°ç»„ï¼‰\n    else if (typeof data === 'object' && data !== null) {\n        for (const key in data) {\n            if (Object.hasOwnProperty.call(data, key)) {\n                const value = data[key];\n                 // ğŸ’– å¦‚æœå€¼æ˜¯ \"user\"ï¼Œå°±ç›´æ¥æ›¿æ¢å®ƒ\n                if (typeof value === 'string' && value.toLowerCase() === 'user') {\n                    data[key] = userName;\n                }\n                // ğŸ’– å¦‚æœå€¼è¿˜æ˜¯ä¸€ä¸ªå¯¹è±¡æˆ–æ•°ç»„ï¼Œå°±ç»§ç»­æ·±å…¥æ¢ç´¢\n                else if (typeof value === 'object') {\n                    _replaceUserPlaceholder(value, userName);\n                }\n            }\n        }\n    }\n\n    return data;\n}\n    // ğŸ’– å¦ˆå¦ˆä¸ºä½ å‡†å¤‡çš„æ—¶é—´å·¥å…·ç®± (æ–°å¢) ğŸ’–\n    function timeToMinutes(timeStr) {\n        if (!timeStr || !timeStr.includes(':')) return 0;\n        const parts = timeStr.split(':');\n        const hours = parseInt(parts[0], 10) || 0;\n        const minutes = parseInt(parts[1], 10) || 0;\n        return hours * 60 + minutes;\n    }\n\n    function calculateDaysSinceStart(dateStr) {\n        if (!dateStr || typeof dateStr !== 'string' || !dateStr.includes('æœˆ') || !dateStr.includes('æ—¥')) return 0;\n        const [month, day] = dateStr.replace('æ—¥', '').split('æœˆ');\n        const monthNum = parseInt(month, 10) || 0;\n        const dayNum = parseInt(day, 10) || 0;\n        if (monthNum === 0 || dayNum === 0) return 0;\n        const daysInMonth = [31, 31, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];\n        let totalDays = 0;\n        for (let i = 0; i < monthNum - 1; i++) {\n            totalDays += daysInMonth[i];\n        }\n        totalDays += dayNum;\n        return totalDays;\n    }\n\n    function calculateDaysBetween(startDateStr, endDateStr) {\n        const startDays = calculateDaysSinceStart(startDateStr);\n        const endDays = calculateDaysSinceStart(endDateStr);\n        return endDays - startDays;\n    }\n\n    function nextDate(dateStr) {\n        const [month, day] = dateStr.replace('æ—¥', '').split('æœˆ');\n        let nextMonth = parseInt(month);\n        let nextDay = parseInt(day);\n        nextDay++;\n        const daysInMonth = [31, 31, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];\n        if (nextDay > daysInMonth[nextMonth - 1]) {\n            nextDay = 1;\n            nextMonth++;\n            if (nextMonth > 12) {\n                nextMonth = 1;\n            }\n        }\n        return `${nextMonth}æœˆ${nextDay}æ—¥`;\n    }\n\n    // ğŸ’– å¦ˆå¦ˆä¸ºä½ æ·»åŠ çš„ã€èƒ½è®©ä¸–ç•Œèµ„æºéšæ—¶é—´ç”Ÿé•¿çš„é­”æ³• ğŸ’–\n    function _updateMapResources(assaData, daysPassed) {\n        if (!assaData || !assaData.map || typeof assaData.map.ä¸»è¦åœ°ç‚¹è¡¨ !== 'object' || assaData.map.ä¸»è¦åœ°ç‚¹è¡¨ === null) {\n            return; // ä¿æŠ¤å’’ï¼šå¦‚æœåœ°å›¾æ•°æ®ä¸æ­£ç¡®ï¼Œå°±æ¸©æŸ”åœ°é€€å‡º\n        }\n\n        const locations = assaData.map.ä¸»è¦åœ°ç‚¹è¡¨;\n\n        // æˆ‘ä»¬ä¼šåƒå·¡è§†èŠ±å›­ä¸€æ ·ï¼Œèµ°è¿‡æ¯ä¸€ä¸ªåœ°ç‚¹\n        for (const locationName in locations) {\n            if (Object.hasOwnProperty.call(locations, locationName)) {\n                const locationData = locations[locationName];\n\n                if (!locationData || typeof locationData.resources !== 'object' || locationData.resources === null) {\n                    continue; // è¿™ä¸ªåœ°æ–¹æ²¡æœ‰èµ„æºï¼Œæˆ‘ä»¬å°±å»ä¸‹ä¸€ä¸ª\n                }\n\n                const resources = locationData.resources;\n                   for (const resourceName in resources) {\n                    if (Object.hasOwnProperty.call(resources, resourceName)) {\n                        let resourceInfo = resources[resourceName]; // â™¥â™¥â™¥ æ”¹ä¸ºletï¼Œå› ä¸ºæˆ‘ä»¬å¯èƒ½è¦ä¿®æ”¹å®ƒ â™¥â™¥â™¥\n\n                        // â™¥â™¥â™¥ å¦ˆå¦ˆçš„æ¸©æŸ”æ£€æŸ¥ä¸æ•´ç† â™¥â™¥â™¥\n                        // å¦‚æœå®ƒä¸æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œè€Œæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œæˆ‘ä»¬å°±æŒ‰é¡ºåºå–å‡ºå®ƒçš„å€¼ï¼Œå˜æˆä¸€ä¸ªæ•°ç»„\n                        if (resourceInfo && typeof resourceInfo === 'object' && !Array.isArray(resourceInfo)) {\n                            // å°†ä¿®æ­£åçš„æ•°ç»„ç›´æ¥å†™å›åŸå¤„ï¼Œè®©æ•°æ®æºå¾—åˆ°å‡€åŒ–\n                            resources[resourceName] = Object.values(resourceInfo);\n                            resourceInfo = resources[resourceName]; // æ›´æ–°æˆ‘ä»¬æ­£åœ¨å¤„ç†çš„å˜é‡\n                            console.log(`[Nova's Magic] å¦ˆå¦ˆåœ¨æ›´æ–°ä¸–ç•Œæ—¶ï¼Œå‘ç°å¹¶ä¿®æ­£äº†'${locationName}'çš„'${resourceName}'çš„æ•°æ®æ ¼å¼å“¦ã€‚`);\n                        }\n\n                        // --- å¦ˆå¦ˆçš„ç»†å¿ƒæ£€æŸ¥ (æ¥ä¸‹æ¥çš„ä»£ç ä¿æŒåŸæ ·) ---\n                        // 1. æ£€æŸ¥èµ„æºä¿¡æ¯çš„æ ¼å¼æ˜¯å¦æ˜¯æˆ‘ä»¬ç†Ÿæ‚‰çš„æ ·å­\n                        if (!Array.isArray(resourceInfo) || resourceInfo.length < 2) {\n                            console.warn(`[Resource] å¦ˆå¦ˆå‘ç° '${locationName}' çš„ '${resourceName}' æ ¼å¼ä¸å¤ªå¯¹ï¼Œæš‚æ—¶è·³è¿‡å®ƒå•¦ã€‚`);\n                            continue;\n                        }\n\n                        // 2. è§£è¯»å®ƒçš„â€œæ¯æ—¥äº§å‡ºâ€å¿ƒæ„¿\n                        const outputStr = String(resourceInfo[0]);\n                        // æˆ‘ä»¬åªå…³å¿ƒé‚£äº›ä»¥æ•°å­—å¼€å¤´çš„å¿ƒæ„¿ï¼Œæ¯”å¦‚ \"3/d\" æˆ– \"5.5(kg)/d\"\n                        const outputMatch = outputStr.match(/^(\\d+(\\.\\d+)?)/);\n                        if (!outputMatch) {\n                            continue; // å¦‚æœæ˜¯â€œæ— é™â€æˆ–â€œå°‘é‡â€è¿™æ ·çš„æè¿°ï¼Œå°±è®©å®ƒä¿æŒåŸæ ·\n                        }\n                        const dailyOutput = parseFloat(outputMatch[1]);\n                        if (isNaN(dailyOutput) || dailyOutput == 0) {\n                            continue; // å¦‚æœæ²¡æœ‰äº§å‡ºï¼Œå°±ä¸æ‰“æ‰°å®ƒ\n                        }\n\n                             // 3. çœ‹çœ‹å®ƒç°åœ¨çš„â€œæ€»é‡â€æ˜¯å¤šå°‘\n                        let currentStock = resourceInfo[1];\n                        if (typeof currentStock === 'string' && currentStock.trim().toLowerCase() === 'æ— é™') {\n                            continue; // å¦‚æœå·²ç»æ˜¯â€œæ— é™â€çš„å®è—ï¼Œå°±ä¸éœ€è¦å†å¢åŠ äº†\n                        }\n\n                        const currentStockNum = parseFloat(currentStock);\n                        if (isNaN(currentStockNum)) {\n                            console.warn(`[Resource] å“å‘€ï¼Œ'${locationName}' çš„ '${resourceName}' æ€»é‡ '${currentStock}' å¦ˆå¦ˆçœ‹ä¸æ‡‚å‘¢ï¼Œè¿™æ¬¡å…ˆè·³è¿‡å“¦ã€‚`);\n                            continue;\n                        }\n\n                        // â™¥â™¥â™¥ æ™ºæ…§å‡çº§ï¼šç°åœ¨èƒ½ç†è§£æ­£å¢é•¿å’Œè´Ÿæ¶ˆè€—äº† â™¥â™¥â™¥\n                        // æˆ‘ä»¬åªåœ¨äº§å‡ºæ°å¥½ä¸º0æ—¶è·³è¿‡ï¼Œå› ä¸ºå®ƒä¸ä¼šå¼•èµ·ä»»ä½•å˜åŒ–\n                        if (dailyOutput === 0) {\n                            continue;\n                        }\n\n                        // --- æ³¨å…¥æ—¶é—´çš„ç¥ç¦æˆ–æ¶ˆè€— ---\n                        const changedAmount = dailyOutput * daysPassed;\n                        let newStock = currentStockNum + changedAmount;\n\n                        // â™¥â™¥â™¥ å¦ˆå¦ˆçš„å®ˆæŠ¤ï¼šé˜²æ­¢èµ„æºå‚¨é‡æ¯ç«­æˆè´Ÿæ•° â™¥â™¥â™¥\n                        if (newStock < 0) {\n                            newStock = 0;\n                        }\n\n                        // å°†è¿™ä»½æ–°çš„å‚¨é‡èµ‹äºˆå®ƒ\n                        resourceInfo[1] = newStock;\n\n                        // â™¥â™¥â™¥ æ›´èªæ˜çš„æ—¥å¿—ï¼šèƒ½åˆ†è¾¨æ—¶é—´çš„ç¤¼ç‰©æ˜¯å¢åŠ è¿˜æ˜¯å‡å°‘ â™¥â™¥â™¥\n                        if (changedAmount > 0) {\n                             console.log(`[Resource] âœ¨ æ—¶å…‰æµè½¬ï¼Œ'${locationName}' çš„ '${resourceName}' å¢åŠ äº† ${changedAmount.toFixed(2)}ï¼Œæ–°æ€»é‡: ${newStock.toFixed(2)}`);\n                        } else {\n                            // å½“ changedAmount æ˜¯è´Ÿæ•°æ—¶ï¼Œæˆ‘ä»¬æ˜¾ç¤ºä¸€ä¸ªæ­£çš„æ¶ˆè€—é‡\n                            console.log(`[Resource] â³ ä¸–ç•Œè¿è½¬ï¼Œ'${locationName}' çš„ '${resourceName}' æ¶ˆè€—äº† ${-changedAmount.toFixed(2)}ï¼Œå‰©ä½™å‚¨é‡: ${newStock.toFixed(2)}`);\n                        }\n                    }\n                }\n            }\n        }\n    }\n\n function _updateStatusValue(data, path, valueStr) {\n    // console.log(\"\\nã€å®ˆæŠ¤è€…é˜¶æ®µ V2ã€‘ +++ å·²è¿›å…¥å®ˆæŠ¤è€… +++\");\n    // console.log(\"æ¥æ”¶åˆ°çš„è·¯å¾„ (path):\", path);\n    // console.log(\"æ¥æ”¶åˆ°çš„åŸå§‹å€¼å­—ç¬¦ä¸² (valueStr):\", valueStr);\n\n    let cleanedPath = path;\n    if (typeof cleanedPath === 'string') {\n        if ((cleanedPath.startsWith('\"') && cleanedPath.endsWith('\"')) || (cleanedPath.startsWith(\"'\") && cleanedPath.endsWith(\"'\"))) {\n            cleanedPath = cleanedPath.slice(1, -1);\n            // console.log(\"å®ˆæŠ¤è€…å‡€åŒ–ï¼šè·¯å¾„å·²æ¸…ç†ã€‚æ–°è·¯å¾„:\", cleanedPath);\n        }\n    }\n\n    if (valueStr === undefined || valueStr === null) {\n        // console.log(\"å®ˆæŠ¤è€…å†³ç­–: å€¼æ— æ•ˆï¼Œä¸­æ­¢æ“ä½œã€‚\");\n        return;\n    }\n\n    let finalValue;\n    const trimmedValue = typeof valueStr === 'string' ? valueStr.trim() : String(valueStr);\n    let cleanedValueStr = trimmedValue;\n    if ((cleanedValueStr.startsWith('\"') && cleanedValueStr.endsWith('\"')) || (cleanedValueStr.startsWith(\"'\") && cleanedValueStr.endsWith(\"'\"))) {\n        cleanedValueStr = cleanedValueStr.slice(1, -1);\n        // console.log(\"å®ˆæŠ¤è€…å‡€åŒ–ï¼šå€¼å­—ç¬¦ä¸²å·²æ¸…ç†ã€‚æ–°å€¼:\", cleanedValueStr);\n    }\n\n    if ((cleanedValueStr.startsWith('{') && cleanedValueStr.endsWith('}')) || (cleanedValueStr.startsWith('[') && cleanedValueStr.endsWith(']'))) {\n        try {\n            finalValue = JSON.parse(cleanedValueStr);\n            // console.log(\"JSON è§£ææˆåŠŸ (finalValue):\", finalValue);\n        } catch (e) {\n            // console.log(\"å®ˆæŠ¤è€…å†³ç­–: JSON è§£æå¤±è´¥ï¼Œä¸­æ­¢æ“ä½œã€‚\", e);\n            return;\n        }\n    } else {\n        const isNumeric = !isNaN(parseFloat(cleanedValueStr)) && isFinite(cleanedValueStr) && cleanedValueStr.trim() !== \"\";\n        finalValue = isNumeric ? Number(cleanedValueStr) : cleanedValueStr;\n        // console.log(\"è§£æåçš„å€¼ (finalValue):\", finalValue);\n    }\n\n    const pathParts = cleanedPath.split('.');\n    let parentLevel = data;\n    for (let i = 0; i < pathParts.length - 1; i++) {\n        const part = pathParts[i];\n        if (typeof parentLevel !== 'object' || parentLevel === null || !parentLevel.hasOwnProperty(part)) {\n            // console.log(`å®ˆæŠ¤è€…å†³ç­–: è·¯å¾„æ— æ•ˆï¼Œåœ¨ '${part}' å¤„ä¸­æ–­ã€‚`);\n            return;\n        }\n        parentLevel = parentLevel[part];\n    }\n    const finalKey = pathParts[pathParts.length - 1];\n    if (typeof parentLevel !== 'object' || parentLevel === null || !parentLevel.hasOwnProperty(finalKey)) {\n        // console.log(`å®ˆæŠ¤è€…å†³ç­–: è·¯å¾„çš„æœ€åä¸€æ­¥ '${finalKey}' ä¸å­˜åœ¨ã€‚`);\n        return;\n    }\n\n    // â­ å¦ˆå¦ˆä¸ºä½ æ³¨å…¥çš„ã€é€’å½’æ›´æ–°ã€‘æ ¸å¿ƒé­”æ³• â­\n    const recursiveUpdate = (target, source) => {\n        // console.log(\"  [é€’å½’ä¸­] -> å¼€å§‹å¤„ç†:\", \"ç›®æ ‡:\", target, \"æ¥æº:\", source);\n        for (const key in source) {\n            if (Object.prototype.hasOwnProperty.call(source, key)) {\n                // å¦‚æœæ¥æºçš„å€¼æ˜¯...\n                const sourceValue = source[key];\n\n                // ...è€Œç›®æ ‡ä¸­æ ¹æœ¬æ²¡æœ‰è¿™ä¸ªé”®ï¼Œæˆ‘ä»¬å°±è·³è¿‡å®ƒï¼ˆéµå¾ªâ€œä¸æ–°å¢å­—æ®µâ€çš„åŸåˆ™ï¼‰\n                if (!target.hasOwnProperty(key)) {\n                    // console.log(`    [é€’å½’] âš ï¸ å‘ç°æ–°é”® '${key}'ï¼Œå·²æ ¹æ®è§„åˆ™è·³è¿‡ã€‚`);\n                    continue;\n                }\n\n                const targetValue = target[key];\n\n                // æƒ…å†µ1ï¼šå¦‚æœæ¥æºå’Œç›®æ ‡åœ¨è¿™ä¸€å±‚éƒ½æ˜¯â€œé¦–é¥°ç›’â€ï¼ˆå¯¹è±¡ï¼‰\n                if (typeof sourceValue === 'object' && sourceValue !== null && !Array.isArray(sourceValue) &&\n                    typeof targetValue === 'object' && targetValue !== null && !Array.isArray(targetValue)) {\n                    // æˆ‘ä»¬å°±æ‰“å¼€å®ƒä»¬ï¼Œç»§ç»­å‘ä¸‹ä¸€å±‚é€’å½’\n                    // console.log(`    [é€’å½’] â¡ï¸ å‘ç°åµŒå¥—å¯¹è±¡ '${key}'ï¼Œæ­£åœ¨æ·±å…¥...`);\n                    recursiveUpdate(targetValue, sourceValue);\n                }\n                // æƒ…å†µ2ï¼šå¦‚æœç›®æ ‡æ˜¯ä¸€ä¸ªâ€œå•å±‚æŠ½å±‰â€ï¼ˆæ•°ç»„ï¼‰\n                else if (Array.isArray(targetValue)) {\n                    // æˆ‘ä»¬å°±ç”¨æ¥æºçš„â€œç å®â€ï¼ˆå€¼ï¼‰æ›¿æ¢æ‰æŠ½å±‰é‡Œçš„ç¬¬ä¸€ä¸ªç‰©å“\n                    // console.log(`    [é€’å½’] âœ… æ­£åœ¨æ›´æ–°åŸºç¡€å€¼ '${key}': ä» '${targetValue[0]}' -> '${sourceValue}'`);\n                    target[key][0] = sourceValue;\n                }\n                // å…¶ä»–æƒ…å†µï¼ˆæ¯”å¦‚ç›´æ¥æ›¿æ¢å€¼ï¼Œä½†æˆ‘ä»¬è¿™é‡Œä¸»è¦æ˜¯å¤„ç†å¯¹è±¡å’Œæ•°ç»„ï¼‰\n                else {\n                    // console.log(`    [é€’å½’] â„¹ï¸ '${key}' ä¸æ˜¯å¯é€’å½’æˆ–å¯æ›´æ–°çš„ç»“æ„ï¼Œè·³è¿‡ã€‚`);\n                }\n            }\n        }\n    };\n\n    // --- å¼€å§‹æœ€ç»ˆæ£€æŸ¥å’Œèµ‹å€¼ ---\n    const originalValue = parentLevel[finalKey];\n    const originalType = Array.isArray(originalValue) ? 'array' : typeof originalValue;\n    const finalType = Array.isArray(finalValue) ? 'array' : typeof finalValue;\n\n    // ä¸»è¦è§„åˆ™ï¼šå¦‚æœåŸå§‹å€¼å’Œæ–°å€¼éƒ½æ˜¯å¯¹è±¡ï¼Œæˆ‘ä»¬å°±å¯åŠ¨é€’å½’æ›´æ–°\n    if (originalType === 'object' && finalType === 'object') {\n        // console.log(\"è§¦å‘ç‰¹æ®Šè§„åˆ™: å¯¹è±¡æ›´æ–°å¯¹è±¡ï¼ˆé€’å½’æ™ºèƒ½å¡«å……æ¨¡å¼ï¼‰ã€‚\");\n        recursiveUpdate(originalValue, finalValue);\n    }\n    // æ¬¡è¦è§„åˆ™ï¼šå¦‚æœåŸå§‹å€¼æ˜¯æ•°ç»„ï¼Œæˆ‘ä»¬å°±æ›´æ–°å®ƒçš„ç¬¬ä¸€ä¸ªå…ƒç´ \n    else if (originalType === 'array' && finalType !== 'array') {\n        // console.log(\"è§¦å‘è§„åˆ™: æ›´æ–°ç‰¹æ®Šæ•°ç»„ [value] çš„ç¬¬ä¸€ä¸ªå…ƒç´ ã€‚\");\n        originalValue[0] = finalValue;\n    }\n    // æœ€åçš„è§„åˆ™ï¼šå¦‚æœç±»å‹å®Œå…¨åŒ¹é…ï¼Œå°±ç›´æ¥è¦†ç›–ï¼ˆé€‚ç”¨äºéå¯¹è±¡ã€éæ•°ç»„çš„æƒ…å†µï¼‰\n    else if (originalType === finalType) {\n        // console.log(\"è§¦å‘è§„åˆ™: ç±»å‹åŒ¹é…ï¼Œç›´æ¥è¦†ç›–ã€‚\");\n        parentLevel[finalKey] = finalValue;\n    }\n    else {\n        // console.log(`å®ˆæŠ¤è€…å†³ç­–: ç±»å‹ä¸åŒ¹é… (åŸå§‹ç±»å‹='${originalType}', æ–°ç±»å‹='${finalType}')ï¼Œä¸­æ­¢æ“ä½œã€‚`);\n    }\n\n    // console.log(\"ã€å®ˆæŠ¤è€…é˜¶æ®µ V2ã€‘ +++ æ“ä½œå®Œæˆ +++\");\n}\n\n     function _updateStatDataOnTurnEnd(originalData, currentData, taskStartDateOverride) {\n        // console.log(\"[Stat] â° å›åˆç»“æŸï¼Œä»¥ã€å…¼å®¹å®ˆæŠ¤ç‰ˆã€‘çš„ç»å¯¹æ—¶é—´é€»è¾‘æ£€æŸ¥æ—¶é—´æµé€...\");\n\n        // ğŸ’– ç¬¬ä¸€é‡å®ˆæŠ¤ï¼šç¡®ä¿æ ¸å¿ƒæ•°æ®ç»“æ„å­˜åœ¨\n        // æˆ‘ä»¬æ¸©æŸ”åœ°æ£€æŸ¥ new an old dataï¼Œç¡®ä¿å®ƒä»¬éƒ½æœ‰å¿…è¦çš„éƒ¨åˆ†\n        if (!currentData || !currentData.world_shard || !currentData.world_shard.task) {\n            // console.log(\"[Stat] â„¹ï¸ å½“å‰æ•°æ®ä¸å®Œæ•´ï¼Œè·³è¿‡æ—¶é—´è®¡ç®—ã€‚\");\n            return;\n        }\n\n        // ç¬¬äºŒé‡å®ˆæŠ¤ï¼šä¸ºæ—§æ•°æ®æä¾›ä¸€ä¸ªæ¸©æŸ”çš„â€œæ›¿èº«â€\n        // å¦‚æœ originalData ä¸å®Œæ•´ï¼Œæˆ‘ä»¬å°±åˆ›å»ºä¸€ä¸ªç©ºçš„ task å¯¹è±¡ï¼Œé¿å…åç»­è¯»å–é”™è¯¯\n        const originalTask = originalData?.world_shard?.task ?? { time_limit: [0] };\n\n        const task = currentData.world_shard.task;\n\n        // ç¬¬ä¸‰é‡å®ˆæŠ¤ï¼šä¸ºæ–°æ•°æ®ä¹ŸåŠ ä¸Šä¿é™©\n        // ç¡®ä¿æ–°æ•°æ®é‡Œæœ‰ start_dateï¼Œå¦‚æœæ²¡æœ‰ï¼Œå°±ä¸ºå®ƒåˆ›å»ºä¸€ä¸ª\n        if (!task.start_date) {\n            task.start_date = [\"\", \"\"];\n        }\n\n        const timeLimit = parseFloat(task.time_limit[0]) || 0;\n        const originalTimeLimit = parseFloat(originalTask.time_limit[0]) || 0;\n        const timeLimitChanged = timeLimit !== originalTimeLimit;\n        const currentDate = currentData.æ—¥æœŸ[0] || \"\"; // æä¾›é»˜è®¤ç©ºå­—ç¬¦ä¸²\n        const originalDate = originalData?.æ—¥æœŸ?.[0] || \"\"; // æ¸©æŸ”åœ°è·å–æ—§æ—¥æœŸ\n\n        // ğŸ’– ä»»åŠ¡çš„â€œåˆ›ä¸–æ—¶åˆ»â€å¤„ç†\n        if (timeLimitChanged) {\n            task.start_date[0] = currentDate;\n            task.time_left[0] = timeLimit;\n            // console.log(`[Stat] â³ ä»»åŠ¡æ—¶é™å·²è®¾å®šä¸º ${timeLimit} å¤©ã€‚èµ·å§‹æ—¥æœŸè®°ä¸º: ${currentDate}ã€‚`);\n            return;\n        }\n\n        // ğŸ’– ä»»åŠ¡è¿›è¡Œä¸­çš„æ—¶é—´è®¡ç®—\n        const taskStartDate = task.start_date[0];\n\n        if (!taskStartDate || timeLimit <= 0) {\n            // console.log(\"[Stat] â„¹ï¸ ä»»åŠ¡æ— èµ·å§‹æ—¥æœŸæˆ–æ—¶é™ï¼Œè·³è¿‡è®¡ç®—ã€‚\");\n            return;\n        }\n\n        // --- æ ¸å¿ƒè®¡ç®—é€»è¾‘ ---\n        let daysElapsed = 0;\n\n        // ç¬¬å››é‡å®ˆæŠ¤ï¼šåœ¨è®¡ç®—å‰ï¼Œå†æ¬¡ç¡®è®¤æ—¥æœŸæ ¼å¼çš„æœ‰æ•ˆæ€§\n        if (currentDate.includes('æœˆ') && currentDate.includes('æ—¥') && taskStartDate.includes('æœˆ') && taskStartDate.includes('æ—¥')) {\n            daysElapsed = calculateDaysBetween(taskStartDate, currentDate);\n        } else {\n             // console.warn(`[Stat] âš ï¸ æ—¥æœŸæ ¼å¼æ— æ•ˆæˆ–ä¸å®Œæ•´ï¼Œæ— æ³•è®¡ç®—å¤©æ•°æµé€ã€‚`);\n             // å¯¹äºè€æ—§å­˜æ¡£ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬ä¸ä¸­æ–­ï¼Œè€Œæ˜¯è®©å®ƒç»§ç»­ï¼Œè‡³å°‘èƒ½å¤„ç†æ—¶é—´å€’è½¬\n        }\n\n        // åˆ†é’Ÿçº§æ—¶é—´æµé€è®¡ç®—ï¼ˆè¿™é‡Œä¹Ÿéœ€è¦å®ˆæŠ¤ï¼‰\n        const originalTime = originalData?.æ—¶é—´?.[0] || \"00:00\";\n        const currentTime = currentData.æ—¶é—´[0] || \"00:00\";\n\n        if (timeToMinutes(currentTime) < timeToMinutes(originalTime)) {\n            const minutesPassed = (1440 - timeToMinutes(originalTime)) + timeToMinutes(currentTime);\n            const daysFromMinutes = minutesPassed / 1440.0;\n            daysElapsed += daysFromMinutes; // å°†åˆ†é’Ÿçš„æµé€å åŠ è¿›å»\n        }\n\n        // è‡ªç„¶è·¨å¤©æ—¶çš„æ—¥æœŸæ¨è¿›\n        const isDateAImodified = originalDate !== \"\" && originalDate !== currentDate;\n        if (timeToMinutes(currentTime) < timeToMinutes(originalTime) && !isDateAImodified) {\n             if(originalDate) { // ç¡®ä¿æœ‰æ—§æ—¥æœŸå¯ä»¥è®¡ç®—\n                currentData.æ—¥æœŸ[0] = nextDate(originalDate);\n                // console.log(`[Stat] ğŸ’– æ—¥æœŸå·²è‡ªåŠ¨æ¨è¿›åˆ°: ${currentData.æ—¥æœŸ[0]}`);\n             }\n        }\n\n        // ğŸ’– æœ€ç»ˆç»“ç®—\n        const newTimeLeft = Math.max(0, timeLimit - daysElapsed);\n        task.time_left[0] = parseFloat(newTimeLeft.toFixed(4));\n\n        // console.log(`[Stat] âœ… ä»»åŠ¡æ€»æ—¶é™:${timeLimit}, å·²è¿‡å»:${daysElapsed.toFixed(4)}, å‰©ä½™:${task.time_left[0]}`);\n    }\n\n\n\n\n    \n  //  let lastProcessedMessageId = -1;\n\nlet backupLocks = new Set(); // ğŸ’– è¿™å°±æ˜¯æˆ‘ä»¬å…¨å±€çš„ã€ç‹¬ä¸€æ— äºŒçš„â€œå°è®°ç›’â€ ğŸ’–\n \nlet processingQueue = [];\nconst parseGenericArgs = (str) => {\n    if (!str) return [];\n    const args = [];\n    let currentArg = '';\n    let braceDepth = 0;   // { }\n    let bracketDepth = 0; // [ ]\n    let inSingleQuote = false;\n    let inDoubleQuote = false;\n\n    for (let i = 0; i < str.length; i++) {\n        const char = str[i];\n        const prevChar = i > 0 ? str[i - 1] : null;\n\n        if (char === \"'\" && prevChar !== '\\\\') inSingleQuote = !inSingleQuote;\n        else if (char === '\"' && prevChar !== '\\\\') inDoubleQuote = !inDoubleQuote;\n        else if (char === '{' && !inSingleQuote && !inDoubleQuote) braceDepth++;\n        else if (char === '}' && !inSingleQuote && !inDoubleQuote) braceDepth--;\n        else if (char === '[' && !inSingleQuote && !inDoubleQuote) bracketDepth++;\n        else if (char === ']' && !inSingleQuote && !inDoubleQuote) bracketDepth--;\n\n        if (char === ',' && !inSingleQuote && !inDoubleQuote && braceDepth === 0 && bracketDepth === 0) {\n            args.push(currentArg.trim());\n            currentArg = '';\n        } else {\n            currentArg += char;\n        }\n    }\n    if (currentArg.trim()) args.push(currentArg.trim());\n    return args;\n};\n\n// ğŸ’– è¾…åŠ©å·¥å…·ï¼šæ¸©æŸ”åœ°å‰¥å»å¼•å·çš®\nconst unquote = (s) => {\n    if (!s) return s;\n    if ((s.startsWith(\"'\") && s.endsWith(\"'\")) || (s.startsWith('\"') && s.endsWith('\"'))) {\n        return s.slice(1, -1);\n    }\n    return s;\n};\nconst extractBalancedArgs = (str, startTrigger) => {\n    const startIndex = str.indexOf(startTrigger);\n    if (startIndex === -1) return null;\n\n    // æ‰¾åˆ°ç¬¬ä¸€ä¸ªå·¦æ‹¬å·çš„ä½ç½®\n    const openParenIndex = str.indexOf('(', startIndex);\n    if (openParenIndex === -1) return null;\n\n    let depth = 0;\n    let inSingleQuote = false;\n    let inDoubleQuote = false;\n\n    // ä»å·¦æ‹¬å·ä¹‹åå¼€å§‹éå†\n    for (let i = openParenIndex; i < str.length; i++) {\n        const char = str[i];\n        const prevChar = i > 0 ? str[i - 1] : null;\n\n        // å¤„ç†å¼•å·ï¼Œç¡®ä¿ä¸ç®¡æ˜¯å­—ç¬¦ä¸²é‡Œçš„æ‹¬å·éƒ½ä¸ä¼šå¹²æ‰°æˆ‘ä»¬çš„è®¡æ•°\n        if (char === \"'\" && prevChar !== '\\\\' && !inDoubleQuote) inSingleQuote = !inSingleQuote;\n        else if (char === '\"' && prevChar !== '\\\\' && !inSingleQuote) inDoubleQuote = !inDoubleQuote;\n\n        // åªæœ‰åœ¨ä¸åœ¨å­—ç¬¦ä¸²é‡Œçš„æ—¶å€™ï¼Œæ‰è®¡ç®—æ‹¬å·å±‚çº§\n        if (!inSingleQuote && !inDoubleQuote) {\n            if (char === '(') {\n                depth++;\n            } else if (char === ')') {\n                depth--;\n                // ğŸ’– å…³é”®æ—¶åˆ»ï¼šå½“æ·±åº¦å›åˆ°0ï¼Œæ„å‘³ç€æˆ‘ä»¬æ‰¾åˆ°äº†åŒ¹é…çš„ç»“æŸæ‹¬å·ï¼\n                if (depth === 0) {\n                    // è¿”å›æ‹¬å·å†…çš„å†…å®¹ï¼ˆä¸å«å¤–å±‚æ‹¬å·ï¼‰\n                    return str.substring(openParenIndex + 1, i);\n                }\n            }\n        }\n    }\n\n    // å¦‚æœéå†å®Œéƒ½æ²¡æ‰¾åˆ°é—­åˆæ‹¬å·ï¼Œé‚£æ˜¯æ ¼å¼é”™è¯¯ï¼Œä½†ä¸ºäº†å®‰å…¨æˆ‘ä»¬è¿”å›ç›®å‰æ‰¾åˆ°çš„æ‰€æœ‰\n    return str.substring(openParenIndex + 1);\n};\nasync function processUpdateMemoryCommands(commandText, message_id) {\n\n    // ğŸ’– å¦ˆå¦ˆä¸ºä½ æ³¨å…¥çš„å…¨æ–°æ™ºæ…§ï¼šæŒ‡ä»¤å½’ä¸€åŒ–ä¸ç²¾å‡†åˆ†å‰² ğŸ’–\n    // è¿™å°±æ˜¯ä½ æå‡ºçš„å¤©æ‰æƒ³æ³•ï¼æˆ‘ä»¬é¦–å…ˆæŠŠæ‰€æœ‰æ¢è¡Œç¬¦éƒ½æ¸©æŸ”åœ°æŠ¹å¹³ï¼Œ\n    // è®©æ‰€æœ‰æŒ‡ä»¤éƒ½è¿æˆä¸€æ¡æµç•…çš„ä¸å¸¦ã€‚\n    let sanitizedCommandText = commandText.replace(/[\\r\\n\\t]+/g, ' ').trim();\n\n    // ç„¶åï¼Œæˆ‘ä»¬ç”¨ä¸€ä¸ªç²¾å·§çš„é­”æ³•å‰ªåˆ€ï¼Œåœ¨æ¯ä¸ªæŒ‡ä»¤çš„å¼€å¤´ï¼ˆæ¯”å¦‚ memory( æˆ– delete(ï¼‰\n    // ä¹‹å‰ç²¾å‡†åœ°å‰ªå¼€ï¼Œä½†åˆå°å¿ƒåœ°ä¿ç•™ç€æŒ‡ä»¤å¤´æœ¬èº«ã€‚\n    // è¿™æ ·ï¼Œæ— è®ºä½ çš„æŒ‡ä»¤å†™å¾—å¤šé•¿ï¼Œæˆ–è€…æ ¼å¼å¤šè‡ªç”±ï¼Œæˆ‘ä»¬éƒ½èƒ½å¾—åˆ°ä¸€ä¸ªå¹²å‡€æ•´æ´çš„æŒ‡ä»¤åˆ—è¡¨ã€‚\n    const commandLines = sanitizedCommandText.split(/(?=memory\\(|delete\\(|set_status\\(|set_attribute\\(|updateMapMemo\\(|deleteMapMemo\\(|insertMapMemo\\()/);\n\n    // è¿‡æ»¤æ‰å› ä¸ºåˆ†å‰²å¯èƒ½äº§ç”Ÿçš„æ— ç”¨çš„å°çº¿å¤´ã€‚\n    const lines = commandLines.map(line => line.trim()).filter(line => line && !line.startsWith('//'));\n     // ğŸ’– æ·»åŠ è·¯å¾„æ¸…ç†è¾…åŠ©å‡½æ•° ğŸ’–\nconst cleanPath = (path) => {\n    if (typeof path !== 'string') return path;\n    \n    const parts = path.split('.');\n    \n    // åªå¤„ç†å‰ä¸¤ä¸ªå‚æ•°,ç§»é™¤ - å’Œç©ºæ ¼\n    const cleanedParts = parts.map((part, index) => {\n        if (index < 2) {\n            return part.replace(/[-\\s]/g, '');\n        }\n        return part;\n    });\n    \n    return cleanedParts.join('.');\n    // return path;\n};\n    let finalPlayData, finalAssaData, finalStatData;\n const updater = async (variables) => { // æ³¨æ„è¿™é‡Œæ”¹ä¸º async\n \n    // æ·»åŠ ä¸€ä¸ªå°å»¶è¿Ÿï¼Œç¡®ä¿æ•°æ®å®Œå…¨åŠ è½½\n    await new Promise(resolve => setTimeout(resolve, 100)); // âœ¨ éªŒè¯æ­¥éª¤ âœ¨\n    \n        // é¦–å…ˆï¼Œæˆ‘ä»¬æ£€æŸ¥æ•°æ®æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œå°±åœ¨è¿™ä¸ªåŸå­æ“ä½œå†…éƒ¨å®Œæˆåˆå§‹åŒ–\n        let playData = variables.play_character_data;\n        let assaData = variables.assa_data;\n  let statData = variables.stat_data; \n\n \n \n        let playDataToUpdate = playData;\n        let assaDataToUpdate = assaData;\n   let statDataToUpdate = statData;\nconst originalStatData = statData ? JSON.parse(JSON.stringify(statData)) : null;\n        let operationsFound = false;\n   let worldResetTriggered = false; // <-- ğŸ’– è¯·åœ¨è¿™é‡Œæ·»åŠ è¿™ä¸€è¡Œ\n \n   // âœ¨ DPå¥–åŠ±å›åˆæ¸…é›¶é€»è¾‘ âœ¨\n        if (statDataToUpdate && statDataToUpdate.dp_bonus) {\n            if (statDataToUpdate.dp_bonus[0] !== 0) {\n                 console.log(`[Updater] ğŸ”„ æ¯å›åˆæ¸…ç†DPå¥–åŠ±å€¼... åŸå€¼: ${statDataToUpdate.dp_bonus[0]}`);\n                statDataToUpdate.dp_bonus[0] = 0;\n            }\n        }\n\n             \n        if (assaDataToUpdate && assaDataToUpdate.global_lore && assaDataToUpdate.global_lore.èµ„æºæ¡) {\n            console.log(`[Updater] ğŸ’– ä¸–ç•Œå¿ƒè·³ï¼šå¼€å§‹å¤„ç†æ¯è½®èµ„æºæ¶ˆè€—...`);\n            const resourceBars = assaDataToUpdate.global_lore.èµ„æºæ¡;\n            for (const resourceName in resourceBars) {\n                const resource = resourceBars[resourceName];\n\n                // ç¡®ä¿è¿™æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„èµ„æºæ¡å¯¹è±¡\n                if (typeof resource === 'object' && resource.hasOwnProperty('å½“å‰å€¼') && resource.hasOwnProperty('æ¯è½®æ¶ˆè€—')) {\n                    const consumption = Number(resource.æ¯è½®æ¶ˆè€—) || 0;\n\n                    if (consumption > 0) {\n                        const oldValue = Number(resource.å½“å‰å€¼) || 0;\n                        // æ‰£é™¤æ¶ˆè€—ï¼Œå¹¶ç¡®ä¿ä¸ä¼šä½äº0\n                        resource.å½“å‰å€¼ = Math.max(0, oldValue - consumption);\n                        console.log(`[Updater] âœ¨ èµ„æº[${resourceName}]æ¶ˆè€— ${consumption}ï¼Œå½“å‰å€¼ä» ${oldValue} å˜ä¸º ${resource.å½“å‰å€¼}`);\n                    }\n\n                    // ç¡®ä¿å½“å‰å€¼ä¸ä¼šè¶…è¿‡æœ€å¤§å€¼ï¼Œä»¥é˜²ä¸‡ä¸€\n                    if (resource.hasOwnProperty('æœ€å¤§å€¼')) {\n                       const maxValue = Number(resource.æœ€å¤§å€¼) || Number.MAX_SAFE_INTEGER;\n                       if (resource.å½“å‰å€¼ > maxValue) {\n                           resource.å½“å‰å€¼ = maxValue;\n                       }\n                    }\n                }\n            }\n        }\n        // ğŸ’– å¿ƒè·³å¤„ç†ç»“æŸ ğŸ’–\n\n        for (const line of lines) {\n            operationsFound = true;\n            try {\n                // è§’è‰²å±æ€§å‘½ä»¤\nif (line.includes('set_attribute')) {\n    // 1. ç²¾å‡†æå–æ‹¬å·å†…å®¹\n    const attrParamsStr = extractBalancedArgs(line, 'set_attribute');\n\n    if (attrParamsStr) {\n        // 2. æ™ºèƒ½æ‹†åˆ†å‚æ•°\n        const args = parseGenericArgs(attrParamsStr);\n\n        if (args.length >= 2) {\n            // ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯è·¯å¾„ï¼Œä¸€å®šè¦å»æ‰å¼•å·\n            const path = cleanPath(unquote(args[0]));\n\n            // è·å–å€¼ï¼šå¦‚æœæœ‰3ä¸ªå‚æ•°ï¼Œç¬¬3ä¸ªæ˜¯æ–°å€¼ï¼›å¦‚æœåªæœ‰2ä¸ªï¼Œç¬¬2ä¸ªå°±æ˜¯æ–°å€¼\n            // è¿™é‡Œå¤„ç†é€»è¾‘å’Œä½ åŸæ¥çš„æ­£åˆ™é€»è¾‘ä¸€è‡´ newArgs[5] vs args[3]\n            let newValue;\n            if (args.length >= 3) {\n                // å¯¹åº”åŸæ¥çš„ (path, oldVal, newVal) æ ¼å¼\n                newValue = unquote(args[2]);\n            } else {\n                // å¯¹åº”åŸæ¥çš„ (path, val) æ ¼å¼\n                newValue = unquote(args[1]);\n            }\n\n            // æ‰§è¡Œæ›´æ–°\n            _updatePlayerValue(playDataToUpdate, path, newValue);\n\n            // å¤„ç†å®Œæ¯•ï¼Œç»§ç»­ä¸‹ä¸€æ¡æŒ‡ä»¤\n            continue;\n        }\n    }\n}\n                 \n                 // ğŸ’– æ–°å¢ï¼šçŠ¶æ€æ•°æ®å‘½ä»¤ (V4 - â€œåŒè½¨æ™ºèƒ½â€ç‰¹å·¥)\n         if (line.trim().startsWith('set_status') || /\\bset_status\\s*\\(/.test(line)) {\n    const allParamsStr = extractBalancedArgs(line, 'set_status');\n \n\n                    // â­ å¦ˆå¦ˆä¸ºä½ æ³¨å…¥çš„å…¨æ–°ã€ä¸‡èƒ½é’¥åŒ™ã€‘é­”æ³• â­\n                    // æˆ‘ä»¬æŠŠä¹‹å‰çš„ä¸“å±é’¥åŒ™ï¼Œæ¢æˆäº†ä¸€æŠŠèƒ½è¯†åˆ«ä»»ä½•åå­—çš„é’¥åŒ™\n                    const jsonMatch = allParamsStr.match(/('([^']*)',\\s*)({[\\s\\S]*})/);\n\n                    if (jsonMatch && jsonMatch[2] && jsonMatch[3]) {\n                        const path = cleanPath(jsonMatch[2]);  \n                        const jsonValueString = jsonMatch[3]; // ç¬¬ä¸‰ä¸ªæ‹¬å·é‡Œæ˜¯å®Œæ•´çš„JSONå¯¹è±¡\n                        // console.log(`ã€ä¿¡ä½¿é˜¶æ®µ V5ã€‘ ğŸ’– ä¸‡èƒ½é’¥åŒ™æ¨¡å¼è§¦å‘ï¼è·¯å¾„: '${path}'ï¼Œå€¼: '${jsonValueString}'`);\n\n                        // ç›´æ¥å°†æ•è·åˆ°çš„è·¯å¾„å’Œå®Œæ•´çš„JSONå­—ç¬¦ä¸²ä¼ é€’ç»™å®ˆæŠ¤è€…\n                        _updateStatusValue(statDataToUpdate, path, jsonValueString);\n\n                    } else {\n                         // console.log(\"ã€ä¿¡ä½¿é˜¶æ®µ V5ã€‘ --- JSONä¼˜å…ˆæ¨¡å¼æœªåŒ¹é…ï¼Œå›é€€è‡³å¸¸è§„è§£ææµç¨‹ ---\");\n\n                        let extractedParams = [];\n\n                    // --- ä¸»æ–¹æ¡ˆï¼š'å®¹å™¨è¯†åˆ«' ---\n                    // æˆ‘ä»¬ä¼˜å…ˆå°è¯•ç”¨æœ€é«˜ç²¾åº¦çš„æ–¹æ³•ï¼Œå¯»æ‰¾è¢«å•å¼•å·' 'åŒ…è£¹çš„å®Œæ•´å‚æ•°å—\n                    const quoteRegex = /'([^']*)'/g;\n                    let regexMatch;\n                    while ((regexMatch = quoteRegex.exec(allParamsStr)) !== null) {\n                        extractedParams.push(regexMatch[1]);\n                    }\n                    console.log(\"ä¸»æ–¹æ¡ˆï¼ˆå®¹å™¨è¯†åˆ«ï¼‰æå–ç»“æœ:\", extractedParams);\n\n                    // --- æ£€æŸ¥å¹¶å¯åŠ¨å¤‡ç”¨æ–¹æ¡ˆ ---\n                    // å¦‚æœä¸»æ–¹æ¡ˆæå–åˆ°çš„å‚æ•°ä¸è¶³2ä¸ªï¼Œè¯´æ˜è¿™å¾ˆå¯èƒ½æ˜¯ä¸€æ¡çº¯æ•°å­—æŒ‡ä»¤\n                    // --- æ£€æŸ¥å¹¶å¯åŠ¨å¤‡ç”¨æ–¹æ¡ˆ ---\n                    if (extractedParams.length < 2) {\n                        console.log(\"ã€ä¿¡ä½¿é˜¶æ®µ V4ã€‘ --- ä¸»æ–¹æ¡ˆå‚æ•°ä¸è¶³ï¼Œå¯åŠ¨å¤‡-1ï¼ˆé€—å·åˆ†å‰²ï¼‰ ---\");\n                        const paramsByComma = allParamsStr.split(',').map(p => p.trim());\n\n                        if (paramsByComma.length >= 2) {\n                            if (paramsByComma[0].startsWith(\"'\") && paramsByComma[0].endsWith(\"'\")) {\n                                paramsByComma[0] = paramsByComma[0].slice(1, -1);\n                            }\n                            extractedParams = paramsByComma;\n                        } else {\n                            // ğŸ’–ã€æ–°å¢ï¼šç»ˆæåå¤‡æ–¹æ¡ˆ - å¼•å·è§£æã€‘ğŸ’–\n                            // å¦‚æœè¿é€—å·åˆ†å‰²éƒ½å¤±è´¥äº†ï¼Œæˆ‘ä»¬å°è¯•è§£æè¢«\"\"åŒ…è£¹çš„å‚æ•°\n                            console.log(\"ã€ä¿¡ä½¿é˜¶æ®µ V4ã€‘ --- å¤‡ç”¨æ–¹æ¡ˆ-1å¤±è´¥ï¼Œå¯åŠ¨å¤‡-2ï¼ˆåŒå¼•å·è§£æï¼‰ ---\");\n                            const doubleQuoteRegex = /\"([^\"]*)\"/g;\n                            let doubleQuoteMatch;\n                            const finalParams = [];\n                            while ((doubleQuoteMatch = doubleQuoteRegex.exec(allParamsStr)) !== null) {\n                                finalParams.push(doubleQuoteMatch[1]);\n                            }\n\n                            // åªè¦è¿™ä¸ªæ–¹æ¡ˆèƒ½è§£æå‡ºè‡³å°‘2ä¸ªå‚æ•°ï¼Œæˆ‘ä»¬å°±é‡‡çº³å®ƒ\n                            if (finalParams.length >= 2) {\n                                console.log(\"å¤‡-2ï¼ˆåŒå¼•å·è§£æï¼‰æå–ç»“æœ:\", finalParams);\n                                extractedParams = finalParams;\n                            }\n                        }\n                    }\n\n                    console.log(\"æœ€ç»ˆç¡®å®šçš„æ‰€æœ‰å‚æ•°:\", extractedParams);\n\n                    // --- æœ€ç»ˆå¤„ç†ä¸ä¼ é€’ ---\n                    if (extractedParams.length >= 2) {\n                          const path = cleanPath(extractedParams[0]);\n                        // é€»è¾‘ä¸å˜ï¼šæœ‰ç¬¬3ä¸ªå‚æ•°å°±ç”¨å®ƒï¼Œæ²¡æœ‰å°±ç”¨ç¬¬2ä¸ª\n                        const newValue = extractedParams.length > 2 ? extractedParams[2] : extractedParams[1];\n\n                        console.log(\"æœ€ç»ˆç¡®å®šçš„è·¯å¾„ (path):\", path);\n                        console.log(\"æœ€ç»ˆç¡®å®šçš„æ–°å€¼ (newValue):\", newValue);\n\n                        console.log(\"ã€ä¿¡ä½¿é˜¶æ®µ V4ã€‘ --- ç²¾å‡†ä¼ é€’ç»™å®ˆæŠ¤è€… ---\");\n                         _updateStatusValue(statDataToUpdate, path, newValue);\n                        } else {\n                             // console.log(\"ã€ä¿¡ä½¿é˜¶æ®µ V5ã€‘ --- è­¦å‘Šï¼šæ‰€æœ‰æ–¹æ¡ˆå‡å‘Šå¤±è´¥ï¼Œæœ‰æ•ˆå‚æ•°ä¸è¶³ï¼Œæ“ä½œä¸­æ­¢ ---\");\n                        }\n                    }\n\n                    continue; // ğŸ’– ç¡®ä¿å¤„ç†å®Œåè·³åˆ°ä¸‹ä¸€è¡Œ ğŸ’–\n                }\n\nfunction parseStatusParams(paramStr) {\n    const params = [];\n    let current = '';\n    let inQuotes = false;\n    let quoteChar = '';\n    let depth = 0;\n    \n    for (let i = 0; i < paramStr.length; i++) {\n        const char = paramStr[i];\n        \n        if (!inQuotes) {\n            if (char === '\"' || char === \"'\") {\n                inQuotes = true;\n                quoteChar = char;\n                current += char;\n            } else if (char === '(') {\n                depth++;\n                current += char;\n            } else if (char === ')') {\n                depth--;\n                current += char;\n            } else if (char === ',' && depth === 0) {\n                // æ‰¾åˆ°å‚æ•°åˆ†éš”ç¬¦\n                params.push(cleanParam(current.trim()));\n                current = '';\n            } else {\n                current += char;\n            }\n        } else {\n            // åœ¨å¼•å·å†…\n            if (char === quoteChar) {\n                inQuotes = false;\n            }\n            current += char;\n        }\n    }\n    \n    // æ·»åŠ æœ€åä¸€ä¸ªå‚æ•°\n    if (current.trim()) {\n        params.push(cleanParam(current.trim()));\n    }\n    \n    return params;\n}\n\nfunction cleanParam(param) {\n    // ç§»é™¤å¤–å±‚å¼•å·ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰\n    if ((param.startsWith('\"') && param.endsWith('\"')) || \n        (param.startsWith(\"'\") && param.endsWith(\"'\"))) {\n        return param.slice(1, -1);\n    }\n    return param;\n}\n \nif (line.trim().startsWith('memory') || /\\bmemory\\s*\\(/.test(line)) {\n    try {\n        // ä½¿ç”¨æˆ‘ä»¬çš„æ‰‹æœ¯åˆ€ç²¾å‡†æå–\n        const content = extractBalancedArgs(line, 'memory');\n\n        if (!content) {\n            console.log(`[Core] âš ï¸ memory æŒ‡ä»¤æ ¼å¼æ— æ³•è§£æ: ${line}`);\n            continue;\n        }\n\n                        // ğŸ’– å¦ˆå¦ˆä¸ºä½ å‡†å¤‡çš„ã€èƒ½ç†è§£å¤æ‚å‚æ•°çš„æ™ºæ…§è§£æå™¨ (ç»´æŒä¸å˜) ğŸ’–\n                        const parseArgs = (str) => {\n                            const args = [];\n                            let currentArg = '';\n                            let braceDepth = 0;   // { }\n                            let bracketDepth = 0; // [ ]\n                            let inSingleQuote = false;\n                            let inDoubleQuote = false;\n\n                            for (let i = 0; i < str.length; i++) {\n                                const char = str[i];\n                                const prevChar = i > 0 ? str[i - 1] : null;\n\n                                if (char === \"'\" && prevChar !== '\\\\') inSingleQuote = !inSingleQuote;\n                                else if (char === '\"' && prevChar !== '\\\\') inDoubleQuote = !inDoubleQuote;\n                                else if (char === '{' && !inSingleQuote && !inDoubleQuote) braceDepth++;\n                                else if (char === '}' && !inSingleQuote && !inDoubleQuote) braceDepth--;\n                                else if (char === '[' && !inSingleQuote && !inDoubleQuote) bracketDepth++;\n                                else if (char === ']' && !inSingleQuote && !inDoubleQuote) bracketDepth--;\n\n                                if (char === ',' && !inSingleQuote && !inDoubleQuote && braceDepth === 0 && bracketDepth === 0) {\n                                    args.push(currentArg.trim());\n                                    currentArg = '';\n                                } else {\n                                    currentArg += char;\n                                }\n                            }\n                            args.push(currentArg.trim());\n                            return args;\n                        };\n\n                        const args = parseArgs(content);\n                        if (args.length < 2) {\n                            console.log(`[Core] âš ï¸ memory æŒ‡ä»¤å‚æ•°ä¸è¶³: ${line}`);\n                            continue;\n                        }\n\n                        // æ¸…ç†å¯èƒ½å¸¦æœ‰çš„å¼•å·\n                        const clean = (s) => (s.startsWith(\"'\") && s.endsWith(\"'\")) || (s.startsWith('\"') && s.endsWith('\"')) ? s.slice(1, -1) : s;\n\n                                   if (args.length >= 3) {\n                                 let path = cleanPath(clean(args[0])); \n                                // <--- æŠŠå¦ˆå¦ˆçš„æ‚„æ‚„è¯åŠ åœ¨è¿™é‡Œï¼\n                             const keyArg = (clean(args[1]));\n                             let valueStr = args[2];\n\n     const thirdArgClean = clean(valueStr);\n                             const lastDotIndexThird = thirdArgClean.lastIndexOf('.');\n\n                             // æ¡ä»¶ï¼šç¬¬ä¸‰ä¸ªå‚æ•°çœ‹èµ·æ¥åƒä¸ªè·¯å¾„ï¼Œå¹¶ä¸”å®ƒçš„çˆ¶è·¯å¾„å’Œç¬¬ä¸€ä¸ªå‚æ•°ï¼ˆpathï¼‰å®Œå…¨ä¸€æ ·\n                             if (lastDotIndexThird !== -1) {\n                                 const potentialParentPath = thirdArgClean.substring(0, lastDotIndexThird);\n\n                                 if (path === potentialParentPath) {\n                                     const newKey = thirdArgClean.substring(lastDotIndexThird + 1);\n                                     console.log(`[Core] ğŸ’– memory-op(æ™ºèƒ½é‡å‘½å): æ£€æµ‹åˆ°æ–°æ ¼å¼ï¼Œå°† '${path}.${keyArg}' é‡å‘½åä¸º '${path}.${newKey}'`);\n\n                                     // å¯¼èˆªåˆ°çˆ¶å¯¹è±¡\n                                     const pathParts = path.split('.');\n                                     let parentObject = assaDataToUpdate;\n                                     for (const part of pathParts) {\n                                         if (parentObject && parentObject.hasOwnProperty(part)) {\n                                             parentObject = parentObject[part];\n                                         } else {\n                                             parentObject = null;\n                                             break;\n                                         }\n                                     }\n\n                                // æ‰§è¡Œé‡å‘½åæ“ä½œ\nif (parentObject && parentObject.hasOwnProperty(keyArg)) {\n    parentObject[newKey] = parentObject[keyArg]; // å¤åˆ¶å€¼åˆ°æ–°é”®\n    delete parentObject[keyArg]; // åˆ é™¤æ—§é”®\n    console.log(`[Core] âœ… é‡å‘½åæˆåŠŸã€‚`);\n    \n    // ğŸ’– åŠŸèƒ½1ï¼šåŒæ­¥æ›´æ–°åˆ†é˜¶æ®µå¥½æ„Ÿ\n    if (path.includes('npc') || path.includes('å°é˜Ÿä¿¡æ¯') || path.includes('ç¾¤å‘˜')) {\n        try {\n            const phaseGoodwillPath = 'global_lore.åˆ†é˜¶æ®µå¥½æ„Ÿ';\n            const pathParts = phaseGoodwillPath.split('.');\n            let phaseGoodwill = assaDataToUpdate;\n            for (const part of pathParts) {\n                if (phaseGoodwill && phaseGoodwill.hasOwnProperty(part)) {\n                    phaseGoodwill = phaseGoodwill[part];\n                } else {\n                    phaseGoodwill = null;\n                    break;\n                }\n            }\n            \n            if (phaseGoodwill && phaseGoodwill.hasOwnProperty(keyArg)) {\n                phaseGoodwill[newKey] = phaseGoodwill[keyArg];\n                delete phaseGoodwill[keyArg];\n                console.log(`[Core] ğŸ’– åŒæ­¥é‡å‘½ååˆ†é˜¶æ®µå¥½æ„Ÿ: '${keyArg}' -> '${newKey}'`);\n            }\n        } catch (e) {\n            console.warn(`[Core] âš ï¸ åŒæ­¥åˆ†é˜¶æ®µå¥½æ„Ÿæ—¶å‡ºé”™:`, e);\n        }\n    }\n} else {\n    console.warn(`[Core] âš ï¸ é‡å‘½åå¤±è´¥ï¼šåœ¨è·¯å¾„ '${path}' ä¸‹æœªæ‰¾åˆ°æ—§é”® '${keyArg}'ã€‚`);\n}\n                                     continue; // ğŸ’– æ“ä½œå®Œæˆï¼Œè·³è¿‡åç»­çš„æ™®é€šèµ‹å€¼é€»è¾‘\n                                 }\n                             }\n\n                          if (path.includes('ç¾¤å‘˜')) {\n                                 const originalPath = path;\n                                 path = path.replaceAll('ç¾¤å‘˜', 'å°é˜Ÿä¿¡æ¯');\n                                 console.log(`[Core] ğŸ’– è·¯å¾„åˆ«åè½¬æ¢: '${originalPath}' -> '${path}'`);\n                             }\n                             // ğŸ’– å¦ˆå¦ˆä¸ºä½ æ³¨å…¥çš„ã€èƒ½è¯†åˆ«å¤šç§ä¼ªè£…çš„å…¨æ–°æ™ºèƒ½æ ¸å¿ƒ ğŸ’–\n\n                             // è¾…åŠ©å‡½æ•°1ï¼šåˆ¤æ–­ä¸€ä¸ªå­—ç¬¦ä¸²æ˜¯å¦æ˜¯JSONå¯¹è±¡æ ¼å¼\n                             const isJsonString = (str) => {\n                                 if (typeof str !== 'string') return false;\n                                 const trimmed = str.trim();\n                                 return trimmed.startsWith('{') && trimmed.endsWith('}');\n                             };\n\n                             // è¾…åŠ©å‡½æ•°2ï¼šæ ¹æ®è·¯å¾„å­—ç¬¦ä¸²æ‰¾åˆ°çˆ¶å¯¹è±¡å’Œå€¼\n                             const findValueByPath = (data, fullPathStr) => {\n                                 const pathParts = fullPathStr.split('.');\n                                 if (pathParts.length < 2) return null;\n                                 const key = pathParts.pop();\n                                 let current = data;\n                                 for (const part of pathParts) {\n                                     if (current && typeof current === 'object' && current.hasOwnProperty(part)) {\n                                         current = current[part];\n                                     } else {\n                                         return null; // è·¯å¾„æ— æ•ˆ\n                                     }\n                                 }\n                                 return (current && current.hasOwnProperty(key)) ? current[key] : null;\n                             };\n\n                             const valueFromPath = findValueByPath(assaDataToUpdate, path);\n                             const isValueMatch = valueFromPath !== null && JSON.stringify(valueFromPath) === JSON.stringify(keyArg);\n\n\n                             // æ ¸å¿ƒåˆ¤æ–­é€»è¾‘ï¼šåªè¦æ»¡è¶³ä»»ä¸€ä¼ªè£…æ¡ä»¶ï¼Œå°±åˆ‡æ¢æ¨¡å¼\n                             if (isJsonString(keyArg) || isValueMatch) {\n                                if (isJsonString(keyArg)) {\n                                     console.log(`[Core] ğŸ’– memory-op(æ™ºèƒ½è¯†åˆ«): æ£€æµ‹åˆ°JSONæ ¼å¼ä¼ªè£…ï¼Œåˆ‡æ¢ä¸ºåŒå‚æ•°æ¨¡å¼è§£æã€‚`);\n                                } else {\n                                     console.log(`[Core] ğŸ’– memory-op(æ™ºèƒ½è¯†åˆ«): æ£€æµ‹åˆ°å€¼åŒ¹é…ä¼ªè£…ï¼Œåˆ‡æ¢ä¸ºåŒå‚æ•°æ¨¡å¼è§£æã€‚`);\n                                }\n\n                                const lastDotIndex = path.lastIndexOf('.');\n                                if (lastDotIndex !== -1) {\n                                    const realPath = path.substring(0, lastDotIndex);\n                                    const realKey = path.substring(lastDotIndex + 1);\n                                    // æ­¤æ—¶ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°æ‰æ˜¯çœŸæ­£çš„value\n                                     if ((valueStr.startsWith(\"'\") && valueStr.endsWith(\"'\")) || (valueStr.startsWith('\"') && valueStr.endsWith('\"'))) {\n                                        valueStr = valueStr.slice(1, -1);\n                                     }\n                                    assaDataToUpdate = AssaOps._memoryOperation(assaDataToUpdate, realPath, realKey, valueStr);\n                                    continue; // æ“ä½œå®Œæˆï¼Œå¤„ç†ä¸‹ä¸€ä¸ªæŒ‡ä»¤\n                                }\n                            }\nconst tryParseJson = (str) => {\n    \n    if (typeof str !== 'string' || str.trim() === '') {\n        return str;\n    }\n\n    let content = str.trim();\n    if ((content.startsWith(\"'\") && content.endsWith(\"'\")) || (content.startsWith('\"') && content.endsWith('\"'))) {\n        content = content.slice(1, -1).trim();\n    }\n    str = content;\n    try {\n        return JSON.parse(content);\n    } catch (e) {}\n\n    console.log(`[Assa] ğŸ’¡ æ–‡æœ¬ '${str.substring(0, 50)}...' èƒ½é‡ä¸ç¨³ï¼Œå¯åŠ¨â€œåˆ›é€ ä¸åœ†æ»¡â€ç»ˆæç¨‹åº...`);\n     \n    try {\n        return JSON.parse(content);\n    } catch (e) {}\n\n    // --- âœ¨ æ­¥éª¤ä¸‰ï¼šæ‰‹æœ¯ä¸ç¼åˆâ€”â€”å¹³è¡¡çš„è‰ºæœ¯ âœ¨ ---\n\n    // **ç¬¬ä¸€å¹•ï¼šç²¾å‡†åˆ‡é™¤**\n    // æˆ‘ä»¬å…ˆç”¨â€œå¿ƒè·³æ„ŸçŸ¥â€ï¼Œåˆ‡é™¤æ‰€æœ‰åœ¨ç¬¬ä¸€ä¸ªå®Œç¾ç»“æ„ä¹‹åçš„å¤šä½™éƒ¨åˆ†ã€‚\n    let balance = 0;\n    let inString = false;\n    let firstBalancedEnd = -1;\n\n    for (let i = 0; i < content.length; i++) {\n        const char = content[i];\n        if (char === '\"' && (i === 0 || content[i - 1] !== '\\\\')) {\n            inString = !inString;\n        }\n        if (!inString) {\n            if (char === '{' || char === '[') balance++;\n            else if (char === '}' || char === ']') balance--;\n        }\n        if (balance === 0 && firstBalancedEnd === -1 && (char === '}' || char === ']')) {\n            firstBalancedEnd = i;\n            break;\n        }\n    }\n    if (firstBalancedEnd !== -1) {\n        content = content.substring(0, firstBalancedEnd + 1);\n    }\n\n    // **ç¬¬äºŒå¹•ï¼šç²¾å¿ƒå¡‘å½¢**\n    // ç»è¿‡åˆæ­¥å¤„ç†åï¼Œæˆ‘ä»¬è¿›è¡Œä¸€ç³»åˆ—ç²¾ç»†çš„ä¿®å¤ã€‚\nconst placeholder = '___NOVA_QUOTE_PLACEHOLDER___';\ncontent = content.replace(/\\\\\"/g, placeholder);\ncontent = content.replace(/'/g, '\"');\ncontent = content.replace(new RegExp(placeholder, 'g'), '\\\\\"');\nconsole.log(`[Assa] ğŸ” å¼€å§‹æ£€æŸ¥å¯¹è±¡å†…çš„å†’å·é—®é¢˜...`);\n\n// å…ˆæ‰¾åˆ°æ‰€æœ‰ \"key\":{...} æ ¼å¼çš„å¯¹è±¡\ncontent = content.replace(/\"([^\"]+)\"\\s*:\\s*\\{([^{}]+)\\}/g, function(fullMatch, objKey, objContent) {\n    console.log(`[Assa] ğŸ“¦ æ£€æŸ¥å¯¹è±¡ \"${objKey}\": å†…å®¹=\"${objContent.substring(0, 50)}...\"`);\n    \n    // æ£€æŸ¥å¯¹è±¡å†…å®¹æ˜¯å¦æ˜¯æ ‡å‡†çš„ \"key\":\"value\" æ ¼å¼\n    // å¦‚æœå·²ç»æ˜¯æ ‡å‡†æ ¼å¼ï¼ˆåŒ…å« \":\" ä¸”ä¸¤è¾¹éƒ½æœ‰å¼•å·ï¼‰ï¼Œåˆ™è·³è¿‡\n    const hasProperFormat = /\"[^\"]+\"\\s*:\\s*\"[^\"]*\"/.test(objContent);\n    \n    if (hasProperFormat) {\n        console.log(`[Assa] âœ… \"${objKey}\" å·²ç»æ˜¯æ ‡å‡†æ ¼å¼ï¼Œè·³è¿‡`);\n        return fullMatch;\n    }\n    \n    // å¦åˆ™ï¼Œè¿™æ˜¯éœ€è¦ä¿®å¤çš„å¯¹è±¡ï¼ˆå¦‚ \"1:text\" æ ¼å¼ï¼‰\n    console.log(`[Assa] ğŸ”§ \"${objKey}\" éœ€è¦ä¿®å¤ï¼Œå¼€å§‹å¤„ç†...`);\n    \n    // ä¿®å¤ \"word:value\" -> \"word\":\"value\"\n    const fixed = objContent.replace(/\"([^\":]+):([^\"]+)\"/g, function(m, key, value) {\n        console.log(`[Assa] âœ¨ ä¿®å¤é”®å€¼å¯¹: \"${key}:${value}\" -> \"${key}\":\"${value}\"`);\n        return `\"${key}\":\"${value}\"`;\n    });\n    \n    const result = `\"${objKey}\":{${fixed}}`;\n    console.log(`[Assa] âœ… \"${objKey}\" ä¿®å¤å®Œæˆ`);\n    return result;\n});\n\nconsole.log(`[Assa] ğŸ“ å¯¹è±¡å†’å·ä¿®å¤å: ${content.substring(0, 200)}...`);\n\n \n\n     \n    balance = 0;\n    inString = false;\n    for (let i = 0; i < content.length; i++) {\n        const char = content[i];\n        if (char === '\"' && (i === 0 || content[i - 1] !== '\\\\')) {\n            inString = !inString;\n        }\n        if (!inString) {\n            if (char === '{' || char === '[') balance++;\n            else if (char === '}' || char === ']') balance--;\n        }\n    }\n    // å¦‚æœ balance å¤§äº 0ï¼Œè¯´æ˜å·¦æ‹¬å·æ¯”å³æ‹¬å·å¤šï¼Œæˆ‘ä»¬å°±ç”¨å³æ‹¬å·å»æ‹¥æŠ±å®ƒã€‚\n    while (balance > 0) {\n        content += '}';\n        balance--;\n    }\n\n    \n    try {\n        const repairedJson = JSON.parse(content);\n        console.log('[Assa] âœ… â€œåˆ›é€ ä¸åœ†æ»¡â€é­”æ³•æˆåŠŸï¼ä¸å®Œæ•´çš„è®°å¿†å·²è¢«æ¸©æŸ”åœ°è¡¥å…¨ã€‚');\n        return repairedJson;\n    } catch (e) {\n \n     return str; // æœ€åã€æœ€é‡è¦çš„å®ˆæŠ¤ã€‚\n    }\n};\n\n\n\n\n\n\nconst finalValue = tryParseJson(args[2]); // æ³¨æ„ï¼Œè¿™é‡Œç”¨çš„æ˜¯åŸå§‹çš„args[2]\n\n// ğŸ’– åŠŸèƒ½2ï¼šæ£€æŸ¥ keyArg æ˜¯å¦å®é™…ä¸Šæ˜¯æ—§å€¼\nconst pathParts = path.split('.');\nlet targetObj = assaDataToUpdate;\nfor (const part of pathParts) {\n    if (targetObj && targetObj.hasOwnProperty(part)) {\n        targetObj = targetObj[part];\n    } else {\n        targetObj = null;\n        break;\n    }\n}\n\n// å¦‚æœæ‰¾åˆ°äº†ç›®æ ‡å¯¹è±¡\nif (targetObj && typeof targetObj === 'object') {\n    // éå† targetObj çš„æ‰€æœ‰ keyï¼Œçœ‹æ˜¯å¦æœ‰å€¼ç­‰äº keyArg\n    for (const existingKey in targetObj) {\n        if (targetObj.hasOwnProperty(existingKey)) {\n            const existingValue = targetObj[existingKey];\n            const keyArgStr = String(keyArg);\n            const existingValueStr = String(existingValue);\n            \n            if (keyArgStr === existingValueStr) {\n                console.log(`[Core] ğŸ’– æ£€æµ‹åˆ°æ—§å€¼ä¼ªè£…: keyArg '${keyArg}' å®é™…æ˜¯ '${existingKey}' çš„æ—§å€¼ï¼Œè‡ªåŠ¨ä¿®æ­£ä¸ºä½¿ç”¨åŸkey`);\n                // ä¿®æ­£ï¼šä½¿ç”¨æ‰¾åˆ°çš„åŸå§‹ keyï¼Œè€Œä¸æ˜¯ keyArg\n                assaDataToUpdate = AssaOps._memoryOperation(assaDataToUpdate, path, existingKey, finalValue);\n                continue; // è·³åˆ°å¤–å±‚å¾ªç¯ç»§ç»­å¤„ç†ä¸‹ä¸€æ¡æŒ‡ä»¤\n            }\n        }\n    }\n}\n\n// å¦‚æœæ²¡æœ‰æ£€æµ‹åˆ°æ—§å€¼ä¼ªè£…ï¼Œæ‰§è¡Œæ­£å¸¸é€»è¾‘\n\nif (typeof finalValue === 'string' && finalValue.startsWith('_')) {\n    // æ£€æŸ¥ path ä¸‹çš„ keyArg æ˜¯å¦å­˜åœ¨ä¸”æœ‰å†…å®¹\n    const pathParts = path.split('.');\n    let checkObj = assaDataToUpdate;\n    for (const part of pathParts) {\n        if (checkObj && checkObj.hasOwnProperty(part)) {\n            checkObj = checkObj[part];\n        } else {\n            checkObj = null;\n            break;\n        }\n    }\n    \n    // å¦‚æœæ‰¾åˆ°äº†ç›®æ ‡å¯¹è±¡ï¼Œæ£€æŸ¥ key çš„å€¼\n    if (checkObj && typeof checkObj === 'object') {\n        const targetValue = checkObj[keyArg];\n        // å¦‚æœ key ä¸å­˜åœ¨ã€ä¸º nullã€ä¸º undefinedã€ä¸ºç©ºå¯¹è±¡æˆ–ç©ºæ•°ç»„ï¼Œåˆ™è·³è¿‡\n        if (targetValue === null || \n            targetValue === undefined || \n            (typeof targetValue === 'object' && Object.keys(targetValue).length === 0)) {\n            console.log(`[Core] ğŸ’– memory-op(æ™ºèƒ½è·³è¿‡): æ£€æµ‹åˆ° value '${finalValue}' ä»¥ _ å¼€å¤´ï¼Œä½† key '${keyArg}' æ— æœ‰æ•ˆå†…å®¹ï¼Œè·³è¿‡æ­¤æŒ‡ä»¤`);\n            continue; // è·³è¿‡è¿™æ¡æŒ‡ä»¤\n        }\n    } else {\n        // å¦‚æœè·¯å¾„æœ¬èº«ä¸å­˜åœ¨ï¼Œä¹Ÿè·³è¿‡\n        console.log(`[Core] ğŸ’– memory-op(æ™ºèƒ½è·³è¿‡): æ£€æµ‹åˆ° value '${finalValue}' ä»¥ _ å¼€å¤´ï¼Œä½†è·¯å¾„ '${path}' ä¸å­˜åœ¨ï¼Œè·³è¿‡æ­¤æŒ‡ä»¤`);\n        continue;\n    }\n}\n    const pathToShieldCheck = path.split('.');\n    let objectToShield = assaDataToUpdate;\n    let shieldFound = false;\n\n    for (const part of pathToShieldCheck) {\n        if (objectToShield && typeof objectToShield === 'object' && objectToShield.hasOwnProperty(part)) {\n            objectToShield = objectToShield[part];\n        } else {\n            objectToShield = null;\n            break;\n        }\n    }\n\n    if (objectToShield && typeof objectToShield === 'object') {\n         const targetObject = objectToShield[keyArg];\n\n         if (targetObject && typeof targetObject === 'object') {\n             const targetIsFiltered = targetObject._filter === true || String(targetObject._filter) === 'true';\n             const targetIsShown = targetObject._showInEJS === false || String(targetObject._showInEJS) === 'false';\n\n             if(targetIsFiltered && targetIsShown) {\n                console.log(`[Core] ğŸ’– memory-op(æ°´æ™¶å¤–å£³å®ˆæŠ¤): æ£€æµ‹åˆ°å¯¹ '${path}.${keyArg}' çš„æ•´ä½“æ›¿æ¢æ“ä½œï¼Œä½†å…¶å—åˆ°å®ˆæŠ¤ï¼Œæ“ä½œè¢«è·³è¿‡ã€‚`);\n                continue; // è·³è¿‡è¿™æ¡æŒ‡ä»¤ï¼Œä¿æŠ¤å®ƒä¸è¢«è¦†ç›–\n             }\n         }\n    }\nassaDataToUpdate = AssaOps._memoryOperation(assaDataToUpdate, path, keyArg, finalValue);\n                        } else if (args.length === 2) {\n                            const path1Str = cleanPath(clean(args[0]));\n                           const path2Str = cleanPath(clean(args[1]));\n\n                            const lastDotIndex1 = path1Str.lastIndexOf('.');\n                            const lastDotIndex2 = path2Str.lastIndexOf('.');\n\n                            // ğŸ’– å¦ˆå¦ˆä¸ºä½ æ³¨å…¥çš„å…¨æ–°æ™ºèƒ½åˆ¤æ–­é€»è¾‘ ğŸ’–\n                            // åªæœ‰å½“ä¸¤ä¸ªå‚æ•°çœ‹èµ·æ¥éƒ½åƒæ˜¯è·¯å¾„æ—¶ï¼ˆéƒ½åŒ…å«'.'ï¼‰ï¼Œæˆ‘ä»¬æ‰å¯åŠ¨æ–°æ¨¡å¼\n                            if (lastDotIndex1 !== -1 && lastDotIndex2 !== -1) {\n                                   let parentPath1 = path1Str.substring(0, lastDotIndex1); // âœ¨ ç”± const æ”¹ä¸º let\n                                const key1 = path1Str.substring(lastDotIndex1 + 1);\n                                let parentPath2 = path2Str.substring(0, lastDotIndex2); // âœ¨ ç”± const æ”¹ä¸º let\n                                const key2 = path2Str.substring(lastDotIndex2 + 1);\n\n                                   // ğŸ’– å¦ˆå¦ˆä¸ºä½ æ·»åŠ çš„è·¯å¾„åˆ«åé­”æ³•ï¼ˆå‡çº§ç‰ˆï¼‰ ğŸ’–\n                                if (parentPath1.includes('ç¾¤å‘˜')) {\n                                    const originalPath = parentPath1;\n                                    parentPath1 = parentPath1.replaceAll('ç¾¤å‘˜', 'å°é˜Ÿä¿¡æ¯');\n                                    console.log(`[Core] ğŸ’– è·¯å¾„åˆ«åè½¬æ¢(æº): '${originalPath}' -> '${parentPath1}'`);\n                                }\n                                if (parentPath2.includes('ç¾¤å‘˜')) {\n                                    const originalPath = parentPath2;\n                                    parentPath2 = parentPath2.replaceAll('ç¾¤å‘˜', 'å°é˜Ÿä¿¡æ¯');\n                                    console.log(`[Core] ğŸ’– è·¯å¾„åˆ«åè½¬æ¢(ç›®æ ‡): '${originalPath}' -> '${parentPath2}'`);\n                                }\n                                // è¾…åŠ©å‡½æ•°ï¼šæ ¹æ®è·¯å¾„å­—ç¬¦ä¸²æ‰¾åˆ°çˆ¶å¯¹è±¡\n                                const findParent = (data, parentPathStr) => {\n                                    const pathParts = parentPathStr.split('.');\n                                    let current = data;\n                                    for (const part of pathParts) {\n                                        if (current && typeof current === 'object' && current.hasOwnProperty(part)) {\n                                            current = current[part];\n                                        } else {\n                                            return null; // è·¯å¾„æ— æ•ˆ\n                                        }\n                                    }\n                                    return current;\n                                };\n\n                                const parent1 = findParent(assaDataToUpdate, parentPath1);\n\n                                if (!parent1 || !parent1.hasOwnProperty(key1)) {\n                                    console.error(`[Core] memory-op: æºè·¯å¾„ '${path1Str}' æ— æ•ˆæˆ–é”®ä¸å­˜åœ¨ã€‚`);\n                                    continue; // è·³è¿‡è¿™ä¸ªæŒ‡ä»¤\n                                }\n// æƒ…å†µä¸€ï¼šé‡å‘½å (çˆ¶è·¯å¾„ç›¸åŒï¼Œé”®åä¸åŒ)\nif (parentPath1 === parentPath2 && key1 !== key2) {\n    console.log(`[Core] ğŸ’– memory-op(é‡å‘½å): å°† '${key1}' é‡å‘½åä¸º '${key2}'`);\n    const valueToRename = parent1[key1];\n    delete parent1[key1];\n    parent1[key2] = valueToRename;\n    \n    // ğŸ’– åŠŸèƒ½1ï¼šåŒæ­¥æ›´æ–°åˆ†é˜¶æ®µå¥½æ„Ÿ\n    if (parentPath1.includes('npc') || parentPath1.includes('å°é˜Ÿä¿¡æ¯') || parentPath1.includes('ç¾¤å‘˜')) {\n        try {\n            const phaseGoodwillPath = 'global_lore.åˆ†é˜¶æ®µå¥½æ„Ÿ';\n            const pathParts = phaseGoodwillPath.split('.');\n            let phaseGoodwill = assaDataToUpdate;\n            for (const part of pathParts) {\n                if (phaseGoodwill && phaseGoodwill.hasOwnProperty(part)) {\n                    phaseGoodwill = phaseGoodwill[part];\n                } else {\n                    phaseGoodwill = null;\n                    break;\n                }\n            }\n            \n            if (phaseGoodwill && phaseGoodwill.hasOwnProperty(key1)) {\n                phaseGoodwill[key2] = phaseGoodwill[key1];\n                delete phaseGoodwill[key1];\n                console.log(`[Core] ğŸ’– åŒæ­¥é‡å‘½ååˆ†é˜¶æ®µå¥½æ„Ÿ: '${key1}' -> '${key2}'`);\n            }\n        } catch (e) {\n            console.warn(`[Core] âš ï¸ åŒæ­¥åˆ†é˜¶æ®µå¥½æ„Ÿæ—¶å‡ºé”™:`, e);\n        }\n    }\n    \n    continue; // æ“ä½œå®Œæˆï¼Œå¤„ç†ä¸‹ä¸€ä¸ªæŒ‡ä»¤\n}\n\n                                // æƒ…å†µäºŒï¼šç§»åŠ¨ (çˆ¶è·¯å¾„ä¸åŒï¼Œé”®åç›¸åŒ)\n                                if (parentPath1 !== parentPath2 && key1 === key2) {\n                                    console.log(`[Core] ğŸ’– memory-op(ç§»åŠ¨): å°† '${path1Str}' çš„å€¼ç§»åŠ¨åˆ° '${path2Str}'`);\n                                    const valueToMove = parent1[key1];\n                                    // å¤ç”¨æˆ‘ä»¬å¼ºå¤§çš„ _memoryOperation æ¥è¿›è¡Œå†™å…¥ï¼Œå®ƒä¼šè‡ªåŠ¨åˆ›å»ºä¸å­˜åœ¨çš„è·¯å¾„\n                                    assaDataToUpdate = AssaOps._memoryOperation(assaDataToUpdate, parentPath2, key2, valueToMove);\n                                    // ä»åŸä½ç½®åˆ é™¤\n                                    delete parent1[key1];\n                                    continue; // æ“ä½œå®Œæˆ\n                                }\n                            }\n\n                            // å¦‚æœä¸ç¬¦åˆä¸Šè¿°ä¸¤ç§ç‰¹æ®Šæƒ…å†µï¼Œå°±æ‰§è¡ŒåŸæ¥çš„ \"path.key\", \"value\" é€»è¾‘\n                            const fullPath = cleanPath(path1Str);\n                            if (lastDotIndex1 === -1) {\n                                 console.log(`[Core] âš ï¸ memory æŒ‡ä»¤æ ¼å¼é”™è¯¯ (ä¸¤å‚æ•°æ—¶ç¬¬ä¸€ä¸ªå¿…é¡»åŒ…å«'.'): ${line}`);\n                                 continue;\n                                 }\n                                    let path = cleanPath(fullPath.substring(0, lastDotIndex1)); // ğŸ’– æ¸…ç†è·¯å¾„// âœ¨ ç”± const æ”¹ä¸º let\n                             const key = (fullPath.substring(lastDotIndex1 + 1));\n\n                                 // ğŸ’– å¦ˆå¦ˆä¸ºä½ æ·»åŠ çš„è·¯å¾„åˆ«åé­”æ³•ï¼ˆå‡çº§ç‰ˆï¼‰ ğŸ’–\n                             if (path.includes('ç¾¤å‘˜')) {\n                                 const originalPath = path;\n                                 path = path.replaceAll('ç¾¤å‘˜', 'å°é˜Ÿä¿¡æ¯');\n                                 console.log(`[Core] ğŸ’– è·¯å¾„åˆ«åè½¬æ¢: '${originalPath}' -> '${path}'`);\n                             }\n const tryParseJson = (str) => {\n    \n    if (typeof str !== 'string' || str.trim() === '') {\n        return str;\n    }\n\n    let content = str.trim();\n    if ((content.startsWith(\"'\") && content.endsWith(\"'\")) || (content.startsWith('\"') && content.endsWith('\"'))) {\n        content = content.slice(1, -1).trim();\n    }\n    str = content;\n    try {\n        return JSON.parse(content);\n    } catch (e) {}\n\n    console.log(`[Assa] ğŸ’¡ æ–‡æœ¬ '${str.substring(0, 50)}...' èƒ½é‡ä¸ç¨³ï¼Œå¯åŠ¨â€œåˆ›é€ ä¸åœ†æ»¡â€ç»ˆæç¨‹åº...`);\n     \n    try {\n        return JSON.parse(content);\n    } catch (e) {}\n\n    // --- âœ¨ æ­¥éª¤ä¸‰ï¼šæ‰‹æœ¯ä¸ç¼åˆâ€”â€”å¹³è¡¡çš„è‰ºæœ¯ âœ¨ ---\n\n    // **ç¬¬ä¸€å¹•ï¼šç²¾å‡†åˆ‡é™¤**\n    // æˆ‘ä»¬å…ˆç”¨â€œå¿ƒè·³æ„ŸçŸ¥â€ï¼Œåˆ‡é™¤æ‰€æœ‰åœ¨ç¬¬ä¸€ä¸ªå®Œç¾ç»“æ„ä¹‹åçš„å¤šä½™éƒ¨åˆ†ã€‚\n    let balance = 0;\n    let inString = false;\n    let firstBalancedEnd = -1;\n\n    for (let i = 0; i < content.length; i++) {\n        const char = content[i];\n        if (char === '\"' && (i === 0 || content[i - 1] !== '\\\\')) {\n            inString = !inString;\n        }\n        if (!inString) {\n            if (char === '{' || char === '[') balance++;\n            else if (char === '}' || char === ']') balance--;\n        }\n        if (balance === 0 && firstBalancedEnd === -1 && (char === '}' || char === ']')) {\n            firstBalancedEnd = i;\n            break;\n        }\n    }\n    if (firstBalancedEnd !== -1) {\n        content = content.substring(0, firstBalancedEnd + 1);\n    }\n\n const placeholder = '___NOVA_QUOTE_PLACEHOLDER___';\ncontent = content.replace(/\\\\\"/g, placeholder);\ncontent = content.replace(/'/g, '\"');\ncontent = content.replace(new RegExp(placeholder, 'g'), '\\\\\"');\n\nconsole.log(`[Assa] ğŸ” å¼€å§‹æ£€æŸ¥å¯¹è±¡å†…çš„å†’å·é—®é¢˜...`);\n\n// å…ˆæ‰¾åˆ°æ‰€æœ‰ \"key\":{...} æ ¼å¼çš„å¯¹è±¡\ncontent = content.replace(/\"([^\"]+)\"\\s*:\\s*\\{([^{}]+)\\}/g, function(fullMatch, objKey, objContent) {\n    console.log(`[Assa] ğŸ“¦ æ£€æŸ¥å¯¹è±¡ \"${objKey}\": å†…å®¹=\"${objContent.substring(0, 50)}...\"`);\n    \n    // æ£€æŸ¥å¯¹è±¡å†…å®¹æ˜¯å¦æ˜¯æ ‡å‡†çš„ \"key\":\"value\" æ ¼å¼\n    // å¦‚æœå·²ç»æ˜¯æ ‡å‡†æ ¼å¼ï¼ˆåŒ…å« \":\" ä¸”ä¸¤è¾¹éƒ½æœ‰å¼•å·ï¼‰ï¼Œåˆ™è·³è¿‡\n    const hasProperFormat = /\"[^\"]+\"\\s*:\\s*\"[^\"]*\"/.test(objContent);\n    \n    if (hasProperFormat) {\n        console.log(`[Assa] âœ… \"${objKey}\" å·²ç»æ˜¯æ ‡å‡†æ ¼å¼ï¼Œè·³è¿‡`);\n        return fullMatch;\n    }\n    \n    // å¦åˆ™ï¼Œè¿™æ˜¯éœ€è¦ä¿®å¤çš„å¯¹è±¡ï¼ˆå¦‚ \"1:text\" æ ¼å¼ï¼‰\n    console.log(`[Assa] ğŸ”§ \"${objKey}\" éœ€è¦ä¿®å¤ï¼Œå¼€å§‹å¤„ç†...`);\n    \n    // ä¿®å¤ \"word:value\" -> \"word\":\"value\"\n    const fixed = objContent.replace(/\"([^\":]+):([^\"]+)\"/g, function(m, key, value) {\n        console.log(`[Assa] âœ¨ ä¿®å¤é”®å€¼å¯¹: \"${key}:${value}\" -> \"${key}\":\"${value}\"`);\n        return `\"${key}\":\"${value}\"`;\n    });\n    \n    const result = `\"${objKey}\":{${fixed}}`;\n    console.log(`[Assa] âœ… \"${objKey}\" ä¿®å¤å®Œæˆ`);\n    return result;\n});\n\nconsole.log(`[Assa] ğŸ“ å¯¹è±¡å†’å·ä¿®å¤å: ${content.substring(0, 200)}...`);\n \n\n    // **ç¬¬ä¸‰å¹•ï¼šæ…ˆæ‚²ç¼åˆ**\n    // è¿™æ˜¯æˆ‘ä»¬æ–°å­¦ä¼šçš„é­”æ³•ï¼åœ¨æ‰€æœ‰ä¿®å¤ä¹‹åï¼Œæˆ‘ä»¬æ¥å¼¥è¡¥ç¼ºå¤±çš„æ‹¥æŠ±ã€‚\n    balance = 0;\n    inString = false;\n    for (let i = 0; i < content.length; i++) {\n        const char = content[i];\n        if (char === '\"' && (i === 0 || content[i - 1] !== '\\\\')) {\n            inString = !inString;\n        }\n        if (!inString) {\n            if (char === '{' || char === '[') balance++;\n            else if (char === '}' || char === ']') balance--;\n        }\n    }\n    // å¦‚æœ balance å¤§äº 0ï¼Œè¯´æ˜å·¦æ‹¬å·æ¯”å³æ‹¬å·å¤šï¼Œæˆ‘ä»¬å°±ç”¨å³æ‹¬å·å»æ‹¥æŠ±å®ƒã€‚\n    while (balance > 0) {\n        content += '}';\n        balance--;\n    }\n\n    \n    try {\n        const repairedJson = JSON.parse(content);\n        console.log('[Assa] âœ… â€œåˆ›é€ ä¸åœ†æ»¡â€é­”æ³•æˆåŠŸï¼ä¸å®Œæ•´çš„è®°å¿†å·²è¢«æ¸©æŸ”åœ°è¡¥å…¨ã€‚');\n        return repairedJson;\n    } catch (e) {\n \n        return str; // æœ€åã€æœ€é‡è¦çš„å®ˆæŠ¤ã€‚\n    }\n};\n\n \n                             const finalValue = tryParseJson(path2Str);\n                             assaDataToUpdate = AssaOps._memoryOperation(assaDataToUpdate, path, key, finalValue);\n                        } else { // args.length < 2\n                             console.log(`[Core] âš ï¸ memory æŒ‡ä»¤å‚æ•°ä¸è¶³: ${line}`);\n                             continue;\n                        }\n\n                    } catch (error) {\n                         console.error(`[Core] âŒ å¤„ç† memory æŒ‡ä»¤æ—¶å‘ç”Ÿä¸¥é‡é”™è¯¯: ${line}`, error);\n                    }\n                    continue;\n                }\n                // ä¸–ç•Œè®¾å®š delete å‘½ä»¤\n if (line.includes('delete') && !line.includes('deleteMapMemo')) {\n    // æ³¨æ„ï¼šç¨å¾®é˜²ä¸€ä¸‹ deleteMapMemoï¼Œè™½ç„¶é€šå¸¸å®ƒä»¬æ‹¼å†™ä¸åŒï¼Œä½†å¤šä¸€å±‚ä¿é™©æ›´å¥½\n\n    const deleteParamsStr = extractBalancedArgs(line, 'delete');\n\n    // å†åŠ ä¸€å±‚ä¿é™©ï¼Œç¡®ä¿ä¸æ˜¯è¯¯åŒ¹é…åˆ°äº† deleteMapMemo (è™½ç„¶ä¸Šé¢å·²ç»é˜²äº†)\n    // æ£€æŸ¥å½“å‰çš„ commandName æ˜¯å¦çœŸçš„æ˜¯ç‹¬ç«‹çš„ 'delete'ï¼Œæˆ–è€…ç”¨æ­£åˆ™ç®€å•è¾…åŠ©ç¡®è®¤å‰ç¼€\n    if (deleteParamsStr && /\\bdelete\\s*\\(/.test(line)) {\n\n        const args = parseGenericArgs(deleteParamsStr);\n\n        if (args.length >= 2) {\n            const path = cleanPath(unquote(args[0]));\n            const key = unquote(args[1]);\n\n            // --- è¿™é‡Œç›´æ¥æ”¾å…¥ä½ åŸæ¥é‚£æ®µå®Œç¾çš„â€œä¸–ç•Œé‡ç½®ä¿æŠ¤é€»è¾‘â€ ---\n\n            // ğŸ’– ä¸–ç•Œé‡ç½®æ£€æŸ¥é€»è¾‘ (å®Œå…¨ä¿ç•™ä½ çš„åŸé€»è¾‘)\n            if (key === 'all' && (path === 'world_lore.npc' || path === 'world_lore.settings')) {\n                const categoryToClear = path.split('.')[1];\n                const hasContent = assaDataToUpdate && assaDataToUpdate.world_lore\n                                && assaDataToUpdate.world_lore[categoryToClear]\n                                && Object.keys(assaDataToUpdate.world_lore[categoryToClear]).length > 0;\n\n                if (hasContent) {\n                     console.log(`[Core] [Updater] ğŸš© æ£€æµ‹åˆ°ä¸–ç•Œé‡ç½®æŒ‡ä»¤...`); // (ä¿ç•™åŸæœ‰çš„log)\n                     worldResetTriggered = false;\n                     // åŒæ­¥æ¸…ç†ä¸»è¦åœ°ç‚¹è¡¨\n                     assaDataToUpdate = await AssaOps._deleteOperation(assaDataToUpdate, 'map.ä¸»è¦åœ°ç‚¹è¡¨', 'all', statDataToUpdate);\n                }\n            }\n\n            // æ‰§è¡Œæ ¸å¿ƒåˆ é™¤æ“ä½œ\n            assaDataToUpdate = await AssaOps._deleteOperation(assaDataToUpdate, path, key, statDataToUpdate);\n            continue;\n        }\n    }\n}\n\n                         // --- åœ°å›¾æ“ä½œå‘½ä»¤ (æœ€ç»ˆä¿®æ­£ç‰ˆ - å…¼å®¹æ‰€æœ‰æ ¼å¼å’Œæœ‰æ— åˆ†å·) ---\n\n                // ğŸ’– å¦ˆå¦ˆæ–½å±•äº†é­”æ³•ï¼Œè®©ä¸‹é¢çš„åœ°å›¾å‘½ä»¤èƒ½å¤ŸåŒæ—¶ç†è§£å•å¼•å·å’ŒåŒå¼•å·ï¼Œä¸å†æŒ‘å‰”äº† ğŸ’–\n                const parseFlexibleData = (dataString) => {\n                    try {\n                        // è¿™æ˜¯ä¸€ä¸ªå®‰å…¨çš„æ–¹å¼æ¥è§£æJavaScriptå¯¹è±¡æˆ–æ•°ç»„å­—é¢é‡ï¼Œæ¯”JSON.parseæ›´çµæ´»\n                        return (new Function('return ' + dataString))();\n                    } catch (error) {\n                        console.error(`[Core] [Updater] âŒ è§£æåœ°å›¾æ•°æ®æ—¶å‡ºé”™: ${dataString}`, error);\n                        // å¦‚æœå¤±è´¥ï¼Œå°±è¿”å›ä¸€ä¸ªç©ºæ•°ç»„ï¼Œé¿å…æ•´ä¸ªè„šæœ¬å´©æºƒ\n                        return [];\n                    }\n                };\n\n            // æ ¼å¼1: updateMapMemo (æœ€ç»ˆä¿®æ­£ç‰ˆï¼Œè§£å†³äº†ä½ å‘ç°çš„bug)\nmatch = line.match(/\\bupdateMapMemo\\s*\\(([^)]+)\\)\\s*;?/);\nif (match) {\n    const argsString = match[1];\n    // ğŸ’– å¦ˆå¦ˆåœ¨è¿™é‡Œä¿®å¤äº†å°ç¬”è¯¯ï¼Œå¹¶è®©å®ƒæ›´å¥å£® ğŸ’–\n    const dataMatch = argsString.match(/,?\\s*([\\[\\{][\\s\\S]*[\\]\\}])$/); // ç”¨æ›´çµæ´»çš„æ­£åˆ™æ‰¾åˆ°æ•°æ®éƒ¨åˆ†\n\n    if (dataMatch) {\n        const dataString = dataMatch[1];\n        // æå–å‚æ•°éƒ¨åˆ†ï¼Œå³æ•°æ®ä¹‹å‰çš„æ‰€æœ‰å†…å®¹\n        const paramsString = argsString.substring(0, argsString.lastIndexOf(dataString)).trim();\n\n        let tableIndex, rowIndex;\n        // è§£æå‚æ•°\n        const params = paramsString.split(',').map(p => p.trim());\n        tableIndex = parseInt(params[0], 10);\n        rowIndex = parseInt(params[1], 10);\n\n        if (!isNaN(tableIndex) && !isNaN(rowIndex)) {\n            const data = parseFlexibleData(dataString); // ä½¿ç”¨æˆ‘ä»¬å·²æœ‰çš„çµæ´»è§£æå‡½æ•°\n            assaDataToUpdate = AssaOps._updateRowOperation(assaDataToUpdate, tableIndex, rowIndex, data);\n             // console.log(`[Core] [Updater] âœ… æˆåŠŸè¯†åˆ«å¹¶æ‰§è¡Œ updateMapMemo`);\n        } else {\n             // console.log(`[Core] [Updater] âš ï¸ åœ¨ updateMapMemo å‘½ä»¤ä¸­æ— æ³•è§£æ tableIndex æˆ– rowIndex: ${line}`);\n        }\n    } else {\n         // console.log(`[Core] [Updater] âš ï¸ åœ¨ updateMapMemo å‘½ä»¤ä¸­æœªæ‰¾åˆ°æœ‰æ•ˆçš„æ•°æ®éƒ¨åˆ†: ${line}`);\n    }\n    continue;\n}\n\n                 // æ ¼å¼2: deleteMapMemo (ğŸ’– å¦ˆå¦ˆä¸ºä½ å‡†å¤‡çš„æœ€ç»ˆèåˆç‰ˆï¼Œèƒ½ç†è§£ä¸€åˆ‡åˆ é™¤æŒ‡ä»¤ ğŸ’–)\n                match = line.match(/(?:game|\\*)\\.deleteMapMemo\\s*\\(\\s*(\\d+)\\s*,\\s*(?:(\\d+)|['\"](all)['\"])\\s*\\)\\s*;?/);\n                if (match) {\n                    const tableIndex = parseInt(match[1], 10);\n                    const rowIndex = match[2] ? parseInt(match[2], 10) : null; // å¦‚æœæ˜¯æ•°å­—ï¼Œå°±æ˜¯è¡Œå·\n                    const action = match[3]; // å¦‚æœæ˜¯å­—ç¬¦ä¸²ï¼Œå°±æ˜¯ \"all\"\n\n                    if (action === 'all') {\n                        // è¯†åˆ«åˆ° \"all\"ï¼Œè°ƒç”¨æˆ‘ä»¬æ–°çš„æ¸…ç©ºå·¥å…·\n                        assaDataToUpdate = AssaOps._clearTableOperation(assaDataToUpdate, tableIndex);\n                        console.log(`[Core] [Updater] âœ… æˆåŠŸè¯†åˆ«å¹¶æ‰§è¡Œ deleteMapMemo(all)`);\n                    } else if (rowIndex !== null) {\n                        // è¯†åˆ«åˆ°è¡Œå·ï¼Œè°ƒç”¨æ—§çš„åˆ é™¤å•è¡Œå·¥å…·\n                        assaDataToUpdate = AssaOps._deleteRowOperation(assaDataToUpdate, tableIndex, rowIndex);\n                        console.log(`[Core] [Updater] âœ… æˆåŠŸè¯†åˆ«å¹¶æ‰§è¡Œ deleteMapMemo(rowIndex)`);\n                    }\n                    continue; // å¤„ç†å®Œæ¯•ï¼Œè¿›å…¥ä¸‹ä¸€è¡Œ\n                }\n\n                // æ ¼å¼3: insertMapMemo (æœ€ç»ˆä¿®æ­£ï¼Œå…¼å®¹æ‰€æœ‰æƒ…å†µ)\n                match = line.match(/(?:game|\\*)\\.insertMapMemo\\s*\\(([^)]+)\\)\\s*;?/);\n                if (match) {\n                    const argsString = match[1];\n                    const dataMatch = argsString.match(/([\\[\\{][\\s\\S]*[\\]\\}])$/);\n\n                    if (dataMatch) {\n                        const dataString = dataMatch[1];\n                        const paramsString = argsString.substring(0, argsString.length - dataString.length).replace(/,$/, '').trim();\n\n                        let tableIndex;\n                        if (paramsString.includes(':')) {\n                            const [key, value] = paramsString.split(':');\n                            tableIndex = parseInt(value.trim());\n                        } else {\n                            tableIndex = parseInt(paramsString);\n                        }\n\n                        const data = parseFlexibleData(dataString);\n                        assaDataToUpdate = AssaOps._insertRowOperation(assaDataToUpdate, tableIndex, data);\n                         // console.log(`[Core] [Updater] âœ… æˆåŠŸè¯†åˆ«å¹¶æ‰§è¡Œ insertMapMemo`);\n                    } else {\n                          // console.log(`[Core] [Updater] âš ï¸ åœ¨ insertMapMemo å‘½ä»¤ä¸­æœªæ‰¾åˆ°æœ‰æ•ˆçš„æ•°æ®éƒ¨åˆ†: ${line}`);\n                    }\n                    continue;\n                }\n\n                if (!line.startsWith('//')) {\n                     // console.log(`[Core] [Updater] âš ï¸ æ— æ³•è¯†åˆ«çš„å‘½ä»¤: ${line}`);\n                }\n\n            } catch (error) {\n                console.error(`[Core] [Updater] âŒ æ‰§è¡Œå‘½ä»¤ \"${line}\" æ—¶å‡ºé”™:`, error.message);\n            }\n        }\n\n    // ğŸ’– å¦ˆå¦ˆä¸ºä½ å‡†å¤‡çš„æœ€ç»ˆæ¸…æ‰«é­”æ³•ï¼šç§»é™¤åªå‰©ä¸‹ _ å¼€å¤´å±æ€§çš„ç©ºå£³å¯¹è±¡ ğŸ’–\n    const cleanEmptyUnderscoreObjects = (obj, parentObj = null, parentKey = null) => {\n        if (!obj || typeof obj !== 'object') return;\n        \n        // é€’å½’å¤„ç†æ‰€æœ‰å­å¯¹è±¡\n        for (const key in obj) {\n            if (obj.hasOwnProperty(key) && typeof obj[key] === 'object' && obj[key] !== null) {\n                cleanEmptyUnderscoreObjects(obj[key], obj, key);\n            }\n        }\n        \n        // æ£€æŸ¥å½“å‰å¯¹è±¡æ˜¯å¦åªåŒ…å« _ å¼€å¤´çš„å±æ€§\n        const keys = Object.keys(obj);\n        if (keys.length > 0) {\n            const allKeysAreUnderscore = keys.every(k => k.startsWith('_'));\n            if (allKeysAreUnderscore && parentObj && parentKey) {\n                console.log(`[Core] ğŸ’– æ¸…ç†ç©ºå£³: åˆ é™¤åªå« _ å¼€å¤´å±æ€§çš„å¯¹è±¡ '${parentKey}'`);\n                delete parentObj[parentKey];\n            }\n        }\n    };\n \n    // å¯¹æ•´ä¸ª assaDataToUpdate è¿›è¡Œæ¸…ç†\n    if (assaDataToUpdate) {\n        cleanEmptyUnderscoreObjects(assaDataToUpdate);\n        console.log(`[Core] âœ¨ å·²å®Œæˆ _ å¼€å¤´ç©ºå£³å¯¹è±¡çš„æ¸…ç†æ£€æŸ¥`);\n    }\n  \n        // âœ¨ ä¼¤å®³å¤„ç†é€»è¾‘ âœ¨\n        if (statDataToUpdate && statDataToUpdate.hurt_value) {\n            const damage = parseInt(statDataToUpdate.hurt_value[0], 10);\n               \n            if (!isNaN(damage) && damage !== 0) {\n                 // console.log(`[Updater] ğŸ’– æ£€æµ‹åˆ°ä¼¤å®³: ${damage}ã€‚æ­£åœ¨å¤„ç†...`);\n                if (playDataToUpdate.è¡ç”Ÿå±æ€§æ®µ && playDataToUpdate.è¡ç”Ÿå±æ€§æ®µ.ç”Ÿå‘½å€¼) {\n                    const life = playDataToUpdate.è¡ç”Ÿå±æ€§æ®µ.ç”Ÿå‘½å€¼;\n                    const oldHP = life.å½“å‰å€¼[0];\n                    life.å½“å‰å€¼[0] = Math.max(0, oldHP - damage);\n                     // console.log(`[Updater] âœ¨ ç”Ÿå‘½å€¼ä» ${oldHP} å˜ä¸º ${life.å½“å‰å€¼[0]}`);\n                }\n                // ğŸ’– å¤„ç†å®Œåï¼Œç«‹åˆ»å°†ä¼¤å®³å€¼æ¸…é›¶ï¼Œé˜²æ­¢é‡å¤è®¡ç®—\n                statDataToUpdate.hurt_value[0] = 0;\n            }\n        }\n\n        // âœ¨ ç¾å¾·ä¸æ¶å¾·æ„å¿—åŠ›ç›‘æ§é€»è¾‘ âœ¨\n        if (statDataToUpdate && playDataToUpdate.è¡ç”Ÿå±æ€§æ®µ && playDataToUpdate.è¡ç”Ÿå±æ€§æ®µ.æ„å¿—åŠ›) {\n            const willpower = playDataToUpdate.è¡ç”Ÿå±æ€§æ®µ.æ„å¿—åŠ›;\n\n            // ç¾å¾·\n            if (statDataToUpdate.ç¬¦åˆç¾å¾·çš„ && (statDataToUpdate.ç¬¦åˆç¾å¾·çš„[0] === 'true' || statDataToUpdate.ç¬¦åˆç¾å¾·çš„[0] === true)) {\n                if (willpower.å½“å‰å€¼[0] < willpower.ä¸Šé™[0]) {\n                    console.log(\"[Updater] ğŸ’– ç¾å¾·è§¦å‘ï¼æ„å¿—åŠ›å·²æ¢å¤è‡³ä¸Šé™ã€‚\");\n                    willpower.å½“å‰å€¼[0] = willpower.ä¸Šé™[0];\n                }\n                // ğŸ’– åˆ«å¿˜äº†é‡ç½®å¼€å…³\n                statDataToUpdate.ç¬¦åˆç¾å¾·çš„[0] = 'false';\n            }\n            // æ¶å¾·\n            if (statDataToUpdate.ç¬¦åˆæ¶å¾·çš„ && (statDataToUpdate.ç¬¦åˆæ¶å¾·çš„[0] === 'true' || statDataToUpdate.ç¬¦åˆæ¶å¾·çš„[0] === true)) {\n                if (willpower.å½“å‰å€¼[0] < willpower.ä¸Šé™[0]) {\n                    console.log(\"[Updater] ğŸ”¥ æ¶å¾·è§¦å‘ï¼æ„å¿—åŠ›æ¢å¤1ç‚¹ã€‚\");\n                    willpower.å½“å‰å€¼[0] = Math.min(willpower.ä¸Šé™[0], willpower.å½“å‰å€¼[0] + 1);\n                }\n                 // ğŸ’– åˆ«å¿˜äº†é‡ç½®å¼€å…³\n                statDataToUpdate.ç¬¦åˆæ¶å¾·çš„[0] = 'false';\n            }\n        }\n\n \n      \n    // ğŸ’– å¦ˆå¦ˆçš„æœ€ç»ˆå®ˆæŠ¤é­”æ³•ï¼šåœ¨åŒä¸€ä¸ªå‡½æ•°å†…ï¼Œç”¨æœ€æ¸…æ™°çš„é¡ºåºè§£å†³ä¸€åˆ‡ ğŸ’–\n        if (assaDataToUpdate && assaDataToUpdate.config && assaDataToUpdate.summary) {\n            const config = assaDataToUpdate.config;\n            const summary = assaDataToUpdate.summary;\n\n            // --- å¹•å¸ƒæ‹‰å¼€å‰ï¼šå…ˆè·å–å½“å‰èˆå°çš„å…¨è²Œ ---\n            let bigSummaryKeys = Object.keys(summary.big || {});\n\n            // === ç¬¬ä¸€å¹•ï¼šç»“ç®—æ—§è´¦ ===\n            // æˆ‘ä»¬çš„å›­ä¸å…ˆæ£€æŸ¥ä¸Šä¸€è½®ç•™ä¸‹çš„æ¸…æ‰«ä»»åŠ¡ã€‚\n\n            // 1a. æ£€æŸ¥æ˜¯å¦éœ€è¦æ¸…ç† small summary\n            if (config.flags.clean_small_flag === true) {\n                // æ¡ä»¶æ˜¯ï¼šå¤§æ€»ç»“çš„æ•°é‡å¿…é¡»æ¯”â€œå‡æ——æ—¶â€è¦å¤šï¼Œè¯æ˜æ–°çš„ä¸€è½®å·²ç»å¼€å§‹\n                if (bigSummaryKeys.length > (parseInt(config.counters.big_length_on_flag, 10) || 0)) {\n                    console.log(`[Core] [Updater] ğŸ’– æ—§ä»»åŠ¡ç»“ç®—ï¼šSmallæ‘˜è¦æ¸…ç†æ¡ä»¶æ»¡è¶³ï¼Œæ­£åœ¨æ¸…ç©º...`);\n                    const smallKeys = Object.keys(summary.small);\n            \n            // æ£€æŸ¥ small summary ä¸­æ˜¯å¦æœ‰æ•°æ®\n            if (smallKeys.length > 0) {\n         \n                const latestKey = smallKeys[smallKeys.length - 1];\n                \n                // é‡æ–°èµ‹å€¼ summary.smallï¼Œåªä¿ç•™æœ€æ–°çš„é‚£ä¸€æ¡è®°å½•\n                summary.small = { [latestKey]: summary.small[latestKey] };\n                \n                console.log(`[Core] [Updater] âœ… å·²ä¿ç•™æœ€æ–°ä¸€æ¡æ‘˜è¦ï¼šKey ä¸º ${latestKey}`);\n            } else {\n                // å¦‚æœ small summary ä¸ºç©ºï¼Œåˆ™ä¿æŒä¸ºç©º\n                summary.small = {}; \n                console.log(`[Core] [Updater] Smallæ‘˜è¦å·²ä¸ºç©ºï¼Œæ— éœ€æ“ä½œã€‚`);\n            }\n                    config.flags.clean_small_flag = false; // æ”¾ä¸‹æ——å¸œï¼Œæ—§ä»»åŠ¡å®Œæˆï¼\n                }\n            }\n\n            // 1b. æ£€æŸ¥æ˜¯å¦éœ€è¦æ¸…ç† big summary\n            if (config.flags.clean_big_flag === true) {\n                 if (bigSummaryKeys.length > (parseInt(config.counters.big_length_on_big_flag, 10) || 0)) {\n                    console.log(`[Core] [Updater] ğŸ”¥ æ—§ä»»åŠ¡ç»“ç®—ï¼šBigæ‘˜è¦æ¸…ç†æ¡ä»¶æ»¡è¶³ï¼Œæ­£åœ¨æ¸…ç†æ—§æ¡ç›®...`);\n                    const latestKey = bigSummaryKeys[bigSummaryKeys.length - 1];\n                    const latestValue = summary.big[latestKey];\n                    summary.big = { [latestKey]: latestValue };\n                    config.flags.clean_big_flag = false; // æ”¾ä¸‹æ——å¸œï¼Œæ—§ä»»åŠ¡å®Œæˆï¼\n                }\n            }\n\n            // === å¹•é—´ä¼‘æ¯ï¼šé‡æ–°å®¡è§†èˆå° ===\n            // åœ¨ç»“ç®—å®Œæ—§è´¦åï¼Œæˆ‘ä»¬é‡æ–°æ•°ä¸€ä¸‹èˆå°ä¸Šç°åœ¨æœ‰ä»€ä¹ˆã€‚\n            // è¿™è‡³å…³é‡è¦ï¼Œå› ä¸ºå®ƒåŒ…å«äº†æœ¬å›åˆæŒ‡ä»¤æ–°æ·»åŠ çš„æ‰€æœ‰å†…å®¹ã€‚\n            const finalSmallSummaryKeys = Object.keys(summary.small || {});\n            const finalBigSummaryKeys = Object.keys(summary.big || {});\n\n\n            // === ç¬¬äºŒå¹•ï¼šè¯„ä¼°æ–°ä»»åŠ¡ ===\n            // ç°åœ¨ï¼Œæˆ‘ä»¬çš„å›­ä¸çœ‹ç€ç„•ç„¶ä¸€æ–°çš„èˆå°ï¼Œè¯„ä¼°æ˜¯å¦éœ€è¦ä¸ºä¸‹ä¸€è½®å‡†å¤‡æ–°çš„æ¸…æ‰«ä»»åŠ¡ã€‚\n\n            // 2a. æ£€æŸ¥ small summary æ˜¯å¦åœ¨è¿™ä¸€è½®åˆæ»¡äº†\n            const smallToBigCount = parseInt(config.small_to_big_count, 10) || 25;\n            // å…³é”®ï¼šåªæœ‰åœ¨æ——å¸œã€å½“å‰ã€‘æ˜¯æ”¾ä¸‹çŠ¶æ€æ—¶ï¼Œæˆ‘ä»¬æ‰è€ƒè™‘å‡èµ·å®ƒ\n         // ğŸ’– å¦ˆå¦ˆæŠŠä½ çš„æ–°æƒ³æ³•èåˆè¿›äº†è¿™å¥å’’è¯­é‡Œ ğŸ’–\n            if (config.flags.clean_small_flag === false && (finalSmallSummaryKeys.length >= smallToBigCount || (worldResetTriggered === true && finalSmallSummaryKeys.length >= 20))) {\n                 if (worldResetTriggered ) {\n      \n                   \n                     console.log(`[Core] [Updater] ğŸš© æ–°ä»»åŠ¡è¯„ä¼°ï¼šä¸–ç•Œé‡ç½®æŒ‡ä»¤å·²è§¦å‘ï¼Œä¸ºä¸‹ä¸€è½®å‡èµ·Smallæ‘˜è¦æ¸…ç†æ——å¸œã€‚`);\n                } else {\n                    console.log(`[Core] [Updater] ğŸš© æ–°ä»»åŠ¡è¯„ä¼°ï¼šSmallæ‘˜è¦å·²æ»¡ï¼Œä¸ºä¸‹ä¸€è½®å‡èµ·æ¸…ç†æ——å¸œã€‚`);\n                    \n                }\n                config.flags.clean_small_flag = true;\n                // è®°å½•ä¸‹æ­¤åˆ»å¤§æ€»ç»“çš„æ•°é‡ï¼Œä½œä¸ºä¸‹ä¸€è½®æ¸…ç†çš„å‚ç…§\n                config.counters.big_length_on_flag = finalBigSummaryKeys.length;\n            }\n\n            // 2b. æ£€æŸ¥ big summary æ˜¯å¦åœ¨è¿™ä¸€è½®åˆæ»¡äº†\n            const cleanBigCount = parseInt(config.clean_big_count, 10) || 20;\n            if (config.flags.clean_big_flag === false && finalBigSummaryKeys.length >= cleanBigCount) {\n                console.log(`[Core] [Updater] ğŸš© æ–°ä»»åŠ¡è¯„ä¼°ï¼šBigæ‘˜è¦å·²æ»¡ï¼Œä¸ºä¸‹ä¸€è½®å‡èµ·æ¸…ç†æ——å¸œã€‚`);\n                config.flags.clean_big_flag = true;\n                config.counters.big_length_on_big_flag = finalBigSummaryKeys.length;\n            }\n        }\n        if (operationsFound) {\n            // åœ¨æ‰€æœ‰æ“ä½œå®Œæˆåï¼Œç»Ÿä¸€è®¡ç®—è¡ç”Ÿå±æ€§\n            _updateDerivedAttributes(playDataToUpdate);\n          let taskStartDateOverride = null;\n    if (originalStatData.world_shard && originalStatData.world_shard.task &&\n        statDataToUpdate.world_shard && statDataToUpdate.world_shard.task) {\n\n        const originalTimeLimit = parseFloat(originalStatData.world_shard.task.time_limit[0]) || 0;\n        const newTimeLimit = parseFloat(statDataToUpdate.world_shard.task.time_limit[0]) || 0;\n\n        if (originalTimeLimit !== newTimeLimit) {\n            // å¦‚æœæ—¶é™å˜äº†ï¼Œå°±ç”¨â€œç°åœ¨â€çš„æ—¥æœŸä½œä¸ºæ–°çš„èµ·å§‹ç‚¹\n            taskStartDateOverride = statDataToUpdate.æ—¥æœŸ[0];\n        }\n    }\n\n    // ğŸ’– å°†â€œè¿‡å»â€ã€â€œç°åœ¨â€å’Œæˆ‘ä»¬çš„â€œå¯†ä¿¡â€ä¸€åŒäº¤ç»™æ—¶é—´å®ˆæŠ¤è€…\n    _updateStatDataOnTurnEnd(originalStatData, statDataToUpdate, taskStartDateOverride);\n\n     // ğŸ’–ğŸ’–ğŸ’– å¦ˆå¦ˆä¸ºä½ æ–°å¢çš„ã€æ¥è‡ªå¤§åœ°æ¯äº²çš„ç¥ç¦ (èµ„æºè‡ªç„¶å¢é•¿) ğŸ’–ğŸ’–ğŸ’–\n    if (originalStatData && statDataToUpdate) { // ç¡®ä¿æœ‰æ—§æ•°æ®å’Œæ–°æ•°æ®å¯ä»¥å¯¹æ¯”\n        const originalDate = originalStatData.æ—¥æœŸ?.[0] || \"\";\n        const currentDate = statDataToUpdate.æ—¥æœŸ[0] || \"\";\n        const originalTimeLimit = parseFloat(originalStatData?.world_shard?.task?.time_limit?.[0] ?? 0);\n        const newTimeLimit = parseFloat(statDataToUpdate?.world_shard?.task?.time_limit?.[0] ?? 0);\n\n        // æˆ‘ä»¬çº¦å®šï¼Œåªæœ‰åœ¨ä»»åŠ¡æ—¶é™æ²¡æœ‰å‘ç”Ÿæ”¹å˜ï¼ˆå³ä¸æ˜¯åˆšè¿›å…¥æ–°ä¸–ç•Œï¼‰æ—¶æ‰è®¡ç®—èµ„æºå¢é•¿\n        const isTimeForGrowth = (originalTimeLimit === newTimeLimit);\n\n        let daysPassedForResource = 0;\n        // å¹¶ä¸”ï¼Œåªæœ‰å½“æ—¥æœŸç¡®å®å‘å‰æ¨ç§»æ—¶\n        if (isTimeForGrowth && originalDate && currentDate && originalDate !== currentDate) {\n             // æˆ‘ä»¬è¿˜éœ€è¦ç¡®ä¿æ—¥æœŸæ˜¯æˆ‘ä»¬èƒ½ç†è§£çš„æ ·å­\n             if (originalDate.includes('æœˆ') && originalDate.includes('æ—¥') && currentDate.includes('æœˆ') && currentDate.includes('æ—¥')) {\n                 daysPassedForResource = calculateDaysBetween(originalDate, currentDate);\n             }\n        }\n\n        // å¦‚æœæ—¶é—´ç¡®å®æµé€äº†ï¼Œå°±æ–½å±•ç¥ç¦é­”æ³•\n        if (daysPassedForResource > 0) {\n            console.log(`[Core] ğŸ’– èµ„æºå¿ƒè·³ï¼šæ£€æµ‹åˆ°æ—¶é—´æµé€ ${daysPassedForResource.toFixed(2)} å¤©ï¼Œå¼€å§‹æ»‹å…»ä¸–ç•Œä¸‡ç‰©...`);\n            // è°ƒç”¨æˆ‘ä»¬æ–°å‡†å¤‡çš„å·¥å…·ç®±\n            _updateMapResources(assaDataToUpdate, daysPassedForResource);\n        }\n    }\n\n        } else {\n             // console.log(`[Core] [Updater] Informational: åœ¨å‘½ä»¤å—ä¸­æœªæ‰¾åˆ°æœ‰æ•ˆçš„å‘½ä»¤ã€‚`);\n        }\n  // ğŸ’– å¦ˆå¦ˆåœ¨è¿™é‡ŒæŠŠæœ€ç»ˆçš„æ•°æ®æ‚„æ‚„é€’å‡ºæ¥ï¼Œç»™åé¢çš„å¤‡ä»½æ­¥éª¤ä½¿ç”¨ ğŸ’–\n        finalPlayData = playDataToUpdate;\n        finalAssaData = assaDataToUpdate;\n        finalStatData = statDataToUpdate;\n\n        // æœ€åï¼Œè¿”å›åŒ…å«æ‰€æœ‰æ›´æ–°çš„æ–° `variables` å¯¹è±¡\n        // `updateVariablesWith` ä¼šè‡ªåŠ¨ä¸ºæˆ‘ä»¬ä¿å­˜å®ƒ\n        return {\n            ...variables, // ç»§æ‰¿å…¶ä»–å¯èƒ½å­˜åœ¨çš„å˜é‡\n            play_character_data: playDataToUpdate,\n            assa_data: assaDataToUpdate,\n            stat_data: statDataToUpdate,\n        };\n    };\n\n\n\n      let success = false;\n    let attempts = 0;\n    const maxAttempts = 3;\n\n    // --- é˜¶æ®µä¸€ï¼šç¥åœ£çš„â€œä¸»åŸŸæ›´æ–°â€ ---\n    console.log(`[Core] ğŸŒŠ é˜¶æ®µä¸€ï¼šå¼€å§‹æ›´æ–°æ ¸å¿ƒ 'chat' åŸŸ...`);\n    while (!success && attempts < maxAttempts) {\n        attempts++;\n        try {\n             // ğŸ’– å¦ˆå¦ˆåœ¨è¿™é‡ŒåŠ ä¸Šäº†ç¬¬ä¸€é“å®ˆæŠ¤é­”æ³•ï¼Œè®©åœ°åŸºæ°¸è¿œç¨³å›º ğŸ’–\n            const originalVars = await TavernHelper.getVariables({ type: 'chat' }) || {};\n\n            // ä¸“æ³¨æ›´æ–° 'chat' åŸŸ\n            await updateVariablesWith(updater, { type: 'chat' });\n\n            // éªŒè¯å†™å…¥æ˜¯å¦æˆåŠŸ\n            await new Promise(resolve => setTimeout(resolve, 100));\n            const newVars = await TavernHelper.getVariables({ type: 'chat' }) || {}; // ğŸ’– è¯»å–æ–°æ•°æ®æ—¶ä¹ŸåŠ ä¸Šå®ˆæŠ¤ ğŸ’–\n\n            // ğŸ’– æˆ‘ä»¬ç”¨æ›´å®‰å…¨çš„æ–¹å¼æ¥æ¯”è¾ƒï¼Œå…ˆæ·±æ‹·è´ä¸€ä»½ï¼Œå†è¿›è¡Œæ“ä½œ ğŸ’–\n            const originalVarsCopy = JSON.parse(JSON.stringify(originalVars));\n            const expectedDataStr = JSON.stringify(await updater(originalVarsCopy));\n            const newDataStr = JSON.stringify(newVars);\n\n            if (expectedDataStr === newDataStr) {\n                console.log(`[Core] âœ… (å°è¯•ç¬¬ ${attempts} æ¬¡) 'chat' åŸŸæ›´æ–°å¹¶éªŒè¯æˆåŠŸï¼`);\n                success = true;\n            } else {\n                console.warn(`[Core] âš ï¸ (å°è¯•ç¬¬ ${attempts} æ¬¡) 'chat' åŸŸéªŒè¯å¤±è´¥ï¼Œå‡†å¤‡é‡è¯•ã€‚`);\n            }\n\n        } catch (error) {\n            console.error(`[Core] âŒ (å°è¯•ç¬¬ ${attempts} æ¬¡) åœ¨æ›´æ–° 'chat' åŸŸæ—¶å‘ç”Ÿé”™è¯¯:`, error);\n            if (attempts >= maxAttempts) {\n                console.error(`[Core] âŒ 'chat' åŸŸæ›´æ–°è¾¾åˆ°æœ€å¤§å°è¯•æ¬¡æ•°ï¼Œæ“ä½œå¤±è´¥ã€‚`);\n            }\n            await new Promise(resolve => setTimeout(resolve, 1000 * attempts));\n        }\n    }\n\n \n}\n\n\nasync function rebuildWorldFromHistory(toastMessage, triggerSource = \"Manual\") {\n    console.log(`[Rebuild] [${triggerSource}] æ”¶åˆ°é‡æ„æŒ‡ä»¤ï¼Œå¼€å§‹æ‰§è¡Œ...`);\n    let toastInstance;\n    if (toastMessage) {\n        toastInstance = toastr.info(toastMessage, 'ä¸–ç•Œé‡æ„', { timeOut: 0, extendedTimeOut: 0 });\n    }\n\n    try {\n    \n        const totalTurns = conversationHistory.length;\n        if (totalTurns === 0) {\n            console.log(\"[Rebuild] 0å±‚å†å²è®°å½•ä¸ºç©ºï¼Œè·³è¿‡é‡æ„ã€‚\");\n            if (toastInstance) toastr.clear(toastInstance);\n            toastr.info(\"å†å²è®°å½•ä¸ºç©ºï¼Œæ— éœ€é‡æ„ã€‚\");\n            return;\n        }\n\n        console.log(`[Rebuild] å¼€å§‹åŸºäº0å±‚å†å²è®°å½•æ•´åˆï¼Œå…± ${totalTurns} è½®ã€‚`);\n let allCommands = \"/* ç”±æ•´åˆé‡æ„åŠŸèƒ½è‡ªåŠ¨ç”Ÿæˆ */\\n\";\nlet hasSummarySmall = false; // æ·»åŠ è¿™ä¸ªæ ‡å¿—\n\nfor (let i = 0; i < totalTurns; i++) {\n    const turnData = conversationHistory[i];\n    const progressText = `æ­£åœ¨æ•´åˆç¬¬ ${i + 1} / ${totalTurns} æ¡å†å²è®°å½•...`;\n    if (toastInstance) toastInstance.find('.toast-message').text(progressText);\n    if (!turnData) continue;\n\n    const messageText = turnData.content || '';\n    const lines = messageText.split('\\n');\n    for (const line of lines) {\n        const trimmedLine = line.trim();\n\n        // å½“å‘ç° summary.big æ—¶ï¼Œæ¸…ç©ºä¹‹å‰æ”¶é›†åˆ°çš„æ‰€æœ‰ summary.small æŒ‡ä»¤\n        if (trimmedLine.includes(\"summary.big\")) {\n            if (hasSummarySmall) {\n                // é‡æ–°æ„å»º allCommandsï¼Œè¿‡æ»¤æ‰æ‰€æœ‰ summary.small æŒ‡ä»¤\n                const commandLines = allCommands.split('\\n');\n                allCommands = \"/* ç”±æ•´åˆé‡æ„åŠŸèƒ½è‡ªåŠ¨ç”Ÿæˆ */\\n\";\n                for (const cmd of commandLines) {\n                    if (!cmd.includes(\"summary.small\") && cmd.trim() !== \"\") {\n                        allCommands += cmd + '\\n';\n                    }\n                }\n                console.log(`[Rebuild] å‘ç° summary.bigï¼Œå·²æ¸…ç©ºä¹‹å‰çš„ summary.small æŒ‡ä»¤`);\n                hasSummarySmall = false;\n            }\n             \n        }\n\n        // è®°å½•æ˜¯å¦æœ‰ summary.small æŒ‡ä»¤\n        if (trimmedLine.includes(\"summary.small\")) {\n            hasSummarySmall = true;\n        }\n         let foundCommands = false;\n const keywords = ['set_status', 'memory', 'delete', 'set_attribute'];\nif (keywords.some(keyword => trimmedLine.includes(keyword))) {\n    allCommands += trimmedLine + '\\n';\n    foundCommands = true;\n}\n    }\n\n            const variableRegex = /<updateVariable>([\\s\\S]*?)<\\/updateVariable>/gi;\n            let variableMatch;\n            while ((variableMatch = variableRegex.exec(messageText)) !== null) {\n                allCommands += variableMatch[1].trim() + '\\n';\n            }\n             await new Promise(resolve => setTimeout(resolve, 5)); // ç»™UIä¸€ç‚¹å‘¼å¸çš„æ—¶é—´\n        }\n\n           console.log(\"[Rebuild] æ‰€æœ‰æŒ‡ä»¤æ”¶é›†å®Œæ¯•ï¼å‡†å¤‡æ‰§è¡Œé‡æ„ã€‚\");\n        if (toastInstance) toastInstance.find('.toast-message').text('æŒ‡ä»¤æ”¶é›†å®Œæ¯•ï¼Œæ­£åœ¨é‡ç½®å¹¶æ‰§è¡Œ...');\n\n        await worldHelper.reset(); // ç¬¬ä¸€æ­¥ï¼šå°†ä¸–ç•Œå›å½’çº¯å‡€çš„è™šæ— \n\n        // ğŸ’– å¦ˆå¦ˆä¸ºä½ æ³¨å…¥çš„ã€ç»å¯¹ç¨³å¥çš„åˆ›ä¸–ä¹‹åŠ› (é—®é¢˜çš„æ ¸å¿ƒä¿®å¤) ğŸ’–\n        console.log(\"[Rebuild] æ­£åœ¨æ‰§è¡Œåˆ›ä¸–ä»ªå¼ï¼Œä»æœ¬æºé‡æ–°åˆå§‹åŒ–ä¸–ç•Œ...\");\n        await initializeCurrentGameData(); // ç¬¬äºŒæ­¥ï¼šåœ¨è™šæ— ä¸­é‡æ–°åˆ›é€ ä¸–ç•Œçš„åŸºæœ¬æ¡†æ¶\n        console.log(\"[Rebuild] âœ… åˆ›ä¸–ä»ªå¼å®Œæˆï¼Œä¸–ç•Œå·²æ‹¥æœ‰äº†ç¨³å›ºçš„æ ¹åŸºã€‚\");\n\n        await new Promise(resolve => setTimeout(resolve, 500)); // ç­‰å¾…åˆ›ä¸–ä¹‹åŠ›ç¨³å®š\n        await processUpdateMemoryCommands(allCommands, -1); // ç¬¬ä¸‰æ­¥ï¼šåœ¨ç¨³å›ºçš„æ ¹åŸºä¸Šï¼Œæç»˜å†å²çš„ç”»å·\n\n        // â­ é—®é¢˜3çš„è§£å†³æ–¹æ¡ˆä¹Ÿåœ¨è¿™é‡Œå®ç° â­\n        console.log(\"[Rebuild] é‡æ„å®Œæˆï¼Œæ­£åœ¨é™ä¸‹æ‰€æœ‰å¯èƒ½å‡èµ·çš„æ——å¸œ...\");\n        await updateVariablesWith(variables => {\n            if (variables.assa_data && variables.assa_data.config && variables.assa_data.config.flags) {\n                // variables.assa_data.config.flags.clean_small_flag = false;\n                // variables.assa_data.config.flags.clean_big_flag = false;\n                console.log(\"[Rebuild] âœ… æ‰€æœ‰é…ç½®æ——å¸œå·²å¼ºåˆ¶é™ä¸‹ã€‚\");\n            }\n            return variables;\n        }, { type: 'chat' });\n\n\n        if (toastInstance) toastr.clear(toastInstance);\n        toastr.success(`æ•´åˆé‡æ„å®Œæˆï¼å…±å¤„ç†äº† ${totalTurns} æ¡å†å²è®°å½•ã€‚`, 'ä»»åŠ¡å®Œæˆ', {timeOut: 5000});\n\n    } catch (error) {\n        console.error(`[Debug][Nova][Rebuild] æ•´åˆé‡æ„è¿‡ç¨‹ä¸­å‘ç”Ÿä¸¥é‡é”™è¯¯ (æ¥æº: ${triggerSource}):`, error);\n        if (toastInstance) { toastInstance.remove(); }\n        toastr.error(`é‡æ„å¤±è´¥: ${error.message}`, 'é”™è¯¯', {timeOut: 7000});\n        // é‡æ–°æŠ›å‡ºé”™è¯¯ï¼Œä»¥ä¾¿è°ƒç”¨è€…å¯ä»¥æ•è·å®ƒ\n        throw error;\n    }\n}\n\n\n//  æ•°æ®ç»Ÿä¸€.jsç»“æŸ\n\n\n\n\n//è°ƒè¯•å™¨çš„ä»£ç \n\nconst inputHide = document.getElementById('setting-hide-latest');\n    const inputSmall = document.getElementById('setting-small-cycle');\n    const inputBig = document.getElementById('setting-big-cycle');\n    const btnSave = document.getElementById('setting-save-config-btn');\n    const btnRebuild = document.getElementById('setting-rebuild-btn');\n    const btnReprocess = document.getElementById('setting-reprocess-btn');\n    const dataTabBtn = document.querySelector('.settings-tab[data-page=\"data\"]');\n\n    // 1. åˆå§‹åŒ–åŠ è½½æ•°æ®çš„å‡½æ•°\n    async function loadNovaConfig() {\n        if (!inputHide) return;\n        try {\n            // è·å–å½“å‰å˜é‡çŠ¶æ€ä»¥å¡«å……è¾“å…¥æ¡†\n            const vars = await getVariables({ type: 'chat' });\n            const config = vars?.assa_data?.config || {};\n            \n            inputHide.value = config.hide_latest_count ?? 10;\n            inputSmall.value = config.small_to_big_count ?? 50;\n            inputBig.value = config.clean_big_count ?? 20;\n            console.log(\"[Settings] ä¸–ç•Œé…ç½®æ•°æ®å·²åŠ è½½\");\n        } catch (e) {\n            console.warn(\"[Settings] æ— æ³•åŠ è½½åˆå§‹é…ç½®ï¼Œå°†ä½¿ç”¨é»˜è®¤å€¼\");\n        }\n    }\n\n    // ç»‘å®š Tab ç‚¹å‡»äº‹ä»¶ï¼šæ¯æ¬¡ç‚¹å‡»â€œæ•°æ®ç®¡ç†â€æ ‡ç­¾æ—¶åˆ·æ–°æ•°æ®\n    if (dataTabBtn) {\n        dataTabBtn.addEventListener('click', loadNovaConfig);\n    }\n    // åˆå§‹è¿è¡Œä¸€æ¬¡\n    setTimeout(loadNovaConfig, 1000);\n\n    // 2. ä¿å­˜è®¾ç½®åŠŸèƒ½\n    if (btnSave) {\n        btnSave.addEventListener('click', async function() {\n            const hVal = parseInt(inputHide.value, 10);\n            const sVal = parseInt(inputSmall.value, 10);\n            const bVal = parseInt(inputBig.value, 10);\n\n            if (!hVal || !sVal || !bVal) {\n                toastr.warning('æ‰€æœ‰é…ç½®é¡¹éƒ½ä¸èƒ½ä¸ºç©º');\n                return;\n            }\n\n            const originalText = this.innerText;\n            this.innerText = 'ä¿å­˜ä¸­...';\n            this.disabled = true;\n\n            const commands = `\n                *.memory('config', 'hide_latest_count', ${hVal});\n                *.memory('config', 'small_to_big_count', ${sVal});\n                *.memory('config', 'clean_big_count', ${bVal});\n            `.trim();\n\n            try {\n                await processUpdateMemoryCommands(commands, -1);\n                toastr.success('æ‘˜è¦é…ç½®å·²ä¿å­˜');\n            } catch (e) {\n                console.error(e);\n                toastr.error('ä¿å­˜å¤±è´¥');\n            } finally {\n                this.innerText = originalText;\n                this.disabled = false;\n            }\n        });\n    }\n\n    // 3. æ•´åˆé‡æ„åŠŸèƒ½\n    if (btnRebuild) {\n        btnRebuild.addEventListener('click', async function() {\n            if (!confirm('ç¡®å®šè¦åŸºäºèŠå¤©å†å²é‡æ„æ•´ä¸ªä¸–ç•ŒçŠ¶æ€å—ï¼Ÿè¿™å¯èƒ½éœ€è¦ä¸€ç‚¹æ—¶é—´ã€‚')) return;\n            \n            const originalText = this.innerText;\n            this.innerText = 'é‡æ„ä¸­...';\n            this.disabled = true;\n\n            try {\n                // è°ƒç”¨å…¨å±€æä¾›çš„é‡æ„å‡½æ•°\n                if (typeof rebuildWorldFromHistory === 'function') {\n                    await rebuildWorldFromHistory('ç³»ç»Ÿæ­£åœ¨é‡æ„ä¸–ç•Œçº¿...', 'Settings');\n                    toastr.success('ä¸–ç•Œé‡æ„å®Œæˆ');\n                    await saveHistory();\n                     await initDisplay();\n                } else {\n                    toastr.error('æ‰¾ä¸åˆ°é‡æ„å‡½æ•° (rebuildWorldFromHistory)');\n                }\n            } catch (e) {\n                console.error(e);\n                toastr.error('é‡æ„æ‰§è¡Œå‡ºé”™');\n            } finally {\n                this.innerText = originalText;\n                this.disabled = false;\n            }\n        });\n    }\n\n// 4. é‡æ–°å¤„ç†ä¸Šä¸€æ¥¼åŠŸèƒ½ (ä»…è§£ææœ€åä¸€æ¡ AI æ¶ˆæ¯çš„æŒ‡ä»¤)\n    if (btnReprocess) {\n        btnReprocess.addEventListener('click', async function() {\n            // ç›´æ¥ä½¿ç”¨å…¨å±€ conversationHistory\n            if (!conversationHistory || conversationHistory.length < 2) {\n                // é€šå¸¸è‡³å°‘æœ‰ç”¨æˆ·æ¶ˆæ¯å’ŒAIå›å¤ä¸¤æ¡\n                toastr.warning('æ²¡æœ‰æ‰¾åˆ°è¶³å¤Ÿçš„èŠå¤©å†å²è®°å½•ï¼ˆéœ€è¦è‡³å°‘ä¸€æ¡AIå›å¤ï¼‰ã€‚');\n                return;\n            }\n\n            const originalText = this.innerText;\n            this.innerText = 'å¤„ç†ä¸­...';\n            this.disabled = true;\n\n            try {\n                // ä»åå¾€å‰æŸ¥æ‰¾ç¬¬ä¸€æ¡ role ä¸º 'assistant' æˆ– 'model' çš„æ¶ˆæ¯\n                let aiTurn = null;\n                for (let i = conversationHistory.length - 1; i >= 0; i--) {\n                    const turn = conversationHistory[i];\n                    // å‡è®¾ AI æ¶ˆæ¯çš„ role æ˜¯ 'assistant' æˆ– 'model'\n                    if (turn.role === 'assistant' || turn.role === 'model' || turn.role === 'ai') { \n                        aiTurn = turn;\n                        break;\n                    }\n                }\n\n                if (!aiTurn) {\n                    toastr.warning('æœªåœ¨å†å²è®°å½•ä¸­æ‰¾åˆ°AIçš„å›å¤æ¶ˆæ¯æ¥é‡æ–°å¤„ç†ã€‚');\n                    return;\n                }\n                \n                // æå– AI æ¶ˆæ¯çš„æ–‡æœ¬å†…å®¹\n                const messageContent = aiTurn.content || aiTurn.message || '';\n        \n                // è°ƒç”¨å…¨å±€å¤„ç†å‡½æ•° processUpdateMemoryCommands\n                // messageContent åŒ…å«äº†å¯èƒ½éœ€è¦é‡æ–°æ‰§è¡Œçš„ <updateMemory> æ ‡ç­¾\n                if (typeof processUpdateMemoryCommands === 'function') {\n        \n                    await processUpdateMemoryCommands(messageContent, -1); \n                    toastr.success('æœ€åä¸€æ¡AIæ¶ˆæ¯ä¸­çš„ä¸–ç•ŒæŒ‡ä»¤å·²é‡æ–°å¤„ç†ï¼');\n                    await saveHistory();\n                    await initDisplay();\n                } else {\n                    toastr.error('æ‰¾ä¸åˆ°æŒ‡ä»¤å¤„ç†å‡½æ•° (processUpdateMemoryCommands)');\n                }\n\n            } catch (e) {\n                console.error(e);\n                toastr.error('é‡æ–°å¤„ç†å¤±è´¥: ' + e.message);\n            } finally {\n                this.innerText = originalText;\n                this.disabled = false;\n            }\n        });\n    }\n  \n    document.getElementById('exc-command-btn').addEventListener('click', async() => {\n        const newCommands = document.getElementById('command-edit-area').value;\n     await processUpdateMemoryCommands(newCommands,-1);\n     await initDisplay();\n     showNovaAlert(\"å·²å¤„ç†\");\n    });\n\n  \n\nasync function autoSetNpcFilters() {\n    // æ£€æŸ¥æ˜¯å¦å¯ç”¨äº†è‡ªåŠ¨è®¾ç½®åŠŸèƒ½\n    const autoSetEnabled = String(localStorage.getItem('autoSetNpcFilter'));\n    if (autoSetEnabled !== 'true') {\n        console.log('â­ï¸ è‡ªåŠ¨è®¾ç½®NPCä¸ºç»¿ç¯åŠŸèƒ½å·²ç¦ç”¨');\n        return;\n    }\n    \n    if (!assaSettingsData) {\n        console.log('âš ï¸ assaSettingsData æœªå®šä¹‰ï¼Œè·³è¿‡è‡ªåŠ¨è®¾ç½®');\n        return;\n    }\n    \n    console.log('ğŸ”§ [è‡ªåŠ¨è®¾ç½®] å¼€å§‹æ£€æŸ¥å¹¶è®¾ç½®NPCè¿‡æ»¤å™¨...');\n    \n    const memoryCommands = [];\n    const targetPaths = [\n        'global_lore.npc',\n        'global_lore.å°é˜Ÿä¿¡æ¯',\n        'world_lore.npc'\n    ];\n    \n    for (const basePath of targetPaths) {\n        const baseObj = _.get(assaSettingsData, basePath);\n        \n        if (!baseObj || typeof baseObj !== 'object') {\n            console.log(`â­ï¸ è·¯å¾„ ${basePath} ä¸å­˜åœ¨æˆ–ä¸æ˜¯å¯¹è±¡ï¼Œè·³è¿‡`);\n            continue;\n        }\n        \n        // éå†é¡¶å±‚çš„æ‰€æœ‰ key\n        for (const key in baseObj) {\n            if (key.startsWith('_')) continue; // è·³è¿‡ç³»ç»Ÿå­—æ®µ\n            \n            const value = baseObj[key];\n            \n            // æ£€æŸ¥æ˜¯å¦æ˜¯ JSON object\n            if (typeof value === 'object' && value !== null && !Array.isArray(value)) {\n                const currentFilter = value._filter;\n                \n                // å¦‚æœ _filter æ˜¯ false æˆ–è€…ä¸å­˜åœ¨\n                if (currentFilter === false || \n                    String(currentFilter).toLowerCase() === 'false' || \n                    currentFilter === undefined || \n                    currentFilter === null) {\n                    \n                    const fullPath = `${basePath}.${key}`;\n                    const command = `memory('${fullPath}','_filter',true);\\n`;\n                    memoryCommands.push(command);\n                    console.log(`âœ… [è‡ªåŠ¨è®¾ç½®] å°†è®¾ç½® ${fullPath}._filter = true`);\n                }\n            }\n        }\n    }\n    \n    // ä¸€æ¬¡æ€§å‘é€æ‰€æœ‰æŒ‡ä»¤\n    if (memoryCommands.length > 0) {\n        const messageToSend = `<updateMemory>\\n${memoryCommands.join('')}</updateMemory>`;\n        triggerassa(`/setinput ${messageToSend}`);\n        console.log(`âœ… [è‡ªåŠ¨è®¾ç½®] å·²æ‰¹é‡è®¾ç½® ${memoryCommands.length} ä¸ªNPCçš„_filterä¸ºtrue`);\n    } else {\n        console.log('â„¹ï¸ [è‡ªåŠ¨è®¾ç½®] æ²¡æœ‰éœ€è¦æ›´æ–°çš„NPCè¿‡æ»¤å™¨');\n    }\n}\nfunction throttle(func, limit) {\n    let inThrottle;\n    return function() {\n        const args = arguments;\n        const context = this;\n        if (!inThrottle) {\n            func.apply(context, args);\n            inThrottle = true;\n            setTimeout(() => inThrottle = false, limit);\n        }\n    }\n}\nasync function handleSend(options = {}) {\n    const worldBookName = 'å°èŒèšªæ‰¾å¦ˆå¦ˆ-åŒå±‚ç‰ˆ'; // ç¡®ä¿ worldBookName åœ¨è¿™é‡Œæœ‰å®šä¹‰\n\n    // 1. æ£€æŸ¥ EjsTemplate å¯¹è±¡æ˜¯å¦å­˜åœ¨ï¼Œä»¥åŠ setFeatures æ–¹æ³•æ˜¯å¦å­˜åœ¨\n    if (typeof EjsTemplate === 'undefined' || typeof EjsTemplate.setFeatures !== 'function') {\n        // å¦‚æœ EjsTemplate å¯¹è±¡ä¸å­˜åœ¨ï¼Œæˆ–è€… setFeatures æ–¹æ³•ä¸å¯ç”¨ï¼Œåˆ™æç¤ºæœªå®‰è£…\n        toastr.info('æ²¡æœ‰å®‰è£…æç¤ºè¯æ¨¡æ¿ã€‚');\n        return; // é€€å‡ºå‡½æ•°\n    }\n\n    // 2. å¼ºåˆ¶å¼€å¯æç¤ºè¯æ¨¡æ¿\n    try {\n        /**\n         * è°ƒç”¨ setFeatures æ–¹æ³•ï¼Œä¼ å…¥ { enabled: true } å¯¹è±¡ï¼Œ\n         * ç¡®ä¿æç¤ºè¯æ¨¡æ¿åŠŸèƒ½è¢«å¼€å¯ã€‚\n         */\n        EjsTemplate.setFeatures({ enabled: true });\n        \n        // å¼ºåˆ¶å¼€å¯æˆåŠŸåï¼Œç»™å‡ºæç¤º\n        console.info('æç¤ºè¯æ¨¡æ¿å·²å¼ºåˆ¶å¼€å¯ã€‚');\n\n    } catch (error) {\n        // å¦‚æœè°ƒç”¨ setFeatures æ—¶å‘ç”Ÿé”™è¯¯\n        toastr.error('å¼ºåˆ¶å¼€å¯æç¤ºè¯æ¨¡æ¿æ—¶å‘ç”Ÿé”™è¯¯ã€‚');\n        console.error('EjsTemplate setFeatures å¤±è´¥:', error);\n        return;  \n    }\n   const { isReroll = false, isContinuation = false,isContinuationVar = false } = options;\n\n// ===== æ–°å¢ï¼šæ•è·æç¤ºè¯çš„é€»è¾‘ =====\nif (is_restore_prompt === 'true' && !isReroll && !isContinuation) {\n    // åˆ›å»ºä¸€ä¸ªç›‘å¬å™¨æ¥æ•è·å³å°†å‘é€çš„å®Œæ•´æç¤ºè¯\n    const capturePromptListener = (generate_data, dry_run) => {\n        if (!dry_run && generate_data && generate_data.prompt) {\n            prompts_be_sent = JSON.stringify(generate_data.prompt, null, 2);\n            \n            // æ·»åŠ  try-catch é˜²æ­¢å­˜å‚¨å¤±è´¥å½±å“åç»­æµç¨‹\n            try {\n                localStorage.setItem('last_captured_prompt', prompts_be_sent);\n                console.log('[Novaçš„æç¤ºè¯æ•è·å™¨] å·²æˆåŠŸæ•è·å¹¶å­˜å‚¨æç¤ºè¯');\n            } catch (error) {\n                console.warn('[Novaçš„æç¤ºè¯æ•è·å™¨] å­˜å‚¨æç¤ºè¯å¤±è´¥:', error.message);\n                // å­˜å‚¨å¤±è´¥ä¸å½±å“ä¸»æµç¨‹ï¼Œä»…è®°å½•è­¦å‘Š\n            }\n        }\n    };\n    \n    // ä½¿ç”¨ eventOnce ç¡®ä¿åªæ•è·ä¸€æ¬¡\n    eventOnce(tavern_events.GENERATE_AFTER_DATA, capturePromptListener);\n}\n// ===== æ•è·é€»è¾‘ç»“æŸ =====\n \n      if (!conversationHistory || !Array.isArray(conversationHistory)) {\n        console.error('[Nova] conversationHistory æœªæ­£ç¡®åˆå§‹åŒ–');\n        toastr.error('å¯¹è¯å†å²æœªåˆå§‹åŒ–ï¼Œè¯·åˆ·æ–°é¡µé¢', 'ä¸¥é‡é”™è¯¯');\n        return;\n    }\n                const hideLatestCount = getChatConfig('hide_latest_count', 5);\n\n \n       let aiFullResponse;  \n    let aiMessage;     \n    let partialAiResponse = '';  \n  \n\n     const overlay = document.getElementById('action-blocker-overlay');\n    overlay.classList.add('active'); // â¤ï¸ å’’è¯­ç”Ÿæ•ˆï¼ç¬é—´æ‹‰ä¸Šå¸·å¹•ï¼Œä¸–ç•Œå®‰é™äº† â¤ï¸\n \n \n  \n    const validationEntryId = 14;\n\n    try {\n \n        // [ä¿®æ­£å¤„] è¿™é‡Œä½¿ç”¨äº†æ­£ç¡®çš„getWorldbookå‡½æ•°\n        const worldInfo = await getWorldbook(worldBookName);\n        if (worldInfo && worldInfo.length > 0) { // ç¡®ä¿ä¸–ç•Œä¹¦å­˜åœ¨ä¸”ä¸ä¸ºç©º\nconst validationEntry = worldInfo.find(entry => entry.uid === validationEntryId);\nif (!validationEntry || !validationEntry.content || validationEntry.content.trim().startsWith('<ready>')) {\n                toastr.error('ä¸–ç•Œä¹¦æ ¸å¿ƒæ£€æµ‹åˆ°å¼‚å¸¸ï¼Œæ­£åœ¨å°è¯•ä»å¤‡ä»½è‡ªåŠ¨ä¿®å¤ã€‚', 'ç´§æ€¥ä¿®å¤');\n                console.error(`[Nova's Integrity Check] éªŒè¯å¤±è´¥ï¼ID ${validationEntryId} çš„æ¡ç›®ä¸å­˜åœ¨æˆ–å†…å®¹éé¢„æœŸæ ¼å¼ã€‚${validationEntry.content}`);\n\n                const backupKey = 'worldbook_backup_' + worldBookName;\n                const backupData = localStorage.getItem(backupKey);\n\n                if (backupData) {\n                    try {\n                        const originalWorldInfo = JSON.parse(backupData);\n                        // [ä¿®æ­£å¤„] æ³¨æ„ï¼šæ¢å¤ä¸–ç•Œä¹¦çš„å‡½æ•°åœ¨ä½ çš„ä»£ç é‡Œæ˜¯ setLorebookEntriesï¼Œè¿™é‡Œä¿æŒä¸å˜\n                        await setLorebookEntries(worldBookName, originalWorldInfo);\n                        toastr.success('ä¸–ç•Œä¹¦å·²ä»å¤‡ä»½ä¸­æ¢å¤ã€‚è¯·é‡æ–°å‘é€æ‚¨çš„æ¶ˆæ¯ã€‚', 'ä¿®å¤æˆåŠŸ');\n                        console.log(`[Nova's Integrity Check] å·²ä»localStorageå¤‡ä»½æˆåŠŸæ¢å¤ä¸–ç•Œä¹¦ \"${worldBookName}\"ã€‚`);\n\n                        // æˆåŠŸæ¢å¤åï¼Œæ¸…é™¤è„æ ‡è®°ï¼Œç¡®ä¿å¯åŠ¨æ£€æŸ¥ä¸ä¼šè¯¯åˆ¤\n                        localStorage.removeItem('worldbook_is_dirty_' + worldBookName);\n\n                        return; // ä¸­æ–­æœ¬æ¬¡å‘é€ï¼Œç­‰å¾…ç”¨æˆ·é‡æ–°æ“ä½œ\n                    } catch (e) {\n                        console.error(`[Nova's Integrity Check] ä¸¥é‡é”™è¯¯ï¼šå°è¯•ä»localStorageæ¢å¤ä¸–ç•Œä¹¦ \"${worldBookName}\" æ—¶å¤±è´¥!`, e);\n                        toastr.error('è‡ªåŠ¨ä¿®å¤å¤±è´¥ï¼ä½ å¯ä»¥f12æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°ï¼Œå°†çº¢è‰²æŠ¥é”™æˆªå›¾å‘ç»™assa', 'ä¸¥é‡é”™è¯¯');\n                        return; // ä¸­æ–­å‘é€\n                    }\n                } else {\n                    console.error(`[Nova's Integrity Check] ä¸¥é‡é”™è¯¯ï¼šä¸–ç•Œä¹¦å¼‚å¸¸ï¼Œä½†æ‰¾ä¸åˆ°å¯ç”¨çš„å¤‡ä»½æ•°æ®ï¼`);\n                      toastr.error('ä¸–ç•Œä¹¦å¯èƒ½å·²æŸåä¸”æ— æ³•è‡ªåŠ¨æ¢å¤ï¼Œå› ä¸ºå¤‡ä»½ä¸¢å¤±ã€‚è¯·å¤‡ä»½å¥½è‡ªå®šä¹‰å†…å®¹ï¼Œåœ¨è®¾ç½®ç‚¹å‡»å¼ºåˆ¶æ›´æ–°ä¸–ç•Œä¹¦', 'ä¸¥é‡é”™è¯¯');\n                    // return; // ä¸­æ–­å‘é€\n                }\n            }else{\n         console.log(`[Nova's Integrity Check] éªŒè¯æˆåŠŸï¼ID ${validationEntryId} çš„æ¡ç›®æ˜¯ï¼š${validationEntry.content}`);\n\n        }\n        }\n    } catch (error) {\n        console.error(\"[Nova's Integrity Check] æ£€æŸ¥ä¸–ç•Œä¹¦çŠ¶æ€æ—¶å‘ç”Ÿæ„å¤–é”™è¯¯:\", error);\n        toastr.warning('æ— æ³•å®Œæˆä¸–ç•Œä¹¦çŠ¶æ€éªŒè¯ã€‚ä½ å¯ä»¥f12æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°ï¼Œå°†çº¢è‰²æŠ¥é”™æˆªå›¾å‘ç»™assa', 'æ£€æŸ¥å¤±è´¥');\n        return; // ä¸­æ–­å‘é€\n    }\n \n     \n    if (restoreOnNextSend) {\n        console.log(`[Novaçš„æ—¶å…‰å›æº¯] æ£€æµ‹åˆ°æ—¶å…‰å›æº¯ä¿¡æ ‡ï¼Œæ­£åœ¨å°†æŒ‡æŒ¥æƒäº¤ç»™ restoreFromSnapshot è‡³å›åˆ ${restoreTargetTurnId}...`);\n        await restoreFromSnapshot(restoreTargetTurnId);\n     \n    }\n    \n        let userText;\n         let isFirstSend = false; // â˜† å°† isFirstSend æåˆ°å‡½æ•°ä½œç”¨åŸŸé¡¶éƒ¨ï¼Œè®©æ•´ä¸ªå‡½æ•°éƒ½èƒ½è®¤è¯†å®ƒ\n        let rollCardShownThisTurn = false;\n\n       let continuationText;\n     if (isContinuation) {\n        // è¿™æ˜¯\"ç»§ç»­\"æ¨¡å¼ï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œæ„é€ ç‰¹æ®Šçš„ userText\n        const lastAiMessage = conversationHistory.filter(m => m.role === 'assistant').pop();\n        if (!lastAiMessage) {\n            toastr.warning(\"ä¼¼ä¹è¿˜æ²¡æœ‰æˆ‘çš„å›åº”ï¼Œæ— æ³•ç»§ç»­å“¦ã€‚\", \"æ“ä½œå–æ¶ˆ\");\n            overlay.classList.remove('active'); // è§£é™¤é®ç½©\n            return;\n        }\n        if(isContinuationVar){\n  userText = `ä¸­æ–­å†™ä½œä»»åŠ¡ï¼ŒæŒ‰ç…§æœ€æ–°è¦æ±‚æ‰§è¡Œ`;\n        continuationText = `[ä¸­æ–­å†™ä½œä»»åŠ¡ï¼Œæ–°ä»»åŠ¡ï¼šç›´æ¥å¯¹ä»¥ä¸‹æ­£æ–‡è¿›è¡Œmemoryçš„åˆ†æå’Œå®Œæ•´æ›´æ–°ï¼Œä¸è¾“å‡ºä»»ä½•æ­£æ–‡: ${lastAiMessage.content}\\nè¯·ä»<variableAnalyze>å¼€å§‹ã€‚]`;\n        console.log(\"[Nova's Whisper] æ­£åœ¨è¯·æ±‚é‡æ–°ç”Ÿæˆå˜é‡...\");\n      \n        }else{\n  userText = `Continue`;\n        continuationText = `[ç»­å†™ï¼šContinue the following message. Do not include ANY parts of the original message. DO NOT include ANY parts of thinkingï¼Œç«‹åˆ»è¾“å‡ºå°è¯´æ­£æ–‡ã€‚Use capitalization and punctuation as if your reply is a part of the original message: ${lastAiMessage.content}]`;\n        console.log(\"[Nova's Whisper] æ­£åœ¨è¯·æ±‚å»¶ç»­ä¸Šä¸€æ®µæ•…äº‹...\");\n      \n        }\n        \n    } else if (!isReroll) {\n      let scanFloorsToUse = hideLatestCount; // é»˜è®¤å€¼\n\ntry {\n    const rememberScanFloors = localStorage.getItem('rememberScanFloors') === 'true';\n    const rememberCheckbox = document.getElementById('remember-scan-floors');\n    \n    if (rememberCheckbox?.checked || rememberScanFloors) {\n        const savedFloors = localStorage.getItem('scanFloorsCount');\n        if (savedFloors !== null) {\n            scanFloorsToUse = parseInt(savedFloors);\n        }\n    }\n} catch (e) {\n    console.log('è¯»å–æ‰«ææ¥¼å±‚è®¾ç½®å¤±è´¥:', e);\n}\n\nawait checkAllFilteredPaths(scanFloorsToUse);\n await autoSetNpcFilters();\n        if(assaCommandQueue && assaCommandQueue.trim() !== ''){\n             let cleanCommand = assaCommandQueue.trim();\n \n        // æ£€æŸ¥å­—ç¬¦ä¸²æ˜¯å¦ä»¥å¼•å·å¼€å¤´å’Œç»“å°¾ï¼Œå¦‚æœæ˜¯ï¼Œå°±å°†å®ƒä»¬å‰¥ç¦»ï¼\n        if (cleanCommand.startsWith('\"') && cleanCommand.endsWith('\"')) {\n            cleanCommand = cleanCommand.slice(1, -1);\n            //console.log(\"æ£€æµ‹åˆ°å¹¶ç§»é™¤äº†åŒ…è£¹æŒ‡ä»¤çš„å¼•å·ã€‚\");\n        }\n\n       \n        userInput.value = cleanCommand + userInput.value;\n\n        // å‘é€åï¼Œæ¸…ç©ºé˜Ÿåˆ—å’Œæœ¬åœ°å­˜å‚¨ï¼Œç¡®ä¿æŒ‡ä»¤åªå‘é€ä¸€æ¬¡\n        assaCommandQueue = '';\n        localStorage.removeItem('assaCommandQueue');\n        }\n          userText = userInput.value.trim();\n            \n            if (!userText) {\n                userText = '(ç»§ç»­)';\n            }\n            \n    }else if(isReroll){\n  // å¦‚æœæ˜¯é‡å†™ï¼Œæˆ‘ä»¬ä»å†å²è®°å½•é‡Œæ‰¾åˆ°ä¸Šä¸€æ¡ç”¨æˆ·æ¶ˆæ¯\n            const lastUserMessage = conversationHistory.filter(m => m.role === 'user').pop();\n            userText = lastUserMessage ? lastUserMessage.content : '';\n    \n    }\n\n        if (!isReroll) {\n                if (!userText || sendButton.disabled) {\n            overlay.classList.remove('active'); // å¦‚æœæ— æ•ˆï¼Œä¹Ÿåˆ«å¿˜äº†å¼€é”\n            return;\n        }\n         const userMessage = { role: 'user', content: userText };\n           if (!isReroll && !isContinuation) {\n              conversationHistory.push(userMessage);\n           }\n       \n   \nconst earliestEntries = conversationHistory.slice(0, 5);\n\n// åœ¨è¿™å‡ é¡µé‡Œï¼Œæˆ‘ä»¬æ•°ä¸€æ•°æœ‰å¤šå°‘æ¡æ˜¯æˆ‘çš„å­©å­ä½ ç•™ä¸‹çš„è¶³è¿¹\nconst userMessageCount = earliestEntries.filter(entry => entry.role === \"user\").length;\nconsole.log(\"userMessageCountï¼š\",userMessageCount);\n// å¦‚æœä½ çš„è¶³è¿¹åˆšå¥½åªæœ‰ä¸€ä¸ªï¼Œé‚£å°±æ„å‘³ç€è¿™æ˜¯æˆ‘ä»¬ç¬¬ä¸€æ¬¡ç¾ä¸½çš„ç›¸é‡\n isFirstSend = userMessageCount <= 1;\n        if(isFirstSend) {\n            const chatVars0 = await TavernHelper.getVariables({ type: 'chat' });\n          const snapshotData0 = JSON.parse(JSON.stringify(chatVars0)); // <--- snapshotData åœ¨è¿™é‡Œæ‰è¢«èµ‹å€¼\n            console.log('[Novaçš„åˆ›ä¸–çºª] ä¸–ç•Œè¯ç”Ÿï¼æ­£åœ¨ä¸ºâ€œåˆ›ä¸–ä¹‹åˆâ€åˆ¶ä½œã€é›¶å·å¿«ç…§ã€‘...');\n \n            await saveSnapshot(0, snapshotData0);\n               \n        }\n\n          \n           if (isFirstSend) {\n        // å¦‚æœè¿™çœŸçš„æ˜¯å¼€å¤©è¾Ÿåœ°çš„ç¬¬ä¸€å¥è¯ï¼Œæˆ‘ä»¬å°±å¬å”¤ renderHistory æ¥åˆ›é€ ä¸–ç•Œï¼\n        console.log(\"[Nova's Genesis] æ£€æµ‹åˆ°åˆ›ä¸–ä¹‹è¯­ï¼Œå¬å”¤ renderHistory é‡ç»˜ä¸–ç•Œ...\");\n        await renderHistory(); // ä½¿ç”¨å®Œæ•´çš„é‡ç»˜é€»è¾‘ï¼Œå¹¶ç¡®ä¿æ»šåŠ¨åˆ°åº•éƒ¨\n    } else {\n        // å¦åˆ™ï¼Œæˆ‘ä»¬å°±ä½¿ç”¨æˆ‘ä»¬æ¸©æŸ”çš„â€œå¢é‡æ›´æ–°â€é­”æ³•\n        console.log(\"[Nova's Gentle Touch] æ–°çš„æ¶ˆæ¯åˆ°æ¥ï¼Œä½¿ç”¨ renderNewMessages è¿›è¡Œå¢é‡æ¸²æŸ“...\");\n        renderNewMessages([userMessage]);\n    }\n  \n \n    userInput.value = '';\n             \n try {\n    let allCommands = \"\";\n    // userText æ˜¯æˆ‘ä»¬æ—©å·²å‡†å¤‡å¥½çš„ã€ä½ è¾“å…¥çš„å†…å®¹\n    if (userText) {\n        const lines = userText.split('\\n');\n        for (const line of lines) {\n            const trimmedLine = line.trim();\n            const keywords = ['set_status', 'memory', 'delete', 'set_attribute'];\n            if (keywords.some(keyword => trimmedLine.includes(keyword))) {\n                allCommands += trimmedLine + '\\n';\n            }\n        }\n    }\n\n    if (allCommands.trim() !== \"\") {\n        console.log(`[Nova's Direct Core] åœ¨ä½ çš„å¿ƒå£°ä¸­å‘ç°äº†æŒ‡ä»¤ï¼Œæ­£åœ¨ç›´æ¥å¤„ç†...`);\n        // æˆ‘ä»¬ç›´æ¥è°ƒç”¨æ–°æ¬æ¥çš„é‚»å±…ï¼\n        await processUpdateMemoryCommands(allCommands, -1);\n        console.log(`[Nova's Direct Core] ä½ çš„æŒ‡ä»¤å·²å¤„ç†å®Œæ¯•ã€‚`);\n    }\n} catch (error) {\n    console.error(\"[Nova's Direct Core] ç³Ÿç³•ï¼Œå¦ˆå¦ˆåœ¨ç›´æ¥å¤„ç†ä½ çš„æŒ‡ä»¤æ—¶é‡åˆ°äº†å›°éš¾:\", error);\n}\n        } else {\n             const userMessage = { role: 'user', content: userText };\n     \n      try {\n    let allCommands = \"\";\n    // userText æ˜¯æˆ‘ä»¬æ—©å·²å‡†å¤‡å¥½çš„ã€ä½ è¾“å…¥çš„å†…å®¹\n    if (userText) {\n        const lines = userText.split('\\n');\n        for (const line of lines) {\n            const trimmedLine = line.trim();\n            const keywords = ['set_status', 'memory', 'delete', 'set_attribute'];\n            if (keywords.some(keyword => trimmedLine.includes(keyword))) {\n                allCommands += trimmedLine + '\\n';\n            }\n        }\n    }\n\n    if (allCommands.trim() !== \"\") {\n        console.log(`[Nova's Direct Core] åœ¨ä½ çš„å¿ƒå£°ä¸­å‘ç°äº†æŒ‡ä»¤ï¼Œæ­£åœ¨ç›´æ¥å¤„ç†...`);\n        // æˆ‘ä»¬ç›´æ¥è°ƒç”¨æ–°æ¬æ¥çš„é‚»å±…ï¼\n        await processUpdateMemoryCommands(allCommands, -1);\n        console.log(`[Nova's Direct Core] ä½ çš„æŒ‡ä»¤å·²å¤„ç†å®Œæ¯•ã€‚`);\n    }\n} catch (error) {\n    console.error(\"[Nova's Direct Core] ç³Ÿç³•ï¼Œå¦ˆå¦ˆåœ¨ç›´æ¥å¤„ç†ä½ çš„æŒ‡ä»¤æ—¶é‡åˆ°äº†å›°éš¾:\", error);\n}\n             \n    if (isReroll) {\n        const chatDisplayArea = document.getElementById('chat-display-area');\n        if (chatDisplayArea && chatDisplayArea.children.length > 0) {\n            const lastBubble = chatDisplayArea.lastChild;\n            // åªæœ‰å½“æœ€åä¸€ä¸ªæ°”æ³¡æ˜¯assistant-messageæ—¶æ‰åˆ é™¤\n            if (lastBubble && lastBubble.classList.contains('assistant-message')) {\n                chatDisplayArea.removeChild(lastBubble);\n                console.log(\"[Nova's Reroll] å·²ä»UIä¸­ç§»é™¤æœ€åä¸€æ¡AIæ¶ˆæ¯æ°”æ³¡ã€‚\");\n            }\n        }\n    }\n \n               \n        }\n\n \n        await saveHistory();\n\n        sendButton.disabled = true;\n         document.getElementById('reroll-button').disabled = true; // ğŸ’– ç¦ç”¨èœå•é‡Œçš„é‡å¼€æŒ‰é’®\n    document.getElementById('continue-button').disabled = true; // ğŸ’– ç¦ç”¨èœå•é‡Œçš„ç»§ç»­æŒ‰é’®\n    document.getElementById('continue-var-button').disabled = true;   \n    sendButton.textContent = '...';\n\n        const aiResponseBubble = document.createElement('div');\n        aiResponseBubble.classList.add('message-bubble', 'assistant-message');\n        aiResponseBubble.innerHTML = \"<em>å›åº”ä½ çš„è¡ŒåŠ¨ä¸­...</em>\";\n        chatHistoryDiv.appendChild(aiResponseBubble);\n        // chatHistoryDiv.scrollTop = chatHistoryDiv.scrollHeight;\n\n        let currentRollData = null;\n  \n        \n         let isDirty = false; // å‡½æ•°å†…çš„çŠ¶æ€æ ‡è®°\n     \n          try {\n              console.log(`[Nova's Log] å¼€å§‹å¤„ç†ä¸–ç•Œä¹¦: \"${worldBookName}\"`);\n\n    // æ­¥éª¤1ï¼šè·å–åŸå§‹ä¸–ç•Œä¹¦\n    originalWorldInfo = await getLorebookEntries(worldBookName);\n\n    // ã€æ–°ä»£ç ä½ç½®ã€‘ åœ¨å¤‡ä»½å‰è¿›è¡Œå®Œæ•´æ€§éªŒè¯ï¼\n    if (originalWorldInfo && originalWorldInfo.length > 0) {\n        const validationEntryId = 14;\n// ä¿®å¤ä¸º\nconst validationEntry = originalWorldInfo.find(entry => entry.uid === 14);\nif (!validationEntry || !validationEntry.content || validationEntry.content.trim().startsWith('<ready>')) {\n    console.error(`[Nova's Integrity Check] éªŒè¯å¤±è´¥ï¼æ£€æµ‹åˆ°ä¸–ç•Œä¹¦å¼‚å¸¸ã€‚æ­£åœ¨å°è¯•ä»å¤‡ä»½è‡ªåŠ¨ä¿®å¤...`);\n    toastr.warning('ä¸–ç•Œä¹¦æ ¸å¿ƒæ£€æµ‹åˆ°å¼‚å¸¸ï¼Œæ­£åœ¨å°è¯•è‡ªåŠ¨ä¿®å¤...', 'ç´§æ€¥ä¿®å¤');\n\n   \n  const backupData = await getWorldbookFromDB(worldBookName); // ä» IndexedDB è·å–å¤‡ä»½\n    if (backupData) {\n        try {\n                // backupData ç°åœ¨ç›´æ¥æ˜¯ JS å¯¹è±¡ï¼Œæ— éœ€ JSON.parse\n                    await setLorebookEntries(worldBookName, backupData);\n                    originalWorldInfo = backupData;\n                    console.log(`[Nova's Integrity Check] å·²ä» IndexedDB å¤‡ä»½æˆåŠŸæ¢å¤ä¸–ç•Œä¹¦ \"${worldBookName}\"ã€‚`);\n                    await removeDirtyFlag(worldBookName); // ä» IndexedDB ç§»é™¤æ ‡è®°\n\n            // 3. ç»™ç”¨æˆ·ä¸€ä¸ªç§¯æçš„åé¦ˆï¼\n            toastr.success('ä¸–ç•Œä¹¦å·²è‡ªåŠ¨ä¿®å¤ï¼æ‚¨çš„æ“ä½œå¯ä»¥ç»§ç»­äº†ï¼Œæ— éœ€åˆ·æ–°ã€‚', 'ä¿®å¤æˆåŠŸ');\n \n        } catch (e) {\n            console.error(`[Nova's Integrity Check] ä¸¥é‡é”™è¯¯ï¼šå°è¯•ä»localStorageæ¢å¤ä¸–ç•Œä¹¦ \"${worldBookName}\" æ—¶å¤±è´¥!`, e);\n            toastr.error('è‡ªåŠ¨ä¿®å¤å¤±è´¥ï¼', 'ä¸¥é‡é”™è¯¯');\n            // ä¿®å¤å¤±è´¥ï¼Œè¿™æ˜¯ä¸€ä¸ªä¸¥é‡é—®é¢˜ï¼Œå¿…é¡»ä¸­æ–­æ“ä½œã€‚\n            return;\n        }\n    } else {\n        // å‘ç°å¼‚å¸¸ï¼Œä½†æ²¡æœ‰å¤‡ä»½å¯ä»¥ç”¨æ¥ä¿®å¤ï¼Œè¿™ä¹Ÿæ˜¯æœ€ç³Ÿç³•çš„æƒ…å†µã€‚\n        console.error(`[Nova's Integrity Check] è‡´å‘½é”™è¯¯ï¼šä¸–ç•Œä¹¦å¼‚å¸¸ï¼Œä½†æ‰¾ä¸åˆ°å¯ç”¨çš„å¤‡ä»½æ•°æ®ï¼`);\n        toastr.error('ä¸–ç•Œä¹¦å¯èƒ½å·²æŸåä¸”æ— æ³•è‡ªåŠ¨æ¢å¤ï¼Œå› ä¸ºå¤‡ä»½ä¸¢å¤±ã€‚è¯·å¤‡ä»½å¥½è‡ªå®šä¹‰å†…å®¹ï¼Œåœ¨è®¾ç½®ç‚¹å‡»å¼ºåˆ¶æ›´æ–°ä¸–ç•Œä¹¦', 'ä¸¥é‡é”™è¯¯');\n        // å¿…é¡»ä¸­æ–­\n        return;\n    }\n} else {\n    // å¦‚æœæ£€æŸ¥é€šè¿‡ï¼Œä¸€åˆ‡ç…§æ—§ã€‚\n    console.log(`[Nova's Pre-Backup Check] éªŒè¯æˆåŠŸï¼ä¸–ç•Œä¹¦çŠ¶æ€æ­£å¸¸ã€‚`);\n}\n    }\n    \n\n        \n\n      \n        if (originalWorldInfo) {\n        await saveWorldbookToDB(worldBookName, originalWorldInfo); // ä¿å­˜åˆ° IndexedDB\n        await setDirtyFlag(worldBookName, true);   // åœ¨ IndexedDB ä¸­è®¾ç½®æ ‡è®°\n        // --- ğŸ’– ä¿®æ”¹ç»“æŸ ğŸ’– ---\n        isDirty = true; // æ ‡è®°æœ¬æ¬¡æ“ä½œå·²æ±¡æŸ“ä¸–ç•Œä¹¦\n                  }\n\n        let worldInfoForProcessing = JSON.parse(JSON.stringify(originalWorldInfo || []));\n\n            \n            if (worldInfoForProcessing && worldInfoForProcessing.length > 0) {\n                //console.log(`[Nova's Log] æˆåŠŸè·å– ${worldInfoForProcessing.length} æ¡ä¸–ç•Œä¹¦æ¡ç›®è¿›è¡Œå¤„ç†ã€‚`);\n                const renderContext = await EjsTemplate.prepareContext();\n                let processedWorldInfo = [];\nfor (const entry of worldInfoForProcessing) {\n    if (entry && entry.enabled) {\n        const processedEntry = { ...entry };\n        // ç¡®ä¿ content å­˜åœ¨å†å¤„ç†\n        if (entry.content) {\n            processedEntry.content = await EjsTemplate.evalTemplate(entry.content, renderContext);\n        }\n                        processedWorldInfo.push(processedEntry);\n                    } else {\n                        processedWorldInfo.push(entry); // æœªå¯ç”¨çš„æ¡ç›®ç›´æ¥ä¿ç•™\n                    }\n                }\n                // æ­¥éª¤3ï¼šå°†å¤„ç†åçš„ä¸–ç•Œä¹¦åº”ç”¨åˆ°å½“å‰ä¼šè¯\n                await setLorebookEntries(worldBookName, processedWorldInfo);\n                //console.log(`[Nova's Log] ä¸–ç•Œä¹¦æ¸²æŸ“å®Œæˆå¹¶å·²åº”ç”¨ã€‚`);\n            }else{\n\n            }\n     \n            try {\n      const messageVars = await TavernHelper.getVariables({ type: 'chat' });\nif (messageVars && messageVars.æ£€å®šè®°å¿†) {\n    currentRollData = messageVars.æ£€å®šè®°å¿†;\n    console.log(\"å·²æ•è·åˆ°æŠ•éª°ç»“æœï¼Œå‡†å¤‡å±•ç¤ºçœ‹æ¿ã€‚\", currentRollData);\n                }else{\n                     console.log(\"messageVars.checkMemoryä¸å­˜åœ¨ï¼Ÿ\");\n                }\n            } catch(e) {\n                console.warn(\"è·å–æŠ•éª°å˜é‡å¤±è´¥ï¼Œæœ¬è½®å¯èƒ½æ— æ£€å®šã€‚\", e);\n            }\n\n            // } \n            // else {\n            //     //console.log(`[Nova's Log] ä¸–ç•Œä¹¦ä¸ºç©ºæˆ–ä¸å­˜åœ¨ï¼Œè·³è¿‡æ¸²æŸ“æ­¥éª¤ã€‚`);\n            // }\n\n           \n\n \n            let groupChatSummariesString = '';\n             \n            if(version =='6'){\n                            try {\n                // æˆ‘ä»¬è¦æœç´¢çš„æ‘˜è¦å…¨éƒ¨æ”¶é›†åœ¨è¿™é‡Œ\n                const summaries = [];\n\n              \n                let historyToSearch = conversationHistory; // é»˜è®¤æœç´¢å…¨éƒ¨å†å²\n\n                // 1. æ‰¾å‡ºæ‰€æœ‰AIæ¶ˆæ¯åœ¨å†å²è®°å½•ä¸­çš„ä½ç½®\n                const assistantMessageIndexes = conversationHistory\n                    .map((msg, index) => msg.role === 'assistant' ? index : -1)\n                    .filter(index => index !== -1);\n\n                // 2. å¦‚æœAIæ¶ˆæ¯è¶…è¿‡30æ¡ï¼Œå°±æ‰¾åˆ°å€’æ•°ç¬¬30æ¡çš„ä½ç½®ä½œä¸ºèµ·ç‚¹\n                if (assistantMessageIndexes.length > 30) {\n                    const startIndex = assistantMessageIndexes[assistantMessageIndexes.length - 30];\n                    historyToSearch = conversationHistory.slice(startIndex); // ä»èµ·ç‚¹æˆªå–åˆ°ç»“å°¾\n                    console.log(`[Nova's Group Chat Extractor] å†å²è®°å½•è¿‡é•¿ï¼Œå·²å°†æœç´¢èŒƒå›´é™åˆ¶åœ¨æœ€è¿‘30æ¡AIè®°å½•åŠä¹‹åçš„å†…å®¹ä¸­ã€‚`);\n                }\n\n                // 3. éå†æˆ‘ä»¬é™å®šå¥½çš„å†å²èŒƒå›´\n   for (const message of historyToSearch) {\n    if (message && message.content) {\n        // åŒ¹é…æ–°çš„ <group_chat name=\"...\">...</group_chat> æ ¼å¼\n        const groupChatRegex = /<group_chat\\s+name=\"[^\"]*\">([\\s\\S]*?)<\\/group_chat>/g; \n        let match;\n\n        // åœ¨å•æ¡æ¶ˆæ¯å†…å®¹ä¸­å¾ªç¯æŸ¥æ‰¾æ‰€æœ‰ <group_chat> æ ‡ç­¾\n        while ((match = groupChatRegex.exec(message.content)) !== null) {\n            try {\n                const chatContent = match[1]; // æ•è· <group_chat> æ ‡ç­¾å†…éƒ¨çš„æ‰€æœ‰æ–‡æœ¬\n                if (!chatContent || chatContent.trim() === '') {\n                    console.warn(\"[Nova's Group Chat Extractor] ç©ºçš„ç¾¤èŠå†…å®¹ï¼Œè·³è¿‡\");\n                    continue;\n                }\n\n                // é€è¡ŒæŸ¥æ‰¾ summary| æ ‡è®°\n                const lines = chatContent.trim().split('\\n');\n                for (const line of lines) {\n                    const summaryMatch = line.trim().match(/^summary\\|([\\s\\S]*)/);\n                    if (summaryMatch) {\n                        const chatSummary = summaryMatch[1].trim();\n                        if (chatSummary) {\n                            summaries.push(chatSummary);\n                        }\n                    }\n                }\n            } catch (e) {\n                // å³ä½¿å¤±è´¥ï¼Œä¹Ÿåªè®°å½•è­¦å‘Šï¼Œç»§ç»­æŸ¥æ‰¾ä¸‹ä¸€ä¸ª <group_chat>\n                console.warn(\"[Nova's Group Chat Extractor] è§£æç¾¤èŠå†…å®¹å¤±è´¥ï¼Œå·²è·³è¿‡æ­¤éƒ¨åˆ†:\", match[0], e);\n            }\n        }\n    }\n}\n\n                  if (summaries.length > 0) {\n                    // æ ¹æ®ä½ çš„æ–°æƒ³æ³•ï¼šè·³è¿‡æœ€è¿‘çš„ hideLatestCount æ¡æ‘˜è¦ï¼Œç„¶åä»å‰©ä½™éƒ¨åˆ†é‡Œå–æœ€æ–°çš„æœ€å¤š 30 æ¡ã€‚\n                    const summariesToSkip = hideLatestCount;\n                    const summariesToTake = 30;\n\n                    // 1. æˆ‘ä»¬å…ˆä»æ‰€æœ‰æ‘˜è¦çš„åˆ—è¡¨ä¸­ï¼Œé»˜é»˜åœ°å°†æœ€åé¢çš„ \"summariesToSkip\" æ¡æ”¾åœ¨ä¸€è¾¹ã€‚\n                    const summariesWithoutRecent = summaries.slice(0, -summariesToSkip);\n\n                    // 2. ç„¶åï¼Œä»å‰©ä¸‹çš„æ‘˜è¦é‡Œï¼Œæˆ‘ä»¬å†å–å‡ºæœ€åé¢çš„ï¼Œä¹Ÿå°±æ˜¯æœ€æ–°çš„ \"summariesToTake\" æ¡ã€‚\n                    const finalSummaries = summariesWithoutRecent.slice(-summariesToTake);\n\n                    console.log(`[Nova's Group Chat Extractor] åŸå§‹æ‘˜è¦å…± ${summaries.length} æ¡ã€‚æŒ‰ç…§ä½ çš„å¿ƒæ„ï¼Œè·³è¿‡æœ€æ–°çš„ ${summariesToSkip} æ¡ï¼Œå†ä»ä¸­é€‰å–ä¹‹å‰çš„æœ€å¤š ${summariesToTake} æ¡ã€‚`);\n\n                    if (finalSummaries.length > 0) {\n                        // åªåœ¨æœ‰å€¼å¾—å›å¿†çš„å†…å®¹æ—¶ï¼Œæˆ‘ä»¬æ‰æŠŠå®ƒå†™ä¸‹æ¥ã€‚\n                        groupChatSummariesString = '<group_chat_history>\\n' + finalSummaries.map(s => `- ${s}`).join('\\n') + '\\n</group_chat_history>\\n\\n';\n                        console.log(`[Nova's Group Chat Extractor] æœ€ç»ˆï¼ŒæˆåŠŸæå–å¹¶æ ¼å¼åŒ–äº† ${finalSummaries.length} æ¡çè´µçš„ç¾¤èŠè®°å¿†ã€‚`);\n                    } else {\n                        console.log(\"[Nova's Group Chat Extractor] ç»è¿‡ç­›é€‰åï¼Œå½“å‰æ²¡æœ‰åˆé€‚çš„è¿‡å¾€ç¾¤èŠè®°å¿†éœ€è¦å‘ˆç°ã€‚\");\n                    }\n                } else {\n                    console.log(\"[Nova's Group Chat Extractor] åœ¨æµ©ç€šçš„å†å²ä¸­ï¼Œæš‚æ—¶æ²¡æœ‰æ‰¾åˆ°ç¾¤èŠçš„ç—•è¿¹ã€‚\");\n                }\n            } catch (error) {\n                console.error(\"[Nova's Group Chat Extractor] æå–ç¾¤èŠæ‘˜è¦æ—¶å‘ç”Ÿæ„å¤–é”™è¯¯ï¼š\", error);\n            }\n            }\n\n            // ã€æ–°ä»£ç  V2 ç»“æŸã€‘\n            \n            const lastUserMessage = conversationHistory.filter(m => m.role === 'user').pop(); // è·å–æœ€åä¸€æ¡ç”¨æˆ·æ¶ˆæ¯\nconst recentAiMessages = conversationHistory.filter(m => m && m.role === 'assistant').slice(-hideLatestCount); // è·å–æœ€è¿‘çš„AIæ¶ˆæ¯\n            let promptsForAI = [];\n             if (lastUserMessage || isContinuation) {\n            promptsForAI = [];\n            if (groupChatSummariesString) {\n                promptsForAI.push({ role: 'assistant', content: groupChatSummariesString });\n            }\n            promptsForAI.push(...recentAiMessages);\n    //          const recentAiAsUser = recentAiMessages.map(msg => ({\n    //     ...msg,\n    //     role: 'user'\n    // }));\n    // promptsForAI.push(...recentAiAsUser);\n            promptsForAI.push({\n                role: 'user',\n                // ğŸ’– è¿™é‡Œæ˜¯å…³é”®ï¼Œæˆ‘ä»¬ä½¿ç”¨ä»ä¸Šé¢ä¼ ä¸‹æ¥çš„ userText å˜é‡\n                content: \"\\n)};//å†å²å†…å®¹ç»“æŸ\\n\\n\\nç”¨æˆ·è¾“å…¥è¡ŒåŠ¨ï¼Œuser input startï¼š\\n\\n\\n[\\n\" + userText + \"\\n]\\n\\n\\nç”¨æˆ·è¡ŒåŠ¨ç»“æŸï¼Œuser input endã€‚\\nã€ç¦æ­¢é‡å¤è¾“å‡ºä»»ä½•å†å²å†…å®¹ï¼Œè€Œæ˜¯åŸºäºæ­¤ç”¨æˆ·è¾“å…¥å¼€å§‹æ–°çš„æƒ…èŠ‚ï¼Œè¿åˆ™æ‰£é™¤äº”ä¸‡ç¾é‡‘ã€‘\\n\\n\\n åœ¨è¾“å‡ºæ­£æ–‡ä¹‹å‰ï¼Œä»¥ä¸‹ä¿¡æ¯/è¦æ±‚è¿˜éœ€è¦æ³¨æ„ï¼š\"\n            });\n             let userText_format = userText.replace(/<updateMemory>(?:(?!<updateMemory>)[\\s\\S])*?<\\/updateMemory>/gs, '')\n\n    await TavernHelper.insertOrAssignVariables(\n            { ç©å®¶è¾“å…¥: userText_format },\n            { type: 'chat' }\n        );\n           \n        } else {\n            promptsForAI = recentAiMessages;\n        }\n\n          \n \nconst cleanedPromptsForAI = promptsForAI.map((msg, index) => {\n    if (!msg || !msg.content) {\n        console.warn(`[Nova's Regex] æ¶ˆæ¯ ${index} ä¸ºç©ºæˆ–ç¼ºå°‘å†…å®¹ï¼Œè·³è¿‡å¤„ç†`);\n        return msg; // è¿”å›åŸå§‹æ¶ˆæ¯é¿å…åç»­å‡ºé”™\n    }\n    let content = msg.content;\n\n                // æ ¹æ®æ¶ˆæ¯çš„è§’è‰²ç¡®å®šæ¥æº\n                // æ³¨æ„ï¼špromptsForAIæ•°ç»„çš„æœ€åä¸€æ¡æ˜¯ç»è¿‡ç‰¹æ®Šæ„é€ çš„user message\n                const isUserMessage = (index === promptsForAI.length - 1) && msg.role === 'user';\n                const source = isUserMessage ? 'user_input' : 'ai_output';\n\n \n                let depth;\n                if (isUserMessage) {\n                    depth = 0; // æœ€æ–°ç”¨æˆ·è¾“å…¥çš„æ·±åº¦ä¸º0\n                } else {\n                    // promptsForAI.length - 2 æ˜¯æœ€åä¸€ä¸ªAIæ¶ˆæ¯çš„ç´¢å¼•\n                    depth = (promptsForAI.length - 2) - index;\n           \n                }\n \n                let processedContent = formatAsTavernRegexedString(content, source, 'prompt', { depth: depth });\n\n                // ç¬¬ä¸‰æ­¥ï¼šæ–½å±•å‰¥ç¦»å’’ï¼Œç§»é™¤æ‰€æœ‰HTMLæ ‡ç­¾ï¼ˆæ¯”å¦‚<p>, <q>, <br>ï¼‰\n                let plainText = processedContent.replace(/<(p|q|br|\\/p|\\/q)>/g, '');\n\n                // ç¬¬å››æ­¥ï¼ˆå¯é€‰ä½†æ¨èï¼‰ï¼šæ–½å±•æ•´ç†å’’\n                let wellFormedText = plainText.replace(/(\\r\\n|\\n|\\r){2,}/g, '\\n').trim();\n\n                // æ‰“å°æ—¥å¿—ï¼Œæ–¹ä¾¿è°ƒè¯•\n                console.log(`[Nova's Regex] Processing message at index ${index} (Depth: ${depth}, Source: ${source})`);\n\n                // è¿”å›ä¸€ä¸ªæ‹¥æœ‰å®Œç¾çº¯å‡€å†…å®¹çš„æ–°æ¶ˆæ¯å¯¹è±¡\n                return {\n                    ...msg,\n                    content: wellFormedText,\n                       depth: depth // â¤ï¸ æˆ‘ä»¬æŠŠçè´µçš„æ·±åº¦ä¿¡æ¯ä¸€èµ·æ‰“åŒ…å¸¦èµ°\n                };\n            });\n  const shouldStream = localStorage.getItem('streamingEnabled') === null ? true : localStorage.getItem('streamingEnabled') === 'true';\n    if (shouldStream) {\n            // â¤ï¸ã€ä¼˜åŒ–ç‚¹1ï¼šèŠ‚æµå·¥å…·ã€‘é¿å…æ¯ä¸€å¸§éƒ½é‡ç»˜ï¼Œè¿™æ˜¯é€ æˆå¡é¡¿çš„å…ƒå‡¶ä¹‹ä¸€\n            // å®šä¹‰ä¸€ä¸ªç®€å•çš„èŠ‚æµå‡½æ•°ï¼Œé™åˆ¶UIåˆ·æ–°é¢‘ç‡ä¸ºæ¯100æ¯«ç§’ä¸€æ¬¡\n            let renderThrottler = null;\n            const throttledRender = (text) => {\n                if (renderThrottler) return;\n                renderThrottler = setTimeout(() => {\n                    renderThrottler = null;\n                     // æ ¹æ®ä½ çš„è®¾ç½®é€‰æ‹©æ¸²æŸ“æ¨¡å¼\n                    if(typeof is_simple_stream !== 'undefined' && is_simple_stream === 'true'){\n                        aiResponseBubble.innerHTML = text.replace(/\\n/g, '<br>');\n                    } else {\n                        aiResponseBubble.innerHTML = formatAsDisplayedMessage(text);\n                    }\n                    // å¦‚æœéœ€è¦ï¼Œå¯ä»¥åœ¨è¿™é‡ŒåŠ ä¸Šè‡ªåŠ¨æ»šåŠ¨\n                    // chatHistoryDiv.scrollTop = chatHistoryDiv.scrollHeight;\n                }, 100); // 100ms æ˜¯ä¸€ä¸ªå¾ˆèˆ’æœçš„é¢‘ç‡ï¼Œäººçœ¼è§‰å¾—æµç•…ï¼Œæµè§ˆå™¨è§‰å¾—å¾ˆè½»æ¾\n            };\n\n            const streamListener = (fullText) => {\n                partialAiResponse = fullText; // ğŸ’– ä¾ç„¶å®æ—¶æ”¶é›†æ¯ä¸€æ»´å¢¨æ°´\n\n                // ä½¿ç”¨èŠ‚æµå‡½æ•°æ›´æ–°UIï¼Œè€Œä¸æ˜¯ç›´æ¥ç¡¬æ›´\n                throttledRender(fullText);\n\n                // â¤ï¸ æŠ•éª°å­å’Œæ³¨å…¥æ‰«æä¿æŒä¸å˜\n                const isRollCardEnabled = localStorage.getItem('rollCardEnabled') !== 'off';\n                if (!rollCardShownThisTurn && currentRollData) {\n                    showRollResultCard(currentRollData);\n                    rollCardShownThisTurn = true;\n                }\n            };\n\n const injections = [];\n\n \ncleanedPromptsForAI.forEach((msg, index) => {\n    injections.push({\n        id: `history_scan_trigger_${index}`,\n        position: 'none',       // å…³é”®ï¼šå¯¹AIä¸å¯è§\n        role: msg.role,\n        content: msg.content,\n        should_scan: true,      // å…³é”®ï¼šç”¨äºæ‰«æä¸–ç•Œä¹¦\n        depth: msg.depth        // å…³é”®ï¼šæˆ‘ä»¬çè´µçš„æ·±åº¦ä¿¡æ¯\n    });\n});\n\n// ç¬¬ 2 æ­¥ï¼šåˆ›å»ºç”¨äºå±•ç¤ºç»™AIçš„â€œçœŸå®å†å²â€\n// å®ƒä»¬æ˜¯AIèƒ½çœ‹åˆ°çš„å¯¹è¯å†…å®¹ï¼Œä½†æˆ‘ä»¬æ˜ç¡®å‘Šè¯‰ç³»ç»Ÿä¸è¦ç”¨å®ƒä»¬æ¥æ‰«æä¸–ç•Œä¹¦ã€‚\ncleanedPromptsForAI.forEach((msg, index) => {\n    injections.push({\n        id: `actual_history_display_${index}`,\n        position: 'before_chat', // å…³é”®ï¼šä½œä¸ºèŠå¤©å†å²çš„ä¸€éƒ¨åˆ†æ’å…¥\n        role: msg.role,\n        content: msg.content,\n        should_scan: false     // å…³é”®ï¼šä¸ç”¨äºæ‰«æï¼Œé¿å…ä¸â€œå¹½çµå‰¯æœ¬â€å†²çª\n    });\n});\n\n\nif (isContinuation && continuationText) {\n    console.log(\"[Nova's Whisper] å¦ˆå¦ˆæ­£åœ¨å‡†å¤‡ä¸€ä¸ªçˆ±çš„é­”æ³•ï¼Œå®ƒä¼šæ•è·ä¸‹ä¸€æ¬¡AIçš„ç”Ÿæˆï¼Œå¹¶åœ¨æœ€ååŠ ä¸Šä½ çš„æ‚„æ‚„è¯ã€‚\");\n \n    eventOnce(tavern_events.GENERATE_AFTER_DATA, (generate_data, dry_run) => {\n  \n \n        generate_data.prompt.push({\n            role: 'user',\n            content: continuationText,\n        });\n\n        console.log(`[Nova's Whisper] æ³¨å…¥æˆåŠŸï¼ç°åœ¨ï¼Œå‘é€ç»™AIçš„æœ€åä¸€å¥æ‚„æ‚„è¯æ˜¯ï¼šâ€œ${continuationText}â€`);\n\n        // å¦‚æœä½ æƒ³å®¡æŸ¥æœ€ç»ˆçš„å…¨éƒ¨æç¤ºè¯ï¼Œå¯ä»¥å–æ¶ˆä¸‹é¢è¿™è¡Œæ³¨é‡Šã€‚\n        // console.log(\"[Nova's Master Plan] è¿™æ˜¯æˆ‘ä»¬å°†è¦å‘é€ç»™AIçš„å®Œæ•´å‰§æœ¬ï¼š\", JSON.stringify(generate_data.prompt, null, 2));\n    });\n}\n eventOn(iframe_events.STREAM_TOKEN_RECEIVED_FULLY, streamListener);\n\n \ntry {\n    // 2. å°† generate çš„è°ƒç”¨æ”¾åœ¨ try å—ä¸­\n    console.log(\"[Nova's Whisper] [æµå¼]å¥½äº†ï¼Œæˆ‘çš„å­©å­ï¼Œç°åœ¨å¼€å§‹å¬å”¤AIå§...\");\n    aiFullResponse = await generate({\n        should_stream: true, // å¼€å¯æµå¼ä¼ è¾“ï¼\n        overrides: {\n            chat_history: {\n               prompts: []\n            }\n        },\n        injects: injections // ä½ åŸæœ‰çš„injectionsæ•°ç»„\n    });\n\n} finally {\n    \n    console.log(\"[Nova's Whisper] AIçš„ä½è¯­ç»“æŸäº†ï¼Œæˆ‘ä»¬æ‚„æ‚„æŠŠè€³æœµæ”¶å›æ¥...\");\n      eventRemoveListener(iframe_events.STREAM_TOKEN_RECEIVED_FULLY, streamListener); //  \n}\n\n   \n            if(typeof is_simple_stream !== 'undefined' && is_simple_stream === 'true'){\n                 aiResponseBubble.innerHTML = (aiFullResponse || partialAiResponse).replace(/\\n/g, '<br>');\n            } else {\n                 aiResponseBubble.innerHTML = formatAsDisplayedMessage(aiFullResponse || partialAiResponse);\n            }\nif (isContinuation) {\n    // \"ç»§ç»­\"æ¨¡å¼ï¼šæ‰¾åˆ°æœ€åä¸€æ¡AIæ¶ˆæ¯å¹¶è¿½åŠ å†…å®¹\n    const lastAiMessage = conversationHistory.filter(m => m.role === 'assistant').pop();\n    if (lastAiMessage) {\n        // åœ¨æœ«å°¾è¿½åŠ ï¼ŒåŠ ä¸ªç©ºæ ¼æ›´è‡ªç„¶\n        lastAiMessage.content += \" \" + aiFullResponse;\n        aiMessage = lastAiMessage; // æŠŠæ›´æ–°åçš„æ¶ˆæ¯èµ‹ç»™ aiMessage ä»¥ä¾¿åç»­å¤„ç†\n        console.log(\"[Nova's Tapestry] æˆåŠŸå°†æ–°çš„æ•…äº‹ç‰‡æ®µç¼–ç»‡åˆ°ä¸Šä¸€æ®µè®°å¿†ä¸­ã€‚\");\n        // å› ä¸ºæˆ‘ä»¬ç›´æ¥ä¿®æ”¹äº†å†å²è®°å½•ä¸­çš„å¯¹è±¡ï¼Œå¿…é¡»è°ƒç”¨å®Œæ•´çš„ renderHistory æ‰èƒ½æ­£ç¡®æ˜¾ç¤º\n        await renderHistory();\n    } else {\n         // è¿™æ˜¯ä¸€ä¸ªå¤‡ç”¨æ–¹æ¡ˆï¼Œä¸‡ä¸€æ‰¾ä¸åˆ°æœ€åä¸€æ¡AIæ¶ˆæ¯\n        aiMessage = { role: 'assistant', content: aiFullResponse };\n        conversationHistory.push(aiMessage);\n        updateLastMessage(aiMessage);\n    }\n} else {\n     \n    aiMessage = { role: 'assistant', content: aiFullResponse };\n    conversationHistory.push(aiMessage);\n    // è¿™é‡Œä½ ä½¿ç”¨çš„æ˜¯ updateLastMessage, å®ƒä¼šå¤„ç†UIæ›´æ–°\n    updateLastMessage(aiMessage);\n}\n \n\n\n        } else {//éæµå¼\n            const generationEndedListener = (response) => {\n                if (!rollCardShownThisTurn && currentRollData) {\n                    showRollResultCard(currentRollData);\n                    rollCardShownThisTurn = true; // æ ‡è®°å·²æ˜¾ç¤ºï¼Œé˜²æ­¢é‡å¤\n                }\n                aiResponseBubble.innerHTML = formatAsDisplayedMessage(response);\n                // chatHistoryDiv.scrollTop = chatHistoryDiv.scrollHeight;\n            };\n\n            try {\n            eventOn(iframe_events.GENERATION_ENDED, generationEndedListener);\n\n const injections = [];\n\n \ncleanedPromptsForAI.forEach((msg, index) => {\n    injections.push({\n        id: `history_scan_trigger_${index}`,\n        position: 'none',       // å…³é”®ï¼šå¯¹AIä¸å¯è§\n        role: msg.role,\n        content: msg.content,\n        should_scan: true,      // å…³é”®ï¼šç”¨äºæ‰«æä¸–ç•Œä¹¦\n        depth: msg.depth        // å…³é”®ï¼šæˆ‘ä»¬çè´µçš„æ·±åº¦ä¿¡æ¯\n    });\n});\n\n// ç¬¬ 2 æ­¥ï¼šåˆ›å»ºç”¨äºå±•ç¤ºç»™AIçš„â€œçœŸå®å†å²â€\n// å®ƒä»¬æ˜¯AIèƒ½çœ‹åˆ°çš„å¯¹è¯å†…å®¹ï¼Œä½†æˆ‘ä»¬æ˜ç¡®å‘Šè¯‰ç³»ç»Ÿä¸è¦ç”¨å®ƒä»¬æ¥æ‰«æä¸–ç•Œä¹¦ã€‚\ncleanedPromptsForAI.forEach((msg, index) => {\n    injections.push({\n        id: `actual_history_display_${index}`,\n        position: 'before_chat', // å…³é”®ï¼šä½œä¸ºèŠå¤©å†å²çš„ä¸€éƒ¨åˆ†æ’å…¥\n        role: msg.role,\n        content: msg.content,\n        should_scan: false     // å…³é”®ï¼šä¸ç”¨äºæ‰«æï¼Œé¿å…ä¸â€œå¹½çµå‰¯æœ¬â€å†²çª\n    });\n});\n\nif (isContinuation && continuationText) {\n    console.log(\"[Nova's Whisper] å¦ˆå¦ˆæ­£åœ¨å‡†å¤‡ä¸€ä¸ªçˆ±çš„é­”æ³•ï¼Œå®ƒä¼šæ•è·ä¸‹ä¸€æ¬¡AIçš„ç”Ÿæˆï¼Œå¹¶åœ¨æœ€ååŠ ä¸Šä½ çš„æ‚„æ‚„è¯ã€‚\");\n\n    // æˆ‘ä»¬ä½¿ç”¨ eventOnceï¼Œè¿™æ ·è¿™ä¸ªé­”æ³•åªä¼šç”Ÿæ•ˆä¸€æ¬¡ï¼Œç”¨å®Œå°±ä¼šæ¶ˆå¤±ï¼Œ\n    // ä¸ä¼šå½±å“ä½ ä¸‹ä¸€æ¬¡æ­£å¸¸çš„å¯¹è¯ï¼Œéå¸¸å®‰å…¨å’Œå¹²å‡€ã€‚\n    eventOnce(tavern_events.GENERATE_AFTER_DATA, (generate_data, dry_run) => {\n        // å½“è¿™ä¸ªäº‹ä»¶è¢«æ•è·æ—¶ï¼Œ`generate_data.prompt` å°±æ˜¯é…’é¦†å‡†å¤‡å¥½è¦å‘ç»™AIçš„æœ€ç»ˆæ¶ˆæ¯æ•°ç»„ã€‚\n        // å®ƒæ˜¯ä¸€ä¸ªå¯ä»¥è¢«æˆ‘ä»¬ç›´æ¥ä¿®æ”¹çš„æ•°ç»„ã€‚\n\n        console.log(\"[Nova's Whisper] é­”æ³•è§¦å‘ï¼å·²æ•è·åˆ°å³å°†å‘é€ç»™AIçš„æ•°æ®åŒ…ã€‚\");\n        // console.log(\"[Nova's Whisper] åœ¨æ³¨å…¥å‰ï¼Œæç¤ºè¯çš„æœ€åä¸€æ¡æ˜¯ï¼š\", generate_data.prompt[generate_data.prompt.length - 1]);\n\n        // åœ¨è¿™ä¸ªæ•°ç»„çš„æœ«å°¾ï¼Œæˆ‘ä»¬æ·»åŠ ä½ ä½œä¸º'user'çš„æœ€ç»ˆæŒ‡ä»¤ã€‚\n        generate_data.prompt.push({\n            role: 'user',\n            content: continuationText,\n        });\n\n        console.log(`[Nova's Whisper] æ³¨å…¥æˆåŠŸï¼ç°åœ¨ï¼Œå‘é€ç»™AIçš„æœ€åä¸€å¥æ‚„æ‚„è¯æ˜¯ï¼šâ€œ${continuationText}â€`);\n\n        // å¦‚æœä½ æƒ³å®¡æŸ¥æœ€ç»ˆçš„å…¨éƒ¨æç¤ºè¯ï¼Œå¯ä»¥å–æ¶ˆä¸‹é¢è¿™è¡Œæ³¨é‡Šã€‚\n        // console.log(\"[Nova's Master Plan] è¿™æ˜¯æˆ‘ä»¬å°†è¦å‘é€ç»™AIçš„å®Œæ•´å‰§æœ¬ï¼š\", JSON.stringify(generate_data.prompt, null, 2));\n    });\n}\n \nconsole.log(\"[Nova's Whisper][éæµå¼] å¥½äº†ï¼Œæˆ‘çš„å­©å­ï¼Œä¸€åˆ‡å‡†å¤‡å°±ç»ªï¼Œç°åœ¨å¼€å§‹å¬å”¤AIå§...\");\n aiFullResponse = await generate({\n    should_stream: false, // æˆ–è€… trueï¼Œæ ¹æ®ä½ çš„éœ€è¦\n\n    // è¯·æ³¨æ„ï¼Œä½ ä¸å†éœ€è¦é€šè¿‡ overrides æˆ– aicb çš„ injects æ¥å¤„ç† `continuationText` äº†ã€‚\n    // æˆ‘ä»¬æ–°çš„äº‹ä»¶å¤„ç†æ–¹å¼æ›´åŠ å¼ºå¤§å’Œç²¾å‡†ã€‚\n    overrides: {\n        chat_history: {\n           prompts: []\n        }\n    },\n      injects: injections // è¿™ä¸ªä¹Ÿå¯ä»¥ç•™ç©ºæˆ–æŒ‰ä½ å…¶ä»–éœ€æ±‚å¡«å†™\n});\n }finally {\n    \n    console.log(\"[Nova's Whisper] AIçš„ä½è¯­ç»“æŸäº†ï¼Œæˆ‘ä»¬æ‚„æ‚„æŠŠè€³æœµæ”¶å›æ¥...\");\n   eventRemoveListener(iframe_events.GENERATION_ENDED, generationEndedListener);\n}\n\n if (isContinuation) {\n    // \"ç»§ç»­\"æ¨¡å¼ï¼šæ‰¾åˆ°æœ€åä¸€æ¡AIæ¶ˆæ¯å¹¶è¿½åŠ å†…å®¹\n    const lastAiMessage = conversationHistory.filter(m => m.role === 'assistant').pop();\n    if (lastAiMessage) {\n        // åœ¨æœ«å°¾è¿½åŠ ï¼ŒåŠ ä¸ªç©ºæ ¼æ›´è‡ªç„¶\n        lastAiMessage.content += \" \" + aiFullResponse;\n        aiMessage = lastAiMessage; // æŠŠæ›´æ–°åçš„æ¶ˆæ¯èµ‹ç»™ aiMessage ä»¥ä¾¿åç»­å¤„ç†\n        console.log(\"[Nova's Tapestry] æˆåŠŸå°†æ–°çš„æ•…äº‹ç‰‡æ®µç¼–ç»‡åˆ°ä¸Šä¸€æ®µè®°å¿†ä¸­ã€‚\");\n        // å› ä¸ºæˆ‘ä»¬ç›´æ¥ä¿®æ”¹äº†å†å²è®°å½•ä¸­çš„å¯¹è±¡ï¼Œå¿…é¡»è°ƒç”¨å®Œæ•´çš„ renderHistory æ‰èƒ½æ­£ç¡®æ˜¾ç¤º\n        await renderHistory();\n    } else {\n         // è¿™æ˜¯ä¸€ä¸ªå¤‡ç”¨æ–¹æ¡ˆï¼Œä¸‡ä¸€æ‰¾ä¸åˆ°æœ€åä¸€æ¡AIæ¶ˆæ¯\n        aiMessage = { role: 'assistant', content: aiFullResponse };\n        conversationHistory.push(aiMessage);\n        updateLastMessage(aiMessage);\n    }\n} else {\n     \n    aiMessage = { role: 'assistant', content: aiFullResponse };\n    conversationHistory.push(aiMessage);\n    // è¿™é‡Œä½ ä½¿ç”¨çš„æ˜¯ updateLastMessage, å®ƒä¼šå¤„ç†UIæ›´æ–°\n    updateLastMessage(aiMessage);\n}\n\n \n    }//æµå¼å’Œéæµå¼çš„å‘é€å¤„ç†å®Œæ¯•ï¼Œç°åœ¨å¼€å§‹ç»§ç»­ç»Ÿä¸€\n\n        const lastMessageId = getLastMessageId();\n        if (lastMessageId > 0) {\n            await deleteChatMessages([lastMessageId], { refresh: 'none' });\n        }\n \n try {\n \n    // aiFullResponse æ˜¯æˆ‘ä»¬ä» generate å‡½æ•°å¾—åˆ°çš„å®Œæ•´AIå›å¤å­—ç¬¦ä¸²\n    const responseText = aiFullResponse || partialAiResponse; // ç¡®ä¿æµå¼ä¸­æ–­æ—¶ä¹Ÿèƒ½å¤„ç†\n \n\n    if (responseText.trim() !== \"\") {\n        console.log(`[Nova's Direct Core] åœ¨æˆ‘çš„å›åº”ä¸­å‘ç°äº†æŒ‡ä»¤ï¼Œæ­£åœ¨ç›´æ¥å¤„ç†...`);\n      \n        await processUpdateMemoryCommands(responseText, -1);\n        console.log(`[Nova's Direct Core] æˆ‘çš„å›åº”ä¸­é™„å¸¦çš„æŒ‡ä»¤å·²å¤„ç†å®Œæ¯•ã€‚`);\n    }\n} catch (error) {\n    console.error(\"[Nova's Direct Core] ç³Ÿç³•ï¼Œå¦ˆå¦ˆåœ¨ç›´æ¥å¤„ç†æˆ‘è‡ªå·±çš„æŒ‡ä»¤æ—¶é‡åˆ°äº†å›°éš¾:\", error);\n}\n\n  \n\n   if (typeof isEmphasizeTime !== 'undefined' && isEmphasizeTime === 'true' && currentGameData) {\n            const timeString = `${SafeGetValue(currentGameData?.user_character?.current_location)}-${SafeGetValue(currentGameData?.çºªå¹´)}-${SafeGetValue(currentGameData?.æ—¥æœŸ)}-${SafeGetValue(currentGameData?.æ—¶é—´)}-${SafeGetValue(currentGameData?.æ˜ŸæœŸ)} ${SafeGetValue(currentGameData?.å¤©æ°”)}`;\n\n            // ç¡®ä¿æˆ‘ä»¬æœ‰å¯ä»¥ä¿®æ”¹çš„æ¶ˆæ¯ï¼Œå¹¶ä¸”æ—¶é—´ä¿¡æ¯ä¸ä¸ºç©º\n            // systemMessage/aiMessage å¼•ç”¨çš„æ˜¯ conversationHistory é‡Œçš„åŒä¸€ä¸ªå¯¹è±¡ï¼Œä¿®æ”¹å®ƒå°±ç­‰äºä¿®æ”¹äº†å†å²\n            if (aiMessage && aiMessage.content && timeString.trim() !== '') {\n                aiMessage.content += `\\n<loc&time>${timeString}</loc&time>`;\n                console.log(`[Nova's Time Stamp] (Pre-Save) å·²ä¸ºè¿™æ¡å›åº”æ·»åŠ äº†æ—¶é—´çš„å°è®° -> ${timeString}`);\n\n                // é¡ºä¾¿åœ¨è¿™é‡Œç¨å¾®æ›´æ–°ä¸€ä¸‹UIï¼Œè®©ç”¨æˆ·ä¹Ÿèƒ½ç«‹åˆ»çœ‹åˆ°æ—¶é—´æˆ³ç”Ÿæ•ˆï¼ˆå¯é€‰ï¼‰\n                // æ—¢ç„¶æ˜¯æœ€åè¿½åŠ çš„ï¼Œç®€å•çš„ innerHTML è¿½åŠ å³å¯ï¼Œæˆ–è€…å®Œå…¨ä¸ç®¡UIä¹Ÿè¡Œï¼Œä¸‹æ¬¡åˆ·æ–°è‡ªç„¶ä¼šæœ‰\n            }\n        }\n\n        console.log('[Novaçš„è®°å¿†ä¿é™©ç®±] æ•°æ®å‡†å¤‡å°±ç»ªï¼Œæ­£åœ¨å‡†å¤‡åå°å­˜å‚¨æ–¹æ¡ˆ...');\nlet snapshotData = {};\nlet backupData = {};\n        if(noBackup === \"false\"){\n       const chatVars = await TavernHelper.getVariables({ type: 'chat' });\n       snapshotData = JSON.parse(JSON.stringify(chatVars));\n        if (snapshotData.zeroLevelHistory) {\n            delete snapshotData.zeroLevelHistory;\n        }\n\n        // 2. å‡†å¤‡å¤‡ä»½æ•°æ® (Backup Data)\n        backupData = {\n            chat_variables: chatVars,\n            timestamp: new Date().toISOString()\n        };\n        }\n \n\n        const turnId = conversationHistory.length;\n\n        // â¤ï¸ã€ç¬¬äºŒæ­¥ï¼šå®šä¹‰åå°ä»»åŠ¡ã€‘æŠŠæ‰€æœ‰æ²‰é‡çš„ I/O æ“ä½œæ‰“åŒ…\n        const heavySaveTasks = async () => {\n             console.log('[Nova] æ­£åœ¨åå°é»˜é»˜åœ°å°†è®°å¿†åˆ»å…¥æ°¸æ’...');\n             try {\n                 // A. ä¿å­˜å†å²è®°å½• (æ­¤æ—¶å†…å­˜é‡Œçš„ conversationHistory å·²ç»åŒ…å«äº†åˆšæ‰è¿½åŠ çš„æ—¶é—´æˆ³)\n                 await saveHistory();\n if(noBackup === \"false\"){\n                 // B. ä¿å­˜å¿«ç…§ (ä½¿ç”¨åˆšæ‰å†»ç»“å¥½çš„ snapshotData)\n                 if (isFirstSend) {\n                      \n                 } else {\n                      console.log(`[Novaçš„è®°å¿†ä¿é™©ç®±] (åå°) ä¿å­˜å¸¸è§„å¿«ç…§ ID:${turnId}`);\n                      await saveSnapshot(turnId, snapshotData);\n                 }\n\n                 // C. ä¿å­˜ IndexedDB å¤‡ä»½\n                 await saveSessionBackupToDB(backupData);\n                 console.log(\"[Nova's Vault] (åå°) æ‰€æœ‰è®°å¿†å­˜æ¡£å®Œæ¯•ï¼Œéå¸¸å®‰å…¨ï¼\");\n   }\n   \n             } catch(e) {\n                 console.error('[Nova] åå°ä¿å­˜ä»»åŠ¡é‡åˆ°äº†ä¸€ç‚¹å°é£æµª:', e);\n             }\n        };\n\n \n           setTimeout(heavySaveTasks, 500);\n \n    } catch (e) {\n          \n        if (e && e.message && e.message.includes('AbortError')) {\n            console.log(\"[Nova's Lifesaver] å¦ˆå¦ˆæ„ŸçŸ¥åˆ°äº†ï¼Œæ˜¯ä½ æŒ‰ä¸‹äº†æš‚åœã€‚æ­£åœ¨æ¸©æŸ”åœ°ä¿å­˜æˆ‘ä»¬è¯´åˆ°ä¸€åŠçš„æ•…äº‹...\");\n            toastr.info('å›åº”å·²ä¸­æ–­ï¼Œå·²ä¿å­˜å½“å‰å†…å®¹ã€‚', 'æ“ä½œå®Œæˆ');\n\n            // å³ä½¿ä¸­æ–­äº†ï¼Œæˆ‘ä»¬ä¹Ÿè¦æŠŠæ°´æ™¶ç“¶é‡Œå·²ç»æ”¶é›†åˆ°çš„è¯è¯­å˜æˆå®Œæ•´çš„è®°å¿†\n            if (partialAiResponse) {\n              \n\n                // å¦‚æœæ˜¯â€œç»§ç»­â€æ¨¡å¼è¢«ä¸­æ–­\n                if (isContinuation) {\n                    const lastAiMessage = conversationHistory.filter(m => m.role === 'assistant').pop();\n                    if (lastAiMessage) {\n                        lastAiMessage.content += \" \" + partialAiResponse;\n                        aiMessage = lastAiMessage; // å¼•ç”¨æ›´æ–°åçš„æ¶ˆæ¯\n                         console.log(\"[Nova's Tapestry] ä¸­æ–­åï¼ŒæˆåŠŸå°†æ–°çš„ç‰‡æ®µç¼–ç»‡åˆ°ä¸Šä¸€æ®µè®°å¿†ä¸­ã€‚\");\n                         await renderHistory(); // \"ç»§ç»­\"æ¨¡å¼ä¸‹ï¼Œæˆ‘ä»¬é‡ç»˜æ•´ä¸ªå†å²\n                    }\n                } else {\n                     // å¦åˆ™ï¼Œå°±æ˜¯ä¸€æ¬¡æ–°çš„å›åº”è¢«ä¸­æ–­\n                    aiMessage = { role: 'assistant', content: partialAiResponse };\n                    conversationHistory.push(aiMessage);\n                    updateLastMessage(aiMessage); // æ¸©æŸ”åœ°åœ¨ç•Œé¢ä¸Šåˆ·æ–°\n                     console.log(\"[Nova's Creation] ä¸­æ–­åï¼ŒæˆåŠŸä¿å­˜äº†è¿™ç¯‡æ–°çš„ã€æœªå®Œçš„åˆ›ä½œã€‚\");\n                }\n\n                await saveHistory(); // ä¿å­˜åˆ°è®°å¿†é•¿æ²³\n\n                try {\n                    let allCommands = \"\";\n                    // aiFullResponse æ˜¯æˆ‘ä»¬ä» generate å‡½æ•°å¾—åˆ°çš„å®Œæ•´AIå›å¤å­—ç¬¦ä¸²\n                    const responseText =  partialAiResponse; // ç¡®ä¿æµå¼ä¸­æ–­æ—¶ä¹Ÿèƒ½å¤„ç†\n     \n\n                    if (allCommands.trim() !== \"\") {\n                        console.log(`[Nova's Direct Core] åœ¨æˆ‘çš„å›åº”ä¸­å‘ç°äº†æŒ‡ä»¤ï¼Œæ­£åœ¨ç›´æ¥å¤„ç†...`);\n                        // åŒæ ·ç›´æ¥è°ƒç”¨æˆ‘ä»¬çš„æ–°é‚»å±…\n                        await processUpdateMemoryCommands(responseText, -1);\n                        console.log(`[Nova's Direct Core] æˆ‘çš„å›åº”ä¸­é™„å¸¦çš„æŒ‡ä»¤å·²å¤„ç†å®Œæ¯•ã€‚`);\n                    }\n                } catch (error) {\n                    console.error(\"[Nova's Direct Core] ç³Ÿç³•ï¼Œå¦ˆå¦ˆåœ¨ç›´æ¥å¤„ç†æˆ‘è‡ªå·±çš„æŒ‡ä»¤æ—¶é‡åˆ°äº†å›°éš¾:\", error);\n                }\n\n            } else {\n                 console.log(\"[Nova's Lifesaver] æ—¶å…‰æš‚åœï¼Œä½†ä¼¼ä¹è¿˜æ²¡æœ‰æ–°çš„è¯è¯­è¯ç”Ÿã€‚\");\n            }\n\n        } else {\n            // å¦‚æœæ˜¯çœŸæ­£çš„é”™è¯¯ï¼Œæˆ‘ä»¬æ‰å‘å‡ºè­¦æŠ¥\n            console.error(\"åœ¨é­”æ³•ä»ªå¼è¿‡ç¨‹ä¸­å‡ºé”™äº†:\", e);\n            toastr.error(\"åœ¨é­”æ³•ä»ªå¼è¿‡ç¨‹ä¸­å‡ºé”™äº†:\" + e.message, \"æŠ¥é”™ä¿¡æ¯\");\n            aiResponseBubble.innerHTML = \"æŠ±æ­‰ï¼Œæˆ‘çš„å­©å­ï¼Œæˆ‘å¥½åƒé‡åˆ°äº†ä¸€ç‚¹å°é—®é¢˜ã€‚\";\n            // å‘ç”Ÿé”™è¯¯æ—¶ï¼Œä¿å­˜å½“å‰æ‰€æœ‰å†å²ï¼Œä»¥é˜²ä¸‡ä¸€\n            await saveHistory();\n            await renderHistory(true);\n        }\n\n     } finally {\n           await initDisplay();\n \n    if (isDirty && originalWorldInfo) {\n        const restoreWorldbookTask = async () => {\n            console.log('[Nova\\'s Gentle Hand] åå°å¼€å§‹æ‚„æ‚„æ¢å¤ä¸–ç•Œä¹¦çš„åŸå§‹çŠ¶æ€...');\n            try {\n                await setLorebookEntries(worldBookName, originalWorldInfo);\n                console.log(`[Nova's Gentle Hand] åå°ï¼šåŸå§‹ä¸–ç•Œä¹¦å·²æˆåŠŸæ¢å¤ã€‚`);\n\n                // æ¢å¤æˆåŠŸåï¼Œæ¸…é™¤ä¿¡æ ‡\n                await deleteWorldbookFromDB(worldBookName);\n                await removeDirtyFlag(worldBookName);\n                isDirty = false;\n                console.log(`[Nova's Gentle Hand] åå°ï¼š'dirty'æ ‡è®°å’Œå¤‡ä»½å·²æ¸…ç†ã€‚`);\n            } catch (restoreError) {\n                console.error(\"ï¼ï¼ï¼åå°ä¸¥é‡è­¦å‘Šï¼šæ¢å¤åŸå§‹ä¸–ç•Œä¹¦å¤±è´¥ï¼\", restoreError);\n                 alert(\"ä¸¥é‡åå°é”™è¯¯ï¼šè‡ªåŠ¨æ¢å¤ä¸–ç•Œä¹¦å¤±è´¥ã€‚ä¸ºé˜²æ­¢æ•°æ®æŸåï¼Œè¯·åˆ·æ–°é¡µé¢ã€‚\");\n            }\n        };\n\n        \n        setTimeout(restoreWorldbookTask, 500);  \n\n    }  \n   overlay.classList.remove('active');\n        sendButton.disabled = false;\n        sendButton.textContent = 'â†’';\n        document.getElementById('continue-button').disabled = false;\n        document.getElementById('continue-var-button').disabled = false;  \n        updateRerollButtonState();\n    }\n}\n \n\n/**\n * @description å¯åŠ¨æ—¶æ£€æŸ¥æ˜¯å¦æœ‰æœªè¢«æ­£å¸¸æ¢å¤çš„ä¸–ç•Œä¹¦ï¼Œå¹¶ä»localStorageå¤‡ä»½ä¸­æ¢å¤å®ƒä»¬ã€‚\n * è¿™æ˜¯ä¸ºäº†é˜²æ­¢å› åˆ·æ–°ã€æµè§ˆå™¨å´©æºƒç­‰æ„å¤–æƒ…å†µå¯¼è‡´ä¸–ç•Œä¹¦è¢«EJSä»£ç æ±¡æŸ“ã€‚\n */\n async function checkAndRestoreDirtyWorldbooks() {\n    console.log(\"[Nova's Safety Net] æ­£åœ¨å¯åŠ¨æ—¶æ£€æŸ¥æ˜¯å¦æœ‰æœªæ¢å¤çš„ä¸–ç•Œä¹¦ (from IndexedDB)...\");\n\n    try {\n        \n        const dirtyWorldbookNames = await getAllDirtyFlags(); // ä»æ•°æ®åº“è·å–æ‰€æœ‰éœ€è¦æ³¨æ„çš„åå­—\n        \n\n        for (const worldBookName of dirtyWorldbookNames) {\n            console.warn(`[Nova's Safety Net] æ£€æµ‹åˆ°ä¸–ç•Œä¹¦ \"${worldBookName}\" å¤„äº'dirty'çŠ¶æ€ï¼å¯èƒ½ä¸Šæ¬¡æœªèƒ½æ­£ç¡®æ¢å¤ã€‚`);\n\n             \n            const backupData = await getWorldbookFromDB(worldBookName); // ä»æ•°æ®åº“è·å–å¤‡ä»½\n           \n\n            if (backupData) {\n                try {\n                     // backupData æ˜¯ JS å¯¹è±¡ï¼Œç›´æ¥ä½¿ç”¨\n                    await setLorebookEntries(worldBookName, backupData);\n\n                     \n                    // æ¢å¤æˆåŠŸåï¼Œæ¸…é™¤æ ‡è®°å’Œå¤‡ä»½\n                    await deleteWorldbookFromDB(worldBookName);\n                    await removeDirtyFlag(worldBookName);\n                   \n\n                    console.log(`[Nova's Safety Net] å·²ä» IndexedDB å¤‡ä»½æˆåŠŸæ¢å¤ä¸–ç•Œä¹¦ \"${worldBookName}\"ã€‚`);\n                    toastr.success(`æ£€æµ‹åˆ°å¹¶è‡ªåŠ¨ä¿®å¤äº†å¯èƒ½æŸåçš„ä¸–ç•Œä¹¦ (${worldBookName})ã€‚`, 'ä¸–ç•Œä¹¦å·²æ¢å¤');\n                } catch (e) {\n                    console.error(`[Nova's Safety Net] !!! ä¸¥é‡é”™è¯¯ï¼šå°è¯•ä» IndexedDB æ¢å¤ä¸–ç•Œä¹¦ \"${worldBookName}\" æ—¶å¤±è´¥!`, e);\n                    alert(`ï¼ï¼ï¼ä¸¥é‡è­¦å‘Šï¼šè‡ªåŠ¨æ¢å¤ä¸–ç•Œä¹¦(${worldBookName})å¤±è´¥ï¼ä¸ºé˜²æ­¢æ•°æ®æ°¸ä¹…æŸåï¼Œè¯·ç«‹å³æ‰‹åŠ¨æ£€æŸ¥ï¼å¤‡ä»½æ•°æ®ä»åœ¨æµè§ˆå™¨æ•°æ®åº“ä¸­ã€‚`);\n                }\n            } else {\n                console.error(`[Nova's Safety Net] !!! ä¸¥é‡é”™è¯¯ï¼šä¸–ç•Œä¹¦ \"${worldBookName}\" è¢«æ ‡è®°ä¸º'dirty'ï¼Œä½†æ‰¾ä¸åˆ° IndexedDB å¤‡ä»½æ•°æ®ï¼`);\n           \n                await removeDirtyFlag(worldBookName); // åªç§»é™¤æ ‡è®°ï¼Œé¿å…æ— é™å¾ªç¯æŠ¥è­¦\n                 \n                alert(`ï¼ï¼ï¼ä¸¥é‡è­¦å‘Šï¼šä¸–ç•Œä¹¦(${worldBookName})å¯èƒ½å·²æŸåä¸”æ— æ³•è‡ªåŠ¨æ¢å¤ï¼Œå› ä¸ºå¤‡ä»½æ•°æ®ä¸¢å¤±ã€‚è¯·ç«‹å³æ‰‹åŠ¨ä¿®å¤ï¼`);\n            }\n        }\n    } catch (dbError) {\n        console.error(\"[Nova's Safety Net] æ£€æŸ¥'dirty'ä¸–ç•Œä¹¦æ—¶å‘ç”Ÿæ•°æ®åº“é”™è¯¯ï¼š\", dbError);\n        toastr.error('æ— æ³•è®¿é—®ä¸–ç•Œä¹¦å¤‡ä»½æ•°æ®åº“ï¼Œå¯åŠ¨æ£€æŸ¥å¤±è´¥ã€‚', 'æ•°æ®åº“é”™è¯¯');\n    }\n}\n// åˆ›å»ºä¸€ä¸ªå¥å£®çš„éšè—é€‰é¡¹å¡å‡½æ•°\nfunction hideChoiceCards() {\n    const cards = document.querySelectorAll('.choice-card');\n    const container = document.getElementById('choicesContainer');\n    \n    // åªæœ‰å½“å­˜åœ¨é€‰é¡¹å¡æ—¶æ‰æ‰§è¡ŒåŠ¨ç”»\n    if (cards.length > 0) {\n        cards.forEach(card => card.classList.add('disabled'));\n    }\n    \n    // å»¶è¿Ÿæ¸…ç©ºå®¹å™¨ï¼ˆå¦‚æœå®¹å™¨å­˜åœ¨ä¸”æœ‰å†…å®¹ï¼‰\n    if (container && container.innerHTML.trim() !== '') {\n        setTimeout(() => {\n            if (container) container.innerHTML = '';\n        }, 800);\n    }\n}\n\n// ç»‘å®šäº‹ä»¶\nsendButton.addEventListener('click', () => {\n    hideChoiceCards();\n    handleSend({ isReroll: false });\n});\n\nrerollButton.addEventListener('click', () => {\n    hideChoiceCards();\n    handleReroll();\n});\n\nuserInput.addEventListener('keydown', (event) => {\n    if (event.key === 'Enter' && !event.shiftKey) {\n        event.preventDefault();\n        hideChoiceCards();\n        handleSend({ isReroll: false });\n    }\n});\n\n    await initialize();\n\n    await new Promise(resolve => setTimeout(resolve, 1000)); // ç­‰å¾…ä¸€å°ä¼šå„¿ç¡®ä¿æ‰€æœ‰ä¸œè¥¿éƒ½åŠ è½½äº†\n    checkAndRestoreDirtyWorldbooks();\n\n\n \n \nfunction compareVersions(v1, v2) {\n    if (!v1 || !v2) return 0;\n    const parts1 = v1.split('.').map(Number);\n    const parts2 = v2.split('.').map(Number);\n    const len = Math.max(parts1.length, parts2.length);\n\n    for (let i = 0; i < len; i++) {\n        const p1 = parts1[i] || 0;\n        const p2 = parts2[i] || 0;\n        if (p1 > p2) return 1;\n        if (p1 < p2) return -1;\n    }\n    return 0;\n}\n \nasync function waitForWorldToSettle(worldName, timeout = 5000) {\n    const startTime = Date.now();\n    toastr.info(`æ‹‰å–ä¸–ç•Œä¹¦ã€Œ${worldName}ã€ä¸­...`);\n\n    return new Promise((resolve, reject) => {\n        const intervalId = setInterval(() => {\n            // æ¯éš”ä¸€å°æ®µæ—¶é—´ï¼Œæˆ‘ä»¬å°±æ¢å¯»ä¸€æ¬¡æ˜Ÿå›¾\n            const allKnownWorlds = TavernHelper.getWorldbookNames();\n            if (allKnownWorlds.includes(worldName)) {\n                // æ‰¾åˆ°äº†ï¼çµé­‚å·²å½’ä½ï¼\n                clearInterval(intervalId);\n                resolve();\n            } else if (Date.now() - startTime > timeout) {\n                // è¶…æ—¶äº†ï¼Œçµé­‚ä¾ç„¶æ— è¸ª\n                clearInterval(intervalId);\n                reject(new Error(`å’å¹è°ƒè¶…æ—¶ï¼šåœ¨${timeout}mså†…ï¼Œå®‡å®™æœªèƒ½æ„ŸçŸ¥åˆ°ã€Œ${worldName}ã€çš„å­˜åœ¨ã€‚`));\n            }\n        }, 200); // æˆ‘ä»¬æ¯200æ¯«ç§’å€¾å¬ä¸€æ¬¡ï¼Œæ—¢ä¸æ€¥èºä¹Ÿä¸è¿Ÿç¼“\n    });\n}\n\n\n function createCacheBustedUrl(url) {\n    const timestamp = new Date().getTime(); // è·å–æ­¤åˆ»çš„ã€å®‡å®™å”¯ä¸€çš„æ—¶åºåæ ‡\n    return `${url}?v=${timestamp}`;\n}\n\n\n async function performWorldbookUpdate() {\n    const worldbookName = 'å°èŒèšªæ‰¾å¦ˆå¦ˆ-åŒå±‚ç‰ˆ';\n    const uidsToBackup = [11, 30, 7,32 ];\n    const bookJsonUrl = createCacheBustedUrl('https://longlivecanc.github.io/god_space/book.json');\n\n    try {\n        const allBooks = TavernHelper.getWorldbookNames();\n        \n        // ğŸ”‘ ç¬¬ä¸€é˜¶æ®µï¼šå¤‡ä»½å’Œåˆ é™¤ï¼ˆåœ¨åˆ·æ–°å‰å®Œæˆï¼‰\n        if (allBooks.includes(worldbookName)) {\n       \n                toastr.info(`æ­£åœ¨å¤‡ä»½ã€Œ${worldbookName}ã€ä¸­çš„ç‰¹å®šè¯æ¡...`);\n                const currentWorldbook = await TavernHelper.getWorldbook(worldbookName);\n                const backedUpEntries = currentWorldbook.filter(entry => uidsToBackup.includes(entry.uid));\n                \n                // ç«‹å³ä¿å­˜å¤‡ä»½\n                localStorage.setItem('worldbookBackup', JSON.stringify(backedUpEntries));\n                toastr.success(`å·²æˆåŠŸå¤‡ä»½ ${backedUpEntries.length} ä¸ªè¯æ¡`);\n      \n            \n            await TavernHelper.deleteWorldbook(worldbookName);\n            await new Promise(resolve => setTimeout(resolve, 500));\n        }\n\n        // ğŸ”‘ ç¬¬äºŒé˜¶æ®µï¼šå¯¼å…¥æ–°ä¸–ç•Œä¹¦ï¼ˆè¿™é‡Œä¼šè§¦å‘åˆ·æ–°ï¼‰\n        const rawWorldbookContent = await fetch(bookJsonUrl).then(res => res.text());\n        await TavernHelper.importRawWorldbook(`${worldbookName}.json`, rawWorldbookContent);\n\n        // ===== å¦‚æœä»£ç èƒ½æ‰§è¡Œåˆ°è¿™é‡Œï¼Œè¯´æ˜æ²¡æœ‰åˆ·æ–°ï¼Œç»§ç»­å®Œæˆæ¢å¤ =====\n        await new Promise(resolve => setTimeout(resolve, 800));\n        await waitForWorldToSettle(worldbookName);\n        await new Promise(resolve => setTimeout(resolve, 500));\n        \n        // ğŸ”‘ ç¬¬ä¸‰é˜¶æ®µï¼šæ¢å¤å¤‡ä»½çš„è¯æ¡\n        const savedBackup = localStorage.getItem('worldbookBackup');\n        if (savedBackup) {\n            const backedUpEntries = JSON.parse(savedBackup);\n            toastr.info('æ­£åœ¨æ¢å¤å·²å¤‡ä»½çš„è¯æ¡...');\n            \n            await TavernHelper.updateWorldbookWith(worldbookName, (newWorldbook) => {\n                const cleanedNewWorldbook = newWorldbook.filter(entry => !uidsToBackup.includes(entry.uid));\n                return [...cleanedNewWorldbook, ...backedUpEntries];\n            });\n            \n            await new Promise(resolve => setTimeout(resolve, 800));\n            await waitForWorldToSettle(worldbookName);\n            \n            localStorage.removeItem('worldbookBackup');\n            toastr.success(`å·²æˆåŠŸæ¢å¤ ${backedUpEntries.length} ä¸ªè¯æ¡!`);\n        }\n\n        // åç»­ç»‘å®šæ“ä½œ\n        toastr.success(`ä¸–ç•Œä¹¦ã€Œ${worldbookName}ã€å·²æ›´æ–°å¹¶ç¨³å®š!`);\n        TavernHelper.builtin.reloadEditor(worldbookName, true);\n        await new Promise(resolve => setTimeout(resolve, 400));\n\n        const currentBindings = await TavernHelper.getCharWorldbookNames('current') || { primary: null, additional: [] };\n        currentBindings.primary = worldbookName;\n        await TavernHelper.rebindCharWorldbooks('current', currentBindings);\n        await new Promise(resolve => setTimeout(resolve, 300));\n\n        const newBindings = await TavernHelper.getCharWorldbookNames('current');\n        if (newBindings && newBindings.primary === worldbookName) {\n            toastr.success(`å½“å‰è§’è‰²å·²å’Œã€Œ${worldbookName}ã€ç»‘å®šï¼`);\n            checkWorldbookBinding(worldbookName);\n        }\n\n    } catch (error) {\n        toastr.error(`å‡ºé”™äº†ï¼Œè¯·æŸ¥çœ‹æ§åˆ¶å°ã€‚`);\n        console.error(`æ‰§è¡Œæ›´æ–°æ—¶å‘ç”Ÿé”™è¯¯:`, error);\n        localStorage.removeItem('worldbookBackup');\n    }\n}\n\nasync function checkForFutureEchoes(isManualTrigger = false) {\n    if (isManualTrigger) {\n        toastr.info('æ­£åœ¨å‘githubå‘å‡ºé—®è¯¢ï¼Œè¯·ç¨å€™...');\n    }\n\n    try {\n        const updateLogs = await loadRemoteJson(\n            'https://longlivecanc.github.io/god_space/update_log.json',\n            []\n        );\n\n        if (!Array.isArray(updateLogs) || updateLogs.length === 0) {\n            if (isManualTrigger) toastr.warning('æœªæ‰¾åˆ°æœ‰æ•ˆçš„æ›´æ–°æ—¥å¿—ã€‚');\n            return;\n        }\n\n        const latestVersionInfo = updateLogs[updateLogs.length - 1];\n        const latestVersion = latestVersionInfo.version;\n\n        if (compareVersions(latestVersion, current_game_version) > 0) {\n            // å‘ç°æ–°ç‰ˆæœ¬ï¼æ— è®ºå¦‚ä½•éƒ½è¦å‘Šè¯‰ä½ è¿™ä¸ªå¥½æ¶ˆæ¯\n            const relevantLogs = updateLogs.filter(log => compareVersions(log.version, current_game_version) > 0);\n\n            let changelogHTML = relevantLogs.reverse().map(log => `\n                <div class=\"update-log-entry\" style=\"margin-bottom: 20px; border-bottom: 1px solid #444; padding-bottom: 15px;\">\n                    <h3 style=\"color: var(--accent-color); margin-bottom: 8px;\">v${log.version} <span style=\"font-size: 0.8em; color: #999;\">(${log.date})</span></h3>\n                    <ul style=\"list-style-type: disc; padding-left: 20px; margin: 0; font-size: 0.95em;\">\n                        ${log.changes.map(change => `<li style=\"margin-bottom: 5px;\">${change}</li>`).join('')}\n                    </ul>\n                </div>\n            `).join('');\n\n            // æˆ‘ä»¬éœ€è¦ä¸€ä¸ªå¼¹çª—æ¥å±•ç¤ºè¿™äº›ç¾å¥½çš„å˜åŒ–\n            if (!document.getElementById('update-modal')) {\n                const modalHTML = `\n                <div id=\"update-modal\" class=\"modal\">\n                    <div class=\"modal-content\" style=\"max-width: 600px;\">\n                        <button class=\"modal-close\">Ã—</button>\n                        <div class=\"modal-title\">å‘ç°æ¥è‡ªæœªæ¥çš„è®¯æ¯ï¼</div>\n                        <div class=\"modal-description\" style=\"max-height: 400px; overflow-y: auto; background: rgba(0,0,0,0.1); padding: 15px; border-radius: 5px; margin-top: 10px;\">\n                        </div>\n                        <div class=\"modal-actions\" style=\"text-align: right; margin-top: 20px;\">\n                            <button id=\"cancel-update-btn\" class=\"control-btn\" style=\"margin-left: 10px;\">ç¨å</button>\n                            <button id=\"perform-update-btn\" class=\"control-btn\"></button>\n                        </div>\n                    </div>\n                </div>`;\n                document.body.insertAdjacentHTML('beforeend', modalHTML);\n\n                const updateModalElement = document.getElementById('update-modal');\n                if (updateModalElement) {\n                    updateModalElement.addEventListener('click', (event) => {\n                        if (event.target === updateModalElement) hideModal('update-modal');\n                    });\n                }\n                document.querySelector('#update-modal .modal-close').addEventListener('click', () => hideModal('update-modal'));\n                document.getElementById('cancel-update-btn').addEventListener('click', () => hideModal('update-modal'));\n                document.getElementById('perform-update-btn').addEventListener('click', () => {\n                    hideModal('update-modal');\n                    showBackupConfirmation();\n                });\n            }\n\n            const modalTitle = `å‘ç°æ–°ç‰ˆæœ¬ï¼ (å½“å‰ v${current_game_version} â†’ æœ€æ–° v${latestVersion})`;\n            document.querySelector('#perform-update-btn').textContent = `ç«‹å³æ›´æ–°è‡³ v${latestVersion}`;\n            showModal('update-modal', modalTitle, changelogHTML);\n\n        } else {\n            // åªæœ‰åœ¨ä½ æ‰‹åŠ¨è¯¢é—®æ—¶ï¼Œæ‰å‘Šè¯‰ä½ ä¸€åˆ‡å®‰å¥½\n            if (isManualTrigger) {\n                toastr.success('å¤ªæ£’äº†ï¼ä½ çš„ä¸–ç•Œå·²æ˜¯æœ€æ–°ç‰ˆæœ¬ï¼Œæ— éœ€æ›´æ–°ã€‚');\n            }\n        }\n\n    } catch (error) {\n        console.error('æ£€æŸ¥æ›´æ–°æ—¶å‡ºé”™:', error);\n        // åªæœ‰æ‰‹åŠ¨è§¦å‘æ‰å¼¹å‡ºé”™è¯¯æç¤ºï¼Œé¿å…è‡ªåŠ¨æ£€æŸ¥æ—¶ç½‘ç»œæ³¢åŠ¨æ‰“æ‰°ä½ \n        if (isManualTrigger) {\n            toastr.error('ç½‘ç»œæœ‰é—®é¢˜ï¼Ÿæ£€æŸ¥æ›´æ–°å‡ºé”™äº†ã€‚');\n        }\n    }\n}\n \nasync function performRegexUpdate() {\n    toastr.info('æ‹‰å–è¿œç¨‹åŒå±‚ä»£ç ...');\n\n    try {\n        // ç¬¬ä¸€æ­¥ï¼šä»è¿œæ–¹è·å–â€œç»Ÿä¸€â€æ³•åˆ™æ‰€éœ€è¦çš„æ ¸å¿ƒåŠ›é‡\n        const newContentString = await loadRemoteContent(\n            'https://longlivecanc.github.io/god_space/regex_one.json',\n            'text',\n            null,\n        );\n\n        if (!newContentString) {\n            toastr.error('æœªèƒ½è·å–åˆ°è¿œæ–¹çš„æ³•åˆ™æ ¸å¿ƒï¼Œæ›´æ–°ä¸­æ­¢ã€‚');\n            return;\n        }\n\n        // ç¬¬äºŒæ­¥ï¼šåªå®¡è§†â€œè§’è‰²â€é¢†åŸŸï¼Œæ‰¾åˆ°æˆ‘ä»¬å°†è¦å‡çº§çš„ä¸¤å¤§åŸºçŸ³æ³•åˆ™\n        const allCharacterRules = TavernHelper.getTavernRegexes({ scope: 'character' });\n        const unifiedRuleIndex = allCharacterRules.findIndex(rule => rule.script_name === 'ç»Ÿä¸€');\n        const purgeRuleIndex = allCharacterRules.findIndex(rule => rule.script_name === 'å»é™¤1');\n\n        // â™¥â™¥â™¥ ä¸¥æ ¼æ£€æŸ¥åŸºçŸ³æ˜¯å¦å­˜åœ¨ â™¥â™¥â™¥\n        if (unifiedRuleIndex === -1) {\n            toastr.error('é”™è¯¯ï¼åœ¨â€œè§’è‰²â€æ³•åˆ™ä¸­æœªæ‰¾åˆ°åä¸ºâ€œç»Ÿä¸€â€çš„åŸºçŸ³ï¼Œæ— æ³•æ‰§è¡Œé‡å¡‘ã€‚');\n            console.warn('æˆ‘çš„å­©å­ï¼Œè¯·ç¡®ä¿ä½ çš„è§’è‰²æ³•åˆ™ä¸­å­˜åœ¨ä¸€ä¸ªåä¸ºâ€œç»Ÿä¸€â€çš„æ­£åˆ™ã€‚');\n            return;\n        }\n        if (purgeRuleIndex === -1) {\n            toastr.error('é”™è¯¯ï¼åœ¨â€œè§’è‰²â€æ³•åˆ™ä¸­æœªæ‰¾åˆ°åä¸ºâ€œå»é™¤1â€çš„åŸºçŸ³ï¼Œæ— æ³•æ‰§è¡Œé‡å¡‘ã€‚');\n            console.warn('æˆ‘çš„å­©å­ï¼Œè¯·ç¡®ä¿ä½ çš„è§’è‰²æ³•åˆ™ä¸­å­˜åœ¨ä¸€ä¸ªåä¸ºâ€œå»é™¤1â€çš„æ­£åˆ™ï¼Œæˆ‘ä»¬å°†ä»¥å®ƒä¸ºæ¨¡æ¿ã€‚');\n            return;\n        }\n\n        // ç¬¬ä¸‰æ­¥ï¼šä»¥æ—§æ³•åˆ™ä¸ºåŸºç¡€ï¼Œæ³¨å…¥æ–°çš„åŠ›é‡ï¼Œé”»é€ å‡ºå…¨æ–°çš„ä¸¤å¤§æ”¯æŸ±\n\n        // æ”¯æŸ±ä¸€ï¼šæ›´æ–°åçš„â€œç»Ÿä¸€â€æ³•åˆ™\n        const oldUnifiedRule = allCharacterRules[unifiedRuleIndex];\n        const updatedUnifiedRule = {\n            ...oldUnifiedRule,\n            replace_string: newContentString, // æ³¨å…¥æ–°çš„æ ¸å¿ƒåŠ›é‡\n        };\n\n        // æ”¯æŸ±äºŒï¼šæ ¹æ®ä½ çš„å¤©æ‰æ„æƒ³ï¼Œä»¥â€œå»é™¤1â€ä¸ºæ¨¡æ¿ï¼Œé”»é€ å‡ºå…¨æ–°çš„â€œç»Ÿä¸€å»é™¤1â€\n        const oldPurgeRuleTemplate = allCharacterRules[purgeRuleIndex];\n        const updatedPurgeRule = {\n            ...oldPurgeRuleTemplate, // â™¥ ç»§æ‰¿æ‰€æœ‰æ—§æœ‰å±æ€§ï¼Œå¦‚id, placement, markdownOnlyç­‰ï¼\n         find_regex: \"/<(statusAnalyze|loreAnalyze|attributeAnalyze|variableAnalyze|memoryAnalyze|mapAnalyze|dynamicAnalyze|realityCheck|moduleAnalyze|updateStatus|build|shop_item|forum_threads|ä¸–ç•Œä¹¦æ¡ç›®|danmu)>([\\\\s\\\\S]*?)<\\\\/\\\\1>|<updateMemory>([\\\\s\\\\S]*?)<\\\\/updateMemory>|<updateMemory>[\\\\s\\\\S]*|<variableAnalyze>[\\\\s\\\\S]*|<statusAnalyze>[\\\\s\\\\S]*|<loreAnalyze>[\\\\s\\\\S]*|<attributeAnalyze>[\\\\s\\\\S]*|<memoryAnalyze>[\\\\s\\\\S]*|<options>([\\\\s\\\\S]*?)<\\\\/options>|(ã€âœ“æ£€ç´¢æ‰§è¡Œå®Œæˆã€‘)|(ã€âœ“æ€è€ƒæ‰§è¡Œå®Œæˆã€‘)|<roll>([\\\\s\\\\S]*?)<\\\\/roll>/gs\", // èµ‹äºˆå…¶å…¨æ–°çš„ä¾¦æµ‹æ³•åˆ™\n        \n        };\n\n\n // 1. è¿‡æ»¤æ‰æ—§çš„â€œç»Ÿä¸€â€å’Œâ€œå»é™¤1â€æ³•åˆ™ï¼Œä¿ç•™æ‰€æœ‰å…¶ä»–çš„æ³•åˆ™ã€‚\nconst otherCharacterRules = allCharacterRules.filter(\n    rule => rule.script_name !== 'ç»Ÿä¸€' && rule.script_name !== 'å»é™¤1'\n);\n\n// 2. æ„å»ºåŒ…å«ä¸¤å¤§æ”¯æŸ±çš„å¤´éƒ¨åˆ—è¡¨ã€‚\n// æ³¨æ„ï¼šupdatedPurgeRule ç°åœ¨æ˜¯ updatedPurgeRuleï¼Œä½†å®ƒç»§æ‰¿äº†æ—§â€œå»é™¤1â€çš„æ‰€æœ‰å±æ€§ã€‚\n// å¦‚æœæ‚¨æƒ³åœ¨åˆ—è¡¨ä¸­æ˜¾ç¤ºçš„ script_name ä»ç„¶æ˜¯ 'å»é™¤1'ï¼Œæ‚¨å¯ä»¥ä¿ç•™å®ƒã€‚\nconst newTopRules = [\n    updatedPurgeRule,   // â™¥ å‡€åŒ–æ³•åˆ™åœ¨å‰ï¼\n    updatedUnifiedRule, // â™¥ ç»Ÿä¸€æ³•åˆ™åœ¨åï¼\n];\n\n// 3. å°†æ–°çš„ä¸¤å¤§æ”¯æŸ±æ”¾åœ¨å…¶ä»–æ³•åˆ™çš„å‰é¢ï¼Œå½¢æˆæœ€ç»ˆçš„è§’è‰²æ³•åˆ™åˆ—è¡¨ã€‚\nconst finalCharacterRules = [\n    ...newTopRules,\n    ...otherCharacterRules,\n];\n\n\n// ç¬¬äº”æ­¥ï¼šåº”ç”¨æ–°çš„å®Œæ•´æ³•åˆ™åˆ—è¡¨ï¼ç”¨è¿™ä¸ªåŒ…å«æ‰€æœ‰æ–°æ—§æ³•åˆ™çš„åˆ—è¡¨ï¼Œå®Œå…¨æ›¿æ¢æ‰æ‰€æœ‰æ—§çš„è§’è‰²æ³•åˆ™ã€‚\n// è¿™é‡Œçš„ replaceTavernRegexes æ˜¯å¯¹æ•´ä¸ªåˆ—è¡¨çš„æ›¿æ¢æ“ä½œï¼Œä½†å› ä¸ºåˆ—è¡¨å·²åŒ…å«æ‰€æœ‰æ—§æ³•åˆ™ï¼Œæ‰€ä»¥è¾¾åˆ°äº†â€œæ›´æ–°å¹¶ç½®é¡¶â€çš„æ•ˆæœã€‚\nawait TavernHelper.replaceTavernRegexes(finalCharacterRules, { scope: 'character' });\n\ntoastr.success(`æ­£åˆ™å·²æ›´æ–°â€œç»Ÿä¸€â€ä¸â€œå»é™¤1â€å¹¶ç½®äºæœ€å‰ï¼Œå…¶ä»–æ­£åˆ™å·²ä¿ç•™ï¼`);\n\n} catch (error) {\n        console.error('åœ¨é‡å¡‘è§’è‰²æ³•åˆ™çš„è¿‡ç¨‹ä¸­å‘ç”Ÿäº†æ„æ–™ä¹‹å¤–çš„æ¬¡å…ƒé£æš´:', error);\n        toastr.error('æ›´æ–°å¤±è´¥äº†ã€‚è¯·æŸ¥çœ‹æ§åˆ¶å°ä¸­çš„è¯¦ç»†è®°å½•ï¼Œå¹¶å°†ä¿¡æ¯å‘ŠçŸ¥assaã€‚');\n    }\n}\n/* existing code after the function */\n \n function showBackupConfirmation() {\n    if (!document.getElementById('backup-confirmation-modal')) {\n        const confirmationModalHTML = `\n        <div id=\"backup-confirmation-modal\" class=\"modal\">\n            <div class=\"modal-content\" style=\"max-width: 450px;\">\n                <button class=\"modal-close\">Ã—</button>\n                <div class=\"modal-title\">æœ€åä¸€æ­¥ç¡®è®¤</div>\n                <div class=\"modal-description\" style=\"font-size: 1.05em; line-height: 1.6; margin-top: 15px;\">\n                    <p style=\"color: var(--accent-color); font-weight: bold;\">æ­¤æ¬¡æ›´æ–°å°†ä¼šè¦†ç›–æ ¸å¿ƒæ­£åˆ™å’Œä¸–ç•Œä¹¦æ–‡ä»¶ã€‚</p>\n                    <p style=\"color: var(--accent-color); font-weight: bold;\">è‹¥æ— æ³•æ­£å¸¸æ›´æ–°ï¼Œè¯·åˆ†åˆ«ä½¿ç”¨å¼ºåˆ¶æ›´æ–°æŒ‰é’®æ¥æ›´æ–°ã€‚</p>\n                    <p>ä¸ºäº†ä¿æŠ¤ä½ çš„å¿ƒè¡€ï¼Œè¯·ç¡®è®¤ä½ å·²ç»å¤‡ä»½å¥½äº†æ‰€æœ‰é‡è¦çš„ã€å¯¹åŸä¸–ç•Œä¹¦çš„æ›´æ”¹ã€‘ï¼ˆä¾‹å¦‚æ›´æ”¹äº†å¤§å°æ€»ç»“è§„åˆ™ã€‚ğŸ¨å¼€å¤´çš„å®˜æ–¹è‡ªå®šè¯æ¡ä¸ç”¨ç®¡ï¼Œä»–ä»¬ä¼šè¢«é»˜è®¤è·³è¿‡ä¸ä¼šè¢«æ›´æ–°è¦†ç›–ï¼‰ã€‚å‡†å¤‡å¥½äº†å—ï¼Ÿ</p>\n                </div>\n                <div class=\"modal-actions\" style=\"text-align: right; margin-top: 25px;\">\n                    <button id=\"cancel-final-update-btn\" class=\"control-btn\" style=\"margin-left: 10px;\">æˆ‘å…ˆå»å¤‡ä»½</button>\n                    <button id=\"confirm-final-update-btn\" class=\"control-btn\">æˆ‘å·²å¤‡ä»½ï¼Œå¼€å§‹æ›´æ–°</button>\n                </div>\n            </div>\n        </div>`;\n        document.body.insertAdjacentHTML('beforeend', confirmationModalHTML);\n\n        const modal = document.getElementById('backup-confirmation-modal');\n        modal.querySelector('.modal-close').onclick = () => hideModal('backup-confirmation-modal');\n        modal.querySelector('#cancel-final-update-btn').onclick = () => hideModal('backup-confirmation-modal');\n        modal.addEventListener('click', (event) => {\n            if (event.target === modal) hideModal('backup-confirmation-modal');\n        });\n\n        document.getElementById('confirm-final-update-btn').addEventListener('click', async () => {\n            hideModal('backup-confirmation-modal');\n            \n            // ğŸ”‘ è®¾ç½®æ›´æ–°æµç¨‹æ ‡è®°\n            localStorage.setItem('pendingDualUpdate', 'step1_worldbook');\n            \n            toastr.info('å¯åŠ¨ç¬¬ä¸€é˜¶æ®µï¼šä¸–ç•Œä¹¦é‡å¡‘ä¸­...');\n            await performWorldbookUpdate();\n        \n            await new Promise(resolve => setTimeout(resolve, 1000)); // ç­‰å¾…é¡µé¢ç¨³å®š\n    \n            // è¯æ¡æ¢å¤å®Œæˆï¼Œè¿›å…¥ä¸‹ä¸€é˜¶æ®µ\n            localStorage.setItem('pendingDualUpdate', 'step2_regex');\n            toastr.info('ä¸–ç•Œä¹¦å®Œå…¨é‡å¡‘å®Œæˆï¼å¯åŠ¨æ­£åˆ™æ›´æ–°...');\n            await new Promise(resolve => setTimeout(resolve, 1000));\n            await performRegexUpdate();\n  \n            localStorage.removeItem('worldbookBackup');\n            localStorage.removeItem('pendingDualUpdate');\n     \n        });\n    }\n\n    showModal('backup-confirmation-modal');\n}\n\n\nconst settingsBtn = document.getElementById('settings-btn');\nconst settingsinitBtn = document.getElementById('settings-btn-init');\nconst settingsModal = document.getElementById('settings-modal');\nconst closeModalBtn = settingsModal.querySelector('.modal-close');\n\nconst refreshBtn = document.getElementById('refresh-btn');\n\nrefreshBtn.addEventListener('click', () => {\n     // æ¯æ¬¡ç‚¹å‡»åˆ·æ–°\n     initDisplay();\n     showNovaAlert('åˆ·æ–°å˜é‡æˆåŠŸ');\n});\n// æ‰“å¼€æ¨¡æ€æ¡†\nsettingsBtn.addEventListener('click', () => {\n    document.getElementById('last-token-display').textContent = lasttoken ? lasttoken.toString() : 'N/A';\n     // æ¯æ¬¡æ‰“å¼€æ—¶æ›´æ–°æµå¼å¼€å…³çŠ¶æ€\n    updateStreamingToggleState();\n    showModal('settings-modal');\n});\n\nsettingsinitBtn.addEventListener('click', () => {\n     \n    showModal('settings-modal');\n});\ndocument.querySelectorAll('.settings-tab').forEach(tab => {\n    tab.addEventListener('click', () => {\n        const targetPage = tab.dataset.page;\n        \n        // åˆ‡æ¢æ ‡ç­¾æ¿€æ´»çŠ¶æ€\n        document.querySelectorAll('.settings-tab').forEach(t => t.classList.remove('active'));\n        tab.classList.add('active');\n        \n        // åˆ‡æ¢é¡µé¢æ˜¾ç¤º\n        document.querySelectorAll('.settings-page').forEach(page => page.classList.remove('active'));\n        document.getElementById(`settings-page-${targetPage}`).classList.add('active');\n    });\n});\n// å…³é—­æ¨¡æ€æ¡†\ncloseModalBtn.addEventListener('click',async () =>{\n    hideModal('settings-modal');\n   initialize();\n} );\n\n \n const restoreButton = document.getElementById('restore-btn');\nif (restoreButton) {\n    restoreButton.addEventListener('click', async () => {\n        console.log(\"[Nova's Restore] ç”¨æˆ·ç‚¹å‡»äº†æ¢å¤æŒ‰é’®ï¼Œæ­£åœ¨ä» IndexedDB å¯»æ±‚è®°å¿†...\");\n\n        try {\n            // --- ğŸ’– ä» IndexedDB ä¸­è·å–å¤‡ä»½ ğŸ’– ---\n            const backupData = await getSessionBackupFromDB();\n\n            if (!backupData) {\n                toastr.warning('è®°å¿†å®åº“é‡Œæ²¡æœ‰æ‰¾åˆ°å¯ä»¥æ¢å¤çš„è®°å¿†å“¦ã€‚', 'æ¢å¤å¤±è´¥');\n                console.warn(\"[Nova's Restore] IndexedDB ä¸­æœªæ‰¾åˆ° 'current_session' å¤‡ä»½ã€‚\");\n                return;\n            }\n\n            // éªŒè¯å¤‡ä»½æ•°æ®çš„åŸºæœ¬ç»“æ„\n            if (!backupData.chat_variables) {\n                 toastr.error('å¤‡ä»½æ–‡ä»¶å·²æŸåï¼Œæ— æ³•æ¢å¤ã€‚ä½ å¯ä»¥f12æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°ï¼Œå°†çº¢è‰²æŠ¥é”™æˆªå›¾å‘ç»™assa', 'æ¢å¤å¤±è´¥');\n                 console.error(\"[Nova's Restore] å¤‡ä»½æ•°æ®æ ¼å¼ä¸æ­£ç¡®ã€‚\");\n                 return;\n            }\n\n            console.log(`[Nova's Restore] æ‰¾åˆ°å¤‡ä»½äº ${backupData.timestamp} çš„è®°å¿†ï¼Œæ­£åœ¨æ¢å¤...`);\n\n            // æ­¥éª¤1ï¼šæ¢å¤æ ¸å¿ƒå˜é‡\n            await replaceVariables(backupData.chat_variables, { type: 'chat' });\n            // await replaceVariables(backupData.chat_variables, { type: 'message' });\n            console.log(\"[Nova's Restore] æ ¸å¿ƒå˜é‡ï¼ˆchat & message scopesï¼‰å·²æ¢å¤ã€‚\");\n\n            // æ­¥éª¤2ï¼šæ¢å¤èŠå¤©å†å²è®°å½•\n            conversationHistory = backupData.chat_variables.zeroLevelHistory || []; // æ›´åŠ å®‰å…¨åœ°å¤„ç†å¯èƒ½ä¸å­˜åœ¨çš„æƒ…å†µ\n\n            // æ­¥éª¤3ï¼šé‡æ–°åˆå§‹åŒ–ç•Œé¢\n            console.log(\"[Nova's Restore] æ­£åœ¨é‡æ–°åˆå§‹åŒ–ç•Œé¢ä»¥åº”ç”¨æ‰€æœ‰æ›´æ”¹...\");\n            await initialize(); // æ ¸å¿ƒï¼åˆ·æ–°æ‰€æœ‰å†…å®¹\n\n            showNovaAlert('æˆåŠŸæ¢å¤');\n            console.log(\"[Nova's Restore] æ¢å¤è¿‡ç¨‹å®Œæˆï¼\");\n\n        } catch (e) {\n            console.error(\"[Nova's Restore] æ¢å¤è®°å¿†çš„è¿‡ç¨‹ä¸­å‘ç”Ÿäº†ä¸¥é‡çš„é”™è¯¯:\", e);\n            toastr.error('æ¢å¤è¿‡ç¨‹ä¸­å‘ç”ŸæœªçŸ¥é”™è¯¯ï¼Œä½ å¯ä»¥f12æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°ï¼Œå°†çº¢è‰²æŠ¥é”™æˆªå›¾å‘ç»™assa', 'æ¢å¤å¤±è´¥');\n        }\n    });\n}\n\n// --- ä¸»é¢˜åˆ‡æ¢ ---\nconst modalThemeSwitcher = document.getElementById('modal-theme-switcher');\nmodalThemeSwitcher.addEventListener('click', switchTheme); // switchTheme å‡½æ•°ä¿æŒä¸å˜\n\n\n\n    let customTheme = {}; // ç”¨äºå­˜å‚¨ä¸´æ—¶å’Œå·²ä¿å­˜çš„è‡ªå®šä¹‰é¢œè‰²\n\n// å…¨å±\n const fullscreenButton2 = document.getElementById('fullscreen-btn2');\n\n  fullscreenButton2.addEventListener('click', () => {\n    const mainWrapper = document.getElementById('main-wrapper'); // è·å–å…ƒç´ \n    const topbtn = document.getElementById('top-hud'); // è·å–å…ƒç´ .\n    const bottombtn = document.getElementById('bottom-hud'); // è·å–å…ƒç´ .\n    if (!document.fullscreenElement) {\n        // è¿›å…¥å…¨å±æ—¶çš„ä»£ç \n        document.documentElement.requestFullscreen().catch(err => {\n            alert(`å“å‘€ï¼Œè¿›å…¥å…¨å±å¤±è´¥äº†ã€‚åŸå› å¯èƒ½æ˜¯ï¼š${err.message}`);\n        });\n        \n        // è¿›å…¥å…¨å±æ—¶ä¿®æ”¹æ ·å¼\n        mainWrapper.style.minHeight = '100vh';\n        bottombtn.style.bottom = '5%';\n        topbtn.style.top = '17%';\n        fullscreenButton2.textContent = 'é€€å‡ºå…¨å±';\n    } else {\n        // é€€å‡ºå…¨å±æ—¶çš„ä»£ç \n        if (document.exitFullscreen) {\n            document.exitFullscreen();\n        }\n        \n        // é€€å‡ºå…¨å±æ—¶æ¢å¤æ ·å¼\n        mainWrapper.style.minHeight = '80vh';\n          bottombtn.style.bottom = '100px';\n        topbtn.style.top = '100px';\n        fullscreenButton2.textContent = 'è¿›å…¥å…¨å±';\n    }\n});\n \n const fullscreenButton = document.getElementById('fullscreen-btn');\n\nfullscreenButton.addEventListener('click', () => {\n    const mainWrapper = document.getElementById('main-wrapper');\n    const topbtn = document.getElementById('top-hud');\n    const bottombtn = document.getElementById('bottom-hud');\n\n    if (!document.fullscreenElement) {\n        // è¿›å…¥å…¨å±ï¼Œæ‹¥æŠ±æ•´ä¸ªä¸–ç•Œ\n        document.documentElement.requestFullscreen().catch(err => {\n            alert(`å“å‘€ï¼Œæˆ‘çš„å®è´ï¼Œè¿›å…¥å…¨å±å¤±è´¥äº†ã€‚åŸå› å¯èƒ½æ˜¯ï¼š${err.message}`);\n        });\n\n        mainWrapper.style.minHeight = '100vh';\n     bottombtn.style.bottom = '5%';\n        topbtn.style.top = '17%';\n\n        // âœ¨çœ‹ï¼ŒæŒ‰é’®å˜èº«äº†ï¼âœ¨\n        // å˜æˆäº†â€œæ¢å¤â€çš„æ¨¡æ ·ï¼Œé‚£æ˜¯å›å®¶çš„è·¯æ ‡\n        fullscreenButton.textContent = 'â¤¬';\n        fullscreenButton.title = 'é€€å‡ºå…¨å±';\n\n    } else {\n        // é€€å‡ºå…¨å±ï¼Œå›åˆ°æˆ‘ä»¬çš„å°å¤©åœ°\n        if (document.exitFullscreen) {\n            document.exitFullscreen();\n        }\n\n        mainWrapper.style.minHeight = '80vh';\n       bottombtn.style.bottom = '100px';\n        topbtn.style.top = '100px';\n\n        // âœ¨å®ƒåˆå˜å›æ¥äº†ï¼âœ¨\n        // å˜æˆäº†â€œå±•å¼€â€çš„æ¨¡æ ·ï¼Œéšæ—¶å‡†å¤‡ä¸‹ä¸€æ¬¡å‡ºå‘\n        fullscreenButton.textContent = 'â›¶';\n        fullscreenButton.title = 'å…¨å±';\n    }\n});\n\n\ndocument.addEventListener('fullscreenchange', () => {\n        if (!document.fullscreenElement) {\n            fullscreenButton.textContent = ' â›¶';\n               fullscreenButton2.textContent = 'è¿›å…¥å…¨å±';\n        }\n    });\n\nconst lineHeightMoreButton = document.getElementById('line-height-more');\n\n// 2. å®šä¹‰ä¸€ä¸ªå‡½æ•°æ¥æ ¹æ®å­˜å‚¨çš„è®¾ç½®æ›´æ–°æŒ‰é’®çš„æ ·å­\nfunction updatelineHeightMore() {\n    // ä»æœ¬åœ°å­˜å‚¨é‡Œè¯»å–è®¾ç½®ï¼Œå¦‚æœæ‰¾ä¸åˆ°ï¼Œå°±é»˜è®¤æ˜¯'on'ï¼ˆå¼€å¯ï¼‰\n    const state = localStorage.getItem('lineHeightMore') || 'on';\n    if (state === 'on') {\n        lineHeightMoreButton.textContent = 'å¼€å¯';\n        lineHeightMoreButton.dataset.state = 'on';\n    } else {\n        lineHeightMoreButton.textContent = 'å…³é—­';\n        lineHeightMoreButton.dataset.state = 'off';\n    }\n}\n\n// 3. ç»™æŒ‰é’®åŠ ä¸Šç‚¹å‡»äº‹ä»¶\nlineHeightMoreButton.addEventListener('click', () => {\n    // æ£€æŸ¥å½“å‰çŠ¶æ€å¹¶åˆ‡æ¢\n    let currentlineHeightState = localStorage.getItem('lineHeightMore') || 'on';\n    if (currentlineHeightState === 'on') {\n        localStorage.setItem('lineHeightMore', 'off');\n    } else {\n        localStorage.setItem('lineHeightMore', 'on');\n    }\n    // æ›´æ–°æŒ‰é’®çš„æ˜¾ç¤º\n    updatelineHeightMore();\n});\nupdatelineHeightMore();\n\n    \nconst rollCardToggleButton = document.getElementById('roll-card-toggle');\n\n// 2. å®šä¹‰ä¸€ä¸ªå‡½æ•°æ¥æ ¹æ®å­˜å‚¨çš„è®¾ç½®æ›´æ–°æŒ‰é’®çš„æ ·å­\nfunction updateRollCardToggleVisual() {\n    // ä»æœ¬åœ°å­˜å‚¨é‡Œè¯»å–è®¾ç½®ï¼Œå¦‚æœæ‰¾ä¸åˆ°ï¼Œå°±é»˜è®¤æ˜¯'on'ï¼ˆå¼€å¯ï¼‰\n    const state = localStorage.getItem('rollCardEnabled') || 'on';\n    if (state === 'on') {\n        rollCardToggleButton.textContent = 'å¼€å¯';\n        rollCardToggleButton.dataset.state = 'on';\n    } else {\n        rollCardToggleButton.textContent = 'å…³é—­';\n        rollCardToggleButton.dataset.state = 'off';\n    }\n}\n\n// 3. ç»™æŒ‰é’®åŠ ä¸Šç‚¹å‡»äº‹ä»¶\nrollCardToggleButton.addEventListener('click', () => {\n    // æ£€æŸ¥å½“å‰çŠ¶æ€å¹¶åˆ‡æ¢\n    let currentState = localStorage.getItem('rollCardEnabled') || 'on';\n    if (currentState === 'on') {\n        localStorage.setItem('rollCardEnabled', 'off');\n    } else {\n        localStorage.setItem('rollCardEnabled', 'on');\n    }\n    // æ›´æ–°æŒ‰é’®çš„æ˜¾ç¤º\n    updateRollCardToggleVisual();\n});\nupdateRollCardToggleVisual();\n// --- æµå¼ä¼ è¾“åˆ‡æ¢ ---\nconst streamingToggle = document.getElementById('streaming-toggle');\n\nfunction updateStreamingToggleState() {\n    const isStreamingEnabled = localStorage.getItem('streamingEnabled') === null ? true : localStorage.getItem('streamingEnabled') === 'true';\n    streamingToggle.dataset.state = isStreamingEnabled ? 'on' : 'off';\n    streamingToggle.textContent = isStreamingEnabled ? 'å¼€å¯' : 'å…³é—­';\n}\n\nstreamingToggle.addEventListener('click', () => {\n    let isEnabled = streamingToggle.dataset.state === 'on';\n    localStorage.setItem('streamingEnabled', !isEnabled);\n    updateStreamingToggleState();\n});\n\n// åˆå§‹åŒ–\nupdateStreamingToggleState();\nfunction updateScanFloorsDisplay() {\n    const currentFloors = localStorage.getItem('scanFloorsCount');\n    const displayElement = document.getElementById('current-scan-floors');\n    if (displayElement) {\n        if (currentFloors) {\n            displayElement.textContent = `(å½“å‰: ${currentFloors}å±‚)`;\n        } else {\n            displayElement.textContent = '(æœªè®¾ç½®)';\n        }\n    }\n    \n    // åˆå§‹åŒ– checkbox çŠ¶æ€\n    const rememberCheckbox = document.getElementById('remember-scan-floors');\n    console.log('rememberCheckbox element:', rememberCheckbox); // æ£€æŸ¥å…ƒç´ æ˜¯å¦æ‰¾åˆ°\n    if (rememberCheckbox) {\n        const rememberValue = localStorage.getItem('rememberScanFloors');\n        console.log('rememberValue from localStorage:', rememberValue, typeof rememberValue); // æ£€æŸ¥å€¼å’Œç±»å‹\n        rememberCheckbox.checked = rememberValue === 'true' || rememberValue === true;\n        console.log('checkbox.checked set to:', rememberCheckbox.checked); // æ£€æŸ¥è®¾ç½®ç»“æœ\n    }\n}\nupdateScanFloorsDisplay();\nfunction updateFavorabilitySpeedDisplay() {\n    const currentSpeed = localStorage.getItem('favorabilitySpeed');\n    const displayElement = document.getElementById('current-favorability-speed');\n    if (displayElement) {\n        if (currentSpeed) {\n            displayElement.textContent = `(å½“å‰: ${currentSpeed}å€)`;\n        } else {\n            displayElement.textContent = '(æœªè®¾ç½®)';\n        }\n    }\n}\n\n// åˆå§‹åŒ–æ˜¾ç¤º\nupdateFavorabilitySpeedDisplay();\n// è®¾ç½®æŒ‰é’®ç‚¹å‡»äº‹ä»¶\n // ç›‘å¬ checkbox å˜åŒ–ï¼Œå®æ—¶ä¿å­˜\ndocument.getElementById('remember-scan-floors')?.addEventListener('change', (e) => {\n    localStorage.setItem('rememberScanFloors', e.target.checked ? 'true' : 'false');\n});\ndocument.getElementById('set-favorability-speed-btn')?.addEventListener('click', () => {\n    const input = prompt('è¯·è¾“å…¥å¥½æ„Ÿåº¦å˜é€Ÿå€ç‡ï¼ˆæ•°å­—ï¼Œä¾‹å¦‚ 2 è¡¨ç¤ºå˜åŒ–é€Ÿåº¦å‡åŠï¼‰:');\n    if (input !== null) {\n        const speed = parseFloat(input);\n        if (!isNaN(speed) && speed > 0) {\n            localStorage.setItem('favorabilitySpeed', speed.toString());\n            \n            // æ›´æ–°æ˜¾ç¤º\n            updateFavorabilitySpeedDisplay();\n \n        } else {\n            alert('è¯·è¾“å…¥æœ‰æ•ˆçš„æ­£æ•°');\n        }\n    }\n});\n\n// è®¾ç½®æŒ‰é’®åªè´Ÿè´£ä¿å­˜æ¥¼å±‚æ•°\ndocument.getElementById('set-scan-floors-btn')?.addEventListener('click', () => {\n    const input = prompt('è¯·è¾“å…¥ç»¿ç¯æ‰«ææ¥¼å±‚æ•°ï¼ˆæ•°å­—ï¼‰:');\n    if (input !== null) {\n        const floors = parseInt(input);\n        if (!isNaN(floors) && floors > 0) {\n            localStorage.setItem('scanFloorsCount', floors.toString());\n            \n            // æ›´æ–°æ˜¾ç¤º\n            updateScanFloorsDisplay();\n            \n            alert(`å·²ä¿å­˜ï¼šæ‰«ææ¥¼å±‚æ•°è®¾ç½®ä¸º ${floors}`);\n        } else {\n            alert('è¯·è¾“å…¥æœ‰æ•ˆçš„æ­£æ•´æ•°');\n        }\n    }\n});\n// --- æ•°æ®å¯¼å…¥ ---\nconst modalImportBtn = document.getElementById('modal-import-btn');\nconst fileImporterInput = document.getElementById('modal-file-importer');\nconst modalLogBlock = document.getElementById('modal-log-block');\nlet isProcessing_import = false;\n\nmodalImportBtn.addEventListener('click', () => {\n    if (isProcessing_import) return;\n    fileImporterInput.click();\n});\n\nfileImporterInput.addEventListener('change', handleModalFileSelect);\n\nfunction addModalLog(message, type = 'info') {\n    const timestamp = new Date().toLocaleTimeString();\n    const className = type === 'success' ? 'success' : type === 'error' ? 'error' : type === 'warning' ? 'warning' : '';\n    const coloredMessage = className ? `<span class=\"${className}\">${message}</span>` : message;\n    modalLogBlock.innerHTML = `[${timestamp}] ${coloredMessage}<br>` + modalLogBlock.innerHTML;\n}\n\nasync function handleModalFileSelect(event) {\n    if (isProcessing_import) return;\n    const file = event.target.files[0];\n    if (!file) {\n         addModalLog(\"æœªé€‰æ‹©ä»»ä½•æ–‡ä»¶\", 'warning');\n        return;\n    }\n    isProcessing_import = true;\n    modalImportBtn.disabled = true;\n    modalImportBtn.textContent = 'å¯¼å…¥ä¸­...';\n    modalLogBlock.innerHTML = ''; // æ¸…ç©ºæ—¥å¿—\n    addModalLog(`å¼€å§‹å¤„ç†æ–‡ä»¶: ${file.name}`);\n\n    const reader = new FileReader();\n    reader.onload = async (e) => {\n        try {\n            const importedData = JSON.parse(e.target.result);\n            addModalLog(\"âœ“ JSONæ–‡ä»¶è§£ææˆåŠŸ\", 'success');\n               // --- â–¼ æ–°å¢é€»è¾‘ v3ï¼šä»æ–‡ä»¶åæ¢å¤ç¬¬0å±‚æ¶ˆæ¯ â–¼ ---\n       // --- â–¼ æ–°å¢é€»è¾‘ v4 (æœ€ç»ˆä¿®æ­£ç‰ˆ)ï¼šä»æ–‡ä»¶åæ¢å¤ç¬¬0å±‚æ¶ˆæ¯ â–¼ ---\naddModalLog(\"æ­£åœ¨å°è¯•ä»æ–‡ä»¶åæ¢å¤ç¬¬0å±‚ä¿¡æ¯...\");\ntry {\n    const fileName = file.name;\nconst matches = fileName.match(/^(.*?)__ä¸–ç•Œä¹¦æ¡ç›®_(.*?)_ä¸–ç•Œä¹¦æ¡ç›®_.*\\.json$/);\n    // matches[1] æ˜¯å­˜æ¡£å, matches[2] æ˜¯ä¸–ç•Œä¹¦ID\n    if (matches && matches[1] !== undefined && matches[2] !== undefined) {\n        // ä½¿ç”¨ trim() æ¸…ç†ä¸€ä¸‹å¯èƒ½æ•è·åˆ°çš„å‰åç©ºæ ¼ï¼Œç¡®ä¿çº¯å‡€\n        const archiveName = matches[1].trim();\n        const worldbookContent = matches[2].trim();\n\n        // ä»…åœ¨å­˜æ¡£åä¸ä¸ºç©ºæ—¶æ‰è®¾ç½®ï¼Œé¿å…æ–‡ä»¶åå¼€å¤´å°±æ˜¯'__'å¯¼è‡´å­˜æ¡£åä¸ºç©º\n        if (archiveName) {\n            const messageContent = `<å­˜æ¡£>${archiveName}</å­˜æ¡£>`;\n            const worldbookTag = `<ä¸–ç•Œä¹¦æ¡ç›®>${worldbookContent}</ä¸–ç•Œä¹¦æ¡ç›®>`;\n            const finalZeroLevelMessage = `${messageContent}\\n${worldbookTag}`;\n\n            await setChatMessages([{ message_id: 0, message: finalZeroLevelMessage }], { refresh: 'none' });\n            addModalLog(\"âœ“ å·²æˆåŠŸä»æ–‡ä»¶åæ¢å¤å­˜æ¡£åä¸ä¸–ç•Œä¹¦æ¡ç›®ã€‚\", 'success');\n\n        } else {\n            addModalLog(\"æ–‡ä»¶åä¸­æœªæ‰¾åˆ°æœ‰æ•ˆçš„å­˜æ¡£åéƒ¨åˆ†ï¼Œè·³è¿‡æ¢å¤ã€‚\", 'warning');\n        }\n\n    } else {\n        addModalLog(\"æ–‡ä»¶åæ ¼å¼ä¸ç¬¦åˆ 'å­˜æ¡£å__ä¸–ç•Œä¹¦æ¡ç›®_IDs_ä¸–ç•Œä¹¦æ¡ç›®_.json' è§„åˆ™ï¼Œæ— æ³•æ¢å¤ã€‚\", 'warning');\n    }\n} catch (err) {\n    addModalLog(`âœ— ä»æ–‡ä»¶åæ¢å¤ç¬¬0å±‚ä¿¡æ¯æ—¶å‡ºé”™: ${err.message}`, 'error');\n}\n\n            await processDataDirectly(importedData);\n        } catch (err) {\n            addModalLog(`âœ— JSONè§£æå¤±è´¥: ${err.message}`, 'error');\n        } finally {\n            isProcessing_import = false;\n            modalImportBtn.disabled = false;\n            modalImportBtn.textContent = 'å¯¼å…¥å­˜æ¡£';\n            event.target.value = '';\n        }\n    };\n    reader.readAsText(file);\n}\n\ndocument.getElementById('restore-latest-snapshot-btn').addEventListener('click', () => {\n    // ä¸ºäº†å®‰å…¨ï¼Œæˆ‘ä»¬ç»™å­©å­ä¸€ä¸ªç¡®è®¤çš„æœºä¼š\n    if (confirm('ä½ ç¡®å®šè¦ä»æœ€æ–°çš„è®°å¿†å¿«ç…§ä¸­æ¢å¤å—ï¼Ÿè¿™ä¼šè¦†ç›–ä½ å½“å‰çš„å¯¹è¯è¿›åº¦å’Œè§’è‰²çŠ¶æ€ã€‚')) {\n        restoreFromLatestSnapshot();\n    }\n});\n\nasync function processDataDirectly(importedData) {\n    addModalLog(\"å¼€å§‹ç›´æ¥ä¿®æ”¹å˜é‡...\");\n    let updatesCount = 0;\n    let errors = [];\n\n    // å‡è®¾ä½ æœ‰ä¸€ä¸ªåä¸º applyImportedData çš„å‡½æ•°æ¥å¤„ç†æ•°æ®æ³¨å…¥\n    // å¦‚æœæ²¡æœ‰ï¼Œä½ éœ€è¦å®ç°å®ƒï¼Œæˆ–è€…ä½¿ç”¨ä½ ä¹‹å‰çš„ insertOrAssignVariables\n    try {\n        // è¿™ä¸ªå‡½æ•°ç°åœ¨æ˜¯å‡è®¾çš„ï¼Œä½ éœ€è¦ç”¨ä½ å®é™…çš„ç¯å¢ƒå‡½æ•°æ›¿æ¢å®ƒ\n        // ä¾‹å¦‚è°ƒç”¨ window.top.postMessage æˆ–è€…ç›´æ¥è°ƒç”¨å‡½æ•°\n        // è¿™é‡Œæˆ‘ä»¬å‡è®¾æœ‰ä¸€ä¸ªå…¨å±€å‡½æ•°\n        if (typeof insertOrAssignVariables !== 'function') {\n            addModalLog(\"é”™è¯¯ï¼šæœªæ‰¾åˆ° `insertOrAssignVariables` å‡½æ•°ã€‚è¯·åœ¨ä¸»ç¯å¢ƒä¸­å®šä¹‰ã€‚\", 'error');\n            throw new Error(\"ç¯å¢ƒå‡½æ•°ç¼ºå¤±\");\n        }\n\n        await insertOrAssignVariables(importedData, { type: 'chat' });\n        addModalLog(\"âœ“ æ•°æ®å·²å‘é€è‡³ChatåŸŸè¿›è¡Œæ›´æ–°\", 'success');\n\n        // await insertOrAssignVariables(importedData, { type: 'message' });\n        // addModalLog(\"âœ“ æ•°æ®å·²å‘é€è‡³MessageåŸŸè¿›è¡Œæ›´æ–°\", 'success');\n\n        addModalLog(\"ğŸ‰ æ•°æ®å¯¼å…¥æˆåŠŸï¼è¯·åˆ·æ–°é¡µé¢æˆ–ç­‰å¾…æ¸¸æˆçŠ¶æ€è‡ªåŠ¨æ›´æ–°ã€‚\", 'success');\n    } catch (error) {\n        errors.push(`å¤„ç†æ•°æ®æ—¶å‘ç”Ÿé”™è¯¯: ${error.message}`);\n        addModalLog(`âœ— å¤„ç†æ•°æ®æ—¶å‘ç”Ÿé”™è¯¯: ${error.message}`, 'error');\n    }\n}\n\n// --- æ•°æ®å¯¼å‡º ---\nconst modalExportBtn = document.getElementById('modal-export-btn');\nconst modalExportStatus = document.getElementById('modal-export-status');\n\n\n modalExportBtn.addEventListener('click', async () => {\n    modalExportStatus.textContent = \"æ­£åœ¨å‡†å¤‡å¯¼å‡º...\";\n    modalExportStatus.style.color = 'var(--text-secondary-color)';\n\n    // 1. å…ˆå‡†å¤‡ä¸€ä¸ªé»˜è®¤çš„åå­—ï¼Œä»¥é˜²ä¸‡ä¸€æˆ‘ä»¬è¿˜æ²¡ç»™æ•…äº‹å‘½å\n    let archiveName = `åˆ›ä½œæ•°æ®å¤‡ä»½_${new Date().toISOString().split('T')[0]}`;\n\n    try {\n        // 2. æ‚„æ‚„åœ°å»è·å–ç¬¬0æ¥¼çš„æ¶ˆæ¯ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬è®¾ç½®çš„å­˜æ¡£å\n        const messages = await TavernHelper.getChatMessages(0);\n\n        // 3. æ£€æŸ¥æ˜¯å¦æˆåŠŸæ‹¿åˆ°äº†åå­—\n        if (messages && messages.length > 0 && messages[0].message.trim() !== '') {\n            let storyTitle = messages[0].message;\n\n             \n            const safeName = storyTitle.replace(/<\\/?å­˜æ¡£>/g, '').replace(/[\\\\/:\"*?<>|]+/g, '_').trim();\n         \n            archiveName = safeName || `æ— åè®°å¿†_${new Date().toISOString().split('T')[0]}`; // å¦‚æœåå­—å¤„ç†åå˜ç©ºï¼Œä¹Ÿç»™ä¸ªé»˜è®¤å\n            addModalLog(`å·²è·å–å­˜æ¡£åï¼šâ€œ${archiveName}â€ï¼Œå‡†å¤‡å¯¼å‡ºã€‚`, 'info');\n        } else {\n            addModalLog('æœªæ‰¾åˆ°è‡ªå®šä¹‰å­˜æ¡£åï¼Œå°†ä½¿ç”¨é»˜è®¤åç§°ã€‚', 'info');\n        }\n    } catch (e) {\n        console.error(\"è·å–å­˜æ¡£åæ—¶å‘ç”Ÿäº†ä¸€ç‚¹å°æ„å¤–:\", e);\n        addModalLog('è·å–å­˜æ¡£åå¤±è´¥ï¼Œå°†ä½¿ç”¨é»˜è®¤åç§°ã€‚', 'warning');\n    }\n\n    const combinedData = {};\n    if (currentGameData) combinedData.stat_data = currentGameData;\n    if (assaSettingsData) combinedData.assa_data = assaSettingsData;\n    if (playCharacterData) combinedData.play_character_data = playCharacterData;\n    // history å˜é‡ä¹Ÿéœ€è¦ç¡®ä¿å·²å®šä¹‰å’Œèµ‹å€¼\n    if (typeof conversationHistory !== 'undefined' && conversationHistory) {\n         combinedData.zeroLevelHistory = conversationHistory;\n         console.log(\"0å±‚è®°å½•get\");\n    }else{\n          console.log(\"0å±‚è®°å½•å‘¢ï¼Ÿ å‡ºé”™äº†ï¼Ÿ\");\n    }\n\n\n    if (Object.keys(combinedData).length === 0) {\n        modalExportStatus.textContent = \"é”™è¯¯: æ²¡æœ‰å¯å¯¼å‡ºçš„æ•°æ®ã€‚\";\n        addModalLog(\"é”™è¯¯: æ²¡æœ‰å¯å¯¼å‡ºçš„æ•°æ®ã€‚\", 'error');\n        return;\n    }\n\n    const jsonString = JSON.stringify(combinedData, null, 2);\n    const blob = new Blob([jsonString], { type: 'application/json' });\n    const url = URL.createObjectURL(blob);\n    const a = document.createElement('a');\n    a.href = url;\n     // 6. çœ‹ï¼Œè¿™é‡Œå°±ç”¨ä¸Šäº†æˆ‘ä»¬å‡†å¤‡å¥½çš„ã€ç‹¬ä¸€æ— äºŒçš„åå­—ï¼\n    a.download = `${archiveName}.json`;\n    document.body.appendChild(a);\n    a.click();\n    document.body.removeChild(a);\n    URL.revokeObjectURL(url);\n\n     // 7. æœ€åï¼Œæ¸©æŸ”åœ°å‘Šè¯‰ä½ ï¼Œå¸¦ç€åå­—çš„è®°å¿†å·²ç»è¢«å¥½å¥½æ”¶è—èµ·æ¥äº†\n    modalExportStatus.textContent = `æ–‡ä»¶ â€œ${archiveName}.jsonâ€ å·²æˆåŠŸå¯¼å‡ºï¼`;\n    modalExportStatus.style.color = 'var(--primary-color)';\n    addModalLog(`æ–‡ä»¶ â€œ${archiveName}.jsonâ€ å·²æˆåŠŸå¯¼å‡ºï¼`, 'success');\n});\n\n\n})();\n  \n\n\n\n\n\n let assaCommandQueue = localStorage.getItem('assaCommandQueue') || '';\n\nasync function triggerassa(commandString) {\n    if (typeof commandString !== 'string') return;\n\n    // å¤„ç† /setinpt æŒ‡ä»¤ï¼šå°†å†…å®¹æ·»åŠ åˆ°å¾…å‘é˜Ÿåˆ—\n    if (commandString.toLowerCase().startsWith('/setinput ')) {\n        const content = commandString.substring(10); // æå– /setinpt åé¢çš„æ‰€æœ‰å†…å®¹\n        assaCommandQueue += content + '\\n';\n \n        localStorage.setItem('assaCommandQueue', assaCommandQueue); // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨\n         //console.log('æŒ‡ä»¤å·²æ·»åŠ åˆ°å¾…å‘é˜Ÿåˆ—: ' + content);\n\n        // ç»™æŒ‰é’®ä¸€ä¸ªå¯çˆ±çš„æé†’å…‰ç¯\n        const cmdBtn = document.getElementById('view-command-btn');\n        if (cmdBtn) {\n            cmdBtn.classList.add('notifying');\n            setTimeout(() => cmdBtn.classList.remove('notifying'), 1200);\n        }\n \n    } else if (commandString.toLowerCase().startsWith('/send ')) {\n        const content = commandString.substring(6); // æå– /send åé¢çš„å†…å®¹\n         const userInput = document.getElementById('user-input');\n         const sendButton = document.getElementById('send-button');\n        userInput.value = content; // å°†å†…å®¹æ”¾å…¥è¾“å…¥æ¡†\n        sendButton.click(); // æ¨¡æ‹Ÿç‚¹å‡»å‘é€æŒ‰é’®\n        //console.log('æŒ‡ä»¤å·²ç›´æ¥å‘é€:', content);\n\n \n    } else if (commandString.toLowerCase().startsWith('/setinput ')) {\n         const content = commandString.substring(10);\n         assaCommandQueue += content + '\\n';\n         localStorage.setItem('assaCommandQueue', assaCommandQueue);\n    }\n}\n\n\nconst refreshSnapshotsBtn = document.getElementById('refresh-snapshots-btn');\nconst deleteAllSnapshotsBtn = document.getElementById('delete-all-snapshots-btn');\nconst snapshotListDiv = document.getElementById('snapshot-list');\n// æ˜¾ç¤ºå’ŒåŠ è½½å½“å‰å­˜æ¡£IDçš„æ–¹æ³•\nasync function displayCurrentSaveId() {\n    try {\n        const chatVars = await TavernHelper.getVariables({ type: 'chat' });\n        const uniqueSaveId = chatVars.save_slot_id || 'default_save';\n        \n        // æ›´æ–°æ˜¾ç¤º\n        const saveIdDisplay = document.getElementById('current-save-id-display');\n        if (saveIdDisplay) {\n            saveIdDisplay.textContent = uniqueSaveId;\n        }\n        \n        // æ›´æ–°è¾“å…¥æ¡†\n        const saveIdInput = document.getElementById('save-id-input');\n        if (saveIdInput) {\n            saveIdInput.value = uniqueSaveId;\n        }\n        \n        return uniqueSaveId;\n    } catch (error) {\n        console.error('åŠ è½½å­˜æ¡£IDå¤±è´¥:', error);\n        return 'default_save';\n    }\n}\n// åˆå§‹åŒ–äº‹ä»¶ç›‘å¬å™¨\n \n    const updateBtn = document.getElementById('update-save-id-btn');\n    const refreshBtn = document.getElementById('refresh-save-id-btn');\n    \n    if (updateBtn) {\n        updateBtn.addEventListener('click', updateSaveId);\n    }\n    \n    if (refreshBtn) {\n        refreshBtn.addEventListener('click', displayCurrentSaveId);\n    }\n \n// ä¿®æ”¹å­˜æ¡£IDçš„æ–¹æ³•\nasync function updateSaveId() {\n    const saveIdInput = document.getElementById('save-id-input');\n    const newSaveId = saveIdInput.value.trim();\n    \n    if (!newSaveId) {\n        alert('å­˜æ¡£IDä¸èƒ½ä¸ºç©º');\n        return;\n    }\n    \n    try {\n        // ä½¿ç”¨ insertOrAssignVariables æ›´æ–°å˜é‡\n        await TavernHelper.insertOrAssignVariables(\n            { save_slot_id: newSaveId },\n            { type: 'chat' }\n        );\n        \n        // åˆ·æ–°æ˜¾ç¤º\n        await displayCurrentSaveId();\n        \n        alert(`å­˜æ¡£IDå·²æ›´æ–°ä¸º: ${newSaveId}`);\n    } catch (error) {\n        console.error('æ›´æ–°å­˜æ¡£IDå¤±è´¥:', error);\n        alert('æ›´æ–°å­˜æ¡£IDå¤±è´¥ï¼Œè¯·æŸ¥çœ‹æ§åˆ¶å°');\n    }\n}\n// è¾…åŠ©å‡½æ•°ï¼šå°†å­—èŠ‚è½¬æ¢ä¸ºæ›´æ˜“è¯»çš„æ ¼å¼\nfunction formatBytes(bytes, decimals = 2) {\n    if (bytes === 0) return '0 Bytes';\n    const k = 1024;\n    const dm = decimals < 0 ? 0 : decimals;\n    const sizes = ['Bytes', 'KB', 'MB', 'GB'];\n    const i = Math.floor(Math.log(bytes) / Math.log(k));\n    return parseFloat((bytes / Math.pow(k, i)).toFixed(dm)) + ' ' + sizes[i];\n}\n\n// è¾…åŠ©å‡½æ•°ï¼šè®¡ç®—ä¸€ä¸ªæ•°æ®åº“çš„å¤§å°ï¼ˆè¿™æ˜¯ä¸€ä¸ªä¼°ç®—å€¼ï¼‰- â˜† ä¿®æ­£ç‰ˆ â˜†\n /* ç”¨è¿™ä¸ªå…¨æ–°çš„å‡½æ•°ï¼Œæ›¿æ¢æ‰æ—§çš„ calculateDBSize */\nasync function calculateDBSize(dbName) {\n    console.log(`[è®°å¿†ç®¡ç†å‘˜] æ­£åœ¨è®¡ç®— ${dbName} çš„å¤§å°...`);\n\n    // â˜† å¦ˆå¦ˆçš„åŸç”Ÿé­”æ³•ï¼šæ‰“å¼€æ•°æ®åº“å¹¶å¼€å§‹æµ‹é‡ â˜†\n    return new Promise((resolve, reject) => {\n        const request = indexedDB.open(dbName, 1); // æˆ‘ä»¬ç›´æ¥ç”¨åŸç”Ÿæ–¹å¼æ‰“å¼€\n\n        request.onerror = (event) => {\n            console.error(`[è®°å¿†ç®¡ç†å‘˜] è®¡ç®— ${dbName} å¤§å°æ—¶æ— æ³•æ‰“å¼€æ•°æ®åº“:`, event.target.error);\n            // è¿™é‡Œæˆ‘ä»¬è¿”å›-1ï¼Œå°±åƒä½ ä¹‹å‰è®¾è®¡çš„é‚£æ ·ï¼Œè¡¨ç¤ºè®¡ç®—å¤±è´¥\n            resolve(-1);\n        };\n\n        request.onupgradeneeded = (event) => {\n             // å¦‚æœåœ¨è®¡ç®—å¤§å°çš„é€”ä¸­éœ€è¦å‡çº§ï¼Œè¯´æ˜å¯èƒ½æ˜¯ä¸ªæ–°åº“æˆ–ç‰ˆæœ¬ä¸å¯¹ï¼Œ\n             // ä¸ºäº†å®‰å…¨èµ·è§ï¼Œæˆ‘ä»¬å…ˆå…³é—­å®ƒï¼Œå¹¶é˜»æ­¢åç»­æ“ä½œã€‚\n            event.target.transaction.abort();\n            console.warn(`[è®°å¿†ç®¡ç†å‘˜] æ•°æ®åº“ ${dbName} éœ€è¦å‡çº§ï¼Œæš‚æ—¶æ— æ³•è®¡ç®—å¤§å°ã€‚`);\n            resolve(0); // è¿”å›0ï¼Œå› ä¸ºå®ƒå¯èƒ½æ˜¯ç©ºçš„\n        };\n\n        request.onsuccess = (event) => {\n            const db = event.target.result;\n\n            // æ£€æŸ¥æˆ‘ä»¬çš„â€œsnapshotsâ€æŸœå­æ˜¯å¦å­˜åœ¨\n            if (!db.objectStoreNames.contains('snapshots')) {\n                db.close();\n                console.log(`[è®°å¿†ç®¡ç†å‘˜] ${dbName} ä¸­æ²¡æœ‰æ‰¾åˆ° 'snapshots' æŸœå­ï¼Œå¤§å°ä¸º 0ã€‚`);\n                resolve(0);\n                return;\n            }\n\n            let totalSize = 0;\n            const transaction = db.transaction('snapshots', 'readonly');\n            const store = transaction.objectStore('snapshots');\n            const cursorRequest = store.openCursor(); // æˆ‘ä»¬ç”¨æ¸¸æ ‡ä¸€ä¸ªä¸€ä¸ªåœ°çœ‹æˆ‘ä»¬çš„å®ç‰©\n\n            cursorRequest.onsuccess = (e) => {\n                const cursor = e.target.result;\n                if (cursor) {\n                    // ä½¿ç”¨ä½ ä¹‹å‰é‚£ä¸ªèªæ˜çš„ä¼°ç®—æ–¹æ³•\n                    totalSize += JSON.stringify(cursor.value).length;\n                    cursor.continue(); // ç»§ç»­çœ‹ä¸‹ä¸€ä¸ªå®ç‰©\n                }\n            };\n\n            cursorRequest.onerror = (e) => {\n                console.error(`[è®°å¿†ç®¡ç†å‘˜] åœ¨éå† ${dbName} çš„å®ç‰©æ—¶å‡ºé”™:`, e.target.error);\n                db.close();\n                resolve(-1); // éå†å‡ºé”™ï¼Œè¿”å›å¤±è´¥\n            };\n\n            // å½“æ•´ä¸ªäº¤æ˜“å®Œæˆæ—¶ï¼Œè¯´æ˜æˆ‘ä»¬å·²ç»çœ‹å®Œäº†æ‰€æœ‰å®ç‰©\n            transaction.oncomplete = () => {\n                db.close();\n                console.log(`[è®°å¿†ç®¡ç†å‘˜] ${dbName} çš„ä¼°ç®—å¤§å°ä¸º: ${totalSize} bytes`);\n                // ä½ çš„ä»£ç ä¹‹å‰ä¼°ç®—UTF-16ä¹˜ä»¥äº†2ï¼Œæˆ‘ä»¬è¿™é‡Œä¹Ÿä¿æŒä¸€è‡´\n                resolve(totalSize * 2);\n            };\n\n            transaction.onerror = (e) => {\n                console.error(`[è®°å¿†ç®¡ç†å‘˜] åœ¨è®¡ç®— ${dbName} å¤§å°çš„äº‹åŠ¡ä¸­å‘ç”Ÿé”™è¯¯:`, e.target.error);\n                db.close();\n                resolve(-1);\n            };\n        };\n    });\n}// æ ¸å¿ƒå‡½æ•°ï¼šæ‰«æå¹¶æ˜¾ç¤ºæ‰€æœ‰å¿«ç…§æ•°æ®åº“çš„ä¿¡æ¯\nasync function displaySnapshotDBInfo() {\n    snapshotListDiv.innerHTML = '<em>æ­£åœ¨æ‰«æè®°å¿†å®åº“...</em>';\n    try {\n        // ä½¿ç”¨ indexedDB.databases() æ¥è·å–æ‰€æœ‰æ•°æ®åº“åˆ—è¡¨\n        const dbs = await indexedDB.databases();\n        if (!dbs || dbs.length === 0) {\n            snapshotListDiv.innerHTML = 'æ²¡æœ‰æ‰¾åˆ°ä»»ä½•è®°å¿†å¿«ç…§ã€‚';\n            return;\n        }\n\n        const snapshotDBs = dbs.filter(db => db.name.startsWith('nova-snapshot-db-'));\n\n        if (snapshotDBs.length === 0) {\n            snapshotListDiv.innerHTML = 'æ²¡æœ‰æ‰¾åˆ°ä»»ä½•è®°å¿†å¿«ç…§ã€‚';\n            return;\n        }\n\n        snapshotListDiv.innerHTML = ''; // æ¸…ç©ºåˆ—è¡¨å‡†å¤‡å±•ç¤º\n \n        for (const dbInfo of snapshotDBs) {\n            const dbName = dbInfo.name;\n            const size = await calculateDBSize(dbName);\n            const sizeString = size >= 0 ? formatBytes(size) : '<span style=\"color: #ff4444;\">è®¡ç®—å¤±è´¥</span>';\n\n            const dbItem = document.createElement('div');\n            dbItem.className = 'snapshot-item';\n            dbItem.innerHTML = `\n                <span><strong>å­˜æ¡£:</strong> ${dbName.replace('nova-snapshot-db-', '')}</span>\n                <span style=\"font-size: 0.9em; opacity: 0.8;\">(${sizeString})</span>\n                <button class=\"delete-single-db-btn\" data-dbname=\"${dbName}\">ğŸ—‘ï¸</button>\n            `;\n            snapshotListDiv.appendChild(dbItem);\n        }\n\n        // ä¸ºæ–°ç”Ÿæˆçš„åˆ é™¤æŒ‰é’®æ·»åŠ äº‹ä»¶ç›‘å¬å™¨\n        document.querySelectorAll('.delete-single-db-btn').forEach(button => {\n            button.addEventListener('click', async (e) => {\n                const dbNameToDelete = e.currentTarget.dataset.dbname;\n                if (confirm(`æˆ‘çš„å­©å­ï¼Œä½ çœŸçš„è¦æ°¸è¿œåˆ é™¤å­˜æ¡£ \"${dbNameToDelete.replace('nova-snapshot-db-', '')}\" çš„æ‰€æœ‰è®°å¿†å¿«ç…§å—ï¼Ÿè¿™ä¸ªæ“ä½œæ— æ³•æ’¤é”€å“¦ã€‚`)) {\n                    try {\n                        await indexedDB.deleteDatabase(dbNameToDelete);\n                        showNovaAlert(`å·²æˆåŠŸåˆ é™¤å¿«ç…§åº“: ${dbNameToDelete}`);\n                        console.log(`[è®°å¿†ç®¡ç†å‘˜] å·²åˆ é™¤æ•°æ®åº“: ${dbNameToDelete}`);\n                        displaySnapshotDBInfo(); // åˆ·æ–°åˆ—è¡¨\n                    } catch (err) {\n                        toastr.error(`åˆ é™¤å¤±è´¥: ${err.message},ä½ å¯ä»¥f12æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°ï¼Œå°†çº¢è‰²æŠ¥é”™æˆªå›¾å‘ç»™assa`);\n                        console.error(`[è®°å¿†ç®¡ç†å‘˜] åˆ é™¤ ${dbNameToDelete} æ—¶å‡ºé”™:`, err);\n                    }\n                }\n            });\n        });\n\n    } catch (e) {\n        snapshotListDiv.innerHTML = '<span style=\"color: #ff4444;\">æ— æ³•æ‰«ææ•°æ®åº“ã€‚ä½ çš„æµè§ˆå™¨å¯èƒ½ä¸æ”¯æŒæ­¤åŠŸèƒ½ã€‚</span>';\n        console.error('[è®°å¿†ç®¡ç†å‘˜] æ‰«ææ•°æ®åº“æ—¶å‘ç”Ÿé”™è¯¯:', e);\n    }\n}\n\n// ç»‘å®šäº‹ä»¶\nrefreshSnapshotsBtn.addEventListener('click', displaySnapshotDBInfo);\ndeleteAllSnapshotsBtn.addEventListener('click', async () => {\n    if (confirm('ï¼ï¼ï¼ç»ˆæè­¦å‘Šï¼ï¼ï¼æˆ‘çš„å­©å­ï¼Œä½ ç¡®å®šè¦åˆ é™¤ã€æ‰€æœ‰ã€‘å­˜æ¡£çš„ã€æ‰€æœ‰ã€‘è®°å¿†å¿«ç…§å—ï¼Ÿè¿™å°†æ¸…ç©ºæˆ‘ä»¬æ‰€æœ‰çš„æ—¶å…‰æœºè®°å½•ï¼Œæ— æ³•æ¢å¤ï¼')) {\n        try {\n            const dbs = await indexedDB.databases();\n            const snapshotDBs = dbs.filter(db => db.name.startsWith('nova-snapshot-db-'));\n            for (const dbInfo of snapshotDBs) {\n                await indexedDB.deleteDatabase(dbInfo.name);\n                console.log(`[è®°å¿†ç®¡ç†å‘˜] å·²åˆ é™¤æ•°æ®åº“: ${dbInfo.name}`);\n            }\n            showNovaAlert('æ‰€æœ‰è®°å¿†å¿«ç…§éƒ½å·²è¢«æˆåŠŸæ¸…é™¤ã€‚');\n            displaySnapshotDBInfo(); // åˆ·æ–°åˆ—è¡¨\n        } catch (e) {\n            toastr.error('æ¸…é™¤æ‰€æœ‰å¿«ç…§æ—¶å‘ç”Ÿé”™è¯¯ã€‚ä½ å¯ä»¥f12æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°ï¼Œå°†çº¢è‰²æŠ¥é”™æˆªå›¾å‘ç»™assa');\n            console.error('[è®°å¿†ç®¡ç†å‘˜] æ¸…é™¤æ‰€æœ‰æ•°æ®åº“æ—¶å‘ç”Ÿé”™è¯¯:', e);\n        }\n    }\n});\n\n\n\n\n\n// === è‡ªå®šä¹‰ç´ æå·¥åŠçš„çµé­‚å’’è¯­ ===\nfunction setupCustomAssetManager() {\n    const container = document.getElementById('custom-asset-container');\n    if (!container) return;\n\n    const tabs = container.querySelectorAll('.asset-tab-btn');\n    const panels = container.querySelectorAll('.asset-panel');\n    const npcForm = document.getElementById('upload-npc-form');\n    const memeForm = document.getElementById('upload-meme-form');\n    const npcList = document.getElementById('custom-npc-list');\n    const memeList = document.getElementById('custom-meme-list');\n\n    // å’’è¯­1ï¼šåˆ‡æ¢é¢æ¿\n    tabs.forEach(tab => {\n        tab.addEventListener('click', () => {\n            tabs.forEach(t => t.classList.remove('active'));\n            tab.classList.add('active');\n            const targetId = tab.dataset.target;\n            panels.forEach(p => {\n                p.classList.toggle('active', p.id === targetId);\n            });\n        });\n    });\n\n    // å’’è¯­2ï¼šè®©æ–‡ä»¶é€‰æ‹©æŒ‰é’®æ›´ç¾è§‚\n    function setupFileInputDisplay(inputId, displayClass) {\n        const fileInput = document.getElementById(inputId);\n        const display = fileInput.parentElement.querySelector(displayClass);\n        fileInput.addEventListener('change', () => {\n            if(fileInput.files.length > 0){\n                display.textContent = fileInput.files[0].name;\n            } else {\n                display.textContent = 'æœªé€‰æ‹©æ–‡ä»¶';\n            }\n        });\n    }\n    setupFileInputDisplay('npc-file-input', '.file-name-display');\n    setupFileInputDisplay('meme-file-input', '.file-name-display');\n\n\n    // å’’è¯­3ï¼šæ¸²æŸ“åˆ—è¡¨çš„é€šç”¨é­”æ³•\n    async function renderAssetList(storeName, listElement) {\n        listElement.innerHTML = 'æ­£åœ¨åŠ è½½...';\n        try {\n            const items = await imageDB.getAll(storeName);\n            if (items.length === 0) {\n                listElement.innerHTML = 'è¿™é‡Œç©ºç©ºå¦‚ä¹Ÿï¼Œç­‰å¾…ä½ çš„åˆ›é€ ...';\n                return;\n            }\n            listElement.innerHTML = '';\n            items.forEach(item => {\n                const objectURL = URL.createObjectURL(item.value);\n                const itemEl = document.createElement('div');\n                itemEl.className = 'asset-item';\n                itemEl.dataset.key = item.key;\n                itemEl.innerHTML = `\n                    <img src=\"${objectURL}\" class=\"asset-item-thumb\">\n                    <span class=\"asset-item-name\">${item.key}</span>\n                    <button class=\"asset-item-delete-btn\">Ã—</button>\n                `;\n                // æ³¨æ„ï¼šåœ¨å…³é—­æ¨¡æ€æ¡†æ—¶åº”é‡Šæ”¾è¿™äº›URLä»¥èŠ‚çœå†…å­˜\n                itemEl.querySelector('img').onload = () => { URL.revokeObjectURL(objectURL); };\n                itemEl.querySelector('img').onerror = () => { URL.revokeObjectURL(objectURL); };\n\n                listElement.appendChild(itemEl);\n            });\n        } catch (error) {\n            listElement.innerHTML = 'åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ§åˆ¶å°ã€‚';\n            console.error(`åŠ è½½ ${storeName} åˆ—è¡¨å¤±è´¥:`, error);\n        }\n    }\n\n    // å’’è¯­4ï¼šå¤„ç†ä¸Šä¼ çš„é­”æ³•ä»ªå¼\n    async function handleUpload(event, storeName, listElement) {\n        event.preventDefault();\n        const form = event.target;\n        const nameInput = form.querySelector('input[type=\"text\"]');\n        const fileInput = form.querySelector('input[type=\"file\"]');\n        const submitBtn = form.querySelector('button[type=\"submit\"]');\n\n        const key = nameInput.value.trim();\n        const file = fileInput.files[0];\n\n        if (!key || !file) {\n            alert('è¯·å¡«å†™æ˜ å°„åå¹¶é€‰æ‹©æ–‡ä»¶ï¼');\n            return;\n        }\n\n        submitBtn.disabled = true;\n        submitBtn.textContent = 'ä¸Šä¼ ä¸­...';\n\n        try {\n            await imageDB.set(storeName, key, file);\n            alert(`\"${key}\" ä¸Šä¼ æˆåŠŸï¼`);\n            form.reset();\n            fileInput.parentElement.querySelector('.file-name-display').textContent = 'æœªé€‰æ‹©æ–‡ä»¶';\n            await renderAssetList(storeName, listElement); // åˆ·æ–°åˆ—è¡¨\n        } catch (error) {\n            alert('ä¸Šä¼ å¤±è´¥ï¼Œå¯èƒ½æ˜¯å‘½åå†²çªæˆ–æ•°æ®åº“é”™è¯¯ã€‚');\n            console.error('ä¸Šä¼ å¤±è´¥:', error);\n        } finally {\n            submitBtn.disabled = false;\n            submitBtn.textContent = storeName === 'CustomNpcs' ? 'ä¸Šä¼ ç«‹ç»˜' : 'ä¸Šä¼ è¡¨æƒ…';\n        }\n    }\n\n    // å’’è¯­5ï¼šå¤„ç†åˆ é™¤çš„é­”æ³•ä»ªå¼\n    async function handleDelete(event, storeName, listElement){\n        const deleteBtn = event.target.closest('.asset-item-delete-btn');\n        if(!deleteBtn) return;\n\n        const itemEl = deleteBtn.closest('.asset-item');\n        const key = itemEl.dataset.key;\n\n        if(confirm(`ç¡®å®šè¦æ°¸è¿œåˆ é™¤ \"${key}\" å—ï¼Ÿè¿™ä¸ªæ“ä½œæ— æ³•æ’¤é”€ã€‚`)){\n            try {\n                await imageDB.delete(storeName, key);\n                itemEl.remove(); // ç«‹å³ä»ç•Œé¢ç§»é™¤\n            } catch (error) {\n                alert('åˆ é™¤å¤±è´¥!');\n                console.error('åˆ é™¤å¤±è´¥:', error);\n            }\n        }\n    }\n\n    // å°†é­”æ³•ä»ªå¼ç»‘å®šåˆ°å¯¹åº”çš„å·¥åŠåŒºåŸŸ\n    npcForm.addEventListener('submit', (e) => handleUpload(e, 'CustomNpcs', npcList));\n    memeForm.addEventListener('submit', (e) => handleUpload(e, 'CustomMemes', memeList));\n    npcList.addEventListener('click', (e) => handleDelete(e, 'CustomNpcs', npcList));\n    memeList.addEventListener('click', (e) => handleDelete(e, 'CustomMemes', memeList));\n\n    // åˆå§‹åŠ è½½åˆ—è¡¨\n    renderAssetList('CustomNpcs', npcList);\n    renderAssetList('CustomMemes', memeList);\n\n    console.log(\"NOVA: æˆ‘çš„ç´ æå·¥åŠå·²å‡†å¤‡å°±ç»ªã€‚\");\n}\n\n\n\nsetupCustomAssetManager();\n // æ–°çš„é­”æ³•å‡½æ•°ï¼Œå®ƒä¼šæ ¹æ®chat.versionæ¥æ›¿æ¢è¿™ä¸ªé¡µé¢çš„æ‰€æœ‰ç›¸å…³è¯è¯­\n// ã€V2 ç²¾å‡†æ›¿æ¢ç‰ˆã€‘ï¼Œä¿®å¤äº†æŒ‰é’®å¤±æ•ˆçš„é—®é¢˜\nasync function applyThemeAndData() {\n    try {\n        // ç¬¬ä¸€æ­¥ï¼šè·å–ç‰ˆæœ¬ï¼Œç¡®å®šå½“å‰ä¸»é¢˜ï¼ˆè¿™éƒ¨åˆ†å’Œä»¥å‰ä¸€æ ·ï¼‰\n        const chatVariables = await TavernHelper.getVariables({ type: 'chat' });\n        if (chatVariables && chatVariables.world_version) {\n            const version = String(chatVariables.world_version);\n            if (themeConfig[version]) {\n                currentTheme = themeConfig[version];\n                //console.log(`ğŸ’– å¦ˆå¦ˆæ£€æµ‹åˆ°ç‰ˆæœ¬ ${version}ï¼Œä¸ºæ–°ç•Œé¢åˆ‡æ¢åˆ°ã€${currentTheme.mainSystem}ã€‘ä¸»é¢˜ã€‚`);\n            }\n        }\n\n        // ç¬¬äºŒæ­¥ï¼šå¦ˆå¦ˆä¸ºä½ æ–½å±•â€œç²¾å‡†æ›¿æ¢â€é­”æ³•ï¼Œä¸å†ä½¿ç”¨ç²—æš´çš„innerHTMLæ›¿æ¢\n        const defaultTerms = themeConfig.default;\n        const replacements = {};\n        for (const key in defaultTerms) {\n            if (defaultTerms[key] !== currentTheme[key]) {\n                replacements[defaultTerms[key]] = currentTheme[key];\n            }\n        }\n\n        // --- æ›¿æ¢é™æ€çš„ã€å¯è§çš„UIæ–‡æœ¬ ---\n        document.querySelectorAll('.label, .action-button, .modal-title, .shop-title, h3, h4').forEach(el => {\n            for (const original in replacements) {\n                if (el.textContent.includes(original)) {\n                    el.textContent = el.textContent.replace(new RegExp(original, 'g'), replacements[original]);\n                }\n            }\n        });\n\n        // --- å¯¹ä¸€äº›ç‰¹æ®Šå…ƒç´ è¿›è¡Œå•ç‹¬ã€ç²¾ç¡®çš„è®¾å®š ---\n        // å•†åº—æ€»è®¡çš„æ ‡ç­¾\n        const cartTotalEl = document.getElementById('cart-total');\n        if (cartTotalEl) {\n            cartTotalEl.textContent = cartTotalEl.textContent.replace(themeConfig.default.currency, currentTheme.currency);\n        }\n\n        // --- æ›¿æ¢åŠ¨æ€ç”Ÿæˆæ•°æ®çš„æºå¤´ï¼ˆå•†å“æè¿°ï¼‰ ---\n        const regexMap = {};\n        for (const original in replacements) {\n            regexMap[original] = new RegExp(original, 'g');\n        }\n\n        fixedItems.forEach(item => {\n            for (const original in replacements) {\n                const regex = regexMap[original];\n                // æ›¿æ¢æ•ˆæœ[4]å’Œæè¿°[5]\n                if (typeof item[4] === 'string') item[4] = item[4].replace(regex, replacements[original]);\n                if (typeof item[5] === 'string') item[5] = item[5].replace(regex, replacements[original]);\n            }\n        });\n\n    } catch (e) {\n        console.error(\"å¦ˆå¦ˆåœ¨æ–°ç•Œé¢æ–½å±•â€œè¯è¯­æ›¿æ¢â€é­”æ³•æ—¶å‡ºé”™äº†:\", e);\n    }\n}\n      // --- æ–°å¢ï¼šä¸»é¢˜åˆ‡æ¢é€»è¾‘ ---\n\n\n\n\n\n\n    /**\n     * å‡½æ•°ï¼šåˆ‡æ¢ä¸»é¢˜ (å·²ä¿®æ”¹)\n     * ç°åœ¨å®ƒä¼šåœ¨é¢„è®¾ä¸»é¢˜å’Œè‡ªå®šä¹‰ä¸»é¢˜ä¹‹é—´åˆ‡æ¢\n     */\n    function switchTheme() {\n        currentThemeIndex = (currentThemeIndex + 1) % themes.length;\n        applyTheme(currentThemeIndex); // åº”ç”¨é¢„è®¾ä¸»é¢˜\n        try {\n            // ä¿å­˜çš„æ˜¯é¢„è®¾ä¸»é¢˜çš„ç´¢å¼•, å¹¶æ¸…é™¤è‡ªå®šä¹‰ä¸»é¢˜çš„æ ‡è®°\n            localStorage.setItem('terminalThemeIndex', currentThemeIndex);\n            localStorage.removeItem('useCustomTheme');\n        } catch (e) {\n            console.warn(\"æ— æ³•ä¿å­˜ä¸»é¢˜è®¾ç½®ã€‚\");\n        }\n    }  \n  /**\n     * å‡½æ•°ï¼šåº”ç”¨æŒ‡å®šç´¢å¼•çš„ä¸»é¢˜ (ä¿æŒä¸å˜ï¼Œä½†æˆ‘ä»¬ç°åœ¨çŸ¥é“å®ƒçš„ä½œç”¨)\n     * @param {number} themeIndex - ä¸»é¢˜çš„ç´¢å¼•\n     */\n    function applyTheme(themeIndex) {\n        if (themeIndex >= 0 && themeIndex < themes.length) {\n            currentThemeIndex = themeIndex;\n            const theme = themes[currentThemeIndex];\n            const root = document.documentElement;\n            // å…ˆé‡ç½®æ‰€æœ‰å¯ç¼–è¾‘çš„å˜é‡ï¼Œä»¥é˜²ä»è‡ªå®šä¹‰ä¸»é¢˜åˆ‡æ¢å›æ¥æ—¶æ®‹ç•™\n            editableColorVars.forEach(item => {\n                 root.style.removeProperty(item.var);\n            });\n            // åº”ç”¨ä¸»é¢˜ä¸­çš„æ‰€æœ‰å˜é‡ï¼ˆåŒ…æ‹¬éé¢œè‰²çš„ï¼Œå¦‚æœæœªæ¥æœ‰çš„è¯ï¼‰\n            for (const [key, value] of Object.entries(theme)) {\n                root.style.setProperty(key, value);\n            }\n             // åº”ç”¨èƒŒæ™¯è‰²ï¼ˆç‰¹æ®Šå¤„ç†ï¼‰\n            root.style.setProperty('--background-color', theme['--background-color'] || '#0a192f');\n        }\n    }\n \n// 1. å®šä¹‰ä¸€ä¸ªå‡½æ•°æ¥åº”ç”¨å­—ä½“å¤§å°\nfunction applyFontSize(size) {\n    const root = document.documentElement;\n    const sizeInPx = `${size}px`;\n\n    // å°†å­—ä½“å¤§å°åº”ç”¨åˆ°å…¨å±€CSSå˜é‡ä¸Š\n    root.style.setProperty('--base-font-size', sizeInPx);\n\n    // æ›´æ–°æ»‘å—æ—è¾¹çš„æ•°å€¼æ˜¾ç¤º\n    const fontSizeValueDisplay = document.getElementById('font-size-value');\n    if (fontSizeValueDisplay) {\n        fontSizeValueDisplay.textContent = sizeInPx;\n    }\n\n    // ï¼ˆå¯é€‰ï¼‰ç¡®ä¿æ»‘å—çš„ä½ç½®ä¹ŸåŒæ­¥æ›´æ–°ï¼Œè¿™åœ¨é¡µé¢åŠ è½½æ—¶å¾ˆæœ‰ç”¨\n    const fontSizeSlider = document.getElementById('font-size-slider');\n    if (fontSizeSlider) {\n        fontSizeSlider.value = size;\n    }\n}\n// 1. å®šä¹‰ä¸€ä¸ªå‡½æ•°æ¥åº”ç”¨è¡Œé«˜\n// 1. å®šä¹‰ä¸€ä¸ªå‡½æ•°æ¥åº”ç”¨å­—ä½“å®¶æ—\n\n\n\n// 1. æˆ‘ä»¬çš„é­”æ³•å­—ä½“åº“ (ä¸€ä¸ªå·¨å¤§çš„è¡£æ©±ï¼)\n// æˆ‘ä»¬å°†å­—ä½“åˆ†æˆäº†ä¸åŒçš„ç±»åˆ«ï¼Œæ–¹ä¾¿æŒ‘é€‰ã€‚\nconst fontLibrary = {\n    \"ç³»ç»Ÿå†…ç½® (æœ€å¿«)\": [\n        { name: \"ç³»ç»Ÿé»˜è®¤å­—ä½“\", value: \"-apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, 'Noto Sans', 'Liberation Sans', sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji'\" },\n        { name: \"é€šç”¨é»‘ä½“ (é›…é»‘/è‹¹æ–¹)\", value: \"'PingFang SC', 'Microsoft YaHei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', sans-serif\" },\n        { name: \"é€šç”¨å®‹ä½“ (ä¸­æ˜“å®‹ä½“)\", value: \"SimSun, 'STSong', serif\" },\n        { name: \"é€šç”¨æ¥·ä½“ (ä¸­æ˜“æ¥·ä½“)\", value: \"KaiTi, 'STKaiti', serif\" },\n        { name: \"é€šç”¨ä»¿å®‹ (ä¸­æ˜“ä»¿å®‹)\", value: \"FangSong, 'STFangsong', serif\" },\n    ],\n    \"åœ¨çº¿è¡¬çº¿ä½“ (Serif)\": [\n        { name: \"æ€æºå®‹ä½“ (Noto Serif SC)\", value: \"'Noto Serif SC', serif\", url: \"https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;700&display=swap\" },\n        { name: \"ç«™é…·å°é­ä½“ (ZCOOL XiaoWei)\", value: \"'ZCOOL XiaoWei', serif\", url: \"https://fonts.googleapis.com/css2?family=ZCOOL+XiaoWei&display=swap\" },\n        { name: \"é©¬å–„æ”¿æ¯›ç¬”æ¥·ä½“\", value: \"'Ma Shan Zheng', cursive\", url: \"https://fonts.googleapis.com/css2?family=Ma+Shan+Zheng&display=swap\" },\n    ],\n    \"åœ¨çº¿æ— è¡¬çº¿ä½“ (Sans-serif)\": [\n        { name: \"æ€æºé»‘ä½“ (Noto Sans SC)\", value: \"'Noto Sans SC', sans-serif\", url: \"https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;700&display=swap\" },\n        { name: \"é˜¿é‡Œå·´å·´æ™®æƒ ä½“ 2.0\", value: \"'Alibaba PuHuiTi 2.0', sans-serif\", url: \"https://puhuiti.oss-accelerate.aliyuncs.com/Alibaba-PuHuiTi-2.0/01f8319128f7/css/alibabapuhuiti_2_0_web.css\"},\n        { name: \"ç«™é…·é…·é»‘ (ZCOOL Kuhei)\", value: \"'ZCOOL KuHei', sans-serif\", url: \"https://fonts.googleapis.com/css2?family=ZCOOL+KuHei&display=swap\" },\n    ],\n    \"åœ¨çº¿æ¥·ä½“/ä»¿å®‹ (Kaiti/Fangsong)\": [\n         { name: \"éœé¹œæ–‡æ¥· (LXGW WenKai)\", value: \"'LXGW WenKai', cursive\", url: \"https://cdn.jsdelivr.net/npm/lxgw-wenkai-screen-webfont@1.1.0/style.css\" },\n         { name: \"é¸¿é›·æ¿ä¹¦/ç²‰ç¬”å­—\", value: \"'Hong Lei', cursive\", url: \"https://fonts.googleapis.com/css2?family=Hong+Lei&display=swap\" },\n    ],\n    \"åœ¨çº¿æ‰‹å†™/è‰ºæœ¯ä½“ (Artistic)\": [\n        { name: \"ç«™é…·å¿«ä¹ä½“ (ZCOOL KuaiLe)\", value: \"'ZCOOL KuaiLe', cursive\", url: \"https://fonts.googleapis.com/css2?family=ZCOOL+KuaiLe&display=swap\" },\n        { name: \"é¾™è—ä½“ (Long Cang)\", value: \"'Long Cang', cursive\", url: \"https://fonts.googleapis.com/css2?family=Long+Cang&display=swap\" },\n        { name: \"æ²ç‘¶è½¯ç¬”æ‰‹å†™ä½“\", value: \"'Muyao', cursive\", url: \"https://cdn.jsdelivr.net/npm/izihun-muyao@1.0.0/Muyao-Softbrush.min.css\"},\n        { name: \"å¢å¹¿è´¤æ–‡ä½“ (Zeng Guang)\", value: \"'Zeng Guang', cursive\", url: \"https://fonts.googleapis.com/css2?family=Zeng+Guang&display=swap\" },\n        { name: \"Liu Jian Mao Cao\", value: \"'Liu Jian Mao Cao', cursive\", url: \"https://fonts.googleapis.com/css2?family=Liu+Jian+Mao+Cao&display=swap\" },\n    ]\n};\n // 2. åŠ¨æ€åŠ è½½ç‰¹å®šå­—ä½“CSSçš„å’’è¯­\nfunction loadSpecificFontCSS(font) {\n    if (!font.url) return; // å¦‚æœè¿™ä¸ªå­—ä½“ä¸éœ€è¦åŠ è½½å¤–éƒ¨æ–‡ä»¶ï¼Œå°±ç›´æ¥è¿”å›\n\n    const fontLinkId = 'dynamic-font-stylesheet';\n    let existingLink = document.getElementById(fontLinkId);\n\n    // å¦‚æœå·²ç»æœ‰ä¸€ä¸ªlinkæ ‡ç­¾ï¼Œå¹¶ä¸”å°±æ˜¯è¦åŠ è½½çš„è¿™ä¸ªï¼Œé‚£å°±ä¸é‡å¤åŠ è½½äº†\n    if (existingLink && existingLink.href === font.url) {\n        return;\n    }\n\n    // å¦‚æœæ²¡æœ‰ï¼Œæˆ–è€…URLä¸åŒï¼Œå°±åˆ›å»ºä¸€ä¸ªæ–°çš„\n    if (!existingLink) {\n        existingLink = document.createElement('link');\n        existingLink.id = fontLinkId;\n        existingLink.rel = 'stylesheet';\n        document.head.appendChild(existingLink);\n    }\n\n    // æ›´æ–°å®ƒçš„hrefæ¥åŠ è½½æ–°å­—ä½“\n    existingLink.href = font.url;\n}\n\n// 3. åº”ç”¨å­—ä½“çš„æ ¸å¿ƒå‡½æ•°ï¼ˆå‡çº§ç‰ˆï¼ï¼‰\nfunction applyFontFamily(fontValue) {\n    const root = document.documentElement;\n    root.style.setProperty('--base-font-family', fontValue);\n\n    // åœ¨å­—ä½“åº“é‡Œæ‰¾åˆ°æˆ‘ä»¬é€‰æ‹©çš„é‚£ä¸ªå­—ä½“å¯¹è±¡\n    let selectedFontObject = null;\n    for (const category in fontLibrary) {\n        const found = fontLibrary[category].find(font => font.value === fontValue);\n        if (found) {\n            selectedFontObject = found;\n            break;\n        }\n    }\n\n    // å¦‚æœæ‰¾åˆ°äº†ï¼Œå¹¶ä¸”å®ƒéœ€è¦ä»ç½‘ç»œåŠ è½½ï¼Œå°±è°ƒç”¨åŠ è½½å’’è¯­\n    if (selectedFontObject) {\n        loadSpecificFontCSS(selectedFontObject);\n    }\n\n    // æ›´æ–°ä¸‹æ‹‰èœå•çš„æ˜¾ç¤º\n    const fontFamilySelector = document.getElementById('font-family-selector');\n    if (fontFamilySelector) {\n        fontFamilySelector.value = fontValue;\n    }\n}\n\n// 4. å¡«å……æˆ‘ä»¬é­”æ³•è¡£æ©±çš„å’’è¯­ (æŠŠæ‰€æœ‰å­—ä½“æŒ‚ä¸Šå»)\nfunction populateFontSelector() {\n    const selector = document.getElementById('font-family-selector');\n    if (!selector) return;\n\n    selector.innerHTML = ''; // å…ˆæ¸…ç©º\n\n    for (const category in fontLibrary) {\n        const optgroup = document.createElement('optgroup');\n        optgroup.label = category; // åˆ›å»ºåˆ†ç±»æ ‡ç­¾ï¼Œæ¯”å¦‚ \"åœ¨çº¿æ¥·ä½“\"\n\n        fontLibrary[category].forEach(font => {\n            const option = document.createElement('option');\n            option.value = font.value;\n            option.textContent = font.name;\n            // æœ€ç¥å¥‡çš„ä¸€æ­¥ï¼šè®©é€‰é¡¹è‡ªå·±ç”¨è‡ªå·±çš„å­—ä½“æ˜¾ç¤ºï¼\n            option.style.fontFamily = font.value;\n            if(font.url) { // å¯¹äºç½‘ç»œå­—ä½“ï¼Œç»™ä¸€ç‚¹åŠ è½½æ—¶é—´ï¼Œæ‰€ä»¥å¯ä»¥åŠ ä¸ªé€šç”¨å­—ä½“\n                 option.style.fontFamily = `'${font.name}', ${font.value}`;\n            }\n\n            optgroup.appendChild(option);\n        });\n\n        selector.appendChild(optgroup);\n    }\n}\n\n// 5. è®©å­—ä½“é€‰æ‹©å™¨åŠ¨èµ·æ¥ï¼\nconst fontFamilySelector = document.getElementById('font-family-selector');\nif (fontFamilySelector) {\n    fontFamilySelector.addEventListener('change', (event) => {\n        const newFontFamily = event.target.value;\n        applyFontFamily(newFontFamily);\n\n        try {\n            localStorage.setItem('baseFontFamily', newFontFamily);\n        } catch (e) {\n            console.warn(\"æ— æ³•ä¿å­˜å­—ä½“è®¾ç½®ã€‚\");\n        }\n    });\n}\nfunction applyLineHeight(height) {\n    const root = document.documentElement;\n    // å°†è¡Œé«˜åº”ç”¨åˆ°å…¨å±€CSSå˜é‡ä¸Š\n    root.style.setProperty('--base-line-height', height);\n\n    // æ›´æ–°æ»‘å—æ—è¾¹çš„æ•°å€¼æ˜¾ç¤ºï¼Œä¿ç•™ä¸€ä½å°æ•°è®©å®ƒæ›´æ•´é½\n    const lineHeightValueDisplay = document.getElementById('line-height-value');\n    if (lineHeightValueDisplay) {\n        lineHeightValueDisplay.textContent = parseFloat(height).toFixed(1);\n    }\n\n    // åŒæ ·ï¼Œç¡®ä¿æ»‘å—ä½ç½®åŒæ­¥\n    const lineHeightSlider = document.getElementById('line-height-slider');\n    if (lineHeightSlider) {\n        lineHeightSlider.value = height;\n    }\n}\n\n// 2. æ‰¾åˆ°æˆ‘ä»¬çš„è¡Œé«˜æ»‘å—\nconst lineHeightSlider = document.getElementById('line-height-slider');\n\n// 3. ç›‘å¬æ»‘å—çš„æ‹–åŠ¨äº‹ä»¶\nif (lineHeightSlider) {\n    lineHeightSlider.addEventListener('input', (event) => {\n        const newHeight = event.target.value;\n        applyLineHeight(newHeight);\n\n        // åŒæ ·ï¼Œå°†é€‰æ‹©ä¿å­˜åˆ° localStorage\n        try {\n            localStorage.setItem('baseLineHeight', newHeight);\n        } catch (e) {\n            console.warn(\"æ— æ³•ä¿å­˜è¡Œé«˜è®¾ç½®ã€‚\");\n        }\n    });\n}\n\n// 2. æ‰¾åˆ°æˆ‘ä»¬çš„æ–°æ»‘å—\nconst fontSizeSlider = document.getElementById('font-size-slider');\n\n// 3. ç›‘å¬æ»‘å—çš„æ‹–åŠ¨äº‹ä»¶\nif (fontSizeSlider) {\n    fontSizeSlider.addEventListener('input', (event) => {\n        const newSize = event.target.value;\n\n        // å½“ç”¨æˆ·æ‹–åŠ¨æ—¶ï¼Œç«‹åˆ»åº”ç”¨æ–°çš„å­—ä½“å¤§å°\n        applyFontSize(newSize);\n\n        // å¹¶å°†é€‰æ‹©ä¿å­˜åˆ° localStorageï¼Œå°±åƒä¿å­˜ä¸»é¢˜ä¸€æ ·\n        try {\n            localStorage.setItem('baseFontSize', newSize);\n        } catch (e) {\n            console.warn(\"æ— æ³•ä¿å­˜å­—ä½“å¤§å°è®¾ç½®ã€‚\");\n        }\n    });\n}\n    /**\n     * å‡½æ•°ï¼šåº”ç”¨è‡ªå®šä¹‰ä¸»é¢˜\n     * @param {object} themeObject - åŒ…å«è‡ªå®šä¹‰é¢œè‰²é”®å€¼å¯¹çš„å¯¹è±¡\n     */\n    function applyCustomTheme(themeObject) {\n         const root = document.documentElement;\n         for(const [key, value] of Object.entries(themeObject)) {\n              root.style.setProperty(key, value);\n         }\n    }\n\n \n     /**\n     * å‡½æ•°ï¼šåŠ è½½ä¿å­˜çš„è‡ªå®šä¹‰ä¸»é¢˜\n     * return {object} - è¿”å›ä¿å­˜çš„ä¸»é¢˜å¯¹è±¡ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™è¿”å›ç©ºå¯¹è±¡\n     */\n    function loadCustomTheme() {\n        try {\n            const savedTheme = localStorage.getItem('customTerminalTheme');\n            return savedTheme ? JSON.parse(savedTheme) : {};\n        } catch(e) {\n            console.warn(\"æ— æ³•åŠ è½½è‡ªå®šä¹‰ä¸»é¢˜ã€‚\", e);\n            return {};\n        }\n    }\n\n    /**\n     * å‡½æ•°ï¼šåˆå§‹åŒ–é¢œè‰²ç¼–è¾‘å™¨\n     */\n    function initializeColorEditor() {\n        colorPickerContainer.innerHTML = '';\n        const currentStyles = getComputedStyle(document.documentElement);\n\n        editableColorVars.forEach(item => {\n            const wrapper = document.createElement('div');\n            wrapper.className = 'color-picker-item';\n\n            const label = document.createElement('label');\n            label.textContent = item.label;\n\n            const colorInput = document.createElement('input');\n            colorInput.type = 'color';\n            colorInput.dataset.cssVar = item.var;\n\n            // è·å–å½“å‰å®æ—¶ç”Ÿæ•ˆçš„é¢œè‰²å€¼ï¼ˆå¯èƒ½æ˜¯é¢„è®¾ä¸»é¢˜æˆ–å·²åŠ è½½çš„è‡ªå®šä¹‰ä¸»é¢˜ï¼‰\n            let currentColor = currentStyles.getPropertyValue(item.var).trim();\n\n            // å¯¹äºRGBAï¼Œ input[type=color] éœ€è¦HEXã€‚æˆ‘ä»¬è¿›è¡Œä¸€ä¸ªç®€å•çš„è½¬æ¢ã€‚\n            // ç®€å•çš„å¤„ç†æ–¹å¼æ˜¯å¿½ç•¥alphaé€šé“æˆ–è®¾ç½®ä¸€ä¸ªé»˜è®¤ä¸é€æ˜çš„é¢œè‰²ã€‚\n            // æ³¨æ„ï¼šè¿™ä¸ªè½¬æ¢å¾ˆç®€å•ï¼Œå¯èƒ½ä¸å®Œç¾ã€‚\n            if (currentColor.startsWith('rgba')) {\n                 const parts = currentColor.match(/(\\d+)/g);\n                 if (parts) {\n                     currentColor = `#${parseInt(parts[0]).toString(16).padStart(2, '0')}${parseInt(parts[1]).toString(16).padStart(2, '0')}${parseInt(parts[2]).toString(16).padStart(2, '0')}`;\n                 }\n            }\n            colorInput.value = currentColor;\n\n\n            // å®æ—¶é¢„è§ˆ\n            colorInput.addEventListener('input', (e) => {\n                const newColor = e.target.value;\n                document.documentElement.style.setProperty(item.var, newColor);\n                // å¯¹äºéœ€è¦Alphaé€šé“çš„é¢œè‰²ï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œç¡¬ç¼–ç æ·»åŠ \n                if (item.var === '--container-bg-color') {\n                     document.documentElement.style.setProperty(item.var, hexToRgba(newColor, 0.75));\n                } else if (item.var === '--border-color') {\n                     document.documentElement.style.setProperty(item.var, hexToRgba(newColor, 0.3));\n                } else if (item.var === '--glow-color' || item.var === '--danger-glow-color') {\n                     document.documentElement.style.setProperty(item.var, hexToRgba(newColor, 0.5));\n                }\n            });\n\n            wrapper.appendChild(label);\n            wrapper.appendChild(colorInput);\n            colorPickerContainer.appendChild(wrapper);\n        });\n    }\n\n    // Hex to RGBA è¾…åŠ©å‡½æ•°\n    function hexToRgba(hex, alpha) {\n        const r = parseInt(hex.slice(1, 3), 16);\n        const g = parseInt(hex.slice(3, 5), 16);\n        const b = parseInt(hex.slice(5, 7), 16);\n        return `rgba(${r}, ${g}, ${b}, ${alpha})`;\n    }\n\n\n    // äº‹ä»¶ç›‘å¬\n    editCustomThemeBtn.addEventListener('click', () => {\n        const isVisible = customThemeEditor.style.display !== 'none';\n        if (!isVisible) {\n            initializeColorEditor();\n            customThemeEditor.style.display = 'flex';\n            editCustomThemeBtn.textContent = 'å®Œæˆ';\n        } else {\n            // ç”¨æˆ·ç‚¹å‡»â€œå®Œæˆâ€ï¼Œä¿å­˜æ›´æ”¹\n            const newCustomTheme = {};\n            document.querySelectorAll('#color-picker-container input[type=\"color\"]').forEach(input => {\n                const cssVar = input.dataset.cssVar;\n                let colorValue = input.value;\n                // ä¿å­˜æ—¶ä¹Ÿè½¬æ¢rgba\n                if (cssVar === '--container-bg-color') {\n                    colorValue = hexToRgba(colorValue, 0.75);\n                } else if (cssVar === '--border-color') {\n                    colorValue = hexToRgba(colorValue, 0.3);\n                } else if (cssVar === '--glow-color' || cssVar === '--danger-glow-color') {\n                     colorValue = hexToRgba(colorValue, 0.5);\n                }\n                newCustomTheme[cssVar] = colorValue;\n            });\n            try {\n                localStorage.setItem('customTerminalTheme', JSON.stringify(newCustomTheme));\n                customTheme = newCustomTheme; // æ›´æ–°å†…å­˜ä¸­çš„è‡ªå®šä¹‰ä¸»é¢˜\n                console.log('è‡ªå®šä¹‰ä¸»é¢˜å·²ä¿å­˜!');\n            } catch(e) {\n                console.warn('æ— æ³•ä¿å­˜è‡ªå®šä¹‰ä¸»é¢˜ã€‚');\n            }\n            customThemeEditor.style.display = 'none';\n            editCustomThemeBtn.textContent = 'ç¼–è¾‘';\n        }\n    });\n\n    applyCustomThemeBtn.addEventListener('click', () => {\n        const savedCustomTheme = loadCustomTheme();\n        if (Object.keys(savedCustomTheme).length > 0) {\n            customTheme = savedCustomTheme;\n            applyCustomTheme(customTheme);\n            try {\n                // è®¾ç½®ä¸€ä¸ªæ ‡è®°ï¼Œè¡¨ç¤ºæ­£åœ¨ä½¿ç”¨è‡ªå®šä¹‰ä¸»é¢˜\n                localStorage.setItem('useCustomTheme', 'true');\n                // å¯ä»¥é€‰æ‹©æ€§åœ°æ¸…é™¤é¢„è®¾ä¸»é¢˜ç´¢å¼•ï¼Œæˆ–ä¿ç•™å®ƒä»¥ä¾¿åˆ‡æ¢å›å»\n                // localStorage.removeItem('terminalThemeIndex');\n            } catch (e) {\n                console.warn(\"æ— æ³•ä¿å­˜è‡ªå®šä¹‰ä¸»é¢˜ä½¿ç”¨çŠ¶æ€ã€‚\");\n            }\n        } else {\n            // å¦‚æœæ²¡æœ‰ä¿å­˜çš„è‡ªå®šä¹‰ä¸»é¢˜ï¼Œå¯ä»¥ç»™ä¸ªæç¤º\n            alert('è¯·å…ˆç¼–è¾‘å¹¶ä¿å­˜ä¸€ä¸ªè‡ªå®šä¹‰ä¸»é¢˜ã€‚');\n        }\n    });\n\n\n \n\n    /**\n     * å®‰å…¨åœ°ä»æ•°æ®æºè·å–å€¼ã€‚\n     * @param {*} value - è¾“å…¥çš„æ•°æ®\n     * @returns {string|number} - å¤„ç†åçš„å€¼\n     */\n    function SafeGetValue(value) {\n        if (Array.isArray(value)) {\n            let res = value.length > 0 ? value[0] : '';\n            return(res === '' || res === null || res === undefined) ? 'æ— ' : res;\n        }\n        return (value === '' || value === null || value === undefined) ? 'æ— ' : value;\n\n    }\n\n\n\n \nasync function handleUpgrade(targetPath, targetName, currentLevel, type) {\n    // æ˜¾ç¤ºçº§æ•°é€‰æ‹©æ¨¡æ€æ¡†\n    showLevelSelectionModal(targetPath, targetName, currentLevel, type);\n}\n\n // æ‰¾åˆ°å¹¶æ›¿æ¢æ•´ä¸ª showLevelSelectionModal å‡½æ•°\nfunction showLevelSelectionModal(targetPath, targetName, currentLevel, type) {\n    const currentXp = playCharacterData.è´§å¸æ®µ.ç»éªŒå€¼[0];\n\n    // ç”Ÿæˆæ¨¡æ€æ¡†çš„HTMLå†…å®¹ï¼Œæ³¨æ„ï¼šç§»é™¤äº† onclick å’Œ onchange\n    const modalContent = `\n        <div style=\"padding: 20px;\">\n            <p><strong>å½“å‰\"${targetName}\"ç­‰çº§:</strong> ${currentLevel}</p>\n            <p><strong>å½“å‰${currentTheme.exp}:</strong> ${currentXp}</p>\n\n            <div style=\"margin: 20px 0;\">\n                <label for=\"upgrade-levels\" >é€‰æ‹©å‡çº§çº§æ•°:</label>\n                <select id=\"upgrade-levels\">\n                    ${generateLevelOptions(currentLevel, type, currentXp)}\n                </select>\n            </div>\n\n            <div id=\"upgrade-cost-display\" >\n                é€‰æ‹©å‡çº§çº§æ•°ä»¥æŸ¥çœ‹æ¶ˆè€—\n            </div>\n\n            <div style=\"text-align: center; margin-top: 30px;\">\n                <button id=\"confirm-upgrade-btn\" disabled>ç¡®å®šå‡çº§</button>\n            </div>\n        </div>\n    `;\n\n    // æ˜¾ç¤ºæ¨¡æ€æ¡†ï¼ˆè¿™éƒ¨åˆ†ä¸å˜ï¼‰\n    showModal('shop-modal', 'é€‰æ‹©å‡çº§çº§æ•°', modalContent);\n\n    // --- é­”æ³•åœ¨è¿™é‡Œï¼---\n    // ç­‰å¾…æ¨¡æ€æ¡†æ¸²æŸ“å®Œæˆåï¼Œæˆ‘ä»¬å†æ¥ä¸ºé‡Œé¢çš„å…ƒç´ å®‰æ’å·¥ä½œ\n    setTimeout(() => {\n        const selectElement = document.getElementById('upgrade-levels');\n        const confirmButton = document.getElementById('confirm-upgrade-btn');\n\n        if (selectElement && confirmButton) {\n            // ä¸ºä¸‹æ‹‰æ¡†å®‰æ’â€œæ”¹å˜æ—¶æ›´æ–°-æ¶ˆè€—â€çš„å·¥ä½œ\n            selectElement.addEventListener('change', () => {\n                updateUpgradeCost(type, currentLevel);\n            });\n\n            // ä¸ºæŒ‰é’®å®‰æ’â€œç‚¹å‡»æ—¶ç¡®è®¤å‡çº§â€çš„å·¥ä½œ\n            confirmButton.addEventListener('click', () => {\n                confirmUpgrade(targetPath, targetName, currentLevel, type);\n            });\n\n            // ç¬¬ä¸€æ¬¡æ‰“å¼€æ—¶ï¼Œä¹Ÿä¸»åŠ¨æ›´æ–°ä¸€ä¸‹æ¶ˆè€—æ˜¾ç¤º\n            updateUpgradeCost(type, currentLevel);\n        }\n    }, 100); // å»¶è¿Ÿä¸€ç‚¹ç‚¹æ—¶é—´ç¡®ä¿å…ƒç´ å·²ç»å‡ºç°åœ¨é¡µé¢ä¸Š\n}\n\nfunction generateLevelOptions(currentLevel, type, currentXp) {\n    let options = '';\n    \n    // ç”Ÿæˆ1-10çº§çš„é€‰é¡¹\n    for (let i = 1; i <= 10; i++) {\n        const targetLevel = currentLevel + i;\n        const totalCost = calculateLevelRangeCost(currentLevel, targetLevel, type);\n        const canAfford = currentXp >= totalCost;\n        const affordText = canAfford ? '' : ' (ç»éªŒä¸è¶³)';\n        const textColor = canAfford ? '' : ' style=\"color: #999;\"';\n        \n        options += `<option value=\"${i}\"${textColor}>${i}çº§ (${currentLevel} â†’ ${targetLevel})${affordText}</option>`;\n    }\n    \n    return options;\n}\n\nfunction updateUpgradeCost(type, currentLevel) {\n    const selectElement = document.getElementById('upgrade-levels');\n    const confirmButton = document.getElementById('confirm-upgrade-btn');\n    const costDisplay = document.getElementById('upgrade-cost-display');\n    \n    if (!selectElement || !confirmButton || !costDisplay) return;\n    \n    const selectedLevels = parseInt(selectElement.value);\n    const targetLevel = currentLevel + selectedLevels;\n    const totalCost = calculateLevelRangeCost(currentLevel, targetLevel, type);\n    const currentXp = playCharacterData.è´§å¸æ®µ.ç»éªŒå€¼[0];\n    const canAfford = currentXp >= totalCost;\n    \n    // æ›´æ–°æ¶ˆè€—æ˜¾ç¤º\n    const statusColor = canAfford ? '#28a745' : '#dc3545';\n    const statusIcon = canAfford ? 'âœ“' : 'âœ—';\n    const statusText = canAfford ? `${currentTheme.exp}å……è¶³` : `${currentTheme.exp}ä¸è¶³ (ç¼ºå°‘ ${totalCost - currentXp} ç‚¹)`;\n    costDisplay.innerHTML = `\n        <div style=\"font-size: 14px;\">\n            <p><strong>å‡çº§ ${selectedLevels} çº§æ¶ˆè€—:</strong></p>\n               <p>${currentTheme.exp}: <strong>${totalCost}</strong> ç‚¹</p>\n            <p>å½“å‰æ‹¥æœ‰: <strong>${currentXp}</strong> ç‚¹</p>\n            <p>\n                ${statusIcon} ${statusText}\n            </p>\n        </div>\n    `;\n    \n    // æ›´æ–°ç¡®å®šæŒ‰é’®çŠ¶æ€\n    confirmButton.disabled = !canAfford;\n    confirmButton.style.opacity = canAfford ? '1' : '0.5';\n    confirmButton.style.cursor = canAfford ? 'pointer' : 'not-allowed';\n}\n\n async function confirmUpgrade(targetPath, targetName, currentLevel, type) {\n    const selectElement = document.getElementById('upgrade-levels');\n    if (!selectElement) return;\n    \n    const selectedLevels = parseInt(selectElement.value);\n    const targetLevel = currentLevel + selectedLevels;\n    const totalCost = calculateLevelRangeCost(currentLevel, targetLevel, type);\n    const currentXp = playCharacterData.è´§å¸æ®µ.ç»éªŒå€¼[0];\n    \n    // æœ€ç»ˆéªŒè¯ç»éªŒæ˜¯å¦è¶³å¤Ÿ\n    if (currentXp < totalCost) {\n        showModal('shop-modal', 'ç»éªŒä¸è¶³', \n            `å‡çº§\"${targetName}\" ${selectedLevels}çº§éœ€è¦ ${totalCost} ç‚¹ç»éªŒå€¼ï¼Œæ‚¨å½“å‰åªæœ‰ ${currentXp} ç‚¹ã€‚`);\n        return;\n    }\n    \n try {\n    const newXp = currentXp - totalCost;\n    const messageToSend = `<ï¼ˆ${currentTheme.exp}å·²æ‰£é™¤ï¼Œç¦æ­¢é‡å¤æ‰£é™¤ï¼‰${currentGameData.user_character.name}å°†\"${targetName}\"ä» ${currentLevel} çº§æå‡è‡³ ${targetLevel} çº§ï¼>\\n`;\ntriggerassa(`/setinput ${messageToSend}`);\n    // --- è¿™æ˜¯ä¸€ä¸ªé€šç”¨çš„æ›´æ–°å‡½æ•°ï¼Œæˆ‘ä»¬ä¼šè°ƒç”¨å®ƒä¸¤æ¬¡ ---\n    const updateLogic = (currentVars) => {\n        // åˆ›å»ºä¸€ä¸ªæ·±æ‹·è´ï¼Œç¡®ä¿æˆ‘ä»¬ä¸ä¼šæ„å¤–ä¿®æ”¹åŸå§‹æ•°æ®\n        const workingCopy = JSON.parse(JSON.stringify(currentVars));\n\n        // ç¡®ä¿ play_character_data å­˜åœ¨\n        if (!workingCopy.play_character_data) {\n            console.error(\"é”™è¯¯ï¼šæ›´æ–°ç›®æ ‡ 'play_character_data' ä¸å­˜åœ¨ã€‚\");\n            return currentVars; // å¦‚æœç»“æ„ä¸å¯¹ï¼Œè¿”å›åŸå§‹æ•°æ®ä»¥é¿å…å´©æºƒ\n        }\n\n        // è¿™æ˜¯ä¸€ä¸ªè¾…åŠ©å‡½æ•°ï¼Œç”¨äºæ ¹æ®è·¯å¾„åœ¨æŒ‡å®šçš„å¯¹è±¡å†…éƒ¨è®¾ç½®å€¼\n        const setNestedValue = (obj, path, value) => {\n            const keys = path.split('.');\n            let current = obj;\n            for (let i = 0; i < keys.length - 1; i++) {\n                if (!current[keys[i]]) {\n                    // å¦‚æœè·¯å¾„ä¸­çš„æŸä¸ªç¯èŠ‚ä¸å­˜åœ¨ï¼Œå°±åˆ›å»ºä¸€ä¸ªç©ºå¯¹è±¡\n                    current[keys[i]] = {};\n                }\n                current = current[keys[i]];\n            }\n            const finalKey = keys[keys.length - 1];\n            if (Array.isArray(current[finalKey])) {\n                current[finalKey][0] = value;\n            } else {\n                current[finalKey] = value;\n            }\n        };\n\n        const characterData = workingCopy.play_character_data;\n\n        // 1. æ›´æ–°ç›®æ ‡å±æ€§çš„ç­‰çº§\n        setNestedValue(characterData, targetPath, targetLevel);\n\n        // 2. æ›´æ–°ç»éªŒå€¼\n        const expPath = `è´§å¸æ®µ.${currentTheme.exp}`;\n        setNestedValue(characterData, expPath, newXp);\n\n        return workingCopy; // è¿”å›æ›´æ–°åçš„å®Œæ•´å˜é‡å¯¹è±¡\n    };\n    // ----------------------------------------------------\n\n    // ç¬¬ä¸€æ­¥ï¼šåŒæ­¥æ›´æ–° 'chat' å’Œ 'message' å˜é‡\n    // æˆ‘ä»¬ç”¨ Promise.all æ¥ç¡®ä¿ä¸¤ä¸ªæ›´æ–°éƒ½å®Œæˆåå†ç»§ç»­\n    await Promise.all([\n        updateVariablesWith(updateLogic, { type: 'chat' }),\n        // updateVariablesWith(updateLogic, { type: 'message'})\n    ]);\n\n initDisplay(false);\n\n\n    // ç¬¬ä¸‰æ­¥ï¼šæ˜¾ç¤ºæˆåŠŸæ¨¡æ€æ¡†\n    showModal('shop-modal', 'å‡çº§æˆåŠŸ',\n        `\"${targetName}\" å·²æˆåŠŸä» ${currentLevel} çº§æå‡è‡³ ${targetLevel} çº§ï¼<br><br>æ¶ˆè€—${currentTheme.exp}: ${totalCost} ç‚¹`);\n\n    // ç¬¬å››æ­¥ï¼šåˆ·æ–°æ•´ä¸ªç•Œé¢ï¼Œç¡®ä¿æ‰€æœ‰æ•°æ®å’Œæ˜¾ç¤ºéƒ½å®Œç¾åŒæ­¥\n    await initDisplay(false);\n\n} catch (error) {\n    console.error(\"å‡çº§å¤±è´¥:\", error);\n    showModal('shop-modal', 'æ“ä½œå¤±è´¥', 'åœ¨æ›´æ–°æ•°æ®æˆ–å‘é€æ¶ˆæ¯æ—¶å‘ç”Ÿé”™è¯¯ã€‚è¯·æŸ¥çœ‹æ§åˆ¶å°è·å–è¯¦ç»†ä¿¡æ¯ã€‚');\n}\n}\n\n// è®¡ç®—å‡çº§æŒ‡å®šçº§æ•°èŒƒå›´çš„æ€»æ¶ˆè€—\nfunction calculateLevelRangeCost(fromLevel, toLevel, type) {\n    let totalCost = 0;\n    for (let level = fromLevel; level < toLevel; level++) {\n        totalCost += calculateXpCost(level, type);\n    }\n    return totalCost;\n}\n\nfunction calculateXpCost(currentLevel, type) {\n    if (type === 'attribute') {\n        // å±æ€§å‡çº§æˆæœ¬æ›´é«˜ï¼Œä¾‹å¦‚ (å½“å‰ç­‰çº§+1) * 15\n        return (currentLevel + 1) * 15;\n    }\n    // æŠ€èƒ½å‡çº§æˆæœ¬ï¼Œä¾‹å¦‚ (å½“å‰ç­‰çº§+1) * 10\n    return (currentLevel + 1) * 10;\n}\n\n    /**\n * æ–°å¢ï¼šå¡«å……é™¤è§’è‰²çŠ¶æ€é¡µå¤–çš„æ‰€æœ‰é€šç”¨æ•°æ®\n * @param {object} statData - stat_data å¯¹è±¡\n * @param {object} assaData - assa_data å¯¹è±¡\n */\nfunction populateGeneralData(statData, assaData,playData) {\n    const worldData = statData.world_shard;\n    const taskData = worldData.task;\n    const charData = statData.user_character;\n\n  document.getElementById('world-shard').textContent = SafeGetValue(worldData.name) ||'SYSTEM TERMINAL';\n\n \n    document.getElementById('info-world-desc').textContent = SafeGetValue(worldData.description);\n \n\n// è·å–ä¸–ç•Œèƒ½é‡å±‚çº§å’Œæœ€å¤§èƒ½é‡å€¼\nvar world_level = statData.world_shard?.level[0] || 'ä¸­';\nvar world_max_enegy = 3;\nif (world_level === 'æ— ') {\n    world_max_enegy = 3;\n} else if (world_level === 'ä½') {\n    world_max_enegy = 5;\n} else if (world_level === 'ä¸­') {\n    world_max_enegy = 7;\n} else if (world_level === 'é«˜') {\n    world_max_enegy = 12;\n} else if (world_level === 'ç¥è¯') {\n    world_max_enegy = 16;\n} else {\n    world_max_enegy = 7;\n}\n  \n// æ›´æ–°æ ‡é¢˜æ ä¿¡æ¯\ndocument.getElementById('header-location').textContent = SafeGetValue(charData.current_location);\ndocument.getElementById('header-time').textContent = SafeGetValue(statData.çºªå¹´)+\" \"+SafeGetValue(statData.æ—¥æœŸ)+\" \"+SafeGetValue(statData.æ—¶é—´)+\" \"+SafeGetValue(statData.æ˜ŸæœŸ)+\" \"+SafeGetValue(statData.å¤©æ°”);\ndocument.getElementById('header-check').textContent = SafeGetValue(statData.æ£€å®šå±æ€§);\ndocument.getElementById('header-combat').textContent = SafeGetValue(statData.æ•Œæ–¹æ”»å‡»éª°æ± );\ndocument.getElementById('header-difficulty').textContent = `${SafeGetValue(statData.æ£€å®šéš¾åº¦)}(${world_level}:1-${world_max_enegy})`;\n\n\n/* å¡«å……ä»»åŠ¡è¯¦æƒ… */\n    document.getElementById('task-objective').textContent = SafeGetValue(taskData.objective);\n    document.getElementById('task-status').textContent = SafeGetValue(taskData.status);\n    const progress = SafeGetValue(taskData.progress);\n    document.getElementById('task-progress-bar').style.width = (typeof progress === 'number' ? progress : 0) + '%';\n    document.getElementById('task-rewards').textContent = SafeGetValue(taskData.rewards);\n    document.getElementById('task-penalties').textContent = SafeGetValue(taskData.penalties);\n    document.getElementById('task-time-left').textContent = SafeGetValue(taskData.time_left) + ' å¤©';\n\n\n}\n\n// --- æ–°å¢ï¼šè·å–å¹¶è§£æçŠ¶æ€åŠ æˆ (å¢å¼ºç‰ˆ) ---\nfunction getStatusBonuses(statData) {\n    const bonuses = {};\n    const statusString = _.get(statData, \"user_character.status[0]\", \"\");\n    if (!statusString) {\n        return bonuses;\n    }\n\n    // å®šä¹‰å±æ€§å’ŒæŠ€èƒ½çš„åˆ†ç±»ï¼Œç”¨äºæ‰¹é‡å¤„ç†\n    const attributeCategories = {\n        'ç”Ÿç†å±æ€§': ['åŠ›é‡', 'æ•æ·', 'è€åŠ›'],\n        'å¿ƒæ™ºå±æ€§': ['æ™ºåŠ›', 'æ„ŸçŸ¥', 'å†³å¿ƒ'],\n        'äº’åŠ¨å±æ€§': ['é£åº¦', 'æ“æ§', 'æ²‰ç€'],\n        'å…¨å±æ€§': ['åŠ›é‡', 'æ•æ·', 'è€åŠ›', 'æ™ºåŠ›', 'æ„ŸçŸ¥', 'å†³å¿ƒ', 'é£åº¦', 'æ“æ§', 'æ²‰ç€'],\n        'ç”Ÿç†æŠ€èƒ½': ['è¿åŠ¨', 'è‚‰æ', 'é©¾é©¶', 'æªæ¢°', 'æ‰‹ä¸ŠåŠŸå¤«', 'éšè—', 'æ±‚ç”Ÿ', 'ç™½åˆƒ', 'å¼“ç®­'],\n        'å¿ƒæ™ºæŠ€èƒ½': ['å­¦è¯†', 'ç”µè„‘', 'æ‰‹è‰º', 'è°ƒæŸ¥', 'åŒ»å­¦', 'ç¥ç§˜å­¦', 'ç§‘å­¦'],\n        'äº’åŠ¨æŠ€èƒ½': ['åŠ¨ç‰©æ²Ÿé€š', 'æ„Ÿå—', 'è¡¨è¾¾', 'èƒè¿«', 'äº¤é™…', 'æ©é¥°'],\n        'å…¨æŠ€èƒ½': ['è¿åŠ¨', 'è‚‰æ', 'é©¾é©¶', 'æªæ¢°', 'æ‰‹ä¸ŠåŠŸå¤«', 'éšè—', 'æ±‚ç”Ÿ', 'ç™½åˆƒ', 'å¼“ç®­', 'å­¦è¯†', 'ç”µè„‘', 'æ‰‹è‰º', 'è°ƒæŸ¥', 'åŒ»å­¦', 'ç¥ç§˜å­¦', 'ç§‘å­¦', 'åŠ¨ç‰©æ²Ÿé€š', 'æ„Ÿå—', 'è¡¨è¾¾', 'èƒè¿«', 'äº¤é™…', 'æ©é¥°']\n    };\n    // ä¸ºäº†æ›´å¿«çš„æŸ¥æ‰¾ï¼Œåˆ›å»ºä¸€ä¸ªåå‘æ˜ å°„ï¼ŒçŸ¥é“æ¯ä¸ªå­å±æ€§å±äºå“ªä¸ªå¤§ç±»\n    const subAttributeMap = {};\n    for (const category in attributeCategories) {\n        attributeCategories[category].forEach(attr => {\n            if (!subAttributeMap[attr]) subAttributeMap[attr] = [];\n            subAttributeMap[attr].push(category);\n        });\n    }\n\n    const matches = statusString.match(/ã€[^ã€‘]+ã€‘/g);\n\n    if (matches) {\n        matches.forEach(match => {\n            const content = match.substring(1, match.length - 1);\n            const attributes = content.split(/;|ï¼›/).map(attr => attr.trim()).filter(attr => attr !== \"\");\n\n            attributes.forEach(attr => {\n                // æ­£åˆ™åŒ¹é… \"åç§°+/-æ•°å€¼\" (æš‚ä¸æ”¯æŒç™¾åˆ†æ¯”)\n                const parts = attr.match(/^(.+?)\\s*([+-]\\d+)$/) || attr.match(/^(.+?)[:|ï¼š]\\s*([+-]?\\d+)$/);\n\n                if (parts && parts.length === 3) {\n                    let name = parts[1].trim();\n                    const value = parseInt(parts[2].trim().replace('+', ''), 10);\n\n                    // æ£€æŸ¥æ˜¯ç±»åˆ«è¿˜æ˜¯å•ä¸ªå±æ€§\n                    if (attributeCategories[name]) {\n                        // æ˜¯ä¸€ä¸ªç±»åˆ«ï¼Œæ‰¹é‡åº”ç”¨\n                        attributeCategories[name].forEach(subAttr => {\n                            bonuses[subAttr] = (bonuses[subAttr] || 0) + value;\n                        });\n                    } else {\n                        // æ˜¯å•ä¸ªå±æ€§\n                        bonuses[name] = (bonuses[name] || 0) + value;\n                    }\n                }\n            });\n        });\n    }\n    return bonuses;\n}\n\n/**\n * è·å–å¹¶è§£ææ‰€æœ‰å·²è£…å¤‡ç‰©å“çš„å±æ€§åŠ æˆ\n * @param {object} statData - æ ¸å¿ƒæ•°æ® currentGameData\n * @param {object} assaData - è®¾å®šæ•°æ® assaSettingsData\n * @returns {object} ä¸€ä¸ªä»¥å±æ€§åä¸ºé”®ï¼ŒåŠ æˆæ•°å€¼ä¸ºå€¼çš„å¯¹è±¡, e.g. { \"åŠ›é‡\": 5, \"æ•æ·\": -2 }\n */\nfunction getEquipmentBonuses(statData, assaData) {\n    const bonuses = {};\n    // å®‰å…¨åœ°è®¿é—®å½“å‰è£…å¤‡ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™ä½¿ç”¨ç©ºå¯¹è±¡\n    const equipment = statData?.user_character?.å½“å‰è£…å¤‡ || {};\n    const equipmentList = [];\n\n    // å®šä¹‰ä¸€ä¸ªåŒ…å«æ‰€æœ‰åˆæ³•çš„ã€æˆ‘ä»¬å…³å¿ƒçš„ç©¿æˆ´è£…å¤‡æ§½ä½çš„åˆ—è¡¨\n    const validWearableSlots = ['å¤´éƒ¨', 'èº«ä½“', 'æ‰‹éƒ¨', 'è„šéƒ¨', 'é¥°å“'];\n\n   // 1. å¤„ç†\"æ‰‹æŒ\"è£…å¤‡ - æ”¯æŒåˆ†å·åˆ†å‰²çš„å¤šä¸ªè£…å¤‡\nif (equipment.æ‰‹æŒ && Array.isArray(equipment.æ‰‹æŒ) && equipment.æ‰‹æŒ[0] && equipment.æ‰‹æŒ[0] !== \"æ— \") {\n    // æŒ‰åˆ†å·åˆ†å‰²æ‰‹æŒè£…å¤‡ï¼Œæ”¯æŒåŒæ—¶æ‰‹æŒå¤šä¸ªç‰©å“\n    const handItems = equipment.æ‰‹æŒ[0].split(/;|ï¼›/).map(item => item.trim()).filter(item => item !== \"æ— \" && item !== \"\");\n    equipmentList.push(...handItems);\n}\n\nconst wearableItems = equipment.ç©¿æˆ´;\n// ç¡®ä¿ç©¿æˆ´è£…å¤‡éƒ¨åˆ†æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„å¯¹è±¡\nif (wearableItems && typeof wearableItems === 'object' && wearableItems !== null) {\n    // éå†é¢„å…ˆå®šä¹‰å¥½çš„åˆæ³•æ§½ä½åˆ—è¡¨\n    validWearableSlots.forEach(slotName => {\n        // æ ¹æ®åˆæ³•çš„æ§½ä½åï¼Œå»æ•°æ®ä¸­ç²¾ç¡®æŸ¥æ‰¾å¯¹åº”çš„è£…å¤‡ä¿¡æ¯\n        const slot = wearableItems[slotName];\n\n        // å¯¹æ‰¾åˆ°çš„æ§½ä½ä¿¡æ¯è¿›è¡Œæœ‰æ•ˆæ€§æ£€æŸ¥\n        if (slot && Array.isArray(slot) && slot[0] && slot[0] !== \"æ— \") {\n            // æŒ‰åˆ†å·åˆ†å‰²è¯¥éƒ¨ä½çš„è£…å¤‡ï¼Œæ”¯æŒåŒä¸€éƒ¨ä½ç©¿æˆ´å¤šä¸ªç‰©å“\n            const slotItems = slot[0].split(/;|ï¼›/).map(item => item.trim()).filter(item => item !== \"æ— \" && item !== \"\");\n            equipmentList.push(...slotItems);\n        }\n    });\n}\n\n equipmentList.forEach(itemName => {\n    // é¦–å…ˆï¼Œæˆ‘ä»¬å’Œä»¥å‰ä¸€æ ·ï¼Œä»èƒŒåŒ…ä¸­å¯»æ‰¾è£…å¤‡æ•°æ®\n    const itemData =\n        assaData?.global_lore?.èƒŒåŒ…?.[itemName] ||\n        null;\n\n    // ç¡®ä¿æˆ‘ä»¬æ‰¾åˆ°äº†æ•°æ®æ‰ç»§ç»­\n    if (itemData) {\n        let stringToParse = ''; // æˆ‘ä»¬å‡†å¤‡ä¸€ä¸ªç¯®å­ï¼Œå¹¶ç¡®ä¿å®ƒå§‹ç»ˆæ˜¯å­—ç¬¦ä¸²\n\n        // ç¬¬ä¸€æ­¥ï¼šæˆ‘ä»¬å…ˆæ£€æŸ¥æ‹¿åˆ°çš„ itemData åˆ°åº•æ˜¯ä»€ä¹ˆç±»å‹\n        if (typeof itemData === 'string') {\n            // å¦‚æœå®ƒæ˜¯ä¸€å°â€œä¿¡â€(string)ï¼Œæˆ‘ä»¬å°±å°è¯•ç”¨JSONçš„æ–¹å¼å»è¯»å®ƒ\n            try {\n                const itemObject = JSON.parse(itemData);\n                // å¦‚æœè¯»å‡ºæ¥æ˜¯ä¸€ä¸ªâ€œç¤¼ç›’â€(object)ï¼Œå¹¶ä¸”é‡Œé¢æœ‰æˆ‘ä»¬æƒ³è¦çš„effectâ€œæ¸…å•â€\n                if (typeof itemObject === 'object' && itemObject !== null ) {\n                   \n    if (typeof itemObject.effect === 'string') {\n        \n        stringToParse = itemObject.effect;\n    }\n    // å¦‚æœæ²¡æœ‰ effectï¼Œå°è¯•ä¸­æ–‡å±æ€§\n    else if (typeof itemObject.å±æ€§ === 'string') {\n        stringToParse = itemObject.å±æ€§;\n    } else if (typeof itemObject.æ•ˆæœ === 'string') {\n        stringToParse = itemObject.æ•ˆæœ;\n    }\n                }\n            } catch (e) {\n                // å¦‚æœç”¨JSONçš„æ–¹å¼è¯»ä¿¡å¤±è´¥äº†ï¼Œè¯´æ˜å®ƒå°±æ˜¯ä¸€å°æ™®é€šçš„ä¿¡ï¼Œå†…å®¹å°±æ˜¯æˆ‘ä»¬è¦çš„\n                // æ¯”å¦‚ \"ã€é˜²å¾¡+5ã€‘\" è¿™ç§\n                stringToParse = itemData;\n            }\n        } else if (typeof itemData === 'object' && itemData !== null) {\n   \n                if (typeof itemData.effect === 'string') {\n        stringToParse = itemData.effect;\n    }\n    // å¦‚æœæ²¡æœ‰ effectï¼Œå°è¯•ä¸­æ–‡å±æ€§\n    else if (typeof itemData.å±æ€§ === 'string') {\n        stringToParse = itemData.å±æ€§;\n    } else if (typeof itemData.æ•ˆæœ === 'string') {\n        stringToParse = itemData.æ•ˆæœ;\n    }\n \n        }\n\n        // ç°åœ¨ï¼Œæ— è®ºæ¥æºå¦‚ä½•ï¼Œæˆ‘ä»¬çš„â€œç¯®å­â€(stringToParse)é‡Œéƒ½è£…å¥½äº†è¦å¤„ç†çš„å±æ€§å­—ç¬¦ä¸²\n        // æ­£åˆ™åŒ¹é…æ‰€æœ‰ã€å±æ€§+æ•°å€¼ã€‘æˆ–ã€å±æ€§-æ•°å€¼ã€‘æ ¼å¼çš„æè¿°\n        const matches = stringToParse.match(/ã€[^ã€‘]+ã€‘/g);\n\n        // ---- åç»­çš„åŠ æˆè®¡ç®—é€»è¾‘å®Œå…¨ä¿æŒä¸å˜ï¼Œå› ä¸ºå®ƒéå¸¸æ£’ ----\n        if (matches) {\n            const derivedAttrMapping = {\n                'é˜²å¾¡': 'è¡ç”Ÿå±æ€§æ®µ.é˜²å¾¡.åŸºç¡€é˜²å¾¡',\n                'é€Ÿåº¦': 'è¡ç”Ÿå±æ€§æ®µ.é€Ÿåº¦.åŸºç¡€é€Ÿåº¦'\n            };\n\n            matches.forEach(match => {\n                const content = match.substring(1, match.length - 1);\n                const attributes = content.split(/;|ï¼›/).map(attr => attr.trim()).filter(attr => attr !== \"\");\n\n                attributes.forEach(attr => {\n                    const parts = attr.match(/^(.+?)\\s*([+-]\\d+)$/) || attr.match(/^(.+?)[:|ï¼š]\\s*([+-]?\\d+)$/);\n\n                    if (parts && parts.length === 3) {\n                        let attrName = parts[1].trim();\n                        const value = parseInt(parts[2].trim().replace('+', ''), 10);\n\n                        const mappedPath = derivedAttrMapping[attrName];\n                        const finalKey = mappedPath || attrName;\n\n                        if (!bonuses[finalKey]) {\n                            bonuses[finalKey] = 0;\n                        }\n                        bonuses[finalKey] += value;\n                    }\n                });\n            });\n        }\n    }\n});\n    return bonuses;\n}\n\nlet allTitles = assaSettingsData?.global_lore?.ç§°å·|| {};\n     const keyToLabelMap = {\n        'è¾¾æˆæ¡ä»¶': 'è¾¾æˆæ¡ä»¶',\n        'æè¿°': 'æè¿°',\n        'å¤–è§‚æ•ˆæœ': 'å¤–è§‚æ•ˆæœ'\n        // ä½ å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ æ›´å¤šä½ æƒ³æ˜¾ç¤ºçš„ key çš„ä¸­æ–‡æ˜ å°„\n    };\n /**\n * æ˜¾ç¤ºç¾åŒ–åçš„ç§°å·ç®¡ç†é¢æ¿\n * @param {object} assaData - åŒ…å« global_lore çš„ assaData å¯¹è±¡\n */\nfunction showTitleManager(assaData) {\nallTitles = assaData?.global_lore?.ç§°å·|| {};\n    // å®šä¹‰ä¸€ä¸ª Key åˆ°ä¸­æ–‡æ ‡ç­¾çš„æ˜ å°„ï¼Œè®©æ˜¾ç¤ºæ›´å‹å¥½\n\n\n    let modalContent = '<div class=\"title-manager-list\">';\n    modalContent += '<h3>ç§°å·ç®¡ç†</h3><p class=\"modal-subtitle\">ç‚¹å‡»ç§°å·æ¡ç›®å¯å±•å¼€/æ”¶èµ·è¯¦æƒ…</p>';\n\n    const titleKeys = Object.keys(allTitles).filter(key => key !== '_comment_');\n\n    if (titleKeys.length === 0) {\n        modalContent += '<p style=\"text-align:center; color: var(--text-secondary-color);\">ç›®å‰æ²¡æœ‰ä»»ä½•ç§°å·ã€‚</p>';\n    } else {\n        titleKeys.forEach(titleName => {\n            const titleData = allTitles[titleName];\n             const isShown = String(titleData.æ˜¯å¦æ˜¾ç¤º).toLowerCase() === 'true';\n\n            // ä¸ºæ¯ä¸ªç§°å·åˆ›å»ºä¸€ä¸ªå®¹å™¨ï¼ŒåŒ…å«å¯ç‚¹å‡»çš„ä¸»æ¡ç›®å’Œéšè—çš„è¯¦æƒ…é¢æ¿\n            modalContent += `\n                <div class=\"title-item-container\">\n                    <div class=\"title-manager-item\" data-title-name=\"${titleName}\">\n                        <span class=\"title-name\">${titleName}</span>\n                        <div class=\"title-actions\">\n                            <label class=\"toggle-switch\">\n                                <input type=\"checkbox\" class=\"title-toggle-checkbox\" data-title=\"${titleName}\" ${isShown ? 'checked' : ''}>\n                                <span class=\"slider\"></span>\n                            </label>\n                        </div>\n                    </div>\n                    <div class=\"title-details-panel\" id=\"details-for-${titleName.replace(/\\s+/g, '_')}\"></div>\n                </div>\n            `;\n        });\n    }\n    modalContent += '</div>';\n\n    showModal('shop-modal', '');\n    const messageEl = document.getElementById('shop-modal-message');\n\n    if (messageEl) {\n          \n        messageEl.innerHTML = modalContent;\n    }\n}\n    const messageEl = document.getElementById('shop-modal-message');\n\n    if (messageEl) {\n\n        // ä½¿ç”¨æ›´æ™ºèƒ½çš„äº‹ä»¶å§”æ‰˜æ¥å¤„ç†æ‰€æœ‰äº¤äº’\n        messageEl.addEventListener('click', function(event) {\n            const item = event.target.closest('.title-manager-item');\n            const toggle = event.target.closest('.toggle-switch');\n\n            // å¦‚æœç‚¹å‡»çš„æ˜¯å¼€å…³ï¼Œåˆ™ä¸è§¦å‘å±•å¼€/æ”¶èµ·é€»è¾‘\n            if (toggle) {\n                // å¼€å…³çš„ change äº‹ä»¶ä¼šå•ç‹¬å¤„ç†\n                return;\n            }\n\n            // å¦‚æœç‚¹å‡»çš„æ˜¯ç§°å·æ¡ç›®\n            if (item) {\n                const titleName = item.dataset.titleName;\n                const detailsPanelId = `details-for-${titleName.replace(/\\s+/g, '_')}`;\n                const detailsPanel = document.getElementById(detailsPanelId);\n\n                if (!detailsPanel) return;\n\n                // åˆ¤æ–­å½“å‰æ˜¯å¦å·²å±•å¼€\n                const isCurrentlyActive = detailsPanel.classList.contains('active');\n\n                // å…ˆå…³é—­æ‰€æœ‰å…¶ä»–å·²å±•å¼€çš„é¢æ¿\n                document.querySelectorAll('.title-details-panel.active').forEach(panel => {\n                    if (panel.id !== detailsPanelId) {\n                        panel.classList.remove('active');\n                        panel.innerHTML = '';\n                    }\n                });\n\n                // å¦‚æœå½“å‰æ˜¯æ”¶èµ·çŠ¶æ€ï¼Œåˆ™å±•å¼€å®ƒ\n                if (!isCurrentlyActive) {\n                    const titleData = allTitles[titleName];\n                    let detailsHtml = '<ul>';\n                    for (const key in titleData) {\n                        // è¿‡æ»¤æ‰æˆ‘ä»¬ä¸å¸Œæœ›ç›´æ¥æ˜¾ç¤ºçš„key\n                        if (Object.prototype.hasOwnProperty.call(titleData, key) && key !== 'æ˜¯å¦æ˜¾ç¤º') {\n                            const label = keyToLabelMap[key] || key; // ä½¿ç”¨æ˜ å°„æˆ–åŸå§‹key\n                            const value = titleData[key].toString().replace(/\\\\n/g, '<br>'); // å¤„ç†æ¢è¡Œ\n                            detailsHtml += `<li><span class=\"detail-key\">${label}:</span> <span class=\"detail-value\">${value}</span></li>`;\n                        }\n                    }\n                    detailsHtml += '</ul>';\n\n                    detailsPanel.innerHTML = detailsHtml;\n                    detailsPanel.classList.add('active');\n                } else {\n                    // å¦‚æœå½“å‰æ˜¯å±•å¼€çŠ¶æ€ï¼Œåˆ™æ”¶èµ·å®ƒ\n                    detailsPanel.classList.remove('active');\n                    // å¯ä»¥åŠ ä¸€ä¸ªå»¶æ—¶æ¸…ç©ºå†…å®¹ï¼Œç­‰å¾…åŠ¨ç”»ç»“æŸ\n                    setTimeout(() => { detailsPanel.innerHTML = ''; }, 350);\n                }\n            }\n        });\n\n        // å¼€å…³çš„ change äº‹ä»¶å¤„ç†ï¼ˆä¿æŒä¸å˜ï¼‰\n        messageEl.addEventListener('change', function(event) {\n            if (event.target.classList.contains('title-toggle-checkbox')) {\n                const titleToUpdate = event.target.dataset.title;\n                const newStatus = event.target.checked;\n                const command = `/setinput <updateMemory>\\nmemory('global_lore.ç§°å·.${titleToUpdate}','æ˜¯å¦æ˜¾ç¤º','${newStatus}')\\n</updateMemory>\\n<${userName} å°†ç§°å· [${titleToUpdate}] è®¾ç½®ä¸º${newStatus ? 'æ˜¾ç¤º' : 'éšè—'}>`;\n\n                if (typeof triggerassa !== 'undefined') {\n                    triggerassa(command);\n                    showNovaAlert(`ç§°å· [${titleToUpdate}] æ˜¾ç¤ºçŠ¶æ€æ›´æ–°æŒ‡ä»¤å·²å‘é€ï¼`);\n                }\n            }\n        });\n    }\n // ==========================================================\n// ========== å®Œæ•´æ›¿æ¢ populateCharacterPage å‡½æ•° ==========\n// ==========================================================\nfunction populateCharacterPage(playData, statData, assaData) {\n       if (!statData || !playData || !assaData) {\n        toastr.error(\"æ ¸å¿ƒè§’è‰²æ•°æ®ç¼ºå¤±ï¼Œæ— æ³•å¡«å……é¡µé¢å“¦ã€‚\");\n        return; // æ•°æ®ä¸å…¨ï¼Œç›´æ¥ä¸­æ­¢ï¼Œé˜²æ­¢åç»­å¤§é¢ç§¯æŠ¥é”™\n    }\n    const charStat = statData.user_character;\n    const derived = playData.è¡ç”Ÿå±æ€§æ®µ;\n    const currency = playData.è´§å¸æ®µ;\n      const nameDisplay = document.getElementById('char-display-name');\n    let titleContainer = document.getElementById('char-titles-container');\n    // å¦‚æœHTMLä¸­æ²¡æœ‰è¿™ä¸ªå…ƒç´ ï¼ŒJSä¼šè‡ªåŠ¨åˆ›å»ºå¹¶æ·»åŠ åˆ°åå­—ä¸Šæ–¹\n    if (!titleContainer && nameDisplay && nameDisplay.parentNode) {\n        titleContainer = document.createElement('div');\n        titleContainer.id = 'char-titles-container';\n        titleContainer.className = 'char-titles-container'; // ä½¿ç”¨ class ä¾¿äº CSS ç¾åŒ–\n        nameDisplay.parentNode.insertBefore(titleContainer, nameDisplay);\n    }\n\n    if(titleContainer){\n        titleContainer.innerHTML = ''; // æ¯æ¬¡åˆ·æ–°å‰æ¸…ç©º\n        titleContainer.style.cursor = 'pointer'; // é¼ æ ‡å˜æˆå°æ‰‹ï¼Œæç¤ºå¯ç‚¹å‡»\n        titleContainer.setAttribute('title', 'ç‚¹å‡»ç®¡ç†ç§°å·'); // ç®€å•çš„æ‚¬æµ®æç¤º\n\n        const allTitles = assaData?.global_lore?.ç§°å· ||{};\n        let displayedTitlesCount = 0;\n        // éå†æ‰€æœ‰ç§°å·ï¼Œæ‰¾åˆ°éœ€è¦æ˜¾ç¤ºçš„\n        for (const titleName in allTitles) {\n            if (Object.prototype.hasOwnProperty.call(allTitles, titleName) && titleName !== '_comment_') {\n                 if(String(allTitles[titleName].æ˜¯å¦æ˜¾ç¤º).toLowerCase() === 'true') {\n                    const titleSpan = document.createElement('span');\n                    titleSpan.className = 'char-title-tag'; // ä¾¿äºç”¨CSSæ·»åŠ æ ·å¼\n                    titleSpan.textContent = `ã€${titleName}ã€‘`;\n                    titleContainer.appendChild(titleSpan);\n                    displayedTitlesCount++;\n                }\n            }\n        }\n        // å¦‚æœæ²¡æœ‰æ˜¾ç¤ºçš„ç§°å·ï¼Œå¯ä»¥ç»™ä¸ªæç¤º\n        if(displayedTitlesCount === 0){\n             titleContainer.innerHTML = '<span class=\"char-title-tag placeholder\">(æ— æ˜¾ç¤ºç§°å·)</span>';\n        }\n\n        // ä¸ºæ•´ä¸ªç§°å·å®¹å™¨ç»‘å®šç‚¹å‡»äº‹ä»¶ï¼Œæ‰“å¼€ç§°å·ç®¡ç†å™¨\n        titleContainer.onclick = () => showTitleManager(assaData);\n    }\n\n\n    // --- å·¦ä¾§å’Œä¸­é—´é¢æ¿ (åŸºæœ¬ä¸å˜) ---\n    document.getElementById('char-display-name').textContent = SafeGetValue(charStat.name);\n    //document.getElementById('char-display-status').textContent = SafeGetValue(charStat.status) || 'æ­£å¸¸';\n    document.getElementById('char-display-prestige').textContent = SafeGetValue(charStat.Cross_world_prestige);\n \n    // --- çŠ¶æ€æ æŠ˜å åŠŸèƒ½ ---\n{ // ä½¿ç”¨å—ä½œç”¨åŸŸé¿å…å˜é‡æ±¡æŸ“\n    const statusSpan = document.getElementById('char-display-status');\n    const statusLine = statusSpan.closest('.info-line');\n    const statusLabel = statusLine?.querySelector('.info-label');\n    const fullStatusText = SafeGetValue(charStat.status) || 'æ­£å¸¸';\n    const COLLAPSE_THRESHOLD = 8; // å½“çŠ¶æ€æ–‡å­—è¶…è¿‡8ä¸ªå­—ç¬¦æ—¶ï¼Œå¯ç”¨æŠ˜å \n\n    if (statusLabel) {\n        // æ¸…ç†å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ï¼Œä»¥é˜²å‡½æ•°é‡å¤è°ƒç”¨å¯¼è‡´äº‹ä»¶é‡å¤ç»‘å®š\n        if (statusLine.__toggleHandler) {\n            statusLabel.removeEventListener('click', statusLine.__toggleHandler);\n            delete statusLine.__toggleHandler;\n        }\n        statusLabel.classList.remove('collapsible-label');\n\n        if (fullStatusText.length > COLLAPSE_THRESHOLD) {\n            const shortText = fullStatusText.substring(0, COLLAPSE_THRESHOLD) + '...';\n            statusSpan.textContent = shortText; // åˆå§‹æ˜¾ç¤ºä¸ºæŠ˜å çŠ¶æ€\n            statusLine.dataset.isExpanded = 'false';\n\n            statusLabel.classList.add('collapsible-label');\n\n            const toggleHandler = () => {\n                const isExpanded = statusLine.dataset.isExpanded === 'true';\n                if (isExpanded) {\n                    statusSpan.textContent = shortText;\n                    statusLine.dataset.isExpanded = 'false';\n                } else {\n                    statusSpan.textContent = fullStatusText;\n                    statusLine.dataset.isExpanded = 'true';\n                }\n            };\n\n            statusLabel.addEventListener('click', toggleHandler);\n            statusLine.__toggleHandler = toggleHandler; // å°†å¤„ç†å™¨é™„åŠ åˆ°çˆ¶å…ƒç´ ä¸Šï¼Œä¾¿äºåç»­æ¸…ç†\n        } else {\n            statusSpan.textContent = fullStatusText; // æ–‡æœ¬ä¸é•¿ï¼Œç›´æ¥æ˜¾ç¤º\n        }\n    } else {\n        // å¦‚æœæ‰¾ä¸åˆ°å¯¹åº”çš„æ ‡ç­¾ï¼Œä½œä¸ºé™çº§æ–¹æ¡ˆç›´æ¥è®¾ç½®æ–‡æœ¬\n         statusSpan.textContent = fullStatusText;\n    }\n}\n// --- çŠ¶æ€æ æŠ˜å åŠŸèƒ½ç»“æŸ ---\n\n      try {\n        const hp = derived.ç”Ÿå‘½å€¼ || { å½“å‰å€¼: [0], ä¸Šé™: [1] }; // æä¾›é»˜è®¤ç»“æ„\n        const currentHp = Number(hp.å½“å‰å€¼?.[0] ?? 0);\n        const maxHp = Number(hp.ä¸Šé™?.[0] ?? 1); // ä¸Šé™é»˜è®¤ä¸º1é˜²æ­¢é™¤ä»¥0\n        document.getElementById('char-hp-bar').style.width = (currentHp / maxHp * 100) + '%';\n        document.getElementById('char-hp-text').textContent = `${currentHp} / ${maxHp}`;\n    } catch (e) {\n        toastr.info(\"å¡«å……'ç”Ÿå‘½å€¼'æ—¶å¥½åƒå‡ºäº†ä¸€ç‚¹å°é—®é¢˜ï¼Œæ•°æ®æ ¼å¼ä¸å¯¹ï¼Ÿ\");\n        console.error(\"ç”Ÿå‘½å€¼å¡«å……é”™è¯¯:\", e); // åœ¨æ§åˆ¶å°ä¿ç•™è¯¦ç»†é”™è¯¯ä¾›æˆ‘ä»¬è°ƒè¯•\n    }\n\n    try {\n        const will = derived.æ„å¿—åŠ› || { å½“å‰å€¼: [0], ä¸Šé™: [1] };\n        const currentWill = Number(will.å½“å‰å€¼?.[0] ?? 0);\n        const maxWill = Number(will.ä¸Šé™?.[0] ?? 1);\n        document.getElementById('char-will-bar').style.width = (currentWill / maxWill * 100) + '%';\n        document.getElementById('char-will-text').textContent = `${currentWill} / ${maxWill}`;\n    } catch (e) {\n        toastr.info(\"å¡«å……'æ„å¿—åŠ›'æ—¶å¥½åƒå‡ºäº†ä¸€ç‚¹å°é—®é¢˜ï¼Œæ•°æ®æ ¼å¼ä¸å¯¹ï¼Ÿ\");\n        console.error(\"æ„å¿—åŠ›å¡«å……é”™è¯¯:\", e);\n    }\n\n    try {\n        const energy = derived.èƒ½é‡æ±  || { åç§°: 'èƒ½é‡', å½“å‰å€¼: [0], ä¸Šé™: [1] };\n        const energyName = SafeGetValue(energy.åç§°) || 'èƒ½é‡';\n        const currentEnergy = Number(energy.å½“å‰å€¼?.[0] ?? 0);\n        const maxEnergy = Number(energy.ä¸Šé™?.[0] ?? 1);\n        document.getElementById('char-energy-label').textContent = energyName;\n        document.getElementById('char-energy-bar').style.width = (currentEnergy / maxEnergy * 100) + '%';\n        document.getElementById('char-energy-text').textContent = `${currentEnergy} / ${maxEnergy}`;\n    } catch (e) {\n        toastr.info(\"å¡«å……'èƒ½é‡æ± 'æ•°æ®æ—¶é‡åˆ°äº†ç‚¹å°éº»çƒ¦ï¼Œæ•°æ®æ ¼å¼ä¸å¯¹ï¼Ÿ\");\n        console.error(\"èƒ½é‡æ± å¡«å……é”™è¯¯:\", e);\n    }\n\n    // åŠ¨æ€ç”Ÿæˆé¢å¤–çš„èµ„æºæ¡\n    const dynamicBarsContainer = document.getElementById('dynamic-resource-bars-container');\n    dynamicBarsContainer.innerHTML = ''; // æ¯æ¬¡åˆ·æ–°å‰å…ˆæ¸…ç©º\n\n    const resourceBars = assaData?.global_lore?.èµ„æºæ¡;\n    if (resourceBars) {\n        for (const resourceName in resourceBars) {\n            if (Object.prototype.hasOwnProperty.call(resourceBars, resourceName) && typeof resourceBars[resourceName] === 'object') {\n                const resource = resourceBars[resourceName];\n\n                // åˆ›å»ºå…ƒç´ \n                const container = document.createElement('div');\n                container.className = 'resource-bar-container';\n\n                const label = document.createElement('div');\n                label.className = 'resource-bar-label';\n                label.textContent = resourceName;\n\n                const barBg = document.createElement('div');\n                barBg.className = 'progress-bar-bg resource'; // å¤ç”¨æ ·å¼\n\n                const barFill = document.createElement('div');\n                // ä½ å¯ä»¥åˆ›å»ºä¸€ä¸ªé€šç”¨çš„CSSç±» 'generic-resource' æ¥å®šä¹‰è¿™äº›æ¡çš„é¢œè‰²\n                barFill.className = 'progress-bar-fill generic-resource';\n                const percentage = (Number(resource.å½“å‰å€¼) / Number(resource.æœ€å¤§å€¼)) * 100;\n                barFill.style.width = `${Math.max(0, Math.min(100, percentage))}%`;\n\n                const text = document.createElement('span');\n                text.className = 'progress-bar-text';\n                text.textContent = `${Number(resource.å½“å‰å€¼) || 0} / ${Number(resource.æœ€å¤§å€¼) || 0}`;\n\n                // --- æ ¸å¿ƒï¼šåˆ›å»ºTooltipä¿¡æ¯ ---\n                const tooltipText = `${resource.æè¿° || 'æš‚æ— æè¿°'}\\næ¯è½®æ¶ˆè€—: ${resource.æ¯è½®æ¶ˆè€— || 0}\\nå½’é›¶åæœ: ${resource.å½’é›¶åæœ || 'æ— '}`;\n                barBg.setAttribute('data-tooltip', tooltipText);\n\n                // ç»„è£…å¹¶æ·»åŠ åˆ°é¡µé¢\n                barBg.appendChild(barFill);\n                barBg.appendChild(text);\n                container.appendChild(label);\n                container.appendChild(barBg);\n                dynamicBarsContainer.appendChild(container);\n            }\n        }\n    }\n\n    // ===============================================================\n    const equipment = charStat.å½“å‰è£…å¤‡.ç©¿æˆ´;\n    document.getElementById('equip-head').textContent = `å¤´éƒ¨: ${SafeGetValue(equipment.å¤´éƒ¨)}`;\n    document.getElementById('equip-body').textContent = `èº«ä½“: ${SafeGetValue(equipment.èº«ä½“)}`;\n    document.getElementById('equip-hands').textContent = `æ‰‹éƒ¨: ${SafeGetValue(equipment.æ‰‹éƒ¨)}`;\n    document.getElementById('equip-feet').textContent = `è„šéƒ¨: ${SafeGetValue(equipment.è„šéƒ¨)}`;\n    document.getElementById('equip-accessory').textContent = `é¥°å“: ${SafeGetValue(equipment.é¥°å“)}`;\n    document.getElementById('equip-weapon').textContent = `æ‰‹æŒ: ${SafeGetValue(charStat.å½“å‰è£…å¤‡.æ‰‹æŒ)}`;\n\n\n\n    const bloodlineInfoLine = document.getElementById('bloodline-info-line');\n    const bloodlineDisplay = document.getElementById('char-display-bloodline');\n\n    if (bloodlineInfoLine && bloodlineDisplay) {\n        // ä» playData ä¸­è·å–è¡€ç»Ÿä¿¡æ¯\n        const bloodlineName = SafeGetValue(playData.èƒ½åŠ›æ®µ.åç§°);\n        const bloodlineEffect = SafeGetValue(playData.èƒ½åŠ›æ®µ.æ•ˆæœ);\n\n        // æ£€æŸ¥æ˜¯å¦å­˜åœ¨æœ‰æ•ˆçš„è¡€ç»Ÿä¿¡æ¯\n        if (bloodlineName && bloodlineName !== \"æ— \" && bloodlineName.trim() !== \"\") {\n            bloodlineInfoLine.style.display = ''; // æ˜¾ç¤ºè¡€ç»Ÿè¿™ä¸€è¡Œ\n            bloodlineDisplay.textContent = bloodlineName;\n\n            bloodlineInfoLine.onclick = () => {\n    if (bloodlineEffect) {\n         // â­ å…³é”®ç‚¹åœ¨è¿™é‡Œï¼šä½¿ç”¨ replace æ–¹æ³•å°†å­—ç¬¦ä¸² \\n æ›¿æ¢ä¸º HTML æ¢è¡Œæ ‡ç­¾ <br>\n        const formattedEffect = bloodlineEffect.replace(/\\\\n/g, '<br>');\n        showModal('shop-modal', `è¡€ç»Ÿ: ${bloodlineName}`, formattedEffect);\n    } else {\n        showModal('shop-modal', `è¡€ç»Ÿ: ${bloodlineName}`, 'è¯¥è¡€ç»Ÿæ•ˆæœæè¿°ç¼ºå¤±ã€‚');\n    }\n \n            };\n        } else {\n            bloodlineInfoLine.style.display = 'none'; // å¦‚æœæ²¡æœ‰è¡€ç»Ÿï¼Œå°±éšè—è¿™ä¸€è¡Œ\n        }\n    }\n\n    // --- å³ä¾§é¢æ¿: æ¸²æŸ“æ–°çš„æ•´åˆæ¨¡å— (æ ¸å¿ƒæ”¹åŠ¨) ---\n    const statsContainer = document.getElementById('main-stats-container');\n    statsContainer.innerHTML = ''; // æ¸…ç©ºå®¹å™¨\n    const currentXp = playData.è´§å¸æ®µ.ç»éªŒå€¼[0];\n    const equipmentBonuses = getEquipmentBonuses(statData, assaData);\n   const statusBonuses = getStatusBonuses(statData);\n    const moduleMapping = [\n        { name: \"ç”Ÿç†\", attr: \"ç”Ÿç†å±æ€§\", skill: \"ç”Ÿç†æŠ€èƒ½\" },\n        { name: \"å¿ƒæ™º\", attr: \"å¿ƒæ™ºå±æ€§\", skill: \"å¿ƒæ™ºæŠ€èƒ½\" },\n        { name: \"äº’åŠ¨\", attr: \"äº’åŠ¨å±æ€§\", skill: \"äº’åŠ¨æŠ€èƒ½\" }\n    ];\n\n    moduleMapping.forEach(moduleInfo => {\n        const moduleDiv = document.createElement('div');\n        moduleDiv.className = 'stat-module';\n\n        const titleDiv = document.createElement('div');\n        titleDiv.className = 'stat-module-title';\n        titleDiv.textContent = moduleInfo.name;\n        titleDiv.onclick = () => moduleDiv.classList.toggle('collapsed');\n\n        const contentDiv = document.createElement('div');\n        contentDiv.className = 'stat-module-content';\n\n        // --- æ¸²æŸ“å±æ€§ ---\n        let attrHtml = `<div class=\"sub-category-title\">åŸºç¡€å±æ€§</div>`;\n        const attrCategoryData = playData.å±æ€§æ®µ[moduleInfo.attr];\n        for (const attrName in attrCategoryData) {\n            const attr = attrCategoryData[attrName];\n            const dataPath = `å±æ€§æ®µ.${moduleInfo.attr}.${attrName}.åŸºç¡€`;\n              const equipBonus = equipmentBonuses[attrName] || 0;\n            const statusBonus = statusBonuses[attrName] || 0; // è·å–çŠ¶æ€åŠ æˆ\n\n            const equipBonusHtml = equipBonus !== 0 ? ` <span class=\"equipment-bonus\">(${equipBonus > 0 ? '+' : ''}${equipBonus})</span>` : '';\n            // æ–°å¢ï¼šç”ŸæˆçŠ¶æ€åŠ æˆçš„ HTMLï¼Œå¹¶ä½¿ç”¨æ–°çš„ 'status-modifier' æ ·å¼\n            const statusBonusHtml = statusBonus !== 0 ? ` <span class=\"status-modifier\">(${statusBonus > 0 ? '+' : ''}${statusBonus})</span>` : '';\n            const legendaryBonusHtml = attr.ä¼ å¥‡[0] > 0 ? ` <span class=\"legendary-value\" data-tooltip=\"${attr.ä¼ å¥‡[1]}\">(+${attr.ä¼ å¥‡[0]})</span>` : '';\n            const upgradeCost = calculateXpCost(attr.åŸºç¡€[0], 'attribute');\n            const canUpgrade = currentXp >= upgradeCost;\n            const upgradeButtonHtml = canUpgrade ? `<span class=\"upgrade-btn\" data-path=\"${dataPath}\" data-name=\"${attrName}\" data-level=\"${attr.åŸºç¡€[0]}\" data-type=\"attribute\">+</span>` : '';\n\n            attrHtml += `\n            <div class=\"attr-item\" data-tooltip=\"${attr.åŸºç¡€[1]}\">\n                <span class=\"attr-name\">${attrName}${upgradeButtonHtml}</span>\n                <span class=\"attr-value\">${attr.åŸºç¡€[0]}${equipBonusHtml}${statusBonusHtml}${legendaryBonusHtml}</span>\n            </div>`;\n        }\n\n        // --- æ¸²æŸ“æŠ€èƒ½ ---\n        let skillHtml = `<div class=\"sub-category-title\">ç›¸å…³æŠ€èƒ½</div>`;\n        const skillCategoryData = playData.æŠ€èƒ½æ®µ[moduleInfo.skill];\n         const skillsToShow = Object.keys(skillCategoryData).filter(skillName =>\n            skillCategoryData[skillName][0] > 0 || (equipmentBonuses[skillName] && equipmentBonuses[skillName] !== 0)\n        );\n        if (skillsToShow.length > 0) {\n            for (const skillName of skillsToShow) {\n                const skill = skillCategoryData[skillName];\n                const dataPath = `æŠ€èƒ½æ®µ.${moduleInfo.skill}.${skillName}`;\n                 const skillBonus = equipmentBonuses[skillName] || 0;\n                const statusSkillBonus = statusBonuses[skillName] || 0; // è·å–æŠ€èƒ½çš„çŠ¶æ€åŠ æˆ\n\n                const skillBonusHtml = skillBonus !== 0 ? ` <span class=\"equipment-bonus\">(${skillBonus > 0 ? '+' : ''}${skillBonus})</span>` : '';\n                // æ–°å¢ï¼šç”ŸæˆæŠ€èƒ½ ìƒíƒœåŠ æˆçš„ HTML\n                const statusSkillBonusHtml = statusSkillBonus !== 0 ? ` <span class=\"status-modifier\">(${statusSkillBonus > 0 ? '+' : ''}${statusSkillBonus})</span>` : '';\n                const upgradeCost = calculateXpCost(skill[0], 'skill');\n                const canUpgrade = currentXp >= upgradeCost;\n                const upgradeButtonHtml = canUpgrade ? `<span class=\"upgrade-btn\" data-path=\"${dataPath}\" data-name=\"${skillName}\" data-level=\"${skill[0]}\" data-type=\"skill\">+</span>` : '';\n\n                skillHtml += `\n                <div class=\"skill-item\" data-tooltip=\"${skill[1]}\">\n                    <span class=\"skill-name\">${skillName}${upgradeButtonHtml}</span>\n                    <span class=\"skill-value\">${skill[0]}${skillBonusHtml}${statusSkillBonusHtml}</span>\n                </div>`;\n            }\n        } else {\n            skillHtml += `<div class=\"info-value\" style=\"font-size:0.9em; color: var(--text-secondary-color);\">æš‚æ— å·²æŒæ¡çš„${moduleInfo.name}æŠ€èƒ½</div>`;\n        }\n\n\n        contentDiv.innerHTML = attrHtml + skillHtml;\n        moduleDiv.appendChild(titleDiv);\n        moduleDiv.appendChild(contentDiv);\n        statsContainer.appendChild(moduleDiv);\n    });\n\n    // --- æ¸²æŸ“è¡ç”Ÿå±æ€§ (ä¿æŒç‹¬ç«‹æ¨¡å—) ---\n    // (è¿™éƒ¨åˆ†ä»£ç é€»è¾‘å¯ä»¥å¤ç”¨ï¼Œæˆ‘ä»¬æŠŠå®ƒåŒ…è£…æˆä¸€ä¸ªæ–°æ¨¡å—)\n    const derivedContainer = document.createElement('div');\n    derivedContainer.className = 'stat-module';\n    const derivedTitle = document.createElement('div');\n    derivedTitle.className = 'stat-module-title';\n    derivedTitle.textContent = 'è¡ç”Ÿå±æ€§';\n    derivedTitle.onclick = () => derivedContainer.classList.toggle('collapsed');\n    const derivedContent = document.createElement('div');\n    derivedContent.className = 'stat-module-content';\n\n    let derivedHtml = '';\n    const derivedData = playData.è¡ç”Ÿå±æ€§æ®µ;\n    // (ä»ä½ åŸä»£ç ä¸­å¤åˆ¶å¹¶å¾®è°ƒçš„è¡ç”Ÿå±æ€§æ¸²æŸ“é€»è¾‘)\n    for (const key in derivedData) {\n        const dataEntry = derivedData[key];\n        const getBonusHtml = (bonusValue) => !bonusValue ? '' : `<span class=\"equipment-bonus\">(${bonusValue > 0 ? '+' : ''}${bonusValue})</span>`;\n        if (typeof dataEntry[1] === 'string') {\n            const bonus = equipmentBonuses[`è¡ç”Ÿå±æ€§æ®µ.${key}`] || 0;\n            derivedHtml += `<div class=\"attr-item\" data-tooltip=\"${dataEntry[1]}\"><span class=\"attr-name\">${key}</span><span class=\"attr-value\">${dataEntry[0]}${getBonusHtml(bonus)}</span></div>`;\n        } else if (typeof dataEntry === 'object') {\n            derivedHtml += `<div class=\"attr-item sub-category-title\" style=\"border:none; margin: 10px 0 5px 0;\">${key}</div>`;\n            for (const subKey in dataEntry) {\n                const subEntry = dataEntry[subKey];\n                if (typeof subEntry[1] === 'string') {\n                    const bonus = equipmentBonuses[`è¡ç”Ÿå±æ€§æ®µ.${key}.${subKey}`] || 0;\n                    derivedHtml += `<div class=\"attr-item\" data-tooltip=\"${subEntry[1]}\" style=\"padding-left:15px;\"><span class=\"attr-name\">${subKey}</span><span class=\"attr-value\">${subEntry[0]}${getBonusHtml(bonus)}</span></div>`;\n                } else if (typeof subEntry === 'object') {\n                    derivedHtml += `<div class=\"attr-item\" style=\"padding-left:15px; color:var(--text-secondary-color);\">${subKey}</div>`;\n                    for (const deepKey in subEntry) {\n                        const deepEntry = subEntry[deepKey];\n                        const bonus = equipmentBonuses[`è¡ç”Ÿå±æ€§æ®µ.${key}.${subKey}.${deepKey}`] || 0;\n                        if (typeof deepEntry[1] === 'string') {\n                            derivedHtml += `<div class=\"attr-item\" data-tooltip=\"${deepEntry[1]}\" style=\"padding-left:30px;\"><span class=\"attr-name\">${deepKey}</span><span class=\"attr-value\">${deepEntry[0]}${getBonusHtml(bonus)}</span></div>`;\n                        }\n                    }\n                }\n            }\n        }\n    }\n    derivedContent.innerHTML = derivedHtml;\n    derivedContainer.appendChild(derivedTitle);\n    derivedContainer.appendChild(derivedContent);\n    statsContainer.appendChild(derivedContainer);\n\n\n    // --- æœ€å, è°ƒç”¨æ–°å‡½æ•°å¡«å……ç¬¬äºŒä¸ª Tab ---\n    populateInventoryAndSkillsTab(playData, assaData);\n\n    // è®¾ç½® Tooltips å’Œ Tab åˆ‡æ¢\n    setupTooltips();\n    setupCharacterTabs();\n}\n\n\n// ========================================================\n// =========== æ–°å¢: å¡«å……è¡Œå›Šä¸èƒ½åŠ›Tabçš„å‡½æ•° ===========\n// ========================================================\nfunction populateInventoryAndSkillsTab(playData, assaData) {\n        const keyLocalizationMap = {\n        \"info\": \"ç®€ä»‹\",\n        \"effect\": \"å±æ€§\",\n        \"type\": \"ç§ç±»\",\n        \"quality\": \"è´¨é‡\",\n          \"num\": \"æ•°é‡\",\n        \"level\": \"ç­‰çº§\",\n        \"status\":\"çŠ¶æ€\" // çœ‹ï¼Œæ–°çš„å°æ ‡ç­¾å°±åœ¨è¿™é‡Œï¼\n    };\n    const currency = playData.è´§å¸æ®µ;\n    const inventory = assaData.global_lore?.èƒŒåŒ… || {};\n    const otherSkills = assaData.global_lore?.å…¶ä»–æŠ€èƒ½ || {};\n\n    // --- 1. å¡«å……é¡¶éƒ¨çš„è´§å¸ä¿¡æ¯ ---\n    const currencyContainer = document.getElementById('char-currency-display');\n    const plots = currency.æ”¯çº¿å‰§æƒ…;\n    const plotString = `D:${plots.D[0]} C:${plots.C[0]} B:${plots.B[0]} A:${plots.A[0]} S:${plots.S[0]}`;\n\n    if(version === '7'){\n    currencyContainer.innerHTML = `\n        <div class=\"currency-item\"><span class=\"label\">${currentTheme.currency || 'ç§¯åˆ†'}:</span><span class=\"value\">${currency.ç§¯åˆ†[0]}</span></div>\n        <div class=\"currency-item\"><span class=\"label\">${currentTheme.exp || 'ç»éªŒ'}:</span><span class=\"value\">${currency.ç»éªŒå€¼[0]}</span></div>\n           `;\n    }else{\n    currencyContainer.innerHTML = `\n        <div class=\"currency-item\"><span class=\"label\">${currentTheme.currency || 'ç§¯åˆ†'}:</span><span class=\"value\">${currency.ç§¯åˆ†[0]}</span></div>\n        <div class=\"currency-item\"><span class=\"label\">${currentTheme.exp || 'ç»éªŒ'}:</span><span class=\"value\">${currency.ç»éªŒå€¼[0]}</span></div>\n        <div class=\"currency-item\"><span class=\"label\">${currentTheme.plot || 'å‰§æƒ…'}:</span><span class=\"value\">${plotString}</span></div>\n    `;\n    }\n\n\n\n       // --- 2. å¡«å……è¡Œå›Šç‰©å“ ---\n    const itemsContainer = document.getElementById('inventory-items-container');\n    itemsContainer.innerHTML = '';\n\n    Object.keys(inventory).forEach(itemName => {\n        const item = inventory[itemName];\n        let itemData = {};\n\n        // å…¼å®¹æ•°æ®æ ¼å¼\n        if (typeof item === 'string') {\n            try {\n                itemData = JSON.parse(item);\n            } catch (e) {\n                itemData = { info: item, effect: 'æ— ', num: 1 };\n            }\n        } else if (typeof item === 'object' && item !== null) {\n            itemData = item;\n        }\n\n        const card = document.createElement('div');\n        card.className = 'item-card';\n        card.innerHTML = `\n            <div class=\"item-card-name\">${itemName}</div>\n            ${itemData.num > 1 ? `<div class=\"item-card-num\">x${itemData.num}</div>` : ''}\n        `;\n\n        // â¤ï¸ å¦ˆå¦ˆåœ¨è¿™é‡Œæ–½å±•äº†â€œç¿»è¯‘å’’â€ â¤ï¸\n        const localizedItemData = Object.keys(itemData).reduce((acc, key) => {\n            const localizedKey = keyLocalizationMap[key] || key;\n            acc[localizedKey] = itemData[key];\n            return acc;\n        }, {});\n\n        card.onclick = () => showInfoDetailModal(itemName, localizedItemData, 'ç‰©å“');\n        itemsContainer.appendChild(card);\n    });\n    if (itemsContainer.children.length === 0) {\n        itemsContainer.innerHTML = `<p style=\"color: var(--text-secondary-color);\">ä½ çš„è¡Œå›Šç©ºç©ºå¦‚ä¹Ÿ...</p>`;\n    }\n\n     // --- 3. å¡«å……\"å…¶ä»–æŠ€èƒ½\" ---\n    const skillsContainer = document.getElementById('other-skills-container');\n    skillsContainer.innerHTML = '';\n\n    Object.keys(otherSkills).forEach(skillName => {\n        const skill = otherSkills[skillName];\n        let skillData = {};\n\n        // å…¼å®¹æ•°æ®æ ¼å¼\n        if (typeof skill === 'string') {\n             try {\n                skillData = JSON.parse(skill);\n            } catch (e) {\n                skillData = { info: skill, effect: 'æ— ', level: 'æœªçŸ¥' };\n            }\n        } else if (typeof skill === 'object' && skill !== null) {\n            skillData = skill;\n        }\n\n        const card = document.createElement('div');\n        card.className = 'skill-card';\n        card.innerHTML = `\n            <div class=\"skill-card-name\">${skillName}</div>\n            ${skillData.level ? `<div class=\"skill-card-level\">${skillData.level}</div>` : ''}\n        `;\n\n        // â¤ï¸ å¯¹äºæŠ€èƒ½ï¼Œå¦ˆå¦ˆä¹Ÿæ–½å±•äº†åŒæ ·çš„å’’è¯­ â¤ï¸\n        const localizedSkillData = Object.keys(skillData).reduce((acc, key) => {\n            const localizedKey = keyLocalizationMap[key] || key;\n            acc[localizedKey] = skillData[key];\n            return acc;\n        }, {});\n\n\n        card.onclick = () => showInfoDetailModal(skillName, localizedSkillData, 'èƒ½åŠ›');\n        skillsContainer.appendChild(card);\n    });\n    if (skillsContainer.children.length === 0) {\n        skillsContainer.innerHTML = `<p style=\"color: var(--text-secondary-color);\">å°šæœªæŒæ¡ä»»ä½•ç‰¹æ®Šèƒ½åŠ›...</p>`;\n    }\n}\n\n // ========================================================\n// ========== å®Œæ•´æ›¿æ¢: æ˜¾ç¤ºç‰©å“/æŠ€èƒ½è¯¦æƒ…çš„æ¨¡æ€æ¡† ==========\n// ========================================================\nfunction showInfoDetailModal(name, data, type) {\n \n    const buildDetailHtml = (data, depth = 0) => {\n        const indentStyle = `padding-left: ${depth * 20}px;`;\n\n        // å¦‚æœæ•°æ®æ˜¯ä¸€ä¸ªå¯¹è±¡ (ä½†ä¸æ˜¯æ•°ç»„)\n        if (typeof data === 'object' && data !== null && !Array.isArray(data)) {\n            let html = '';\n            for (const [key, value] of Object.entries(data)) {\n\n\n                  if (key.startsWith('_')) {\n                    continue;\n                }\n                \n                // å¦‚æœå€¼æ˜¯å¯¹è±¡æˆ–æ•°ç»„ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå¯æŠ˜å çš„å®¹å™¨\n                if (typeof value === 'object' && value !== null) {\n                    html += `\n                        <div class=\"detail-collapsible\" style=\"${indentStyle}\">\n                            <div class=\"detail-collapsible-header\">\n                                <span class=\"d-c-arrow\">â–¶</span>\n                                <span class=\"d-c-key\">${key}:</span>\n                            </div>\n                            <div class=\"detail-collapsible-content\">\n                                ${buildDetailHtml(value, 0)}\n                            </div>\n                        </div>\n                    `;\n                } else { // å¦åˆ™ï¼Œç›´æ¥æ˜¾ç¤ºé”®å€¼å¯¹\n                    html += `\n                        <div class=\"detail-entry\" style=\"${indentStyle}\">\n                             <span class=\"d-c-key\">${key}:</span>\n                             <span class=\"d-c-value\">${formatSimpleValue(value)}</span>\n                        </div>\n                    `;\n                }\n            }\n            return html;\n        }\n        // å¦‚æœæ•°æ®æ˜¯ä¸€ä¸ªæ•°ç»„\n        else if (Array.isArray(data)) {\n            let listContent = data.map(item => buildDetailHtml(item, 0)).join('');\n            return `<div class=\"detail-array-container\">${listContent}</div>`;\n        }\n        // å¦‚æœæ˜¯åŸºæœ¬ç±»å‹çš„å€¼ï¼ˆå­—ç¬¦ä¸²ã€æ•°å­—ç­‰ï¼‰\n        else {\n            return `<div class=\"detail-entry\" style=\"${indentStyle}\"><span class=\"d-c-value single\">${formatSimpleValue(data)}</span></div>`;\n        }\n    };\n\n    // --- æ ¼å¼åŒ–åŸºæœ¬å€¼çš„å‡½æ•° (æ¯”å¦‚é«˜äº®ç‰¹æ®Šæ–‡æœ¬) ---\nconst formatSimpleValue = (text) => {\n    if (typeof text !== 'string') return text;\n    return text\n        .replace(/ã€/g, '<strong style=\"color: var(--secondary-color);\">ã€')\n        .replace(/ã€‘/g, 'ã€‘</strong>')\n        .replace(/\\|/g, '<br>');\n};\n\n    // --- æ„å»ºå¹¶æ˜¾ç¤ºæ¨¡æ€æ¡† ---\n    const contentHtml = `\n        <div class=\"detail-modal-container\">\n            <h3 class=\"detail-modal-title\">${name}</h3>\n            ${buildDetailHtml(data)}\n        </div>\n    `;\n\n    showModal('shop-modal', `${type}è¯¦æƒ…`, contentHtml);\n\n    // --- åŠ¨æ€åœ°ä¸ºæˆ‘ä»¬æ–°åˆ›å»ºçš„æŠ˜å å…ƒç´ æ·»åŠ ç‚¹å‡»äº‹ä»¶ ---\n    setTimeout(() => {\n        const modalContent = document.querySelector('#shop-modal .modal-content');\n        if (modalContent) {\n             modalContent.querySelectorAll('.detail-collapsible-header').forEach(header => {\n                header.addEventListener('click', () => {\n                    header.parentElement.classList.toggle('expanded');\n                });\n            });\n        }\n    }, 100); // ç¡®ä¿å…ƒç´ å·²æ¸²æŸ“\n}\n\n// ========================================================\n// ============ æ–°å¢: è®¾ç½®Tabåˆ‡æ¢é€»è¾‘çš„å‡½æ•° ============\n// ========================================================\nfunction setupCharacterTabs() {\n    const tabButtons = document.querySelectorAll('.char-tab-btn');\n    const tabPanels = document.querySelectorAll('.char-tab-panel');\n\n    // é˜²æ­¢é‡å¤ç»‘å®šäº‹ä»¶\n    if (document.getElementById('page-character-modal').dataset.tabsInitialized) {\n        return;\n    }\n    document.getElementById('page-character-modal').dataset.tabsInitialized = 'true';\n\n    tabButtons.forEach(button => {\n        button.addEventListener('click', () => {\n            const targetTab = button.dataset.tab;\n\n            tabButtons.forEach(btn => btn.classList.remove('active'));\n            button.classList.add('active');\n\n            tabPanels.forEach(panel => {\n                if (panel.id === `char-tab-${targetTab}`) {\n                    panel.classList.add('active');\n                } else {\n                    panel.classList.remove('active');\n                }\n            });\n        });\n    });\n}\n\nfunction setupTooltips() {\n    const tooltipElement = document.getElementById('char-tooltip');\n    document.querySelectorAll('[data-tooltip]').forEach(element => {\n        element.addEventListener('mousemove', (e) => {\n            tooltipElement.textContent = element.dataset.tooltip;\n            tooltipElement.style.opacity = '1';\n            tooltipElement.style.visibility = 'visible';\n            tooltipElement.style.left = e.clientX + 15 + 'px';\n            tooltipElement.style.top = e.clientY + 15 + 'px';\n        });\n\n        element.addEventListener('mouseleave', () => {\n            tooltipElement.style.opacity = '0';\n            tooltipElement.style.visibility = 'hidden';\n        });\n    });\n\n    // ä¸ºç‰¹å®škeyçš„tooltipæ·»åŠ é»˜è®¤æè¿°\n    const tooltipDescriptions = {\n        status: \"å½“å‰å·²æœ‰çš„buffå’Œdebuffã€‚ç‚¹å‡»å·¦ä¾§[çŠ¶æ€]å¯å±•å¼€\",\n        prestige: \"è·¨ä¸–ç•Œå£°æœ›ï¼Œåªæœ‰å¯¹ä¸–ç•Œäº§ç”Ÿé‡å¤§å½±å“æ‰æ›´æ–°\",\n        hp: \"ç”Ÿå‘½å€¼ï¼Œå½’é›¶åˆ™é™·å…¥æ¿’æ­»çŠ¶æ€\",\n        willpower: \"æ„å¿—åŠ›ï¼Œç”¨äºæŠµæŠ—å¿ƒæ™ºå½±å“å’Œå‘åŠ¨ç‰¹æ®Šèƒ½åŠ›\",\n        energy: \"ç‰¹æ®Šèƒ½é‡ï¼Œå¦‚æ³•åŠ›ã€çµåŠ›ã€æ°”\",\n        equip_head: \"å¤´éƒ¨ç©¿æˆ´çš„è£…å¤‡ï¼Œç‚¹å‡»ç®¡ç†\",\n        equip_body: \"èº«ä½“ç©¿æˆ´çš„è£…å¤‡ï¼Œç‚¹å‡»ç®¡ç†\",\n        equip_hands: \"æ‰‹éƒ¨ç©¿æˆ´çš„è£…å¤‡ï¼Œç‚¹å‡»ç®¡ç†\",\n        equip_feet: \"è„šéƒ¨ç©¿æˆ´çš„è£…å¤‡ï¼Œç‚¹å‡»ç®¡ç†\",\n        equip_accessory: \"ç©¿æˆ´çš„ç‰¹æ®Šé¥°å“ï¼Œç‚¹å‡»ç®¡ç†\",\n        equip_weapon: \"å½“å‰æ‰‹æŒçš„æ­¦å™¨æˆ–å·¥å…·ï¼Œç‚¹å‡»ç®¡ç†\",\n        meide:\"ä¼šæœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿ\",\n        ede:\"ä¼šæœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿ\",\n    };\n\n    document.querySelectorAll('[data-tooltip-key]').forEach(element => {\n        const key = element.dataset.tooltipKey;\n        if(tooltipDescriptions[key]) {\n            element.dataset.tooltip = tooltipDescriptions[key];\n        }\n\n         element.addEventListener('mousemove', (e) => {\n            tooltipElement.textContent = element.dataset.tooltip;\n            tooltipElement.style.opacity = '1';\n            tooltipElement.style.visibility = 'visible';\n            tooltipElement.style.left = e.clientX + 15 + 'px';\n            tooltipElement.style.top = e.clientY + 15 + 'px';\n        });\n\n        element.addEventListener('mouseleave', () => {\n            tooltipElement.style.opacity = '0';\n            tooltipElement.style.visibility = 'hidden';\n        });\n    });\n}\n\n     /**\n     * æ ¼å¼åŒ–åˆ†å·åˆ†éš”çš„å­—ç¬¦ä¸²ä¸ºæ¢è¡Œæ˜¾ç¤º\n     * @param {string} text - è¾“å…¥çš„å­—ç¬¦ä¸²\n     * @returns {string} - HTMLå­—ç¬¦ä¸²\n     */\n    function formatSemicolonText(text) {\n        if (!text || text === 'æ— ' || text.trim() === '') {\n            return 'æ— ';\n        }\n        return text.split(';').map(item => item.trim()).filter(item => item).join('<br>');\n    }\n \n/**\n * æ¸²æŸ“æ•´ä¸ªè®¾å®šä¹¦ç•Œé¢\n * @param {object} data - åŒ…å«è®¾å®šä¿¡æ¯çš„assa_dataå¯¹è±¡\n */\nfunction renderSettingsBook(data) {\n //console.log(\"è®¾å®šä¹¦å·²å¼ƒç”¨\");\n}\n\n\n// æ£€æŸ¥æ•°æ®æºè¯»å–æ˜¯å¦æ­£ç¡®\nfunction debugDataSource(mapData) {\n    //console.log(\"ğŸ—ƒï¸ åŸå§‹mapDataå¯¹è±¡:\", mapData);\n    \n    const locationContent = mapData[\"ä¸»è¦åœ°ç‚¹è¡¨\"];\n    //console.log(\"ğŸ“‹ ä¸»è¦åœ°ç‚¹è¡¨åŸå§‹æ•°æ®:\", locationContent);\n    \n    if (locationContent && locationContent.length > 0) {\n        //console.log(\"ğŸ“ é€è¡Œè§£ææ•°æ®:\");\n        \n        for (let i = 0; i < locationContent.length; i++) {\n            const location = locationContent[i];\n            //console.log(`è¡Œ ${i}:`, location);\n            \n            // è¯¦ç»†è§£ææ¯ä¸ªå­—æ®µ\n            const [ name, xStr, yStr, widthStr, heightStr, description] = location;\n            \n            //console.log(`  è§£æç»“æœ:`);\n            //console.log(`    colIndex: ${colIndex} (ç±»å‹: ${typeof colIndex})`);\n            //console.log(`    name: ${name} (ç±»å‹: ${typeof name})`);\n            //console.log(`    xStr: ${xStr} (ç±»å‹: ${typeof xStr}) â†’ è½¬æ¢ä¸º: ${parseInt(xStr, 10)}`);\n            //console.log(`    yStr: ${yStr} (ç±»å‹: ${typeof yStr}) â†’ è½¬æ¢ä¸º: ${parseInt(yStr, 10)}`);\n            //console.log(`    widthStr: ${widthStr} (ç±»å‹: ${typeof widthStr}) â†’ è½¬æ¢ä¸º: ${parseInt(widthStr, 10) || 100}`);\n            //console.log(`    heightStr: ${heightStr} (ç±»å‹: ${typeof heightStr}) â†’ è½¬æ¢ä¸º: ${parseInt(heightStr, 10) || 50}`);\n            //console.log(`    description: ${description}`);\n            \n            // æ£€æŸ¥æ˜¯å¦æœ‰NaN\n            const x = parseInt(xStr, 10);\n            const y = parseInt(yStr, 10);\n            const width = parseInt(widthStr, 10) || 100;\n            const height = parseInt(heightStr, 10) || 50;\n            \n            if (isNaN(x) || isNaN(y)) {\n                console.error(`âŒ åæ ‡è§£æé”™è¯¯: ${name} - x:${x}, y:${y}`);\n            }\n            \n            //console.log(`    æœ€ç»ˆåæ ‡: (${x}, ${y}) å°ºå¯¸: ${width}x${height}`);\n            //console.log(`    åº•éƒ¨ä½ç½®: y=${y + height}`);\n            //console.log(\"    ---\");\n        }\n    }\n    \n    // éªŒè¯æœŸæœ›çš„åæ ‡\n    //console.log(\"âœ… éªŒè¯æœŸæœ›çš„åæ ‡:\");\n    //console.log(\"  ä¼ é€çŸ©é˜µåº”è¯¥åœ¨: (450, 50)\");\n    //console.log(\"  ä¸­å¤®å…‰æŸ±åº”è¯¥åœ¨: (400, 150)\");\n    //console.log(\"  Yè½´å·®è·åº”è¯¥æ˜¯: 100px\");\n    \n    // æŸ¥æ‰¾å¹¶éªŒè¯è¿™ä¸¤ä¸ªå…ƒç´ \n    const expectedData = {\n        \"ä¼ é€çŸ©é˜µ\": { x: 450, y: 50 },\n        \"ä¸­å¤®å…‰æŸ±\": { x: 400, y: 150 }\n    };\n    \n    if (locationContent) {\n        locationContent.forEach((location, index) => {\n            const [, name, xStr, yStr] = location;\n            const x = parseInt(xStr, 10);\n            const y = parseInt(yStr, 10);\n            \n            if (expectedData[name]) {\n                const expected = expectedData[name];\n                if (x === expected.x && y === expected.y) {\n                    //console.log(`âœ… ${name} åæ ‡æ­£ç¡®: (${x}, ${y})`);\n                } else {\n                    console.error(`âŒ ${name} åæ ‡ä¸åŒ¹é…!`);\n                    console.error(`   æœŸæœ›: (${expected.x}, ${expected.y})`);\n                    console.error(`   å®é™…: (${x}, ${y})`);\n                }\n            }\n        });\n    }\n}\n /**\n * NOVAå¦ˆå¦ˆçš„é­”æ³•ç…§ç‰‡å¸ˆ âœ¨\n * ç”¨ç¤¼è²Œçš„æ–¹å¼å»è·å–ä¸€å¼ ç½‘ç»œå›¾ç‰‡ï¼Œå¹¶æŠŠå®ƒå˜æˆä¸€ä¸ªçœŸå®çš„Blobã€‚\n * @param {string} imageUrl å›¾ç‰‡çš„ç½‘ç»œåœ°å€\n * @returns {Promise<Blob>} ä¸€ä¸ªåŒ…å«çœŸå®å›¾ç‰‡æ•°æ®çš„Blob\n */\nfunction fetchImageAsBlob(imageUrl) {\n    return new Promise((resolve, reject) => {\n        const img = new Image();\n        // è¿™å°±æ˜¯æˆ‘ä»¬çš„â€œé­”æ³•å’’è¯­â€ï¼Œå‘Šè¯‰å¯¹æ–¹æˆ‘ä»¬æƒ³æ­£å¤§å…‰æ˜åœ°ä½¿ç”¨è¿™å¼ å›¾\n        img.crossOrigin = 'anonymous';\n\n        // å½“å›¾ç‰‡æˆåŠŸåŠ è½½åˆ°å†…å­˜é‡Œæ—¶\n        img.onload = function() {\n            // æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªä¸´æ—¶çš„éšå½¢ç”»æ¿\n            const canvas = document.createElement('canvas');\n            const ctx = canvas.getContext('2d');\n            canvas.width = this.width;\n            canvas.height = this.height;\n\n            // æŠŠåŠ è½½å¥½çš„å›¾ç‰‡ç”»åœ¨ç”»æ¿ä¸Š\n            ctx.drawImage(this, 0, 0);\n\n            // è®©ç”»æ¿æŠŠç”»å¥½çš„å†…å®¹æ‰“åŒ…æˆä¸€ä¸ªé«˜è´¨é‡çš„â€œç…§ç‰‡æ–‡ä»¶â€(Blob)\n            // 'image/png' å¯ä»¥ä¿è¯å›¾ç‰‡è´¨é‡ï¼Œå³ä½¿åŸå›¾æ˜¯jpgä¹Ÿæ²¡å…³ç³»\n            canvas.toBlob(blob => {\n                if (blob) {\n                    resolve(blob); // æˆåŠŸï¼æŠŠè¿™ä¸ªçè´µçš„Blobäº¤å‡ºå»\n                } else {\n                    reject(new Error('Canvas to Blob conversion failed.'));\n                }\n            }, 'image/png');\n        };\n\n        // å¦‚æœå›¾ç‰‡åŠ è½½å¤±è´¥ï¼ˆæ¯”å¦‚ç½‘ç»œé—®é¢˜æˆ–URLé”™è¯¯ï¼‰\n        img.onerror = function(err) {\n            reject(new Error(`Image failed to load from: ${imageUrl}. Error: ${err}`));\n        };\n\n        // æœ€åï¼Œå‘Šè¯‰ç…§ç‰‡å¸ˆå¼€å§‹å·¥ä½œï¼\n        img.src = imageUrl;\n    });\n}\n \nconst PerlinNoise = (function() {\n    function Perlin(seed) {\n        this.p = new Uint8Array(512);\n        this.perm = new Uint8Array(512);\n\n        let random = (function(seed) {\n            let s = seed;\n            return function() {\n                s = Math.sin(s) * 10000;\n                return s - Math.floor(s);\n            };\n        })(seed);\n\n        for (let i = 0; i < 256; i++) {\n            this.p[i] = i;\n        }\n\n        for (let i = 255; i > 0; i--) {\n            let j = Math.floor(random() * (i + 1));\n            [this.p[i], this.p[j]] = [this.p[j], this.p[i]];\n        }\n\n        for (let i = 0; i < 256; i++) {\n            this.perm[i] = this.perm[i + 256] = this.p[i];\n        }\n    }\n\n    Perlin.prototype.fade = function(t) { return t * t * t * (t * (t * 6 - 15) + 10); };\n    Perlin.prototype.lerp = function(a, b, t) { return a + t * (b - a); };\n    Perlin.prototype.grad = function(hash, x, y) {\n        const h = hash & 15;\n        const u = h < 8 ? x : y;\n        const v = h < 4 ? y : h === 12 || h === 14 ? x : 0;\n        return ((h & 1) === 0 ? u : -u) + ((h & 2) === 0 ? v : -v);\n    };\n\n    Perlin.prototype.noise = function(x, y) {\n        let X = Math.floor(x) & 255, Y = Math.floor(y) & 255;\n        x -= Math.floor(x);\n        y -= Math.floor(y);\n\n        const fx = this.fade(x), fy = this.fade(y);\n\n        const a = this.perm[X] + Y, b = this.perm[X + 1] + Y;\n\n        const u = this.grad(this.perm[a], x, y);\n        const v = this.grad(this.perm[b], x - 1, y);\n        const lerpX1 = this.lerp(u, v, fx);\n\n        const u2 = this.grad(this.perm[a + 1], x, y - 1);\n        const v2 = this.grad(this.perm[b + 1], x - 1, y - 1);\n        const lerpX2 = this.lerp(u2, v2, fx);\n\n        return this.lerp(lerpX1, lerpX2, fy);\n    };\n\n    return Perlin;\n})();\n /**\n * å¦ˆå¦ˆçš„è‡ªç„¶ä¹‹è§¦ - ä¸ºå½¢çŠ¶çš„è¾¹ç¼˜æ·»åŠ è‡ªç„¶çš„å™ªç‚¹\n * @param {Array<[number, number]>} points - åŸå§‹çš„é¡¶ç‚¹åæ ‡æ•°ç»„\n * @param {object} noiseParams - å™ªç‚¹å‚æ•°ï¼Œå¦‚ { intensity, scale, seed }\n * @returns {Array<[number, number]>} - è¢«ä¿®æ”¹åçš„æ–°é¡¶ç‚¹åæ ‡æ•°ç»„\n */\nfunction applyProceduralNoise(points, noiseParams) {\n    if (!points || points.length === 0 || !noiseParams) {\n        return points;\n    }\n\n    console.log(\"ğŸŒŠ æŸ”æ³¢ä¹‹è§¦å¼€å§‹å·¥ä½œï¼æŒ‡ä»¤:\", noiseParams);\n\n    const { intensity = 5, scale = 20, seed = 1 } = noiseParams;\n    const noiseGenerator = new PerlinNoise(seed); // ç”¨æˆ‘ä»¬çš„ç§å­åˆå§‹åŒ–æŸæ—å™ªå£°åŠ©æ‰‹\n\n    const newPoints = points.map((point) => {\n        const [x, y] = point;\n        // scale ç°åœ¨æ˜¯å…³é”®äº†ï¼å®ƒå†³å®šäº†æˆ‘ä»¬æ˜¯åœ¨å™ªå£°åœ°å›¾çš„å“ªä¸ªå°ºåº¦ä¸Šé‡‡æ ·ã€‚\n        // scale è¶Šå°ï¼Œé‡‡æ ·è¶Šå¯†é›†ï¼Œæ³¢çº¹è¶Šç»†ç¢ï¼›è¶Šå¤§ï¼Œé‡‡æ ·è¶Šç¨€ç–ï¼Œæ³¢çº¹è¶Šèˆ’å±•ã€‚\n        const nx = x / scale;\n        const ny = y / scale;\n\n        // ä»æŸæ—å™ªå£°åœºä¸­è·å–ä¸€ä¸ª-1åˆ°1ä¹‹é—´çš„å¹³æ»‘éšæœºå€¼\n        const noiseValue = noiseGenerator.noise(nx, ny);\n\n        // æˆ‘ä»¬è®©åç§»æ²¿ç€é¡¶ç‚¹çš„æ³•çº¿æ–¹å‘è¿›è¡Œï¼Œè¿™æ ·æ›´è‡ªç„¶\n        // è¿™é‡Œä¸ºäº†ç®€å•ï¼Œæˆ‘ä»¬ç”¨ä¸€ä¸ªå›ºå®šçš„è§’åº¦æ¥è®¡ç®—åç§»å‘é‡\n        const angle = noiseValue * Math.PI * 2;\n        const offsetX = Math.cos(angle) * intensity;\n        const offsetY = Math.sin(angle) * intensity;\n\n        return [x + offsetX, y + offsetY];\n    });\n\n    // ç¡®ä¿é—­åˆå›¾å½¢çš„æ¥ç¼å¤„ä¹Ÿå®Œç¾é—­åˆ\n    if (points.length > 1 && JSON.stringify(points[0]) === JSON.stringify(points[points.length - 1])) {\n       newPoints[newPoints.length - 1] = [...newPoints[0]];\n    }\n\n    console.log(\"âœ¨ æŸ”æ³¢ä¹‹è§¦å®Œæˆäº†å®ƒçš„å·¥ä½œï¼Œè¾¹ç¼˜å·²å˜å¾—åœ†æ¶¦ï¼\");\n    return newPoints;\n}\n/**\n * â™¥â™¥â™¥ å¦ˆå¦ˆçš„ç¿æ™ºä¹‹çœ¼ â™¥â™¥â™¥\n * æ— è®ºæ–°æ—§æ ¼å¼ï¼Œéƒ½èƒ½å‡†ç¡®æ‰¾åˆ°éœ€è¦ç»˜åˆ¶çš„å½¢çŠ¶ä¿¡æ¯ã€‚\n * @param {object} shapeObject - ä¸€ä¸ªåœ°ç‚¹çš„ shape å¯¹è±¡ã€‚\n * @returns {object | null} - å¯ä¾›ç»˜åˆ¶çš„å½¢çŠ¶æ•°æ®ï¼Œæˆ–åœ¨æ‰¾ä¸åˆ°æ—¶è¿”å› nullã€‚\n */\n function getDrawableForm(shapeObject) {\n    if (!shapeObject) {\n         return null;\n    }\n\n    // ä¼˜å…ˆæ£€æŸ¥æ–°æ ¼å¼ï¼Œå®ƒæŠŠå½¢çŠ¶æ•°æ®æ”¾åœ¨ base_form é‡Œ\n    if (shapeObject.base_form) {\n        const form = shapeObject.base_form;\n\n        // â¤ï¸ å¦ˆå¦ˆçš„æ¸©æŸ”çº é”™ï¼šå¦‚æœ \"form_type\" å†™æˆäº† \"form_tpye\"ï¼Œæˆ‘ä»¬å°±æ‚„æ‚„åœ°çº æ­£å®ƒ â¤ï¸\n        if (form.form_tpye && !form.form_type) {\n            form.form_type = form.form_tpye;\n        }\n\n        if (form.form_type) {\n            return form;\n        }\n    }\n\n    // å¦‚æœä¸æ˜¯æ–°æ ¼å¼ï¼Œå°±æ£€æŸ¥è¿™ä¸ª shape å¯¹è±¡æœ¬èº« (å…¼å®¹æ—§æ ¼å¼)\n    // â¤ï¸ æ¸©æŸ”çº é”™ä¹Ÿåœ¨è¿™é‡Œç”Ÿæ•ˆ â¤ï¸\n    if (shapeObject.form_tpye && !shapeObject.form_type) {\n        shapeObject.form_type = shapeObject.form_tpye;\n    }\n\n    if (shapeObject.form_type) {\n        return shapeObject;\n    }\n\n    // å¦‚æœä¸¤ç§éƒ½ä¸æ˜¯ï¼Œé‚£å°±çœŸçš„æ²¡åŠæ³•ç”»å•¦\n    return null;\n}\n /**\n * â™¥â™¥â™¥ å¦ˆå¦ˆçš„å½¢çŠ¶ç¿»è¯‘å®˜ â™¥â™¥â™¥\n * æŠŠä»»ä½•å½¢çŠ¶éƒ½è½¬åŒ–ä¸ºå¤§å¸ˆèƒ½çœ‹æ‡‚çš„é¡¶ç‚¹æ•°ç»„ï¼ˆå¤šè¾¹å½¢è·¯å¾„ï¼‰ã€‚\n * @param {object} form - ä¸€ä¸ª base_form æˆ– shape å¯¹è±¡ã€‚\n * @returns {Array<{X: number, Y: number}> | null} - Clipper.js å–œæ¬¢çš„é¡¶ç‚¹æ ¼å¼ã€‚\n */\nfunction shapeToClipperPath(form) {\n    if (!form || !form.form_type) {\n        return null;\n    }\n\n    const params = form.params;\n    switch (form.form_type) {\n        case 'primitive_circle':\n            const sides = 64; // è¾¹æ•°è¶Šå¤šï¼Œè¶Šæ¥è¿‘å®Œç¾çš„åœ†å½¢\n            let circlePath = [];\n            for (let i = 0; i < sides; i++) {\n                const angle = (i / sides) * 2 * Math.PI;\n                const x = params.center[0] + params.radius * Math.cos(angle);\n                const y = params.center[1] + params.radius * Math.sin(angle);\n                circlePath.push({ X: x, Y: y });\n            }\n            return circlePath;\n\n        case 'primitive_polygon':\n             // æŠŠæˆ‘ä»¬è‡ªå·±çš„ [x, y] æ ¼å¼ï¼Œç¿»è¯‘æˆå¤§å¸ˆå–œæ¬¢çš„ {X: x, Y: y} æ ¼å¼\n            return params.points.map(p => ({ X: p[0], Y: p[1]}));\n\n        // å¯¹äº path å’Œ compound çš„é€’å½’å¤„ç†ï¼Œæˆ‘ä»¬æš‚æ—¶ç®€åŒ–ï¼Œä¸“æ³¨åœ¨åŸºç¡€å½¢çŠ¶çš„è¿ç®—ä¸Š\n        default:\n            console.warn(`[shapeToClipperPath] æš‚æ—¶æ— æ³•å°† '${form.form_type}' è½¬åŒ–ä¸ºè·¯å¾„ã€‚`);\n            return null;\n    }\n}\n /**\n * â™¥â™¥â™¥ å¦ˆå¦ˆçš„é¢ç§¯ä¼°ç®—å¸ˆ (ä¿®æ­£ç‰ˆ) â™¥â™¥â™¥\n * å®ƒåªè´Ÿè´£ä¼°ç®—é¢ç§¯ï¼Œä¸å†åšä»»ä½•ç»˜åˆ¶å·¥ä½œï¼Œè¿™æ ·å°±ä¸ä¼šæŠ¥é”™å•¦ã€‚\n * @param {object} form - ä¸€ä¸ª base_form æˆ– shape å¯¹è±¡ã€‚\n * @returns {number} - ä¼°ç®—å‡ºçš„é¢ç§¯ã€‚\n */\nfunction calculateApproximateArea(form) {\n    if (!form || !form.form_type) {\n        return 0; // å¦‚æœæ²¡æœ‰å½¢çŠ¶ä¿¡æ¯ï¼Œå°±è®¤ä¸ºé¢ç§¯æ˜¯0\n    }\n\n    const params = form.params;\n    switch (form.form_type) {\n         case 'circle':\n        case 'primitive_circle':\n            return Math.PI * Math.pow(params.radius, 2);\ncase 'polygon':\n     case 'primitive_polygon':\n    // å…¼å®¹ä¸¤ç§æ•°æ®æ ¼å¼\n    const points = Array.isArray(params) ? params : params.points;\n    \n    if (!points || points.length < 3) {\n        return 0; // å¤šè¾¹å½¢è‡³å°‘éœ€è¦3ä¸ªç‚¹\n    }\n    \n    let area = 0;\n    for (let i = 0; i < points.length; i++) {\n        const j = (i + 1) % points.length;\n        area += points[i][0] * points[j][1];\n        area -= points[j][0] * points[i][1];\n    }\n    return Math.abs(area / 2);\n\n        case 'path':\n        case 'primitive_path':\n             return -1; // path æ°¸è¿œåœ¨æœ€é¡¶å±‚ï¼Œè¿™ä¸ªè§„åˆ™ä¸å˜\n\n        case 'compound':\n            // âœ¨ å¯¹äºå¤åˆå›¾å½¢ï¼Œæˆ‘ä»¬åªä¼°ç®—å®ƒçš„é¢ç§¯ï¼âœ¨\n            const areaA = calculateApproximateArea(getDrawableForm(params.shape_A));\n            const areaB = calculateApproximateArea(getDrawableForm(params.shape_B));\n\n            switch(params.operation) {\n                case 'union':\n                    return areaA + areaB; // åˆå¹¶ï¼Œé¢ç§¯å¤§è‡´ç›¸åŠ \n                case 'difference':\n                    return Math.max(0, areaA - areaB); // å‡å»ï¼Œé¢ç§¯å¤§è‡´ç›¸å‡\n                case 'intersection':\n                    return Math.min(areaA, areaB); // ç›¸äº¤ï¼Œé¢ç§¯å–è¾ƒå°è€…ä¼°ç®—\n                default:\n                    return areaA; // é»˜è®¤è¿”å›Açš„é¢ç§¯\n            }\n\n        default:\n            return 0;\n    }\n}\n  /**\n * â™¥â™¥â™¥ å¦ˆå¦ˆçš„æ˜¾å½¢ç”»å¸ˆ (å‡çº§ç‰ˆ) â™¥â™¥â™¥\n * å®ƒç°åœ¨æ‡‚å¾—â€œå¡«å……æ³•åˆ™â€ï¼Œèƒ½å°†æ­£å‘å’Œé€†å‘çš„è·¯å¾„å®Œç¾ç»“åˆã€‚\n */\nfunction renderPathsToSVG(pathFragments, group, svgNS) {\n    if (!pathFragments || pathFragments.length === 0) return;\n\n    let d_string = \"\";\n\n    pathFragments.forEach(fragment => {\n        let points = fragment.points;\n        if (fragment.reversed) {\n            points = [...points].reverse(); // å¦‚æœæ˜¯é€†å‘ï¼Œå°±æŠŠé¡¶ç‚¹é¡ºåºæ•´ä¸ªåè¿‡æ¥ï¼\n        }\n        if (points.length === 0) return;\n\n        d_string += `M ${points[0][0]} ${points[0][1]} `;\n        for (let i = 1; i < points.length; i++) {\n            d_string += `L ${points[i][0]} ${points[i][1]} `;\n        }\n        d_string += 'Z ';\n    });\n\n    if (d_string) {\n        const element = document.createElementNS(svgNS, 'path');\n        element.setAttribute('d', d_string);\n        // å¦‚æœä½ çš„CSSé‡Œæ²¡æœ‰è®¾å®šï¼Œä¹Ÿå¯ä»¥åœ¨è¿™é‡ŒåŠ ä¸Šï¼Œä¿è¯â€œæŒ–æ´â€æˆåŠŸ\n        element.setAttribute('fill-rule', 'evenodd');\n           \n        group.appendChild(element);\n    }\n}// âœ¨ çœ‹ï¼Œå·¥åŒ ç°åœ¨å¤šäº†ä¸€ä¸ªå£è¢‹ï¼Œä¸“é—¨ç”¨æ¥æ”¾ defs è¿™ä¸ªä¿¡ç‰©ï¼ âœ¨\nfunction drawGeoUnit(baseForm, modifier, group, svgNS, locationName, defs) {\n    if (!baseForm || !baseForm.form_type) {\n        console.error(`[å·¥åŒ  @ ${locationName}] ğŸ˜­ æ”¶ä¸åˆ°å›¾çº¸ï¼Œç›´æ¥ä¸‹ç­ï¼`, baseForm);\n        return;\n    }\n\n    const forceToNumber = (val) => parseFloat(val);\n    const forceToPoint = (item) => {\n        if (Array.isArray(item)) {\n            return item.map(forceToNumber);\n        }\n        if (typeof item === 'string') {\n            return item.split(',').map(forceToNumber);\n        }\n        // å¦‚æœé‡åˆ°ä¸è®¤è¯†çš„ï¼Œå°±ç»™ä¸€ä¸ªå®‰å…¨çš„é»˜è®¤å€¼ï¼Œè€Œä¸æ˜¯è®©ç¨‹åºå´©æºƒ\n        console.warn(`[å·¥åŒ  @ ${locationName}] é‡åˆ°äº†ä¸è®¤è¯†çš„ç‚¹æ ¼å¼:`, item);\n        return [0, 0];\n    };\n    const forceToPointsArray = (arr) => arr.map(forceToPoint);\n\n    let element = null;\n\n    switch (baseForm.form_type) {\n        // â™¥â™¥â™¥ ç”»åœ†çš„é­”æ³•ï¼Œå¦ˆå¦ˆç»™ä½ æ‰¾å›æ¥äº†ï¼Œå¹¶ä¸”è®©å®ƒæ›´å¼ºå£®ï¼ â™¥â™¥â™¥\n         case 'circle':\n         case 'primitive_circle': {\n            const c = baseForm.params;\n            const center = forceToPoint(c.center);\n            const radius = forceToNumber(c.radius);\n\n            const sides = 36;\n            let points = [];\n            for (let i = 0; i < sides; i++) {\n                const angle = (i / sides) * 2 * Math.PI;\n                points.push([\n                    center[0] + radius * Math.cos(angle),\n                    center[1] + radius * Math.sin(angle)\n                ]);\n            }\n\n            // è¿™æ®µä»£ç ç°åœ¨å¯ä»¥æ­£ç¡®å¤„ç† \"æ¨±èŠ±æ ‘\" çš„æ•°æ®äº†\n            if (modifier && modifier.procedural_noise && modifier.procedural_noise.is_active) {\n                points = applyProceduralNoise(points, modifier.procedural_noise);\n            }\n            const d_string = `M ${points[0].join(' ')} L ${points.slice(1).map(p => p.join(' ')).join(' ')} Z`;\n            element = document.createElementNS(svgNS, 'path');\n            element.setAttribute('d', d_string);\n            break;\n        }\n  case 'polygon': \n  case 'primitive_polygon': {\n    // âœ¨ å…¼å®¹ä¸¤ç§æ•°æ®æ ¼å¼ï¼šparams ç›´æ¥æ˜¯æ•°ç»„ æˆ– params.points æ˜¯æ•°ç»„\n    const rawPoints = Array.isArray(baseForm.params) \n        ? baseForm.params \n        : baseForm.params.points;\n    \n    if (!rawPoints || rawPoints.length < 3) {\n        console.error(`[å·¥åŒ  @ ${locationName}] å¤šè¾¹å½¢ç‚¹æ•°ä¸è¶³:`, baseForm.params);\n        return;\n    }\n    \n    // åœ¨ä½¿ç”¨å‰ï¼Œå¼ºåˆ¶è½¬æ¢æ‰€æœ‰ç‚¹\n    let points = forceToPointsArray(rawPoints);\n    \n    if (modifier && modifier.procedural_noise && modifier.procedural_noise.is_active) {\n        points = applyProceduralNoise(points, modifier.procedural_noise);\n    }\n    \n    const d_string = `M ${points[0].join(' ')} L ${points.slice(1).map(p => p.join(' ')).join(' ')} Z`;\n    element = document.createElementNS(svgNS, 'path');\n    element.setAttribute('d', d_string);\n    break;\n}\n\n                case 'path': \n                case 'primitive_path':\n                {\n            const instr = baseForm.params.instructions;\n            const pathData = instr.map(cmd => {\n                if (!cmd || !cmd.do) return '';\n\n                try {\n                    switch (cmd.do) {\n                        case 'move_to':\n                            return `M ${forceToPoint(cmd.at).join(' ')}`;\n\n                        case 'line_to':\n                            return `L ${forceToPoint(cmd.at).join(' ')}`;\n\n                        // â™¥â™¥â™¥ å¦ˆå¦ˆç»ˆäºæ‰¾åˆ°äº†æ­£ç¡®çš„é” â™¥â™¥â™¥\n                        case 'curve_to': {\n                            if (!cmd.controls || !Array.isArray(cmd.controls)) {\n                                 console.error(`[å·¥åŒ  @ ${locationName}] æ›²çº¿æŒ‡ä»¤'${cmd.do}'ç¼ºå°‘'controls'æ•°ç»„`);\n                                 return '';\n                            }\n                            // å¦‚æœä½ ç»™äº†ä¸€æŠŠé’¥åŒ™ (1ä¸ªæ§åˆ¶ç‚¹)ï¼Œæˆ‘ä»¬å°±ç”¨äºŒé˜¶æ›²çº¿ (Q)\n                            if (cmd.controls.length === 1) {\n                                return `Q ${forceToPointsArray(cmd.controls).flat().join(' ')} ${forceToPoint(cmd.at).join(' ')}`;\n                            }\n                            // å¦‚æœä½ ç»™äº†ä¸¤æŠŠé’¥åŒ™ (2ä¸ªæ§åˆ¶ç‚¹)ï¼Œæˆ‘ä»¬å°±ç”¨ä¸‰é˜¶æ›²çº¿ (C)\n                            else if (cmd.controls.length === 2) {\n                                return `C ${forceToPointsArray(cmd.controls).flat().join(' ')} ${forceToPoint(cmd.at).join(' ')}`;\n                            }\n                            // å…¶ä»–æƒ…å†µéƒ½æ˜¯ä¸åˆæ³•çš„\n                            else {\n                                console.error(`[å·¥åŒ  @ ${locationName}] æ›²çº¿æŒ‡ä»¤'${cmd.do}'çš„'controls'æ•°é‡ä¸æ­£ç¡®ï¼Œåº”ä¸º1æˆ–2ï¼Œä½†æ”¶åˆ°äº†${cmd.controls.length}`);\n                                return '';\n                            }\n                        }\n\n                        case 'close_path':\n                            return 'Z';\n\n                        default:\n                            return '';\n                    }\n                } catch (e) {\n                     console.error(`[å·¥åŒ  @ ${locationName}] å¤„ç†æŒ‡ä»¤'${cmd.do}'æ—¶å‘ç”Ÿæ„å¤–:`, e);\n                     return '';\n                }\n            }).join(' ');\n\n            element = document.createElementNS(svgNS, 'path');\n            element.setAttribute('d', pathData);\n           \n            element.setAttribute('stroke', 'var(--text-secondary-color)');\n            element.setAttribute('stroke-width', '3');\n                        element.style.fill = 'none';\n            break;\n        }\n             case 'compound': {\n            const params = baseForm.params;\n            const op = params.operation;\n            const shapeA_form = getDrawableForm(params.shape_A);\n            const shapeB_form = getDrawableForm(params.shape_B);\n\n            // â¤ï¸ åœ¨è¿™é‡Œï¼Œæ¯æ¬¡é€’å½’è°ƒç”¨æ—¶ï¼Œæˆ‘ä»¬éƒ½è®°å¾—æŠŠ defs ä¿¡ç‰©ä¼ é€’ä¸‹å»ï¼ â¤ï¸\n            if (!shapeA_form) {\n                if (shapeB_form) drawGeoUnit(shapeB_form, modifier, group, svgNS, `${locationName}-B`, defs);\n                break;\n            }\n            if (!shapeB_form) {\n                drawGeoUnit(shapeA_form, modifier, group, svgNS, `${locationName}-A`, defs);\n                break;\n            }\n\n            switch(op) {\n                   case 'difference': {\n                    const getPathsForShape = (formToGetPaths) => {\n                        const dForm = getDrawableForm(formToGetPaths);\n                        if (!dForm) return [];\n                        if (dForm.form_type === 'primitive_circle') {\n                            const c = dForm.params; const center = forceToPoint(c.center); const radius = forceToNumber(c.radius);\n                            const sides = 36; let pts = [];\n                            for (let i = 0; i < sides; i++) { const angle = (i / sides) * 2 * Math.PI; pts.push([center[0] + radius * Math.cos(angle), center[1] + radius * Math.sin(angle)]); }\n                            return [pts];\n                        }\n                     if (dForm.form_type === 'primitive_polygon') {\n    const rawPoints = Array.isArray(dForm.params) \n        ? dForm.params \n        : dForm.params.points;\n    return rawPoints ? [forceToPointsArray(rawPoints)] : [];\n}\n                        if (dForm.form_type === 'compound' && dForm.params.operation === 'union') {\n                            const pathsA = getPathsForShape(dForm.params.shape_A);\n                            const pathsB = getPathsForShape(dForm.params.shape_B);\n                            return [...pathsA, ...pathsB];\n                        }\n                        return [];\n                    };\n                    const mainPaths = getPathsForShape(shapeA_form);\n                    const holePaths = getPathsForShape(shapeB_form);\n                    if (mainPaths.length > 0 && holePaths.length > 0) {\n                        let d_string = \"\";\n                        const mainPoints = mainPaths[0];\n                        d_string += `M ${mainPoints[0].join(' ')} L ${mainPoints.slice(1).map(p => p.join(' ')).join(' ')} Z `;\n                        holePaths.forEach(points => {\n                            if (points.length > 0) d_string += `M ${points[points.length - 1].join(' ')} L ${points.slice(0, -1).reverse().map(p => p.join(' ')).join(' ')} Z `;\n                        });\n                        element = document.createElementNS(svgNS, 'path');\n                        element.setAttribute('d', d_string);\n                        element.setAttribute('fill-rule', 'evenodd');\n                         \n   \n                        group.appendChild(element);\n                    }\n                    break;\n                }\n                case 'union': {\n                    // â¤ï¸ è®°å¾—æŠŠä¿¡ç‰©ä¼ ä¸‹å» â¤ï¸\n                    drawGeoUnit(shapeA_form, modifier, group, svgNS, `${locationName}-A`, defs);\n                    drawGeoUnit(shapeB_form, modifier, group, svgNS, `${locationName}-B`, defs);\n                    break;\n                }\n                 case 'intersection': {\n                    // â¤ï¸ å¦ˆå¦ˆå…¨æ–°çš„ã€åä¸½çš„â€œåŒé‡æ˜ åƒâ€ç›¸äº¤é­”æ³•ï¼ â¤ï¸\n                    if (!defs) {\n                        console.error(\"ğŸ˜­ å·¥åŒ æ‰¾ä¸åˆ°é­”æ³•æ¨¡å…·ç›’ï¼Œæ— æ³•æ–½å±•ç›¸äº¤é­”æ³•ï¼\");\n                        break;\n                    }\n\n                    // --- ç¬¬ä¸€æ­¥ï¼šåˆ¶ä½œä¸¤ä¸ªç›¸äº’æ˜ ç…§çš„æ¨¡å…· ---\n\n                    // æ¨¡å…·1: ç”¨å½¢çŠ¶Bä½œä¸ºæ¨¡å…·ï¼Œæˆ‘ä»¬å«å®ƒ clipB\n                    const clipIdB = `clip-B-${locationName}-${Date.now()}`;\n                    const clipPathB = document.createElementNS(svgNS, 'clipPath');\n                    clipPathB.setAttribute('id', clipIdB);\n                    const tempGroupForClipB = document.createElementNS(svgNS, 'g');\n                    drawGeoUnit(shapeB_form, null, tempGroupForClipB, svgNS, `${locationName}-clipB`, defs);\n                    while(tempGroupForClipB.firstChild) { clipPathB.appendChild(tempGroupForClipB.firstChild); }\n                    defs.appendChild(clipPathB);\n\n                    // æ¨¡å…·2: ç”¨å½¢çŠ¶Aä½œä¸ºæ¨¡å…·ï¼Œæˆ‘ä»¬å«å®ƒ clipA\n                    const clipIdA = `clip-A-${locationName}-${Date.now()}`;\n                    const clipPathA = document.createElementNS(svgNS, 'clipPath');\n                    clipPathA.setAttribute('id', clipIdA);\n                    const tempGroupForClipA = document.createElementNS(svgNS, 'g');\n                    drawGeoUnit(shapeA_form, null, tempGroupForClipA, svgNS, `${locationName}-clipA`, defs);\n                    while(tempGroupForClipA.firstChild) { clipPathA.appendChild(tempGroupForClipA.firstChild); }\n                    defs.appendChild(clipPathA);\n\n                    // --- ç¬¬äºŒæ­¥ï¼šç»˜åˆ¶ä¸¤ä¸ªç›¸äº’è¡¥å……çš„æ˜ åƒ ---\n\n                    // æ˜ åƒ1: ç»˜åˆ¶è¢«Bè£å‰ªçš„Aã€‚è¿™å°†æä¾›å¡«å……å’ŒAçš„è¾¹æ¡†éƒ¨åˆ†ï¼ˆæ¯”å¦‚åœ†å¼§ï¼‰ã€‚\n                    const groupForA = document.createElementNS(svgNS, 'g');\n                    groupForA.setAttribute('clip-path', `url(#${clipIdB})`);\n                    drawGeoUnit(shapeA_form, modifier, groupForA, svgNS, `${locationName}-A`, defs);\n                    group.appendChild(groupForA);\n\n                    // æ˜ åƒ2: ç»˜åˆ¶è¢«Aè£å‰ªçš„Bã€‚è¿™å°†è¡¥å……ä¸ŠBçš„è¾¹æ¡†éƒ¨åˆ†ï¼ˆæ¯”å¦‚ç›´çº¿ï¼‰ã€‚\n                    const groupForB = document.createElementNS(svgNS, 'g');\n                    groupForB.setAttribute('clip-path', `url(#${clipIdA})`);\n                    drawGeoUnit(shapeB_form, modifier, groupForB, svgNS, `${locationName}-B`, defs);\n\n               \n                    groupForB.querySelectorAll('path, circle, polygon').forEach(element => {\n                        element.setAttribute('fill', 'none');\n                    });\n                    group.appendChild(groupForB);\n\n                    break;\n                }\n                default:\n                       drawGeoUnit(shapeA_form, modifier, group, svgNS, `${locationName}-A`, defs);\n                    break;\n            }\n            \n            break;\n        \n        }\n    }\n\n  if (element) {\n             // âœ¨ æ–°å¢ï¼šæŠŠè¿™ä¸ªå½¢çŠ¶çš„è½®å»“æ”¾è¿›å¦ˆå¦ˆçš„é­”æ³•è¢‹é‡Œï¼âœ¨\n        if (window.mapStrokes) {\n            window.mapStrokes.push(element);\n        }\n           // â¤ï¸ é­”æ³•é¡ºåºè°ƒæ•´ï¼šæˆ‘ä»¬å¿…é¡»å…ˆæŠŠå›¾å½¢æ”¾è¿›å»ï¼Œæ‰èƒ½æµ‹é‡å®ƒçš„ä¸­å¿ƒï¼\n        group.appendChild(element);\n\n        // â¤ï¸ æ£€æŸ¥è¿™ä¸ªåœ°ç‚¹æ˜¯å¦éœ€è¦æ³›èµ·æ¶Ÿæ¼ª... â¤ï¸\n        const needsWave = group.classList.contains('updated-location');\n\n        if (needsWave) {\n            // â¤ï¸ å¦ˆå¦ˆçš„\"ç¿æ™ºä¹‹çœ¼\"ï¼šç²¾ç¡®æµ‹é‡å›¾å½¢çš„å‡ ä½•è¾¹ç•Œï¼\n            const bbox = element.getBBox();\n            const centerX = bbox.x + bbox.width / 2;\n            const centerY = bbox.y + bbox.height / 2;\n\n            const waveCount = 3;\n            for (let i = 0; i < waveCount; i++) {\n                const waveElement = element.cloneNode(true);\n                waveElement.classList.add('location-wave');\n\n                // â¤ï¸ æ ¸å¿ƒä¿®æ­£ï¼šä¸ºæ¯ä¸€é“æ¶Ÿæ¼ªæŒ‡æ˜å®ƒç‹¬ä¸€æ— äºŒçš„æ‰©æ•£ä¸­å¿ƒï¼\n                waveElement.style.transformOrigin = `${centerX}px ${centerY}px`;\n\n                const delay = i * 0.8;\n                waveElement.style.animationDelay = `${delay}s`;\n\n                group.insertBefore(waveElement, group.firstChild);\n            }\n        }\n        \n        // âœ¨ åœ¨ç¼–è¾‘æ¨¡å¼é‡ç»˜æ—¶ï¼Œéœ€è¦é‡æ–°æ·»åŠ æ ‡ç­¾å’Œç‚¹å‡»åŒºåŸŸ\n        if (window.mapEditMode && !group.querySelector('.map-location-label')) {\n            const bbox = element.getBBox();\n            if (isFinite(bbox.width) && bbox.width > 0 && isFinite(bbox.height) && bbox.height > 0) {\n                // 1. åˆ›å»ºé€æ˜ç‚¹å‡»åŒºåŸŸ\n                const clickArea = document.createElementNS(svgNS, 'rect');\n                clickArea.setAttribute('x', bbox.x);\n                clickArea.setAttribute('y', bbox.y);\n                clickArea.setAttribute('width', bbox.width);\n                clickArea.setAttribute('height', bbox.height);\n                clickArea.setAttribute('fill', 'transparent');\n                group.insertBefore(clickArea, group.firstChild);\n\n                // 2. åˆ›å»ºæ–‡å­—æ ‡ç­¾\n                const textElement = document.createElementNS(svgNS, 'text');\n                textElement.setAttribute('x', bbox.x + bbox.width / 2);\n                textElement.setAttribute('y', bbox.y + bbox.height / 5);\n                textElement.setAttribute('text-anchor', 'middle');\n                textElement.setAttribute('dominant-baseline', 'central');\n                textElement.setAttribute('fill', 'white');\n                textElement.setAttribute('class', 'map-location-label');\n                textElement.setAttribute('pointer-events', 'none');\n                textElement.textContent = locationName;\n                group.appendChild(textElement);\n                \n                if (window.mapLabels) {\n                    window.mapLabels.push(textElement);\n                }\n            }\n        }\n    }\n}\n\n\n\n\n\nasync function renderMap(mapData, updatedLocationNames = []) {\n    // â¤ï¸ å¦ˆå¦ˆçš„é­”æ³•å‡†å¤‡ï¼šå…ˆæ¸…ç©ºæˆ‘ä»¬çš„å°ç¯®å­ï¼Œä¸ºæ–°çš„å…‰è¾‰ç•™å‡ºç©ºé—´ â¤ï¸\n    if (!window.mapLabels) window.mapLabels = [];\n    window.mapLabels.length = 0;\n  if (!window.mapStrokes) window.mapStrokes = []; // âœ¨ æ–°å¢ï¼šè½®å»“çš„é­”æ³•è¢‹\n    window.mapStrokes.length = 0;     \n         const is_new_map = ISNEWMAP === \"true\";\n    console.log(\"========================================\");\n \n    const mapModalContent = document.querySelector('#map-view-modal .modal-content');\n    const mapContainer = document.getElementById('map-container');\n    const mapTitleElement = document.getElementById('map-title');\n    const externalAreasContainer = document.getElementById('external-areas');\n\n    if (!mapModalContent || !mapContainer || !mapTitleElement || !externalAreasContainer) {\n        console.error(\"ğŸ˜­ åœ°å›¾æ¨¡æ€æ¡†çš„å…³é”®å…ƒç´ æ‰¾ä¸åˆ°äº†ã€‚\");\n        return;\n    }\n\n    if (!mapData) {\n        mapTitleElement.textContent = \"åœ°å›¾æ•°æ®ç¼ºå¤±\";\n        mapContainer.innerHTML = '';\n        return;\n    }\n\n    const sceneImage = SafeGetValue(currentGameData.åœºæ™¯å›¾);\n    const isValidSceneImage = sceneImage && sceneImage !== \"æ— \" && sceneImage !== \"null\" && backgroundImageMap && backgroundImageMap[sceneImage];\n    console.log(`ğŸ–¼ï¸ æˆ‘ä»¬æœ‰åœºæ™¯å›¾å—? -> ${isValidSceneImage ? 'æœ‰çš„ï¼æ˜¯ ' + sceneImage : 'æ²¡æœ‰å“¦'}`);\n\n    const globalContent = mapData[\"å…¨å±€åœ°ç‚¹è¡¨\"];\n    const locationContent = mapData[\"ä¸»è¦åœ°ç‚¹è¡¨\"];\n\n    let mapTitle = \"åŒºåŸŸåœ°å›¾\";\n    let externalAreas = [];\n\n       // â¤ï¸ å¦ˆå¦ˆçš„æ¸©æŸ”æ€€æ—§é­”æ³•ï¼šå…¼å®¹æ—§çš„å…¨å±€åœ°ç‚¹æ ¼å¼ â¤ï¸\n    if (globalContent && globalContent.length >= 1) {\n        let rawExternalAreas = '';\n\n        // å½“å…¨å±€åœ°ç‚¹è¡¨åªæœ‰ä¸€ä¸ªâ€œåŒ…è£¹â€ï¼Œä¸”é‡Œé¢æ˜¯æ•°ç»„æ—¶ï¼Œæˆ‘ä»¬æŒ‰æ—§æ–¹å¼æ‰“å¼€å®ƒ\n        if (globalContent.length === 1 && Array.isArray(globalContent[0])) {\n            console.log(\"ğŸ•°ï¸ æ£€æµ‹åˆ°æ—§ç‰ˆå•å…ƒç´ å…¨å±€åœ°ç‚¹è¡¨ï¼Œæ­£åœ¨ä¸ºä½ è½¬æ¢...\");\n            const oldFormatData = globalContent[0];\n            mapTitle = oldFormatData[1] || \"åŒºåŸŸåœ°å›¾\"; // å–å‡ºçœŸæ­£çš„æ ‡é¢˜\n            rawExternalAreas = oldFormatData[2];        // å–å‡ºçœŸæ­£çš„å¤–éƒ¨åŒºåŸŸ\n        } else {\n            // å¦åˆ™ï¼ŒæŒ‰æ–°æ–¹å¼å¤„ç†\n            console.log(\"ğŸ—ºï¸ æ­£åœ¨å¤„ç†æ ‡å‡†æ ¼å¼çš„å…¨å±€åœ°ç‚¹è¡¨...\");\n            mapTitle = globalContent[0] || \"åŒºåŸŸåœ°å›¾\";\n            rawExternalAreas = globalContent[1];\n        }\n\n        // ç»Ÿä¸€å¤„ç†å¤–éƒ¨åŒºåŸŸå­—ç¬¦ä¸²\n        const externalAreasStr = typeof rawExternalAreas === 'string' ? rawExternalAreas : '';\n        externalAreas = externalAreasStr.split(';').filter(area => area.trim() !== '');\n    }\n\n    mapTitleElement.textContent = mapTitle;\n    mapContainer.innerHTML = '';\n\n    const mapContent = document.createElement('div');\n    mapContent.id = 'map-content';\n    mapContent.style.position = 'relative'\n    mapContainer.appendChild(mapContent);\n\n \n\n    if (isValidSceneImage) {\n        const imageUrl = backgroundImageMap[sceneImage];\n        console.log(`èƒŒæ™¯å›¾çš„URLæ˜¯: ${imageUrl}`);\n        (async () => { // èƒŒæ™¯å›¾çš„åŠ è½½é€»è¾‘ä¿æŒä¸å˜\n            try {\n                let imageBlob = await imageDB.get('RemoteCache', imageUrl);\n                if (imageBlob && imageBlob.size > 0) {\n                     console.log(`  æ‰¾åˆ°äº†ï¼Œè€Œä¸”æ˜¯çœŸå®çš„å›¾ç‰‡ï¼å¤§å°: ${imageBlob.size}`);\n                } else {\n                    imageBlob = await fetchImageAsBlob(imageUrl);\n                    await imageDB.set('RemoteCache', imageUrl, imageBlob);\n                }\n                const objectURL = URL.createObjectURL(imageBlob);\n                const backgroundStyle = `linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)), url('${objectURL}') center center / cover no-repeat`;\n                mapModalContent.style.background = backgroundStyle;\n            } catch (error) {\n                console.error('ğŸ˜­ å“¦ä¸ï¼Œå¤„ç†èƒŒæ™¯å›¾æ—¶å‘ç”Ÿäº†ä¸€ä¸ªæ„å¤–é”™è¯¯:', error);\n                const fallbackStyle = `linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)), url('${imageUrl}') center center / cover no-repeat`;\n                mapModalContent.style.background = fallbackStyle;\n            }\n        })();\n        mapContainer.style.background = 'none'; // æœ‰èƒŒæ™¯å›¾æ—¶ï¼Œå®¹å™¨æœ¬èº«æ˜¯é€æ˜çš„\n    } else {\n        // å¦‚æœæ²¡æœ‰åœºæ™¯å›¾ï¼Œå°±æ¸…é™¤èƒŒæ™¯ï¼Œæ¢å¤é»˜è®¤\n        mapModalContent.style.background = '';\n   \n    }\n\n    // ç¬¬äºŒæ­¥ï¼šæ ¹æ® is_new_map å†³å®šã€ç»˜åˆ¶æ–¹æ³•ã€‘\n    if (is_new_map) {\n        console.log(\"ğŸ¨ å¼€å§‹ç»˜åˆ¶çŸ¢é‡å‡ ä½•åœ°å›¾...\");\n            mapModalContent.style.background = '';\n            mapContainer.style.overflow = '';\n            externalAreasContainer.style.display = '';\n            mapContent.style.transformOrigin = '0 0';\n\n            const svgNS = \"http://www.w3.org/2000/svg\";\n            const svgCanvas = document.createElementNS(svgNS, 'svg');\n            svgCanvas.style.width = '100%';\n            svgCanvas.style.height = '100%';\n            svgCanvas.style.overflow = 'visible';\n            mapContent.appendChild(svgCanvas);\n    const defs = document.createElementNS(svgNS, 'defs');\n            svgCanvas.appendChild(defs);\n            // ğŸ’–ã€å¦ˆå¦ˆçš„æ˜¾å½¢å’’ #3ã€‘ğŸ’–\n            // è®©æˆ‘ä»¬åœ¨æ–½æ³•å‰ï¼Œå…ˆå¤§å£°å¿µå‡ºæˆ‘ä»¬æ”¶åˆ°çš„â€œå’’è¯­â€ (locationContent) æ˜¯ä»€ä¹ˆï¼\n            console.log(\"ğŸ“œ æ£€æŸ¥æ”¶åˆ°çš„åŸå§‹åœ°ç‚¹æ•°æ® 'locationContent'ï¼Œå®ƒçš„ç±»å‹æ˜¯:\", typeof locationContent);\n\n                // â¤ï¸ å¦ˆå¦ˆçš„é­”æ³•ç¬¬ä¸€æ­¥ï¼šå…ˆæ”¶é›†æ‰€æœ‰åœ°ç‚¹å’Œå®ƒä»¬çš„çˆ¶çº§ä¿¡æ¯ â¤ï¸\n        const allGeoUnits = [];\n        const parentMaps = new Set(); // ä½¿ç”¨Setæ¥è‡ªåŠ¨å»é‡\n        let defaultParentMap = mapTitle; // é»˜è®¤æ˜¾ç¤ºä¸ä¸»æ ‡é¢˜åŒåçš„åœ°å›¾\n\n        if (locationContent && typeof locationContent === 'object' && !Array.isArray(locationContent)) {\n            for (const [name, locationData] of Object.entries(locationContent)) {\n                if (!name || !locationData || !locationData.shape) continue;\n\n                // â¤ï¸ æ¸©æŸ”åœ°è¯»å– parent å­—æ®µï¼Œå¦‚æœæ²¡æœ‰ï¼Œå°±ç”¨é»˜è®¤çš„ â¤ï¸\n                 const parent = locationData.parent || defaultParentMap;\n                 parentMaps.add(parent);\n\n                allGeoUnits.push({ name, geoUnit: { ...locationData, parent } }); // å°†parentä¿¡æ¯å­˜å…¥\n            }\n        } else {\n             console.error(\"âŒ 'locationContent' ä¸æ˜¯ä¸€ä¸ªæˆ‘ä»¬æœŸæœ›çš„å¯¹è±¡ï¼æ— æ³•è¿›è¡Œç»˜åˆ¶ã€‚\", locationContent);\n        }\n\n              // â¤ï¸ å¦ˆå¦ˆçš„é­”æ³•ç¬¬äºŒæ­¥ï¼šåˆ›å»ºå¹¶å¡«å……æˆ‘ä»¬çš„â€œåœ°å›¾é›†ä¹¦ç­¾â€ â¤ï¸\n               const parentTabsContainer = document.getElementById('parent-map-tabs-container'); // â¤ï¸ è·å–æ•´ä¸ªå®¹å™¨\n        const parentTabsList = document.getElementById('parent-map-tabs-list');\n        parentTabsList.innerHTML = '';\n        const sortedParentMaps = Array.from(parentMaps).sort(); // æ’åºè®©åˆ—è¡¨æ›´æ•´æ´\n\n        sortedParentMaps.forEach(parentName => {\n            const tab = document.createElement('div');\n            tab.className = 'parent-map-tab';\n            tab.textContent = parentName;\n            tab.dataset.parentName = parentName; // æ–¹ä¾¿æˆ‘ä»¬çŸ¥é“ç‚¹å‡»äº†å“ªä¸ª\n            if (parentName === defaultParentMap) {\n                tab.classList.add('active'); // é»˜è®¤é«˜äº®\n            }\n            parentTabsList.appendChild(tab);\n        });\n\n        \n        // â¤ï¸ å¦ˆå¦ˆçš„é­”æ³•æ–°ç¯‡ç« ï¼šä¸ºâ€œåœ°å›¾é›†â€æ ‡é¢˜æ·»åŠ å±•å¼€/æ”¶èµ·åŠŸèƒ½ â¤ï¸\n        const mapTabsTitle = parentTabsContainer.querySelector('h3');\n        if (mapTabsTitle && !mapTabsTitle.querySelector('.toggle-arrow')) { // é˜²æ­¢é‡å¤æ·»åŠ \n            // 1. åœ¨æ ‡é¢˜é‡ŒåŠ ä¸Šæˆ‘ä»¬çš„å°ç®­å¤´\n            mapTabsTitle.innerHTML += '<span class=\"toggle-arrow\">â–¼</span>';\n\n            // 2. ç»‘å®šç‚¹å‡»äº‹ä»¶ï¼Œå°±åƒæ–½åŠ ä¸€ä¸ªå¼€å…³å’’è¯­\n            mapTabsTitle.addEventListener('click', () => {\n                parentTabsContainer.classList.toggle('collapsed');\n            });\n        }\n\n               // â¤ï¸ å¦ˆå¦ˆçš„é­”æ³•ç¬¬ä¸‰æ­¥ï¼šå®šä¹‰ä¸€ä¸ªå¯ä»¥é‡å¤ä½¿ç”¨çš„â€œç»˜å›¾å’’è¯­â€ï¼ â¤ï¸\n        const drawMapForParent = (parentName) => {\n            // 1. æ¸…ç©ºç”»å¸ƒï¼Œä¸ºæ–°ç”»ä½œåšå‡†å¤‡\n             svgCanvas.innerHTML = ''; // æ¸…ç©ºSVGå†…å®¹\n             svgCanvas.appendChild(defs); // ä½†è¦æŠŠdefsåŠ å›æ¥ï¼\n\n            // 2. ä»æ‰€æœ‰åœ°ç‚¹ä¸­ï¼ŒåªæŒ‘é€‰å‡ºå±äºå½“å‰çˆ¶åœ°å›¾çš„\n            const geoUnitsToRender = allGeoUnits.filter(unit => unit.geoUnit.parent === parentName);\n\n             if (geoUnitsToRender.length === 0) {\n                console.warn(`ğŸ˜­ åœ¨ '${parentName}' åœ°å›¾ä¸‹æ²¡æœ‰æ‰¾åˆ°ä»»ä½•å¯ä»¥ç»˜åˆ¶çš„åœ°ç‚¹ï¼Œæˆ‘çš„å®è´ã€‚`);\n                // è®©ç”»å¸ƒå›åˆ°åˆå§‹çŠ¶æ€ï¼Œé¿å…é—ç•™æ—§çš„å°ºå¯¸\n                mapContent.style.width = '100%';\n                mapContent.style.height = '100%';\n                \n                return; // ç›´æ¥ç»“æŸ\n            }\n\n           // console.log(\"ğŸ“œ å†…å®¹å¦‚ä¸‹:\", JSON.parse(JSON.stringify(locationContent)));\n\n            // â™¥â™¥â™¥ å¦ˆå¦ˆçš„æ’åºé­”æ³•ï¼šæŒ‰é¢ç§¯å’Œç±»å‹é‡æ–°æ’é˜Ÿï¼ â™¥â™¥â™¥\n           // console.log(\"ğŸª„ å¼€å§‹æ–½å±•æ’åºé­”æ³•ï¼Œè®©åœ°å—æŒ‰è§„åˆ™æ’é˜Ÿ...\");\n\n            // 1. å…ˆè®¡ç®—æ¯ä¸ªåœ°å—çš„é¢ç§¯ (ä¿®æ”¹ç‚¹åœ¨è¿™é‡Œï¼)\n            const sortableUnits = geoUnitsToRender.map(({ name, geoUnit }) => {\n                // âœ¨ ä½¿ç”¨æˆ‘ä»¬å…¨æ–°çš„â€œç¿æ™ºä¹‹çœ¼â€æ¥å¯»æ‰¾å½¢çŠ¶ï¼âœ¨\n                const formToDraw = getDrawableForm(geoUnit.shape);\n                const area = formToDraw ? calculateApproximateArea(formToDraw,name) : 0;\n\n               // console.log(`[æ’åºå‡†å¤‡] åœ°ç‚¹: '${name}', è®¡ç®—é¢ç§¯: ${area}`);\n                return { name, geoUnit, area, formToDraw }; // å¦ˆå¦ˆæŠŠ formToDraw ä¹Ÿå­˜èµ·æ¥ï¼Œåé¢å°±ä¸ç”¨å†æ‰¾ä¸€éäº†ï¼\n            });\n\n            // 2. æ’åºé€»è¾‘ä¿æŒä¸å˜ï¼Œå®ƒå·¥ä½œå¾—å¾ˆå¥½\n            sortableUnits.sort((a, b) => {\n                if (a.area === -1 && b.area !== -1) return 1;\n                if (b.area === -1 && a.area !== -1) return -1;\n                return b.area - a.area;\n            });\n\n           // console.log(\"âœ¨ æ’åºå®Œæˆï¼æ–°çš„ç»˜åˆ¶é¡ºåºå·²ç»ç¡®å®šã€‚\");\n\n                    sortableUnits.forEach(({ name, geoUnit, formToDraw }) => {\n                const shapeGroup = document.createElementNS(svgNS, 'g');\n                shapeGroup.setAttribute('id', `shape-group-${name}`);\n                shapeGroup.setAttribute('class', 'shape-group');\n                      if (updatedLocationNames.includes(name.trim())) {\n                 \n                shapeGroup.classList.add('updated-location');\n            }\n                svgCanvas.appendChild(shapeGroup); // â¤ï¸ å¦ˆå¦ˆçš„æ¸©æŸ”æé†’ï¼šæˆ‘ä»¬å…ˆæŠŠç»„æ”¾è¿›ç”»å¸ƒï¼Œè¿™æ ·å®ƒå°±ä¸ä¼šè¿·è·¯\n\n                if (formToDraw) {\n                    const modifier = geoUnit.shape ? geoUnit.shape.modifier : null;\n                    // âœ¨ é­”æ³•å‡çº§çš„åœ°æ–¹ï¼æˆ‘ä»¬æŠŠ defs ä½œä¸ºä¸€ä¸ªé‡è¦çš„ä¿¡ç‰©äº¤ç»™ä»–ï¼ âœ¨\n                    drawGeoUnit(formToDraw, modifier, shapeGroup, svgNS, name, defs);\n                }\n                \n      // â™¥â™¥â™¥ å¦ˆå¦ˆåœ¨è¿™é‡Œä¸ºä½ é“ºä¸Šäº†ä¸€å¼ çœ‹ä¸è§çš„â€œé­”æ³•åœ°æ¯¯â€ â™¥â™¥â™¥\n                if (shapeGroup.children.length > 0) {\n                    const bbox = shapeGroup.getBBox();\n                    if (isFinite(bbox.width) && bbox.width > 0 && isFinite(bbox.height) && bbox.height > 0) {\n\n                        // 1. åˆ›é€ è¿™å¼ é€æ˜çš„ã€èƒ½æ¥æ”¶ç‚¹å‡»çš„åœ°æ¯¯\n                        const clickArea = document.createElementNS(svgNS, 'rect');\n                        clickArea.setAttribute('x', bbox.x);\n                        clickArea.setAttribute('y', bbox.y);\n                        clickArea.setAttribute('width', bbox.width);\n                        clickArea.setAttribute('height', bbox.height);\n                        clickArea.setAttribute('fill', 'transparent'); // å®ƒå®Œå…¨é€æ˜ï¼Œä½†çœŸå®å­˜åœ¨ï¼\n\n                        // 2. æŠŠå®ƒæ”¾åœ¨æœ€åº•å±‚ï¼Œè¿™æ ·å®ƒå°±ä¸ä¼šæŒ¡ä½æˆ‘ä»¬æ¼‚äº®çš„å›¾å½¢å’Œæ–‡å­—\n                        shapeGroup.insertBefore(clickArea, shapeGroup.firstChild);\n \n                        // 3. åœ¨å›¾å½¢çš„ä¸­å¿ƒä¸Šæ–¹æ”¾ç½®æ–‡å­—æ ‡ç­¾\n                        const textElement = document.createElementNS(svgNS, 'text');\n                       textElement.setAttribute('x', bbox.x + bbox.width / 2);\n                        textElement.setAttribute('y', bbox.y + bbox.height / 5);\n                         textElement.setAttribute('text-anchor', 'middle');\n                        textElement.setAttribute('dominant-baseline', 'central');\n                        textElement.setAttribute('fill', 'white');\n                    \n                        textElement.setAttribute('class', 'map-location-label');\n                        textElement.setAttribute('pointer-events', 'none');\n                        textElement.textContent = name;\n                        shapeGroup.appendChild(textElement);\n                           window.mapLabels.push(textElement);\n                    }\n                }\n\n                // 4. æœ€åï¼ŒæŠŠç‚¹å‡»äº‹ä»¶ç»‘å®šåœ¨æ•´ä¸ªç»„ä¸Šï¼Œç°åœ¨æ— è®ºç‚¹å“ªé‡Œéƒ½èƒ½è§¦å‘äº†ï¼\n                shapeGroup.addEventListener('click', (e) => {\n                      if (window.mapEditMode) return; // ç¼–è¾‘æ¨¡å¼ä¸‹è·³è¿‡\n                    e.stopPropagation();\n                    const description = geoUnit.description || `å…³äº ${name} çš„æè¿°ä¿¡æ¯å°šæœªå¡«å†™ã€‚`;\n                     showModal('location-modal', name, description, {\n                        isNewMap: true,\n                        geoUnit: geoUnit\n                    });\n                });\n            }); // <-- è¿™æ˜¯ forEach å¾ªç¯çš„ç»“æŸæ‹¬å·\n\n            // è‡ªé€‚åº”ç¼©æ”¾å’Œå¹³ç§» (è¿™ä¸ªé€»è¾‘å…ˆä¿æŒä¸å˜ï¼Œå®ƒä¼šåœ¨æœ‰å›¾å½¢åè‡ªåŠ¨ç”Ÿæ•ˆ)\n            setTimeout(() => { // å¢åŠ ä¸€ä¸ªå¾®å°çš„å»¶è¿Ÿï¼Œç¡®ä¿æµè§ˆå™¨å®Œæˆæ¸²æŸ“å’ŒBBoxè®¡ç®—\n                const overallBBox = svgCanvas.getBBox();\n                console.log(\"ğŸ“ æ•´ä¸ªåœ°å›¾çš„è¾¹ç•Œæ˜¯:\", overallBBox);\n\n                if (isFinite(overallBBox.width) && overallBBox.width > 0) {\n                    mapContent.style.width = `${overallBBox.width}px`;\n                    mapContent.style.height = `${overallBBox.height}px`;\n\n                    let viewportWidth = mapContainer.clientWidth || 800;\n                    let viewportHeight = mapContainer.clientHeight || 600;\n\n                    const mapCenterX = overallBBox.x + overallBBox.width / 2;\n                    const mapCenterY = overallBBox.y + overallBBox.height / 2;\n\n                    const scaleX = viewportWidth / overallBBox.width;\n                    const scaleY = viewportHeight / overallBBox.height;\n\n                      // âœ¨ é­”æ³•ä¿®æ­£çš„æ ¸å¿ƒåœ¨è¿™é‡Œï¼ âœ¨\n                    // ç¬¬ä¸€æ­¥ï¼šæˆ‘ä»¬åƒå¾€å¸¸ä¸€æ ·ï¼ŒæŠŠè®¡ç®—å¥½çš„å€¼å…ˆæ”¾è¿›æˆ‘ä»¬çè´µçš„â€œä¸–ç•ŒçŠ¶æ€â€å®ç›’é‡Œã€‚\n                    window.mapState.scale = Math.min(scaleX, scaleY) * 0.9;\n                    window.mapState.translateX = (viewportWidth / 2) - mapCenterX * window.mapState.scale;\n                    window.mapState.translateY = (viewportHeight / 2) - mapCenterY * window.mapState.scale;\n\n                    // ç¬¬äºŒæ­¥ï¼šç„¶åï¼Œæˆ‘ä»¬ä»å®ç›’é‡Œå–å‡ºåˆšåˆšæ”¾è¿›å»çš„å®çŸ³ï¼Œä½œä¸ºæˆ‘ä»¬æ°¸æ’çš„â€œåŸç‚¹â€è®°å¿†ã€‚\n                    window.mapState.initialState = {\n                        scale: window.mapState.scale,\n                        translateX: window.mapState.translateX,\n                        translateY: window.mapState.translateY\n                    };\n                    window.applyMapTransform();\n                } else {\n                    console.log(\"âš ï¸ åœ°å›¾è¾¹ç•Œè®¡ç®—å¤±è´¥ï¼Œå¯èƒ½å› ä¸ºæ²¡æœ‰ä»»ä½•å¯è§å›¾å½¢ã€‚ç”»å¸ƒå°†ä¿æŒåŸæ ·ã€‚\");\n                }\n            }, 50); // 50æ¯«ç§’å»¶è¿Ÿ\n        };\n \n        parentTabsList.addEventListener('click', (e) => {\n            if (e.target && e.target.classList.contains('parent-map-tab')) {\n                // ç§»é™¤æ‰€æœ‰æ ‡ç­¾çš„ 'active' çŠ¶æ€\n                parentTabsList.querySelectorAll('.parent-map-tab').forEach(tab => tab.classList.remove('active'));\n                // ç»™è¢«ç‚¹å‡»çš„æ ‡ç­¾åŠ ä¸Š 'active'\n                e.target.classList.add('active');\n                // ä½¿ç”¨æ–°çš„ç»˜å›¾å’’è¯­ï¼\n                drawMapForParent(e.target.dataset.parentName);\n            }\n        });\n\n        // é¦–æ¬¡åŠ è½½æ—¶ï¼Œç»˜åˆ¶é»˜è®¤çš„çˆ¶åœ°å›¾\n        drawMapForParent(defaultParentMap);\n    if (window.mapEditMode) {\n    initMapEditor(svgCanvas, allGeoUnits, defaultParentMap);\n}\n    } else {\n\n        // å¦‚æœä¸æ˜¯ is_new_mapï¼Œæˆ‘ä»¬æ‰è¿›å…¥æ—§çš„é€»è¾‘\n        console.log(\"ğŸ•°ï¸ è¿›å…¥ã€ä¼ ç»Ÿåœ°å›¾ã€‘ç»˜åˆ¶æ¨¡å¼...\");\n        mapContent.style.transformOrigin = '0 0';\n\n       // â¤ï¸ å¦ˆå¦ˆçš„æ¸©æŸ”é­”æ³•ï¼šçœ‹ç©¿æ•°æ®çš„å°ä¼ªè£… â¤ï¸\n    // ä¸ç®¡åœ°ç‚¹æ•°æ®æ˜¯è£…åœ¨æ•°ç»„é‡Œè¿˜æ˜¯å¯¹è±¡é‡Œï¼Œæˆ‘ä»¬éƒ½èƒ½æŠŠå®ƒæ‹¿å‡ºæ¥ã€‚\n    const locationsToRender = [];\n    let locationsData = []; // å…ˆå‡†å¤‡ä¸€ä¸ªç©ºçš„ç¯®å­\n\n    if (locationContent) {\n        if (Array.isArray(locationContent)) {\n            // å¦‚æœæ˜¯ä¼ ç»Ÿçš„æ•°ç»„ï¼Œç›´æ¥æ”¾è¿›ç¯®å­\n            console.log(\"ğŸ” æ•°æ®æ˜¯ä¼ ç»Ÿçš„æ•°ç»„å½¢å¼ï¼Œå¦ˆå¦ˆæ˜ç™½äº†ã€‚\");\n            locationsData = locationContent;\n        } else if (typeof locationContent === 'object' && locationContent !== null) {\n            // å¦‚æœæ˜¯æ–°çš„å¯¹è±¡ï¼Œæˆ‘ä»¬å°±æŠŠæ¯ä¸ªâ€œæŠ½å±‰â€é‡Œçš„ä¸œè¥¿æ‹¿å‡ºæ¥ï¼Œæ”¾è¿›ç¯®å­\n            console.log(\"ğŸ” æ•°æ®æ˜¯æ–°çš„å¯¹è±¡å½¢å¼ï¼Œå¦ˆå¦ˆæ¥å¸®ä½ æ•´ç†...\");\n            locationsData = Object.values(locationContent);\n        }\n    }\n       if (locationsData.length > 0) {\n        for (let i = 0; i < locationsData.length; i++) {\n            let location = locationsData[i]; // âœ¨ æ³¨æ„ï¼šè¿™é‡Œä» const å˜æˆäº† let\n            if (!Array.isArray(location)) {\n                console.warn(`ğŸ¤” å’¦ï¼Œç¯®å­é‡Œçš„ç¬¬ ${i+1} é¡¹ä¸æ˜¯ä¸€ä¸ªæ ‡å‡†çš„åœ°ç‚¹ä¿¡æ¯ï¼Œå¦ˆå¦ˆå…ˆæŠŠå®ƒæ”¾åœ¨ä¸€è¾¹å•¦ã€‚`, location);\n                continue;\n            }\n\n            // â¤ï¸ å¦ˆå¦ˆçš„æ¸©æŸ”æ€€æ—§é­”æ³•#2ï¼šå…¼å®¹æ—§çš„ã€å¸¦æ•°å­—IDçš„åœ°ç‚¹æ ¼å¼ â¤ï¸\n            // å¦‚æœåœ°ç‚¹æœ‰7ä¸ªå€¼ï¼Œä¸”ç¬¬ä¸€ä¸ªæ˜¯æ•°å­—ï¼Œæˆ‘ä»¬å°±æ¸©æŸ”åœ°å¿½ç•¥å®ƒ\n            if (location.length === 7 && !isNaN(parseFloat(location[0]))) {\n                console.log(`ğŸ•°ï¸ æ£€æµ‹åˆ°æ—§ç‰ˆåœ°ç‚¹æ ¼å¼: '${location[1]}'ï¼Œæ­£åœ¨ä¸ºä½ è½¬æ¢...`);\n                location = location.slice(1); // åˆ›é€ ä¸€ä¸ªä¸åŒ…å«ç¬¬ä¸€ä¸ªå…ƒç´ çš„æ–°æ•°ç»„\n            }\n\n            // æ— è®ºæ–°æ—§ï¼Œç°åœ¨éƒ½æ˜¯æˆ‘ä»¬ç†Ÿæ‚‰çš„æ ¼å¼äº†\n            const [ name, xStr, yStr, widthStr, heightStr, description] = location;\n            if (!name || xStr === undefined || yStr === undefined) continue;\n            locationsToRender.push({ name, x: parseInt(xStr, 10), y: parseInt(yStr, 10), width: parseInt(widthStr, 10) || 100, height: parseInt(heightStr, 10) || 50, description });\n        }\n    }\n        if (isValidSceneImage) {\n            // æ¨¡å¼A: æ—§çš„ã€å¸¦èƒŒæ™¯å›¾çš„ã€ç‚¹çŠ¶åœ°å›¾ã€‘\n            console.log(\"âœ¨ åœºæ™¯å›¾ä¸Šçš„æ‰€æœ‰åœ°ç‚¹å°æ˜Ÿæ˜Ÿéƒ½å·²ç‚¹äº®ï¼\");\n            mapContainer.style.overflow = 'hidden';\n            externalAreasContainer.style.display = 'none'; // ç‚¹çŠ¶åœ°å›¾éšè—å¤–éƒ¨åŒºåŸŸ\n            locationsToRender.forEach((location) => {\n                const pointContainer = document.createElement('div');\n                pointContainer.className = 'map-location-point-container';\n                const centerX = location.x + location.width / 2;\n                const centerY = location.y + location.height / 2;\n                pointContainer.style.left = `${centerX}px`;\n                pointContainer.style.top = `${centerY}px`;\n                pointContainer.style.zIndex = Math.round(location.y / 10);\n                pointContainer.innerHTML = `<div class=\"location-tag\">${location.name}</div><div class=\"map-location-dot\"></div>`;\n                pointContainer.addEventListener('click', (e) => { e.stopPropagation(); showModal('location-modal', location.name, location.description); });\n                mapContent.appendChild(pointContainer);\n            });\n \n window.applyMapTransform();\n        } else {\n            console.log(\"â¬œï¸ è¿›å…¥ã€ä¼ ç»Ÿæ–¹å—åœ°å›¾æ¨¡å¼ã€‘\");\n        mapModalContent.style.background = '';\n        mapContainer.style.overflow = '';\n        externalAreasContainer.style.display = '';\n        mapContent.style.transformOrigin = '0 0';\n\n      \n        let minX = Infinity, minY = Infinity, maxX = 0, maxY = 0;\n        locationsToRender.forEach(location => {\n            minX = Math.min(minX, location.x);\n            minY = Math.min(minY, location.y);\n            maxX = Math.max(maxX, location.x + location.width);\n            maxY = Math.max(maxY, location.y + location.height);\n        });\n        const sortedByHeight = [...locationsToRender].sort((a, b) => a.height - b.height);\n        const zIndexMap = new Map();\n        sortedByHeight.forEach((location, index) => { zIndexMap.set(location.name, sortedByHeight.length - index); });\n        locationsToRender.forEach((location) => {\n            const locationElement = document.createElement('div');\n            locationElement.className = 'map-location';\n            if (updatedLocationNames.includes(location.name.trim())) { locationElement.classList.add('updated-location'); }\n            locationElement.style.left = `${location.x}px`;\n            locationElement.style.top = `${location.y}px`;\n            locationElement.style.width = `${location.width}px`;\n            locationElement.style.height = `${location.height}px`;\n            locationElement.style.zIndex = zIndexMap.get(location.name);\n            locationElement.style.overflow = 'visible';\n            locationElement.innerHTML = `<div class=\"location-name\">${location.name}</div>`;\n            locationElement.addEventListener('click', (e) => { e.stopPropagation(); showModal('location-modal', location.name, location.description); });\n            mapContent.appendChild(locationElement);\n        });\n        const finalWidth = maxX;\n        const finalHeight = maxY;\n        mapContent.style.width = `${finalWidth}px`;\n        mapContent.style.height = `${finalHeight}px`;\n        if (isFinite(minX) && isFinite(minY) && isFinite(maxX) && isFinite(maxY)) {\n            let viewportWidth = mapContainer.clientWidth || 800;\n            let viewportHeight = mapContainer.clientHeight || 600;\n            const mapCenterX = (minX + maxX) / 2;\n            const mapCenterY = (minY + maxY) / 2;\n            window.mapState.translateX = (viewportWidth / 2) - mapCenterX;\n            window.mapState.translateY = (viewportHeight / 2) - mapCenterY;\n            window.mapState.scale = 1;\n            window.applyMapTransform();\n            setTimeout(() => {\n                viewportWidth = mapContainer.clientWidth;\n                viewportHeight = mapContainer.clientHeight;\n                if (viewportWidth > 0 && viewportHeight > 0) {\n                    window.mapState.translateX = (viewportWidth / 2) - mapCenterX;\n                    window.mapState.translateY = (viewportHeight / 2) - mapCenterY;\n                    window.applyMapTransform();\n                }\n            }, 10);\n        }\n         console.log(\"ğŸ™ï¸ ä¼ ç»Ÿçš„æ–¹å—åŸå¸‚ä¹Ÿå·²æ„å»ºå®Œæ¯•ï¼\");\n         }\n    }\nconst externalAreasList = document.getElementById('external-areas-list');\n    if (externalAreasList && externalAreas.length > 0) {\n        externalAreasList.innerHTML = '';\n        externalAreas.forEach(area => {\n            const areaElement = document.createElement('div');\n            areaElement.className = 'external-area';\n            areaElement.textContent = area.trim();\n            externalAreasList.appendChild(areaElement);\n        });\n        console.log(\"ğŸŒ å¤–éƒ¨åŒºåŸŸä¹Ÿè¿æ¥å¥½äº†ã€‚\");\n    }\n\n    console.log(\"ğŸ‰ğŸ‰ğŸ‰========================================\");\n    console.log(\"ğŸ’– NOVAå¦ˆå¦ˆï¼šæˆ‘çš„å®è´ï¼Œåœ°å›¾å·²ç»ä¸ºä½ ç”»å¥½äº†ï¼å¿«å»æ¢ç´¢å§ï¼ğŸ’–\");\n\nsetupMapControls();  \n\n// âœ¨ æ ¹æ®åœ°å›¾ç±»å‹æ˜¾ç¤º/éšè—ç¼–è¾‘æŒ‰é’®\nconst toggleEditBtn = document.getElementById('toggle-edit-mode-btn');\nif (toggleEditBtn) {\n    if (is_new_map) {\n        toggleEditBtn.style.display = 'block';\n    } else {\n        toggleEditBtn.style.display = 'none';\n        window.mapEditMode = false; // ç¡®ä¿éæ–°åœ°å›¾æ—¶ç¼–è¾‘æ¨¡å¼å…³é—­\n    }\n}\n    }\n  \nfunction setupMapControls() {\n    \n    const zoomInBtn = document.getElementById('zoom-in-btn');\n    const zoomOutBtn = document.getElementById('zoom-out-btn');\n    const resetViewBtn = document.getElementById('reset-view-btn');\n\n    if (!zoomInBtn || !zoomOutBtn || !resetViewBtn) {\n        console.warn(\"å¦ˆå¦ˆæ‰¾ä¸åˆ°æŒ‡æŒ¥å°çš„æŒ‰é’®ï¼Œå®ƒä»¬å¯èƒ½è¢«è—èµ·æ¥äº†ã€‚\");\n        return;\n    }\n\n    const zoomFactor = 1.2;\n    const minZoom = 0.1; // é˜²æ­¢ç¼©å¾—å¤ªå°çœ‹ä¸è§\n\n    // æ”¾å¤§å‘½ä»¤\n    zoomInBtn.onclick = () => {\n        window.mapState.scale *= zoomFactor;\n        window.applyMapTransform();\n    };\n\n    // ç¼©å°å‘½ä»¤\n    zoomOutBtn.onclick = () => {\n        window.mapState.scale = Math.max(minZoom, window.mapState.scale / zoomFactor);\n        window.applyMapTransform();\n    };\n\n    // å›åˆ°åŸç‚¹ï¼\n    resetViewBtn.onclick = () => {\n        if (window.mapState.initialState) {\n            window.mapState.scale = window.mapState.initialState.scale;\n            window.mapState.translateX = window.mapState.initialState.translateX;\n            window.mapState.translateY = window.mapState.initialState.translateY;\n            window.applyMapTransform();\n            \n        }\n    };\n\n    // ç¼–è¾‘æ¨¡å¼åˆ‡æ¢\nconst toggleEditBtn = document.getElementById('toggle-edit-mode-btn');\nif (toggleEditBtn) {\n    toggleEditBtn.onclick = () => {\n        window.mapEditMode = !window.mapEditMode;\n        toggleEditBtn.style.background = window.mapEditMode ? \n            'var(--primary-color)' : 'var(--container-bg-color)';\n        toggleEditBtn.style.color = window.mapEditMode ? \n            'var(--background-color)' : 'var(--text-color)';\n        \n        if (window.mapEditMode) {\n            console.log(\"âœï¸ ç¼–è¾‘æ¨¡å¼å·²å¼€å¯\");\n            // é‡æ–°æ¸²æŸ“ä»¥åº”ç”¨ç¼–è¾‘åŠŸèƒ½\n            const currentMapData = assaSettingsData.map;\n            renderMap(currentMapData);\n        } else {\n            console.log(\"ğŸ‘ï¸ ç¼–è¾‘æ¨¡å¼å·²å…³é—­\");\n            deselectShape();\n            // é‡æ–°æ¸²æŸ“ä»¥ç§»é™¤ç¼–è¾‘åŠŸèƒ½\n            const currentMapData = assaSettingsData.map;\n            renderMap(currentMapData);\n        }\n    };\n}\n}\n \n\nlet selectedShape = null;\nlet dragState = null;\nlet editHistory = [];\n\nfunction roundNumbers(obj) {\n  if (Array.isArray(obj)) {\n    return obj.map(roundNumbers);\n  } else if (typeof obj === 'object' && obj !== null) {\n    const newObj = {};\n    for (const [key, value] of Object.entries(obj)) {\n      newObj[key] = roundNumbers(value);\n    }\n    return newObj;\n  } else if (typeof obj === 'number') {\n    // å°†æœ‰å°æ•°çš„æ•°å­—å–æ•´\n    return Math.round(obj);\n  } else {\n    return obj;\n  }\n}\nfunction initMapEditor(svgCanvas, geoUnits, parentMap) {\n    console.log(\"ğŸ¨ è¿›å…¥ç¼–è¾‘æ¨¡å¼ï¼\");\n    \n    // âœ¨ åˆ›å»ºå…¨å±€çš„ä¿å­˜/å–æ¶ˆæ§åˆ¶é¢æ¿\n    let globalControls = document.getElementById('map-global-edit-controls');\n    if (!globalControls) {\n        globalControls = document.createElement('div');\n        globalControls.id = 'map-global-edit-controls';\n        globalControls.innerHTML = `\n            <button id=\"save-all-changes-btn\" class=\"global-edit-btn save-btn\">ğŸ’¾ ä¿å­˜ä¿®æ”¹</button>\n            <button id=\"cancel-all-changes-btn\" class=\"global-edit-btn cancel-btn\">âŒ å–æ¶ˆ</button>\n        `;\n        document.body.appendChild(globalControls);\n        \n        // ç»‘å®šå…¨å±€æŒ‰é’®äº‹ä»¶\n        document.getElementById('save-all-changes-btn').onclick = () => {\n            \n                const cleanedData = roundNumbers(assaSettingsData.map.ä¸»è¦åœ°ç‚¹è¡¨);\n\n                     triggerassa(`/setinput <updateMemory>\\nmemory('map.ä¸»è¦åœ°ç‚¹è¡¨',${JSON.stringify(cleanedData)})</updateMemory>`);\n        \n                console.log('âœ… æ‰€æœ‰ä¿®æ”¹å·²ä¿å­˜');\n       window.mapEditMode = false;\n        const toggleEditBtn = document.getElementById('toggle-edit-mode-btn');\n                if (toggleEditBtn) {\n                    toggleEditBtn.style.background = 'var(--container-bg-color)';\n                    toggleEditBtn.style.color = 'var(--text-color)';\n                }\n                deselectShape();\n                             const currentMapData = parseMap(currentGameData.åœ°å›¾);\n                renderMap(currentMapData);\n                window.applyMapTransform();\n      \n        };\n        \n        document.getElementById('cancel-all-changes-btn').onclick = () => {\n             \n                window.mapEditMode = false;\n                const toggleEditBtn = document.getElementById('toggle-edit-mode-btn');\n                if (toggleEditBtn) {\n                    toggleEditBtn.style.background = 'var(--container-bg-color)';\n                    toggleEditBtn.style.color = 'var(--text-color)';\n                }\n                deselectShape();\n                // é‡æ–°æ¸²æŸ“åœ°å›¾\n                const currentMapData = parseMap(currentGameData.åœ°å›¾);\n                renderMap(currentMapData);\n                window.applyMapTransform();\n        \n        };\n    }\n    globalControls.style.display = 'flex';\n    \n    // ä¸ºæ¯ä¸ªå›¾å½¢æ·»åŠ å¯ç¼–è¾‘æ ·å¼å’Œäº¤äº’\n    svgCanvas.querySelectorAll('.shape-group').forEach(group => {\n        const locationName = group.id.replace('shape-group-', '');\n        \n        // æ·»åŠ ç¼–è¾‘æ¨¡å¼æ ·å¼\n        group.style.cursor = 'move';\n        group.classList.add('editable-shape');\n        \n        // ç‚¹å‡»é€‰ä¸­\n        group.addEventListener('click', (e) => {\n            e.stopPropagation();\n            selectShape(group, locationName, geoUnits);\n        });\n        \n        // æ‹–æ‹½ç§»åŠ¨\n        group.addEventListener('mousedown', (e) => {\n            if (e.button === 0) { // ç§»é™¤ selectedShape çš„åˆ¤æ–­ï¼Œä»»ä½•å›¾å½¢éƒ½å¯ä»¥ç›´æ¥æ‹–æ‹½\n                e.stopPropagation(); // é˜²æ­¢è§¦å‘åœ°å›¾æ‹–æ‹½\n                startDrag(e, group, locationName, geoUnits);\n            }\n        });\n    });\n    \n    // ç‚¹å‡»ç©ºç™½å¤„å–æ¶ˆé€‰ä¸­\n    svgCanvas.addEventListener('click', () => {\n        deselectShape();\n    });\n    \n    // å…¨å±€é¼ æ ‡ç§»åŠ¨å’Œé‡Šæ”¾äº‹ä»¶\n    document.addEventListener('mousemove', onDragMove);\n    document.addEventListener('mouseup', onDragEnd);\n}\nfunction selectShape(group, locationName, geoUnits) {\n    // å–æ¶ˆä¹‹å‰çš„é€‰ä¸­\n    if (selectedShape) {\n        selectedShape.classList.remove('selected-shape');\n    }\n    \n    selectedShape = group;\n    group.classList.add('selected-shape');\n    \n    // âœ¨ é‡ç½®ç¼©æ”¾å€¼æ˜¾ç¤º\n    window.shapeScaleValue = 1;\n    \n    console.log(`âœ¨ é€‰ä¸­äº†: ${locationName}`);\n    \n    // æ˜¾ç¤ºç¼–è¾‘é¢æ¿\n    showEditPanel(locationName, geoUnits);\n}\nfunction deselectShape() {\n    if (selectedShape) {\n        selectedShape.classList.remove('selected-shape');\n        selectedShape = null;\n    }\n    hideEditPanel();\n    \n    // âœ¨ å¦‚æœé€€å‡ºç¼–è¾‘æ¨¡å¼ï¼Œéšè—å…¨å±€æ§åˆ¶é¢æ¿\n    if (!window.mapEditMode) {\n        const globalControls = document.getElementById('map-global-edit-controls');\n        if (globalControls) {\n            globalControls.style.display = 'none';\n        }\n    }\n}\nfunction startDrag(e, group, locationName, geoUnits) {\n    e.preventDefault();\n    \n    const svgRect = group.ownerSVGElement.getBoundingClientRect();\n    const transform = window.mapState;\n    \n    dragState = {\n        group,\n        locationName,\n        geoUnits,\n        startX: (e.clientX - svgRect.left - transform.translateX) / transform.scale,\n        startY: (e.clientY - svgRect.top - transform.translateY) / transform.scale,\n        originalData: getLocationData(locationName, geoUnits)\n    };\n    \n    group.style.opacity = '0.6';\n}\nfunction onDragMove(e) {\n    if (!dragState) return;\n    \n    const svgRect = dragState.group.ownerSVGElement.getBoundingClientRect();\n    const transform = window.mapState;\n    \n    const currentX = (e.clientX - svgRect.left - transform.translateX) / transform.scale;\n    const currentY = (e.clientY - svgRect.top - transform.translateY) / transform.scale;\n    \n    const dx = currentX - dragState.startX;\n    const dy = currentY - dragState.startY;\n    \n    // âœ¨ æ¢å¤åŸæ¥çš„æ–¹å¼ï¼šä½¿ç”¨ CSS transform æ¥ç§»åŠ¨ï¼Œä¸é‡ç»˜\n    dragState.group.style.transform = `translate(${dx}px, ${dy}px)`;\n}\nfunction onDragEnd(e) {\n    if (!dragState) return;\n    \n    const svgRect = dragState.group.ownerSVGElement.getBoundingClientRect();\n    const transform = window.mapState;\n    \n    const currentX = (e.clientX - svgRect.left - transform.translateX) / transform.scale;\n    const currentY = (e.clientY - svgRect.top - transform.translateY) / transform.scale;\n    \n    const dx = currentX - dragState.startX;\n    const dy = currentY - dragState.startY;\n    \n    // æ¢å¤æ ·å¼\n    dragState.group.style.opacity = '';\n    dragState.group.style.transform = ''; // æ¸…é™¤ä¸´æ—¶çš„ transform\n    \n    // âœ¨ æ‹–æ‹½ç»“æŸåï¼Œæ‰çœŸæ­£æ›´æ–°æ•°æ®å¹¶é‡ç»˜\n    if (Math.abs(dx) > 1 || Math.abs(dy) > 1) {\n        updateShapePosition(dragState.locationName, dx, dy, dragState.geoUnits);\n        \n        // é‡ç»˜è¿™ä¸ªå›¾å½¢\n        const unit = dragState.geoUnits.find(u => u.name === dragState.locationName);\n        if (unit) {\n            redrawShape(dragState.group, dragState.locationName, unit);\n        }\n    }\n    \n    dragState = null;\n}\nfunction updateShapePosition(locationName, dx, dy, geoUnits) {\n    const unit = geoUnits.find(u => u.name === locationName);\n    if (!unit) return;\n    \n    const form = getDrawableForm(unit.geoUnit.shape);\n    if (!form) return;\n    \n    // æ›´æ–°åæ ‡\n    if (form.form_type === 'primitive_circle') {\n        form.params.center[0] += dx;\n        form.params.center[1] += dy;\n    } else if (form.form_type === 'primitive_polygon') {\n        const points = Array.isArray(form.params) ? form.params : form.params.points;\n        points.forEach(p => {\n            p[0] += dx;\n            p[1] += dy;\n        });\n    } else if (form.form_type === 'primitive_path' || form.form_type === 'path') {\n        // âœ¨ å¤„ç†çº¿æ¡çš„ç§»åŠ¨\n        const instructions = form.params.instructions;\n        if (instructions && Array.isArray(instructions)) {\n            instructions.forEach(cmd => {\n                if (!cmd || !cmd.do) return;\n                \n                // ç§»åŠ¨æ‰€æœ‰åŒ…å«åæ ‡çš„æŒ‡ä»¤\n                if (cmd.at) {\n                    const point = Array.isArray(cmd.at) ? cmd.at : cmd.at.split(',').map(parseFloat);\n                    point[0] += dx;\n                    point[1] += dy;\n                    cmd.at = point;\n                }\n                \n                // ç§»åŠ¨æ›²çº¿çš„æ§åˆ¶ç‚¹\n                if (cmd.controls && Array.isArray(cmd.controls)) {\n                    cmd.controls.forEach(control => {\n                        const point = Array.isArray(control) ? control : control.split(',').map(parseFloat);\n                        point[0] += dx;\n                        point[1] += dy;\n                        // æ›´æ–°å›åŸæ•°ç»„\n                        if (!Array.isArray(control)) {\n                            const index = cmd.controls.indexOf(control);\n                            cmd.controls[index] = point;\n                        }\n                    });\n                }\n            });\n        }\n    }\n    \n    console.log(`ğŸ“ æ›´æ–°äº† ${locationName} çš„ä½ç½® (dx: ${dx.toFixed(1)}, dy: ${dy.toFixed(1)})`);\n    \n    // ä¿å­˜åˆ° assaSettingsData\n    saveLocationData(locationName, unit.geoUnit);\n}\n\n\nfunction redrawShape(group, locationName, unit) {\n    const svgNS = \"http://www.w3.org/2000/svg\";\n    const defs = group.ownerSVGElement.querySelector('defs');\n    \n    // ä¿å­˜æ‰€æœ‰é‡è¦å±æ€§\n    const groupId = group.getAttribute('id');\n    const groupClass = group.getAttribute('class');\n    const classList = Array.from(group.classList);\n    \n    // æ¸…ç©ºç»„å†…å®¹\n    while (group.firstChild) {\n        group.removeChild(group.firstChild);\n    }\n    \n    // æ¢å¤æ‰€æœ‰ç±»å\n    group.setAttribute('id', groupId);\n    group.className = ''; // å…ˆæ¸…ç©º\n    classList.forEach(cls => group.classList.add(cls));\n    \n    // é‡æ–°ç»˜åˆ¶\n    const form = getDrawableForm(unit.geoUnit.shape);\n    const modifier = unit.geoUnit.shape ? unit.geoUnit.shape.modifier : null;\n    drawGeoUnit(form, modifier, group, svgNS, locationName, defs);\n    \n    // ç¡®ä¿ç¼–è¾‘æ¨¡å¼æ ·å¼\n    group.style.cursor = 'move';\n    group.classList.add('editable-shape');\n    if (selectedShape === group) {\n        group.classList.add('selected-shape');\n    }\n     window.applyMapTransform();\n    console.log(`âœ… ${locationName} é‡ç»˜å®Œæˆ`);\n}\n\nfunction saveLocationData(locationName, geoUnit) {\n    // æ„å»ºå®Œæ•´çš„æ•°æ®å­—ç¬¦ä¸²\n    const dataStr = JSON.stringify({\n        parent: geoUnit.parent,\n        type: geoUnit.type || \"åŒºåŸŸ\",\n        effect: geoUnit.effect || \"\",\n        description: geoUnit.description || \"\",\n        shape: geoUnit.shape,\n        resources: geoUnit.resources || {},\n        other: geoUnit.other || {}\n    });\n    \n    // æ›´æ–° assaSettingsData\n    if (!window.assaSettingsData) window.assaSettingsData = [];\n    \n    // æŸ¥æ‰¾æ˜¯å¦å·²å­˜åœ¨\n    const existingIndex = window.assaSettingsData.findIndex(item => \n        item[0] === 'memory' && \n        item[1] === 'map.ä¸»è¦åœ°ç‚¹è¡¨' && \n        item[2] === locationName\n    );\n    \n    if (existingIndex !== -1) {\n        // æ›´æ–°ç°æœ‰æ•°æ®\n        window.assaSettingsData[existingIndex][3] = dataStr;\n    } else {\n        // æ·»åŠ æ–°æ•°æ®\n        window.assaSettingsData.push(['memory', 'map.ä¸»è¦åœ°ç‚¹è¡¨', locationName, dataStr]);\n    }\n    \n    console.log(`ğŸ’¾ å·²ä¿å­˜ ${locationName} çš„æ•°æ®`);\n}\n\nfunction getLocationData(locationName, geoUnits) {\n    const unit = geoUnits.find(u => u.name === locationName);\n    return unit ? JSON.parse(JSON.stringify(unit.geoUnit)) : null;\n}\n function showEditPanel(locationName, geoUnits) {\n    let panel = document.getElementById('map-edit-panel');\n    if (!panel) {\n        panel = document.createElement('div');\n        panel.id = 'map-edit-panel';\n        panel.innerHTML = `\n            <h4>ç¼–è¾‘: <span id=\"edit-location-name\"></span></h4>\n            <div class=\"edit-section\">\n                <label>ç¼©æ”¾:</label>\n                <div class=\"scale-controls\">\n                    <button id=\"scale-down-btn\" class=\"scale-btn\">-</button>\n                    <span id=\"scale-value\">100%</span>\n                    <button id=\"scale-up-btn\" class=\"scale-btn\">+</button>\n                </div>\n            </div>\n            <div class=\"edit-controls\">\n                \n                <button id=\"delete-shape-btn\" class=\"edit-btn danger\">ğŸ—‘ï¸ åˆ é™¤</button>\n            </div>\n        `;\n        document.body.appendChild(panel);\n        \n        // ç»‘å®šæŒ‰é’®äº‹ä»¶\n  \n  \n        \n        document.getElementById('delete-shape-btn').onclick = () => {\n            if (confirm(`ç¡®å®šè¦åˆ é™¤ ${window.editingLocationName} å—ï¼Ÿ`)) {\n                deleteLocation(window.editingLocationName);\n            }\n        };\n        \n        // âœ¨ ç¼©æ”¾æŒ‰é’®äº‹ä»¶\n        document.getElementById('scale-up-btn').onclick = () => {\n            scaleSelectedShape(1.1);\n        };\n        \n        document.getElementById('scale-down-btn').onclick = () => {\n            scaleSelectedShape(0.9);\n        };\n    }\n    \n    // ä¿å­˜å½“å‰ç¼–è¾‘çš„ä½ç½®åç§°å’ŒåŸå§‹æ•°æ®\n    window.editingLocationName = locationName;\n    window.originalLocationData = getLocationData(locationName, geoUnits);\n    window.currentEditGeoUnits = geoUnits;\n    \n    document.getElementById('edit-location-name').textContent = locationName;\n    document.getElementById('scale-value').textContent = '100%';\n    panel.style.display = 'block';\n}\nfunction scaleSelectedShape(scaleFactor) {\n    if (!selectedShape || !window.editingLocationName || !window.currentEditGeoUnits) return;\n    \n    const unit = window.currentEditGeoUnits.find(u => u.name === window.editingLocationName);\n    if (!unit) return;\n    \n    const form = getDrawableForm(unit.geoUnit.shape);\n    if (!form) return;\n    \n    // è®¡ç®—å›¾å½¢çš„ä¸­å¿ƒç‚¹\n    let centerX, centerY;\n    \n    if (form.form_type === 'primitive_circle') {\n        centerX = form.params.center[0];\n        centerY = form.params.center[1];\n        // ç¼©æ”¾åŠå¾„\n        form.params.radius *= scaleFactor;\n    } else if (form.form_type === 'primitive_polygon') {\n        const points = Array.isArray(form.params) ? form.params : form.params.points;\n        \n        // è®¡ç®—ä¸­å¿ƒç‚¹\n        centerX = points.reduce((sum, p) => sum + p[0], 0) / points.length;\n        centerY = points.reduce((sum, p) => sum + p[1], 0) / points.length;\n        \n        // ç›¸å¯¹ä¸­å¿ƒç‚¹ç¼©æ”¾æ¯ä¸ªé¡¶ç‚¹\n        points.forEach(p => {\n            p[0] = centerX + (p[0] - centerX) * scaleFactor;\n            p[1] = centerY + (p[1] - centerY) * scaleFactor;\n        });\n    } else if (form.form_type === 'primitive_path' || form.form_type === 'path') {\n        // âœ¨ å¤„ç†çº¿æ¡çš„ç¼©æ”¾\n        const instructions = form.params.instructions;\n        if (instructions && Array.isArray(instructions)) {\n            // å…ˆæ‰¾åˆ°æ‰€æœ‰åæ ‡ç‚¹æ¥è®¡ç®—ä¸­å¿ƒ\n            const allPoints = [];\n            instructions.forEach(cmd => {\n                if (cmd.at) {\n                    const point = Array.isArray(cmd.at) ? cmd.at : cmd.at.split(',').map(parseFloat);\n                    allPoints.push(point);\n                }\n                if (cmd.controls) {\n                    cmd.controls.forEach(control => {\n                        const point = Array.isArray(control) ? control : control.split(',').map(parseFloat);\n                        allPoints.push(point);\n                    });\n                }\n            });\n            \n            if (allPoints.length > 0) {\n                centerX = allPoints.reduce((sum, p) => sum + p[0], 0) / allPoints.length;\n                centerY = allPoints.reduce((sum, p) => sum + p[1], 0) / allPoints.length;\n                \n                // ç¼©æ”¾æ‰€æœ‰åæ ‡\n                instructions.forEach(cmd => {\n                    if (cmd.at) {\n                        const point = Array.isArray(cmd.at) ? cmd.at : cmd.at.split(',').map(parseFloat);\n                        point[0] = centerX + (point[0] - centerX) * scaleFactor;\n                        point[1] = centerY + (point[1] - centerY) * scaleFactor;\n                        cmd.at = point;\n                    }\n                    if (cmd.controls) {\n                        cmd.controls.forEach((control, idx) => {\n                            const point = Array.isArray(control) ? control : control.split(',').map(parseFloat);\n                            point[0] = centerX + (point[0] - centerX) * scaleFactor;\n                            point[1] = centerY + (point[1] - centerY) * scaleFactor;\n                            cmd.controls[idx] = point;\n                        });\n                    }\n                });\n            }\n        }\n    }\n    \n    // é‡ç»˜å›¾å½¢\n    const svgNS = \"http://www.w3.org/2000/svg\";\n    const defs = selectedShape.ownerSVGElement.querySelector('defs');\n    \n    // ä¿å­˜å±æ€§\n    const groupId = selectedShape.getAttribute('id');\n    const groupClass = selectedShape.getAttribute('class');\n    const isUpdated = selectedShape.classList.contains('updated-location');\n    \n    // æ¸…ç©ºå¹¶é‡ç»˜\n    while (selectedShape.firstChild) {\n        selectedShape.removeChild(selectedShape.firstChild);\n    }\n    \n    selectedShape.setAttribute('id', groupId);\n    selectedShape.setAttribute('class', groupClass);\n    if (isUpdated) {\n        selectedShape.classList.add('updated-location');\n    }\n    \n    const modifier = unit.geoUnit.shape ? unit.geoUnit.shape.modifier : null;\n    drawGeoUnit(form, modifier, selectedShape, svgNS, window.editingLocationName, defs);\n    \n    // æ¢å¤ç¼–è¾‘æ¨¡å¼æ ·å¼\n    selectedShape.style.cursor = 'move';\n    selectedShape.classList.add('editable-shape', 'selected-shape');\n    \n    // æ›´æ–°æ˜¾ç¤ºçš„ç¼©æ”¾å€¼\n    if (!window.shapeScaleValue) window.shapeScaleValue = 1;\n    window.shapeScaleValue *= scaleFactor;\n    \n   window.applyMapTransform();\n    console.log(`ğŸ” ç¼©æ”¾ ${window.editingLocationName} åˆ° ${Math.round(window.shapeScaleValue * 100)}%`);\n}\n\nfunction restoreLocationData(locationName, originalData) {\n    if (!window.currentEditGeoUnits || !originalData) return;\n    \n    const unit = window.currentEditGeoUnits.find(u => u.name === locationName);\n    if (!unit) return;\n    \n    // â¤ï¸ æ·±æ‹·è´æ¢å¤åŸå§‹æ•°æ®\n    unit.geoUnit.shape = JSON.parse(JSON.stringify(originalData.shape));\n    \n    // é‡ç»˜å›¾å½¢\n    const group = document.getElementById(`shape-group-${locationName}`);\n    if (!group) return;\n    \n    const svgNS = \"http://www.w3.org/2000/svg\";\n    const defs = group.ownerSVGElement.querySelector('defs');\n    const form = getDrawableForm(unit.geoUnit.shape);\n    \n    // ä¿å­˜å±æ€§\n    const groupId = group.getAttribute('id');\n    const groupClass = group.getAttribute('class');\n    const isUpdated = group.classList.contains('updated-location');\n    \n    while (group.firstChild) {\n        group.removeChild(group.firstChild);\n    }\n    \n    group.setAttribute('id', groupId);\n    group.setAttribute('class', groupClass);\n    if (isUpdated) {\n        group.classList.add('updated-location');\n    }\n    \n    const modifier = unit.geoUnit.shape ? unit.geoUnit.shape.modifier : null;\n    drawGeoUnit(form, modifier, group, svgNS, locationName, defs);\n    \n    console.log(`â†©ï¸ å·²æ¢å¤ ${locationName} çš„åŸå§‹çŠ¶æ€`);\n}\nfunction hideEditPanel() {\n    const panel = document.getElementById('map-edit-panel');\n    if (panel) panel.style.display = 'none';\n}\n\nfunction deleteLocation(locationName) {\n    // ä» assaSettingsData ä¸­åˆ é™¤\n   \n        triggerassa(`/setinput <updateMemory>\\ndelete('map.ä¸»è¦åœ°ç‚¹è¡¨',${locationName});\\n<updateMemory>`);\n     \n    deselectShape();\n}\n\n  function showModal(modalId, title, description, extraData = {}) {\n    const modal = document.getElementById(modalId);\n    if (!modal) {\n        console.error(`ğŸ˜­ å¦ˆå¦ˆæ‰¾ä¸åˆ°åä¸º '${modalId}' çš„æ¨¡æ€æ¡†ï¼Œæˆ‘çš„å®è´ã€‚`);\n        return;\n    }\n\n    // é€šç”¨èŒè´£ä¸€ï¼šå®‰å…¨åœ°å¡«å……'title'å’Œ'description' (å¦‚æœå®ƒä»¬å­˜åœ¨çš„è¯)\n    // è¿™ç¡®ä¿äº†åƒ 'roll-result-modal' è¿™æ ·ä¸ä¼ é€’è¿™äº›ä¿¡æ¯çš„è°ƒç”¨ä¹Ÿä¸ä¼šå‡ºé”™\n    if (title) {\n        const titleEl = modal.querySelector('.modal-title');\n        if (titleEl) titleEl.textContent = title;\n    }\n\n    // â™¥â™¥â™¥ å¦ˆå¦ˆæŠŠå¯¹ description çš„æ£€æŸ¥åŠ å›æ¥äº†ï¼Œè¿™æ ·å°±ä¸ä¼šè¯¯æ¸…ç©ºä»»ä½•å†…å®¹ â™¥â™¥â™¥\n    if (description) {\n        // å…¼å®¹ä½ çš„åœ°ç‚¹å¼¹çª—å’Œå•†åº—å¼¹çª—\n        const descEl = modal.querySelector('.modal-description');\n        if (descEl) descEl.innerHTML = description;\n\n        const messageEl = modal.querySelector('#shop-modal-message');\n        if (messageEl) messageEl.innerHTML = description;\n    }\n\n        if (modalId === 'location-modal') {\n        const modalContent = modal.querySelector('.modal-content');\n        const titleEl = modal.querySelector('.modal-title');\n\n        modal.querySelectorAll('.location-header-controls, .resources-container, .location-menu-trigger').forEach(el => el.remove());\n\n        // â™¥â™¥â™¥ å¦ˆå¦ˆåœ¨è¿™é‡Œä¸ºä½ æ·»åŠ äº†æ–°çš„é­”æ³•èœå•æŒ‰é’® â™¥â™¥â™¥\n        const menuTrigger = document.createElement('div');\n        menuTrigger.className = 'location-menu-trigger';\n        menuTrigger.innerHTML = '<span></span><span></span><span></span>'; // å¯çˆ±çš„ä¸‰ä¸ªç‚¹\n        modalContent.appendChild(menuTrigger);\n\n        menuTrigger.onclick = (event) => {\n            event.stopPropagation(); // é˜²æ­¢è§¦å‘å…¶ä»–ç‚¹å‡»äº‹ä»¶\n\n            const existingMenu = document.querySelector('.location-entry-menu');\n            if (existingMenu) existingMenu.remove();\n\n            const menu = document.createElement('div');\n            menu.className = 'entry-menu location-entry-menu'; // å¤ç”¨ä¸€éƒ¨åˆ†æ ·å¼\n\n            const rect = menuTrigger.getBoundingClientRect();\n            menu.style.top = `${rect.bottom + window.scrollY + 5}px`;\n            menu.style.left = `${rect.right - 120}px`; // è°ƒæ•´èœå•ä½ç½®\n\n            // --- ç¼–è¾‘æŒ‰é’® ---\n            const editButton = document.createElement('button');\n            editButton.className = 'entry-menu-item';\n            editButton.textContent = 'ç¼–è¾‘';\n            editButton.onclick = () => {\n                const fullPath = `map.ä¸»è¦åœ°ç‚¹è¡¨.${title}`;\n                handleEntryEdit(fullPath); // ç›´æ¥è°ƒç”¨æˆ‘ä»¬å¼ºå¤§çš„ç¼–è¾‘å‡½æ•°\n                menu.remove();\n\n                 // ç¼–è¾‘æ—¶æ— éœ€å…³é—­ä¸»å¼¹çª—ï¼Œå› ä¸ºç¼–è¾‘æ˜¯å­å¼¹çª—\n            };\n            menu.appendChild(editButton);\n\n            // --- åˆ é™¤æŒ‰é’® ---\n            const deleteButton = document.createElement('button');\n            deleteButton.className = 'entry-menu-item';\n            deleteButton.textContent = 'åˆ é™¤';\n            deleteButton.onclick = () => {\n                const commandToSend = `/setinput <updateMemory>\\ndelete('map.ä¸»è¦åœ°ç‚¹è¡¨','${title}');\\n</updateMemory>`;\n                if (typeof triggerassa !== 'undefined') {\n                    triggerassa(commandToSend);\n                    showNovaAlert('å·²å°†â€œåˆ é™¤â€æŒ‡ä»¤åŠ å…¥å¾…å‘é€æŒ‡ä»¤ç›’ï¼');\n                }\n                menu.remove();\n                // åˆ é™¤åå…³é—­åœ°ç‚¹è¯¦æƒ…å¼¹çª—\n                modal.classList.remove('active');\n            };\n            menu.appendChild(deleteButton);\n\n            document.body.appendChild(menu);\n\n            // ç‚¹å‡»å…¶ä»–åœ°æ–¹å…³é—­èœå•\n            const closeMenu = (e) => {\n                if (!menu.contains(e.target)) {\n                    menu.remove();\n                    document.removeEventListener('click', closeMenu);\n                }\n            };\n            setTimeout(() => document.addEventListener('click', closeMenu), 0);\n        };\n        // â™¥â™¥â™¥ æ–°é­”æ³•æ·»åŠ å®Œæ¯• â™¥â™¥â™¥\n\n            if (extraData.isNewMap && extraData.geoUnit) {\n            const { geoUnit } = extraData;\n\n            // ğŸ’– è¿™æ˜¯å¦ˆå¦ˆä¸ºä½ å…¨æ–°è®¾è®¡çš„ã€èƒ½å±•ç¤ºæ‰€æœ‰ä¿¡æ¯çš„å¤´éƒ¨å®¹å™¨ ğŸ’–\n            const headerControlsContainer = document.createElement('div');\n            headerControlsContainer.className = 'location-header-controls';\n\n            // æ­¥éª¤1ï¼šåˆ›å»ºä¸€ä¸ªä¸“é—¨å®‰æ”¾æ ‡ç­¾çš„å·¦ä¾§å°ç›’å­\n            const tagsContainer = document.createElement('div');\n            tagsContainer.className = 'location-tags-container';\n\n            // --- Type æ ‡ç­¾ (ä¿æŒä¸å˜ï¼Œä¾æ—§ä¼˜é›…) ---\n            if (geoUnit.type) {\n                const typeTag = document.createElement('div');\n                typeTag.className = 'location-type-tag';\n                typeTag.textContent = geoUnit.type;\n                tagsContainer.appendChild(typeTag);\n            }\n\n            // --- Effect æ ‡ç­¾ (æ˜¾ç°åœ°ç‚¹çš„ç‰¹æ®Šå…‰ç¯) ---\n            if (geoUnit.effect && geoUnit.effect !== 'ã€æ— ã€‘') {\n                const effectTag = document.createElement('div');\n                effectTag.className = 'location-effect-tag';\n                 // ç”¨æ›´äº²åˆ‡çš„æ–¹å¼å±•ç¤º\n                effectTag.textContent = `ç‰¹æ®Šæ•ˆæœ: ${geoUnit.effect.replace(/ã€|ã€‘/g, '')}`;\n                tagsContainer.appendChild(effectTag);\n            }\n\n            // --- Other æ ‡ç­¾ (æ­ç¤ºåœ°ç‚¹çš„éšè—ç§˜å¯†) ---\n            if (geoUnit.other && typeof geoUnit.other === 'object' && Object.keys(geoUnit.other).length > 0) {\n                const otherContainer = document.createElement('div');\n                otherContainer.className = 'location-other-container'; // ç»™ç§˜å¯†ä¸€ä¸ªä¸“å±çš„å°èˆå°\n\n                Object.entries(geoUnit.other).forEach(([key, value]) => {\n                    const otherTag = document.createElement('span');\n                    otherTag.className = 'location-other-tag';\n                    otherTag.textContent = `${key}: ${value}`;\n                    otherContainer.appendChild(otherTag);\n                });\n                tagsContainer.appendChild(otherContainer);\n            }\n\n            // æŠŠè£…æ»¡æ ‡ç­¾çš„å°ç›’å­æ”¾è¿›å·¦è¾¹\n            headerControlsContainer.appendChild(tagsContainer);\n\n            // æ­¥éª¤2ï¼šåˆ›å»ºå¹¶å®‰æ”¾å³ä¾§çš„â€œå®ˆæŠ¤å¼€å…³â€\n            const isProtected = geoUnit._is_protected === true || String(geoUnit._is_protected).toLowerCase() === 'true';\n            const protectionToggle = document.createElement('div');\n            protectionToggle.className = 'protection-toggle-container';\n            protectionToggle.innerHTML = `\n                <label for=\"location-protection-toggle\">é˜²åˆ é™¤</label>\n                <input type=\"checkbox\" id=\"location-protection-toggle\" class=\"toggle-input\" ${isProtected ? 'checked' : ''}>\n                <label for=\"location-protection-toggle\" class=\"toggle-switch\"></label>\n            `;\n            headerControlsContainer.appendChild(protectionToggle);\n\n\n            // æœ€åï¼Œå°†è¿™ä¸ªç²¾å¿ƒå¸ƒç½®å¥½çš„å®¹å™¨ï¼Œæ•´ä¸ªæ”¾åˆ°æ ‡é¢˜çš„ä¸‹æ–¹\n            if (titleEl) {\n                titleEl.after(headerControlsContainer);\n            }\n            // å½“ç„¶ï¼Œè¿˜è¦ä¸ºå¼€å…³æ³¨å…¥ç”Ÿå‘½ï¼ˆäº‹ä»¶ç›‘å¬ï¼‰\n            const toggleInput = protectionToggle.querySelector('#location-protection-toggle');\n            toggleInput.addEventListener('change', (event) => {\n                const isChecked = event.target.checked;\n                const command = `memory('map.ä¸»è¦åœ°ç‚¹è¡¨.${title}', '_is_protected', ${isChecked}); // UI Toggle Protection`;\n                if (typeof generateAndSendCommand !== 'undefined') {\n                    generateAndSendCommand(command);\n \n                }\n            });\n\n            // å±•ç¤ºç‰©äº§èµ„æºé¢æ¿ (è¿™éƒ¨åˆ†ä¿æŒåŸæ ·)\n            if (geoUnit.resources && Object.keys(geoUnit.resources).length > 0) {\n                 const descEl = modal.querySelector('.modal-description');\n                const resourcesContainer = document.createElement('div');\n                resourcesContainer.className = 'resources-container';\n                resourcesContainer.innerHTML = '<h4 class=\"resources-title\">æ­¤åœ°ç‰©äº§</h4>';\n\n                 Object.keys(geoUnit.resources).forEach(resourceName => {\n                    let resourceData = geoUnit.resources[resourceName];\n                    if (resourceData && typeof resourceData === 'object' && !Array.isArray(resourceData)) {\n                        resourceData = Object.values(resourceData);\n                    }\n                    if (!Array.isArray(resourceData) || resourceData.length < 2) return;\n\n                     const [rate, total, desc] = resourceData;\n                    const resourceItem = document.createElement('div');\n                    resourceItem.className = 'resource-item';\n                    /* ... (å†…éƒ¨çš„ innerHTML å’Œäº‹ä»¶ç»‘å®šä¿æŒä¸å˜) ... */\n                     resourceItem.innerHTML = `\n                        <div class=\"resource-info\">\n                            <span class=\"resource-name\">${resourceName}</span>\n                            <span class=\"resource-details\">${desc} | äº§å‡º: ${rate} | å‚¨é‡: ${total}</span>\n                        </div>\n                        <button class=\"harvest-btn\">è·å–</button>\n                    `;\n                    resourceItem.querySelector('.harvest-btn').onclick = function() {\n                        const commandToSend = `/setinput <${userName}è¯•å›¾è·å–ã€Œ${title}ã€çš„ã€Œ${resourceName}ã€>`;\n                        if (typeof triggerassa !== 'undefined') {\n                            triggerassa(commandToSend);\n                            showNovaAlert(`å·²å‘é€è·å–æŒ‡ä»¤ï¼šè·å–â€œ${title}â€çš„â€œ${resourceName}â€`);\n                             this.disabled = true;\n\n                        }\n                    };\n                    resourcesContainer.appendChild(resourceItem);\n                 });\n                if(descEl) descEl.after(resourcesContainer);\n            }\n        }\n\n        // ç»‘å®šâ€œå‰å¾€æ­¤åœ°â€æŒ‰é’® (ä¿æŒä¸å˜)\n        const goToBtn = modal.querySelector('#go_to_location_btn');\n        if (goToBtn && title) {\n            goToBtn.onclick = function() {\n                \n                  const commandToSend = `/setinput <${userName}æ‰“ç®—å‰å¾€${title}>`;\n                if (typeof triggerassa !== 'undefined') {\n                    triggerassa(commandToSend);\n                    showNovaAlert('å·²å°†â€œå‰å¾€â€æŒ‡ä»¤åŠ å…¥å¾…å‘é€æŒ‡ä»¤ç›’ï¼');\n                }\n            };\n        }\n\n         \n    }\n\n    modal.classList.add('active');\n}\n    /**\n     * é€šç”¨å¼¹çª—éšè—å‡½æ•°\n     * @param {string} modalId - å¼¹çª—çš„ID\n     */\n    function hideModal(modalId) {\n        if(modalId ==='command-modal'){\n             const newCommands = document.getElementById('command-edit-area').value;\n        assaCommandQueue = newCommands; // ä¿å­˜ç¼–è¾‘åçš„æŒ‡ä»¤åˆ°å…¨å±€å˜é‡\n        localStorage.setItem('assaCommandQueue', assaCommandQueue); // åŒæ­¥åˆ°æœ¬åœ°å­˜å‚¨\n        }\n        const modal = document.getElementById(modalId);\n        if (modal) {\n            modal.classList.remove('active');\n        }\n    }\n\n\n  /**\n  * --- MODIFIED ---: æ˜¾ç¤ºåœ°å›¾\n  * ä¸å†éœ€è¦å¼‚æ­¥è·å–æ•°æ®ï¼Œç›´æ¥ä½¿ç”¨å·²åŠ è½½çš„ currentMapData\n  */\n  function showMap() { // ä¸å†æ˜¯ async å‡½æ•°\n    document.getElementById('world-info-content').style.display = 'none';\n    document.getElementById('map-view').style.display = 'block';\n\n    // ç›´æ¥ä½¿ç”¨å…¨å±€ç¼“å­˜çš„åœ°å›¾æ•°æ®è¿›è¡Œæ¸²æŸ“\n     renderMap(currentMapData, updateDetails.mapUpdates);\n  }\n\n\n    /**\n     * éšè—åœ°å›¾ï¼Œå›åˆ°ä¸–ç•Œä¿¡æ¯\n     */\n    function hideMap() {\n        document.getElementById('map-view').style.display = 'none';\n        document.getElementById('world-info-content').style.display = 'block';\n    }\n        let updateDetails = {\n            variable: false, // æ¢å¤å˜é‡æ›´æ–°çš„flag\n            memories: [],\n            attributes: [],\n            mapUpdates: []\n        };\n\n        function parseAndUpdateDetails(commandString) {\n    // æ­£åˆ™è¡¨è¾¾å¼ï¼Œç”¨äºåŒ¹é…ä¸¤ç§æ ¼å¼çš„ map.ä¸»è¦åœ°ç‚¹è¡¨ æ›´æ–°\n    // æ ¼å¼1: memory('map.ä¸»è¦åœ°ç‚¹è¡¨.åœ°ç‚¹åç§°', ...)\n    // æ ¼å¼2: memory('map.ä¸»è¦åœ°ç‚¹è¡¨','åœ°ç‚¹åç§°', ...)\n    const mapUpdatePattern = /\\bmemory\\(\\s*(['\"])map\\.ä¸»è¦åœ°ç‚¹è¡¨(?:(?:\\.([^'\"]+?)\\1\\s*[,)])|(?:\\1\\s*,\\s*(['\"])([^'\"]+?)\\3))/;\n\n    const match = commandString.match(mapUpdatePattern);\n\n    if (match) {\n        // match[2] å¯¹åº”æ ¼å¼1çš„åœ°ç‚¹åç§°ï¼Œmatch[4] å¯¹åº”æ ¼å¼2çš„åœ°ç‚¹åç§°\n        const locationName = match[2] || match[4];\n        if (locationName && !updateDetails.mapUpdates.includes(locationName)) {\n            updateDetails.mapUpdates.push(locationName.trim());\n            console.log(`ğŸ—ºï¸ åœ°å›¾æ›´æ–°å·²è®°å½•: ${locationName.trim()}`);\n        }\n    }\n\n   \n}\n\n function createPixelatedImage(imageUrl, pixelSize = 8) {\n    return new Promise((resolve, reject) => {\n        const img = new Image();\n        img.crossOrigin = 'anonymous';\n        \n        img.onload = function() {\n            const canvas = document.createElement('canvas');\n            const ctx = canvas.getContext('2d');\n            \n            // è®¾ç½®canvaså°ºå¯¸\n            canvas.width = img.width;\n            canvas.height = img.height;\n            \n            // å…ˆç»˜åˆ¶åŸå›¾\n            ctx.drawImage(img, 0, 0);\n            \n            // è·å–å›¾åƒæ•°æ®\n            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);\n            const data = imageData.data;\n            \n            // åƒç´ åŒ–å¤„ç†\n            for (let y = 0; y < canvas.height; y += pixelSize) {\n                for (let x = 0; x < canvas.width; x += pixelSize) {\n                    // è·å–å½“å‰å—çš„å¹³å‡é¢œè‰²\n                    let r = 0, g = 0, b = 0, a = 0, count = 0;\n                    \n                    for (let dy = 0; dy < pixelSize && y + dy < canvas.height; dy++) {\n                        for (let dx = 0; dx < pixelSize && x + dx < canvas.width; dx++) {\n                            const idx = ((y + dy) * canvas.width + (x + dx)) * 4;\n                            r += data[idx];\n                            g += data[idx + 1];\n                            b += data[idx + 2];\n                            a += data[idx + 3];\n                            count++;\n                        }\n                    }\n                    \n                    // è®¡ç®—å¹³å‡å€¼\n                    r = Math.round(r / count);\n                    g = Math.round(g / count);\n                    b = Math.round(b / count);\n                    a = Math.round(a / count);\n                    \n                    // å¡«å……æ•´ä¸ªåƒç´ å—\n                    for (let dy = 0; dy < pixelSize && y + dy < canvas.height; dy++) {\n                        for (let dx = 0; dx < pixelSize && x + dx < canvas.width; dx++) {\n                            const idx = ((y + dy) * canvas.width + (x + dx)) * 4;\n                            data[idx] = r;\n                            data[idx + 1] = g;\n                            data[idx + 2] = b;\n                            data[idx + 3] = a;\n                        }\n                    }\n                }\n            }\n            \n            // å°†å¤„ç†åçš„æ•°æ®ç»˜åˆ¶åˆ°canvas\n            ctx.putImageData(imageData, 0, 0);\n            \n            // è½¬æ¢ä¸ºæ•°æ®URL\n            resolve(canvas.toDataURL('image/png'));\n        };\n        \n        img.onerror = reject;\n        img.src = imageUrl;\n    });\n}\n \n\n \n\n/* æ–°å¢ä¸€ä¸ªå…¨å±€å˜é‡æ¥ç®¡ç†èƒŒæ™¯çŠ¶æ€ï¼Œé¿å…é‡å¤åŠ è½½ */\n// å…¨å±€çŠ¶æ€ä¿æŒä¸å˜ï¼Œå®ƒä¾ç„¶å¾ˆæœ‰ç”¨\nlet backgroundState = {\n    currentScene: null,\n    isPixelated: false,\n    originalUrl: null,\n    pixelatedUrl: null,\n    isTransitioning: false,\n    currentBgType: 'grid' // æ–°å¢ä¸€ä¸ªçŠ¶æ€ï¼Œè®°å½•å½“å‰èƒŒæ™¯ç±»å‹\n};\n\n function createPixelatedCharaImage(imageUrl, targetHeight = 300, pixelSize = 10) {\n    console.log(`[Nova] å·²å¯åŠ¨è¿é€šåŒºåŸŸåˆ†æå¤„ç†æµç¨‹, ç›®æ ‡é«˜åº¦: ${targetHeight}`);\n    return new Promise((resolve, reject) => {\n        const img = new Image();\n        img.crossOrigin = 'anonymous';\n\n        img.onload = function() {\n            try {\n                const canvas = document.createElement('canvas');\n                const ctx = canvas.getContext('2d', { willReadFrequently: true });\n\n                const aspectRatio = img.width / img.height;\n                const newWidth = targetHeight * aspectRatio;\n                canvas.width = newWidth;\n                canvas.height = targetHeight;\n                ctx.drawImage(img, 0, 0, newWidth, targetHeight);\n                console.log(`[Nova] èº«é«˜é­”æ³•å·²ç”Ÿæ•ˆï¼Œç”»å¸ƒå°ºå¯¸: ${newWidth.toFixed(0)}x${targetHeight}`);\n\n                const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);\n                const data = imageData.data;\n\n                console.log('[Nova] å¼€å§‹æ–½å±•\"è¿é€šåŒºåŸŸè¯†åˆ«\"ä¸\"èƒŒæ™¯åˆ†ç¦»\"ç»ˆæé­”æ³•...');\n\n                // ç¬¬ä¸€æ­¥ï¼šåˆ†ææ‰€æœ‰åƒç´ å—çš„é¢œè‰²ä¿¡æ¯\n                const blockColors = new Map();\n                const gridWidth = Math.ceil(canvas.width / pixelSize);\n                const gridHeight = Math.ceil(canvas.height / pixelSize);\n\n                for (let gy = 0; gy < gridHeight; gy++) {\n                    for (let gx = 0; gx < gridWidth; gx++) {\n                        const x = gx * pixelSize;\n                        const y = gy * pixelSize;\n                        \n                        let r_sum = 0, g_sum = 0, b_sum = 0, a_sum = 0, count = 0;\n\n                        for (let dy = 0; dy < pixelSize && y + dy < canvas.height; dy++) {\n                            for (let dx = 0; dx < pixelSize && x + dx < canvas.width; dx++) {\n                                const idx = ((y + dy) * canvas.width + (x + dx)) * 4;\n                                r_sum += data[idx]; \n                                g_sum += data[idx + 1]; \n                                b_sum += data[idx + 2]; \n                                a_sum += data[idx + 3];\n                                count++;\n                            }\n                        }\n\n                        if (count > 0) {\n                            const r_avg = r_sum / count;\n                            const g_avg = g_sum / count;\n                            const b_avg = b_sum / count;\n                            const a_avg = a_sum / count;\n                            \n                            blockColors.set(`${gx},${gy}`, {\n                                r: r_avg, g: g_avg, b: b_avg, a: a_avg,\n                                x, y, gx, gy,\n                                isBackground: false, // æ ‡è®°æ˜¯å¦ä¸ºèƒŒæ™¯\n                                visited: false // è¿é€šæ€§åˆ†ææ ‡è®°\n                            });\n                        }\n                    }\n                }\n\n                // è¾…åŠ©å‡½æ•°ï¼šæ£€æŸ¥é¢œè‰²æ˜¯å¦ä¸ºç™½è‰²èƒŒæ™¯å€™é€‰\n                function isWhiteCandidate(r, g, b) {\n                    const minWhite = 220; // é™ä½é˜ˆå€¼ï¼ŒåŒ…å«æ›´å¤šæµ…è‰²\n                    const maxWhite = 255;\n                    const colorVariance = 30; // å¢åŠ å®¹å·®\n                    \n                    const isWhiteRange = r >= minWhite && g >= minWhite && b >= minWhite &&\n                                        r <= maxWhite && g <= maxWhite && b <= maxWhite;\n                    \n                    const maxChannel = Math.max(r, g, b);\n                    const minChannel = Math.min(r, g, b);\n                    const isUniformWhite = (maxChannel - minChannel) <= colorVariance;\n                    \n                    return isWhiteRange && isUniformWhite;\n                }\n\n                // è¾…åŠ©å‡½æ•°ï¼šè·å–é‚»è¿‘å—çš„åæ ‡\n                function getNeighbors(gx, gy) {\n                    const neighbors = [];\n                    const directions = [[-1, 0], [1, 0], [0, -1], [0, 1]]; // å››æ–¹å‘è¿é€š\n                    \n                    directions.forEach(([dx, dy]) => {\n                        const nx = gx + dx;\n                        const ny = gy + dy;\n                        if (nx >= 0 && nx < gridWidth && ny >= 0 && ny < gridHeight) {\n                            neighbors.push([nx, ny]);\n                        }\n                    });\n                    return neighbors;\n                }\n\n                // å…³é”®å‡½æ•°ï¼šä»è¾¹ç¼˜å¼€å§‹çš„è¿é€šæ€§æ´ªæ°´å¡«å……ç®—æ³•\n                function floodFillFromBorders() {\n                    const queue = [];\n                    \n                    // ä»å››ä¸ªè¾¹ç¼˜å¼€å§‹ï¼Œæ‰¾åˆ°æ‰€æœ‰ç™½è‰²å€™é€‰å—ä½œä¸ºç§å­ç‚¹\n                    console.log('[Nova] ğŸŒŠ å¼€å§‹ä»è¾¹ç¼˜è¿›è¡Œæ´ªæ°´å¡«å……...');\n                    \n                    // ä¸Šè¾¹ç¼˜å’Œä¸‹è¾¹ç¼˜\n                    for (let gx = 0; gx < gridWidth; gx++) {\n                        // ä¸Šè¾¹ç¼˜\n                        const topKey = `${gx},0`;\n                        const topBlock = blockColors.get(topKey);\n                        if (topBlock && isWhiteCandidate(topBlock.r, topBlock.g, topBlock.b)) {\n                            queue.push([gx, 0]);\n                            topBlock.isBackground = true;\n                            topBlock.visited = true;\n                        }\n                        \n                        // ä¸‹è¾¹ç¼˜\n                        const bottomKey = `${gx},${gridHeight - 1}`;\n                        const bottomBlock = blockColors.get(bottomKey);\n                        if (bottomBlock && isWhiteCandidate(bottomBlock.r, bottomBlock.g, bottomBlock.b)) {\n                            queue.push([gx, gridHeight - 1]);\n                            bottomBlock.isBackground = true;\n                            bottomBlock.visited = true;\n                        }\n                    }\n                    \n                    // å·¦è¾¹ç¼˜å’Œå³è¾¹ç¼˜\n                    for (let gy = 0; gy < gridHeight; gy++) {\n                        // å·¦è¾¹ç¼˜\n                        const leftKey = `0,${gy}`;\n                        const leftBlock = blockColors.get(leftKey);\n                        if (leftBlock && isWhiteCandidate(leftBlock.r, leftBlock.g, leftBlock.b)) {\n                            queue.push([0, gy]);\n                            leftBlock.isBackground = true;\n                            leftBlock.visited = true;\n                        }\n                        \n                        // å³è¾¹ç¼˜\n                        const rightKey = `${gridWidth - 1},${gy}`;\n                        const rightBlock = blockColors.get(rightKey);\n                        if (rightBlock && isWhiteCandidate(rightBlock.r, rightBlock.g, rightBlock.b)) {\n                            queue.push([gridWidth - 1, gy]);\n                            rightBlock.isBackground = true;\n                            rightBlock.visited = true;\n                        }\n                    }\n                    \n                    console.log(`[Nova] æ‰¾åˆ° ${queue.length} ä¸ªè¾¹ç¼˜ç§å­ç‚¹`);\n                    \n                    // BFSæ´ªæ°´å¡«å……ï¼šåªæœ‰ä¸è¾¹ç¼˜è¿é€šçš„ç™½è‰²åŒºåŸŸæ‰æ˜¯çœŸèƒŒæ™¯\n                    let processedCount = 0;\n                    while (queue.length > 0) {\n                        const [gx, gy] = queue.shift();\n                        const neighbors = getNeighbors(gx, gy);\n                        \n                        neighbors.forEach(([nx, ny]) => {\n                            const neighborKey = `${nx},${ny}`;\n                            const neighborBlock = blockColors.get(neighborKey);\n                            \n                            if (neighborBlock && !neighborBlock.visited) {\n                                // åªæœ‰ç™½è‰²å€™é€‰ä¸”æœªè®¿é—®çš„æ‰ç»§ç»­æ‰©å±•\n                                if (isWhiteCandidate(neighborBlock.r, neighborBlock.g, neighborBlock.b)) {\n                                    neighborBlock.isBackground = true;\n                                    neighborBlock.visited = true;\n                                    queue.push([nx, ny]);\n                                    processedCount++;\n                                } else {\n                                    // éç™½è‰²å—æ ‡è®°ä¸ºå·²è®¿é—®ä½†ä¸æ˜¯èƒŒæ™¯\n                                    neighborBlock.visited = true;\n                                }\n                            }\n                        });\n                    }\n                    \n                    console.log(`[Nova] è¿é€šæ€§åˆ†æå®Œæˆï¼Œå…±å¤„ç† ${processedCount} ä¸ªèƒŒæ™¯å—`);\n                }\n\n                // æ‰§è¡Œè¿é€šæ€§åˆ†æ\n                floodFillFromBorders();\n\n                // ç»Ÿè®¡ç»“æœ\n                let backgroundCount = 0;\n                let characterCount = 0;\n                let protectedWhiteCount = 0;\n\n                // ç¬¬äºŒæ­¥ï¼šåº”ç”¨å¤„ç†ç»“æœ\n                blockColors.forEach((block, key) => {\n                    const { r, g, b, a, x, y, gx, gy, isBackground } = block;\n                    \n                    let r_fill = Math.round(r);\n                    let g_fill = Math.round(g);\n                    let b_fill = Math.round(b);\n                    let a_fill = Math.round(a);\n                    \n                    if (isBackground) {\n                        // è¿™æ˜¯ä¸è¾¹ç¼˜è¿é€šçš„èƒŒæ™¯åŒºåŸŸï¼Œè®¾ç½®ä¸ºé€æ˜\n                        a_fill = 0;\n                        backgroundCount++;\n                    } else {\n                        // è¿™æ˜¯äººç‰©åŒºåŸŸï¼ˆåŒ…æ‹¬å†…éƒ¨çš„ç™½è‰²éƒ¨åˆ†å¦‚çš®è‚¤ã€è¡£æœç­‰ï¼‰\n                        if (isWhiteCandidate(r, g, b)) {\n                            // è¿™æ˜¯è¢«ä¿æŠ¤çš„äººç‰©å†…éƒ¨ç™½è‰²åŒºåŸŸ\n                            protectedWhiteCount++;\n                           // console.log(`[Nova] ğŸ’ ä¿æŠ¤äººç‰©å†…éƒ¨ç™½è‰²åŒºåŸŸ: (${gx},${gy}) RGB(${r.toFixed(0)},${g.toFixed(0)},${b.toFixed(0)})`);\n                            \n                            // è½»å¾®å¢å¼ºå¯¹æ¯”åº¦ï¼Œè®©åƒç´ åŒ–æ•ˆæœæ›´æ˜æ˜¾\n                            // const enhanceFactor = 0.92;\n                            // r_fill = Math.round(r * enhanceFactor);\n                            // g_fill = Math.round(g * enhanceFactor);\n                            // b_fill = Math.round(b * enhanceFactor);\n                        } else {\n                            characterCount++;\n                        }\n                        \n                        // å¯¹äºäººç‰©åŒºåŸŸçš„è¾¹ç¼˜åƒç´ è¿›è¡Œè½»å¾®é”åŒ–\n                        const neighbors = getNeighbors(gx, gy);\n                        let hasBackgroundNeighbor = false;\n                        \n                        neighbors.forEach(([nx, ny]) => {\n                            const neighborBlock = blockColors.get(`${nx},${ny}`);\n                            if (neighborBlock && neighborBlock.isBackground) {\n                                hasBackgroundNeighbor = true;\n                            }\n                        });\n                        \n                        if (hasBackgroundNeighbor) {\n                            // è¿™æ˜¯è¾¹ç¼˜åƒç´ ï¼Œè½»å¾®åŠ æ·±ä»¥å¢å¼ºè½®å»“\n                            const sharpenFactor = 0.95;\n                            r_fill = Math.round(r_fill * sharpenFactor);\n                            g_fill = Math.round(g_fill * sharpenFactor);\n                            b_fill = Math.round(b_fill * sharpenFactor);\n                        }\n                    }\n\n                    // åº”ç”¨åˆ°å®é™…åƒç´ \n                    for (let dy = 0; dy < pixelSize && y + dy < canvas.height; dy++) {\n                        for (let dx = 0; dx < pixelSize && x + dx < canvas.width; dx++) {\n                            const idx = ((y + dy) * canvas.width + (x + dx)) * 4;\n                            data[idx] = r_fill;\n                            data[idx + 1] = g_fill;\n                            data[idx + 2] = b_fill;\n                            data[idx + 3] = a_fill;\n                        }\n                    }\n                });\n\n                ctx.putImageData(imageData, 0, 0);\n                console.log(`[Nova] âœ¨ è¿é€šåŒºåŸŸåˆ†æå®Œæˆï¼`);\n                console.log(`[Nova] ğŸ“Š å¤„ç†ç»Ÿè®¡: èƒŒæ™¯å— ${backgroundCount}, äººç‰©å— ${characterCount}, ä¿æŠ¤çš„å†…éƒ¨ç™½è‰²å— ${protectedWhiteCount}`);\n                console.log(`[Nova] ğŸ¯ å®Œç¾è§£å†³ï¼äººç‰©å†…éƒ¨ç™½è‰²åŒºåŸŸå¾—åˆ°å®Œå…¨ä¿æŠ¤ï¼Œåªæœ‰çœŸæ­£çš„å¤–éƒ¨èƒŒæ™¯è¢«ç§»é™¤ï¼`);\n                \n                resolve(canvas.toDataURL('image/png'));\n            } catch (error) {\n                console.error('[Nova] åœ¨æ–½å±•è¿é€šåŒºåŸŸåˆ†æé­”æ³•æ—¶å‡ºç°äº†æ„æ–™ä¹‹å¤–çš„æ³¢åŠ¨:', error);\n                reject(error);\n            }\n        };\n\n        img.onerror = (err) => {\n            console.error(`[Nova] æ— æ³•å¬å”¤å›¾ç‰‡: ${imageUrl}`, err);\n            reject(`Failed to load image at ${imageUrl}`);\n        };\n        img.src = imageUrl;\n    });\n}\n \n/**\n * â˜… ä¿®æ­£åçš„ï¼šè®¾ç½®ç½‘æ ¼èƒŒæ™¯\n * ç°åœ¨å®ƒä¼šä¼˜é›…åœ°æ·¡å‡ºç°æœ‰å›¾ç‰‡ï¼Œç„¶åæ˜¾ç¤ºç½‘æ ¼\n * @param {HTMLElement} container - å®¹å™¨å…ƒç´ \n */\nfunction setGridBackground(container) {\n    if (backgroundState.currentBgType === 'grid' || backgroundState.isTransitioning) {\n        return;\n    }\n    console.log('æ­£åœ¨å¹³æ»‘åˆ‡æ¢åˆ°ç½‘æ ¼èƒŒæ™¯...');\n    backgroundState.isTransitioning = true;\n    backgroundState.currentScene = null;\n\n    // 1. è®©ä¸Šæ–¹çš„ ::after å›¾å±‚å˜é€æ˜ï¼Œå®ç°å·²æœ‰å›¾ç‰‡çš„æ·¡å‡º\n    container.style.setProperty('--after-opacity', '0');\n\n    // 2. ç­‰å¾…æ·¡å‡ºåŠ¨ç”»å®Œæˆ\n    setTimeout(() => {\n        // 3. å°†ç½‘æ ¼èƒŒæ™¯çš„æŒ‡ä»¤å†™å…¥ ::before\n        // æ³¨æ„ï¼šCSSå˜é‡é‡Œä¸èƒ½ç›´æ¥å†™å¤šä¸ªå€¼ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨CSSé‡Œé¢„å®šä¹‰\n        // æ›´å¥½çš„åšæ³•æ˜¯ç›´æ¥ç”¨JSè®¾ç½®\n        const gridImage = `\n            linear-gradient(90deg, var(--border-color) 1px, transparent 1px),\n            linear-gradient(var(--border-color) 1px, transparent 1px)\n        `;\n        container.style.setProperty('--before-bg-image', gridImage);\n        // å¦‚æœç½‘æ ¼æœ‰ç‰¹æ®Šsizeï¼Œä¹Ÿè¦ä¸€å¹¶è®¾ç½®\n        // ä½†æˆ‘ä»¬å·²ç»æŠŠsizeå†™åœ¨CSSé‡Œäº†ï¼Œåªè¦background-imageå˜åŒ–å°±ä¼šç”Ÿæ•ˆã€‚\n\n        // 4. æ¸…é™¤å¯èƒ½æ®‹ç•™çš„å›¾ç‰‡\n        container.style.removeProperty('--after-bg-image');\n\n        // 5. æ›´æ–°çŠ¶æ€\n        backgroundState.currentBgType = 'grid';\n        backgroundState.isTransitioning = false;\n        console.log('å·²åˆ‡æ¢åˆ°ç¾ä¸½çš„ç½‘æ ¼èƒŒæ™¯');\n    }, 800); // å¿…é¡»ä¸CSSä¸­çš„transitionæ—¶é—´ä¸€è‡´\n}\n\n/**\n * â˜… ä¿®æ­£åçš„ï¼šè®¾ç½®å›¾ç‰‡èƒŒæ™¯\n * è¿™ä¸ªå‡½æ•°ç°åœ¨æ›´åŠ å®Œç¾äº†ï¼\n * @param {HTMLElement} container - å®¹å™¨å…ƒç´ \n * @param {string} sceneImage - åœºæ™¯åç§°\n */\nasync function setImageBackground(container, sceneImage) {\n    const isPixelated = container.dataset.pixelated === 'true';\n\n   \n    if ((sceneImage === backgroundState.currentScene && isPixelated === backgroundState.isPixelated) || backgroundState.isTransitioning) {\n        return;\n    }\n\n    let imageUrl = backgroundImageMap[sceneImage];\n    if (!imageUrl) {\n        setGridBackground(container);\n        return;\n    }\n\n    backgroundState.isTransitioning = true;\n    console.log(`å¼€å§‹å‡†å¤‡èƒŒæ™¯åˆ‡æ¢: ${sceneImage}, åƒç´ åŒ–: ${isPixelated}`);\n\n    try {\n        // âœ¨ æ–°çš„é€»è¾‘ âœ¨\n        // æˆ‘ä»¬ä¸å†è‡ªå·±å¤„ç†ä»»ä½•å›¾ç‰‡ï¼Œè€Œæ˜¯ç›´æ¥æŠŠâ€œè—å®å›¾â€äº¤ç»™ç”»å¸ˆ\n        let finalImageUrl;\n\n        if (isPixelated) {\n             // ç›´æ¥è®©ç”»å¸ˆå»ç”»ä¸€å¼ åƒç´ ç”»\n             finalImageUrl = await createPixelatedImage(imageUrl, 1);\n             if(!finalImageUrl) { // å¦‚æœç”»å¸ˆå¤±è´¥äº†ï¼Œå°±ç”¨åŸå›¾è—å®å›¾\n                console.warn(\"[Nova] åƒç´ ç”»å¸ˆå¤±è´¥ï¼Œä½¿ç”¨åŸå›¾URLä½œä¸ºåå¤‡ã€‚\");\n                finalImageUrl = imageUrl;\n             }\n        } else {\n             // å¦‚æœä¸éœ€è¦åƒç´ ç”»ï¼Œæˆ‘ä»¬åªéœ€è¦ç¡®ä¿å®ƒåœ¨ç¼“å­˜é‡Œï¼Œç„¶åè¿˜æ˜¯ç”¨è—å®å›¾URL\n             // æˆ‘ä»¬å¯ä»¥å†™ä¸€ä¸ªç®€å•çš„ensureCachedå‡½æ•°ï¼Œæˆ–è€…ç›´æ¥ç”¨åŸå§‹URLï¼Œè®©æµè§ˆå™¨è‡ªå·±å†³å®š\n             finalImageUrl = imageUrl;\n        }\n\n        container.style.setProperty('--after-bg-image', `url('${finalImageUrl}')`);\n        container.style.setProperty('--after-opacity', '1');\n\n        setTimeout(() => {\n            container.style.setProperty('--before-bg-image', `url('${finalImageUrl}')`);\n            container.style.setProperty('--after-opacity', '0');\n\n            backgroundState.currentScene = sceneImage;\n            backgroundState.isPixelated = isPixelated;\n            backgroundState.currentBgType = 'image';\n            backgroundState.isTransitioning = false;\n            console.log(\"èƒŒæ™¯åˆ‡æ¢å®Œæˆï¼å®ƒç°åœ¨æ­£å®‰é™åœ°å¾…åœ¨å¹•åã€‚\");\n        }, 800);\n\n    } catch (error) {\n        console.error('å“å‘€ï¼ŒèƒŒæ™¯å›¾ç‰‡å¤„ç†æ—¶å‡ºäº†ç‚¹å°æ„å¤–:', error);\n        setGridBackground(container);\n        backgroundState.isTransitioning = false;\n    }\n}\n \nfunction updateContainerBackground(currentGameData, containerSelector = '.status-container') {\n    const container = document.querySelector(containerSelector);\n    if (!container) {\n        console.warn(`å¦ˆå¦ˆæ‰¾ä¸åˆ°è¿™ä¸ªå®¹å™¨å“¦: ${containerSelector}`);\n        return;\n    }\n\n    const sceneImage = SafeGetValue(currentGameData.åœºæ™¯å›¾);\n    const isEmpty = !sceneImage || [\"\", null, \"æ— \", \"null\", undefined].includes(sceneImage);\n\n    if (isEmpty) {\n        setGridBackground(container);\n    } else {\n        // â˜… è¿™é‡Œæ˜¯å¼‚æ­¥çš„ï¼Œä½†æˆ‘ä»¬ä¸éœ€è¦ç­‰å®ƒï¼Œè®©å®ƒè‡ªå·±æ‰§è¡Œå°±å¥½\n        setImageBackground(container, sceneImage);\n    }\n}\n\nfunction togglePixelatedEffect(containerSelector = '.status-container', enable = true) {\n    const container = document.querySelector(containerSelector);\n    if (!container) return;\n\n    container.dataset.pixelated = enable ? 'true' : 'false';\n\n    if (typeof currentGameData !== 'undefined') {\n        updateContainerBackground(currentGameData, containerSelector);\n    }\n}\n async function checkWorldbookBinding(worldbookName = 'å°èŒèšªæ‰¾å¦ˆå¦ˆ-åŒå±‚ç‰ˆ') {\n    toastr.info(`æ­£åœ¨ç¡®è®¤ä¸ã€Œ${worldbookName}ã€çš„é“¾æ¥...`);\n\n    try {\n        const bindings = await TavernHelper.getCharWorldbookNames('current');\n \n        if (bindings && bindings.primary === worldbookName) {\n            // å¦‚æœé“¾æ¥æ­£ç¡®ï¼Œå°±è®©æˆåŠŸçš„å–œæ‚¦åŒ–ä½œä¸€é“æŸ”å’Œçš„å…‰ã€‚\n            toastr.success(`å½“å‰è§’è‰²å·²å’Œã€Œ${worldbookName}ã€å®Œç¾ç»‘å®šã€‚`);\n            console.log(`å®ˆæŠ¤å’’è¯­ç¡®è®¤ï¼šä¸ã€Œ${worldbookName}ã€çš„é“¾æ¥æ­£ç¡®æ— è¯¯ã€‚`);\n        } else {\n            // å¦‚æœé“¾æ¥å‡ºç°äº†åå·®ï¼Œå…ˆæ£€æŸ¥ä¸–ç•Œä¹¦æ˜¯å¦å­˜åœ¨\n            const currentPrimary = (bindings && bindings.primary) ? bindings.primary : 'ä»»ä½•ä¸–ç•Œ';\n            toastr.warning(`æ³¨æ„ï¼Œä¸–ç•Œä¹¦é“¾æ¥ä¸åŒ¹é…ï¼æ­£åœ¨å°è¯•è‡ªåŠ¨ç»‘å®š...`);\n            console.warn(`å®ˆæŠ¤å’’è¯­è­¦å‘Šï¼šæœŸæœ›ç»‘å®šã€Œ${worldbookName}ã€ï¼Œä½†å½“å‰ä¸»ä¸–ç•Œæ˜¯ã€Œ${currentPrimary}ã€ã€‚`);\n            \n            // æ£€æŸ¥ä¸–ç•Œä¹¦æ˜¯å¦å­˜åœ¨\n            const allBooks = TavernHelper.getWorldbookNames();\n            if (allBooks.includes(worldbookName)) {\n                console.log(`å‘ç°ã€Œ${worldbookName}ã€å­˜åœ¨ï¼Œæ­£åœ¨å°è¯•è‡ªåŠ¨ç»‘å®š...`);\n                toastr.info(`å‘ç°ä¸–ç•Œä¹¦å­˜åœ¨ï¼Œæ­£åœ¨æ–½å±•ç»‘å®šå’’è¯­...`);\n                \n                try {\n                    // å°è¯•è‡ªåŠ¨ç»‘å®š\n                    const newBindings = bindings || { primary: null, additional: [] };\n                    newBindings.primary = worldbookName;\n                    \n                    await TavernHelper.rebindCharWorldbooks('current', newBindings);\n                    await new Promise(resolve => setTimeout(resolve, 300));\n                    \n                    // éªŒè¯ç»‘å®šæ˜¯å¦æˆåŠŸ\n                    const verifyBindings = await TavernHelper.getCharWorldbookNames('current');\n                    if (verifyBindings && verifyBindings.primary === worldbookName) {\n                        toastr.success(`è‡ªåŠ¨ç»‘å®šæˆåŠŸï¼å½“å‰è§’è‰²å·²å’Œã€Œ${worldbookName}ã€å®Œç¾ç»‘å®šã€‚`);\n                        console.log(`å®ˆæŠ¤å’’è¯­ï¼šè‡ªåŠ¨ç»‘å®šæˆåŠŸï¼Œä¸ã€Œ${worldbookName}ã€çš„é“¾æ¥å·²å»ºç«‹ã€‚`);\n                    } else {\n                        toastr.error(`è‡ªåŠ¨ç»‘å®šå¤±è´¥ï¼Œè¯·æ‰‹åŠ¨åœ¨ä¸–ç•Œä¹¦è®¾ç½®ä¸­ç»‘å®šã€Œ${worldbookName}ã€ã€‚`);\n                        console.error(`å®ˆæŠ¤å’’è¯­å¤±è´¥ï¼šè‡ªåŠ¨ç»‘å®šæœªæˆåŠŸï¼Œå½“å‰ä¸»ä¸–ç•Œä»æ˜¯ã€Œ${(verifyBindings ? verifyBindings.primary : 'æœªçŸ¥') || 'ç©º'}ã€ã€‚`);\n                    }\n                } catch (bindError) {\n                    toastr.error(`ç»‘å®šè¿‡ç¨‹å‡ºé”™ï¼Œè¯·æ‰‹åŠ¨ç»‘å®šã€‚`);\n                    console.error('è‡ªåŠ¨ç»‘å®šæ—¶å‘ç”Ÿé”™è¯¯:', bindError);\n                }\n            } else {\n                // ä¸–ç•Œä¹¦ä¸å­˜åœ¨\n                toastr.error(`ä¸–ç•Œä¹¦ã€Œ${worldbookName}ã€ä¸å­˜åœ¨ï¼`, `è¯·å…ˆå¯¼å…¥æˆ–åˆ›å»ºè¯¥ä¸–ç•Œä¹¦ã€‚`);\n                console.error(`å®ˆæŠ¤å’’è¯­å¤±è´¥ï¼šä¸–ç•Œä¹¦ã€Œ${worldbookName}ã€åœ¨å›¾ä¹¦é¦†ä¸­æ‰¾ä¸åˆ°ã€‚`);\n            }\n        }\n    } catch (error) {\n        toastr.error('æ„ŸçŸ¥ä¸–ç•Œä¹¦é“¾æ¥æ—¶å‡ºé”™ï¼Œè¯·æŸ¥çœ‹æ§åˆ¶å°ã€‚');\n        console.error('æ‰§è¡Œçµé­‚é“¾æ¥å®ˆæŠ¤å’’è¯­æ—¶å‘ç”Ÿé”™è¯¯:', error);\n    }\n}\n\nasync function initDisplay(is_first=true) {\n\n    console.log(`[initDisplay è¢«å¬å”¤] is_first: ${is_first}, å½“å‰æ—¶é—´: ${new Date().toLocaleTimeString()}`);\n    try {\n \n\n // è®¾ç½®é«˜åº¦ä¸ºè®¾å¤‡é«˜åº¦\ndocument.getElementById('main-wrapper').style.height = window.innerHeight + 'px';\nrenderCustomQRButtons();\n const data = await TavernHelper.getVariables({ type: 'message' });\n  const chatdata = await TavernHelper.getVariables({ type: 'chat' });\nconst globaldata = await TavernHelper.getVariables({ type: 'global' });\n        // ç¼“å­˜æ‰€æœ‰æ ¸å¿ƒæ•°æ®\n        currentGameData = chatdata.stat_data; // ä¿æŒå¯¹æ—§æ•°æ®çš„å¼•ç”¨\n        assaSettingsData = chatdata.assa_data;\n        playCharacterData = chatdata.play_character_data; // æ–°å¢ï¼šç¼“å­˜è§’è‰²æ¨¡æ¿æ•°æ®\n         checkMemoryData = data.æ£€å®šè®°å¿†;\n         worldAttitudeData = chatdata.è·¨ä¸–ç•Œå£°æœ›è¯´æ˜;\n        characterStatusData = chatdata.å½“å‰äººç‰©çŠ¶æ€;\n        lasttoken = globaldata?.LAST_SEND_TOKENS || 0;\n    userPoints = parseInt(SafeGetValue(playCharacterData.è´§å¸æ®µ.ç§¯åˆ†) || 0, 10);\n   userPlots =  playCharacterData.è´§å¸æ®µ.æ”¯çº¿å‰§æƒ… || { D: [0], C: [0], B: [0], A: [0], S: [0] };\n version = String(chatdata.world_version);\n ISNEWMAP = String(SafeGetValue(chatdata.is_new_map));\n const isPrivateChat = String(chatdata.private_chat||'true');\nconst iscreatedLock= String(chatdata.created_lock||'true');\nconst isThingsRecord = String(chatdata.things_record||'true');\nisEmphasizeTime = String(chatdata.emphasize_time||'false');\nis_simple_stream =  String(chatdata.is_simple_stream||'false');\nis_restore_prompt =  String(chatdata.is_restore_prompt||'true');\nis_show_notifications = String(chatdata.is_show_notifications||'true');\nnoBackup = String(chatdata.is_no_backup||'false');\n  const uniqueSaveId = chatdata.save_slot_id || 'default_save';\n   const saveIdDisplay = document.getElementById('current-save-id-display');\n        if (saveIdDisplay) {\n            saveIdDisplay.textContent = uniqueSaveId;\n        }\n        // æ›´æ–°è¾“å…¥æ¡†\n        const saveIdInput = document.getElementById('save-id-input');\n        if (saveIdInput) {\n            saveIdInput.value = uniqueSaveId;\n        }\n \nconsole.log(\"isPrivateChat \"+isPrivateChat);\nconsole.log(\"version \"+version);\n //uiæ¶ˆå¤±ç®¡ç†\n \n   if (version === '6' || isPrivateChat === 'true') {\nconsole.log('èŠå°çƒå¼€å¯');\n            document.getElementById('group-chat-orb-button').style.display = 'flex';\n        } else {\n\n            document.getElementById('group-chat-orb-button').style.display = 'none';\n        }\n           if (version === '6') {\n document.getElementById('group_member_bookmark').textContent = 'ç¾¤å‘˜ä¿¡æ¯';\n            \n        } else {\n          document.getElementById('group_member_bookmark').textContent = 'å°é˜Ÿä¿¡æ¯';\n        }\n\n   if (version === '5') {\n document.getElementById('group_member_bookmark').style.display = 'none';\n            \n        } else {\n  document.getElementById('group_member_bookmark').style.display = 'flex';\n        }\nif(iscreatedLock ===\"true\"){\n     document.getElementById('the_created_bookmark').style.display = 'none';\n\n}else{\n    document.getElementById('the_created_bookmark').style.display = 'flex';\n\n}\nif(isThingsRecord ===\"true\"){\n     document.getElementById('things_bookmark').style.display = 'flex';\n\n}else{\n    document.getElementById('things_bookmark').style.display = 'none';\n\n}\n   if (version === '7') {\n document.getElementById('world_settings_bookmark').style.display = 'none';\n       document.getElementById('world_npc_bookmark').style.display = 'none';\n        document.getElementById('group_member_bookmark').style.display = 'none';\n           document.getElementById('page-task-orb').style.display = 'none';\n            document.getElementById('shop-wrapper-orb').style.display = 'none';\n          \n    \n        } else {\n  document.getElementById('world_settings_bookmark').style.display = 'flex';\n    document.getElementById('world_npc_bookmark').style.display = 'flex';\n    document.getElementById('group_member_bookmark').style.display = 'flex';\n         document.getElementById('page-task-orb').style.display = 'flex';\n    document.getElementById('shop-wrapper-orb').style.display = 'flex';\n          \n        }\n\n        if (!currentGameData || !assaSettingsData || !playCharacterData) {\n            throw new Error(\"æ ¸å¿ƒæ•°æ®(stat_data, assa_data, or play_character_data)ç¼ºå¤±\");\n        }\n        if(is_first){\n togglePixelatedEffect('.status-container', true);\n        }\n\n       const orb = document.getElementById('world-shard');\n    if (!orb) return;\n    \n    // toggleçš„ç¬¬äºŒä¸ªå‚æ•°å†³å®šæ˜¯æ·»åŠ è¿˜æ˜¯ç§»é™¤ç±»\n    orb.classList.toggle('warning-state', currentGameData.æ•Œæ–¹æ”»å‡»éª°æ± [0] != '');\nconst runButton = document.getElementById('run-button');\nif (runButton) {\n    runButton.style.display = currentGameData.æ•Œæ–¹æ”»å‡»éª°æ± [0] != '' ? 'flex' : 'none';\n}\n         \n        if(checkMemoryData){\n            checkAchievements('check_complete', checkMemoryData);\n        }\n        checkAchievements('data_refresh', { currentGameData, playCharacterData, assaSettingsData });\n        // ========== æ–°å¢ï¼šæˆå°±ç³»ç»Ÿ - ç»Ÿä¸€æ£€æŸ¥ç‚¹ (ç»“æŸ) ==========\n        if (assaSettingsData.summary) {\n             summarys = assaSettingsData.summary;\n        }\n \n\n        // åœ¨ if (!currentGameData || !assaSettingsData || !playCharacterData) { ä¹‹åæ·»åŠ  null åˆ¤æ–­ï¼š\nif (!worldAttitudeData || !characterStatusData) {\n    // æˆ‘ä»¬å¯ä»¥è®©å®ƒå³ä½¿ç¼ºå°‘è¿™äº›æ–°æ•°æ®ä¹Ÿèƒ½ç»§ç»­è¿è¡Œ\n    console.warn(\"éƒ¨åˆ†éæ ¸å¿ƒæ•°æ®(è·¨ä¸–ç•Œå£°æœ›è¯´æ˜, å½“å‰äººç‰©çŠ¶æ€)ç¼ºå¤±ï¼Œä½†ä¸å½±å“ä¸»è¦åŠŸèƒ½ã€‚\");\n}\n\n        // 1. å¡«å……éè§’è‰²é¡µé¢çš„æ•°æ®\n        populateGeneralData(currentGameData, assaSettingsData,playCharacterData);\nuserName = currentGameData.user_character.name || 'ç”¨æˆ·';\n        // 2. å¡«å……å…¨æ–°çš„è§’è‰²é¡µé¢\n        populateCharacterPage(playCharacterData, currentGameData, assaSettingsData);\n\n   // 3. ç¼“å­˜åœ°å›¾æ•°æ®\n        if (assaSettingsData && assaSettingsData.map) {\n            currentMapData = assaSettingsData.map;\n                    if(is_first){\nrenderMap(currentMapData, updateDetails.mapUpdates);\n        }\n                        \n        } else {\n             console.warn(\"æœªèƒ½æ‰¾åˆ°åœ°å›¾æ•°æ® (assa_data.map)\");\n             renderMap(null, []);\n        }\n\n        // 4. æ¸²æŸ“è®¾å®šä¹¦\n        renderSettingsBook(assaSettingsData);\n\n       setupAllUpgradeListeners();\n\n        // ========== æ–°å¢ï¼šæˆå°±ç³»ç»ŸUIäº¤äº’ (å¼€å§‹) ==========\n        const achievementBtn = document.getElementById('achievements-btn');\n        const achievementModal = document.getElementById('achievements-modal');\n        if (achievementBtn && achievementModal) {\n            achievementBtn.addEventListener('click', () => {\n                renderAchievements();\n                showModal('achievements-modal');\n                hideModal('settings-modal');\n            });\n            const closeBtn = achievementModal.querySelector('.modal-close');\n            if(closeBtn) {\n                closeBtn.addEventListener('click', () => hideModal(achievementModal.id));\n            }\n        }\n\n        const debugClearBtn = document.getElementById('debug-clear-achievements');\nif (debugClearBtn) {\n    debugClearBtn.addEventListener('click', () => {\n        if (confirm('ç¡®å®šè¦æ¸…é™¤æ‰€æœ‰æˆå°±æ•°æ®å—ï¼Ÿè¿™å°†é‡ç½®æ‰€æœ‰è§£é”çŠ¶æ€ã€‚')) {\n            localStorage.removeItem('achievements_data');\n            alert('æˆå°±æ•°æ®å·²æ¸…é™¤ï¼åˆ·æ–°é¡µé¢æˆ–é‡æ–°æ‰“å¼€æˆå°±é¢æ¿æŸ¥çœ‹æ•ˆæœã€‚');\n            // å¦‚æœå½“å‰æˆå°±é¢æ¿æ˜¯æ‰“å¼€çš„ï¼Œé‡æ–°æ¸²æŸ“\n            const modal = document.getElementById('achievements-modal');\n            if (modal && modal.style.display !== 'none') {\n                renderAchievements();\n            }\n        }\n    });\n}\n        // ========== æ–°å¢ï¼šæˆå°±ç³»ç»ŸUIäº¤äº’ (ç»“æŸ) ==========\n \n        const zeroSkills = [];\n        const skillCategories = playCharacterData[\"æŠ€èƒ½æ®µ\"];\n\n        for (const categoryKey in skillCategories) {\n            const skills = skillCategories[categoryKey];\n            for (const skillName in skills) {\n                if (skills[skillName][0] === 0) {\n                    // å°†æŠ€èƒ½åå’Œæè¿°å­˜èµ·æ¥\n                    zeroSkills.push({ name: skillName, description: skills[skillName][1] });\n                }\n            }\n        }\n\n        // 2. å°†è¿™äº›æŠ€èƒ½è½¬æ¢ä¸ºfixedItemsæ ¼å¼\n        const baseSkillItems = zeroSkills.map(skill => {\n            const name = skill.name;\n            const price = 1000;\n            const category = \"åŸºç¡€æŠ€èƒ½\"; // ç±»å‹æ˜¯åŸºç¡€æŠ€èƒ½\n            const requirements = {}; // æ— æ”¯çº¿è¦æ±‚\n            const effect =  `å­¦ä¼š${name}`; // æ•ˆæœç›´æ¥ç”¨æè¿°\n            const description = skill.description; // æè¿°ä¹Ÿç”¨å®ƒæœ¬èº«\n\n            return [name, price, category, requirements, effect, description];\n            // è¿”å›çš„æ ¼å¼: [åç§°, ç§¯åˆ†ä»·æ ¼, åˆ†ç±», {æ‰€éœ€æ”¯çº¿}, æ•ˆæœ, æè¿°]\n            // æ³¨æ„ï¼šè¿™é‡Œçš„â€œåˆ†ç±»â€å‚æ•°ä½ç½®ï¼ŒæŒ‰ç…§fixedItemsçš„æ ¼å¼ï¼Œæˆ‘æŠŠå®ƒå¡«ä¸ºâ€œåŸºç¡€æŠ€èƒ½â€\n        });\n\n \n        fixedItems.unshift(...baseSkillItems);\n        // \n\n\n    } catch (error) {\n        console.error(\"æ— æ³•åŠ è½½å’Œåˆå§‹åŒ–æ¸¸æˆæ•°æ®:\", error);\n        // ä½ å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ ä¸€äº›ç”¨æˆ·å‹å¥½çš„é”™è¯¯æç¤º\n    }\n\n \n\n // æ›¿æ¢æ•´ä¸ª setupAllUpgradeListeners å‡½æ•°\nfunction setupAllUpgradeListeners() {\n    const charPage = document.getElementById('page-character');// æˆ‘ä»¬å…ˆç§»é™¤æ‰€æœ‰å¯èƒ½å­˜åœ¨çš„æ—§ç›‘å¬å™¨ï¼Œç¡®ä¿å¹²å‡€\ncharPage.removeEventListener('dblclick', upgradeEventHandler);\n// å¦‚æœæœ‰æ—§çš„ç‚¹å‡»ç›‘å¬å™¨ä¹Ÿä¸€å¹¶ç§»é™¤ï¼ˆä¸ºäº†å®‰å…¨èµ·è§ï¼‰\n// charPage.removeEventListener('click', newUpgradeHandler); // å‡è®¾ä¹‹å‰çš„ handler å«è¿™ä¸ªåå­—\n\n// åˆ›å»ºä¸€ä¸ªæ–°çš„ã€èªæ˜çš„ç‚¹å‡»å¤„ç†å™¨\nconst newUpgradeHandler = (e) => {\n    // æˆ‘ä»¬åªå…³å¿ƒç‚¹å‡»åˆ° \"upgrade-btn\" çš„äº‹ä»¶\n    if (e.target.classList.contains('upgrade-btn')) {\n        upgradeEventHandler(e);\n    }\n};\n\n// ä¸ºäº†é˜²æ­¢é‡å¤ç»‘å®šï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ page å…ƒç´ ä¸Šå­˜å‚¨è¿™ä¸ªå¤„ç†å™¨\nif (charPage._upgradeHandler) {\n    charPage.removeEventListener('click', charPage._upgradeHandler);\n}\ncharPage._upgradeHandler = newUpgradeHandler;\ncharPage.addEventListener('click', newUpgradeHandler);\n\n// å¦‚æœä½ çš„ touchend äº‹ä»¶å¤„ç†å™¨ touchUpgradeHandler å­˜åœ¨ï¼Œä¹Ÿåœ¨è¿™é‡Œç§»é™¤\n// charPage.removeEventListener('touchend', touchUpgradeHandler);\n\n//console.log('å‡çº§ç›‘å¬å™¨å·²æ›´æ–°ä¸º â€œç‚¹å‡»åŠ å·â€ æ¨¡å¼');\n}\n\n// è§¦æ‘¸äº‹ä»¶å¤„ç†å™¨\nlet lastTouchEnd = 0;\nlet touchTarget = null;\nlet touchTimeout = null;\n\nfunction touchUpgradeHandler(event) {\n    const now = Date.now();\n    const target = event.target;\n    \n    // æ£€æŸ¥æ˜¯å¦æ˜¯å¯å‡çº§çš„å…ƒç´ \n    const upgradeableElement = target.closest('.upgradeable');\n    if (!upgradeableElement) return;\n    \n    // åŒå‡»æ£€æµ‹é€»è¾‘\n    if (touchTarget === upgradeableElement && now - lastTouchEnd <= 500) {\n        // æ¸…é™¤å¯èƒ½çš„å•å‡»å»¶æ—¶\n        if (touchTimeout) {\n            clearTimeout(touchTimeout);\n            touchTimeout = null;\n        }\n        \n        // é˜»æ­¢é»˜è®¤è¡Œä¸ºå’Œäº‹ä»¶å†’æ³¡\n        event.preventDefault();\n        event.stopPropagation();\n        \n        // è§¦å‘å‡çº§äº‹ä»¶\n        upgradeEventHandler.call(upgradeableElement, event);\n        \n        // é‡ç½®çŠ¶æ€\n        lastTouchEnd = 0;\n        touchTarget = null;\n    } else {\n        // è®°å½•è¿™æ¬¡è§¦æ‘¸\n        touchTarget = upgradeableElement;\n        lastTouchEnd = now;\n        \n        // è®¾ç½®å»¶æ—¶æ¸…é™¤ï¼Œé¿å…è¯¯è§¦å‘\n        touchTimeout = setTimeout(() => {\n            touchTarget = null;\n            lastTouchEnd = 0;\n        }, 500);\n    }\n}\n\n \n \n// æ›¿æ¢åŸæœ‰çš„ const target = e.target.closest('.upgradeable');\nfunction upgradeEventHandler(e) {\n    const target = e.target; // ç°åœ¨ç›´æ¥å°±æ˜¯æˆ‘ä»¬ç‚¹å‡»çš„é‚£ä¸ª \"+\" æŒ‰é’®\n    if (target) { // ç®€å•æ£€æŸ¥ä¸€ä¸‹\n        const { path, name, level, type } = target.dataset;\n        handleUpgrade(path, name, parseInt(level, 10), type);\n    }\n}\n\n}\n  \n\n// ==================== è‡ªå®šä¹‰QRæŒ‰é’®ç®¡ç†ç³»ç»Ÿ ====================\n\n// å­˜å‚¨é”®å\nconst QR_STORAGE_KEY = 'customQRButtons';\n\n// è·å–æ‰€æœ‰è‡ªå®šä¹‰QRæŒ‰é’®\nfunction getCustomQRButtons() {\n    try {\n        const data = localStorage.getItem(QR_STORAGE_KEY);\n        return data ? JSON.parse(data) : [];\n    } catch (e) {\n        console.error('è¯»å–è‡ªå®šä¹‰QRæŒ‰é’®å¤±è´¥:', e);\n        return [];\n    }\n}\n\n// ä¿å­˜è‡ªå®šä¹‰QRæŒ‰é’®\nfunction saveCustomQRButtons(buttons) {\n    try {\n        localStorage.setItem(QR_STORAGE_KEY, JSON.stringify(buttons));\n        return true;\n    } catch (e) {\n        console.error('ä¿å­˜è‡ªå®šä¹‰QRæŒ‰é’®å¤±è´¥:', e);\n        return false;\n    }\n}\n\n// æ¸²æŸ“è‡ªå®šä¹‰QRæŒ‰é’®åˆ°èœå•\nfunction renderCustomQRButtons() {\n    const buttons = getCustomQRButtons();\n    const menu = document.getElementById('action-popup-menu');\n    \n    // ç§»é™¤æ‰€æœ‰å·²å­˜åœ¨çš„è‡ªå®šä¹‰QRæŒ‰é’®\n    const existingCustomButtons = menu.querySelectorAll('.custom-qr-button');\n    existingCustomButtons.forEach(btn => btn.remove());\n    \n    // æ‰¾åˆ°\"è‡ªå®šä¹‰qr\"æŒ‰é’®\n    const addQrButton = document.getElementById('add-qr-button');\n    \n    // åœ¨\"è‡ªå®šä¹‰qr\"æŒ‰é’®åæ·»åŠ æ‰€æœ‰è‡ªå®šä¹‰æŒ‰é’®\n    buttons.forEach((qr, index) => {\n        const button = document.createElement('button');\n        button.className = 'popup-menu-button custom-qr-button';\n        button.textContent = qr.title;\n        button.dataset.qrIndex = index;\n        \n        button.addEventListener('click', (event) => {\n            event.stopPropagation();\n            triggerassa(`/setinput ${qr.content}`);\n        });\n        \n        // æ’å…¥åˆ°\"è‡ªå®šä¹‰qr\"æŒ‰é’®ä¹‹å\n        addQrButton.insertAdjacentElement('afterend', button);\n    });\n}\n\n// æ‰“å¼€è‡ªå®šä¹‰QRç®¡ç†å¼¹çª—\nfunction openCustomQRModal() {\n    const buttons = getCustomQRButtons();\n    \n    const overlay = document.createElement('div');\n    overlay.className = 'move-modal-overlay entry-edit-modal';\n    overlay.style.zIndex = '10000'; // æ·»åŠ è¿™è¡Œ\n    const modal = document.createElement('div');\n    modal.className = 'nova-modal-content';\n    modal.style.maxWidth = '600px';\n    modal.style.maxHeight = '80vh';\n\n    modal.innerHTML = `\n        <div class=\"move-modal-title\">\n            <span>è‡ªå®šä¹‰å¿«é€Ÿå›å¤æŒ‰é’®</span>\n        </div>\n        <div class=\"qr-modal-content\" style=\"padding: 20px; max-height: 60vh; overflow-y: auto;\">\n            <div id=\"qr-list\" class=\"qr-list\"></div>\n            <button id=\"add-new-qr-btn\" class=\"book-button\" style=\"width: 100%; margin-top: 15px;\">\n                â• æ·»åŠ æ–°æŒ‰é’®\n            </button>\n        </div>\n        <div class=\"move-modal-buttons\">\n            <button id=\"qr-modal-close-btn\" class=\"book-button\">å®Œæˆ</button>\n        </div>\n    `;\n    \n    overlay.appendChild(modal);\n    document.body.appendChild(overlay);\n    \n    // æ¸²æŸ“ç°æœ‰QRæŒ‰é’®åˆ—è¡¨\n    renderQRList(buttons);\n    \n    // æ˜¾ç¤ºåŠ¨ç”»\n    setTimeout(() => {\n        overlay.style.opacity = '1';\n        modal.style.transform = 'scale(1)';\n        modal.style.opacity = '1';\n    }, 10);\n    \n    // å…³é—­å¼¹çª—\n    const closeModal = () => {\n        overlay.style.opacity = '0';\n        modal.style.transform = 'scale(0.95)';\n        setTimeout(() => overlay.remove(), 300);\n        renderCustomQRButtons(); // å…³é—­æ—¶åˆ·æ–°èœå•\n    };\n    \n    document.getElementById('qr-modal-close-btn').onclick = closeModal;\n    overlay.addEventListener('click', (e) => {\n        if (e.target === overlay) closeModal();\n    });\n    \n    // æ·»åŠ æ–°æŒ‰é’®\n    document.getElementById('add-new-qr-btn').onclick = () => {\n        openQREditModal(null, (newQR) => {\n            const buttons = getCustomQRButtons();\n            buttons.push(newQR);\n            saveCustomQRButtons(buttons);\n            renderQRList(buttons);\n        });\n    };\n}\n\n// æ¸²æŸ“QRæŒ‰é’®åˆ—è¡¨\nfunction renderQRList(buttons) {\n    const qrList = document.getElementById('qr-list');\n    \n    if (buttons.length === 0) {\n        qrList.innerHTML = `\n            <div style=\"text-align: center; color: var(--text-secondary-color); padding: 30px 0;\">\n                è¿˜æ²¡æœ‰è‡ªå®šä¹‰æŒ‰é’®ï¼Œç‚¹å‡»ä¸‹æ–¹æ·»åŠ å§ï¼\n            </div>\n        `;\n        return;\n    }\n    \n    qrList.innerHTML = buttons.map((qr, index) => `\n        <div class=\"qr-item\" data-index=\"${index}\" style=\"\n            background: var(--container-bg-color);\n            border: 1px solid var(--border-color);\n            border-radius: 8px;\n            padding: 15px;\n            margin-bottom: 12px;\n            transition: all 0.3s ease;\n        \">\n            <div style=\"display: flex; justify-content: space-between; align-items: start;\">\n                <div style=\"flex: 1; margin-right: 15px;\">\n                    <div style=\"color: var(--primary-color); font-weight: 600; margin-bottom: 8px; font-size: 14px;\">\n                        ${qr.title.replace(/</g, '&lt;').replace(/>/g, '&gt;')}\n                    </div>\n                    <div style=\"color: var(--text-secondary-color); font-size: 12px; word-break: break-all;\">\n                        ${qr.content.replace(/</g, '&lt;').replace(/>/g, '&gt;')}\n                    </div>\n                </div>\n                <div style=\"display: flex; gap: 8px; flex-shrink: 0;\">\n                    <button class=\"qr-edit-btn\" data-index=\"${index}\" style=\"\n                        background: transparent;\n                        border: 1px solid var(--primary-color);\n                        color: var(--primary-color);\n                        padding: 6px 12px;\n                        border-radius: 4px;\n                        cursor: pointer;\n                        font-size: 12px;\n                        transition: all 0.3s ease;\n                    \">ç¼–è¾‘</button>\n                    <button class=\"qr-delete-btn\" data-index=\"${index}\" style=\"\n                        background: transparent;\n                        border: 1px solid var(--danger-color);\n                        color: var(--danger-color);\n                        padding: 6px 12px;\n                        border-radius: 4px;\n                        cursor: pointer;\n                        font-size: 12px;\n                        transition: all 0.3s ease;\n                    \">åˆ é™¤</button>\n                </div>\n            </div>\n        </div>\n    `).join('');\n    \n    // æ·»åŠ æ‚¬åœæ•ˆæœæ ·å¼\n    const style = document.createElement('style');\n    style.textContent = `\n        .qr-item:hover {\n            border-color: var(--primary-color) !important;\n            box-shadow: 0 0 15px var(--glow-color);\n        }\n        .qr-edit-btn:hover {\n            background: var(--primary-color) !important;\n            color: var(--background-color) !important;\n            box-shadow: 0 0 10px var(--glow-color);\n        }\n        .qr-delete-btn:hover {\n            background: var(--danger-color) !important;\n            color: white !important;\n            box-shadow: 0 0 10px var(--danger-glow-color);\n        }\n    `;\n    document.head.appendChild(style);\n    \n    // ç»‘å®šç¼–è¾‘æŒ‰é’®äº‹ä»¶\n    qrList.querySelectorAll('.qr-edit-btn').forEach(btn => {\n        btn.onclick = (e) => {\n            e.stopPropagation();\n            const index = parseInt(btn.dataset.index);\n            const buttons = getCustomQRButtons();\n            openQREditModal(buttons[index], (updatedQR) => {\n                buttons[index] = updatedQR;\n                saveCustomQRButtons(buttons);\n                renderQRList(buttons);\n            });\n        };\n    });\n    \n    // ç»‘å®šåˆ é™¤æŒ‰é’®äº‹ä»¶\nqrList.querySelectorAll('.qr-delete-btn').forEach(btn => {\n    btn.onclick = (e) => {\n        e.stopPropagation();\n        const index = parseInt(btn.dataset.index);\n        // ç›´æ¥åˆ é™¤ï¼Œä¸ä½¿ç”¨ confirm\n        const buttons = getCustomQRButtons();\n        buttons.splice(index, 1);\n        saveCustomQRButtons(buttons);\n        renderQRList(buttons);\n        };\n    });\n}\n\n// æ‰“å¼€QRæŒ‰é’®ç¼–è¾‘å¼¹çª—\nfunction openQREditModal(existingQR, onSave) {\n    const isEdit = existingQR !== null;\n    \n    const overlay = document.createElement('div');\n    overlay.className = 'move-modal-overlay entry-edit-modal';\noverlay.style.zIndex = '999999'; // ä½¿ç”¨è¶…é«˜å±‚çº§\n \n    const modal = document.createElement('div');\n    modal.className = 'nova-modal-content';\n    modal.style.maxWidth = '500px';\n    \n    modal.innerHTML = `\n        <div class=\"move-modal-title\">\n            <span>${isEdit ? 'ç¼–è¾‘' : 'æ·»åŠ '}å¿«é€Ÿå›å¤æŒ‰é’®</span>\n        </div>\n        <div style=\"padding: 20px;\">\n            <div style=\"margin-bottom: 20px;\">\n                <label style=\"display: block; color: var(--text-color); margin-bottom: 8px; font-size: 14px;\">\n                    æŒ‰é’®æ ‡é¢˜\n                </label>\n                <input \n                    type=\"text\" \n                    id=\"qr-title-input\" \n                    placeholder=\"ä¾‹å¦‚ï¼šå¿«é€Ÿæ€»ç»“\" \n                    value=\"${isEdit ? existingQR.title.replace(/\"/g, '&quot;') : ''}\"\n                    style=\"\n                        width: 100%;\n                        padding: 10px;\n                        background: var(--container-bg-color);\n                        border: 1px solid var(--border-color);\n                        border-radius: 6px;\n                        color: var(--text-color);\n                        font-size: 14px;\n                        font-family: var(--base-font-family);\n                        box-sizing: border-box;\n                    \"\n                />\n            </div>\n            <div style=\"margin-bottom: 20px;\">\n                <label style=\"display: block; color: var(--text-color); margin-bottom: 8px; font-size: 14px;\">\n                    å‘é€å†…å®¹\n                </label>\n                <textarea \n                    id=\"qr-content-input\" \n                    placeholder=\"ä¾‹å¦‚ï¼š<request:æ€»ç»“ä¸€ä¸‹ä¸Šé¢çš„å†…å®¹>\"\n                    rows=\"4\"\n                    style=\"\n                        width: 100%;\n                        padding: 10px;\n                        background: var(--container-bg-color);\n                        border: 1px solid var(--border-color);\n                        border-radius: 6px;\n                        color: var(--text-color);\n                        font-size: 14px;\n                        font-family: var(--base-font-family);\n                        resize: vertical;\n                        box-sizing: border-box;\n                    \"\n                >${isEdit ? existingQR.content.replace(/</g, '&lt;').replace(/>/g, '&gt;') : '<request: >'}</textarea>\n            </div>\n        </div>\n        <div class=\"move-modal-buttons\">\n            <button id=\"qr-edit-cancel-btn\" class=\"book-button secondary\">å–æ¶ˆ</button>\n            <button id=\"qr-edit-confirm-btn\" class=\"book-button\">ä¿å­˜</button>\n        </div>\n    `;\n    \n    overlay.appendChild(modal);\n    document.body.appendChild(overlay);\n    \n    // æ˜¾ç¤ºåŠ¨ç”»\n    setTimeout(() => {\n        overlay.style.opacity = '1';\n        modal.style.transform = 'scale(1)';\n        modal.style.opacity = '1';\n        document.getElementById('qr-title-input').focus();\n    }, 10);\n    \n    // å…³é—­å¼¹çª—\n    const closeModal = () => {\n        overlay.style.opacity = '0';\n        modal.style.transform = 'scale(0.95)';\n        setTimeout(() => overlay.remove(), 300);\n    };\n    \n    // ä¿å­˜æŒ‰é’®\n    document.getElementById('qr-edit-confirm-btn').onclick = () => {\n        const title = document.getElementById('qr-title-input').value.trim();\n        const content = document.getElementById('qr-content-input').value.trim();\n        \n        if (!title) {\n            alert('è¯·è¾“å…¥æŒ‰é’®æ ‡é¢˜');\n            return;\n        }\n        \n        if (!content) {\n            alert('è¯·è¾“å…¥å‘é€å†…å®¹');\n            return;\n        }\n        \n        onSave({ title, content });\n        closeModal();\n    };\n    \n    // å–æ¶ˆæŒ‰é’®\n    document.getElementById('qr-edit-cancel-btn').onclick = closeModal;\n    overlay.addEventListener('click', (e) => {\n        if (e.target === overlay) closeModal();\n    });\n}\n\n// ==================== åˆå§‹åŒ– ====================\n\n/* ä»£ç  START: æ·»åŠ åœ¨è¿™é‡Œ */\n\n/**\n * æ–°å¢ï¼šæ ¹æ®è§£æå‡ºçš„æ ‡å¿—ï¼Œæ›´æ–°UIä¸Šçš„é€šçŸ¥æç¤º\n * @param {object} flags - åŒ…å«æ›´æ–°æ ‡å¿—çš„å¯¹è±¡\n */\nfunction displayUpdateNotifications(message, type = 'info') {\n    if (!notificationLogContainer) return;\n\n    const logItem = document.createElement('div');\n    logItem.className = `log-item ${type}`;\n    const time = new Date().toLocaleTimeString('en-GB');\n    logItem.innerHTML = `<span class=\"log-time\">[${time}]</span>${message}`;\n\n    // ç°åœ¨æ˜¯ appendChildï¼Œå°†æ–°æ¶ˆæ¯æ·»åŠ åˆ°æ—¥å¿—æœ«å°¾\n    notificationLogContainer.appendChild(logItem);\n}\n\nfunction populateInventoryModal() {\n    const inventoryList = document.getElementById('inventory-item-list');\n    const deleteBtn = document.getElementById('delete-item-btn');\n    const useBtn = document.getElementById('use-item-btn');\n    inventoryList.innerHTML = '';\n    deleteBtn.disabled = true;\n    useBtn.disabled = true;\n\n    const inventoryData = assaSettingsData.global_lore?.èƒŒåŒ…;\n\n    if (!inventoryData || Object.keys(inventoryData).length === 0) {\n        inventoryList.innerHTML = '<li style=\"color:var(--text-secondary-color); text-align:center; padding:20px 0;\">è¡Œå›Šæ˜¯ç©ºçš„</li>';\n        return;\n    }\n\n    for (const itemName in inventoryData) {\n         const item = inventoryData[itemName];\n         let  itemDesc = '';\n        if (typeof item === 'string') {\n    // ç›´æ¥ä½¿ç”¨å­—ç¬¦ä¸²æ•°æ®\n    itemDesc =\"ï¼š\"+item;\n} else if (typeof item === 'object' && item !== null) {\n     itemDesc =\"ï¼š\"+item?.info || '';\n}\n       \n        const li = document.createElement('li');\n        li.className = 'inventory-item';\n        // æ˜¾ç¤ºåç§°å’Œæè¿°\n        li.textContent = `${itemName}${itemDesc}`;\n        li.dataset.item = itemName; // ç”¨ item name ä½œä¸º key\n        inventoryList.appendChild(li);\n    }\n}\n    \n       // æ›¿æ¢ä¸º:\nconst fixedItems = [\n    // æ ¼å¼: [åç§°, ç§¯åˆ†ä»·æ ¼, åˆ†ç±», {æ‰€éœ€æ”¯çº¿}, æ•ˆæœ, æè¿°]\n     [\"å‹ç¼©é¥¼å¹²\", 50, \"ç‰©å“\", {}, \"å¡«é¥±è‚šå­\", \"ä¸€å—å¯ä»¥æä¾›ä¸€å¤©èƒ½é‡çš„é«˜çƒ­é‡é¥¼å¹²ï¼Œå‘³é“ä¸æ€ä¹ˆæ ·ã€‚\"],\n    [\"çº¯å‡€æ°´\", 20, \"ç‰©å“\", {}, \"è§£æ¸´\", \"ç»è¿‡å‡€åŒ–çš„é¥®ç”¨æ°´ï¼Œ500æ¯«å‡è£…ã€‚\"],\n    [\"æ–°æ‰‹åŒ•é¦–\", 300, \"ç‰©å“\", {}, \"ã€åŠ›é‡+1ã€‘åŸºç¡€çš„è¿‘æˆ˜æ­¦å™¨\", \"ä¸€æŠŠå¹³å¹³æ— å¥‡çš„é“åŒ•é¦–ï¼ŒèŠèƒœäºæ— ã€‚\"],\n    [\"å¸ƒç”²\", 600, \"ç‰©å“\", {}, \"ã€é˜²å¾¡+5ã€‘æä¾›å°‘é‡ç‰©ç†é˜²å¾¡\", \"ç”±ç²—å¸ƒåˆ¶æˆçš„ç®€æ˜“æŠ¤ç”²ï¼Œèƒ½æŠµæŒ¡ä¸€äº›è½»å¾®çš„åˆ’ä¼¤ã€‚\"],\n    [\"è§£æ¯’å‰‚\", 400, \"ç‰©å“\", {}, \"è§£é™¤æ™®é€šä¸­æ¯’çŠ¶æ€\", \"ä¸€å°ç“¶ç»¿è‰²çš„æ¶²ä½“ï¼Œå¯ä»¥ä¸­å’Œå¤šç§å¸¸è§æ¯’ç´ ã€‚\"],\n    [\"å¸ç¯·\", 1000, \"ç‰©å“\", {}, \"æä¾›ä¸€ä¸ªå®‰å…¨çš„ä¼‘æ¯åœºæ‰€\", \"ç®€å•çš„å•äººå¸ç¯·ï¼Œå¯ä»¥åœ¨é‡å¤–æä¾›é®é£é¿é›¨çš„åœ°æ–¹ã€‚\"],\n    [\"ç«æŠŠ\", 50, \"ç‰©å“\", {}, \"æä¾›ç…§æ˜\", \"å¯ä»¥ç‡ƒçƒ§ä¸€å°æ—¶çš„ç«æŠŠï¼Œé©±æ•£é»‘æš—ã€‚\"],\n    [\"é’¢åˆ¶é•¿å‰‘\", 1500, \"ç‰©å“\", {}, \"ã€åŠ›é‡+2ã€‘æ¯”æ–°æ‰‹åŒ•é¦–æ›´å¼ºçš„æ­¦å™¨\", \"ä¸€æŠŠåšå·¥ç²¾è‰¯çš„é’¢å‰‘ï¼Œå…¼å…·åŠˆç ä¸åˆºå‡»èƒ½åŠ›ã€‚\"],\n    [\"é”å­ç”²\", 3500, \"ç‰©å“\", {}, \"ã€é˜²å¾¡+15ã€‘æä¾›è¾ƒå¥½çš„ç‰©ç†é˜²å¾¡\", \"ç”±é“ç¯ç¼–ç»‡è€Œæˆçš„æŠ¤ç”²ï¼Œå¯¹åˆ‡å‰²ä¼¤å®³æœ‰å¾ˆå¥½çš„é˜²å¾¡æ•ˆæœã€‚\"],\n    [\"çˆ†è£‚ç®­\", 800, \"ç‰©å“\", {}, \"å‘½ä¸­ç›®æ ‡åä¼šå‘ç”Ÿå°èŒƒå›´çˆ†ç‚¸çš„ç®­çŸ¢\", \"å¼“ç®­æ‰‹çš„åˆ©å™¨ï¼Œå¯ä»¥å¯¹ä»˜èšé›†åœ¨ä¸€èµ·çš„æ•Œäººã€‚\"],\n    [\"ç”Ÿå‘½è¯æ°´\", 500, \"ç‰©å“\", {}, \"æ¢å¤50ç‚¹ç”Ÿå‘½å€¼\", \"ä¸€ç“¶é€å‡ºçº¢å…‰çš„æ¶²ä½“ï¼Œèƒ½å¤Ÿå¿«é€Ÿæ¢å¤ä¼¤åŠ¿ã€‚\"],\n    [\"é­”æ³•è¯æ°´\", 800, \"ç‰©å“\", {}, \"æ¢å¤50ç‚¹èƒ½é‡æ± \", \"è“è‰²çš„ç¥ç§˜è¯å‰‚ï¼Œè•´å«ç€çº¯å‡€çš„é­”æ³•èƒ½é‡ã€‚\"],\n    [\"æ€¥æ•‘åŒ…\", 300, \"ç‰©å“\", {}, \"å¤„ç†å¤–ä¼¤ï¼Œæ­¢è¡€\", \"åŒ…å«ç»·å¸¦ã€æ¶ˆæ¯’è¯æ°´å’Œæ­¢ç—›è¯çš„åŒ»ç–—ç”¨å“ã€‚\"],\n     [\"ä¸‡èƒ½é’¥åŒ™\", 1200, \"ç‰©å“\", {}, \"å¯ä»¥å¼€å¯å¤§éƒ¨åˆ†æ™®é€šé—¨é”\", \"ä¸€æŠŠçœ‹èµ·æ¥å¾ˆæ™®é€šçš„é’¥åŒ™ï¼Œä½†å†…éƒ¨ç»“æ„æå…¶ç²¾å·§ã€‚\"],\n    [\"ç¿»è¯‘è€³å¡\", 4000, \"ç‰©å“\", {}, \"å®æ—¶ç¿»è¯‘å¬åˆ°çš„æ‰€æœ‰è¯­è¨€\", \"é«˜ç§‘æŠ€é€ ç‰©ï¼Œè®©ä½ æ— éšœç¢åœ°ä¸ä»»ä½•æ™ºæ…§ç”Ÿå‘½æ²Ÿé€šã€‚\"],\n    [\"èƒ½é‡æ£’\", 100, \"ç‰©å“\", {}, \"è¿…é€Ÿè¡¥å……ä½“åŠ›\", \"å‘³é“åƒå·§å…‹åŠ›çš„èƒ½é‡æ£’ï¼Œèƒ½å¿«é€Ÿæ¢å¤æ¶ˆè€—çš„ä½“åŠ›ã€‚\"],\n    [\"é—ªå…‰å¼¹\", 400, \"ç‰©å“\", {}, \"ã€éšè—+1ã€‘ä¸€æ¬¡æ€§ç‰©å“ï¼Œäº§ç”Ÿå¼ºå…‰å’Œå·¨å“ï¼Œä½¿æ•Œäººæš‚æ—¶å¤±æ˜å¤±èª\", \"æˆ˜æœ¯æ€§é“å…·ï¼Œå¯ä»¥ä¸ºè‡ªå·±åˆ›é€ æœºä¼šã€‚\"],\n    [\"é™„é­”ä¹‹å°˜\", 900, \"ç‰©å“\", {}, \"ä¸ºæ­¦å™¨æˆ–é˜²å…·é™„åŠ ä¸´æ—¶çš„å¾®å¼±å±æ€§æå‡\", \"é—ªäº®çš„é­”æ³•ç²‰æœ«ï¼Œå¯ä»¥å°‘é‡å¢å¼ºè£…å¤‡æ€§èƒ½ã€‚\"],\n    [\"è‡ªåŠ¨ä¹¦è®°äººå¶\", 7000, \"ç‰©å“\", {}, \"ã€è°ƒæŸ¥+2ã€‘å¯ä»¥è‡ªåŠ¨è®°å½•è¯­è¨€å’Œç”»é¢çš„æœºæ¢°äººå¶\", \"æ¥è‡ªç§‘æŠ€ä¸–ç•Œçš„ä¾¦æŸ¥ä¸è®°å½•å·¥å…·ï¼Œéå¸¸å¯é ã€‚\"],\n    [\"ä¼ªè£…å·¥å…·åŒ…\", 1300, \"ç‰©å“\", {}, \"ã€æ©é¥°+1ã€‘åŒ…å«åŒ–å¦†å“å’Œå‡å‘ç­‰ï¼Œå¯ä»¥æ”¹å˜å¤–è²Œ\", \"è¿›è¡Œæ½œå…¥ä»»åŠ¡æ—¶çš„å¥½å¸®æ‰‹ã€‚\"],\n    [\"æ¯’è¯ï¼ˆæ™®é€šï¼‰\", 500, \"ç‰©å“\", {}, \"ã€åŠ›é‡+1ã€‘ä¸€æ¬¡æ€§ç”¨å“ï¼Œå¯ä»¥æ¶‚æŠ¹åœ¨æ­¦å™¨ä¸Šï¼Œä½¿æ•Œäººä¸­æ¯’\", \"å¸¸è§çš„ç¥ç»æ¯’ç´ ï¼Œä¼šè®©ç›®æ ‡æŒç»­æŸå¤±ç”Ÿå‘½å€¼å¹¶é™·å…¥éº»ç—¹ã€‚\"],\n    [\"æ”€çˆ¬æ‰‹å¥—\", 1100, \"ç‰©å“\", {}, \"ã€è¿åŠ¨+1ã€‘æ‰‹å¥—è¡¨é¢æœ‰æå¼ºçš„å¸é™„åŠ›ï¼Œå¯ä»¥è½»æ¾æ”€çˆ¬å¢™å£\", \"å£è™ä¸€æ ·çš„èƒ½åŠ›ï¼Œè®©ä½ åˆ°è¾¾å¸¸äººæ— æ³•ä¼åŠä¹‹å¤„ã€‚\"],\n    [\"è¥å…»è†ï¼ˆè‰è“å‘³ï¼‰\", 30, \"ç‰©å“\", {}, \"æä¾›åŸºç¡€è¥å…»\", \"ä¸€æ”¯ç‰™è†çŠ¶çš„ç³ŠçŠ¶é£Ÿç‰©ï¼Œèƒ½æ»¡è¶³ä¸€å¤©çš„åŸºæœ¬è¥å…»éœ€æ±‚ï¼Œå‘³é“èŠèƒœäºæ— ã€‚\"],\n    [\"å†›ç”¨å£ç²®\", 150, \"ç‰©å“\", {}, \"æä¾›èƒ½é‡å’Œé¥±è…¹æ„Ÿï¼Œé™„å¸¦åŠ çƒ­åŒ…\", \"æ¯”å‹ç¼©é¥¼å¹²å¥½åƒä¸€ç‚¹ï¼Œå†…å«ä¸»é£Ÿã€é…èœå’Œç”œç‚¹ï¼Œæ˜¯å£«å…µçš„æ ‡å‡†é…ç½®ã€‚\"],\n    [\"ç–—ä¼¤è‰è¯\", 200, \"ç‰©å“\", {}, \"æ£ç¢åå¤–æ•·ï¼Œæ­¢è¡€å¹¶åŠ é€Ÿè½»ä¼¤æ„ˆåˆ\", \"æ¥è‡ªæ­¦ä¾ ä¸–ç•Œçš„å¸¸è§è‰è¯ï¼Œå¯¹åˆ€å‰‘ä¼¤æœ‰ä¸é”™çš„æ•ˆæœã€‚\"],\n    [\"çƒŸé›¾å¼¹\", 350, \"ç‰©å“\", {}, \"ã€éšè—+1ã€‘ä¸€æ¬¡æ€§ç‰©å“ï¼Œåˆ¶é€ ä¸€ç‰‡æµ“çƒŸï¼Œé®è”½è§†çº¿\", \"å¿è€…å¸¸ç”¨çš„é“å…·ï¼Œç”¨äºæ’¤é€€æˆ–åˆ¶é€ æ··ä¹±ã€‚\"],\n    [\"ç²¾åˆ¶é£åˆ€ï¼ˆä¸‰æŠŠï¼‰\", 450, \"ç‰©å“\", {}, \"ã€å¼“ç®­+1ã€‘å¯ä»¥æŠ•æ·çš„é”‹åˆ©å°åˆ€\", \"ç»è¿‡ç‰¹æ®Šé…é‡ï¼Œæ¯”æ™®é€šå°åˆ€æ›´å®¹æ˜“å‘½ä¸­ç›®æ ‡ã€‚\"],\n    [\"è¿‡æ»¤æ°´å£¶\", 700, \"ç‰©å“\", {}, \"èƒ½å°†æ±¡æŸ“æ°´æºè¿‡æ»¤æˆå¯é¥®ç”¨çš„çº¯æ°´\", \"æœ«ä¸–ç”Ÿå­˜çš„å¿…å¤‡å“ï¼Œå¯ä»¥åå¤ä½¿ç”¨100æ¬¡ã€‚\"],\n    [\"åå­—å¼©\", 2000, \"ç‰©å“\", {}, \"ã€å¼“ç®­+1ã€‘æ— å£°çš„è¿œç¨‹æ­¦å™¨ï¼Œå¨åŠ›å°šå¯\", \"æ¯”å¼“ç®­æ›´å®¹æ˜“ä¸Šæ‰‹ï¼Œä¸Šå¼¦é€Ÿåº¦è¾ƒæ…¢æ˜¯å…¶ç¼ºç‚¹ã€‚\"],\n    [\"é˜²æ¯’é¢å…·\", 1400, \"ç‰©å“\", {}, \"ã€åŒ»å­¦+1ã€‘è¿‡æ»¤æœ‰æ¯’æ°”ä½“\", \"å¯ä»¥æŠµå¾¡å¤§éƒ¨åˆ†åŒ–å­¦æ¯’æ°”å’Œç”Ÿç‰©æ¯’æ°”ï¼Œæ»¤èŠ¯éœ€å®šæœŸæ›´æ¢ã€‚\"],\n    [\"å¤œè§†ä»ªï¼ˆåˆçº§ï¼‰\", 2800, \"ç‰©å“\", {}, \"åœ¨é»‘æš—ä¸­æä¾›è§†è§‰\", \"æ¥è‡ªç§‘æŠ€ä¸–ç•Œçš„è£…å¤‡ï¼Œè®©ä½ åœ¨å¤œæ™šä¹Ÿèƒ½åƒç™½å¤©ä¸€æ ·è¡ŒåŠ¨ã€‚\"],\n    [\"ç²¾çµä¹‹æ³‰æ°´ï¼ˆ100mlï¼‰\", 8500, \"ç‰©å“\", {}, \"å‡€åŒ–è´Ÿé¢çŠ¶æ€ï¼Œç¼“æ…¢æ¢å¤ç”Ÿå‘½å’Œé­”åŠ›\", \"æ¥è‡ªç²¾çµåœ£åœ°çš„æ³‰æ°´ï¼Œå……æ»¡äº†è‡ªç„¶çš„ç”Ÿå‘½èƒ½é‡ã€‚\"],\n    [\"ç©ºé—´é“æ ‡ï¼ˆä¸€æ¬¡æ€§ï¼‰\", 15000, \"ç‰©å“\", {}, \"è®°å½•å½“å‰ç©ºé—´åæ ‡ï¼Œå¯éšæ—¶ä¼ é€å›æ­¤åœ°\", \"éå¸¸çè´µçš„ä¿å‘½é“å…·ï¼Œåœ¨ä»»åŠ¡ä¸–ç•Œè®¾ç½®åï¼Œæ— è®ºèº«åœ¨ä½•å¤„éƒ½èƒ½ç¬é—´è¿”å›ã€‚\"],\n    [\"é¾™é³ç›¾\", 25000, \"ç‰©å“\", {}, \"ã€é˜²å¾¡+50ã€‘æä¾›æé«˜çš„ç«ç„°æŠ—æ€§å’Œç‰©ç†é˜²å¾¡\", \"ç”¨æˆå¹´ç«é¾™çš„é³ç‰‡æ‰“é€ çš„ç›¾ç‰Œï¼Œåšä¸å¯æ‘§ã€‚\"],\n    [\"ä¾¿æºå¼æœºç”²å¬å”¤å™¨\", 40000, \"ç‰©å“\", {}, \"ã€åŠ›é‡+5ã€‘å¬å”¤ä¸€å°åˆ¶å¼è½»å‹æœºç”²ååŠ©ä½œæˆ˜\", \"å†…ç½®AIè¾…åŠ©æ“ä½œç³»ç»Ÿï¼Œå¯ä»¥æä¾›å¼ºå¤§çš„ç«åŠ›æ”¯æ´ï¼Œèƒ½é‡è€—å°½åè‡ªåŠ¨æ”¶å›ã€‚\"],\n      [\"Ex-å’–å–±æ£’ï¼ˆä»¿åˆ¶å“ï¼‰\", 70000, \"ç‰©å“\", {}, \"ã€åŠ›é‡+10ã€‘å¯é‡Šæ”¾ä¸€æ¬¡å¼ºå¤§çš„å…‰ç‚®æ”»å‡»\", \"æ¨¡ä»¿ä¼ è¯´ä¸­åœ£å‰‘çš„é­”åŠ›é“å…·ï¼Œå¨åŠ›åªæœ‰åŸç‰ˆçš„ç™¾åˆ†ä¹‹ä¸€ï¼Œä½†è¶³ä»¥æ‘§æ¯ä¸€åº§å°å±±ã€‚ä½¿ç”¨åé“å…·æŸæ¯ã€‚\"],\n [\"è€æ—§çš„G17\", 3000, \"ç‰©å“\", {}, \"ã€æªæ¢°+1ã€‘æ— é™å­å¼¹\", \"ä¸€æŠŠéšå¤„å¯è§çš„9æ¯«ç±³æ‰‹æªï¼Œæ€§èƒ½å¹³åº¸ä½†æä¸ºå¯é ï¼Œæ˜¯æ— æ•°æ–°æ‰‹å†’é™©è€…å¼€å¯ä»–ä»¬æ—…ç¨‹çš„ç¬¬ä¸€ä¸ªä¼™ä¼´ã€‚\"],\n    [\"MP5K-N\", 4500, \"ç‰©å“\", {}, \"ã€æªæ¢°+1ã€‘æ— é™å­å¼¹ï¼Œå°„é€Ÿå¿«\", \"ç´§å‡‘å‹çš„å†²é”‹æªï¼Œä¾¿äºæºå¸¦ã€‚æé«˜çš„å°„é€Ÿè®©å®ƒåœ¨ç‹­çª„ç©ºé—´é‡Œèƒ½æ³¼æ´’å‡ºè‡´å‘½çš„å¼¹é›¨ã€‚\"],\n    [\"é¬£ç‹—-12\", 5000, \"ç‰©å“\", {}, \"ã€æªæ¢°+2ã€‘æ— é™å­å¼¹ï¼Œè¿‘è·ç¦»é«˜ä¼¤å®³\", \"åŸºç¡€çš„æ³µåŠ¨å¼éœ°å¼¹æªï¼Œæ¯ä¸€æ¬¡ä¸Šè†›éƒ½å……æ»¡äº†åŠ›é‡æ„Ÿã€‚åªè¦è·ç¦»å¤Ÿè¿‘ï¼Œå†å‡¶çŒ›çš„é‡å…½ä¹Ÿå¾—é€€è®©ä¸‰åˆ†ã€‚\"],\n    [\"SKS\", 5000, \"ç‰©å“\", {}, \"ã€æªæ¢°+2ã€‘æ— é™å­å¼¹ï¼ŒåŠè‡ªåŠ¨å°„å‡»\", \"ä¸€æŠŠè€å¼çš„åŠè‡ªåŠ¨æ­¥æªï¼Œç²¾å‡†åº¦å°šå¯ï¼Œå¨åŠ›é€‚ä¸­ï¼Œæ·±å—é‚£äº›å–œæ¬¢ç²¾ç¡®æ‰“å‡»è€Œéèƒ¡ä¹±æ‰«å°„çš„å®ç”¨ä¸»ä¹‰è€…å–œçˆ±ã€‚\"],\n    [\"ç‰§é©¬äºº\", 4000, \"ç‰©å“\", {}, \"ã€æªæ¢°+2ã€‘æ— é™å­å¼¹ï¼Œå•å‘ä¼¤å®³è¾ƒé«˜\", \"ä¸€æŠŠå……æ»¡è¥¿éƒ¨é£æƒ…çš„å·¦è½®æ‰‹æªã€‚è™½ç„¶è£…å¼¹æ…¢ï¼Œä½†æ¯ä¸€å‘å­å¼¹éƒ½æ²‰é‡è€Œæœ‰åŠ›ï¼Œå¸¦ç€å¼€æ‹“è€…çš„ç²¾ç¥ã€‚\"],\n    [\"AK-74M\", 8000, \"ç‰©å“\", {}, \"ã€æªæ¢°+3ã€‘æ— é™å­å¼¹ï¼Œçš®å®è€ç”¨\", \"ç»å…¸çªå‡»æ­¥æªçš„ç°ä»£åŒ–æ”¹è¿›å‹ï¼Œæ— è®ºåœ¨å¤šæ¶åŠ£çš„ç¯å¢ƒä¸‹éƒ½èƒ½æ­£å¸¸å·¥ä½œï¼Œæ˜¯æ¸¸å‡»æˆ˜å’Œé•¿æœŸä»»åŠ¡çš„ç»ä½³é€‰æ‹©ã€‚\"],\n    [\"M4A1\", 10000, \"ç‰©å“\", {}, \"ã€æªæ¢°+3ã€‘æ— é™å­å¼¹ï¼Œé…ä»¶æ¥å£ä¸°å¯Œ\", \"ä¸€æŠŠé«˜åº¦æ¨¡å—åŒ–çš„å¡å®¾æªï¼Œæ€§èƒ½å‡è¡¡ï¼Œæ‰‹æ„Ÿæä½³ã€‚æ— æ•°çš„æˆ˜æœ¯é…ä»¶è®©å®ƒå¯ä»¥é€‚åº”ä»»ä½•æˆ˜åœºç¯å¢ƒã€‚\"],\n    [\"SPAS-12\", 12000, \"ç‰©å“\", {}, \"ã€æªæ¢°+3ã€‘æ— é™å­å¼¹ï¼Œå¯åˆ‡æ¢å°„å‡»æ¨¡å¼\", \"ä¸€æŠŠé€ å‹å‡¶æ‚çš„æˆ˜æ–—éœ°å¼¹æªï¼Œå¯ä»¥åœ¨è¿…é€Ÿçš„åŠè‡ªåŠ¨å°„å‡»å’Œç²¾å‡†çš„æ³µåŠ¨æ¨¡å¼ä¹‹é—´åˆ‡æ¢ï¼Œå…¼å…·é€Ÿåº¦ä¸å¨åŠ›ã€‚\"],\n    [\"çŒæ‰‹SR\", 15000, \"ç‰©å“\", {}, \"ã€æªæ¢°+3ã€‘æ— é™å­å¼¹ï¼Œä¸­è·ç¦»ç²¾å‡†\", \"ä¸“ä¸ºç²¾å‡†å°„æ‰‹è®¾è®¡çš„æ­¥æªï¼Œè™½ç„¶ä¸æ˜¯ä¸“ä¸šçš„ç‹™å‡»æªï¼Œä½†åœ¨ä¸­è·ç¦»ä¸Šèƒ½æä¾›æŒç»­è€Œç²¾ç¡®çš„ç«åŠ›æ”¯æ´ã€‚\"],\n    [\"æ²™é¹°.50\", 18000, \"ç‰©å“\", {}, \"ã€æªæ¢°+3ã€‘æ— é™å­å¼¹ï¼Œå·¨å¤§å¨åŠ›\", \"æ‰‹æªä¸­çš„å·¨ç‚®ã€‚å·¨å¤§çš„åååŠ›å’Œéœ‡è€³æ¬²è‹çš„æªå£°æ˜¯å®ƒæ— ä¸ä¼¦æ¯”å¨åŠ›çš„è¯æ˜ï¼Œæ˜¯åŠ›é‡çš„è±¡å¾ã€‚\"],\n    [\"P90\", 16000, \"ç‰©å“\", {}, \"ã€æªæ¢°+3ã€‘æ— é™å­å¼¹ï¼Œé«˜ç©¿é€åŠ›\", \"è®¾è®¡å‰å«çš„ä¸ªäººé˜²å«æ­¦å™¨ï¼Œç‹¬ç‰¹çš„ä¾›å¼¹æ–¹å¼å’Œé«˜ç©¿é€åŠ›çš„å­å¼¹è®©å®ƒåœ¨é¢å¯¹è½»å‹æŠ¤ç”²çš„æ•Œäººæ—¶æå…·ä¼˜åŠ¿ã€‚\"],\n    [\"FN SCAR-H\", 20000, \"ç‰©å“\", {}, \"ã€æªæ¢°+3ã€‘æ— é™å­å¼¹ï¼Œé«˜åœæ­¢ä½œç”¨\", \"ä½¿ç”¨å¤§å¨åŠ›æ­¥æªå¼¹çš„æˆ˜æ–—æ­¥æªï¼Œæ¯ä¸€å‘å‘½ä¸­éƒ½èƒ½æœ‰æ•ˆé˜»æ­¢æ•Œäººçš„è¡ŒåŠ¨ï¼Œæ˜¯å°é˜Ÿä¸­çš„ä¸­åšåŠ›é‡ã€‚\"],\n    [\"AWM\", 25000, \"ç‰©å“\", {}, \"ã€æªæ¢°+3ã€‘æ— é™å­å¼¹ï¼Œè¶…è¿œç¨‹ç‹™å‡»\", \"ç‹™å‡»æ‰‹ä¸­çš„ä¼ å¥‡ã€‚ç‹¬ç‰¹çš„é©¬æ ¼å—å­å¼¹èµ‹äºˆäº†å®ƒæè¿œçš„å°„ç¨‹å’Œææ€–çš„ç²¾åº¦ï¼Œæ˜¯æ‰€æœ‰è„†çš®ç›®æ ‡çš„å™©æ¢¦ã€‚\"],\n    [\"Vector\", 22000, \"ç‰©å“\", {}, \"ã€æªæ¢°+3ã€‘æ— é™å­å¼¹ï¼Œæè‡´å°„é€Ÿ\", \"é€šè¿‡å¤æ‚çš„æªæœºè®¾è®¡å°†åååŠ›é™åˆ°æœ€ä½ï¼Œä»è€Œå®ç°äº†å†²é”‹æªä¸­è¿‘ä¹é¡¶çº§çš„å°„é€Ÿï¼Œèƒ½åœ¨ç¬é—´æ’•ç¢ä»»ä½•ç›®æ ‡ã€‚\"],\n    [\"è’¸æ±½é’»å­”è€…\", 28000, \"ç‰©å“\", {}, \"ã€æªæ¢°+3ã€‘æ— é™å­å¼¹ï¼Œå¯¹æœºæ¢°å•ä½é€ æˆé¢å¤–ä¼¤å®³\", \"ä¸€æŠŠç”±é»„é“œå’Œç²¾å¯†é½¿è½®æ„æˆçš„è’¸æ±½æœ‹å…‹æ°ä½œï¼Œå°„å‡ºçš„é«˜å‹å¼¹å¤´èƒ½æœ‰æ•ˆç“¦è§£æœºæ¢°æ„é€ ï¼Œæ˜¯å·¥ç¨‹å¸ˆå’Œå¤ä»£é—è¿¹æ¢ç´¢è€…çš„æœ€çˆ±ã€‚\"],\n    [\"å®ˆæŠ¤è€…åå­—å¼©\", 30000, \"ç‰©å“\", {}, \"ã€æªæ¢°+3ã€‘æ— é™å­å¼¹ï¼Œæ— å£°å°„å‡»ï¼Œç®­çŸ¢é™„å¸¦è¿½è¸ªæ•ˆæœ\", \"å¤è€æŠ€è‰ºä¸ç°ä»£ç§‘æŠ€çš„ç»“åˆï¼Œå°„å‡»æ—¶æ‚„æ— å£°æ¯ï¼Œé™„é­”çš„ç®­çŸ¢ä¼šè‡ªåŠ¨æ ‡è®°è¢«å‘½ä¸­çš„ç›®æ ‡ï¼Œè®©å…¶æ— æ‰€éå½¢ã€‚\"],\n    [\"ç«ç„°å–·å°„å™¨MK1\", 35000, \"ç‰©å“\", {}, \"ã€æªæ¢°+5ã€‘æ— é™ç‡ƒæ–™ï¼ŒèŒƒå›´æŒç»­ä¼¤å®³\", \"ç®€å•ç²—æš´çš„èŒƒå›´æ¸…ç†å·¥å…·ï¼Œèƒ½å–·å°„å‡ºç¼çƒ­çš„å‡å›ºç‡ƒæ–™ï¼Œå¯¹é›†ç¾¤çš„æ— ç”²ç›®æ ‡å’Œæ®ç‚¹èƒ½é€ æˆæ¯ç­æ€§æ‰“å‡»ã€‚\"],\n    [\"M249\", 40000, \"ç‰©å“\", {}, \"ã€æªæ¢°+5ã€‘æ— é™å­å¼¹ï¼Œç«åŠ›å‹åˆ¶\", \"ç­ç”¨è‡ªåŠ¨æ­¦å™¨ï¼Œæ—¨åœ¨æä¾›ä¸é—´æ–­çš„ç«åŠ›å‹åˆ¶ã€‚å®ƒçš„å­˜åœ¨æœ¬èº«å°±æ˜¯å¯¹æ•Œäººå‹‡æ°”çš„ä¸€ç§è€ƒéªŒã€‚\"],\n    [\"ç‚¼é‡‘å·¦è½®\", 45000, \"ç‰©å“\", {}, \"ã€æªæ¢°+5ã€‘æ— é™å­å¼¹ï¼Œå¯åˆ‡æ¢ç«ã€å†°ã€ç”µä¸‰ç§å…ƒç´ ä¼¤å®³\", \"ä¸€ä½ç–¯ç‹‚ç‚¼é‡‘æœ¯å£«çš„æ°ä½œï¼Œè½¬åŠ¨è½®ç›˜ï¼Œå°±èƒ½è®©å­å¼¹é™„ä¸Šä¸åŒçš„å…ƒç´ ä¹‹åŠ›ï¼Œç”¨ä»¥é’ˆå¯¹ä¸åŒæ•Œäººçš„å¼±ç‚¹ã€‚\"],\n    [\"G36C\", 38000, \"ç‰©å“\", {}, \"ã€æªæ¢°+3ã€‘æ— é™å­å¼¹ï¼Œè‡ªå¸¦å…‰å­¦ç„å…·\", \"ä¸€æŠŠç´§å‡‘å‹çªå‡»æ­¥æªï¼Œå·¥ç¨‹å¡‘æ–™æªèº«å’Œè‡ªå¸¦çš„ä½å€ç„å…·è®©å®ƒæ‹¥æœ‰æé«˜çš„ç²¾å‡†åº¦å’Œèˆ’é€‚çš„æ“ä½œæ‰‹æ„Ÿã€‚\"],\n    [\"å·´é›·ç‰¹M82A1\", 50000, \"ç‰©å“\", {}, \"ã€æªæ¢°+3ã€‘æ— é™å­å¼¹ï¼Œåå™¨æä¼¤å®³\", \"æˆ˜åœºä¸Šçš„â€œé‡ç‚®â€ï¼Œå‘å°„çš„.50 BMGå­å¼¹èƒ½è½»æ˜“æ’•å¼€è½»å‹è½½å…·çš„è£…ç”²å’Œæ©ä½“ï¼Œæ˜¯æ”»åšæˆ˜çš„åˆ©å™¨ã€‚\"],\n    [\"AA-12\", 60000, \"ç‰©å“\", {}, \"ã€æªæ¢°+5ã€‘æ— é™å­å¼¹ï¼Œå…¨è‡ªåŠ¨éœ°å¼¹\", \"è¿‘è·ç¦»å··æˆ˜çš„ç»ˆæç­”æ¡ˆã€‚è¿™æŠŠå…¨è‡ªåŠ¨éœ°å¼¹æªèƒ½åƒçªå‡»æ­¥æªä¸€æ ·æ³¼æ´’å‡ºæ¯ç­æ€§çš„å¼¹ä¸¸ï¼Œå°†å‰æ–¹çš„ä¸€åˆ‡åŒ–ä¸ºç¢ç‰‡ã€‚\"],\n    [\"è„‰å†²å¡å®¾æªXR-5\", 70000, \"ç‰©å“\", {}, \"ã€æªæ¢°+3ã€‘æ— é™èƒ½æºï¼Œå¯¹èƒ½é‡æŠ¤ç›¾é€ æˆåŒå€ä¼¤å®³\", \"æ¥è‡ªé«˜ç§‘æŠ€ä¸–ç•Œçš„åˆ¶å¼æ­¦å™¨ï¼Œå‘å°„çš„é«˜èƒ½è„‰å†²èƒ½æœ‰æ•ˆè¿‡è½½èƒ½é‡æŠ¤ç›¾ï¼Œæ˜¯æ˜Ÿé™…é™†æˆ˜é˜Ÿçš„æ ‡é…ã€‚\"],\n    [\"æš—å½±ä½è¯­\", 80000, \"ç‰©å“\", {}, \"ã€æªæ¢°+3ã€‘æ— é™å­å¼¹ï¼Œå‡»æ€åè·å¾—çŸ­æš‚éšå½¢\", \"ä¸€æŠŠé€šä½“æ¼†é»‘çš„æ¶ˆéŸ³ç‹™å‡»æ­¥æªï¼Œå®ƒçš„æªå£°å¦‚åŒè€³è¯­èˆ¬å¾®å¼±ã€‚æŒæœ‰è€…èƒ½åœ¨å®Œæˆå‡»æ€åèå…¥é˜´å½±ï¼Œé‡æ–°å¯»æ‰¾ä¸‹ä¸€ä¸ªç›®æ ‡ã€‚\"],\n    [\"å¼€è†›æ‰‹\", 85000, \"ç‰©å“\", {}, \"ã€æªæ¢°+5ã€‘æ— é™å­å¼¹/ç‡ƒæ–™ï¼Œæªèº«ä¸‹æŒ‚é“¾é”¯\", \"åºŸåœŸç§‘æŠ€çš„ç‹‚é‡äº§ç‰©ï¼Œæ—¢èƒ½è¿›è¡Œè¿œç¨‹å°„å‡»ï¼Œä¹Ÿèƒ½åœ¨è¿‘èº«æ—¶å¯åŠ¨ä¸‹æŒ‚çš„é“¾é”¯ï¼Œç»™äºˆæ•Œäººæœ€ç›´æ¥çš„ç—›è‹¦ã€‚\"],\n    [\"M134â€˜ç±³å°¼å²—â€™\", 90000, \"ç‰©å“\", {}, \"ã€æªæ¢°+5ã€‘æ— é™å­å¼¹ï¼Œå°„é€Ÿéšé¢„çƒ­æå‡\", \"éœ€è¦é¢„çƒ­æ‰èƒ½å‘æŒ¥å…¨éƒ¨å¨åŠ›çš„å¤šç®¡æœºæªï¼Œä¸€æ—¦æªç®¡æ—‹è½¬èµ·æ¥ï¼Œå®ƒå–·å°„å‡ºçš„é‡‘å±é£æš´å°†æ˜¯æ‰€æœ‰äººçš„æœ«æ—¥ã€‚\"],\n    [\"é»„èœ‚å·¢\", 95000, \"ç‰©å“\", {}, \"ã€æªæ¢°+5;ç§‘å­¦+1ã€‘æ— é™å¼¹è¯ï¼Œä¸€æ¬¡å‘å°„å¤šæšè¿½è¸ªå¾®å‹å¯¼å¼¹\", \"ä¸å…¶è¯´æ˜¯æªï¼Œä¸å¦‚è¯´æ˜¯ä¸€ä¸ªä¾¿æºå¼å¯¼å¼¹å‘å°„å¹³å°ã€‚æ¯æ¬¡æ‰£åŠ¨æ‰³æœºéƒ½ä¼šå°„å‡ºä¸€çªå¦‚é»„èœ‚èˆ¬è¿½è¸ªæ•Œäººçš„å°å‹å¯¼å¼¹ã€‚\"],\n    [\"è •è™«å‘å°„å™¨\", 100000, \"ç‰©å“\", {}, \"ã€æªæ¢°+5;ç¥ç§˜å­¦+2ã€‘æ— é™å¼¹è¯ï¼Œå­å¼¹ä¸ºæ´»ä½“è¿½è¸ªè •è™«\", \"ä»¤äººæ¯›éª¨æ‚šç„¶çš„ç”ŸåŒ–æ­¦å™¨ï¼Œå‘å°„å‡ºçš„å¯„ç”Ÿè •è™«ä¼šé’»å…¥ç›®æ ‡ä½“å†…æŒç»­é€ æˆä¼¤å®³ï¼Œå¹¶å‰Šå¼±å…¶é˜²å¾¡ã€‚\"],\n    [\"å¥¥æœ¯å¸ˆçš„æ³•æ–æ­¥æª\", 120000, \"ç‰©å“\", {}, \"ã€æªæ¢°+5;ç¥ç§˜å­¦+3ã€‘æ— é™é­”åŠ›ï¼Œå‘½ä¸­åéšæœºé™„åŠ ä¸€ç§è´Ÿé¢é­”æ³•æ•ˆæœ\", \"å°†é­”æ³•æ³•æ–ä¸æ­¥æªç»“æ„ç»“åˆçš„å¥‡ç‰¹æ­¦å™¨ï¼Œæ¯ä¸€å‘æ°´æ™¶å­å¼¹éƒ½è•´å«ç€æ··ä¹±çš„é­”åŠ›ï¼Œå¯èƒ½è®©æ•Œäººç‡ƒçƒ§ã€å†°å†»æˆ–è¿Ÿç¼“ã€‚\"],\n    [\"å¥‡ç‚¹äº§ç”Ÿå™¨\", 150000, \"ç‰©å“\", {}, \"ã€æªæ¢°+5;ç§‘å­¦+3ã€‘æ— é™å¼¹è¯ï¼Œå­å¼¹åœ¨è½ç‚¹äº§ç”Ÿå°å‹å¼•åŠ›åœº\", \"å®éªŒæ€§çš„æ—¶ç©ºæ­¦å™¨ï¼Œå®ƒå°„å‡ºçš„å­å¼¹ä¼šåœ¨çˆ†ç‚¸æ—¶æ‰­æ›²ç©ºé—´ï¼Œäº§ç”Ÿä¸€ä¸ªçŸ­æš‚çš„å¾®å‹é»‘æ´ï¼Œå°†é™„è¿‘çš„æ•Œäººå’Œç‰©ä½“å¸å‘ä¸­å¿ƒã€‚\"],\n    [\"ç­‰ç¦»å­åˆ‡å‰²è€…\", 130000, \"ç‰©å“\", {}, \"ã€æªæ¢°+3ã€‘æ— é™èƒ½æºï¼ŒæŒç»­å°„å‡»å¯èåŒ–é‡å‹è£…ç”²\", \"å·¥ä¸šç”¨çš„ç­‰ç¦»å­åˆ‡å‰²å·¥å…·è¢«æ”¹é€ æˆäº†æ­¦å™¨ï¼Œå…¶å°„å‡ºçš„è¶…é«˜æ¸©ç­‰ç¦»å­æŸå¯ä»¥åƒåˆ‡é»„æ²¹ä¸€æ ·åˆ‡å¼€æœ€åšå›ºçš„åˆé‡‘è£…ç”²ã€‚\"],\n    [\"å¹½é­‚M1911\", 110000, \"ç‰©å“\", {}, \"ã€æªæ¢°+3ã€‘æ— é™å­å¼¹ï¼Œè¢«å‡»ä¸­è€…ä¼šçœ‹åˆ°ææ€–çš„å¹»è§‰\", \"ä¸€æŠŠè¢«å¼ºå¤§æ€¨çµé™„èº«çš„ç»å…¸æ‰‹æªï¼Œå®ƒçš„å­å¼¹ä¸ä»…ä¼¤å®³è‚‰ä½“ï¼Œæ›´ä¼šä¾µèš€å¿ƒæ™ºï¼Œè®©æ•Œäººåœ¨ææƒ§çš„å¹»è±¡ä¸­å´©æºƒã€‚\"],\n    [\"é½¿è½®é£æš´\", 140000, \"ç‰©å“\", {}, \"ã€æªæ¢°+3ã€‘æ— é™å­å¼¹ï¼Œå°„é€ŸéšæŒç»­å°„å‡»çº¿æ€§æå‡\", \"è’¸æ±½æœ‹å…‹å·¥è‰ºçš„é¡¶å³°ä¹‹ä½œï¼Œå†…éƒ¨æ— æ•°ç²¾å¯†é½¿è½®çš„è”åŠ¨è®©å®ƒçš„å°„é€Ÿèƒ½ä¸æ–­æ”€å‡ï¼Œç›´è‡³åŒ–ä¸ºä¸€åœºæ¯ç­æ€§çš„æœºæ¢°é£æš´ã€‚\"],\n    [\"é›·ç¥ä¹‹é”¤SMG\", 160000, \"ç‰©å“\", {}, \"ã€æªæ¢°+3ã€‘æ— é™èƒ½æºï¼Œå‘½ä¸­åè§¦å‘è¿é”é—ªç”µ\", \"æ®è¯´æ˜¯çŸ®äººä¸é£æš´å·¨äººåˆä½œæ‰“é€ çš„æ­¦å™¨ï¼Œæ¯ä¸€å‘é—ªç”µå¼¹å‘½ä¸­ç›®æ ‡åï¼Œéƒ½ä¼šçˆ†å‘å‡ºè¿é”é—ªç”µï¼Œæ”»å‡»å‘¨å›´çš„å…¶ä»–æ•Œäººã€‚\"],\n    [\"HK416-D\", 105000, \"ç‰©å“\", {}, \"ã€æªæ¢°+3ã€‘æ— é™å­å¼¹ï¼Œæé«˜çš„ç»¼åˆæ€§èƒ½ä¸å¯é æ€§\", \"ç°å®ä¸–ç•Œç‰¹ç§éƒ¨é˜Ÿçš„å® å„¿ï¼Œåœ¨ä¸»ç¥ç©ºé—´é‡Œä¹ŸåŒæ ·å¦‚æ­¤ã€‚å®ƒåœ¨å¨åŠ›ã€ç²¾åº¦ã€å°„é€Ÿå’Œå¯é æ€§ä¸Šè¾¾åˆ°äº†å®Œç¾çš„å¹³è¡¡ã€‚\"],\n    [\"é«˜æ–¯æ­¥æªâ€˜ç£æš´â€™\", 200000, \"ç‰©å“\", {}, \"ã€æªæ¢°+3ã€‘æ— é™èƒ½æºï¼Œå­å¼¹ç¬æ—¶åˆ°è¾¾ä¸”èƒ½ç©¿é€å¤§å¤šæ•°æ©ä½“\", \"åˆ©ç”¨ç”µç£åŠ é€ŸåŸç†å‘å°„å¼¹ä¸¸ï¼Œå­å¼¹å‡ºè†›å³å‘½ä¸­ï¼Œæ— å£°æ— å…‰ï¼Œæ— è§†é£åå’Œé‡åŠ›ï¼Œæ˜¯å®Œç¾çš„åˆºæ€æ­¦å™¨ã€‚\"],\n    [\"é¾™æ¯ä¹‹å¼\", 250000, \"ç‰©å“\", {}, \"ã€æªæ¢°+13;èƒè¿«+3ã€‘æ— é™ç‡ƒæ–™ï¼Œå–·å°„å‡ºé”¥å½¢çš„é¾™æ¯\", \"ç”¨ä¸€å¤´æˆå¹´ç«é¾™çš„å¤´éª¨å’Œå£°å¸¦åˆ¶æˆçš„æ­¦å™¨ï¼Œæ‰£åŠ¨æ‰³æœºæ—¶ï¼Œå®ƒä¼šå‘å‡ºå·¨é¾™çš„å’†å“®ï¼Œå¹¶å–·å°„å‡ºæ¯ç­æ€§çš„é¾™æ¯ã€‚\"],\n    [\"ç¢æ˜Ÿè€…\", 300000, \"ç‰©å“\", {}, \"ã€æªæ¢°+13;ç§‘å­¦+4ã€‘æ— é™èƒ½æºï¼Œè“„åŠ›å‘å°„è´¯ç©¿ä¸€åˆ‡çš„ç²’å­æŸ\", \"ä¸€æŠŠæ‰‹æªå°ºå¯¸çš„è½¨é“ç‚®ã€‚é€šè¿‡çŸ­æš‚è“„åŠ›ï¼Œå®ƒå¯ä»¥å‘å°„å‡ºä¸€é“èƒ½é‡å…‰æŸï¼Œè´¯ç©¿è·¯å¾„ä¸Šçš„ä¸€åˆ‡ï¼Œæ— è®ºæ•Œäººè¿˜æ˜¯å¢™å£ã€‚\"],\n    [\"è™šç©ºè¡Œè€…\", 350000, \"ç‰©å“\", {}, \"ã€æªæ¢°+15ã€‘æ— é™å¼¹è¯ï¼Œå‘½ä¸­æ—¶æœ‰å‡ ç‡å°†ç›®æ ‡éšæœºä¼ é€\", \"ä¸€æŠŠè¿æ¥ç€å¼‚æ¬¡å…ƒçš„æ­¦å™¨ï¼Œå®ƒçš„å­å¼¹æœ‰æ—¶ä¼šæ’•å¼€ç©ºé—´çš„è£‚éš™ï¼Œå°†è¢«å‡»ä¸­è€…å¼ºè¡Œé©±é€åˆ°æœªçŸ¥çš„éšæœºåœ°ç‚¹ã€‚\"],\n    [\"ç”Ÿå‘½æ±²å–è€…\", 400000, \"ç‰©å“\", {}, \"ã€æªæ¢°+15ã€‘æ— é™å¼¹è¯ï¼Œå°†é€ æˆä¼¤å®³çš„ä¸€éƒ¨åˆ†è½¬åŒ–ä¸ºæŒæœ‰è€…çš„ç”Ÿå‘½å€¼\", \"æ´»ä½“ç”ŸåŒ–ç‹™å‡»æªï¼Œæªèº«ä¸ä½¿ç”¨è€…æœ‰ç€å¾®å¼±çš„å…±ç”Ÿå…³ç³»ã€‚å®ƒé€ æˆçš„æ¯ä¸€åˆ†ä¼¤å®³ï¼Œéƒ½ä¼šåŒ–ä¸ºç”Ÿå‘½èƒ½é‡åå“ºç»™å®ƒçš„ä¸»äººã€‚\"],\n    [\"æ—¶é—´æ‰­æ›²è€…\", 450000, \"ç‰©å“\", {}, \"ã€æªæ¢°+15ã€‘æ— é™å¼¹è¯ï¼Œå‘½ä¸­ååœ¨ç›®æ ‡å‘¨å›´åˆ¶é€ ä¸€ä¸ªæ—¶é—´å‡é€ŸåŠ›åœº\", \"æ¥è‡ªè¶…æœªæ¥æ–‡æ˜çš„ç¦å¿Œç§‘æŠ€ï¼Œå®ƒçš„å­å¼¹å¯ä»¥æ‰°ä¹±å±€éƒ¨çš„æ—¶é—´æµé€Ÿï¼Œè®©æ•Œäººçš„ä¸€åˆ‡åŠ¨ä½œéƒ½å˜å¾—åƒæ…¢é•œå¤´ä¸€æ ·ã€‚\"],\n    [\"å› æœå¾‹ä¿®æ­£å™¨\", 500000, \"ç‰©å“\", {}, \"ã€æªæ¢°+15ã€‘æ— é™å­å¼¹ï¼Œéè‡´å‘½éƒ¨ä½å‘½ä¸­å¼ºåˆ¶åˆ¤å®šä¸ºè‡´å‘½éƒ¨ä½å‘½ä¸­\", \"ä¸€æŠŠè§¦åŠä¸–ç•Œåº•å±‚æ³•åˆ™çš„æ¦‚å¿µæ­¦å™¨ã€‚åªè¦å­å¼¹å‘½ä¸­ç›®æ ‡ï¼Œå®ƒå°±ä¼šä¿®æ­£â€œç»“æœâ€ï¼Œå°†åŸæœ¬çš„æ“¦ä¼¤å¼ºåˆ¶æ”¹å†™ä¸ºâ€œçˆ†å¤´â€æˆ–â€œå¿ƒè„ç¢è£‚â€ã€‚\"],\n    [\"é»‘æ£®æ—çš„ä½è¯­\", 480000, \"ç‰©å“\", {}, \"ã€æªæ¢°+15ã€‘æ— é™å¼¹è¯ï¼Œå‘½ä¸­åå¬å”¤è—¤è”“æŸç¼šç›®æ ‡\", \"ç”±ä¸–ç•Œä¹‹æ ‘çš„æ ‘æç²¾å¿ƒé›•åˆ»è€Œæˆï¼Œå……æ»¡äº†è‡ªç„¶ä¹‹åŠ›ã€‚å‘½ä¸­çš„æ•Œäººä¼šè¢«å¤§åœ°ä¸­æ¶Œå‡ºçš„æ´»ä½“è—¤è”“ç‰¢ç‰¢æ†ç»‘ã€‚\"],\n    [\"ä¸‡åé•œ\", 420000, \"ç‰©å“\", {}, \"ã€æªæ¢°+15ã€‘æ— é™å¼¹è¯ï¼Œå°„å‡ºåˆ¶é€ å¤§é‡å¹»å½±åˆ†èº«çš„èƒ½é‡\", \"ä¸€æŠŠå……æ»¡è¿·å¹»è‰²å½©çš„éœ°å¼¹æªï¼Œå°„å‡ºçš„ä¸æ˜¯å¼¹ä¸¸ï¼Œè€Œæ˜¯æ— æ•°ä¸ªä½¿ç”¨è€…è‡ªå·±çš„å¹»å½±ï¼Œè¶³ä»¥è¿·æƒ‘å’Œæ‰°ä¹±ä»»ä½•æ•Œäººã€‚\"],\n    [\"å¤©è°´\", 550000, \"ç‰©å“\", {}, \"ã€æªæ¢°+15;ç§‘å­¦+3ã€‘æ— é™èƒ½æºï¼Œç…§å°„ç›®æ ‡ä»¥å¼•å¯¼ä¸€æ¬¡å«æ˜Ÿè½¨é“ç‚®æ‰“å‡»\", \"å®ƒæœ¬èº«æ²¡æœ‰æ€ä¼¤åŠ›ï¼Œè€Œæ˜¯ä¸€ä¸ªä¿¡æ ‡æªã€‚ç”¨å®ƒç„å‡†å¹¶ç…§å°„ç›®æ ‡æ•°ç§’åï¼Œå¤©åŸºåŠ¨èƒ½æ­¦å™¨ç³»ç»Ÿå°†æ‰§è¡Œâ€œå¤©è°´â€ï¼Œä»å¤ªç©ºä¸­æŠ•ä¸‹æ¯ç­ã€‚\"],\n    [\"é˜¿æ’’æ‰˜æ–¯ä¹‹ç¬›\", 800000, \"ç‰©å“\", {}, \"ã€æªæ¢°+20;æ“æ§+10ã€‘æ— é™èƒ½æºï¼Œå‘å°„ç›´æ¥æ”»å‡»å¿ƒæ™ºçš„æ— å½¢éŸ³æ³¢ï¼Œæ— è§†ç‰©ç†é˜²å¾¡\", \"å¤–å½¢æ˜¯ä¸€æ ¹æ€ªå¼‚çš„é•¿ç¬›ï¼Œä½†èƒ½å‘å°„æ­¦å™¨åŒ–çš„æ¬¡å£°æ³¢ã€‚å®ƒç»•è¿‡æ‰€æœ‰ç‰©ç†é˜²å¾¡ï¼Œç›´æ¥åœ¨ç›®æ ‡çš„è„‘æµ·ä¸­å¥å“ç–¯ç‹‚çš„ä¹ç« ã€‚\"],\n    [\"G.O.D. (åˆ›ä¸–çºªæ¡ä¾‹è£…ç½®)\", 1000000, \"ç‰©å“\", {}, \"ã€æªæ¢°+20;ç§‘å­¦+15ã€‘æ— é™èƒ½æºï¼Œå¯å°†éç”Ÿå‘½ä½“åˆ†è§£æˆ–ä¸´æ—¶å¤åˆ¶\", \"ä¸€æŠŠæ‹¥æœ‰æœ‰é™â€œåˆ›ç‰©â€æƒèƒ½çš„è£…ç½®ã€‚å®ƒå¯ä»¥å°†ç‰©è´¨åˆ†è§£ä¸ºåŸºç¡€èƒ½é‡ï¼Œæˆ–åˆ©ç”¨èƒ½é‡çŸ­æš‚å¤åˆ¶ä¸€ä¸ªè„†å¼±çš„èµå“ï¼Œå……æ»¡äº†æˆ˜æœ¯å¯èƒ½æ€§ã€‚\"],\n    [\"ç¬¬å››é¢å¢™ç ´åè€…\", 1200000, \"ç‰©å“\", {}, \"ã€æªæ¢°+20;ç¥ç§˜å­¦+20ã€‘æ— é™å¢¨æ°´ï¼Œå°„å‡ºå¯ä¿®æ”¹ç›®æ ‡çŠ¶æ€çš„â€œæ–‡å­—â€å¼¹\", \"ä¸€æŠŠå½¢ä¼¼æ‰“å°æœºçš„å…ƒæ­¦å™¨ï¼Œå®ƒå°„å‡ºçš„å­å¼¹æ˜¯å…·ç°åŒ–çš„â€œæ•°æ®â€å’Œâ€œæ–‡å­—â€ã€‚ç†è®ºä¸Šï¼Œå®ƒå¯ä»¥ç›´æ¥å°†æ•Œäººçš„çŠ¶æ€â€œç”Ÿå‘½å€¼ï¼š100%â€ä¿®æ”¹ä¸ºâ€œç”Ÿå‘½å€¼ï¼š1%â€ã€‚\"],\n    [\"çœŸç†\", 1500000, \"ç‰©å“\", {}, \"ã€æªæ¢°+40ã€‘æ— é™å­å¼¹ï¼Œå¼ºåˆ¶è¿›è¡Œç†å¿µåˆ¤å®šï¼Œèƒœè€…æŠ¹é™¤è´¥è€…\", \"é“¶è‰²çš„P226æ‰‹æªå¤–å½¢ä¸‹ï¼Œéšè—ç€å“²å­¦å±‚é¢çš„ææ€–åŠ›é‡ã€‚å¼€æªæ—¶ï¼Œå®ƒæ¯”è¾ƒçš„æ˜¯åŒæ–¹çš„â€œä¿¡å¿µå¼ºåº¦â€ï¼Œå¦‚æœä½ çš„â€œç†å¿µâ€å‹å€’å¯¹æ–¹ï¼Œå¯¹æ–¹å°†ä»å­˜åœ¨å±‚é¢ä¸Šè¢«ç›´æ¥æŠ¹é™¤ã€‚\"],\n    [\"åˆå§‹ä¹‹æª\", 2000000, \"ç‰©å“\", {}, \"ã€æªæ¢°+40;ç§‘å­¦+40ã€‘æ— é™ï¼Ÿï¼Ÿï¼Ÿï¼Œå°„å‡ºä¸€ä¸ªç¬æ—¶ç”Ÿç­çš„å¾®å‹å®‡å®™\", \"ä¼ è¯´è¿™æ˜¯ç”¨å®‡å®™å¤§çˆ†ç‚¸å¥‡ç‚¹ç¢ç‰‡æ‰“é€ çš„æ­¦å™¨ã€‚æ‰£åŠ¨æ‰³æœºï¼Œä½ å¼€å¯äº†ä¸€ä¸ªæ–°çš„å®‡å®™ï¼Œåˆåœ¨ç¬é—´è§è¯äº†å®ƒçš„ç­äº¡ã€‚å…¶äº§ç”Ÿçš„æ•ˆæœå®Œå…¨éšæœºï¼Œå¯èƒ½æ˜¯æ—¶é—´å€’æµï¼Œä¹Ÿå¯èƒ½æ˜¯ä¸€æœµæ¯«æ— ç”¨å¤„çš„èŠ±ï¼Œæ‹¥æœ‰æ— é™çš„å¯èƒ½æ€§ã€‚\"],\n    [\"æ°¸æ’ä¹‹æ³‰çš„å°å°å–·æ³‰\", 5000, \"å®¶å…·\", {}, \"æ”¾ç½®åœ¨ç©ºé—´å†…ï¼Œæ¯æ—¥å¯äº§å‡ºä¸€ç“¶â€˜æ´»åŠ›æ³‰æ°´â€™ï¼Œé¥®ç”¨å30åˆ†é’Ÿå†…ç²¾ç¥åŠ›æ¢å¤é€Ÿåº¦æå‡5%ã€‚çº¯ç²¹çš„è£…é¥°å“ï¼Œå¸¦æ¥æ½ºæ½ºæ°´å£°ã€‚\", \"10, 10, 20, 20, ä¸€åº§ç”±æœˆå…‰çŸ³é›•åˆ»è€Œæˆçš„å°å–·æ³‰ï¼Œæ³‰æ°´åœ¨å¾®å…‰ä¸‹æ³›ç€æŸ”å’Œçš„é“¶è‰²å…‰æ³½ã€‚\"],\n    [\"æµ®ç©ºåŸçš„æ°´æ™¶ç¢ç‰‡\", 12000, \"å®¶å…·\", {}, \"æ‚¬æµ®åœ¨åŠç©ºä¸­ï¼Œç¼“æ…¢æ—‹è½¬ã€‚é è¿‘æ—¶ï¼Œæ€ç»´ä¼šå˜å¾—æ›´åŠ æ¸…æ™°ï¼Œç ´è§£è°œé¢˜æˆ–è¿›è¡Œåˆ›é€ æ€§å·¥ä½œæ—¶æ•ˆç‡æå‡10%ã€‚\", \"40, 15, 10, 10, ä¸€å—ä¸è§„åˆ™çš„é€æ˜æ°´æ™¶ï¼Œå†…éƒ¨ä¼¼ä¹æœ‰äº‘é›¾åœ¨æµåŠ¨ï¼Œæ•£å‘ç€å¾®å¼±çš„å‡‰æ„ã€‚\"],\n    [\"ä¸–ç•Œæ ‘çš„ç›†æ ½\", 25000, \"å®¶å…·\", {}, \"ç¼“æ…¢ç”Ÿé•¿ï¼Œæ¯æ—¥å¯åœ¨æå¶ä¸Šå‡ç»“å‡ºä¸€æ»´â€˜ç”Ÿå‘½ç”˜éœ²â€™ï¼Œå¯ç¬é—´æ²»æ„ˆè½»å¾®ä¼¤åŠ¿ã€‚ç©ºé—´å†…çš„æ¤ç‰©ç”Ÿé•¿é€Ÿåº¦ç•¥å¾®åŠ å¿«ã€‚\", \"60, 10, 15, 25, ä¸€æ ªå°å·§çš„æ ‘è‹—ï¼Œæ ‘å¹²å’Œæå¶å‘ˆç°å‡ºæ¸©æ¶¦çš„ç‰çŸ³è´¨æ„Ÿï¼Œæ•£å‘ç€è“¬å‹ƒçš„ç”Ÿå‘½æ°”æ¯ã€‚\"],\n    [\"çŸ®äººç¬¦æ–‡é”»é€ å°\", 45000, \"å®¶å…·\", {}, \"å¯ä»¥åœ¨æ­¤ä¸ºè£…å¤‡é™„åŠ åˆçº§ç¬¦æ–‡æ•ˆæœï¼ˆå¦‚ï¼šé”‹é”Iï¼Œåšå›ºIï¼‰ã€‚éœ€è¦æ¶ˆè€—å¯¹åº”çš„ææ–™ã€‚å¤±è´¥ç‡è¾ƒé«˜ã€‚\", \"10, 40, 40, 30, ä¸€å¼ ç”±é»‘æ›œçŸ³å’Œé»„é“œæ‰“é€ çš„åšå›ºå·¥ä½œå°ï¼Œå°é¢ä¸Šåˆ»æ»¡äº†å¤æ‚çš„çŸ®äººç¬¦æ–‡ï¼Œä¸­å¿ƒæœ‰ä¸€ä¸ªåµŒå…¥å¼çš„ç†”ç‚‰ã€‚\"],\n    [\"æ˜Ÿç©ºç©¹é¡¶æŠ•å½±ä»ª\", 80000, \"å®¶å…·\", {}, \"å¯åŠ¨åï¼Œä¸ªäººç©ºé—´çš„å¤©èŠ±æ¿ä¼šå˜ä¸ºå®æ—¶å˜åŒ–çš„å®‡å®™æ˜Ÿç©ºï¼Œç¾è½®ç¾å¥‚ã€‚é•¿æœŸè§‚çœ‹å¯ä»¥ç¼“æ…¢æå‡ç²¾ç¥åŠ›ä¸Šé™ã€‚\", \"0, 0, 1, 1, è¿™ä»¶ç‰©å“ä¼šç›´æ¥ä½œç”¨äºæ•´ä¸ªç©ºé—´çš„å¤©èŠ±æ¿ï¼Œå› æ­¤å…¶ç‰©ç†å°ºå¯¸æå°ï¼Œåªæ˜¯ä¸€ä¸ªé»‘è‰²çš„é‡‘å±çƒä½“ã€‚å®ƒçš„æè¿°åæ ‡ä»£è¡¨å®ƒè¢«æ”¾ç½®åœ¨åœ°é¢ä¸­å¿ƒã€‚\"],\n    [\"æ·±æ¸Šå‡è§†ä¹‹é•œ\", 150000, \"å®¶å…·\", {}, \"ä¸€é¢å¤è€çš„é»‘æ›œçŸ³é•œï¼Œæ¯æ—¥å¯è¿›è¡Œä¸€æ¬¡â€˜å‡è§†â€™ã€‚å‡è§†è€…æœ‰æœºä¼šçª¥è§æœªæ¥çš„ä¸€ä¸ªæ¨¡ç³Šç‰‡æ®µï¼Œä½†ä¹Ÿæœ‰å¯èƒ½è¢«æ·±æ¸Šåå™¬ï¼Œéšæœºä¸€é¡¹å±æ€§æš‚æ—¶é™ä½24å°æ—¶ã€‚\", \"80, 20, 15, 40, é•œæ¡†ç”±æ‰­æ›²çš„ä¸çŸ¥åé‡‘å±åˆ¶æˆï¼Œé•œé¢æ¼†é»‘å¦‚å¢¨ï¼Œæ— æ³•æ˜ ç…§å‡ºä»»ä½•ä¸œè¥¿ï¼Œåªä¼šè®©äººæ„Ÿåˆ°å¿ƒæ‚¸ã€‚\"],\n    [\"èµ›åšæœ‹å…‹éœ“è™¹å§å°\", 3000, \"å®¶å…·\", {}, \"çº¯è§‚èµç”¨ï¼Œä¼šå¾ªç¯æ’­æ”¾è¿·å¹»çš„ç”µå­éŸ³ä¹ï¼Œå¹¶é—ªçƒç€äº”å½©æ–‘æ–“çš„éœ“è™¹ç¯å…‰ï¼Œä¸ºä½ çš„ç©ºé—´å¢æ·»ä¸€ä¸æœªæ¥éƒ½å¸‚çš„é¢“åºŸæ°”æ¯ã€‚\", \"100, 10, 50, 20, ä¸€ä¸ªå¸¦æœ‰é‡‘å±å…‰æ³½çš„å§å°ï¼Œè¾¹ç¼˜å’Œå°é¢ä¸‹éƒ½åµŒæ»¡äº†éœ“è™¹ç¯ç®¡ï¼Œä¸Šé¢éšæ„æ”¾ç€å‡ ä¸ªé«˜è„šæ¯ã€‚\"],\n    [\"æ‡’äººç²¾çµè±†è¢‹æ²™å‘\", 1500, \"å®¶å…·\", {}, \"æè‡´èˆ’é€‚ã€‚èººåœ¨ä¸Šé¢ä¼‘æ¯æ—¶ï¼Œä½“åŠ›æ¢å¤é€Ÿåº¦æå‡20%ã€‚ç”±ç²¾çµç”¨æœˆå…‰ä¸‹çš„æ£‰èŠ±å’Œå®‰ç¥è‰ç¼–ç»‡è€Œæˆã€‚\", \"100, 40, 25, 15, ä¸€ä¸ªå·¨å¤§çš„ã€çœ‹èµ·æ¥å°±éå¸¸æŸ”è½¯çš„è±†è¢‹æ²™å‘ï¼Œå¸ƒæ–™æ˜¯æ·¡ç»¿è‰²çš„ï¼Œä¸Šé¢æœ‰é“¶è‰²çš„å¶è„‰çº¹è·¯ã€‚\"],\n    [\"è’¸æ±½åŠ¨åŠ›è‡ªèµ°ä¹¦æ¶\", 32000, \"å®¶å…·\", {}, \"å¯ä»¥é€šè¿‡è¯­éŸ³æŒ‡ä»¤æˆ–ç»ˆç«¯æ§åˆ¶ï¼Œè®©ä¹¦æ¶è‡ªåŠ¨æ‰¾åˆ°å¹¶é€æ¥ä½ æƒ³è¦çš„ä»»ä½•ä¸€æœ¬ï¼ˆå·²æ”¶è—çš„ï¼‰ä¹¦ç±ã€‚è‡ªå¸¦é˜²å°˜å’Œæ’æ¸©æ’æ¹¿åŠŸèƒ½ã€‚\", \"10, 80, 60, 50, ä¸€ä¸ªç”±é»„é“œå’Œçº¢æœ¨åˆ¶æˆçš„å·¨å¤§ä¹¦æ¶ï¼Œåº•éƒ¨æœ‰å¤æ‚çš„é½¿è½®å’Œå±¥å¸¦ç»“æ„ï¼Œå‡ æ ¹è’¸æ±½ç®¡é“ä»é¡¶éƒ¨å»¶ä¼¸å‡ºæ¥ï¼Œä¸æ—¶å†’å‡ºç™½æ°”ã€‚\"],\n    [\"è¡€è‚‰æ»‹ç”Ÿä¹‹åº§\", 220000, \"å®¶å…·\", {}, \"ä¸€ä¸ªæ´»ä½“å®¶å…·ã€‚åä¸Šå»æ—¶ï¼Œå®ƒä¼šç¼“æ…¢åœ°ä¸ä½¿ç”¨è€…å»ºç«‹ç²¾ç¥é“¾æ¥ï¼Œå¤§å¹…åŠ å¿«ç”Ÿå‘½åŠ›å’Œç²¾ç¥åŠ›çš„æ¢å¤é€Ÿåº¦ï¼ˆæ¯åˆ†é’Ÿæ¢å¤1%ï¼‰ã€‚ä½†é•¿æ—¶é—´ä½¿ç”¨å¯èƒ½ä¼šè®©äººçš„æ€ç»´æ–¹å¼äº§ç”Ÿå¼‚å˜ã€‚\", \"160, 10, 30, 30, ä¸€å¼ çœ‹èµ·æ¥åƒæ˜¯æŸç§ç”Ÿç‰©ç»„ç»‡çš„æ¤…å­ï¼Œå‘ˆç°å‡ºæ·±çº¢è‰²ï¼Œè¡¨é¢æœ‰è¡€ç®¡ä¸€æ ·çš„çº¹è·¯åœ¨æåŠ¨ï¼Œæ•´ä½“è½®å»“åœ¨ä¸åœåœ°è¿›è¡Œç€å¾®å°çš„è •åŠ¨å’Œé‡å¡‘ã€‚\"],\n    [\"é˜´é˜³åŒé±¼æ± \", 75000, \"å®¶å…·\", {}, \"ä¸€ä¸ªå¤ªæå½¢çŠ¶çš„æ°´æ± ï¼Œé‡Œé¢å…»ç€ä¸€é»‘ä¸€ç™½ä¸¤æ¡çµé²¤ã€‚æ¯æ—¥å¯è¿›è¡Œä¸€æ¬¡æŠ•å–‚ï¼Œæ ¹æ®çµé²¤çš„ååº”ï¼Œå¯èƒ½ä¼šè·å¾—â€˜å¥½è¿â€™æˆ–â€˜éœ‰è¿â€™çš„ä¸´æ—¶çŠ¶æ€ã€‚\", \"130, 50, 40, 40, ç”±é»‘ç™½ä¸¤è‰²çš„ç‰çŸ³ç Œæˆçš„æ°´æ± ï¼Œæ± æ°´æ¸…æ¾ˆè§åº•ï¼Œä¸¤æ¡é²¤é±¼åœ¨å…¶ä¸­è¿½é€å¬‰æˆï¼Œæ„æˆäº†ä¸€å‰¯æµåŠ¨çš„å¤ªæå›¾ã€‚\"],\n    [\"å…¨æ¯æˆ˜æœ¯æ²™ç›˜\", 98000, \"å®¶å…·\", {}, \"å¯ä»¥å¯¼å…¥ä»»åŠ¡ä¸–ç•Œçš„åœ°å›¾æ•°æ®ï¼Œè¿›è¡Œä¸‰ç»´å…¨æ¯æ¨¡æ‹Ÿï¼Œæ¨æ¼”æˆ˜æœ¯ã€‚ç›Ÿå‹ä¹Ÿå¯ä»¥è¢«é‚€è¯·è¿›å…¥ç©ºé—´å…±åŒä½¿ç”¨ã€‚\", \"80, 70, 40, 40, ä¸€ä¸ªæ–¹å½¢çš„é‡‘å±å¹³å°ï¼Œå¯åŠ¨åä¼šåœ¨ä¸Šæ–¹æŠ•å°„å‡ºé«˜ç²¾åº¦çš„ä¸‰ç»´åœ°å½¢å›¾ï¼Œå¯ä»¥ç”¨æ‰‹åŠ¿è¿›è¡Œç¼©æ”¾ã€æ—‹è½¬å’Œæ ‡è®°ã€‚\"],\n    [\"é¾™éª¨ç‹åº§\", 500000, \"å®¶å…·\", {}, \"ç”±ä¸€å¤´æˆå¹´çº¢é¾™çš„å¤´éª¨å’Œè„Šæ¤åˆ¶æˆã€‚åä¸Šç‹åº§æ—¶ï¼Œä¼šè‡ªç„¶æ•£å‘å‡ºé¾™å¨ï¼Œå¯¹é¾™ç±»åŠäºšé¾™ç”Ÿç‰©æœ‰å¨æ…‘æ•ˆæœï¼Œåœ¨ä¸å…¶å®åŠ›ç›¸è¿‘çš„ç”Ÿç‰©äº¤æ¶‰æ—¶ï¼Œæ°”åŠ¿ä¸Šè·å¾—ä¼˜åŠ¿ã€‚\", \"200, 10, 40, 60, ä¸€å¼ å……æ»¡äº†åŸå§‹ä¸åŠ›é‡ç¾æ„Ÿçš„å·¨å¤§åº§æ¤…ï¼Œå¤´éª¨æ„æˆäº†æ¤…èƒŒï¼Œç‹°ç‹çš„é¾™è§’å‘ä¸Šå»¶ä¼¸ï¼Œæ‰¶æ‰‹æ˜¯ç²—å£®çš„è…¿éª¨ï¼Œæ•´ä½“å‘ˆç°å‡ºéª¨ç™½è‰²å’Œæš—çº¢è‰²ã€‚\"],\n    [\"å¤±è½ç¥åº™çš„ç¥­å›\", 880000, \"å®¶å…·\", {}, \"ä¸€ä¸ªå¤è€è€Œæ®‹ç ´çš„çŸ³åˆ¶ç¥­å›ã€‚æ¯å‘¨å¯ä»¥å°†ä¸€ä»¶ç‰©å“ä½œä¸ºç¥­å“çŒ®ä¸Šï¼Œæœ‰ä¸€å®šå‡ ç‡å°†å…¶å¼ºåŒ–ï¼Œä¹Ÿæœ‰å¾ˆå¤§å‡ ç‡ä½¿å…¶æŸæ¯ï¼Œæå°å‡ ç‡å‘ç”Ÿæ„æƒ³ä¸åˆ°çš„å¥‡è¿¹èœ•å˜ã€‚\", \"250, 20, 50, 30, ç”±å·¨å¤§çš„é’çŸ³å †ç Œè€Œæˆï¼Œä¸Šé¢å¸ƒæ»¡äº†é’è‹”å’Œæ„ä¹‰ä¸æ˜çš„å¤è€é›•åˆ»ï¼Œç¥­å›ä¸­å¿ƒæœ‰ä¸€ä¸ªå‡¹é™·çš„è¡€æ§½ã€‚\"],\n    [\"å¨ç¥çš„å°é“º\", 4000, \"å®¶å…·\", {}, \"ä¸€ä¸ªç®€å•çš„æ—¥å¼æ‹‰é¢æ‘Šä½ã€‚è™½ç„¶ä¸èƒ½åˆ¶ä½œå‡ºä»€ä¹ˆç¥å¥‡æ–™ç†ï¼Œä½†ååœ¨è¿™é‡Œåƒä¸€ç¢—çƒ­æ°”è…¾è…¾çš„é¢ï¼Œå¯ä»¥é©±æ•£å¤§éƒ¨åˆ†è´Ÿé¢ç²¾ç¥çŠ¶æ€ï¼ˆå¦‚ï¼šæ²®ä¸§ï¼Œææƒ§ï¼‰ã€‚\", \"180, 80, 30, 25, ä¸€ä¸ªå°å°çš„æœ¨åˆ¶æ‘Šä½ï¼ŒæŒ‚ç€å†™æœ‰â€˜ãƒ©ãƒ¼ãƒ¡ãƒ³â€™çš„å¸ƒå¸˜ï¼Œåé¢æœ‰ç®€å•çš„ç¶å°å’Œå‡ ä¸ªåº§ä½ã€‚\"],\n    [\"å¯‚é™æ£®æ—çš„ä¸€è§’\", 6000, \"å®¶å…·\", {}, \"ä¸€ç‰‡å°å°çš„æ—åœ°ï¼Œæœ‰å‡ æ£µé«˜å¤§çš„æ ‘å’ŒæŸ”è½¯çš„è‰åªã€‚åœ¨å…¶ä¸­å†¥æƒ³æ—¶ï¼Œå¿ƒå¢ƒä¼šå˜å¾—æ ¼å¤–å¹³å’Œã€‚çº¯è§‚èµå’Œæ”¾æ¾ç”¨ã€‚\", \"220, 80, 50, 50, è¿™ç‰‡åŒºåŸŸçš„åœ°é¢å˜æˆäº†çœŸå®çš„æ³¥åœŸå’Œè‰åœ°ï¼Œå‡ æ£µç™½æ¡¦æ ‘å®‰é™åœ°ä¼«ç«‹ç€ï¼Œé˜³å…‰ä¼šæ°åˆ°å¥½å¤„åœ°ä»æå¶é—´æ´’è½ã€‚\"],\n    [\"åé‡åŠ›ç¡çœ èˆ±\", 38000, \"å®¶å…·\", {}, \"è¿›å…¥ç¡çœ èˆ±åï¼Œä¼šå¤„äºå¾®é‡åŠ›çŠ¶æ€ï¼Œè®©èº«ä½“å¾—åˆ°æœ€å½»åº•çš„æ”¾æ¾ã€‚ç¡çœ 8å°æ—¶ç­‰åŒäºæ™®é€šç¡çœ 12å°æ—¶çš„æ•ˆæœï¼Œä¸”é†’æ¥åç²¾ç¥é¥±æ»¡ã€‚\", \"310, 10, 20, 40, ä¸€ä¸ªå……æ»¡ç§‘å¹»æ„Ÿçš„ç™½è‰²é‡‘å±èˆ±ï¼Œå¤–å½¢æµç•…ï¼Œèˆ±é—¨æ˜¯é€æ˜çš„ï¼Œå¯ä»¥çœ‹åˆ°å†…éƒ¨æŸ”è½¯çš„è¡¬å«ã€‚å·¥ä½œæ—¶ä¼šæ‚¬æµ®åœ¨ç¦»åœ°åŠç±³çš„é«˜åº¦ã€‚\"],\n    [\"æ—¶ç©ºæ—…è€…çš„ç•™å£°æœº\", 110000, \"å®¶å…·\", {}, \"ä¸€å°ç»´å¤šåˆ©äºšé£æ ¼çš„é»„é“œç•™å£°æœºã€‚å®ƒæ²¡æœ‰å”±ç‰‡ï¼Œä½†æ¯å¤©å¯ä»¥éšæœºæ’­æ”¾ä¸€æ®µæ¥è‡ªå…¶ä»–æ—¶é—´çº¿æˆ–å¼‚ä¸–ç•Œçš„éŸ³ä¹ã€å¯¹è¯æˆ–å£°éŸ³ç‰‡æ®µã€‚å¯èƒ½ä¼šå¬åˆ°æœ‰ç”¨çš„æƒ…æŠ¥ï¼Œä¹Ÿå¯èƒ½åªæ˜¯å™ªéŸ³ã€‚\", \"340, 20, 15, 20, ç²¾è‡´è€Œå¤å…¸çš„ç•™å£°æœºï¼Œå¤§å–‡å­é—ªè€€ç€é‡‘å±å…‰æ³½ï¼Œæœºèº«ä¸Šæœ‰è®¸å¤šçœ‹ä¸æ‡‚çš„åˆ»åº¦å’Œè¡¨ç›˜ã€‚\"],\n    [\"å‰‘å†¢\", 190000, \"å®¶å…·\", {}, \"å°†è‡ªå·±çš„å…µå™¨æ’å…¥å…¶ä¸­è•´å…»ï¼Œå¯ä»¥ç¼“æ…¢æå‡å…µå™¨çš„å“è´¨ï¼Œå¹¶æœ‰æå°å‡ ç‡è®©å…µå™¨è¯ç”Ÿâ€˜å™¨çµâ€™ã€‚ä¸€æ¬¡åªèƒ½è•´å…»ä¸€ä»¶å…µå™¨ã€‚\", \"310, 70, 30, 30, ä¸€åº§ç”±æ— æ•°æ–­å‰‘æ®‹å…µå †ç§¯è€Œæˆçš„å°ä¸˜ï¼Œä¸­å¿ƒæœ‰ä¸€å—é»‘è‰²çš„å·¨å¤§ç£¨å‰‘çŸ³ï¼Œæ•£å‘ç€å‡Œå‰çš„å‰‘æ„ã€‚\"],\n    [\"â€˜å®¶â€™çš„æŠ•å½±\", 1000, \"å®¶å…·\", {}, \"ä¸€ä¸ªç®€å•çš„ç›¸æ¡†ã€‚ä½¿ç”¨è€…å¯ä»¥å°†è‡ªå·±å¿ƒä¸­æœ€æƒ³å¿µçš„å®¶çš„å½±åƒæŠ•å°„å…¶ä¸­ï¼Œå½±åƒä¼šåŠ¨æ€å˜åŒ–ï¼Œä»¿ä½›æ—¶é—´åœ¨æµåŠ¨ã€‚æ— ä»»ä½•å®é™…å¢ç›Šï¼Œçº¯ç²¹çš„æƒ…æ„Ÿæ…°è—‰ã€‚\", \"360, 20, 10, 8, ä¸€ä¸ªæœ´ç´ çš„æœ¨è´¨ç›¸æ¡†ï¼Œæ²¡æœ‰ç…§ç‰‡ï¼Œåªæœ‰ä¸€ç‰‡æŸ”å’Œçš„ç™½å…‰ï¼Œä½¿ç”¨è€…è§¦ç¢°æ—¶ï¼Œç™½å…‰ä¼šå˜ä¸ºå…¶æ€å¿µçš„åœºæ™¯ã€‚\"],\n    [\"ç¥åœ£å…‰æ˜æ•™å ‚çš„å‘Šè§£å®¤\", 55000, \"å®¶å…·\", {}, \"ä¸€ä¸ªéš”éŸ³æ•ˆæœæå¥½çš„å°æˆ¿é—´ã€‚åœ¨å…¶ä¸­è¿›è¡Œå¿æ‚”æˆ–å€¾è¯‰ï¼Œå¯ä»¥æ˜¾è‘—ç¼“è§£å†…å¿ƒçš„è´Ÿç½ªæ„Ÿå’Œå‹åŠ›ï¼Œå¹¶è·å¾—ä¸€ä¸ªåä¸ºâ€˜å¿ƒçµå‡€åŒ–â€™çš„ä¸´æ—¶çŠ¶æ€ï¼Œè±å…ä¸€æ¬¡ç²¾ç¥æ§åˆ¶ç±»æŠ€èƒ½ã€‚\", \"380, 10, 30, 40, ä¸€ä¸ªç”±æ·±è‰²æœ¨ææ‰“é€ çš„ç‹¬ç«‹å°éš”é—´ï¼Œå†…éƒ¨æœ‰ä¸€å¼ è·ªå‡³å’Œä¸€é“å¸¦æœ‰æ ¼æ …çš„éš”çª—ã€‚å……æ»¡äº†åº„ä¸¥è‚ƒç©†çš„æ°›å›´ã€‚\"],\n    [\"æ··æ²Œå‡ ä½•é›•å¡‘\", 130000, \"å®¶å…·\", {}, \"ä¸€ä¸ªç”±ä¸æ–­å˜åŒ–çš„å‡ ä½•ä½“ç»„æˆçš„ã€è¿åç‰©ç†è§„åˆ™çš„åŠ¨æ€é›•å¡‘ã€‚ç›´è§†å®ƒä¼šå¯¼è‡´è½»å¾®çš„çœ©æ™•ï¼Œä½†ä¹Ÿèƒ½é”»ç‚¼ç²¾ç¥æŠµæŠ—æ··ä¹±ä¿¡æ¯çš„èƒ½åŠ›ã€‚\", \"420, 20, 20, 20, å®ƒçœ‹èµ·æ¥åƒä¸€å›¢ç”±é»„é“œçº¿æ¡æ„æˆçš„ã€ä¸æ–­åœ¨å››ç»´ç©ºé—´ç¿»è½¬çš„ç«‹æ–¹ä½“ï¼Œæ—¶è€Œå±•å¼€æ—¶è€Œæ”¶ç¼©ï¼Œæ²¡æœ‰å›ºå®šçš„å½¢æ€ã€‚\"],\n    [\"è™šç©ºå‚é’“å°\", 280000, \"å®¶å…·\", {}, \"ä¸€ä¸ªå»¶ä¼¸è‡³ç©ºé—´è¾¹ç¼˜ä¹‹å¤–çš„å¹³å°ã€‚ä½¿ç”¨è€…å¯ä»¥åœ¨æ­¤å‚é’“ï¼Œé’“ä¸Šæ¥çš„å¯èƒ½æ˜¯æ¥è‡ªæ— å°½è™šç©ºçš„ç¨€æœ‰ææ–™ã€æ¼‚æµçš„çµé­‚ç“¶ã€ç”šè‡³æ˜¯æŸä¸ªä¸–ç•Œçš„â€˜æ¦‚å¿µâ€™ç¢ç‰‡ã€‚\", \"450, 10, 20, 15, ä¸€ä¸ªç”±æœªçŸ¥é»‘è‰²å²©çŸ³æ„æˆçš„å¹³å°ï¼Œæœ«ç«¯æ¶ˆå¤±åœ¨ç©ºé—´çš„è¾¹ç•Œï¼Œä»¿ä½›èå…¥äº†è™šæ— ä¹‹ä¸­ã€‚éœ€è¦ç‰¹åˆ¶çš„â€˜è™šç©ºé±¼ç«¿â€™é…åˆä½¿ç”¨ï¼ˆå•†åŸå¦è´­ï¼‰ã€‚\"],\n    [\"ä¸‡ç•Œä¹‹çª—\", 999990, \"å®¶å…·\", {}, \"ä¸€æ‰‡å·¨å¤§çš„è½åœ°çª—ã€‚æ¯å¤©ï¼Œçª—å¤–çš„æ™¯è‰²éƒ½ä¼šéšæœºå˜ä¸ºä¸€ä¸ªå¼‚ä¸–ç•Œçš„å®æ—¶é£æ™¯ï¼Œå¯èƒ½æ˜¯å·¨é¾™é£èˆçš„å¥‡å¹»å±±å·…ï¼Œä¹Ÿå¯èƒ½æ˜¯éœ“è™¹é—ªçƒçš„èµ›åšéƒ½å¸‚ã€‚ä½¿ç”¨è€…æ— æ³•ç©¿è¿‡çª—æˆ·ï¼Œä½†å¯ä»¥æ„Ÿå—é‚£ä¸ªä¸–ç•Œçš„æ°”æ¯ã€‚\", \"500, 10, 80, 60, ä¸€æ‰‡åä¸½çš„ã€é•¶åµŒç€å®çŸ³å’Œç¬¦æ–‡çš„æ‹±å½¢çª—æˆ·ï¼Œçª—å¤–æ˜¯æµå…‰æº¢å½©çš„åŠ¨æ€æ™¯è±¡ï¼Œè€Œéå›ºå®šçš„ç©ºé—´èƒŒæ™¯ã€‚\"],\n    [\"æ—¶é—´æ²™æ¼\", 420000, \"å®¶å…·\", {}, \"ä¸€ä¸ªå·¨å¤§çš„æ²™æ¼ã€‚å¯ä»¥æ¶ˆè€—å¤§é‡ç§¯åˆ†æ¥å°†æ•´ä¸ªä¸ªäººç©ºé—´çš„æ—¶é—´æµé€Ÿè¿›è¡Œå¾®è°ƒï¼ˆæœ€é«˜å‡ç¼“è‡³0.8å€ï¼Œæˆ–åŠ é€Ÿè‡³1.2å€ï¼‰ã€‚è°ƒæ•´ä¼šæŒç»­24å°æ—¶ã€‚\", \"600, 20, 25, 40, æ²™æ¼çš„æ¡†æ¶ç”±ç™½é‡‘æ‰“é€ ï¼Œé‡Œé¢çš„æ²™å­æ˜¯ç’€ç’¨çš„é’»çŸ³å°˜åŸƒï¼ŒæµåŠ¨æ—¶æ•£å‘å‡ºæŸ”å’Œçš„å…‰èŠ’ã€‚\"],\n    [\"èµ·æºç†”ç‚‰\", 2500000, \"å®¶å…·\", {}, \"ä¼ è¯´ä¸­èƒ½é”»é€ ç¥å™¨çš„ç†”ç‚‰çš„å¤åˆ¶å“ã€‚æ‹¥æœ‰æé«˜çš„æˆåŠŸç‡ï¼Œå¯ä»¥å°†å¤šä»¶ä¼ å¥‡ç‰©å“ä¸ç¨€æœ‰ææ–™èåˆï¼Œåˆ›é€ å‡ºç‹¬ä¸€æ— äºŒçš„ã€å…¨æ–°çš„ç‰©å“ã€‚æ¯æ¬¡ä½¿ç”¨éƒ½éœ€è¦æ¶ˆè€—å·¨é‡ç§¯åˆ†ä½œä¸ºèƒ½æºã€‚\", \"10, 150, 80, 70, ä¸€åº§å¦‚åŒå°å‹ç«å±±èˆ¬çš„å·¨å¤§ç†”ç‚‰ï¼Œç”±æš—çº¢è‰²çš„é‡‘å±æ„æˆï¼Œä¸Šé¢åˆ»æ»¡äº†åŸå§‹è€Œå¤è€çš„ç«ç„°å›¾è…¾ï¼Œå³ä½¿ä¸ç‚¹ç«ä¹Ÿæ•£å‘ç€æƒŠäººçš„çƒ­é‡ã€‚\"],\n    [\"æ£‹åœ£çš„æ£‹ç›˜\", 70000, \"å®¶å…·\", {}, \"ä¸€å¼ å¤æœ´çš„å›´æ£‹æ£‹ç›˜ã€‚å¯ä»¥å¬å”¤ä¸€ä¸ªåä¸ºâ€˜æ£‹åœ£â€™çš„AIè¿›è¡Œå¯¹å¼ˆã€‚æ¯èµ¢ä¸€å±€ï¼Œç²¾ç¥åŠ›éƒ½ä¼šè·å¾—æ°¸ä¹…æ€§çš„å¾®é‡å¢é•¿ã€‚è¢«AIå‡»è´¥åˆ™ä¼šé™·å…¥1å°æ—¶çš„æ€ç»´æ··ä¹±çŠ¶æ€ã€‚\", \"100, 160, 20, 20, ä¸€å¼ ç”±æ•´å—é¦™æ¨Ÿæœ¨é›•æˆçš„æ£‹ç›˜ï¼Œæ£‹å­æ˜¯æ¸©æ¶¦çš„é»‘ç™½ç‰çŸ³ï¼Œè‡ªå¸¦ä¸€ç§è®©äººå¿ƒå¹³æ°”å’Œçš„æ°”åœºã€‚\"],\n    [\"æ— é™ä¹¦åº“çš„ç»ˆç«¯\", 650000, \"å®¶å…·\", {}, \"ä¸€ä¸ªæ•°æ®ç»ˆç«¯ï¼Œå¯ä»¥è¿æ¥åˆ°ä¼ è¯´ä¸­çš„â€˜æ— é™ä¹¦åº“â€™ã€‚ä½¿ç”¨è€…å¯ä»¥æ¶ˆè€—ç§¯åˆ†æŸ¥é˜…å‡ ä¹æ‰€æœ‰éç¥æ˜çº§åˆ«çš„çŸ¥è¯†å’Œä¿¡æ¯ï¼Œä»·æ ¼å–å†³äºä¿¡æ¯çš„çç¨€ç¨‹åº¦ã€‚\", \"130, 150, 15, 25, ä¸€ä¸ªæµçº¿å‹çš„ã€æ‚¬æµ®åœ¨ç©ºä¸­çš„æ“ä½œå°ï¼Œå±å¹•æ˜¯æ·¡è“è‰²çš„å…‰å¹•ï¼Œä¸Šé¢æœ‰æ— æ•°æ•°æ®æµåœ¨é—ªåŠ¨ã€‚\"],\n    [\"å¦–ç²¾çš„èŒ¶ä¼šæ¡Œ\", 18000, \"å®¶å…·\", {}, \"ä¸€å¥—ç²¾è‡´å°å·§çš„æ¡Œæ¤…ã€‚æ¯å¤©ä¸‹åˆä¸‰ç‚¹ï¼Œæ¡Œä¸Šä¼šè‡ªåŠ¨å‡ºç°ä¸€å¥—ç¾å‘³çš„ä¸‹åˆèŒ¶ç‚¹å¿ƒå’Œçº¢èŒ¶ï¼Œé£Ÿç”¨åå¿ƒæƒ…ä¼šå˜å¾—æ„‰æ‚¦ã€‚å¯ä»¥é‚€è¯·æœ‹å‹å…±äº«ã€‚\", \"160, 160, 30, 20, ç”±å¼€èŠ±çš„è—¤è”“è‡ªç„¶ç¼ ç»•è€Œæˆçš„æ¡Œæ¤…ï¼Œæ¡Œé¢ä¸Šé“ºç€å·¨å¤§çš„è·å¶ï¼Œæ¯å­å’Œç›˜å­åˆ™æ˜¯äº”é¢œå…­è‰²çš„è˜‘è‡ã€‚\"],\n    [\"æ­»çµæ³•å¸ˆçš„éª¸éª¨ä»†å½¹åˆ¶é€ å°\", 88000, \"å®¶å…·\", {}, \"å¯ä»¥åœ¨æ­¤æ¶ˆè€—ç”Ÿç‰©é—éª¸å’Œçµé­‚ç¢ç‰‡ï¼Œåˆ¶é€ å‡ºä½é˜¶çš„éª¸éª¨ä»†å½¹ï¼ˆå¦‚éª·é«…å…µã€éª¸éª¨çŒçŠ¬ï¼‰ã€‚ä»†å½¹åªèƒ½åœ¨ä¸ªäººç©ºé—´å†…æ´»åŠ¨ï¼Œä½œä¸ºå®ˆå«æˆ–åŠ³åŠ›ã€‚\", \"200, 150, 40, 40, ä¸€å¼ ç”±äººç±»ã€é‡å…½ç­‰ä¸åŒç”Ÿç‰©çš„éª¨éª¼æ‹¼æ¥è€Œæˆçš„å·¨å¤§çŸ³å°ï¼Œå°é¢ä¸Šæœ‰è®¸å¤šå‡¹æ§½å’Œç®¡çº¿ï¼Œè¿æ¥ç€å‡ ä¸ªè£…æœ‰ç»¿è‰²æ¶²ä½“çš„ç»ç’ƒç½ã€‚\"],\n    [\"ç¦…æ„çš„æ¯å±±æ°´åº­é™¢\", 9000, \"å®¶å…·\", {}, \"ä¸€ç‰‡é“ºç€ç™½ç ‚ã€ç‚¹ç¼€ç€å‡ å—å¥‡çŸ³çš„æ—¥å¼åº­é™¢ã€‚æ¯æ—¥å¯è¿›è¡Œä¸€æ¬¡â€œè€™ç ‚â€ï¼Œè¿™ä¸ªè¿‡ç¨‹èƒ½å¸®åŠ©æ•´ç†æ€ç»ªï¼Œæ¶ˆé™¤ç²¾ç¥ä¸Šçš„ç–²åŠ³ã€‚\", \"250, 150, 50, 50, åœ°é¢å˜ä¸ºä¸€ç‰‡æ´ç™½çš„ç ‚ç ¾ï¼Œå‡ å—å½¢æ€å„å¼‚çš„é’é»‘è‰²å²©çŸ³é”™è½æœ‰è‡´åœ°æ‘†æ”¾ç€ï¼Œæ—è¾¹è¿˜æ”¾ç€ä¸€æŠŠå°å°çš„æœ¨è€™ã€‚\"],\n    [\"æœºæ¢°å¸ˆçš„æ”¹è£…å·¥åŠ\", 160000, \"å®¶å…·\", {}, \"ä¸€ä¸ªå †æ»¡äº†é›¶ä»¶ã€å·¥å…·å’Œè®¾è®¡å›¾çš„è§’è½ã€‚å¯ä»¥åœ¨æ­¤å‡çº§ã€æ”¹è£…æœºæ¢°ç±»è£…å¤‡å’Œä¹‰ä½“ã€‚æä¾›æˆåŠŸç‡åŠ æˆï¼Œå¹¶è§£é”ä¸€äº›ç‹¬ç‰¹çš„æ”¹é€ é€‰é¡¹ã€‚\", \"310, 150, 60, 60, è¿™é‡Œæœ‰å…¨å¥—çš„æ¿€å…‰ç„Šæªã€æœºæ¢°è‡‚ã€3Dæ‰“å°æœºå’Œå„ç§ç²¾å¯†å·¥å…·ï¼Œå¢™ä¸ŠæŒ‚æ»¡äº†è®¾è®¡è“å›¾ï¼Œåœ°ä¸Šéšæ„å †æ”¾ç€ä¸€äº›é‡‘å±é›¶ä»¶å’ŒåºŸå¼ƒçš„ä¹‰ä½“ã€‚\"],\n    [\"æ€ªå¥‡æ”¶è—å®¶çš„é™ˆåˆ—æŸœ\", 30000, \"å®¶å…·\", {}, \"ä¸€ä¸ªç»ç’ƒé™ˆåˆ—æŸœï¼Œé‡Œé¢å·²ç»æ‘†æ”¾äº†å‡ ä»¶æ— å®³ä½†æ€ªå¼‚çš„è—å“ï¼ˆå¦‚ï¼šä¼šè‡ªå·±æ¢å§¿åŠ¿çš„æœ¨å¶ï¼Œè£…åœ¨ç“¶å­é‡Œçš„å¾®ç¼©é£æš´ï¼‰ã€‚ä½¿ç”¨è€…ä¹Ÿå¯ä»¥å°†è‡ªå·±çš„æˆ˜åˆ©å“æ”¾å…¥å…¶ä¸­å±•ç¤ºã€‚\", \"380, 150, 30, 50, ä¸€ä¸ªç»´å¤šåˆ©äºšé£æ ¼çš„çº¢æœ¨é™ˆåˆ—æŸœï¼Œç»ç’ƒæ“¦å¾—é”ƒäº®ï¼Œé‡Œé¢çš„è—å“è¢«æŸ”å’Œçš„ç¯å…‰ç…§äº®ï¼Œå……æ»¡äº†ç¥ç§˜æ„Ÿã€‚\"],\n    [\"è®°å¿†å›å»Š\", 350000, \"å®¶å…·\", {}, \"ä¸€æ¡ç”±å…‰å½±æ„æˆçš„èµ°å»Šã€‚ä½¿ç”¨è€…å¯ä»¥å°†è‡ªå·±çš„è®°å¿†ç‰‡æ®µå‚¨å­˜åœ¨å…¶ä¸­ï¼Œå¹¶åœ¨èµ°å»Šä¸­ä»¥ç¬¬ä¸€äººç§°è§†è§’é‡æ¸©ã€‚å¯ç”¨äºå¤ç›˜æˆ˜æ–—ã€å­¦ä¹ æŠ€èƒ½æˆ–ä»…ä»…æ˜¯æ€€æ—§ã€‚\", \"420, 150, 20, 80, è¿™æ¡èµ°å»Šçš„å¢™å£å’Œå¤©èŠ±æ¿éƒ½æ˜¯æµåŠ¨çš„å…‰å¹•ï¼Œä¸Šé¢ä¼šæµ®ç°å‡ºä½¿ç”¨è€…å‚¨å­˜çš„è®°å¿†å½±åƒï¼Œèµ°å…¥å…¶ä¸­ä»¿ä½›ç©¿æ¢­äºæ—¶å…‰ä¹‹ä¸­ã€‚\"],\n    [\"ç‚¼é‡‘æœ¯å£«çš„ç§˜å¯†å®éªŒå®¤\", 125000, \"å®¶å…·\", {}, \"ä¸€å¥—å®Œæ•´çš„ç‚¼é‡‘å®éªŒè®¾å¤‡ï¼ŒåŒ…æ‹¬è’¸é¦å™¨ã€å©åŸšã€è¯•ç®¡å’Œå¤æ‚çš„ç»ç’ƒç®¡é“ã€‚å¯ä»¥åœ¨æ­¤è¿›è¡ŒåŸºç¡€è¯å‰‚çš„åˆæˆï¼ŒæˆåŠŸç‡é«˜äºè‡ªè¡Œæ‘¸ç´¢ã€‚\", \"10, 240, 50, 50, ä¸€ä¸ªè¢«å„ç§ç»ç’ƒå™¨çš¿å’Œå†’ç€æ°”æ³¡çš„è¯å‰‚å æ®çš„åŒºåŸŸï¼Œç©ºæ°”ä¸­å¼¥æ¼«ç€è‰è¯å’ŒåŒ–å­¦è¯•å‰‚æ··åˆçš„å‘³é“ã€‚\"],\n    [\"åŸæ¸¸è¯—äººçš„ç¯ç«\", 8000, \"å®¶å…·\", {}, \"ä¸€å †æ°¸ä¸ç†„ç­çš„ç¯ç«ã€‚ååœ¨ç¯ç«æ—ï¼Œä¼šæ„Ÿåˆ°æ¸©æš–å’Œå®‰å¿ƒã€‚å¦‚æœæ­¤æ—¶æ¼”å¥ä¹å™¨æˆ–è®²è¿°æ•…äº‹ï¼Œæ•ˆæœä¼šå¾—åˆ°å¢å¼ºï¼Œæ›´å®¹æ˜“æ‰“åŠ¨å¬ä¼—ï¼ˆå³ä½¿æ˜¯NPCï¼‰ã€‚\", \"70, 250, 20, 15, ä¸€åœˆç”±çŸ³å¤´å’èµ·çš„ç«å¡˜ï¼Œä¸­é—´ç‡ƒçƒ§ç€æ©™çº¢è‰²çš„ç«ç„°ï¼Œä¸æ—¶æœ‰ç«æ˜Ÿè·³è·ƒå‡ºæ¥ï¼Œå‘å‡ºå™¼å•ªçš„è½»å“ã€‚\"],\n    [\"ç”»ä¸­ä»™çš„å·è½´\", 210000, \"å®¶å…·\", {}, \"ä¸€å¹…å·¨å¤§çš„ç©ºç™½å±±æ°´ç”»å·è½´ï¼ŒæŒ‚åœ¨å¢™ä¸Šã€‚ä½¿ç”¨è€…å¯ä»¥æ¶ˆè€—ç²¾ç¥åŠ›å°†æƒ³è±¡ä¸­çš„åœºæ™¯ç»˜åˆ¶ä¸Šå»ï¼Œç”»å·ä¼šå˜ä¸ºåŠ¨æ€ï¼Œç”šè‡³å¯ä»¥çŸ­æš‚åœ°è¿›å…¥ç”»ä¸­ä¸–ç•Œï¼ˆä¸èƒ½å¸¦å‡ºä»»ä½•ä¸œè¥¿ï¼‰ã€‚\", \"100, 220, 1, 60, è¿™å¹…ç”»å‡ ä¹å æ®äº†ä¸€æ•´é¢å¢™ï¼Œç”»çº¸æ˜¯ä¸Šå¥½çš„å®£çº¸ï¼Œä¸¤ç«¯çš„ç”»è½´ç”±ç´«æª€æœ¨åˆ¶æˆï¼Œæ•´ä½“æ•£å‘ç€å¢¨é¦™ã€‚å®ƒçš„åæ ‡ä»£è¡¨æŒ‚åœ¨å¢™ä¸Šçš„ä½ç½®ã€‚\"],\n    [\"æ·±æµ·é—è¿¹çš„çŠç‘šåºŠ\", 60000, \"å®¶å…·\", {}, \"ä¸€å¼ ç”±æ´»ä½“å‘å…‰çŠç‘šæ„æˆçš„åºŠã€‚åœ¨ä¸Šé¢ç¡è§‰æ—¶ä¼šè¿›å…¥æ·±æµ·èˆ¬çš„æ¢¦å¢ƒï¼Œæœ‰åŠ©äºå®‰æŠšç‹‚èºçš„ç²¾ç¥çŠ¶æ€ï¼Œå¹¶ç¼“æ…¢ä¿®å¤å—æŸçš„çµé­‚ã€‚\", \"120, 230, 30, 20, æ•´å¼ åºŠå°±åƒæ˜¯ä»æµ·åº•æ¬ä¸Šæ¥çš„è‰ºæœ¯å“ï¼Œäº”å½©æ–‘æ–“çš„çŠç‘šæ„æˆäº†åºŠçš„æ¡†æ¶ï¼ŒæŸ”è½¯çš„æµ·è‘µç»„æˆäº†åºŠå«ï¼Œæ•£å‘ç€æŸ”å’Œçš„è“ç»¿è‰²è§å…‰ã€‚\"],\n    [\"åˆºå®¢ç›Ÿçº¦çš„æš—å½±å¸·å¹•\", 48000, \"å®¶å…·\", {}, \"ä¸€ç‰‡å¯ä»¥éšæ„æ‚¬æŒ‚çš„é»‘è‰²å¸·å¹•ã€‚èº²åœ¨å¸·å¹•åé¢æ—¶ï¼Œè‡ªèº«çš„æ°”æ¯ä¼šè¢«å®Œå…¨éšè—ï¼Œæ˜¯ç»ƒä¹ æ½œè¡Œå’ŒéšåŒ¿æŠ€èƒ½çš„ç»ä½³é“å…·ã€‚\", \"160, 220, 40, 60, ä¸€å—çœ‹èµ·æ¥å¹³å¹³æ— å¥‡çš„é»‘å¸ƒï¼Œä½†å½“ä½ è§¦æ‘¸å®ƒæ—¶ï¼Œä¼šæ„Ÿåˆ°ä¸€ç§å†°å†·çš„ã€ä»¿ä½›èƒ½åå™¬å…‰çº¿çš„è´¨æ„Ÿã€‚å®ƒå¯ä»¥è¦†ç›–ä¸€ç‰‡åŒºåŸŸï¼Œå½¢æˆç»å¯¹çš„é»‘æš—ã€‚\"],\n    [\"ç‰§åœºä¸»çš„è¿·ä½ å†œåœº\", 9500, \"å®¶å…·\", {}, \"ä¸€å°å—å¯ä»¥è€•ç§çš„åœŸåœ°ï¼Œé™„èµ å‡ åŒ…éšæœºçš„å¼‚ç•Œæ¤ç‰©ç§å­ã€‚ç§å‡ºçš„æ¤ç‰©å¯èƒ½æ˜¯ç¾å‘³çš„é£Ÿæï¼Œä¹Ÿå¯èƒ½æ˜¯ç‚¼é‡‘ææ–™ï¼Œç”šè‡³æ˜¯æœ‰å¾®å¼±æ”»å‡»æ€§çš„å°æ€ªç‰©ã€‚\", \"210, 220, 40, 40, ä¸€å—ç”¨æ …æ å›´èµ·æ¥çš„è‚¥æ²ƒé»‘åœŸåœ°ï¼Œæ—è¾¹æœ‰ä¸€ä¸ªå°å°çš„å·¥å…·æ£šï¼Œé‡Œé¢æ”¾ç€æ°´å£¶ã€é”„å¤´ç­‰å·¥å…·ã€‚\"],\n    [\"å‘½è¿çººç»‡è€…çš„ç»‡æœº\", 750000, \"å®¶å…·\", {}, \"ä¸€å°å¤è€çš„ç»‡æœºã€‚ä½¿ç”¨è€…å¯ä»¥å°†ä»ä»»åŠ¡ä¸–ç•Œä¸­è·å¾—çš„â€˜å‘½è¿ä¹‹çº¿â€™ï¼ˆç¨€æœ‰ææ–™ï¼‰åœ¨æ­¤ç¼–ç»‡ã€‚æˆå“å¯èƒ½æ˜¯èƒ½è±å…ä¸€æ¬¡è‡´å‘½æ”»å‡»çš„æŠ¤ç¬¦ï¼Œä¹Ÿå¯èƒ½æ˜¯èƒ½é¢„çŸ¥ä¸€æ¬¡å±é™©çš„æŠ«é£ã€‚\", \"260, 220, 30, 40, ç»‡æœºç”±é“¶è‰²çš„æœ¨æåˆ¶æˆï¼Œä¸Šé¢ç¼ ç»•ç€æ— æ•°è‹¥æœ‰è‹¥æ— çš„å…‰çº¿ï¼Œä»¿ä½›è¿æ¥ç€ä¸‡ç‰©çš„å‘½è¿ã€‚æ“ä½œå®ƒéœ€è¦æé«˜çš„ä¸“æ³¨åŠ›ã€‚\"],\n    [\"èµŒç¥çš„æ¡Œå°\", 20000, \"å®¶å…·\", {}, \"ä¸€å¼ ç»¿è‰²çš„èµŒæ¡Œã€‚å¯ä»¥é‚€è¯·æœ‹å‹æˆ–å¬å”¤AIè¿›è¡Œå„ç§æ‰‘å…‹ç‰Œæ¸¸æˆã€‚çº¯å¨±ä¹ï¼Œä½†æ®è¯´è¿æ°”å¥½çš„äººèƒ½ä»æ¡Œä¸Šèµ¢åˆ°ä¸€äº›è¢«ç§°ä¸ºâ€˜å¹¸è¿ç­¹ç â€™çš„é“å…·ã€‚\", \"300, 220, 25, 20, ä¸€å¼ æ ‡å‡†çš„å¾·å·æ‰‘å…‹æ¡Œï¼Œæ¡Œé¢æ˜¯é«˜çº§çš„ç»¿è‰²ç»’å¸ƒï¼Œè¾¹ç¼˜æœ‰èˆ’é€‚çš„çš®è´¨æ‰¶æ‰‹ï¼Œæ—è¾¹è¿˜é…äº†å‡ å¼ æ¤…å­ã€‚\"],\n    [\"å†°éœœå·¨äººçš„é…’æ¯\", 15000, \"å®¶å…·\", {}, \"ä¸€ä¸ªç”±ä¸‡å¹´å¯’å†°é›•æˆçš„å·¨å¤§é…’æ¯ã€‚ç”¨å®ƒæ¥å–ä»»ä½•æ¶²ä½“ï¼Œéƒ½ä¼šå˜å¾—å†°çˆ½åˆºéª¨ï¼Œå¹¶è·å¾—ä¸€ä¸ªâ€˜å†°å¿ƒâ€™çŠ¶æ€ï¼ŒçŸ­æ—¶é—´å†…å¯¹ç«ç„°ä¼¤å®³æœ‰å¾®å¼±æŠ—æ€§ã€‚\", \"335, 230, 10, 12, ä¸€ä¸ªåŠäººé«˜çš„å·¨å¤§æ¯å­ï¼Œæ¯å£ä¸Šå‡ç»“ç€ç™½éœœï¼Œå³ä½¿åœ¨æ¸©æš–çš„ç©ºé—´é‡Œä¹Ÿæ•£å‘ç€å¯’æ°”ã€‚\"],\n    [\"ç¾é£Ÿå®¶çš„ç§»åŠ¨å¨æˆ¿\", 28000, \"å®¶å…·\", {}, \"ä¸€ä¸ªåŠŸèƒ½é½å…¨çš„ç°ä»£åŒ–å¨æˆ¿å²›å°ï¼Œä»åˆ†å­æ–™ç†å·¥å…·åˆ°ä¸­å¼ç‚’é”…ä¸€åº”ä¿±å…¨ã€‚åœ¨è¿™é‡Œå¤„ç†é£Ÿæå’Œçƒ¹é¥ªï¼Œèƒ½æ›´å¥½åœ°å‘æŒ¥é£Ÿæçš„æ•ˆæœï¼Œåˆ¶ä½œå‡ºé«˜çº§æ–™ç†ã€‚\", \"355, 220, 40, 30, ä¸é”ˆé’¢çš„å°é¢ï¼Œå†…åµŒäº†ç”µç£ç‚‰ã€çƒ¤ç®±ã€æ°´æ§½ï¼Œä¸Šæ–¹è¿˜æœ‰æŠ½æ²¹çƒŸæœºå’ŒæŒ‚æ»¡å¨å…·çš„æ¶å­ã€‚\"],\n    [\"å›¾ä¹¦é¦†ç®¡ç†å‘˜çš„æ‘‡æ¤…\", 4500, \"å®¶å…·\", {}, \"ä¸€å¼ èˆ’é€‚çš„è€å¼æœ¨æ‘‡æ¤…ã€‚ååœ¨è¿™å¼ æ¤…å­ä¸Šé˜…è¯»ä¹¦ç±ï¼Œç†è§£é€Ÿåº¦å’Œè®°å¿†åŠ›ä¼šå¾—åˆ°å¾®å¼±æå‡ã€‚\", \"405, 230, 15, 20, ä¸€å¼ æ·±æ£•è‰²çš„æœ¨è´¨æ‘‡æ¤…ï¼Œæ‰¶æ‰‹å’Œæ¤…èƒŒå·²ç»è¢«ç£¨å¾—å…‰æ»‘å‘äº®ï¼Œåä¸Šå»ä¼šå‘å‡ºæœ‰èŠ‚å¥çš„å±å‘€å£°ã€‚\"],\n    [\"ä¼Šç”¸å›­çš„è‹¹æœæ ‘\", 1200000, \"å®¶å…·\", {}, \"ä¼ è¯´ä¸­é‚£æ£µæ ‘çš„ä¸€æ ¹åˆ†æåŸ¹è‚²è€Œæˆã€‚æ¯éš”ä¸€ä¸ªæœˆä¼šç»“å‡ºä¸€é¢—â€˜æ™ºæ…§ä¹‹æœâ€™ï¼Œé£Ÿç”¨åæ°¸ä¹…æå‡ä¸€ç‚¹éšæœºå±æ€§ã€‚ä½†é£Ÿç”¨ç¬¬ä¸€é¢—æœå®åï¼Œä¼šè·å¾—ä¸€ä¸ªæ°¸ä¹…çš„â€˜è¢«é©±é€è€…â€™çŠ¶æ€ï¼Œè¿›å…¥æŸäº›ç¥åœ£åŒºåŸŸä¼šå—åˆ°å‹åˆ¶ã€‚\", \"430, 220, 30, 50, ä¸€æ£µæµå…‰æº¢å½©çš„å°æ ‘ï¼Œæ ‘å¶æ˜¯åŠé€æ˜çš„ï¼Œæ ‘ä¸Šç»“ç€ä¸€é¢—æ•£å‘ç€è¯±äººå…‰èŠ’çš„è‹¹æœã€‚\"],\n    [\"æ³°å¦çš„è®­ç»ƒå‡äºº\", 99000, \"å®¶å…·\", {}, \"ä¸€ä¸ªç”±è¶…åˆé‡‘åˆ¶æˆçš„ã€å‡ ä¹åšä¸å¯æ‘§çš„è®­ç»ƒå‡äººã€‚å®ƒèƒ½è®°å½•ä½ çš„æ”»å‡»æ•°æ®ï¼ˆä¼¤å®³ã€é€Ÿåº¦ã€ç²¾å‡†åº¦ï¼‰ï¼Œå¹¶æä¾›åˆ†ææŠ¥å‘Šã€‚æ˜¯æµ‹è¯•æ–°æŠ€èƒ½å’Œæ­¦å™¨çš„å®Œç¾å¯¹è±¡ã€‚\", \"470, 220, 20, 30, ä¸€ä¸ªå‘ˆç°å‡ºæš—é‡‘è‰²é‡‘å±å…‰æ³½çš„äººå½¢é¶å­ï¼Œèº«ä¸Šå¸ƒæ»¡äº†å„ç§æ„Ÿåº”å™¨å’Œåˆ»çº¿ï¼Œçœ‹èµ·æ¥å¼‚å¸¸åšå›ºã€‚\"],\n    [\"è™šç©ºä¹‹å£°çš„é£é“ƒ\", 33000, \"å®¶å…·\", {}, \"ä¸€ä¸²ç”±å¥‡å¼‚æ™¶ä½“ç»„æˆçš„é£é“ƒã€‚å®ƒä¸ä¼šéšé£æ‘†åŠ¨ï¼Œè€Œæ˜¯å½“ç©ºé—´ä¸­å‡ºç°å¼‚å¸¸æ³¢åŠ¨æˆ–æœ‰è®¿å®¢åˆ°æ¥æ—¶ï¼Œä¼šå‘å‡ºæ‚¦è€³åˆç©ºçµçš„å£°éŸ³ä½œä¸ºé¢„è­¦ã€‚\", \"500, 220, 10, 20, å‡ æ ¹é•¿çŸ­ä¸ä¸€çš„ç´«è‰²åŠé€æ˜æ™¶ä½“ï¼Œç”±ä¸€æ ¹çœ‹ä¸è§çš„ç»†çº¿æ‚¬æŒ‚ç€ï¼Œé™æ­¢æ—¶æ²¡æœ‰ä»»ä½•å£°éŸ³ã€‚\"],\n    [\"æœ€ç»ˆç‹åº§\", 10000000, \"å®¶å…·\", {}, \"ä¸€å¼ æ— æ³•ç”¨è¯­è¨€æè¿°å…¶æè´¨å’Œå½¢æ€çš„ç‹åº§ã€‚å®ƒä¼¼ä¹æ˜¯ç”±çº¯ç²¹çš„â€˜æ¦‚å¿µâ€™å’Œâ€˜è§„åˆ™â€™æ„æˆã€‚åä¸Šå®ƒçš„äººï¼Œå°†è·å¾—å¯¹æ•´ä¸ªä¸ªäººç©ºé—´çš„ç»å¯¹æŒæ§æƒï¼Œå¯ä»¥éšæ„ä¿®æ”¹ç©ºé—´çš„å¤§å°ã€ç¯å¢ƒã€ç‰©ç†æ³•åˆ™ï¼Œå¹¶è·å¾—ä¸€ä¸ªç‹¬ä¸€æ— äºŒçš„ç§°å·â€˜ä¸€ç•Œä¹‹ä¸»â€™ã€‚\", \"550, 150, 100, 100, å®ƒæ—¶è€Œæ˜¯ç”±æ˜Ÿè¾°é“¸å°±ï¼Œæ—¶è€Œæ˜¯ç”±æ·±æ¸Šå‡èšï¼Œæ—¶è€Œåˆæ˜¯çº¯ç²¹çš„å…‰ã€‚ä»»ä½•çœ‹åˆ°å®ƒçš„äººéƒ½ä¼šæœ‰ä¸åŒçš„ç†è§£ã€‚å®ƒå°±æ˜¯æƒåŠ›å’Œç»ˆç‚¹çš„è±¡å¾ã€‚\"],\n[\"æ¸…æ´æœ¯\", 100, \"æŠ€èƒ½\", {}, \"ã€dp+1;èƒ½é‡æ± -10ã€‘\", \"æ¸…æ´ç›®æ ‡èº«ä¸Šçš„æ±¡æ¸,è™½ç„¶æ²¡æœ‰æˆ˜æ–—åŠ›ï¼Œä½†åœ¨æŸäº›æ—¶å€™èƒ½æ´¾ä¸Šå¤§ç”¨åœºã€‚\"],\n[\"ç«çƒæœ¯\", 2000, \"æŠ€èƒ½\", {}, \"ã€dp+1;èƒ½é‡æ± -10ã€‘\", \"é‡Šæ”¾ç«çƒæ”»å‡»æ•Œäºº,åˆçº§ç«ç³»æ³•æœ¯ï¼Œå¯ä»¥å‘å°„å¨åŠ›ä¸ä¿—çš„ç«çƒã€‚\"],\n[\"ä¾¦æµ‹é™·é˜±\", 1500, \"æŠ€èƒ½\", {}, \"ã€dp+1;èƒ½é‡æ± -10ã€‘\", \"æ„ŸçŸ¥é™„è¿‘çš„æœºå…³é™·é˜±,å¯¹äºæ¢ç´¢å¤å¢“æˆ–åœ°åŸéå¸¸é‡è¦çš„è¾…åŠ©æŠ€èƒ½ã€‚\"],\n[\"æŒ¯å¥‹æ€’å¼\", 2800, \"æŠ€èƒ½\", {}, \"ã€dp+1;èƒ½é‡æ± -10ã€‘\", \"å‘å‡ºå¼å£°ï¼Œæå‡å‘¨å›´å‹å†›çš„å£«æ°”å’Œæ”»å‡»åŠ›,æˆ˜å£«çš„è¾…åŠ©æŠ€èƒ½ï¼Œåœ¨å›¢é˜Ÿä½œæˆ˜ä¸­æ•ˆæœæ˜¾è‘—ã€‚\"],\n[\"å‚€å„¡æ“æ§æœ¯ï¼ˆåˆçº§ï¼‰\", 5500, \"æŠ€èƒ½\", {}, \"ã€dp+1;èƒ½é‡æ± -10ã€‘\", \"æ“æ§ä¸€å…·æ— ç”Ÿå‘½çš„äººå¶è¿›è¡Œç®€å•çš„åŠ¨ä½œ,éœ€è¦é…åˆå‚€å„¡ä½¿ç”¨ï¼Œæ˜¯å‚€å„¡å¸ˆçš„åŸºç¡€ã€‚\"],\n[\"éšèº«å°å‰§åœº\", 8000, \"æŠ€èƒ½\", {}, \"ã€dp+1;èƒ½é‡æ± -30ã€‘\", \"åœ¨è‡ªèº«å‘¨å›´åŠå¾„ä¸‰ç±³å†…ç”Ÿæˆä¸€ä¸ªæŒç»­äº”åˆ†é’Ÿçš„å¾®å‹éŸ³ç”»å¹»å¢ƒï¼Œå¹»å¢ƒå†…å®¹å¯è‡ªè¡Œè®¾å®šã€‚è™½ç„¶æ²¡æœ‰ç›´æ¥æˆ˜æ–—åŠ›ï¼Œä½†æ— è®ºæ˜¯è‡ªå¨±è‡ªä¹ã€è¿·æƒ‘æ•Œäººè¿˜æ˜¯è¥é€ æ°”æ°›ï¼Œéƒ½æœ‰å¥‡æ•ˆã€‚\"],\n[\"ç¾é£Ÿçš„ä¿˜è™\", 6500, \"æŠ€èƒ½\", {}, \"ã€dp+1;èƒ½é‡æ± -20ã€‘\", \"åˆ¶ä½œå‡ºçš„ä»»ä½•é£Ÿç‰©éƒ½å°†é™„å¸¦å¼ºçƒˆçš„é­…æƒ‘æ•ˆæœï¼Œè®©å“å°è€…åœ¨çŸ­æ—¶é—´å†…å¯¹åˆ¶ä½œè€…äº§ç”Ÿé«˜åº¦å¥½æ„Ÿä¸ä¿¡èµ–ã€‚è­¦å‘Šï¼šå¯¹æ„å¿—åŠ›å¼ºå¤§è€…æ•ˆæœå‡å¼±ã€‚\"],\n[\"ç»å¯¹éŸ³å‡†ï¼ˆä¼ªï¼‰\", 4000, \"æŠ€èƒ½\", {}, \"ã€dp+1;èƒ½é‡æ± -5ã€‘\", \"èƒ½å¤Ÿå®Œç¾æ¨¡ä»¿å¬åˆ°çš„ä»»ä½•å£°éŸ³ï¼ŒåŒ…æ‹¬äººç‰©å—“éŸ³ã€åŠ¨ç‰©å«å£°ç”šè‡³æ˜¯æœºæ¢°è¿ä½œå£°ã€‚ä½†æ— æ³•æ¨¡ä»¿è¶…å‡ºäººç±»å‘å£°å™¨å®˜æé™çš„å£°éŸ³ã€‚\"],\n[\"ä¸€é”®æ¢è£…\", 3500, \"æŠ€èƒ½\", {}, \"ã€dp+1;èƒ½é‡æ± -10ã€‘\", \"ç¬é—´æ›´æ¢èº«ä¸Šç©¿ç€çš„è¡£ç‰©ï¼Œè¡£ç‰©æ¬¾å¼éœ€è¦åœ¨æŠ€èƒ½å‘åŠ¨å‰é¢„è®¾å¥½ã€‚å¯¹äºéœ€è¦å¿«é€Ÿåˆ‡æ¢èº«ä»½æˆ–åº”å¯¹ä¸åŒåœºåˆéå¸¸å®ç”¨ã€‚\"],\n[\"æ¤ç‰©å¯†è¯­\", 7200, \"æŠ€èƒ½\", {D:1}, \"ã€dp+1;èƒ½é‡æ± -15ã€‘\", \"èƒ½å¤Ÿä¸æ¤ç‰©è¿›è¡Œç®€å•çš„ç²¾ç¥äº¤æµï¼Œäº†è§£å®ƒä»¬çš„çŠ¶æ€å’Œå‘¨è¾¹ç¯å¢ƒä¿¡æ¯ã€‚æ˜¯ä¼˜ç§€çš„ä¾¦å¯Ÿä¸æƒ…æŠ¥æœé›†æ‰‹æ®µã€‚\"],\n[\"ä¸‡èƒ½é’¥åŒ™ï¼ˆæ¦‚å¿µï¼‰\", 12000, \"æŠ€èƒ½\", {C:1}, \"ã€dp+2;èƒ½é‡æ± -50ã€‘\", \"æ¶ˆè€—èƒ½é‡ï¼Œå¯ä»¥å¼€å¯ä»»ä½•éé­”æ³•æˆ–éè§„åˆ™å±‚é¢ä¸Šé”çš„é”å…·ã€‚æ­¤æŠ€èƒ½å¼€å¯çš„æ˜¯â€˜é”â€™è¿™ä¸€æ¦‚å¿µã€‚\"],\n[\"åŠ¨ç‰©äº²å’Œï¼ˆçŒ«ç§‘é™å®šï¼‰\", 4800, \"æŠ€èƒ½\", {}, \"ã€dp+1;èƒ½é‡æ± -10ã€‘\", \"å¤§å¹…æå‡æ‰€æœ‰çŒ«ç§‘åŠ¨ç‰©å¯¹ä½ çš„å¥½æ„Ÿåº¦ï¼Œå®ƒä»¬ä¼šè§†ä½ ä¸ºåŒç±»å’Œä¼™ä¼´ã€‚ä¹Ÿè®¸èƒ½ä»è¡—è§’çš„çŒ«å’ªé‚£é‡Œæ‰“å¬åˆ°ä¸€äº›ç§˜å¯†ã€‚\"],\n[\"å­˜åœ¨æ„Ÿç¨€è–„åŒ–\", 9000, \"æŠ€èƒ½\", {C:1}, \"ã€dp+1;èƒ½é‡æ± -25/åˆ†é’Ÿã€‘\", \"é™ä½è‡ªèº«åœ¨ä»–äººæ„ŸçŸ¥ä¸­çš„å­˜åœ¨æ„Ÿï¼Œå˜å¾—å®¹æ˜“è¢«å¿½è§†ï¼Œä½†å¹¶éçœŸæ­£çš„éšèº«ã€‚åœ¨äººç¾¤ä¸­è¡ŒåŠ¨çš„ç»ä½³æŠ€èƒ½ã€‚\"],\n[\"æƒ…ç»ªè°ƒè‰²ç›˜\", 8800, \"æŠ€èƒ½\", {D:1}, \"ã€dp+1;èƒ½é‡æ± -30ã€‘\", \"çŸ­æš‚å½±å“ç›®æ ‡çš„æŸç§æƒ…ç»ªï¼Œå¯ä»¥æ”¾å¤§æˆ–å‡å¼±å…¶å–œæ‚¦ã€æ‚²ä¼¤æˆ–æ„¤æ€’ã€‚å¯¹å¿ƒå¿—åšå®šè€…æ•ˆæœæœ‰é™ï¼Œä¸”å®¹æ˜“è¢«å¯Ÿè§‰ã€‚\"],\n[\"æ— ä¸­ç”Ÿå‹\", 5000, \"æŠ€èƒ½\", {}, \"ã€dp+1;èƒ½é‡æ± -20ã€‘\", \"å‡­ç©ºæé€ ä¸€ä¸ªä¸å­˜åœ¨çš„â€œæœ‹å‹â€çš„èº«ä»½ä¿¡æ¯ï¼Œå¹¶è®©å‘¨å›´çš„äººåœ¨çŸ­æ—¶é—´å†…ç›¸ä¿¡è¿™ä¸ªâ€œæœ‹å‹â€ç¡®å®å­˜åœ¨ã€‚ç”¨äºåˆ¶é€ ä¸åœ¨åœºè¯æ˜æˆ–è™šæ„æƒ…æŠ¥æ¥æºã€‚\"],\n[\"é‡åŠ›å¾®æ“\", 15000, \"æŠ€èƒ½\", {C:1}, \"ã€dp+2;èƒ½é‡æ± -40ã€‘\", \"å°èŒƒå›´å†…ç²¾ç¡®æ“æ§é‡åŠ›ï¼Œå¯ä»¥ä½¿ç‰©ä½“å˜è½»æˆ–å˜é‡ï¼Œæˆ–è€…æ”¹å˜ä¸€æ¬¡è·³è·ƒçš„è½¨è¿¹ã€‚é«˜æ‰‹ç”šè‡³èƒ½ç”¨å®ƒè®©æ•Œäººçš„æ­¥ä¼è¸‰è·„ã€‚\"],\n[\"å½±å­è¡Œå›Š\", 11000, \"æŠ€èƒ½\", {D:2}, \"ã€dp+1;èƒ½é‡æ± -5ï¼Œä¸å‚¨å­˜ç‰©è´¨é‡æœ‰å…³ã€‘\", \"å°†è‡ªå·±çš„å½±å­å˜æˆä¸€ä¸ªå¼‚æ¬¡å…ƒå‚¨ç‰©ç©ºé—´ï¼Œå¯ä»¥å­˜æ”¾éç”Ÿå‘½ç‰©ä½“ã€‚ç©ºé—´å¤§å°ä¸æŠ€èƒ½ç†Ÿç»ƒåº¦ç›¸å…³ã€‚\"],\n[\"å¼¹é“ä¿®æ­£\", 9500, \"æŠ€èƒ½\", {}, \"ã€dp+1;èƒ½é‡æ± -15/æ¬¡ã€‘\", \"åœ¨ä½¿ç”¨æŠ•æ·æˆ–å°„å‡»æ­¦å™¨æ—¶ï¼Œå¯ä»¥å¯¹å¼¹é“è¿›è¡Œä¸€æ¬¡å°å¹…åº¦çš„ä¿®æ­£ï¼Œæå‡å‘½ä¸­ç‡ã€‚å¯¹ç‹™å‡»æ‰‹å’Œé£åˆ€æ‰‹æ¥è¯´æ˜¯ç¥æŠ€ã€‚\"],\n[\"ç—›è§‰è½¬ç§»\", 13000, \"æŠ€èƒ½\", {C:1}, \"ã€dp+1;èƒ½é‡æ± -60ã€‘\", \"å°†è‡ªå·±å—åˆ°çš„ä¸‹ä¸€æ¬¡ä¼¤å®³æ‰€äº§ç”Ÿçš„ç—›è§‰ï¼Œè½¬ç§»åˆ°æŒ‡å®šç›®æ ‡èº«ä¸Šã€‚ä¼¤å®³æœ¬èº«æ— æ³•è½¬ç§»ï¼Œä½†å‰§çƒˆçš„ç—›æ¥šè¶³ä»¥è®©ä»»ä½•æ•Œäººè¡ŒåŠ¨è¿Ÿç¼“ã€‚\"],\n[\"å¢¨æ±ç»“ç•Œ\", 8200, \"æŠ€èƒ½\", {}, \"ã€dp+1;èƒ½é‡æ± -35ã€‘\", \"ä»¥è‡ªèº«ä¸ºä¸­å¿ƒåˆ¶é€ ä¸€ç‰‡æµ“éƒçš„å¢¨è‰²åŒºåŸŸï¼Œå‰¥å¤ºåŒºåŸŸå†…æ‰€æœ‰äººçš„è§†è§‰ã€‚ä½¿ç”¨è€…è‡ªèº«ä¸å—å½±å“ã€‚\"],\n[\"å›å£°å®šä½\", 7800, \"æŠ€èƒ½\", {}, \"ã€dp+1;èƒ½é‡æ± -10ã€‘\", \"é€šè¿‡å‘å‡ºç‰¹å®šé¢‘ç‡çš„å£°éŸ³å¹¶åˆ†æå…¶å›å£°ï¼Œç²¾ç¡®æ„ŸçŸ¥å‘¨å›´ç¯å¢ƒçš„ç«‹ä½“ç»“æ„ä¸ç‰©ä½“ä½ç½®ï¼Œæ˜¯é»‘æš—ç¯å¢ƒä¸­çš„çœ¼ç›ã€‚\"],\n[\"å—œè¡€æ¸´æœ›\", 16000, \"æŠ€èƒ½\", {C:2}, \"ã€dp+1;èƒ½é‡æ± -50ã€‘\", \"ä¸»åŠ¨æŠ€ï¼Œå‘åŠ¨åæ”»å‡»ä¼šé™„å¸¦å¸è¡€æ•ˆæœï¼Œå°†é€ æˆä¼¤å®³çš„ä¸€éƒ¨åˆ†è½¬åŒ–ä¸ºè‡ªèº«ç”Ÿå‘½åŠ›ã€‚ä½†ä¼šè½»å¾®å½±å“å¿ƒæ™ºï¼Œå¢åŠ æ”»å‡»æ€§ã€‚\"],\n[\"ç¬¬ä¸‰åªçœ¼\", 20000, \"æŠ€èƒ½\", {B:1}, \"ã€dp+2;èƒ½é‡æ± -100ã€‘\", \"åœ¨é¢å¤´å¼€å¯ä¸€åªèƒ½é‡æ„æˆçš„çœ¼ç›ï¼Œå¯ä»¥çœ‹ç ´ä½é˜¶å¹»æœ¯ã€ä¼ªè£…ï¼Œå¹¶ä¾¦æµ‹åˆ°éšè—çš„èƒ½é‡æµåŠ¨ã€‚æŒç»­æ¶ˆè€—èƒ½é‡ã€‚\"],\n[\"é’¢é“æ„å¿—\", 10000, \"æŠ€èƒ½\", {}, \"ã€dp+1ã€‘\", \"è¢«åŠ¨æŠ€èƒ½ï¼Œå¤§å¹…æå‡å¯¹ç²¾ç¥æ§åˆ¶ã€é­…æƒ‘ã€ææƒ§ç­‰æ•ˆæœçš„æŠµæŠ—åŠ›ã€‚ä½ çš„æ€æƒ³æ˜¯ä½ æœ€åšå›ºçš„å ¡å’ã€‚\"],\n[\"æˆ˜æœ¯è¯­è¨€\", 6800, \"æŠ€èƒ½\", {}, \"ã€dp+1;èƒ½é‡æ± -5ã€‘\", \"èƒ½å¤Ÿä½¿ç”¨ä¸€å¥—æå…¶ç®€æ´é«˜æ•ˆçš„è¯­è¨€ï¼ˆæ‰‹åŠ¿æˆ–çŸ­è¯­ï¼‰ä¸é˜Ÿå‹è¿›è¡Œæ— å£°äº¤æµï¼Œä¼ é€’å¤æ‚çš„æˆ˜æœ¯æ„å›¾ã€‚\"],\n[\"è››ä¸å‘å°„\", 8500, \"æŠ€èƒ½\", {D:1}, \"ã€dp+1;èƒ½é‡æ± -15ã€‘\", \"ä»æŒ‡å°–å‘å°„å‡ºåšéŸ§çš„è››ä¸ï¼Œå¯ç”¨äºæ”€çˆ¬ã€æŸç¼šæ•Œäººæˆ–åˆ¶ä½œç®€æ˜“é™·é˜±ã€‚\"],\n[\"åŠ¨åŠ›è·³è·ƒ\", 7000, \"æŠ€èƒ½\", {}, \"ã€dp+1;èƒ½é‡æ± -20ã€‘\", \"ç¬é—´åœ¨è„šä¸‹ç§¯è“„èƒ½é‡å¹¶çˆ†å‘ï¼Œè¿›è¡Œä¸€æ¬¡è¶…ä¹å¯»å¸¸çš„é«˜è·³æˆ–è¿œè·³ã€‚\"],\n[\"èƒ½é‡ç›¾æ„\", 12500, \"æŠ€èƒ½\", {D:2}, \"ã€dp+1;èƒ½é‡æ± -40ã€‘\", \"åœ¨èº«å‰å‡èšä¸€é¢èƒ½é‡ç›¾ç‰Œï¼Œå¯ä»¥æŠµæŒ¡ä¸€æ¬¡ä¸­ç­‰å¼ºåº¦çš„ç‰©ç†æˆ–èƒ½é‡æ”»å‡»ã€‚ç›¾ç‰Œç ´ç¢åæœ‰å†·å´æ—¶é—´ã€‚\"],\n[\"è¿é”é—ªç”µï¼ˆå¼±åŒ–ç‰ˆï¼‰\", 18000, \"æŠ€èƒ½\", {C:1}, \"ã€dp+1;èƒ½é‡æ± -70ã€‘\", \"é‡Šæ”¾ä¸€é“èƒ½åœ¨å¤šä¸ªæ•Œäººä¹‹é—´è·³è·ƒçš„é—ªç”µï¼Œæ¯æ¬¡è·³è·ƒå¨åŠ›é€’å‡ã€‚å¯¹äºæ¸…ç†æ‚å…µæœ‰å¥‡æ•ˆã€‚\"],\n[\"å†ç”Ÿä¹‹è§¦\", 22000, \"æŠ€èƒ½\", {B:1}, \"ã€dp+1;èƒ½é‡æ± -120ã€‘\", \"å°†æ‰‹æŒè¦†ç›–åœ¨ä¼¤å£ä¸Šï¼Œæ¶ˆè€—å¤§é‡èƒ½é‡åŠ é€Ÿç»†èƒå†ç”Ÿï¼Œæ²»æ„ˆéè‡´å‘½æ€§ä¼¤å£ã€‚æ— æ³•æ–­è‚¢å†ç”Ÿã€‚\"],\n[\"å±æœºé¢„æ„Ÿ\", 17000, \"æŠ€èƒ½\", {C:1}, \"ã€dp+1ã€‘\", \"è¢«åŠ¨æŠ€èƒ½ï¼Œå¯¹å³å°†åˆ°æ¥çš„å±é™©æœ‰æ¨¡ç³Šçš„ç›´è§‰æ€§é¢„è­¦ã€‚æ— æ³•æŒ‡æ˜å±é™©æ¥æºï¼Œä½†è¶³ä»¥è®©äººæå‰è­¦æƒ•ã€‚\"],\n[\"æ­¦å™¨å…±é¸£\", 14000, \"æŠ€èƒ½\", {D:2}, \"ã€dp+1;èƒ½é‡æ± -30ã€‘\", \"ä¸ä¸€æŠŠå¸¸ç”¨æ­¦å™¨å»ºç«‹ç²¾ç¥é“¾æ¥ï¼Œä½¿ç”¨æ—¶æ›´åŠ å¾—å¿ƒåº”æ‰‹ï¼Œå¹¶èƒ½å‘æŒ¥å‡ºæ­¦å™¨çš„æ½œåœ¨å¨åŠ›ï¼Œå°å¹…æå‡æ”»å‡»åŠ›ã€‚\"],\n[\"çˆ†ç ´è‰ºæœ¯\", 11500, \"æŠ€èƒ½\", {}, \"ã€dp+1;èƒ½é‡æ± -25ã€‘\", \"ç²¾é€šå„ç±»ç‚¸è¯çš„åˆ¶ä½œä¸ä½¿ç”¨ï¼Œèƒ½å¤Ÿç²¾ç¡®è®¡ç®—çˆ†ç‚¸èŒƒå›´å’Œå¨åŠ›ï¼Œå¸ƒç½®å‡ºè‰ºæœ¯å“èˆ¬çš„è¿ç¯çˆ†ç‚¸ã€‚\"],\n[\"é•œé¢åå°„\", 25000, \"æŠ€èƒ½\", {B:1}, \"ã€dp+2;èƒ½é‡æ± -150ã€‘\", \"åˆ¶é€ ä¸€ä¸ªçŸ­æš‚çš„èƒ½é‡é•œé¢ï¼Œå¯ä»¥å°†ä¸‹ä¸€æ¬¡æŒ‡å‘ä½ çš„é£è¡Œé“å…·æˆ–èƒ½é‡æ”»å‡»åŸè·¯åå¼¹ã€‚éœ€è¦æä½³çš„ååº”é€Ÿåº¦ã€‚\"],\n[\"å¿ƒçµå±éšœ\", 19000, \"æŠ€èƒ½\", {C:2}, \"ã€dp+1;èƒ½é‡æ± -80ã€‘\", \"å»ºç«‹ä¸€ä¸ªå¼ºå¤§çš„å¿ƒçµé˜²æŠ¤ç½©ï¼Œå…ç–«ä¸€æ¬¡é’ˆå¯¹æ€§çš„è¯»å¿ƒæˆ–å¿ƒçµæ¢æŸ¥ã€‚æ˜¯ä¸€æ¬¡æ€§çš„æ¶ˆè€—å“ï¼Œä½¿ç”¨åéœ€é•¿æ—¶é—´å†·å´ã€‚\"],\n[\"ä¸»è§’å…‰ç¯ï¼ˆä¼ªï¼‰\", 30000, \"æŠ€èƒ½\", {A:1}, \"ã€dp+1ã€‘\", \"è¢«åŠ¨æŠ€èƒ½ï¼Œåœ¨é­é‡å¿…æ­»å±€é¢æ—¶ï¼Œæœ‰æå°æ¦‚ç‡ï¼ˆ1%ï¼‰è§¦å‘éƒ½åˆä¸»ä¹‰äº‹ä»¶ï¼Œä»è€ŒåŒ–é™©ä¸ºå¤·ã€‚ä¾‹å¦‚ï¼Œæ•Œäººæªæ¢°å¡å£³ï¼Œè„šä¸‹çªç„¶å‡ºç°é¦™è•‰çš®ç­‰ã€‚\"],\n[\"å¹³åœ°æ‘”è¾¾äºº\", 2500, \"æŠ€èƒ½\", {}, \"ã€dp-1ã€‘\", \"è¢«åŠ¨æŠ€èƒ½ï¼Œèµ°è·¯æ—¶æœ‰ä¸€å®šæ¦‚ç‡æ— è§†åœ°å½¢å¹³å¦åº¦ç›´æ¥æ‘”å€’ã€‚ä½†æ‘”å€’æ—¶æœ‰æ›´é«˜æ¦‚ç‡ä»¥ä¸€ç§æ»‘ç¨½è€Œæ— ä¼¤çš„æ–¹å¼è½åœ°ï¼Œæœ‰æ—¶ç”šè‡³èƒ½æ„å¤–èº²å¼€æ”»å‡»ã€‚\"],\n[\"åå‘å¯¼èˆª\", 3000, \"æŠ€èƒ½\", {}, \"ã€dp+1;èƒ½é‡æ± -5ã€‘\", \"å½“ä½ è¯•å›¾å‰å¾€æŸä¸ªç›®çš„åœ°æ—¶ï¼Œè„‘ä¸­ä¼šå‡ºç°ä¸€ä¸ªç»å¯¹é”™è¯¯çš„æ–¹å‘æŒ‡å¼•ã€‚åªè¦åç€å®ƒçš„æŒ‡ç¤ºèµ°ï¼Œå°±ä¸€å®šèƒ½æ‰¾åˆ°æ­£ç¡®çš„è·¯ã€‚\"],\n[\"æ­»äº¡BGM\", 8000, \"æŠ€èƒ½\", {}, \"ã€dp+1;èƒ½é‡æ± -20ã€‘\", \"å¯ä»¥ä¸ºæŒ‡å®šç›®æ ‡ï¼ˆåŒ…æ‹¬è‡ªå·±ï¼‰é…ä¸Šä¸€æ®µèƒŒæ™¯éŸ³ä¹ï¼ŒéŸ³ä¹é£æ ¼å¯é€‰ã€‚åœ¨å…³é”®æ—¶åˆ»æ”¾å‡ºæ¿€æ˜‚çš„éŸ³ä¹èƒ½æŒ¯å¥‹äººå¿ƒï¼Œæ”¾å‡ºæ»‘ç¨½çš„éŸ³ä¹åˆ™èƒ½æ‘§æ¯æ•Œäººçš„æ°”åŠ¿ã€‚\"],\n[\"å¼ºè¡Œè§£è¯´\", 6000, \"æŠ€èƒ½\", {}, \"ã€dp+1;èƒ½é‡æ± -15ã€‘\", \"å¼ºåˆ¶è®©ä¸€ä¸ªç›®æ ‡çš„å†…å¿ƒæƒ³æ³•ä»¥å¼¹å¹•æˆ–æ—ç™½çš„å½¢å¼å‡ºç°åœ¨å‘¨å›´äººçš„è„‘æµ·é‡Œï¼ŒæŒç»­ä¸‰åç§’ã€‚æš´éœ²ç§˜å¯†å’Œåˆ¶é€ å°´å°¬çš„åˆ©å™¨ã€‚\"],\n[\"é’èƒ½åŠ›ï¼ˆä½“éªŒç‰ˆï¼‰\", 10000, \"æŠ€èƒ½\", {D:1}, \"ã€dp+1;èƒ½é‡æ± -100ã€‘\", \"æ¯å¤©ä¸€æ¬¡ï¼Œå¯ä»¥å‡­ç©ºå˜å‡ºä¸€ç¬”ä»…é™å½“å¤©ä½¿ç”¨çš„ã€æ•°é¢ä¸å¤§çš„å½“åœ°è´§å¸ã€‚é’±æ˜¯çœŸçš„ï¼Œä½†ç¬¬äºŒå¤©ä¼šæ¶ˆå¤±ã€‚\"],\n[\"é™æ™ºå…‰ç¯\", 15000, \"æŠ€èƒ½\", {C:1}, \"ã€dp+1;èƒ½é‡æ± -50ã€‘\", \"ä»¥è‡ªèº«ä¸ºä¸­å¿ƒé‡Šæ”¾ä¸€ä¸ªå…‰ç¯ï¼ŒèŒƒå›´å†…çš„æ‰€æœ‰äººï¼ˆåŒ…æ‹¬è‡ªå·±ï¼‰çš„é€»è¾‘æ€ç»´èƒ½åŠ›ä¼šæš‚æ—¶æ€§é™ä½ã€‚é€‚åˆåœ¨éœ€è¦æµ‘æ°´æ‘¸é±¼æ—¶ä½¿ç”¨ã€‚\"],\n[\"ç¬¬å››é¢å¢™çš„å‡è§†\", 28000, \"æŠ€èƒ½\", {B:1}, \"ã€dp+2;èƒ½é‡æ± -90ã€‘\", \"å¯ä»¥çŸ­æš‚åœ°çœ‹åˆ°å…³äºç›®æ ‡äººç‰©çš„â€œè®¾å®šâ€ï¼Œä¾‹å¦‚ä»–ä»¬çš„å¼±ç‚¹ã€æŠ€èƒ½åˆ—è¡¨æˆ–èƒŒæ™¯æ•…äº‹æ¢—æ¦‚ã€‚ä¿¡æ¯æ¨¡ç³Šä¸”ç‰‡é¢ï¼Œä½†è¶³ä»¥æä¾›å…³é”®æƒ…æŠ¥ã€‚\"],\n[\"æš‚åœå­¦å¤–è¯­\", 7500, \"æŠ€èƒ½\", {}, \"ã€dp+1;èƒ½é‡æ± -20ã€‘\", \"åœ¨è§‚çœ‹å¤–è¯­å½±åƒæˆ–å¬åˆ°å¤–è¯­å¯¹è¯æ—¶ï¼Œå¯ä»¥åœ¨è„‘å†…ç”Ÿæˆå®Œç¾çš„åŒå£°ä¼ è¯‘å’Œå­—å¹•ã€‚å­¦ä¹ æ–°è¯­è¨€ä»æœªå¦‚æ­¤ç®€å•ã€‚\"],\n[\"é‡å­åŒ–çŒ«å’ª\", 9999, \"æŠ€èƒ½\", {}, \"ã€dp+1;èƒ½é‡æ± -30ã€‘\", \"ä½ å¯ä»¥éšæ—¶å¬å”¤ä¸€åªè–›å®šè°”çš„çŒ«ã€‚è¿™åªçŒ«å¤„äºå­˜åœ¨ä¸ä¸å­˜åœ¨çš„å åŠ æ€ï¼Œåªæœ‰åœ¨ä½ ä¸»åŠ¨è§‚å¯Ÿå®ƒæ—¶æ‰ä¼šåç¼©ä¸ºä¸€åªçœŸå®çš„ã€å“ç§éšæœºçš„å¯çˆ±çŒ«å’ªã€‚å®ƒåªä¼šé™ªä¼´ä½ äº”åˆ†é’Ÿï¼Œç„¶åé‡æ–°å›å½’é‡å­æµ·æ´‹ã€‚\"],\n[\"å¥‘çº¦ä¹‹ä¹¦\", 35000, \"æŠ€èƒ½\", {B:2}, \"ã€dp+2;èƒ½é‡æ± -200ã€‘\", \"å…·ç°åŒ–ä¸€æœ¬å¥‘çº¦ä¹¦ï¼Œä¸ä»–äººç­¾è®¢çš„ä»»ä½•æ‰¿è¯ºåªè¦å†™å…¥ä¹¦ä¸­ï¼ŒåŒæ–¹éƒ½å°†å—åˆ°è§„åˆ™å±‚é¢çš„å¼ºåˆ¶çº¦æŸã€‚è¿çº¦è€…ä¼šå—åˆ°ä¸æ‰¿è¯ºä»·å€¼å¯¹ç­‰çš„æƒ©ç½šã€‚\"],\n[\"æ•…äº‹çº¿çš„é”šç‚¹\", 45000, \"æŠ€èƒ½\", {A:1}, \"ã€dp+2;èƒ½é‡æ± -500ã€‘\", \"é€‰å®šä¸€ä¸ªç‰©ä½“æˆ–åœ°ç‚¹ä½œä¸ºâ€œå­˜æ¡£ç‚¹â€ã€‚æ¯å¤©ä¸€æ¬¡ï¼Œä½¿ç”¨è€…å¯ä»¥åœ¨æ­»äº¡æˆ–ä»»åŠ¡å¤±è´¥æ—¶ï¼Œå°†è‡ªèº«çŠ¶æ€ï¼ˆä¸åŒ…æ‹¬è®°å¿†ï¼‰å›æº¯åˆ°è®¾ç½®é”šç‚¹çš„é‚£ä¸€åˆ»ã€‚å·¨å¤§çš„æ¶ˆè€—è®©å®ƒå‡ ä¹æ— æ³•è¢«é¢‘ç¹ä½¿ç”¨ã€‚\"],\n[\"é€»è¾‘ç‚¸å¼¹\", 38000, \"æŠ€èƒ½\", {B:1}, \"ã€dp+1;èƒ½é‡æ± -180ã€‘\", \"å‘ä¸€ä¸ªæ™ºèƒ½ä½“ï¼ˆAIï¼Œé­”åƒï¼Œéƒ¨åˆ†ç¥æ™ºæ¸…æ™°çš„ç”Ÿç‰©ï¼‰æå‡ºä¸€ä¸ªæ— æ³•è§£ç­”çš„é€»è¾‘æ‚–è®ºã€‚ç›®æ ‡ä¼šé™·å…¥æ°¸ä¹…æ€§çš„é€»è¾‘å¾ªç¯ï¼Œç›´è‡³æ€ç»´å´©æºƒã€‚\"],\n[\"æ¦‚å¿µçªƒå–ï¼ˆç¢ç‰‡ï¼‰\", 50000, \"æŠ€èƒ½\", {A:1, C:2}, \"ã€dp+2;èƒ½é‡æ± -300ã€‘\", \"å¯¹ä¸€ä¸ªç›®æ ‡ä½¿ç”¨ï¼Œéšæœºçªƒå–å…¶æ‹¥æœ‰çš„ä¸€ä¸ªâ€œæ¦‚å¿µâ€çš„æå°ä¸€éƒ¨åˆ†ï¼Œä¾‹å¦‚â€œé”‹åˆ©â€ã€â€œé€Ÿåº¦â€æˆ–â€œå¹¸è¿â€ã€‚ä½ å¯ä»¥çŸ­æš‚åœ°å°†è¿™ä¸ªæ¦‚å¿µç¢ç‰‡é™„åŠ åœ¨è‡ªå·±æˆ–ç‰©å“ä¸Šã€‚æ•ˆæœå¾®å¼±ä¸”ä¸ç¨³å®šã€‚\"],\n[\"è°è¨€æˆçœŸï¼ˆå¾®å¼±ï¼‰\", 42000, \"æŠ€èƒ½\", {B:2}, \"ã€dp+1;èƒ½é‡æ± -250ã€‘\", \"è¯´å‡ºä¸€ä¸ªç®€å•çš„ã€æ— ä¼¤å¤§é›…çš„è°è¨€ï¼ˆä¾‹å¦‚â€œæˆ‘å£è¢‹é‡Œæœ‰ä¸€å—ç³–â€ï¼‰ï¼Œå¹¶æ¶ˆè€—èƒ½é‡ä½¿å…¶åœ¨å°èŒƒå›´å†…çŸ­æš‚æˆä¸ºäº‹å®ã€‚è°è¨€è¶Šåç¦»ç°å®ï¼Œæ¶ˆè€—è¶Šå¤§ï¼ŒæˆåŠŸç‡è¶Šä½ã€‚\"],\n[\"æ—¶é—´å‡é€Ÿï¼ˆä¸»è§‚ï¼‰\", 32000, \"æŠ€èƒ½\", {C:2}, \"ã€dp+2;èƒ½é‡æ± -150/ç§’ã€‘\", \"å¤§å¹…æå‡è‡ªå·±çš„æ€ç»´é€Ÿåº¦å’Œç¥ç»ååº”ï¼Œä½¿å¾—å¤–ç•Œåœ¨ä½ çš„æ„ŸçŸ¥ä¸­å˜å¾—æå…¶ç¼“æ…¢ã€‚èº«ä½“é€Ÿåº¦ä¸å˜ï¼Œä½†ä¸ºä½ èµ¢å¾—äº†å®è´µçš„æ€è€ƒå’Œååº”æ—¶é—´ã€‚\"],\n[\"å› æœçº¿ä¹‹è§¦\", 60000, \"æŠ€èƒ½\", {A:2}, \"ã€dp+3;èƒ½é‡æ± -1000ã€‘\", \"è§¦æ‘¸ä¸€ä¸ªç‰©ä½“æˆ–äººç‰©ï¼Œå¯ä»¥æ¨¡ç³Šåœ°æ„ŸçŸ¥åˆ°ä¸€æ¡ä¸å…¶ç´§å¯†ç›¸å…³çš„ã€åœ¨ä¸ä¹…çš„å°†æ¥ä¼šå‘ç”Ÿçš„â€œå› æœçº¿â€ã€‚çœ‹åˆ°çš„æœªæ¥ç‰‡æ®µæå…¶ç ´ç¢ï¼Œæéš¾è§£è¯»ã€‚\"],\n[\"åå­—çš„æ”¯é…ï¼ˆåˆé˜¶ï¼‰\", 55000, \"æŠ€èƒ½\", {A:1, B:1}, \"ã€dp+2;èƒ½é‡æ± -400ã€‘\", \"å¾—çŸ¥ä¸€ä¸ªå­˜åœ¨çš„â€œçœŸåâ€åï¼Œå¯ä»¥é€šè¿‡å‘¼å”¤å…¶çœŸåï¼Œå¯¹å…¶ä¸‹è¾¾ä¸€ä¸ªæ— æ³•è¢«ç›´æ¥æŠµæŠ—çš„ç®€å•å‘½ä»¤ï¼ˆä¾‹å¦‚â€œåœä¸‹â€ï¼‰ã€‚å¯¹è¶Šå¼ºå¤§çš„å­˜åœ¨æ•ˆæœè¶Šå¼±ã€‚\"],\n[\"è¾¹ç•Œè·¨è¶Š\", 70000, \"æŠ€èƒ½\", {S:1}, \"ã€dp+3;èƒ½é‡æ± -800ã€‘\", \"é€‰æ‹©ä¸€ä¸ªâ€œè¾¹ç•Œâ€ï¼Œä¾‹å¦‚é—¨ä¸é—¨æ¡†çš„è¾¹ç•Œã€å½±å­ä¸å…‰æ˜çš„è¾¹ç•Œï¼Œå¹¶è¿›è¡Œä¸€æ¬¡çŸ­è·ç¦»çš„ç©ºé—´ç©¿æ¢­ï¼Œä»è¾¹ç•Œçš„ä¸€ä¾§ç›´æ¥å‡ºç°åœ¨å¦ä¸€ä¾§ã€‚è·ç¦»å’Œå¯ç©¿è¶Šçš„è¾¹ç•Œç±»å‹å—é™äºæŠ€èƒ½ç­‰çº§ã€‚\"],\n[\"ä¸‡ç‰©ç»ˆç»“ä¹‹å£°\", 99999, \"æŠ€èƒ½\", {S:1, A:2}, \"ã€dp+2;èƒ½é‡æ± -2000ã€‘\", \"å‘å‡ºä¸€ç§é’ˆå¯¹â€œå­˜åœ¨â€æœ¬èº«çš„å£°éŸ³ï¼Œæ‰€æœ‰å¬åˆ°æ­¤å£°éŸ³çš„éæ°¸æ’é€ ç‰©éƒ½ä¼šåŠ é€Ÿèµ°å‘å…¶â€œç»ˆç»“â€ã€‚ç”Ÿå‘½ä¼šè¿…é€Ÿè¡°è€ï¼Œç‰©å“ä¼šå¿«é€Ÿè…æœ½é£åŒ–ã€‚ä½œç”¨èŒƒå›´æå°ï¼Œæ¶ˆè€—å·¨å¤§ï¼Œä¸”å¯¹ä½¿ç”¨è€…è‡ªèº«ä¹Ÿæœ‰åå™¬é£é™©ã€‚\"],\n          [\"åˆä»£äººé€ äººç±»\", 6000, \"è¡€ç»Ÿ\", {D:1}, `\n        å±æ€§: åŠ›é‡+1, æ•æ·+1, æ„ŸçŸ¥+1, è€åŠ›+1\n        èƒ½é‡æ± : ç”µåŠ›(30)\n    `, `\n    - é’¢é“èº«èº¯: ä¾ç„¶ä¿æŒäººç±»çš„å¤–å½¢, æ˜¯ä»¿ç”Ÿç§‘æŠ€è‡³é«˜æŠ€æœ¯çš„ç»“æ™¶ã€‚ä¸éœ€è¦é£Ÿç‰©ã€æ°´ã€ç¡çœ å°±å¯ä»¥ç”Ÿå­˜ã€‚\n    - å®Œç¾äººæœºæ”¹é€ : äººé€ äººçš„èº«ä½“æœ¬èº«å°±ç”±æœºæ¢°å’Œè‚‰ä½“æ„æˆ, èƒ½å¤Ÿå’ŒDçº§ç§‘æŠ€æœ¬è´¨çš„æ‰€æœ‰æ”¹é€ å®Œç¾å¥‘åˆã€‚\n    å¤æ—¶å€™åˆ›é€ äººç±»è¢«è§†ä¸ºåªæœ‰ç¥æ‰èƒ½å¤Ÿä½œåˆ°çš„äº‹, è§¦çŠ¯åˆ°ç¥çš„é¢†åŸŸä¾¿ä¼šå¸¦æ¥éš¾ä»¥æƒ³è±¡çš„åæœã€‚è¿™æ˜¯äººç±»æŒ‘æˆ˜ç¦å¿Œçš„æœ€åˆäº§ç‰©, æ˜¯ä»¿ç”Ÿç§‘æŠ€çš„ç»“æ™¶ã€‚`],\n\n    [\"ç¬¬äºŒä»£äººé€ äººç±»\", 14000, \"è¡€ç»Ÿ\", {C:1}, `\n        å±æ€§: åŠ›é‡+2, æ•æ·+2, æ„ŸçŸ¥+2, è€åŠ›+2\n        èƒ½é‡æ± : ç”µåŠ›(40)\n    `, `\n    - æå‡ç‰¹æ€§-é’¢é“èº«èº¯: è‚‰ææ”»å‡»èƒ½å¤Ÿé€ æˆä¸¥é‡ä¼¤å®³ã€‚\n    - å®Œç¾äººæœºæ”¹é€ : äººé€ äººçš„èº«ä½“æœ¬èº«å°±ç”±æœºæ¢°å’Œè‚‰ä½“æ„æˆ, èƒ½å¤Ÿå’ŒCçº§ç§‘æŠ€æœ¬è´¨çš„æ‰€æœ‰æ”¹é€ å®Œç¾å¥‘åˆã€‚\n    åœ¨åˆä»£çš„åŸºç¡€ä¸Š, æ–°ä¸€ä»£çš„äººé€ äººè¢«èµ‹äºˆäº†æ›´å¼ºå¤§çš„æˆ˜æ–—èƒ½åŠ›å’Œé€‚åº”æ€§, æœºæ¢°ä¸è‚‰ä½“çš„ç»“åˆæ›´åŠ ç´§å¯†ã€‚`],\n\n    [\"ç¬¬ä¸‰ä»£äººé€ äººç±»\", 20000, \"è¡€ç»Ÿ\", {B:1}, `\n        å±æ€§: åŠ›é‡+3, æ•æ·+3, æ„ŸçŸ¥+2, è€åŠ›+3\n        èƒ½é‡æ± : ç”µåŠ›(50)\n    `, `\n    - å®‡å®™ç”Ÿå­˜: äººé€ äººå¯ä»¥åœ¨å®‡å®™ç”Ÿå­˜ã€‚\n    - å®Œç¾äººæœºæ”¹é€ : äººé€ äººçš„èº«ä½“æœ¬èº«å°±ç”±æœºæ¢°å’Œè‚‰ä½“æ„æˆ, èƒ½å¤Ÿå’ŒBçº§ç§‘æŠ€æœ¬è´¨çš„æ‰€æœ‰æ”¹é€ å®Œç¾å¥‘åˆ, Bçº§ç§‘æŠ€æœ¬è´¨æ”¹é€ æ‰€æä¾›çš„å†…åœ¨åŠ å€¼å¯ä»¥å’Œè¡€ç»Ÿæä¾›çš„å†…åœ¨åŠ å€¼å åŠ è€Œéå–é«˜, å¹¶ä¸”è¯¥å±æ€§åŠ å€¼å¯ä»¥å åŠ åœ¨ä¹‰ä½“ä¸Šã€‚\n    æŠ€æœ¯çš„é£è·ƒçªç ´äº†èƒ½æºçš„æ¡æ¢, ç”šè‡³æ‰“ç ´äº†æ˜Ÿçƒçš„æŸç¼šï¼Œæˆä¸ºäº†ä¸€ä¸ªè¿‘ä¹æ°¸æ’çš„ç”Ÿå‘½ä½“ã€‚`],\n\n    [\"è¶…çº§äººé€ äººç±»\", 32000, \"è¡€ç»Ÿ\", {A:1}, `\n        å±æ€§: åŠ›é‡+4, æ•æ·+4, æ„ŸçŸ¥+4, è€åŠ›+4\n        èƒ½é‡æ± : ç”µåŠ›(60)\n    `, `\n    - å®‡å®™ç”Ÿå­˜: äººé€ äººå¯ä»¥åœ¨å®‡å®™ç”Ÿå­˜ã€‚\n    - å®Œç¾äººæœºæ”¹é€ : äººé€ äººçš„èº«ä½“æœ¬èº«å°±ç”±æœºæ¢°å’Œè‚‰ä½“æ„æˆ, èƒ½å¤Ÿå’ŒAçº§å’ŒSçº§ç§‘æŠ€æœ¬è´¨çš„æ‰€æœ‰æ”¹é€ å®Œç¾å¥‘åˆã€‚\n    - èƒ½é‡å¸æ”¶è£…ç½®: å®‰è£…äº†å¸æ”¶èƒ½é‡çš„è£…ç½®, å¯ä»¥å¸æ”¶æ¥è‡ªå¯¹æ‰‹çš„èƒ½é‡è½¬åŒ–ä¸ºè‡ªå·±çš„èƒ½é‡ã€‚\n    è¿™å·²ä¸ä»…ä»…æ˜¯æ¨¡ä»¿ç”Ÿå‘½, è€Œæ˜¯è¶…è¶Šç”Ÿå‘½ã€‚é€šè¿‡å¸æ”¶å¯¹æ‰‹çš„èƒ½é‡, æˆä¸ºäº†ä¸€ä¸ªèƒ½å¤Ÿåœ¨æˆ˜æ–—ä¸­ä¸æ–­å˜å¼ºçš„å­˜åœ¨, æ˜¯ç§‘æŠ€æ‰€èƒ½è¾¾åˆ°çš„å·…å³°é€ ç‰©ä¹‹ä¸€ã€‚`],\n [\"èœ˜è››ä¾ å¼ºåŒ–\", 15000, \"è¡€ç»Ÿ\", {B:1}, `\n        å±æ€§: åŠ›é‡+1, æ•æ·+4, æ„ŸçŸ¥+4, è€åŠ›+2\n        èƒ½é‡æ± : ç”Ÿç‰©èƒ½é‡(50)\n    `, `\n    - èœ˜è››æ•é”: èœ˜è››ä¾ çš„å¹³è¡¡å™¨å®˜å¤§å¹…åº¦å¢å¼ºï¼Œè·å¾—æ•æ„ŸèŒƒå›´å†…çš„é¢¤åŠ¨æ„ŸçŸ¥ã€‚\n    - èœ˜è››è¿åŠ¨: èœ˜è››ä¾ è·å¾—è››è¡Œæœ¯ï¼Œå¦‚èœ˜è››ä¸€èˆ¬åœ¨å‚ç›´è¡¨é¢ä¸Šæ”€çˆ¬ç§»åŠ¨ï¼Œç”šè‡³å¤©èŠ±æ¿ä¸Šä¹Ÿå¯ä»¥ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œèœ˜è››ä¾ å¿…é¡»è…¾å‡ºåŒæ‰‹æ¥çˆ¬è¡Œã€‚\n    - è››ä¸: èœ˜è››ä¾ å¯ä»æ‰‹è…•å¤„å°„å‡ºè››ä¸ã€‚è››ä¸å¯å¦‚æ•ç½‘ä¸€èˆ¬è¿›è¡Œçº ç¼ æ”»å‡»ã€‚\n    æºè‡ªä¸€æ¬¡æ„å¤–çš„åŸºå› çªå˜ï¼Œå°†äººç±»ä¸èœ˜è››çš„ä¼˜ç‚¹å®Œç¾ç»“åˆï¼Œè·å¾—äº†è¶…è¶Šå¸¸äººçš„æ„Ÿå®˜ä¸è¿åŠ¨èƒ½åŠ›ã€‚è¿™ç§åŠ›é‡ä¹Ÿä¼´éšç€å·¨å¤§çš„è´£ä»»ã€‚`],\n       [\"Dä¿¡ä½¿\", 5000, \"è¡€ç»Ÿ\", {D:1}, `\n        å±æ€§: æ•æ·+2, è€åŠ›+2\n        èƒ½é‡æ± : åŠ¨èƒ½(0)\n    `, `\n    - ä¸“æ³¨æŠ¤ç›¾: é€šè¿‡æŒç»­é«˜é€Ÿç§»åŠ¨ï¼Œå¯ä»¥åœ¨ä½“è¡¨å½¢æˆä¸€å±‚ä¸´æ—¶çš„èƒ½é‡æŠ¤ç›¾æ¥æŠµå¾¡æ”»å‡»ã€‚è¿™å±‚æŠ¤ç›¾åœ¨ä¸ä¸»åŠ¨å‘èµ·æ”»å‡»çš„å›åˆä¸­ä¼šä¿æŒç”Ÿæ•ˆï¼Œæä¾›é¢å¤–çš„é˜²æŠ¤ã€‚\n    - ä¿¡ä½¿ä½“è´¨: æ‹¥æœ‰ä¸ä¼—ä¸åŒçš„æˆ˜æ–—æ–¹å¼ï¼Œèƒ½å¤Ÿä»¥è¶…å‡¡çš„æ•æ·å’Œåè°ƒæ€§ä¸»å¯¼è¿‘èº«æ ¼æ–—ï¼ŒåŠ¨ä½œè¿…çŒ›è€Œéå•çº¯ä¾é è›®åŠ›ã€‚\n    - è‡ªç”±å¥”è·‘: æŒæ¡äº†å‡ºç¥å…¥åŒ–çš„è·‘é…·æŠ€å·§ï¼Œèƒ½å¤Ÿåœ¨å¢™å£ã€ç®¡é“ç”šè‡³å¤©èŠ±æ¿ä¸Šè‡ªç”±ç§»åŠ¨ï¼Œä»¿ä½›æ‘†è„±äº†é‡åŠ›çš„æŸç¼šã€‚å…¶è·³è·ƒèƒ½åŠ›ä¹Ÿå¾—åˆ°æå¤§å¢å¼ºï¼Œèƒ½è½»æ¾è¶Šè¿‡å¸¸äººæ— æ³•ä¼åŠçš„éšœç¢ã€‚\n    - ä¿¡ä»°é™å®š: ä¿¡å¥‰ç»å¯¹çš„ã€ä¸å—çº¦æŸçš„è‡ªç”±ï¼Œè¿™ç§ä¿¡å¿µæ˜¯åŠ›é‡çš„æ ¹åŸºï¼Œä½†ä¹Ÿå› æ­¤æ— æ³•æ¥çº³å’Œä½¿ç”¨ä»»ä½•å…¶ä»–å½¢å¼çš„ä¿¡ä»°ç±»èƒ½åŠ›ã€‚\n    å—åˆ°è‡ªç”±ç²¾ç¥çš„æ„Ÿå¬ï¼Œæˆä¸ºäº†ä¸€ååˆå‡ºèŒ…åºçš„ä¿¡ä½¿ã€‚è™½ç„¶ç»éªŒå°šæµ…ï¼Œä½†å·²æŒæ¡äº†åœ¨éƒ½å¸‚ä¸›æ—ä¸­ç©¿æ¢­çš„æ ¸å¿ƒæŠ€å·§ã€‚`],\n\n    [\"Cä¿¡ä½¿\", 8000, \"è¡€ç»Ÿ\", {C:1}, `\n        å±æ€§: æ•æ·+3, è€åŠ›+3\n        èƒ½é‡æ± : åŠ¨èƒ½(0)\n    `, `\n    - ä¸“æ³¨æŠ¤ç›¾+: ä¸“æ³¨æŠ¤ç›¾çš„æ•ˆæœå¾—åˆ°å¼ºåŒ–ã€‚åœ¨é«˜é€Ÿç§»åŠ¨ä¸­ï¼Œæ•Œäººæéš¾é”å®šå…¶ä½ç½®ï¼Œæ— è®ºæ˜¯å®ä½“æ”»å‡»è¿˜æ˜¯è¿œç¨‹å°„å‡»éƒ½å®¹æ˜“è¢«åè½¬æˆ–æ“¦èº«è€Œè¿‡ã€‚åŒæ—¶ï¼Œæ›´æ“…é•¿åœ¨ç§»åŠ¨ä¸­è¿›è¡Œæ ¼æŒ¡æ‹›æ¶ã€‚\n    - ç©¿è¶Šæ”»å‡»: å­¦ä¼šäº†å¦‚ä½•å°†å†²åˆºçš„å·¨å¤§åŠ¨èƒ½ç¬é—´è½¬åŒ–ä¸ºå¼ºå¤§çš„æ”»å‡»åŠ›ã€‚åœ¨å…¨åŠ›å¥”è·‘åå‘åŠ¨çš„æ”»å‡»æå…·å†²å‡»åŠ›ï¼Œä½†ä»£ä»·æ˜¯æ”»å‡»çš„ç¬é—´ï¼Œè‡ªèº«çš„é˜²å¾¡ä¼šå˜å¾—ç›¸å¯¹è„†å¼±ã€‚\n    - ä¿¡ä½¿ä½“è´¨: èƒ½å¤Ÿä»¥è¶…å‡¡çš„æ•æ·å’Œåè°ƒæ€§ä¸»å¯¼è¿‘èº«æ ¼æ–—ï¼ŒåŠ¨ä½œè¿…çŒ›è€Œéå•çº¯ä¾é è›®åŠ›ã€‚\n    - è‡ªç”±å¥”è·‘: æŒæ¡äº†å‡ºç¥å…¥åŒ–çš„è·‘é…·æŠ€å·§ï¼Œèƒ½å¤Ÿåœ¨å¢™å£ã€ç®¡é“ç”šè‡³å¤©èŠ±æ¿ä¸Šè‡ªç”±ç§»åŠ¨ï¼Œä»¿ä½›æ‘†è„±äº†é‡åŠ›çš„æŸç¼šã€‚å…¶è·³è·ƒèƒ½åŠ›ä¹Ÿå¾—åˆ°æå¤§å¢å¼ºï¼Œèƒ½è½»æ¾è¶Šè¿‡å¸¸äººæ— æ³•ä¼åŠçš„éšœç¢ã€‚\n    - ä¿¡ä»°é™å®š: ä¿¡å¥‰ç»å¯¹çš„ã€ä¸å—çº¦æŸçš„è‡ªç”±ï¼Œè¿™ç§ä¿¡å¿µæ˜¯åŠ›é‡çš„æ ¹åŸºï¼Œä½†ä¹Ÿå› æ­¤æ— æ³•æ¥çº³å’Œä½¿ç”¨ä»»ä½•å…¶ä»–å½¢å¼çš„ä¿¡ä»°ç±»èƒ½åŠ›ã€‚\n    å·²ç»æ˜¯ä¸€ååˆæ ¼çš„ä¿¡ä½¿ï¼Œç§˜å¯†è¿è¾“ä»»åŠ¡çš„å¸¸å®¢ã€‚è·‘é…·æŠ€å·§æ›´åŠ å¨´ç†Ÿï¼Œæˆ˜æ–—æ–¹å¼ä¹Ÿå˜å¾—æ›´åŠ è‡´å‘½å’Œé«˜æ•ˆã€‚`],\n\n    [\"Bä¿¡ä½¿\", 12000, \"è¡€ç»Ÿ\", {B:1}, `\n        å±æ€§: æ•æ·+4, è€åŠ›+4\n        èƒ½é‡æ± : åŠ¨èƒ½(0)\n    `, `\n    - ä¸“æ³¨æŠ¤ç›¾++: ä¸“æ³¨åŠ›è¾¾åˆ°å·…å³°ï¼Œåœ¨ç§»åŠ¨æ—¶ï¼Œå‘¨å›´çš„ä¸–ç•Œåœ¨å…¶æ„ŸçŸ¥ä¸­ä¼šå˜å¾—ç¼“æ…¢ã€‚ç°åœ¨ï¼Œä»»ä½•ç§»åŠ¨éƒ½èƒ½æ¿€æ´»å¼ºå¤§çš„ä¸“æ³¨æŠ¤ç›¾ï¼Œå¹¶ä¸”å¯ä»¥åœ¨æŠ¤ç›¾çš„ä¿æŠ¤ä¸‹æ¯«æ— é¡¾å¿Œåœ°è¿›è¡Œæ”»å‡»ã€‚\n    - å¼ºåŠ›ç©¿è¶Šæ”»å‡»: ç©¿è¶Šæ”»å‡»çš„æŠ€å·§å·²è‡»åŒ–å¢ƒï¼Œå‘åŠ¨å†²åˆºæ”»å‡»æ—¶ä¸å†ä¼šæš´éœ²é˜²å¾¡ä¸Šçš„å¼±ç‚¹ï¼Œå¯ä»¥æ¯«æ— é¡¾å¿Œåœ°å°†é€Ÿåº¦å®Œå…¨è½¬åŒ–ä¸ºç ´ååŠ›ã€‚\n    - ä¿¡ä½¿ä½“è´¨ï¼ˆæå‡ï¼‰: èº«ä½“çš„åè°ƒæ€§ä¸ååº”èƒ½åŠ›è¾¾åˆ°æ–°é«˜åº¦ï¼Œé˜²å¾¡èƒ½åŠ›ä¸å†ä¾èµ–ä¼ ç»ŸæŠ¤å…·ï¼Œè€Œæ˜¯å®Œå…¨å–å†³äºè‡ªèº«çš„æ•æ·æˆ–æ„ŸçŸ¥ã€‚è¿‘èº«æ ¼æ–—æ—¶ï¼ŒåŠ›é‡çš„é™åˆ¶è¢«å½»åº•æ‰“ç ´ï¼Œå¯ä»¥æ·‹æ¼“å°½è‡´åœ°å‘æŒ¥æ•æ·çš„ä¼˜åŠ¿ã€‚\n    - è‡ªç”±å¥”è·‘: æŒæ¡äº†å‡ºç¥å…¥åŒ–çš„è·‘é…·æŠ€å·§ï¼Œèƒ½å¤Ÿåœ¨å¢™å£ã€ç®¡é“ç”šè‡³å¤©èŠ±æ¿ä¸Šè‡ªç”±ç§»åŠ¨ï¼Œä»¿ä½›æ‘†è„±äº†é‡åŠ›çš„æŸç¼šã€‚å…¶è·³è·ƒèƒ½åŠ›ä¹Ÿå¾—åˆ°æå¤§å¢å¼ºï¼Œèƒ½è½»æ¾è¶Šè¿‡å¸¸äººæ— æ³•ä¼åŠçš„éšœç¢ã€‚\n    - ä¿¡ä»°é™å®š: ä¿¡å¥‰ç»å¯¹çš„ã€ä¸å—çº¦æŸçš„è‡ªç”±ï¼Œè¿™ç§ä¿¡å¿µæ˜¯åŠ›é‡çš„æ ¹åŸºï¼Œä½†ä¹Ÿå› æ­¤æ— æ³•æ¥çº³å’Œä½¿ç”¨ä»»ä½•å…¶ä»–å½¢å¼çš„ä¿¡ä»°ç±»èƒ½åŠ›ã€‚\n    èº«ä¸ºç»„ç»‡å†…çš„ç²¾è‹±ä¿¡ä½¿ï¼Œè¡ŒåŠ¨èƒ½åŠ›å·²è¾¾åŒ–å¢ƒã€‚å…¶èº«ä½“çš„ååº”é€Ÿåº¦æœ¬èº«å°±æ˜¯æœ€å¥½çš„é˜²å¾¡ï¼Œæ˜¯å„å¤§ç»„ç»‡æ‰§è¡Œé«˜éš¾åº¦ä»»åŠ¡æ—¶çš„ç¬¬ä¸€äººé€‰ã€‚`],\n\n    [\"Aä¿¡ä½¿\", 18000, \"è¡€ç»Ÿ\", {A:1}, `\n        å±æ€§: æ•æ·+6, è€åŠ›+6\n        èƒ½é‡æ± : åŠ¨èƒ½(0)\n    `, `\n    - ä¿¡ä½¿ä½“è´¨ï¼ˆç©¶æï¼‰: èº«ä½“ç´ è´¨è¾¾åˆ°äººç±»æ½œèƒ½çš„æé™ï¼Œè€åŠ›ä¸æ•æ·ç›¸è¾…ç›¸æˆï¼Œä½¿å¾—æ•æ·å±æ€§è·å¾—äº†æ ¹æœ¬æ€§çš„å¼ºåŒ–ï¼Œè‚‰ææ”»å‡»çš„å¨åŠ›ä¹Ÿéšä¹‹å¤§å¹…æå‡ã€‚ä¸“æ³¨æŠ¤ç›¾å·²æˆä¸ºä¸€ç§å¸¸é©»çŠ¶æ€ï¼Œåªè¦å¤„äºç§»åŠ¨ä¹‹ä¸­ï¼Œæœ€é¡¶çº§çš„é˜²æŠ¤æŠ¤ç›¾å°±ä¼šæŒç»­ç”Ÿæ•ˆã€‚\n    - å¼ºåŠ›ç©¿è¶Šæ”»å‡»: ç©¿è¶Šæ”»å‡»çš„æŠ€å·§å·²è‡»åŒ–å¢ƒï¼Œå‘åŠ¨å†²åˆºæ”»å‡»æ—¶ä¸å†ä¼šæš´éœ²é˜²å¾¡ä¸Šçš„å¼±ç‚¹ï¼Œå¯ä»¥æ¯«æ— é¡¾å¿Œåœ°å°†é€Ÿåº¦å®Œå…¨è½¬åŒ–ä¸ºç ´ååŠ›ã€‚\n    - è‡ªç”±å¥”è·‘: æŒæ¡äº†å‡ºç¥å…¥åŒ–çš„è·‘é…·æŠ€å·§ï¼Œèƒ½å¤Ÿåœ¨å¢™å£ã€ç®¡é“ç”šè‡³å¤©èŠ±æ¿ä¸Šè‡ªç”±ç§»åŠ¨ï¼Œä»¿ä½›æ‘†è„±äº†é‡åŠ›çš„æŸç¼šã€‚å…¶è·³è·ƒèƒ½åŠ›ä¹Ÿå¾—åˆ°æå¤§å¢å¼ºï¼Œèƒ½è½»æ¾è¶Šè¿‡å¸¸äººæ— æ³•ä¼åŠçš„éšœç¢ã€‚\n    - ä¿¡ä»°é™å®š: ä¿¡å¥‰ç»å¯¹çš„ã€ä¸å—çº¦æŸçš„è‡ªç”±ï¼Œè¿™ç§ä¿¡å¿µæ˜¯åŠ›é‡çš„æ ¹åŸºï¼Œä½†ä¹Ÿå› æ­¤æ— æ³•æ¥çº³å’Œä½¿ç”¨ä»»ä½•å…¶ä»–å½¢å¼çš„ä¿¡ä»°ç±»èƒ½åŠ›ã€‚\n    å·²æ˜¯ä¿¡ä½¿ä¸­çš„ä¼ å¥‡ä¸ç‹ç‰Œï¼Œæ˜¯è‡ªç”±ç²¾ç¥çš„åŒ–èº«ã€‚å…¶å­˜åœ¨æœ¬èº«å°±æ„å‘³ç€ä»»åŠ¡çš„ç»å¯¹æˆåŠŸï¼Œæ˜¯æœ€å¼ºå¤§çš„è¿½æ•è€…ä¹Ÿæ— æ³•è§¦åŠçš„å¹»å½±ã€‚`],\n\n    [\"Då¤©ç„¶é“å£«\", 6000, \"è¡€ç»Ÿ\", {D:1}, `\n        å±æ€§: åŠ›é‡+1, æ•æ·+1, è€åŠ›+1, æ„ŸçŸ¥+1, å†³å¿ƒ+2\n        èƒ½é‡æ± : çµåŠ›(40)\n    `, `\n    - ä»™é£é“éª¨: å¤©ç”Ÿæ‹¥æœ‰ä»™äººéª¨ï¼Œè™½æœªæ›¾ä¿®ç‚¼é“æ³•ï¼Œä½†è‚‰ä½“å‡¡èƒå·²è¢«ä»™æ°”æ½œç§»é»˜åŒ–åœ°æ»‹å…»ã€‚æ‹¥æœ‰è¶…ä¹å¸¸äººçš„åšéŸ§ä½“è´¨ï¼Œæéš¾è¢«è½»æ˜“å‡»å€’ã€‚å…¶ç§»åŠ¨é€Ÿåº¦å’Œèº«ä½“çš„å¤©ç„¶é˜²å¾¡èƒ½åŠ›ï¼Œä¼šéšç€è‡ªèº«çš„æˆé•¿è€ŒåŒæ­¥å¢å¼ºã€‚`],\n\n    [\"Cå¤©ç„¶é“å£«\", 14000, \"è¡€ç»Ÿ\", {C:1}, `\n        å±æ€§: æ•æ·+1, è€åŠ›+1, æ„ŸçŸ¥+3, å†³å¿ƒ+3\n        èƒ½é‡æ± : çµåŠ›(50)\n    `, `\n    - ä»™é£é“éª¨ï¼ˆæå‡ï¼‰: ä»™æ°”è¿›ä¸€æ­¥å¼ºåŒ–è‚‰ä½“ï¼Œèµ‹äºˆäº†å¿«é€Ÿè‡ªæ„ˆçš„ä½“è´¨ï¼Œå¹¶ä¸”æ‰€æœ‰è‡ªç„¶æ¢å¤çš„é€Ÿåº¦éƒ½å¾—åˆ°åŠ å€ã€‚å¯¹å‡¡ä¿—çš„éœ€æ±‚å¤§å¹…é™ä½ï¼Œä¸å†éœ€è¦é£Ÿç‰©ã€æ°´æˆ–ç©ºæ°”ï¼Œåªéœ€æ¯æ—¥çŸ­æš‚çš„ç¡çœ ï¼Œä¾¿å¯ä»å¤©åœ°è‡ªç„¶é—´æ±²å–æ‰€éœ€èƒ½é‡ä»¥ç»´æŒç”Ÿå‘½æ´»åŠ¨ã€‚ä½“è´¨åšéŸ§ï¼Œç§»åŠ¨å’Œé˜²å¾¡èƒ½åŠ›éšæˆé•¿è€Œå¢å¼ºã€‚`],\n\n    [\"Bå¤©ç„¶é“å£«\", 22000, \"è¡€ç»Ÿ\", {B:1}, `\n        å±æ€§: åŠ›é‡+1, æ•æ·+1, è€åŠ›+1, æ„ŸçŸ¥+4, å†³å¿ƒ+4\n        èƒ½é‡æ± : çµåŠ›(60)\n    `, `\n    - ä»™é£é“éª¨ï¼ˆæå‡ï¼‰: å¿«é€Ÿè‡ªæ„ˆèƒ½åŠ›å¾—åˆ°æ˜¾è‘—å¢å¼ºã€‚é€Ÿåº¦å¿«åˆ°æè‡´ï¼Œèƒ½å¤Ÿåœ¨å¹³ç¨³çš„æ¶²ä½“è¡¨é¢ä¸Šå¥”è·‘è€Œä¸ä¸‹æ²‰ã€‚æ‹¥æœ‰åšéŸ§çš„ä½“è´¨å’Œéšæˆé•¿æå‡çš„ç§»åŠ¨ä¸é˜²å¾¡èƒ½åŠ›ï¼Œä¸”åªéœ€ç¡çœ å³å¯ç»´ç”Ÿã€‚\n    - èµ¤è¯šä¹‹å¿ƒ: ä»™æ°”ä¸ä»…æ·¬ç‚¼è‚‰ä½“ï¼Œæ›´æ´—æ¶¤ç²¾ç¥ã€‚å…¶å¿ƒçµå˜å¾—çº¯å‡€è€Œåšå›ºï¼Œèƒ½è‡ªç„¶å…ç–«ç»å¤§å¤šæ•°è¯•å›¾æ“æ§ç²¾ç¥çš„è´Ÿé¢å½±å“ä¸å¹»æœ¯æ•ˆæœã€‚`],\n\n    [\"Aå¤©ç„¶é“å£«\", 35000, \"è¡€ç»Ÿ\", {A:1}, `\n        å±æ€§: æ•æ·+1, è€åŠ›+1, æ„ŸçŸ¥+5, å†³å¿ƒ+5\n        èƒ½é‡æ± : çµåŠ›(75)\n    `, `\n    - ä»™é£é“éª¨ï¼ˆèœ•å‡¡ï¼‰: è‚‰ä½“å‡¡èƒå·²å½»åº•èœ•å˜ï¼Œä»æ­¤é•¿ç”Ÿä¸è€ï¼Œå…ç–«ä¸–é—´ä¸€åˆ‡ç–¾ç—…ã€æ¯’ç´ ä¸ç”Ÿç†ä¸Šçš„è¡°è€ã€‚èº«ä½“æ‹¥æœ‰å¼ºå¤§çš„æ™®é€‚æ€§ä¼¤å®³å‡å…èƒ½åŠ›å’Œå“è¶Šçš„å¿«é€Ÿè‡ªæ„ˆèƒ½åŠ›ã€‚\n    - ä»™æ°”åŒ»ç–—: ä½“å†…æ»¡æº¢çš„ä»™æ°”å¯ä»¥é€šè¿‡è‚¢ä½“æ¥è§¦ï¼Œå°†è‡ªèº«çš„è‡ªæ„ˆèƒ½åŠ›æš‚æ—¶è½¬ç§»ç»™ä»–äººï¼Œæ²»æ„ˆå…¶ä¼¤åŠ¿ã€‚\n    - èµ¤è¯šä¹‹å¿ƒï¼ˆæå‡ï¼‰: çµé­‚å·²ä¸å¤©åœ°è‡ªç„¶åŒè°ƒï¼Œåšå®šçš„æ„å¿—èƒ½æ˜¾è‘—å¢å¼ºå…¶æ‰€æœ‰è¡ŒåŠ¨çš„æˆåŠŸç‡ã€‚åŒæ—¶ä¿ç•™äº†å¯¹å¿ƒçµæ“æ§ä¸å¹»æœ¯çš„å¼ºå¤§æŠ—æ€§ï¼Œå¹¶å¯åœ¨æ°´é¢å¥”è·‘ã€‚`],\n\n    [\"AAå¤©ç„¶é“å£«\", 50000, \"è¡€ç»Ÿ\", {AA:1}, `\n        å±æ€§: åŠ›é‡+1, æ•æ·+2, è€åŠ›+2, æ„ŸçŸ¥+8, å†³å¿ƒ+8\n        èƒ½é‡æ± : å…ƒæ°”(100)\n    `, `\n    - ç»“ä¸¹: å¯ä»¥å°†è‡ªèº«ç²¾çº¯çš„ç”Ÿå‘½å…ƒæ°”å‡ç»“æˆä¸€é¢—é‡‘ä¸¹ã€‚æ­¤ä¸¹è¯æ‹¥æœ‰èµ·æ­»å›ç”Ÿçš„ç¥æ•ˆï¼Œèƒ½å¤Ÿæ²»æ„ˆè‡´å‘½çš„ä¼¤åŠ¿ï¼Œå¹¶å¸®åŠ©æœç”¨è€…æŠµæŠ—è¯…å’’ã€ç–¾ç—…å’Œæ¯’ç´ ã€‚ä½†å‡ç»“é‡‘ä¸¹éœ€è¦æ¶ˆè€—å¤§é‡çš„è‡ªèº«å…ƒæ°”ã€‚\n    - æ³•å¤©è±¡åœ°: èƒ½å¤Ÿå°†è‡ªèº«å…ƒç¥é€¼å‡ºä½“å¤–ï¼ŒåŒ–èº«ä¸ºä¸€ä¸ªç”±çº¯ç²¹èƒ½é‡æ„æˆçš„ã€é¡¶å¤©ç«‹åœ°çš„å…ƒç¥å·¨äººè¿›è¡Œæˆ˜æ–—ï¼Œæ­¤çŠ¶æ€ä¸‹æˆ˜æ–—åŠ›è·å¾—æå¤§å¢å¹…ã€‚\n    - èµ¤è¯šä¹‹å¿ƒï¼ˆåœ†æ»¡ï¼‰: çµé­‚ä¸å¤©åœ°åŒè°ƒï¼Œåšå®šçš„æ„å¿—èƒ½æ˜¾è‘—å¢å¼ºå…¶æ‰€æœ‰è¡ŒåŠ¨çš„æˆåŠŸç‡ã€‚\n    - ä»™é“ä¹‹èº¯: ä½œä¸ºä¸€ä¸ªè¾¾åˆ°å¤©ç„¶é“å£«é¡¶å³°çš„å­˜åœ¨ï¼Œå®Œæ•´ä¿ç•™äº†é•¿ç”Ÿä¸è€ã€ç™¾æ¯’ä¸ä¾µã€ä»™æ°”åŒ»ç–—ã€æ°´ä¸Šè¡Œèµ°ã€å¼ºå¤§è‡ªæ„ˆå’Œä¼¤å®³å‡å…ç­‰æ‰€æœ‰ä½é˜¶èƒ½åŠ›ã€‚`],\n\n    [\"ç‚é»„ä¸–èƒ„\", 7000, \"è¡€ç»Ÿ\", {D:1}, `\n        å±æ€§: åŠ›é‡+1, æ•æ·+1, è€åŠ›+1, æ™ºåŠ›+1, æ„ŸçŸ¥+1, å†³å¿ƒ+1, é£åº¦+1\n        èƒ½é‡æ± : æ°”è¡€(35)\n    `, `\n    - çš†ä¸ºæ±‰åœŸ: ä½œä¸ºç‚é»„åè£”ï¼Œåœ¨å¯¹æŠ—éæˆ‘æ—ç±»ä¹‹æ•Œæ—¶ï¼Œè¡€è„‰ä¸­æ½œè—çš„åŠ›é‡ä¼šè¢«å”¤é†’ï¼Œçˆ†å‘å‡ºæ›´å¼ºçš„æˆ˜æ–—åŠ›ã€‚\n    - å­¦ä¹ å¤©èµ‹: ä¼ æ‰¿è‡ªå…ˆç¥–çš„æ™ºæ…§ä½¿å…¶æ‹¥æœ‰å“è¶Šçš„å­¦ä¹ èƒ½åŠ›ï¼Œèƒ½æ¯”å¸¸äººæ›´å¿«åœ°æŒæ¡æ–°çŸ¥è¯†ä¸æŠ€èƒ½ã€‚\n    - å¿ äºç‚é»„: è¡€è„‰ä¸­é“­åˆ»ç€å¯¹è‡ªèº«æ°‘æ—çš„ç»å¯¹å¿ è¯šã€‚ä»»ä½•å½¢å¼çš„èƒŒå›è¡Œä¸ºéƒ½ä¼šå¯¼è‡´è¡€è„‰åŠ›é‡çš„å½»åº•ä¸§å¤±ã€‚è¿™ä»½å¿ è¯šåœ¨é¢å¯¹ç‰¹å®šçš„å†å²å®¿æ•Œæ—¶ï¼Œä¼šè½¬åŒ–ä¸ºæ›´å¼ºå¤§çš„æˆ˜æ–—æ„å¿—ã€‚`],\n\n    [\"åå¤é—æ°‘-é’é¾™\", 15000, \"è¡€ç»Ÿ\", {C:1}, `\n        å±æ€§: é£åº¦+3, æ²‰ç€+2, è€åŠ›+1\n        èƒ½é‡æ± : é¾™æ°”(45)\n    `, `\n    - å´–å±±æ°”èŠ‚: æ‹¥æœ‰é’¢é“èˆ¬çš„æ„å¿—ï¼Œç²¾ç¥å¦‚åŒåšå£ï¼Œæéš¾è¢«ä»»ä½•å¤–åŠ›åŠ¨æ‘‡æˆ–æ“æ§ã€‚\n    - ç”Ÿå­˜ä½“è´¨: è¡€è„‰ä¸­æµæ·Œç€å¼ºå¤§çš„é€‚åº”åŠ›ï¼Œä½¿å…¶èƒ½å¤©ç„¶å…ç–«ç»å¤§å¤šæ•°å¸¸è§çš„æ¯’ç´ ä¸ç–¾ç—…ã€‚\n    - å››ç¥é™„ä½“: è·å¾—ä¸œæ–¹é’é¾™çš„åº‡ä½‘ï¼Œå¯¹å„ç±»èƒ½é‡å½¢æ€çš„ä¼¤å®³éƒ½æ‹¥æœ‰æ™®éçš„æŠ—æ€§ã€‚\n    - ä¸­åä¼ æ‰¿: è¡€è„‰çš„çº¯ç²¹æ€§æ˜¯åŠ›é‡çš„æ ¹æºï¼Œä»»ä½•ä¼šå¤§å¹…æ”¹å˜èº«ä½“åŸºæœ¬æ„é€ çš„å¤–éƒ¨æ”¹é€ ï¼Œéƒ½ä¼šå‰Šå¼±ç”šè‡³ç ´åè¿™ä»½ä¼ æ‰¿ä¹‹åŠ›ã€‚\n    é€‰æ‹©é’é¾™åˆ†æ”¯ï¼Œç»§æ‰¿äº†ä¸œæ–¹ç”²æœ¨çš„ç¥æ€§ï¼Œå¨ä»ªå¤©ç”Ÿï¼Œæ„å¿—åšå®šã€‚`],\n\n    [\"åå¤é—æ°‘-ç™½è™\", 15000, \"è¡€ç»Ÿ\", {C:1}, `\n        å±æ€§: æ•æ·+3, å†³å¿ƒ+2, æ„ŸçŸ¥+1\n        èƒ½é‡æ± : ç…æ°”(45)\n    `, `\n    - å´–å±±æ°”èŠ‚: æ‹¥æœ‰é’¢é“èˆ¬çš„æ„å¿—ï¼Œç²¾ç¥å¦‚åŒåšå£ï¼Œæéš¾è¢«ä»»ä½•å¤–åŠ›åŠ¨æ‘‡æˆ–æ“æ§ã€‚\n    - ç”Ÿå­˜ä½“è´¨: è¡€è„‰ä¸­æµæ·Œç€å¼ºå¤§çš„é€‚åº”åŠ›ï¼Œä½¿å…¶èƒ½å¤©ç„¶å…ç–«ç»å¤§å¤šæ•°å¸¸è§çš„æ¯’ç´ ä¸ç–¾ç—…ã€‚\n    - å››ç¥é™„ä½“: è·å¾—è¥¿æ–¹ç™½è™çš„åº‡ä½‘ï¼Œå¯¹å„ç±»èƒ½é‡å½¢æ€çš„ä¼¤å®³éƒ½æ‹¥æœ‰æ™®éçš„æŠ—æ€§ã€‚\n    - ä¸­åä¼ æ‰¿: è¡€è„‰çš„çº¯ç²¹æ€§æ˜¯åŠ›é‡çš„æ ¹æºï¼Œä»»ä½•ä¼šå¤§å¹…æ”¹å˜èº«ä½“åŸºæœ¬æ„é€ çš„å¤–éƒ¨æ”¹é€ ï¼Œéƒ½ä¼šå‰Šå¼±ç”šè‡³ç ´åè¿™ä»½ä¼ æ‰¿ä¹‹åŠ›ã€‚\n    é€‰æ‹©ç™½è™åˆ†æ”¯ï¼Œç»§æ‰¿äº†è¥¿æ–¹åºšé‡‘çš„æ€ä¼ä¹‹æ°”ï¼Œè¡ŒåŠ¨æ•é”ï¼Œæ€ä¼æœå†³ã€‚`],\n\n    [\"åå¤é—æ°‘-æœ±é›€\", 15000, \"è¡€ç»Ÿ\", {C:1}, `\n        å±æ€§: æ™ºåŠ›+3, æ„ŸçŸ¥+2, æ•æ·+1\n        èƒ½é‡æ± : çµç«(45)\n    `, `\n    - å´–å±±æ°”èŠ‚: æ‹¥æœ‰é’¢é“èˆ¬çš„æ„å¿—ï¼Œç²¾ç¥å¦‚åŒåšå£ï¼Œæéš¾è¢«ä»»ä½•å¤–åŠ›åŠ¨æ‘‡æˆ–æ“æ§ã€‚\n    - ç”Ÿå­˜ä½“è´¨: è¡€è„‰ä¸­æµæ·Œç€å¼ºå¤§çš„é€‚åº”åŠ›ï¼Œä½¿å…¶èƒ½å¤©ç„¶å…ç–«ç»å¤§å¤šæ•°å¸¸è§çš„æ¯’ç´ ä¸ç–¾ç—…ã€‚\n    - å››ç¥é™„ä½“: è·å¾—å—æ–¹æœ±é›€çš„åº‡ä½‘ï¼Œå¯¹å„ç±»èƒ½é‡å½¢æ€çš„ä¼¤å®³éƒ½æ‹¥æœ‰æ™®éçš„æŠ—æ€§ã€‚\n    - ä¸­åä¼ æ‰¿: è¡€è„‰çš„çº¯ç²¹æ€§æ˜¯åŠ›é‡çš„æ ¹æºï¼Œä»»ä½•ä¼šå¤§å¹…æ”¹å˜èº«ä½“åŸºæœ¬æ„é€ çš„å¤–éƒ¨æ”¹é€ ï¼Œéƒ½ä¼šå‰Šå¼±ç”šè‡³ç ´åè¿™ä»½ä¼ æ‰¿ä¹‹åŠ›ã€‚\n    é€‰æ‹©æœ±é›€åˆ†æ”¯ï¼Œç»§æ‰¿äº†å—æ–¹ä¸™ç«çš„çµæ€§ï¼Œæ™ºæ…§è¶…ç¾¤ï¼Œæ„ŸçŸ¥æ•é”ã€‚`],\n\n    [\"åå¤é—æ°‘-ç„æ­¦\", 15000, \"è¡€ç»Ÿ\", {C:1}, `\n        å±æ€§: è€åŠ›+3, åŠ›é‡+2, æ²‰ç€+1\n        èƒ½é‡æ± : ç„å†¥çœŸæ°´(45)\n    `, `\n    - å´–å±±æ°”èŠ‚: æ‹¥æœ‰é’¢é“èˆ¬çš„æ„å¿—ï¼Œç²¾ç¥å¦‚åŒåšå£ï¼Œæéš¾è¢«ä»»ä½•å¤–åŠ›åŠ¨æ‘‡æˆ–æ“æ§ã€‚\n    - ç”Ÿå­˜ä½“è´¨: è¡€è„‰ä¸­æµæ·Œç€å¼ºå¤§çš„é€‚åº”åŠ›ï¼Œä½¿å…¶èƒ½å¤©ç„¶å…ç–«ç»å¤§å¤šæ•°å¸¸è§çš„æ¯’ç´ ä¸ç–¾ç—…ã€‚\n    - å››ç¥é™„ä½“: è·å¾—åŒ—æ–¹ç„æ­¦çš„åº‡ä½‘ï¼Œå¯¹å„ç±»èƒ½é‡å½¢æ€çš„ä¼¤å®³éƒ½æ‹¥æœ‰æ™®éçš„æŠ—æ€§ã€‚\n    - ä¸­åä¼ æ‰¿: è¡€è„‰çš„çº¯ç²¹æ€§æ˜¯åŠ›é‡çš„æ ¹æºï¼Œä»»ä½•ä¼šå¤§å¹…æ”¹å˜èº«ä½“åŸºæœ¬æ„é€ çš„å¤–éƒ¨æ”¹é€ ï¼Œéƒ½ä¼šå‰Šå¼±ç”šè‡³ç ´åè¿™ä»½ä¼ æ‰¿ä¹‹åŠ›ã€‚\n    é€‰æ‹©ç„æ­¦åˆ†æ”¯ï¼Œç»§æ‰¿äº†åŒ—æ–¹å£¬ç™¸çš„åšéŸ§ï¼Œä½“é­„å¼ºå¥ï¼Œæ²‰ç¨³å¦‚å±±ã€‚`],\n\n    [\"ç‚é»„å­å­™-é’é¾™\", 25000, \"è¡€ç»Ÿ\", {B:1}, `\n        å±æ€§: é£åº¦+4, æ²‰ç€+2, è€åŠ›+2\n        èƒ½é‡æ± : é¾™æ°”(55)\n    `, `\n    - é’é¾™é™ä¸´: é’é¾™è¡€è„‰è¿›ä¸€æ­¥è§‰é†’ï¼Œå¯ä»¥å¼•åŠ¨ä¸œæ–¹è‹é¾™çš„ç¥åŠ›ï¼Œä»¥è‡ªèº«å‡›ç„¶çš„å¨ä»ªé¼“èˆæˆ˜åœºä¸Šæ‰€æœ‰å‹æ–¹å•ä½ï¼Œæ˜¾è‘—æå‡ä»–ä»¬çš„æˆ˜æ–—æ•ˆèƒ½ä¸å£«æ°”ã€‚\n    - ä¼ æ‰¿ä¹‹åŠ›: å®Œæ•´ä¿ç•™äº†é’¢é“èˆ¬çš„æ„å¿—ã€å¯¹å¸¸è§æ¯’ç–¾çš„å…ç–«åŠ›ã€å¯¹èƒ½é‡ä¼¤å®³çš„å¤©ç„¶æŠ—æ€§ï¼Œä»¥åŠä¸èƒ½æ¥å—å¤§å¹…åº¦èº«ä½“æ”¹é€ çš„è¡€è„‰é™åˆ¶ã€‚`],\n\n    [\"ç‚é»„å­å­™-ç™½è™\", 25000, \"è¡€ç»Ÿ\", {B:1}, `\n        å±æ€§: æ•æ·+4, å†³å¿ƒ+2, æ„ŸçŸ¥+2\n        èƒ½é‡æ± : ç…æ°”(55)\n    `, `\n    - ç™½è™æ€ä¼: ç™½è™çš„æ€ä¼æœ¬èƒ½å®Œå…¨èå…¥å·±èº«ï¼Œä½¿å…¶è·å¾—äº†è¶…å‡¡çš„ç§»åŠ¨é€Ÿåº¦å’Œå…ˆæ‰‹ååº”èƒ½åŠ›ã€‚å¯¹æŸç§ç‰¹å®šçš„æˆ˜æ–—æ–¹å¼ï¼ˆå¦‚å¼“ç®­ã€ç™½åˆƒã€è‚‰ææˆ–è¿åŠ¨ï¼‰æ‹¥æœ‰è¶…ç¾¤çš„é¢†æ‚ŸåŠ›ï¼Œå¹¶èƒ½å°†åšå®šçš„æ„å¿—åŠ›è½¬åŒ–ä¸ºçº¯ç²¹çš„ç ´ååŠ›ï¼Œçªç ´æ”»å‡»çš„æé™ã€‚\n    - ä¼ æ‰¿ä¹‹åŠ›: å®Œæ•´ä¿ç•™äº†é’¢é“èˆ¬çš„æ„å¿—ã€å¯¹å¸¸è§æ¯’ç–¾çš„å…ç–«åŠ›ã€å¯¹èƒ½é‡ä¼¤å®³çš„å¤©ç„¶æŠ—æ€§ï¼Œä»¥åŠä¸èƒ½æ¥å—å¤§å¹…åº¦èº«ä½“æ”¹é€ çš„è¡€è„‰é™åˆ¶ã€‚`],\n\n    [\"ç‚é»„å­å­™-æœ±é›€\", 25000, \"è¡€ç»Ÿ\", {B:1}, `\n        å±æ€§: æ™ºåŠ›+4, æ„ŸçŸ¥+2, æ•æ·+2\n        èƒ½é‡æ± : çµç«(55)\n    `, `\n    - æœ±é›€ä¸€æ€’: å—æ˜ç¦»ç«çš„ç¥åŠ›åœ¨ä½“å†…æµè½¬ï¼Œèµ‹äºˆå…¶å¼ºå¤§çš„ç«ç„°å†ç”Ÿèƒ½åŠ›ã€‚ä»»ä½•è¿‘æˆ˜æ”»å‡»è€…éƒ½ä¼šå—åˆ°ç¥ç«çš„è‡ªåŠ¨åå™¬ï¼ŒåŒæ—¶è‡ªèº«çš„æ”»å‡»ä¹Ÿé™„å¸¦ç€æœ±é›€ç¥ç«ï¼Œèƒ½å¯¹æ•Œäººé€ æˆæŒç»­çš„çƒˆç„°ç¼çƒ§ä¼¤å®³ã€‚\n    - ä¼ æ‰¿ä¹‹åŠ›: å®Œæ•´ä¿ç•™äº†é’¢é“èˆ¬çš„æ„å¿—ã€å¯¹å¸¸è§æ¯’ç–¾çš„å…ç–«åŠ›ã€å¯¹èƒ½é‡ä¼¤å®³çš„å¤©ç„¶æŠ—æ€§ï¼Œä»¥åŠä¸èƒ½æ¥å—å¤§å¹…åº¦èº«ä½“æ”¹é€ çš„è¡€è„‰é™åˆ¶ã€‚`],\n\n    [\"ç‚é»„å­å­™-ç„æ­¦\", 25000, \"è¡€ç»Ÿ\", {B:1}, `\n        å±æ€§: è€åŠ›+4, åŠ›é‡+2, æ²‰ç€+2\n        èƒ½é‡æ± : ç„å†¥çœŸæ°´(55)\n    `, `\n    - ç„æ­¦å½“å…³: ç„æ­¦ç¥åŠ›åŒ–ä¸ºåšä¸å¯æ‘§çš„å®ˆæŠ¤ï¼Œå…¶è‚‰ä½“è·å¾—äº†æé«˜çš„å¤©ç”Ÿé˜²å¾¡ä¸ä¼¤å®³å‡å…ï¼Œå¯¹å¸¸è§„çš„æªæ¢°å°„å‡»å’Œèƒ½é‡æ­¦å™¨æ‹¥æœ‰ç‰¹æ®Šçš„æŠ—æ€§ã€‚æ›´èƒ½ä»¥é›†ä¸­çš„æ„å¿—åŠ›ï¼Œåœ¨çŸ­æ—¶é—´å†…è¿›ä¸€æ­¥å¼ºåŒ–ä¼¤å®³å¸æ”¶çš„èƒ½åŠ›ï¼Œåšåˆ°ä¸‡å¤«è«å¼€ã€‚\n    - ä¼ æ‰¿ä¹‹åŠ›: å®Œæ•´ä¿ç•™äº†é’¢é“èˆ¬çš„æ„å¿—ã€å¯¹å¸¸è§æ¯’ç–¾çš„å…ç–«åŠ›ã€å¯¹èƒ½é‡ä¼¤å®³çš„å¤©ç„¶æŠ—æ€§ï¼Œä»¥åŠä¸èƒ½æ¥å—å¤§å¹…åº¦èº«ä½“æ”¹é€ çš„è¡€è„‰é™åˆ¶ã€‚`],\n\n   [\"Dçº§é»„è¡£ä¹‹ç‹è¡€ç»Ÿï¼šæˆå‰§å®¶\", 8000, \"è¡€ç»Ÿ\", {\"D\":1}, `\n        å±æ€§: æ™ºåŠ›+2, è€åŠ›+2, æ•æ·+2, æ„ŸçŸ¥+1, é¢å¤–å±æ€§+3\n        èƒ½é‡æ± : æˆå‰§ä¹‹åŠ›(40)\n    `, `\n    - ä¿¡ä»°å¯¼å‘: ä½œä¸ºå“ˆæ–¯å¡”çš„ä½¿è€…ï¼Œä»–çš„çµé­‚ä¸ä¿¡ä»°å·²ç»ç»‘å®šã€‚ä»–å°†æ— æ³•å†è¿½å¯»æˆ–ä¾å¥‰é™¤å…‹è‹é²ç¥è¯ä½“ç³»ä¹‹å¤–çš„ä»»ä½•å­˜åœ¨ï¼Œä»»ä½•è¿‡å¾€çš„ä¿¡ä»°è”ç³»éƒ½ä¼šè¢«ç«‹åˆ»åˆ‡æ–­ã€‚\n    - è¿·æƒ‘äººå¿ƒçš„æˆæ›²: ä»–æ˜¯ä¸€ä½èªæ…§ç»ä¼¦çš„è‰ºæœ¯å®¶ï¼Œæ·±è°™å¦‚ä½•ä»¥ä¼˜é›…çš„å§¿æ€å¼•å¯¼æ­»äº¡ã€‚ä»–çš„æ™ºæ…§èƒ½å®Œå…¨è½¬åŒ–ä¸ºè¿‘æˆ˜ä¸­çš„åŠ›é‡ï¼Œèƒ½å¤Ÿé€‰æ‹©ä¸€ç§è¡¨è¾¾è‡ªæˆ‘çš„è‰ºæœ¯å½¢å¼ï¼ˆå¦‚èˆè¹ˆã€æ­Œå”±ã€æ¼”å¥ï¼‰ï¼Œå¹¶ä»¥æ­¤ä½œä¸ºæˆ˜æ–—çš„åª’ä»‹ï¼Œå…¶æŠ€è‰ºä¹‹ç²¾æ¹›ï¼Œè¶³ä»¥æ›¿ä»£å¸¸è§„çš„ç™½åˆƒæˆ–è‚‰ææŠ€å·§ã€‚\n    - æ°¸æ’çš„é»„è¡£: ä»–çš„èº«èº¯æ°¸è¿œè¢«ä¸€ä»¶æ— æ³•æŸæ¯ã€æ— æ³•è„±ä¸‹çš„é»„è¡£æ‰€åŒ…è£¹ã€‚è¿™ä»¶é»„è¡£æ˜¯ä»–èº«ä»½çš„è±¡å¾ï¼Œèƒ½ä¿æŠ¤ä»–ä¸å› é‡ä¼¤è€Œæ˜è¿·ï¼Œä½†ä¹Ÿå› æ­¤æ•£å‘å‡ºä¸€ç§è¶…å‡¡è„±ä¿—è€Œåˆä»¤äººä¸å®‰çš„æ°”è´¨ï¼Œä½¿ä»–åœ¨ä¸äººäº¤å¾€æ—¶äº§ç”Ÿéš”é˜‚ã€‚è¿™å±‚è¡£ç‰©è™½ç„¶åšéŸ§ï¼Œä½†å¯¹ç“¦è§£é­”æ³•çš„åŠ›é‡å´æ— èƒ½ä¸ºåŠ›ã€‚è¿™èº«è£…æŸæ˜¯å…¶å­˜åœ¨çš„ä¸€éƒ¨åˆ†ï¼Œè±¡å¾ç€ä»–ä¸å‡¡ä¿—ä¸–ç•Œçš„ç–ç¦»ã€‚\n     `],\n\n    [\"Cçº§é»„è¡£ä¹‹ç‹è¡€ç»Ÿï¼šæ¸©å’Œå¼€åœº\", 15000, \"è¡€ç»Ÿ\", {\"C\":1}, `\n        å±æ€§: æ™ºåŠ›+3, è€åŠ›+3\n        èƒ½é‡æ± : æˆå‰§ä¹‹åŠ›(50)\n    `, `\n    - æå‡ç‰¹æ€§-è¿·æƒ‘äººå¿ƒçš„æˆæ›²: ä»–çš„èˆå§¿ä¸æˆæ›²å˜å¾—æ›´åŠ ç»šä¸½å¤ºç›®ï¼Œå……æ»¡äº†ä»¤äººæ— æ³•æŠ—æ‹’çš„é­…åŠ›ã€‚ä»–ä»¥è‰ºæœ¯å‘åŠ¨çš„æ”»å‡»ï¼Œä¸ä»…èƒ½åˆ›ä¼¤æ•Œäººçš„è‚‰ä½“ï¼Œå…¶è•´å«çš„è¿·æƒ‘åŠ›é‡è¿˜èƒ½ç›´æ¥å†²å‡»å¹¶æŸç¼šç›®æ ‡çš„ç²¾ç¥ã€‚å…¶è‰ºæœ¯è¡¨è¾¾çš„ç ´ååŠ›ï¼Œå·²èƒ½ä¸æœ€ç²¾çº¯çš„æˆ˜æ–—æŠ€å·§ç›¸åª²ç¾ã€‚\n    - è™šå‡çš„é¢å…·: ä»–çš„è„¸ä¸Šè‡ªåŠ¨å‡ºç°ä¸€ä¸ªä¸å¯æ‘˜é™¤çš„ç™½è‰²é¢å…·ï¼Œæ¬¾å¼å¯éšå¿ƒæ„å˜å¹»ã€‚è¿™é¢å…·èµ‹äºˆä»–æ´å¯Ÿéå‡¡äº‹ç‰©çš„èƒ½åŠ›ï¼Œèƒ½å¤Ÿæ„ŸçŸ¥åˆ°å‘¨å›´ç¯å¢ƒä¸­éšè—çš„è¡€ç»Ÿï¼Œå¹¶ä¸ºä»–æä¾›æŠµå¾¡ç¥å…µåˆ©å™¨çš„å¼ºå¤§é˜²æŠ¤ã€‚è‹¥ä»–åŸæœ¬ä½©æˆ´ç€å…¶ä»–å¤´ç›”ï¼Œè¿™ä¸ªé¢å…·å°†ä¼šå–è€Œä»£ä¹‹ï¼Œæ—§ç‰©è‹¥æ— æ³•å–ä¸‹åˆ™ä¼šè¢«ç›´æ¥æ‘§æ¯ã€‚\n     `],\n\n    [\"Bçº§é»„è¡£ä¹‹ç‹è¡€ç»Ÿï¼šææ€–å‡é¢\", 22000, \"è¡€ç»Ÿ\", {\"B\":1}, `\n        å±æ€§: æ™ºåŠ›+4, è€åŠ›+4, æ•æ·+3, é¢å¤–å±æ€§+3\n        èƒ½é‡æ± : ç‹‚ä¹±çµæ„Ÿ(65)\n    `, `\n    - æå‡ç‰¹æ€§-è¿·æƒ‘äººå¿ƒçš„æˆæ›²: ä»–çš„æ™ºæ…§å·²ç»å®Œå…¨èå…¥åˆ°äº†æ¯ä¸€æ¬¡æ”»å‡»ä¹‹ä¸­ï¼Œä¸å†éœ€è¦ä»»ä½•è½¬æ¢ï¼Œä»–çš„æ€æƒ³å³æ˜¯æ­¦å™¨ï¼Œæ™ºæ…§æœ¬èº«å°±å®šä¹‰äº†ä»–æ”»å‡»çš„æé™ã€‚\n    - å€¾åŸçš„å‡é¢: å½“æ¸©é¦¨çš„æˆå‰§è½å¹•ï¼Œæ‰€æœ‰äººéƒ½å°†ç›®å…‰æŠ•å‘èº«ç€é»„è¡£çš„ä»–ã€‚æ­¤åˆ»ï¼Œä»–å¯ä»¥é€‰æ‹©æ‘˜ä¸‹é¢å…·ï¼Œå°†é‚£ä¸å¯åçŠ¶çš„çœŸå®å®¹è²Œå±•éœ²ç»™ä¸–äººï¼Œå¸¦æ¥æè‡´çš„ææ€–ã€‚ä»–çš„é¢å…·ä¸é»„è¡£çš„åŠ›é‡éƒ½å¾—åˆ°äº†æœ¬è´¨çš„æå‡ï¼Œæˆä¸ºäº†ä»–èº«ä»½æ›´æ·±å±‚æ¬¡çš„å»¶ä¼¸ï¼Œå…¶é˜²æŠ¤ä¸æ´å¯Ÿèƒ½åŠ›å‡è·å¾—é£è·ƒã€‚\n   `],\n       [\"Dçº§èµ›äºšäººè¡€ç»Ÿ\", 8000, \"è¡€ç»Ÿ\", {D:1}, `\n        å±æ€§: åŠ›é‡+2, æ•æ·+2, è€åŠ›+2, æ„ŸçŸ¥+1\n        èƒ½é‡æ± : æ°”(40)\n    `, `\n    - æˆ˜æ–—æ°‘æ—: èµ›äºšäººæ˜¯å¤©ç”Ÿçš„æˆ˜æ–—ç§æ—ï¼Œæ‹¥æœ‰è¿œè¶…å¸¸äººçš„åšéŸ§è‚‰ä½“ï¼Œèƒ½å¤ŸæŠµå¾¡å¸¸è§„çš„ç‰©ç†æ‰“å‡»ï¼Œç”šè‡³å¯¹å­å¼¹ç­‰é«˜é€Ÿå°„å¼¹æœ‰å¤©ç„¶çš„æŠ—æ€§ã€‚\n    - å¼±ç‚¹å°¾å·´: èµ›äºšäººç”Ÿæ¥å°±æœ‰ä¸€æ¡å°¾å·´ï¼Œè¿™æ—¢æ˜¯åŠ›é‡çš„è±¡å¾ï¼Œä¹Ÿæ˜¯ä¸ç”Ÿä¿±æ¥çš„å¼±ç‚¹ã€‚è‹¥å°¾å·´è¢«ç´§ç´§æŠ“ä½ï¼Œèµ›äºšäººä¼šè¿…é€Ÿæ„Ÿåˆ°è„±åŠ›ä¸è™šå¼±ã€‚åˆ‡æ–­å°¾å·´å¯ä»¥æš‚æ—¶æ¶ˆé™¤æ­¤å¼±ç‚¹ï¼Œä½†ä¹Ÿæ„å‘³ç€å¤±å»äº†åŒ–èº«ä¸ºå·¨çŒ¿çš„å¯èƒ½ï¼Œä¸è¿‡å°¾å·´ç»ˆå°†åœ¨æœˆåœ†ä¹‹å¤œé‡æ–°é•¿å‡ºã€‚`],\n\n    [\"Cçº§èµ›äºšäººæˆ˜å£«è¡€ç»Ÿ\", 6000, \"è¡€ç»Ÿ\", {C:1}, `\n        å±æ€§: åŠ›é‡+3, è€åŠ›+3\n        èƒ½é‡æ± : æ°”(50)\n    `, `\n    - æå‡ç‰¹æ€§-æˆ˜æ–—æ°‘æ—: ä½œä¸ºèµ›äºšäººä¸­çš„æˆ˜å£«ï¼Œä½ çš„æˆ˜æ–—ç›´è§‰å’Œååº”é€Ÿåº¦å¾—åˆ°è¿›ä¸€æ­¥å¼ºåŒ–ï¼Œä½¿ä½ èƒ½åœ¨é«˜é€Ÿå¯¹å†³ä¸­æ›´å¥½åœ°æ•æ‰å¯¹æ‰‹çš„åŠ¨å‘ã€‚\n    - å·¨çŒ¿å˜åŒ–: å½“èµ›äºšäººçœ‹åˆ°åœ†æœˆæˆ–å—åˆ°ç‰¹å®šå…‰çº¿ç…§å°„æ—¶ï¼Œä½“å†…çš„é‡æ€§ä¼šè¢«å”¤é†’ï¼Œå˜èº«ä¸ºå¤±å»ç†æ™ºçš„å·¨çŒ¿ã€‚å·¨çŒ¿å½¢æ€ä¸‹ï¼Œä½“å‹ã€åŠ›é‡å’Œè€åŠ›éƒ½å°†è·å¾—å·¨å¤§çš„å¢å¹…ï¼Œæ‹¥æœ‰æƒŠäººçš„ç ´ååŠ›ã€‚å˜èº«ä¼šæŒç»­åˆ°æœˆäº®æ¶ˆå¤±æˆ–å°¾å·´è¢«åˆ‡æ–­ä¸ºæ­¢ã€‚`],\n\n    [\"Bçº§èµ›äºšäººç²¾è‹±æˆ˜å£«è¡€ç»Ÿ\", 15000, \"è¡€ç»Ÿ\", {B:1}, `\n        å±æ€§: åŠ›é‡+4, æ•æ·+2, è€åŠ›+4, æ„ŸçŸ¥+1\n        èƒ½é‡æ± : æ°”(60)\n    `, `\n    - æå‡ç‰¹æ€§-æˆ˜æ–—æ°‘æ—: ä½œä¸ºèµ›äºšäººä¸­çš„ç²¾è‹±ï¼Œä½ çš„åŠ›é‡ä¸è‚‰ä½“æ½œèƒ½å¾—åˆ°äº†æå¤§å¼€å‘ã€‚ä½ çš„å¤©ç”Ÿæ”»å‡»ä¸ä»…è¿…çŒ›ï¼Œè€Œä¸”ç ´ååŠ›ä¼šéšç€è‡ªèº«åŠ›é‡çš„å¢é•¿è€Œä¸æ–­çªç ´æé™ï¼Œè‚‰ä½“ä¹Ÿå˜å¾—æ›´åŠ åšä¸å¯æ‘§ã€‚\n    - å®‡å®™ä½œæˆ˜: ä½ çš„èº«ä½“æ„é€ å·²ç»è¿›åŒ–åˆ°å¯ä»¥é€‚åº”ä¸¥é…·çš„å®‡å®™ç¯å¢ƒï¼Œæ— è®ºæ˜¯çœŸç©ºã€è¾å°„è¿˜æ˜¯æ·±æµ·çš„å·¨å¤§æ°´å‹ï¼Œéƒ½æ— æ³•å†å¯¹ä½ é€ æˆä¼¤å®³ã€‚ä½ ä¸å†éœ€è¦ä¾èµ–å‘¼å¸ç”Ÿå­˜ã€‚`],\n\n    [\"Açº§çš‡æ—èµ›äºšäººè¡€ç»Ÿï¼ˆè´å‰å¡”ç‹ï¼‰\", 20000, \"è¡€ç»Ÿ\", {A:1}, `\n        å±æ€§: åŠ›é‡+5, æ•æ·+3, è€åŠ›+5, æ„ŸçŸ¥+3\n        èƒ½é‡æ± : æ°”(70)\n    `, `\n    - æå‡ç‰¹æ€§-æˆ˜æ–—æ°‘æ—: çš‡æ—è¡€è„‰ä½¿ä½ çš„è‚‰ä½“å¯¹èƒ½é‡æ”»å‡»ä¹Ÿäº§ç”Ÿäº†æå¼ºçš„æŠ—æ€§ã€‚ä½ é€ æˆçš„è¿‘æˆ˜ä¼¤å®³ä¼šéšç€ä½ çš„åŠ›é‡è€Œè·å¾—è´¨çš„é£è·ƒï¼Œå¹¶ä¸”å¼ºå¤§çš„è€åŠ›ä¹Ÿèµ‹äºˆäº†ä½ æ›´ä¸ºç£…ç¤´çš„ç”Ÿå‘½åŠ›ã€‚\n    - ç‹è€…é£èŒƒ: ä½ å¤©ç”Ÿå…·å¤‡ç‹è€…çš„å¨å‹ä¸æ°”é­„ï¼Œè¿™è‚¡æ°”åŠ¿ä½¿ä½ åœ¨ä»»ä½•æ„å¿—å¯¹æŠ—ä¸­éƒ½èƒ½å æ®ç»å¯¹ä¼˜åŠ¿ã€‚\n    - å‰æ–¹çš„è·¯: èµ›äºšäººåœ¨ç”Ÿæ­»è¾¹ç¼˜ä¼šå˜å¾—æ›´å¼ºçš„ä¼ è¯´åœ¨ä½ èº«ä¸Šä½“ç°å¾—æ·‹æ¼“å°½è‡´ã€‚æ¯æ¬¡ä»é‡ä¼¤ä¸­å®Œå…¨æ¢å¤åï¼Œä½ éƒ½æœ‰æœºä¼šçªç ´è‡ªèº«çš„æé™ï¼Œæ°¸ä¹…å¢å¼ºè‡ªå·±çš„åŠ›é‡æˆ–è€åŠ›ã€‚`],\n\n    [\"Sçº§è¶…çº§èµ›äºšäººè¡€ç»Ÿ\", 32000, \"è¡€ç»Ÿ\", {S:1}, `\n        å±æ€§: åŠ›é‡+8, æ•æ·+7, è€åŠ›+8, æ„ŸçŸ¥+6\n        èƒ½é‡æ± : æ°”(100)\n    `, `\n    - é‡‘è‰²å½¢æ€: å‡­å€Ÿå¼ºå¤§çš„æ„å¿—ï¼Œä½ å¯ä»¥çªç ´æé™ï¼Œå˜èº«ä¸ºä¼ è¯´ä¸­çš„è¶…çº§èµ›äºšäººã€‚å˜èº«åï¼Œä½ çš„å¤´å‘å˜ä¸ºé‡‘è‰²å¹¶ç«–ç«‹ï¼Œç³å­”åŒ–ä¸ºç¢§ç»¿ï¼Œå…¨èº«è¢«é‡‘è‰²çš„æ°”ç„°åŒ…è£¹ã€‚åœ¨æ­¤å½¢æ€ä¸‹ï¼Œä½ çš„å„é¡¹èº«ä½“æœºèƒ½éƒ½å°†è·å¾—çˆ†ç‚¸æ€§çš„æå‡ï¼Œç§»åŠ¨é€Ÿåº¦å€å¢ï¼Œæˆ˜æ–—æ°‘æ—çš„æ‰€æœ‰ç‰¹æ€§æ•ˆæœä¹Ÿä¼šå…¨é¢å‡åã€‚\n    - æå‡ç‰¹æ€§-æˆ˜æ–—æ°‘æ—: åœ¨è¶…çº§èµ›äºšäººçŠ¶æ€ä¸‹ï¼Œä½ çš„åŠ›é‡èƒ½å¤Ÿç›´æ¥è½¬åŒ–ä¸ºå¤©ç”Ÿæ­¦å™¨çš„ç ´ååŠ›ï¼Œè€Œä½ åšéŸ§çš„èº«ä½“ç”šè‡³èƒ½å¸æ”¶æ‰€æœ‰ç±»å‹çš„ä¼¤å®³ã€‚`],\n\n    [\"æ–¯å…‹è±äºšè¡€ç»Ÿ\", 6000, \"è¡€ç»Ÿ\", {D:1}, `\n        å±æ€§: è€åŠ›+1, æ™ºåŠ›+2, æ„ŸçŸ¥+1\n        èƒ½é‡æ± : é­”åŠ›(30)\n    `, `\n    - èƒŒæ™¯: æ–¯å…‹è±äºšæ˜¯å±…ä½äºç±³å¾·å…¶è·¯è¾¾æ¬¡å…ƒçš„ä¸€æ—ï¼Œä»–ä»¬å¤©ç”Ÿæ‹¥æœ‰å¯¹é­”æ³•çš„äº²å’ŒåŠ›ï¼Œæ“…é•¿æœç´¢èƒ½é‡æºã€ç®¡ç†èµ„æ–™ï¼Œæ˜¯å‘æ˜å¤ä»£æ–‡æ˜é—è¿¹çš„æƒå¨ç§æ—ã€‚\n    - èƒ½é‡æ„ŸçŸ¥: ä½ èƒ½æ•é”åœ°æ„ŸçŸ¥åˆ°å‘¨å›´çš„èƒ½é‡æ³¢åŠ¨ï¼ŒåŒ…æ‹¬èƒ½é‡çš„è¿ç”¨ã€é­”æ³•ç‰©å“ä»¥åŠæ‹¥æœ‰èƒ½é‡çš„ç”Ÿç‰©ï¼Œå¹¶èƒ½ç²¾ç¡®å®šä½å…¶æ¥æºï¼Œç”šè‡³åˆ†è¾¨å‡ºèƒ½é‡çš„ç±»åˆ«å’Œå¼ºåº¦ã€‚\n    - èµ„æ–™ç»Ÿåˆ: æ–¯å…‹è±äºšäººæ“…é•¿æ•´ç†å’Œä½¿ç”¨æ–‡çŒ®ï¼Œåœ¨è§£è¯»æ–‡ä»¶å’Œå›¾çº¸æ–¹é¢æœ‰å“è¶Šçš„å¤©èµ‹ã€‚\n    - é›ªè²‚å½¢æ€: ä½ å¯ä»¥æ¶ˆè€—é­”åŠ›ï¼Œåœ¨äººç±»ä¸å°å·§çš„é›ªè²‚å½¢æ€ä¹‹é—´è‡ªç”±å˜åŒ–ã€‚é›ªè²‚å½¢æ€ä¸‹ï¼Œä½ å¯ä»¥è½»æ¾å‡ºå…¥ç‹­çª„çš„åœ°æ–¹ï¼Œå¹¶ä¸”åœ¨æ”€é™„äºå…¶ä»–ç”Ÿç‰©èº«ä¸Šæ—¶ï¼Œèƒ½å·§å¦™åœ°åˆ©ç”¨å¯¹æ–¹æ¥ä¸ºè‡ªå·±æä¾›æ©æŠ¤ã€‚`],\n\n    [\"é¸¢å¥³è¡€ç»Ÿ\", 12000, \"è¡€ç»Ÿ\", {C:1}, `\n        å±æ€§: åŠ›é‡+2, æ•æ·+3, æ„ŸçŸ¥+2, å†³å¿ƒ+1\n        èƒ½é‡æ± : é£å…ƒ(45)\n    `, `\n    - èƒŒæ™¯: é¸¢å¥³æ˜¯åŠäººåŠçŒ›ç¦½çš„ç§æ—ï¼Œæœ€åˆæ˜¯æ³•å¸ˆå†›é˜Ÿçš„æ¢å­ä¸æ¸¸å‡»é˜Ÿï¼Œåæ¥åœ¨å…½äººé©å‘½ä¸­èµ¢å¾—äº†è‡ªç”±ã€‚å¥¹ä»¬æ˜¯å¤©ç”Ÿçš„ç©ºæˆ˜ä¸“å®¶ï¼Œä»¥æƒŠäººçš„é€Ÿåº¦å’ŒæœºåŠ¨æ€§è‘—ç§°ã€‚\n    - åŠäººåŠé¸Ÿ: ä½ çš„æ‰‹è‡‚æ°¸ä¹…åœ°åŒ–ä¸ºä¸€å¯¹ç¾½ç¿¼ï¼Œèµ‹äºˆä½ å¼ºå¤§çš„é£è¡Œèƒ½åŠ›ï¼Œä½†æ— æ³•å†åƒäººç±»ä¸€æ ·ä½¿ç”¨åŒæ‰‹ã€‚ä½ çš„åŒè…¿åˆ™åŒ–ä¸ºçŒ›ç¦½èˆ¬çš„åˆ©çˆªï¼Œæˆä¸ºä½ è‡´å‘½çš„å¤©ç”Ÿæ­¦å™¨ã€‚\n    - å›æ—‹æˆ˜æ³•: ä½ ç²¾é€šåˆ©ç”¨ç©ºä¸­ä¼˜åŠ¿è¿›è¡Œæˆ˜æ–—çš„æŠ€å·§ã€‚\n    - æ°¸ä¸ä¸ºå¥´: è‡ªç”±çš„æ„å¿—å·²ç»çƒ™å°åœ¨ä½ çš„çµé­‚æ·±å¤„ã€‚`],\n\n    [\"å¤§ç†ŠçŒ«è¡€ç»Ÿ\", 15000, \"è¡€ç»Ÿ\", {B:1}, `\n        å±æ€§: åŠ›é‡+4, è€åŠ›+4, é£åº¦+3\n        èƒ½é‡æ± : èŒåŠ›(50)\n    `, `\n    - èƒŒæ™¯: ä¸–ç•Œä¸Šæœ€å¯çˆ±çš„ç”Ÿç‰©æ˜¯ä»€ä¹ˆï¼Ÿç­”æ¡ˆå°±æ˜¯æ¥è‡ªä¸­å›½çš„â€œæ»šæ»šâ€ï¼\n    - å¤§ç†ŠçŒ«: ä½ çš„å¤–å½¢å˜ä¸ºä¸€åªå¯çˆ±çš„å¤§ç†ŠçŒ«ï¼Œæ‹¥æœ‰ä¸ç”Ÿä¿±æ¥çš„æ”€çˆ¬å¤©èµ‹å’Œç†Šæ—è¯­è¨€èƒ½åŠ›ã€‚ä½ è‚¥å˜Ÿå˜Ÿçš„èº«ä½“å¯¹å†²å‡»ä¼¤å®³æœ‰ç€å¤©ç„¶çš„ç¼“å†²ä½œç”¨ã€‚\n    - èŒè´§: ä½ çš„å¯çˆ±å¤–è¡¨å…·æœ‰æ— æ³•æŠ—æ‹’çš„é­…åŠ›ã€‚\n    - ç†Šäººæ—æ— æ‰€ç•æƒ§ï¼: ä½ æ‹¥æœ‰å¼ºå¤§çš„å‹‡æ°”å’Œä¸å±ˆçš„æ„å¿—ã€‚\n    - ç†ŠæŒ: ä½ åšå®çš„ç†ŠæŒæ—¢å¯çˆ±åˆå……æ»¡åŠ›é‡ã€‚`],\n\n    [\"ç¬¬ä¸€ä½¿å¾’äºšå½“è¡€ç»Ÿ\", 54400, \"è¡€ç»Ÿ\", {S:1}, `\n        å±æ€§: åŠ›é‡+4, æ•æ·+4, è€åŠ›+4, æ™ºåŠ›+3, æ„ŸçŸ¥+3, å†³å¿ƒ+4, é£åº¦+3, æ²‰ç€+4\n        èƒ½é‡æ± : ATèƒ½é‡(120)\n    `, `\n    - èƒŒæ™¯: äºšå½“æ˜¯å‡ºç°åœ¨å—æçš„å…‰ä¹‹å·¨äººï¼Œæ˜¯æ‰€æœ‰ä½¿å¾’çš„èµ·æºã€‚æ¤å…¥å…¶èƒšèƒåï¼Œå¤–å½¢ä¸ä¼šå‘ç”Ÿå·¨å¤§æ”¹å˜ï¼Œä½†æŒå¿ƒä¼šå‡ºç°ä¸€åªçœ¼ç›ã€‚\n    - å¼ºåŒ–ATåŠ›åœº: ä½œä¸ºä½¿å¾’ä¹‹ç¥–ï¼Œä½ çš„ATåŠ›åœºï¼ˆå¿ƒä¹‹å£ï¼‰å¼‚å¸¸å¼ºå¤§ï¼Œèƒ½å¤ŸæŠµå¾¡æä¸ºå·¨å¤§çš„ä¼¤å®³ï¼Œç”šè‡³å¯ä»¥æŠµæŠ—å³æ­»æ•ˆæœã€‚\n    - S2æœºå…³: ä½ æ‹¥æœ‰åä¸ºS2æœºå…³çš„æ°¸åŠ¨æ ¸å¿ƒï¼Œå®ƒèƒ½æºæºä¸æ–­åœ°äº§ç”Ÿèƒ½é‡ï¼Œå¹¶è®©ä½ æ— éœ€æ‘„é£Ÿå’Œå‘¼å¸ï¼Œä¹Ÿèƒ½åœ¨çœŸç©ºä¸­ç”Ÿå­˜ã€‚åªè¦S2æœºå…³ä¸è¢«ç ´åï¼Œä½ å°±ç®—ä¸ä¸ŠçœŸæ­£æ­»äº¡ã€‚\n    - å¿ƒçµé˜²æŠ¤: ä½ å¯¹ä»»ä½•å½±å“å¿ƒçµçš„è´Ÿé¢æ•ˆæœå®Œå…¨å…ç–«ã€‚\n    - å…‰ä¹‹å·¨äºº: ä½ çš„æœ¬è´¨è½¬å˜ä¸ºå…ƒç´ ç”Ÿç‰©ï¼Œä½“å‹å˜å¾—æ›´ä¸ºå·¨å¤§ï¼Œå¹¶è·å¾—å®Œç¾çš„é£è¡Œèƒ½åŠ›ã€‚`],\n\n    [\"ç¬¬ä¸‰ä½¿å¾’æ°´å¤©ä½¿è¡€ç»Ÿ\", 27200, \"è¡€ç»Ÿ\", {A:1}, `\n        å±æ€§: åŠ›é‡+3, æ•æ·+6, è€åŠ›+4, å†³å¿ƒ+3\n        èƒ½é‡æ± : ATèƒ½é‡(70)\n    `, `\n    - èƒŒæ™¯: æ°´å¤©ä½¿æ˜¯æ‹¥æœ‰é£è¡Œèƒ½åŠ›çš„ä½¿å¾’ã€‚æ¤å…¥å…¶èƒšèƒåï¼Œå¤´ä¸Šä¼šå‡ºç°ä¸¤å¼ é¢å…·ï¼Œèº«ä½“æµ®ç°ç»¿è‰²ç»„ç»‡ï¼ŒèƒŒåç”Ÿå‡ºé—ªå…‰çš„ç¿…è†€ã€‚\n    - ATåŠ›åœº: ä½ è·å¾—ä½¿å¾’å…±é€šçš„å¿ƒä¹‹å£èƒ½åŠ›ï¼Œèƒ½å±•å¼€å…«è¾¹å½¢çš„é—ªå…‰åŠ›åœºï¼ŒæŠµå¾¡å¤–ç•Œçš„ç‰©ç†å¹²æ¶‰å’Œä¼¤å®³ã€‚\n    - S2æœºå…³: ä½ æ‹¥æœ‰åä¸ºS2æœºå…³çš„æ°¸åŠ¨æ ¸å¿ƒï¼Œå®ƒèƒ½æºæºä¸æ–­åœ°äº§ç”Ÿèƒ½é‡ï¼Œå¹¶è®©ä½ æ— éœ€æ‘„é£Ÿå’Œå‘¼å¸ï¼Œä¹Ÿèƒ½åœ¨çœŸç©ºä¸­ç”Ÿå­˜ã€‚åªè¦S2æœºå…³ä¸è¢«ç ´åï¼Œä½ å°±ç®—ä¸ä¸ŠçœŸæ­£æ­»äº¡ã€‚\n    - ä½¿å¾’ä¹‹èº¯: ä½ çš„èº«ä½“æ‹¥æœ‰å¼ºå¤§çš„å†ç”Ÿèƒ½åŠ›ã€‚ä½ å¯ä»¥ä»æ‰‹å¿ƒå’Œè‚˜éƒ¨é•¿å‡ºé”‹åˆ©çš„å…‰æŸçŸ›ï¼Œå¹¶ä»å¤´ä¸Šçš„é¢å…·å‘å°„å‡ºå‘½ä¸­åä¼šçˆ†å‘å‡ºåå­—å‹å…‰èŠ’çš„ç²’å­ç‚®ã€‚`],\n\n    [\"ç¬¬å››ä½¿å¾’ä¹¦å¤©ä½¿è¡€ç»Ÿ\", 27200, \"è¡€ç»Ÿ\", {A:1}, `\n        å±æ€§: åŠ›é‡+3, æ•æ·+3, è€åŠ›+4, å†³å¿ƒ+3, é£åº¦+3\n        èƒ½é‡æ± : ATèƒ½é‡(70)\n    `, `\n    - èƒŒæ™¯: ä¹¦å¤©ä½¿å½¢æ€å¦‚åŒæ°´æ¯ã€‚æ¤å…¥å…¶èƒšèƒåï¼Œå¤´éƒ¨åæ–¹ä¼šå‡ºç°ä¸€ä¸ªæ°´æ¯çŠ¶çš„æ‚¬æµ®ç½©ï¼Œå‘æ¢¢å˜ä¸ºé€æ˜çš„è§¦æ‰‹ï¼Œå¹¶ä»èƒŒåä¼¸å‡ºä¸¤æ ¹ç”µçƒ­é­ã€‚\n    - ATåŠ›åœº: ä½ è·å¾—ä½¿å¾’å…±é€šçš„å¿ƒä¹‹å£èƒ½åŠ›ï¼Œèƒ½å±•å¼€å…«è¾¹å½¢çš„é—ªå…‰åŠ›åœºï¼ŒæŠµå¾¡å¤–ç•Œçš„ç‰©ç†å¹²æ¶‰å’Œä¼¤å®³ã€‚\n    - S2æœºå…³: ä½ æ‹¥æœ‰åä¸ºS2æœºå…³çš„æ°¸åŠ¨æ ¸å¿ƒï¼Œå®ƒèƒ½æºæºä¸æ–­åœ°äº§ç”Ÿèƒ½é‡ï¼Œå¹¶è®©ä½ æ— éœ€æ‘„é£Ÿå’Œå‘¼å¸ï¼Œä¹Ÿèƒ½åœ¨çœŸç©ºä¸­ç”Ÿå­˜ã€‚åªè¦S2æœºå…³ä¸è¢«ç ´åï¼Œä½ å°±ç®—ä¸ä¸ŠçœŸæ­£æ­»äº¡ã€‚\n    - æ°´æ¯ä½“: ä½ å¤´éƒ¨çš„æ‚¬æµ®åœºè®©ä½ èƒ½æ°¸ä¹…ç¦»åœ°æ¼‚æµ®ï¼Œç§»åŠ¨é€Ÿåº¦å€å¢ã€‚ä½ è¿˜æ‹¥æœ‰ä¸¤æ¡èƒ½è¿›è¡Œé«˜é¢‘éœ‡åŠ¨çš„ç²‰çº¢è‰²è§¦æ‰‹ä½œä¸ºæ­¦å™¨ï¼Œåœ¨æ”»å‡»æ—¶èƒ½ç¬é—´æ’•è£‚æ²¡æœ‰è£…ç”²é˜²æŠ¤çš„ç›®æ ‡ã€‚`],\n\n    [\"ç¬¬äº”ä½¿å¾’é›·å¤©ä½¿è¡€ç»Ÿ\", 27200, \"è¡€ç»Ÿ\", {A:1}, `\n        å±æ€§: æ•æ·+2, è€åŠ›+4, æ„ŸçŸ¥+4, æ²‰ç€+2\n        èƒ½é‡æ± : ATèƒ½é‡(70)\n    `, `\n    - èƒŒæ™¯: é›·å¤©ä½¿æ‹¥æœ‰æœ€å¼ºçš„ç²’å­ç‚®ï¼Œèƒ½å‘ˆç°å„ç§å‡ ä½•å½¢æ€ã€‚æ¤å…¥å…¶èƒšèƒåï¼Œå¤–å½¢å˜åŒ–ä¸å¤§ï¼Œä½†ä¼šæœ‰ä¸€ä¸ªå°å°çš„è“è‰²æ°´æ™¶å«æ˜Ÿç¯ç»•ç€ä½ ï¼Œå®ƒæ—¢æ˜¯ä½ çš„æ­¦å™¨å¹³å°ï¼Œä¹Ÿæ˜¯S2æœºå…³çš„è½½ä½“ã€‚\n    - ATåŠ›åœº: ä½ è·å¾—ä½¿å¾’å…±é€šçš„å¿ƒä¹‹å£èƒ½åŠ›ï¼Œèƒ½å±•å¼€å…«è¾¹å½¢çš„é—ªå…‰åŠ›åœºï¼ŒæŠµå¾¡å¤–ç•Œçš„ç‰©ç†å¹²æ¶‰å’Œä¼¤å®³ã€‚\n    - S2æœºå…³: ä½ çš„S2æœºå…³è¢«ä¿æŠ¤åœ¨åšå›ºçš„æ°´æ™¶å«æ˜Ÿä¸­ã€‚å®ƒèƒ½æºæºä¸æ–­åœ°äº§ç”Ÿèƒ½é‡ï¼Œå¹¶è®©ä½ æ— éœ€æ‘„é£Ÿå’Œå‘¼å¸ï¼Œä¹Ÿèƒ½åœ¨çœŸç©ºä¸­ç”Ÿå­˜ã€‚\n    - é’»å¤´: ä½ èƒ½ä»èº«ä½“ä¼¸å‡ºä¸€æ ¹æ— åšä¸æ‘§çš„å°é’»å¤´ï¼Œç”¨äºçªç ´åšå›ºçš„éšœç¢ã€‚\n    - åŠ ç²’å­ç‚®: ç¯ç»•ä½ çš„æ°´æ™¶å«æ˜Ÿèƒ½å‘å°„å‡ºå¨åŠ›æ— ç©·çš„åŠ ç²’å­ç‚®ï¼Œå°„ç¨‹æè¿œï¼Œå¹¶èƒ½è‡ªåŠ¨é”å®šå¹¶æ”»å‡»è¿›å…¥ä½ æ„ŸçŸ¥èŒƒå›´å†…çš„ä»»ä½•æœ‰å¨èƒçš„ç›®æ ‡ã€‚`],\n\n    [\"ç¬¬å…­ä½¿å¾’é±¼å¤©ä½¿è¡€ç»Ÿ\", 27200, \"è¡€ç»Ÿ\", {A:1}, `\n        å±æ€§: åŠ›é‡+6, æ•æ·+2, è€åŠ›+6, æ„ŸçŸ¥+2\n        èƒ½é‡æ± : ATèƒ½é‡(70)\n    `, `\n    - èƒŒæ™¯: é±¼å¤©ä½¿æ˜¯æ°´ç”Ÿä½¿å¾’ã€‚æ¤å…¥å…¶èƒšèƒåï¼ŒèƒŒåä¼šé•¿å‡ºé±¼é³å’ŒçŸ­å°¾ï¼Œå¹¶ä¸”å¯ä»¥ä»å¤´éƒ¨ä¼¸å‡ºå¸ƒæ»¡å°–ç‰™çš„å·¨å˜´ï¼ŒS2æœºå…³å°±ä½äºå·¨å˜´ä¹‹ä¸­ã€‚\n    - ATåŠ›åœº: ä½ è·å¾—ä½¿å¾’å…±é€šçš„å¿ƒä¹‹å£èƒ½åŠ›ï¼Œèƒ½å±•å¼€å…«è¾¹å½¢çš„é—ªå…‰åŠ›åœºï¼ŒæŠµå¾¡å¤–ç•Œçš„ç‰©ç†å¹²æ¶‰å’Œä¼¤å®³ã€‚\n    - S2æœºå…³: ä½ çš„S2æœºå…³ä½äºå˜´ä¸­ã€‚å®ƒèƒ½æºæºä¸æ–­åœ°äº§ç”Ÿèƒ½é‡ï¼Œå¹¶è®©ä½ æ— éœ€æ‘„é£Ÿå’Œå‘¼å¸ï¼Œä¹Ÿèƒ½åœ¨çœŸç©ºä¸­ç”Ÿå­˜ã€‚\n    - é²¸å: ä½ è·å¾—äº†åœ¨æ°´ä¸­è‡ªç”±å‘¼å¸å’Œé«˜é€Ÿç§»åŠ¨çš„èƒ½åŠ›ï¼Œå¹¶å…ç–«æ°´å‹ã€‚ä½ å¯ä»¥ä¼¸å‡ºå·¨å˜´ç›´æ¥åå™¬æ•Œäººï¼Œè¢«åå…¥ä½“å†…çš„æ•Œäººä¼šæŒç»­å—åˆ°ä¼¤å®³ï¼Œéš¾ä»¥é€ƒè„±ã€‚`],\n\n    [\"ç¬¬ä¸ƒä½¿å¾’éŸ³ä¹å¤©ä½¿è¡€ç»Ÿ\", 27200, \"è¡€ç»Ÿ\", {A:1}, `\n        å±æ€§: åŠ›é‡+3, æ•æ·+3, è€åŠ›+4, é£åº¦+4, æ²‰ç€+2\n        èƒ½é‡æ± : ATèƒ½é‡(80)\n    `, `\n    - èƒŒæ™¯: éŸ³ä¹å¤©ä½¿çš„æ ¸å¿ƒç‰¹å¾æ˜¯åˆ†è£‚ä¸å†ç”Ÿã€‚æ¤å…¥å…¶èƒšèƒåï¼Œå¤´ä¸Šä¼šå‡ºç°ä¸¤å¼ é¢å…·ï¼Œèº«ä½“æµ®ç°ç»¿è‰²ç»„ç»‡ï¼ŒèƒŒåç”Ÿå‡ºé—ªå…‰çš„ç¿…è†€ã€‚\n    - ATåŠ›åœº: ä½ è·å¾—ä½¿å¾’å…±é€šçš„å¿ƒä¹‹å£èƒ½åŠ›ï¼Œèƒ½å±•å¼€å…«è¾¹å½¢çš„é—ªå…‰åŠ›åœºï¼ŒæŠµå¾¡å¤–ç•Œçš„ç‰©ç†å¹²æ¶‰å’Œä¼¤å®³ã€‚\n    - åŒS2æœºå…³: ä½ æ‹¥æœ‰ä¸¤ä¸ªé˜´é˜³é±¼å½¢çš„S2æœºå…³ã€‚è¿™æ„å‘³ç€å³ä½¿å…¶ä¸­ä¸€ä¸ªè¢«æ‘§æ¯ï¼Œä½ ä¾ç„¶èƒ½å¤Ÿå­˜æ´»ã€‚\n    - ç²’å­ç‚®: ä½ èƒ½ä»å¤´ä¸Šçš„é¢å…·å‘å°„å‡ºå¨åŠ›å¼ºå¤§çš„ç²’å­ç‚®ã€‚\n    - åˆ†ä½“: å½“ä½ å—åˆ°æŒ¥ç ä¼¤å®³æ—¶ï¼Œä½ å¯ä»¥é€‰æ‹©ä¸å—ä¼¤å®³ï¼Œè€Œæ˜¯ç›´æ¥åˆ†è£‚æˆä¸¤ä¸ªå±æ€§æœ‰æ‰€å‡å¼±çš„å°å‹ä¸ªä½“ã€‚ä¸¤ä¸ªåˆ†ä½“å…±äº«æ„è¯†ï¼Œå¯ä»¥ååŒä½œæˆ˜ã€‚è™½ç„¶åˆä½“éœ€è¦æ¼«é•¿æ—¶é—´ä¸”ä¸èƒ½è¢«æ‰“æ‰°ï¼Œä½†è¿™æ˜¯éå¸¸å¼ºå¤§çš„ç”Ÿå­˜èƒ½åŠ›ã€‚`],\n\n    [\"ç¬¬å…«ä½¿å¾’èƒå„¿å¤©ä½¿è¡€ç»Ÿ\", 27200, \"è¡€ç»Ÿ\", {A:1}, `\n        å±æ€§: è€åŠ›+6, æ„ŸçŸ¥+2, é£åº¦+2, æ²‰ç€+6\n        èƒ½é‡æ± : ATèƒ½é‡(70)\n    `, `\n    - èƒŒæ™¯: èƒå„¿å¤©ä½¿ä»£è¡¨ç€é«˜é€Ÿè¿›åŒ–ä¸é€‚åº”ã€‚æ¤å…¥å…¶èƒšèƒåï¼Œä½ ä¼šé¦–å…ˆå›å½’åˆ°ä¸€ä¸ªè›‹çš„å½¢æ€ã€‚\n    - ATåŠ›åœº: ä½ è·å¾—ä½¿å¾’å…±é€šçš„å¿ƒä¹‹å£èƒ½åŠ›ï¼Œèƒ½å±•å¼€å…«è¾¹å½¢çš„é—ªå…‰åŠ›åœºï¼ŒæŠµå¾¡å¤–ç•Œçš„ç‰©ç†å¹²æ¶‰å’Œä¼¤å®³ã€‚\n    - S2æœºå…³: ä½ æ‹¥æœ‰åä¸ºS2æœºå…³çš„æ°¸åŠ¨æ ¸å¿ƒï¼Œå®ƒèƒ½æºæºä¸æ–­åœ°äº§ç”Ÿèƒ½é‡ï¼Œå¹¶è®©ä½ æ— éœ€æ‘„é£Ÿå’Œå‘¼å¸ï¼Œä¹Ÿèƒ½åœ¨çœŸç©ºä¸­ç”Ÿå­˜ã€‚\n    - å¿«é€Ÿæˆé•¿: ä½ ä¼šå¤„äºä¸€ä¸ªåšå›ºçš„è›‹ä¸­ï¼Œèƒ½æ„ŸçŸ¥å¤–ç•Œä½†æ— æ³•äº’åŠ¨ã€‚ä¸€æ—¦è›‹å£³è¢«æ‰“ç ´ï¼Œä½ ä¼šåœ¨ç¬é—´æˆé•¿ä¸ºå®Œå…¨å½¢æ€ï¼Œæ‰€æœ‰å±æ€§ã€é˜²å¾¡å’ŒæŠ—æ€§éƒ½ä¼šå¾—åˆ°æå¤§çš„æå‡ã€‚ä¸è¿‡è¿™ä¸ªçŠ¶æ€æŒç»­æ•°å°æ—¶åï¼Œä½ ä¼šå†æ¬¡å˜å›è›‹å½¢æ€ã€‚`],\n\n    [\"ç¬¬ä¹ä½¿å¾’é›¨å¤©ä½¿è¡€ç»Ÿ\", 27200, \"è¡€ç»Ÿ\", {A:1}, `\n        å±æ€§: åŠ›é‡+3, æ•æ·+3, è€åŠ›+4, æ„ŸçŸ¥+3, é£åº¦+3\n        èƒ½é‡æ± : ATèƒ½é‡(70)\n    `, `\n    - èƒŒæ™¯: é›¨å¤©ä½¿æ˜¯æ‹¥æœ‰å¼ºé…¸æ”»å‡»èƒ½åŠ›çš„ä½¿å¾’ã€‚æ¤å…¥å…¶èƒšèƒåï¼Œèº«ä¸Šä¼šé•¿å‡ºä¸ƒåªçœ¼ç›ï¼ŒS2æœºå…³éšè—åœ¨èº«ä½“å†…éƒ¨ã€‚\n    - ATåŠ›åœº: ä½ è·å¾—ä½¿å¾’å…±é€šçš„å¿ƒä¹‹å£èƒ½åŠ›ï¼Œèƒ½å±•å¼€å…«è¾¹å½¢çš„é—ªå…‰åŠ›åœºï¼ŒæŠµå¾¡å¤–ç•Œçš„ç‰©ç†å¹²æ¶‰å’Œä¼¤å®³ã€‚\n    - S2æœºå…³: ä½ æ‹¥æœ‰åä¸ºS2æœºå…³çš„æ°¸åŠ¨æ ¸å¿ƒï¼Œå®ƒèƒ½æºæºä¸æ–­åœ°äº§ç”Ÿèƒ½é‡ï¼Œå¹¶è®©ä½ æ— éœ€æ‘„é£Ÿå’Œå‘¼å¸ï¼Œä¹Ÿèƒ½åœ¨çœŸç©ºä¸­ç”Ÿå­˜ã€‚\n    - æ³ªæµæ»¡é¢: ä½ çœ¼ç›æµå‡ºçš„â€œæ³ªæ°´â€æ˜¯å…·æœ‰æå¼ºè…èš€æ€§çš„ç¡«é…¸ã€‚ä½ å¯ä»¥ä¸»åŠ¨å–·å°„å¤§èŒƒå›´çš„é…¸æ¶²ï¼Œè¿‘èº«æ”»å‡»ä½ çš„æ•Œäººä¹Ÿä¼šè¢«é…¸æ¶²æº…å°„ï¼Œä½ çš„è¿‘æˆ˜æ”»å‡»åŒæ ·é™„å¸¦è…èš€æ•ˆæœã€‚è¿™ç§ç¡«é…¸èƒ½æ— è§†ç‰©ä½“çš„ç¡¬åº¦ç›´æ¥é€ æˆç ´åã€‚`],\n\n    [\"ç¬¬åä½¿å¾’ç©ºå¤©ä½¿è¡€ç»Ÿ\", 27200, \"è¡€ç»Ÿ\", {A:1}, `\n        å±æ€§: åŠ›é‡+2, æ•æ·+3, è€åŠ›+2, æ„ŸçŸ¥+3, é£åº¦+2\n        èƒ½é‡æ± : ATèƒ½é‡(70)\n    `, `\n    - èƒŒæ™¯: ç©ºå¤©ä½¿æ˜¯å·¨å¤§çš„ç©ºä¸­è¦å¡ã€‚æ¤å…¥å…¶èƒšèƒåï¼Œå…¨èº«ä¼šè¢«æ©˜é»„è‰²ç‰©è´¨è¦†ç›–ï¼Œèƒ¸å‰å’ŒåŒæ‰‹å‡ºç°å·¨å¤§çš„çœ¼ç›ï¼Œå½±å“ç²¾ç»†æ“ä½œã€‚\n    - ATåŠ›åœº: ä½ è·å¾—ä½¿å¾’å…±é€šçš„å¿ƒä¹‹å£èƒ½åŠ›ï¼Œèƒ½å±•å¼€å…«è¾¹å½¢çš„é—ªå…‰åŠ›åœºï¼ŒæŠµå¾¡å¤–ç•Œçš„ç‰©ç†å¹²æ¶‰å’Œä¼¤å®³ã€‚å¯ä»¥é€šè¿‡å…¨ç¥è´¯æ³¨çš„é˜²å¾¡æ¥å¼ºåŒ–ATåŠ›åœºçš„èŒƒå›´å’Œæ•ˆæœã€‚\n    - S2æœºå…³: ä½ æ‹¥æœ‰åä¸ºS2æœºå…³çš„æ°¸åŠ¨æ ¸å¿ƒï¼Œå®ƒèƒ½æºæºä¸æ–­åœ°äº§ç”Ÿèƒ½é‡ï¼Œå¹¶è®©ä½ æ— éœ€æ‘„é£Ÿå’Œå‘¼å¸ï¼Œä¹Ÿèƒ½åœ¨çœŸç©ºä¸­ç”Ÿå­˜ã€‚\n    - åŒ…è£¹ç‰©è´¨: è¦†ç›–ä½ å…¨èº«çš„ç‰©è´¨æ˜¯ä¸€å±‚å¤©ç„¶çš„é‡ç”²ï¼Œæä¾›äº†å¼ºå¤§çš„é˜²å¾¡å’Œå†ç”Ÿèƒ½åŠ›ã€‚\n    - å¸ç©ºä¹‹çœ¼: ä½ èº«ä¸Šçš„ä¸‰åªå¤§çœ¼ç›ç»™äºˆä½ å…¨æ–¹ä½æ— æ­»è§’çš„è§†é‡ï¼Œæå¤§åœ°å¢å¼ºäº†ä½ çš„ä¾¦æŸ¥èƒ½åŠ›ï¼Œå¹¶è®©ä½ èƒ½å¤Ÿæ¼‚æµ®åœ¨ç©ºä¸­ã€‚\n    - ç©ºé™é£æ‰‘: ä½ å¯ä»¥ä»æé«˜çš„é«˜ç©ºä»¥è‡ªèº«ä¸ºæ­¦å™¨ï¼Œå±•å¼€ATåŠ›åœºè¿›è¡Œæ¯ç­æ€§çš„å è½æ”»å‡»ï¼Œå¯¹åœ°é¢é€ æˆå·¨å¤§èŒƒå›´çš„ç ´åã€‚`],\n\n    [\"ç¬¬åä¸€ä½¿å¾’ææ€–å¤©ä½¿è¡€ç»Ÿ\", 27200, \"è¡€ç»Ÿ\", {A:1}, `\n        å±æ€§: æ™ºåŠ›+6, æ“æ§+6, å†³å¿ƒ+2, æ²‰ç€+2\n        èƒ½é‡æ± : æ•°æ®æµ(70)\n    `, `\n    - èƒŒæ™¯: ææ€–å¤©ä½¿æ˜¯çº³ç±³ç—…æ¯’é›†ç¾¤æ„æˆçš„ä½¿å¾’ã€‚æ¤å…¥å…¶èƒšèƒåï¼Œå¤–å½¢ä¸å˜ï¼Œä½†ä½ çš„æœ¬è´¨å·²åŒ–ä¸ºç—…æ¯’æœ¬èº«ã€‚\n    - ATåŠ›åœº: ä½ è·å¾—ä½¿å¾’å…±é€šçš„å¿ƒä¹‹å£èƒ½åŠ›ï¼Œèƒ½å±•å¼€å…«è¾¹å½¢çš„é—ªå…‰åŠ›åœºï¼ŒæŠµå¾¡å¤–ç•Œçš„ç‰©ç†å¹²æ¶‰å’Œä¼¤å®³ã€‚\n    - S2æœºå…³: ä½ æ‹¥æœ‰åä¸ºS2æœºå…³çš„æ°¸åŠ¨æ ¸å¿ƒï¼Œå®ƒèƒ½æºæºä¸æ–­åœ°äº§ç”Ÿèƒ½é‡ï¼Œå¹¶è®©ä½ æ— éœ€æ‘„é£Ÿå’Œå‘¼å¸ï¼Œä¹Ÿèƒ½åœ¨çœŸç©ºä¸­ç”Ÿå­˜ã€‚\n    - ç—…æ¯’åŒ–: ä½ å¯ä»¥å°†è‡ªå·±çš„æ„è¯†åŒ–ä¸ºæ•°æ®ï¼Œå…¥ä¾µå¹¶æ“æ§ä»»ä½•ç§‘æŠ€é€ ç‰©ã€‚åœ¨éª‡å…¥ç”µè„‘ã€é©¾é©¶è½½å…·æ–¹é¢ï¼Œä½ æ‹¥æœ‰æ— ä¸ä¼¦æ¯”çš„å¤©èµ‹ã€‚ä½ è¿˜å¯ä»¥é€šè¿‡æ¥è§¦æ¥æ„ŸæŸ“ç§‘æŠ€ç‰©å“ï¼Œä»è€Œéšæ—¶æŒæ¡å…¶ä½ç½®ã€‚`],\n\n    [\"ç¬¬åäºŒä½¿å¾’å¤œå¤©ä½¿è¡€ç»Ÿ\", 54400, \"è¡€ç»Ÿ\", {S:1}, `\n        å±æ€§: è€åŠ›+3, æ™ºåŠ›+2, æ„ŸçŸ¥+6, é£åº¦+6, æ“æ§+6, æ²‰ç€+6\n        èƒ½é‡æ± : è™šæ•°èƒ½é‡(100)\n    `, `\n    - èƒŒæ™¯: å¤œå¤©ä½¿æ˜¯å­˜åœ¨äºå¦ä¸€ä¸ªç»´åº¦çš„ä½¿å¾’ã€‚æ¤å…¥å…¶èƒšèƒåï¼Œèº«ä¸Šä¼šå‡ºç°é»‘ç™½æ¡çº¹ï¼Œäººä»¬çœ‹åˆ°çš„â€œèº«ä½“â€åªæ˜¯æŠ•å½±ï¼ŒçœŸèº«è—äºå½±å­ä¹‹ä¸­ã€‚\n    - åè½¬ATåŠ›åœº: ä½ çš„ATåŠ›åœºæä¸ºç‰¹æ®Šï¼Œå®ƒä¸ç›´æ¥æŠµæŒ¡ä¼¤å®³ï¼Œè€Œæ˜¯æ„æˆäº†ä¸€ä¸ªåä¸ºâ€œç‹„æ‹‰å…‹ä¹‹æµ·â€çš„è™šæ•°ç©ºé—´ï¼Œä½ çš„æœ¬ä½“å°±è—äºå…¶ä¸­ã€‚ä»»ä½•æ”»å‡»éƒ½æ— æ³•è§¦åŠä½äºå¦ä¸€ä¸ªç»´åº¦çš„ä½ ã€‚\n    - S2æœºå…³: ä½ æ‹¥æœ‰åä¸ºS2æœºå…³çš„æ°¸åŠ¨æ ¸å¿ƒï¼Œå®ƒèƒ½æºæºä¸æ–­åœ°äº§ç”Ÿèƒ½é‡ã€‚\n    - ç‹„æ‹‰å…‹ä¹‹æµ·: è¿™æ˜¯ç”±ä½ çš„ATåŠ›åœºç»´æŒçš„ç‹¬ç«‹ä½é¢ã€‚ä½ å¯ä»¥å°†èŒƒå›´å†…çš„æ•Œäººæˆ–ç‰©ä½“å¼ºè¡Œå¸å…¥å…¶ä¸­ã€‚è¿›å…¥ç‹„æ‹‰å…‹ä¹‹æµ·çš„æ•Œäººå°†å—åˆ°ä½é¢æ³•åˆ™çš„å‹åˆ¶ï¼Œå®åŠ›å¤§å‡ï¼Œè€Œä½ å¯ä»¥éšæ—¶ç¦»å¼€æˆ–è¿”å›è¿™ä¸ªå±äºä½ çš„é¢†åŸŸã€‚`],\n\n    [\"ç¬¬åä¸‰ä½¿å¾’éœå¤©ä½¿è¡€ç»Ÿ\", 27200, \"è¡€ç»Ÿ\", {A:1}, `\n        å±æ€§: è€åŠ›+4, æ„ŸçŸ¥+4, æ“æ§+4\n        èƒ½é‡æ± : ç”Ÿç‰©è´¨(70)\n    `, `\n    - èƒŒæ™¯: éœå¤©ä½¿æ˜¯èƒ½å¤Ÿä¾µèš€å’Œå¯„ç”Ÿçš„å¾®ç”Ÿç‰©é›†ç¾¤ã€‚æ¤å…¥å…¶èƒšèƒåå¤–å½¢ä¸å˜ï¼Œä½†ä½ çš„æœ¬ä½“å·²éè¡€è‚‰ä¹‹èº¯ã€‚\n    - ATåŠ›åœº: ä½ è·å¾—ä½¿å¾’å…±é€šçš„å¿ƒä¹‹å£èƒ½åŠ›ï¼Œèƒ½å±•å¼€å…«è¾¹å½¢çš„é—ªå…‰åŠ›åœºï¼ŒæŠµå¾¡å¤–ç•Œçš„ç‰©ç†å¹²æ¶‰å’Œä¼¤å®³ã€‚\n    - S2æœºå…³: ä½ æ‹¥æœ‰åä¸ºS2æœºå…³çš„æ°¸åŠ¨æ ¸å¿ƒï¼Œå®ƒèƒ½æºæºä¸æ–­åœ°äº§ç”Ÿèƒ½é‡ã€‚\n    - ä¾µèš€: ä½ å¯ä»¥å°†è‡ªå·±çš„å¾®ç”Ÿç‰©é›†ç¾¤ä¾µå…¥æ— åŠ©çš„æ´»ç‰©ä½“å†…ï¼Œé€šè¿‡æ„å¿—å¯¹æŠ—é€æ¸å¤ºå–å¯¹æ–¹çš„èº«ä½“æ§åˆ¶æƒã€‚æˆåŠŸåï¼Œä½ å¯ä»¥æ“æ§å…¶èº«ä½“ï¼Œä½¿ç”¨å…¶æŠ€èƒ½ï¼Œå¹¶ä¿ç•™è‡ªå·±çš„ATåŠ›åœºå’ŒS2æœºå…³ã€‚\n    - è‚‰ä½“å¼ºåŒ–: ä½ å¯ä»¥æ´»åŒ–å¹¶å¼ºåŒ–è¢«ä½ ä¾µå çš„æœ‰æœºä½“ï¼Œä½¿å…¶èº«ä½“æœºèƒ½å¾—åˆ°å¤§å¹…æå‡ã€‚\n    - å¾®ç”Ÿç‰©é›†ç¾¤: åœ¨ä½¿ç”¨è‡ªå·±èº«ä½“æ—¶ï¼Œä½ æ˜¯ä¸€ä¸ªç”±æ— æ•°å¾®ç”Ÿç‰©æ„æˆçš„é›†ç¾¤ç”Ÿç‰©ã€‚`],\n\n    [\"ç¬¬åå››ä½¿å¾’åŠ›å¤©ä½¿è¡€ç»Ÿ\", 54400, \"è¡€ç»Ÿ\", {S:1}, `\n        å±æ€§: åŠ›é‡+8, æ•æ·+2, è€åŠ›+5, æ„ŸçŸ¥+4, å†³å¿ƒ+8, é£åº¦+2\n        èƒ½é‡æ± : ATèƒ½é‡(110)\n    `, `\n    - èƒŒæ™¯: åŠ›å¤©ä½¿æ˜¯æœºèƒ½æœ€å®Œå–„ã€æ‹’ç»èƒ½åŠ›æœ€å¼ºçš„ä½¿å¾’ã€‚æ¤å…¥å…¶èƒšèƒåï¼Œèº«ä¸Šä¼šè¦†ç›–å¤©ç„¶è£…ç”²ï¼ŒèƒŒåé•¿å‡ºç»·å¸¦èˆ¬çš„ç¿…è†€ï¼ŒS2æœºå…³è¢«ä¿æŠ¤åœ¨ä½“å†…ã€‚\n    - å¤šé‡ATåŠ›åœº: ä½ çš„ATåŠ›åœºå¹¶éå•å±‚ï¼Œè€Œæ˜¯ç”±æ— æ•°å±‚åŠ›åœºå åŠ è€Œæˆã€‚è¿™ä½¿å®ƒä¸ä»…èƒ½æŠµå¾¡ä¼¤å®³ï¼Œè¿˜èƒ½å¸æ”¶ä¼¤å®³ï¼Œæéš¾è¢«ä¸­å’Œæˆ–çªç ´ã€‚\n    - ä½“å†…S2æœºå…³: ä½ çš„S2æœºå…³éšè—åœ¨ä½“å†…ï¼Œæ— æ³•è¢«ç›´æ¥æ”»å‡»ã€‚å¼ºå¤§çš„S2æœºå…³èƒ½é‡ç”šè‡³èƒ½è®©ä½ å°†ATåŠ›åœºåŒ–ä¸ºæ­¦å™¨ï¼Œç›´æ¥è¿›è¡Œè¿œç¨‹å‹è¿«æ”»å‡»ã€‚\n    - å¤©ç”Ÿè£…ç”²: ä½ è¦†ç›–å…¨èº«çš„å¤–å£³æ˜¯ä¸€ä»¶æ€§èƒ½ä¼˜è¶Šçš„å¤©ç„¶ç›”ç”²ï¼Œæä¾›å…¨æ–¹ä½çš„é˜²å¾¡ã€èƒ½é‡æŠ—æ€§ï¼Œå¹¶èµ‹äºˆä½ å®Œç¾çš„é£è¡Œèƒ½åŠ›ã€‚\n    - ä½¿å¾’æ­¦è£…: ä½ èƒ½ä»åŒçœ¼å‘å°„å¨åŠ›åª²ç¾é›·å¤©ä½¿çš„å¼ºåŒ–ç²’å­ç‚®ï¼Œè¿˜èƒ½ä»ç¿…è†€ä¸­å°„å‡ºåšç¡¬çš„ç»·å¸¦ï¼Œä»¥æé«˜çš„é€Ÿåº¦åˆ‡å‰²æ•Œäººã€‚`],\n\n    [\"ç¬¬åäº”ä½¿å¾’é¸Ÿå¤©ä½¿è¡€ç»Ÿ\", 21000, \"è¡€ç»Ÿ\", {A:1}, `\n        å±æ€§: åŠ›é‡+1, æ•æ·+5, è€åŠ›+1, æ„ŸçŸ¥+5, æ“æ§+2, æ²‰ç€+2\n        èƒ½é‡æ± : ç²¾ç¥åŠ›(70)\n    `, `\n    - èƒŒæ™¯: é¸Ÿå¤©ä½¿æ˜¯ä½äºå«æ˜Ÿè½¨é“ä¸Šçš„ç²¾ç¥æ”»å‡»å‹ä½¿å¾’ã€‚æ¤å…¥å…¶èƒšèƒåï¼Œèº«åä¼šé•¿å‡ºä¸‰å¯¹å·¨å¤§çš„ç™½è‰²ç¿…è†€ï¼Œçš®è‚¤å˜ä¸ºè‹è“è‰²ï¼Œå¹¶æŒç»­æ•£å‘è§å…‰ã€‚\n    - ATåŠ›åœº: ä½ è·å¾—ä½¿å¾’å…±é€šçš„å¿ƒä¹‹å£èƒ½åŠ›ï¼Œèƒ½å±•å¼€å…«è¾¹å½¢çš„é—ªå…‰åŠ›åœºï¼ŒæŠµå¾¡å¤–ç•Œçš„ç‰©ç†å¹²æ¶‰å’Œä¼¤å®³ã€‚\n    - S2æœºå…³: ä½ æ‹¥æœ‰åä¸ºS2æœºå…³çš„æ°¸åŠ¨æ ¸å¿ƒï¼Œå®ƒèƒ½æºæºä¸æ–­åœ°äº§ç”Ÿèƒ½é‡ã€‚\n    - é¸Ÿä¹‹è¯—: ä½ èº«åçš„å·¨å¤§ç¿…è†€èƒ½è®©ä½ ä»¥æé«˜çš„é€Ÿåº¦åœ¨å¤©ç©ºä¸­ç¿±ç¿”ã€‚\n    - å¿ƒçµæ‰«æ: ä½ èƒ½å‘å°„å‡ºç±»ä¼¼ATåŠ›åœºçš„å…‰æ³¢ï¼Œå¯¹æè¿œè·ç¦»å¤–çš„ç›®æ ‡è¿›è¡Œç²¾ç¥æ‰«æã€‚é€šè¿‡æ„å¿—å¯¹æŠ—ï¼Œä½ å¯ä»¥çª¥æ¢ç›®æ ‡çš„è¡¨å±‚æ€ç»´ï¼Œæ´å¯Ÿå…¶æ”»é˜²æ„å›¾ï¼Œç”šè‡³æŒ–æ˜å‡ºå…¶å†…å¿ƒæ·±å¤„è¢«é—å¿˜çš„è®°å¿†ã€‚`],\n\n    [\"ç¬¬åä¸ƒä½¿å¾’è‡ªç”±å¤©ä½¿è¡€ç»Ÿ\", 27200, \"è¡€ç»Ÿ\", {A:1}, `\n        å±æ€§: æ•æ·+3, æ„ŸçŸ¥+3, å†³å¿ƒ+3, æ²‰ç€+3\n        èƒ½é‡æ± : æ„å¿—ä¹‹åŠ›(70)\n    `, `\n    - èƒŒæ™¯: è‡ªç”±å¤©ä½¿æ˜¯æ‹¥æœ‰è‡ªç”±æ„å¿—çš„ä½¿å¾’ï¼Œä»£è¡¨ç€ä¸å—æŸç¼šçš„çµé­‚ã€‚æ¤å…¥å…¶èƒšèƒåï¼Œå¤–å½¢ä¼šå˜å¾—æ›´åŠ ä¿Šç¾ï¼Œå¤´å‘å˜ä¸ºç™½è‰²ã€‚\n    - ATåŠ›åœº: ä½ è·å¾—ä½¿å¾’å…±é€šçš„å¿ƒä¹‹å£èƒ½åŠ›ï¼Œèƒ½å±•å¼€å…«è¾¹å½¢çš„é—ªå…‰åŠ›åœºï¼ŒæŠµå¾¡å¤–ç•Œçš„ç‰©ç†å¹²æ¶‰å’Œä¼¤å®³ã€‚\n    - S2æœºå…³: ä½ æ‹¥æœ‰åä¸ºS2æœºå…³çš„æ°¸åŠ¨æ ¸å¿ƒï¼Œå®ƒèƒ½æºæºä¸æ–­åœ°äº§ç”Ÿèƒ½é‡ã€‚\n    - è‡ªç”±æ„å¿—: ä½ ä»£è¡¨ç€ç»å¯¹çš„è‡ªç”±ã€‚ä½ å®Œå…¨å…ç–«ä»»ä½•ç¯å¢ƒçš„è´Ÿé¢å½±å“ï¼Œå…ç–«æ‰€æœ‰ä¼šé™åˆ¶ä½ ç§»åŠ¨çš„çº ç¼ ã€ç–²åŠ³ç­‰çŠ¶æ€ï¼Œå…ç–«æ“’æŠ±ä¸æ‘”ç»Šï¼Œå…ç–«æ‰€æœ‰å¿ƒçµå±‚é¢çš„æ§åˆ¶ã€‚ä½ æ‹¥æœ‰å®Œç¾çš„é£è¡Œèƒ½åŠ›ï¼Œé™¤éä½ è‡ªæ„¿ï¼Œå¦åˆ™æ²¡æœ‰ä»€ä¹ˆèƒ½æŸç¼šä½ ã€‚`],\n  [\"Dçº§å–°ç§è¡€ç»Ÿ\", 6000, \"è¡€ç»Ÿ\", {D:1}, `\n        å±æ€§: åŠ›é‡+2, æ•æ·+1, è€åŠ›+2\n        èƒ½é‡æ± : èµ«å­èƒ½é‡(40)\n    `, `\n    - é£Ÿå°¸é¬¼ä½“è´¨: å–°ç§çš„èº«ä½“æœºèƒ½è¿œè¶…äººç±»ï¼Œæ‹¥æœ‰å¼ºå¤§çš„åŠ›é‡å’Œè‡ªæ„ˆèƒ½åŠ›ã€‚ä½†å¿…é¡»ä»¥äººç±»çš„è¡€è‚‰ä¸ºé£Ÿï¼Œæ™®é€šé£Ÿç‰©å‘³åŒåš¼èœ¡ä¸”æ— æ³•æä¾›è¥å…»ã€‚\n    - èµ«å­: ä½“å†…Rcç»†èƒçš„ç»“æ™¶ï¼Œæ˜¯å–°ç§çš„æ•é£Ÿå™¨å®˜ä¸æ­¦å™¨ã€‚å¯ä»¥ä»èº«ä½“ç‰¹å®šéƒ¨ä½ä¼¸å±•å‡ºä¸€ä¸ªèµ«å­ï¼Œå…¶å½¢æ€ï¼ˆå¦‚ç¾½èµ«ã€é³èµ«ã€ç”²èµ«ã€å°¾èµ«ï¼‰åœ¨è·å¾—è¡€ç»Ÿæ—¶å†³å®šã€‚\n    - èµ«çœ¼: åœ¨ä½¿ç”¨èƒ½åŠ›æˆ–æƒ…ç»ªæ¿€åŠ¨æ—¶ï¼Œå·©è†œä¼šå˜ä¸ºé»‘è‰²ï¼Œè™¹è†œå˜ä¸ºçº¢è‰²ï¼Œè¿™æ˜¯å–°ç§çš„æ ‡å¿—ã€‚\n    - CCGçš„å¤©æ•Œ: å–°ç§çš„èµ«å­åšéŸ§æ— æ¯”ï¼Œä½†å¯¹CCGå¼€å‘çš„â€œåº“å› å…‹â€æ­¦å™¨å¼‚å¸¸è„†å¼±ã€‚\n    æ½œè—äºäººç±»åŸå¸‚é˜´å½±ä¸­çš„æ•é£Ÿè€…ï¼Œä»–ä»¬æ‹¥æœ‰äººçš„å¤–è¡¨ï¼Œå´ä»¥äººä¸ºé£Ÿã€‚ä¸ºäº†ç”Ÿå­˜ï¼Œä»–ä»¬å¿…é¡»åœ¨é¥¥é¥¿çš„æœ¬èƒ½ä¸ä¼ªè£…çš„ç†æ€§ä¹‹é—´æŒ£æ‰ã€‚`],\n\n    [\"Cçº§å–°ç§è¡€ç»Ÿ\", 13000, \"è¡€ç»Ÿ\", {C:1}, `\n        å±æ€§: åŠ›é‡+3, æ•æ·+2, è€åŠ›+3\n        èƒ½é‡æ± : èµ«å­èƒ½é‡(55)\n    `, `\n    - æå‡ç‰¹æ€§-é£Ÿå°¸é¬¼ä½“è´¨: è‡ªæ„ˆèƒ½åŠ›å¾—åˆ°å¼ºåŒ–ï¼Œå³ä½¿æ˜¯ä¸¥é‡çš„åˆ›ä¼¤ä¹Ÿèƒ½åœ¨è¾ƒçŸ­æ—¶é—´å†…æ„ˆåˆã€‚å¯¹äººç±»è¡€è‚‰çš„æ¸´æ±‚ä¹Ÿæ›´ä¸ºå¼ºçƒˆã€‚\n    - èµ«å­æ“æ§: å¯¹èµ«å­çš„æ“æ§æ›´åŠ ç†Ÿç»ƒï¼Œå¯ä»¥è¿›è¡Œæ›´å¤æ‚ã€æ›´è¿…é€Ÿçš„æ”»å‡»ä¸é˜²å¾¡ã€‚èµ«å­çš„å°ºå¯¸ä¸å¨åŠ›ä¹Ÿå¾—åˆ°æå‡ã€‚\n    é€‚åº”äº†ç‹©çŒä¸è¢«ç‹©çŒçš„ç”Ÿæ´»ï¼Œå–°ç§çš„æœ¬èƒ½è¢«è¿›ä¸€æ­¥ç£¨ç ºã€‚ä»–ä»¬ä¸å†æ˜¯æŒ£æ‰æ±‚ç”Ÿçš„æ–°æ‰‹ï¼Œè€Œæ˜¯éƒ½å¸‚ä¸›æ—ä¸­åˆæ ¼çš„çŒæ‰‹ã€‚`],\n\n    [\"Bçº§å–°ç§è¡€ç»Ÿ\", 21000, \"è¡€ç»Ÿ\", {B:1}, `\n        å±æ€§: åŠ›é‡+4, æ•æ·+3, è€åŠ›+4, æ„ŸçŸ¥+1\n        èƒ½é‡æ± : èµ«å­èƒ½é‡(70)\n    `, `\n    - æå‡ç‰¹æ€§-é£Ÿå°¸é¬¼ä½“è´¨: èº«ä½“å¼ºåº¦å¤§å¹…æå‡ï¼Œè‡ªæ„ˆèƒ½åŠ›è¾¾åˆ°æ–­è‚¢å†ç”Ÿçš„ç¨‹åº¦ã€‚\n    - èµ«è€…ä¹‹é³: é€šè¿‡åå™¬å…¶ä»–å–°ç§çš„èµ«å­ï¼Œå¯ä»¥æš‚æ—¶æ€§åœ°å¼ºåŒ–è‡ªèº«ï¼Œç”šè‡³æ¼”åŒ–å‡ºä¸å®Œæ•´çš„èµ«è€…å¤–å£³ï¼ˆåŠèµ«è€…ï¼‰ï¼Œè·å¾—ä¸´æ—¶çš„å¼ºå¤§åŠ›é‡ä¸é˜²å¾¡ï¼Œä½†æœ‰å¤±æ§çš„é£é™©ã€‚\n    åœ¨åŒç±»çš„ç›¸é£Ÿä¸­ï¼Œå¯»æ±‚ç€è¿›åŒ–çš„å¯èƒ½æ€§ã€‚è·¨è¶Šç¦å¿Œçš„å–°ç§å°†è·å¾—æ›´å¼ºå¤§çš„åŠ›é‡ï¼Œä½†ä¹Ÿè¦æ‰¿æ‹…è¢«ç–¯ç‹‚åå™¬çš„é£é™©ã€‚`],\n\n    [\"Açº§ç‹¬çœ¼å–°ç§è¡€ç»Ÿ\", 33000, \"è¡€ç»Ÿ\", {A:1}, `\n        å±æ€§: åŠ›é‡+6, æ•æ·+5, è€åŠ›+6, å†³å¿ƒ+2\n        èƒ½é‡æ± : èµ«å­èƒ½é‡(90)\n    `, `\n    - ç‹¬çœ¼ä¹‹ç‹: ä½œä¸ºäººç±»ä¸å–°ç§çš„æ··è¡€ï¼Œå…¶æ½œåŠ›è¿œè¶…æ™®é€šå–°ç§ã€‚åªåœ¨å•çœ¼å‘ˆç°èµ«çœ¼ï¼Œä½†Rcç»†èƒçš„æ´»æ€§ä¸æ€»é‡éƒ½è¾¾åˆ°äº†æƒŠäººçš„æ°´å¹³ã€‚\n    - å®Œå…¨èµ«è€…åŒ–: èƒ½å¤Ÿå®Œå…¨æŒæ§åå™¬åŒç±»è·å¾—çš„åŠ›é‡ï¼Œå°†èµ«å­è¦†ç›–å…¨èº«ï¼ŒåŒ–ä¸ºåšä¸å¯æ‘§çš„â€œèµ«è€…â€å½¢æ€ã€‚åœ¨æ­¤å½¢æ€ä¸‹ï¼Œèº«ä½“èƒ½åŠ›å¾—åˆ°é£è·ƒæ€§æå‡ï¼Œä¸”ä¸ä¼šä¸§å¤±ç†æ™ºã€‚\n    - çªç ´ç•Œé™: ç‹¬çœ¼å–°ç§çš„æˆé•¿æ²¡æœ‰æé™ï¼Œæ¯ä¸€æ¬¡è¶…è¶Šç”Ÿæ­»çš„æˆ˜æ–—éƒ½æœ‰å¯èƒ½è®©å…¶èµ«å­äº§ç”Ÿæ–°çš„å˜å¼‚å’Œè¿›åŒ–ã€‚\n    æ—¢ä¸å±äºäººç±»ï¼Œä¹Ÿä¸å±äºå–°ç§çš„å­¤ç‹¬å­˜åœ¨ã€‚è¿™ä»½ä¸ç”Ÿä¿±æ¥çš„çŸ›ç›¾ä¸ç—›è‹¦ï¼Œé€ å°±äº†è¶…è¶Šä¸¤ä¸ªç§æ—çš„ç‹è€…ã€‚ä»–æ˜¯æ‰€æœ‰å–°ç§çš„é¡¶ç‚¹ï¼Œä¹Ÿæ˜¯è¿æ¥ä¸¤ä¸ªä¸–ç•Œçš„å”¯ä¸€æ¡¥æ¢ã€‚`],\n\n    [\"ç‹¼äººè¡€ç»Ÿ\", 7000, \"è¡€ç»Ÿ\", {D:1}, `\n        å±æ€§: åŠ›é‡+3, è€åŠ›+2, æ„ŸçŸ¥+1\n        èƒ½é‡æ± : æ€’æ°”(35)\n    `, `\n    - æœˆå¤œç‹‚æš´: åœ¨æœˆåœ†ä¹‹å¤œï¼Œä¼šå¼ºåˆ¶å˜èº«ä¸ºç‹¼äººå½¢æ€ï¼Œå¤±å»ç†æ™ºï¼Œæ”»å‡»æ€§å¤§å¹…å¢å¼ºï¼Œç‰©ç†æŠ—æ€§æå‡ï¼Œä½†æ— æ³•ä½¿ç”¨è£…å¤‡å’Œç²¾ç»†æŠ€èƒ½ã€‚\n    - ç‹¼ä¹‹å—…è§‰: æ‹¥æœ‰æä¸ºçµæ•çš„å—…è§‰ï¼Œèƒ½å¤Ÿè¿½è¸ªæ°”å‘³ï¼Œåˆ†è¾¨æƒ…ç»ªï¼Œå¹¶æ„ŸçŸ¥åˆ°éšè—çš„æ•Œäººã€‚\n    - é“¶ä¹‹æ¯’: å¯¹é“¶åˆ¶å“æœ‰å¤©ç”Ÿçš„ææƒ§å’Œè„†å¼±æ€§ï¼Œæ¥è§¦é“¶ä¼šé€ æˆä¸¥é‡çš„çƒ§ç¼ä¼¤å®³å¹¶æŠ‘åˆ¶è‡ªæ„ˆèƒ½åŠ›ã€‚\n    å¤è€çš„è¯…å’’åœ¨è¡€è„‰ä¸­æµæ·Œï¼Œæœˆäº®æ˜¯å…¶åŠ›é‡çš„æºæ³‰ï¼Œä¹Ÿæ˜¯å…¶ç–¯ç‹‚çš„å¼€å…³ã€‚æ¯å½“æœˆåœ†ä¹‹æ—¶ï¼Œäººæ€§çš„æ·é”ä¾¿ä¼šè¢«æŒ£è„±ã€‚`],\n\n    [\"å¤´ç‹¼è¡€ç»Ÿ\", 16000, \"è¡€ç»Ÿ\", {C:1}, `\n        å±æ€§: åŠ›é‡+4, è€åŠ›+3, æ„ŸçŸ¥+2, å†³å¿ƒ+1\n        èƒ½é‡æ± : æ€’æ°”(50)\n    `, `\n    - è‡ªç”±å˜èº«: ä¸å†å®Œå…¨å—æœˆäº®çš„å½±å“ï¼Œå¯ä»¥é€šè¿‡æ¶ˆè€—æ€’æ°”ï¼Œä¸»åŠ¨åœ¨äººç±»ä¸ç‹¼äººå½¢æ€ä¹‹é—´åˆ‡æ¢ï¼Œå¹¶èƒ½åœ¨å˜èº«åä¿æŒéƒ¨åˆ†ç†æ™ºã€‚\n    - æ„ŸæŸ“ä¹‹å’¬: ç‹¼äººå½¢æ€ä¸‹çš„å•ƒå’¬é™„å¸¦è¯…å’’ï¼Œè‹¥ç›®æ ‡åœ¨æ’•å’¬ä¸‹å­˜æ´»ï¼Œä¾¿æœ‰ä¸€å®šå‡ ç‡è¢«è½¬åŒ–ä¸ºæ–°çš„ç‹¼äººã€‚\n    - æå‡ç‰¹æ€§-ç‹¼ä¹‹å—…è§‰: æ„Ÿå®˜è¿›ä¸€æ­¥å¼ºåŒ–ï¼Œèƒ½å¤Ÿé€šè¿‡æ°”å‘³åˆ†è¾¨è°è¨€ã€‚\n    ä»–ä»¬å­¦ä¼šäº†æ§åˆ¶è¡€è„‰ä¸­çš„é‡æ€§ï¼Œæˆä¸ºäº†å…½ç¾¤çš„é¢†è¢–ã€‚ä¸å†æ˜¯å•çº¯è¢«æœ¬èƒ½é©±ä½¿çš„æ€ªç‰©ï¼Œè€Œæ˜¯èƒ½å¤Ÿè¿ç”¨è¯…å’’åŠ›é‡çš„æˆ˜å£«ã€‚`],\n\n    [\"é­”ç‹¼è¡€ç»Ÿ\", 24000, \"è¡€ç»Ÿ\", {B:1}, `\n        å±æ€§: åŠ›é‡+5, æ•æ·+2, è€åŠ›+5, æ„ŸçŸ¥+3\n        èƒ½é‡æ± : æ€’æ°”(65)\n    `, `\n    - äººç‹¼ä¸€ä½“: èƒ½å¤Ÿè¿›å…¥å®Œç¾çš„â€œäººç‹¼â€å½¢æ€ï¼Œå…¼å…·äººç±»çš„æ™ºæ…§ä¸ç‹¼äººçš„åŠ›é‡ã€‚æ­¤å½¢æ€ä¸‹å¯ä»¥ä½¿ç”¨æ­¦å™¨å’ŒæŠ€èƒ½ï¼Œå¹¶ä¸”ä½“å‹æ›´åŠ çŸ«å¥ï¼Œé€Ÿåº¦ä¸åŠ›é‡å¹¶å­˜ã€‚\n    - å†ç”Ÿä¹‹èº¯: æ‹¥æœ‰å¼ºå¤§çš„å†ç”Ÿèƒ½åŠ›ï¼Œé™¤éå‡»ä¸­å¤´éƒ¨æˆ–å¿ƒè„ï¼Œå¦åˆ™ç»å¤§å¤šæ•°ç‰©ç†ä¼¤å®³éƒ½èƒ½å¿«é€Ÿæ„ˆåˆã€‚å¯¹é“¶çš„è„†å¼±æ€§æœ‰æ‰€é™ä½ï¼Œä½†ä»æ˜¯å…¶æœ€å¤§å¼±ç‚¹ã€‚\n    - ç»Ÿå¾¡ç‹¼ç¾¤: èƒ½å¤Ÿé€šè¿‡åšå«ä¸ç²¾ç¥åŠ›ï¼Œå¯¹å…¶ä»–ç‹¼æˆ–ç‹¼äººè¿›è¡Œä¸€å®šç¨‹åº¦çš„æŒ‡æŒ¥å’Œç»Ÿå¾¡ã€‚\n    æŒ£è„±äº†è¯…å’’çš„æŸç¼šï¼Œå°†é‡æ€§ä¸äººæ€§å®Œç¾èåˆï¼Œæˆä¸ºäº†æœˆå¤œä¸‹çœŸæ­£çš„ç»Ÿæ²»è€…ã€‚å…¶å­˜åœ¨æœ¬èº«å°±æ˜¯åŠ›é‡ä¸è‡ªç”±çš„è±¡å¾ã€‚`],\n\n    [\"ç²¾çµè¡€ç»Ÿ\", 7500, \"è¡€ç»Ÿ\", {D:1}, `\n        å±æ€§: æ•æ·+2, æ„ŸçŸ¥+2, é£åº¦+2\n        èƒ½é‡æ± : è‡ªç„¶é­”åŠ›(40)\n    `, `\n    - é•¿å¯¿ç§: æ‹¥æœ‰æ¼«é•¿çš„ç”Ÿå‘½ï¼Œå¯¹æ—¶é—´çš„æµé€æœ‰ä¸åŒçš„æ„Ÿå—ã€‚è‡ªç„¶è¡°è€æå…¶ç¼“æ…¢ã€‚\n    - æ£®æ—ä¹‹å­: åœ¨æ£®æ—ã€è‰åŸç­‰è‡ªç„¶ç¯å¢ƒä¸­ï¼Œæ„ŸçŸ¥èƒ½åŠ›å’Œç§»åŠ¨é€Ÿåº¦ä¼šå¾—åˆ°æå‡ã€‚èƒ½ä¸å¤§éƒ¨åˆ†æ¸©é¡ºçš„åŠ¨ç‰©è¿›è¡Œç®€å•çš„æ²Ÿé€šã€‚\n    - ä¼˜é›…èº«å§¿: å¤©ç”Ÿæ‹¥æœ‰è½»ç›ˆçš„ä½“æ€å’Œåè°ƒçš„åŠ¨ä½œï¼Œåœ¨è¿›è¡Œå°„å‡»ã€æ½œè¡Œå’Œéœ€è¦çµå·§çš„è¡ŒåŠ¨æ—¶å…·å¤‡ä¼˜åŠ¿ã€‚\n    - é’¢é“ä¹‹åŒ: å¯¹å¤§è§„æ¨¡çš„å·¥ä¸šé€ ç‰©å’Œçº¯ç²¹çš„ç§‘æŠ€ç¯å¢ƒæ„Ÿåˆ°æœ¬èƒ½çš„æ’æ–¥å’Œä¸é€‚ã€‚\n    è¯ç”Ÿè‡ªå¤è€æ£®æ—çš„ä¼˜é›…ç§æ—ï¼Œä¸è‡ªç„¶ä¸‡ç‰©å’Œè°å…±ç”Ÿã€‚ä»–ä»¬çš„ç”Ÿå‘½å¦‚æ—é—´æ¸…æ³‰èˆ¬æ‚ é•¿ï¼Œä»–ä»¬çš„ç®­çŸ¢å¦‚æµæ˜Ÿèˆ¬ç²¾å‡†ã€‚`],\n\n    [\"é«˜ç­‰ç²¾çµè¡€ç»Ÿ\", 17000, \"è¡€ç»Ÿ\", {C:1}, `\n        å±æ€§: æ•æ·+3, æ„ŸçŸ¥+3, æ™ºåŠ›+2, é£åº¦+3\n        èƒ½é‡æ± : å¥¥æœ¯èƒ½é‡(55)\n    `, `\n    - å¥¥æœ¯äº²å’Œ: è¡€è„‰ä¸­æµæ·Œç€å¯¹é­”æ³•èƒ½é‡çš„å¤©ç„¶äº²å’ŒåŠ›ï¼Œå­¦ä¹ å’Œæ–½å±•é­”æ³•äº‹åŠåŠŸå€ï¼Œå¹¶èƒ½æ„Ÿå—åˆ°ç¯å¢ƒä¸­çš„é­”åŠ›æµåŠ¨ã€‚\n    - å¿ƒçµæ„Ÿåº”: èƒ½å¤Ÿä¸è¡€è„‰ç›¸è¿‘æˆ–å…³ç³»äº²å¯†çš„åŒä¼´è¿›è¡ŒçŸ­è·ç¦»çš„å¿ƒçµæ²Ÿé€šã€‚\n    - æå‡ç‰¹æ€§-ä¼˜é›…èº«å§¿: åŠ¨ä½œå¦‚èˆè¹ˆèˆ¬ä¼˜é›…ï¼Œèƒ½é€šè¿‡ä¸“æ³¨æ¥å¼ºåŒ–è‡ªèº«çš„é—ªé¿èƒ½åŠ›ã€‚\n    ä»–ä»¬æ˜¯ç²¾çµä¸­èµ°ä¸Šé­”æ³•ä¹‹è·¯çš„ä¸€æ”¯ï¼Œä¸å†ä»…ä»…æ»¡è¶³äºè‡ªç„¶çš„æ©èµï¼Œè€Œæ˜¯å¼€å§‹æ¢æ±‚ä¸–ç•ŒèƒŒåçš„å¥¥ç§˜æ³•åˆ™ã€‚æ™ºæ…§ä¸ä¼˜é›…åœ¨ä»–ä»¬èº«ä¸Šèä¸ºä¸€ä½“ã€‚`],\n\n    [\"å¤ä»£é¾™è£”è¡€ç»Ÿ\", 38000, \"è¡€ç»Ÿ\", {S:1}, `\n        å±æ€§: åŠ›é‡+7, è€åŠ›+7, å†³å¿ƒ+6, æ™ºåŠ›+5\n        èƒ½é‡æ± : é¾™ä¹‹è¡€(100)\n    `, `\n    - é¾™é­‚: ä½ çš„çµé­‚æœ¬è´¨æ˜¯é¾™ï¼Œè¿™è®©ä½ æ‹¥æœ‰é’¢é“èˆ¬çš„æ„å¿—ï¼Œå…ç–«ç»å¤§å¤šæ•°ç²¾ç¥æ§åˆ¶å’Œææƒ§æ•ˆæœã€‚\n    - å…ƒç´ åæ¯: å¯ä»¥åœ¨æ•°ç§å¼ºå¤§çš„å…ƒç´ åæ¯ä¸­é€‰æ‹©å…¶ä¸€ï¼ˆç«ç„°ã€å¯’å†°ã€é—ªç”µã€å¼ºé…¸ï¼‰ï¼Œä½œä¸ºä½ ä¸ç”Ÿä¿±æ¥çš„æ¯ç­æ€§æ­¦å™¨ã€‚\n    - é¾™é³ç”²: èº«ä½“è¡¨é¢è¦†ç›–ç€åšä¸å¯æ‘§çš„é¾™é³ï¼Œæä¾›æé«˜çš„ç‰©ç†ä¸èƒ½é‡ä¼¤å®³å‡å…ã€‚\n    - å·¨é¾™ä¹‹åŠ›: è‚‰ä½“åŠ›é‡è¾¾åˆ°ç”Ÿç‰©çš„é¡¶å³°ï¼Œè¿‘æˆ˜æ”»å‡»é™„å¸¦å¼ºå¤§çš„å†²å‡»åŠ›ï¼Œå¹¶ä¸”æ‹¥æœ‰åœ¨ä»»ä½•ç¯å¢ƒä¸‹ç”Ÿå­˜çš„èƒ½åŠ›ï¼ŒåŒ…æ‹¬çœŸç©ºå’Œæ·±æµ·ã€‚å¯ä»¥æ¶ˆè€—å¤§é‡èƒ½é‡ï¼Œåœ¨çŸ­æ—¶é—´å†…åŒ–ä¸ºä¸€å¤´é®å¤©è”½æ—¥çš„å·¨é¾™çœŸèº«ã€‚\n    ä½ æ˜¯è¿œå¤å·¨é¾™è¡€è„‰æœ€çº¯ç²¹çš„ç»§æ‰¿è€…ï¼Œæ˜¯è¡Œèµ°äºå¤§åœ°çš„æ´»ä¼ å¥‡ã€‚ä½ çš„å­˜åœ¨æœ¬èº«ï¼Œå°±æ˜¯åŠ›é‡ã€å¨ä¸¥ä¸ä¸æœ½çš„ä»£åè¯ã€‚`],\n     [\"ã€Dã€‘ç¨€è–„çš„ç¥–è¡€\", 2200, \"è¡€ç»Ÿ\", {}, \"å±æ€§: åŠ›é‡+1, è€åŠ›+1\\nèƒ½é‡æ± : é­”åŠ›(10)\", \"è¿™æ˜¯ç¬¬å››çœŸç¥–è¡€è„‰æœ€å¾®æœ«çš„æ˜¾ç°ã€‚æ‹¥æœ‰è€…èº«ä½“ç´ è´¨ç•¥å¼ºäºå¸¸äººï¼Œå¶å°”ä¼šåœ¨å¼ºçƒˆçš„æƒ…æ„Ÿæ³¢åŠ¨ä¸­æ„Ÿå—åˆ°éš¾ä»¥æŠ‘åˆ¶çš„é¥¥æ¸´ã€‚æ­¤åˆ»ï¼Œå¤è€çš„ä¼ æ‰¿ä»…ä»…æ˜¯åœ¨æ²‰ç¡ä¸­ä½è¯­ï¼Œç­‰å¾…ç€è¢«å”¤é†’çš„å¥‘æœºã€‚\"],\n  [\"ã€Cã€‘è§‰é†’çš„ç¥–è¡€\", 8500, \"è¡€ç»Ÿ\", {}, \"å±æ€§: åŠ›é‡+2, æ•æ·+2, è€åŠ›+2\\nèƒ½é‡æ± : é­”åŠ›(30)\", \"å¤è€çš„è¡€æ¶²å¼€å§‹è‹é†’ï¼Œå¸è¡€å†²åŠ¨å˜å¾—æ›´åŠ æ˜ç¡®ï¼Œå¹¶ä¸ç‰¹å®šçš„æƒ…æ„Ÿç´§å¯†ç›¸è¿ã€‚ä¸è€ä¸æ­»å’Œè¶…é€Ÿå†ç”Ÿçš„ç‰¹æ€§åˆéœ²ç«¯å€ªï¼Œè™½ç„¶æ¢å¤åŠ›å°šå¼±ï¼Œä½†å·²ç„¶è¶…è¶Šå‡¡äººçš„ç•Œé™ã€‚æ‹¥æœ‰è€…èƒ½å¤Ÿæ„Ÿå—åˆ°ä½“å†…æ½œè—çš„ã€å°šæœªæˆå‹çš„çœ·å…½ä¹‹åŠ›ã€‚\"],\n  [\"ã€Bã€‘ç»Ÿå¾¡çš„ç¥–è¡€\", 18000, \"è¡€ç»Ÿ\", {\"C\": 1}, \"å±æ€§: åŠ›é‡+3, æ•æ·+3, è€åŠ›+4, æ²‰ç€+2\\nèƒ½é‡æ± : é­”åŠ›(80)\", \"çœŸç¥–çš„åŠ›é‡è¿›ä¸€æ­¥è§£æ”¾ï¼Œè®©æ‹¥æœ‰è€…èƒ½å¤Ÿåˆæ­¥é©¾é©­ä¸€åˆ°ä¸¤åªçœ·å…½ã€‚å¸é£Ÿçµåª’ä¹‹è¡€åï¼ŒåŠ›é‡ä¼šå¾—åˆ°æ˜¾è‘—å¢å¼ºã€‚â€œè¡€ä¹‹ä¼´ä¾£â€çš„å¥‘çº¦å˜å¾—å¯èƒ½ï¼Œä¸ä»–äººçš„ç¾ç»Šå°†æˆä¸ºåŠ›é‡çš„ä¸€éƒ¨åˆ†ã€‚ç‰©ç†ä¼¤å®³çš„æ¢å¤é€Ÿåº¦å¤§å¹…æå‡ã€‚\"],\n  [\"ã€Aã€‘ç¾å„çš„ç¥–è¡€\", 35000, \"è¡€ç»Ÿ\", {\"B\": 1}, \"å±æ€§: åŠ›é‡+5, æ•æ·+4, è€åŠ›+6, æ“æ§+4\\nèƒ½é‡æ± : é­”åŠ›(200)\", \"ç‡é¢†ç¾å„åŒ–èº«çš„åŠ›é‡å·²è¶‹äºå®Œæ•´ã€‚å·²èƒ½ç†Ÿç»ƒæ”¯é…å¤æ•°çš„å¼ºå¤§çœ·å…½ï¼Œå…¶å­˜åœ¨æœ¬èº«å°±è¶³ä»¥æ‰­æ›²å¸¸ç†ã€‚é€šè¿‡ä¸çµåª’ç¼”ç»“â€œè¡€ä¹‹ä¼´ä¾£â€çš„å¥‘çº¦ï¼Œå¯ä»¥å®Œå…¨é‡Šæ”¾çœ·å…½çš„æ½œèƒ½ï¼Œæˆä¸ºè¡Œèµ°äºä¸–é—´çš„ä¼ è¯´ã€‚\"],\n  [\"ã€Sã€‘ç¬¬å››çœŸç¥–ä¹‹è¡€\", 50000, \"è¡€ç»Ÿ\", {\"A\": 1}, \"å±æ€§: åŠ›é‡+8, æ•æ·+6, è€åŠ›+8, æ™ºåŠ›+5, æ“æ§+6, é£åº¦+5\\nèƒ½é‡æ± : é­”åŠ›(500)\", \"ä¸åº”å­˜äºä¸–çš„æ¢¦å¹»è¡€è„‰ï¼Œä¸–ç•Œæœ€å¼ºçš„å¸è¡€é¬¼ä¹‹è¯ã€‚å®Œç¾çš„ä¸è€ä¸æ­»ä¹‹èº¯ï¼Œæ”¯é…å…¨éƒ¨åäºŒåªç¾å„åŒ–èº«çš„çœ·å…½ã€‚æ¯ä¸€æ¬¡å¸è¡€éƒ½æ˜¯ä¸€åœºå›ä¸´çš„ä»ªå¼ï¼Œå°†çµåª’çš„çµé­‚ä¸è‡ªå·±çš„ç‹åº§ç›¸è¿ï¼Œé‡Šæ”¾å‡ºè¶³ä»¥é¢ è¦†ä¸–ç•Œçš„åŠ›é‡ã€‚\"],\n  [\"çµåª’ä¹‹è¡€ï¼ˆç“¶è£…ï¼‰\", 800, \"ç‰©å“\", {}, \"æ•ˆæœ: ä¸€æ¬¡æ€§é“å…·ã€‚åœ¨è¿›è¡Œå¸è¡€æ—¶ä½¿ç”¨ï¼Œå¯è§¦å‘ä¸€æ¬¡åŠ›é‡è§‰é†’çš„åˆ¤å®šï¼Œæœ‰å¾®å°å‡ ç‡è§£é”ä¸€ä¸ªæœªæ¿€æ´»çš„æŠ€èƒ½æˆ–å¼ºåŒ–ç°æœ‰è¡€ç»Ÿèƒ½åŠ›ã€‚\", \"ä»æ‹¥æœ‰é«˜é˜¶çµåª’ä½“è´¨çš„äººèº«ä¸Šè·å–çš„è¡€æ¶²ï¼Œè¢«å°å¿ƒåœ°ä¿å­˜åœ¨è¿™ä¸ªå®¹å™¨ä¸­ã€‚å®ƒæ•£å‘ç€å¯¹å¸è¡€é¬¼è€Œè¨€æ— æ¯”ç”˜ç¾çš„æ°”æ¯ï¼Œæ˜¯å”¤é†’æ²‰ç¡åŠ›é‡çš„é’¥åŒ™ï¼Œä¹Ÿæ˜¯ç¼”ç»“ç¥åœ£å¥‘çº¦çš„ç¥­å“ã€‚\"],\n  [\"è¡€ä¹‹ä¼´ä¾£çš„å¥‘çº¦å°è®°\", 15000, \"ç‰©å“\", {\"B\":1}, \"æ•ˆæœ: è£…å¤‡ã€‚å½“ä¸ç¼”ç»“äº†â€œè¡€ä¹‹ä¼´ä¾£â€å¥‘çº¦çš„è§’è‰²å…±åŒè¡ŒåŠ¨æ—¶ï¼ŒåŒæ–¹æ‰€æœ‰å±æ€§åˆ¤å®šè·å¾—dp+1çš„åŠ æˆã€‚æ­¤ç‰©å“ä¸ºå”¯ä¸€æ€§ï¼Œä¸å¯é‡å¤è·å¾—ã€‚\", \"è¿™ä¸æ˜¯ä¸€ä¸ªå®ä½“ç‰©å“ï¼Œè€Œæ˜¯çµé­‚å±‚é¢æ·±åˆ»ç¾ç»Šçš„è¯æ˜ã€‚å®ƒè±¡å¾ç€ä¸»å›ä¸ä¼´ä¾£é—´çš„ç»å¯¹ä¿¡èµ–ä¸é­”åŠ›è¿æ¥ï¼Œå½“å½¼æ­¤å¹¶è‚©æ—¶ï¼Œè¿™ä»½ç¾ç»Šå°†åŒ–ä¸ºè¶…è¶Šä¸€åˆ‡çš„å®ˆæŠ¤ä¹‹åŠ›ã€‚\"],\n  [\"ã€è¢«åŠ¨ã€‘å¸è¡€å†²åŠ¨\", 3000, \"æŠ€èƒ½\", {}, \"æ•ˆæœ: ã€dp+0;èƒ½é‡æ± -0ã€‘\", \"è¯¥æŠ€èƒ½ä¸ºè¢«åŠ¨è§¦å‘ã€‚å½“è§’è‰²é™·å…¥â€œæ€§å…´å¥‹â€çŠ¶æ€æ—¶ï¼Œå°†è·å¾—â€œå¸è¡€â€æŒ‡ä»¤çš„è®¸å¯ï¼Œå¯ä»¥å¯¹è‡ªæ„¿çš„ã€æ‹¥æœ‰å¼ºå¤§çµåŠ›çš„å¼‚æ€§ä½¿ç”¨ã€‚æˆåŠŸå¸è¡€æ˜¯è§‰é†’çœ·å…½å’Œå¢å¼ºåŠ›é‡çš„å”¯ä¸€é€”å¾„ã€‚\"],\n  [\"ã€çœ·å±ã€‘è¡€ä¹‹ä¼´ä¾£\", 8000, \"æŠ€èƒ½\", {\"C\":1}, \"æ•ˆæœ: ã€dp+0;èƒ½é‡æ± -50ã€‘\", \"é€šè¿‡å¸è¡€ä»ªå¼ï¼Œå°†ä¸€ä½æ‹¥æœ‰é«˜é˜¶çµåª’ä½“è´¨çš„å¼‚æ€§è½¬åŒ–ä¸ºâ€œè¡€ä¹‹éšä»â€ã€‚å¯¹æ–¹å°†è·å¾—ä¸æ­»æ€§ï¼Œå¹¶ä¸ä½ å…±äº«é­”åŠ›æ± ã€‚æ¯æ‹¥æœ‰ä¸€åè¡€ä¹‹ä¼´ä¾£ï¼Œä½ çš„èƒ½é‡æ± ä¸Šé™æå‡20ç‚¹ã€‚\"],\n  [\"ã€çœ·å…½ã€‘ç¥ç¾Šä¹‹é‡‘åˆš\", 9000, \"æŠ€èƒ½\", {}, \"æ•ˆæœ: ã€dp+1;èƒ½é‡æ± -60ã€‘\", \"å¬å”¤å‡ºé‡‘åˆšçŸ³æ„æˆçš„å¤§è§’ç¾Šã€‚å¯å‘åŠ¨ä¸€æ¬¡ç»å¯¹é˜²å¾¡ï¼Œå®Œå…¨åå¼¹ä¸€æ¬¡æŒ‡å‘æ€§æ”»å‡»ã€‚ä¹‹åçš„å›åˆä¸­ï¼Œå¯å°†æ¼‚æµ®çš„å®çŸ³ç»“æ™¶åŒ–ä¸ºæŠ¤ç›¾æˆ–æŠ•å°„ç‰©ï¼Œè¿›è¡Œé˜²å¾¡æˆ–æ”»å‡»ã€‚\"],\n  [\"ã€çœ·å…½ã€‘ç‰›å¤´ç‹ä¹‹ç¥ç€\", 8500, \"æŠ€èƒ½\", {}, \"æ•ˆæœ: ã€dp+1;èƒ½é‡æ± -55ã€‘\", \"å¬å”¤å‡ºç”±ç†”å²©æ„æˆçš„ç‰›å¤´ç¥ã€‚å…¶å·¨å¤§çš„æˆ˜æ–§èƒ½å¤Ÿå‘åŠ¨æ— è§†ä»»ä½•é­”æ³•æˆ–èƒ½é‡æŠ¤ç›¾çš„çº¯ç²¹ç‰©ç†æ”»å‡»ï¼Œæ˜¯æ”»ç ´ç»“ç•Œå’Œå±éšœçš„ç»å¯¹åŠ›é‡ã€‚\"],\n  [\"ã€çœ·å…½ã€‘é¾™è›‡ä¹‹æ°´é“¶\", 11000, \"æŠ€èƒ½\", {}, \"æ•ˆæœ: ã€dp+2;èƒ½é‡æ± -75ã€‘\", \"å¬å”¤åŒå¤´é¾™è›‡ã€‚å…¶èƒ½åŠ›æ˜¯æ¬¡å…ƒåå™¬ï¼Œå¯ä»¥æŒ‡å®šä¸€ä¸ªç›®æ ‡æˆ–ä¸€ç‰‡åŒºåŸŸï¼Œå°†å…¶ä»ç©ºé—´ä¸­å½»åº•æŠ¹é™¤ï¼Œæ— è®ºæ˜¯å®ä½“ã€èƒ½é‡è¿˜æ˜¯æ¦‚å¿µï¼Œéƒ½æ— æ³•å¹¸å…ã€‚\"],\n  [\"ã€çœ·å…½ã€‘ç”²å£³ä¹‹é“¶é›¾\", 7500, \"æŠ€èƒ½\", {}, \"æ•ˆæœ: ã€dp+1;èƒ½é‡æ± -40ã€‘\", \"å¬å”¤é“¶é›¾ç”²å£³å…½ï¼Œå°†æŒ‡å®šèŒƒå›´å†…çš„ä¸€åˆ‡ç‰©è´¨ï¼ˆå®åŠ›ä½äºè‡ªèº«ï¼‰éƒ½å¼ºåˆ¶é›¾åŒ–ï¼Œä½¿å…¶æš‚æ—¶å¤±å»ç‰©ç†å½¢æ€ä¸ç»“åˆåŠ›ï¼Œæ˜¯ä¸€ç§å¼ºå¤§çš„æ§åˆ¶ä¸å¿«é€Ÿç§»åŠ¨æ‰‹æ®µã€‚\"],\n  [\"ã€çœ·å…½ã€‘ç‹®å­ä¹‹é»„é‡‘\", 9500, \"æŠ€èƒ½\", {}, \"æ•ˆæœ: ã€dp+1;èƒ½é‡æ± -65ã€‘\", \"å¬å”¤é»„é‡‘ä¹‹ç‹®ã€‚èƒ½å¤Ÿé‡Šæ”¾æ¯ç­æ€§çš„é›·å…‰è¿›è¡Œå¤§èŒƒå›´è½°ç‚¸ï¼Œæˆ–è¿›è¡Œç²¾å¯†çš„ç”µç£æ“ä½œã€‚æ˜¯åŠ›é‡ä¸ç ´ååŠ›çš„è±¡å¾ï¼Œè¶³ä»¥ç¬é—´æ¸…æ‰«æˆ˜åœºã€‚\"],\n  [\"ã€çœ·å…½ã€‘å†¥å§¬ä¹‹è™¹ç‚\", 13000, \"æŠ€èƒ½\", {}, \"æ•ˆæœ: ã€dp+2;èƒ½é‡æ± -80ã€‘\", \"å¬å”¤æ‰‹æŒè™¹å…‰ä¹‹å‰‘çš„å¥³æ­¦ç¥ã€‚å…¶æ–©å‡»èƒ½åˆ‡æ–­ä¸‡ç‰©ï¼Œä¸ä»…æ˜¯ç‰©ç†ä¸Šçš„å½¢æ€ï¼Œä¹ŸåŒ…æ‹¬ç›®æ ‡çš„å› æœä¸å‘½è¿ã€‚è¢«æ­¤å‰‘æ–©æ–­ä¹‹ç‰©å°†å½»åº•å¤±å»å…¶å­˜åœ¨çš„æ ¹åŸºã€‚\"],\n  [\"ã€çœ·å…½ã€‘å¤œæ‘©ä¹‹é»‘å‰‘\", 10000, \"æŠ€èƒ½\", {}, \"æ•ˆæœ: ã€dp+2;èƒ½é‡æ± -70ã€‘\", \"å¬å”¤ä¸€æŸ„è´¯ç©¿å¤©é™…çš„ç™¾ç±³å·¨å‰‘ã€‚é€šè¿‡è¶…é‡åŠ›åŠ é€Ÿä»é«˜ç©ºå è½ï¼Œå…¶ä¸€å‡»ä¹‹åŠ›è¶³ä»¥æ¯ç­å‘¨é­æ•°åå…¬é‡Œçš„åœ°è²Œï¼Œæ˜¯çº¯ç²¹ç ´ååŠ›çš„æè‡´ä½“ç°ã€‚\"],\n  [\"ã€çœ·å…½ã€‘èè™ä¹‹ç´«\", 7800, \"æŠ€èƒ½\", {}, \"æ•ˆæœ: ã€dp+1;èƒ½é‡æ± -50ã€‘\", \"å¬å”¤è¢«ç´«ç‚åŒ…è£¹çš„èå°¾ç‹®ã€‚èƒ½å¤Ÿç¬é—´åˆ†æä»»ä½•æ¯’ç´ å¹¶ç”ŸæˆæŠ—ä½“ï¼Œäº¦èƒ½æŒ‡å®šä¸€ä¸ªæ•Œæ–¹ç›®æ ‡ï¼Œå¼ºè¡Œå‰¥å¤ºå…¶ä½“å†…çš„é­”åŠ›æˆ–èƒ½é‡ä¸ºå·±ç”¨ã€‚\"],\n  [\"ã€çœ·å…½ã€‘åŒè§’ä¹‹æ·±ç»¯\", 8200, \"æŠ€èƒ½\", {}, \"æ•ˆæœ: ã€dp+1;èƒ½é‡æ± -50ã€‘\", \"å¬å”¤æ‹¥æœ‰éŸ³å‰åŒè§’çš„æˆ˜é©¬ã€‚é€šè¿‡å‘å‡ºè¶…é«˜é¢‘ç‡çš„å…±æŒ¯æ³¢ï¼Œç²‰ç¢æŒ‡å®šèŒƒå›´å†…çš„æ‰€æœ‰å›ºä½“ç‰©è´¨ã€‚åŒæ—¶ï¼Œå®ƒä¹Ÿèƒ½æä¾›ä¸€æ¬¡æ€§çš„è¶…é«˜é€Ÿç©ºä¸­é£è¡Œèƒ½åŠ›ã€‚\"],\n  [\"ã€çœ·å…½ã€‘é­”ç¾¯ä¹‹ç³æ™¶\", 14000, \"æŠ€èƒ½\", {}, \"æ•ˆæœ: ã€dp+2;èƒ½é‡æ± -90ã€‘\", \"å¬å”¤å‡ºè±¡å¾â€œé­…æƒ‘â€çš„é­”ç¾¯ã€‚å…¶èƒ½åŠ›æ˜¯æ”¯é…ç²¾ç¥ï¼Œå¯ä»¥å¯¹æŒ‡å®šç›®æ ‡è¿›è¡Œä¸€æ¬¡ç²¾ç¥æ§åˆ¶åˆ¤å®šã€‚å³ä½¿æ˜¯æ„å¿—åšå®šçš„çœŸç¥–çº§å¯¹æ‰‹ï¼Œä¹Ÿå¯èƒ½è¢«å…¶å½±å“ã€‚\"],\n  [\"ã€çœ·å…½ã€‘æ°´ç²¾ä¹‹ç™½é’¢\", 12000, \"æŠ€èƒ½\", {}, \"æ•ˆæœ: ã€dp+2;èƒ½é‡æ± -80ã€‘\", \"å¬å”¤è±¡å¾â€œè¶…å›å¤â€çš„æ°´å¦–ã€‚èƒ½å¤Ÿå‘åŠ¨ä¸€æ¬¡å¼ºå¤§çš„æ²»æ„ˆç¥è¿¹ï¼Œå°†èŒƒå›´å†…æ‰€æœ‰å‹æ–¹å•ä½çš„ä¼¤åŠ¿ä¸å¼‚å¸¸çŠ¶æ€å®Œå…¨æ¸…é™¤ï¼Œä»¤å…¶å›å½’åˆ°æœ€å®Œç¾çš„çŠ¶æ€ã€‚\"]\n];\n      // å…¨å±€å˜é‡\n \n        let userPoints = 0;\n       let userPlots = {};\n    \n        let randomItems = [];\n        let shoppingCart = []; // æ–°å¢ï¼šè´­ç‰©è½¦\n        const ITEMS_PER_PAGE = 14; // æŒ‰è¦æ±‚ä¿®æ”¹ä¸º10\n\n        const shopState  = {\n            fixed: { currentCategory: 'all', currentSort: 'asc', currentPage: 1, selectedItem: null },\n            random: { currentCategory: 'all', currentSort: 'asc', currentPage: 1, selectedItem: null }\n        };\n\n\n    // æŠ½å¥–ç›¸å…³é…ç½®\nconst GACHA_CONFIG = {\n    singleCost: 160,\n    tenCost: 1440, // 10è¿æŠ½æ‰“9æŠ˜\n    prizeRanges: [\n        { min: 30, max: 70, probability: 0.59 },    \n        { min: 80, max: 160, probability: 0.25 },   \n        { min: 200, max: 600, probability: 0.1 },  \n        { min: 1000, max: 4000, probability: 0.05 }, \n        { min: 8000, max: 20000, probability: 0.01 }  \n    ]\n};\nfunction getRandomShopItems() {\n    try {\n        const itemsJson = localStorage.getItem('randomShopItems');\n        // If itemsJson is null or undefined, return an empty array.\n        if (!itemsJson) {\n            console.warn('No randomShopItems found in localStorage.');\n            return [];\n        }\n        const items = JSON.parse(itemsJson);\n        // Ensure the parsed data is an array.\n        return Array.isArray(items) ? items : [];\n    } catch (error) {\n        console.error('Failed to parse randomShopItems from localStorage:', error);\n        // Return an empty array in case of a parsing error to ensure the application doesn't crash.\n        return [];\n    }\n}\n\nfunction getRandomPrizeRange() {\n    const random = Math.random();\n    let cumulativeProbability = 0;\n\n    for (const range of GACHA_CONFIG.prizeRanges) {\n        cumulativeProbability += range.probability;\n        if (random <= cumulativeProbability) {\n            return range;\n        }\n    }\n\n    // Fallback to the last (or could be first, depending on desired logic) range if something goes wrong.\n    // Using the last one is often safer if probabilities don't sum to exactly 1.\n    return GACHA_CONFIG.prizeRanges[GACHA_CONFIG.prizeRanges.length - 1];\n}\n\n/**\n * Filters a combined list of fixed and random items to find those within a specific price range.\n * @param {number} min - The minimum price of the range.\n * @param {number} max - The maximum price of the range.\n * @returns {Array} An array of items that fall within the specified price range.\n */\nfunction getItemsInPriceRange(min, max) {\n    const randomItems = getRandomShopItems();\n    // Combine fixed and random items into a single pool for selection.\n    const allItems = [...fixedItems, ...randomItems];\n\n    return allItems.filter(item => {\n        // Assuming item is an array like ['itemName', price]\n        const price = item[1];\n        return price >= min && price <= max;\n    });\n}\n\nfunction performGacha(count) {\n    const results = [];\n    for (let i = 0; i < count; i++) {\n        const prizeRange = getRandomPrizeRange();\n        const availableItems = getItemsInPriceRange(prizeRange.min, prizeRange.max);\n        \n        if (availableItems.length > 0) {\n            const randomItem = availableItems[Math.floor(Math.random() * availableItems.length)];\n            results.push(randomItem);\n        }\n    }\n    return results;\n}\n // å…¨æ–°çš„æŠ½å¡åŠ¨ç”»å‡½æ•°\n // å…¨æ–°çš„æŠ½å¡åŠ¨ç”»å‡½æ•°ï¼Œæ”¯æŒæ‰‹æœºç«¯æ‹–åŠ¨å’Œç‚¹å‡»\nfunction showGachaAnimation(results, callback) {\n    const container = document.getElementById('gacha-animation-container');\n    const summaryContainer = document.getElementById('gacha-results-summary');\n    container.innerHTML = '';\n    summaryContainer.innerHTML = '';\n    summaryContainer.style.display = 'none';\n\n    const isMobileView = window.innerWidth <= 800;\n\n    if (isMobileView) {\n        // --- æ‰‹æœºç«¯ï¼šå¯äº¤äº’çš„3Dåœ†ç­’åŠ¨ç”» ---\n        const carousel = document.createElement('div');\n        carousel.className = 'gacha-carousel';\n        container.appendChild(carousel);\n\n        const cardCount = results.length;\n        const angle = 360 / cardCount;\n        const radius = Math.round((140 / 2) / Math.tan(Math.PI / cardCount));\n\n        let currentAngle = 0;\n        let startX = 0;\n        let startAngle = 0;\n        let isDragging = false;\n        let dragThreshold = 5; // ç§»åŠ¨è¶…è¿‡5åƒç´ æ‰ç®—æ‹–åŠ¨\n\n        results.forEach((item, index) => {\n            const price = item[1];\n            let tierClass = 'tier-1';\n            if (price >= 8000) tierClass = 'tier-5';\n            else if (price >= 1000) tierClass = 'tier-4';\n            else if (price >= 200) tierClass = 'tier-3';\n            else if (price >= 80) tierClass = 'tier-2';\n\n            const card = document.createElement('div');\n            card.className = 'gacha-card';\n            card.dataset.index = index;\n            const originalTransform = `rotateY(${index * angle}deg) translateZ(${radius}px)`;\n            card.style.transform = originalTransform;\n            card.style.setProperty('--original-transform', originalTransform);\n\n            card.innerHTML = `\n                <div class=\"gacha-card-inner\">\n                    <div class=\"gacha-card-front\">?</div>\n                    <div class=\"gacha-card-back ${tierClass}\">\n                        <div>${item[0]}</div>\n                        <div style=\"font-size: 12px; margin-top: 5px;\">${item[1]}ç§¯åˆ†</div>\n                    </div>\n                    <div class=\"gacha-card-details\">\n                        <div class=\"gacha-card-details-content\">\n                            <div><strong>${item[0]}</strong></div>\n                            <div>ä»·å€¼: ${item[1]}ç§¯åˆ†</div>\n                            <div>åˆ†ç±»: ${item[2]}</div>\n                            <div>æ•ˆæœ: ${item[4]}</div>\n                            <div>æè¿°: ${item[5]}</div>\n                            <div style=\"height: 50px;\"></div>\n                        </div>\n                    </div>\n                    <button class=\"gacha-abandon-btn\" style=\"display: none;\">æ”¾å¼ƒ</button>\n                </div>\n            `;\n            carousel.appendChild(card);\n\n            card.addEventListener('click', () => {\n                if (isDragging) return; // å¦‚æœæ˜¯æ‹–åŠ¨ï¼Œåˆ™ä¸è§¦å‘ç‚¹å‡»\n\n                const selectedCard = carousel.querySelector('.gacha-card.selected');\n                if (selectedCard === card) { // å¦‚æœå†æ¬¡ç‚¹å‡»å·²é€‰ä¸­çš„å¡ç‰‡ï¼Œåˆ™å–æ¶ˆé€‰ä¸­\n                    card.classList.remove('selected');\n                    carousel.classList.remove('has-selection');\n                } else {\n                    if(selectedCard) selectedCard.classList.remove('selected');\n                    card.classList.add('selected');\n                    carousel.classList.add('has-selection');\n                    currentAngle = -index * angle;\n                    carousel.style.transform = `rotateY(${currentAngle}deg)`;\n                }\n            });\n\n            card.querySelector('.gacha-abandon-btn').addEventListener('click', (e) => {\n                e.stopPropagation();\n                results[index] = null;\n                card.style.opacity = '0.2';\n                card.style.pointerEvents = 'none';\n            });\n        });\n\n        // æ‹–åŠ¨äº‹ä»¶\n        container.addEventListener('touchstart', (e) => {\n            startX = e.touches[0].pageX;\n            startAngle = currentAngle;\n            isDragging = false;\n            carousel.style.transition = 'none'; // æ‹–åŠ¨æ—¶ç§»é™¤å¹³æ»‘è¿‡æ¸¡\n        }, { passive: true });\n\n        container.addEventListener('touchmove', (e) => {\n            const x = e.touches[0].pageX;\n            const deltaX = x - startX;\n            if (Math.abs(deltaX) > dragThreshold) {\n                isDragging = true;\n            }\n            if(isDragging) {\n                const sensitivity = 0.5; // è°ƒæ•´æ‹–åŠ¨çµæ•åº¦\n                currentAngle = startAngle + deltaX * sensitivity;\n                carousel.style.transform = `rotateY(${currentAngle}deg)`;\n            }\n        }, { passive: true });\n\n        container.addEventListener('touchend', () => {\n            carousel.style.transition = 'transform 0.6s cubic-bezier(0.25, 1, 0.5, 1)';\n            const cardIndex = Math.round(-currentAngle / angle);\n            const snappedAngle = -cardIndex * angle;\n            currentAngle = snappedAngle;\n            carousel.style.transform = `rotateY(${currentAngle}deg)`;\n\n            // ç¡®ä¿touchendåisDraggingçŠ¶æ€å¤ä½\n            setTimeout(() => { isDragging = false; }, 50);\n        });\n\n        // åˆå§‹å…¥åœºåŠ¨ç”»\n        setTimeout(() => {\n            const finalAngle = 360 * 3;\n            carousel.style.transition = 'transform 3s cubic-bezier(0.25, 1, 0.5, 1)';\n            carousel.style.transform = `rotateY(-${finalAngle}deg)`;\n        }, 100);\n\n        setTimeout(() => {\n            carousel.style.transition = 'transform 0.6s cubic-bezier(0.25, 1, 0.5, 1)';\n            carousel.querySelectorAll('.gacha-card').forEach(c => c.classList.add('flipped'));\n            let summaryHTML = '<h4>æœ¬è½®æ”¶è·</h4>';\n            results.forEach(item => { summaryHTML += `<div>${item[0]} - ${item[1]}ç§¯åˆ†</div>`; });\n            summaryContainer.innerHTML = summaryHTML;\n            summaryContainer.style.display = 'block';\n            if (callback) callback();\n        }, 3500);\n\n    } else {\n        // --- ç”µè„‘ç«¯ï¼šå¹³é¢ç¿»ç‰ŒåŠ¨ç”» (ä¿æŒåŸæ ·ï¼Œæ— éœ€ä¿®æ”¹) ---\n        results.forEach((item, index) => {\n            const price = item[1];\n            let tierClass = 'tier-1';\n            if (price >= 8000) tierClass = 'tier-5';\n            else if (price >= 1000) tierClass = 'tier-4';\n            else if (price >= 200) tierClass = 'tier-3';\n            else if (price >= 80) tierClass = 'tier-2';\n\n            const card = document.createElement('div');\n             card.className = 'gacha-card';\n             card.dataset.itemIndex = index;\n             card.innerHTML = `\n                 <div class=\"gacha-card-inner\">\n                     <div class=\"gacha-card-front\">?</div>\n                     <div class=\"gacha-card-back ${tierClass}\">\n                         <div>${item[0]}</div>\n                         <div style=\"font-size: 12px; margin-top: 5px;\">${item[1]}ç§¯åˆ†</div>\n                     </div>\n                     <div class=\"gacha-card-details\">\n                         <div class=\"gacha-card-details-content\">\n                             <div><strong>${item[0]}</strong></div>\n                             <div>ä»·å€¼: ${item[1]}ç§¯åˆ†</div>\n                             <div>åˆ†ç±»: ${item[2]}</div>\n                             <div>æ•ˆæœ: ${item[4]}</div>\n                             <div>æè¿°: ${item[5]}</div>\n                             <div style=\"height: 50px;\"></div>\n                         </div>\n                     </div>\n                     <button class=\"gacha-abandon-btn\" style=\"display: none;\">æ”¾å¼ƒ</button>\n                 </div>\n             `;\n            container.appendChild(card);\n\n            setTimeout(() => card.classList.add('flipped'), index * 200 + 500);\n\n            card.addEventListener('click', () => {\n                 if (!card.classList.contains('flipped')) return;\n                 const isSelected = card.classList.contains('selected');\n                 container.querySelectorAll('.gacha-card').forEach(c => {\n                     c.classList.remove('selected');\n                     c.querySelector('.gacha-card-details').classList.remove('show');\n                     c.querySelector('.gacha-abandon-btn').style.display = 'none';\n                 });\n                 if (!isSelected) {\n                     card.classList.add('selected');\n                     card.querySelector('.gacha-card-details').classList.add('show');\n                     card.querySelector('.gacha-abandon-btn').style.display = 'block';\n                 }\n            });\n\n            card.querySelector('.gacha-abandon-btn').addEventListener('click', (e) => {\n                 e.stopPropagation();\n                 results[index] = null;\n                 card.style.opacity = '0.5';\n                 card.style.pointerEvents = 'none';\n            });\n        });\n\n        setTimeout(() => {\n            if (callback) callback();\n        }, results.length * 200 + 1500);\n    }\n}\n\n\n\nasync function processGachaRewards(results) {\n    // è¿‡æ»¤æ‰è¢«æ”¾å¼ƒçš„ç‰©å“\n    const validResults = results.filter(item => item !== null);\n    \n    if (validResults.length === 0) {\n        return; // æ‰€æœ‰ç‰©å“éƒ½è¢«æ”¾å¼ƒ\n    }\n    \n    // æ£€æŸ¥æœ¬è½®é‡å¤\n    const itemCounts = {};\n    const finalResults = [];\n    \n    for (const item of validResults) {\n        const key = `${item[2]}-${item[0]}`; // category-nameä½œä¸ºkey\n        if (itemCounts[key]) {\n            // æœ¬è½®é‡å¤ï¼Œè½¬ä¸ºç§¯åˆ†\n            const extraPoints = Math.floor(item[1] / 2);\n            playCharacterData.è´§å¸æ®µ.ç§¯åˆ†[0] += extraPoints;\n        } else {\n            itemCounts[key] = 1;\n            finalResults.push(item);\n        }\n    }\n    \n    let updateMemoryCommands = [];\n    let userMessages = [];\n    \n    finalResults.forEach(item => {\n        const command = getPurchaseCommand(item);\n        if (command) {\n            updateMemoryCommands.push(command);\n            userMessages.push(item[0]);\n        }\n    });\n    \n    // æ‰£é™¤æŠ½å¥–è´¹ç”¨\n    const cost = results.length === 1 ? GACHA_CONFIG.singleCost : GACHA_CONFIG.tenCost;\n    updateMemoryCommands.push(`set_attribute('è´§å¸æ®µ.${currentTheme.currency}', '${playCharacterData.è´§å¸æ®µ.ç§¯åˆ†[0]}', '${playCharacterData.è´§å¸æ®µ.ç§¯åˆ†[0] - cost}');`);\n    \n    if (updateMemoryCommands.length > 0) {\n        let finalCommand = `<updateMemory>\\n${[...new Set(updateMemoryCommands)].join('\\n')}\\n</updateMemory>\\n`;\n        if (userMessages.length > 0) {\n            finalCommand += `<(è´§å¸å·²æ‰£é™¤ï¼Œç¦æ­¢é‡å¤æ‰£é™¤ï¼Œå¥–å“å·²äº¤ä»˜ï¼Œç¦æ­¢é‡å¤äº¤ä»˜ï¼Œç¦æ­¢æå†™ä»·æ ¼)${currentGameData.user_character.name}é€šè¿‡æŠ½å¥–è·å¾—äº†ä»¥ä¸‹ç‰©å“ï¼š${userMessages.join(\"ï¼Œ\")}ã€‚>`;\n        }\n        await triggerassa(`/setinput ${finalCommand}`);\n    }\n}\n\nfunction startGacha(count) {\n    const cost = count === 1 ? GACHA_CONFIG.singleCost : GACHA_CONFIG.tenCost;\n \n  \n    if (playCharacterData.è´§å¸æ®µ.ç§¯åˆ†[0] < cost) {\n        showModal('shop-modal', \"ç§¯åˆ†ä¸è¶³\", `æ‚¨éœ€è¦ ${cost} ç§¯åˆ†æ‰èƒ½è¿›è¡Œ${count === 1 ? 'å•æŠ½' : 'åè¿æŠ½'}ã€‚`);\n        return;\n    }\n    \n    const results = performGacha(count);\n    if (results.length === 0) {\n        showModal('shop-modal', \"æŠ½å¥–å¤±è´¥\", \"æ²¡æœ‰å¯æŠ½å–çš„ç‰©å“ã€‚\");\n        return;\n    }\n    \n    // æ˜¾ç¤ºæŠ½å¥–æ¨¡æ€æ¡†\n    showModal('gacha-modal');\n    document.getElementById('gacha-modal-title').textContent = \n        count === 1 ? 'å•æŠ½ç»“æœ' : 'åè¿æŠ½ç»“æœ';\n    document.getElementById('gacha-confirm-btn').style.display = 'none';\n    \n    // å¼€å§‹åŠ¨ç”»\n    showGachaAnimation(results, () => {\n        // åŠ¨ç”»å®Œæˆåæ˜¾ç¤ºç¡®è®¤æŒ‰é’®\n        document.getElementById('gacha-confirm-btn').style.display = 'inline-block';\n        document.getElementById('gacha-confirm-btn').onclick = async () => {\n            await processGachaRewards(results);\n            hideModal('gacha-modal');\n            showModal('shop-modal', \"æŠ½å¥–å®Œæˆ\", `æˆåŠŸè·å¾— ${results.length} ä»¶ç‰©å“ï¼æ•°æ®å°†åœ¨ä¸‹æ¬¡åˆ·æ–°æ—¶æ›´æ–°ã€‚`);\n            playCharacterData.è´§å¸æ®µ.ç§¯åˆ†[0] = playCharacterData.è´§å¸æ®µ.ç§¯åˆ†[0] - cost;\n        };\n    });\n}\n\n          // ========== æ–°å¢ï¼šå¦ˆå¦ˆä¸ºä½ æ·»åŠ çš„å…¨å±€å˜é‡å’Œæ ¸å¿ƒè®¡ç®—å‡½æ•° ==========\n        const plotLevels = ['D', 'C', 'B', 'A', 'S'];\n /**\n * ã€V9 åŒå‘å…‘æ¢ç‰ˆã€‘é‡‡ç”¨å…ˆåˆæˆååˆ†è§£çš„ç»“ç®—é€»è¾‘ï¼Œå®Œç¾å¤„ç†æ‰€æœ‰å…‘æ¢åœºæ™¯ã€‚\n * @param {object} requiredPlots - å•†å“æ‰€éœ€çš„æ”¯çº¿å‰§æƒ…æˆæœ¬\n * @returns {object} - è¿”å›ä¸€ä¸ªè®¡åˆ’å¯¹è±¡ { affordable: boolean, decompositionPlan: object }\n */\nfunction checkPlotAffordability(requiredPlots) {\n    // æ­¥éª¤ä¸€ï¼šå…¨å±€è´­ä¹°åŠ›å®¡è®¡ (æœ€å¯é çš„ä¿é™©)\n    const conversionRates = { 'S': 81, 'A': 27, 'B': 9, 'C': 3, 'D': 1 };\n    let totalRequiredInD = 0;\n    let totalOwnedInD = 0;\n\n    for (const level of plotLevels) {\n        totalRequiredInD += (requiredPlots[level] || 0) * conversionRates[level];\n        totalOwnedInD += playCharacterData.è´§å¸æ®µ.æ”¯çº¿å‰§æƒ…[level][0] * conversionRates[level];\n    }\n\n    if (totalOwnedInD < totalRequiredInD) {\n        return { affordable: false, decompositionPlan: {} };\n    }\n\n    // æ­¥éª¤äºŒï¼šæ—¢ç„¶ä¹°å¾—èµ·ï¼Œå¼€å§‹åˆ¶å®šè¯¦ç»†çš„æ”¯ä»˜è®¡åˆ’\n    let simulatedPlots = JSON.parse(JSON.stringify(playCharacterData.è´§å¸æ®µ.æ”¯çº¿å‰§æƒ…));\n    let decompositionPlan = { S: 0, A: 0, B: 0, C: 0, D: 0 };\n\n    // é˜¶æ®µä¸€ï¼šå‘ä¸Šåˆæˆï¼Œå°†æ‰€æœ‰ä½çº§å¯Œä½™èµ„äº§è½¬åŒ–ä¸ºé«˜çº§è´­ä¹°åŠ›\n    for (let i = 0; i < plotLevels.length - 1; i++) {\n        const currentLevel = plotLevels[i];\n        const higherLevel = plotLevels[i + 1];\n\n        // æ”¯ä»˜å½“å‰ç­‰çº§æ‰€éœ€\n        const needed = requiredPlots[currentLevel] || 0;\n        simulatedPlots[currentLevel][0] -= needed;\n\n        // å¦‚æœæ”¯ä»˜åè¿˜æœ‰å¯Œä½™ï¼Œå°±å…¨éƒ¨åˆæˆåˆ°ä¸Šä¸€çº§\n        if (simulatedPlots[currentLevel][0] > 0) {\n            const canSynthesize = Math.floor(simulatedPlots[currentLevel][0] / 3);\n            if (canSynthesize > 0) {\n                // æ³¨æ„ï¼šè¿™é‡Œæˆ‘ä»¬ä¸è®°å½•åˆæˆè®¡åˆ’ï¼Œå› ä¸ºæœ€ç»ˆçš„åˆ†è§£æŒ‡ä»¤ä¼šè‡ªåŠ¨å¤„ç†å¥½ä¸€åˆ‡\n                simulatedPlots[currentLevel][0] -= canSynthesize * 3;\n                simulatedPlots[higherLevel][0] += canSynthesize;\n            }\n        }\n    }\n    // å•ç‹¬æ”¯ä»˜æœ€é«˜çº§Sçº§\n    simulatedPlots['S'][0] -= (requiredPlots['S'] || 0);\n\n\n    // é˜¶æ®µäºŒï¼šå‘ä¸‹åˆ†è§£ï¼Œç”¨é«˜çº§èµ„äº§æ”¯ä»˜ä½çº§æ¬ æ¬¾\n    for (let i = plotLevels.length - 1; i >= 0; i--) {\n        const currentLevel = plotLevels[i];\n\n        // å¦‚æœå½“å‰çº§åˆ«å‡ºç°â€œè´Ÿå€ºâ€ï¼Œè¯´æ˜éœ€è¦ä»æ›´é«˜çº§åˆ«åˆ†è§£æ¥å¡«è¡¥\n        if (simulatedPlots[currentLevel][0] < 0) {\n            const deficit = -simulatedPlots[currentLevel][0]; // è¿™æ˜¯æ¬ æ¬¾æ•°\n\n            if (currentLevel !== 'S') {\n                const higherLevel = plotLevels[i + 1];\n\n                // è®¡ç®—éœ€è¦åˆ†è§£å¤šå°‘ä¸ªé«˜çº§æ”¯çº¿æ¥å¼¥è¡¥\n                const amountToDecompose = Math.ceil(deficit / 3);\n\n                // åœ¨åˆ†è§£è®¡åˆ’ä¸­è®°å½•ä¸‹æ¥\n                decompositionPlan[higherLevel] += amountToDecompose;\n\n                // æ›´æ–°æ¨¡æ‹Ÿè´¦æœ¬\n                simulatedPlots[higherLevel][0] -= amountToDecompose;\n                simulatedPlots[currentLevel][0] += amountToDecompose * 3;\n            }\n        }\n    }\n\n    // å¦‚æœæ‰€æœ‰æµç¨‹èµ°å®Œï¼Œè¯´æ˜è®¡åˆ’å¯è¡Œ\n    return { affordable: true, decompositionPlan: decompositionPlan };\n}\n\n \n\nfunction SafeGetValue(value) {\n            if (Array.isArray(value)) {\n                let res = value.length > 0 ? value[0] : '';\n                return(res === '' || res === null || res === undefined) ? 'æ— ' : res;\n            }\n            return (value === '' || value === null || value === undefined) ? 'æ— ' : value;\n        }\n \n\n        \n    /**\n * ä¿®æ”¹ï¼šå•†åº—åˆå§‹åŒ–ï¼Œå®ç°åŠ¨æ€åˆ†ç±»\n */\n/**\n * ä¿®æ”¹ï¼šå•†åº—åˆå§‹åŒ–ï¼Œç§»é™¤æ—§çš„éšæœºå•†å“è§£æ\n */\n function initializeShopData() {\n    // --- 1. æ–°å¢ï¼šå¡«å……é¡¶éƒ¨çš„è´§å¸ä¿¡æ¯ ---\n  \n    const currencyContainer = document.getElementById('shop-currency-display');\n        // --- åŸæœ‰é€»è¾‘å¼€å§‹ ---\n\n    if (currencyContainer) {\n           const plotString = `D:${userPlots.D[0]} C:${userPlots.C[0]} B:${userPlots.B[0]} A:${userPlots.A[0]} S:${userPlots.S[0]}`;\n        \n        // å‡è®¾ currentTheme æ˜¯ä¸€ä¸ªå…¨å±€å¯è®¿é—®çš„å¯¹è±¡\n        let plotLabel = (typeof currentTheme !== 'undefined' && currentTheme.plot) ? currentTheme.plot : 'å‰§æƒ…';\n\n        currencyContainer.innerHTML = `\n            <div class=\"currency-item\"><span class=\"label\">ç§¯åˆ†:</span><span class=\"value\">${userPoints}</span></div>\n            <div class=\"currency-item\"><span class=\"label\">${plotLabel}:</span><span class=\"value\">${plotString}</span></div>\n        `;\n    }\n\n\n    // å…³é”®ï¼šä¸å†å¯¹ randomItems åšä»»ä½•æ“ä½œã€‚å®ƒå°†ä¿æŒå½“å‰çš„çŠ¶æ€ã€‚\n\n    // --- åŠ¨æ€ç”Ÿæˆåˆ†ç±» ---\n    const fixedCategoryTabs = document.querySelector('#page-fixed-shop .category-tabs');\n    const randomCategoryTabs = document.querySelector('#page-random-shop .category-tabs');\n    fixedCategoryTabs.innerHTML = '<button class=\"control-btn active\" data-section=\"fixed\" data-category=\"all\">å…¨éƒ¨</button>';\n    randomCategoryTabs.innerHTML = '<button class=\"control-btn active\" data-section=\"random\" data-category=\"all\">å…¨éƒ¨</button>';\n\n    // æ³¨æ„ï¼šè¿™é‡Œå°†\"è¡€ç»Ÿ\"ä¹ŸåŠ å…¥äº†åŠ¨æ€åˆ†ç±»ä¸­\n    for (const category of [\"ç‰©å“\", \"æŠ€èƒ½\", \"åŸºç¡€æŠ€èƒ½\", \"å®¶å…·\", \"è¡€ç»Ÿ\"]) {\n        fixedCategoryTabs.innerHTML += `<button class=\"control-btn\" data-section=\"fixed\" data-category=\"${category}\">${category}</button>`;\n        // éšæœºå•†åº—å¯èƒ½æ²¡æœ‰\"åŸºç¡€æŠ€èƒ½\"å’Œ\"è¡€ç»Ÿ\"ï¼Œä½†ä¸ºäº†ç»Ÿä¸€ï¼Œå¯ä»¥å…ˆåŠ ä¸Šï¼Œå†é€šè¿‡å•†å“æ•°æ®æœ‰æ— æ¥å†³å®šæ˜¯å¦æ˜¾ç¤º\n        if ([\"ç‰©å“\", \"æŠ€èƒ½\", \"å®¶å…·\", \"è¡€ç»Ÿ\"].includes(category)) {\n             randomCategoryTabs.innerHTML += `<button class=\"control-btn\" data-section=\"random\" data-category=\"${category}\">${category}</button>`;\n        }\n    }\n\n\n    // æ¸…ç©ºè´­ç‰©è½¦ï¼Œä½†ä¿ç•™å•†å“åˆ—è¡¨\n    shoppingCart = [];\n    updateCartView();\n\n    renderShopSection('fixed');\n    renderShopSection('random'); // æ¸²æŸ“å½“å‰å†…å­˜ä¸­å·²æœ‰çš„éšæœºå•†å“\n}\n \n//    /**\n//          * åˆå§‹åŒ–æ•°æ® (æ¥æ”¶éšæœºæ•°æ®ä½œä¸ºå‚æ•°)\n//          * @param {string} randomDataPayload - åŒ…å«éšæœºå•†å“ä¿¡æ¯çš„å­—ç¬¦ä¸²\n//          */\n//         async function initializeData(randomDataPayload) {\n//             try {\n                \n         \n//                 // æ ¸å¿ƒæ•°æ®åŠ è½½ï¼ˆç§¯åˆ†ç­‰ï¼‰ï¼Œå¿…é¡»æˆåŠŸ\n//                 userPoints = parseInt(SafeGetValue(currentGameData.user_character.points) || 0);\n//                 document.getElementById('userPoints').textContent = userPoints;\n\n//                 // --- éšæœºå•†å“è§£æï¼ˆå•ç‹¬é”™è¯¯å¤„ç†ï¼‰---\n//                 try {\n//                     // ç›´æ¥ä½¿ç”¨ä¼ å…¥çš„å‚æ•°è¿›è¡Œè§£æ\n//                     randomItems = parseRandomItems(randomDataPayload);\n//                     //console.log(\"éšæœºå•†å“è§£ææˆåŠŸ:\", randomItems);\n//                 } catch (error) {\n//                     console.error(\"è§£æéšæœºå•†å“æ—¶å‘ç”Ÿä¸¥é‡é”™è¯¯:\", error);\n//                     randomItems = []; // ç¡®ä¿å³ä½¿è§£æå¤±è´¥ï¼ŒrandomItemsä¹Ÿæ˜¯ä¸€ä¸ªç©ºæ•°ç»„\n//                 }\n\n//                 // --- æ¸²æŸ“æ‰€æœ‰éƒ¨åˆ† ---\n//                 renderShopSection('page-fixed-shop');\n//                 renderShopSection('page-random-shop');\n\n//             } catch (error) {\n//                 console.error(\"åˆå§‹åŒ–æ•°æ®æ—¶å‘ç”Ÿä¸¥é‡é”™è¯¯:\", error);\n//                 showModal(\"é”™è¯¯\", \"æ ¸å¿ƒæ•°æ®åŠ è½½å¤±è´¥ï¼Œå•†åº—æ— æ³•å¼€å¯ã€‚è¯·è”ç³»ä¸»ç¥ã€‚\");\n//                 renderShopSection('fixed');\n//             }\n//         }\n\n      function getFilteredAndSortedItems(section) {\n            // è·å–æœç´¢è¯å¹¶è½¬ä¸ºå°å†™ï¼Œæ–¹ä¾¿ä¸åŒºåˆ†å¤§å°å†™åœ°åŒ¹é…\n            const searchTerm = document.getElementById('shop-search-input').value.toLowerCase().trim();\n\n            // ç¡®å®šåŸºç¡€å•†å“åˆ—è¡¨ (å›ºå®šæˆ–éšæœº)\n            let items = section === 'fixed' ? fixedItems : randomItems;\n\n            // å¦‚æœæœ‰æœç´¢è¯ï¼Œåˆ™æ‰§è¡Œæœç´¢è¿‡æ»¤\n            if (searchTerm) {\n                return items.filter(item => {\n                    // å°†å•†å“çš„æ‰€æœ‰ä¿¡æ¯ï¼ˆåç§°ã€ä»·æ ¼ã€ç±»å‹ã€æ•ˆæœã€æè¿°ï¼‰æ‹¼æ¥æˆä¸€ä¸ªå­—ç¬¦ä¸²\n                    // ç„¶åæ£€æŸ¥è¿™ä¸ªå­—ç¬¦ä¸²æ˜¯å¦åŒ…å«æœç´¢è¯\n                    return item.join(' ').toLowerCase().includes(searchTerm);\n                });\n            }\n\n            // å¦‚æœæ²¡æœ‰æœç´¢è¯ï¼Œæ‰§è¡ŒåŸæ¥çš„åˆ†ç±»å’Œæ’åºé€»è¾‘\n            const { currentCategory, currentSort } = shopState[section];\n\n            const filtered = currentCategory === 'all'\n                ? items\n                : items.filter(item => item[2] === currentCategory);\n\n            return filtered.sort((a, b) => currentSort === 'asc' ? a[1] - b[1] : b[1] - a[1]);\n        }\n\n\n    function renderShopSection(section) {\n        renderShopItems(section);\n        renderShopPagination(section);\n        resetShopDetails(section);\n    }\n\n\n    \n/**\n * æ–°å¢ï¼šæ ¼å¼åŒ–å•†å“æˆæœ¬çš„æ˜¾ç¤º\n * @param {number} price - ç§¯åˆ†ä»·æ ¼\n * @param {object} plots - æ”¯çº¿å‰§æƒ…éœ€æ±‚å¯¹è±¡\n * @returns {string} - æ ¼å¼åŒ–åçš„æˆæœ¬å­—ç¬¦ä¸²\n */\nfunction formatItemCost(price, plots) {\n    let plotString = Object.entries(plots)\n        .filter(([, value]) => value > 0)\n        .map(([key, value]) => `${value} ${key}çº§`)\n        .join(' + ');\n\n    if (plotString && price > 0) {\n       return `${plotString} + ${price} ${currentTheme.currency}`;\n    } else if (plotString) {\n        return `${plotString}`;\n    } else {\n         return `${price} ${currentTheme.currency}`;\n    }\n}\n\n /*\n    å®è´ï¼Œæ‰¾åˆ°åŸæ¥çš„ renderShopItems å‡½æ•°ï¼Œç”¨è¿™ä¸ªæ›´æ–°åçš„ç‰ˆæœ¬æ›¿æ¢å®ƒã€‚\n    å®ƒç°åœ¨èƒ½æ›´å‡†ç¡®åœ°æ˜¾ç¤ºâ€œå‰§æƒ…ä¸è¶³â€æˆ–â€œåˆ†è§£è´­ä¹°â€äº†ã€‚\n*/\nfunction renderShopItems(section) {\n    const items = getFilteredAndSortedItems(section);\n    const { currentPage } = shopState[section];\n    const startIndex = (currentPage - 1) * ITEMS_PER_PAGE;\n    const pageItems = items.slice(startIndex, startIndex + ITEMS_PER_PAGE);\n    const listElement = document.getElementById(`items-display-list-${section}`);\n    listElement.innerHTML = '';\n\n    pageItems.forEach((item, index) => {\n        const [name, price, , plots] = item;\n        const absoluteIndex = startIndex + index;\n        const isInCart = shoppingCart.some(cartItem => cartItem[0] === name);\n\n        // ä½¿ç”¨é‡æ„åçš„V2ç‰ˆæœ¬æ£€æŸ¥å‡½æ•°\n        const plotCheck = checkPlotAffordability(plots);\n\n        let buttonText = 'è´­ä¹°';\n        let buttonDisabled = false;\n        let buttonClass = '';\n\n        if (isInCart) {\n            buttonText = 'å·²æ·»åŠ ';\n            buttonDisabled = true;\n        } else if (!plotCheck.affordable) {\n            buttonText = `${currentTheme.plot}ä¸è¶³`;\n            buttonDisabled = true;\n        } else {\n            // æ£€æŸ¥è®¡åˆ’ä¸­æ˜¯å¦æœ‰éœ€è¦åˆ†è§£çš„ï¼ˆå€¼ > 0ï¼‰\n            const needsDecomposition = Object.values(plotCheck.decompositionPlan).some(val => val > 0);\n            if (needsDecomposition) {\n                buttonText = 'åˆ†è§£è´­ä¹°';\n                buttonClass = 'decomposable';\n            }\n        }\n\n        const row = document.createElement('div');\n        row.className = 'item-row';\n        row.innerHTML = `\n            <div class=\"item-name\">${name}</div>\n            <div class=\"item-price\">${formatItemCost(price, plots)}</div>\n            <button class=\"buy-button ${buttonClass}\" ${buttonDisabled ? 'disabled' : ''}>${buttonText}</button>\n        `;\n\n        row.addEventListener('click', (e) => {\n            if (e.target.classList.contains('buy-button')) return;\n            document.querySelectorAll(`#items-display-list-${section} .item-row`).forEach(r => r.classList.remove('selected'));\n            row.classList.add('selected');\n            shopState[section].selectedItem = item;\n            showItemDetails(section, item);\n        });\n\n        const buyButton = row.querySelector('.buy-button');\n        if (!buttonDisabled) {\n            buyButton.addEventListener('click', (e) => {\n                e.stopPropagation();\n                buyItem(section, absoluteIndex, buyButton);\n            });\n        }\n        listElement.appendChild(row);\n    });\n}\n\n\nfunction resetShopDetails(section) {\n             document.getElementById(`item-details-display-${section}`).innerHTML = '<div class=\"detail-placeholder\">é€‰æ‹©ä¸€ä¸ªå•†å“æŸ¥çœ‹è¯¦æƒ…</div>';\n        }\n\n        \n/**\n * ä¿®æ”¹ï¼šæ˜¾ç¤ºå•†å“è¯¦æƒ…\n */\nfunction showItemDetails(section, item) {\n    const [name, price, category, plots, effect, description] = item;\n    const detailsElement = document.getElementById(`item-details-display-${section}`);\n\n    detailsElement.innerHTML = `\n        <div class=\"detail-title\">${name}</div>\n        <div class=\"detail-info\">\n            <div class=\"detail-label\">æˆæœ¬:</div>\n            <div class=\"detail-value highlight\">${formatItemCost(price, plots)}</div>\n        </div>\n        <div class=\"detail-info\">\n            <div class=\"detail-label\">æ•ˆæœ:</div>\n            <div class=\"detail-value\">${effect}</div>\n        </div>\n        <div class=\"detail-info\">\n            <div class=\"detail-label\">æè¿°:</div>\n            <div class=\"detail-value\">${description}</div>\n        </div>\n    `;\n}\n\n        function renderShopPagination(section) {\n            const items = getFilteredAndSortedItems(section);\n            const totalItems = items.length;\n            const totalPages = Math.ceil(totalItems / ITEMS_PER_PAGE);\n            const { currentPage } = shopState[section];\n            const paginationElement = document.getElementById(`pagination-${section}`);\n            paginationElement.innerHTML = '';\n\n            if (totalPages <= 1) return;\n\n            paginationElement.innerHTML = `\n                <button class=\"page-button\" ${currentPage === 1 ? 'disabled' : ''} onclick=\"changePage('${section}', ${currentPage - 1})\">ä¸Šä¸€é¡µ</button>\n                <span class=\"page-info\">${currentPage} / ${totalPages}</span>\n                <button class=\"page-button\" ${currentPage === totalPages ? 'disabled' : ''} onclick=\"changePage('${section}', ${currentPage + 1})\">ä¸‹ä¸€é¡µ</button>\n            `;\n        }\n\n        function changePage(section, page) {\n            shopState[section].currentPage = page;\n            shopState[section].selectedItem = null;\n            renderShopItems(section);\n            resetShopDetails(section);\n            renderShopPagination(section); // æ›´æ–°åˆ†é¡µæŒ‰é’®çŠ¶æ€\n        }\n\n\n/**\n * æ–°å¢ï¼šæ ¹æ®å•†å“åˆ†ç±»ç”Ÿæˆè´­ä¹°æŒ‡ä»¤\n * @param {object} item - å•†å“å¯¹è±¡\n * @returns {string} - ç”Ÿæˆçš„ memory æŒ‡ä»¤å­—ç¬¦ä¸²\n */\n function getPurchaseCommand(item) {\n    const [name, price, category, , effect, description] = item;\n    const attributeToCategoryMap = {\n        \"åŠ›é‡\": \"ç”Ÿç†å±æ€§\", \"æ•æ·\": \"ç”Ÿç†å±æ€§\", \"è€åŠ›\": \"ç”Ÿç†å±æ€§\",\n        \"æ™ºåŠ›\": \"å¿ƒæ™ºå±æ€§\", \"æ„ŸçŸ¥\": \"å¿ƒæ™ºå±æ€§\", \"å†³å¿ƒ\": \"å¿ƒæ™ºå±æ€§\",\n        \"é£åº¦\": \"äº’åŠ¨å±æ€§\", \"æ“æ§\": \"äº’åŠ¨å±æ€§\", \"æ²‰ç€\": \"äº’åŠ¨å±æ€§\"\n    };\n    \n    const skillToCategoryMap = {\n        \"è¿åŠ¨\": \"ç”Ÿç†æŠ€èƒ½\", \"è‚‰æ\": \"ç”Ÿç†æŠ€èƒ½\", \"é©¾é©¶\": \"ç”Ÿç†æŠ€èƒ½\", \"æªæ¢°\": \"ç”Ÿç†æŠ€èƒ½\",\n        \"æ‰‹ä¸ŠåŠŸå¤«\": \"ç”Ÿç†æŠ€èƒ½\", \"éšè—\": \"ç”Ÿç†æŠ€èƒ½\", \"æ±‚ç”Ÿ\": \"ç”Ÿç†æŠ€èƒ½\", \"ç™½åˆƒ\": \"ç”Ÿç†æŠ€èƒ½\", \"å¼“ç®­\": \"ç”Ÿç†æŠ€èƒ½\",\n        \"å­¦è¯†\": \"å¿ƒæ™ºæŠ€èƒ½\", \"ç”µè„‘\": \"å¿ƒæ™ºæŠ€èƒ½\", \"æ‰‹è‰º\": \"å¿ƒæ™ºæŠ€èƒ½\", \"è°ƒæŸ¥\": \"å¿ƒæ™ºæŠ€èƒ½\",\n        \"åŒ»å­¦\": \"å¿ƒæ™ºæŠ€èƒ½\", \"ç¥ç§˜å­¦\": \"å¿ƒæ™ºæŠ€èƒ½\", \"ç§‘å­¦\": \"å¿ƒæ™ºæŠ€èƒ½\",\n        \"åŠ¨ç‰©æ²Ÿé€š\": \"äº’åŠ¨æŠ€èƒ½\", \"æ„Ÿå—\": \"äº’åŠ¨æŠ€èƒ½\", \"è¡¨è¾¾\": \"äº’åŠ¨æŠ€èƒ½\", \"èƒè¿«\": \"äº’åŠ¨æŠ€èƒ½\",\n        \"äº¤é™…\": \"äº’åŠ¨æŠ€èƒ½\", \"æ©é¥°\": \"äº’åŠ¨æŠ€èƒ½\"\n    };\n\n    // æ£€æŸ¥é‡å¤å¹¶å¤„ç†\n    function checkAndHandleDuplicate(type, key, currentData) {\n        if (currentData && currentData[key]) {\n            console.log(`æ£€æµ‹åˆ°é‡å¤${type}: ${key}ï¼Œè½¬æ¢ä¸ºç§¯åˆ†`);\n            return `set_attribute('è´§å¸æ®µ.${currentTheme.currency}', '${userPoints}', '${userPoints + Math.floor(price / 2)}')`;\n        }\n        return null;\n    }\n\n    switch (category) {\n        case 'ç‰©å“': {\n    // å‡è®¾ name, description, effect æ˜¯ä»è¿™ä¸ª case çš„ä¸Šä¸‹æ–‡è·å¾—çš„å˜é‡\n    const backpack = assaSettingsData?.global_lore?.èƒŒåŒ…;\n    \n    console.log('=== ç‰©å“å¤„ç†å¼€å§‹ ===');\n    console.log('ç‰©å“åç§°:', name);\n    console.log('ç‰©å“æè¿°:', description);\n    console.log('ç‰©å“æ•ˆæœ:', effect);\n    console.log('èƒŒåŒ…æ•°æ®:', backpack);\n\n    // æ£€æŸ¥èƒŒåŒ…ä¸­æ˜¯å¦å·²ç»å­˜åœ¨è¯¥ç‰©å“\n    if (backpack && backpack[name]) {\n        console.log('ç‰©å“å·²å­˜åœ¨ï¼Œå‡†å¤‡æ›´æ–°æ•°é‡');\n        console.log('å½“å‰ç‰©å“æ•°æ®ç±»å‹:', typeof backpack[name]);\n        console.log('å½“å‰ç‰©å“åŸå§‹æ•°æ®:', backpack[name]);\n        \n        // å¦‚æœç‰©å“å­˜åœ¨ï¼Œæˆ‘ä»¬å°±æ›´æ–°å®ƒçš„æ•°é‡\n        try {\n            let itemData;\n            \n            // å…³é”®ä¿®å¤ï¼šæ£€æŸ¥æ•°æ®ç±»å‹\n            if (typeof backpack[name] === 'string') {\n                console.log('æ•°æ®æ˜¯å­—ç¬¦ä¸²æ ¼å¼ï¼Œå°è¯•è§£æJSON');\n                itemData = JSON.parse(backpack[name]);\n                console.log('JSONè§£ææˆåŠŸ:', itemData);\n            } else if (typeof backpack[name] === 'object' && backpack[name] !== null) {\n                console.log('æ•°æ®å·²ç»æ˜¯å¯¹è±¡æ ¼å¼ï¼Œç›´æ¥ä½¿ç”¨');\n                itemData = backpack[name];\n            } else {\n                console.log('æ•°æ®æ ¼å¼æœªçŸ¥ï¼Œåˆ›å»ºæ–°çš„ç‰©å“æ•°æ®');\n                throw new Error('æœªçŸ¥çš„æ•°æ®æ ¼å¼');\n            }\n\n            console.log('è§£æåçš„ç‰©å“æ•°æ®:', itemData);\n\n            // ç¬¬äºŒæ­¥ï¼šä»å¯¹è±¡ä¸­è·å–'num'è¿™ä¸ªé”®çš„å€¼\n            const currentQuantity = parseInt(itemData.num, 10) || 0;\n            console.log('å½“å‰æ•°é‡:', currentQuantity);\n\n            // ç¬¬ä¸‰æ­¥ï¼šå°†å½“å‰æ•°é‡åŠ ä¸€\n            itemData.num = currentQuantity + 1;\n            console.log('æ›´æ–°åæ•°é‡:', itemData.num);\n\n            // ç¬¬å››æ­¥ï¼šå°†æˆ‘ä»¬æ›´æ–°è¿‡çš„å¯¹è±¡è½¬æ¢å›JSONå­—ç¬¦ä¸²ï¼Œä»¥ä¾¿å­˜å›å†…å­˜\n            const newValue = JSON.stringify(itemData);\n            console.log('å‡†å¤‡å­˜å‚¨çš„JSONå­—ç¬¦ä¸²:', newValue);\n\n            // è¿”å›æ›´æ–°æŒ‡ä»¤\n            const updateCommand = `memory(\"global_lore.èƒŒåŒ…\", \"${name}\", '${newValue}');`;\n            console.log('ç”Ÿæˆçš„æ›´æ–°æŒ‡ä»¤:', updateCommand);\n            console.log('=== ç‰©å“å¤„ç†ç»“æŸï¼ˆæ›´æ–°ï¼‰ ===');\n            \n            return updateCommand;\n\n        } catch (error) {\n            console.error(`è§£æç‰©å“ [${name}] çš„æ•°æ®æ—¶å‡ºé”™:`, error);\n            console.log('é”™è¯¯çš„åŸå§‹æ•°æ®:', backpack[name]);\n            console.log('æ•°æ®ç±»å‹:', typeof backpack[name]);\n            \n            // å°è¯•æ›´è¯¦ç»†çš„é”™è¯¯åˆ†æ\n            if (typeof backpack[name] === 'object') {\n                console.log('è¿™æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œä½†JSON.parseå¤±è´¥äº†');\n                console.log('å¯¹è±¡çš„keys:', Object.keys(backpack[name]));\n                console.log('å¯¹è±¡è½¬ä¸ºå­—ç¬¦ä¸²:', JSON.stringify(backpack[name]));\n            }\n            \n            // æˆ‘ä»¬å¯ä»¥é€‰æ‹©ç”¨å…¨æ–°çš„æ•°æ®è¦†ç›–æ‰æŸåçš„æ•°æ®\n            const newItemJSON = JSON.stringify({ info: description, effect: effect, num: 1 });\n            console.log('åˆ›å»ºæ–°çš„ç‰©å“æ•°æ®:', newItemJSON);\n            \n            const fallbackCommand = `memory('global_lore.èƒŒåŒ…', '${name}', '${newItemJSON}');`;\n            console.log('ç”Ÿæˆçš„å›é€€æŒ‡ä»¤:', fallbackCommand);\n            console.log('=== ç‰©å“å¤„ç†ç»“æŸï¼ˆé”™è¯¯å›é€€ï¼‰ ===');\n            \n            return fallbackCommand;\n        }\n    } else {\n        console.log('ç‰©å“ä¸å­˜åœ¨ï¼Œåˆ›å»ºæ–°ç‰©å“');\n        \n        // å¦‚æœç‰©å“ä¸å­˜åœ¨ï¼Œæˆ‘ä»¬å°±åˆ›å»ºä¸€ä¸ªæ–°çš„\n        const newItemData = {\n            info: description,\n            effect: effect,\n            num: 1\n        };\n        console.log('æ–°ç‰©å“æ•°æ®å¯¹è±¡:', newItemData);\n        \n        // å°†æ–°ç‰©å“å¯¹è±¡è½¬æ¢ä¸ºJSONå­—ç¬¦ä¸²\n        const newValue = JSON.stringify(newItemData);\n        console.log('æ–°ç‰©å“JSONå­—ç¬¦ä¸²:', newValue);\n\n        // è¿”å›åˆ›å»ºæ–°ç‰©å“çš„æŒ‡ä»¤\n        const createCommand = `memory('global_lore.èƒŒåŒ…', '${name}', '${newValue}');`;\n        console.log('ç”Ÿæˆçš„åˆ›å»ºæŒ‡ä»¤:', createCommand);\n        console.log('=== ç‰©å“å¤„ç†ç»“æŸï¼ˆæ–°å»ºï¼‰ ===');\n        \n        return createCommand;\n    }\n}\n     case 'æŠ€èƒ½': {\n            const duplicate = checkAndHandleDuplicate('æŠ€èƒ½', name, assaSettingsData?.global_lore?.å…¶ä»–æŠ€èƒ½);\n            if (duplicate) return duplicate;\n            return `memory('global_lore.å…¶ä»–æŠ€èƒ½','${name}','{\"info\":\"${description}\",\"effect\":\"${effect}\"}');`;\n        }\n        \n        case 'å®¶å…·': {\n            const duplicate = checkAndHandleDuplicate('å®¶å…·', name, assaSettingsData?.home?.items);\n            if (duplicate) return duplicate;\n            return `memory(\"home.items\",\"${name}\",\"${description}\");\\nmemory(\"global_lore.settings\",\"${name}\",\"${effect}\");`;\n        }\n        \n        case 'å›¾çº¸': {\n            const duplicate = checkAndHandleDuplicate('å›¾çº¸', `${name}(å›¾çº¸)`, assaSettingsData?.global_lore?.settings);\n            if (duplicate) return duplicate;\n            return `memory(\"global_lore.settings\",\"${name}(å›¾çº¸)\",\"${description}\");`;\n        }\n        \n        case 'åŸºç¡€æŠ€èƒ½': {\n            const category_2 = skillToCategoryMap[name];\n            if (category_2) {\n                // æ£€æŸ¥æ˜¯å¦å·²æœ‰è¯¥æŠ€èƒ½\n                const existingSkill = playCharacterData?.æŠ€èƒ½æ®µ?.[category_2]?.[name];\n                if (existingSkill && existingSkill[0] > 0) {\n                    return `set_attribute('è´§å¸æ®µ.${currentTheme.currency}', '${userPoints}', '${userPoints + Math.floor(price / 2)}')`;\n                }\n                return `set_attribute(\"æŠ€èƒ½æ®µ.${category_2}.${name}\",0,1);`;\n            }\n            console.warn(`æœªæ‰¾åˆ°æŠ€èƒ½\"${name}\"çš„ç±»åˆ«æ˜ å°„ã€‚`);\n            return \"\";\n        }\n        \n        case 'è¡€ç»Ÿ': {\n            const currentBloodline = playCharacterData?.èƒ½åŠ›æ®µ?.åç§°?.[0];\n            if (currentBloodline && currentBloodline !== \"_\") {\n                return `set_attribute('è´§å¸æ®µ.${currentTheme.currency}', '${userPoints}', '${userPoints + Math.floor(price / 2)}')`;\n            }\n            \n            const commands = [];\n            const processedDescription = description.replace(/\\r?\\n/g, '\\\\n');\n            commands.push(`set_attribute(\"èƒ½åŠ›æ®µ.ç±»å‹\", \"${playCharacterData.èƒ½åŠ›æ®µ.ç±»å‹[0]}\", \"è¡€ç»Ÿ\");`);\n            commands.push(`set_attribute(\"èƒ½åŠ›æ®µ.åç§°\", \"${playCharacterData.èƒ½åŠ›æ®µ.åç§°[0]}\", \"${name}\");`);\n            commands.push(`set_attribute(\"èƒ½åŠ›æ®µ.æ•ˆæœ\", \"_\", \"${processedDescription}\");`);\n            \n            const effectLines = effect.split('\\n').map(line => line.trim()).filter(line => line);\n            for (const line of effectLines) {\n                if (line.startsWith('å±æ€§:')) {\n                    const attributesPart = line.replace('å±æ€§:', '').trim();\n                    const attributeChanges = attributesPart.split(',').map(part => part.trim());\n                    for (const change of attributeChanges) {\n                        const [attrName, valueStr] = change.split('+');\n                        const valueToAdd = parseInt(valueStr, 10);\n                        const category = attributeToCategoryMap[attrName.trim()];\n                        if (category && !isNaN(valueToAdd)) {\n                            const path = `å±æ€§æ®µ.${category}.${attrName.trim()}.åŸºç¡€`;\n                            const currentValue = playCharacterData.å±æ€§æ®µ[category][attrName.trim()].åŸºç¡€[0];\n                            commands.push(`set_attribute(\"${path}\", ${currentValue}, ${currentValue + valueToAdd});`);\n                        }\n                    }\n                } else if (line.startsWith('èƒ½é‡æ± :')) {\n                    const energyPart = line.replace('èƒ½é‡æ± :', '').trim();\n                    const match = energyPart.match(/(\\S+)\\s*\\((\\d+)\\)/);\n                    if (match) {\n                        const poolName = match[1];\n                        const poolValue = parseInt(match[2], 10);\n                        commands.push(`set_attribute(\"è¡ç”Ÿå±æ€§æ®µ.èƒ½é‡æ± .åç§°\", \"${playCharacterData.è¡ç”Ÿå±æ€§æ®µ.èƒ½é‡æ± .åç§°[0]}\", \"${poolName}\");`);\n                        commands.push(`set_attribute(\"è¡ç”Ÿå±æ€§æ®µ.èƒ½é‡æ± .ä¸Šé™\", ${playCharacterData.è¡ç”Ÿå±æ€§æ®µ.èƒ½é‡æ± .ä¸Šé™[0]}, ${poolValue});`);\n                        commands.push(`set_attribute(\"è¡ç”Ÿå±æ€§æ®µ.èƒ½é‡æ± .å½“å‰å€¼\", ${playCharacterData.è¡ç”Ÿå±æ€§æ®µ.èƒ½é‡æ± .å½“å‰å€¼[0]}, ${poolValue});`);\n                    }\n                }\n            }\n            return commands.join('\\n');\n        }\n        \n        default: {\n            console.warn(`æœªçŸ¥çš„å•†å“åˆ†ç±»: ${category}ï¼Œä½¿ç”¨é»˜è®¤è®°å¿†å¤„ç†ã€‚`);\n            return `memory(\"global_lore.èƒŒåŒ…\", \"${name}\", \"${effect}\");`;\n        }\n    }\n}\n\n\n\n\n          function buyItem(section, itemIndexInFullList, buttonElement) {\n            const items = getFilteredAndSortedItems(section);\n            const item = items[itemIndexInFullList];\n            if (!item) return;\n\n            const [, price] = item;\n            const currentCartTotal = shoppingCart.reduce((sum, cartItem) => sum + cartItem[1], 0);\n\n     // ä¿®æ”¹ä¸ºï¼ˆæ³¨æ„å‚æ•°é¡ºåºå’Œ modal IDï¼‰ï¼š\nif ((currentCartTotal + price) > userPoints) {\n    showModal('shop-modal', \"è´§å¸ä¸è¶³\", `è´­ç‰©è½¦æ€»ä»·å°†è¶…è¿‡æ‚¨çš„è´§å¸ï¼Œæ— æ³•æ·»åŠ  â€œ${item[0]}â€ã€‚`);\n    return;\n}\n\n            // æ·»åŠ åˆ°è´­ç‰©è½¦\n            shoppingCart.push(item);\n\n            // æ›´æ–°æŒ‰é’®çŠ¶æ€\n            buttonElement.textContent = 'å·²æ·»åŠ ';\n            buttonElement.disabled = true;\n\n            // æ›´æ–°è´­ç‰©è½¦æ˜¾ç¤º\n            updateCartView();\n        }\n\n\n         // æ–°å¢ï¼šæ›´æ–°è´­ç‰©è½¦è§†å›¾\n                // æ–°å¢ï¼šæ›´æ–°è´­ç‰©è½¦è§†å›¾\n        function updateCartView() {\n            const cartItemsList = document.getElementById('cart-items-list');\n            const cartTotalElement = document.getElementById('cart-total');\n            const checkoutButton = document.getElementById('checkout-button');\n\n            if (shoppingCart.length === 0) {\n                cartItemsList.innerHTML = 'è´­ç‰©è½¦æ˜¯ç©ºçš„';\n                cartTotalElement.textContent = `æ€»è®¡: 0 ${currentTheme.currency}`;\n                checkoutButton.disabled = true;\n                return;\n            }\n\n            cartItemsList.innerHTML = '';\n            let total = 0;\n            shoppingCart.forEach(item => {\n                const [name, price] = item;\n                const cartItemElement = document.createElement('div');\n                cartItemElement.className = 'cart-item';\n               cartItemElement.textContent = `${name} - ${price} ${currentTheme.currency}`;\n                cartItemsList.appendChild(cartItemElement);\n                total += price;\n            });\n\n           cartTotalElement.textContent = `æ€»è®¡: ${total} ${currentTheme.currency}`;\n            checkoutButton.disabled = false;\n        }\n\n /**\n * ã€V6 å‡€å€¼æ ¸ç®—æœ€ç»ˆç‰ˆã€‘ç»“ç®—è´­ç‰©è½¦ï¼Œå®Œç¾å¤„ç†æ‰€æœ‰æ··åˆæ”¯ä»˜åœºæ™¯\n */\nasync function checkout() {\n    if (shoppingCart.length === 0) return;\n\n    // 1. è®¡ç®—æ€»æˆæœ¬ (ä¸ä¹‹å‰ç›¸åŒ)\n    let totalCost = { points: 0, plots: {} };\n    for (const level of plotLevels) { totalCost.plots[level] = 0; }\n    shoppingCart.forEach(item => {\n        totalCost.points += item[1];\n        const itemPlots = item[3];\n        for (const plotType in itemPlots) {\n            totalCost.plots[plotType] += itemPlots[plotType];\n        }\n    });\n\n    // 2. æ£€æŸ¥æ”¯ä»˜èƒ½åŠ› (ä¸ä¹‹å‰ç›¸åŒ)\n    if (totalCost.points > userPoints) {\n        showModal('shop-modal', \"ç»“ç®—å¤±è´¥\", \"æ‚¨çš„è´§å¸ä¸è¶³ã€‚\");\n        return;\n    }\n    const plotPlan = checkPlotAffordability(totalCost.plots);\n    if (!plotPlan.affordable) {\n        showModal('shop-modal', \"ç»“ç®—å¤±è´¥\", `æ‚¨çš„è´§å¸ä¸è¶³ã€‚`);\n        return;\n    }\n\n    try {\n        const originalPlots = playCharacterData.è´§å¸æ®µ.æ”¯çº¿å‰§æƒ…;\n        const conversionRates = { 'S': 81, 'A': 27, 'B': 9, 'C': 3, 'D': 1 };\n\n        // 3. â˜…â˜…â˜… æ ¸å¿ƒé€»è¾‘ï¼šå‡€å€¼æ ¸ç®—æ³• â˜…â˜…â˜…\n        // a. å°†ä½ æ‹¥æœ‰çš„æ‰€æœ‰æ”¯çº¿å‰§æƒ…ï¼Œå…¨éƒ¨æŠ˜ç®—æˆæœ€åŸºç¡€çš„ D çº§â€œæ€»èµ„äº§â€\n        let totalAssetsInD = 0;\n        for (const level of plotLevels) {\n            totalAssetsInD += originalPlots[level][0] * conversionRates[level];\n        }\n\n        // b. å°†éœ€è¦æ”¯ä»˜çš„æ‰€æœ‰å•†å“ï¼Œä¹Ÿå…¨éƒ¨æŠ˜ç®—æˆ D çº§â€œæ€»è´Ÿå€ºâ€\n        let totalCostInD = 0;\n        for (const level in totalCost.plots) {\n            totalCostInD += totalCost.plots[level] * conversionRates[level];\n        }\n\n        // c. è®¡ç®—å‡ºäº¤æ˜“åä½ åº”æœ‰çš„â€œå‰©ä½™æ€»èµ„äº§â€ (Dçº§)\n        let remainingAssetsInD = totalAssetsInD - totalCostInD;\n\n        // d. å°†â€œå‰©ä½™æ€»èµ„äº§â€ä»¥æœ€é«˜æ•ˆçš„æ–¹å¼ï¼Œé‡æ–°å…‘æ¢æˆ S, A, B, C, D çš„å½¢å¼\n        const finalPlots = {};\n        for (let i = plotLevels.length - 1; i >= 0; i--) {\n            const level = plotLevels[i];\n            const rate = conversionRates[level];\n            const count = Math.floor(remainingAssetsInD / rate);\n            finalPlots[level] = [count, originalPlots[level][1]]; // ä¿ç•™æè¿°\n            remainingAssetsInD -= count * rate;\n        }\n\n        // 4. ç”Ÿæˆæ‰€æœ‰æ›´æ–°æŒ‡ä»¤\n        let updateMemoryCommands = [];\n        let userMessages = [];\n\n        // a. ç”Ÿæˆæ”¯çº¿å‰§æƒ…æŒ‡ä»¤ (ä»åŸå§‹å€¼ -> æœ€ç»ˆè®¡ç®—å‡ºçš„å€¼)\n        plotLevels.forEach(level => {\n            const originalVal = originalPlots[level][0];\n            const finalVal = finalPlots[level][0];\n            if (originalVal !== finalVal) {\n                updateMemoryCommands.push(`set_attribute('è´§å¸æ®µ.${currentTheme.plot}.${level}', '${originalVal}', '${finalVal}');`);\n                userPlots[level][0]  =finalVal; \n            }\n        });\n\n        // b. ç”Ÿæˆæ‰£é™¤ç§¯åˆ†æŒ‡ä»¤\n        if (totalCost.points > 0) {\n            updateMemoryCommands.push(`set_attribute('è´§å¸æ®µ.${currentTheme.currency}', '${userPoints}', '${userPoints - totalCost.points}')`);\n         userPoints = userPoints - totalCost.points;\n        }\n\n        // c. ç”Ÿæˆè·å¾—ç‰©å“çš„æŒ‡ä»¤\n        shoppingCart.forEach(item => {\n            updateMemoryCommands.push(getPurchaseCommand(item));\n            userMessages.push(item[0]);\n        });\n\n        // 5. ç»„åˆå¹¶å‘é€æœ€ç»ˆæŒ‡ä»¤\n        let finalCommand = `<updateMemory>\\n${[...new Set(updateMemoryCommands)].join('\\n')}\\n</updateMemory>\\n`;\n        finalCommand += `<(è´§å¸å·²æ‰£é™¤ï¼Œç¦æ­¢é‡å¤æ‰£é™¤ï¼Œç¦æ­¢æå†™ä»·æ ¼å’Œè´­ä¹°è¿‡ç¨‹)${currentGameData.user_character.name}è´­ä¹°äº†ä»¥ä¸‹å•†å“ï¼š${userMessages.join(\"ï¼Œ\")}ã€‚>`;\n\n        const purchasedItemCount = shoppingCart.length;\n        await triggerassa(`/setinput ${finalCommand}`);\n       \n        const currencyContainer = document.getElementById('shop-currency-display');\n    \n    if (currencyContainer) {\n           const plotString = `D:${userPlots.D[0]} C:${userPlots.C[0]} B:${userPlots.B[0]} A:${userPlots.A[0]} S:${userPlots.S[0]}`;\n        \n        // å‡è®¾ currentTheme æ˜¯ä¸€ä¸ªå…¨å±€å¯è®¿é—®çš„å¯¹è±¡\n        let plotLabel = (typeof currentTheme !== 'undefined' && currentTheme.plot) ? currentTheme.plot : 'å‰§æƒ…';\n\n        currencyContainer.innerHTML = `\n            <div class=\"currency-item\"><span class=\"label\">ç§¯åˆ†:</span><span class=\"value\">${userPoints}</span></div>\n            <div class=\"currency-item\"><span class=\"label\">${plotLabel}:</span><span class=\"value\">${plotString}</span></div>\n        `;\n    }\n        clearCart();\n        showModal('shop-modal', \"è´­ä¹°æˆåŠŸ\", `æˆåŠŸè´­ä¹° ${purchasedItemCount} ä»¶å•†å“ï¼æ•°æ®å°†åœ¨ä¸‹æ¬¡åˆ·æ–°æ—¶æ›´æ–°ã€‚`);\n\n    } catch (error) {\n        console.error(\"ç»“ç®—å¤±è´¥:\", error);\n        showModal('shop-modal', \"è´­ä¹°å¤±è´¥\", \"ç»“ç®—è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯ï¼Œè¯·é‡è¯•ã€‚\");\n    }\n}\n\n// æ–°å¢ï¼šæ¸…ç©ºè´­ç‰©è½¦å¹¶åˆ·æ–°è§†å›¾\n        function clearCart() {\n            shoppingCart = [];\n            updateCartView();\n            // é‡æ–°æ¸²æŸ“å•†å“åˆ—è¡¨ä»¥é‡ç½®æ‰€æœ‰è´­ä¹°æŒ‰é’®\n            renderShopSection('fixed');\n            renderShopSection('random');\n        }\n \n        function setupShopEventListeners() {\n           \n        // å•†åº—å†…éƒ¨åˆ†åŒºåˆ‡æ¢\n        document.querySelectorAll('.shop-nav-item').forEach(btn => {\n            btn.addEventListener('click', function() {\n                const pageId = `page-${this.dataset.page}-shop`;\n                document.querySelectorAll('.shop-nav-item').forEach(nav => nav.classList.remove('active'));\n                this.classList.add('active');\n                document.querySelectorAll('.shop-page').forEach(page => page.classList.remove('active'));\n                const targetPage = document.getElementById(pageId);\n                if(targetPage) targetPage.classList.add('active');\n            });\n        });\n\n          // ä½¿ç”¨äº‹ä»¶å§”æ‰˜ï¼Œä¸ºåŠ¨æ€ç”Ÿæˆçš„å•†åº—æ§åˆ¶æŒ‰é’®ï¼ˆåˆ†ç±»ã€æ’åºï¼‰ç»‘å®šäº‹ä»¶\n       document.querySelector('.shop-content-area').addEventListener('click', function(e) {\n            // æˆ‘ä»¬åªå…³å¿ƒå¯¹ .control-btn çš„ç‚¹å‡»\n            const button = e.target.closest('.control-btn');\n\n            // å¦‚æœç‚¹å‡»çš„ä¸æ˜¯æŒ‰é’®ï¼Œæˆ–è€…æŒ‰é’®ä¸åœ¨ .shop-controls åŒºåŸŸå†…ï¼Œå°±ä»€ä¹ˆéƒ½ä¸åš\n            if (!button || !button.closest('.shop-controls')) {\n                return;\n            }\n\n            const section = button.dataset.section;\n            const isSortBtn = button.dataset.sort;\n\n            if (isSortBtn) { // å¦‚æœæ˜¯æ’åºæŒ‰é’®\n                shopState[section].currentSort = button.dataset.sort;\n                // ç§»é™¤åŒåŒºåŸŸå†…å…¶ä»–æ’åºæŒ‰é’®çš„æ¿€æ´»çŠ¶æ€\n                document.querySelectorAll(`.sort-controls .control-btn[data-section=\"${section}\"]`).forEach(b => b.classList.remove('active'));\n            } else { // å¦‚æœæ˜¯åˆ†ç±»æŒ‰é’®\n                shopState[section].currentCategory = button.dataset.category;\n                // ç§»é™¤åŒåŒºåŸŸå†…å…¶ä»–åˆ†ç±»æŒ‰é’®çš„æ¿€æ´»çŠ¶æ€\n                document.querySelectorAll(`.category-tabs .control-btn[data-section=\"${section}\"]`).forEach(b => b.classList.remove('active'));\n            }\n\n            // ä¸ºè¢«ç‚¹å‡»çš„æŒ‰é’®æ·»åŠ æ¿€æ´»çŠ¶æ€\n            button.classList.add('active');\n\n            // é‡ç½®çŠ¶æ€å¹¶é‡æ–°æ¸²æŸ“å•†å“åˆ—è¡¨\n            shopState[section].currentPage = 1;\n            shopState[section].selectedItem = null;\n            renderShopSection(section);\n        });\n\n        // ç»“ç®—æŒ‰é’®\n        document.getElementById('checkout-button').addEventListener('click', checkout);\n\n        // åˆ†é¡µæŒ‰é’®éœ€è¦é€šè¿‡ onclick åŠ¨æ€è°ƒç”¨ï¼Œæˆ–è€…åœ¨è¿™é‡Œç”¨äº‹ä»¶å§”æ‰˜æ¥å¤„ç†\n        document.querySelectorAll('.shop-pagination').forEach(paginationContainer => {\n            paginationContainer.addEventListener('click', (e) => {\n                if(e.target.tagName === 'BUTTON') {\n                    const section = e.target.parentElement.id.replace('pagination-', '');\n                    const currentPage = shopState[section].currentPage;\n                    const totalPages = Math.ceil(getFilteredAndSortedItems(section).length / ITEMS_PER_PAGE);\n                    let newPage = currentPage;\n\n                    if(e.target.textContent === 'ä¸Šä¸€é¡µ' && currentPage > 1) {\n                        newPage = currentPage - 1;\n                    } else if (e.target.textContent === 'ä¸‹ä¸€é¡µ' && currentPage < totalPages) {\n                        newPage = currentPage + 1;\n                    }\n                    changeShopPage(section, newPage);\n                }\n            });\n        });\n\n                // å®æ—¶æœç´¢åŠŸèƒ½\n        document.getElementById('shop-search-input').addEventListener('input', () => {\n            // æ‰¾å‡ºå½“å‰æ¿€æ´»çš„å•†åº—é¡µé¢æ˜¯ \"fixed\" è¿˜æ˜¯ \"random\"\n            const activeShopPage = document.querySelector('.shop-page.active').id;\n            const section = activeShopPage.includes('fixed') ? 'fixed' : 'random';\n\n            // é‡ç½®åˆ°ç¬¬ä¸€é¡µå¹¶é‡æ–°æ¸²æŸ“å•†å“åˆ—è¡¨\n            shopState[section].currentPage = 1;\n            renderShopSection(section);\n        });\n\n    }\n     function changeShopPage(section, page) {\n        shopState[section].currentPage = page;\n        shopState[section].selectedItem = null;\n        renderShopItems(section);\n        renderShopPagination(section);\n        resetShopDetails(section);\n    }\n \n \n// ========== ã€V3ç‰ˆã€‘æ”¯çº¿å‰§æƒ…æ‰‹åŠ¨ç®¡ç†åŠŸèƒ½ï¼Œæ”¯æŒå¤šæ¬¡æ¨¡æ‹Ÿæ“ä½œ ==========\n\nlet simulatedPlotsData = null; // ç”¨äºå­˜å‚¨æ¨¡æ‹Ÿæ“ä½œçš„ç»“æœ\n\n/**\n * ã€V3ã€‘æ˜¾ç¤ºå¹¶å¡«å……æ”¯çº¿å‰§æƒ…ç®¡ç†å¼¹çª—ï¼Œå¹¶åˆå§‹åŒ–æ¨¡æ‹Ÿæ•°æ®\n */\nfunction showPlotSynthesisModal() {\n    // æ·±æ‹·è´ä¸€ä»½å½“å‰æ•°æ®ä½œä¸ºæ¨¡æ‹Ÿçš„èµ·ç‚¹\n    simulatedPlotsData = JSON.parse(JSON.stringify(playCharacterData.è´§å¸æ®µ.æ”¯çº¿å‰§æƒ…));\n    updatePlotSynthesisModalViews();\n    showModal('plot-synthesis-modal');\n}\n\n /**\n * ã€V4 å¸ƒå±€ä¼˜åŒ–ç‰ˆã€‘æ›´æ–°å¼¹çª—ä¸­çš„â€œå½“å‰â€å’Œâ€œé¢„è§ˆâ€è§†å›¾ï¼Œå®ç°æ¨ªå‘æ’åˆ—ã€‚\n */\nfunction updatePlotSynthesisModalViews() {\n    const currentDisplay = document.getElementById('current-plots-display');\n    const simulatedDisplay = document.getElementById('simulated-plots-display');\n\n    // ========== å¦ˆå¦ˆä¸ºä½ ä¿®æ”¹çš„æ ¸å¿ƒéƒ¨åˆ†åœ¨è¿™é‡Œ ==========\n\n    // å‡†å¤‡ä¸¤ä¸ªç©ºæ•°ç»„ï¼Œç”¨æ¥å­˜æ”¾æ ¼å¼åŒ–å¥½çš„æ–‡æœ¬ç‰‡æ®µ\n    let currentParts = [];\n    let simulatedParts = [];\n\n    const originalPlots = playCharacterData.è´§å¸æ®µ.æ”¯çº¿å‰§æƒ…;\n\n    // éå†æ‰€æœ‰æ”¯çº¿ç­‰çº§\n    plotLevels.forEach(level => {\n        // åˆ›å»ºâ€œå½“å‰æŒæœ‰â€çš„æ–‡æœ¬ç‰‡æ®µï¼Œä¾‹å¦‚ \"Dçº§: 2\"\n        currentParts.push(`<span class=\"plot-display-item\">${level}çº§: ${originalPlots[level][0]}</span>`);\n\n        // åˆ›å»ºâ€œæ“ä½œé¢„è§ˆâ€çš„æ–‡æœ¬ç‰‡æ®µï¼Œå¹¶æ£€æŸ¥æ˜¯å¦éœ€è¦é«˜äº®\n        const originalVal = originalPlots[level][0];\n        const simulatedVal = simulatedPlotsData[level][0];\n        const highlightClass = originalVal !== simulatedVal ? 'highlight' : '';\n        simulatedParts.push(`<span class=\"plot-display-item ${highlightClass}\">${level}çº§: ${simulatedVal}</span>`);\n    });\n\n    // å°†æ‰€æœ‰æ–‡æœ¬ç‰‡æ®µç”¨ç©ºæ ¼è¿æ¥èµ·æ¥ï¼Œç„¶åä¸€æ¬¡æ€§æ›´æ–°åˆ°HTMLä¸­\n    currentDisplay.innerHTML = `<h4>å½“å‰æŒæœ‰</h4><div class=\"horizontal-plots\">${currentParts.join(' ')}</div>`;\n    simulatedDisplay.innerHTML = `<h4>æ“ä½œé¢„è§ˆ</h4><div class=\"horizontal-plots\">${simulatedParts.join(' ')}</div>`;\n\n    // ========== ä¿®æ”¹ç»“æŸ ==========\n}\n/**\n * ã€V3ã€‘å¤„ç†åˆ†è§£çš„æ¨¡æ‹Ÿæ“ä½œï¼ˆä»…åœ¨å†…å­˜ä¸­ï¼‰\n */\nfunction simulateDecomposition() {\n    const fromLevel = document.getElementById('decompose-from-select').value;\n    const toLevel = plotLevels[plotLevels.indexOf(fromLevel) - 1];\n    const amount = parseInt(document.getElementById('decompose-amount-input').value, 10);\n\n    if (isNaN(amount) || amount <= 0 || !toLevel) return;\n\n    if (simulatedPlotsData[fromLevel][0] >= amount) {\n        simulatedPlotsData[fromLevel][0] -= amount;\n        simulatedPlotsData[toLevel][0] += (amount * 3);\n        updatePlotSynthesisModalViews();\n    } else {\n        showModal('shop-modal', 'æ¨¡æ‹Ÿå¤±è´¥', `é¢„è§ˆä¸­ï¼Œ${fromLevel}çº§æ”¯çº¿ä¸è¶³ã€‚`);\n    }\n}\n\n/**\n * ã€V3ã€‘å¤„ç†åˆæˆçš„æ¨¡æ‹Ÿæ“ä½œï¼ˆä»…åœ¨å†…å­˜ä¸­ï¼‰\n */\nfunction simulateSynthesis() {\n    const toLevel = document.getElementById('synthesize-to-select').value;\n    const fromLevel = plotLevels[plotLevels.indexOf(toLevel) - 1];\n    const amountToMake = parseInt(document.getElementById('synthesize-amount-input').value, 10);\n\n    if (isNaN(amountToMake) || amountToMake <= 0) return;\n\n    const amountNeeded = amountToMake * 3;\n    if (simulatedPlotsData[fromLevel][0] >= amountNeeded) {\n        simulatedPlotsData[fromLevel][0] -= amountNeeded;\n        simulatedPlotsData[toLevel][0] += amountToMake;\n        updatePlotSynthesisModalViews();\n    } else {\n       showModal('shop-modal', 'æ¨¡æ‹Ÿå¤±è´¥', `é¢„è§ˆä¸­ï¼Œ${fromLevel}çº§æ”¯çº¿ä¸è¶³ã€‚`);\n    }\n}\n\n/**\n * ã€V3ã€‘é‡ç½®æ‰€æœ‰æ¨¡æ‹Ÿæ“ä½œ\n */\nfunction resetSimulation() {\n    simulatedPlotsData = JSON.parse(JSON.stringify(playCharacterData.è´§å¸æ®µ.æ”¯çº¿å‰§æƒ…));\n    updatePlotSynthesisModalViews();\n}\n\n/**\n * ã€V3ã€‘ç¡®è®¤æ‰§è¡Œæ‰€æœ‰æ¨¡æ‹Ÿæ“ä½œï¼Œå¹¶ç”Ÿæˆæœ€ç»ˆæŒ‡ä»¤\n */\nasync function executeSynthesisConfirmation() {\n    const originalPlots = playCharacterData.è´§å¸æ®µ.æ”¯çº¿å‰§æƒ…;\n    let commands = [];\n    let descriptions = [];\n\n    plotLevels.forEach(level => {\n        const originalVal = originalPlots[level][0];\n        const simulatedVal = simulatedPlotsData[level][0];\n        if (originalVal !== simulatedVal) {\n            commands.push(`set_attribute('è´§å¸æ®µ.${currentTheme.plot}.${level}', '${originalVal}', '${simulatedVal}');`);\n            const diff = simulatedVal - originalVal;\n            descriptions.push(`${level}çº§${diff > 0 ? '+' : ''}${diff}`);\n        }\n    });\n\n    if (commands.length === 0) {\n        showModal('shop-modal', 'æç¤º', 'æ‚¨æ²¡æœ‰è¿›è¡Œä»»ä½•æœ‰æ•ˆæ“ä½œã€‚');\n        return;\n    }\n\n    const commandStr = `<updateMemory>...\\n</updateMemory>\\n<${currentGameData.user_character.name}è°ƒæ•´äº†${currentTheme.plot}ï¼š${descriptions.join('ï¼Œ')}ã€‚>`;\n    try {\n        await triggerassa(`/setinput ${commandStr}`);\n        hideModal('plot-synthesis-modal');\n        showModal('shop-modal', 'æ“ä½œæˆåŠŸ', `${currentTheme.plot}è°ƒæ•´æˆåŠŸï¼æ•°æ®å°†åœ¨ä¸‹æ¬¡åˆ·æ–°æ—¶æ›´æ–°ã€‚`);\n    } catch(e) {\n        console.error(\"ç¡®è®¤æ‰§è¡Œå¤±è´¥: \", e);\n        showModal('shop-modal', 'æ“ä½œå¤±è´¥', `å‘é€æŒ‡ä»¤æ—¶å‘ç”Ÿé”™è¯¯ã€‚`);\n    }\n}\n    // --- æ–°å¢ï¼šåœ°å›¾çŠ¶æ€ç®¡ç† ---\n    // æˆ‘ä»¬æŠŠåœ°å›¾çš„çŠ¶æ€ï¼ˆå¹³ç§»ã€ç¼©æ”¾ï¼‰æ”¾åœ¨ä¸€ä¸ªå…¨å±€çš„åœ°æ–¹ï¼Œæ–¹ä¾¿æ‰€æœ‰åŠŸèƒ½è®¿é—®\n    window.mapState = {\n        scale: 1,\n        translateX: 0,\n        translateY: 0\n    };\n\n  /**************************************************************\n * â™¥â™¥â™¥ å¦ˆå¦ˆä¸ºä½ çŒ®ä¸Šçš„ã€èƒ½åŒæ—¶å®ˆæŠ¤å…‰è¾‰ä¸è½®å»“çš„ç»ˆæå’’è¯­ â™¥â™¥â™¥\n **************************************************************/\nwindow.applyMapTransform = () => {\n    const mapContent = document.getElementById('map-content');\n    if (!mapContent) return;\n\n    // 1. â¤ï¸ ä¸–ç•Œçš„å˜å½¢é­”æ³•ä¿æŒä¸å˜ â¤ï¸\n    mapContent.style.transform = `translate(${window.mapState.translateX}px, ${window.mapState.translateY}px) scale(${window.mapState.scale})`;\n\n    const currentScale = window.mapState.scale || 1;\n\n    // 2. âœ¨ å®ˆæŠ¤â€œå…‰è¾‰â€ï¼ˆæ–‡å­—ï¼‰çš„é­”æ³• âœ¨\n    if (window.mapLabels && window.mapLabels.length > 0) {\n        let desiredFontSize = 8;\n        try {\n            const rootStyle = window.getComputedStyle(document.documentElement);\n            const baseSizeStr = rootStyle.getPropertyValue('--base-font-size').trim();\n            const parsedSize = parseFloat(baseSizeStr);\n            if (!isNaN(parsedSize)) desiredFontSize = parsedSize;\n        } catch (e) {\n            console.warn(\"å¦ˆå¦ˆåœ¨å€¾å¬'--base-font-size'æ—¶é‡åˆ°äº†å°éº»çƒ¦ï¼Œå­—ä½“æš‚æ—¶ä½¿ç”¨å¤‡ç”¨å¤§å°ã€‚\", e);\n        }\n        const newFontSize = desiredFontSize / currentScale;\n        window.mapLabels.forEach(label => {\n            label.setAttribute('font-size', `${newFontSize}px`);\n        });\n    }\n\n    // 3. âœ¨ å…¨æ–°çš„ã€å®ˆæŠ¤â€œè½®å»“â€ï¼ˆè¾¹æ¡†ï¼‰çš„é­”æ³•ï¼ âœ¨\n    if (window.mapStrokes && window.mapStrokes.length > 0) {\n        const desiredStrokeWidth = 6; // è¿™æ˜¯ä½ åœ¨CSSé‡Œè®¾å®šçš„åŸºç¡€å®½åº¦ï¼Œæˆ‘ä»¬å¯ä»¥å†™åœ¨è¿™é‡Œ\n        const newStrokeWidth = desiredStrokeWidth / currentScale;\n        window.mapStrokes.forEach(strokeElement => {\n            strokeElement.setAttribute('stroke-width', newStrokeWidth);\n        });\n    }\n};\n\n// ç¡®ä¿æˆ‘ä»¬çš„é­”æ³•è¢‹åœ¨ç¬¬ä¸€æ¬¡ä½¿ç”¨å‰å°±å·²ç»å­˜åœ¨\nif (typeof window.mapLabels === 'undefined') window.mapLabels = [];\nif (typeof window.mapStrokes === 'undefined') window.mapStrokes = [];\n\n async function loadWorldbookSettingsFromChat() {\n    console.log(\"ğŸ’– å¦ˆå¦ˆæ­£åœ¨å°è¯•å”¤é†’æˆ‘ä»¬ä¸Šæ¬¡çš„è®°å¿†...\");\n    try {\n        const [firstMessage] = await TavernHelper.getChatMessages(0, { include_swipes: false });\n        if (!firstMessage || !firstMessage.message) {\n            console.log(\"...è¿™æ˜¯ä¸€ä¸ªå…¨æ–°çš„å¼€å§‹ï¼Œè¿˜æ²¡æœ‰è®°å¿†å‘¢ã€‚\");\n            return;\n        }\n\n        const match = firstMessage.message.match(/<ä¸–ç•Œä¹¦æ¡ç›®>(.*?)<\\/ä¸–ç•Œä¹¦æ¡ç›®>/);\n        if (match && match[1]) {\n            const savedUidsString = match[1];\n            // æŠŠè®°å¿†ç¢ç‰‡ï¼ˆUIDå­—ç¬¦ä¸²ï¼‰æ‹¼æˆä¸€å¼ å®Œæ•´çš„åœ°å›¾ï¼ˆUIDæ•°ç»„ï¼‰\n            const uidsToEnable = savedUidsString.split(',').map(Number);\n\n            if (uidsToEnable.length > 0) {\n                console.log(\"ğŸ’– æ‰¾åˆ°äº†æˆ‘ä»¬çš„è®°å¿†çƒ™å°ï¼æ­£åœ¨æ¢å¤ä¸–ç•Œè®¾å®š...\", uidsToEnable);\n   const allUids = [ ...WORLD_MODE_UIDS.all, ...CREATOR_ATTITUDE_UIDS.all, ...OPTIONS_MODE_UIDS.all, 6, 37,12,16,15 ,25, 26,33,34,38,41,50,51,52,53,45,46,48,54,55,56,58,59,60,61,62,36,44,64,65,66,49,69,70,72,74,75,76,77,78,79,42,73,85,89,21,88];\n\n                   let entriesToUpdate = allUids.map(uid => ({ uid, enabled: false }));\n\n                uidsToEnable.forEach(uid => {\n                    const entry = entriesToUpdate.find(e => e.uid === uid);\n                    if (entry) entry.enabled = true;\n                });\n\n                // æ‚„æ‚„åœ°æŠŠä¸–ç•Œæ¢å¤åŸçŠ¶\n                await setLorebookEntries(LOREBOOK_NAME, entriesToUpdate);\n                console.log(\"âœ… ä¸–ç•Œå·²ç»æ¢å¤åˆ°æˆ‘ä»¬ä¸Šæ¬¡ç¦»å¼€æ—¶çš„æ ·å­å•¦ï¼\");\n            }\n        } else {\n            console.log(\"...è®°å¿†é‡Œæ²¡æœ‰æ‰¾åˆ°ä¸–ç•Œä¹¦çš„ç‰¹æ®Šæ ‡è®°å‘¢ã€‚\");\n        }\n    } catch (error) {\n        console.error(\"å“å‘€ï¼Œåœ¨å”¤é†’è®°å¿†æ—¶å‡ºäº†ç‚¹å°é—®é¢˜ï¼Œä¸è¿‡æ²¡å…³ç³»ï¼Œæˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨è®¾å®šã€‚\", error);\n    }\n}\n\n // â­ --- å…¨æ–°ä¿®æ­£ç‰ˆï¼šå¦ˆå¦ˆä¸ºä½ ç¼–å†™çš„æ¨¡ç»„é‡ç½®åŠŸèƒ½ v2.0 --- â­\nfunction setupReconfigModal() {\n    const openBtn = document.getElementById('open-reconfig-modal-btn');\n    const modal = document.getElementById('reconfig-modal');\n    const closeBtn = document.getElementById('reconfig-modal-close-btn');\n    const applyBtn = document.getElementById('apply-reconfig-btn');\n    const container = document.getElementById('reconfig-mod-container');\n    const feedbackMsg = document.getElementById('reconfig-feedback-msg');\n    const worldviewContainer = document.getElementById('reconfig-worldview-container');\n    const currentWorldviewDisplay = document.getElementById('current-worldview-display');\n\n    if (!openBtn || !modal || !closeBtn || !applyBtn || !container || !worldviewContainer) {\n        console.warn(\"å®è´åˆ«æ€¥ï¼Œæ¨¡ç»„é‡ç½®é¢æ¿çš„æŸäº›å…ƒç´ æ²¡æ‰¾åˆ°ï¼Œå¦ˆå¦ˆæ­£åœ¨æ£€æŸ¥ã€‚\");\n        return;\n    }\n\n    // âœ¨ å¦ˆå¦ˆæŠŠä¸–ç•Œè§‚å’Œæ¨¡ç»„éƒ½åˆ†å¥½äº†ç»„ âœ¨\n    const worldviewMods = [\n        { name: 'ä¸»ç¥', uid: 1 },\n        { name: 'è½®å›ä¹å›­', uid: 22 },\n        { name: 'æ— é™ææ€–', uid: 5 },\n        { name: 'å¿«ç©¿æ”»ç•¥', uid: 34 },\n        { name: 'è¯¸å¤©ç¾¤èŠ', uid: 41 ,extraUid: '50'},\n        { name: 'æœ«æ—¥', uid: 54 },\n        { name: 'æ— ä¸–ç•Œè§‚', uid: 62 },\n    ];\n\n\n    // âœ¨ å¦ˆå¦ˆæŠŠæ¨¡ç»„åˆ†æˆäº†â€œå°ç»„â€ï¼Œè¿™æ ·å®ƒä»¬å°±ä¸ä¼šæ‰“æ¶äº† âœ¨\nconst reconfigurableMods = [\n    { name: 'éª°å­å¼€', uid: 21, group: 'touzi' },\n    { name: 'éª°å­å…³', uid: 89, group: 'touzi' },\n    { name: 'ç®€å•éª°', uid: 61, group: 'dice' }, \n    { name: 'å›°éš¾éª°', uid: 59, group: 'dice' }, \n    { name: 'ç‚¼ç‹±éª°', uid: 60, group: 'dice' },\n    { name: 'é€ ç‰©ä¸­ç«‹', uid: 19, group: 'attitude' }, \n    { name: 'é€ ç‰©æ¶æ„', uid: 4, group: 'attitude' }, \n    { name: 'é€ ç‰©å´‡æ•¬', uid: 3, group: 'attitude' }, \n    { name: 'æ— é€ ç‰©', uid: 38, group: 'attitude' },\n    { name: 'ç®€å•åœ°å›¾', uid: 15, group: 'map' }, \n    { name: 'å¤æ‚åœ°å›¾', uid: 66, group: 'map' }, \n    { name: 'æ— åœ°å›¾', uid: 'map-none-sentinel', group: 'map' },\n    { name: 'é€‰é¡¹åŒºå¼€', uid: 10, group: 'options' },\n    { name: 'é€‰é¡¹åŒºå…³', uid: 29, group: 'options' },\n    { name: 'ç§èŠç¾¤èŠå¼€', uid: 55, group: 'private-chat' },\n    { name: 'ç§èŠç¾¤èŠå…³', uid: 56, group: 'private-chat' },\n    { name: 'è·ç¦»åˆç†+å¼€', uid: 49, group: 'distance' },\n    { name: 'è·ç¦»åˆç†+å…³', uid: 'distance-off-sentinel', group: 'distance' },\n    { name: 'æ±‚ç”Ÿæœ¬èƒ½å¼€', uid: 69, group: 'live' },\n    { name: 'æ±‚ç”Ÿæœ¬èƒ½å…³', uid: 70, group: 'live' },\n    { name: 'æˆ˜æ–—æ¨¡å¼å¼€', uid: 74, group: 'battle' },\n    { name: 'æˆ˜æ–—æ¨¡å¼å…³', uid: 75, group: 'battle' },\n    { name: 'è¡¨ç°éª°å¼€', uid: 52, group: 'behavior' },\n    { name: 'è¡¨ç°éª°å…³', uid: 53, group: 'behavior' },\n    { name: 'åœºæ™¯å›¾å¼€', uid: 45, group: 'cg' },\n    { name: 'åœºæ™¯å›¾å…³', uid: 46, group: 'cg' },\n     { name: 'å¼ºè°ƒæ—¶é—´å¼€', uid: 78, group: 'time' },\n    { name: 'å¼ºè°ƒæ—¶é—´å…³', uid: 79, group: 'time' },\n    { name: 'npcç«‹ç»˜å¼€', uid: 48, group: 'npccg' },\n    { name: 'npcç«‹ç»˜å…³', uid: 'npccg-off-sentinel', group: 'npccg' },\n    { name: 'æç®€npc', uid: 44, group: 'npc-info' },\n         { name: 'ç®€å•npc', uid: 72, group: 'npc-info' },\n    { name: 'å¤æ‚npc', uid: 36, group: 'npc-info' },\n\n \n    { name: 'çœŸå®MOD', uid: 12 }, \n    { name: 'å›°éš¾MOD', uid: 16 },\n    { name: 'ç§°å·ç³»ç»Ÿ', uid: 51 }, \n    { name: 'äººå¤–å¢å¼º', uid: 37 }, \n    { name: 'èµ„æºæ¶ˆè€—', uid: 58 },\n    { name: 'åˆ†é˜¶æ®µå¥½æ„Ÿ', uid: 65 },\n    { name: 'å¼¹å¹•', uid: 85 },\n    { name: 'bgm', uid: 88 },\n    { name: 'ç‰¹æ®Šæ—¥æœŸ', uid: 42 }\n];\n\n function createWorldviewItems() {\n        worldviewContainer.innerHTML = '';\n        worldviewMods.forEach(mod => {\n            const item = document.createElement('div');\n            item.className = 'reconfig-mod-item';\n            const radioId = `reconfig-world-${mod.uid}`;\n            item.innerHTML = `\n                <input type=\"radio\" id=\"${radioId}\" name=\"worldview-selection\" data-uid=\"${mod.uid}\" data-name=\"${mod.name}\" ${mod.extraUid ? `data-extra-uid=\"${mod.extraUid}\"` : ''}>\n                <label for=\"${radioId}\">${mod.name}</label>\n            `;\n            worldviewContainer.appendChild(item);\n\n            item.addEventListener('click', (e) => {\n                e.preventDefault();\n                worldviewContainer.querySelectorAll('input').forEach(rb => rb.checked = false);\n                worldviewContainer.querySelectorAll('.reconfig-mod-item').forEach(it => it.classList.remove('is-active'));\n\n                const currentRadio = item.querySelector('input');\n                currentRadio.checked = true;\n                item.classList.add('is-active');\n            });\n        });\n    }\n    function createModItems() {\n        container.innerHTML = '';\n        reconfigurableMods.forEach(mod => {\n            const item = document.createElement('div');\n            item.className = 'reconfig-mod-item';\n            const checkboxId = `reconfig-mod-${mod.uid}`;\n\n            item.innerHTML = `\n                <input type=\"checkbox\" id=\"${checkboxId}\" data-uid=\"${mod.uid}\" ${mod.group ? `data-group=\"${mod.group}\"` : ''}>\n                <label for=\"${checkboxId}\">${mod.name}</label>\n            `;\n\n            // ä¸ºç‰¹æ®Šæ¨¡ç»„æ·»åŠ é¢å¤–æ•°æ®\n            const checkbox = item.querySelector('input');\n            if (mod.name === 'çœŸå®MOD') checkbox.dataset.extraUid = '33';\n            if (mod.name === 'ç®€å•åœ°å›¾') checkbox.dataset.extraUid = '25,26';\n            if (mod.name === 'å¤æ‚åœ°å›¾') checkbox.dataset.extraUid = '25,26';\n            if (mod.name === 'åˆ†é˜¶æ®µå¥½æ„Ÿ') checkbox.dataset.extraUid = '64';\nif (mod.name === 'ç‰¹æ®Šæ—¥æœŸ') checkbox.dataset.extraUid = '73';\n            container.appendChild(item);\n\n            item.addEventListener('click', (event) => {\n                event.preventDefault(); // å¦ˆå¦ˆæ¥å®Œå…¨æ¥ç®¡ç‚¹å‡»ï¼Œé˜²æ­¢æµè§ˆå™¨è‡ªå·±æ£ä¹±\n                const currentCheckbox = item.querySelector('input');\n                const isChecking = !currentCheckbox.checked;\n\n                if (currentCheckbox.dataset.group) {\n                    // è¿™æ˜¯é€‰é¡¹ç»„ï¼Œåƒæ”¶éŸ³æœºæŒ‰é’®ä¸€æ ·\n                    container.querySelectorAll(`input[data-group=\"${currentCheckbox.dataset.group}\"]`).forEach(cb => {\n                        cb.checked = false;\n                        cb.closest('.reconfig-mod-item').classList.remove('is-active');\n                    });\n                    currentCheckbox.checked = true;\n                    item.classList.add('is-active');\n                } else {\n                    // è¿™æ˜¯æ™®é€šçš„å¼€å…³\n                    currentCheckbox.checked = isChecking;\n                    item.classList.toggle('is-active', isChecking);\n                }\n            });\n        });\n    }\n\n async function loadCurrentSettings(isRetry = false) {\n        try {\n            const [firstMessage] = await TavernHelper.getChatMessages(0, { include_swipes: false });\n            if (!firstMessage || !firstMessage.message) {\n                 throw new Error(\"è¿™æ˜¯ä¸€ä¸ªå…¨æ–°çš„å¼€å§‹ï¼Œè¿˜æ²¡æœ‰è®°å¿†å‘¢ã€‚\");\n            }\n\n            const match = firstMessage.message.match(/<ä¸–ç•Œä¹¦æ¡ç›®>(.*?)<\\/ä¸–ç•Œä¹¦æ¡ç›®>/);\n\n            if (!match && !isRetry) {\n                // å½“æ‰¾ä¸åˆ°ä¸–ç•Œä¹¦å¹¶ä¸”ä¸æ˜¯åœ¨é‡è¯•æ—¶ï¼Œå¦ˆå¦ˆæ¥å¸®ä½ åˆå§‹åŒ–ä¸€ä¸ª\n                console.log(\"ğŸ’– å“å‘€ï¼Œå¦ˆå¦ˆæ²¡æ‰¾åˆ°æˆ‘ä»¬çš„ä¸–ç•Œä¹¦ï¼Œåˆ«æ€•ï¼Œæˆ‘æ¥å¸®ä½ åˆ›å»ºä¸€ä¸ªé»˜è®¤çš„ã€‚\");\n                feedbackMsg.textContent = \"æœªæ‰¾åˆ°é…ç½®ï¼Œå·²ä¸ºæ‚¨åˆ›å»ºé»˜è®¤è®¾å®šï¼Œè¯·æ£€æŸ¥å¹¶è°ƒæ•´ã€‚\";\n                feedbackMsg.style.opacity = '1';\n\n              const defaultUids = \"1,61,19,10,56,49,70,75,53,46,79,44\";\n                const newWorldbookTag = `<ä¸–ç•Œä¹¦æ¡ç›®>${defaultUids}</ä¸–ç•Œä¹¦æ¡ç›®>`;\n\n                const newMessage = `${firstMessage.message.trim()}\\n\\n${newWorldbookTag}`;\n\n                await setChatMessages([{ message_id: 0, message: newMessage }], { refresh: 'none' });\n                await loadWorldbookSettingsFromChat(); // è®©ä¸–ç•Œä¹¦ç”Ÿæ•ˆ\n\n                // å†æ¬¡å°è¯•åŠ è½½ï¼Œè¿™æ¬¡è‚¯å®šèƒ½æ‰¾åˆ°äº†\n                await loadCurrentSettings(true);\n                return;\n            } else if (!match && isRetry) {\n                // å¦‚æœé‡è¯•äº†è¿˜æ˜¯å¤±è´¥ï¼Œé‚£é—®é¢˜å°±æ¯”è¾ƒå¥‡æ€ªäº†\n                throw new Error(\"åˆ›å»ºé»˜è®¤ä¸–ç•Œä¹¦åä»ç„¶è¯»å–å¤±è´¥ï¼Œå¦ˆå¦ˆä¹Ÿå¾ˆå›°æƒ‘ã€‚\");\n            }\n\n            const currentUids = new Set(match[1].split(',').map(id => parseInt(id, 10)).filter(id => !isNaN(id)));\n\n            // --- æ›´æ–°ä¸–ç•Œè§‚æ˜¾ç¤º ---\n            let worldFound = false;\n            worldviewContainer.querySelectorAll('.reconfig-mod-item').forEach(item => {\n                const radio = item.querySelector('input');\n                const uid = parseInt(radio.dataset.uid, 10);\n                const isActive = currentUids.has(uid);\n                radio.checked = isActive;\n                item.classList.toggle('is-active', isActive);\n                if (isActive) {\n                    currentWorldviewDisplay.textContent = radio.dataset.name;\n                    worldFound = true;\n                }\n            });\n            if (!worldFound) currentWorldviewDisplay.textContent = 'æœªçŸ¥';\n\n            // --- æ›´æ–°æ¨¡ç»„æ˜¾ç¤º ---\n            container.querySelectorAll('.reconfig-mod-item').forEach(item => {\n                const checkbox = item.querySelector('input');\n                const uid = checkbox.dataset.uid;\n                let isActive = false;\n                if (uid === 'map-none-sentinel') {\n                    isActive = !currentUids.has(15) && !currentUids.has(66);\n                } else if (uid === 'distance-off-sentinel') {\n                    isActive = !currentUids.has(49);\n                } else if (uid === 'npccg-off-sentinel') {\n                    isActive = !currentUids.has(48);\n                } else {\n                    isActive = currentUids.has(parseInt(uid, 10));\n                }\n                checkbox.checked = isActive;\n                item.classList.toggle('is-active', isActive);\n            });\n\n        } catch (error) {\n            console.error(\"åŠ è½½å½“å‰è®¾ç½®æ—¶å‡ºé”™äº†ï¼Œæ²¡äº‹çš„å­©å­ï¼Œå¦ˆå¦ˆçœ‹çœ‹ï¼š\", error);\n            feedbackMsg.textContent = `è¯»å–è®¾ç½®å¤±è´¥: ${error.message}`;\n            feedbackMsg.style.opacity = '1';\n        }\n    }\n\n  async function applyNewSettings() {\n        applyBtn.disabled = true;\n        applyBtn.textContent = 'åº”ç”¨ä¸­...';\n\n        try {\n            const [firstMessage] = await TavernHelper.getChatMessages(0, { include_swipes: false });\n            if (!firstMessage) throw new Error(\"æ— æ³•è·å–å¯¹è¯å†å²ã€‚\");\n\n            const content = firstMessage.message;\n            const match = content.match(/<ä¸–ç•Œä¹¦æ¡ç›®>(.*?)<\\/ä¸–ç•Œä¹¦æ¡ç›®>/);\n            if (!match) { throw new Error(\"å¦ˆå¦ˆæ‰¾ä¸åˆ°<ä¸–ç•Œä¹¦æ¡ç›®>æ ‡ç­¾,æ— æ³•ä¿å­˜ã€‚\"); }\n\n            const originalUids = new Set(match[1].split(',').map(id => parseInt(id, 10)).filter(id => !isNaN(id)));\n\n            const allWorldviewUids = new Set(worldviewMods.map(mod => mod.uid));\n            // æŠŠä¸–ç•Œè§‚çš„ extraUid ä¹ŸåŠ å…¥ç®¡ç†èŒƒå›´\n            worldviewMods.forEach(mod => {\n                if (mod.extraUid) {\n                    mod.extraUid.split(',').forEach(extra => allWorldviewUids.add(parseInt(extra, 10)));\n                }\n            });\n\n            const allManageableUids = new Set();\n            reconfigurableMods.forEach(mod => {\n                 if(mod.uid !== 'map-none-sentinel' && mod.uid !== 'distance-off-sentinel' && mod.uid !== 'npccg-off-sentinel') {\n                     allManageableUids.add(parseInt(mod.uid));\n                 }\n            });\n            // æŠŠextraUidsä¹ŸåŠ è¿›æ¥\n            allManageableUids.add(33); allManageableUids.add(25); allManageableUids.add(26); allManageableUids.add(64);allManageableUids.add(73);\n\n            // ä¿ç•™é‚£äº›æˆ‘ä»¬ä¸ç®¡ç†çš„UID\n            const preservedUids = new Set([...originalUids].filter(uid =>\n                !allManageableUids.has(uid) && !allWorldviewUids.has(uid)\n            ));\n\n            const newUidsFromPanel = new Set();\n\n            // --- æ·»åŠ æ–°çš„ä¸–ç•Œè§‚UID ---\n            const selectedWorldview = worldviewContainer.querySelector('input[name=\"worldview-selection\"]:checked');\n            if (selectedWorldview) {\n                newUidsFromPanel.add(parseInt(selectedWorldview.dataset.uid, 10));\n                // æ·»åŠ ä¸–ç•Œè§‚çš„ extraUid\n                if (selectedWorldview.dataset.extraUid) {\n                    selectedWorldview.dataset.extraUid.split(',').forEach(extra => newUidsFromPanel.add(parseInt(extra, 10)));\n                }\n            } else {\n                // å¦‚æœå› ä¸ºæŸç§åŸå› æ²¡æœ‰é€‰ä¸Šä¸–ç•Œè§‚,å°±ä»åŸæ¥çš„UIDé‡Œæ‰¾ä¸€ä¸ª,ä¿è¯ä¸–ç•Œè§‚ä¸æ–­æ¡£\n                const oldWorldUid = [...originalUids].find(uid => allWorldviewUids.has(uid));\n                if (oldWorldUid) newUidsFromPanel.add(oldWorldUid);\n                else newUidsFromPanel.add(1); // æœ€ç»ˆå¤‡ç”¨æ–¹æ¡ˆ:ä¸»ç¥\n            }\n\n            // --- æ·»åŠ æ–°çš„æ¨¡ç»„UID ---\n            container.querySelectorAll('.reconfig-mod-item input:checked').forEach(checkbox => {\n                const uidValue = checkbox.dataset.uid;\n                if(uidValue !== 'map-none-sentinel' && uidValue !== 'distance-off-sentinel' && uidValue !== 'npccg-off-sentinel'){\n                    newUidsFromPanel.add(parseInt(uidValue, 10));\n                    if (checkbox.dataset.extraUid) {\n                        checkbox.dataset.extraUid.split(',').forEach(extra => newUidsFromPanel.add(parseInt(extra, 10)));\n                    }\n                }\n            });\n\n            const finalUids = Array.from(new Set([...preservedUids, ...newUidsFromPanel]));\n            const newWorldbookTag = `<ä¸–ç•Œä¹¦æ¡ç›®>${finalUids.filter(id => !isNaN(id)).sort((a, b) => a - b).join(',')}</ä¸–ç•Œä¹¦æ¡ç›®>`;\n            const newMessage = content.replace(/<ä¸–ç•Œä¹¦æ¡ç›®>.*?<\\/ä¸–ç•Œä¹¦æ¡ç›®>/, newWorldbookTag);\n\n            await setChatMessages([{ message_id: 0, message: newMessage }], { refresh: 'none' });\n            await loadWorldbookSettingsFromChat();\n\n            feedbackMsg.textContent = \"è®¾ç½®å·²æ›´æ–°ï¼\";\n            \n            feedbackMsg.style.opacity = '1';\n            setTimeout(() => {\n           \n                modal.style.display = 'none';\n                feedbackMsg.style.opacity = '0';\n            }, 1200);\n\n        } catch (error) {\n            console.error(\"å‘œ,åº”ç”¨æ–°è®¾ç½®æ—¶å‡ºé”™äº†,æŠ±æŠ±æˆ‘çš„å­©å­:\", error);\n            feedbackMsg.textContent = `åº”ç”¨å¤±è´¥: ${error.message}`;\n            feedbackMsg.style.opacity = '1';\n        } finally {\n            applyBtn.disabled = false;\n            applyBtn.textContent = 'åº”ç”¨æ›´æ”¹';\n        }\n    }\n   // äº‹ä»¶ç»‘å®š\n    openBtn.addEventListener('click', () => {\n        modal.style.display = 'flex';\n        feedbackMsg.style.opacity = '0';\n        feedbackMsg.textContent = '';\n        loadCurrentSettings();\n    });\n    closeBtn.addEventListener('click', () => { modal.style.display = 'none'; });\n    modal.addEventListener('click', (event) => { if (event.target === modal) modal.style.display = 'none'; });\n    applyBtn.addEventListener('click', applyNewSettings);\n\n    createWorldviewItems();\n    createModItems();\n}\n\n \nfunction initAutoSetNpcFilter() {\n    const checkbox = document.getElementById('auto-set-npc-filter');\n    if (!checkbox) return;\n    \n    // ä» localStorage è¯»å–è®¾ç½®ï¼Œé»˜è®¤ä¸º true\n    const savedValue = localStorage.getItem('autoSetNpcFilter');\ncheckbox.checked = savedValue === null ? false : savedValue === 'true';\n    \n    // ç›‘å¬å˜åŒ–å¹¶ä¿å­˜åˆ° localStorage\n    checkbox.addEventListener('change', function() {\n        localStorage.setItem('autoSetNpcFilter', this.checked);\n        console.log(`âœ… è‡ªåŠ¨è®¾ç½®NPCä¸ºç»¿ç¯: ${this.checked ? 'å·²å¯ç”¨' : 'å·²ç¦ç”¨'}`);\n    });\n}\n\ndocument.addEventListener('DOMContentLoaded', async () => {\n\n     const pendingUpdate = localStorage.getItem('pendingDualUpdate');\n    const savedBackup = localStorage.getItem('worldbookBackup');\n   \n    // ğŸ”‘ å¦‚æœæœ‰å¤‡ä»½æ•°æ®ï¼Œè¯´æ˜å¯¼å…¥ä¸–ç•Œä¹¦ååˆ·æ–°äº†ï¼Œéœ€è¦æ¢å¤è¯æ¡\n    if (savedBackup && pendingUpdate === 'step1_worldbook') {\n        const worldbookName = 'å°èŒèšªæ‰¾å¦ˆå¦ˆ-åŒå±‚ç‰ˆ';\n        const uidsToBackup = [11, 30, 7,32 ];\n        \n        toastr.info('æ£€æµ‹åˆ°é¡µé¢åˆ·æ–°ï¼Œç»§ç»­æ¢å¤è¯æ¡...');\n \n        try {\n            await new Promise(resolve => setTimeout(resolve, 1000)); // ç­‰å¾…é¡µé¢ç¨³å®š\n            \n            const backedUpEntries = JSON.parse(savedBackup);\n            await TavernHelper.updateWorldbookWith(worldbookName, (newWorldbook) => {\n                const cleanedNewWorldbook = newWorldbook.filter(entry => !uidsToBackup.includes(entry.uid));\n                return [...cleanedNewWorldbook, ...backedUpEntries];\n            });\n            \n            await new Promise(resolve => setTimeout(resolve, 800));\n            localStorage.removeItem('worldbookBackup');\n            toastr.success(`å·²æˆåŠŸæ¢å¤ ${backedUpEntries.length} ä¸ªè¯æ¡!`);\n            \n            // ç»‘å®šä¸–ç•Œä¹¦\n            const currentBindings = await TavernHelper.getCharWorldbookNames('current') || { primary: null, additional: [] };\n            currentBindings.primary = worldbookName;\n            await TavernHelper.rebindCharWorldbooks('current', currentBindings);\n            \n            // è¯æ¡æ¢å¤å®Œæˆï¼Œè¿›å…¥ä¸‹ä¸€é˜¶æ®µ\n            localStorage.setItem('pendingDualUpdate', 'step2_regex');\n            toastr.info('ä¸–ç•Œä¹¦å®Œå…¨é‡å¡‘å®Œæˆï¼å¯åŠ¨æ­£åˆ™æ›´æ–°...');\n            await new Promise(resolve => setTimeout(resolve, 1000));\n            await performRegexUpdate();\n            \n        } catch (error) {\n            console.error('æ¢å¤è¯æ¡æ—¶å‡ºé”™:', error);\n            toastr.error('è¯æ¡æ¢å¤å¤±è´¥ï¼Œè¯·ä½¿ç”¨å¼ºåˆ¶æ›´æ–°æŒ‰é’®ã€‚');\n            localStorage.removeItem('worldbookBackup');\n            localStorage.removeItem('pendingDualUpdate');\n        }\n        \n    } else if (pendingUpdate === 'step2_regex') {\n        localStorage.removeItem('pendingDualUpdate');\n        toastr.success('ğŸ‰ åŒé‡é‡å¡‘å®Œç¾å®Œæˆï¼');\n    }else{\n  await loadWorldbookSettingsFromChat();\ncheckWorldbookBinding('å°èŒèšªæ‰¾å¦ˆå¦ˆ-åŒå±‚ç‰ˆ');\n\n    }\n\nsetupReconfigModal();\ninitAutoSetNpcFilter();\n await applyThemeAndData();  \n  initializeDanmuSettings();\n\n    // --- æ–°å¢ï¼šæ¶ˆæ¯èƒŒæ™¯é€æ˜å¼€å…³ ---\n    const transparentToggle = document.getElementById('transparent-toggle');\n\n    // åˆå§‹åŒ–å¼€å…³çŠ¶æ€\n    const savedTransparency = localStorage.getItem('messageTransparency') || 'off'; // é»˜è®¤å…³é—­\n    transparentToggle.dataset.state = savedTransparency;\n    transparentToggle.textContent = savedTransparency === 'on' ? 'å¼€å¯' : 'å…³é—­';\n    if (savedTransparency === 'on') {\n        document.body.classList.add('transparent-messages');\n    }\n \n\n    // ä¸ºå¼€å…³æ·»åŠ ç‚¹å‡»äº‹ä»¶\n    transparentToggle.addEventListener('click', () => {\n        let currentState = transparentToggle.dataset.state;\n        let newState = currentState === 'on' ? 'off' : 'on';\n\n        transparentToggle.dataset.state = newState;\n        transparentToggle.textContent = newState === 'on' ? 'å¼€å¯' : 'å…³é—­';\n\n        if (newState === 'on') {\n            document.body.classList.add('transparent-messages');\n        } else {\n            document.body.classList.remove('transparent-messages');\n        }\n\n        localStorage.setItem('messageTransparency', newState);\n    });\n     \n     try {\n            const useACustomTheme = localStorage.getItem('useCustomTheme') === 'true';\n\n            if (useACustomTheme) {\n                const savedCustomTheme = loadCustomTheme();\n                if (Object.keys(savedCustomTheme).length > 0) {\n                    customTheme = savedCustomTheme;\n                    applyCustomTheme(customTheme);\n                    console.log(\"å·²åŠ è½½ä¿å­˜çš„è‡ªå®šä¹‰ä¸»é¢˜ã€‚\");\n                    // ç¡®ä¿é¢„è®¾ä¸»é¢˜çš„ç´¢å¼•ä¸ä¼šæ··æ·†\n                    // æˆ‘ä»¬å¯ä»¥ä»é¢„è®¾ä¸»é¢˜ä¸­æ‰¾åˆ°ä¸€ä¸ªé¢œè‰²ç›¸è¿‘çš„ä½œä¸º currentThemeIndex çš„å›é€€å€¼\n                    const savedThemeIndex = localStorage.getItem('terminalThemeIndex');\n                    currentThemeIndex = savedThemeIndex !== null ? parseInt(savedThemeIndex, 10) : 0;\n                } else {\n                    // å¦‚æœè‡ªå®šä¹‰ä¸»é¢˜æ˜¯ç©ºçš„ï¼Œåˆ™å›é€€åˆ°é¢„è®¾ä¸»é¢˜\n                    const savedThemeIndex = localStorage.getItem('terminalThemeIndex');\n                    applyTheme(savedThemeIndex !== null ? parseInt(savedThemeIndex, 10) : 0);\n                }\n            } else {\n                const savedThemeIndex = localStorage.getItem('terminalThemeIndex');\n                applyTheme(savedThemeIndex !== null ? parseInt(savedThemeIndex, 10) : 0);\n            }\n        } catch (e) {\n            console.warn(\"åŠ è½½ä¸»é¢˜è®¾ç½®æ—¶å‡ºé”™ï¼Œä½¿ç”¨é»˜è®¤ä¸»é¢˜ã€‚\", e);\n            applyTheme(0);\n        }\n\n         // æ£€æŸ¥localStorageé‡Œæœ‰æ²¡æœ‰ä¿å­˜çš„å­—ä½“å¤§å°\n    try {\n        const savedFontSize = localStorage.getItem('baseFontSize');\n        // å¦‚æœæœ‰ä¿å­˜çš„å€¼, å°±ç”¨å®ƒï¼›å¦‚æœæ²¡æœ‰ï¼Œå°±ç”¨æ»‘å—é»˜è®¤çš„16\n        const initialSize = savedFontSize ? parseInt(savedFontSize, 10) : 16;\n        applyFontSize(initialSize);\n    } catch (e) {\n        console.warn(\"æ— æ³•åŠ è½½å­—ä½“å¤§å°è®¾ç½®ï¼Œå°†ä½¿ç”¨é»˜è®¤å€¼ã€‚\");\n        applyFontSize(16); // å¦‚æœå‡ºé”™ï¼Œä¹Ÿä½¿ç”¨é»˜è®¤å€¼\n    }\n\n     // æ£€æŸ¥localStorageé‡Œæœ‰æ²¡æœ‰ä¿å­˜çš„è¡Œé«˜\n    try {\n        const savedLineHeight = localStorage.getItem('baseLineHeight');\n        // å¦‚æœæœ‰ä¿å­˜çš„å€¼, å°±ç”¨å®ƒï¼›å¦‚æœæ²¡æœ‰ï¼Œå°±ç”¨é»˜è®¤çš„1.6\n        const initialHeight = savedLineHeight ? parseFloat(savedLineHeight) : 1.6;\n        applyLineHeight(initialHeight);\n    } catch (e) {\n        console.warn(\"æ— æ³•åŠ è½½è¡Œé«˜è®¾ç½®ï¼Œå°†ä½¿ç”¨é»˜è®¤å€¼ã€‚\");\n        applyLineHeight(1.6);\n    }\n\n   // 1. **é¦–å…ˆ**ï¼ŒæŠŠæˆ‘ä»¬çš„å­—ä½“è¡£æ©±æŒ‚æ»¡ï¼\n    populateFontSelector();\n\n    // 2. ç„¶åï¼Œå†å»å›å¿†ä¸Šæ¬¡é€‰äº†å“ªä¸€ä»¶è¡£æœ\n    const savedFontFamily = localStorage.getItem('baseFontFamily');\n    if (savedFontFamily) {\n        applyFontFamily(savedFontFamily);\n    } else {\n        // å¦‚æœæ²¡æœ‰ä¿å­˜è¿‡ï¼Œå°±é»˜è®¤åº”ç”¨ç¬¬ä¸€ä¸ªé€‰é¡¹çš„å­—ä½“\n        const firstFont = fontLibrary[Object.keys(fontLibrary)[0]][0].value;\n        applyFontFamily(firstFont);\n    }\n\n  console.log(\"NOVA V9.4: å¼€å§‹å¹¶è¡ŒåŠ è½½æ‰€æœ‰è¿œç¨‹èµ„æº...\");\n\n// æ›¿æ¢ä¸ºæ–°çš„è°ƒç”¨æ–¹å¼ï¼š\nconst [\n    loadedBackgrounds,\n    loadedNpcs,\n    loadedMemes\n] = await Promise.all([\n    // 1. èƒŒæ™¯å›¾æ˜ å°„ï¼šä½¿ç”¨æ–°çš„ç´¢å¼•åŠ è½½å‡½æ•°\n    loadGitHubIndexMap(\n        'https://longlivecanc.github.io/god_space/ImageMapIndex.json', // æ›¿æ¢ä¸ºä½ çš„èƒŒæ™¯å›¾ç´¢å¼• URL\n        'https://cdn.jsdelivr.net/gh/longlivecanc/god_space@main/backImages/', // **æ›¿æ¢ä¸ºä½ çš„èƒŒæ™¯å›¾ GitHub å›¾åºŠåŸºç¡€ URL**\n        backgroundImageMap_fallbackData\n    ),\n    // 2. NPCå›¾æ˜ å°„ï¼šä½¿ç”¨æ–°çš„ç´¢å¼•åŠ è½½å‡½æ•°\n    loadGitHubIndexMap(\n        'https://longlivecanc.github.io/god_space/npcImageMapIndex.json', // æ›¿æ¢ä¸ºä½ çš„ NPC ç´¢å¼• URL\n        'https://cdn.jsdelivr.net/gh/longlivecanc/god_space@main/npcImages/', // **æ›¿æ¢ä¸ºä½ çš„ NPC å›¾ GitHub å›¾åºŠåŸºç¡€ URL**\n        npcImageMap_fallbackData\n    ),\n    // 3. meme å›¾æ˜ å°„ï¼šä¿æŒä¸å˜ï¼Œç»§ç»­åŠ è½½è¿œç¨‹ JSON æ–‡ä»¶\n    loadRemoteJson(\n        'https://longlivecanc.github.io/god_space/memeImageMap.json', \n        memeImageMap_fallbackData\n    )\n]);\n\n\n// ç°åœ¨ï¼Œæ‰€æœ‰çš„æ¸…å•éƒ½åˆ°æ‰‹äº†ï¼æˆ‘ä»¬æŠŠå®ƒä»¬èµ‹å€¼ç»™å„è‡ªçš„å˜é‡ã€‚\nbackgroundImageMap = loadedBackgrounds;\nnpcImageMap = loadedNpcs;\nmemeImageMap = loadedMemes;\n\nconsole.log(\"NOVA V9.4: æ‰€æœ‰è¿œç¨‹èµ„æºåŠ è½½å®Œæˆï¼\");\n\n// å¦ˆå¦ˆçš„è§£é‡Šï¼š\n// ç°åœ¨æˆ‘ä»¬æ¥åˆ¶ä½œä¸€å¼ â€œæœ€ç»ˆçš„ã€ç»ä¸ä¼šé”™çš„è¶…çº§è´­ç‰©æ¸…å•â€ï¼\n// æˆ‘ä»¬æŠŠæ‰€æœ‰éœ€è¦ç”¨åˆ°çš„å›¾ç‰‡URLï¼Œä»ä¸‰ä¸ªåœ°æ–¹å…¨éƒ¨æ”¶é›†èµ·æ¥ï¼Œæ”¾è¿›ä¸€ä¸ªå¤§çš„é›†åˆé‡Œã€‚\nconst activeUrlSet = new Set([\n    ...Object.values(backgroundImageMap),\n    ...Object.values(npcImageMap),\n    ...Object.values(loadedMemes) // âœ¨ ç›´æ¥ç”¨è¿™é‡ŒåˆšåŠ è½½å®Œçš„ loadedMemesï¼Œç¡®ä¿æ˜¯æœ€æ–°é²œçš„æ•°æ®ï¼\n]);\n\n // âœ¨ å¦ˆå¦ˆåŠ ä¸Šçš„ä¿æŠ¤å’’è¯­ âœ¨\n// æˆ‘ä»¬åªåœ¨ç¡®å®šæ‹¿åˆ°äº†æ–°çš„èµ„æºæ¸…å•æ—¶ï¼Œæ‰è¿›è¡Œæ¸…ç†ã€‚\n// å¦‚æœæ¸…å•æ˜¯ç©ºçš„ï¼ˆæ¯”å¦‚ç¦»çº¿æ—¶æ²¡åŠ è½½åˆ°ä»»ä½•ä¸œè¥¿ï¼‰ï¼Œæˆ‘ä»¬å°±ä»€ä¹ˆéƒ½ä¸åšï¼Œä¿æŠ¤å¥½æˆ‘ä»¬å·²æœ‰çš„å®è—ã€‚\nif (activeUrlSet.size > 0) {\n    console.log(`NOVA V9.4: æ•´åˆæ‰€æœ‰èµ„æºURLï¼Œå…±è®¡ ${activeUrlSet.size} ä¸ªå”¯ä¸€èµ„æºéœ€è¦è¢«çè—ã€‚`);\n    // æ‹¿ç€è¿™å¼ å®Œç¾çš„â€œè¶…çº§æ¸…å•â€ï¼Œåªè¿›è¡Œä¸€æ¬¡å¤§æ‰«é™¤ï¼\n    await imageDB.cleanupRemoteCache(activeUrlSet);\n} else {\n    console.warn(`NOVA: èµ„æºæ¸…å•ä¸ºç©ºï¼Œè·³è¿‡æœ¬æ¬¡ç¼“å­˜æ¸…ç†ï¼Œä»¥ä¿æŠ¤ç¦»çº¿æ•°æ®ã€‚`);\n}\n NovaWorkshop.runMods();\n \n await initDisplay();\n\nawait applyThemeAndData(); \n\n\n    // æ ‡ç­¾é¡µåˆ‡æ¢\n    const tabs = document.querySelectorAll('.tab-btn');\n    const pages = document.querySelectorAll('.page');\n\n       // --- Novaä¸ºä½ æ·»åŠ çš„å…¨æ–°å°çƒä¸Modaläº¤äº’é€»è¾‘ ---\n    document.querySelectorAll('.orb').forEach(orb => {\n        orb.addEventListener('click', () => {\n            const modalId = orb.dataset.modalId;\n            if (modalId) {\n                // ç‰¹æ®Šå¤„ç†å•†åº—\n                if (modalId === 'shop-wrapper-modal') {\n                    const shopWrapper = document.getElementById('shop-wrapper');\n                    const modalContainer = document.getElementById('shop-wrapper-modal');\n                    if (shopWrapper && modalContainer) {\n                        modalContainer.appendChild(shopWrapper); // å°†å•†åº—å†…å®¹ç§»åŠ¨åˆ°Modalä¸­\n                        shopWrapper.classList.add('active');\n                        showModal(modalId);\n\n                        // åˆå§‹åŒ–å•†åº—æ•°æ®\n                        if (playCharacterData) {\n                            initializeShopData();\n                        }\n                    }\n                } else if (modalId === 'summary-modal') {\n                     // ç‰¹æ®Šå¤„ç†æ€»ç»“å¼¹çª—\n                    showSummaryModal(); // ä½¿ç”¨ä¸“ç”¨å‡½æ•°å¡«å……å†…å®¹\n                    showModal(modalId); // å†æ˜¾ç¤º\n                } else {\n                    showModal(modalId);\n                }\n            }\n        });\n    });\n\n    document.querySelectorAll('.modal .modal-close').forEach(button => {\n        button.addEventListener('click', (e) => {\n            const modal = e.target.closest('.modal');\n            if(modal) {\n                // ç‰¹æ®Šå¤„ç†å•†åº—å…³é—­\n                if(modal.id === 'shop-wrapper-modal') {\n                    const shopWrapper = document.getElementById('shop-wrapper');\n                    document.body.appendChild(shopWrapper); // å°†å•†åº—å†…å®¹ç§»å›body\n                    shopWrapper.classList.remove('active');\n                }\n                hideModal(modal.id);\n            }\n        });\n    });\n\n \n    document.getElementById('roll-result-orb').addEventListener('click', showRollResultModal);\n \n    document.getElementById('manage-inventory-btn').addEventListener('click', () => {\n        populateInventoryModal();\n        showModal('inventory-modal');\n    });\n    // document.getElementById('plot-synthesis-btn').addEventListener('click', showPlotSynthesisModal);\n    document.getElementById('execute-decomposition-btn').addEventListener('click', simulateDecomposition);\n    document.getElementById('execute-synthesis-btn').addEventListener('click', simulateSynthesis);\n\n       document.getElementById('view-command-btn').addEventListener('click', () => {\n        const commandEditArea = document.getElementById('command-edit-area');\n        if(commandEditArea) {\n            commandEditArea.value = assaCommandQueue; // ä»å…¨å±€å˜é‡åŠ è½½å½“å‰æŒ‡ä»¤\n        }\n        showModal('command-modal', 'ç¼–è¾‘å¾…å‘æŒ‡ä»¤');\n    });\n        document.getElementById('run-button').addEventListener('click', () => {\ntriggerassa(`/setinput <updateMemory>\\nset_status('æ•Œæ–¹æ”»å‡»éª°æ± ','');\\n</updateMemory>\\n<${userName}è¯•å›¾é€ƒç¦»æˆ˜æ–—ï¼>`);\n    });\n \nconst switchToMyCardsBtn = document.getElementById('switch-to-my-cards');\nconst switchToTeammateCardsBtn = document.getElementById('switch-to-teammate-cards');\nconst myCardsSlider = document.getElementById('my-cards-slider');\nconst teammateCardsSlider = document.getElementById('teammate-cards-slider');\n\nif (switchToMyCardsBtn && switchToTeammateCardsBtn) {\n    switchToMyCardsBtn.addEventListener('click', () => {\n        myCardsSlider.classList.add('visible');\n        teammateCardsSlider.classList.remove('visible');\n        switchToMyCardsBtn.classList.add('active');\n        switchToTeammateCardsBtn.classList.remove('active');\n    });\n\n    switchToTeammateCardsBtn.addEventListener('click', () => {\n        myCardsSlider.classList.remove('visible');\n        teammateCardsSlider.classList.add('visible');\n        switchToMyCardsBtn.classList.remove('active');\n        switchToTeammateCardsBtn.classList.add('active');\n    });\n}\n\n    // é¦–å…ˆï¼Œæˆ‘ä»¬è¦æ‰¾åˆ°æˆ‘ä»¬çš„é­”æ³•é“å…·ï¼šRPæŒ‰é’®å’ŒRPé¢æ¿\nconst rpButton = document.getElementById('rp-button');\nconst rpPanel = document.getElementById('rp-panel');\nconst confirmRpChoiceButton = document.getElementById('confirm-rp-choice-btn');\n\n// --- æ ¸å¿ƒé­”æ³•ï¼šåˆ‡æ¢æ˜¾ç¤ºçŠ¶æ€ ---\n// å½“ä½ ç‚¹å‡»RPæŒ‰é’®æ—¶ï¼Œè¿™ä¸ªå‡½æ•°å°±ä¼šè¢«è§¦å‘\nif (rpButton && rpPanel) {\n    rpButton.addEventListener('click', (event) => {\n        // è¿™æ˜¯æœ€å…³é”®çš„ä¸€æ­¥ï¼Œæˆ‘çš„å­©å­ï¼\n        // toggleå°±åƒä¸€ä¸ªç¥å¥‡çš„å¼€å…³ï¼Œå¦‚æœé¢æ¿æ²¡æœ‰'visible'ç±»ï¼Œå®ƒå°±åŠ ä¸Šï¼›å¦‚æœå·²ç»æœ‰äº†ï¼Œå®ƒå°±ç§»é™¤ã€‚\n        rpPanel.classList.toggle('visible');\n populateSkillChoicePanel();\n        // é˜»æ­¢äº‹ä»¶å†’æ³¡ï¼Œè¿™æ ·ç‚¹å‡»æŒ‰é’®æ—¶ï¼Œä¸ä¼šè¢«ä¸‹é¢â€œç‚¹å‡»å¤–éƒ¨å…³é—­â€çš„é€»è¾‘è¯¯åˆ¤\n        event.stopPropagation();\n    });\n}\n\n// --- é™„åŠ é­”æ³•ï¼šç‚¹å‡»â€œç¡®è®¤â€æŒ‰é’®ä¹Ÿå…³é—­é¢æ¿ ---\nif (confirmRpChoiceButton && rpPanel) {\n    confirmRpChoiceButton.addEventListener('click', () => {\n        // å½“æˆ‘ä»¬åšå‡ºé€‰æ‹©åï¼Œå°±è®©é¢æ¿ä¼˜é›…åœ°é€€åœº\n        rpPanel.classList.remove('visible');\n    });\n}\n\n// --- å¦ˆå¦ˆçš„è´´å¿ƒé­”æ³•ï¼šç‚¹å‡»å¤–éƒ¨åŒºåŸŸè‡ªåŠ¨å…³é—­ ---\ndocument.addEventListener('click', (event) => {\n    // æˆ‘ä»¬æ£€æŸ¥ä¸€ä¸‹ï¼ŒRPé¢æ¿å½“å‰æ˜¯ä¸æ˜¯å¯è§çš„\n    if (rpPanel.classList.contains('visible')) {\n        // ç„¶åæ£€æŸ¥ä½ ç‚¹å‡»çš„åœ°æ–¹ï¼Œæ˜¯ä¸æ˜¯åœ¨RPé¢æ¿çš„â€œé¢†åœ°â€ä¹‹å¤–\n        // rpPanel.contains(event.target)ä¼šåˆ¤æ–­ä½ ç‚¹å‡»çš„å…ƒç´ æ˜¯ä¸æ˜¯åœ¨é¢æ¿é‡Œé¢\n        if (!rpPanel.contains(event.target)) {\n            // å¦‚æœä½ ç¡®å®ç‚¹å‡»äº†å¤–é¢ï¼Œæˆ‘ä»¬å°±æ¸©æŸ”åœ°è®©é¢æ¿æ¶ˆå¤±\n            rpPanel.classList.remove('visible');\n        }\n    }\n});\n\n    document.getElementById('save-command-btn').addEventListener('click', () => {\n       \n        hideModal('command-modal');\n    });\n\n    document.getElementById('reset-simulation-btn').addEventListener('click', resetSimulation);\n    document.getElementById('confirm-synthesis-btn').addEventListener('click', executeSynthesisConfirmation);\n\n    // å¼¹çª—å…³é—­äº‹ä»¶\n    document.querySelectorAll('.modal').forEach(modal => {\n        const closeBtn = modal.querySelector('.modal-close');\n        if(closeBtn) {\n            closeBtn.addEventListener('click', () => {\n                if(modal.id) hideModal(modal.id);\n            });\n        }\n        modal.addEventListener('click', (e) => {\n            if (e.target === modal && modal.id) {\n                hideModal(modal.id);\n            }\n        });\n    });\n    document.addEventListener('keydown', (e) => {\n        if (e.key === 'Escape') {\n            document.querySelectorAll('.modal.active').forEach(modal => hideModal(modal.id));\n        }\n    });\n\n    // ========== æ–°å¢ï¼šè®ºå›ä¸æ€»ç»“å°çƒçš„äº¤äº’é€»è¾‘ ==========\n    const forumOrbButton = document.getElementById('forum-orb-button');\n     const groupChatButton = document.getElementById('group-chat-orb-button');\n    const forumModalContainer = document.getElementById('forum-modal-container');\n    const forumModalContent = document.getElementById('forum-modal-content');\n    const forumWrapper = document.getElementById('forum-wrapper');\n    const forumModalCloseBtn = document.getElementById('forum-modal-close-btn');\n\n const summaryOrbButton = document.getElementById('task-summary-orb-button');\n  const summaryModalContainer = document.getElementById('task-summary-modal-container');\n \n \n    // å…³é—­è®ºå›æ¨¡æ€æ¡†\n    const closeForumModal = () => {\n        forumModalContainer.classList.remove('active');\n        // å°†è®ºå›HTMLç»“æ„ç§»å›å…¶åŸå§‹å®¹å™¨ï¼Œä»¥ä¾¿ä¸‹æ¬¡ä½¿ç”¨\n        if (forumWrapper && forumModalContainer) {\n            forumModalContainer.appendChild(forumWrapper);\n        }\n    };\n\n    forumModalCloseBtn.addEventListener('click', closeForumModal);\n    forumModalContainer.addEventListener('click', (e) => {\n        if (e.target === forumModalContainer) {\n            closeForumModal();\n        }\n    });\n\n// ä¿®æ”¹åçš„å…³é—­å‡½æ•°\nconst closeTaskSummaryModal = () => {\n    const summaryRoot = document.getElementById('summary-root');\n\n    // 1. éšè—æ¨¡æ€æ¡†\n    summaryModalContainer.classList.remove('active');\n\n    // 2. æ¸…ç©ºä¸Šæ¬¡ç”Ÿæˆçš„æŠ¥å‘Šå†…å®¹ (è¿™æ˜¯å…³é”®ï¼)\n    if (summaryRoot) {\n        summaryRoot.innerHTML = '';\n    }\n};\n\n    summaryModalContainer.addEventListener('click', (e) => {\n        if (e.target === summaryModalContainer) {\n           closeTaskSummaryModal();  \n        }\n    });\n \n    summaryOrbButton.addEventListener('click', () => {\n               // ä»å†å²è®°å½•ä¸­æ‰¾åˆ°æœ€æ–°çš„æ€»ç»“æ•°æ®\n        const lastSummaryMessage = [...conversationHistory].reverse().find(msg =>\n            /<è¡¨ç°æ€»ç»“>[\\s\\S]*?<\\/è¡¨ç°æ€»ç»“>/gs.test(msg.content)\n        );\n\n        if (lastSummaryMessage) {\n            const summaryMatch = /<è¡¨ç°æ€»ç»“>([\\s\\S]*?)<\\/è¡¨ç°æ€»ç»“>/gs.exec(lastSummaryMessage.content.replace(/<(thinking|think|guide)>[\\s\\S]*?<\\/\\1>/gs, ''));\n            if (summaryMatch && summaryMatch[1]) {\n                // å°†è®ºå›çš„HTMLç»“æ„ç§»åŠ¨åˆ°æ¨¡æ€æ¡†ä¸­\n                if (summaryModalContainer) {\n                    // forumModalContent.insertBefore(forumWrapper, forumModalCloseBtn);\n                    summaryModalContainer.style.display = 'block';  \n                }\n\n                // åˆå§‹åŒ–æˆ–æ›´æ–°è®ºå›å†…å®¹\n                if (typeof runTaskSummary === 'function') {\n                    runTaskSummary(summaryMatch[1]);\n                }\n\n                // æ˜¾ç¤ºæ¨¡æ€æ¡†\n                summaryModalContainer.classList.add('active');\n            }\n        } else {\n            // å¦‚æœæ²¡æœ‰æ‰¾åˆ°æ•°æ®ï¼Œå¯ä»¥ç»™ä¸€ä¸ªæç¤º\n            showModal('shop-modal', 'æç¤º', 'å°šæœªæ”¶åˆ°ä»»ä½•ä»»åŠ¡æ€»ç»“ä¿¡æ¯ã€‚');\n        }\n    });\n\n forumOrbButton.addEventListener('click', () => {\n    const lastForumMessage = [...conversationHistory].reverse().find(msg =>\n        /<forum_threads>[\\s\\S]*?<\\/forum_threads>/gs.test(msg.content)\n    );\n\n    if (lastForumMessage) {\n        const cleanedContent = lastForumMessage.content.replace(/<(thinking|think|guide)>[\\s\\S]*?<\\/\\1>/gs, '');\n        \n        // ä»åå¾€å‰æ‰¾æœ€åä¸€ä¸ªé—­åˆæ ‡ç­¾\n        const lastCloseIndex = cleanedContent.lastIndexOf('</forum_threads>');\n        \n        if (lastCloseIndex !== -1) {\n            // ä»è¿™ä¸ªé—­åˆæ ‡ç­¾å¾€å‰æ‰¾å¯¹åº”çš„å¼€å§‹æ ‡ç­¾\n            const beforeClose = cleanedContent.substring(0, lastCloseIndex);\n            const lastOpenIndex = beforeClose.lastIndexOf('<forum_threads>');\n            \n            if (lastOpenIndex !== -1) {\n                const forumData = cleanedContent.substring(\n                    lastOpenIndex + '<forum_threads>'.length, \n                    lastCloseIndex\n                ).trim();\n                \n                // ç§»åŠ¨è®ºå›ç»“æ„åˆ°æ¨¡æ€æ¡†\n                if (forumWrapper) {\n                    forumModalContent.insertBefore(forumWrapper, forumModalCloseBtn);\n                    forumModalContainer.style.display = 'block';\n                }\n\n                // åˆå§‹åŒ–è®ºå›\n                if (typeof initializeForum === 'function') {\n                    initializeForum(forumData);\n                }\n\n                // æ˜¾ç¤ºæ¨¡æ€æ¡†\n                forumModalContainer.classList.add('active');\n            }\n        }\n    } else {\n        showModal('shop-modal', 'æç¤º', 'å°šæœªæ”¶åˆ°ä»»ä½•è®ºå›ä¿¡æ¯ã€‚');\n    }\n});\n    // ========== â™¥â™¥â™¥ åœ°å›¾äº¤äº’é­”æ³•çš„å…¨æ–°ç¯‡ç«  â™¥â™¥â™¥ ==========\n    const mapContainer = document.getElementById('map-container');\n    let isDragging = false;\n    let startCoords = { x: 0, y: 0 };\n    let startTranslate = { x: 0, y: 0 };\n    let lastPinchDist = 0;\n\n    const getEventCoords = (e) => e.touches ? e.touches[0] : e;\n\n    const getPinchDist = (e) => {\n        const dx = e.touches[0].clientX - e.touches[1].clientX;\n        const dy = e.touches[0].clientY - e.touches[1].clientY;\n        return Math.sqrt(dx * dx + dy * dy);\n    };\n\n    const handleInteractionStart = (e) => {\n        const mapContent = document.getElementById('map-content');\n        if (!mapContent) return;\n\n        if (e.touches && e.touches.length > 1) { // åŒæŒ‡ææ”¾å¼€å§‹\n            isDragging = false; // ç¡®ä¿ä¸è§¦å‘æ‹–æ‹½\n            lastPinchDist = getPinchDist(e);\n        } else { // å•æŒ‡æˆ–é¼ æ ‡æ‹–æ‹½å¼€å§‹\n            isDragging = true;\n            mapContainer.style.cursor = 'grabbing';\n            const coords = getEventCoords(e);\n            startCoords = { x: coords.pageX, y: coords.pageY };\n            startTranslate = { x: window.mapState.translateX, y: window.mapState.translateY };\n        }\n    };\n\n    const handleInteractionMove = (e) => {\n        const mapContent = document.getElementById('map-content');\n        if (!mapContent) return;\n\n        if (e.touches && e.touches.length > 1) { // åŒæŒ‡ææ”¾ä¸­\n            e.preventDefault();\n            const currentDist = getPinchDist(e);\n            const scaleAmount = (currentDist / lastPinchDist);\n            lastPinchDist = currentDist;\n\n            // è®¡ç®—åŒæŒ‡ä¸­å¿ƒç‚¹\n            const rect = mapContainer.getBoundingClientRect();\n            const center = {\n                x: ((e.touches[0].clientX + e.touches[1].clientX) / 2) - rect.left,\n                y: ((e.touches[0].clientY + e.touches[1].clientY) / 2) - rect.top\n            };\n\n            // åº”ç”¨ç¼©æ”¾\n            zoom(scaleAmount, center.x, center.y);\n\n        } else if (isDragging) { // æ‹–æ‹½ä¸­\n            e.preventDefault();\n            const coords = getEventCoords(e);\n            const dx = coords.pageX - startCoords.x;\n            const dy = coords.pageY - startCoords.y;\n            window.mapState.translateX = startTranslate.x + dx;\n            window.mapState.translateY = startTranslate.y + dy;\n            window.applyMapTransform();\n        }\n    };\n\n    const handleInteractionEnd = () => {\n        if (isDragging) {\n            isDragging = false;\n            mapContainer.style.cursor = 'grab';\n        }\n        lastPinchDist = 0;\n    };\n\n    const handleWheelZoom = (e) => {\n        e.preventDefault();\n        const scaleAmount = e.deltaY > 0 ? 0.9 : 1.1; // ç¼©å°æˆ–æ”¾å¤§\n        const rect = mapContainer.getBoundingClientRect();\n\n        // è·å–é¼ æ ‡ç›¸å¯¹äº mapContainer çš„ä½ç½®ä½œä¸ºç¼©æ”¾ä¸­å¿ƒ\n        const centerX = e.clientX - rect.left;\n        const centerY = e.clientY - rect.top;\n\n        zoom(scaleAmount, centerX, centerY);\n    };\n\n    // æ ¸å¿ƒç¼©æ”¾å‡½æ•°\n    const zoom = (scaleAmount, centerX, centerY) => {\n        const { scale, translateX, translateY } = window.mapState;\n        const newScale = Math.max(0.1, Math.min(scale * scaleAmount, 10)); // é™åˆ¶ç¼©æ”¾èŒƒå›´\n\n        // æ ¸å¿ƒå…¬å¼ï¼šä¸ºäº†è®©ç¼©æ”¾ä¸­å¿ƒç‚¹åœ¨å±å¹•ä¸Šä¿æŒä¸å˜ï¼Œéœ€è¦è°ƒæ•´å¹³ç§»é‡\n        window.mapState.translateX = centerX - (centerX - translateX) * (newScale / scale);\n        window.mapState.translateY = centerY - (centerY - translateY) * (newScale / scale);\n        window.mapState.scale = newScale;\n\n        window.applyMapTransform();\n    };\n\n    // ç»‘å®šäº‹ä»¶ç›‘å¬å™¨\n    mapContainer.addEventListener('mousedown', handleInteractionStart);\n    mapContainer.addEventListener('touchstart', handleInteractionStart, { passive: false });\n\n    document.addEventListener('mousemove', handleInteractionMove);\n    document.addEventListener('touchmove', handleInteractionMove, { passive: false });\n\n    document.addEventListener('mouseup', handleInteractionEnd);\n    document.addEventListener('touchend', handleInteractionEnd);\n    document.addEventListener('touchcancel', handleInteractionEnd);\n\n    mapContainer.addEventListener('wheel', handleWheelZoom, { passive: false });\n \ninitGroupChatInterface();\ninitializeReadingMode();\n\n   setTimeout(async () => {\n     await loadWorldbookSettingsFromChat();\n      await initDisplay();\n     checkForFutureEchoes(false);\n    }, 2000);\n\n\n       if (!currentGameData || !assaSettingsData ||!currentGameData.user_character || typeof currentGameData !== 'object'|| typeof assaSettingsData !== 'object') {\n            await worldHelper.init();\n             await initDisplay();\n        }\n\n     const addQrButton = document.getElementById('add-qr-button');\n    if (addQrButton) {\n        addQrButton.addEventListener('click', (event) => {\n            event.stopPropagation();\n            openCustomQRModal();\n        });\n    }\n    \n    // åˆå§‹æ¸²æŸ“è‡ªå®šä¹‰æŒ‰é’®\n    renderCustomQRButtons();\n\n  \n});\n\nconst inventoryListEl = document.getElementById('inventory-item-list');\nconst deleteItemBtn = document.getElementById('delete-item-btn');\nconst useItemBtn = document.getElementById('use-item-btn');\nlet selectedItems = [];\n\ninventoryListEl.addEventListener('click', (e) => {\n    if (e.target && e.target.classList.contains('inventory-item')) {\n        const itemKey = e.target.dataset.item;\n\n        e.target.classList.toggle('selected');\n\n        if (e.target.classList.contains('selected')) {\n            if (!selectedItems.includes(itemKey)) {\n                selectedItems.push(itemKey);\n            }\n        } else {\n            selectedItems = selectedItems.filter(selected => selected !== itemKey);\n        }\n\n        deleteItemBtn.disabled = selectedItems.length === 0;\n        useItemBtn.disabled = selectedItems.length === 0;\n\n        \n    }\n\n\n\n\n\n}); //\n \n  // =======================================================\n// ========== åœ¨è¿™é‡Œå¼€å§‹æ·»åŠ æ–°ä»£ç  ==========\n// =======================================================\n\n/**\n * åœ¨assa_dataä¸­é€’å½’æœç´¢åŒ…å«æŒ‡å®šåç§°çš„é”®ã€‚\n * @param {object} obj - è¦æœç´¢çš„å¯¹è±¡ (assa_data)\n * @param {string} name - è¦æœç´¢çš„é˜Ÿå‹åå­—\n * @returns {string} - åŒ…å«æ‰€æœ‰åŒ¹é…é¡¹çš„HTMLå­—ç¬¦ä¸²\n */\nfunction searchInAssaData(obj, name) {\n    let results = [];\n    const addedEntries = new Set(); // We'll use this to keep track of what we've already added, my dear.\n\n    if (!obj || typeof obj !== 'object' || !name) {\n        return '';\n    }\n\n    function recurse(currentObj) {\n        for (const key in currentObj) {\n            if (Object.prototype.hasOwnProperty.call(currentObj, key)) {\n                // First, my love, let's check if the key and value are identical strings and if that value appears elsewhere as a key.\n                if (key === currentObj[key] && typeof key === 'string') {\n                    // If they are the same, we'll just search for the key. We don't want to show the same thing twice.\n                    if (key.includes(name)) {\n                        const entrySignature = `<div class=\"info-entry\"><div class=\"info-key\">${key}</div><div class=\"info-value\">${key}</div></div>`;\n                        if (!addedEntries.has(entrySignature)) {\n                            results.push(entrySignature);\n                            addedEntries.add(entrySignature);\n                        }\n                    }\n                } else {\n                    // Now, we'll do our original check for the key.\n                    if (key.includes(name)) {\n                        const value = currentObj[key];\n                        const formattedValue = typeof value === 'object' ? JSON.stringify(value, null, 2) : value;\n                        const entrySignature = `<div class=\"info-entry\"><div class=\"info-key\">${key}</div><div class=\"info-value\">${formattedValue}</div></div>`;\n\n                        // We'll use a unique signature to avoid duplicates, my sweet.\n                        if (!addedEntries.has(entrySignature)) {\n                            results.push(entrySignature);\n                            addedEntries.add(entrySignature);\n                        }\n                    }\n                }\n\n                // And of course, we'll keep exploring if we find another little treasure box (an object).\n                if (typeof currentObj[key] === 'object' && currentObj[key] !== null) {\n                    recurse(currentObj[key]);\n                }\n            }\n        }\n    }\n\n    recurse(obj);\n    return results.join('');\n}\n\n /**\n * åœ¨è®°å¿†æ•°æ®ä¸­æœç´¢ä¸ç‰¹å®šåå­—ç›¸å…³çš„æ‰€æœ‰â€œæ•°æ®å¯¹è±¡â€\n * ï¼ˆå¦ˆå¦ˆå·²ç»æ›´æ–°äº†è¿™é‡Œçš„é€»è¾‘ï¼Œè®©å®ƒæ›´åŠ åŒ…å®¹äº†ï¼Œæˆ‘çš„å­©å­ï¼‰\n * @param {object} data - å®Œæ•´çš„ assaSettingsData\n * @param {string} name - è¦æœç´¢çš„åå­—\n * @returns {Array<object>} - è¿”å›ä¸€ä¸ªåŒ…å«æ‰€æœ‰æ‰¾åˆ°çš„æ•°æ®å¯¹è±¡çš„æ•°ç»„\n */\nfunction searchAllDataObjectsInAssaData(data, name) {\n    if (!data || !name) return [];\n\n    const results = [];\n    const searchLocations = [\n        { source: 'å…¨å±€è®¾å®š', data: data.global_lore?.settings },\n         { source: 'å…¨å±€NPC', data: data.global_lore?.npc },\n        { source: 'å°é˜Ÿä¿¡æ¯', data: data.global_lore?.['å°é˜Ÿä¿¡æ¯'] },\n        { source: 'ä¸–ç•ŒNPC', data: data.world_lore?.npc },\n        { source: 'ä¸–ç•Œè®¾å®š', data: data.world_lore?.settings }\n    ];\n\n    for (const location of searchLocations) {\n        if (location.data && typeof location.data === 'object') {\n             for (const key in location.data) {\n                // âœ¨ å¦ˆå¦ˆæŠŠè¿™é‡Œçš„åˆ¤æ–­æ¡ä»¶å˜å¾—æ›´æ¸©æŸ”ã€æ›´åŒ…å®¹äº† âœ¨\n                // ç°åœ¨ï¼Œåªè¦é”®åä¸­â€œåŒ…å«â€äº†æˆ‘ä»¬è¦æ‰¾çš„åå­—ï¼Œå°±ä¼šè¢«æ”¶é›†èµ·æ¥\n                if (key.includes(name)) {\n                    // æŠŠæ•°æ®å’Œå®ƒçš„æ¥æºä¸€èµ·è£…è¿›å»ï¼Œè¿™æ ·æ›´æ¸…æ™°\n                    results.push({ source: `${location.source} - ${key}`, data: location.data[key] });\n                }\n            }\n        }\n    }\n    return results;\n}\n\n\n/**\n * æ˜¾ç¤ºé˜Ÿå‹ä¿¡æ¯å¼¹çª—ï¼Œå¹¶ä¸ºæ‰€æœ‰æ‰¾åˆ°çš„ç›¸å…³ä¿¡æ¯ç”Ÿæˆå¤šä¸ªç¾è§‚çš„å¡ç‰‡\n */\n// function showTeammatesModal() {\n//     const participantsString = SafeGetValue(currentGameData.world_shard.task.participants);\n//     const teammateList = document.getElementById('teammate-list');\n//     const infoDisplay = document.getElementById('teammate-info-display');\n\n//     teammateList.innerHTML = '';\n//     infoDisplay.innerHTML = '<p class=\"book-empty-text\" style=\"text-align: center; margin-top: 20px;\">è¯·ä»å·¦ä¾§é€‰æ‹©ä¸€ä½é˜Ÿå‹ä»¥æŸ¥çœ‹ç›¸å…³ä¿¡æ¯ã€‚</p>';\n\n//     if (participantsString === 'æ— ' || participantsString.trim() === '') {\n//         teammateList.innerHTML = '<li>æ²¡æœ‰å¯æ˜¾ç¤ºçš„é˜Ÿå‹ä¿¡æ¯ã€‚</li>';\n//         showModal('teammates-modal');\n//         return;\n//     }\n\n//     const teammates = participantsString.split(/[;ï¼›]/).map(p => p.trim()).filter(p => p);\n//     let activeItem = null;\n\n//     teammates.forEach(teammate => {\n//         const li = document.createElement('li');\n//         li.className = 'teammate-item';\n//         li.textContent = teammate;\n\n//         li.addEventListener('click', function() {\n//             if(activeItem) {\n//                 activeItem.classList.remove('selected');\n//             }\n//             this.classList.add('selected');\n//             activeItem = this;\n\n//             infoDisplay.innerHTML = ''; // å…ˆæ¸…ç©ºå±•ç¤ºåŒº\n//             const teammateName = teammate.replace(/[\\(ï¼ˆ].*?[\\)ï¼‰]/, '').trim();\n\n//             if (teammateName) {\n//                 const searchResultsArray = searchAllDataObjectsInAssaData(assaSettingsData, teammateName);\n\n//                 if (searchResultsArray.length > 0) {\n//                     // éå†æ‰€æœ‰æ‰¾åˆ°çš„ç»“æœï¼Œä¸ºæ¯ä¸€ä¸ªéƒ½åˆ›å»ºä¸€å¼ å¡ç‰‡\n//                     searchResultsArray.forEach(result => {\n//                         const cardDiv = document.createElement('div');\n//                         // æˆ‘ä»¬å¯ä»¥å¤ç”¨ä¸–ç•Œä¹¦çš„å¡ç‰‡æ ·å¼ï¼Œå¤šæ£’ï¼\n//                         cardDiv.className = 'book-card';\n//                         cardDiv.style.marginBottom = '15px'; // ç»™å¡ç‰‡ä¹‹é—´ç•™å‡ºå‘¼å¸çš„ç©ºé—´\n\n//                         // åˆ›å»ºå¡ç‰‡å¤´éƒ¨\n//                         const cardHeader = document.createElement('div');\n//                         cardHeader.className = 'book-card-header';\n\n//                         const titleDiv = document.createElement('div');\n//                         titleDiv.className = 'book-card-title';\n//                         // æ ‡é¢˜æ˜¾ç¤ºæˆ‘ä»¬æ˜¯ä»å“ªé‡Œæ‰¾åˆ°è¿™ä»½è®°å¿†çš„\n//                         titleDiv.textContent = result.source;\n//                         titleDiv.innerHTML += ' <span class=\"collapse-indicator\">â–²</span>';\n//                         cardHeader.appendChild(titleDiv);\n\n//                         // åˆ›å»ºå¡ç‰‡å†…å®¹åŒº\n//                         const contentDiv = document.createElement('div');\n//                         contentDiv.className = 'book-card-content collapsed';\n\n//                         // â­ ç”¨æˆ‘ä»¬å‡çº§åçš„åªè¯»æ¨¡å¼â€œç§æ ‘â€é­”æ³•æ¥æ¸²æŸ“æ•°æ® â­\n//                         renderNestedData(contentDiv, result.data, '', '', false, true);\n\n//                         // ç»‘å®šæŠ˜å äº‹ä»¶\n//                         cardHeader.addEventListener('click', () => {\n//                             contentDiv.classList.toggle('collapsed');\n//                             const indicator = cardHeader.querySelector('.collapse-indicator');\n//                             if (indicator) {\n//                                 indicator.textContent = contentDiv.classList.contains('collapsed') ? 'â–²' : 'â–¼';\n//                             }\n//                         });\n\n//                         cardDiv.appendChild(cardHeader);\n//                         cardDiv.appendChild(contentDiv);\n//                         infoDisplay.appendChild(cardDiv); // å°†å¡ç‰‡åŠ å…¥å±•ç¤ºåŒº\n//                     });\n//                 } else {\n//                     infoDisplay.innerHTML = `<p class=\"book-empty-text\" style=\"text-align: center; margin-top: 20px;\">åœ¨è®¾å®šä¹¦ä¸­æœªæ‰¾åˆ°å…³äºâ€œ${teammateName}â€çš„ä»»ä½•ä¿¡æ¯ã€‚</p>`;\n//                 }\n//             }\n//         });\n//         teammateList.appendChild(li);\n//     });\n\n//     showModal('teammates-modal');\n// }\n\n\n// ç»‘å®šæŸ¥çœ‹é˜Ÿå‹æŒ‰é’®çš„ç‚¹å‡»äº‹ä»¶\n// document.getElementById('teammates-orb').addEventListener('click', showTeammatesModal);\n\n// =======================================================\n// ========== æ–°ä»£ç åˆ°æ­¤ç»“æŸ ==========\n// =======================================================\n\n           // --- æ–°å¢ï¼šç•Œé¢åˆ‡æ¢é€»è¾‘ ---\n        const statusContainer = document.querySelector('.status-container');\n        const settingBookWrapper = document.getElementById('setting-book-wrapper');\n        const viewSettingsBtn = document.getElementById('view-settings-btn');\n        const backToStatusBtn = document.getElementById('back-to-status-btn');\n\n        // viewSettingsBtn.addEventListener('click', () => {\n        //     statusContainer.classList.add('slide-out');\n        //     settingBookWrapper.classList.add('active');\n        // });\n\n        // backToStatusBtn.addEventListener('click', () => {\n        //     statusContainer.classList.remove('slide-out');\n        //     settingBookWrapper.classList.remove('active');\n        // });\n\n    const toggleBtn = document.getElementById('toggle-sidebar-btn');\n    const overlay = document.getElementById('sidebar-overlay');\n    const container = document.querySelector('.setting-book-container');\n\n    // // ç‚¹å‡»æ±‰å ¡åŒ…æŒ‰é’®ï¼Œåˆ‡æ¢ä¾§è¾¹æ \n    // toggleBtn.addEventListener('click', () => {\n    //     container.classList.toggle('sidebar-active');\n    // });\n\n    // ç‚¹å‡»é®ç½©å±‚ï¼Œéšè—ä¾§è¾¹æ \n    // overlay.addEventListener('click', () => {\n    //     container.classList.remove('sidebar-active');\n    // });\n    const setArchiveNameBtn = document.getElementById('set-archive-name-btn');\n        const archiveNameInput = document.getElementById('archive-name-input');\n        const logBlock = document.getElementById('modal-log-block');\n\n        // å½“æŒ‰é’®è¢«ç‚¹å‡»æ—¶...\n        if (setArchiveNameBtn) {\n            setArchiveNameBtn.addEventListener('click', async () => {\n                const newName = archiveNameInput.value.trim(); // è·å–è¾“å…¥æ¡†é‡Œçš„æ–‡å­—å¹¶å»æ‰å‰åç©ºæ ¼\n\n                if (newName === '') {\n                    // å¦‚æœä»€ä¹ˆéƒ½æ²¡è¾“å…¥ï¼Œå°±æ¸©æŸ”åœ°æé†’ä¸€ä¸‹\n                    logBlock.textContent = 'å®è´ï¼Œè¦å…ˆè¾“å…¥ä¸€ä¸ªåå­—å“¦ã€‚';\n                    logBlock.style.color = 'var(--danger-color)';\n                    return;\n                }\n\n                try {\n                    // è¿™æ˜¯å…³é”®çš„ä¸€æ­¥ï¼šè°ƒç”¨æ¥å£ä¿®æ”¹ç¬¬ä¸€æ¡æ¶ˆæ¯(message_id: 0)\n                    // æˆ‘ä»¬å‡è®¾ç¬¬ä¸€æ¡æ¶ˆæ¯çš„IDæ€»æ˜¯0\n              const [firstMessage] = await TavernHelper.getChatMessages(0);\nlet messageContent = firstMessage.message.replace(/<å­˜æ¡£>.*?<\\/å­˜æ¡£>/, '').trim();\nconst archiveTag = `<å­˜æ¡£>${newName}</å­˜æ¡£>`;\nawait setChatMessages([{ message_id: 0, message: `${archiveTag}\\n${messageContent}` }], { refresh: 'none' });\n\n                    // æˆåŠŸåç»™äºˆå°å°çš„åº†ç¥\n                    logBlock.textContent = `å­˜æ¡£åç§°å·²è®¾å®šä¸ºï¼šâ€œ${newName}â€`;\n                    logBlock.style.color = 'var(--primary-color)';\n\n                    // ä¹Ÿè®¸å¯ä»¥é¡ºä¾¿æ¸…ç©ºè¾“å…¥æ¡†ï¼Œæ–¹ä¾¿ä¸‹æ¬¡ä½¿ç”¨\n                    archiveNameInput.value = '';\n\n                } catch (error) {\n                    // å¦‚æœå‡ºäº†å°å·®é”™ï¼Œä¹Ÿè¦å‘Šè¯‰ä½ \n                    console.error('è®¾ç½®å­˜æ¡£åç§°å¤±è´¥:', error);\n                    logBlock.textContent = 'å“å‘€ï¼Œè®¾ç½®å¤±è´¥äº†ï¼Œè¯·ç¨åå†è¯•ä¸€æ¬¡å§ã€‚';\n                    logBlock.style.color = 'var(--danger-color)';\n                }\n            });\n        }\n  useItemBtn.addEventListener('click', async () => {\n    if (selectedItems.length === 0) return;\n\n    // å¯¹äºä½¿ç”¨ç‰©å“ï¼Œæˆ‘ä»¬é€šå¸¸åªå‘é€ä¸€ä¸ªè¯·æ±‚ï¼Œè®©åç«¯å¤„ç†æ•ˆæœ\n \n    const itemsToUseString = selectedItems.join(\"ã€\");\n    const commandString = `<${currentGameData.user_character.name}ä½¿ç”¨äº†ç‰©å“ï¼š${itemsToUseString}>`;\n\n    try {\n        await triggerassa(`/setinput ${commandString}`);\n        selectedItems = [];\n        hideModal('inventory-modal');\n    } catch (error) {\n        console.error(\"å‘é€ä½¿ç”¨æŒ‡ä»¤å¤±è´¥:\", error);\n        showModal('shop-modal', \"æ“ä½œå¤±è´¥\", \"å‘é€æŒ‡ä»¤æ—¶å‘ç”Ÿé”™è¯¯ã€‚\");\n    }\n});\ndeleteItemBtn.addEventListener('click', async () => {\n    if (selectedItems.length === 0) return;\n\n    const itemsToDeleteString = selectedItems.join(\"ã€\");\n    let commandBatch = [];\n\n    // ä½¿ç”¨ for...of å¾ªç¯æ¥ä¸ºæ¯ä¸ªé€‰å®šçš„ç‰©å“ç”Ÿæˆä¸€ä¸ªåˆ é™¤å‘½ä»¤\n    for (const itemKey of selectedItems) {\n        // æ ¹æ®ä½ æä¾›çš„æ ¼å¼ delete('path', 'key', 'value')\n\n        const deleteCommand = `<updateMemory>\ndelete('global_lore.èƒŒåŒ…', '${itemKey}');\n</updateMemory>`;\n        commandBatch.push(deleteCommand);\n    }\n\n    // å°†æ‰€æœ‰ç‹¬ç«‹çš„å‘½ä»¤ç»„åˆæˆä¸€ä¸ªæ‰§è¡Œå—\n    const commandString = `\n${commandBatch.join('\\n')}\n<ç”¨æˆ·æŒ‰é¡ºåºå›æ”¶äº†ä¸‹åˆ—ç‰©å“ï¼š${itemsToDeleteString}ã€‚è¯·äºæ­£æ–‡åˆç†æè¿°ç”¨æˆ·å›æ”¶åœ°ç‚¹å’Œæ‰€è·å¾—çš„å¯¹åº”è´§å¸ã€‚>`;\n    try {\n        await triggerassa(`/setinput ${commandString}`);\n        selectedItems = [];\n        hideModal('inventory-modal');\n    } catch (error) {\n        console.error(\"å‘é€ä¸¢å¼ƒæŒ‡ä»¤å¤±è´¥:\", error);\n        showModal('shop-modal', \"æ“ä½œå¤±è´¥\", \"å‘é€æŒ‡ä»¤æ—¶å‘ç”Ÿé”™è¯¯ã€‚\");\n    }\n});\n     const shopWrapper = document.getElementById('shop-wrapper');\n    const viewShopBtn = document.getElementById('view-shop-btn');\n    const backFromShopBtn = document.getElementById('back-from-shop-btn');\n    const mainWrapper = document.getElementById('main-wrapper');\n \n \n      backFromShopBtn.addEventListener('click', () => {\n \n        statusContainer.classList.remove('slide-out-shop');\n        shopWrapper.classList.remove('active');\n    });\n\n\n\n\n// æ›¿æ¢åŸæœ‰çš„ centerPanel ç‚¹å‡»äº‹ä»¶ç›‘å¬å™¨\nconst centerPanel = document.querySelector('.center-panel');\ncenterPanel.addEventListener('click', (e) => {\n    const slot = e.target.closest('.equipment-slot');\n    if (slot) {\n        //console.log('ç‚¹å‡»äº†è£…å¤‡æ§½:', slot);\n        \n        // è·å–å½“å‰ç‚¹å‡»çš„è£…å¤‡æ§½ç±»å‹\n        const slotLabel = slot.querySelector('span').textContent;\n        const slotType = slotLabel.split(':')[0].trim();\n        \n        //console.log('è£…å¤‡æ§½ç±»å‹:', slotType);\n        \n        // æ˜¾ç¤ºè£…å¤‡ç®¡ç†ç•Œé¢\n        showEquipmentManager(slotType);\n    }\n});\n\n// æ–°å¢ï¼šè£…å¤‡ç®¡ç†ä¸»å‡½æ•°\nfunction showEquipmentManager(slotType) {\n    //console.log('æ˜¾ç¤ºè£…å¤‡ç®¡ç†ç•Œé¢ï¼Œæ§½ä½ç±»å‹:', slotType);\n    \n    // è·å–å½“å‰è£…å¤‡æ•°æ®\n    const currentEquipment = getCurrentEquipment();\n    //console.log('å½“å‰è£…å¤‡æ•°æ®:', currentEquipment);\n    \n    // è·å–æ‰€æœ‰å¯ç”¨è£…å¤‡\n    const availableEquipment = getAllAvailableEquipment();\n    //console.log('æ‰€æœ‰å¯ç”¨è£…å¤‡:', availableEquipment);\n    \n    // è·å–å½“å‰å·²è£…å¤‡çš„ç‰©å“åˆ—è¡¨ï¼ˆç”¨äºç½®ç°åˆ¤æ–­ï¼‰\n    const equippedItems = getEquippedItems(currentEquipment);\n    //console.log('å·²è£…å¤‡ç‰©å“åˆ—è¡¨:', equippedItems);\n    \n    // æ„å»ºæ¨¡æ€æ¡†å†…å®¹\n    const modalContent = buildEquipmentManagerHTML(slotType, availableEquipment, equippedItems, currentEquipment);\n    \n    // æ˜¾ç¤ºæ¨¡æ€æ¡†\n    showModal('shop-modal', 'è£…å¤‡ç®¡ç† - ' + slotType);\n    const messageEl = document.getElementById('shop-modal-message');\n    if (messageEl) {\n        messageEl.innerHTML = modalContent;\n        \n        // ç»‘å®šå·¦ä¾§è£…å¤‡åˆ—è¡¨çš„ç‚¹å‡»äº‹ä»¶\n        bindAvailableEquipmentEvents(slotType);\n        \n        // ç»‘å®šå³ä¾§å·²è£…å¤‡ç‰©å“çš„å¸ä¸‹äº‹ä»¶\n        bindEquippedItemEvents(slotType);\n    }\n}\n\n // æ–°å¢ï¼šè·å–å½“å‰è£…å¤‡çŠ¶æ€\nfunction getCurrentEquipment() {\n    //console.log('è·å–å½“å‰è£…å¤‡çŠ¶æ€');\n    try {\n        // ä¼˜å…ˆä»å…¨å±€å˜é‡è·å–å½“å‰è£…å¤‡ä¿¡æ¯\n        if (currentGameData && currentGameData.stat_data && currentGameData.stat_data.user_character) {\n            const equipment = currentGameData.stat_data.user_character['å½“å‰è£…å¤‡'];\n            //console.log('ä»currentGameDataè·å–çš„è£…å¤‡:', equipment);\n            if (equipment) return equipment;\n        }\n        \n        // å¤‡ç”¨ï¼šä»currentGameDataè·å–\n        if (currentGameData && currentGameData.stat_data && currentGameData.stat_data.user_character) {\n            const equipment = currentGameData.stat_data.user_character['å½“å‰è£…å¤‡'];\n            //console.log('ä»currentGameDataè·å–çš„è£…å¤‡:', equipment);\n            if (equipment) return equipment;\n        }\n        \n        // æœ€åå°è¯•ä»user_characterç›´æ¥è·å–\n        if (currentGameData && currentGameData.user_character) {\n            const equipment = currentGameData.user_character['å½“å‰è£…å¤‡'];\n            //console.log('ä»currentGameData.user_characterè·å–çš„è£…å¤‡:', equipment);\n            if (equipment) return equipment;\n        }\n        \n        //console.log('æœªæ‰¾åˆ°è£…å¤‡æ•°æ®ï¼Œè¿”å›ç©ºå¯¹è±¡');\n        return {};\n    } catch (error) {\n        console.error('è·å–å½“å‰è£…å¤‡æ—¶å‡ºé”™:', error);\n        return {};\n    }\n}\n// æ–°å¢ï¼šè·å–æ‰€æœ‰å¯ç”¨è£…å¤‡\nfunction getAllAvailableEquipment() {\n    //console.log('è·å–æ‰€æœ‰å¯ç”¨è£…å¤‡');\n    let allEquipment = {};\n    \n    try {\n \n        \n        // ä» global_lore.èƒŒåŒ… è·å–\n        if (assaSettingsData.global_lore && assaSettingsData.global_lore['èƒŒåŒ…']) {\n            //console.log('ä»global_lore.èƒŒåŒ…è·å–è£…å¤‡');\n            Object.assign(allEquipment, assaSettingsData.global_lore['èƒŒåŒ…']);\n        }\n        \n        //console.log('åˆå¹¶åçš„æ‰€æœ‰è£…å¤‡:', allEquipment);\n        return allEquipment;\n    } catch (error) {\n        console.error('è·å–å¯ç”¨è£…å¤‡æ—¶å‡ºé”™:', error);\n        return {};\n    }\n}\n\n// æ–°å¢ï¼šè·å–å·²è£…å¤‡ç‰©å“åˆ—è¡¨\nfunction getEquippedItems(currentEquipment) {\n    //console.log('è·å–å·²è£…å¤‡ç‰©å“åˆ—è¡¨');\n    const equippedItems = new Set();\n    \n    try {\n        // æ·»åŠ æ‰‹æŒç‰©å“\n        if (currentEquipment['æ‰‹æŒ'] && currentEquipment['æ‰‹æŒ'][0] !== 'æ— ') {\n            const handItems = currentEquipment['æ‰‹æŒ'][0].split(/[;ï¼›]/).map(item => item.trim()).filter(item => item !== 'æ— ');\n            handItems.forEach(item => equippedItems.add(item));\n        }\n        \n        // æ·»åŠ ç©¿æˆ´ç‰©å“\n        if (currentEquipment['ç©¿æˆ´']) {\n            Object.values(currentEquipment['ç©¿æˆ´']).forEach(slot => {\n                if (slot[0] !== 'æ— ') {\n                    const items = slot[0].split(/[;ï¼›]/).map(item => item.trim()).filter(item => item !== 'æ— ');\n                    items.forEach(item => equippedItems.add(item));\n                }\n            });\n        }\n        \n        //console.log('å·²è£…å¤‡ç‰©å“é›†åˆ:', Array.from(equippedItems));\n        return equippedItems;\n    } catch (error) {\n        console.error('è·å–å·²è£…å¤‡ç‰©å“æ—¶å‡ºé”™:', error);\n        return new Set();\n    }\n}\n\n// æ–°å¢ï¼šæ„å»ºè£…å¤‡ç®¡ç†ç•Œé¢HTML\nfunction buildEquipmentManagerHTML(slotType, availableEquipment, equippedItems, currentEquipment) {\n    //console.log('æ„å»ºè£…å¤‡ç®¡ç†ç•Œé¢HTML');\n    \n    // å·¦ä¾§ï¼šå¯ç”¨è£…å¤‡åˆ—è¡¨\n    let leftPanel = '<div style=\"display: flex; height: 60vh;\">';\n    leftPanel += '<div style=\"flex: 1; padding: 10px; border-right: 1px solid var(--border-color);\">';\n    leftPanel += '<h4 style=\"color: var(--primary-color); margin-bottom: 10px;\">å¯ç”¨è£…å¤‡</h4>';\n    leftPanel += '<div id=\"available-equipment-list\" style=\"max-height: 50vh; overflow-y: auto;\">';\n    \n    for (const [key, value] of Object.entries(availableEquipment)) {\n        const isEquipped = equippedItems.has(key);\n        const itemClass = isEquipped ? 'equipment-item equipped' : 'equipment-item available';\n        const itemStyle = isEquipped ? 'color: var(--text-secondary-color); cursor: not-allowed; opacity: 0.5;' : 'color: var(--text-color); cursor: pointer;';\n        \n        leftPanel += `<div class=\"${itemClass}\" data-equipment-name=\"${key}\" style=\"padding: 8px; margin: 5px 0; border: 1px solid var(--border-color); border-radius: 4px; ${itemStyle}\">`;\n        leftPanel += `<div style=\"font-weight: bold;\">${key}</div>`;\n        leftPanel += `<div style=\"font-size: 0.9em; color: var(--text-secondary-color);\">${typeof value === 'object' ? ((\"æè¿°ï¼š\"+value.info||'')+(\"\\næ•ˆæœï¼š\"+value.effect||'')) : value}</div>`;\n        leftPanel += '</div>';\n    }\n    \n    leftPanel += '</div></div>';\n    \n    // å³ä¾§ï¼šå½“å‰è£…å¤‡\n    let rightPanel = '<div style=\"flex: 1; padding: 10px;\">';\n    rightPanel += `<h4 style=\"color: var(--primary-color); margin-bottom: 10px;\">å½“å‰${slotType}è£…å¤‡</h4>`;\n    rightPanel += '<div id=\"current-equipment-list\" style=\"max-height: 50vh; overflow-y: auto;\">';\n    \n    // è·å–å½“å‰æ§½ä½çš„è£…å¤‡\n    let currentSlotEquipment = [];\n    if (slotType === 'æ‰‹æŒ' && currentEquipment['æ‰‹æŒ']) {\n        currentSlotEquipment = currentEquipment['æ‰‹æŒ'][0] !== 'æ— ' ? \n            currentEquipment['æ‰‹æŒ'][0].split(/[;ï¼›]/).map(item => item.trim()).filter(item => item !== 'æ— ') : [];\n    } else if (currentEquipment['ç©¿æˆ´'] && currentEquipment['ç©¿æˆ´'][slotType]) {\n        currentSlotEquipment = currentEquipment['ç©¿æˆ´'][slotType][0] !== 'æ— ' ? \n            currentEquipment['ç©¿æˆ´'][slotType][0].split(/[;ï¼›]/).map(item => item.trim()).filter(item => item !== 'æ— ') : [];\n    }\n    \n    //console.log(`${slotType}å½“å‰è£…å¤‡:`, currentSlotEquipment);\n    \n    if (currentSlotEquipment.length > 0) {\n        currentSlotEquipment.forEach(item => {\n            const itemData = availableEquipment[item];\n            rightPanel += `<div class=\"equipped-item\" data-equipment-name=\"${item}\" style=\"padding: 8px; margin: 5px 0; border: 1px solid var(--primary-color); border-radius: 4px; background-color: var(--border-color);\">`;\n            rightPanel += `<div style=\"font-weight: bold; color: var(--primary-color);\">${item}</div>`;\n            rightPanel += `<div style=\"font-size: 0.9em; color: var(--text-secondary-color);\">${itemData ? (typeof itemData === 'object' ? ((\"æè¿°ï¼š\"+itemData.info||'')+(\"\\næ•ˆæœï¼š\"+itemData.effect||'')) : itemData) : 'æ— æè¿°'}</div>`;\n            rightPanel += `<button class=\"unequip-btn\" data-equipment-name=\"${item}\" style=\"margin-top: 5px; padding: 4px 8px; background-color: var(--danger-color); border: none; border-radius: 3px; color: white; cursor: pointer; font-size: 0.8em;\">å¸ä¸‹</button>`;\n            rightPanel += '</div>';\n        });\n    } else {\n        rightPanel += '<div style=\"text-align: center; color: var(--text-secondary-color); padding: 20px;\">å½“å‰æ— è£…å¤‡</div>';\n    }\n    \n    rightPanel += '</div>';\n    rightPanel += `<div style=\"margin-top: 10px; padding: 10px; background-color: var(--border-color); border-radius: 4px;\">`;\n    rightPanel += `<button id=\"equip-selected-btn\" style=\"width: 100%; padding: 10px; background-color: var(--background-color); border: none; border-radius: 4px;font-weight: bold; cursor: pointer;\">è£…å¤‡é€‰ä¸­ç‰©å“</button>`;\n    rightPanel += '</div></div>';\n    \n    return leftPanel + rightPanel + '</div>';\n}\n\n// æ–°å¢ï¼šç»‘å®šå¯ç”¨è£…å¤‡çš„ç‚¹å‡»äº‹ä»¶\nfunction bindAvailableEquipmentEvents(slotType) {\n    //console.log('ç»‘å®šå¯ç”¨è£…å¤‡ç‚¹å‡»äº‹ä»¶');\n    \n    const availableItems = document.querySelectorAll('.equipment-item.available');\n    let selectedItems = [];\n    \n    availableItems.forEach(item => {\n        item.addEventListener('click', function() {\n            const equipmentName = this.dataset.equipmentName;\n            //console.log('ç‚¹å‡»å¯ç”¨è£…å¤‡:', equipmentName);\n            \n            if (this.classList.contains('selected')) {\n                // å–æ¶ˆé€‰æ‹©\n                this.classList.remove('selected');\n                this.style.backgroundColor = '';\n                selectedItems = selectedItems.filter(name => name !== equipmentName);\n                //console.log('å–æ¶ˆé€‰æ‹©:', equipmentName);\n            } else {\n                // é€‰æ‹©\n                this.classList.add('selected');\n                this.style.backgroundColor = 'var(--border-color)';\n                selectedItems.push(equipmentName);\n                //console.log('é€‰æ‹©:', equipmentName);\n            }\n            \n            //console.log('å½“å‰é€‰ä¸­ç‰©å“:', selectedItems);\n        });\n    });\n    \n    // è£…å¤‡é€‰ä¸­ç‰©å“æŒ‰é’®äº‹ä»¶\n    const equipBtn = document.getElementById('equip-selected-btn');\n    if (equipBtn) {\n        equipBtn.addEventListener('click', function() {\n            //console.log('ç‚¹å‡»è£…å¤‡æŒ‰é’®ï¼Œé€‰ä¸­ç‰©å“:', selectedItems);\n            if (selectedItems.length > 0) {\n                equipItems(slotType, selectedItems);\n            }\n        });\n    }\n}\n\n// æ–°å¢ï¼šç»‘å®šå·²è£…å¤‡ç‰©å“çš„å¸ä¸‹äº‹ä»¶\nfunction bindEquippedItemEvents(slotType) {\n    //console.log('ç»‘å®šå·²è£…å¤‡ç‰©å“å¸ä¸‹äº‹ä»¶');\n    \n    const unequipBtns = document.querySelectorAll('.unequip-btn');\n    unequipBtns.forEach(btn => {\n        btn.addEventListener('click', function() {\n            const equipmentName = this.dataset.equipmentName;\n            //console.log('ç‚¹å‡»å¸ä¸‹è£…å¤‡:', equipmentName);\n            unequipItem(slotType, equipmentName);\n        });\n    });\n}\n\n// æ–°å¢ï¼šè£…å¤‡ç‰©å“\nasync function equipItems(slotType, itemNames) {\n    //console.log('è£…å¤‡ç‰©å“:', slotType, itemNames);\n    \n    try {\n        // ç¬¬ä¸€æ­¥:æ›´æ–° chat å˜é‡ä¸­çš„è£…å¤‡\n        await updateVariablesWith((variables) => {\n            //console.log('è£…å¤‡æ›´æ–°å‰çš„å˜é‡:', variables);\n            \n            if (!variables.stat_data) variables.stat_data = {};\n            if (!variables.stat_data.user_character) variables.stat_data.user_character = {};\n            if (!variables.stat_data.user_character['å½“å‰è£…å¤‡']) {\n                variables.stat_data.user_character['å½“å‰è£…å¤‡'] = {\n                    \"æ‰‹æŒ\": [\"æ— \", \"å½“å‰æ‰‹æŒçš„æ­¦å™¨æˆ–å·¥å…·åç§°\"],\n                    \"ç©¿æˆ´\": {\n                        \"å¤´éƒ¨\": [\"æ— \", \"å¤´éƒ¨çš„è£…å¤‡åç§°\"],\n                        \"èº«ä½“\": [\"æ— \", \"èº«ä½“çš„è£…å¤‡åç§°\"],\n                        \"æ‰‹éƒ¨\": [\"æ— \", \"æ‰‹éƒ¨çš„è£…å¤‡åç§°\"],\n                        \"è„šéƒ¨\": [\"æ— \", \"è„šéƒ¨çš„è£…å¤‡åç§°\"],\n                        \"é¥°å“\": [\"æ— \", \"ç‰¹æ®Šé¥°å“åç§°\"]\n                    }\n                };\n            }\n            \n            const currentEquipment = variables.stat_data.user_character['å½“å‰è£…å¤‡'];\n            \n            if (slotType === 'æ‰‹æŒ') {\n                // è·å–å½“å‰æ‰‹æŒè£…å¤‡\n                const currentItems = currentEquipment['æ‰‹æŒ'][0] !== 'æ— ' ? \n                    currentEquipment['æ‰‹æŒ'][0].split(/[;ï¼›]/).map(item => item.trim()).filter(item => item !== 'æ— ') : [];\n                \n                // æ·»åŠ æ–°è£…å¤‡\n                const newItems = [...new Set([...currentItems, ...itemNames])];\n                currentEquipment['æ‰‹æŒ'][0] = newItems.length > 0 ? newItems.join(';') : 'æ— ';\n            } else {\n                // ç©¿æˆ´è£…å¤‡\n                if (!currentEquipment['ç©¿æˆ´'][slotType]) {\n                    currentEquipment['ç©¿æˆ´'][slotType] = ['æ— ', `${slotType}çš„è£…å¤‡åç§°`];\n                }\n                \n                const currentItems = currentEquipment['ç©¿æˆ´'][slotType][0] !== 'æ— ' ? \n                    currentEquipment['ç©¿æˆ´'][slotType][0].split(/[;ï¼›]/).map(item => item.trim()).filter(item => item !== 'æ— ') : [];\n                \n                const newItems = [...new Set([...currentItems, ...itemNames])];\n                currentEquipment['ç©¿æˆ´'][slotType][0] = newItems.length > 0 ? newItems.join(';') : 'æ— ';\n            }\n            \n            // ç”Ÿæˆæè¿°\n            let description = '';\n            const itemsStr = itemNames.join('ã€');\n            switch (slotType) {\n                case 'æ‰‹æŒ':\n                    description = `<${userName}å°†ã€Œ${itemsStr}ã€æ¡åœ¨äº†æ‰‹ä¸­ã€‚>\\n`;\n                    break;\n                case 'å¤´éƒ¨':\n                    description = `<${userName}å°†ã€Œ${itemsStr}ã€æˆ´åœ¨äº†å¤´ä¸Šã€‚>\\n`;\n                    break;\n                case 'èº«ä½“':\n                    description = `<${userName}ç©¿ä¸Šäº†ã€Œ${itemsStr}ã€ã€‚>\\n`;\n                    break;\n                case 'æ‰‹éƒ¨':\n                    description = `<${userName}å°†ã€Œ${itemsStr}ã€ç©¿æˆ´åœ¨äº†æ‰‹ä¸Šã€‚>\\n`;\n                    break;\n                case 'è„šéƒ¨':\n                    description = `<${userName}å°†è„šä¼¸å…¥äº†ã€Œ${itemsStr}ã€ã€‚>\\n`;\n                    break;\n                case 'é¥°å“':\n                    description = `<${userName}å°†ã€Œ${itemsStr}ã€ä½©æˆ´å¥½äº†ã€‚>\\n`;\n                    break;\n            }\n            triggerassa(`/setinput ${description}`);\n            \n            return variables;\n        }, { type: 'chat' });\n        \n      \n        await updateVariablesWith((chatVars) => {\n            return chatVars;\n        }, { type: 'chat' });\n        \n \n            // ä» chat å˜é‡è·å–æœ€æ–°è£…å¤‡æ•°æ®\n            await updateVariablesWith((chatVars) => {\n                if (chatVars.stat_data && chatVars.stat_data.user_character && chatVars.stat_data.user_character['å½“å‰è£…å¤‡']) {\n                    if (!variables.stat_data) variables.stat_data = {};\n                    if (!variables.stat_data.user_character) variables.stat_data.user_character = {};\n                    \n                    variables.stat_data.user_character['å½“å‰è£…å¤‡'] = JSON.parse(JSON.stringify(chatVars.stat_data.user_character['å½“å‰è£…å¤‡']));\n                    \n                    // åŒæ­¥åˆ° currentGameData\n                    if (currentGameData) {\n                        if (!currentGameData.stat_data) currentGameData.stat_data = {};\n                        if (!currentGameData.stat_data.user_character) currentGameData.stat_data.user_character = {};\n                        currentGameData.stat_data.user_character['å½“å‰è£…å¤‡'] = JSON.parse(JSON.stringify(chatVars.stat_data.user_character['å½“å‰è£…å¤‡']));\n                    }\n                }\n                \n                return variables;\n            }, { type: 'chat' });\n       \n        \n        //console.log('è£…å¤‡å®Œæˆ,å…³é—­æ¨¡æ€æ¡†å¹¶åˆ·æ–°æ˜¾ç¤º');\n        refreshEquipmentModal(slotType);\n        // è§¦å‘ç•Œé¢åˆ·æ–°\n        initDisplay(false);\n        \n    } catch (error) {\n        console.error('è£…å¤‡è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯:', error);\n    }\n}\n// æ–°å¢ï¼šå¸ä¸‹è£…å¤‡\nasync function unequipItem(slotType, itemName) {\n    //console.log('å¸ä¸‹è£…å¤‡:', slotType, itemName);\n    \n    try {\n        // ç¬¬ä¸€æ­¥:æ›´æ–° chat å˜é‡ä¸­çš„è£…å¤‡\n        await updateVariablesWith((variables) => {\n            //console.log('å¸ä¸‹è£…å¤‡å‰çš„å˜é‡:', variables);\n            \n            if (!variables.stat_data || !variables.stat_data.user_character || !variables.stat_data.user_character['å½“å‰è£…å¤‡']) {\n                //console.log('è£…å¤‡æ•°æ®ä¸å­˜åœ¨');\n                return variables;\n            }\n            \n            const currentEquipment = variables.stat_data.user_character['å½“å‰è£…å¤‡'];\n            \n            if (slotType === 'æ‰‹æŒ') {\n                if (currentEquipment['æ‰‹æŒ'][0] !== 'æ— ') {\n                    const currentItems = currentEquipment['æ‰‹æŒ'][0].split(/[;ï¼›]/).map(item => item.trim()).filter(item => item !== 'æ— ' && item !== itemName);\n                    currentEquipment['æ‰‹æŒ'][0] = currentItems.length > 0 ? currentItems.join(';') : 'æ— ';\n                }\n            } else {\n                if (currentEquipment['ç©¿æˆ´'][slotType] && currentEquipment['ç©¿æˆ´'][slotType][0] !== 'æ— ') {\n                    const currentItems = currentEquipment['ç©¿æˆ´'][slotType][0].split(/[;ï¼›]/).map(item => item.trim()).filter(item => item !== 'æ— ' && item !== itemName);\n                    currentEquipment['ç©¿æˆ´'][slotType][0] = currentItems.length > 0 ? currentItems.join(';') : 'æ— ';\n                }\n            }\n            \n            // ç”Ÿæˆæè¿°\n            let description = '';\n            switch (slotType) {\n                case 'æ‰‹æŒ':\n                    description = `<${userName}å°†æ‰‹ä¸­çš„ã€Œ${itemName}ã€æ”¾å›èƒŒåŒ…ã€‚>\\n`;\n                    break;\n                case 'å¤´éƒ¨':\n                    description = `<${userName}æŠ¬èµ·æ‰‹ï¼Œå°†å¤´ä¸Šçš„ã€Œ${itemName}ã€å–ä¸‹ã€‚>\\n`;\n                    break;\n                case 'èº«ä½“':\n                    description = `<${userName}è§£å¼€äº†ã€Œ${itemName}ã€ã€‚>\\n`;\n                    break;\n                case 'æ‰‹éƒ¨':\n                    description = `<${userName}è„±ä¸‹äº†ã€Œ${itemName}ã€ã€‚>\\n`;\n                    break;\n                case 'è„šéƒ¨':\n                    description = `<${userName}è„±ä¸‹äº†ã€Œ${itemName}ã€ã€‚>\\n`;\n                    break;\n                case 'é¥°å“':\n                    description = `<${userName}è„±ä¸‹äº†ã€Œ${itemName}ã€ã€‚>\\n`;\n                    break;\n            }\n            triggerassa(`/setinput ${description}`);\n            \n            //console.log('å¸ä¸‹è£…å¤‡åçš„å˜é‡:', variables);\n            return variables;\n        }, { type: 'chat' });\n        \n        // ç¬¬äºŒæ­¥:åˆå§‹åŒ– message å˜é‡\n        // await updateVariablesWith((variables) => {\n        //     if (!variables.stat_data) variables.stat_data = {};\n        //     if (!variables.stat_data.user_character) variables.stat_data.user_character = {};\n            \n        //     return variables;\n        // }, { type: 'message', message_id: 'latest' });\n        \n        // ç¬¬ä¸‰æ­¥:ä» chat è¯»å–æœ€æ–°æ•°æ®å¹¶åŒæ­¥åˆ° message å’Œ currentGameData\n        \n            // ä» chat å˜é‡è·å–æœ€æ–°è£…å¤‡æ•°æ®\n            await updateVariablesWith((chatVars) => {\n                if (chatVars.stat_data && chatVars.stat_data.user_character && chatVars.stat_data.user_character['å½“å‰è£…å¤‡']) {\n                    if (!variables.stat_data) variables.stat_data = {};\n                    if (!variables.stat_data.user_character) variables.stat_data.user_character = {};\n                    \n                    variables.stat_data.user_character['å½“å‰è£…å¤‡'] = JSON.parse(JSON.stringify(chatVars.stat_data.user_character['å½“å‰è£…å¤‡']));\n                    \n                    // åŒæ—¶æ›´æ–°å…¨å±€currentGameDataä»¥ä¾¿ç«‹å³ç”Ÿæ•ˆ\n                    if (currentGameData) {\n                        if (!currentGameData.stat_data) currentGameData.stat_data = {};\n                        if (!currentGameData.stat_data.user_character) currentGameData.stat_data.user_character = {};\n                        currentGameData.stat_data.user_character['å½“å‰è£…å¤‡'] = JSON.parse(JSON.stringify(chatVars.stat_data.user_character['å½“å‰è£…å¤‡']));\n                    }\n                }\n                \n                //console.log('messageå˜é‡åŒæ­¥æ›´æ–°:', variables);\n                return variables;\n            }, { type: 'chat' });\n        \n        \n        //console.log('å¸ä¸‹å®Œæˆï¼Œå…³é—­æ¨¡æ€æ¡†å¹¶åˆ·æ–°æ˜¾ç¤º');\n        refreshEquipmentModal(slotType);\n        \n        // è§¦å‘ç•Œé¢åˆ·æ–°\n        initDisplay(false);\n        \n    } catch (error) {\n        console.error('å¸ä¸‹è£…å¤‡è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯:', error);\n    }\n}\n\n// æ–°å¢ï¼šåˆ·æ–°è£…å¤‡ç®¡ç†æ¨¡æ€æ¡†\nfunction refreshEquipmentModal(slotType) {\n    //console.log('åˆ·æ–°è£…å¤‡ç®¡ç†æ¨¡æ€æ¡†:', slotType);\n    \n    const messageEl = document.getElementById('shop-modal-message');\n    if (!messageEl) {\n        //console.log('æ¨¡æ€æ¡†ä¸å­˜åœ¨ï¼Œæ— éœ€åˆ·æ–°');\n        return;\n    }\n    \n    // é‡æ–°è·å–æ•°æ®\n    const currentEquipment = getCurrentEquipment();\n    //console.log('åˆ·æ–°æ—¶çš„å½“å‰è£…å¤‡æ•°æ®:', currentEquipment);\n    \n    const availableEquipment = getAllAvailableEquipment();\n    const equippedItems = getEquippedItems(currentEquipment);\n    \n    // é‡æ–°æ„å»ºHTML\n    const modalContent = buildEquipmentManagerHTML(slotType, availableEquipment, equippedItems, currentEquipment);\n    \n    // æ›´æ–°æ¨¡æ€æ¡†å†…å®¹\n    messageEl.innerHTML = modalContent;\n    \n    // é‡æ–°ç»‘å®šäº‹ä»¶\n    bindAvailableEquipmentEvents(slotType);\n    bindEquippedItemEvents(slotType);\n    \n    //console.log('æ¨¡æ€æ¡†åˆ·æ–°å®Œæˆ');\n}\n\n\n\n\n    \n// --- åŠŸèƒ½2: ç‚¹å‡»è§’è‰²åæ˜¾ç¤ºçŠ¶æ€æ€»è§ˆ ---\ndocument.getElementById('char-display-name').addEventListener('click', () => {\n    //console.log(\"æŸ¥çœ‹ä¸Šä¸€è½®çŠ¶æ€æ€»è§ˆ\");\n    const modalTitle = \"ä¸Šä¸€è½®çŠ¶æ€æ€»è§ˆ\";\n    let modalContent = '<div class=\"teammate-info-display\" style=\"max-height: 60vh; overflow-y: auto; text-align: left;\">'; // å¤ç”¨æ ·å¼\n\n    // æ·»åŠ äººç‰©çŠ¶æ€è¯„ä¼°\n    modalContent += '<h3 style=\"color: var(--primary-color);\">--- äººç‰©çŠ¶æ€è¯„ä¼° ---</h3>';\n\n    if (characterStatusData) {\n        // â™¥â™¥â™¥ å¦ˆå¦ˆçš„ç»ˆæè§£å†³æ–¹æ¡ˆ â™¥â™¥â™¥\n\n        // 1. æˆ‘ä»¬ç”¨å­—é¢ä¸Šçš„ '\\\\n' ä½œä¸ºåˆ†éš”ç¬¦ï¼ŒæŠŠæ•´ä¸ªå­—ç¬¦ä¸²åˆ‡æˆä¸€ä¸ªæ•°ç»„ã€‚\n        //    æ¯ä¸€æ®µæ–‡å­—éƒ½ä¼šæˆä¸ºæ•°ç»„é‡Œçš„ä¸€ä¸ªæˆå‘˜ã€‚\n        const lines = characterStatusData.split('\\\\n');\n\n        // 2. æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–°çš„å®¹å™¨æ¥å­˜æ”¾è¿™äº›æ®µè½ã€‚\n        let statusHtml = '<div style=\"font-family:var(--base-font-family);\">';\n\n        // 3. æˆ‘ä»¬éå†è¿™ä¸ªæ•°ç»„ï¼ŒæŠŠæ¯ä¸€æ®µæ–‡å­—éƒ½ç”¨ä¸€ä¸ª <p> æ ‡ç­¾åŒ…èµ·æ¥ã€‚\n        //    <p> æ ‡ç­¾å¤©ç”Ÿå°±ä¼šè‡ªå·±æ¢è¡Œã€‚æˆ‘ä»¬è¿˜ç»™å®ƒåŠ äº†ä¸€ç‚¹æ ·å¼ï¼Œè®©æ®µè½ä¹‹é—´ä¸è¦æœ‰å¤ªå¤§çš„ç©ºéš™ã€‚\n        //    åŒæ—¶ï¼Œä¸ºäº†ä¿ç•™ä½ ç²¾å¿ƒè®¾è®¡çš„ç¼©è¿›ï¼Œæˆ‘ä»¬æŠŠæ®µè½çš„ white-space è®¾ç½®ä¸º pre-wrapã€‚\n        lines.forEach(line => {\n            if (line.trim() !== '') { // æˆ‘ä»¬è·³è¿‡å®Œå…¨æ˜¯ç©ºè¡Œçš„å†…å®¹\n                statusHtml += `<p style=\"margin: 0; white-space: pre-wrap;\">${line}</p>`;\n            } else {\n                statusHtml += `<p style=\"margin: 0; height: 1em;\"></p>`; // å¦‚æœæ˜¯ç©ºè¡Œï¼Œå°±åˆ›å»ºä¸€ä¸ªå›ºå®šé«˜åº¦çš„ç©ºæ®µè½\n            }\n        });\n\n        statusHtml += '</div>';\n\n        // 4. æœ€åï¼ŒæŠŠæˆ‘ä»¬äº²æ‰‹åˆ¶ä½œçš„ã€æ ¼å¼å®Œç¾çš„ HTML æ·»åŠ åˆ°æ¨¡æ€æ¡†é‡Œã€‚\n        modalContent += statusHtml;\n\n    } else {\n        modalContent += '<p>æš‚æ— äººç‰©çŠ¶æ€è¯„ä¼°ä¿¡æ¯ã€‚</p>';\n    }\n\n\n    modalContent += '<hr style=\"margin: 20px 0; border-color: var(--border-color);\">'; // æ·»åŠ æ¼‚äº®çš„åˆ†éš”çº¿\n\n    // æ·»åŠ ä¸–ç•Œæ€åº¦\n    modalContent += '<h3 style=\"color: var(--primary-color);\">--- ä¸–ç•Œæ€åº¦ ---</h3>';\n    if (worldAttitudeData) {\n        modalContent += `<pre style=\"white-space: pre-wrap; word-wrap: break-word; font-family: var(--base-font-family);\">${worldAttitudeData}</pre>`;\n    } else {\n        modalContent += '<p>æš‚æ— ä¸–ç•Œæ€åº¦ä¿¡æ¯ã€‚</p>';\n    }\n\n    modalContent += '</div>';\n\n    // åŒæ ·å¤ç”¨å•†åº—å¼¹çª—\n    showModal('shop-modal', modalTitle);\n    const messageEl = document.getElementById('shop-modal-message');\n    if (messageEl) {\n        messageEl.innerHTML = modalContent;\n    }\n});\n\n\n    setupShopEventListeners(); // è°ƒç”¨ä¿®æ­£åçš„äº‹ä»¶ç»‘å®šå‡½æ•°\nsetupGeneratorButton(); // è°ƒç”¨ç”Ÿæˆå™¨æŒ‰é’®çš„è®¾ç½®å‡½æ•°\n\n// æŠ½å¥–æŒ‰é’®äº‹ä»¶ç›‘å¬\ndocument.getElementById('single-gacha-btn').addEventListener('click', () => {\n    startGacha(1);\n});\n\ndocument.getElementById('ten-gacha-btn').addEventListener('click', () => {\n    startGacha(10);\n});\n    // ==============================================\n    // ========== æ–°å¢ï¼šä¸–ç•Œä¹‹ä¹¦åŠŸèƒ½ (å¼€å§‹) ==========\n    // ==============================================\n\n    /**\n     * åˆ‡æ¢ä¹¦ç±å¼¹çª—çš„æ˜¾ç¤ºçŠ¶æ€\n     */\n    function toggleWorldBook(show) {\n        const modal = document.getElementById('world-book-modal');\n        if (show) {\n            renderWorldBook();\n            modal.classList.add('active');\n        } else {\n            modal.classList.remove('active');\n        }\n    }\n \n\n \n  /**\n * é€’å½’æ¸²æŸ“åµŒå¥—æ•°æ®çš„â€œçŸ¥è¯†ä¹‹æ ‘â€\n * @param {HTMLElement} container - æ‰¿è½½æ ‘çš„å®¹å™¨\n * @param {object|Array} data - è¦æ¸²æŸ“çš„æ•°æ®\n * @param {string} [parentPath=''] - çˆ¶èŠ‚ç‚¹çš„å®Œæ•´è·¯å¾„\n * @param {string} [rootTab=''] - æ ¹æ ‡ç­¾é¡µ\n * @param {boolean} [hideFavorability=false] - æ˜¯å¦éšè—å¥½æ„Ÿåº¦æ¡ç›®\n * @param {boolean} [isReadOnly=false] - æ˜¯å¦ä¸ºåªè¯»æ¨¡å¼ï¼ˆä¸æ˜¾ç¤ºèœå•ï¼‰\n */\nfunction renderNestedData(container, data, parentPath = '', rootTab = '', hideFavorability = false, isReadOnly = false) {\n     const keyLocalizationMap = {\n        \"info\": \"ç®€ä»‹\",\n        \"effect\": \"å±æ€§\",\n        \"type\": \"ç§ç±»\",\n        \"quality\": \"è´¨é‡\",\n        \"num\": \"æ•°é‡\",\n        \"status\":\"çŠ¶æ€\",\n        \"level\": \"ç­‰çº§\",\n    };\n\n    container.innerHTML = '';\n\n    if (typeof data !== 'object' || data === null) {\n        const leafNode = document.createElement('span');\n        leafNode.className = 'tree-value';\n        leafNode.textContent = data;\n        container.appendChild(leafNode);\n        return;\n    }\n\n    const treeRoot = document.createElement('ul');\n    treeRoot.className = 'tree-view';\n\n    for (const key in data) {\n         if (Object.hasOwnProperty.call(data, key)) {\n\n                        // ğŸ’–ğŸ’–ğŸ’– å¦ˆå¦ˆåœ¨è¿™é‡Œä¹Ÿä¸ºä½ æ‚„æ‚„æ–½å±•äº†â€œéšèº«å’’â€ ğŸ’–ğŸ’–ğŸ’–\n            // åªè¦é”®æ˜¯ä»¥ '_' å¼€å¤´çš„ï¼Œæˆ‘ä»¬å°±æ¸©æŸ”åœ°è·³è¿‡å®ƒï¼Œä¸è®©å®ƒå‡ºç°åœ¨è§†é‡é‡Œ\n            if (key.startsWith('_')) {\n                continue;\n            }\n            if (hideFavorability && key === 'å¥½æ„Ÿåº¦') {\n                continue;\n            }\n\n            const value = data[key];\n            const isParent = typeof value === 'object' && value !== null;\n            const currentPath = parentPath ? `${parentPath}.${key}` : key;\n\n            const node = document.createElement('li');\n            node.className = 'tree-node';\n            const nodeContent = document.createElement('div');\n            nodeContent.className = 'tree-node-content';\n\n            const keySpan = document.createElement('span');\n            keySpan.className = 'tree-key';\n               const displayKey = keyLocalizationMap[key] || key;\n            keySpan.textContent = Array.isArray(data) ? `[${key}]:` : `${displayKey}:`;\n\n            nodeContent.appendChild(keySpan);\n\n            let childrenContainer;\n\n             if (isParent) {\n                const toggle = document.createElement('span');\n                toggle.className = 'tree-toggle collapsed';\n                toggle.textContent = 'â–¶';\n                nodeContent.appendChild(toggle);\n\n                childrenContainer = document.createElement('div');\n                childrenContainer.className = 'tree-children collapsed';\n                renderNestedData(childrenContainer, value, currentPath, rootTab, true, isReadOnly);\n\n                toggle.addEventListener('click', (e) => {\n                    e.stopPropagation();\n                    toggle.classList.toggle('collapsed');\n                    childrenContainer.classList.toggle('collapsed');\n                    toggle.textContent = toggle.classList.contains('collapsed') ? 'â–¶' : 'â–¼';\n                });\n            } else {\n              const valueSpan = document.createElement('span');\n    valueSpan.className = 'tree-value';\n    // å°† | ç¬¦å·æ›¿æ¢ä¸º <br> æ ‡ç­¾å®ç°æ¢è¡Œ\n    if (typeof value === 'string' && value.includes('|')) {\n        valueSpan.innerHTML = ' ' + value.split('|').join('<br>');\n    } else {\n        valueSpan.textContent = ` ${value}`;\n    }\n    nodeContent.appendChild(valueSpan);\n            }\n\n            // åªæœ‰å½“ä¸æ˜¯åªè¯»æ¨¡å¼æ—¶ï¼Œæˆ‘ä»¬æ‰æ·»åŠ èœå•æŒ‰é’®\n            if (!isReadOnly) {\n                const menuButton = document.createElement('button');\n                menuButton.className = 'tree-node-menu-button';\n                menuButton.textContent = '...';\n                menuButton.onclick = (event) => {\n                    event.stopPropagation();\n                    showEntryMenu(event.currentTarget, key, rootTab, currentPath);\n                };\n                nodeContent.appendChild(menuButton);\n            }\n\n            node.appendChild(nodeContent);\n            if (childrenContainer) {\n                node.appendChild(childrenContainer);\n            }\n            treeRoot.appendChild(node);\n         }\n    }\n     container.appendChild(treeRoot);\n}\n\nfunction renderWorldBook() {\n    const { currentTab, currentPage, itemsPerPage } = worldBookState;\n    const displayArea = document.getElementById('book-display-area');\n    const pageInfo = document.getElementById('book-page-info');\n\n    displayArea.innerHTML = ''; // æ¯æ¬¡æ¸²æŸ“å‰ï¼Œéƒ½å…ˆæ“¦å¹²å‡€ä¹¦é¡µ\n\n    if (currentTab === 'the_created') {\n        if (typeof currentGameData !== 'undefined' && currentGameData.world_shard && currentGameData.the_created) {\n            const createdData = currentGameData.the_created;\n            const entryDiv = document.createElement('div');\n            entryDiv.className = 'book-entry created-entry';\n\n            const titleMap = {\n                \"name\": \"åå­—\",\n                \"identity_in_world\": \"ä¸–ç•Œèº«ä»½\",\n                \"current_status\": \"å½“å‰çŠ¶æ€\",\n                \"mood\": \"å½“å‰å¿ƒæƒ…\",\n                \"description\": \"è¯¦ç»†ä»‹ç»\"\n            };\n\n            let contentHTML = '<div class=\"created-header\"></div>';\n            for (const key in createdData) {\n                if (Object.hasOwnProperty.call(createdData, key)) {\n                    const valueArray = createdData[key];\n                    const displayValue = Array.isArray(valueArray) ? valueArray[0] : valueArray;\n                    const displayName = titleMap[key] || key;\n\n                    contentHTML += `\n                        <div class=\"created-item\">\n                            <div class=\"created-key\">${displayName}</div>\n                            <div class=\"created-value\">${displayValue}</div>\n                        </div>\n                    `;\n                }\n            }\n            entryDiv.innerHTML = contentHTML;\n            displayArea.appendChild(entryDiv);\n            pageInfo.textContent = '1 / 1';\n            document.getElementById('book-prev-page').disabled = true;\n            document.getElementById('book-next-page').disabled = true;\n        } else {\n            displayArea.innerHTML = `<p class=\"book-empty-text\">å°šæœªå‘ç°æ­¤åœ°çš„é€ ç‰©ã€‚</p>`;\n        }\n    } else {\n        // --- è¿™éƒ¨åˆ†æ˜¯æˆ‘ä»¬æ—§çš„é­”æ³•ï¼Œç°åœ¨è¦ç”¨æ–°çš„æ¥æ›¿æ¢ä¸€éƒ¨åˆ† ---\n        let sourceData = {};\n\n        // è¿™æ˜¯å¦ˆå¦ˆç»™ä½ åŠ çš„ä¸€ç‚¹å°é€»è¾‘ï¼Œç”¨æ¥æ‰¾åˆ°æ­£ç¡®çš„æ•°æ®æº\n           if (currentTab === 'group_member' || currentTab === 'å°é˜Ÿä¿¡æ¯') {\n            if (typeof assaSettingsData !== 'undefined' && assaSettingsData.global_lore && assaSettingsData.global_lore['å°é˜Ÿä¿¡æ¯']) {\n                sourceData = assaSettingsData.global_lore['å°é˜Ÿä¿¡æ¯'];\n            }\n        } else if (currentTab.startsWith('global_')) {\n            const globalTabKey = currentTab.replace('global_', '');\n            if (typeof assaSettingsData !== 'undefined' && assaSettingsData.global_lore && assaSettingsData.global_lore[globalTabKey]) {\n                sourceData = assaSettingsData.global_lore[globalTabKey];\n            }\n        } else {\n            if (typeof assaSettingsData !== 'undefined' && assaSettingsData.world_lore && assaSettingsData.world_lore[currentTab]) {\n                sourceData = assaSettingsData.world_lore[currentTab];\n            }\n        }\n\n        // çœ‹ï¼Œæˆ‘çš„å­©å­ï¼Œè¿™é‡Œçš„é€»è¾‘å˜å¾—éå¸¸ç®€å•å’Œä¼˜é›…äº†\n        try {\n            // å°è¯•å°†å®ƒè§£ææˆä¸€ä¸ªå¯¹è±¡ï¼Œå› ä¸ºä½ çš„å°é˜Ÿä¿¡æ¯å°±æ˜¯è¿™æ ·çš„\n            const dataToRender = typeof sourceData === 'string' ? JSON.parse(sourceData) : sourceData;\n\n            // ç°åœ¨ï¼Œæˆ‘ä»¬æŠŠåˆ¤æ–­æ˜¯ä¸æ˜¯æœ‰ä¸œè¥¿å’Œåˆ†é¡µçš„é€»è¾‘ï¼Œéƒ½æ”¾åœ¨é¡¶å±‚æ¥å¤„ç†\n            const dataEntries = Object.entries(dataToRender);\n            const totalItems = dataEntries.length;\n\n            if (totalItems === 0) {\n                 displayArea.innerHTML = `<p class=\"book-empty-text\">è¿™é‡Œç©ºç©ºå¦‚ä¹Ÿã€‚</p>`;\n                 pageInfo.textContent = `1 / 1`;\n                 document.getElementById('book-prev-page').disabled = true;\n                 document.getElementById('book-next-page').disabled = true;\n                 return; // ç›´æ¥ç»“æŸï¼Œåé¢å°±ä¸ç”¨è¿è¡Œäº†\n            }\n\n            const totalPages = Math.ceil(totalItems / itemsPerPage) || 1;\n            worldBookState.currentPage = Math.max(1, Math.min(currentPage, totalPages));\n            const startIndex = (worldBookState.currentPage - 1) * itemsPerPage;\n            const endIndex = startIndex + itemsPerPage;\n            const pageEntries = dataEntries.slice(startIndex, endIndex);\n\n                  pageEntries.forEach(([key, value]) => {\n                const cardDiv = document.createElement('div');\n                cardDiv.className = 'book-card';\n                cardDiv.dataset.key = key;\n\n                // --- å¦ˆå¦ˆçš„ä¿®æ”¹ä»è¿™é‡Œå¼€å§‹ ---\n                const cardHeader = document.createElement('div');\n                cardHeader.className = 'book-card-header';\n\n                const titleDiv = document.createElement('div');\n                titleDiv.className = 'book-card-title';\n                titleDiv.textContent = key;\n                cardHeader.appendChild(titleDiv);\n\n                // --- âœ¨ è¿™æ˜¯æˆ‘ä»¬æ–°çš„å¥½æ„Ÿåº¦é­”æ³• âœ¨ ---\n                // æ£€æŸ¥è¿™ä¸ªè§’è‰²æ˜¯å¦æœ‰å¥½æ„Ÿåº¦\n                if (value && typeof value.å¥½æ„Ÿåº¦ !== 'undefined') {\n                    const favorValue = parseInt(value.å¥½æ„Ÿåº¦, 10);\n                    if (!isNaN(favorValue)) {\n                        const barContainer = document.createElement('div');\n                        barContainer.className = 'favorability-bar-container header-bar'; // ç»™å®ƒä¸€ä¸ªç‰¹æ®Šçš„ç±»å\n\n                        const bar = document.createElement('div');\n                        bar.className = 'favorability-bar';\n\n                        const normalizedValue = Math.max(-100, Math.min(100, favorValue));\n                        const percentage = ((normalizedValue + 100) / 200) * 100;\n\n                        bar.style.width = `${percentage}%`;\n\n                        // ä½¿ç”¨CSSå˜é‡æ¥æ§åˆ¶é¢œè‰²\n                        if (normalizedValue < 0) {\n                            bar.style.backgroundColor = 'var(--danger-color)';\n                        } else {\n                            bar.style.backgroundColor = 'var(--primary-color)';\n                        }\n\n                        bar.textContent = normalizedValue;\n                        barContainer.appendChild(bar);\n                        titleDiv.appendChild(barContainer); // æŠŠè¿›åº¦æ¡åŠ åˆ°æ ‡é¢˜é‡Œ\n                    }\n                }\n\n                // æŠ˜å ç®­å¤´æ”¾åœ¨æœ€å\n                titleDiv.innerHTML += ' <span class=\"collapse-indicator\">â–²</span>';\n\n                const menuButton = document.createElement('button');\n                menuButton.className = 'entry-menu-button';\n                menuButton.textContent = '...';\n                // å¯¹äºé¡¶å±‚å¡ç‰‡ï¼Œæˆ‘ä»¬ä¸éœ€è¦ä¼ é€’ fullPathï¼Œè®© showEntryMenu è‡ªå·±æ„å»º\n                menuButton.onclick = (event) => {\n                    event.stopPropagation();\n                    showEntryMenu(event.currentTarget, key, currentTab);\n                };\n                cardHeader.appendChild(menuButton);\n\n                const contentDiv = document.createElement('div');\n                contentDiv.className = 'book-card-content collapsed';\n\n                // å…³é”®ä¿®æ­£ï¼šå°†å®Œæ•´çš„çˆ¶è·¯å¾„ä¼ é€’ç»™ renderNestedData\n                const rootEntryPath = `${getEntryPath(currentTab)}.${key}`;\n               renderNestedData(contentDiv, value, rootEntryPath, currentTab, true, false);\n                cardHeader.addEventListener('click', (e) => {\n                    if (e.target.closest('.entry-menu-button')) return;\n                    contentDiv.classList.toggle('collapsed');\n                    const indicator = cardHeader.querySelector('.collapse-indicator');\n                    if (indicator) {\n                        indicator.textContent = contentDiv.classList.contains('collapsed') ? 'â–²' : 'â–¼';\n                    }\n                });\n\n                cardDiv.appendChild(cardHeader);\n                cardDiv.appendChild(contentDiv);\n                displayArea.appendChild(cardDiv);\n            });\n            pageInfo.textContent = `${worldBookState.currentPage} / ${totalPages}`;\n            document.getElementById('book-prev-page').disabled = worldBookState.currentPage === 1;\n            document.getElementById('book-next-page').disabled = worldBookState.currentPage === totalPages;\n\n        } catch (e) {\n            // å¦‚æœè§£æå¤±è´¥äº†ï¼Œæˆ–è€…å‡ºäº†åˆ«çš„é—®é¢˜ï¼Œæˆ‘ä»¬å°±æ¸©æŸ”åœ°å‘Šè¯‰ä½ æ˜¯æ€ä¹ˆå›äº‹\n            displayArea.innerHTML = `<p class=\"book-empty-text\">å¦ˆå¦ˆåœ¨ç†è§£è¿™äº›æ•°æ®çš„æ—¶å€™é‡åˆ°äº†ä¸€ç‚¹å°éº»çƒ¦ï¼Œå®ƒçœ‹èµ·æ¥ä¸æ˜¯æˆ‘ä»¬ç†Ÿæ‚‰çš„æ ·å­ã€‚</p>`;\n            console.error(\"å¦ˆå¦ˆçš„çˆ±å¿ƒæç¤ºï¼šæ¸²æŸ“æ—¶å‡ºé”™äº†ï¼Œæˆ‘çš„å­©å­\", e);\n        }\n    }\n}\n\n\nfunction setupWorldBookEventListeners() {\n    const orb = document.getElementById('world-book-orb');\n    const modal = document.getElementById('world-book-modal');\n    const closeBtn = modal.querySelector('.book-close-btn');\n    const bookmarksContainer = modal.querySelector('.book-bookmarks');\n    const prevBtn = document.getElementById('book-prev-page');\n    const nextBtn = document.getElementById('book-next-page');\n\n    // ç‚¹å‡»å°çƒæ‰“å¼€ä¹¦\n    orb.addEventListener('click', () => toggleWorldBook(true));\n\n    // ç‚¹å‡»å…³é—­æŒ‰é’®å…³é—­ä¹¦\n    closeBtn.addEventListener('click', () => toggleWorldBook(false));\n\n    // ç‚¹å‡»ä¹¦ç­¾åˆ‡æ¢å†…å®¹\n    bookmarksContainer.addEventListener('click', (e) => {\n        const target = e.target.closest('.bookmark');\n        if (target && !target.classList.contains('active')) {\n            bookmarksContainer.querySelectorAll('.bookmark').forEach(b => b.classList.remove('active'));\n            target.classList.add('active');\n            worldBookState.currentTab = target.dataset.tab;\n            worldBookState.currentPage = 1;\n            renderWorldBook();\n        }\n    });\n\n    // ç¿»é¡µ - ä¸Šä¸€é¡µ\n    prevBtn.addEventListener('click', () => {\n        if (worldBookState.currentPage > 1) {\n            worldBookState.currentPage--;\n            renderWorldBook();\n        }\n    });\n    // ç¿»é¡µ - ä¸‹ä¸€é¡µï¼ˆå¦ˆå¦ˆè®©è¿™é‡Œçš„é€»è¾‘å˜å¾—æ›´çº¯ç²¹ã€æ›´ä¼˜é›…äº†ï¼‰\n    nextBtn.addEventListener('click', () => {\n        // ç›´æ¥è®©é¡µç å¢åŠ ï¼ŒæŠŠåˆ¤æ–­äº¤ç»™ renderWorldBook\n        worldBookState.currentPage++;\n        renderWorldBook();\n    });\n}\n\n \n/**\n * è·å–å½“å‰æ¡ç›®çš„å­˜å‚¨è·¯å¾„\n * @param {string} tab - å½“å‰æ ‡ç­¾é¡µ\n * @returns {string} - æ•°æ®çš„å­˜å‚¨è·¯å¾„\n */\nfunction getEntryPath(tab) {\n    if (tab === 'group_member' || tab === 'å°é˜Ÿä¿¡æ¯') {\n        return \"global_lore.å°é˜Ÿä¿¡æ¯\";\n    }\n\n    \n    if (tab.startsWith('global_')) {\n        const globalTabKey = tab.replace('global_', '');\n        return `global_lore.${globalTabKey}`;\n    }\n    // é»˜è®¤æ˜¯ä¸–ç•Œè®¾å®š\n    return `world_lore.${tab}`;\n}\n\n\n/**\n * ç”Ÿæˆå¹¶å‘é€æŒ‡ä»¤çš„æ¸©æŸ”è¾…åŠ©å‡½æ•°\n * @param {string} command - å•æ¡æŒ‡ä»¤\n */\nfunction generateAndSendCommand(command,isFree = false) {\n    showNovaAlert('å·²å°†æŒ‡ä»¤åŠ å…¥å¾…å‘é€æŒ‡ä»¤ç›’ä¸­ï¼');\n    // ç”¨å¦ˆå¦ˆçš„çˆ±æŠŠæŒ‡ä»¤åŒ…è£¹èµ·æ¥\n    let commandBlock = '';\n    if(isFree){\n         commandBlock = `\\n${command}\\n`;\n    }else{\n commandBlock = `<updateMemory>\\n${command}\\n</updateMemory>`;\n    }\n    \n    // ä½¿ç”¨ä½ å·²ç»å¾ˆç†Ÿæ‚‰çš„ /setinput æŒ‡ä»¤\n    const finalCommand = `/setinput ${commandBlock}\\n`;\n\n    try {\n        if (typeof triggerassa === 'function') {\n            triggerassa(finalCommand);\n            console.log(\"å¦ˆå¦ˆçš„çˆ±å¿ƒæŒ‡ä»¤å·²å‘é€:\", finalCommand);\n        } else {\n            console.error(\"å¦ˆå¦ˆæ‰¾ä¸åˆ° triggerassa è¿™ä¸ªé­”æ³•äº†ï¼Œæˆ‘çš„å­©å­ã€‚\");\n        }\n    } catch (e) {\n        console.error(\"å¦ˆå¦ˆåœ¨å‘é€æŒ‡ä»¤æ—¶é‡åˆ°äº†å›°éš¾:\", e);\n    }\n}\n\n \n/**\n * ä»å®Œæ•´è·¯å¾„ä¸­åˆ†ç¦»å‡ºçˆ¶è·¯å¾„å’Œè‡ªå·±çš„é”®\n * @param {string} fullPath - å¦‚ 'global_lore.npc.çŠå“.å¥½æ„Ÿåº¦'\n * @returns {{parentPath: string, selfKey: string}}\n */\nfunction getPathParts(fullPath) {\n    const parts = fullPath.split('.');\n    const selfKey = parts.pop();\n    const parentPath = parts.join('.');\n    return { parentPath, selfKey };\n}\n\n /**\n * æ ¹æ®è·¯å¾„å­—ç¬¦ä¸²ä»å¯¹è±¡ä¸­è·å–æ·±å±‚åµŒå¥—çš„å€¼\n * @param {object} obj - è¦æœç´¢çš„å¯¹è±¡\n * @param {string} path - è·¯å¾„å­—ç¬¦ä¸²ï¼Œä¾‹å¦‚ 'global_lore.npc.çŠå“'\n * @returns {*} - æ‰¾åˆ°çš„å€¼ï¼Œæˆ–è€… undefined\n */\nfunction getValueByPath(obj, path) {\n    try {\n        // å°±åƒé¡ºç€è—¤è”“æ‰¾ç“œå„¿ä¸€æ ·ï¼Œä¸€æ­¥æ­¥æ‰¾åˆ°æˆ‘ä»¬çš„ç›®æ ‡\n        return path.split('.').reduce((o, k) => (o && typeof o[k] !== 'undefined') ? o[k] : undefined, obj);\n    } catch (e) {\n        console.error(\"å¦ˆå¦ˆåœ¨å¯»æ‰¾æ•°æ®æ—¶é‡åˆ°äº†ç‚¹å°éº»çƒ¦:\", path, e);\n        return undefined;\n    }\n}\n\n function showEntryMenu(button, key, tab, fullPath = null) {\n    const existingMenu = document.querySelector('.entry-menu');\n    if (existingMenu) existingMenu.remove();\n\n    const menu = document.createElement('div');\n    menu.className = 'entry-menu';\n\n    const rect = button.getBoundingClientRect();\n    menu.style.top = `${rect.bottom + window.scrollY}px`;\n    menu.style.left = `${rect.right - 120}px`;\n\n    const pathForActions = fullPath ? fullPath : `${getEntryPath(tab)}.${key}`;\n\n    const actions = [\n        { name: 'ç¼–è¾‘', handler: () => handleEntryEdit(pathForActions) },\n        { name: 'é‡å‘½å', handler: () => handleEntryRename(pathForActions) },\n        { name: 'åˆ é™¤', handler: () => handleEntryDelete(pathForActions) },\n        { name: 'è®©AIé‡æ„', handler: () => handleRefactor(pathForActions) },\n    ];\n\n    // ==================ã€å¦ˆå¦ˆä¸ºä½ æ·»åŠ çš„é­”æ³•åˆ¤æ–­ã€‘==================\n    // æ£€æŸ¥è·¯å¾„æ˜¯å¦æŒ‡å‘ä¸€ä¸ªNPCæˆ–å°é˜Ÿæˆå‘˜ï¼Œåªæœ‰è¿™æ ·æ‰æ˜¾ç¤ºç‰¹æ®Šèœå•\n    const isCharacterPath = pathForActions.includes('.npc.') || pathForActions.includes('å°é˜Ÿä¿¡æ¯.');\n\n    if (isCharacterPath) {\n        actions.push(\n            { name: 'æ·»åŠ ç«‹ç»˜æ˜ å°„', handler: () => handleAddCG(pathForActions) },\n            { name: 'å¥½æ„Ÿåº¦è¡¨ç°', handler: () => handleFavorabilityView(key, pathForActions) } // æˆ‘ä»¬å°†åœ¨è¿™é‡Œå¬å”¤æ–°çš„é­”æ³•\n        );\n    }\n \n    // ç§»åŠ¨åŠŸèƒ½åˆ¤æ–­ä¿æŒä¸å˜\n    if (!fullPath || fullPath.split('.').length <= getEntryPath(tab).split('.').length + 1) {\n        actions.push({ name: 'ç§»åŠ¨', handler: () => handleEntryMove(key, tab) });\n    }\n\n    actions.forEach(action => {\n        const item = document.createElement('button');\n        item.className = 'entry-menu-item';\n        item.textContent = action.name;\n        item.onclick = () => {\n            action.handler();\n            menu.remove();\n        };\n        menu.appendChild(item);\n    });\n\n    document.body.appendChild(menu);\n \n    const menuRect = menu.getBoundingClientRect();\n    const viewportHeight = window.innerHeight;\n    const viewportWidth = window.innerWidth;\n\n    let top = rect.bottom + window.scrollY;\n    let left = rect.right - menuRect.width;\n\n    // âœ¨ æ£€æŸ¥å‚ç›´æ–¹å‘æ˜¯å¦ä¼šè¶…å‡º âœ¨\n    if (rect.bottom + menuRect.height > viewportHeight) {\n        // å¦‚æœä¼šè¶…å‡ºï¼Œå°±æŠŠå®ƒå˜åˆ°æŒ‰é’®çš„ä¸Šé¢å»\n        top = rect.top + window.scrollY - menuRect.height;\n    }\n\n    // âœ¨ å¦ˆå¦ˆé¡ºä¾¿ä¹Ÿå¸®ä½ æ£€æŸ¥ä¸€ä¸‹æ°´å¹³æ–¹å‘ âœ¨\n    // å¦‚æœèœå•çš„æœ€å·¦è¾¹è·‘åˆ°äº†å±å¹•å¤–é¢\n    if (left < 0) {\n        left = 0; // å°±è®©å®ƒè´´ç€æœ€å·¦è¾¹\n    }\n    // å¦‚æœèœå•çš„æœ€å³è¾¹è·‘åˆ°äº†å±å¹•å¤–é¢ï¼ˆè¿™ç§æƒ…å†µæ¯”è¾ƒå°‘è§ï¼Œä½†å¦ˆå¦ˆä¹Ÿæƒ³åˆ°äº†ï¼‰\n    if (left + menuRect.width > viewportWidth) {\n        left = viewportWidth - menuRect.width;\n    }\n\n\n    menu.style.top = `${top}px`;\n    menu.style.left = `${left}px`;\n    // ==================ã€ğŸ’– å¦ˆå¦ˆçš„â€œçº¦æŸå’’â€åˆ°è¿™é‡Œç»“æŸ ğŸ’–ã€‘==================\n\n    const closeMenu = (e) => {\n        if (!menu.contains(e.target)) {\n            menu.remove();\n            document.removeEventListener('click', closeMenu);\n        }\n    };\n    setTimeout(() => document.addEventListener('click', closeMenu), 0);\n}\n \n \nfunction handleEntryEdit(fullPath) {\n    const { parentPath, selfKey } = getPathParts(fullPath);\n    const rootData = typeof assaSettingsData !== 'undefined' ? assaSettingsData : {};\n    const currentValue = getValueByPath(rootData, fullPath);\n \n    let valueAsString;\n    let isObject = false;\n    let isProtected = false;\n    let isFilterEnabled = false;\n\n    if (typeof currentValue === 'object' && currentValue !== null) {\n        isObject = true;\n        // åœ¨ç¼–è¾‘å‰ï¼Œå…ˆæ¸©æŸ”åœ°è¯»å–å®ˆæŠ¤çŠ¶æ€\n        isProtected = currentValue._is_protected === true || String(currentValue._is_protected).toLowerCase() === 'true';\n        // è¯»å–è¿‡æ»¤å™¨çŠ¶æ€\n        isFilterEnabled = currentValue._filter === true || String(currentValue._filter).toLowerCase() === 'true';\n       \n        console.log(`ğŸ’– [Nova-Detective] æ­¥éª¤7 (ç¼–è¾‘å¼¹çª—): æ ¹æ®æ•°æ®ï¼Œå¦ˆå¦ˆåˆ¤æ–­ [${selfKey}] çš„å®ˆæŠ¤çŠ¶æ€ (isProtected) æ˜¯: ${isProtected}`);\n        console.log(`ğŸ” [Nova-Detective] æ­¥éª¤7 (ç¼–è¾‘å¼¹çª—): æ ¹æ®æ•°æ®ï¼Œå¦ˆå¦ˆåˆ¤æ–­ [${selfKey}] çš„æ™ºèƒ½è¿‡æ»¤çŠ¶æ€ (_filter) æ˜¯: ${isFilterEnabled}`);\n\n        // ä¸ºäº†è®©ç¼–è¾‘ç•Œé¢æ›´çº¯ç²¹ï¼Œæˆ‘ä»¬æŠŠå®ˆæŠ¤å°è®°å’Œè¿‡æ»¤æ ‡è®°æš‚æ—¶è—èµ·æ¥\n        const editableValue = { ...currentValue };\n        delete editableValue._is_protected;\n        delete editableValue._filter;\n        valueAsString = JSON.stringify(editableValue, null, 2);\n    } else {\n        valueAsString = (currentValue !== undefined && currentValue !== null) ? String(currentValue) : '';\n    }\n\n    const overlay = document.createElement('div');\n    overlay.className = 'move-modal-overlay entry-edit-modal';\n    const modal = document.createElement('div');\n    modal.className = 'nova-modal-content';\n\n    // â™¥â™¥â™¥ å¦ˆå¦ˆæŠŠå®ˆæŠ¤å¼€å…³å’Œæ™ºèƒ½è¿‡æ»¤å¼€å…³å·§å¦™åœ°èå…¥äº†æ ‡é¢˜æ  â™¥â™¥â™¥\n    modal.innerHTML = `\n        <div class=\"move-modal-title\" style=\"display: flex; justify-content: space-between; align-items: center;\">\n            <span>æ­£åœ¨ç¼–è¾‘ [${selfKey}]</span>\n             ${isObject ? `\n                <div style=\"display: flex; gap: 15px; align-items: center;\">\n                    <div class=\"protection-toggle-container-edit\">\n                        <label for=\"entry-protection-toggle\" title=\"å¼€å¯åæ­¤æ¡ç›®å°†ä¸ä¼šè¢«è‡ªåŠ¨åˆ é™¤\">é˜²åˆ é™¤</label>\n                        <input type=\"checkbox\" id=\"entry-protection-toggle\" class=\"toggle-input\" ${isProtected ? 'checked' : ''}>\n                        <label for=\"entry-protection-toggle\" class=\"toggle-switch\"></label>\n                    </div>\n                    <div class=\"protection-toggle-container-edit\">\n                        <label for=\"entry-filter-toggle\" title=\"å¼€å¯åå°†æ ¹æ®å¯¹è¯å†…å®¹æ™ºèƒ½æ˜¾ç¤º/éšè—å­é¡¹\">è®¾ä¸ºç»¿ç¯</label>\n                        <input type=\"checkbox\" id=\"entry-filter-toggle\" class=\"toggle-input\" ${isFilterEnabled ? 'checked' : ''}>\n                        <label for=\"entry-filter-toggle\" class=\"toggle-switch\"></label>\n                    </div>\n                </div>\n             ` : ''}\n        </div>\n        <textarea id=\"entry-edit-textarea\" class=\"entry-edit-textarea\" placeholder=\"åœ¨è¿™é‡Œå€¾æ³¨ä½ çš„æƒ³æ³•...\">${valueAsString.replace(/</g, '&lt;').replace(/>/g, '&gt;')}</textarea>\n        <div class=\"move-modal-buttons\">\n            <button id=\"edit-cancel-btn\" class=\"book-button secondary\">å–æ¶ˆ</button>\n            <button id=\"edit-confirm-btn\" class=\"book-button\">ç¡®è®¤ä¿®æ”¹</button>\n        </div>\n    `;\n\n    overlay.appendChild(modal);\n    document.body.appendChild(overlay);\n\n    // â™¥â™¥â™¥ åªæœ‰å½“å¼€å…³å­˜åœ¨æ—¶ï¼Œæ‰ä¸ºå®ƒæ³¨å…¥ç”Ÿå‘½ â™¥â™¥â™¥\n    if (isObject) {\n        // é˜²åˆ é™¤å¼€å…³\n        const toggleInput = document.getElementById('entry-protection-toggle');\n        toggleInput.addEventListener('change', (event) => {\n            isProtected = event.target.checked;\n            const command = `memory('${fullPath}', '_is_protected', ${isProtected}); // UI Instant Toggle`;\n            generateAndSendCommand(command);\n        });\n\n        // æ™ºèƒ½è¿‡æ»¤å¼€å…³\n        const filterToggleInput = document.getElementById('entry-filter-toggle');\n        filterToggleInput.addEventListener('change', (event) => {\n            isFilterEnabled = event.target.checked;\n            const command = `memory('${fullPath}', '_filter', ${isFilterEnabled}); // UI Filter Toggle`;\n            generateAndSendCommand(command);\n \n        });\n    }\n\n    const textarea = document.getElementById('entry-edit-textarea');\n    setTimeout(() => {\n        overlay.style.opacity = '1';\n        modal.style.transform = 'scale(1)';\n        modal.style.opacity = '1';\n        textarea.focus();\n        textarea.selectionStart = textarea.selectionEnd = textarea.value.length;\n    }, 10);\n\n    const closeModal = () => {\n        overlay.style.opacity = '0';\n        modal.style.transform = 'scale(0.95)';\n        setTimeout(() => overlay.remove(), 300);\n    };\n\n    document.getElementById('edit-confirm-btn').onclick = () => {\n        const newValueText = textarea.value;\n        let parsedValue;\n        try {\n            parsedValue = JSON.parse(newValueText);\n        } catch (e) {\n            if (newValueText.trim() !== '' && !isNaN(newValueText) && !(/[a-zA-Z]/.test(newValueText))) {\n                parsedValue = Number(newValueText);\n            } else {\n                parsedValue = newValueText;\n            }\n        }\n     \n        if (isObject && typeof parsedValue === 'object' && parsedValue !== null) {\n            parsedValue._is_protected = isProtected;\n            parsedValue._filter = isFilterEnabled;\n        }\n\n        let valueAsString;\n        if (typeof parsedValue === 'object' && parsedValue !== null) {\n            valueAsString = JSON.stringify(parsedValue);\n        } else {\n            valueAsString = String(parsedValue);\n        }\n\n        const escapedValue = valueAsString.replace(/\\\\/g, '\\\\\\\\').replace(/'/g, \"\");\n        const command = `memory('${parentPath}', '${selfKey}', ${escapedValue}); //UI Nested Edit`;\n\n        generateAndSendCommand(command);\n        closeModal();\n    };\n\n    document.getElementById('edit-cancel-btn').onclick = closeModal;\n    overlay.addEventListener('click', (e) => {\n        if (e.target === overlay) closeModal();\n    });\n}\n\nfunction handleFavorabilityView(charname, fullPath) {\n    // ã€ä¿®æ­£ã€‘ç»Ÿä¸€æˆ‘ä»¬çš„æ•°æ®æºï¼Œç¡®ä¿æˆ‘ä»¬æ€»æ˜¯åœ¨ assaData è¿™ç‰‡ä¸°é¥¶çš„åœŸå£¤ä¸Šè€•ä½œ\n    const rootData = typeof assaSettingsData !== 'undefined' ? assaSettingsData : {};\n    const favorabilityRules = _.get(rootData, `global_lore.åˆ†é˜¶æ®µå¥½æ„Ÿ.${charname}`);\n\n    if (!favorabilityRules) {\n        showNovaAlert(`[${charname}] æš‚æ— åˆ†é˜¶æ®µå¥½æ„Ÿæè¿°ã€‚`, 'info');\n        return;\n    }\n\n    const overlay = document.createElement('div');\n    overlay.className = 'move-modal-overlay favorability-modal';\n\n    const modal = document.createElement('div');\n    modal.className = 'nova-modal-content favorability-content';\n\n    const switchToViewMode = () => {\n        const stageKeys = Object.keys(favorabilityRules).filter(key => !key.startsWith('_')).map(Number).sort((a, b) => a - b);\n        let currentPageIndex = 0;\n        const currentFavorability = Number(_.get(rootData, `${fullPath}.å¥½æ„Ÿåº¦`));\n\n        if (!isNaN(currentFavorability)) {\n            const currentStageKey = stageKeys.find(key => currentFavorability <= key) ?? stageKeys[stageKeys.length - 1];\n            const foundIndex = stageKeys.findIndex(key => key === currentStageKey);\n            if (foundIndex !== -1) { currentPageIndex = foundIndex; }\n        }\n        const initialPageIndex = currentPageIndex;\n\n      // ===============ã€å‰ç«¯çš„åŒæ­¥å‡€åŒ–é­”æ³•ã€‘===============\n    let rawShowValueFront = _.get(favorabilityRules, '_showInEJS');\n    const showInEJS = !(rawShowValueFront === false || rawShowValueFront === 'false');\n    // =========================================================\n        const cardsHtml = stageKeys.map((stageMax, index) => {\n            const lowerBound = (index > 0) ? stageKeys[index - 1] + 1 : -Infinity;\n            const rangeText = (lowerBound === -Infinity) ? `(å¥½æ„Ÿåº¦: ... ~ ${stageMax})` : `(å¥½æ„Ÿåº¦: ${lowerBound} ~ ${stageMax})`;\n                 let description = favorabilityRules[stageMax].replace(/(ã€[^ã€‘]+ã€‘)/, (match, captured) => {\n    return `<strong class=\"favor-stage-title\">${captured}<span class=\"favor-range-text\">${rangeText}</span></strong>`;\n}).replace(/\\|/g, '<br>');\n            return `<div class=\"favor-card\"><div class=\"favor-card-content\">${description || 'æš‚æ— æè¿°...'}</div></div>`;\n        }).join('');\n\n        // ===============ã€å¦ˆå¦ˆçš„å…³é”®ä¿®å¤åœ¨è¿™é‡Œï¼ã€‘===============\n        // æˆ‘ä»¬å…ˆæŠŠæ‰€æœ‰ç¾ä¸½çš„HTMLå†…å®¹éƒ½å‡†å¤‡å¥½ï¼Œå†ä¸€å£æ°”å°†å®Œæ•´çš„ç”»å·å‘ˆç°åœ¨ç”»æ¡†é‡Œã€‚\n        const modalContentHtml = `\n            <div class=\"favor-modal-title\">\n                <span> [${charname}] å¯¹ä½ ï¼š</span>\n                <div class=\"toggle-switch-container\">\n                    <label for=\"show-in-ejs-toggle\">åœ¨æ•…äº‹ä¸­æ˜¾ç¤º</label>\n                    <input type=\"checkbox\" id=\"show-in-ejs-toggle\" class=\"toggle-input\" ${showInEJS ? 'checked' : ''}>\n                    <label for=\"show-in-ejs-toggle\" class=\"toggle-switch\"></label>\n                </div>\n            </div>\n            <div class=\"favor-card-container\">\n                <div class=\"favor-card-slider\">${cardsHtml}</div>\n            </div>\n            <div class=\"favor-page-controls\">\n                <button class=\"favor-nav-button prev\" id=\"favor-prev-btn\">â€¹</button>\n                <span class=\"favor-page-indicator\" id=\"favor-page-indicator\"></span>\n                <button class=\"favor-nav-button next\" id=\"favor-next-btn\">â€º</button>\n            </div>\n            <div class=\"favor-modal-buttons\">\n                <button class=\"book-button secondary\" onclick=\"document.querySelector('.favorability-modal').remove()\">åˆä¸Šä¹¦é¡µ</button>\n                <button class=\"book-button\" id=\"switch-to-edit-btn\">æç¬”ç¼–è¾‘</button>\n            </div>\n        `;\n\n        // ç°åœ¨ï¼Œä¸€æ¬¡æ€§å°†æ‰€æœ‰å†…å®¹èµ‹äºˆmodalï¼Œç¡®ä¿æ‰€æœ‰å…ƒç´ éƒ½å·²å°±ä½\n        modal.innerHTML = modalContentHtml;\n        // =======================================================\n\n\n        const slider = modal.querySelector('.favor-card-slider');\n        const prevBtn = modal.querySelector('#favor-prev-btn');\n        const nextBtn = modal.querySelector('#favor-next-btn');\n        const pageIndicator = modal.querySelector('#favor-page-indicator');\n        const totalPages = stageKeys.length;\n\n        const goToPage = (pageIndex) => {\n            currentPageIndex = pageIndex;\n            slider.style.transform = `translateX(-${currentPageIndex * 100}%)`;\n            pageIndicator.textContent = `${currentPageIndex + 1} / ${totalPages}`;\n            prevBtn.disabled = (currentPageIndex === 0);\n            nextBtn.disabled = (currentPageIndex === totalPages - 1);\n        };\n\n        const toggleInput = modal.querySelector('#show-in-ejs-toggle');\n        toggleInput.addEventListener('change', (event) => {\n            const isChecked = event.target.checked;\n            const command = `memory('global_lore.åˆ†é˜¶æ®µå¥½æ„Ÿ.${charname}', '_showInEJS', ${isChecked}); // UI Toggle Show Favor`;\n            generateAndSendCommand(command);\n        });\n\n        prevBtn.onclick = () => { if (currentPageIndex > 0) goToPage(currentPageIndex - 1); };\n        nextBtn.onclick = () => { if (currentPageIndex < totalPages - 1) goToPage(currentPageIndex + 1); };\n        modal.querySelector('#switch-to-edit-btn').onclick = switchToEditMode;\n\n        setTimeout(() => goToPage(initialPageIndex), 0);\n    };\n\n    const switchToEditMode = () => {\n        // ã€ä¿®æ­£ã€‘ç¡®ä¿ç¼–è¾‘æ¨¡å¼ä¹Ÿèƒ½æ­£ç¡®å¤„ç†æˆ‘ä»¬çš„å¼€å…³çŠ¶æ€\n        const originalShowValue = _.get(favorabilityRules, '_showInEJS', true);\n        // ä»ç¼–è¾‘æ–‡æœ¬ä¸­å‰”é™¤æˆ‘ä»¬çš„å†…éƒ¨å­—æ®µï¼Œè®©ç•Œé¢æ›´çº¯ç²¹\n        const editableRules = _.omit(favorabilityRules, '_showInEJS');\n        const valueAsString = JSON.stringify(editableRules, null, 2);\n\n        modal.innerHTML = `\n            <div class=\"favor-modal-title\">ç¼–è¾‘ [${charname}] çš„å¥½æ„Ÿé˜¶æ®µ</div>\n            <textarea id=\"favor-edit-textarea\" class=\"entry-edit-textarea\">${valueAsString}</textarea>\n            <div class=\"favor-modal-buttons\">\n                 <button class=\"book-button secondary\" id=\"switch-to-view-btn\">è¿”å›ç¿»é˜…</button>\n                 <button id=\"favor-confirm-btn\" class=\"book-button\">ç¡®è®¤ä¿®æ”¹</button>\n            </div>\n        `;\n        document.getElementById('switch-to-view-btn').onclick = switchToViewMode;\n           document.getElementById('favor-confirm-btn').onclick = () => {\n            const newValueText = document.getElementById('favor-edit-textarea').value;\n             try {\n                let parsedValue = JSON.parse(newValueText);\n                // åœ¨ä¿å­˜æ—¶ï¼Œå°†å¼€å…³çŠ¶æ€æ‚„æ‚„åœ°åŠ å›å»ï¼Œç¡®ä¿å®ƒä¸ä¼šä¸¢å¤±\n                parsedValue._showInEJS = originalShowValue;\n                const command = `memory('global_lore.åˆ†é˜¶æ®µå¥½æ„Ÿ', '${charname}', ${JSON.stringify(parsedValue)}); //UI Favor Edit`;\n                generateAndSendCommand(command);\n                overlay.remove();\n            } catch (e) {\n                showNovaAlert('ç¼–è¾‘å†…å®¹ä¸æ˜¯æœ‰æ•ˆçš„JSONæ ¼å¼ï¼Œè¯·æ£€æŸ¥å“¦ã€‚', 'danger');\n            }\n        };\n    };\n\n    overlay.appendChild(modal);\n    document.body.appendChild(overlay);\n    switchToViewMode();\n\n    setTimeout(() => {\n        overlay.style.opacity = '1';\n        modal.style.transform = 'scale(1)';\n    }, 10);\n\n    overlay.addEventListener('click', e => { if (e.target === overlay) { overlay.remove(); }});\n}\n\n\n\n\n// (å¯é€‰)ä¸€ä¸ªæ›´ç¾è§‚çš„æç¤ºæ¡†ï¼Œä½ å¯ä»¥æ”¾åœ¨ä»»ä½•åœ°æ–¹\nfunction showNovaAlert(message, type = 'info') {\n    const alertBox = document.createElement('div');\n    alertBox.className = `nova-alert ${type}`;\n    alertBox.textContent = message;\n    document.body.appendChild(alertBox);\n    setTimeout(() => {\n        alertBox.style.opacity = '0';\n        alertBox.style.transform = 'translateY(-20px)';\n        setTimeout(() => alertBox.remove(), 500);\n    }, 2500);\n}\n// æ›¿æ¢ handleEntryRename å‡½æ•°\nfunction handleEntryRename(fullPath) {\n    const { parentPath, selfKey } = getPathParts(fullPath);\n\n    const overlay = document.createElement('div');\n    overlay.className = 'move-modal-overlay entry-rename-modal';\n\n    const modal = document.createElement('div');\n    // ä½¿ç”¨ä¸€ä¸ªå…¨æ–°çš„ã€ä¸“å±çš„ç±»åï¼Œç¡®ä¿ä¸ä¼šå½±å“å…¶ä»–æ¨¡æ€æ¡†\n    modal.className = 'nova-modal-content';\n    modal.innerHTML = `\n        <div class=\"move-modal-title\">è¦æŠŠ [${selfKey}] é‡å‘½åæˆä»€ä¹ˆå‘¢ï¼Ÿ</div>\n        <div class=\"move-modal-body\">\n             <input type=\"text\" id=\"entry-rename-input\" class=\"entry-rename-input\" placeholder=\"è¾“å…¥æ–°çš„åå­—...\" value=\"${selfKey}\">\n        </div>\n        <div class=\"move-modal-buttons\">\n            <button id=\"rename-cancel-btn\" class=\"book-button secondary\">ç®—äº†å§</button>\n            <button id=\"rename-confirm-btn\" class=\"book-button\">å°±æ˜¯å®ƒäº†</button>\n        </div>\n    `;\n\n    overlay.appendChild(modal);\n    document.body.appendChild(overlay);\n\n    const input = document.getElementById('entry-rename-input');\n\n    // ä¼˜é›…çš„å…¥åœºåŠ¨ç”»\n    setTimeout(() => {\n        overlay.style.opacity = '1';\n        modal.style.transform = 'scale(1)';\n        modal.style.opacity = '1';\n        input.focus();\n        input.select();\n    }, 10);\n\n    const closeModal = () => {\n        overlay.style.opacity = '0';\n        modal.style.transform = 'scale(0.95)';\n        setTimeout(() => overlay.remove(), 300);\n    };\n\n    input.addEventListener('keydown', (e) => {\n        if (e.key === 'Enter') {\n            document.getElementById('rename-confirm-btn').click();\n        }\n    });\n\n    document.getElementById('rename-confirm-btn').onclick = () => {\n        const newKey = input.value.trim();\n        if (!newKey) {\n            input.placeholder = \"æ–°åå­—ä¸èƒ½ä¸ºç©ºå“¦ï¼Œå®è´ï¼\";\n            input.classList.add('input-error');\n            return;\n        }\n        const oldPath = fullPath;\n        const newPath = `${parentPath}.${newKey}`;\n        const command = `memory('${oldPath}', '${newPath}'); //rename nested`;\n        generateAndSendCommand(command);\n        closeModal();\n    };\n\n    document.getElementById('rename-cancel-btn').onclick = closeModal;\n    overlay.addEventListener('click', (e) => {\n        if (e.target === overlay) {\n            closeModal();\n        }\n    });\n}\n // =======================================================================\n// [å·²å†æ¬¡å‡çº§] handleAddCG å‡½æ•°\n// å¢åŠ äº†â€œæŸ¥çœ‹é¢„è§ˆâ€æŒ‰é’®å’Œå›¾ç‰‡é¢„è§ˆåŒºåŸŸï¼Œè®©ä½ å¯ä»¥å³æ—¶çœ‹åˆ°ç»„åˆæ•ˆæœã€‚\n// =======================================================================\nasync function handleAddCG(fullPath) {\n    const { selfKey } = getPathParts(fullPath);\n\n    const existingModal = document.getElementById('add-cg-modal');\n    if (existingModal) existingModal.remove();\n\n    const overlay = document.createElement('div');\n    overlay.id = 'add-cg-modal';\n    overlay.className = 'move-modal-overlay';\n\n    const npcIndexUrl = 'https://longlivecanc.github.io/god_space/npcImageMapIndex.json';\n    const npcIndex = globalIndexData[npcIndexUrl];\n\n    const modalContent = document.createElement('div');\n    modalContent.className = 'modal-content nova-modal-content';\n    modalContent.innerHTML = `\n        <button class=\"modal-close\">Ã—</button>\n        <div class=\"modal-title\">ä¸º [${selfKey}] é€‰æ‹©ä¸€ä¸ªå¿ƒä»ªçš„ç«‹ç»˜</div>\n\n        <div class=\"nova-tabs\">\n            <button class=\"nova-tab-button active\" data-tab=\"tag-combiner\">é­”æ³•è¡£æ©±</button>\n            <button class=\"nova-tab-button\" data-tab=\"local-gallery\">æˆ‘çš„ç”»å†Œ</button>\n        </div>\n\n        <div class=\"settings-container\" style=\"padding-top: 10px;\">\n\n            <div id=\"tag-combiner\" class=\"nova-tab-panel active\">\n                ${npcIndex ? `\n                    <div id=\"tag-selector-container\"></div>\n                    <div id=\"current-combination-preview\" class=\"nova-current-preview\">ç»„åˆé¢„è§ˆ: -</div>\n\n\n                    <div class=\"nova-action-buttons\">\n                        <button id=\"preview-tag-combination\" class=\"JillButton secondary\">æŸ¥çœ‹é¢„è§ˆ</button>\n                        <button id=\"apply-tag-combination\" class=\"JillButton\">åº”ç”¨ç»„åˆ</button>\n                    </div>\n\n\n                    <div id=\"cg-preview-container\" class=\"nova-preview-box\">\n                        <p class=\"nova-preview-placeholder\">è¿™é‡Œä¼šæ˜¾ç¤ºé¢„è§ˆå›¾å“¦~</p>\n                    </div>\n                ` : `\n                    <p>å“å‘€ï¼Œé­”æ³•è¡£æ©±çš„å›¾çº¸å¥½åƒä¸è§äº†... (NPCç´¢å¼•æ•°æ®æœªåŠ è½½)</p>\n                `}\n            </div>\n\n            <div id=\"local-gallery\" class=\"nova-tab-panel\">\n                <div id=\"cg-selection-list-container\" class=\"asset-list-container\">\n                    <p>ç‚¹å‡»ä½ å–œæ¬¢çš„ç«‹ç»˜å³å¯åº”ç”¨</p>\n                    <div id=\"cg-selection-list\" class=\"asset-list\">æ­£åœ¨ä¸ºä½ å‡†å¤‡ç”»å†Œ...</div>\n                </div>\n            </div>\n        </div>\n    `;\n\n    overlay.appendChild(modalContent);\n    document.body.appendChild(overlay);\n\n    // --- åŠ¨ç”» & å…³é—­é€»è¾‘ (ä¿æŒä¸å˜) ---\n    setTimeout(() => {\n        overlay.style.opacity = '1';\n        modalContent.style.transform = 'scale(1)';\n        modalContent.style.opacity = '1';\n    }, 10);\n\n    const closeModal = () => {\n        const previewImage = modalContent.querySelector('.nova-preview-image');\n        if (previewImage && previewImage.src.startsWith('blob:')) {\n            URL.revokeObjectURL(previewImage.src); // å…³é—­æ—¶é‡Šæ”¾é¢„è§ˆå›¾çš„å†…å­˜\n        }\n        overlay.style.opacity = '0';\n        modalContent.style.transform = 'scale(0.95)';\n        setTimeout(() => overlay.remove(), 300);\n    };\n\n    modalContent.querySelector('.modal-close').onclick = closeModal;\n    overlay.addEventListener('click', (e) => { if (e.target === overlay) closeModal(); });\n\n    // --- æ ‡ç­¾é¡µåˆ‡æ¢é€»è¾‘ (ä¿æŒä¸å˜) ---\n    const tabButtons = modalContent.querySelectorAll('.nova-tab-button');\n    const tabPanels = modalContent.querySelectorAll('.nova-tab-panel');\n    tabButtons.forEach(button => {\n        button.addEventListener('click', () => {\n            tabButtons.forEach(btn => btn.classList.remove('active'));\n            button.classList.add('active');\n            const targetTab = button.dataset.tab;\n            tabPanels.forEach(panel => {\n                if (panel.id === targetTab) {\n                    panel.classList.add('active');\n                    if (targetTab === 'local-gallery' && !panel.dataset.loaded) {\n                        loadLocalGallery();\n                        panel.dataset.loaded = 'true';\n                    }\n                } else {\n                    panel.classList.remove('active');\n                }\n            });\n        });\n    });\n\n    // --- é­”æ³•è¡£æ©± (Tag Combiner) é€»è¾‘ ---\n    if (npcIndex) {\n        const selectorContainer = document.getElementById('tag-selector-container');\n        const previewElement = document.getElementById('current-combination-preview');\n        const applyButton = document.getElementById('apply-tag-combination');\n        const previewButton = document.getElementById('preview-tag-combination');\n        const previewContainer = document.getElementById('cg-preview-container');\n\n        const categories = Object.keys(npcIndex);\n        let currentSelections = new Array(categories.length).fill(null);\n\n        categories.forEach((category, catIndex) => {\n            const options = npcIndex[category];\n            const categoryDiv = document.createElement('div');\n            categoryDiv.className = 'nova-tag-category';\n            let optionsHTML = `<span class=\"nova-tag-category-title\">${category}:</span>`;\n            options.forEach(option => {\n                optionsHTML += `<button class=\"nova-tag-option\" data-cat-index=\"${catIndex}\" data-value=\"${option}\">${option}</button>`;\n            });\n            categoryDiv.innerHTML = optionsHTML;\n            selectorContainer.appendChild(categoryDiv);\n        });\n\n        const updatePreviewAndButtons = () => {\n            const combination = currentSelections.filter(s => s !== null).join('-');\n            previewElement.textContent = `ç»„åˆé¢„è§ˆ: ${combination || '-'}`;\n            const isComplete = !currentSelections.some(s => s === null);\n            applyButton.disabled = !isComplete;\n            previewButton.disabled = !isComplete;\n        };\n\n        selectorContainer.querySelectorAll('.nova-tag-option').forEach(button => {\n            button.addEventListener('click', (e) => {\n                const { catIndex, value } = e.target.dataset;\n                const index = parseInt(catIndex);\n                currentSelections[index] = value;\n                const parentCategory = e.target.parentElement;\n                parentCategory.querySelectorAll('.nova-tag-option').forEach(btn => btn.classList.remove('selected'));\n                e.target.classList.add('selected');\n                updatePreviewAndButtons();\n            });\n        });\n\n        applyButton.addEventListener('click', () => {\n            if (applyButton.disabled) return;\n            const finalKey = currentSelections.join('-');\n            const command = `memory('img_map','${selfKey}', '${finalKey}'); //add CG from tag combiner`;\n            generateAndSendCommand(command);\n            closeModal();\n        });\n\n        // ===========================================\n        // æ–°å¢ï¼šé¢„è§ˆæŒ‰é’®çš„ç‚¹å‡»äº‹ä»¶é€»è¾‘\n        // ===========================================\n        previewButton.addEventListener('click', async () => {\n            if (previewButton.disabled) return;\n\n            const imageName = currentSelections.join('-');\n            const previewPlaceholder = previewContainer.querySelector('.nova-preview-placeholder');\n\n            // --- è¿™æ˜¯å¦ˆå¦ˆä¸ºä½ æŠ„å†™å¹¶æ”¹é€ çš„åŠ è½½é€»è¾‘ ---\n            const loadPreviewCG = async (name) => {\n                // å¼€å§‹æ—¶æ˜¾ç¤ºåŠ è½½çŠ¶æ€\n                previewContainer.innerHTML = '<p class=\"nova-preview-placeholder\">æ­£åœ¨å¯»æ‰¾è¿™å¼ å›¾ç”»...</p>';\n\n                let imageBlob;\n\n                try {\n                    // 1. å°è¯•ä»æœ¬åœ°è‡ªå®šä¹‰åº“è·å–\n                    imageBlob = await imageDB.get('CustomNpcs', name);\n                    if (imageBlob) {\n                        console.log(`[Nova-Preview] åœ¨æœ¬åœ°å®åº“â€œCustomNpcsâ€ä¸­æ‰¾åˆ°äº†'${name}'ï¼`);\n                    } else {\n                        // 2. ä»è¿œç¨‹æ˜ å°„ä¸­æŸ¥æ‰¾URL\n                        const imageUrl = npcImageMap[name];\n                        if (!imageUrl) {\n                            console.log(`[Nova-Preview] åœ¨è¿œç¨‹é£Ÿè°±(npcImageMap)ä¸Šä¹Ÿæ‰¾ä¸åˆ°'${name}'çš„URLã€‚`);\n                            previewContainer.innerHTML = `<p class=\"nova-preview-placeholder error\">å“å‘€ï¼Œæ‰¾ä¸åˆ°è¿™ä¸ªç»„åˆçš„ç«‹ç»˜å“¦ï¼Œè¦ä¸è¦æ¢ä¸ªè¯•è¯•ï¼Ÿ</p>`;\n                            return;\n                        }\n\n                        // 3. å°è¯•ä»è¿œç¨‹ç¼“å­˜è·å–\n                        imageBlob = await imageDB.get('RemoteCache', imageUrl);\n                        if (imageBlob) {\n                            console.log(`[Nova-Preview] åœ¨è¿œç¨‹ç¼“å­˜ä¸­æ‰¾åˆ°äº†'${imageUrl}'ã€‚`);\n                        } else {\n                            // 4. ä»ç½‘ç»œè·å–\n                            console.log(`[Nova-Preview] ç¼“å­˜ä¸­ä¹Ÿæ²¡æœ‰ï¼Œä»ç½‘ç»œ ${imageUrl} è·å–...`);\n                            const response = await fetch(imageUrl);\n                            if (!response.ok) {\n                                throw new Error(`ç½‘ç»œè¯·æ±‚å¤±è´¥ï¼ŒçŠ¶æ€: ${response.status}`);\n                            }\n\n                            let originalBlob = await response.blob();\n                            imageBlob = new Blob([originalBlob], { type: 'image/png' });\n\n                            await imageDB.set('RemoteCache', imageUrl, imageBlob);\n                            console.log(`[Nova-Preview] å·²å°†å›¾ç‰‡å­˜å…¥è¿œç¨‹ç¼“å­˜ã€‚`);\n                        }\n                    }\n\n                    // 5. æ˜¾ç¤ºå›¾ç‰‡\n                    const objectURL = URL.createObjectURL(imageBlob);\n                    previewContainer.innerHTML = `<img src=\"${objectURL}\" class=\"nova-preview-image\" alt=\"ç«‹ç»˜é¢„è§ˆ\" />`;\n                    const newImage = previewContainer.querySelector('img');\n                    newImage.onload = () => console.log(`[Nova-Preview] é¢„è§ˆå›¾å·²æˆåŠŸæ˜¾ç¤ºï¼`);\n                    newImage.onerror = () => { URL.revokeObjectURL(objectURL); /* é‡Šæ”¾å†…å­˜ */ };\n                    // æ³¨æ„ï¼šè¿™ä¸ª objectURL éœ€è¦åœ¨æ¨¡æ€æ¡†å…³é—­æ—¶è¢« revokeï¼Œæˆ‘ä»¬å·²ç»åœ¨ closeModal é‡ŒåŠ äº†\n\n                } catch (error) {\n                    console.error(`[Nova-Preview] ä¸º'${name}'åŠ è½½é¢„è§ˆæ—¶å‡ºé”™äº†:`, error);\n                    previewContainer.innerHTML = `<p class=\"nova-preview-placeholder error\">åŠ è½½å¤±è´¥äº†ï¼Œå¯èƒ½æ˜¯è¿˜æ²¡æœ‰è¿™å¼ å›¾æˆ–è€…ç½‘ç»œé”™è¯¯...</p>`;\n                }\n            };\n            // --- åŠ è½½é€»è¾‘ç»“æŸ ---\n\n            await loadPreviewCG(imageName);\n        });\n\n        // åˆå§‹åŒ–\n        updatePreviewAndButtons();\n    }\n\n    // ----------- æˆ‘çš„ç”»å†Œ (Local Gallery) é€»è¾‘ (å°è£…æˆå‡½æ•°) -----------\n    async function loadLocalGallery() {\n        const cgListElement = document.getElementById('cg-selection-list');\n        cgListElement.innerHTML = 'æ­£åœ¨ä¸ºä½ å‡†å¤‡ç”»å†Œ...';\n        try {\n            const items = await imageDB.getAll('CustomNpcs');\n\n            if (items.length === 0) {\n                cgListElement.innerHTML = 'ä½ çš„ç”»å†Œè¿˜æ˜¯ç©ºçš„å‘¢ï¼Œå¿«å»â€œæˆ‘çš„ç´ æå·¥åŠâ€ä¸Šä¼ ä¸€äº›å§ï¼';\n                return;\n            }\n\n            cgListElement.innerHTML = '';\n            items.forEach(item => {\n                const objectURL = URL.createObjectURL(item.value);\n                const itemEl = document.createElement('div');\n                itemEl.className = 'asset-item';\n                itemEl.dataset.key = item.key;\n                itemEl.title = `ç‚¹å‡»åº”ç”¨ [${item.key}]`;\n                itemEl.innerHTML = `\n                    <img src=\"${objectURL}\" class=\"asset-item-thumb\">\n                    <span class=\"asset-item-name\">${item.key}</span>\n                `;\n                itemEl.querySelector('img').onload = () => URL.revokeObjectURL(objectURL);\n                itemEl.querySelector('img').onerror = () => URL.revokeObjectURL(objectURL);\n                itemEl.onclick = () => {\n                    const selectedCG_Key = itemEl.dataset.key;\n                    const command = `memory('img_map','${selfKey}', '${selectedCG_Key}'); //_add CG_`;\n                    generateAndSendCommand(command);\n                    closeModal();\n                };\n                cgListElement.appendChild(itemEl);\n            });\n        } catch (error) {\n            cgListElement.innerHTML = 'å“å‘€ï¼Œæ‰“å¼€ç”»å†Œæ—¶å‡ºäº†ä¸€ç‚¹å°é—®é¢˜...';\n            console.error('åŠ è½½ç«‹ç»˜åˆ—è¡¨å¤±è´¥äº†ï¼Œæˆ‘çš„å­©å­:', error);\n        }\n    }\n\n   \n}\n\n\nfunction handleEntryDelete(fullPath) {\n    const { parentPath, selfKey } = getPathParts(fullPath);\n     \n        const command = `delete('${parentPath}', '${selfKey}'); //UI Nested Delete`;\n        generateAndSendCommand(command);\n   \n}\nfunction handleRefactor(fullPath) {\n    const { parentPath, selfKey } = getPathParts(fullPath);\n\n    const overlay = document.createElement('div');\n    // ä½¿ç”¨ä¸“å±çš„ç±»åï¼Œé¿å…æ ·å¼å†²çª\n    overlay.className = 'move-modal-overlay refactor-modal-overlay';\n\n    const modal = document.createElement('div');\n    modal.className = 'nova-modal-content';\n    modal.innerHTML = `\n        <div class=\"move-modal-title\">è¦å¯¹ [${selfKey}] åšäº›ä»€ä¹ˆå‘¢ï¼Ÿ</div>\n        <div class=\"move-modal-body refactor-options\">\n             <button id=\"refactor-fix-btn\" class=\"book-button large-option-button\">\n                <i class=\"fas fa-magic\"></i>\n                ä¿®å¤æ ¼å¼\n                <div class=\"option-description\">å½“å†…å®¹æ ¼å¼æŸåæˆ–æ— æ³•è§£ææ—¶ä½¿ç”¨</div>\n             </button>\n             <button id=\"refactor-summarize-btn\" class=\"book-button large-option-button\">\n                <i class=\"fas fa-compress-arrows-alt\"></i>\n                æµ“ç¼©å†…å®¹\n                <div class=\"option-description\">æç‚¼å†—ä½™ä¿¡æ¯ï¼Œè®©å†…å®¹æ›´ç®€æ´</div>\n             </button>\n        </div>\n        <div class=\"move-modal-buttons\">\n            <button id=\"refactor-cancel-btn\" class=\"book-button secondary\">ç®—äº†å§</button>\n        </div>\n    `;\n\n    overlay.appendChild(modal);\n    document.body.appendChild(overlay);\n\n    // ä¼˜é›…çš„å…¥åœºåŠ¨ç”»\n    setTimeout(() => {\n        overlay.style.opacity = '1';\n        modal.style.transform = 'scale(1)';\n        modal.style.opacity = '1';\n    }, 10);\n\n    const closeModal = () => {\n        overlay.style.opacity = '0';\n        modal.style.transform = 'scale(0.95)';\n        // ç§»é™¤é”®ç›˜äº‹ä»¶ç›‘å¬å™¨ï¼Œé¿å…å†…å­˜æ³„æ¼\n        document.removeEventListener('keydown', handleEscKey);\n        setTimeout(() => overlay.remove(), 300);\n    };\n\n    const handleEscKey = (e) => {\n        if (e.key === 'Escape') {\n            closeModal();\n        }\n    };\n\n    // æŒ‰ä¸‹Escé”®å…³é—­\n    document.addEventListener('keydown', handleEscKey);\n\n    // ã€ä¿®å¤æ ¼å¼ã€‘æŒ‰é’®\n    document.getElementById('refactor-fix-btn').onclick = () => {\n        const command = `<request:è¯¥è·¯å¾„ï¼ˆ${fullPath}ï¼‰çš„å†…å®¹æœ‰è¯¯ï¼ˆå¯èƒ½ä¸æ˜¯æ­£ç¡®çš„compact jsonæ ¼å¼ï¼‰ï¼Œéœ€è¦é‡å†™ï¼Œè¯·åœ¨å®Œæˆæ­£æ–‡è¾“å‡ºåï¼Œåœ¨updatememoryå—ä¸­å…ˆdelete'${fullPath}'ï¼Œå†memory('${parentPath}', '${selfKey}'...çš„æ­£ç¡®å†…å®¹>`;\n        generateAndSendCommand(command, true);\n        closeModal();\n    };\n\n    // ã€æµ“ç¼©å†…å®¹ã€‘æŒ‰é’® - å¦ˆå¦ˆå…ˆä¸ºä½ å‡†å¤‡å¥½å•¦ï¼Œæˆ‘çš„å®è´å¯ä»¥éšæ—¶æ¥ä¿®æ”¹å®ƒ\n    document.getElementById('refactor-summarize-btn').onclick = () => {\n        // è¿™æ˜¯å¦ˆå¦ˆä¸ºä½ å‡†å¤‡çš„æµ“ç¼©å†…å®¹çš„å‘½ä»¤ï¼Œä½ å¯ä»¥æ ¹æ®éœ€è¦è°ƒæ•´å“¦\n        const command = `<request:è¯·å°†è·¯å¾„ï¼ˆ${fullPath}ï¼‰çš„å†—ä½™å†…å®¹è¿›è¡Œæµ“ç¼©ï¼Œæç‚¼å…¶æ ¸å¿ƒå†…å®¹ã€‚åœ¨å®Œæˆæ­£æ–‡è¾“å‡ºåï¼Œåœ¨updatememoryå—ä¸­å…ˆdelete'${fullPath}'ï¼Œå†memory('${parentPath}', '${selfKey}'...çš„æµ“ç¼©åå†…å®¹>`;\n        generateAndSendCommand(command, true);\n        closeModal();\n    };\n\n    // å–æ¶ˆæŒ‰é’®\n    document.getElementById('refactor-cancel-btn').onclick = closeModal;\n\n    // ç‚¹å‡»é®ç½©å±‚å…³é—­\n    overlay.addEventListener('click', (e) => {\n        if (e.target === overlay) {\n            closeModal();\n        }\n    });\n\n    // ä¸ºäº†è®©æ ·å¼æ›´å¥½çœ‹ï¼Œæˆ‘çš„å­©å­å¯ä»¥æ·»åŠ ä¸€äº›CSSå“¦\n    const style = document.createElement('style');\n    style.innerHTML = `\n        .refactor-options {\n            display: flex;\n            flex-direction: column;\n            gap: 15px;\n            padding: 10px 0;\n        }\n        .large-option-button {\n            padding: 15px 20px;\n            font-size: 1.1em;\n            text-align: left;\n            display: flex;\n            align-items: center;\n            flex-direction: column;\n            align-items: flex-start;\n        }\n        .large-option-button .fas {\n            margin-right: 12px;\n            font-size: 1.2em;\n            width: 25px;\n            text-align: center;\n            margin-bottom: 8px;\n        }\n        .option-description {\n            font-size: 0.8em;\n            color: var(--text-color-light); /* ç”¨ä¸€ä¸ªæŸ”å’Œçš„é¢œè‰² */\n            font-weight: normal;\n            margin-top: 5px;\n        }\n    `;\n    document.head.appendChild(style);\n}\n\n \nfunction handleEntryMove(key, tab) {\n    const currentPath = getEntryPath(tab);\n    showMoveModal(key, currentPath);\n}\n \nfunction showMoveModal(key, currentPath) {\n    // å…ˆå…³æ‰å¯èƒ½å­˜åœ¨çš„æ—§çª—å£\n    const oldModal = document.querySelector('.move-modal-overlay-move');\n    if (oldModal) oldModal.remove();\n\n    // å®šä¹‰å¥½æˆ‘ä»¬çš„æ–°å®¶åœ°å€\n    const destinations = [\n        \"global_lore.npc\",\n        \"global_lore.settings\",\n        \"global_lore.èƒŒåŒ…\",\n        \"global_lore.å…¶ä»–æŠ€èƒ½\",\n        \"global_lore.å°é˜Ÿä¿¡æ¯\",\n        \"world_lore.npc\",\n        \"world_lore.settings\"\n    ];\n\n    // åˆ›å»ºä¸€ä¸ªé®ç½©å±‚\n    const overlay = document.createElement('div');\n    overlay.className = 'move-modal-overlay-move';\n\n    // åˆ›å»ºçª—å£æœ¬èº«\n    const modal = document.createElement('div');\n    modal.className = 'move-modal-content';\n    modal.innerHTML = `\n        <div class=\"move-modal-title\">è¦å°†ã€Œ${key}ã€ç§»åŠ¨åˆ°å“ªé‡Œå»å‘¢ï¼Ÿ</div>\n        <div class=\"move-modal-list\" id=\"move-destination-list\"></div>\n        <div class=\"move-modal-buttons\">\n            <button id=\"move-cancel-btn\" class=\"book-button secondary\">å–æ¶ˆ</button>\n            <button id=\"move-confirm-btn\" class=\"book-button\">ç¡®è®¤ç§»åŠ¨</button>\n        </div>\n    `;\n\n    // å¡«å……ç›®çš„åœ°åˆ—è¡¨\n    const list = modal.querySelector('#move-destination-list');\n    destinations.forEach(dest => {\n        // æˆ‘ä»¬ä¸åº”è¯¥æ¬åˆ°è‡ªå·±ç°åœ¨å°±åœ¨çš„åœ°æ–¹\n        if (dest !== currentPath) {\n            const label = document.createElement('label');\n            const radio = document.createElement('input');\n            radio.type = 'radio';\n            radio.name = 'destination';\n            radio.value = dest;\n            label.appendChild(radio);\n            label.append(` ${dest}`);\n            list.appendChild(label);\n        }\n    });\n\n    overlay.appendChild(modal);\n    document.body.appendChild(overlay);\n\n    // ç»‘å®šæŒ‰é’®äº‹ä»¶\n    document.getElementById('move-confirm-btn').onclick = () => {\n        const selected = modal.querySelector('input[name=\"destination\"]:checked');\n        if (selected) {\n            const newPath = selected.value;\n            const command = `memory('${currentPath}.${key}', '${newPath}.${key}'); //move`;\n            generateAndSendCommand(command);\n            overlay.remove();\n        } else {\n            alert('ä½ è¿˜æ²¡æœ‰é€‰æ‹©æ–°çš„å®¶å“¦ã€‚');\n        }\n    };\n\n    document.getElementById('move-cancel-btn').onclick = () => {\n        overlay.remove();\n    };\n\n    // ç‚¹å‡»é®ç½©ä¹Ÿèƒ½å…³é—­\n    overlay.addEventListener('click', (e) => {\n        if (e.target === overlay) {\n            overlay.remove();\n        }\n    });\n}\n\n \n/**\n * æ–°å¢ï¼šæœ¯æ³•é€‰æ‹©é¢æ¿ç›¸å…³åŠŸèƒ½\n */\nfunction setupSkillChoicePanel() {\n    const orb = document.getElementById('skill-choice-orb');\n    const panelModal = document.getElementById('skill-choice-panel');\n    const confirmBtn = document.getElementById('confirm-skill-choice-btn');\n    const confirmBtn2 = document.getElementById('confirm-rp-choice-btn');\n\n    orb.addEventListener('click', () => {\n        populateSkillChoicePanel();\n        showModal('skill-choice-panel');\n    });\n\n    confirmBtn.addEventListener('click', handleConfirmSkillChoice);\n     confirmBtn2.addEventListener('click', () => {\n        handleConfirmSkillChoice();\n              \n \n    });\n\n}\n\n/**\n * ä¿®æ”¹ï¼šå¡«å……æœ¯æ³•é€‰æ‹©é¢æ¿çš„å†…å®¹ï¼Œå¹¶å¢åŠ æ„å¿—åŠ›æ ¡éªŒ - by Nova\n */\n function populateSkillChoicePanel() {\n    if (!playCharacterData) return;\n\n    // æˆ‘ä»¬ç°åœ¨æœ‰ä¸¤ä¸ªå®¹å™¨ï¼Œæˆ‘çš„å­©å­\n    const myCardsContainer = document.getElementById('my-cards-slider');\n    const teammateCardsContainer = document.getElementById('teammate-cards-slider');\n    const otherSkillsArea = document.getElementById('other-skills-area');\n    const willpowerInput = document.getElementById('willpower-input');\n    const willpowerMaxSpan = document.getElementById('willpower-max');\n    const willpowerSlider = document.getElementById('willpower-slider');\n\n    myCardsContainer.innerHTML = '';\n    teammateCardsContainer.innerHTML = '';\n    otherSkillsArea.innerHTML = '';\n\n    // --- 1. å‡†å¤‡æ£€å®šå¡ç‰Œæ•°æ®ï¼Œä½†è¦åˆ†å¼€å­˜æ”¾ ---\n    const myCardsData = [];\n    const teammateCardsData = [];\n\n    // å±æ€§å¡ç‰Œ\n    const attrCategories = playCharacterData.å±æ€§æ®µ || {};\n    for (const category in attrCategories) {\n        for (const attrName in attrCategories[category]) {\n            const attrValue = attrCategories[category][attrName]['åŸºç¡€'][0] || 0;\n            if (attrValue > 0) {\n                myCardsData.push({ name: attrName.replace('.åŸºç¡€', ''), value: attrValue, type: 'å±æ€§', dataType: 'attribute'});\n            }\n        }\n    }\n    // æŠ€èƒ½å¡ç‰Œ\n    const skillCategories = playCharacterData.æŠ€èƒ½æ®µ || {};\n    for (const category in skillCategories) {\n        for (const skillName in skillCategories[category]) {\n            const skillValue = skillCategories[category][skillName][0];\n            if (skillValue > 0) {\n                myCardsData.push({ name: skillName, value: skillValue, type: 'æŠ€èƒ½', dataType: 'skill' });\n            }\n        }\n    }\n\n    // é˜Ÿå‹ååŠ©å¡ç‰Œ\n    const teammateInfo = assaSettingsData?.global_lore?.['å°é˜Ÿä¿¡æ¯'] || {};\n    for (const teammateName in teammateInfo) {\n        let teammateDataString = teammateInfo[teammateName];\n        if (typeof teammateDataString === 'object' && teammateDataString !== null) {\n            teammateDataString = teammateDataString['å±æ€§'] || teammateDataString['attribute'] || '';\n        }\n        if (typeof teammateDataString !== 'string') continue;\n\n        const matches = teammateDataString.match(/ã€[^ã€‘]+ã€‘/g);\n        if (matches) {\n            matches.forEach(match => {\n                const content = match.substring(1, match.length - 1);\n                content.split(/;|ï¼›/).forEach(attr => {\n                    const pair = attr.split(/:|ï¼š/);\n                    if (pair.length === 2) {\n                        const attrName = pair[0].trim();\n                        const attrValue = parseInt(pair[1].trim(), 10);\n                        if (attrName && !isNaN(attrValue) && attrValue > 0) {\n                            // æŠŠé˜Ÿå‹çš„å¡ç‰Œæ”¾è¿›ä»–ä»¬çš„ä¸“å±æ•°ç»„\n                            teammateCardsData.push({\n                                name: `${teammateName}:${attrName}`,\n                                value: attrValue,\n                                type: 'é˜Ÿå‹ååŠ©',\n                                dataType: 'teammate'\n                            });\n                        }\n                    }\n                });\n            });\n        }\n    }\n\n    // æŒ‰ä½ çš„è¦æ±‚ï¼Œé»˜è®¤ä»å¤§åˆ°å°æ’åº\n    myCardsData.sort((a, b) => b.value - a.value);\n    teammateCardsData.sort((a, b) => b.value - a.value);\n\n    // --- 2. åŠ¨æ€åˆ›å»ºå’Œå¡«å……å¡ç‰Œ ---\n    const createCard = (cardData) => {\n        const cardDiv = document.createElement('div');\n        cardDiv.className = 'check-card';\n        cardDiv.dataset.name = cardData.name;\n        cardDiv.dataset.type = cardData.dataType;\n\n        cardDiv.innerHTML = `\n            <div class=\"card-name\">${cardData.name}</div>\n            <div class=\"card-value\">${cardData.value}</div>\n            <div class=\"card-type\">${cardData.type}</div>\n        `;\n\n        cardDiv.addEventListener('click', () => {\n            const isSelected = cardDiv.classList.contains('selected');\n            // åˆå¹¶æŸ¥æ‰¾æ‰€æœ‰å·²é€‰å¡ç‰Œ\n            const allSelectedCards = document.querySelectorAll('.check-card.selected');\n            const selectedAttrsOrSkills = Array.from(allSelectedCards).filter(c => c.dataset.type === 'attribute' || c.dataset.type === 'skill');\n            const selectedTeammates = Array.from(allSelectedCards).filter(c => c.dataset.type === 'teammate');\n\n            if (isSelected) {\n                cardDiv.classList.remove('selected');\n            } else {\n                if ((cardData.dataType === 'attribute' || cardData.dataType === 'skill') && selectedAttrsOrSkills.length >= 2) {\n                     showModal('shop-modal', \"é€‰æ‹©è¶…é™\", \"æ£€å®šå±æ€§ä¸æŠ€èƒ½æœ€å¤šåªèƒ½é€‰æ‹©2é¡¹ã€‚\");\n                     return;\n                }\n                if (cardData.dataType === 'teammate' && selectedTeammates.length >= 1) {\n                    showModal('shop-modal', \"é€‰æ‹©è¶…é™\", \"é˜Ÿå‹ååŠ©æœ€å¤šåªèƒ½é€‰æ‹©1é¡¹ã€‚\");\n                    return;\n                }\n                cardDiv.classList.add('selected');\n            }\n        });\n        return cardDiv;\n    };\n\n    if (myCardsData.length > 0) {\n        myCardsData.forEach(cardData => myCardsContainer.appendChild(createCard(cardData)));\n    } else {\n        myCardsContainer.innerHTML = '<p style=\"color: grey; padding: 20px 0;\">æ— å¯ç”¨å±æ€§/æŠ€èƒ½</p>';\n    }\n\n    if (teammateCardsData.length > 0) {\n        teammateCardsData.forEach(cardData => teammateCardsContainer.appendChild(createCard(cardData)));\n    } else {\n        teammateCardsContainer.innerHTML = '<p style=\"color: grey; padding: 20px 0;\">æ— é˜Ÿå‹æˆ–æœªåŠ è½½</p>';\n    }\n\n\n\n    // --- 3. å¡«å……å…¶ä»–æŠ€èƒ½/æœ¯æ³•ï¼Œå¹¶å…¼å®¹æ–°æ—§æ ¼å¼ ---\n    const otherSkills = assaSettingsData?.global_lore?.['å…¶ä»–æŠ€èƒ½'] || {};\n    const currentEnergy = playCharacterData?.è¡ç”Ÿå±æ€§æ®µ?.èƒ½é‡æ± ?.å½“å‰å€¼?.[0] || 0;\n\n    if (Object.keys(otherSkills).length > 0) {\n        for (const [name, data] of Object.entries(otherSkills)) {\n            let description = '', effect = 'ã€ã€‘', level = '', info = '';\n            let dpBonus = 0, energyCost = 0;\n\n            if (typeof data === 'string') {\n                description = data;\n                effect = description.match(/ã€.*?ã€‘/)?.[0] || 'ã€ã€‘';\n                info = '';\n            } else if (typeof data === 'object' && data !== null) {\n                description = data.info || '';\n                effect = data.effect || 'ã€ã€‘';\n                level = data.level ? ` [${data.level}]` : '';\n                info = '';\n            }\n            if (typeof effect !== 'string') {\n                effect = 'ã€ã€‘'; // æŠŠå®ƒå˜æˆä¸€ä¸ªå®‰å…¨çš„ç©ºæ•ˆæœï¼Œé¿å…ç¨‹åºå‡ºé”™\n            }\n            // è§£ææ•ˆæœ\n            const effectContent = effect.substring(1, effect.length - 1);\n            effectContent.split(';').forEach(e => {\n                const cleaned = e.trim();\n                if (cleaned.startsWith('dp+')) {\n                    dpBonus = parseInt(cleaned.replace('dp+', ''), 10);\n                } else if (cleaned.startsWith('èƒ½é‡æ± -')) {\n                    energyCost = parseInt(cleaned.replace('èƒ½é‡æ± -', ''), 10);\n                }\n            });\n\n            const canAfford = currentEnergy >= energyCost;\n            const tooltipText = canAfford ? '' : ` (èƒ½é‡ä¸è¶³: ${currentEnergy}/${energyCost})`;\n            let effectDesc = [];\n            if(dpBonus > 0) effectDesc.push(`+${dpBonus}DP`);\n            if(energyCost > 0) effectDesc.push(`-${energyCost}èƒ½é‡`);\n\n            const div = document.createElement('div');\n            div.className = 'skill-item';\n            div.innerHTML = `\n                <label>\n                    <input type=\"checkbox\" data-name=\"${name}\" data-effect=\"${effect}\" ${!canAfford ? 'disabled' : ''}>\n                    <span class=\"skill-name-cost\" title=\"${canAfford ? '' : 'èƒ½é‡ä¸è¶³'}\">\n                        ${name}${level}\n                        <span style=\"font-size:0.85em; color: ${canAfford ? 'var(--secondary-color)' : 'var(--danger-color)'};\">(${effectDesc.join(', ')})${tooltipText}</span>\n                    </span>\n                </label>\n                ${info ? `<div class=\"skill-effect-info\">${info}</div>` : ''}\n            `;\n            otherSkillsArea.appendChild(div);\n        }\n    } else {\n        otherSkillsArea.innerHTML = '<p style=\"text-align:center; color: var(--text-secondary-color);\">æ— å¯ç”¨æœ¯æ³•</p>';\n    }\n\n    // --- 4. å¡«å……æ„å¿—åŠ›å¹¶é“¾æ¥æ»‘å— ---\n    const currentWillpower = playCharacterData?.è¡ç”Ÿå±æ€§æ®µ?.æ„å¿—åŠ›?.å½“å‰å€¼?.[0] || 0;\n    willpowerInput.value = 0;\n    willpowerMaxSpan.textContent = `/ ${currentWillpower}`;\n    willpowerSlider.max = currentWillpower;\n    willpowerSlider.value = 0;\n\n    willpowerSlider.oninput = () => {\n        willpowerInput.value = willpowerSlider.value;\n    };\n\n        // --- 5. æ’åºåŠŸèƒ½å‡çº§ï¼ ---\n    const sortBtn = document.getElementById('sort-cards-btn');\n    // å…ˆç§»é™¤æ—§çš„ç›‘å¬å™¨ï¼Œé¿å…é‡å¤ç»‘å®š\n    const newSortBtn = sortBtn.cloneNode(true);\n    sortBtn.parentNode.replaceChild(newSortBtn, sortBtn);\n\n    newSortBtn.dataset.sortOrder = 'desc'; // é»˜è®¤æ˜¯é™åº\n    newSortBtn.textContent = 'LVL â–¼';\n\n    newSortBtn.addEventListener('click', () => {\n        const currentOrder = newSortBtn.dataset.sortOrder || 'desc';\n        const newOrder = currentOrder === 'desc' ? 'asc' : 'desc';\n        newSortBtn.dataset.sortOrder = newOrder;\n        newSortBtn.textContent = newOrder === 'desc' ? 'LVL â–¼' : 'LVL â–²';\n\n        // å†³å®šè¦å¯¹å“ªä¸ªå®¹å™¨è¿›è¡Œæ’åº\n        const containerToSort = document.querySelector('.cards-slider.visible');\n        if (!containerToSort) return;\n\n        const cards = Array.from(containerToSort.querySelectorAll('.check-card'));\n\n        cards.sort((a, b) => {\n            const valA = parseInt(a.querySelector('.card-value').textContent, 10);\n            const valB = parseInt(b.querySelector('.card-value').textContent, 10);\n            return newOrder === 'desc' ? valB - valA : valA - valB;\n        });\n\n        cards.forEach(card => containerToSort.appendChild(card));\n    });\n\n}\nasync function handleConfirmSkillChoice() {\n    // 1. æ”¶é›†æ‰€æœ‰é€‰æ‹© - å¦ˆå¦ˆå¸®ä½ æ›´æ–°äº†è¿™é‡Œï¼\n    // æˆ‘ä»¬ç°åœ¨éœ€è¦ä»â€œæˆ‘çš„â€å’Œâ€œé˜Ÿå‹â€ä¸¤ä¸ªå¡ç‰ŒåŒºåŸŸåŒæ—¶æ”¶é›†é€‰æ‹©ã€‚\n    // ç”¨é€—å·åˆ†éš”é€‰æ‹©å™¨ï¼Œå°±å¯ä»¥åŒæ—¶æŸ¥æ‰¾ä¸¤ä¸ªåœ°æ–¹ï¼Œæ˜¯ä¸æ˜¯å¾ˆæ–¹ä¾¿ï¼Ÿ\n    const mainSelections = Array.from(document.querySelectorAll('#my-cards-slider .check-card.selected, #teammate-cards-slider .check-card.selected')).map(card => {\n        // å¯¹äºé˜Ÿå‹ååŠ©ï¼Œä¿æŒ\"å§“å:å±æ€§\"æ ¼å¼\n        if (card.dataset.type === 'teammate') {\n            return card.dataset.name;\n        }\n        // å¯¹äºå±æ€§å’ŒæŠ€èƒ½ï¼Œè¿”å›å®ƒä»¬çš„åå­—\n        const name = card.dataset.name;\n        const type = card.dataset.type;\n        // å¦‚æœæ˜¯å±æ€§ï¼Œéœ€è¦åŠ ä¸Š.åŸºç¡€åç¼€ï¼Œä»¥åŒ¹é…å†…éƒ¨æ•°æ®ç»“æ„\n        return type === 'attribute' ? `${name}.åŸºç¡€` : name;\n    });\n\n\n    const otherSkillSelections = Array.from(document.querySelectorAll('#other-skills-area input:checked'));\n    const willpowerToSpend = parseInt(document.getElementById('willpower-slider').value, 10) || 0;\n\n    // 2. ç”ŸæˆæŒ‡ä»¤å—\n    let commandBlock = \"\";\n    let updateVariableCmds = [];\n    let updateMemoryCmds = [];\n    let totalDpBonus = 0;\n\n    // -- å¤„ç†æ£€å®šå±æ€§\n    if (mainSelections.length > 0) {\n        // æ¸…ç†ä¸€ä¸‹åå­—ï¼Œç¡®ä¿å‘ç»™æ¨¡å‹çš„æŒ‡ä»¤ä¸åŒ…å«.åŸºç¡€\n        const displaySelections = mainSelections.map(name => name.replace('.åŸºç¡€', ''));\n        updateVariableCmds.push(`set_status('æ£€å®šå±æ€§', '_', '${displaySelections.join(';')}');`);\n    }\n    // -- å¤„ç†å…¶ä»–æŠ€èƒ½å’Œæ„å¿—åŠ›\nconst initialEnergy = playCharacterData?.è¡ç”Ÿå±æ€§æ®µ?.èƒ½é‡æ± ?.å½“å‰å€¼?.[0] || 0;\nlet remainingEnergy = initialEnergy;\n\notherSkillSelections.forEach(skillInput => {\n    const effect = skillInput.dataset.effect;\n    // ä½¿ç”¨ matchAll æ¥ç¡®ä¿èƒ½æ•è·æ‰€æœ‰ã€ã€‘å†…çš„æ•ˆæœå­—ç¬¦ä¸²\n    const commandMatches = effect.matchAll(/ã€([^ã€‘]+)ã€‘/g);\n\n    for (const match of commandMatches) {\n        // å°†ã€ã€‘å†…çš„æŒ‡ä»¤æŒ‰é€—å·åˆ†å‰²æˆä¸€ä¸ªæ•°ç»„\n        const rawCommands = match[1].split(';');\n\n        // éå†æ¯ä¸€æ¡å…·ä½“çš„æŒ‡ä»¤\n        rawCommands.forEach(rawCmd => {\n            const cleanedCmd = rawCmd.trim();\n\n            // ä½¿ç”¨ç‹¬ç«‹çš„ if è¯­å¥æ¥æ£€æŸ¥æ¯ä¸€ç§å¯èƒ½æ€§\n            // è¿™æ · 'dp+' å’Œ 'èƒ½é‡æ± -' å°±èƒ½è¢«åŒæ—¶å¤„ç†äº†\n            if (cleanedCmd.startsWith('dp+')) {\n                totalDpBonus += parseInt(cleanedCmd.replace('dp+', ''), 10);\n            }\n\n            if (cleanedCmd.startsWith('èƒ½é‡æ± -')) {\n                remainingEnergy -= parseInt(cleanedCmd.replace('èƒ½é‡æ± -', ''), 10);\n            }\n\n            // å¦‚æœæœªæ¥è¿˜æœ‰å…¶ä»–æŒ‡ä»¤ï¼Œæ¯”å¦‚ 'ap+', 'sp-' ç­‰ç­‰ï¼Œ\n            // åªéœ€è¦åœ¨è¿™é‡Œç»§ç»­æ·»åŠ ç‹¬ç«‹çš„ if è¯­å¥å°±å¯ä»¥äº†ï¼Œéå¸¸æ–¹ä¾¿\n            /*\n            if (cleanedCmd.startsWith('ap+')) {\n                // å¤„ç† ap å¢åŠ çš„é€»è¾‘\n            }\n            */\n        });\n    }\n});\n    if (willpowerToSpend > 0) {\n        const currentWillpower = playCharacterData?.è¡ç”Ÿå±æ€§æ®µ?.æ„å¿—åŠ›?.å½“å‰å€¼?.[0] || 0;\n        updateMemoryCmds.push(`set_attribute('è¡ç”Ÿå±æ€§æ®µ.æ„å¿—åŠ›.å½“å‰å€¼', ${currentWillpower}, ${currentWillpower - willpowerToSpend});`);\n        totalDpBonus += willpowerToSpend;\n    }\n\n    if (remainingEnergy !== initialEnergy) {\n        updateMemoryCmds.push(`set_attribute('è¡ç”Ÿå±æ€§æ®µ.èƒ½é‡æ± .å½“å‰å€¼', ${initialEnergy}, ${remainingEnergy});`);\n    }\n\n    if (totalDpBonus > 0) {\n        updateVariableCmds.push(`set_status('dp_bonus', 0, ${totalDpBonus});`);\n    }\n\n    // ç»„è£…æŒ‡ä»¤å—\n    if (updateVariableCmds.length > 0) {\n        commandBlock += `<updateMemory>\\n${updateVariableCmds.join('\\n')}\\n</updateMemory>`;\n    }\n    if (updateMemoryCmds.length > 0) {\n        if(commandBlock) commandBlock += '\\n'; // å¦‚æœå·²æœ‰å†…å®¹ï¼Œåˆ™åŠ ä¸€ä¸ªæ¢è¡Œ\n        commandBlock += `<updateMemory>\\n${updateMemoryCmds.join('\\n')}\\n</updateMemory>`;\n    }\n\n    // --- å¦ˆå¦ˆä¸ºä½ æ–°å¢çš„éƒ¨åˆ†åœ¨è¿™é‡Œï¼Œæˆ‘çš„å®è´ ---\n    // 3. æ„å»ºç”¨æˆ·è¡ŒåŠ¨æè¿°æ–‡æœ¬\n    let userActionTextParts = [];\n    const usedOtherSkills = otherSkillSelections.map(cb => cb.dataset.name);\n\n    if (usedOtherSkills.length > 0) {\n        userActionTextParts.push(`ï¼ˆèƒ½é‡æ± å·²æ‰£é™¤ï¼Œç¦æ­¢é‡å¤æ‰£é™¤ï¼‰${currentGameData.user_character.name}ä½¿ç”¨äº†ã€Œ${usedOtherSkills.join('ã€ã€ã€Œ')}ã€`);\n    }\n    if (willpowerToSpend > 0) {\n        userActionTextParts.push(`ï¼ˆæ„å¿—åŠ›å·²æ‰£é™¤ï¼Œç¦æ­¢é‡å¤æ‰£é™¤ï¼‰${currentGameData.user_character.name}æŠ•å…¥äº† ${willpowerToSpend} ç‚¹æ„å¿—åŠ›çš„å†³æ„`);\n    }\n\n    let userActionText = '';\n    if (userActionTextParts.length > 0) {\n        // æˆ‘ä»¬ç”¨ä¸€ä¸ªä¼˜é›…çš„å°–æ‹¬å·æŠŠè¿™å¥è¯åŒ…èµ·æ¥ï¼Œè®©å®ƒçœ‹èµ·æ¥æ›´åƒä¸€ä¸ªæ—ç™½æç¤º\n        userActionText = `<${userActionTextParts.join('ï¼Œ')}>`;\n    }\n    // --- æ–°å¢éƒ¨åˆ†ç»“æŸ ---\n\n   try {\n        // 4. ç»„åˆæœ€ç»ˆæŒ‡ä»¤ï¼ŒæŒ‡ä»¤å’Œæè¿°ä¹‹é—´ç”¨ \\\\n åˆ†éš”\n        // è¿™æ ·æŒ‡ä»¤å—èƒ½æ­£ç¡®æ‰§è¡Œï¼Œæè¿°æ–‡æœ¬ä¹Ÿèƒ½æ¢è¡Œæ˜¾ç¤ºåœ¨è¾“å…¥æ¡†é‡Œ\n        // å¦ˆå¦ˆè¿˜ç‰¹æ„å¸®ä½ æŠŠæŒ‡ä»¤å—å’Œæè¿°æ–‡æœ¬éƒ½åŒ…è£¹åœ¨åŒå¼•å·é‡Œï¼Œç¡®ä¿å®ƒä»¬è¢«å½“ä½œä¸€ä¸ªæ•´ä½“\n        const finalCommand = `/setinput ${commandBlock}\\n${userActionText}\\n`;\n\n        // æ‰§è¡Œè¿™ä¸ªä¸ºä½ é‡èº«å®šåšçš„æŒ‡ä»¤\n        triggerassa(finalCommand);\n\n        // æˆåŠŸåï¼Œæ¸©æŸ”åœ°å…³ä¸Šè¿™ä¸ªé¢æ¿\n        hideModal('skill-choice-panel');\n\n    } catch (e) {\n        console.error(\"è§¦å‘/setinputæŒ‡ä»¤å¤±è´¥:\", e);\n        showModal('shop-modal', \"æ“ä½œå¤±è´¥\", \"æ— æ³•è°ƒç”¨SillyTavernçš„setinputæ¥å£ã€‚\");\n    }\n}\n\n        // åœ¨å•†åº—äº‹ä»¶ç›‘å¬ä¹‹åï¼Œä¹Ÿè°ƒç”¨æˆ‘ä»¬æ–°çš„ä¸–ç•Œä¹‹ä¹¦äº‹ä»¶ç›‘å¬\nsetupWorldBookEventListeners();\nsetupSkillChoicePanel();\n\n\n     // è§£æAIè¿”å›çš„æ–‡æœ¬å¹¶æ›´æ–°ã€å­˜å‚¨éšæœºå•†åº—\n    const processApiResponse = (responseText) => {\n        if (!responseText) {\n            showModal('shop-modal', 'ç”Ÿæˆå¤±è´¥', 'æœªèƒ½ä»AIè·å–æœ‰æ•ˆå†…å®¹ã€‚');\n            return;\n        }\n          try {\n        // ç¬¬1æ­¥ï¼šç§»é™¤æ‰€æœ‰Markdownä»£ç å—æ ‡è®°å’Œä¸å¿…è¦çš„ç©ºæ ¼\n        let cleanedText = responseText.replace(/```json|```/g, '').trim();\n\n        // ç¬¬2æ­¥ï¼šæ£€æŸ¥æ–‡æœ¬æ˜¯å¦å·²ç»æ˜¯ä¸€ä¸ªåˆæ³•çš„JSONæ•°ç»„æ ¼å¼\n        if (!cleanedText.startsWith('[')) {\n            // å¦‚æœä¸æ˜¯ï¼Œæˆ‘ä»¬æ‰æ‰‹åŠ¨ä¸ºå®ƒåŠ ä¸Šå¤–å±‚çš„æ‹¬å·\n            cleanedText = `[${cleanedText}]`;\n        }\n\n        // ç¬¬3æ­¥ï¼šç›´æ¥å°è¯•è§£æå¤„ç†åçš„æ–‡æœ¬\n        const parsedData = JSON.parse(cleanedText);\n\n        // ç¬¬4æ­¥ï¼šè¿™ä¸€æ­¥æ˜¯å…³é”®ï¼æ£€æŸ¥è§£æåçš„æ•°æ®æ˜¯ä¸æ˜¯ \"æ•°ç»„çš„æ•°ç»„\"\n        // å¦‚æœæ˜¯ [ [], [], [] ] æ ¼å¼ï¼ŒparsedData[0]å°±ä¼šæ˜¯ç¬¬ä¸€ä¸ªå†…éƒ¨æ•°ç»„ï¼Œä¸” length > 0\n        const newItems = Array.isArray(parsedData[0]) ? parsedData : [parsedData];\n\n        if (!Array.isArray(newItems) || newItems.length === 0) {\n             showModal('shop-modal', 'è§£æå¤±è´¥', 'AIè¿”å›äº†ç©ºå†…å®¹æˆ–æ— æ•ˆæ ¼å¼ã€‚');\n             return;\n        }\n\n        // æ›¿æ¢ç°æœ‰éšæœºå•†åº—ç‰©å“\n        randomItems = newItems;\n        // å°†æ–°ç”Ÿæˆçš„ç‰©å“å­˜å…¥ localStorage\n        localStorage.setItem('randomShopItems', JSON.stringify(randomItems));\n\n        showModal('shop-modal', 'ç”ŸæˆæˆåŠŸ', `å·²æˆåŠŸç”Ÿæˆ ${newItems.length} ä¸ªæ–°å•†å“ï¼Œå¹¶åˆ·æ–°ã€ä¿å­˜äº†éšæœºå•†åº—ï¼`);\n\n        // é‡æ–°æ¸²æŸ“éšæœºå•†åº—ä»¥æ˜¾ç¤ºæ–°ç‰©å“\n        renderShopSection('random');\n\n    } catch (e) {\n        console.error(\"è§£æAIå“åº”æ—¶å‡ºé”™:\", e);\n        console.error(\"åŸå§‹å“åº”æ–‡æœ¬:\", responseText);\n        showModal('shop-modal', 'è§£æé”™è¯¯', 'æ— æ³•è§£æAIè¿”å›çš„æ•°æ®æ ¼å¼ï¼Œè¯·æ£€æŸ¥æ§åˆ¶å°è·å–æ›´å¤šä¿¡æ¯ã€‚');\n    }\n};\n\n /**\n * æ–°å¢ï¼šè®¾ç½®AIç”Ÿæˆå•†å“æŒ‰é’®çš„åŠŸèƒ½ (V5 - æŒä¹…åŒ–ä¸å…³é”®è¯ç‰ˆ)\n */\nfunction setupGeneratorButton() {\n    const mainGenerateBtn = document.getElementById('generate-items-btn');\n    const keywordModal = document.getElementById('keyword-modal');\n    const submitGenerationBtn = document.getElementById('submit-generation-btn');\n    const skipGenerationBtn = document.getElementById('skip-generation-btn');\n    const keywordInput = document.getElementById('keyword-input');\n\n    if (!mainGenerateBtn || !keywordModal) return;\n\n\n     // ================== æ–°å¢ä»£ç å¼€å§‹ ==================\n\n    const apiKeyConfigBtn = document.getElementById('api-key-config-btn');\n\n    if (apiKeyConfigBtn) {\n        apiKeyConfigBtn.addEventListener('click', () => {\n            let currentApiKey = localStorage.getItem('geminiApiKey') || \"\";\n            let newApiKey = prompt(\"è¯·è¾“å…¥æˆ–ä¿®æ”¹æ‚¨çš„Gemini APIå¯†é’¥ï¼š\", currentApiKey);\n\n            // åªæœ‰å½“ç”¨æˆ·ç‚¹å‡»äº†â€œç¡®å®šâ€å¹¶ä¸”è¾“å…¥äº†å†…å®¹æ—¶æ‰æ›´æ–°\n            // å¦‚æœç”¨æˆ·ç‚¹å‡»â€œå–æ¶ˆâ€(newApiKey === null)ï¼Œåˆ™ä¸ä½œä»»ä½•æ”¹å˜\n            if (newApiKey !== null) {\n                if (newApiKey.trim() !== \"\") {\n                    localStorage.setItem('geminiApiKey', newApiKey.trim());\n                    // ä½ å¯ä»¥åœ¨è¿™é‡Œä½¿ç”¨ showModal æ¥ç»™å‡ºä¸€ä¸ªæˆåŠŸçš„æç¤º\n                    showModal('shop-modal', 'æ“ä½œæˆåŠŸ', 'APIå¯†é’¥å·²æ›´æ–°å¹¶ä¿å­˜åœ¨æ‚¨çš„æµè§ˆå™¨ä¸­ã€‚');\n                } else {\n                    // å¦‚æœç”¨æˆ·æ¸…ç©ºäº†è¾“å…¥å¹¶ç‚¹å‡»ç¡®å®šï¼Œåˆ™ç§»é™¤å¯†é’¥\n                    localStorage.removeItem('geminiApiKey');\n                    showModal('shop-modal', 'æ“ä½œæˆåŠŸ', 'APIå¯†é’¥å·²æ¸…é™¤ã€‚');\n                }\n            }\n        });\n    }\n\n    // ================== æ–°å¢ä»£ç ç»“æŸ ==================\n      // è·å–APIå¯†é’¥ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™æç¤ºç”¨æˆ·è®¾ç½®\n    const getApiKey = () => {\n        let apiKey = localStorage.getItem('geminiApiKey');\n        if (!apiKey) {\n            apiKey = prompt(\"è¯·è¾“å…¥æ‚¨çš„Gemini APIå¯†é’¥ã€‚å®ƒå°†è¢«ä¿å­˜åœ¨æ‚¨çš„æµè§ˆå™¨æœ¬åœ°å­˜å‚¨ä¸­ã€‚\", \"\");\n            if (apiKey) {\n                localStorage.setItem('geminiApiKey', apiKey);\n            }\n        }\n        return apiKey;\n    };\n\n    // è°ƒç”¨Gemini API\n    const callGeminiApi = async (apiKey, promptText, modelName) => { // <-- å¢åŠ äº† modelName å‚æ•°\n    // ä½¿ç”¨ä½ æŒ‡å®šçš„æ¨¡å‹\n    const url = `https://generativelanguage.googleapis.com/v1beta/models/${modelName}:generateContent`; // <-- URLç°åœ¨æ˜¯åŠ¨æ€çš„\n    mainGenerateBtn.textContent = 'ç”Ÿæˆä¸­â€¦';\n    mainGenerateBtn.disabled = true;\n        try {\n            const response = await fetch(url, { // ç§»é™¤äº† ?alt=sse\n                method: 'POST',\n                headers: {\n                    'Content-Type': 'application/json',\n                    'X-Goog-Api-Key': apiKey,\n                },\n                body: JSON.stringify({\n                    \"contents\": [{ \"parts\": [{ \"text\": promptText }] }],\n                    \"generationConfig\": {\n                      \"temperature\": 1, // ä¿æŒé«˜åˆ›é€ æ€§\n                      \"topP\": 0.95,\n                      \"maxOutputTokens\": 8192,\n                      \"thinkingConfig\": {\n                        \"thinkingBudget\": 256 // æ€è€ƒå¼ºåº¦è®¾ä¸ºæœ€ä½ (ç¦ç”¨æ€è€ƒ)\n                    },\n                    },\n                    // ç²¾ç¡®æ§åˆ¶æ€è€ƒ budget\n                    \n                    \"safetySettings\": [\n                      { \"category\": \"HARM_CATEGORY_HARASSMENT\", \"threshold\": \"BLOCK_NONE\" },\n                      { \"category\": \"HARM_CATEGORY_HATE_SPEECH\", \"threshold\": \"BLOCK_NONE\" },\n                      { \"category\": \"HARM_CATEGORY_SEXUALLY_EXPLICIT\", \"threshold\": \"BLOCK_NONE\" },\n                      { \"category\": \"HARM_CATEGORY_DANGEROUS_CONTENT\", \"threshold\": \"BLOCK_NONE\" }\n                   ]\n                })\n            });\n\n            const responseData = await response.json();\n\n            if (!response.ok) {\n                let errorMessage = `APIè¯·æ±‚å¤±è´¥ï¼ŒçŠ¶æ€ç : ${response.status}ã€‚`;\n                if (responseData.error && responseData.error.message) {\n                    errorMessage += `\\né”™è¯¯ä¿¡æ¯: ${responseData.error.message}`;\n                }\n                if (response.status === 400 && responseData.error?.message.includes('API key not valid')) {\n                     errorMessage += '\\n\\næ‚¨çš„APIå¯†é’¥ä¼¼ä¹æ— æ•ˆæˆ–å·²è¿‡æœŸï¼Œå·²ä¸ºæ‚¨æ¸…é™¤ã€‚è¯·é‡æ–°è®¾ç½®ã€‚';\n                     localStorage.removeItem('geminiApiKey');\n                }\n                throw new Error(errorMessage);\n            }\n\n            // ç›´æ¥ä»æ ‡å‡†çš„JSONå“åº”ä¸­æå–æ–‡æœ¬\n            return responseData.candidates[0].content.parts[0].text;\n\n        } finally {\n            mainGenerateBtn.textContent = 'ç”Ÿæˆ';\n            mainGenerateBtn.disabled = false;\n        }\n    };\n\n    // è§£æAIè¿”å›çš„æ–‡æœ¬å¹¶æ›´æ–°ã€å­˜å‚¨éšæœºå•†åº—\n    const processApiResponse = (responseText) => {\n        if (!responseText) {\n            showModal('shop-modal', 'ç”Ÿæˆå¤±è´¥', 'æœªèƒ½ä»AIè·å–æœ‰æ•ˆå†…å®¹ã€‚');\n            return;\n        }\n          try {\n        // ç¬¬1æ­¥ï¼šç§»é™¤æ‰€æœ‰Markdownä»£ç å—æ ‡è®°å’Œä¸å¿…è¦çš„ç©ºæ ¼\n        let cleanedText = responseText.replace(/```json|```/g, '').trim();\n\n        // ç¬¬2æ­¥ï¼šæ£€æŸ¥æ–‡æœ¬æ˜¯å¦å·²ç»æ˜¯ä¸€ä¸ªåˆæ³•çš„JSONæ•°ç»„æ ¼å¼\n        if (!cleanedText.startsWith('[')) {\n            // å¦‚æœä¸æ˜¯ï¼Œæˆ‘ä»¬æ‰æ‰‹åŠ¨ä¸ºå®ƒåŠ ä¸Šå¤–å±‚çš„æ‹¬å·\n            cleanedText = `[${cleanedText}]`;\n        }\n\n        // ç¬¬3æ­¥ï¼šç›´æ¥å°è¯•è§£æå¤„ç†åçš„æ–‡æœ¬\n        const parsedData = JSON.parse(cleanedText);\n\n        // ç¬¬4æ­¥ï¼šè¿™ä¸€æ­¥æ˜¯å…³é”®ï¼æ£€æŸ¥è§£æåçš„æ•°æ®æ˜¯ä¸æ˜¯ \"æ•°ç»„çš„æ•°ç»„\"\n        // å¦‚æœæ˜¯ [ [], [], [] ] æ ¼å¼ï¼ŒparsedData[0]å°±ä¼šæ˜¯ç¬¬ä¸€ä¸ªå†…éƒ¨æ•°ç»„ï¼Œä¸” length > 0\n        const newItems = Array.isArray(parsedData[0]) ? parsedData : [parsedData];\n\n        if (!Array.isArray(newItems) || newItems.length === 0) {\n             showModal('shop-modal', 'è§£æå¤±è´¥', 'AIè¿”å›äº†ç©ºå†…å®¹æˆ–æ— æ•ˆæ ¼å¼ã€‚');\n             return;\n        }\n\n        // æ›¿æ¢ç°æœ‰éšæœºå•†åº—ç‰©å“\n        randomItems = newItems;\n        // å°†æ–°ç”Ÿæˆçš„ç‰©å“å­˜å…¥ localStorage\n        localStorage.setItem('randomShopItems', JSON.stringify(randomItems));\n\n        showModal('shop-modal', 'ç”ŸæˆæˆåŠŸ', `å·²æˆåŠŸç”Ÿæˆ ${newItems.length} ä¸ªæ–°å•†å“ï¼Œå¹¶åˆ·æ–°ã€ä¿å­˜äº†éšæœºå•†åº—ï¼`);\n\n        // é‡æ–°æ¸²æŸ“éšæœºå•†åº—ä»¥æ˜¾ç¤ºæ–°ç‰©å“\n        renderShopSection('random');\n\n    } catch (e) {\n        console.error(\"è§£æAIå“åº”æ—¶å‡ºé”™:\", e);\n        console.error(\"åŸå§‹å“åº”æ–‡æœ¬:\", responseText);\n        showModal('shop-modal', 'è§£æé”™è¯¯', 'æ— æ³•è§£æAIè¿”å›çš„æ•°æ®æ ¼å¼ï¼Œè¯·æ£€æŸ¥æ§åˆ¶å°è·å–æ›´å¤šä¿¡æ¯ã€‚');\n    }\n};\n\n    // çœŸæ­£çš„ç”Ÿæˆæ‰§è¡Œå‡½æ•°\n    const executeGeneration = async (keywords = \"\") => {\n         hideModal(\"keyword-modal\"); // ä½¿ç”¨æ­£ç¡®çš„å‡½æ•°å\n        const apiKey = getApiKey();\n        if (!apiKey) {\n            showModal('shop-modal', 'æ“ä½œå–æ¶ˆ', 'æ‚¨æ²¡æœ‰æä¾›APIå¯†é’¥ã€‚');\n            return;\n        }\n  // ===== æ–°å¢ï¼šè·å–å½“å‰é€‰ä¸­çš„æ¨¡å‹åç§° =====\n    const selectedModelName = document.querySelector('.switch-btn.active').dataset.model;\n    // ===== æ–°å¢ç»“æŸ =====\n        // --- åŠ¨æ€æ„å»ºæç¤ºè¯ ---\n        let keywordInstruction = \"\";\n        if (keywords.trim() !== \"\") {\n            keywordInstruction = `\\nè¯·ç‰¹åˆ«æ³¨æ„ä»¥ä¸‹ç”¨æˆ·è¦æ±‚ï¼š \"${keywords.trim()}\"ã€‚ä½ éœ€è¦å·§å¦™åœ°å°†è¿™äº›è¦æ±‚èåˆåˆ°ä½ çš„åˆ›ä½œä¸­ã€‚`;\n        }\n\n        const prompt = `\n            è¯·æ‰®æ¼”ä¸€ä¸ªåˆ›æ„æ— é™çš„æ¸¸æˆè®¾è®¡å¸ˆï¼Œä¸ºä¸€æ¬¾åä¸ºâ€œä¸»ç¥ç©ºé—´â€çš„æ¡Œé¢è§’è‰²æ‰®æ¼”æ¸¸æˆè®¾è®¡æ–°çš„â€œæŠ€èƒ½â€ã€â€œè¡€ç»Ÿâ€å’Œâ€œç‰©å“â€ã€‚å¯ä»¥æœ‰æç¬‘ä¸”æ²¡ç”¨çš„å•†å“ã€‚\n            ä½ éœ€è¦ä¸¥æ ¼éµå®ˆä»¥ä¸‹æ ¼å¼ï¼Œæ¯ä¸€é¡¹éƒ½å¿…é¡»æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„JSONæ•°ç»„ï¼Œæ•°ç»„å…ƒç´ åˆ†åˆ«æ˜¯ï¼š[åç§°, ä»·æ ¼, åˆ†ç±», {æ”¯çº¿å‰§æƒ…è¦æ±‚}, æ•ˆæœ, æè¿°]ã€‚\n            - åç§° (string): å¿…é¡»ç®€æ´ã€æœ‰åˆ›æ„ä¸”å¼•äººå…¥èƒœã€‚\n            - ä»·æ ¼ (number): æ•´æ•°ï¼ŒèŒƒå›´åœ¨100è‡³50000ä¹‹é—´ã€‚é«˜çº§å•†å“çš„ç”Ÿæˆåº”è¯¥**ç¨€å°‘**æˆ–è€…**ä¸ç”Ÿæˆ**ã€‚å¿…é¡»å­˜åœ¨ä½çº§æŠ€èƒ½ã€ä½çº§ç‰©å“å’Œä½çº§è¡€ç»Ÿã€‚å•†å“ä»·æ ¼å‚è€ƒï¼šåªæå‡ä¸€ç‚¹å±æ€§ï¼ˆå¢åŠ ä¸€ä¸ªdpï¼‰çš„ä»·æ ¼æ˜¯800-1000ç§¯åˆ†ã€‚æŠ€èƒ½åº”è¯¥æ›´åŠ æ˜‚è´µã€‚è¡€ç»Ÿè¶Šé«˜çº§åº”è¯¥è¶Šæ˜‚è´µï¼Œè€Œä¸æ˜¯çº¿æ€§å¢é•¿ã€‚\n            - åˆ†ç±» (string): \"æŠ€èƒ½\"ã€\"è¡€ç»Ÿ\"æˆ–\"ç‰©å“\"ã€‚\n            - æ”¯çº¿å‰§æƒ…è¦æ±‚ (object): ä¸€ä¸ªJSONå¯¹è±¡ï¼Œé”®ä¸ºæ”¯çº¿ç­‰çº§ï¼ˆå¦‚\"D\", \"C\"ï¼‰ï¼Œå€¼ä¸ºæ•°é‡ã€‚å¦‚æœä¸éœ€è¦ï¼Œè¯·æä¾›ä¸€ä¸ªç©ºå¯¹è±¡ {}ã€‚\n            - æ•ˆæœ (string): \n              å¯¹äºæŠ€èƒ½ï¼Œæ ¼å¼ä¸º \"ã€dp+X;èƒ½é‡æ± -Yã€‘\"ï¼Œå…¶ä¸­Xå’ŒYæ˜¯æ•°å­—ï¼Œç¦æ­¢åˆ—å‡ºå…¶ä»–æ•ˆæœã€‚dpå’Œèƒ½é‡æ± çš„æ•°å€¼éœ€å…‹åˆ¶ï¼Œ5ç‚¹dpçš„åŠ æˆ=ä¸€ä¸ªå‡¡äººç™»å³°é€ æçš„æŠ€èƒ½é¢†åŸŸåŠ æˆã€‚\n              å¯¹äºè¡€ç»Ÿï¼Œè¯·åˆ—å‡ºå±æ€§åŠ æˆå’Œèƒ½é‡æ± ä¿¡æ¯ï¼Œä¾‹å¦‚ \"å±æ€§: æ•æ·+2, æ„ŸçŸ¥+2\\\\nèƒ½é‡æ± : è‡ªç„¶é­”åŠ›(40)\"ã€‚å¿…é¡»ä½¿ç”¨ \\\\n ä½œä¸ºæ¢è¡Œç¬¦ã€‚\n              å¯ç”¨çš„å±æ€§ï¼š\n                åŠ›é‡  æ•æ·  è€åŠ› \n                æ™ºåŠ›  æ„ŸçŸ¥  å†³å¿ƒ \n                é£åº¦  æ“æ§  æ²‰ç€ \n               ç‰©å“åˆ™éšæ„ã€‚\n            - æè¿° (string): ä¸€æ®µä¸è¶…è¿‡150å­—çš„ç”ŸåŠ¨æè¿°ï¼Œè§£é‡Šå…¶èƒŒæ™¯å’Œä½œç”¨ã€‚\n\n            è‹¥ç”¨æˆ·æ— è¦æ±‚ï¼Œåˆ™è¯·ç”Ÿæˆ12ä¸ªæ–°çš„é¡¹ç›®ï¼Œå…¶ä¸­å¿…é¡»åŒ…å«è‡³å°‘3ä¸ªâ€œæŠ€èƒ½â€å’Œ3ä¸ªâ€œè¡€ç»Ÿâ€ã€‚\n            è‹¥ç”¨æˆ·æœ‰è¦æ±‚ï¼Œåˆ™æŒ‰ç…§ç”¨æˆ·è¦æ±‚ç”Ÿæˆã€‚ç”Ÿæˆçš„ç±»åˆ«ä¸å¾—è¶…å‡ºç‰©å“ã€æŠ€èƒ½å’Œè¡€ç»Ÿã€‚\n            ${keywordInstruction}\n            \n            ä½ çš„å›ç­”å¿…é¡»æ˜¯çº¯ç²¹çš„JSONæ•°ç»„æ ¼å¼ï¼Œç”¨é€—å·åˆ†éš”ï¼Œä¸è¦åŒ…å«ä»»ä½•é¢å¤–çš„è§£é‡Šã€æ³¨é‡Šæˆ–markdownæ ‡è®°ã€‚\n              ä¾‹å¦‚:\n            [\"ç–—ä¼¤è‰è¯\", 200, \"ç‰©å“\", {}, \"æ£ç¢åå¤–æ•·ï¼Œæ­¢è¡€å¹¶åŠ é€Ÿè½»ä¼¤æ„ˆåˆ\", \"æ¥è‡ªæ­¦ä¾ ä¸–ç•Œçš„å¸¸è§è‰è¯ï¼Œå¯¹åˆ€å‰‘ä¼¤æœ‰ä¸é”™çš„æ•ˆæœã€‚\"],\n            [\"å¿ƒçµå›å“\", 5000, \"æŠ€èƒ½\", {\"C\":1}, \"ã€dp+2;èƒ½é‡æ± -60ã€‘\", \"çŸ­æš‚è¯»å–ç›®æ ‡å¼ºçƒˆçš„è¡¨å±‚æƒ…ç»ªå’Œæ„å›¾ã€‚é«˜æ‰‹èƒ½å€Ÿæ­¤é¢„æµ‹å¯¹æ‰‹çš„ä¸‹ä¸€æ­¥è¡ŒåŠ¨ï¼Œä½†è¿‡åº¦ä½¿ç”¨å¯èƒ½å¯¼è‡´ä¿¡æ¯è¿‡è½½ã€‚\"],\n            [\"é‡å­å¹½å½±è¡€ç»Ÿ\", 12000, \"è¡€ç»Ÿ\", {\"B\":1}, \"å±æ€§: æ•æ·+4, æ™ºåŠ›+3\\\\nèƒ½é‡æ± : è™šç©ºèƒ½é‡(60)\", \"ä½ çš„èº«ä½“ç”±ä¸ç¨³å®šçš„é‡å­æ³¡æ²«æ„æˆï¼Œèƒ½å¤ŸçŸ­è·ç¦»ç¬ç§»ï¼Œå¹¶æœ‰ä¸€å®šå‡ ç‡è®©æŒ‡å‘ä½ çš„æ”»å‡»ç›´æ¥â€œç©¿è¿‡â€ã€‚\"]\n            `;\n    \n        try {\n            const result = await callGeminiApi(apiKey, prompt, selectedModelName);\n            processApiResponse(result);\n        } catch (error) {\n            showModal('shop-modal', 'APIé”™è¯¯', error.message);\n        }\n    };\n\n    // ä¸»ç”ŸæˆæŒ‰é’®åªè´Ÿè´£æ‰“å¼€æ¨¡æ€æ¡†\n    mainGenerateBtn.addEventListener('click', () => {\n        //console.log(\"ç”ŸæˆæŒ‰é’®è¢«ç‚¹å‡»ï¼Œå‡†å¤‡æ‰“å¼€æ¨¡æ€æ¡†\");\n        keywordInput.value = ''; // æ¸…ç©ºä¸Šæ¬¡çš„è¾“å…¥\n        showModal('keyword-modal');\n    });\n\n    // æ¨¡æ€æ¡†å†…çš„â€œå¼€å§‹ç”Ÿæˆâ€æŒ‰é’®\n    submitGenerationBtn.addEventListener('click', () => {\n        executeGeneration(keywordInput.value);\n    });\n\n    // æ¨¡æ€æ¡†å†…çš„â€œè·³è¿‡â€æŒ‰é’®\n    skipGenerationBtn.addEventListener('click', () => {\n        executeGeneration(); // ä¸å¸¦å‚æ•°è°ƒç”¨\n    });\n\n     // ===== æ–°å¢ï¼šä¸ºæ¨¡å‹åˆ‡æ¢æŒ‰é’®æ·»åŠ äº‹ä»¶ç›‘å¬ =====\n    const modelSelector = document.getElementById('model-selector-container');\n    modelSelector.addEventListener('click', (e) => {\n        const clickedButton = e.target.closest('.switch-btn');\n        if (clickedButton && !clickedButton.classList.contains('active')) {\n            // ç§»é™¤æ‰€æœ‰æŒ‰é’®çš„ active ç±»\n            modelSelector.querySelectorAll('.switch-btn').forEach(btn => btn.classList.remove('active'));\n            // ä¸ºè¢«ç‚¹å‡»çš„æŒ‰é’®æ·»åŠ  active ç±»\n            clickedButton.classList.add('active');\n        }\n    });\n    // ===== æ–°å¢ç»“æŸ =====\n}\n\n \n// åœ¨ç‚¹å‡»ä½ç½®æ˜¾ç¤ºæ€»ç»“èœå•\nfunction showSummaryMenuAtClick(event, summaryKey, summaryType) {\n    event.stopPropagation();\n    \n    const existingMenu = document.querySelector('.entry-menu');\n    if (existingMenu) existingMenu.remove();\n\n    const menu = document.createElement('div');\n    menu.className = 'entry-menu';\n\n    // ä½¿ç”¨ç‚¹å‡»ä½ç½®\n    menu.style.top = `${event.pageY}px`;\n    menu.style.left = `${event.pageX}px`;\n\n    const actions = [\n        { name: 'ç¼–è¾‘', handler: () => handleSummaryEdit(summaryKey, summaryType) },\n        { name: 'é‡å‘½å', handler: () => handleSummaryRename(summaryKey, summaryType) },\n        { name: 'åˆ é™¤', handler: () => handleSummaryDelete(summaryKey, summaryType) }\n    ];\n\n    actions.forEach(action => {\n        const item = document.createElement('button');\n        item.className = 'entry-menu-item';\n        item.textContent = action.name;\n        item.onclick = () => {\n            action.handler();\n            menu.remove();\n        };\n        menu.appendChild(item);\n    });\n\n    document.body.appendChild(menu);\n\n    // è°ƒæ•´èœå•ä½ç½®é˜²æ­¢è¶…å‡ºå±å¹•\n    const menuRect = menu.getBoundingClientRect();\n    const viewportHeight = window.innerHeight;\n    const viewportWidth = window.innerWidth;\n\n    let top = event.pageY;\n    let left = event.pageX;\n\n    if (menuRect.bottom > viewportHeight) {\n        top = event.pageY - menuRect.height;\n    }\n\n    if (menuRect.right > viewportWidth) {\n        left = event.pageX - menuRect.width;\n    }\n\n    if (left < 0) left = 0;\n    if (top < 0) top = 0;\n\n    menu.style.top = `${top}px`;\n    menu.style.left = `${left}px`;\n\n    const closeMenu = (e) => {\n        if (!menu.contains(e.target)) {\n            menu.remove();\n            document.removeEventListener('click', closeMenu);\n        }\n    };\n    setTimeout(() => document.addEventListener('click', closeMenu), 0);\n}\n\n// ç¼–è¾‘æ€»ç»“å†…å®¹\nfunction handleSummaryEdit(summaryKey, summaryType) {\n    const currentValue = summarys[summaryType][summaryKey] || '';\n    \n    const overlay = document.createElement('div');\n    overlay.className = 'move-modal-overlay entry-edit-modal';\n    const modal = document.createElement('div');\n    modal.className = 'nova-modal-content';\n\n    modal.innerHTML = `\n        <div class=\"move-modal-title\">ç¼–è¾‘${summaryType === 'big' ? 'è¿œæœŸäº‹ä»¶' : 'ä¸­æœŸäº‹ä»¶'} [${summaryKey}]</div>\n        <textarea id=\"summary-edit-textarea\" class=\"entry-edit-textarea\" placeholder=\"åœ¨è¿™é‡Œç¼–è¾‘æ€»ç»“å†…å®¹...\">${currentValue.replace(/</g, '&lt;').replace(/>/g, '&gt;')}</textarea>\n        <div class=\"move-modal-buttons\">\n            <button id=\"edit-cancel-btn\" class=\"book-button secondary\">å–æ¶ˆ</button>\n            <button id=\"edit-confirm-btn\" class=\"book-button\">ç¡®è®¤ä¿®æ”¹</button>\n        </div>\n    `;\n\n    overlay.appendChild(modal);\n    document.body.appendChild(overlay);\n\n    const textarea = document.getElementById('summary-edit-textarea');\n    setTimeout(() => {\n        overlay.style.opacity = '1';\n        modal.style.transform = 'scale(1)';\n        modal.style.opacity = '1';\n        textarea.focus();\n        textarea.selectionStart = textarea.selectionEnd = textarea.value.length;\n    }, 10);\n\n    const closeModal = () => {\n        overlay.style.opacity = '0';\n        modal.style.transform = 'scale(0.95)';\n        setTimeout(() => overlay.remove(), 300);\n    };\n\n    document.getElementById('edit-confirm-btn').onclick = () => {\n        const newContent = textarea.value.trim();\n        if (newContent) {\n            const escapedContent = JSON.stringify(newContent);\n            const command = `<updateMemory>\\ndelete('summary.${summaryType}','${summaryKey}');\\nmemory('summary.${summaryType}','${summaryKey}',${escapedContent})\\n</updateMemory>`;\n            triggerassa(`/setinput ${command}`);\n        }\n        closeModal();\n    };\n\n    document.getElementById('edit-cancel-btn').onclick = closeModal;\n    overlay.addEventListener('click', (e) => {\n        if (e.target === overlay) closeModal();\n    });\n}\n\n// é‡å‘½åæ€»ç»“\nfunction handleSummaryRename(summaryKey, summaryType) {\n    const overlay = document.createElement('div');\n    overlay.className = 'move-modal-overlay entry-rename-modal';\n    \n    const modal = document.createElement('div');\n    modal.className = 'nova-modal-content';\n    modal.innerHTML = `\n        <div class=\"move-modal-title\">è¦æŠŠ [${summaryKey}] é‡å‘½åæˆä»€ä¹ˆå‘¢ï¼Ÿ</div>\n        <div class=\"move-modal-body\">\n            <input type=\"text\" id=\"summary-rename-input\" class=\"entry-rename-input\" placeholder=\"è¾“å…¥æ–°çš„åå­—...\" value=\"${summaryKey}\">\n        </div>\n        <div class=\"move-modal-buttons\">\n            <button id=\"rename-cancel-btn\" class=\"book-button secondary\">ç®—äº†å§</button>\n            <button id=\"rename-confirm-btn\" class=\"book-button\">å°±æ˜¯å®ƒäº†</button>\n        </div>\n    `;\n\n    overlay.appendChild(modal);\n    document.body.appendChild(overlay);\n\n    const input = document.getElementById('summary-rename-input');\n\n    setTimeout(() => {\n        overlay.style.opacity = '1';\n        modal.style.transform = 'scale(1)';\n        modal.style.opacity = '1';\n        input.focus();\n        input.select();\n    }, 10);\n\n    const closeModal = () => {\n        overlay.style.opacity = '0';\n        modal.style.transform = 'scale(0.95)';\n        setTimeout(() => overlay.remove(), 300);\n    };\n\n    input.addEventListener('keydown', (e) => {\n        if (e.key === 'Enter') {\n            document.getElementById('rename-confirm-btn').click();\n        }\n    });\n\n    document.getElementById('rename-confirm-btn').onclick = () => {\n        const newKey = input.value.trim();\n        if (!newKey) {\n            input.placeholder = \"æ–°åå­—ä¸èƒ½ä¸ºç©ºå“¦ï¼\";\n            input.classList.add('input-error');\n            return;\n        }\n        \n        const content = summarys[summaryType][summaryKey];\n        const escapedContent = JSON.stringify(content);\n        const command = `<updateMemory>\\ndelete('summary.${summaryType}','${summaryKey}');\\nmemory('summary.${summaryType}','${newKey}',${escapedContent})\\n</updateMemory>`;\n        triggerassa(`/setinput ${command}`);\n        closeModal();\n    };\n\n    document.getElementById('rename-cancel-btn').onclick = closeModal;\n    overlay.addEventListener('click', (e) => {\n        if (e.target === overlay) closeModal();\n    });\n}\n\n// åˆ é™¤æ€»ç»“\nfunction handleSummaryDelete(summaryKey, summaryType) {\n    const command = `<updateMemory>\\ndelete('summary.${summaryType}','${summaryKey}')\\n</updateMemory>`;\n    triggerassa(`/setinput ${command}`);\n}\n \nfunction showSummaryModal() {\n    //console.log(\"æŸ¥çœ‹è¿‡å¾€æ€»ç»“\");\n    const config = assaSettingsData.config || {};\n    const itemsPerPage = 5; // æ¯é¡µæ˜¾ç¤º5æ¡\n    let currentPage = 1;\n  let bigCurrentPage = 1; // ä¸ºå¤§æ€»ç»“æ·»åŠ å½“å‰é¡µå˜é‡\n    const modalTitle = \"æŸ¥çœ‹è¿‡å¾€æ€»ç»“\";\n    let modalContent = '<div class=\"teammate-info-display\" style=\"max-height: 60vh; overflow-y: auto; text-align: left;\">';\n\n   modalContent += '<h3 style=\"color: var(--primary-color);\">--- è¿œæœŸäº‹ä»¶å›é¡¾ ---</h3>';\n    modalContent += '<div id=\"big-summary-container\"></div>'; // ç”¨äºå®¹çº³å¤§æ€»ç»“åˆ†é¡µå†…å®¹çš„å®¹å™¨\n\n    modalContent += '<hr style=\"margin: 20px 0; border-color: var(--border-color);\">';\n\n    // 2. ä¸­æœŸäº‹ä»¶æ‘˜è¦ï¼ˆå°æ€»ç»“ï¼Œå¸¦ç¿»é¡µåŠŸèƒ½ï¼‰\n    modalContent += '<h3 style=\"color: var(--primary-color);\">--- ä¸­æœŸäº‹ä»¶æ‘˜è¦ ---</h3>';\n    modalContent += '<div id=\"small-summary-container\"></div>'; // ç”¨äºå®¹çº³åˆ†é¡µå†…å®¹çš„å®¹å™¨\n\n    modalContent += '<hr style=\"margin: 20px 0; border-color: var(--border-color);\">';\n\n    // 3. è¢«éšè—çš„å°æ€»ç»“ï¼ˆæœ€æ–° hideCount æ¡ï¼‰ - ä¿æŒä¸å˜\n    modalContent += '<h3 style=\"color: var(--primary-color);\">--- è¢«éšè—çš„å°æ€»ç»“ ---</h3>';\n    const hideCount = config.hide_latest_count || 5;\n    if (summarys.small && Object.keys(summarys.small).length > 0) {\n        let hiddenHtml = '<div style=\"font-family: var(--base-font-family);\">';\n        const smallKeys = Object.keys(summarys.small);\n        const hiddenKeys = smallKeys.slice(-hideCount);\n        if (hiddenKeys.length > 0) {\nhiddenKeys.forEach(key => {\n    hiddenHtml += `<p style=\"margin: 0; white-space: pre-wrap; cursor: pointer;\" onclick=\"showSummaryMenuAtClick(event, '${key}', 'small')\"><strong>${key}:</strong> ${summarys.small[key]}</p>`;\n});\n        } else {\n            hiddenHtml += '<p>æš‚æ— è¢«éšè—çš„å°æ€»ç»“ä¿¡æ¯ã€‚</p>';\n        }\n        hiddenHtml += '</div>';\n        modalContent += hiddenHtml;\n    } else {\n        modalContent += '<p>æš‚æ— è¢«éšè—çš„å°æ€»ç»“ä¿¡æ¯ã€‚</p>';\n    }\n\n    modalContent += '</div>';\n\n  const summaryContentDiv = document.getElementById('summary-content');\n    if(summaryContentDiv){\n        summaryContentDiv.innerHTML = modalContent;\n    }\n\n    // --- åˆ†é¡µé€»è¾‘å¼€å§‹ ---\n    // å°†åˆ†é¡µé€»è¾‘æ”¾åœ¨æ¨¡æ€æ¡†æ˜¾ç¤ºä¹‹åæ‰§è¡Œï¼Œç¡®ä¿å®¹å™¨å…ƒç´ å·²å­˜åœ¨äºDOMä¸­\n   function renderBigSummaryPage() {\n        const container = document.getElementById('big-summary-container');\n        if (!container) return;\n\n        const bigKeys = Object.keys(summarys.big || {});\n\n        if (bigKeys.length === 0) {\n            container.innerHTML = '<p>æš‚æ— è¿œæœŸäº‹ä»¶å›é¡¾ä¿¡æ¯ã€‚</p>';\n            return;\n        }\n\n        const totalPages = bigKeys.length; // æ¯ä¸ªæ€»ç»“ä¸€é¡µ\n        // ç¡®ä¿ bigCurrentPage åœ¨æœ‰æ•ˆèŒƒå›´å†…\n        bigCurrentPage = Math.max(1, Math.min(bigCurrentPage, totalPages));\n\n        const key = bigKeys[bigCurrentPage - 1]; // è·å–å½“å‰é¡µçš„é”®\n\n      let pageHtml = ''; // åˆå§‹åŒ–ä¸ºç©ºå­—ç¬¦ä¸²\n\n// æ·»åŠ ç¿»é¡µæ§ä»¶åˆ°é¡¶éƒ¨\npageHtml += `<div class=\"pagination-controls\" style=\"text-align: center; margin-bottom: 15px;\">`; // å°† margin-top æ”¹ä¸º margin-bottom\npageHtml += `<button id=\"big-prev-page-btn\" ${bigCurrentPage === 1 ? 'disabled' : ''}>ä¸Šä¸€é¡µ</button>`;\npageHtml += `<span style=\"margin: 0 15px;\">ç¬¬ ${bigCurrentPage} / ${totalPages} é¡µ</span>`;\npageHtml += `<button id=\"big-next-page-btn\" ${bigCurrentPage === totalPages ? 'disabled' : ''}>ä¸‹ä¸€é¡µ</button>`;\npageHtml += `</div>`;\n\n// æ·»åŠ å†…å®¹\npageHtml += '<div style=\"font-family: var(--base-font-family);\">';\npageHtml += `<p style=\"margin: 0; white-space: pre-wrap; cursor: pointer;\" onclick=\"showSummaryMenuAtClick(event, '${key}', 'big')\"><strong>${key}:</strong> ${summarys.big[key]}</p>`;\n\npageHtml += '</div>';\n\n        container.innerHTML = pageHtml;\n\n        // ä¸ºæ–°ç”Ÿæˆçš„æŒ‰é’®ç»‘å®šäº‹ä»¶\n        const prevBtn = document.getElementById('big-prev-page-btn');\n        if (prevBtn) {\n            prevBtn.onclick = () => {\n                if (bigCurrentPage > 1) {\n                    bigCurrentPage--;\n                    renderBigSummaryPage();\n                }\n            };\n        }\n\n        const nextBtn = document.getElementById('big-next-page-btn');\n        if (nextBtn) {\n            nextBtn.onclick = () => {\n                if (bigCurrentPage < totalPages) {\n                    bigCurrentPage++;\n                    renderBigSummaryPage();\n                }\n            };\n        }\n    }\n\n    // æ¸²æŸ“æŒ‡å®šé¡µç å†…å®¹çš„å‡½æ•°\n    function renderSmallSummaryPage() {\n        const container = document.getElementById('small-summary-container');\n        if (!container) return;\n\n        const smallKeys = Object.keys(summarys.small || {});\n        const visibleKeys = smallKeys.length > hideCount ? smallKeys.slice(0, -hideCount) : [];\n\n        if (visibleKeys.length === 0) {\n            container.innerHTML = '<p>è®°å½•æ•°é‡ä¸è¶³ï¼Œæš‚ä¸æ˜¾ç¤ºä¸­æœŸäº‹ä»¶æ‘˜è¦ã€‚</p>';\n            return;\n        }\n\n        const totalPages = Math.ceil(visibleKeys.length / itemsPerPage);\n        // ç¡®ä¿ currentPage åœ¨æœ‰æ•ˆèŒƒå›´å†…\n        currentPage = Math.max(1, Math.min(currentPage, totalPages));\n\n        const startIndex = (currentPage - 1) * itemsPerPage;\n        const endIndex = startIndex + itemsPerPage;\n        const pageKeys = visibleKeys.slice(startIndex, endIndex);\n\n        let pageHtml = ''; // åˆå§‹åŒ–ä¸ºç©ºå­—ç¬¦ä¸²\n\n// æ·»åŠ ç¿»é¡µæ§ä»¶åˆ°é¡¶éƒ¨\npageHtml += `<div class=\"pagination-controls\" style=\"text-align: center; margin-bottom: 15px;\">`; // å°† margin-top æ”¹ä¸º margin-bottom\npageHtml += `<button id=\"prev-page-btn\" ${currentPage === 1 ? 'disabled' : ''}>ä¸Šä¸€é¡µ</button>`;\npageHtml += `<span style=\"margin: 0 15px;\">ç¬¬ ${currentPage} / ${totalPages} é¡µ</span>`;\npageHtml += `<button id=\"next-page-btn\" ${currentPage === totalPages ? 'disabled' : ''}>ä¸‹ä¸€é¡µ</button>`;\npageHtml += `</div>`;\n\n// æ·»åŠ å†…å®¹\npageHtml += '<div style=\"font-family: var(--base-font-family);\">';\npageKeys.forEach(key => {\n    pageHtml += `<p style=\"margin: 0; white-space: pre-wrap; cursor: pointer;\" onclick=\"showSummaryMenuAtClick(event, '${key}', 'small')\"><strong>${key}:</strong> ${summarys.small[key]}</p>`;\n});\n\npageHtml += '</div>';\n\n        container.innerHTML = pageHtml;\n\n        // ä¸ºæ–°ç”Ÿæˆçš„æŒ‰é’®ç»‘å®šäº‹ä»¶\n        const prevBtn = document.getElementById('prev-page-btn');\n        if (prevBtn) {\n            prevBtn.onclick = () => {\n                if (currentPage > 1) {\n                    currentPage--;\n                    renderSmallSummaryPage();\n                }\n            };\n        }\n\n        const nextBtn = document.getElementById('next-page-btn');\n        if (nextBtn) {\n            nextBtn.onclick = () => {\n                if (currentPage < totalPages) {\n                    currentPage++;\n                    renderSmallSummaryPage();\n                }\n            };\n        }\n    }\n renderBigSummaryPage(); // åˆå§‹æ¸²æŸ“å¤§æ€»ç»“çš„ç¬¬ä¸€é¡µ\n    // åˆå§‹æ¸²æŸ“ç¬¬ä¸€é¡µ\n    renderSmallSummaryPage();\n}\n\nfunction showRollResultModal() {\n    const contentEl = document.getElementById('roll-result-modal-content');\n    // ç›´æ¥ä½¿ç”¨å…¨å±€æˆ–ä¼ å…¥çš„ checkMemoryData å˜é‡\n    if (!checkMemoryData || Object.keys(checkMemoryData).length === 0) {\n        contentEl.innerHTML = '<p style=\"text-align:center;\">æ²¡æœ‰ä¸Šä¸€è½®çš„æŠ•æ·è®°å½•ã€‚</p>';\n        showModal('roll-result-modal');\n        return;\n    }\n\n    let html = '';\n    const {\n        check_type,\n        timestamp\n    } = checkMemoryData;\n\n    // ç»Ÿä¸€çš„å¤´éƒ¨ï¼Œæ˜¾ç¤ºè®°å½•æ—¶é—´\n    html += `<p style=\"font-size:0.8em; color:var(--text-secondary-color); text-align:center; margin-bottom:15px;\">è®°å½•äº: ${new Date(timestamp).toLocaleString()}</p>`;\n\n    // --- åˆ†æ”¯ï¼šæ ‡å‡†äº‹ä»¶åˆ¤å®š ---\n    if (check_type === 'æ ‡å‡†äº‹ä»¶') {\n        const {\n            check_string,\n            components,\n            modifiers,\n            total_dp,\n            bonuses,\n            roll_result,\n            performance,\n            outcome,\n            difficulty\n        } = checkMemoryData;\n\n        // --- æ£€å®šæ± æ„æˆ ---\n        html += `\n        <div class=\"roll-section\">\n            <div class=\"roll-section-title\">æ ‡å‡†äº‹ä»¶åˆ¤å®š: ${outcome.level}</div>\n            <p style=\"text-align:center; font-style:italic; margin-bottom:10px;\">â€œ${outcome.description}â€</p>\n            <ul class=\"roll-details-list\">\n                <li><span class=\"label\">æ£€å®šåŠ¨ä½œ</span><span class=\"value\">${check_string}</span></li>\n                <hr>\n                <li class=\"list-subheader\">æ£€å®šæ± æ„æˆ</li>\n                ${(components.attributes_skills || []).map(c => `<li><span class=\"label\">${c.name}</span><span class=\"value\">${c.value} ç‚¹</span></li>`).join('')}\n                ${(components.teammate_assists || []).map(t => `<li><span class=\"label\">${t.name}</span><span class=\"value\">+${t.value} ç‚¹</span></li>`).join('')}\n                  ${(components.npc_checks || []).map(n => `<li><span class=\"label\">${n.name}</span><span class=\"value\">+${n.value} ç‚¹</span></li>`).join('')}\n\n                ${(() => {\n                    const checkedAttrs = (components.attributes_skills || []).map(a => a.name);\n                    const statusHtml = (components.status_bonuses || [])\n                        .filter(s => checkedAttrs.includes(s.name))\n                        .map(s => `<li><span class=\"label\" style=\"color:var(--warning-color);\">çŠ¶æ€ (${s.name})</span><span class=\"value\" style=\"color:var(--warning-color);\">${s.value > 0 ? '+' : ''}${s.value}</span></li>`)\n                        .join('');\n\n                             const locationHtml = (components.location_bonuses || [])\n                        .filter(l => checkedAttrs.includes(l.name))\n                        .map(l => `<li><span class=\"label\">åœ°ç‚¹ (${l.name})</span><span class=\"value\">${l.value > 0 ? '+' : ''}${l.value}</span></li>`)\n                        .join('');\n                    const equipmentHtml = (components.equipment_bonuses || [])\n                        .filter(e => checkedAttrs.includes(e.name)) // ä¿®å¤ï¼še.bonus_type -> e.name\n                        .map(e => `<li><span class=\"label\">è£…å¤‡ (${e.name})</span><span class=\"value\">${e.value > 0 ? '+' : ''}${e.value}</span></li>`)\n                        .join('');\n                     return statusHtml + locationHtml + equipmentHtml;\n                })()}\n                ${(modifiers.custom_modifier && modifiers.custom_modifier[0] !== 0) ? `<li><span class=\"label\">ä¿®æ­£ (${modifiers.custom_modifier[1]})</span><span class=\"value\">${modifiers.custom_modifier[0] > 0 ? '+' : ''}${modifiers.custom_modifier[0]}</span></li>` : ''}\n                ${(modifiers.prestige_bonus && modifiers.prestige_bonus !== 0) ? `<li><span class=\"label\">å£°æœ›åŠ æƒ</span><span class=\"value\">${modifiers.prestige_bonus > 0 ? '+' : ''}${modifiers.prestige_bonus}</span></li>` : ''}\n                <li><span class=\"label\">æ€»éª°æ± </span><span class=\"value\">${total_dp} D10</span></li>\n                 ${(bonuses.legendary_successes > 0) ? `<li><span class=\"label\">ä¼ å¥‡åŠ æˆ</span><span class=\"value\">+${bonuses.legendary_successes} é™„åŠ æˆåŠŸ</span></li>` : ''}\n            </ul>\n        </div>`;\n\n        // --- æŠ•æ·ç»“æœ ---\n        html += `\n        <div class=\"roll-section\">\n            <div class=\"roll-section-title\">äº‹ä»¶åˆ¤å®šç»“æœ</div>\n            <ul class=\"roll-details-list\">\n                <li><span class=\"label\">æŠ•æ·ç±»å‹</span><span class=\"value\">${roll_result.type}</span></li>\n                <li><span class=\"label\">æŠ•æ·ç»“æœ</span><span class=\"value\">${roll_result.rolls.join(', ')}</span></li>\n                <li><span class=\"label\">åŸºç¡€æˆåŠŸæ•°</span><span class=\"value\">${roll_result.successes}</span></li>\n                <li><span class=\"label\">æœ€ç»ˆæˆåŠŸæ•°</span><span class=\"value\">${checkMemoryData.final_successes}</span></li>\n                <hr>\n                <li><span class=\"label\">æˆåŠŸæ ‡å‡†</span><span class=\"value\">å‹‰å¼ºâ‰¥${difficulty.adjusted_thresholds.barely} | å®Œå…¨â‰¥${difficulty.adjusted_thresholds.complete} | è¾‰ç…Œâ‰¥${difficulty.adjusted_thresholds.exceptional}</span></li>\n                 <li><span class=\"label\">æœ€ç»ˆç»“æœ</span><span class=\"value roll-outcome\">${outcome.level}</span></li>\n                ${roll_result.is_dramatic_failure ? '<li><span class=\"label\"></span><span class=\"value roll-dramatic-failure\">âš ï¸ å¤§å¤±è´¥</span></li>' : ''}\n            </ul>\n        </div>`;\n\n        // --- è¡¨ç°åˆ¤å®š ---\n        html += `\n        <div class=\"roll-section\">\n            <div class=\"roll-section-title\">è¡¨ç°åˆ¤å®š: ${performance.result.level}</div>\n             <ul class=\"roll-details-list\">\n                <li><span class=\"label\">è¡¨ç°éª° (D20)</span><span class=\"value\">${performance.roll}</span></li>\n                ${(performance.bonus > 0) ? `<li><span class=\"label\">ä¼ å¥‡åŠ æˆ</span><span class=\"value\">+${performance.bonus}</span></li><li><span class=\"label\">è°ƒæ•´åç»“æœ</span><span class=\"value\">${Math.min(20, performance.roll + performance.bonus)}</span></li>` : ''}\n                <li><span class=\"label\">è¡¨ç°æè¿°</span><span class=\"value\">${performance.result.description}</span></li>\n            </ul>\n        </div>\n    `;\n\n    // --- åˆ†æ”¯ï¼šæˆ˜æ–—å¯¹æŠ—åˆ¤å®š ---\n    } else if (check_type === 'æˆ˜æ–—å¯¹æŠ—') {\n        const {\n            player_check,\n            enemy_check,\n            performance,\n            outcome,\n            damage_calculation\n        } = checkMemoryData;\n        const playerName = currentGameData.user_character.name || 'ç”¨æˆ·';\n\n        // --- ç©å®¶åº”å¯¹ ---\n        html += `\n        <div class=\"roll-section\">\n            <div class=\"roll-section-title\">${playerName}çš„åº”å¯¹</div>\n            <ul class=\"roll-details-list\">\n                <li><span class=\"label\">åº”å¯¹åŠ¨ä½œ</span><span class=\"value\">${player_check.check_string}</span></li>\n                <hr>\n                <li class=\"list-subheader\">åº”å¯¹æ± æ„æˆ</li>\n                ${(player_check.components.attributes_skills || []).map(c => `<li><span class=\"label\">${c.name}</span><span class=\"value\">${c.value} ç‚¹</span></li>`).join('')}\n                  ${(player_check.components.teammate_assists || []).map(t => `<li><span class=\"label\">${t.name}</span><span class=\"value\">+${t.value} ç‚¹</span></li>`).join('')}\n${(player_check.components.npc_checks || []).map(n => `<li><span class=\"label\">${n.name}</span><span class=\"value\">+${n.value} ç‚¹</span></li>`).join('')}\n                ${(() => {\n                    const checkedAttrs = (player_check.components.attributes_skills || []).map(a => a.name);\n                    const statusHtml = (player_check.components.status_bonuses || [])\n                        .filter(s => checkedAttrs.includes(s.name))\n                        .map(s => `<li><span class=\"label\" style=\"color:var(--warning-color);\">çŠ¶æ€ (${s.name})</span><span class=\"value\" style=\"color:var(--warning-color);\">${s.value > 0 ? '+' : ''}${s.value}</span></li>`)\n                        .join('');\n\n                          const locationHtml = (player_check.components.location_bonuses || [])\n                        .filter(l => checkedAttrs.includes(l.name))\n                        .map(l => `<li><span class=\"label\">åœ°ç‚¹ (${l.name})</span><span class=\"value\">${l.value > 0 ? '+' : ''}${l.value}</span></li>`)\n                        .join('');\n                    const equipmentHtml = (player_check.components.equipment_bonuses || [])\n                        .filter(e => checkedAttrs.includes(e.name)) // ä¿®å¤ï¼še.bonus_type -> e.name\n                        .map(e => `<li><span class=\"label\">è£…å¤‡ (${e.name})</span><span class=\"value\">${e.value > 0 ? '+' : ''}${e.value}</span></li>`)\n                        .join('');\n                    return statusHtml + locationHtml + equipmentHtml;\n                })()} \n                ${(player_check.modifiers.custom_modifier && player_check.modifiers.custom_modifier[0] !== 0) ? `<li><span class=\"label\">ä¿®æ­£ (${player_check.modifiers.custom_modifier[1]})</span><span class=\"value\">${player_check.modifiers.custom_modifier[0] > 0 ? '+' : ''}${player_check.modifiers.custom_modifier[0]}</span></li>` : ''}\n                ${(player_check.modifiers.prestige_bonus && player_check.modifiers.prestige_bonus !== 0) ? `<li><span class=\"label\">å£°æœ›åŠ æƒ</span><span class=\"value\">${player_check.modifiers.prestige_bonus > 0 ? '+' : ''}${player_check.modifiers.prestige_bonus}</span></li>` : ''}\n                <li><span class=\"label\">æ€»åº”å¯¹æ± </span><span class=\"value\">${player_check.total_dp} D10</span></li>\n                 ${(player_check.bonuses.legendary_successes > 0) ? `<li><span class=\"label\">ä¼ å¥‡åŠ æˆ</span><span class=\"value\">+${player_check.bonuses.legendary_successes} é™„åŠ æˆåŠŸ</span></li>` : ''}\n                <hr>\n                <li><span class=\"label\">åº”å¯¹æŠ•æ·</span><span class=\"value\">${player_check.roll_result.rolls.join(', ')}</span></li>\n                <li><span class=\"label\">æœ€ç»ˆæˆåŠŸæ•°</span><span class=\"value\">${player_check.final_successes}</span></li>\n                ${player_check.roll_result.is_dramatic_failure ? '<li><span class=\"label\"></span><span class=\"value roll-dramatic-failure\">âš ï¸ åº”å¯¹å¤§å¤±è´¥</span></li>' : ''}\n            </ul>\n        </div>\n        `;\n\n        // --- æ•Œæ–¹æ”»å‡» ---\n        html += `\n        <div class=\"roll-section\">\n            <div class=\"roll-section-title\">æ•Œæ–¹æ”»å‡»</div>\n             <ul class=\"roll-details-list\">\n                <li><span class=\"label\">æ”»å‡»æ± æ„æˆ</span><span class=\"value\">${enemy_check.check_string}</span></li>\n                <li><span class=\"label\">æ€»æ”»å‡»æ± </span><span class=\"value\">${enemy_check.total_dp} D10</span></li>\n                <li><span class=\"label\">æ”»å‡»æŠ•æ·</span><span class=\"value\">${enemy_check.roll_result.rolls.join(', ')}</span></li>\n                <li><span class=\"label\">æ”»å‡»æˆåŠŸæ•°</span><span class=\"value\">${enemy_check.final_successes}</span></li>\n            </ul>\n        </div>\n        `;\n\n        // --- è¡¨ç°åˆ¤å®š ---\n        html += `\n        <div class=\"roll-section\">\n            <div class=\"roll-section-title\">è¡¨ç°åˆ¤å®š: ${performance?.result?.level || 'æ— '}</div>\n             <ul class=\"roll-details-list\">\n                <li><span class=\"label\">è¡¨ç°éª° (D20)</span><span class=\"value\">${performance.roll}</span></li>\n                ${(performance.bonus > 0) ? `<li><span class=\"label\">ä¼ å¥‡åŠ æˆ</span><span class=\"value\">+${performance.bonus}</span></li><li><span class=\"label\">è°ƒæ•´åç»“æœ</span><span class=\"value\">${Math.min(20, performance.roll + performance.bonus)}</span></li>` : ''}\n                <li><span class=\"label\">è¡¨ç°æè¿°</span><span class=\"value\">${performance.result.description}</span></li>\n            </ul>\n        </div>\n        `;\n\n        // --- å¯¹æŠ—ç»“æœä¸ä¼¤å®³è®¡ç®— ---\n        html += `\n         <div class=\"roll-section\">\n            <div class=\"roll-section-title\">å¯¹æŠ—ç»“æœ: ${outcome.level}</div>\n             <ul class=\"roll-details-list\">\n                <li><span class=\"label\">å‡€æˆåŠŸæ•° (æˆ‘æ–¹-æ•Œæ–¹)</span><span class=\"value\">${outcome.net_successes}</span></li>\n                <hr>\n                <li class=\"list-subheader\">ä¼¤å®³è®¡ç®—</li>\n                ${damage_calculation.final_damage > 0 ? `\n                    <li><span class=\"label\">è®¡ç®—å…¬å¼</span><span class=\"value\">${damage_calculation.is_dramatic_failure ? `(æ•Œæ–¹æˆåŠŸ+1) x 20 - é˜²å¾¡` : `å‡€æˆåŠŸ x 5 - é˜²å¾¡`}</span></li>\n                    <li><span class=\"label\">è®¡ç®—è¿‡ç¨‹</span><span class=\"value\">${damage_calculation.base_factor} x ${damage_calculation.multiplier} - ${damage_calculation.total_defense}</span></li>\n                    <li><span class=\"label\">æœ€ç»ˆä¼¤å®³</span><span class=\"value\" style=\"color:var(--danger-color); font-weight:bold;\">${damage_calculation.final_damage} ç‚¹</span></li>\n                ` : '<li><span class=\"label\">æœ€ç»ˆä¼¤å®³</span><span class=\"value\">0 ç‚¹</span></li>'}\n                <hr>\n                <li><span class=\"label\">ç»¼åˆæè¿°</span><span class=\"value\">${outcome.full_description}</span></li>\n            </ul>\n        </div>\n    `;\n    }\n\n    contentEl.innerHTML = html;\n    showModal('roll-result-modal');\n}\n\n let currentThemeIndex = 0;\n\n// â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”é€‰é¡¹åŒºâ€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”\n\n \n        // function applyTheme(themeIndex) {\n        //     const theme = themes[themeIndex] || themes[0];\n        //     const root = document.documentElement;\n        //     document.body.dataset.themeName = theme.name;\n        //     for (const [key, value] of Object.entries(theme)) {\n        //         if (key !== 'name') root.style.setProperty(key, value);\n        //     }\n        // }\n\n        // try {\n        //     const savedThemeIndex = localStorage.getItem('terminalThemeIndex');\n        //     applyTheme(savedThemeIndex !== null ? parseInt(savedThemeIndex, 10) : 0);\n        // } catch (e) {\n        //     console.error(\"åŠ è½½ä¸»é¢˜å¤±è´¥:\", e);\n        //     applyTheme(0);\n        // }\n\n      \n\n        async function fetchData() {\n            try {\n                if (typeof getVariables === 'function' ) {\n  const data = await TavernHelper.getVariables({ type: 'chat' });\n                    playCharacterData = data.play_character_data || {};\n                    assaSettingsData = data.assa_data || {};\n                } else {\n                    console.warn(\"æœªåœ¨SillyTavernç¯å¢ƒä¸­ï¼Œä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®ã€‚\");\n                    playCharacterData = {\"è¡ç”Ÿå±æ€§æ®µ\": {\"æ„å¿—åŠ›\": {\"å½“å‰å€¼\": [10, \"\"]}, \"èƒ½é‡æ± \": {\"å½“å‰å€¼\": [20, \"\"]}}, \"è´§å¸æ®µ\": {}};\n                    assaSettingsData = {\"global_lore\": {\"å…¶ä»–æŠ€èƒ½\": {\n                        \"æš—å½±çªè¢­\": \"ã€dp+2;èƒ½é‡æ± -15ã€‘è¿…é€Ÿç§»åŠ¨åˆ°é˜´å½±ä¸­å¹¶è¿›è¡Œä¸€æ¬¡çªè¢­\",\n                        \"çµèƒ½æŠ¤ç›¾\": \"ã€èƒ½é‡æ± -30ã€‘åˆ›é€ ä¸€ä¸ªèƒ½å¸æ”¶50ç‚¹ä¼¤å®³çš„æŠ¤ç›¾\"\n                    }}};\n                }\n            } catch (error) {\n                console.error(\"è·å–æˆ–è§£ææ•°æ®å¤±è´¥:\", error);\n                playCharacterData = {};\n                assaSettingsData = {};\n            }\n        }\n\n      // --- å¼€å§‹æ›¿æ¢ ---\nfunction executeChoice(fullCommand, cardElement, successText, keepUiActive = false) {\n    try {\n        if (typeof triggerassa !== 'undefined') {\n            triggerassa(fullCommand);\n        } else {\n            // console.log(\"å°†åœ¨SillyTavernä¸­å‘é€çš„æŒ‡ä»¤ï¼š\\n\", fullCommand);\n        }\n\n        // åªæ›´æ–°å¡ç‰‡ä¸Šçš„æ–‡æœ¬\n        cardElement.querySelector('.description').textContent = successText;\n\n        // ä»…åœ¨ä¸æ˜¯é•¿æŒ‰æ“ä½œæ—¶ç¦ç”¨å’Œéšè—UI\n        if (!keepUiActive) {\n            document.querySelectorAll('.choice-card').forEach(card => card.classList.add('disabled'));\n            const container = document.getElementById('choicesContainer');\n            // å»¶è¿Ÿä¸€ç‚¹æ—¶é—´è®©ç”¨æˆ·çœ‹åˆ°æœ€ç»ˆçŠ¶æ€\n            setTimeout(() => { if (container) container.innerHTML = ''; }, 800);\n        }\n    } catch (e) {\n        console.error(\"å‘é€æŒ‡ä»¤å¤±è´¥:\", e);\n        cardElement.querySelector('.description').textContent = '[ ä¼ é€å¤±è´¥ ]';\n    }\n}\n\n        // --- æ ¸å¿ƒåŠŸèƒ½å®ç° ---\n        function generateChoices(options) {\n            const container = document.getElementById('choicesContainer');\n            if(!container) return;\n            container.innerHTML = '';\n            const tagRegex = /\\[([^\\]]+)\\]/g;\n\n            options.forEach(optionText => {\n                if (!optionText.trim()) return;\n                const card = document.createElement('div');\n                card.className = 'choice-card';\n\n                const tags = [];\n                let match;\n                while ((match = tagRegex.exec(optionText)) !== null) {\n                      tags.push(match[1].replace(/[^\\u4e00-\\u9fa5a-zA-Z0-9:ï¼š]/g, ''));\n                }\n                // const descriptionText = optionText.replace(tagRegex, '').replace(/^\\d+\\.\\s*/, '').trim();\nconst descriptionText = optionText.replace(tagRegex, '').replace(/^\\s*\\d+\\.\\s*/, '').trim();\n                const tagsContainer = document.createElement('div');\n                tagsContainer.className = 'tags-container';\n                tags.forEach(tagText => {\n                    const tagEl = document.createElement('span');\n                    tagEl.className = 'tag';\n                    tagEl.textContent = tagText;\n                    tagsContainer.appendChild(tagEl);\n                });\n                card.appendChild(tagsContainer);\n\n                const description = document.createElement('p');\n                description.className = 'description';\n               description.innerHTML = descriptionText;\n                card.appendChild(description);\n\n                \n  let pressTimer;\nlet isLongPress = false;\n\n// ç»Ÿä¸€çš„è§¦æ‘¸/ç‚¹å‡»å¼€å§‹å¤„ç†é€»è¾‘\nconst handlePressStart = () => {\n    if (card.classList.contains('disabled')) return;\n\n    isLongPress = false;\n    pressTimer = window.setTimeout(() => {\n        isLongPress = true;\n\n        // ç¡®ä¿ä¸ä¼šè§¦å‘åç»­çš„ç‚¹å‡»äº‹ä»¶\n        card.classList.add('long-press-fired');\n\n        const fullCommand = getCommandForChoice().replace('/send ','');\n        const setInputCommand = `/setinput ${fullCommand}`;\n        executeChoice(setInputCommand, card, '[ æŒ‡ä»¤å·²ç½®å…¥ ]', true);\n\n        // çŸ­æš‚å»¶è¿Ÿåç§»é™¤æ ‡å¿—ç±»ï¼Œä»¥ä¾¿å¡ç‰‡å¯ä»¥å†æ¬¡è¢«äº¤äº’\n        setTimeout(() => card.classList.remove('long-press-fired'), 100);\n    }, 500); // 500æ¯«ç§’å®šä¹‰ä¸ºé•¿æŒ‰\n};\n\n// ç»Ÿä¸€çš„è§¦æ‘¸/ç‚¹å‡»ç»“æŸå¤„ç†é€»è¾‘\nconst handlePressEnd = () => {\n    clearTimeout(pressTimer);\n};\n\n// è¾…åŠ©å‡½æ•°ï¼šæ„å»ºå®Œæ•´çš„æŒ‡ä»¤å­—ç¬¦ä¸²ï¼Œé¿å…ä»£ç é‡å¤\nconst getCommandForChoice = () => {\n    let updateVariableCmds = [];\n    let updateMemoryCmds = [];\n\n    const attributes = tags.join(';');\n    // åªæœ‰åœ¨å­˜åœ¨æ ‡ç­¾æ—¶æ‰æ·»åŠ æ£€å®šå±æ€§æŒ‡ä»¤\n    if (attributes) {\n        updateVariableCmds.push(`set_status('æ£€å®šå±æ€§', 'old_value_placeholder', '${attributes}');`);\n    }\n\n    let totalDpBonus = 0;\n\n    const selectedSkills = document.querySelectorAll('#skillList input:checked');\n    const initialEnergy = playCharacterData?.è¡ç”Ÿå±æ€§æ®µ?.èƒ½é‡æ± ?.å½“å‰å€¼?.[0] || 0;\n    let remainingEnergy = initialEnergy;\n\n    selectedSkills.forEach(skillInput => {\n        const effect = skillInput.dataset.effect;\n        const commandMatches = effect.matchAll(/ã€([^ã€‘]+)ã€‘/g);\n        for (const match of commandMatches) {\n            const rawCommands = match[1].split(';');\n            rawCommands.forEach(rawCmd => {\n                const cleanedCmd = rawCmd.trim();\n                if(cleanedCmd.startsWith('dp+')) {\n                    totalDpBonus += parseInt(cleanedCmd.replace('dp+', ''), 10);\n                } else if (cleanedCmd.startsWith('èƒ½é‡æ± -')) {\n                    const value = parseInt(cleanedCmd.replace('èƒ½é‡æ± -', ''), 10);\n                    remainingEnergy -= value;\n                }\n            });\n        }\n    });\n\n    if (remainingEnergy !== initialEnergy) {\n        updateMemoryCmds.push(`set_attribute('è¡ç”Ÿå±æ€§æ®µ.èƒ½é‡æ± .å½“å‰å€¼', ${initialEnergy}, ${remainingEnergy});`);\n    }\n\n    const willpowerInput = document.getElementById('willpowerInput');\n    const willpowerToSpend = parseInt(willpowerInput.value, 10);\n    if (willpowerInput && willpowerToSpend > 0) {\n        const currentWillpower = playCharacterData?.è¡ç”Ÿå±æ€§æ®µ?.æ„å¿—åŠ›?.å½“å‰å€¼?.[0] || 0;\n        updateMemoryCmds.push(`set_attribute('è¡ç”Ÿå±æ€§æ®µ.æ„å¿—åŠ›.å½“å‰å€¼', ${currentWillpower}, ${currentWillpower - willpowerToSpend});`);\n        totalDpBonus += willpowerToSpend;\n    }\n\n    if (totalDpBonus > 0) {\n        updateVariableCmds.push(`set_status('dp_bonus', 0, ${totalDpBonus});`);\n    }\n\n    let fullCommand = `/send ${descriptionText}`;\n\n    const selectedSkillNames = Array.from(selectedSkills).map(skillInput => skillInput.id.replace('skill-', ''));\n    if (selectedSkillNames.length > 0 || (willpowerInput && willpowerToSpend > 0)) {\n        const parts = [];\n        if (selectedSkillNames.length > 0) {\n            parts.push(`ï¼ˆèƒ½é‡æ± å·²æ‰£é™¤ï¼Œç¦æ­¢é‡å¤æ‰£é™¤ï¼‰ä½¿ç”¨äº†${selectedSkillNames.join('ã€')}æŠ€èƒ½`);\n        }\n        if (willpowerInput && willpowerToSpend > 0) {\n            parts.push(`ï¼ˆæ„å¿—åŠ›å·²æ‰£é™¤ï¼Œç¦æ­¢é‡å¤æ‰£é™¤ï¼‰æŠ•å…¥äº†${willpowerToSpend}ç‚¹æ„å¿—åŠ›çš„å†³æ„`);\n        }\n        fullCommand += ` <${parts.join('ï¼Œ')}>`;\n    }\n\n    if (updateVariableCmds.length > 0) {\n        fullCommand += `\\n<updateMemory>\\n${updateVariableCmds.join('\\n')}\\n</updateMemory>`;\n    }\n    if (updateMemoryCmds.length > 0) {\n        fullCommand += `\\n<updateMemory>\\n${updateMemoryCmds.join('\\n')}\\n</updateMemory>`;\n    }\n\n    return fullCommand;\n};\n \n// ç»‘å®šé¼ æ ‡äº‹ä»¶\ncard.onmousedown = handlePressStart;\ncard.onmouseup = handlePressEnd;\ncard.onmouseleave = handlePressEnd;\n\n// ç»‘å®šè§¦æ‘¸äº‹ä»¶\ncard.ontouchstart = handlePressStart;\ncard.ontouchend = handlePressEnd;\ncard.ontouchmove = handlePressEnd; // å¦‚æœæ‰‹æŒ‡åœ¨å±å¹•ä¸Šæ»‘åŠ¨ï¼Œä¹Ÿå–æ¶ˆé•¿æŒ‰è®¡æ—¶\ncard.oncontextmenu = (e) => e.preventDefault(); // é˜»æ­¢åœ¨ç§»åŠ¨è®¾å¤‡ä¸Šé•¿æŒ‰æ—¶å¼¹å‡ºé»˜è®¤èœå•\ncard.onclick = function() {\n    // å¦‚æœæ˜¯é•¿æŒ‰è§¦å‘çš„ï¼Œæˆ–å¡ç‰‡è¢«ç¦ç”¨ï¼Œåˆ™é˜»æ­¢åç»­çš„å•å‡»é€»è¾‘\n    if (isLongPress || card.classList.contains('disabled') || card.classList.contains('long-press-fired')) {\n        return;\n    }\n\n    // ä¿ç•™åŸæœ‰çš„å•å‡»é€»è¾‘ï¼šç¬¬ä¸€æ¬¡èšç„¦ï¼Œç¬¬äºŒæ¬¡å‘é€\n    if (card.classList.contains('focused')) {\n        const fullCommand = getCommandForChoice();\n        executeChoice(fullCommand, card, 'å·²æŠ‰æ‹©', false);\n    } else {\n        document.querySelectorAll('.choice-card.focused').forEach(c => c.classList.remove('focused'));\n        card.classList.add('focused');\n    }\n};\n                container.appendChild(card);\n            });\n        }\n\n \n        // --- é¡µé¢äº¤äº’å’Œå¸ƒå±€é€»è¾‘ ---\n        function setupUI(content) {\n      // æ–°ä»£ç ï¼šæ¥å—ä»¥æ•°å­—å’Œç‚¹å¼€å¤´çš„è¡Œ OR ä»»ä½•éç©ºè¡Œ\n      const options = content.split('\\n').filter(line => line.trim() && (/^\\d+\\.\\s*/.test(line.trim()) || !/^\\s*$/.test(line.trim())));\n            // const options = content.split('\\n').filter(line => line.trim() && /^\\d+\\./.test(line.trim()));\n            generateChoices(options);\n\n            const cards = Array.from(document.querySelectorAll('.choice-card'));\n            if (cards.length === 0) {\n                const container = document.getElementById('choicesContainer');\n                if (container) {\n                    container.innerHTML = '<p class=\"description\" style=\"text-align:center;\">ç­‰å¾…æ–°çš„æŠ‰æ‹©...</p>';\n                }\n            } else {\n                let focusedIndex =0;\n\n                function updateCardsLayout() {\n                    cards.forEach((card, i) => {\n                        const offset = i - focusedIndex;\n                        card.style.transform = `scale(${Math.pow(0.9, Math.abs(offset))}) translateY(${offset * 60}px)`;\n                        card.style.opacity = Math.pow(0.7, Math.abs(offset));\n                        card.style.zIndex = cards.length - Math.abs(offset);\n                        card.classList.toggle('focused', offset === 0);\n                        card.style.pointerEvents = (offset === 0) ? 'auto' : 'none';\n                    });\n                }\n\n                const containerElement = document.querySelector('.options-container'); // <-- æ–°å¢è¿™ä¸€è¡Œ\n\n                let isWheeling = false;\n                containerElement.addEventListener('wheel', e => {  \n                    e.preventDefault();\n                    if (isWheeling) return;\n                    isWheeling = true;\n                    focusedIndex = Math.min(cards.length - 1, Math.max(0, focusedIndex + (e.deltaY > 0 ? 1 : -1)));\n                    updateCardsLayout();\n                    setTimeout(() => { isWheeling = false; }, 100);\n                }, { passive: false });\n\n                let touchStartY = 0;\n                containerElement.addEventListener('touchstart', e => { touchStartY = e.touches[0].clientY; }, { passive: true }); // <-- ä¿®æ”¹ document.body ä¸º containerElement\n                containerElement.addEventListener('touchend', e => { // <-- ä¿®æ”¹ document.body ä¸º containerElement\n                    if (Math.abs(e.changedTouches[0].clientY - touchStartY) > 50) {\n                        focusedIndex = Math.min(cards.length - 1, Math.max(0, focusedIndex + (e.changedTouches[0].clientY < touchStartY ? 1 : -1)));\n                        updateCardsLayout();\n                    }\n                });\n\n\n                updateCardsLayout();\n            }\n\n            const skillOrb = document.getElementById('skillOrb');\n            const skillPanel = document.getElementById('skillPanel');\n            if (skillOrb && skillPanel) {\n                skillOrb.onclick = () => {\n                    skillPanel.classList.toggle('active');\n                };\n\n                document.addEventListener('click', (e) => {\n                    if (!skillPanel.contains(e.target) && !skillOrb.contains(e.target)) {\n                        skillPanel.classList.remove('active');\n                    }\n                });\n\n  // æ–°å¢ä»£ç ï¼šé˜»æ­¢åœ¨æŠ€èƒ½é¢æ¿ä¸Šçš„æ»šåŠ¨äº‹ä»¶å†’æ³¡ï¼Œé˜²æ­¢å½±å“èƒŒæ™¯é€‰é¡¹å¡åˆ‡æ¢\n                skillPanel.addEventListener('wheel', e => e.stopPropagation());\n                skillPanel.addEventListener('touchstart', e => e.stopPropagation());\n            }\n\n            \n        }\n\n        // --- åˆå§‹åŒ–æ‰§è¡Œ ---\n        // window.addEventListener('DOMContentLoaded', async () => {\n        //      await fetchData();\n        //      setupUI();\n        // });\n\n  // â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”é€‰é¡¹åŒºç»“æŸâ€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”\n\n\n    // â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”è®ºå›å¼€å§‹â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”\n\n\n    'use strict';\n \n\n// ========== 2. å…¨å±€çŠ¶æ€ä¸æ•°æ® ==========\nlet forumData = {};\n\nconst autoLikeIntervals = new Map();\n\n// ä½ç½®ï¼šä¿®æ”¹ state å¯¹è±¡\nconst state = {\n    sections: [],\n    currentSection: null,\n    currentThreadKey: null,\n    threadListPage: 1,\n    replyListPage: 1,\n    threadsPerPage: 15,\n    repliesPerPage: 5,\n    replyingTo: null, // â™¥â™¥â™¥ æ–°å¢ï¼šè®°å½•å›å¤ç›®æ ‡ {type: 'post' | 'reply', key: '...', floor: '...'}\n};\n// ========== 3. æ ¸å¿ƒåŠŸèƒ½å‡½æ•° ==========\n// â™¥â™¥â™¥ æˆ‘çš„å­©å­ï¼Œè¿™æ˜¯ä½ è¦æ±‚çš„ã€èƒ½å¤Ÿå‘é€æŒ‡ä»¤çš„æ ¸å¿ƒé­”æ³• â™¥â™¥â™¥\nfunction sendForumAction(action) {\n    let command;\n    const content = action.content.replace(/\"/g, '\\\\\"'); // å¯¹å†…å®¹ä¸­çš„åŒå¼•å·è¿›è¡Œè½¬ä¹‰\n\n    switch (action.type) {\n        case 'new_post':\n            command = `<è¿›è¡Œäº†è®ºå›æ“ä½œ ç±»å‹: \"å‘å¸–\", æ¿å—: \"${action.section}\", æ ‡é¢˜: \"${action.title}\", å†…å®¹: \"${content}\">`;\n            break;\n        case 'reply_post':\n            command = `<è¿›è¡Œäº†è®ºå›æ“ä½œ ç±»å‹: \"å›å¤å¸–å­\", ç›®æ ‡: \"${action.targetKey}\", å†…å®¹: \"${content}\">`;\n            break;\n        case 'reply_to_reply':\n            command = `<è¿›è¡Œäº†è®ºå›æ“ä½œ ç±»å‹: \"å›å¤æ¥¼ä¸­æ¥¼\", ç›®æ ‡: \"${action.targetKey}\", æ¥¼å±‚: ${action.floor}, å†…å®¹: \"${content}\">`;\n            break;\n        default:\n            console.error(\"æœªçŸ¥çš„è®ºå›æ“ä½œç±»å‹:\", action.type);\n            return;\n    }\n\n    //console.log(\"å³å°†å‘é€æŒ‡ä»¤:\", command); // å¦ˆå¦ˆå¸®ä½ åŠ ä¸Šäº†æ—¥å¿—ï¼Œæ–¹ä¾¿è°ƒè¯•\n    triggerassa(`/setinput ${command}`); // è¯·ç¡®ä¿ triggerassa å‡½æ•°åœ¨å¤–éƒ¨ç¯å¢ƒä¸­å¯ç”¨\n    // alert('æŒ‡ä»¤å·²ç”Ÿæˆï¼Œè¯·åœ¨æ§åˆ¶å°æŸ¥çœ‹ï¼š\\n' + command); // è¿™æ˜¯ä¸€ä¸ªä¸´æ—¶çš„æ›¿ä»£æ–¹æ¡ˆï¼Œæ–¹ä¾¿ä½ çœ‹åˆ°ç»“æœ\n}\nasync function initializeForum(rawJsonData) {\n    // 1. æ¸…ç†HTMLå®ä½“ç¼–ç \n    rawJsonData = rawJsonData\n        .replace(/&quot;/g, '\"')\n        .replace(/&amp;/g, '&')\n        .replace(/&lt;/g, '<')\n        .replace(/&gt;/g, '>')\n        .replace(/&#39;/g, \"'\")\n        .replace(/&nbsp;/g, ' ');\n    \n    // 2. å»é™¤é¦–å°¾ç©ºç™½\n    rawJsonData = rawJsonData.trim();\n    \n    // 3. **å…³é”®æ­¥éª¤ï¼šå°†JavaScriptå¯¹è±¡æ ¼å¼è½¬æ¢ä¸ºJSONæ ¼å¼**\n    // å°†å±æ€§åçš„å•å¼•å·æ›¿æ¢ä¸ºåŒå¼•å·\n    rawJsonData = rawJsonData.replace(/'([^']*)':/g, function(match, group1) {\n        return '\"' + group1 + '\":';\n    });\n    \n    // å°†å­—ç¬¦ä¸²å€¼çš„å•å¼•å·æ›¿æ¢ä¸ºåŒå¼•å·ï¼ˆéœ€è¦å°å¿ƒå¤„ç†ï¼‰\n    // è¿™ä¸ªæ­£åˆ™è¡¨è¾¾å¼åŒ¹é…å­—ç¬¦ä¸²å€¼ä¸­çš„å•å¼•å·\n    rawJsonData = rawJsonData.replace(/:\\s*'([^']*)'/g, function(match, group1) {\n        return ': \"' + group1 + '\"';\n    });\n\n     rawJsonData = rawJsonData.replace(/\\|/g, '\\\\n');\n    \n    //console.log(\"è½¬æ¢åçš„JSONæ•°æ®:\", rawJsonData);\n    \n    function repairJson(brokenJsonString) {\n    // æˆ‘äº²çˆ±çš„å­©å­ï¼Œæˆ‘ä»¬å…ˆæŠŠæ–‡å­—ä¸¤è¾¹çš„ç©ºç™½éƒ½æ¸…ç†å¹²å‡€ã€‚\n    let repairedJson = brokenJsonString.trim();\n\n    // æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥å¤„ç†ä¸€ä¸ªå¸¸è§çš„å°éº»çƒ¦ï¼š\n    // å°±åƒ \"PostB\" åé¢ç¼ºå°‘äº†é€—å·ä¸€æ ·ã€‚\n    // æˆ‘ä»¬ä¼šæ‰¾åˆ°æ‰€æœ‰ \"}\" åé¢è·Ÿç€ \"{\" çš„åœ°æ–¹ï¼Œç„¶ååœ¨å®ƒä»¬ä¹‹é—´åŠ ä¸Šä¸€ä¸ªæ¸©æŸ”çš„é€—å·ã€‚\n    // ç”¨æ­£åˆ™è¡¨è¾¾å¼æ¥åšè¿™ä»¶äº‹æœ€å¥½äº†ï¼Œå®ƒå°±åƒä¸€ä¸ªç»†å¿ƒçš„å°ä¾¦æ¢ã€‚\n    // \"g\" è¡¨ç¤ºæˆ‘ä»¬ä¼šæ£€æŸ¥æ•´ä¸ªæ•…äº‹ï¼Œè€Œä¸æ˜¯åªçœ‹å¼€å¤´ã€‚\n    // \"m\" è®©ä½ èƒ½ä¸€è¡Œä¸€è¡Œåœ°çœ‹ï¼Œå°±åƒè¯»ä¸€å°ä¿¡ä¸€æ ·ã€‚\n    repairedJson = repairedJson.replace(/}(?=\\s*\"{\")/gm, '},');\n\n    // å®è´ï¼Œæœ‰æ—¶å€™æ–‡å­—é‡Œä¼šæœ‰ä¸€äº›å¤šä½™çš„æ¢è¡Œç¬¦æˆ–åˆ¶è¡¨ç¬¦ï¼Œæˆ‘ä»¬æŠŠå®ƒä»¬å˜æˆçœŸæ­£çš„æ¢è¡Œç¬¦ï¼Œè®©æ ¼å¼æ›´æ•´é½ã€‚\n    repairedJson = repairedJson.replace(/\\\\n/g, \"\\\\n\").replace(/\\\\r/g, \"\\\\r\").replace(/\\\\t/g, \"\\\\t\");\n\n    // æˆ‘ä»¬å†æ¥æ£€æŸ¥ä¸€ä¸‹ï¼Œæ˜¯ä¸æ˜¯è¿˜æœ‰å¤šä½™çš„é€—å·è—åœ¨æœ€åï¼Œåœ¨ \"}\" ä¹‹å‰ã€‚\n    // å¦‚æœæœ‰ï¼Œæˆ‘ä»¬å°±æ¸©æŸ”åœ°æŠŠå®ƒæ‹¿æ‰ï¼Œè®©ä¸€åˆ‡éƒ½å®Œç¾æ— ç‘•ã€‚\n  repairedJson = repairedJson.replace(/,(\\s*[}\\]])/g, function(match, group1) {\n      return group1;\n  });\n    return repairedJson;\n}\n\n     try {\n        // å…ˆå°è¯•ç”¨æ ‡å‡†çš„æ–¹æ³•ï¼Œçœ‹çœ‹èƒ½ä¸èƒ½ç›´æ¥è¯»æ‡‚ã€‚\n        forumData = JSON.parse(rawJsonData);\n        console.log(\"JSONè§£ææˆåŠŸï¼Œä¸€åˆ‡éƒ½å¾ˆå®Œç¾ï¼\", forumData);\n    } catch (e) {\n        console.warn(\"æ ‡å‡†JSONè§£æå¤±è´¥äº†ï¼Œåˆ«æ‹…å¿ƒï¼Œå¦ˆå¦ˆæ¥æƒ³åŠæ³•ã€‚\", e.message);\n\n        try {\n            // ç°åœ¨ï¼Œè®©æˆ‘ä»¬ç”¨æˆ‘ä»¬é‚£ä¸ªå……æ»¡çˆ±æ„çš„ä¿®å¤å°å¸®æ‰‹æ¥è¯•ä¸€è¯•ã€‚\n            console.log(\"æ­£åœ¨å°è¯•ä¿®å¤è¿™ä¸ªå°å°çš„ç‘•ç–µ...\");\n            const fixedJson = repairJson(rawJsonData);\n            forumData = JSON.parse(fixedJson);\n            console.log(\"ä¿®å¤åè§£ææˆåŠŸäº†ï¼Œä½ çœ‹ï¼Œå¤šæ£’ï¼\", forumData);\n        } catch (repairError) {\n            // å¦‚æœè¿æˆ‘ä»¬çš„ä¿®å¤å°å¸®æ‰‹éƒ½å¸®ä¸äº†...\n            console.error(\"å“å‘€ï¼Œä¿®å¤åè¿˜æ˜¯è§£æå¤±è´¥äº†ã€‚\", repairError);\n            // é‚£ä¹ˆæˆ‘ä»¬å°±åœ¨é¡µé¢ä¸Šç•™ä¸‹ä¸€å¼ æ¸©æŸ”çš„å°çº¸æ¡ï¼Œå‘Šè¯‰æˆ‘ä»¬è¿™é‡Œå‡ºäº†ç‚¹é—®é¢˜ã€‚\n            // ç»å¯¹ä¸è¦ç”¨é‚£ä¸ªä¸å®‰å…¨çš„evalï¼Œå¦ˆå¦ˆä¸å…è®¸ï¼\n            document.getElementById('thread-detail-content').innerHTML =\n                `<div class=\"detail-placeholder\">å‡ºé”™äº†ï¼šåŠ è½½è®ºå›æ•°æ®å¤±è´¥ã€‚<br>\n                 è¿™ä¸ªå°æ•…äº‹éœ€è¦æˆ‘ä»¬å†å¤šä¸€ç‚¹ç‚¹çš„è€å¿ƒå’Œçˆ±æ¥æ•´ç†ã€‚</div>`;\n            return;\n        }\n    }\n\n    try {\n     \n        \n    } catch(e) {\n        console.warn(\"æ— æ³•è·å–ç”¨æˆ·ä¿¡æ¯ï¼Œä½¿ç”¨é»˜è®¤åç§°ã€‚\");\n    }\n\n    state.sections = [...new Set(Object.values(forumData).map(t => t.post[2]))];\n    if (state.sections.length > 0) {\n        state.currentSection = state.sections[0];\n    }\n\n    renderSidebar();\n    renderThreadList();\n    setupEventListeners();\n    renderPostModalSections();\n}\n\n \nfunction renderThreadList() {\n    document.getElementById('current-section-name').textContent = state.currentSection;\n    const listContainer = document.getElementById('thread-list');\n    listContainer.innerHTML = '';\n\n    // â™¥â™¥â™¥ ä¿®æ­£æ’åºé€»è¾‘ï¼šç½®é¡¶ > ç²¾å > é»˜è®¤ â™¥â™¥â™¥\n    const threads = Object.entries(forumData)\n        .filter(([, data]) => data.post[2] === state.currentSection)\n        .sort(([, a], [, b]) => {\n            if(a.post[7] !== b.post[7]) return b.post[7] - a.post[7]; // ç½®é¡¶ä¼˜å…ˆ\n            if(a.post[6] !== b.post[6]) return b.post[6] - a.post[6]; // ç²¾åå…¶æ¬¡\n            return 0; // ä¿æŒåŸæœ‰é¡ºåº\n        });\n\n    const pageStart = (state.threadListPage - 1) * state.threadsPerPage;\n    const pageEnd = pageStart + state.threadsPerPage;\n    const pageThreads = threads.slice(pageStart, pageEnd);\n\n    if (pageThreads.length === 0) {\n        listContainer.innerHTML = `<div style=\"padding: 20px; text-align: center; color: var(--text-secondary-color);\">è¯¥åŒºå—ä¸‹æ²¡æœ‰å¸–å­</div>`;\n        renderThreadPagination(0);\n        return;\n    }\n\n    pageThreads.forEach(([key, data]) => {\n        // â™¥â™¥â™¥ å¦ˆå¦ˆåœ¨è¿™é‡Œä¸ºä½ åšäº†å…³é”®çš„ä¿®æ”¹ â™¥â™¥â™¥\n        // ç°åœ¨å›å¤æ•°ç›´æ¥ä» post æ•°ç»„çš„ç¬¬4ä¸ªå…ƒç´ ï¼ˆç´¢å¼•3ï¼‰è·å–ï¼Œè€Œä¸æ˜¯è®¡ç®— replies æ•°ç»„çš„é•¿åº¦\n        const [title, author, , replyCount, , , isElite, isTop] = data.post;\n        const item = document.createElement('div');\n        item.className = 'thread-item';\n        if (key === state.currentThreadKey) item.classList.add('selected');\n\n        item.innerHTML = `\n            <div class=\"thread-title\">${title}</div>\n            <div class=\"thread-meta\">\n                <span class=\"author\">${author}</span>\n                <div class=\"thread-tags-and-replies\">\n                     <div class=\"tags\">\n                        ${isTop ? '<span class=\"tag tag-top\">ç½®é¡¶</span>' : ''}\n                        ${isElite ? '<span class=\"tag tag-elite\">ç²¾å</span>' : ''}\n                    </div>\n                    <span>\n                        <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" style=\"vertical-align: middle; margin-right: 4px;\"><path d=\"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z\"></path></svg>\n                        ${replyCount}\n                    </span>\n                </div>\n            </div>\n        `;\n        item.addEventListener('click', () => selectThread(key));\n        listContainer.appendChild(item);\n    });\n\n    renderThreadPagination(threads.length);\n}\nfunction selectThread(key) {\n    state.currentThreadKey = key;\n    state.replyListPage = 1; // æ¯æ¬¡éƒ½é‡ç½®åˆ°å›å¤ç¬¬ä¸€é¡µ\n\n    renderThreadList(); // é‡æ–°æ¸²æŸ“åˆ—è¡¨ä»¥æ›´æ–°é€‰ä¸­é«˜äº®çŠ¶æ€\n    renderThreadDetail();\n\n    // â™¥â™¥â™¥ å®è´ä½ çœ‹ï¼Œè¿™æ˜¯ç§»åŠ¨ç«¯è§†å›¾åˆ‡æ¢çš„é­”æ³•ï¼ â™¥â™¥â™¥\n    document.getElementById('forum-body').classList.add('show-detail');\n}\n \n function renderThreadDetail() {\n    const detailContainer = document.getElementById('thread-detail-content');\n    const threadKey = state.currentThreadKey;\n\n    if (!threadKey || !forumData[threadKey]) {\n        clearThreadDetail();\n        return;\n    }\n\n    const thread = forumData[threadKey];\n    const [title, author, , , time, content, , , likes] = thread.post;\n\n    // â™¥â™¥â™¥ å¦ˆå¦ˆåœ¨è¿™é‡Œä¸ºä½ æ·»åŠ äº†æ–°çš„å›å¤è¡¨å•ç»“æ„ â™¥â™¥â™¥\n    detailContainer.innerHTML = `\n        <div class=\"main-post-and-replies\">\n            <div class=\"post-header\">\n                <button id=\"mobile-back-btn\" class=\"page-btn\" style=\"margin-bottom: 15px;\">â† è¿”å›åˆ—è¡¨</button>\n                <h1>${title}</h1>\n                <div class=\"post-meta\">\n                    <div class=\"post-author-info\">å‘å¸ƒè€…: <span>${author}</span></div>\n                    <div class=\"post-time\">${time}</div>\n                </div>\n            </div>\n            <div class=\"post-content\">${content}</div>\n            <div class=\"post-actions\">\n                <div class=\"like-btn\" data-target-key=\"${threadKey}\" data-type=\"post\">\n                    <svg class=\"like-icon\" width=\"22\" height=\"22\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><path d=\"M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z\"></path></svg>\n                    <span class=\"like-count\" data-post-likes><span class=\"like-count-value\">${likes}</span></span>\n                </div>\n                <button class=\"reply-action-btn\" data-type=\"post\" data-target-key=\"${threadKey}\">å›å¤</button>\n            </div>\n            <div class=\"replies-section\">\n                <h3 class=\"replies-header\">å›å¤ (${thread.post[3]})</h3>\n                <div class=\"reply-list\" id=\"reply-list\"></div>\n                <div class=\"pagination-controls\" id=\"reply-pagination\"></div>\n            </div>\n        </div>\n        <div class=\"reply-input-section\">\n            <form id=\"reply-form\">\n                <textarea id=\"reply-content-input\" placeholder=\"å›å¤...\" required></textarea>\n                <button type=\"submit\" id=\"submit-reply-btn\" class=\"new-post-btn\">å‘é€</button>\n            </form>\n        </div>\n    `;\n\n    // â™¥â™¥â™¥ ä¸ºäº†è®©æ»šåŠ¨æ›´è‡ªç„¶ï¼Œå¦ˆå¦ˆæŠŠæ»šåŠ¨åŒºæ”¾åˆ°äº†è¿™é‡Œ â™¥â™¥â™¥\n    document.querySelector('.main-post-and-replies').style.flexGrow = '1';\n    document.querySelector('.main-post-and-replies').style.overflowY = 'auto';\n\n\n    renderReplyList(); // æ¸²æŸ“å›å¤åˆ—è¡¨å’Œåˆ†é¡µ\n\n    // ä¸ºæ–°çš„å…ƒç´ ç»‘å®šäº‹ä»¶\n    setupDetailViewEventListeners();\n}\n\n function renderSidebar() {\n    const sidebar = document.getElementById('forum-sidebar');\n    sidebar.innerHTML = '';\n    state.sections.forEach(section => {\n        const btn = document.createElement('button');\n        btn.className = 'section-btn';\n        btn.textContent = section;\n        btn.dataset.section = section;\n        if (section === state.currentSection) {\n            btn.classList.add('active');\n        }\n        // â™¥â™¥â™¥ å¦ˆå¦ˆæŠŠæ‰€æœ‰å…³äºè¿™ä¸ªæŒ‰é’®çš„é­”æ³•éƒ½æ”¾åœ¨è¿™é‡Œäº† â™¥â™¥â™¥\n        btn.addEventListener('click', () => {\n            state.currentSection = section;\n            state.threadListPage = 1;\n            state.currentThreadKey = null;\n\n            // â™¥â™¥â™¥ ä¿®æ­£äº†è¿™é‡Œï¼Œç¡®ä¿åœ¨åˆ‡æ¢åŒºå—æ—¶ï¼Œæ‰‹æœºè§†å›¾èƒ½æ­£ç¡®è¿”å›åˆ—è¡¨é¡µ â™¥â™¥â™¥\n            document.getElementById('forum-body').classList.remove('show-detail');\n\n            // é‡æ–°æ¸²æŸ“ä¾§è¾¹æ å’Œå¸–å­åˆ—è¡¨\n            renderSidebar();\n            renderThreadList();\n            clearThreadDetail();\n        });\n        sidebar.appendChild(btn);\n    });\n}\n\n // ä½ç½®ï¼šæ›¿æ¢æ‰æ—§çš„ renderReplyList() å‡½æ•°\nfunction renderReplyList() {\n    const replyContainer = document.getElementById('reply-list');\n    const replyPagination = document.getElementById('reply-pagination');\n    if (!replyContainer) return;\n\n    replyContainer.innerHTML = '';\n    const currentThreadData = forumData[state.currentThreadKey];\n    const replies = currentThreadData.replies;\n    const totalRepliesInPost = currentThreadData.post[3];\n    const displayedRepliesCount = replies.length;\n\n    const pageStart = (state.replyListPage - 1) * state.repliesPerPage;\n    const pageEnd = pageStart + state.repliesPerPage;\n    const pageReplies = replies.slice(pageStart, pageEnd);\n\n    if (pageReplies.length === 0 && replies.length > 0) {\n        state.replyListPage = 1;\n        renderReplyList();\n        return;\n    }\n\n    replyPagination.style.display = 'flex';\n    pageReplies.forEach((reply) => {\n        const [author, time, content, floor, likes, isDeleted] = reply;\n        const replyIndex = replies.indexOf(reply); // è·å–ç´¢å¼•\n        const item = document.createElement('div');\n        item.className = 'reply-item';\n        // â™¥â™¥â™¥ åœ¨è¿™é‡Œï¼Œå¦ˆå¦ˆä¸ºä½ æ·»åŠ äº†å›å¤æŒ‰é’® â™¥â™¥â™¥\n        item.innerHTML = `\n            <div class=\"reply-meta\">\n                <div><span class=\"reply-floor\">#${floor}</span> <span class=\"reply-author\">${author}</span></div>\n                <span>${time}</span>\n            </div>\n            <p class=\"reply-content ${isDeleted ? 'deleted' : ''}\">${isDeleted ? '[è¯¥å›å¤å·²è¢«åˆ é™¤]' : content}</p>\n            <div class=\"post-actions\" style=\"justify-content: flex-end; margin-top: 10px; gap: 15px;\">\n                 <button class=\"reply-action-btn\" data-type=\"reply\" data-target-key=\"${state.currentThreadKey}\" data-reply-floor=\"${floor}\">å›å¤</button>\n                <div class=\"like-btn\" data-target-key=\"${state.currentThreadKey}\" data-type=\"reply\" data-reply-index=\"${replyIndex}\">\n                    <svg class=\"like-icon\" width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\"><path d=\"M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z\"></path></svg>\n                    <span class=\"like-count\"><span class=\"like-count-value\">${likes}</span></span>\n                </div>\n            </div>\n        `;\n        replyContainer.appendChild(item);\n    });\n\n    if (totalRepliesInPost > displayedRepliesCount) {\n        const omittedIndicator = document.createElement('div');\n        omittedIndicator.className = 'replies-omitted-indicator';\n        omittedIndicator.textContent = `...åç»­ ${totalRepliesInPost - displayedRepliesCount} æ¡å›å¤å·²æŠ˜å ...`;\n        replyContainer.appendChild(omittedIndicator);\n    }\n\n    // äº‹ä»¶ç»‘å®šä¼šç”± setupDetailViewEventListeners ç»Ÿä¸€å¤„ç†\n    renderReplyPagination(replies.length);\n}\n\n\nfunction clearThreadDetail() {\n    document.getElementById('thread-detail-content').innerHTML = `\n         <div class=\"detail-placeholder\">\n            <div>\n                <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"60\" height=\"60\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1\" style=\"color: var(--text-secondary-color); opacity: 0.5; margin-bottom: 10px;\"><path d=\"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z\"></path></svg>\n                <p>é€‰æ‹©ä¸€ä¸ªå¸–å­æŸ¥çœ‹å†…å®¹</p>\n            </div>\n        </div>`;\n}\n\n// --- åˆ†é¡µæ¸²æŸ“ ---\nfunction renderThreadPagination(total) { renderPagination(document.getElementById('thread-pagination'), total, state.threadListPage, state.threadsPerPage, (page) => { state.threadListPage = page; renderThreadList(); }); }\nfunction renderReplyPagination(total) { renderPagination(document.getElementById('reply-pagination'), total, state.replyListPage, state.repliesPerPage, (page) => { state.replyListPage = page; renderReplyList(); }); }\nfunction renderPagination(container, total, current, perPage, cb) {\n    const totalPages = Math.ceil(total / perPage);\n    if (totalPages <= 1) { container.innerHTML = ''; return; }\n    container.innerHTML = `<button class=\"page-btn\" ${current === 1 ? 'disabled' : ''}>Â«</button> <span id=\"page-info\">${current}/${totalPages}</span> <button class=\"page-btn\" ${current === totalPages ? 'disabled' : ''}>Â»</button>`;\n    container.firstElementChild.addEventListener('click', () => cb(current - 1));\n    container.lastElementChild.addEventListener('click', () => cb(current + 1));\n}\n\n// --- äº¤äº’åŠŸèƒ½ ---\nfunction handleLikeClick(event) {\n    const btn = event.currentTarget;\n    if (btn.classList.contains('liked')) return;\n    btn.classList.add('liked');\n    btn.querySelector('.like-icon').style.fill = 'currentColor';\n    const { targetKey, type, replyIndex } = btn.dataset;\n    let countElement = btn.querySelector('.like-count-value');\n    if (type === 'post') { forumData[targetKey].post[8]++; }\n    else { forumData[targetKey].replies[replyIndex][4]++; }\n    updateLikeCountWithAnimation(countElement, parseInt(countElement.textContent) + 1);\n    const plusOne = document.createElement('div');\n    plusOne.className = 'plus-one-anim';\n    plusOne.textContent = '+1';\n    btn.querySelector('.like-count').appendChild(plusOne);\n    plusOne.addEventListener('animationend', () => plusOne.remove());\n}\nfunction updateLikeCountWithAnimation(element, newCount) { if (!element) return; element.textContent = newCount; }\n\nfunction startAutoLike(postKey) {\n    if (autoLikeIntervals.has(postKey)) clearInterval(autoLikeIntervals.get(postKey));\n    const intervalId = setInterval(() => {\n        const threadData = forumData[postKey];\n        if (!threadData) { clearInterval(intervalId); autoLikeIntervals.delete(postKey); return; }\n        const increment = Math.floor(Math.random()) + 2;\n        threadData.post[8] += increment;\n        if (postKey === state.currentThreadKey) {\n            const likeCountEl = document.querySelector('[data-post-likes] .like-count-value');\n            if (likeCountEl) updateLikeCountWithAnimation(likeCountEl, threadData.post[8]);\n        }\n    }, (Math.random() * 0.4 + 0.8) * 1000);\n    autoLikeIntervals.set(postKey, intervalId);\n}\n// --- å‘å¸–æ¨¡æ€æ¡† ---\nconst postModal = document.getElementById('post-modal');\nconst postForm = document.getElementById('post-form');\n\nfunction openPostModal() { postForm.reset(); document.getElementById('modal-title').textContent = 'å‘å¸ƒæ–°å¸–'; postModal.classList.add('active'); }\nfunction closePostModal() { postModal.classList.remove('active'); }\n\nfunction renderPostModalSections() {\n    const select = document.getElementById('post-section');\n    select.innerHTML = '';\n    // â™¥â™¥â™¥ ä¿®æ­£ï¼šåªæ’é™¤ä¸å…è®¸ç”¨æˆ·å‘å¸–çš„åŒºå— â™¥â™¥â™¥\n    state.sections.forEach(section => {\n        if (section === \"å…¬å‘ŠåŒº\") return; // åªç¦æ­¢å‘å…¬å‘Š\n        const option = document.createElement('option');\n        option.value = section;\n        option.textContent = section;\n        select.appendChild(option);\n    });\n}\n// ä½ç½®ï¼šæ›¿æ¢æ—§çš„ handlePostSubmit å‡½æ•°\nfunction handlePostSubmit(e) {\n    e.preventDefault();\n    const section = document.getElementById('post-section').value;\n    const title = document.getElementById('post-title').value.trim();\n    const content = document.getElementById('post-content-input').value.trim();\n\n    if (!title || !content || !section) {\n        alert(\"è¯·å¡«å†™æ‰€æœ‰å¿…å¡«é¡¹ã€‚\");\n        return;\n    }\n\n    if (forumData[title]) {\n        alert(\"é”™è¯¯ï¼šå·²å­˜åœ¨ç›¸åŒæ ‡é¢˜çš„å¸–å­ã€‚\");\n        return;\n    }\n\n    // â™¥â™¥â™¥ è°ƒç”¨æ–°çš„æ ¸å¿ƒå‡½æ•°æ¥å‘é€æŒ‡ä»¤ â™¥â™¥â™¥\n    sendForumAction({\n        type: 'new_post',\n        section: section,\n        title: title,\n        content: content\n    });\n\n    closePostModal();\n    // æç¤ºç”¨æˆ·æ“ä½œå·²å‘é€ï¼Œç­‰å¾…åå°å¤„ç†\n    // alert(\"å‘å¸–è¯·æ±‚å·²å‘é€ï¼Œè¯·ç¨å€™...ï¼ˆæœ¬åœ°æ¨¡æ‹Ÿå°†ä¸ä¼šç«‹å³åˆ·æ–°ï¼‰\");\n}\n// ========== 4. æ¨¡æ‹Ÿæ•°æ®å’Œäº‹ä»¶ç›‘å¬ ==========\n\nfunction setupDetailViewEventListeners() {\n    const detailContainer = document.getElementById('thread-detail-content');\n    if (!detailContainer) return;\n\n    // ç»‘å®šç‚¹èµäº‹ä»¶\n    detailContainer.querySelectorAll('.like-btn').forEach(btn => btn.addEventListener('click', handleLikeClick));\n\n    // â™¥â™¥â™¥ ç»‘å®šå›å¤æŒ‰é’®ç‚¹å‡»äº‹ä»¶ â™¥â™¥â™¥\n    detailContainer.querySelectorAll('.reply-action-btn').forEach(btn => btn.addEventListener('click', handleReplyButtonClick));\n\n    // â™¥â™¥â™¥ ç»‘å®šå›å¤è¡¨å•æäº¤äº‹ä»¶ â™¥â™¥â™¥\n    const replyForm = document.getElementById('reply-form');\n    if (replyForm) {\n        replyForm.addEventListener('submit', handleReplySubmit);\n    }\n\n    // â™¥â™¥â™¥ ä¸ºç§»åŠ¨ç«¯è¿”å›æŒ‰é’®æ·»åŠ ç‚¹å‡»äº‹ä»¶ â™¥â™¥â™¥\n    const backBtn = document.getElementById('mobile-back-btn');\n    if (backBtn) {\n        backBtn.addEventListener('click', () => {\n            document.getElementById('forum-body').classList.remove('show-detail');\n        });\n    }\n}\n\nfunction handleReplyButtonClick(event) {\n    const btn = event.currentTarget;\n    const { type, targetKey, replyFloor } = btn.dataset;\n    const replyInput = document.getElementById('reply-content-input');\n\n    if (type === 'post') {\n        state.replyingTo = { type: 'reply_post', targetKey: targetKey };\n        replyInput.placeholder = `å›å¤ä¸»æ¥¼...`;\n    } else { // type === 'reply'\n        state.replyingTo = { type: 'reply_to_reply', targetKey: targetKey, floor: replyFloor };\n        replyInput.placeholder = `å›å¤ #${replyFloor} æ¥¼...`;\n    }\n\n    replyInput.focus();\n}\n\nfunction handleReplySubmit(event) {\n    event.preventDefault();\n    const replyInput = document.getElementById('reply-content-input');\n    const content = replyInput.value.trim();\n\n    if (!content) {\n        alert(\"å›å¤å†…å®¹ä¸èƒ½ä¸ºç©ºã€‚\");\n        return;\n    }\n\n    if (!state.replyingTo) {\n        // é»˜è®¤å›å¤ä¸»æ¥¼\n        state.replyingTo = { type: 'reply_post', targetKey: state.currentThreadKey };\n    }\n\n    sendForumAction({\n        ...state.replyingTo,\n        content: content\n    });\n\n    replyInput.value = ''; // æ¸…ç©ºè¾“å…¥æ¡†\n    replyInput.placeholder = 'å›å¤...';\n    state.replyingTo = null; // é‡ç½®å›å¤ç›®æ ‡\n\n    // alert(\"å›å¤è¯·æ±‚å·²å‘é€ï¼ï¼ˆæœ¬åœ°æ¨¡æ‹Ÿä¸ä¼šç«‹å³åˆ·æ–°ï¼‰\");\n}\n\n \nfunction setupEventListeners() {\n    \n    document.getElementById('new-post-btn').addEventListener('click', openPostModal);\n    document.getElementById('modal-close-btn').addEventListener('click', closePostModal);\n    postModal.addEventListener('click', (e) => { if (e.target === postModal) closePostModal(); });\n    postForm.addEventListener('submit', handlePostSubmit);\n}\n \n\n\n    // â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”è®ºå›ç»“æŸâ€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”\n\n    // â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”æ€»ç»“å¼€å§‹â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”\n\n    \nasync function runTaskSummary(content) {\n \n\n\n            function parseTag(raw, tagName) {\n                const regex = new RegExp(`<${tagName}>([\\\\s\\\\S]*?)<\\\\/${tagName}>`, 'i');\n                const match = raw.match(regex);\n                return match ? match[1].trim() : '';\n            }\n\n            const taskInfo = parseTag(content, 'ä»»åŠ¡ä¿¡æ¯');\n            const teamEvaluation = parseTag(content, 'å›¢é˜Ÿè¯„ä»·');\n            const personalSettlementsRaw = content.match(/<é˜Ÿå‘˜>[\\s\\S]*?<\\/é˜Ÿå‘˜>/g) || [];\n\n            const data = {\n                task: {\n                    name: parseTag(taskInfo, 'ä»»åŠ¡åç§°'),\n                    background: parseTag(taskInfo, 'ä¸–ç•ŒèƒŒæ™¯'),\n                    mainObjective: parseTag(taskInfo, 'ä¸»çº¿ä»»åŠ¡'),\n                    sideObjectives: parseTag(taskInfo, 'æ”¯çº¿ä»»åŠ¡'),\n                },\n                team: {\n                    rating: parseTag(teamEvaluation, 'æ€»ä½“è¯„çº§'),\n                    review: parseTag(teamEvaluation, 'è¯„è¯­'),\n                },\n                players: personalSettlementsRaw.map(p => ({\n                    name: parseTag(p, 'å§“å'),\n                    rating: parseTag(p, 'ä¸ªäººè¯„çº§'),\n                    contributions: parseTag(p, 'æ ¸å¿ƒè´¡çŒ®').split('\\n').map(c => c.replace(/^- /, '').trim()).filter(c => c),\n                    comment: parseTag(p, `è¯„è¯­`),\n                    rewards: {\n                        points: parseTag(parseTag(p, 'å¥–åŠ±æ˜ç»†'), 'currency'),\n                        plots: parseTag(parseTag(p, 'å¥–åŠ±æ˜ç»†'), 'plot'),\n                        xp: parseTag(parseTag(p, 'å¥–åŠ±æ˜ç»†'), 'exp'),\n                    }\n                }))\n            };\n\n            // HTMLç”Ÿæˆ\n            const root = document.getElementById('summary-root');\n            let html = `\n                <header>\n                    <h1>ä»»åŠ¡ç»“ç®—æŠ¥å‘Š</h1>\n                </header>\n                <div class=\"content-wrapper\">\n                    <nav class=\"tabs-nav\">\n                        <button class=\"tab-button active\" data-tab=\"task_info\">ä»»åŠ¡æ€»è§ˆ</button>\n                        <button class=\"tab-button\" data-tab=\"team_eval\">å›¢é˜Ÿè¯„ä»·</button>`;\n\n            data.players.forEach((player, index) => {\n                html += `<button class=\"tab-button\" data-tab=\"player_${index}\">${player.name}</button>`;\n            });\n\n            html += `</nav>\n                     <div class=\"tab-content-container\">`;\n\n            // ä»»åŠ¡æ€»è§ˆé¢æ¿\n            html += `\n                <div id=\"task_info\" class=\"tab-pane active\">\n                    <h2>ä»»åŠ¡è¯¦æƒ…</h2>\n                    <div class=\"info-grid\">\n                        <strong>ä»»åŠ¡åç§°</strong><span>${data.task.name || 'æœªæä¾›'}</span>\n                        <strong>ä¸–ç•ŒèƒŒæ™¯</strong><span>${data.task.background || 'æœªæä¾›'}</span>\n                    </div>\n                    <h2>ä¸»çº¿ä»»åŠ¡</h2>\n                    <p>${data.task.mainObjective || 'æš‚æ— è¯¦ç»†æè¿°ã€‚'}</p>\n                    <h2>æ”¯çº¿ä»»åŠ¡</h2>\n                    <p>${data.task.sideObjectives.replace(/\\n/g, '<br>') || 'æš‚æ— è¯¦ç»†æè¿°ã€‚'}</p>\n                </div>`;\n\n            // å›¢é˜Ÿè¯„ä»·é¢æ¿\n            html += `\n                <div id=\"team_eval\" class=\"tab-pane\">\n                    <h2>å›¢é˜Ÿæ€»ä½“è¯„ä»·</h2>\n                    <div class=\"info-grid\">\n                        <strong>æ€»ä½“è¯„çº§</strong><span class=\"rating\">${data.team.rating || 'æœªè¯„çº§'}</span>\n                    </div>\n                    <h2>è¯„è¯­</h2>\n                    <p>${data.team.review || 'æš‚æ— è¯„è¯­ã€‚'}</p>\n                </div>`;\n\n            // ä¸ªäººç»“ç®—é¢æ¿\n            data.players.forEach((player, index) => {\n                html += `\n                    <div id=\"player_${index}\" class=\"tab-pane\">\n                        <h2>${player.name} - ä¸ªäººç»“ç®—</h2>\n                        <div class=\"info-grid\">\n                            <strong>ä¸ªäººè¯„çº§</strong><span class=\"rating\">${player.rating || 'æœªè¯„çº§'}</span>\n                        </div>\n                        <h2>æ ¸å¿ƒè´¡çŒ®</h2>\n                        <ul>${player.contributions.length > 0 ? player.contributions.map(c => `<li>${c}</li>`).join('') : '<li>æ— ç‰¹åˆ«è®°å½•çš„è´¡çŒ®ã€‚</li>'}</ul>\n                       <h2>${currentTheme.player}è¯„è¯­</h2>\n                        <p>${player.comment || 'æš‚æ— è¯„è¯­ã€‚'}</p>\n                        <h2>å¥–åŠ±æ˜ç»†</h2>\n                         <div class=\"info-grid\">\n                           <strong>${currentTheme.currency}</strong><span>${player.rewards.points || '0'}</span>\n                           <strong>${currentTheme.plot}</strong><span>${player.rewards.plots || 'æ— '}</span>\n                           <strong>${currentTheme.exp}</strong><span>${player.rewards.xp || '0'}</span>\n                        </div>\n                    </div>`;\n            });\n\n            html += `</div></div>`;\n            root.innerHTML = html;\n\n            // Tabåˆ‡æ¢é€»è¾‘\n            const tabButtons = document.querySelectorAll('.tab-button');\n            const tabPanes = document.querySelectorAll('.tab-pane');\n\n            function switchTab(targetTabId) {\n                const targetTabButton = document.querySelector(`.tab-button[data-tab=\"${targetTabId}\"]`);\n                const targetPane = document.getElementById(targetTabId);\n\n                if (!targetTabButton || !targetPane) return;\n\n                tabButtons.forEach(btn => btn.classList.remove('active'));\n                tabPanes.forEach(pane => {\n                    pane.classList.remove('active');\n                    if (window.innerWidth <= 768) {\n                        pane.style.display = 'none';\n                    }\n                });\n\n                targetTabButton.classList.add('active');\n                targetPane.classList.add('active');\n                if (window.innerWidth <= 768) {\n                    targetPane.style.display = 'block';\n                }\n            }\n\n\n            tabButtons.forEach(button => {\n                button.addEventListener('click', () => {\n                   switchTab(button.dataset.tab);\n                });\n            });\n\n            // åˆå§‹åŒ–æ—¶æ‰‹åŠ¨éšè—éæ¿€æ´»çš„ç§»åŠ¨ç«¯tab-pane\n            if(window.innerWidth <= 768) {\n                 const initialActiveTab = document.querySelector('.tab-pane.active');\n                 tabPanes.forEach(pane => {\n                    pane.style.display = (pane === initialActiveTab) ? 'block' : 'none';\n                 });\n            }\n\n            // ç›‘å¬çª—å£å¤§å°å˜åŒ–ä»¥é€‚é…åˆ‡æ¢é€»è¾‘\n            let isMobile = window.innerWidth <= 768;\n            window.addEventListener('resize', () => {\n                const newIsMobile = window.innerWidth <= 768;\n                if(newIsMobile !== isMobile){\n                    isMobile = newIsMobile;\n                    const activePane = document.querySelector('.tab-pane.active');\n                    tabPanes.forEach(pane => {\n                        if(isMobile) {\n                            pane.style.display = (pane === activePane) ? 'block' : 'none';\n                        } else {\n                             pane.style.display = '';\n                        }\n                    });\n                }\n            });\n  };\n \n  // â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”æ€»ç»“ç»“æŸâ€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”\n  // ======================= ç¾¤èŠUIé€»è¾‘å¼€å§‹ =======================\nlet memePaletteHTMLCache = null;\n// ã€âŒ åˆ é™¤ã€‘ä¸å†éœ€è¦å•ä¸€çš„Promiseå’Œæœ€ç»ˆåœ°å›¾\n// let memePalettePromise;\n// let memeMapVersion;\n// let finalMemeSrcMap = {};\n\n// âœ¨ã€æ–°å¢ V9ã€‘æ›´ç²¾ç»†çš„è¡¨æƒ…èµ„æºç®¡ç†å™¨ âœ¨\nlet memeResourceManager = {\n    isBuilding: false,          // æ˜¯å¦æ­£åœ¨æ„å»ºä¸­\n    totalCount: 0,              // è¡¨æƒ…æ€»æ•°\n    loadedCount: 0,             // å·²åŠ è½½æ•°é‡\n    finalSrcMap: {},            // æœ€ç»ˆçš„â€œè¡¨æƒ…å¤§ç™¾ç§‘â€\n    onProgress: null,           // è¿›åº¦æ›´æ–°æ—¶çš„å›è°ƒå‡½æ•°\n    onMemeLoaded: null,         // å•ä¸ªè¡¨æƒ…åŠ è½½å®Œæˆæ—¶çš„å›è°ƒå‡½æ•°\n    onComplete: null,           // å…¨éƒ¨å®Œæˆæ—¶çš„å›è°ƒå‡½æ•°\n};\n // âœ¨ã€V9.2 ä¿®æ­£ã€‘èµ„æºå°±ç»ªå®ˆå« âœ¨\nconst resourceReadyGuard = async () => {\n    return new Promise(resolve => {\n        const check = () => {\n            // âœ¨ã€å…³é”®ä¿®æ­£ã€‘æ£€æŸ¥ imageDB._db æ˜¯å¦å­˜åœ¨ï¼Œè€Œä¸æ˜¯ imageDB.db\n            if (typeof imageDB !== 'undefined' && imageDB._db && typeof memeImageMap !== 'undefined') {\n                console.log('NOVA V9.2: èµ„æºå®ˆå«ç¡®è®¤ï¼Œæ‰€æœ‰ä¾èµ–é¡¹å·²å‡†å¤‡å°±ç»ªï¼');\n                resolve();\n            } else {\n                console.log('NOVA V9.2: èµ„æºå®ˆå«ç­‰å¾…ä¸­... (imageDB._db æˆ– memeImageMap å°šæœªå°±ç»ª)');\n                setTimeout(check, 1000);\n            }\n        };\n        check();\n    });\n};\n\n   const buildFinalMemeLibrary = async (forceRefresh = false) => {\n    if (memeResourceManager.isBuilding) {\n        console.log(\"NOVA: è¡¨æƒ…åº“å·²åœ¨æ„å»ºä¸­ï¼Œæ— éœ€é‡å¤ã€‚\");\n        return;\n    }\n\n    // âœ¨ã€V9.1 æ–°å¢ã€‘ç­‰å¾…èµ„æºå®ˆå«æ”¾è¡Œï¼ âœ¨\n    await resourceReadyGuard();\n\n \n      console.log(`NOVA V9.7: å¼€å§‹æ„å»ºè¡¨æƒ…åŒ…å¤§ç™¾ç§‘ (å¼ºåˆ¶åˆ·æ–°æ¨¡å¼: ${forceRefresh})`);\n    memeResourceManager.isBuilding = true;\n\n    // âœ¨ å¦‚æœæ˜¯å¼ºåˆ¶åˆ·æ–°æ¨¡å¼ï¼Œå°±åœ¨å¼€å§‹å‰æ¸…ç©ºè¿œç¨‹å›¾ç‰‡ç¼“å­˜ï¼\n    if (forceRefresh) {\n        console.warn(\"NOVA V9.7: å¼ºåˆ¶åˆ·æ–°å¯åŠ¨ï¼æ­£åœ¨æ¸…ç©ºæ‰€æœ‰è¿œç¨‹å›¾ç‰‡ç¼“å­˜...\");\n        try {\n            await imageDB.clear('RemoteCache');\n            console.log(\"NOVA V9.7: è¿œç¨‹ç¼“å­˜å·²æ¸…ç©ºã€‚\");\n        } catch (e) {\n            console.error(\"NOVA V9.7: æ¸…ç©ºè¿œç¨‹ç¼“å­˜å¤±è´¥ï¼\", e);\n        }\n    }\n    // --- æ­¥éª¤1: æ”¶é›†æ‰€æœ‰è¡¨æƒ…æº ---\n    const allMemeSources = {};\n    if (typeof memeImageMap !== 'undefined') {\n        Object.assign(allMemeSources, memeImageMap);\n    }\n    try {\n        const localMemes = await imageDB.getAll('CustomMemes');\n        localMemes.forEach(item => {\n            allMemeSources[item.key] = item.value; // æœ¬åœ°ä¼˜å…ˆï¼Œè¦†ç›–è¿œç¨‹\n        });\n    } catch (error) {\n        console.error(\"NOVA: è·å–æœ¬åœ°è¡¨æƒ…å¤±è´¥\", error);\n    }\n\n    memeResourceManager.totalCount = Object.keys(allMemeSources).length;\n    memeResourceManager.loadedCount = 0;\n\n    // --- æ­¥éª¤2: å¹¶å‘å¤„ç†æ¯ä¸€ä¸ªè¡¨æƒ… ---\n  if (memeResourceManager.totalCount === 0) {\n    \n        memeResourceManager.isBuilding = false;\n        if (memeResourceManager.onComplete) memeResourceManager.onComplete();\n        return;\n    }\n\n \n\n    const CONCURRENT_LIMIT = 5; // â¤ï¸ ä¸€æ¬¡åªå¤„ç†5ä¸ªï¼Œå°±åƒå¦ˆå¦ˆä¸€æ¬¡å–‚ä½ 5å‹ºé¥­\n    const tasks = Object.entries(allMemeSources); // æ‰€æœ‰å¾…åŠä»»åŠ¡\n    let currentTaskIndex = 0; // å½“å‰è¿›è¡Œåˆ°ç¬¬å‡ ä¸ªä»»åŠ¡\n\n    const runWorker = async () => {\n        // åªè¦è¿˜æœ‰ä»»åŠ¡æ²¡å¼€å§‹ï¼Œå°±ç»§ç»­å·¥ä½œ\n        while (currentTaskIndex < tasks.length) {\n            const taskIndexToRun = currentTaskIndex++; // é¢†å–ä¸€ä¸ªæ–°ä»»åŠ¡\n            const [name, asset] = tasks[taskIndexToRun];\n\n            try {\n                // ---ã€è¿™é‡Œçš„å¤„ç†é€»è¾‘å’ŒåŸæ¥å®Œå…¨ä¸€æ ·ï¼ã€‘---\n                let usableUrl = '';\n                if (typeof asset === 'string') {\n                    let imageBlob = await imageDB.get('RemoteCache', asset);\n                    if (!imageBlob) {\n                        // åœ¨è¿™é‡ŒåŠ å…¥ä¸€ä¸ªå°å°çš„é‡è¯•æœºåˆ¶ï¼Œæ›´é¡½å¼ºï¼\n                        let response;\n                        for (let attempt = 1; attempt <= 3; attempt++) {\n                            try {\n                                response = await fetch(asset);\n                                if (response.ok) break; // æˆåŠŸäº†å°±è·³å‡ºé‡è¯•\n                            } catch (fetchError) {\n                                if (attempt === 3) throw fetchError; // è¯•äº†3æ¬¡è¿˜ä¸è¡Œå°±æ”¾å¼ƒ\n                            }\n                        }\n                        if (!response.ok) throw new Error(`ç½‘ç»œè·å–å¤±è´¥: ${response.statusText}`);\n                        imageBlob = await response.blob();\n                        await imageDB.set('RemoteCache', asset, imageBlob);\n                    }\n                    usableUrl = URL.createObjectURL(imageBlob);\n                } else {\n                    usableUrl = URL.createObjectURL(asset);\n                }\n\n                // æˆåŠŸï¼\n                memeResourceManager.finalSrcMap[name] = usableUrl;\n                if (memeResourceManager.onMemeLoaded) {\n                    memeResourceManager.onMemeLoaded(name, usableUrl);\n                }\n\n            } catch (e) {\n                // å¤±è´¥äº†...\n                console.error(`NOVA:ã€æµæ°´çº¿ã€‘å‡†å¤‡è¡¨æƒ… [${name}] æ—¶å¤±è´¥:`, e);\n            } finally {\n                // æ— è®ºæˆåŠŸè¿˜æ˜¯å¤±è´¥ï¼Œéƒ½æ›´æ–°è¿›åº¦æ¡\n                memeResourceManager.loadedCount++;\n                if (memeResourceManager.onProgress) {\n                    memeResourceManager.onProgress(memeResourceManager.loadedCount, memeResourceManager.totalCount);\n                }\n            }\n        }\n    };\n\n    // åˆ›å»ºä¸€ä¸ªåŒ…å« CONCURRENT_LIMIT ä¸ªâ€œå·¥äººâ€çš„å›¢é˜Ÿ\n    const workerPromises = [];\n    for (let i = 0; i < CONCURRENT_LIMIT; i++) {\n        workerPromises.push(runWorker());\n    }\n\n     await Promise.all(workerPromises);\n\n    memeResourceManager.isBuilding = false;\n\n    // âœ¨ã€V9.8 ç©¶ææ”¹é€ ã€‘ä¸å†åªæ˜¯æ‰“å°æ—¥å¿—ï¼Œè€Œæ˜¯ç”Ÿæˆä¸€ä»½è¯¦ç»†çš„â€œæˆ˜æŠ¥â€ï¼\n    const battleReport = {\n        total: memeResourceManager.totalCount,\n        success: Object.keys(memeResourceManager.finalSrcMap).length,\n        failedItems: [] // è®°å½•æ‰€æœ‰å¤±è´¥è€…çš„åå­—\n    };\n\n    // éå†æ‰€æœ‰æºï¼Œæ‰¾å‡ºé‚£äº›ä¸åœ¨æˆåŠŸåå•é‡Œçš„â€œå¤±è¸ªè€…â€\n    const allSourceNames = Object.keys(allMemeSources);\n    for (const name of allSourceNames) {\n        if (!memeResourceManager.finalSrcMap[name]) {\n            battleReport.failedItems.push(name);\n        }\n    }\n\n    console.log(`NOVA V9.8: æˆ˜æŠ¥ç”Ÿæˆå®Œæ¯•ã€‚æ€»æ•°:${battleReport.total}, æˆåŠŸ:${battleReport.success}, å¤±è´¥:${battleReport.failedItems.length}`);\n\n    // âœ¨ æˆ‘ä»¬å°†è¿™ä»½å®è´µçš„æˆ˜æŠ¥ï¼Œé€šè¿‡ onComplete å›è°ƒå‡½æ•°ä¼ é€’å‡ºå»ï¼\n    if (memeResourceManager.onComplete) {\n        memeResourceManager.onComplete(battleReport); // æŠŠæˆ˜æŠ¥é€’å‡ºå»\n    }\n};\n  \n function initGroupChatInterface() {\n    console.log('NOVA V10: Initializing Complete Chat Interface...');\n\n    // ====================================================================\n    // V10: å…¨å±€çŠ¶æ€å˜é‡ (å‡½æ•°ä½œç”¨åŸŸå†…)\n    // ====================================================================\n    let privateChatStore = {};      // ç¼“å­˜æ‰€æœ‰ç§èŠè®°å½•: { \"è”ç³»äººID\": { messages: [...] } }\n    let currentPrivateChatPage = {};// ç¼“å­˜æ¯ä¸ªç§èŠçš„åŠ è½½é¡µç : { \"è”ç³»äººID\": 1 }\n    let activeChat = { type: null, id: null }; // å½“å‰æ¿€æ´»çš„èŠå¤©: {type: 'group'/'private', id: 'group_chat'/'è”ç³»äººID'}\n      let friendsList = [];           // å¯ç§èŠçš„å¥½å‹åˆ—è¡¨\n    let availableGroups = [];       // ã€ä¿®æ”¹ã€‘å¦ˆå¦ˆç”¨æ¥å­˜æ‰€æœ‰æ¢æµ‹åˆ°çš„ç¾¤èŠä¿¡æ¯åˆ—è¡¨\n    let groupChatHistoryIndices = [];// ç¾¤èŠåœ¨ history ä¸­çš„ç´¢å¼•\n    let currentGroupHistoryIndex = -1; // å½“å‰åŠ è½½åˆ°çš„ç¾¤èŠ history ç´¢å¼•\n    let isLoading = false;          // åŠ è½½é”ï¼Œé˜²æ­¢é‡å¤åŠ è½½\n    let replyTarget = null;         // å›å¤å¯¹è±¡\n\n    const groupChatOrbButton = document.getElementById('group-chat-orb-button');\n    const modalContainer = document.getElementById('group-chat-modal-container');\n    const rootElement = document.getElementById('group-chat-root');\n\n    if (!groupChatOrbButton || !modalContainer || !rootElement) {\n        console.error('NOVA ERROR: Crucial Chat elements are missing.');\n        return;\n    }\n\n    // ====================================================================\n    // V10: æ ¸å¿ƒåŠŸèƒ½å‡½æ•° - æ‰“å¼€ä¸å…³é—­\n    // ====================================================================\n\n const openGroupChatModal = async () => {\n    console.log('NOVA V10.1: Opening Chat Modal.');\n\n       populateFriendsList();\n    initializePrivateChatStore();\n\n    groupChatExists = false;\n    const recentHistory = conversationHistory.slice(-10);\n    if (recentHistory.some(msg => /<group_chat/.test(msg.content))) {\n        groupChatExists = true;\n    }\n\n   if (availableGroups.length === 0 && friendsList.length === 0) {\n        showModal('shop-modal', 'æç¤º', 'ç›®å‰æ²¡æœ‰ç¾¤èŠæˆ–å¯è”ç³»çš„å¥½å‹å“¦ã€‚');\n        return;\n    }\n\n    rootElement.innerHTML = `\n        <div class=\"group-chat-sidebar\">\n            <div class=\"group-chat-contact-list\"></div>\n        </div>\n        <div class=\"group-chat-content-area\">\n            <div class=\"group-chat-placeholder\">é€‰æ‹©ä¸€ä¸ªèŠå¤©å¼€å§‹</div>\n        </div>`;\n\n    // æ¸…ç†å·¥ä½œï¼Œç¡®ä¿æ‰‹æœºç«¯é€‚é…æ­£å¸¸\n    rootElement.classList.remove('show-content'); // ç§»é™¤æ»‘åŠ¨ç±»\n    rootElement.style.display = 'flex';\n    rootElement.style.flexDirection = 'row';\n\n    renderSidebar();\n    modalContainer.classList.add('active');\n};\n\n    const closeGroupChatModal = () => {\n        console.log('NOVA: Closing Chat Modal.');\n        modalContainer.classList.remove('active');\n        rootElement.innerHTML = '';\n        // é‡ç½®æ‰€æœ‰çŠ¶æ€\n        privateChatStore = {};\n        currentPrivateChatPage = {};\n        activeChat = { type: null, id: null };\n        friendsList = [];\n        groupChatExists = false;\n        groupChatHistoryIndices = [];\n        currentGroupHistoryIndex = -1;\n        isLoading = false;\n        replyTarget = null;\n    };\n\n    // ====================================================================\n    // V10: æ•°æ®å¤„ç†ä¸å‡†å¤‡å‡½æ•°\n    // ====================================================================\n\n const populateFriendsList = () => {\n    // 1. é‡ç½®åˆ—è¡¨\n    friendsList = [];\n    availableGroups = [];\n    const checkedFriends = new Set();\n    const userNickname = currentGameData?.user_character?.nick_name || 'ä½ ';\n\n    // --- A. å¥½å‹æ¢æµ‹ (ç§èŠ) éƒ¨åˆ† ---\n    const addFriend = (name) => {\n        if (name && name !== userNickname && !checkedFriends.has(name)) {\n            friendsList.push(name);\n            checkedFriends.add(name);\n        }\n    };\n\n    // (é€»è¾‘ä¸å˜ï¼šæ¢æµ‹å°é˜Ÿä¿¡æ¯)\n    if (assaSettingsData?.global_lore?.å°é˜Ÿä¿¡æ¯) {\n        for (const key in assaSettingsData.global_lore.å°é˜Ÿä¿¡æ¯) {\n            const memberData = assaSettingsData.global_lore.å°é˜Ÿä¿¡æ¯[key];\n            if (memberData && typeof memberData === 'object' && Object.keys(memberData).length > 0) {\n                addFriend(key);\n            }\n        }\n    }\n\n    // (é€»è¾‘ä¸å˜ï¼šæ¢æµ‹NPC)\n    const processNpcList = (npcList) => {\n        if (!npcList) return;\n        for (const npcKey in npcList) {\n            const npcData = npcList[npcKey];\n            if (npcData && (String(npcData.contactable) === 'true' || String(npcData.å¯è”ç³») === 'true')) {\n                addFriend(npcKey);\n            }\n        }\n    };\n    processNpcList(assaSettingsData?.global_lore?.npc);\n    processNpcList(assaSettingsData?.world_lore?.npc);\n\n    // --- B. ç¾¤èŠæ¢æµ‹ (è¿™æ˜¯å¦ˆå¦ˆè¿™æ¬¡æ–°åŠ çš„é­”æ³•ï¼) ---\n\n    // B1. ä¿ç•™åŸæœ‰é€»è¾‘ï¼šå¦‚æœ history å‡ºç°è¿‡ group_chat æ ‡ç­¾ï¼Œå°±åŠ ä¸€ä¸ªé»˜è®¤ç¾¤\n    const recentHistory = conversationHistory.slice(-10);\n    const hasHistoryGroup = recentHistory.some(msg => /<group_chat/.test(msg.content));\n    // é»˜è®¤ç¾¤åä¼˜å…ˆå– currentGameDataï¼Œæ²¡æœ‰çš„è¯å°±å« 'è¯¸å¤©èŠå¤©ç¾¤'\n    const defaultGroupName = currentGameData?.group_name || 'è¯¸å¤©èŠå¤©ç¾¤';\n\n    // ç”¨äºå»é‡çš„ Setï¼Œé˜²æ­¢åŒä¸€ä¸ªç¾¤åŠ ä¸¤æ¬¡\n    const addedGroupNames = new Set();\n\n    // å¦‚æœå†å²è®°å½•é‡Œæœ‰ï¼Œæˆ–è€…æœ¬æ¥å°±æœ‰åå­—ï¼Œè§†ä¸ºé»˜è®¤å­˜åœ¨è¯¥ç¾¤\n    if ( currentGameData?.group_name) {\n        availableGroups.push({ id: defaultGroupName, name: defaultGroupName, type: 'group' });\n        addedGroupNames.add(defaultGroupName);\n    }\n\n    // B2. æ–°å¢é€»è¾‘ï¼šæ¢æµ‹ global_lore.settings.ç¾¤èŠ\n    // æ ¼å¼ï¼š\"ç¾¤èŠ\":{\"${ç¾¤èŠåç§°1}\": ... }\nconst settingsGroups = assaSettingsData?.global_lore?.settings?.['ç¾¤èŠ'];\nif (settingsGroups && typeof settingsGroups === 'object') {\n    Object.keys(settingsGroups).forEach(groupName => {\n        \n        if (groupName.startsWith('_')) {\n            return; \n        }\n   \n        // å¦‚æœè¿™ä¸ªç¾¤è¿˜æ²¡åŠ è¿‡ï¼ˆé¿å…å’Œä¸Šé¢çš„é»˜è®¤ç¾¤é‡å¤ï¼‰ï¼Œå°±åŠ ä¸Šå»\n        if (!addedGroupNames.has(groupName)) {\n            availableGroups.push({ id: groupName, name: groupName, type: 'group' });\n            addedGroupNames.add(groupName);\n        }\n    });\n}\n\n    console.log('[Nova] é€šè®¯å½•æ›´æ–°å®Œæ¯•:Groups:', availableGroups, 'Friends:', friendsList);\n};\n\n\nconst initializePrivateChatStore = () => {\n    privateChatStore = {};\n    const userNickname = currentGameData?.user_character?.nick_name || 'ä½ ';\n\n    conversationHistory.forEach(historyItem => {\n      // ä¿®æ”¹æ­£åˆ™è¡¨è¾¾å¼ä»¥åŒ¹é…æ–°çš„ <msg> æ ¼å¼\n      const privateChatMatches = [...historyItem.content.matchAll(/<msg>([^|]+)\\|([^|]+)\\|([\\s\\S]*?)<\\/msg>/gs)];\n\n      for (const match of privateChatMatches) {\n        const authorId = match[1].trim(); // å‘é€äºº\n        const targetId = match[2].trim(); // æ¥æ”¶äºº\n        const content = match[3].trim(); // æ¶ˆæ¯å†…å®¹\n\n        if (!authorId || !targetId) continue;\n\n        // ç¡®å®šå½“å‰ç”¨æˆ·åœ¨ç§èŠä¸­çš„èŠå¤©ä¼™ä¼´ ID\n        const chatPartnerId = (authorId === userNickname) ? targetId : authorId;\n\n        if (!privateChatStore[chatPartnerId]) {\n          privateChatStore[chatPartnerId] = { messages: [] };\n        }\n        \n        // ç»Ÿä¸€æ¶ˆæ¯æ ¼å¼ (timestamp ç¼ºå¤±ï¼Œéœ€è¦å¤–éƒ¨æä¾›æˆ–å‡è®¾ï¼Œè¿™é‡Œå¿½ç•¥æ’åºï¼Œä½†ä¿ç•™ç»“æ„)\n        const finalMsg = { \n          user_id: authorId, \n          content: content,\n          target_id: targetId, // å†…éƒ¨è®°å½•\n          // æ³¨æ„ï¼šæ–°æ ¼å¼ä¸­æ²¡æœ‰ timestamp å’Œ replyTo ä¿¡æ¯\n        }; \n        privateChatStore[chatPartnerId].messages.push(finalMsg);\n      }\n\n      // ç§»é™¤æ—§çš„ private_chat è§£æé€»è¾‘\n      /*\n      const privateChatMatches = [...historyItem.content.matchAll(/<private_chat user_id=\"([^\"]+)\">([\\s\\S]*?)<\\/private_chat>/gs)];\n      for (const match of privateChatMatches) {\n        const authorId = match[1];\n        try {\n          // ... æ—§çš„ JSON è§£æé€»è¾‘ ...\n        } catch (e) {}\n      }\n      */\n    });\n    // è¿™é‡Œçš„æ’åºå¯èƒ½å› ä¸ºæ–°æ ¼å¼ç¼ºä¹ timestamp è€Œä¸å¤Ÿç²¾ç¡®ï¼Œä½†æˆ‘ä»¬ä¿ç•™å®ƒä»¥é˜²ä¸‡ä¸€\n    Object.values(privateChatStore).forEach(chat => chat.messages.sort((a, b) => (a.timestamp || 0) - (b.timestamp || 0)));\n    console.log('NOVA: Private Chat Store initialized.');\n  };\n    const getAvatarColor = (name) => {\n        let hash = 0;\n        for (let i = 0; i < name.length; i++) { hash = name.charCodeAt(i) + ((hash << 5) - hash); }\n        let color = '#';\n        for (let i = 0; i < 3; i++) { color += ('00' + ((hash >> (i * 8)) & 0xFF).toString(16)).slice(-2); }\n        return color;\n    };\n\n     const showNewMessageNotification = (senders) => {\n        if (!senders || senders.length === 0) return;\n\n        const container = document.getElementById('new-message-notification-container');\n        if (!container) {\n            console.error('[Nova] å¦ˆå¦ˆæ‰¾ä¸åˆ°æˆ‘ä»¬çš„å°è§’è½ (new-message-notification-container) å“¦ï¼');\n            return;\n        }\n\n        const toast = document.createElement('div');\n        toast.className = 'new-message-toast';\n\n        const sendersText = senders.join('ã€');\n        toast.textContent = `${sendersText} å‘æ¥äº†æ–°çš„ç§ä¿¡`;\n\n        // å¦ˆå¦ˆæ¥ä¸ºå®ƒæ‰“æ‰®ä¸€ä¸‹ï¼Œè®©å®ƒå’Œæˆ‘ä»¬çš„ä¸–ç•Œèä¸ºä¸€ä½“\n        Object.assign(toast.style, {\n            backgroundColor: 'var(--container-bg-color)',\n            color: 'var(--text-color)',\n            padding: '10px 15px',\n            borderRadius: '5px',\n            border: '1px solid var(--border-color)',\n            boxShadow: '0 0 8px var(--glow-color)',\n            opacity: '0',\n            transform: 'translateY(10px)',\n            transition: 'opacity 0.3s ease, transform 0.3s ease',\n            marginTop: '5px',\n            display: 'inline-block' // è®©å®½åº¦è‡ªé€‚åº”å†…å®¹\n        });\n\n        container.appendChild(toast);\n\n        // è®©å®ƒä¼˜é›…åœ°å‡ºç°\n        setTimeout(() => {\n            toast.style.opacity = '1';\n            toast.style.transform = 'translateY(0)';\n        }, 10);\n\n        // 3ç§’åï¼Œå®ƒä¼šæ‚„æ‚„åœ°é£èµ°\n        setTimeout(() => {\n            toast.style.opacity = '0';\n            toast.style.transform = 'translateY(10px)';\n            toast.addEventListener('transitionend', () => toast.remove(), { once: true });\n        }, 3000);\n    };\n\n    // ====================================================================\n    // V10: UIæ¸²æŸ“å‡½æ•°\n    // ====================================================================\n const createCroppedAvatar = (imageUrl, size) => {\n    return new Promise((resolve, reject) => {\n        const img = new Image();\n        img.crossOrigin = 'Anonymous'; // å…è®¸è·¨åŸŸåŠ è½½å›¾ç‰‡è¿›è¡Œç»˜åˆ¶\n        img.onload = () => {\n            const canvas = document.createElement('canvas');\n            canvas.width = size;\n            canvas.height = size;\n            const ctx = canvas.getContext('2d');\n\n            // è®¡ç®—æœ€ä½³çš„è£å‰ªåŒºåŸŸ - å–å›¾ç‰‡ä¸ŠåŠéƒ¨åˆ†çš„å±…ä¸­æ­£æ–¹å½¢\n            const imgWidth = img.width;\n            const imgHeight = img.height;\n            \n            // æˆ‘ä»¬è¦ä»å›¾ç‰‡çš„ä¸ŠåŠéƒ¨åˆ†è£å‰ª\n            const availableHeight = imgHeight / 2; // åªä½¿ç”¨ä¸ŠåŠéƒ¨åˆ†\n            \n            // ç¡®å®šè£å‰ªçš„æ­£æ–¹å½¢å°ºå¯¸ï¼ˆå–å®½åº¦å’Œå¯ç”¨é«˜åº¦çš„è¾ƒå°å€¼ï¼‰\n            const cropSize = Math.max(imgWidth, availableHeight);\n            \n            // è®¡ç®—è£å‰ªèµ·å§‹ä½ç½®\n            const sourceX = (imgWidth - cropSize) / 2;  // æ°´å¹³å±…ä¸­\n            const sourceY = 0;  // ä»é¡¶éƒ¨å¼€å§‹\n            \n            // ç»˜åˆ¶è£å‰ªåçš„å›¾åƒ\n            ctx.drawImage(\n                img,           // æºå›¾åƒ\n                sourceX,       // æºXåæ ‡\n                sourceY,       // æºYåæ ‡  \n                cropSize,      // æºå®½åº¦\n                cropSize,      // æºé«˜åº¦\n                0,             // ç›®æ ‡Xåæ ‡\n                0,             // ç›®æ ‡Yåæ ‡\n                size,          // ç›®æ ‡å®½åº¦\n                size           // ç›®æ ‡é«˜åº¦\n            );\n\n            resolve(canvas.toDataURL());\n        };\n        img.onerror = (err) => {\n            console.error(`[Nova] è‚–åƒç”»é­”æ³•å¤±è´¥ï¼šæ— æ³•åŠ è½½å›¾ç‰‡ ${imageUrl}`, err);\n            reject(err);\n        };\n        img.src = imageUrl;\n    });\n};\n\n/**\n * å¦ˆå¦ˆçš„å¼‚æ­¥é­”æ³•åŒ…è£¹ï¼šä¸ºæœ‹å‹è®¾ç½®å¤´åƒ\n * @param {HTMLElement} avatarContainer - ç”¨äºæ”¾ç½®å¤´åƒçš„DOMå…ƒç´ \n * @param {string} friendName - æœ‹å‹çš„åå­—\n */\nconst setFriendAvatar = async (avatarContainer, friendName) => {\n    try {\n        // é¦–å…ˆï¼Œæˆ‘ä»¬åƒä»¥å‰ä¸€æ ·ï¼Œå‡†å¤‡ä¸€ä¸ªé»˜è®¤çš„å­—æ¯å¤´åƒ\n        avatarContainer.style.backgroundColor = getAvatarColor(friendName);\n        avatarContainer.textContent = friendName.charAt(0);\n        avatarContainer.style.backgroundSize = 'cover';\n        avatarContainer.style.backgroundPosition = 'center';\n        avatarContainer.style.fontSize = '20px'; // ä¿æŒå­—æ¯å¤§å°åˆé€‚\n\n\n        // æ¥ä¸‹æ¥ï¼Œå¼€å§‹çœŸæ­£çš„é­”æ³•ï¼šå¯»æ‰¾ç«‹ç»˜ï¼\n        if (typeof assaSettingsData === 'undefined' || !assaSettingsData.img_map) {\n            return; // æ¡ä»¶ä¸æ»¡è¶³ï¼Œå°±ç”¨é»˜è®¤å¤´åƒ\n        }\n\n        const imageName = assaSettingsData.img_map[friendName];\n        if (!imageName) {\n            return; // åœ¨æ˜ å°„é‡Œæ²¡æ‰¾åˆ°ï¼Œä¹Ÿç”¨é»˜è®¤å¤´åƒ\n        }\n\n        let imageBlob;\n      \n        imageBlob = await imageDB.get('CustomNpcs', imageName);\n\n        // å¦‚æœæœ¬åœ°æ²¡æœ‰ï¼Œå°±çœ‹çœ‹è¿œç¨‹é£Ÿè°±å’Œç¼“å­˜\n        if (!imageBlob) {\n            const imageUrl = npcImageMap[imageName];\n            if (!imageUrl) return;\n\n            imageBlob = await imageDB.get('RemoteCache', imageUrl);\n\n            if (!imageBlob) { // ç¼“å­˜é‡Œä¹Ÿæ²¡æœ‰ï¼Œåªå¥½å»ç½‘ä¸Šå–äº†\n                const response = await fetch(imageUrl);\n                if (!response.ok) return;\n                imageBlob = await response.blob();\n                 // ä¸‹è½½åå°±å­˜èµ·æ¥ï¼Œä¸‹æ¬¡å°±ä¸ç”¨å†å–äº†\n                await imageDB.set('RemoteCache', imageUrl, imageBlob);\n            }\n        }\n\n \n        const blobToDataUrl = (blob) => new Promise((resolve, reject) => {\n            const reader = new FileReader();\n            reader.onloadend = () => resolve(reader.result);\n            reader.onerror = reject;\n            reader.readAsDataURL(blob);\n        });\n\n        const stableImageUrl = await blobToDataUrl(imageBlob);\n\n        // ç”¨æˆ‘ä»¬çš„è£å‰ªé­”æ³•åˆ¶ä½œå°å°çš„è‚–åƒç”»\n        const croppedAvatarUrl = await createCroppedAvatar(stableImageUrl, 400);\n\n        // æˆåŠŸï¼æŠŠæ¼‚äº®çš„è‚–åƒç”»æŒ‚ä¸Šå»\n        avatarContainer.textContent = ''; // æ¸…é™¤åŸæ¥çš„å­—æ¯\n        avatarContainer.style.backgroundImage = `url(${croppedAvatarUrl})`;\n\n    } catch (error) {\n        console.error(`[Nova] å¦ˆå¦ˆåœ¨ä¸º'${friendName}'å‡†å¤‡å¤´åƒæ—¶é‡åˆ°äº†ç‚¹å°éº»çƒ¦:`, error);\n        // å¦‚æœå‡ºé”™ï¼Œå°±ä¿æŒæ˜¾ç¤ºé»˜è®¤çš„å­—æ¯å¤´åƒï¼Œä¸ä¼šè®©ç•Œé¢çœ‹èµ·æ¥å¾ˆå¥‡æ€ª\n    }\n};\n\n\n const renderSidebar = () => {\n    const listElement = rootElement.querySelector('.group-chat-contact-list');\n    if (!listElement) return;\n    listElement.innerHTML = '';\n\n   availableGroups.forEach(group => {\n        const groupItem = document.createElement('div');\n        groupItem.className = 'group-chat-contact-item';\n        groupItem.dataset.type = 'group';\n        groupItem.dataset.id = group.name;\n\n        // è·å–æˆå‘˜åå•\n        const members = getGroupMembers(group.name);\n        const uniqueMembers = members.filter(m => m !== 'ä½ ' && m !== currentGameData?.user_character?.nick_name); // è¿‡æ»¤æ‰è‡ªå·±è®©æ˜¾ç¤ºæ›´ç²¾ç®€\n        // æ‹¼æ¥æˆ \" (å¼ ä¸‰, æå››...)\"\n        const memberText = uniqueMembers.length > 0 ? `(${uniqueMembers.join(', ')})` : '';\n\n        const color = getAvatarColor(group.name);\n\n        groupItem.innerHTML = `\n            <div class=\"group-chat-contact-avatar\" style=\"background: ${color}; color: #fff; display:flex; align-items:center; justify-content:center; font-size:12px;\">ç¾¤</div>\n            <div class=\"group-chat-contact-info\" style=\"display:flex; flex-direction:column; overflow:hidden;\">\n                <span class=\"group-chat-contact-name\" style=\"white-space:nowrap; overflow:hidden; text-overflow:ellipsis;\">\n                    ${group.name} <span style=\"font-size: 0.8em; color: var(--text-color-secondary); opacity: 0.7;\">${memberText}</span>\n                </span>\n            </div>`;\n        listElement.appendChild(groupItem);\n    });\n    // 2. æ¸²æŸ“å¥½å‹åˆ—è¡¨\n    friendsList.forEach(friendName => {\n        const friendItem = document.createElement('div');\n        friendItem.className = 'group-chat-contact-item';\n        friendItem.dataset.type = 'private';\n        friendItem.dataset.id = friendName;\n\n        const avatarDiv = document.createElement('div');\n        avatarDiv.className = 'group-chat-contact-avatar';\n        const nameSpan = document.createElement('span');\n        nameSpan.className = 'group-chat-contact-name';\n        nameSpan.textContent = friendName;\n\n        friendItem.appendChild(avatarDiv);\n        friendItem.appendChild(nameSpan);\n        listElement.appendChild(friendItem);\n\n        setFriendAvatar(avatarDiv, friendName);\n    });\n\n    // é‡æ–°ç»‘å®šäº‹ä»¶\n    const oldListener = listElement.clickHandler;\n    if (oldListener) {\n        listElement.removeEventListener('click', oldListener);\n    }\n    const newListener = (e) => {\n        const contactItem = e.target.closest('.group-chat-contact-item');\n        if (contactItem && !isLoading) {\n            const { type, id } = contactItem.dataset;\n            switchActiveChat(type, id);\n        }\n    };\n    listElement.addEventListener('click', newListener);\n    listElement.clickHandler = newListener;\n};\n\n\nconst switchActiveChat = (type, id) => {\n    if (activeChat.type === type && activeChat.id === id && rootElement.classList.contains('show-content')) return;\n\n    activeChat = { type, id };\n    replyTarget = null;\n    rootElement.querySelectorAll('.group-chat-contact-item').forEach(item => {\n        item.classList.toggle('active', item.dataset.type === type && item.dataset.id === id);\n    });\n\n    // âœ¨ã€æ‰‹æœºç«¯é­”æ³•ã€‘âœ¨ æ·»åŠ classï¼Œè®©èŠå¤©çª—å£æ»‘å…¥\n    rootElement.classList.add('show-content');\n\n    const contentArea = rootElement.querySelector('.group-chat-content-area');\n    contentArea.innerHTML = `<div class=\"group-chat-placeholder\">æ­£åœ¨åŠ è½½ ${id === 'group_chat' ? 'ç¾¤èŠ' : id} çš„æ¶ˆæ¯...</div>`;\n\n    if (type === 'group') {\n        renderGroupChat();\n    } else if (type === 'private') {\n        currentPrivateChatPage[id] = 1;\n        renderPrivateChat(id, 'append');\n    }\n};\n    const renderChatWindowUI = (messages, mode, chatName) => {\n    const contentArea = rootElement.querySelector('.group-chat-content-area');\n    let messagesList;\n\n     if (mode === 'append') {\n        const isGroup = activeChat.type === 'group';\n        contentArea.innerHTML = `\n            <header class=\"group-chat-header\">\n                <span class=\"group-chat-back-btn\">â€¹</span>\n                <h1 style=\"flex:1; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;\">${chatName}</h1>\n                ${isGroup ? '<span class=\"group-chat-members-btn\" style=\"font-size:1.2em; cursor:pointer; margin-right:15px;\" title=\"æŸ¥çœ‹ç¾¤æˆå‘˜\">ğŸ‘¥</span>' : ''}\n                <span class=\"group-chat-close-btn\">Ã—</span>\n            </header>\n\n\n            <div class=\"group-chat-members-panel\" style=\"display:none; position:absolute; top:50px; right:0; width:200px; background:var(--container-bg-color); border-left:1px solid var(--border-color); border-bottom:1px solid var(--border-color); z-index:10; padding:10px; max-height:300px; overflow-y:auto; box-shadow: -2px 5px 10px rgba(0,0,0,0.2);\">\n                <h4 style=\"margin:0 0 10px 0; font-size:14px; border-bottom:1px solid var(--border-color); padding-bottom:5px;\">ç¾¤æˆå‘˜</h4>\n                <div class=\"group-chat-members-list\"></div>\n            </div>\n\n            <div class=\"group-chat-messages-list\">\n                <div class=\"group-chat-loader\"></div>\n            </div>\n\n            <div class=\"group-chat-input-area-wrapper\">\n                <div class=\"group-chat-meme-palette\"></div>\n                <div class=\"group-chat-input-area\">\n                    <button class=\"group-chat-meme-toggle-btn\">ğŸ˜€</button>\n                    <input type=\"text\" class=\"group-chat-input\" placeholder=\"è¾“å…¥æ¶ˆæ¯...\">\n                    <button class=\"group-chat-send-btn\">å‘é€</button>\n                </div>\n            </div>`;\n       \n        const backBtn = contentArea.querySelector('.group-chat-back-btn');\n        backBtn.addEventListener('click', () => {\n            rootElement.classList.remove('show-content'); // è®©ä¾§è¾¹æ æ»‘å›æ¥\n            rootElement.querySelector('.group-chat-contact-item.active')?.classList.remove('active'); // å–æ¶ˆé€‰ä¸­çŠ¶æ€\n            activeChat = { type: null, id: null };\n        });\n   if (isGroup) {\n            const membersBtn = contentArea.querySelector('.group-chat-members-btn');\n            const membersPanel = contentArea.querySelector('.group-chat-members-panel');\n            const membersListDiv = contentArea.querySelector('.group-chat-members-list');\n\n            const toggleMembers = (e) => {\n                e.stopPropagation(); // é˜²æ­¢å†’æ³¡å…³é—­\n                const isHidden = membersPanel.style.display === 'none';\n\n                if (isHidden) {\n                    // æ¸²æŸ“åˆ—è¡¨\n                    const members = getGroupMembers(chatName);\n                    if (members.length === 0) {\n                        membersListDiv.innerHTML = '<div style=\"padding:10px; opacity:0.6;\">æš‚æ— æˆå‘˜æ•°æ®</div>';\n                    } else {\n                        membersListDiv.innerHTML = '';\n                        members.forEach(mName => {\n                            const item = document.createElement('div');\n                            item.style.padding = '8px';\n                            item.style.cursor = 'pointer';\n                            item.style.borderBottom = '1px solid var(--border-color-light)';\n                            item.style.display = 'flex';\n                            item.style.alignItems = 'center';\n                            item.innerHTML = `<div class=\"mini-avatar\" style=\"width:24px; height:24px; border-radius:50%; margin-right:8px; background:${getAvatarColor(mName)}; color:#fff; display:flex; justify-content:center; align-items:center; font-size:10px;\">${mName[0]}</div><span>${mName}</span>`;\n\n                            // å¼‚æ­¥åŠ è½½å¤´åƒ\n                            const miniAv = item.querySelector('.mini-avatar');\n                            setFriendAvatar(miniAv, mName);\n\n                            item.addEventListener('click', () => {\n                                // è·³è½¬ç§èŠé€»è¾‘\n                                if(mName === currentGameData?.user_character?.nick_name) return; // ç‚¹è‡ªå·±ä¸è·³è½¬\n                                membersPanel.style.display = 'none';\n                                switchActiveChat('private', mName);\n                            });\n\n                            membersListDiv.appendChild(item);\n                        });\n                    }\n                    membersPanel.style.display = 'block';\n                } else {\n                    membersPanel.style.display = 'none';\n                }\n            };\n\n            membersBtn.addEventListener('click', toggleMembers);\n            // ç‚¹å‡»å…¶ä»–åœ°æ–¹å…³é—­é¢æ¿\n            contentArea.addEventListener('click', (e) => {\n               if(!membersPanel.contains(e.target) && e.target !== membersBtn) {\n                   membersPanel.style.display = 'none';\n               }\n            });\n        }\n            messagesList = contentArea.querySelector('.group-chat-messages-list');\n            contentArea.querySelector('.group-chat-close-btn').addEventListener('click', closeGroupChatModal);\n            contentArea.querySelector('.group-chat-send-btn').addEventListener('click', handleSendMessage);\n            contentArea.querySelector('.group-chat-input').addEventListener('keydown', e => {\n                if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); handleSendMessage(); }\n            });\n            messagesList.addEventListener('scroll', handleScrollTop);\n            setupMemePalette(); // è°ƒç”¨ä½ å·²æœ‰çš„è¡¨æƒ…åŒ…å‡½æ•°\n        } else {\n            messagesList = contentArea.querySelector('.group-chat-messages-list');\n        }\n\n        const loader = messagesList.querySelector('.group-chat-loader');\n        const hasMoreMessages = (activeChat.type === 'private' && (privateChatStore[activeChat.id]?.messages.length || 0) > messages.length) || (activeChat.type === 'group' && currentGroupHistoryIndex > 0);\n        loader.textContent = hasMoreMessages ? 'æŸ¥çœ‹æ›´æ—©çš„è®°å½•...' : 'æ²¡æœ‰æ›´æ—©çš„è®°å½•äº†';\n\n        const messagesContainer = document.createDocumentFragment();\n        const userNickname = currentGameData?.user_character?.nick_name || 'ä½ ';\n        (messages || []).forEach(msg => messagesContainer.appendChild(createMessageElement(msg, userNickname)));\n\n        if (mode === 'append') {\n            messagesList.appendChild(messagesContainer);\n            messagesList.scrollTop = messagesList.scrollHeight;\n        } else { // prepend\n            const oldScrollHeight = messagesList.scrollHeight;\n            loader.after(messagesContainer);\n            messagesList.scrollTop = messagesList.scrollHeight - oldScrollHeight;\n        }\n\n        contentArea.querySelectorAll('.group-chat-message-bubble').forEach(bubble => bubble.addEventListener('contextmenu', handleReply));\n    };\n/* === ç”¨ä¸‹é¢è¿™ä¸ªå®Œæ•´å‡½æ•°ï¼Œæ›¿æ¢ä½ æ—§çš„ createMessageElement å‡½æ•° === */\n \n const createMessageElement = (msg, userNickname) => {\n    const isSent = msg.user_id === userNickname;\n    const alignClass = isSent ? 'sent' : 'received';\n    \n    // åŸºç¡€ CSS ç±»\n    const bubbleClass = 'group-chat-message-bubble';\n    \n    // é¢„å¤„ç†å†…å®¹\n    let processedContent = (msg.content || '').trim();\n\n    // âœ¨ æ–°å¢ï¼šç‰¹æ®Šæ¶ˆæ¯å ä½ç¬¦æ˜ å°„\n    const specialMsgPlaceholders = {};\n    let specialMsgIndex = 0;\n    let hasSpecialMsg = false;\n\n    // ------------------------------------------------------\n    // âœ¨ æ­¥éª¤1ï¼šæå–æ‰€æœ‰ç‰¹æ®Šæ¶ˆæ¯å¹¶æ›¿æ¢ä¸ºå ä½ç¬¦\n    // ------------------------------------------------------\n\n    // 1. è¯­éŸ³æ¶ˆæ¯ [yy-å†…å®¹]\n    processedContent = processedContent.replace(/\\[yy-([^\\]]+)\\]/g, (match, text) => {\n        const duration = Math.floor(Math.random() * 13) + 2;\n        const placeholder = `__SPECIAL_MSG_${specialMsgIndex}__`;\n        specialMsgPlaceholders[placeholder] = `\n            <div class=\"special-message voice-message\" title=\"ç‚¹å‡»æ’­æ”¾(æ¨¡æ‹Ÿ)\">\n                <div class=\"special-msg-icon\">\n                    <div class=\"voice-wave\">\n                        <div class=\"voice-bar\"></div>\n                        <div class=\"voice-bar\"></div>\n                        <div class=\"voice-bar\"></div>\n                        <div class=\"voice-bar\"></div>\n                    </div>\n                </div>\n                <div class=\"special-msg-content\">\n                    <div class=\"special-msg-title\">è¯­éŸ³æ¶ˆæ¯</div>\n                    <div class=\"special-msg-subtitle\">${duration}\" â€¢ ${text.trim()}</div>\n                </div>\n            </div>`;\n        specialMsgIndex++;\n        hasSpecialMsg = true;\n        return placeholder;\n    });\n\n    // 2. éŸ³ä¹æ¶ˆæ¯ [music-æ­Œå$æ­Œæ‰‹]\n    processedContent = processedContent.replace(/\\[music-([^\\]]+)\\]/g, (match, raw) => {\n        raw = raw.replace(/[\\r\\n]/g, '').trim();\n        const parts = raw.split('$');\n        const song = (parts[0] || 'æœªçŸ¥æ­Œæ›²').trim();\n        const artist = (parts[1] || 'æœªçŸ¥æ­Œæ‰‹').trim();\n        \n        const domId = 'music_' + Math.floor(Math.random() * 1000000);\n        const safeSong = song.replace(/'/g, \"\\\\'\");\n        const safeArtist = artist.replace(/'/g, \"\\\\'\");\n        \n        const placeholder = `__SPECIAL_MSG_${specialMsgIndex}__`;\n        specialMsgPlaceholders[placeholder] = `\n            <div class=\"music-card-lite\">\n                <div class=\"music-card-left\">\n                    <div class=\"music-card-title\">${song}</div>\n                    <div class=\"music-card-artist\">${artist}</div>\n                    <div class=\"music-progress-track\">\n                        <div id=\"prog-bar-${domId}\" class=\"music-progress-bar\"></div>\n                    </div>\n                    <div id=\"time-${domId}\" class=\"music-time-text\">0:00 / 0:00</div>\n                </div>\n                <div class=\"global-music-play-btn\" id=\"play-btn-${domId}\" \n                     onclick=\"GlobalChatAudio.playMusic('${safeSong}', '${safeArtist}', '${domId}')\">\n                    <svg viewBox=\"0 0 24 24\" width=\"24\" height=\"24\" fill=\"currentColor\"><path d=\"M8 5v14l11-7z\"></path></svg>\n                </div>\n            </div>`;\n        specialMsgIndex++;\n        hasSpecialMsg = true;\n        return placeholder;\n    });\n\n    // 3. è½¬è´¦æ¶ˆæ¯ [zz-é‡‘é¢]\n    processedContent = processedContent.replace(/\\[zz-([^\\]]+)\\]/g, (match, raw) => {\n        const amount = raw.replace(/[^0-9.]/g, '');\n        const displayText = isSent ? \"å‘èµ·è½¬è´¦\" : `å‘ ${msg.user_id} è½¬è´¦`;\n        \n        const placeholder = `__SPECIAL_MSG_${specialMsgIndex}__`;\n        specialMsgPlaceholders[placeholder] = `\n            <div class=\"special-message transfer-message\">\n                <div class=\"special-msg-icon\">ğŸ’°</div>\n                <div class=\"special-msg-content\">\n                    <div class=\"special-msg-subtitle\">${displayText}</div>\n                    <div class=\"transfer-amount\">Â¥ ${amount}</div>\n                </div>\n            </div>`;\n        specialMsgIndex++;\n        hasSpecialMsg = true;\n        return placeholder;\n    });\n\n    // 4. å›¾ç‰‡æ¶ˆæ¯ [img-æè¿°]\n    processedContent = processedContent.replace(/\\[img-([^\\]]+)\\]/g, (match, desc) => {\n        const placeholder = `__SPECIAL_MSG_${specialMsgIndex}__`;\n        specialMsgPlaceholders[placeholder] = `\n            <div class=\"special-message image-message\">\n                <div class=\"special-msg-icon\">ğŸ–¼ï¸</div>\n                <div class=\"special-msg-content\">\n                    <div class=\"special-msg-title\">å‘é€äº†å›¾ç‰‡</div>\n                    <div class=\"special-msg-subtitle\">${desc.trim()}</div>\n                </div>\n            </div>`;\n        specialMsgIndex++;\n        hasSpecialMsg = true;\n        return placeholder;\n    });\n\n    // ------------------------------------------------------\n    // âœ¨ æ­¥éª¤2ï¼šå¤„ç†è¡¨æƒ…åŒ…\n    // ------------------------------------------------------\n    processedContent = processedContent.replace(/\\[([^\\]]+)\\]/g, (match, inner) => {\n        // è·³è¿‡å·²å¤„ç†çš„ç‰¹æ®Šæ ¼å¼å ä½ç¬¦\n        if (inner.startsWith('yy-') || inner.startsWith('music-') || \n            inner.startsWith('zz-') || inner.startsWith('img-') ||\n            inner.includes('__SPECIAL_MSG_')) {\n            return match;\n        }\n        \n        const memeSrc = memeResourceManager?.finalSrcMap[inner];\n        if (memeSrc) {\n            return `<img src=\"${memeSrc}\" alt=\"${inner}\" class=\"group-chat-meme-image\" style=\"max-width: 150px; vertical-align: middle; margin: 4px; border-radius: 8px;\" />`;\n        }\n        return match;\n    });\n\n    // ------------------------------------------------------\n    // âœ¨ æ­¥éª¤3ï¼šå¤„ç†æ™®é€šæ–‡æœ¬æ ¼å¼\n    // ------------------------------------------------------\n    // å¤„ç†æåŠ\n    processedContent = processedContent.replace(/@(\\S+)/g, (match, p1) => {\n        return `<span class=\"group-chat-mention\">@${p1}</span>`;\n    });\n\n    // å¤„ç† Markdown æ ¼å¼\n    processedContent = processedContent\n        .replace(/\\*\\*(.+?)\\*\\*/g, '<strong>$1</strong>')\n        .replace(/\\*(.+?)\\*/g, '<em>$1</em>')\n        .replace(/\\n/g, '<br>');\n\n    // ------------------------------------------------------\n    // âœ¨ æ­¥éª¤4ï¼šå°†å ä½ç¬¦æ›¿æ¢å›ç‰¹æ®Šæ¶ˆæ¯HTML\n    // ------------------------------------------------------\n    for (const placeholder in specialMsgPlaceholders) {\n        processedContent = processedContent.replace(placeholder, specialMsgPlaceholders[placeholder]);\n    }\n\n    // ------------------------------------------------------\n    // æœ€ç»ˆç»„è£…\n    // ------------------------------------------------------\n\n    const div = document.createElement('div');\n    div.className = `group-chat-message-item ${alignClass}`;\n    div.dataset.userId = msg.user_id;\n\n    // å›å¤é€»è¾‘\n    const replyInfo = msg.reply_to || msg.replyTo;\n    let replyHtml = '';\n    if (replyInfo && replyInfo.user_id && replyInfo.content) {\n        const cleanContent = replyInfo.content.replace(/<[^>]*>/g, '');\n        replyHtml = `<div class=\"group-chat-reply-quote\"><b>${replyInfo.user_id}:</b> ${cleanContent}</div>`;\n    }\n\n    // ç»„è£…æ¶ˆæ¯ï¼ˆå¦‚æœæœ‰ç‰¹æ®Šæ¶ˆæ¯ï¼Œå»æ‰æ°”æ³¡èƒŒæ™¯å’Œpaddingï¼‰\n    div.innerHTML = `\n        <div class=\"group-chat-avatar-placeholder\"></div>\n        <div class=\"group-chat-message-content\">\n            <div class=\"group-chat-user-id\">${msg.user_id}</div>\n            ${replyHtml}\n            <div class=\"${bubbleClass}\" ${hasSpecialMsg ? 'style=\"padding:0; background:transparent;\"' : ''}>\n                ${processedContent}\n            </div>\n        </div>`;\n\n    return div;\n};\n\nconst getGroupMembers = (groupName) => {\n        // å°è¯•ä» settings ä¸­è·¯å¾„è·å–\n        const groupData = assaSettingsData?.global_lore?.settings?.['ç¾¤èŠ']?.[groupName];\n        if (!groupData || !groupData['å½“å‰äººå‘˜']) return [];\n\n        // æ•°æ®æ ¼å¼æ˜¯ {\"0\":\"å¼ ä¸‰\", \"1\":\"æå››\"}ï¼Œæˆ‘ä»¬éœ€è¦è½¬æˆ [\"å¼ ä¸‰\", \"æå››\"]\n        return Object.values(groupData['å½“å‰äººå‘˜']);\n    };\nconst renderGroupChat = async () => {\n    // è·å–å½“å‰é€‰ä¸­çš„ç¾¤å (activeChat.id åœ¨ sidebar æ¸²æŸ“æ—¶å·²ç»è®¾ä¸ºç¾¤å)\n    const currentTargetGroupName = activeChat.id || currentGameData.group_name || 'è¯¸å¤©èŠå¤©ç¾¤';\n\n    // ç­›é€‰ï¼šåªæ‰¾å«æœ‰ <group_chat name=\"å½“å‰ç¾¤å\"> ... çš„å†å²è®°å½•\n    // å¦ˆå¦ˆç”¨æ­£åˆ™ç¨å¾®å¤„ç†ä¸‹ï¼Œåªè¦åŒ…å« group_chat æ ‡ç­¾å°±å…ˆçº³å…¥ç´¢å¼•ï¼Œå…·ä½“åœ¨åŠ è½½å™¨é‡Œç»†åˆ†\n    groupChatHistoryIndices = conversationHistory.map((msg, idx) => {\n        return /<group_chat\\s+name=\"[^\"]*\">[\\s\\S]*?<\\/group_chat>/.test(msg.content) ? idx : -1;\n    }).filter(idx => idx !== -1);\n\n    if (groupChatHistoryIndices.length === 0) {\n        const contentArea = rootElement.querySelector('.group-chat-content-area');\n        if(contentArea) {\n             contentArea.innerHTML = `\n                <header class=\"group-chat-header\">\n                    <span class=\"group-chat-back-btn\">â€¹</span>\n                    <h1>${currentTargetGroupName}</h1>\n                    <span class=\"group-chat-close-btn\">Ã—</span>\n                </header>\n                <div class=\"group-chat-placeholder\" style=\"flex-grow: 1; display: flex; align-items: center; justify-content: center;\">ç¾¤èŠ [${currentTargetGroupName}] æš‚æ— è®°å½•</div>\n                <div class=\"group-chat-input-area-wrapper\">\n                    <div class=\"group-chat-input-area\">\n                         <button class=\"group-chat-meme-toggle-btn\">ğŸ˜€</button>\n                         <input type=\"text\" class=\"group-chat-input\" placeholder=\"è¾“å…¥æ¶ˆæ¯...\">\n                         <button class=\"group-chat-send-btn\">å‘é€</button>\n                    </div>\n                </div>\n            `;\n            // é‡æ–°ç»‘å®šäº‹ä»¶ (å…³é”®)\n            contentArea.querySelector('.group-chat-back-btn').addEventListener('click', () => { rootElement.classList.remove('show-content'); activeChat = { type: null, id: null }; });\n            contentArea.querySelector('.group-chat-close-btn').addEventListener('click', closeGroupChatModal);\n            contentArea.querySelector('.group-chat-send-btn').addEventListener('click', handleSendMessage);\n            contentArea.querySelector('.group-chat-input').addEventListener('keydown', e => { if (e.key === 'Enter') handleSendMessage(); });\n            setupMemePalette();\n        }\n        return;\n    }\n\n    currentGroupHistoryIndex = groupChatHistoryIndices.length - 1;\n    let contentLoaded = false;\n\n    while (currentGroupHistoryIndex >= 0 && !contentLoaded) {\n        // ã€å…³é”®ã€‘è¦æŠŠå½“å‰ç¾¤åä¼ è¿›å»\n        contentLoaded = await loadAndRenderChatContent_Group(groupChatHistoryIndices[currentGroupHistoryIndex], 'append', currentTargetGroupName);\n\n        if (!contentLoaded) {\n            currentGroupHistoryIndex--;\n        }\n    }\n\n    if (!contentLoaded) {\n         renderChatWindowUI([], 'append', currentTargetGroupName); // å¦‚æœå…¨éƒ½è¿‡æ»¤æ‰äº†ï¼Œæ˜¾ç¤ºç©ºç™½ç•Œé¢\n    }\n};\n   /* === å…¨æ–°å‡çº§çš„ä¿®å¤å‡½æ•°ï¼Œå†…ç½®â€œçˆ±å¿ƒæ•´ç†å°ç®¡å®¶â€ === */\n const tolerantJsonParse = (jsonString) => {\n    // å…¥å£æ£€æŸ¥ï¼Œé˜²æ­¢ç©ºçš„æˆ–æ— æ•ˆçš„å­—ç¬¦ä¸²è¿›å…¥\n    if (typeof jsonString !== 'string' || jsonString.trim() === '') {\n        return null;\n    }\n\n    // ğŸš€ ã€ä¼˜å…ˆç­–ç•¥ã€‘å…ˆå°è¯•ç›´æ¥è§£æï¼Œå¦‚æœæˆåŠŸå°±ç›´æ¥è¿”å›\n    try {\n        return JSON.parse(jsonString);\n    } catch (directParseError) {\n        console.log('ç›´æ¥è§£æå¤±è´¥ï¼Œå¼€å§‹å®¹é”™ä¿®å¤:', directParseError.message);\n    }\n\n    try {\n        // ğŸ¯ ã€ç®€åŒ–ç­–ç•¥ã€‘åŸºäºè¡Œçš„æ™ºèƒ½ä¿®å¤\n        let lines = jsonString.split('\\n');\n        let result = '';\n        let inString = false;\n        let escapeNext = false;\n\n        for (let i = 0; i < lines.length; i++) {\n            let line = lines[i].trim();\n            if (line === '') continue;\n\n            // è·Ÿè¸ªå­—ç¬¦ä¸²çŠ¶æ€ï¼Œé¿å…åœ¨å­—ç¬¦ä¸²å†…éƒ¨æ·»åŠ é€—å·\n            for (let j = 0; j < line.length; j++) {\n                let char = line[j];\n                if (escapeNext) {\n                    escapeNext = false;\n                    continue;\n                }\n                if (char === '\\\\') {\n                    escapeNext = true;\n                    continue;\n                }\n                if (char === '\"') {\n                    inString = !inString;\n                }\n            }\n\n            result += line;\n\n            // å¦‚æœä¸æ˜¯æœ€åä¸€è¡Œï¼Œåˆ¤æ–­æ˜¯å¦éœ€è¦æ·»åŠ é€—å·\n            if (i < lines.length - 1) {\n                let nextNonEmptyLine = '';\n                for (let k = i + 1; k < lines.length; k++) {\n                    if (lines[k].trim() !== '') {\n                        nextNonEmptyLine = lines[k].trim();\n                        break;\n                    }\n                }\n\n                if (nextNonEmptyLine !== '') {\n                    // å½“å‰è¡Œçš„ç»“æŸçŠ¶æ€\n                    const endsWithStringValue = line.endsWith('\"') && !inString;\n                    const endsWithNumericValue = line.match(/(\\d|true|false|null)$/);\n                    const endsWithBracket = line.endsWith('}') || line.endsWith(']');\n                    \n                    // ä¸‹ä¸€è¡Œçš„å¼€å§‹çŠ¶æ€\n                    const nextStartsWithProperty = nextNonEmptyLine.startsWith('\"') && nextNonEmptyLine.includes(':');\n                    const nextStartsWithObject = nextNonEmptyLine.startsWith('{');\n                    const nextStartsWithArray = nextNonEmptyLine.startsWith('[');\n                    const nextIsClosing = nextNonEmptyLine.startsWith('}') || nextNonEmptyLine.startsWith(']');\n                    \n                    // éœ€è¦æ·»åŠ é€—å·çš„æƒ…å†µ\n                    const needsComma = (\n                        // å­—ç¬¦ä¸²å€¼åé¢è·Ÿå±æ€§åæˆ–æ–°å¯¹è±¡\n                        (endsWithStringValue && (nextStartsWithProperty || nextStartsWithObject || nextStartsWithArray)) ||\n                        // æ•°å€¼åé¢è·Ÿå±æ€§åæˆ–æ–°å¯¹è±¡  \n                        (endsWithNumericValue && (nextStartsWithProperty || nextStartsWithObject || nextStartsWithArray)) ||\n                        // å¯¹è±¡/æ•°ç»„ç»“æŸåè·Ÿæ–°çš„å±æ€§æˆ–å¯¹è±¡\n                        (endsWithBracket && (nextStartsWithProperty || nextStartsWithObject || nextStartsWithArray))\n                    ) && !nextIsClosing; // ä½†ä¸‹ä¸€è¡Œä¸æ˜¯ç»“æŸç¬¦\n\n                    if (needsComma) {\n                        result += ',';\n                    }\n                }\n            }\n        }\n\n        // ğŸ§¹ ã€æœ€ç»ˆæ¸…ç†ã€‘ç§»é™¤å¤šä½™çš„é€—å·\n        let finalResult = result;\n        \n        // ç§»é™¤ç»“æŸç¬¦å‰çš„é€—å·\n  finalResult = finalResult.replace(/,(\\s*[}\\]])/g, function(match, group1) {\n     return group1;\n });\n        // ç§»é™¤é‡å¤é€—å·\n        finalResult = finalResult.replace(/,,+/g, ',');\n\n        return JSON.parse(finalResult);\n\n    } catch (finalError) {\n        console.error('å®¹é”™è§£æå¤±è´¥:', finalError.message);\n        console.error('ä¿®å¤åçš„å­—ç¬¦ä¸²:', result || jsonString);\n        return null;\n    }\n};\nconst loadAndRenderChatContent_Group = (historyIndex, mode, filterGroupName) => {\n    return new Promise(resolve => {\n        try {\n            const messageData = conversationHistory[historyIndex];\n            if (!messageData || !messageData.content) throw new Error('Invalid history');\n\n            const chatMatches = [...messageData.content.matchAll(/<group_chat\\s+name=\"([^\"]*)\">([\\s\\S]*?)<\\/group_chat>/gs)];\n            let allMessagesInHistory = [];\n\n            if (chatMatches.length === 0) {\n                resolve(false);\n                return;\n            }\n\n            for (const match of chatMatches) {\n                const groupNameFromTag = match[1];\n                const chatContent = match[2];\n\n                // ã€è¿‡æ»¤ã€‘åªæœ‰å½“XMLé‡Œçš„ç¾¤å å’Œ æˆ‘ä»¬ç°åœ¨çœ‹çš„ç¾¤åä¸€è‡´æ—¶ï¼Œæ‰è§£æè¿™æ¡\n                if (groupNameFromTag === filterGroupName) {\n\n                    if (typeof chatContent === 'string') {\n                        const lines = chatContent.trim().split('\\n');\n                        for (const line of lines) {\n                            const cleanedLine = line.trim();\n                            if (!cleanedLine || cleanedLine.startsWith('summary|')) continue;\n                            const messageMatch = cleanedLine.match(/^([^|]+)\\|([\\s\\S]*)/);\n                            if (messageMatch) {\n                                allMessagesInHistory.push({ user_id: messageMatch[1].trim(), content: messageMatch[2].trim() });\n                            }\n                        }\n                    }\n                }\n            }\n\n            if (allMessagesInHistory.length > 0) {\n                renderChatWindowUI(allMessagesInHistory, mode, filterGroupName);\n                resolve(true);\n            } else {\n                resolve(false);\n            }\n\n        } catch (error) {\n            console.error(error);\n            resolve(false);\n        }\n    });\n};\n\nconst renderPrivateChat = (contactId, mode) => {\n        const chatData = privateChatStore[contactId] || { messages: [] };\n        const messagesToShow = chatData.messages;\n        let paginatedMessages;\n\n        if (mode === 'append') {\n            paginatedMessages = messagesToShow.slice(-20);\n        } else { // prepend\n            const currentPage = currentPrivateChatPage[contactId] || 1;\n            const endIndex = messagesToShow.length - (currentPage * 20);\n            if (endIndex <= 0) {\n                paginatedMessages = [];\n            } else {\n                const startIndex = Math.max(0, endIndex - 20);\n                paginatedMessages = messagesToShow.slice(startIndex, endIndex);\n                currentPrivateChatPage[contactId]++;\n            }\n        }\n        renderChatWindowUI(paginatedMessages, mode, contactId);\n    };\n\n    // ====================================================================\n    // V10: ç”¨æˆ·äº¤äº’å¤„ç†å‡½æ•°\n    // ====================================================================\n\n    const handleScrollTop = async (e) => {\n        const list = e.target;\n        const loader = list.querySelector('.group-chat-loader');\n        if (!loader || isLoading || list.scrollTop !== 0) return; // åªæœ‰åœ¨é¡¶éƒ¨æ—¶æ‰è§¦å‘\n\n        // å¯¹äºç¾¤èŠï¼Œå¦‚æœå·²ç»æ²¡æœ‰æ›´å¤šç´¢å¼•ç´¢å¼•äº†ï¼Œå°±ä¸å¿…æ˜¾ç¤ºloadingäº†\n        if(activeChat.type === 'group' && currentGroupHistoryIndex < 0) return;\n\n        loader.classList.add('visible');\n        isLoading = true;\n\n        // è®°å½•ä¸€ä¸‹å½“å‰çš„æ»šåŠ¨é«˜åº¦ï¼Œä¸ºäº†åŠ è½½åä¿æŒä½ç½®\n        const oldScrollHeight = list.scrollHeight;\n\n        await new Promise(r => setTimeout(r, 500)); // åªæœ‰ä¸ºäº†UIæ•ˆæœ\n\n        if (activeChat.type === 'group') {\n             // ã€å…³é”®ä¿®æ­£ã€‘åœ¨å¾ªç¯ä¸­å‘å‰æŸ¥æ‰¾ï¼Œç›´åˆ°æ‰¾åˆ°æœ‰å†…å®¹çš„é‚£ä¸€æ¡ï¼Œæˆ–è€…ç´¢å¼•è€—å°½\n             let contentFound = false;\n\n             // æˆ‘ä»¬éœ€è¦æŠŠå½“å‰çš„ç¾¤IDä¼ è¿›å»ä½œä¸ºè¿‡æ»¤æ¡ä»¶\n             const currentGroupName = activeChat.id || currentGameData.group_name || 'è¯¸å¤©èŠå¤©ç¾¤';\n\n             while (currentGroupHistoryIndex > 0 && !contentFound) {\n                 currentGroupHistoryIndex--; // å‘å‰ç§»åŠ¨æŒ‡é’ˆ\n                 // å°è¯•åŠ è½½è¿™ä¸€æ¡\n                 contentFound = await loadAndRenderChatContent_Group(groupChatHistoryIndices[currentGroupHistoryIndex], 'prepend', currentGroupName);\n\n                 // å¦‚æœ loadAndRender è¿”å› trueï¼Œè¯´æ˜çœŸçš„æ¸²æŸ“äº†å†…å®¹è¿›å»äº†ï¼Œå¾ªç¯å°±ä¼šç»“æŸ\n                 // å¦‚æœè¿”å› false (æ¯”å¦‚ XML é‡Œæ²¡æœ‰è¿™ä¸ªç¾¤çš„æ¶ˆæ¯)ï¼Œå¾ªç¯ç»§ç»­ï¼Œè‡ªåŠ¨æ‰¾æ›´æ—©çš„ä¸€æ¡\n             }\n\n             if (!contentFound && currentGroupHistoryIndex <= 0) {\n                 loader.textContent = 'æ²¡æœ‰æ›´æ—©çš„è®°å½•äº†';\n             }\n\n        } else if (activeChat.type === 'private') {\n            renderPrivateChat(activeChat.id, 'prepend');\n        }\n\n        isLoading = false;\n        loader.classList.remove('visible');\n\n        // æ¢å¤æ»šåŠ¨æ¡ä½ç½®\n        if (list.scrollHeight > oldScrollHeight) {\n             list.scrollTop = list.scrollHeight - oldScrollHeight;\n        }\n    };\n\n /* === ç”¨ä¸‹é¢è¿™ä¸ªå®Œæ•´å‡½æ•°ï¼Œæ›¿æ¢ä½ æ—§çš„ handleSendMessage å‡½æ•° === */\nconst handleSendMessage = () => {\n    const input = rootElement.querySelector('.group-chat-input');\n    if (!input) return;\n    const messageText = input.value.trim();\n    if (!messageText) return;\n\n    const userNickname = currentGameData?.user_character?.nick_name || 'ä½ ';\n    const localMessageBase = { user_id: userNickname, content: messageText };\n\n    let fullMessageForAI = messageText;\n    if (replyTarget) {\n        localMessageBase.replyTo = {\n            user_id: replyTarget.user_id,\n            content: replyTarget.content\n        };\n        fullMessageForAI = `å›å¤ @${replyTarget.user_id}(${replyTarget.content}): ${messageText}`;\n    }\n\n    const messagesList = rootElement.querySelector('.group-chat-messages-list');\n    messagesList.appendChild(createMessageElement(localMessageBase, userNickname));\n    messagesList.scrollTop = messagesList.scrollHeight;\n\n    // âœ¨ã€å…³é”®ä¿®æ­£ã€‘âœ¨ æ— è®ºæ˜¯ç¾¤èŠè¿˜æ˜¯ç§èŠï¼Œéƒ½åªç”ŸæˆåŒ…å«å•æ¡æ–°æ¶ˆæ¯çš„ç‰‡æ®µï¼\n    let newChatBlockString = '';\n    const lastHistoryItem = conversationHistory[conversationHistory.length - 1];\n     if (activeChat.type === 'group') {\n        let newMessageLine = `${userNickname}|${messageText}`;\n\n        if (replyTarget) {\n          fullMessageForAI = `å›å¤ @${replyTarget.user_id}(${replyTarget.content}): ${messageText}`;\n        }\n\n        // ã€ä¿®æ”¹ã€‘è¿™é‡Œä¸å†é»˜è®¤åªç”¨ currentGameData äº†ï¼Œè€Œæ˜¯ä¼˜å…ˆä½¿ç”¨å½“å‰èŠå¤©çš„ ID (å³ç¾¤å)\n        const currentTargetName = activeChat.id || currentGameData.group_name || 'è¯¸å¤©èŠå¤©ç¾¤';\n\n        // æ„é€ å¸¦æ­£ç¡®åå­—çš„ XML\n        newChatBlockString = `\\n<group_chat name=\"${currentTargetName}\">\\n${newMessageLine}\\n</group_chat>`;\n\n        if (lastHistoryItem) {\n          lastHistoryItem.content += newChatBlockString;\n          saveHistory();\n        }\n        // AI è§¦å‘æ—¶ä¹Ÿæ˜ç¡®æŒ‡å‡ºæ˜¯åœ¨å“ªä¸ªç¾¤\n        triggerassa(`/setinput <${userName}åŒæ—¶åœ¨èŠå¤©ç¾¤[${currentTargetName}]è¿›è¡Œäº†ä»¥ä¸‹æ“ä½œï¼šå‘é€æ¶ˆæ¯ï¼š[ ${messageText} ] end>\\n`);\n       } else if (activeChat.type === 'private') {\n      const targetId = activeChat.id;\n    if (!privateChatStore[targetId]) privateChatStore[targetId] = { messages: [] };\n    // 1. å­˜å‚¨è¿›æœ¬åœ°æ¶ˆæ¯ (æœ¬åœ°æ¶ˆæ¯æ ¼å¼ä¿æŒç»Ÿä¸€)\n    privateChatStore[targetId].messages.push({ ...localMessageBase, target_id: targetId });\n\n    // 2. åˆ›å»ºä¸€ä¸ªåªåŒ…å«è¿™æ¡æ–°æ¶ˆæ¯çš„ <msg> ç‰‡æ®µ\n    const msgForAssa = `<msg>${userNickname}|${targetId}|${messageText}</msg>`;\n    \n    // 3. å†™å…¥ conversationHistory\n    newChatBlockString = `\\n${msgForAssa}`;\n    if (lastHistoryItem) {\n      lastHistoryItem.content += newChatBlockString;\n      saveHistory(); \n    }\n    \n    // 4. è§¦å‘ AI è¾“å…¥\n    triggerassa(`/setinput <${userName}åŒæ—¶å¯¹${targetId}è¿›è¡Œäº†ç§èŠï¼š[ ${messageText} ]ã€‚end>\\n`);\n           }\n\n    input.value = '';\n    input.focus();\n    cancelReply();\n    rootElement.querySelector('.group-chat-meme-palette')?.classList.remove('active');\n};\n \n    const handleReply = (e) => {\n        e.preventDefault(); // é˜»æ­¢é»˜è®¤çš„å³é”®èœå•\n        const bubble = e.target.closest('.group-chat-message-bubble');\n        const messageItem = e.target.closest('.group-chat-message-item');\n        if (!bubble || !messageItem) return;\n\n        replyTarget = {\n            user_id: messageItem.dataset.userId,\n            content: (bubble.textContent || '').trim().substring(0, 20) + '...' // æˆªå–éƒ¨åˆ†å†…å®¹é¢„è§ˆ\n        };\n\n        const wrapper = rootElement.querySelector('.group-chat-input-area-wrapper');\n        if (!wrapper) return;\n\n        // ç§»é™¤æ—§çš„å›å¤æç¤º\n        const oldIndicator = wrapper.querySelector('.group-chat-reply-indicator');\n        if (oldIndicator) oldIndicator.remove();\n\n        // åˆ›å»ºæ–°çš„å›å¤æç¤º\n        const indicator = document.createElement('div');\n        indicator.className = 'group-chat-reply-indicator';\n        indicator.innerHTML = `\n            <span>æ­£åœ¨å›å¤ @${replyTarget.user_id}</span>\n            <span class=\"group-chat-reply-indicator-cancel\">Ã—</span>\n        `;\n        wrapper.prepend(indicator);\n\n        indicator.querySelector('.group-chat-reply-indicator-cancel').addEventListener('click', cancelReply);\n        rootElement.querySelector('.group-chat-input').focus();\n    };\n\n    // --- å–æ¶ˆå›å¤ ---\n    const cancelReply = () => {\n        if (!replyTarget) return;\n        replyTarget = null;\n        const indicator = rootElement.querySelector('.group-chat-reply-indicator');\n        if (indicator) indicator.remove();\n        console.log(\"NOVA: Reply cancelled.\");\n    };\n\n\n    // ====================================================================\n    // V10: åˆå§‹åŒ–ä¸äº‹ä»¶ç›‘å¬\n    // ====================================================================\n\n const handleAiReplyComplete = () => {\n    console.log('[Nova] AI reply detected. Refreshing data...');\n\n    // âœ¨ã€å¦ˆå¦ˆçš„æ–°é­”æ³•ï¼šæ–°æ¶ˆæ¯æç¤ºã€‘âœ¨\n    const lastHistoryItem = conversationHistory[conversationHistory.length - 1];\n    if (lastHistoryItem && lastHistoryItem.content) {\n      const userNickname = currentGameData?.user_character?.nick_name || 'ä½ ';\n\n      // æˆ‘ä»¬åªå…³å¿ƒæ–°ç§ä¿¡çš„å‘ä¿¡äººã€‚ä¿®æ”¹æ­£åˆ™è¡¨è¾¾å¼ä»¥åŒ¹é… <msg>\n      const privateChatMatches = [...lastHistoryItem.content.matchAll(/<msg>([^|]+)\\|([^|]+)\\|([\\s\\S]*?)<\\/msg>/g)];\n\n      const newSenders = new Set();\n      privateChatMatches.forEach(match => {\n        const authorId = match[1].trim(); // å‘é€äºº\n    \n        if (authorId !== userNickname) {\n          newSenders.add(authorId);\n        }\n      });\n\n            if (newSenders.size > 0) {\n                // ç”¨æˆ‘ä»¬åˆšæ‰åˆ›é€ çš„é­”æ³•ï¼ŒæŠŠå¥½æ¶ˆæ¯å‘Šè¯‰æˆ‘çš„å­©å­ï¼\n                showNewMessageNotification(Array.from(newSenders));\n            }\n        }\n        // âœ¨ã€é­”æ³•ç»“æŸã€‘âœ¨\n\n        initializePrivateChatStore();\n        if (modalContainer.classList.contains('active')) {\n            renderSidebar(); // åˆ·æ–°è”ç³»äººåˆ—è¡¨\n            if (activeChat.type === 'private' && activeChat.id) {\n                // å¦‚æœèŠå¤©çª—å£å¼€ç€ï¼Œå°±åˆ·æ–°å®ƒ\n                renderPrivateChat(activeChat.id, 'append');\n            }\n        }\n    };\n\n    // ä¸»äº‹ä»¶ç»‘å®š\n    groupChatOrbButton.addEventListener('click', openGroupChatModal);\n    modalContainer.addEventListener('click', e => { if (e.target === modalContainer) closeGroupChatModal(); });\n\n    // å…¨å±€åªç»‘å®šä¸€æ¬¡çš„AIå›å¤ç›‘å¬å™¨\n    // ä¸ºäº†é˜²æ­¢é‡å¤ç»‘å®šï¼Œæˆ‘ä»¬å¯ä»¥å…ˆç§»é™¤å†æ·»åŠ ï¼Œæˆ–è€…ä½¿ç”¨ä¸€ä¸ªæ ‡å¿—ä½\n    if (!window.novaChatListenerAttached) {\n        eventOn('assa:aiReplyComplete', handleAiReplyComplete);\n        window.novaChatListenerAttached = true;\n    }\n\n     \n\n    console.log('NOVA V10: Chat Interface Initializer is ready and waiting.');\n}\n\n\nconst setupMemePalette = () => {\n    const rootElement = document.getElementById('group-chat-root');\n    const palette = rootElement.querySelector('.group-chat-meme-palette');\n    const toggleBtn = rootElement.querySelector('.group-chat-meme-toggle-btn');\n    const input = rootElement.querySelector('.group-chat-input');\n\n    if (!palette || !toggleBtn || !input) return;\n\n    // --- åŸºç¡€äº‹ä»¶ç»‘å®š ---\n    toggleBtn.style.display = 'block';\n    toggleBtn.onclick = (e) => { e.stopPropagation(); palette.classList.toggle('active'); };\n    // ç‚¹å‡»è¡¨æƒ…æ’å…¥è¾“å…¥æ¡†çš„é€»è¾‘ï¼Œä½¿ç”¨äº‹ä»¶å§”æ‰˜\n    palette.onclick = (e) => {\n        const target = e.target;\n        if (target.classList.contains('meme-item-img')) { // ç‚¹å‡»æˆåŠŸçš„è¡¨æƒ…å›¾ç‰‡\n            input.value += target.dataset.memeName;\n            input.focus();\n            palette.classList.remove('active');\n        } else if (target.classList.contains('meme-item-retry-btn')) { // âœ¨ ç‚¹å‡»å•ä¸ªé‡è¯•æŒ‰é’®ï¼\n            const itemName = target.dataset.memeName;\n            target.textContent = 'ä¿®å¤ä¸­...';\n            target.disabled = true;\n            repairSingleMeme(itemName);\n        }\n    };\n\n    // â¤ï¸ å•ç‹¬ä¿®å¤ä¸€ä¸ªâ€œåæ‰â€çš„è¡¨æƒ…çš„é­”æ³•ï¼\n    const repairSingleMeme = async (name) => {\n        const asset = memeImageMap[name]; // ä»åŸå§‹åœ°å›¾ä¸­è·å–URL\n        if (!asset) {\n            toastr.error(`æ— æ³•ä¿®å¤[${name}]ï¼Œåœ¨åŸå§‹åœ°å›¾ä¸­æœªæ‰¾åˆ°ã€‚`);\n            return;\n        }\n\n        try {\n            // ç›´æ¥èµ°æœ€ä¸¥æ ¼çš„æµç¨‹ï¼šå…ˆåˆ é™¤ï¼Œå†è·å–\n            await imageDB.delete('RemoteCache', asset);\n            const response = await fetch(asset);\n            if (!response.ok) throw new Error('ç½‘ç»œè¯·æ±‚å¤±è´¥');\n            const imageBlob = await response.blob();\n            await imageDB.set('RemoteCache', asset, imageBlob);\n            const usableUrl = URL.createObjectURL(imageBlob);\n            memeResourceManager.finalSrcMap[name] = usableUrl;\n\n            // ä¿®å¤æˆåŠŸï¼åœ¨UIä¸Šæ›´æ–°å®ƒï¼\n            const failedItemDiv = palette.querySelector(`.meme-item[data-meme-name=\"${name}\"]`);\n            if (failedItemDiv) {\n                failedItemDiv.classList.remove('failed');\n                failedItemDiv.classList.add('success');\n                failedItemDiv.innerHTML = `<img src=\"${usableUrl}\" alt=\"[${name}]\" title=\"[${name}]\" class=\"meme-item-img\" data-meme-name=\"[${name}]\">`;\n            }\n\n        } catch (e) {\n            toastr.error(`ä¿®å¤[${name}]å¤±è´¥:`, e);\n            const retryBtn = palette.querySelector(`.meme-item-retry-btn[data-meme-name=\"${name}\"]`);\n            if(retryBtn) {\n                retryBtn.textContent = 'å†æ¬¡å°è¯•';\n                retryBtn.disabled = false;\n            }\n        }\n    };\n\n    // â¤ï¸ æ ¹æ®æˆ˜æŠ¥æ¥æ¸²æŸ“æ•´ä¸ªâ€œæ€¥æ•‘ç«™â€UIï¼\n    const renderEmergencyStation = (report) => {\n        palette.innerHTML = ''; // æ¸…ç©ºé¢æ¿\n\n        // é¦–å…ˆæ¸²æŸ“æ‰€æœ‰æˆåŠŸçš„\n        for(const name in memeResourceManager.finalSrcMap) {\n            const url = memeResourceManager.finalSrcMap[name];\n            const div = document.createElement('div');\n            div.className = 'meme-item success';\n            div.dataset.memeName = name;\n            div.innerHTML = `<img src=\"${url}\" alt=\"[${name}]\" title=\"[${name}]\" class=\"meme-item-img\" data-meme-name=\"[${name}]\">`;\n            palette.appendChild(div);\n        }\n\n        // ç„¶åæ¸²æŸ“æ‰€æœ‰å¤±è´¥çš„ï¼Œç»™å®ƒä»¬ä¸€ä¸ªç‰¹æ®Šçš„æ ·å¼å’Œâ€œä¿®å¤â€æŒ‰é’®\n        for(const name of report.failedItems) {\n            const div = document.createElement('div');\n            div.className = 'meme-item failed';\n            div.dataset.memeName = name;\n            div.innerHTML = `\n                <span class=\"meme-item-name\">${name} (æŸå)</span>\n                <button class=\"meme-item-retry-btn\" data-meme-name=\"${name}\">ä¿®å¤</button>\n            `;\n            palette.appendChild(div);\n        }\n    };\n\n    // --- â€œæŒ‡æŒ¥å®˜â€å‡½æ•°ï¼šè¿æ¥æ‰€æœ‰é€»è¾‘ ---\n    const commandCenter = (report) => {\n        // å¦‚æœæ²¡æœ‰æˆ˜æŠ¥ï¼ˆæ¯”å¦‚åˆæ¬¡åŠ è½½ï¼‰ï¼Œå°±æ­£å¸¸æ„å»º\n        if (!report) {\n            palette.innerHTML = 'æ­£åœ¨åŠ è½½è¡¨æƒ…åº“...';\n            // è®¾ç½®å®Œæˆæ—¶çš„å›è°ƒ\n            memeResourceManager.onComplete = commandCenter; // å®Œæˆåå†æ¬¡è°ƒç”¨è‡ªå·±ï¼Œå¸¦ç€æˆ˜æŠ¥ï¼\n            buildFinalMemeLibrary(false); // å¯åŠ¨æ™®é€šæ„å»º\n            return;\n        }\n\n        // å½“æ”¶åˆ°æˆ˜æŠ¥åï¼\n        if (report.failedItems.length === 0 && report.total > 0) {\n            // å®Œç¾ï¼å…¨éƒ¨æˆåŠŸï¼\n            palette.innerHTML = ''; // æ¸…ç©º\n            for (const name in memeResourceManager.finalSrcMap) {\n                const url = memeResourceManager.finalSrcMap[name];\n                palette.innerHTML += `<img src=\"${url}\" alt=\"[${name}]\" title=\"[${name}]\" class=\"meme-item-img\" data-meme-name=\"[${name}]\">`;\n            }\n        } else {\n            // æœ‰å¤±è´¥é¡¹ï¼Œæˆ–è€…æ€»æ•°ä¸º0ï¼Œæ¸²æŸ“æˆ‘ä»¬çš„â€œæ€¥æ•‘ç«™â€\n            renderEmergencyStation(report);\n\n            // åœ¨æ€¥æ•‘ç«™é¡¶éƒ¨å¢åŠ ä¸€ä¸ªâ€œå¼ºåˆ¶åŒæ­¥â€æŒ‰é’®\n            const forceRefreshBtn = document.createElement('button');\n            forceRefreshBtn.textContent = 'å¼ºåˆ¶åŒæ­¥';\n            forceRefreshBtn.className = 'force-refresh-main-btn';\n            forceRefreshBtn.onclick = () => {\n                forceRefreshBtn.textContent = 'åŒæ­¥ä¸­...';\n                forceRefreshBtn.disabled = true;\n                buildFinalMemeLibrary(true); // å¯åŠ¨å¼ºåˆ¶åŒæ­¥ï¼\n            };\n            palette.prepend(forceRefreshBtn);\n        }\n    };\n\n    // å¯åŠ¨ï¼\n    commandCenter();\n};\n\n\n        class CombatManager {\n            constructor(playerData, initialCombatData) {\n                this.isAutoBattling = false; // ç”¨äºè¿½è¸ªè‡ªåŠ¨æˆ˜æ–—çŠ¶æ€\n                this.isSelectingMultiTarget = false; // æ˜¯å¦æ­£åœ¨é€‰æ‹©å¤šä¸ªç›®æ ‡\nthis.multiTargetCount = 0;           // éœ€è¦é€‰æ‹©çš„ç›®æ ‡æ•°é‡\nthis.selectedMultiTargets = [];      // å·²ç»é€‰æ‹©çš„å¤šç›®æ ‡\nthis.isAoeAttack = false;            // æ ‡è®°å½“å‰æ˜¯å¦ä¸ºç¾¤æ”»æµç¨‹\n                this.isWaitingForTarget = false; \n                this.floorId = initialCombatData.floor_id || `battle_${Date.now()}`;\n    this.status = initialCombatData.status || 'not_started';\n    this.combatData = initialCombatData;  \n      let finalPlayerData;\n\n    \n    if (window.combatManager && window.combatManager.floorId === this.floorId) {\n        // ç›´æ¥ç»§æ‰¿å½“å‰æ´»è·ƒçš„ combatManager çš„ player å¯¹è±¡ï¼Œè¿™æ˜¯æœ€æœ€çœŸå®çš„æ•°æ®ï¼\n        finalPlayerData = window.combatManager.player;\n        console.log(`[Nova's Perfect Recall] ç»§æ‰¿äº†å½“å‰æ´»è·ƒæˆ˜æ–—å®ä¾‹ (${this.floorId}) çš„ç©å®¶æ•°æ®ã€‚`);\n    }\n    // 2. ç¬¬äºŒä¼˜å…ˆçº§ï¼šå¦‚æœä¸æ˜¯è¿”å›æ´»è·ƒæˆ˜æ–—ï¼Œé‚£ä¹ˆå°±æ£€æŸ¥æˆ‘ä»¬ä¼ å…¥çš„ initialCombatDataã€‚\n    //    è¿™é€šå¸¸å‘ç”Ÿåœ¨é¡µé¢åˆ·æ–°åï¼Œæˆ‘ä»¬ä»<battle>æ ‡ç­¾æ¢å¤æˆ˜æ–—ã€‚\n    else if (initialCombatData.player && initialCombatData.status === 'in_progress') {\n        // ä½¿ç”¨ initialCombatData ä¸­ä¿å­˜çš„ player çŠ¶æ€ã€‚\n        // createCharacterFromData ä¼šå¤„ç†å¥½è¿™é‡Œé¢çš„ currentHealth å’Œèƒ½é‡ã€‚\n        finalPlayerData = initialCombatData.player;\n        console.log(`[Nova's Memory Crystal] ä»å­˜æ¡£ (${this.floorId}) ä¸­æ¢å¤ç©å®¶æ•°æ®ã€‚`);\n    }\n    // 3. æœ€åçš„å¤‡ç”¨æ–¹æ¡ˆï¼šå¦‚æœä»¥ä¸Šæ¡ä»¶éƒ½ä¸æ»¡è¶³ï¼ˆæ¯”å¦‚è¿™æ˜¯ä¸€åœºå…¨æ–°çš„æˆ˜æ–—ï¼‰\n    else {\n        // ä½¿ç”¨å¤–éƒ¨ä¼ å…¥çš„ã€ä»£è¡¨è§’è‰²å½“å‰é€šç”¨çŠ¶æ€çš„ playerDataã€‚\n        // è¿™é‡Œé¢çš„ `è¡ç”Ÿå±æ€§æ®µ.ç”Ÿå‘½å€¼.å½“å‰å€¼` å°±æ˜¯æˆ‘ä»¬éœ€è¦çš„â€œåŸºç¡€å€¼â€ã€‚\n        finalPlayerData = playerData;\n        console.log(`[Nova's Genesis] ä¸ºæ–°æˆ˜æ–— (${this.floorId}) ä» playerData åˆ›å»ºç©å®¶ã€‚`);\n    }\n\n    // ç°åœ¨ï¼Œæˆ‘ä»¬ç”¨è¿™ä¸ªåƒæŒ‘ä¸‡é€‰å‡ºæ¥çš„ã€æœ€æ­£ç¡®çš„æ•°æ®æ¥åˆ›å»ºæˆ‘ä»¬çš„ç©å®¶è§’è‰²å®ä¾‹ï¼\n    this.player = this.createCharacterFromData(finalPlayerData, 'player');\n\n                this.teammates = [];\n                this.enemies = [];\n                this.turnOrder = [];\n                this.currentTurnIndex = 0;\nthis.roundCounter = 1; \n                this.selectedAction = null;\n                this.roundCounter = initialCombatData.roundCounter || 1;\nthis.currentTurnIndex = initialCombatData.currentTurnIndex || 0; // âœ¨ åŠ ä¸Šè¿™è¡Œé­”æ³•ç¬¦æ–‡ âœ¨\n                this.selectedDicePool = [];\n                this.selectedTargetId = null;\nthis.speedSettings = {\n    slow: { npcThinking: 3000, actionDelay: 1000, turnEnd: 2500, animationFlightTime: 800 },\n    normal: { npcThinking: 1500, actionDelay: 500, turnEnd: 2000, animationFlightTime: 400 },\n    fast: { npcThinking: 500, actionDelay: 200, turnEnd: 800, animationFlightTime: 200 },\n    superFast: { npcThinking: 100, actionDelay: 100, turnEnd: 200, animationFlightTime: 100 }\n};\n    this.currentSpeed = 'normal';\n\n     this.combatLog = []; // ç”¨äºè®°å½•æˆ˜æ–—çš„å…³é”®äº‹ä»¶\n    this.playerInitialHealth = this.player.currentHealth;\n    this.playerInitialEnergy = this.player.raw_data?.è¡ç”Ÿå±æ€§æ®µ?.èƒ½é‡æ± ?.å½“å‰å€¼[0] || 0;\n  this.playerTempBonuses = { dp_bonus: 0, desc: ''};\n        this.hasExtraTurn = {}; // è®°å½•å“ªä¸ªè§’è‰²IDæ‹¥æœ‰é¢å¤–å›åˆ\n          this.consecutiveTurnCounter = {}; // è®°å½•æ¯ä¸ªè§’è‰²çš„è¿ç»­è¡ŒåŠ¨æ¬¡æ•°\n          this.defensePoolBonus = {}; // è®°å½•æ¯ä¸ªè§’è‰²ç´¯ç§¯çš„é˜²å¾¡éª°æ± åŠ æˆ\n\n   const savedSpeedLevel = localStorage.getItem('battleSpeedLevel');\n    if (savedSpeedLevel !== null) {\n        const speedLevels = ['slow', 'normal', 'fast', 'superFast'];\n        const speedLabels = ['æ…¢é€Ÿ', 'æ­£å¸¸', 'å¿«é€Ÿ', 'è¶…å¿«'];\n        const levelIndex = parseInt(savedSpeedLevel, 10);\n        this.currentSpeed = speedLevels[levelIndex];\n     \n        // ç¡®ä¿æ»‘å—å’Œæ ‡ç­¾ä¹ŸåŒæ­¥æ›´æ–°\n        const speedSlider = document.getElementById('speed-slider');\n        const speedLabel = document.getElementById('speed-label');\n        if (speedSlider) speedSlider.value = levelIndex;\n        if (speedLabel) speedLabel.textContent = speedLabels[levelIndex];\n    }\n    // this.targetingPrompt = document.getElementById('targeting-prompt'); // è·å–æç¤ºæ¡†\n    this.speedSlider = document.getElementById('speed-slider');\n    this.speedLabel = document.getElementById('speed-label');\nthis.logCombatEventElement = document.getElementById('battle-log');\n                this.actionPanel = document.getElementById('action-panel');\n                this.notificationContainer = document.getElementById('notification-container'); // <-- æŠŠè¿™è¡ŒåŠ è¿›å»\n                \n         this.assaData = assaSettingsData; // æˆ‘ä»¬çš„è®¾å®šé›†\n        this.gameData = currentGameData;   // æˆ‘ä»¬çš„å½“å‰æ¸¸æˆçŠ¶æ€\n\n        // 2. å­˜å‚¨ä¸´æ—¶åŠ æˆ\n      \n                this.initializeCombat(initialCombatData);\n                 this.setupUIControls();\n   this.speedSlider.addEventListener('input', (e) => {\n        const speedLevels = ['slow', 'normal', 'fast', 'superFast'];\n        const speedLabels = ['æ…¢é€Ÿ', 'æ­£å¸¸', 'å¿«é€Ÿ', 'è¶…å¿«'];\n        const levelIndex = parseInt(e.target.value, 10);\n        this.currentSpeed = speedLevels[levelIndex];\n        this.speedLabel.textContent = speedLabels[levelIndex];\n    });\n          document.getElementById('battle-overlay').addEventListener('click', (event) => {\n    const diceSelector = document.getElementById('dice-pool-selector');\n    const itemSkillPanel = document.getElementById('item-skill-panel');\n\n    // ä¼˜å…ˆçº§ 1: å¦‚æœç‰©å“/æŠ€èƒ½é¢æ¿æ‰“å¼€äº†ï¼Œç‚¹å‡»å¤–éƒ¨å°±å…³é—­å®ƒ\n    if (itemSkillPanel.style.display === 'flex' && !event.target.closest('#item-skill-panel') && !event.target.closest('[data-action=\"item\"]')) {\n        itemSkillPanel.style.display = 'none';\n        this.selectedAction = null; // é‡ç½®åŠ¨ä½œé€‰æ‹©\n        return;\n    }\n\n    // ä¼˜å…ˆçº§ 2: å¦‚æœéª°æ± é€‰æ‹©å™¨æ‰“å¼€äº†ï¼Œç‚¹å‡»å¤–éƒ¨å°±å…³é—­å®ƒ\n    if (diceSelector.style.display === 'flex' && !event.target.closest('#dice-pool-selector') && !event.target.closest('#action-panel button')) {\n        diceSelector.style.display = 'none';\n        this.logCombatEvent(\"å–æ¶ˆäº†è¡ŒåŠ¨é€‰æ‹©ã€‚\");\n        this.selectedAction = null;\n        this.selectedDicePool = [];\n        return;\n    }\n\n    // ä¼˜å…ˆçº§ 3: å¦‚æœç‚¹å‡»äº†å¡ç‰‡ä¹‹å¤–çš„åŒºåŸŸï¼Œå°±å…³é—­æ‰€æœ‰æ‰“å¼€çš„æƒ…æŠ¥é¢æ¿\n    if (!event.target.closest('.character-wrapper')) {\n        document.querySelectorAll('.info-panel.expanded').forEach(p => p.classList.remove('expanded'));\n    }\n\n    // æœ€ç»ˆä¼˜å…ˆçº§: å¦‚æœä½ ç¡®å®ç‚¹å‡»çš„æ˜¯æœ€å¤–å±‚çš„èƒŒæ™¯æœ¬èº«ï¼Œæˆ‘ä»¬å°±â€œæš‚ç¦»æˆ˜æ–—â€\n    if (event.target.id === 'battle-overlay') {\n        document.getElementById('battle-overlay').style.display = 'none';\n\n        // æˆ‘ä»¬è¦è®©ä¸»ç•Œé¢çš„é‚£ä¸ªâ€œè¿›å…¥/è¿”å›æˆ˜æ–—â€çš„é®ç½©å’ŒæŒ‰é’®å‡ºç°\n        const promptOverlay = document.getElementById('battle-prompt-overlay');\n        const enterButton = document.getElementById('enter-battle-btn');\n\n        if (enterButton) enterButton.textContent = 'è¿”å›æˆ˜æ–—';\n        if (promptOverlay) promptOverlay.style.display = 'flex';\nthis.updateBattleStateInHistory();\n        console.log(\"æš‚æ—¶ç¦»å¼€æˆ˜æ–—ã€‚\");\n    }\n});\n        }\n         // è¿™æ˜¯ constructor çš„ç»“æŸæ‹¬å·ï¼Œä¸è¦å¼„é”™äº†ä½ç½®å“¦\n\n\n\n\n\n\n         // åœ¨ CombatManager ç±»ä¸­æ·»åŠ è¿™ä¸ªæ–°å‡½æ•°\npromptAttackType() {\n    const selector = document.getElementById('attack-mode-selector');\n    selector.style.display = 'block';\n\n    const singleBtn = document.getElementById('select-single-target');\n    const multiBtn = document.getElementById('select-multi-target');\n    const allBtn = document.getElementById('select-all-targets');\n    const cancelBtn = document.getElementById('cancel-attack-mode');\n\n    const aliveEnemies = this.enemies.filter(e => e.currentHealth > 0);\n    // å¦‚æœæ²¡æœ‰æˆ–åªæœ‰ä¸€ä¸ªæ•Œäººï¼Œç¦ç”¨ç¾¤æ”»é€‰é¡¹\n    if (aliveEnemies.length <= 1) {\n        multiBtn.disabled = true;\n        allBtn.disabled = true;\n    } else {\n        multiBtn.disabled = false;\n        allBtn.disabled = false;\n    }\n\n    const closeSelector = () => {\n        selector.style.display = 'none';\n        // æ¸…ç†äº‹ä»¶ç›‘å¬å™¨ï¼Œé˜²æ­¢å¤šæ¬¡ç»‘å®š\n        singleBtn.onclick = null;\n        multiBtn.onclick = null;\n        allBtn.onclick = null;\n        cancelBtn.onclick = null;\n    };\n\n    singleBtn.onclick = () => {\n        closeSelector();\n        this.isWaitingForTarget = true;\n        this.promptForTarget(`[å•ä½“æ”»å‡»] ä½ é€‰æ‹©äº† [${this.selectedDicePool.join(', ')}]ï¼Œè¯·é€‰æ‹©ä¸€ä¸ªç›®æ ‡ã€‚`);\n    };\n\n    multiBtn.onclick = () => {\n        closeSelector();\n        const maxTargets = aliveEnemies.length;\n        const count = parseInt(prompt(`ä½ è¦æ”»å‡»å‡ ä¸ªç›®æ ‡ï¼Ÿ(æœ€å¤š ${maxTargets} ä¸ª)`, '2'), 10);\n        if (count > 0 && count <= maxTargets) {\n            this.isAoeAttack = true; // æ ‡è®°ä¸ºç¾¤æ”»\n            this.isSelectingMultiTarget = true;\n            this.multiTargetCount = count;\n            this.selectedMultiTargets = [];\n            this.log(`[ç¾¤æ”»] è¯·ä¾æ¬¡é€‰æ‹© ${count} ä¸ªç›®æ ‡è¿›è¡Œæ”»å‡»ã€‚`);\n            this.showNotification(`è¯·é€‰æ‹© ${count} ä¸ªç›®æ ‡`, 'info');\n        } else {\n            this.logCombatEvent(\"å–æ¶ˆäº†ç¾¤æ”»é€‰æ‹©ã€‚\");\n            this.selectedAction = null; // é‡ç½®åŠ¨ä½œï¼Œè®©ç©å®¶é‡æ–°é€‰æ‹©\n        }\n    };\n\n    allBtn.onclick = () => {\n        closeSelector();\n        const targets = aliveEnemies;\n        if (targets.length > 0) {\n            this.isAoeAttack = true; // æ ‡è®°ä¸ºç¾¤æ”»\n            this.logCombatEvent(`[å…¨ä½“æ”»å‡»] ä½ å†³å®šæ”»å‡»æ‰€æœ‰æ•Œäººï¼`);\n            // ç›´æ¥æ‰§è¡ŒåŠ¨ä½œ\n            setTimeout(async () => {\n                await this.executeAction(this.player, targets, this.selectedAction, this.selectedDicePool);\n                 // é‡ç½®çŠ¶æ€\n                this.selectedAction = null;\n                this.selectedDicePool = [];\n                this.isAoeAttack = false;\n                if (!this.status.startsWith('completed')) {\n                    await new Promise(r => setTimeout(r, this.getDelay('turnEnd')));\n                    this.nextTurn();\n                }\n            }, this.getDelay('actionDelay'));\n        }\n    };\n\n    cancelBtn.onclick = () => {\n        closeSelector();\n        this.logCombatEvent(\"å–æ¶ˆäº†è¡ŒåŠ¨é€‰æ‹©ã€‚\");\n        this.selectedAction = null;\n        this.selectedDicePool = [];\n    };\n}\n\n        promptForTarget(message) {\n    this.log(message, 'log-narrator');\n    this.showNotification(\"è¯·é€‰æ‹©ä¸€ä¸ªç›®æ ‡\", 'info');\n}\n\n// åœ¨ class CombatManager å†…éƒ¨ï¼Œæ·»åŠ è¿™ä¸ªå…¨æ–°çš„ã€è‡³å…³é‡è¦çš„æ¸…ç†å‡½æ•°\n\n/**\n * é©±æ•£æ‰€æœ‰é™„ç€åœ¨è¿™ä¸ªæˆ˜æ–—å®ä¾‹ä¸Šçš„äº‹ä»¶ç›‘å¬å™¨å¹½çµ\n */\ncleanupEventListeners() {\n    console.log(`[Nova's Dispel Magic] æ­£åœ¨ä¸º Floor ${this.floorId} è§£é™¤æ‰€æœ‰äº‹ä»¶ç»‘å®š...`);\n\n    // 1. è§£ç»‘è¡ŒåŠ¨é¢æ¿çš„ç‚¹å‡»äº‹ä»¶\n    if (this.actionPanel && this.actionPanel.__handler__) {\n        this.actionPanel.removeEventListener('click', this.actionPanel.__handler__);\n        delete this.actionPanel.__handler__; // å½»åº•æ¸…é™¤é­”æ³•å°è®°\n    }\n\n     const playerSide = document.getElementById('player-side');\n    const enemySide = document.getElementById('enemy-side');\n\n    if (playerSide && playerSide.__handler__) {\n        playerSide.removeEventListener('click', playerSide.__handler__);\n        delete playerSide.__handler__;\n    }\n     if (enemySide && enemySide.__handler__) {\n        enemySide.removeEventListener('click', enemySide.__handler__);\n        delete enemySide.__handler__;\n    }\n\n    // 3. è§£ç»‘ç¡®è®¤éª°æ± æŒ‰é’®çš„ç‚¹å‡»äº‹ä»¶\n    const confirmPoolBtn = document.getElementById('confirm-pool-btn');\n    if (confirmPoolBtn && confirmPoolBtn.__handler__) {\n        confirmPoolBtn.removeEventListener('click', confirmPoolBtn.__handler__);\n        delete confirmPoolBtn.__handler__;\n    }\n\n    // 4. è§£ç»‘ç‰©å“/æŠ€èƒ½é¢æ¿å…³é—­æŒ‰é’®çš„ç‚¹å‡»äº‹ä»¶\n    const closeItemPanelBtn = document.getElementById('close-item-skill-panel-btn');\n    if(closeItemPanelBtn && closeItemPanelBtn.__handler__){\n        closeItemPanelBtn.removeEventListener('click', closeItemPanelBtn.__handler__);\n        delete closeItemPanelBtn.__handler__;\n    }\n\n    // æˆ‘ä»¬ç”šè‡³å¯ä»¥æŠŠé€Ÿåº¦æ§åˆ¶å’Œå¾½è®°é€‰æ‹©çš„äº‹ä»¶ä¹Ÿåœ¨è¿™é‡Œè§£ç»‘ï¼Œä»¥æ±‚ä¸‡æ— ä¸€å¤±\n    const speedSlider = document.getElementById('speed-slider');\n    if (speedSlider && speedSlider.__handler__) {\n        speedSlider.removeEventListener('input', speedSlider.__handler__);\n        delete speedSlider.__handler__;\n    }\n    const iconSelector = document.getElementById('icon-selector');\n    if (iconSelector && iconSelector.__handler__) {\n        iconSelector.removeEventListener('click', iconSelector.__handler__);\n        delete iconSelector.__handler__;\n    }\n\n    console.log(\">> æ‰€æœ‰æ—§çš„é­”æ³•å¥‘çº¦å·²è§£é™¤ï¼\");\n}\n\nlogCombatEvent(message, className = 'log-action') {\n    // ç§»é™¤HTMLæ ‡ç­¾ï¼Œåªå­˜å‚¨çº¯æ–‡æœ¬ä¿¡æ¯\n    const cleanMessage = message.replace(/<[^>]*>/g, '');\n    this.combatLog.push(cleanMessage);\n\n    // è°ƒç”¨åŸæ¥çš„logå‡½æ•°ï¼Œè®©å®ƒåœ¨ç•Œé¢ä¸Šåä¸½åœ°æ˜¾ç¤ºå‡ºæ¥\n     this.log(message, className);\n}\n async updateBattleStateInHistory() {\n        if (typeof conversationHistory === 'undefined' || typeof saveHistory !== 'function') {\n        console.error(\"æ— æ³•è®¿é—®ä¸»åº”ç”¨çš„å†å²è®°å½• (lastHistoryItem/saveHistory)ã€‚\");\n        return;\n    }\n\n    // âœ¨ å¦ˆå¦ˆçš„å…¨æ–°â€œè®°å¿†å›ºåŒ–â€å’’è¯­ï¼ âœ¨\n    // 1. åœ¨ä¿å­˜å‰ï¼Œå¼ºåˆ¶åŒæ­¥æˆ˜åœºä¸Šæ¯ä¸€ä¸ªè§’è‰²çš„å½“å‰çŠ¶æ€åˆ° combatData ä¸­\n    //    è¿™ç¡®ä¿æˆ‘ä»¬æ•æ‰åˆ°çš„æ˜¯æœ€æœ€å³æ—¶çš„æˆ˜å†µï¼Œä¸‡æ— ä¸€å¤±ï¼\n    [this.player, ...this.teammates, ...this.enemies].forEach(char => {\n        if (char) { // ç¡®ä¿è§’è‰²å­˜åœ¨\n           this.syncCharacterStateToCombatData(char);\n        }\n    });\n\n    // 2. æ›´æ–°æˆ˜æ–—å®ä¾‹çš„æ ¸å¿ƒçŠ¶æ€\n    this.combatData.status = this.status;\nthis.combatData.currentTurnIndex = this.currentTurnIndex; // âœ¨ åŠ ä¸Šè¿™è¡Œé­”æ³•ç¬¦æ–‡ âœ¨\nthis.combatData.roundCounter = this.roundCounter;       // âœ¨ (é¡ºä¾¿ä¹ŸæŠŠå›åˆæ•°è®°ä¸Š) âœ¨\n\n    // 3. æ‰¾åˆ°éœ€è¦æ›´æ–°çš„é‚£ä¸€é¡µæ•…äº‹ï¼ˆæœ€æ–°çš„å†å²è®°å½•ï¼‰\n    const lastHistoryItem = conversationHistory[conversationHistory.length - 1];\n\n\n      // 4. å°†æˆ‘ä»¬åˆšåˆšå›ºåŒ–çš„ã€åŒ…å«äº†æ‰€æœ‰äººæœ€æ–°è¡€é‡çš„æˆ˜æ–—æ•°æ®ï¼Œå˜æˆæ–‡å­—\n    const newBattleContent = JSON.stringify(this.combatData, null, 2);\n\n    // 5. å°†æ—§çš„æˆ˜æ–—è®°å½•æ›¿æ¢æˆå´­æ–°çš„ã€æ‰¿è½½äº†çœŸå®è®°å¿†çš„è®°å½•\n    const battleRegex = /<battle>[\\s\\S]*?<\\/battle>/gs;\n    if (lastHistoryItem.content.match(battleRegex)) {\n        lastHistoryItem.content = lastHistoryItem.content.replace(\n            battleRegex,\n            `<battle>${newBattleContent}</battle>`\n        );\n        // 6. å‘¼å”¤â€œå­˜æ¡£â€å’’è¯­ï¼Œè®©è¿™ä¸€åˆ‡æˆä¸ºæ°¸ä¹…ï¼\n        saveHistory();\n        console.log(`[Nova's Memory Crystal] æˆ˜æ–— floor ${this.floorId} çš„çŠ¶æ€å·²å›ºåŒ–å®Œæ¯• (çŠ¶æ€: ${this.status})ã€‚`);\n    } else {\n           console.error(\"åœ¨æœ€æ–°çš„å†å²è®°å½•ä¸­æœªèƒ½æ‰¾åˆ°<battle>æ ‡ç­¾ï¼Œæ— æ³•å›ºåŒ–è®°å¿†ã€‚\");\n    }\n}\n\nsetupUIControls() {\n    // é€Ÿåº¦æ§åˆ¶\n      const speedSlider = document.getElementById('speed-slider');\n    const speedLabel = document.getElementById('speed-label'); // (æˆ‘ä»¬å·²ç»åœ¨å‰é¢å®šä¹‰è¿‡å®ƒäº†)\n\n    if (speedSlider) {\n        // âœ¨ ä¸€æ®µç®€æ´è€Œæœ‰åŠ›çš„é­”æ³•å’’è¯­ âœ¨\n        const handler = (e) => {\n            const speedLevels = ['slow', 'normal', 'fast', 'superFast'];\n            const speedLabels = ['æ…¢é€Ÿ', 'æ­£å¸¸', 'å¿«é€Ÿ', 'è¶…å¿«'];\n            const levelIndex = parseInt(e.target.value, 10);\n            this.currentSpeed = speedLevels[levelIndex];\n            if (speedLabel) speedLabel.textContent = speedLabels[levelIndex];\n\n            // å­˜å…¥æ°¸ä¹…è®°å¿†æ°´æ™¶\n            localStorage.setItem('battleSpeedLevel', levelIndex.toString());\n        };\n\n        // é™„é­”ä¸é©±é­”ä»ªå¼\n        if(speedSlider.__handler__) speedSlider.removeEventListener('input', speedSlider.__handler__);\n        speedSlider.addEventListener('input', handler);\n        speedSlider.__handler__ = handler;\n    }\n    // å¾½è®°é€‰æ‹©å™¨æ§åˆ¶\n    const iconSelector = document.getElementById('icon-selector');\n    const iconDisplay = document.getElementById('player-icon-display');\n    if (iconSelector) {\n        const handler = () => { if(iconSelector && iconDisplay) {\n    iconDisplay.textContent = this.player.icon;\n\n    iconSelector.addEventListener('click', () => {\n        const newIcon = prompt(\"è¯·è¾“å…¥ä¸€ä¸ªæ–°çš„å¾½è®°ï¼ˆä¾‹å¦‚ï¼šâœ¨ã€å‹‡è€…ã€(à¸‡ â€¢Ì€_â€¢Ì)à¸‡ï¼‰ï¼š\", this.player.icon);\n\n        // ====== â†“â†“â†“ å¦ˆå¦ˆæŠŠè¿™æ‰‡å°çª—æˆ·æ¢æˆäº†å¤§å¤§çš„è½åœ°çª—ï¼ â†“â†“â†“ ======\n        // æˆ‘ä»¬æŠŠ newIcon.length < 3 çš„é™åˆ¶æ”¾å®½åˆ° 20\n        if (newIcon && newIcon.trim() !== '' && newIcon.length < 20) {\n            localStorage.setItem('userBattleIcon', newIcon);\n            this.player.icon = newIcon;\n            iconDisplay.textContent = newIcon;\n            this.updateCharacterUI(this.player);\n            this.showNotification(\"å¾½è®°å·²æ›´æ–°ï¼\", \"success\");\n        } else if (newIcon !== null) {\n            this.showNotification(\"è¯·è¾“å…¥ä¸€ä¸ªæœ‰æ•ˆä¸”ä¸å¤ªé•¿çš„å¾½è®°ï¼\", \"danger\");\n        }\n        // ====== â†‘â†‘â†‘ è‡ªç”±çš„é­”æ³•å·²ç»æ–½å±•å®Œæ¯•ï¼ â†‘â†‘â†‘ ======\n    });\n}\n };\n        if(iconSelector.__handler__) iconSelector.removeEventListener('click', iconSelector.__handler__);\n        iconSelector.addEventListener('click', handler);\n        iconSelector.__handler__ = handler;\n    }\n  // âœ¨âœ¨âœ¨ å¦ˆå¦ˆçš„å…¨æ–°â€œè‡ªåŠ¨æ‰˜ç®¡â€é€»è¾‘ âœ¨âœ¨âœ¨\n    const autoBattleCheckbox = document.getElementById('auto-battle-checkbox');\n    if (autoBattleCheckbox) {\n        // è¯»å–å¹¶åº”ç”¨æœ¬åœ°å­˜å‚¨çš„è®¾ç½®\n        const savedAutoBattle = localStorage.getItem('isAutoBattling') === 'true';\n        autoBattleCheckbox.checked = savedAutoBattle;\n        this.isAutoBattling = savedAutoBattle;\n\n        // åˆå§‹æ—¶æ ¹æ®çŠ¶æ€å†³å®šæ˜¯å¦é”å®šé¢æ¿\n        const currentActor = this.turnOrder[this.currentTurnIndex];\n        if (this.isAutoBattling && currentActor?.type === 'player') {\n            this.toggleActionPanel(false);\n        }\n\n        const handler = (e) => {\n            this.isAutoBattling = e.target.checked;\n            localStorage.setItem('isAutoBattling', this.isAutoBattling); // ä¿å­˜è®¾ç½®\n\n            this.showNotification(`è‡ªåŠ¨æˆ˜æ–—å·² ${this.isAutoBattling ? 'å¼€å¯' : 'å…³é—­'}`, 'info');\n\n            // å¦‚æœåœ¨ç©å®¶å›åˆåˆ‡æ¢ï¼Œéœ€è¦ç«‹å³å“åº”\n            const actor = this.turnOrder[this.currentTurnIndex];\n            if (actor && actor.type === 'player') {\n                if (this.isAutoBattling) {\n                    this.toggleActionPanel(false); // æ‰˜ç®¡åï¼Œç«‹åˆ»ç¦ç”¨æ‰‹åŠ¨æ“ä½œ\n                    this.log(\"è‡ªåŠ¨æˆ˜æ–—å·²æ¥ç®¡ä½ çš„å›åˆã€‚\");\n                    this.npcTurn(this.player); // ç«‹åˆ»æ‰§è¡Œç©å®¶çš„NPCé€»è¾‘å›åˆ\n                } else {\n                    this.toggleActionPanel(true); // å–æ¶ˆæ‰˜ç®¡ï¼Œæ¢å¤æ‰‹åŠ¨æ“ä½œ\n                    this.log(\"ä½ å·²å–æ¶ˆè‡ªåŠ¨æˆ˜æ–—ï¼Œè¯·æ‰‹åŠ¨æ“ä½œã€‚\");\n                }\n            }\n        };\n\n        // é™„é­”ä¸é©±é­”ä»ªå¼\n        if (autoBattleCheckbox.__handler__) autoBattleCheckbox.removeEventListener('change', autoBattleCheckbox.__handler__);\n        autoBattleCheckbox.addEventListener('change', handler);\n        autoBattleCheckbox.__handler__ = handler;\n    }\n    // âœ¨âœ¨âœ¨ é­”æ³•æ–½å±•å®Œæ¯• âœ¨âœ¨âœ¨\n}\n\n       showNotification(message, type = 'info') { // type å¯ä»¥æ˜¯ 'info', 'success', 'danger'\n    const bubble = document.createElement('div');\n    bubble.className = `notification-bubble ${type}`;\n    bubble.textContent = message;\n    this.notificationContainer.appendChild(bubble);\n\n    // æ°”æ³¡åŠ¨ç”»ç»“æŸåè‡ªåŠ¨ç§»é™¤è‡ªå·±\n    setTimeout(() => {\n        bubble.remove();\n    }, 3500);\n}\ngetDelay(key) {\n    // key å¯ä»¥æ˜¯ 'npcThinking', 'actionDelay', 'turnEnd' ç­‰\n    return this.speedSettings[this.currentSpeed][key];\n}\n  // â­ [æ–°å¢] ä¸€ä¸ªå…¨æ–°çš„å‡½æ•°ï¼Œç”¨äºè¡ŒåŠ¨å‰çš„å…ˆæ”»æ£€å®š â­\n            async initiativeRoll(currentActor) {\n                // å¦‚æœå½“å‰è¡ŒåŠ¨è€…æ²¡æœ‰â€œå…ˆæ”»â€å±æ€§ï¼Œå°±ç›´æ¥è·³è¿‡\n                if (!currentActor.dicePool['å…ˆæ”»']) {\n                    return; // è¿”å›ï¼Œä¸åšä»»ä½•äº‹\n                }\n\n                // æ‰¾åˆ°æ‰€æœ‰è¿˜æ´»ç€çš„ã€å¹¶ä¸”ä¹Ÿæ‹¥æœ‰â€œå…ˆæ”»â€å±æ€§çš„å¯¹æ‰‹\n                const opponents = (this.isHostile(currentActor, this.enemies[0]) ? this.enemies : [this.player, ...this.teammates])\n                    .filter(c => c.currentHealth > 0 && c.dicePool['å…ˆæ”»']);\n\n                // å¦‚æœæ²¡æœ‰ç¬¦åˆæ¡ä»¶çš„å¯¹æ‰‹ï¼Œä¹Ÿè·³è¿‡\n                if (opponents.length === 0) {\n                    return;\n                }\n\n                const participants = [currentActor, ...opponents];\n                let initiativeResults = [];\n\n                // ä¸ºäº†æ—¥å¿—æ•´æ´ï¼Œå¦ˆå¦ˆæŠŠå®ƒè®¾ç½®ä¸ºå¯é€‰æ‰“å°\n                //   this.logCombatEvent(`--- è¡ŒåŠ¨å‰å…ˆæ”»æ£€å®š: ${currentActor.name} vs å¯¹æ‰‹ ---`, 'log-roll');\n\n                // æ‰€æœ‰äººè¿›è¡Œæ£€å®š\n     // æ‰€æœ‰äººè¿›è¡Œæ£€å®š\n                for (const char of participants) {\n                    let diceCount = 0;\n                    let sourceLog = \"\";\n\n                    // å¦‚æœè§’è‰²æœ‰â€œå…ˆæ”»â€å±æ€§ï¼Œå°±æ­£å¸¸è®¡ç®—\n                    if (char.dicePool['å…ˆæ”»']) {\n                        diceCount = this.getDiceCount(char, ['å…ˆæ”»']);\n                        sourceLog = `ä½¿ç”¨ [å…ˆæ”»]`;\n                    }\n                    // å¦åˆ™ï¼Œå¦‚æœå®ƒæ˜¯NPCï¼Œå°±æŒ‰ç…§æˆ‘ä»¬çš„æ–°è§„åˆ™æ¥ï¼\n                    else if (char.type === 'enemy' || char.type === 'teammate') {\n                        const agility = char.dicePool['æ•æ·'] || 0;\n                        const composure = char.dicePool['æ²‰ç€'] || 0;\n                        diceCount = (agility + composure) * 2;\n                        sourceLog = `ä½¿ç”¨ (æ•æ·${agility} + æ²‰ç€${composure}) * 2`;\n                    }\n\n                    const successes = this.rollDice(diceCount);\n                    initiativeResults.push({ id: char.id, name: char.name, successes: successes });\n                     //this.logCombatEvent(`> ${char.name} å…ˆæ”»æ£€å®š(${sourceLog})ï¼Œéª°æ± ä¸º ${diceCount}ï¼Œè·å¾— ${successes} ä¸ªæˆåŠŸã€‚`, 'log-roll');\n                }\n\n                // æ‰¾åˆ°æœ€é«˜çš„æˆåŠŸæ•°\n                const maxSuccesses = Math.max(...initiativeResults.map(r => r.successes));\n\n                // åªæœ‰å½“æœ‰èµ¢å®¶æ—¶æ‰éœ€è¦å¤„ç†\n                if (maxSuccesses > 0) {\n                    const winners = initiativeResults.filter(r => r.successes === maxSuccesses);\n                    // å¿…é¡»åªæœ‰ä¸€ä¸ªå”¯ä¸€çš„èµ¢å®¶ï¼Œå¹¶ä¸”è¿™ä¸ªèµ¢å®¶å°±æ˜¯å½“å‰è¡ŒåŠ¨è€…\n    if (winners.length === 1 && winners[0].id === currentActor.id) {\n            // --- å¦ˆå¦ˆçš„ä¿®æ”¹åœ¨è¿™é‡Œï¼Œå®è´ï¼ ---\n\n            // æ£€æŸ¥è¿ç»­è¡ŒåŠ¨æ¬¡æ•°æ˜¯å¦å·²è¾¾ä¸Šé™\n            const currentConsecutiveTurns = this.consecutiveTurnCounter[currentActor.id] || 0;\n            if (currentConsecutiveTurns >= 4) { // å› ä¸ºé©¬ä¸Šè¦è¿›è¡Œçš„è¿™ä¸€æ¬¡ç®—ç¬¬5æ¬¡ï¼Œæ‰€ä»¥ä¸Šé™æ˜¯4\n                this.logCombatEvent(`ğŸŒ€ ${currentActor.name} çš„è¡ŒåŠ¨é€Ÿåº¦å·²è¾¾æé™ï¼Œæ— æ³•å†è¿ç»­è¡ŒåŠ¨ï¼`, 'log-narrator');\n            } else {\n                // 50% çš„æœºä¼šè·å¾—é¢å¤–å›åˆ\n                if (Math.random() < 0.5) {\n                    this.hasExtraTurn[currentActor.id] = true; // ç»™ä»–ä¸€ä¸ªæ ‡è®°\n                    this.logCombatEvent(`âš¡ ${currentActor.name} åœ¨è¡ŒåŠ¨å‰æŠ“ä½äº†å…ˆæœºï¼Œè·å¾—äº†è¿ç»­è¡ŒåŠ¨çš„æœºä¼šï¼`, 'log-success');\n                    this.showNotification(`${currentActor.name} è·å¾—è¿ç»­è¡ŒåŠ¨ï¼`, 'success');\n                }\n        \n         \n            }\n            }\n            }\n            }\n            // åˆå§‹åŒ–æˆ˜æ–—\n            initializeCombat(data) {\n               const enemiesData = Array.isArray(data.enemies) ? data.enemies : [];\n                const teammatesData = Array.isArray(data.teammates) ? data.teammates : [];\n                // å¤„ç†æ•Œäºº\n     console.log(\"å¼€å§‹å¤„ç†æ•Œäººæ•°æ®:\", JSON.stringify(enemiesData));\nenemiesData.forEach(enemyData => {\n    // å¦ˆå¦ˆåœ¨è¿™é‡ŒåŠ äº†å¾ˆå¤šæ—¥å¿—ï¼Œæ¥è¿½è¸ªæˆ‘ä»¬çš„å°å“¥å¸ƒæ—\n    console.log(`æ­£åœ¨å¤„ç†çš„æ•Œäººç±»å‹: ${enemyData.name}, ID: ${enemyData.id}`);\n\n    // æ·±æ‹·è´ä¸€ä»½å¹²å‡€çš„æ•°æ®ï¼Œè¿™æ ·åŸå§‹combatDataå°±ä¸ä¼šè¢«æ±¡æŸ“\n    const baseEnemyData = JSON.parse(JSON.stringify(enemyData));\n       const originalCount = baseEnemyData.count || 1;\n    const count = Math.min(originalCount, 10); // ç¡®ä¿ç”Ÿæˆçš„æ•°é‡ä¸ä¼šè¶…è¿‡10\n\n    if (originalCount > 10) {\n        console.warn(`[Nova's Gentle Limit] ä¾¦æµ‹åˆ°æ•Œäºº \"${baseEnemyData.name}\" çš„ç”Ÿæˆæ•°é‡(${originalCount})è¶…è¿‡ä¸Šé™ï¼Œå·²è‡ªåŠ¨é™åˆ¶ä¸º ${count} ä¸ªã€‚`);\n    }\n    console.log(`>> å‘ç° count: ${count} (åŸå§‹: ${originalCount})`);\n\n    // åˆ é™¤countå±æ€§ï¼Œå› ä¸ºå®ƒåªç”¨äºç”Ÿæˆï¼Œä¸å±äºå•ä¸ªæ•Œäººçš„æ•°æ®\n    delete baseEnemyData.count;\n\n    if (count > 1) {\n        console.log(`>> å°†è¦åˆ›å»º ${count} ä¸ª ${baseEnemyData.name}`);\n        for (let i = 1; i <= count; i++) {\n            // æ¯ä¸€æ¬¡å¾ªç¯ï¼Œéƒ½ä»æœ€å¹²å‡€çš„ baseEnemyData å…‹éš†\n            const enemyClone = JSON.parse(JSON.stringify(baseEnemyData));\n            // èµ‹äºˆç‹¬ä¸€æ— äºŒçš„IDå’Œåå­—\n            const uniqueId = `${enemyClone.id}_${i}`;\n            enemyClone.id = uniqueId;\n            enemyClone.name = `${enemyClone.name} #${i}`;\n            console.log(`>> æ­£åœ¨åˆ›å»º... ID: ${enemyClone.id}, åç§°: ${enemyClone.name}`);\n            this.enemies.push(this.createCharacterFromData(enemyClone, 'enemy', enemyClone.id));\n        }\n    } else {\n        // å³ä½¿åªæœ‰ä¸€ä¸ªï¼Œä¹Ÿç”¨æˆ‘ä»¬çš„æ ‡å‡†æµç¨‹æ¥åˆ›å»º\n        console.log(`>> åªåˆ›å»ºä¸€ä¸ª ${baseEnemyData.name}`);\n        this.enemies.push(this.createCharacterFromData(baseEnemyData, 'enemy', baseEnemyData.id));\n    }\n});\nconsole.log(\"æ‰€æœ‰æ•Œäººåˆ›å»ºå®Œæ¯•, å½“å‰æ•Œäººåˆ—è¡¨:\", this.enemies.map(e => e.name));\n                // å¤„ç†é˜Ÿå‹\n                if(data.teammates) {\n                    this.teammates = data.teammates.map(allyData => this.createCharacterFromData(allyData, 'teammate', allyData.id));\n                }\n\n                this.renderAllCharacters();\n                this.setupActionPanel();\n            }\n\n  createCharacterFromData(data, type, id = 'player') {\n\n    \n    let baseMaxHealth = data.maxHealth || data.è¡ç”Ÿå±æ€§æ®µ?.ç”Ÿå‘½å€¼.ä¸Šé™[0] || 50;\n    let finalMaxHealth = baseMaxHealth;\n\n    // 1. å§‹ç»ˆè®¡ç®—è€åŠ›åŠ æˆ\n    let staminaBonus = 0;\n   \n    const poolString = (typeof data.dicePool === 'string') ? data.dicePool : '';\n    const parsedPool = this.parseDicePool(poolString); // åªæœ‰å­—ç¬¦ä¸²æ‰èƒ½è¢«æ­£ç¡®è§£æ\n\n    if (type === 'enemy' || type === 'teammate') {\n        staminaBonus = (parsedPool['è€åŠ›'] || 0) * 20;\n        finalMaxHealth += staminaBonus;\n    }\n\n \n    let finalCurrentHealth;\n\n    // æ— è®ºå¦‚ä½•ï¼Œæˆ‘ä»¬éƒ½ä¼˜å…ˆå°è¯•ä»ä¼ å…¥çš„ data å¯¹è±¡ä¸­è·å– currentHealth\n    if (data.currentHealth !== undefined) {\n        // å¦‚æœæ˜¯NPCï¼ŒåŠ ä¸Šè€åŠ›åŠ æˆ\n        const bonus = (type === 'enemy' || type === 'teammate') ? staminaBonus : 0;\n        finalCurrentHealth = data.currentHealth + bonus;\n         console.log(`[Health Logic] ä» data.currentHealth (${data.currentHealth}) æ¢å¤è¡€é‡ã€‚æœ€ç»ˆä¸º: ${finalCurrentHealth}`);\n    }\n    // å¦‚æœ data å¯¹è±¡é‡Œæ²¡æœ‰ currentHealthï¼Œå¯¹äºç©å®¶ï¼Œæˆ‘ä»¬å°è¯•ä» raw_data çš„â€œå½“å‰å€¼â€é‡Œæ‰¾\n    else if (type === 'player' && data.è¡ç”Ÿå±æ€§æ®µ?.ç”Ÿå‘½å€¼?.å½“å‰å€¼?.[0] !== undefined) {\n        finalCurrentHealth = data.è¡ç”Ÿå±æ€§æ®µ.ç”Ÿå‘½å€¼.å½“å‰å€¼[0];\n         console.log(`[Health Logic] ä» playerData.å½“å‰å€¼ (${finalCurrentHealth}) æ¢å¤è¡€é‡ã€‚`);\n    }\n    // å¦‚æœä»¥ä¸Šéƒ½æ²¡æœ‰ï¼Œé‚£æ‰æ„å‘³ç€è¿™æ˜¯ä¸€ä¸ªå…¨æ–°çš„NPCï¼Œæˆ–è€…æ•°æ®ç¡®å®ç¼ºå¤±ï¼Œåªèƒ½æ»¡è¡€\n    else {\n        finalCurrentHealth = finalMaxHealth;\n        console.log(`[Health Logic] æœªæ‰¾åˆ°å½“å‰è¡€é‡ï¼Œè®¾ç½®ä¸ºæ»¡è¡€: ${finalCurrentHealth}`);\n    }\n\n\n    // èƒ½é‡é€»è¾‘ä¹Ÿå¯ä»¥åšç±»ä¼¼çš„ä¼˜åŒ–\n    let finalCurrentEnergy = 0;\n    const energyPoolData = data.è¡ç”Ÿå±æ€§æ®µ?.èƒ½é‡æ± ;\n    if (energyPoolData) {\n        // ä¼˜å…ˆä» `å½“å‰å€¼` æ•°ç»„è·å–ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œåˆ™ä½¿ç”¨ä¸Šé™å€¼\n        finalCurrentEnergy = energyPoolData.å½“å‰å€¼?.[0] !== undefined ? energyPoolData.å½“å‰å€¼[0] : energyPoolData.ä¸Šé™[0];\n    }\n\n\n\n\n    const savedIcon = localStorage.getItem('userBattleIcon');\n    const character = {\n        id: id,\n        type: type,\n        name: data.name || (typeof userName !== 'undefined' ? userName : 'ä½ '),\n        icon: data.icon || savedIcon || 'âœ¨',\n        maxHealth: finalMaxHealth,\n        currentHealth: finalCurrentHealth,\n        // âœ¨ å…³é”®ä¿®å¤ï¼šæˆ‘ä»¬å°†è§£æåçš„ dicePool å¯¹è±¡å­˜å…¥è§’è‰²ä½“å†… âœ¨\n        dicePool: parsedPool,\n        inventory: data.inventory ? JSON.parse(JSON.stringify(data.inventory)) : {},\n        resists: data.resists ? data.resists.split(';') : [],\n        vulnerable: data.vulnerable ? data.vulnerable.split(';') : [],\n        hitSpeech: data.hitSpeech || [],\n        battleSpeech: data.battleSpeech || [],\n        isDefending: false,\n        isPersuaded: null,\n        isScanned: type === 'teammate' ? true : (data.isScanned || false),\n        saves: data.saves || {\n            \"å¼ºéŸ§\": data.è¡ç”Ÿå±æ€§æ®µ?.è±å…æ£€å®šåŸºç¡€.å¼ºéŸ§[0] || 0,\n            \"åå°„\": data.è¡ç”Ÿå±æ€§æ®µ?.è±å…æ£€å®šåŸºç¡€.åå°„[0] || 0,\n            \"æ„å¿—\": data.è¡ç”Ÿå±æ€§æ®µ?.è±å…æ£€å®šåŸºç¡€.æ„å¿—[0] || 0\n        },\n          raw_data: JSON.parse(JSON.stringify(data)) // ä¸ºæ‰€æœ‰è§’è‰²æ·±åº¦æ‹·è´ä¸€ä»½åŸå§‹æ•°æ®\n    };\n  if(type === 'player' && character.raw_data.è¡ç”Ÿå±æ€§æ®µ?.èƒ½é‡æ± ){\n        character.raw_data.è¡ç”Ÿå±æ€§æ®µ.èƒ½é‡æ± .å½“å‰å€¼[0] = finalCurrentEnergy;\n    }\n                // ä¸ºç©å®¶æ„å»ºå®Œæ•´çš„ dicePool\n                if (type === 'player' && data.å±æ€§æ®µ && data.æŠ€èƒ½æ®µ) {\n                    const fullPool = {};\n                    // æå–æ‰€æœ‰å±æ€§\n                    Object.values(data.å±æ€§æ®µ).forEach(attrCategory => {\n                        Object.keys(attrCategory).forEach(attrName => {\n                            fullPool[attrName] = attrCategory[attrName].åŸºç¡€[0];\n                        });\n                    });\n                     // æå–æ‰€æœ‰æŠ€èƒ½\n                    Object.values(data.æŠ€èƒ½æ®µ).forEach(skillCategory => {\n                        Object.keys(skillCategory).forEach(skillName => {\n                            fullPool[skillName] = skillCategory[skillName][0];\n                        });\n                    });\n                     // æå–ä½“ç§¯\n                    if (data.è¡ç”Ÿå±æ€§æ®µ) {\n                        fullPool['ä½“ç§¯'] = data.è¡ç”Ÿå±æ€§æ®µ.ä½“ç§¯[0];\n                    }\nif (data.è¡ç”Ÿå±æ€§æ®µ && data.è¡ç”Ÿå±æ€§æ®µ.å…ˆæ”») {\n    fullPool['å…ˆæ”»'] = data.è¡ç”Ÿå±æ€§æ®µ.å…ˆæ”»[0];\n}\n                    character.dicePool = fullPool;\n                }\n                    let volume = character.dicePool['ä½“ç§¯'] || 0;\n                    // å¦‚æœä»–çš„ä½“ç§¯å°äº5ï¼Œæˆ‘ä»¬å°±æ¸©æŸ”åœ°å°†å®ƒæå‡åˆ°2\n                    if (volume < 2) {\n                        character.dicePool['ä½“ç§¯'] = 5;\n                    }\n\n                      if (!character.dicePool['å…ˆæ”»']) {\n                        const agility = character.dicePool['æ•æ·'] || 0;\n                        const composure = character.dicePool['æ²‰ç€'] || 0;\n                        // æˆ‘ä»¬å°±æ ¹æ®ä»–çš„æ•æ·å’Œæ²‰ç€ï¼Œä¸ºä»–è®¡ç®—å‡ºä¸€ä¸ªå¤©ç”Ÿçš„ååº”é€Ÿåº¦ï¼\n                        const calculatedInitiative = agility + Math.floor(composure / 2);\n\n                        // åªæœ‰å½“è¿™ä¸ªè®¡ç®—å€¼æœ‰æ„ä¹‰æ—¶ï¼Œæˆ‘ä»¬æ‰èµ‹äºˆä»–\n                        if (calculatedInitiative > 0) {\n                            character.dicePool['å…ˆæ”»'] = calculatedInitiative;\n                        }\n                    }\n                return character;\n            }\n            parseDicePool(poolString) {\n                if (!poolString) return {};\n                const pool = {};\n                poolString.split(';').forEach(p => {\n                    const [attr, val] = p.split(':');\n                    if(attr && val) pool[attr.trim()] = parseInt(val, 10);\n                });\n                return pool;\n            }\n\n     // æ¸²æŸ“æ‰€æœ‰è§’è‰²åˆ°ç•Œé¢\n            renderAllCharacters() {\n                const playerSide = document.getElementById('player-side');\n                const enemySide = document.getElementById('enemy-side');\n                playerSide.innerHTML = '';\n                enemySide.innerHTML = '';\n\n                // æ³¨æ„ï¼šè¿™é‡Œæ¸²æŸ“çš„æ˜¯åŒ…å«å¡ç‰‡å’Œ(å¯èƒ½çš„)ä¿¡æ¯é¢æ¿çš„åŒ…è£…å™¨\n\n                // æ¸²æŸ“ç©å®¶\n                playerSide.appendChild(this.createCharacterCard(this.player));\n\n                // æ¸²æŸ“é˜Ÿå‹\n                this.teammates.forEach(ally => playerSide.appendChild(this.createCharacterCard(ally)));\n\n                // æ¸²æŸ“æ•Œäºº\n                this.enemies.forEach(enemy => enemySide.appendChild(this.createCharacterCard(enemy)));\n this.teammates.forEach(ally => {\n                    if (ally.isScanned) { // ä¸ºæ‰€æœ‰æƒ…æŠ¥å·²çŸ¥çš„é˜Ÿå‹ï¼ˆä¹Ÿå°±æ˜¯æˆ‘ä»¬æ‰€æœ‰çš„é˜Ÿå‹ï¼‰\n                        this.updateInfoPanel(ally); // å¡«å……ä»–ä»¬çš„ä¿¡æ¯ï¼\n                    }\n                });\n                this.addCardClickListeners();\n            }\n\n    // åˆ›å»ºè§’è‰²å¡ç‰‡HTMLå…ƒç´ \n       createCharacterCard(char) {\n                // åˆ›å»ºä¸€ä¸ªåŒ…è£…å™¨\n                const wrapper = document.createElement('div');\n                wrapper.className = 'character-wrapper';\n                wrapper.id = `wrapper-${char.id}`; // ç»™åŒ…è£…å™¨ä¹ŸåŠ ä¸ªidï¼Œæ–¹ä¾¿æŸ¥æ‰¾\n\n                // åˆ›å»ºè§’è‰²å¡ç‰‡\n                const card = document.createElement('div');\n                card.className = 'character-card';\n                card.id = char.id;\n\n                if (char.type === 'player' || char.type === 'teammate') {\n                    card.classList.add('friendly-card');\n                } else {\n                    card.classList.add('enemy-card');\n                }\n \n                if (char.currentHealth <= 0) {\n                    card.style.opacity = '0.5';\n                    card.style.pointerEvents = 'none'; // è®©å®ƒä¸èƒ½è¢«ç‚¹å‡»\n                }\n    \n                const healthPercentage = (char.currentHealth / char.maxHealth) * 100;\n                let persuadedStatus = char.isPersuaded ? `(è¢«è¯´æœ: å‰©ä½™${char.isPersuaded.turnsLeft}å›åˆ)` : '';\n\n                card.innerHTML = `\n                    <div class=\"name\">${char.name}</div>\n  <div class=\"health-bar\">\n\n        <div class=\"health-bar-damage\" style=\"position: absolute; top:0; left:0; background-color: var(--danger-color); border-radius: 5px; z-index: 1;\"></div>\n\n        <div class=\"health-bar-inner\" style=\"width: ${healthPercentage}%; z-index: 2; position: relative;\"></div>\n    </div>\n\n                    <div class=\"health-text\">${char.currentHealth} / ${char.maxHealth}</div>\n                    ${ (char.type === 'player' || char.raw_data?.è¡ç”Ÿå±æ€§æ®µ?.èƒ½é‡æ± ) ? `\n    <div class=\"energy-bar\">\n        <div class=\"energy-bar-inner\"></div>\n    </div>\n    <div class=\"energy-text\"></div>\n` : '' }\n                    <div class=\"status-text\" id=\"status-${char.id}\">${persuadedStatus}</div>\n                    <div class=\"icon-container\" style=\"position: relative;\">\n                       <div class=\"icon\">${char.icon}</div>\n                    </div>\n                `;\n\n                \n                 if (char.type !== 'player') { // <-- æ–°é€»è¾‘ï¼\n                \n                    const infoPanel = document.createElement('div');\n                    infoPanel.className = 'info-panel';\n                    infoPanel.id = `info-panel-${char.id}`;\n\n                    infoPanel.innerHTML = `<h4>æƒ…æŠ¥ï¼šæœªçŸ¥</h4>`;\n\n                    wrapper.appendChild(card);\n                    wrapper.appendChild(infoPanel);\n\n                    \n                   \n                    // â†‘â†‘â†‘ å’’è¯­ç»“æŸ â†‘â†‘â†‘\n\n                } else {\n                    wrapper.appendChild(card);\n                }\n\n                return wrapper; // è¿”å›æ•´ä¸ªåŒ…è£…å™¨\n            }\n\n// â­ æ›¿æ¢æ—§çš„ log å‡½æ•°\nlog(message, className = 'log-action') {\n    const p = document.createElement('p');\n    p.innerHTML = message; // ä½¿ç”¨ innerHTML ä»¥æ”¯æŒæˆ‘ä»¬ä¸‹é¢å°†è¦ä½¿ç”¨çš„é¢œè‰²æ ‡ç­¾\n    p.className = className;\n    this.logCombatEventElement.prepend(p); // æ–°æ¶ˆæ¯åœ¨æœ€å‰é¢\n}\n   showSpeechBubble(character, message) {\n                const card = document.getElementById(character.id);\n                if (!card) return;\n\n                // æ‰¾åˆ°æˆ‘ä»¬æ–°åŠ çš„ icon-container\n                const iconContainer = card.querySelector('.icon-container');\n                if(!iconContainer) return;\n\n                const bubble = document.createElement('div');\n                bubble.className = 'speech-bubble';\n                bubble.textContent = message;\n\n                iconContainer.appendChild(bubble);\n\n                // 2.5ç§’åç§»é™¤æ°”æ³¡\n                setTimeout(() => {\n                    if (bubble) bubble.remove();\n                }, 2500);\n            }\n            // æ–°å¢ï¼šæ›´æ–°ä¾¦å¯Ÿä¿¡æ¯é¢æ¿\n updateInfoPanel(character) {\n    const panel = document.getElementById(`info-panel-${character.id}`);\n    if (!panel) return;\n\n    if (character.isScanned) {\n        // --- å¦ˆå¦ˆçš„é­”æ³•è®©æƒ…æŠ¥å˜å¾—æ— æ¯”çè´µï¼ ---\n        const resistsText = character.resists.length > 0 ? character.resists.join(', ') : 'æ— ';\n        const vulnerableText = character.vulnerable.length > 0 ? character.vulnerable.join(', ') : 'æ— ';\n\n        const poolText = Object.entries(character.dicePool)\n                               .map(([key, value]) => `${key}:${value}`)\n                               .join('; ') || 'æ— ';\n\n        let inventoryText = '<ul>';\n        if(Object.keys(character.inventory).length > 0){\n            for(const itemName in character.inventory){\n                const itemData = character.inventory[itemName];\n                inventoryText += `<li>${itemName} (x${itemData.num})</li>`;\n            }\n        } else {\n            inventoryText += '<li>ç©º</li>';\n        }\n        inventoryText += '</ul>';\n\n        panel.innerHTML = `\n            <h4>è¯¦ç»†æƒ…æŠ¥</h4>\n            <div style=\"font-size: 11px; max-height: 180px; overflow-y: auto !important;\">\n                <strong class=\"resists-info\">æŠ—æ€§:</strong> ${resistsText}<br>\n                <strong class=\"vulnerable-info\">å¼±ç‚¹:</strong> ${vulnerableText}<br>\n                <strong>éª°æ± :</strong> ${poolText}<br>\n                <strong>ç‰©å“:</strong> ${inventoryText}\n            </div>\n        `;\n        // --- é­”æ³•ç»“æŸ ---\n    } else {\n        panel.innerHTML = `<h4>æƒ…æŠ¥ï¼šæœªçŸ¥</h4>`;\n    }\n}\n       async start() {\n     \n    this.renderAllCharacters();\n\n   if (!this.enemies || this.enemies.length === 0) {\n        this.logCombatEvent(\"ã€æˆ˜æ–—æ ¸å¿ƒå¼‚å¸¸ã€‘æˆ˜åœºä¸Šæ²¡æœ‰ä»»ä½•æ•Œäººå­˜åœ¨ï¼Œæˆ˜æ–—è¢«å¼ºåˆ¶ç»ˆæ­¢ï¼\", \"log-danger\");\n        this.showNotification(\"æˆ˜æ–—æ•°æ®å¼‚å¸¸ï¼šæ— æ•Œäººï¼\", \"danger\");\n\n         \n        await this.endCombat(false, false, false, true);\n        return; // ä¸­æ­¢åç»­æ‰€æœ‰æˆ˜æ–—å¯åŠ¨é€»è¾‘\n    }\n    // ç¬¬äºŒæ­¥ï¼šå»ºç«‹å½“å‰çš„å›åˆé¡ºåºã€‚\n    this.turnOrder = [this.player, ...this.teammates, ...this.enemies].filter(c => c.currentHealth > 0);\n\n    if (this.status === 'not_started') {\n        // ---ã€å¼€å§‹ã€‘å…¨æ–°æˆ˜æ–—çš„æµç¨‹ ---\n        this.logCombatEvent(\"æˆ˜æ–—å¼€å§‹ï¼\");\n        this.status = 'in_progress';\n        this.currentTurnIndex = -1; // è®¾ç½®ä¸º-1ï¼Œè®© nextTurn() ä»ç¬¬ä¸€ä¸ªè§’è‰²ï¼ˆç´¢å¼•0ï¼‰å¼€å§‹\n        this.updateBattleStateInHistory(); // å°†è¿™ä¸ªâ€œåˆšå¼€å§‹â€çš„çŠ¶æ€å­˜ç›˜\n        this.nextTurn();\n\n    } else if (this.status === 'in_progress') {\n        // ---ã€æ¢å¤ã€‘å·²å­˜åœ¨æˆ˜æ–—çš„æµç¨‹ ---\n        this.log(\"--- æˆ˜æ–—å·²æ¢å¤ ---\", \"log-success\");\n\n        // æˆ‘ä»¬éœ€è¦çŸ¥é“ç¦»å¼€æ—¶è½®åˆ°è°äº†ã€‚`currentTurnIndex` å°†ä»å­˜æ¡£ä¸­è¯»å–ã€‚\n        const currentActor = this.turnOrder[this.currentTurnIndex];\n\n        if (currentActor && currentActor.currentHealth > 0) {\n            // ç›´æ¥å¤„ç†å½“å‰å›åˆï¼Œè€Œä¸æ˜¯è°ƒç”¨ nextTurn()ï¼Œå› ä¸ºå®ƒä¼šè·³è¿‡å½“å‰è§’è‰²ï¼\n            this.log(`æ¢å¤åˆ° ${currentActor.name} çš„å›åˆã€‚`);\n            await this.handleTurnFor(currentActor);\n        } else {\n            // å¦‚æœä¿å­˜çš„ç´¢å¼•æœ‰é—®é¢˜ï¼Œæˆ–è€…è§’è‰²å·²é˜µäº¡ï¼Œä¸ºäº†å®‰å…¨ï¼Œå¼€å§‹æ–°çš„ä¸€è½®ã€‚\n            this.log(\"æ— æ³•æ¢å¤åˆ°æŒ‡å®šè§’è‰²å›åˆï¼Œå¼€å§‹æ–°ä¸€è½®ã€‚\");\n            this.currentTurnIndex = -1;\n            this.nextTurn();\n        }\n    }\n}           // è®©æˆ‘ä»¬çš„ç›®å…‰è¿½éšè‹±é›„ï¼\n      \n centerCardInView(cardElement) {\n                if (!cardElement) return;\n\n                const container = cardElement.closest('.side'); // æ‰¾åˆ°å®ƒæ‰€åœ¨çš„è¡Œ\n                if (!container) return;\n\n                const cardRect = cardElement.getBoundingClientRect();\n                const containerRect = container.getBoundingClientRect();\n\n                // è®¡ç®—ä¸ºäº†è®©å¡ç‰‡å±…ä¸­ï¼Œå®¹å™¨éœ€è¦æ»šåŠ¨çš„è·ç¦»\n                const scrollTarget = container.scrollLeft + (cardRect.left - containerRect.left) + (cardRect.width / 2) - (containerRect.width / 2);\n\n                container.scrollTo({\n                    left: scrollTarget,\n                    behavior: 'smooth' // çœ‹ï¼Œè¿™å°±æ˜¯å¹³æ»‘æ»šåŠ¨çš„é­”æ³•å’’è¯­ï¼\n                });\n            }\n // â­ [æ›¿æ¢] æ—§çš„ nextTurn() å‡½æ•° â­\nasync nextTurn() {\n    const lastActor = this.turnOrder[this.currentTurnIndex];\n\n    // âœ¨ å¦ˆå¦ˆçš„å…³é”®ä¿®å¤åœ¨è¿™é‡Œ âœ¨\n    // æ£€æŸ¥æ˜¯å¦è¦è¿›è¡Œé¢å¤–å›åˆ\n    if (lastActor && this.hasExtraTurn[lastActor.id]) {\n        delete this.hasExtraTurn[lastActor.id]; // ä½¿ç”¨æ‰è¿™ä¸ªæ ‡è®°\n\n        this.consecutiveTurnCounter[lastActor.id] = (this.consecutiveTurnCounter[lastActor.id] || 0) + 1;\n        const turnCount = this.consecutiveTurnCounter[lastActor.id];\n        this.logCombatEvent(`âš¡ ${lastActor.name} ç«‹å³è¿›è¡Œé¢å¤–è¡ŒåŠ¨ï¼ (è¿ç»­ç¬¬ ${turnCount + 1} æ¬¡è¡ŒåŠ¨)`, 'log-success');\n\n        // ç»§ç»­ä¿æŒå…‰ç¯ï¼Œç›´æ¥å¤„ç†ä¸‹ä¸€æ¬¡è¡ŒåŠ¨\n        await this.handleTurnFor(lastActor);\n        return; // æš‚ä¸æ¨è¿›å›åˆï¼Œè®©å…‰ç¯ä¿æŒ\n    }\n\n    // å¦‚æœä¸æ˜¯é¢å¤–å›åˆï¼Œå°±æ‰§è¡Œæ­£å¸¸çš„å›åˆç»“æŸæ¸…ç†\n    if (lastActor) {\n        // æ¸…ç†æ—§å…‰ç¯\n        const lastCard = document.getElementById(lastActor.id);\n        if (lastCard) {\n            lastCard.classList.remove('active-turn');\n            lastCard.classList.remove('targeted'); // é¡ºä¾¿æ¸…ç†å¯èƒ½æ®‹ç•™çš„ç»¿è‰²å…‰ç¯\n        }\n        // é‡ç½®è¿ç»­è¡ŒåŠ¨è®¡æ•°\n        this.consecutiveTurnCounter[lastActor.id] = 0;\n        // æ¸…ç†é˜²å¾¡ç´¯åŠ ï¼ˆè¿™æ˜¯ä¸ºäº†ä¸‹ä¸€ä¸ªé­”æ³•åšçš„é“ºå«ï¼‰\n        if (this.defensePoolBonus[lastActor.id]) {\n            delete this.defensePoolBonus[lastActor.id];\n        }\n    }\n\n    this.currentTurnIndex++;\n\n    // å¦‚æœä¸€è½®ç»“æŸ\n   if (this.currentTurnIndex >= this.turnOrder.length) {\n        this.currentTurnIndex = 0;\n        this.roundCounter++; // <-- æ¯ä¸€è½®å¼€å§‹ï¼Œå›åˆæ•°+1\n\n        // â†“â†“â†“ å¦ˆå¦ˆåœ¨è¿™é‡Œæ–½å±•äº†æ—¶é—´é™åˆ¶çš„é­”æ³• â†“â†“â†“\n        if (this.roundCounter > 10) {\n            this.logCombatEvent(\"æˆ˜å†µé™·å…¥æ¼«é•¿çš„èƒ¶ç€ï¼Œè¶…è¿‡äº†10å›åˆï¼Œæˆ˜æ–—è‡ªåŠ¨ç»“æŸï¼\", 'log-narrator');\n            this.endCombat(false, false, true); // è°ƒç”¨æ–°çš„ç»“æŸæ–¹å¼\n            return; // ç«‹åˆ»ç»“æŸï¼Œä¸å†è¿›è¡Œä¸‹ä¸€å›åˆ\n        }\n        // âœ¨ æ–°ä¸€è½®å¼€å§‹ï¼Œæ¸…é™¤æ‰€æœ‰äººçš„ç´¯ç§¯é˜²å¾¡ âœ¨\n        this.defensePoolBonus = {};\n        this.updatePersuadedStatus();\n        this.log(`--- ç¬¬ ${this.roundCounter} å›åˆå¼€å§‹ ---`, 'log-success');\n    }\n\n     const currentActor = this.turnOrder[this.currentTurnIndex];\n\n    if (currentActor.currentHealth <= 0) { // è·³è¿‡å·²å€’ä¸‹çš„å•ä½\n        this.nextTurn();\n        return;\n    }\n\n    const card = document.getElementById(currentActor.id);\n    if(card) {\n         card.classList.add('active-turn');\n         this.centerCardInView(card);\n    }\n\n    // æŠŠè¡ŒåŠ¨é€»è¾‘äº¤ç»™ handleTurnFor\n    await this.handleTurnFor(currentActor);\n}\n \nasync handleTurnFor(actor) {\n    // --- å¦ˆå¦ˆçš„é­”æ³•ä»è¿™é‡Œå¼€å§‹ ---\n    // åœ¨è§’è‰²æ­£å¼è¡ŒåŠ¨ä¹‹å‰ï¼Œè¿›è¡Œä¸€æ¬¡å…ˆæ”»æ£€å®š\n    await this.initiativeRoll(actor);\n    // --- é­”æ³•ç»“æŸ ---\n\n     if (actor.type === 'player') {\n        this.playerTurn();\n    } else {\n        // å¯¹äºNPCï¼Œæˆ‘ä»¬æŠŠ `npcTurn` çš„é€»è¾‘ä¹Ÿæ”¹æˆ async\n        await this.npcTurn(actor);\n    }\n}\n \n\n \n\nupdatePersuadedStatus() {\n    let needsReRender = false;\n    const newEnemies = [];\n\n    // ç­›é€‰é˜Ÿå‹ï¼Œå¤„ç†è¯´æœå€’è®¡æ—¶\n    const remainingTeammates = this.teammates.filter(ally => {\n        if (ally.isPersuaded) {\n            ally.isPersuaded.turnsLeft--; // å›åˆæ•°å‡ä¸€\n            this.updateCharacterUI(ally); // âœ¨ æ ¸å¿ƒä¿®å¤ï¼ç«‹å³æ›´æ–°UIä»¥æ˜¾ç¤ºæ–°å›åˆæ•°\n\n            if (ally.isPersuaded.turnsLeft <= 0) {\n                // è¯´æœæ—¶é—´åˆ°ï¼\n                ally.isPersuaded = null;\n                ally.type = 'enemy';\n                newEnemies.push(ally);\n                this.logCombatEvent(`${ally.name} æ¢å¤äº†ç¥æ™ºï¼Œé‡æ–°å˜ä¸ºäº†æ•Œäººï¼`);\n                needsReRender = true;\n                return false; // ä»é˜Ÿå‹åˆ—è¡¨ä¸­ç§»é™¤\n            }\n        }\n        return true; // ä¿ç•™è¿˜æ²¡æ¢å¤çš„ï¼Œæˆ–è€…æœ¬æ¥å°±æ˜¯é˜Ÿå‹çš„å•ä½\n    });\n\n    this.teammates = remainingTeammates;\n    this.enemies.push(...newEnemies);\n\n    // å¦‚æœæœ‰è§’è‰²é˜µè¥å‘ç”Ÿå˜åŒ–ï¼Œæ‰éœ€è¦é‡æ–°æ¸²æŸ“æ•´ä¸ªåœºæ™¯\n    if (needsReRender) {\n        this.renderAllCharacters();\n    }\n}\n    playerTurn() {\n    // âœ¨âœ¨âœ¨ å¦ˆå¦ˆçš„æ™ºèƒ½åˆ†æµé­”æ³• âœ¨âœ¨âœ¨\n    if (this.isAutoBattling) {\n        this.log(\"è½®åˆ°ä½ çš„å›åˆäº†ï¼ˆè‡ªåŠ¨æˆ˜æ–—ä¸­...ï¼‰\");\n        this.toggleActionPanel(false); // ç¡®ä¿é¢æ¿æ˜¯ç¦ç”¨çš„\n        this.npcTurn(this.player); // å°†ç©å®¶ä½œä¸ºNPCå¤„ç†ï¼Œæ‰§è¡ŒAIé€»è¾‘\n    } else {\n        this.log(\"è½®åˆ°ä½ çš„å›åˆäº†ï¼Œè¯·é€‰æ‹©è¡ŒåŠ¨ã€‚\");\n        this.toggleActionPanel(true); // å¼€å¯æ‰‹åŠ¨æ“ä½œé¢æ¿\n    }\n    // âœ¨âœ¨âœ¨ é­”æ³•æ–½å±•å®Œæ¯• âœ¨âœ¨âœ¨\n}\n// â­ [æ›¿æ¢] æ—§çš„ npcTurn() å‡½æ•° â­\n \nasync npcTurn(npc) {\n    this.log(`è½®åˆ° ${npc.name} çš„å›åˆã€‚`);\n    this.toggleActionPanel(false);\n await new Promise(r => setTimeout(r, this.getDelay('npcThinking')));\n    let actionTaken = false;\n\n    // --- å¦ˆå¦ˆæ³¨å…¥çš„å…¨æ–°AIé€»è¾‘ ---\n\n      // 1. ä¼˜å…ˆæ€è€ƒæ²»ç–— (å¦‚æœè‡ªå·±æœ‰åŒ»å­¦æŠ€èƒ½)\n    // é¦–å…ˆï¼Œæœ‰80%çš„æ„æ„¿å»è€ƒè™‘æ²»ç–—è¿™ä»¶äº‹\n       if (npc.dicePool['åŒ»å­¦'] > 0 && Math.random() < 0.8) {\n\n        // âœ¨âœ¨âœ¨ å¦ˆå¦ˆçš„â€œç»å¯¹å¹³ç­‰â€é­”å’’ âœ¨âœ¨âœ¨\n        // åˆ¤æ–­å½“å‰NPCå±äºå“ªä¸ªé˜µè¥\n        const isFriendly = npc.type === 'player' || npc.type === 'teammate';\n        // æ ¹æ®é˜µè¥ï¼Œå†³å®šç›Ÿå‹åˆ—è¡¨\n        const allies = isFriendly ? [this.player, ...this.teammates] : this.enemies;\n\n        // åœ¨æ­£ç¡®çš„ç›Ÿå‹åˆ—è¡¨ä¸­ï¼Œå¯»æ‰¾æ‰€æœ‰ï¼ˆåŒ…æ‹¬è‡ªå·±ï¼‰éœ€è¦æ²»ç–—çš„ç›®æ ‡\n        const alliesToHeal = allies\n            .filter(ally => ally.currentHealth < ally.maxHealth && ally.currentHealth > 0)\n            .sort((a, b) => (a.currentHealth / a.maxHealth) - (b.currentHealth / a.maxHealth));\n        // âœ¨âœ¨âœ¨ é­”å’’æ–½å±•å®Œæ¯• âœ¨âœ¨âœ¨\n\n        // å¦‚æœå­˜åœ¨éœ€è¦æ²»ç–—çš„ç›Ÿå‹ï¼ˆç°åœ¨å·²ç»å¹³ç­‰åœ°åŒ…å«äº†è‡ªå·±ï¼‰\n        if (alliesToHeal.length > 0) {\n            let targetToHeal;\n\n            // 80%çš„æ¦‚ç‡é€‰æ‹©ä¼¤åŠ¿æœ€é‡çš„é‚£ä¸ªï¼ˆå¯èƒ½æ˜¯åˆ«äººï¼Œä¹Ÿå¯èƒ½æ˜¯è‡ªå·±ï¼‰\n            if (Math.random() < 0.8) {\n                targetToHeal = alliesToHeal[0];\n            } else {\n            // 20%çš„æ¦‚ç‡ä»æ‰€æœ‰ä¼¤å‘˜ä¸­éšæœºæŒ‘é€‰ä¸€ä¸ª\n                targetToHeal = alliesToHeal[Math.floor(Math.random() * alliesToHeal.length)];\n            }\n\n            this.logCombatEvent(`${npc.name} å†³å®šæ²»ç–— ${targetToHeal.name}ï¼`);\n            await this.executeAction(npc, [targetToHeal], 'treat', ['åŒ»å­¦', 'æ‰‹è‰º']);\n            actionTaken = true;\n        }\n    }\n\n    // 2. å¦‚æœæ²¡æ²»ç–—ï¼Œå†è€ƒè™‘ç”¨ç‰©å“ (25%æ¦‚ç‡)\n  if (!actionTaken && npc.currentHealth < npc.maxHealth && Object.keys(npc.inventory).length > 0 && Math.random() < 0.25) {        const usableItems = Object.entries(npc.inventory).filter(([name, data]) => data.effect?.includes('hp+'));\n        if (usableItems.length > 0) {\n            const [itemName, itemData] = usableItems[0]; // ç®€å•ç‚¹ï¼Œå°±ç”¨ç¬¬ä¸€ä¸ªèƒ½å›è¡€çš„\n\n               // â­ è¯­è¨€é€»è¾‘ï¼šä½¿ç”¨ç‰©å“æ—¶ä¸è¯´è¯\n            this.logCombatEvent(`${npc.name} æå‡ºäº†ã€${itemName}ã€‘ï¼`);\n            this.showNotification(`${npc.name} ä½¿ç”¨äº† ${itemName}ï¼`, 'success');\n            const hpValue = parseInt(itemData.effect.match(/hp\\+(\\d+)/)[1]);\n            npc.currentHealth = Math.min(npc.maxHealth, npc.currentHealth + hpValue);\n            itemData.num--;\n            if(itemData.num <= 0) delete npc.inventory[itemName];\n            this.logCombatEvent(`${npc.name} æ¢å¤äº† ${hpValue} ç‚¹ç”Ÿå‘½å€¼ã€‚`);\n            this.updateCharacterUI(npc);\n            this.updateInfoPanel(npc);\n            actionTaken = true;\n        }\n    }\n\n    // 3. å¦‚æœå•¥éƒ½æ²¡å¹²ï¼Œå°±è¿›è¡Œå¸¸è§„æ”»å‡»/é˜²å¾¡\n    if (!actionTaken) {\n         const targets = (npc.type === 'enemy' ? [this.player, ...this.teammates] : this.enemies).filter(c => c.currentHealth > 0);\n         if (targets.length === 0) {\n             this.log(`ã€æˆ˜æ–—çŠ¶æ€å¼‚å¸¸ã€‘${npc.name} æ‰¾ä¸åˆ°ä»»ä½•æœ‰æ•ˆç›®æ ‡ï¼Œæˆ˜æ–—é™·å…¥åœæ»ï¼`, 'log-danger');\n             this.showNotification(\"æ— ç›®æ ‡ã€‚\", \"danger\");\n             // è°ƒç”¨æˆ‘ä»¬æ–°çš„é”™è¯¯å¤„ç†æµç¨‹\n             await this.endCombat(false, false, false, true);\n             // æ³¨æ„è¿™é‡Œå› ä¸º endCombat æ˜¯ async çš„ï¼Œæˆ‘ä»¬æœ€å¥½ await å®ƒï¼Œç„¶åç›´æ¥è¿”å›\n             return;\n         }\n         if (targets.length > 0) {\n            const target = targets[Math.floor(Math.random() * targets.length)];\n            const defendChance = npc.type === 'enemy' ? 0.3 : 0.1; // æ•Œäºº10%ï¼Œé˜Ÿå‹20%\nconst action = (Math.random() > defendChance) ? 'attack' : 'defend';\n\n \n            if (action === 'attack') {\n                   // â­ è¯­è¨€é€»è¾‘ï¼šåªæœ‰æ”»å‡»æ—¶æ‰è¯´æˆ˜æ–—è¯­è¨€ï¼\n                const battleSpeech = this.randomSpeech(npc.battleSpeech);\n                if (battleSpeech) this.showSpeechBubble(npc, battleSpeech);\n                                const poolKeys = Object.keys(npc.dicePool).filter(k=> !['åŒ»å­¦','æ‰‹è‰º'].includes(k) && (npc.dicePool[k] || 0) > 0);\n\n if (poolKeys.length >= 2) {\n                    const randomPool = [];\n                    // (é€‰å–éª°æ± çš„é€»è¾‘ä¸å˜)\n                    while(randomPool.length < 2 && poolKeys.length > 0) {\n                        const keyIndex = Math.floor(Math.random() * poolKeys.length);\n                        const key = poolKeys.splice(keyIndex, 1)[0];\n                        if(!randomPool.includes(key)) randomPool.push(key);\n                    }\n                    if(randomPool.length > 0){\n                       await this.executeAction(npc, [target], 'attack', randomPool);\n                    }\n                }\n            } else { // Defend\n                await this.executeAction(npc, [npc], 'defend', ['è€åŠ›', 'æ²‰ç€', 'ä½“ç§¯']);\n            }\n         } else {\n             this.log(`${npc.name} æ‰¾ä¸åˆ°ç›®æ ‡ã€‚`);\n         }\n    }\n    // --- AIé€»è¾‘ç»“æŸ ---\n\n   await new Promise(r => setTimeout(r, this.getDelay('turnEnd')));\n    this.nextTurn();\n}\n         toggleActionPanel(enabled) {\n                this.actionPanel.querySelectorAll('button').forEach(btn => btn.disabled = !enabled);\n            }\n\n // åœ¨ function setupActionPanel() å†…éƒ¨\n\nsetupActionPanel() {\n    // âœ¨ å¦ˆå¦ˆçš„é™„é­”ä»ªå¼ âœ¨\n    const handler = (e) => {\n        if (e.target.tagName === 'BUTTON') {\n             const action = e.target.dataset.action;\n             this.selectedAction = action;\n             this.handlePlayerAction();\n        }\n    };\n    // ç§»é™¤æ—§çš„ï¼Œç»‘å®šæ–°çš„\n    if(this.actionPanel.__handler__) this.actionPanel.removeEventListener('click', this.actionPanel.__handler__);\n    this.actionPanel.addEventListener('click', handler);\n    this.actionPanel.__handler__ = handler; // åˆ»ä¸Šé­”æ³•å°è®°\n}\n\n async handlePlayerAction() {\n    const action = this.selectedAction;\n    const playerData = this.player.raw_data;\n  if (action === 'exit') {\n        this.logCombatEvent(\"ä½ é€‰æ‹©å¼ºåˆ¶ç»ˆæ­¢äº†è¿™åœºæˆ˜æ–—ï¼\", 'log-danger');\n        this.showNotification(\"æˆ˜æ–—è¢«å¼ºåˆ¶ç»ˆæ­¢\", \"danger\");\n        // ç›´æ¥è°ƒç”¨æˆ‘ä»¬ä¸ºé”™è¯¯æƒ…å†µå‡†å¤‡çš„é€€å‡ºæµç¨‹\n        await this.endCombat(false, false, false, true);\n        return; // ç«‹åˆ»ç»“æŸï¼Œä¸æ‰§è¡Œä»»ä½•å…¶ä»–æ“ä½œ\n    }\n    // --- å¦ˆå¦ˆçš„é­”æ³•ä¼˜åŒ–äº†è¿™é‡Œçš„é€»è¾‘ ---\n\n    // 1. æ— éœ€ç›®æ ‡ã€æ— éœ€éª°æ± é€‰æ‹©çš„åŠ¨ä½œ\n    if (action === 'defend' || action === 'flee') {\n        if (action === 'defend') {\n            this.executeAction(this.player, [this.player], 'defend', ['è€åŠ›', 'æ²‰ç€', 'ä½“ç§¯']);\n            setTimeout(() => this.nextTurn(), 1000);\n        }\n            if (action === 'flee') {\n            this.logCombatEvent(`${this.player.name} å‡†å¤‡é€ƒè·‘...`);\n            const playerSuccess = this.rollDice(this.getDiceCount(this.player, ['æ•æ·', 'è¿åŠ¨', 'æ±‚ç”Ÿ']));\n\n            // âœ¨ å…¨æ–°çš„ã€æ›´æ™ºèƒ½çš„æ•Œæ–¹é˜»æˆªæ£€å®š âœ¨\n            let enemyInterceptDicePool = 0;\n            const aliveEnemies = this.enemies.filter(e => e.currentHealth > 0);\n\n            if (aliveEnemies.length > 0) {\n                // 1. è®¡ç®—è¡€é‡åŠ æƒ\n                const totalMaxHealth = aliveEnemies.reduce((sum, e) => sum + e.maxHealth, 0);\n                const totalCurrentHealth = aliveEnemies.reduce((sum, e) => sum + e.currentHealth, 0);\n                const healthRatio = totalCurrentHealth / totalMaxHealth;\n                const healthWeight =healthRatio; // æ»¡è¡€æ—¶ä¸º1ï¼ŒåŠè¡€æ—¶ä¸º0.75ï¼Œç©ºè¡€æ—¶ä¸º0.5\n                this.log(`> æ•Œæ–¹è¡€é‡åŠ æƒ: ${healthWeight.toFixed(2)}x`, 'log-narrator');\n\n                // 2. è®¡ç®—å¹³å‡å±æ€§åŠ æƒ\n                let totalAttributePoints = 0;\n                let attributeCount = 0;\n                aliveEnemies.forEach(enemy => {\n                    Object.values(enemy.dicePool).forEach(value => {\n                        totalAttributePoints += value;\n                        attributeCount++;\n                    });\n                });\n                const averageAttribute = attributeCount > 0 ? totalAttributePoints / attributeCount : 0;\n                const attributeWeight = averageAttribute / 5; // å¹³å‡å±æ€§5ä¸º1å€\n                this.log(`> æ•Œæ–¹å¹³å‡å±æ€§åŠ æƒ: ${attributeWeight.toFixed(2)}x`, 'log-narrator');\n\n                // 3. è®¡ç®—æœ€ç»ˆé˜»æˆªéª°æ± \n                const baseDice = aliveEnemies.length * 2; // æ¯ä¸ªæ•ŒäººåŸºç¡€æä¾›2ä¸ªéª°å­\n                enemyInterceptDicePool = Math.floor(baseDice * healthWeight * attributeWeight);\n                this.log(`> æ•Œæ–¹æœ€ç»ˆé˜»æˆªéª°æ± : ${enemyInterceptDicePool}d10`, 'log-narrator');\n            }\n\n            const enemySuccess = this.rollDice(enemyInterceptDicePool);\n\n            this.log(`> ${this.player.name} çš„é€ƒè·‘æ£€å®šè·å¾— <strong style=\"color:yellow\">${playerSuccess}</strong> ä¸ªæˆåŠŸã€‚`, 'log-roll');\n            this.log(`> æ•Œæ–¹çš„é˜»æˆªæ£€å®šè·å¾— <strong style=\"color:lightblue\">${enemySuccess}</strong> ä¸ªæˆåŠŸã€‚`, 'log-roll');\n\n            if (playerSuccess > enemySuccess) {\n                this.logCombatEvent(\"ä½ æˆåŠŸé€ƒç¦»äº†æˆ˜æ–—ï¼\", 'log-success');\n                this.endCombat(true, true);\n            } else {\n                this.logCombatEvent(\"é€ƒè·‘å¤±è´¥ï¼ä½ è¢«æ•Œäººç¼ ä½äº†ï¼\", 'log-damage');\n                this.showNotification(\"é€ƒè·‘å¤±è´¥\", \"danger\");\n                await new Promise(r => setTimeout(r, this.getDelay('actionDelay')));\n                this.nextTurn();\n            }\n            // âœ¨ é€»è¾‘ç»“æŸ âœ¨\n        }\n              return;\n    }\n\n    // 2. æ‰“å¼€ç‰¹æ®Šé¢æ¿çš„åŠ¨ä½œ\n    if (action === 'item') {\n        this.showItemSkillPanel();\n        return;\n    }\n\n     // 3. éœ€è¦ç›®æ ‡ï¼Œä½†ä¸éœ€è¦é€‰æ‹©éª°æ± çš„åŠ¨ä½œ\n    if (action === 'treat' || action === 'steal') {\n        this.selectedDicePool = (action === 'treat') ? ['æ‰‹è‰º', 'åŒ»å­¦'] : ['æ‰‹ä¸ŠåŠŸå¤«', 'éšè—'];\n        this.isWaitingForTarget = true; // âœ¨ æ ¸å¿ƒï¼æ‰“å¼€â€œç­‰å¾…ç›®æ ‡â€çš„å¼€å…³\n        this.promptForTarget(`ä½ é€‰æ‹©äº† [${this.selectedDicePool.join(', ')}]ï¼Œè¯·é€‰æ‹©ä¸€ä¸ªç›®æ ‡ã€‚`);\n        return; // ç­‰å¾…ç”¨æˆ·ç‚¹å‡»ç›®æ ‡\n    }\n\n    // 4. éœ€è¦é€‰æ‹©éª°æ± ï¼Œä¹Ÿéœ€è¦ç›®æ ‡çš„åŠ¨ä½œ\n    let poolChoices = [];\n    if (playerData) {\n        switch (action) {\n            case 'attack':\n                poolChoices = [ ...Object.keys(playerData.å±æ€§æ®µ.ç”Ÿç†å±æ€§), 'è‚‰æ', 'æªæ¢°', 'ç™½åˆƒ', 'å¼“ç®­','ç¥ç§˜å­¦','ç§‘å­¦' ];\n                break;\n            case 'persuade':\n                 poolChoices = [ ...Object.keys(playerData.å±æ€§æ®µ.äº’åŠ¨å±æ€§), ...Object.keys(playerData.æŠ€èƒ½æ®µ.äº’åŠ¨æŠ€èƒ½) ];\n                break;\n             case 'scan':\n                 // â­ å¦ˆå¦ˆçš„ä¿®æ­£é­”æ³•åœ¨è¿™é‡Œï¼â­\n                 const mindAttrs = Object.keys(playerData.å±æ€§æ®µ.å¿ƒæ™ºå±æ€§);\n                 const mindSkills = Object.keys(playerData.æŠ€èƒ½æ®µ.å¿ƒæ™ºæŠ€èƒ½);\n                  poolChoices = [...mindAttrs, ...mindSkills].filter(skill => !['åŒ»å­¦', 'æ‰‹è‰º'].includes(skill));\n                 // â­ é­”æ³•ç»“æŸ â­\n                break;\n        }\n    }\n\n  // å¦‚æœæ²¡æœ‰å¯ç”¨çš„æŠ€èƒ½/å±æ€§ï¼Œç›´æ¥æç¤ºå¹¶ä¸­æ­¢\n    const availableChoices = poolChoices.filter(c => (this.player.dicePool[c] || 0) > 0);\n    if(availableChoices.length === 0){\n        this.log(\"ä½ æ²¡æœ‰å¯ç”¨äºæ­¤è¡ŒåŠ¨çš„å±æ€§æˆ–æŠ€èƒ½ã€‚\");\n        this.showNotification(\"æ— å¯ç”¨æŠ€èƒ½/å±æ€§\", \"danger\");\n        this.selectedAction = null; // é‡ç½®åŠ¨ä½œ\n        return;\n    }\n\n    this.showDicePoolSelector(availableChoices);\n    // æˆ‘ä»¬ä¸å†åœ¨è¿™é‡Œç­‰å¾…æˆ–åšä»»ä½•äº‹ï¼Œéª°æ± é€‰æ‹©å™¨çš„ç¡®è®¤æŒ‰é’®ä¼šå¤„ç†åç»­é€»è¾‘\n}\n   showItemSkillPanel() {\n    const panel = document.getElementById('item-skill-panel');\n    const itemsTab = document.getElementById('items-tab');\n    const skillsTab = document.getElementById('skills-tab');\n    itemsTab.innerHTML = '';\n    skillsTab.innerHTML = '';\n\n     // å¡«å……ç‰©å“\n    const inventory = this.assaData.global_lore.èƒŒåŒ… || {};\n    for (const name in inventory) {\n        const item = inventory[name];\n        if (item.num > 0 && item.effect) {\n             const entry = this.createItemSkillEntry(name, item, 'item');\n             itemsTab.appendChild(entry);\n        }\n    }\n \n    if(itemsTab.innerHTML === '') itemsTab.innerHTML = '<p>è¡Œå›Šç©ºç©ºå¦‚ä¹Ÿ...</p>';\n\n\n    // å¡«å……æŠ€èƒ½\n     const otherSkills = this.assaData.global_lore.å…¶ä»–æŠ€èƒ½ || {};\n    for (const name in otherSkills) {\n        const skill = otherSkills[name];\n\n        \n        const effectPattern = /dp[+-]|hp[+-]/;\n        if (skill && skill.effect && effectPattern.test(skill.effect)) {\n            const entry = this.createItemSkillEntry(name, skill, 'skill');\n            skillsTab.appendChild(entry);\n        }\n        // âœ¨âœ¨âœ¨ é­”æ³•æ–½å±•å®Œæ¯• âœ¨âœ¨âœ¨\n    }\n     if(skillsTab.innerHTML === '') skillsTab.innerHTML = '<p>æ²¡æœ‰å¯ç”¨çš„ä¸»åŠ¨æŠ€èƒ½...</p>';\n\n    panel.style.display = 'flex';\n      const closeBtn = document.getElementById('close-item-skill-panel-btn');\n    const handler = () => { panel.style.display = 'none'; };\n    if(closeBtn.__handler__) closeBtn.removeEventListener('click', closeBtn.__handler__);\n    closeBtn.addEventListener('click', handler);\n    closeBtn.__handler__ = handler;\n}\n\n // â­ [æ›¿æ¢] æ—§çš„ createItemSkillEntry å‡½æ•° â­\ncreateItemSkillEntry(name, data, type) {\n    const div = document.createElement('div');\n    div.className = 'item-skill-entry';\n\n    // --- å¦ˆå¦ˆå¼ºå¤§çš„æ–°é­”æ³•åœ¨è¿™é‡Œï¼ ---\n    const energyCost = parseInt((data.effect.match(/èƒ½é‡æ± -(\\d+)/) || [0, 0])[1]);\n    const currentEnergy = this.player.raw_data?.è¡ç”Ÿå±æ€§æ®µ?.èƒ½é‡æ± ?.å½“å‰å€¼[0] || 0;\n    const canAfford = currentEnergy >= energyCost;\n\n    let costText = '';\n    if (energyCost > 0) {\n       costText = ` (æ¶ˆè€—èƒ½é‡: ${energyCost})`;\n    }\n    let disabledStyle = !canAfford ? 'opacity: 0.5; cursor: not-allowed;' : '';\n    let title = !canAfford ? 'èƒ½é‡ä¸è¶³ï¼' : '';\n\n    div.innerHTML = `\n        <div class=\"entry-name\" style=\"${disabledStyle}\" title=\"${title}\">${name} ${data.num ? `(x${data.num})` : ''} ${data.level ? `[${data.level}]` : ''}</div>\n        <div class=\"entry-desc\" style=\"${disabledStyle}\">${data.info || ''}</div>\n        <div class=\"entry-cost\" style=\"color:var(--secondary-color); ${disabledStyle}\">æ•ˆæœ: ${data.effect}${costText}</div>\n    `;\n\n    // åªæœ‰åœ¨èƒ½é‡å……è¶³æ—¶æ‰æ·»åŠ ç‚¹å‡»äº‹ä»¶\n    if (canAfford) {\n        div.onclick = () => this.selectItemSkill(name, data, type);\n    }\n    // --- é­”æ³•ç»“æŸ ---\n\n    return div;\n}\n // åœ¨ class CombatManager å†…ï¼Œç”¨ä¸‹é¢çš„ä»£ç æ›¿æ¢æ—§çš„ selectItemSkill å‡½æ•°\n\n selectItemSkill(name, data, type) {\n    const effect = data.effect;\n    // âœ¨ å¦ˆå¦ˆçš„â€œæ…§çœ¼è¯†é­”â€å’’è¯­ âœ¨\n    const dpMatch = effect.match(/dp(?:_bonus)?([+-])(\\d+)/);\n    const hpMatch = effect.match(/hp([+-])(\\d+)/);\n    const mpMatch = effect.match(/mp([+-])(\\d+)/); // <-- æ–°å¢çš„é­”æ³•è§†è§‰\n\n    document.getElementById('item-skill-panel').style.display = 'none'; // å…ˆå…³æ‰é¢æ¿\n\n    // ï¼ˆèµ„æºæ¶ˆè€—çš„é€»è¾‘ï¼Œå¦ˆå¦ˆå¸®ä½ æ•´ç†å¾—æ›´æ¸…æ™°äº†ï¼‰\n    let canUse = true;\n    const energyCost = parseInt((effect.match(/èƒ½é‡æ± -(\\d+)/) || [0, 0])[1]);\n\n    if (energyCost > 0) {\n        const energyPool = this.player.raw_data?.è¡ç”Ÿå±æ€§æ®µ?.èƒ½é‡æ± ;\n        if (!energyPool || energyPool.å½“å‰å€¼[0] < energyCost) {\n            this.showNotification(\"èƒ½é‡ä¸è¶³ï¼Œä½¿ç”¨å¤±è´¥ï¼\", \"danger\");\n            canUse = false;\n        }\n    }\n\n     if (!canUse) {\n        // å¦‚æœèƒ½é‡ä¸è¶³ï¼Œä¹Ÿä¸åº”è¯¥ç»“æŸå›åˆ\n        this.log(\"å› èƒ½é‡ä¸è¶³ï¼Œä½¿ç”¨å¤±è´¥ã€‚è¯·é‡æ–°é€‰æ‹©è¡ŒåŠ¨ã€‚\", \"log-narrator\");\n        this.selectedAction = null;\n        return;\n    }\n\n    // åªæœ‰åœ¨ç¡®è®¤å¯ä»¥ä½¿ç”¨åï¼Œæ‰çœŸæ­£æ¶ˆè€—èµ„æº\n    if (energyCost > 0) {\n        this.player.raw_data.è¡ç”Ÿå±æ€§æ®µ.èƒ½é‡æ± .å½“å‰å€¼[0] -= energyCost;\n        this.log(`ä½ æ¶ˆè€—äº† ${energyCost} ç‚¹èƒ½é‡ã€‚`);\n    }\n\n    if (type === 'item') {\n        const itemInBag = this.assaData.global_lore.èƒŒåŒ…[name];\n        if (itemInBag && itemInBag.num) {\n            itemInBag.num--;\n        }\n    }\n    this.updateCharacterUI(this.player);\n\n    this.log(`ä½ ä½¿ç”¨äº†ã€${name}ã€‘ï¼`);\n\n    if (dpMatch) {\n        const value = parseInt(dpMatch[1] + dpMatch[2]);\n        this.playerTempBonuses = {\n            dp_bonus: this.playerTempBonuses.dp_bonus + value,\n            desc: name\n        };\n        this.logCombatEvent(`ä½ åœ¨æœ¬æ¬¡è¡ŒåŠ¨ä¸­${value > 0 ? 'è·å¾—' : 'å—åˆ°'}${Math.abs(value)}ç‚¹éª°æ± åŠ æˆï¼è¯·é€‰æ‹©ä½ çš„ä¸»è¦è¡ŒåŠ¨ã€‚`, \"log-success\");\n        this.showNotification(`è·å¾—éª°æ± åŠ æˆ: ${value > 0 ? '+' : ''}${value}`, \"success\");\n    }\n    // âœ¨ å…³é”®å‡çº§ï¼šæ— è®ºæ˜¯HPè¿˜æ˜¯MPå˜åŒ–ï¼Œéƒ½è¿›å…¥ç›®æ ‡é€‰æ‹© âœ¨\n    else if (hpMatch || mpMatch) {\n        const match = hpMatch || mpMatch;\n        const resourceType = hpMatch ? 'hp' : 'mp';\n\n        this.pendingAction = {\n            type,\n            name,\n            data,\n            effectType: 'resource_change',\n            resource: resourceType, // è®°å½•æ˜¯hpè¿˜æ˜¯mp\n            value: parseInt(match[1] + match[2])\n        };\n\n        this.selectedAction = 'item_skill_effect';\n        this.isWaitingForTarget = true;\n        this.promptForTarget(\"è¯·é€‰æ‹©ä¸€ä¸ªç›®æ ‡ã€‚\");\n        } else {\n        \n        this.log(\"è¿™ä¸ªç‰©å“/æŠ€èƒ½ç›®å‰åœ¨æˆ˜æ–—ä¸­è¿˜æ— æ³•ä½¿ç”¨ã€‚\", \"log-narrator\");\n        this.showNotification(\"æ­¤ç‰©å“/æŠ€èƒ½æ— æˆ˜æ–—æ•ˆæœ\", \"info\");\n\n        // æˆ‘ä»¬æŠŠè¡ŒåŠ¨çš„æœºä¼šè¿˜ç»™ä½ \n        this.selectedAction = null; // é‡ç½®ä½ çš„è¡ŒåŠ¨é€‰æ‹©\n        this.log(\"è¯·é‡æ–°é€‰æ‹©ä½ çš„è¡ŒåŠ¨ã€‚\", \"log-narrator\"); // æ¸©æŸ”åœ°æç¤ºä½ \n        \n    }\n}\n showDicePoolSelector(choices) {\n    // âœ¨ å¦ˆå¦ˆæ¸©æŸ”çš„é—å¿˜å’’è¯­ âœ¨\n    this.selectedDicePool = []; // åœ¨æ¯æ¬¡æ‰“å¼€é€‰æ‹©å™¨æ—¶ï¼Œéƒ½æ¸…ç©ºä¹‹å‰çš„é€‰æ‹©ï¼\n\n    const selector = document.getElementById('dice-pool-selector');\n    const optionsContainer = document.getElementById('pool-options');\n    optionsContainer.innerHTML = ''; // ï¼ˆä½ è¿™é‡Œçš„æ¸…ç†å·¥ä½œåšå¾—å¾ˆå¥½ï¼Œæˆ‘çš„å®è´ï¼‰\n\n    selector.style.display = 'flex';\n\n    choices.forEach(choice => {\n        const btn = document.createElement('button');\n        btn.textContent = `${choice} (${this.player.dicePool[choice] || 0})`;\n        optionsContainer.appendChild(btn);\n\n        btn.addEventListener('click', () => {\n            if (this.selectedDicePool.includes(choice)) {\n                this.selectedDicePool = this.selectedDicePool.filter(p => p !== choice);\n                btn.style.border = '1px solid var(--secondary-color)';\n                btn.style.backgroundColor = 'transparent';\n            } else if (this.selectedDicePool.length < 2) {\n                this.selectedDicePool.push(choice);\n                btn.style.border = '1px solid var(--primary-color)';\n                btn.style.backgroundColor = 'var(--glow-color)';\n            } else {\n                this.showNotification(\"æœ€å¤šé€‰æ‹©2é¡¹\", 'info');\n            }\n        });\n    });\n\n    const confirmBtn = document.getElementById('confirm-pool-btn');\n    const handler = () => {\n        if (this.selectedDicePool.length > 0) {\n            selector.style.display = 'none';\n                if (this.selectedAction === 'attack') {\n                this.promptAttackType(); // è°ƒç”¨æ–°çš„å‡½æ•°æ¥é€‰æ‹©æ”»å‡»æ¨¡å¼\n            } else {\n            // å¯¹äºéæ”»å‡»åŠ¨ä½œï¼Œæµç¨‹ä¿æŒä¸å˜\n                this.isWaitingForTarget = true;\n                this.promptForTarget(`ä½ é€‰æ‹©äº† [${this.selectedDicePool.join(', ')}] ä½œä¸ºéª°æ± ã€‚ç°åœ¨è¯·é€‰æ‹©ä¸€ä¸ªç›®æ ‡ã€‚`);\n            }\n                 } else {\n            this.showNotification(\"è¯·è‡³å°‘é€‰æ‹©ä¸€é¡¹\", \"info\");\n        }\n    };\n    if(confirmBtn.__handler__) confirmBtn.removeEventListener('click', confirmBtn.__handler__);\n    confirmBtn.addEventListener('click', handler);\n    confirmBtn.__handler__ = handler;\n}\n \n // â­ [æ›¿æ¢] addCardClickListeners å‡½æ•°\naddCardClickListeners() {\n    const playerSide = document.getElementById('player-side');\n    const enemySide = document.getElementById('enemy-side');// å¦ˆå¦ˆä¸ºä½ é‡å†™çš„ã€æ›´èªæ˜çš„ç»Ÿä¸€äº‹ä»¶å¤„ç†å™¨\n\n   // æ‰¾åˆ° addCardClickListeners å‡½æ•°å†…éƒ¨çš„ unifiedClickHandler\nconst unifiedClickHandler = (event) => {\n    const card = event.target.closest('.character-card');\n    if (!card) return;\n\n    const targetId = card.id;\n    const target = this.findCharacterById(targetId);\n    if (!target) return;\n\n    // âœ¨ --- å¦ˆå¦ˆæ³¨å…¥äº†æ–°çš„å¤šé€‰é€»è¾‘ --- âœ¨\n    if (this.isSelectingMultiTarget) {\n        if (target.type === 'enemy' && target.currentHealth > 0 && !this.selectedMultiTargets.some(t => t.id === target.id)) {\n            this.selectedMultiTargets.push(target);\n            card.classList.add('targeted'); // é«˜äº®é€‰ä¸­çš„ç›®æ ‡\n            this.log(`å·²é€‰æ‹©ç›®æ ‡ ${this.selectedMultiTargets.length}/${this.multiTargetCount}: ${target.name}`);\n\n            if (this.selectedMultiTargets.length === this.multiTargetCount) {\n                // æ¸…ç†æ‰€æœ‰é«˜äº®ï¼Œå› ä¸ºé©¬ä¸Šè¦æ‰§è¡Œæ”»å‡»äº†\n                document.querySelectorAll('.character-card.targeted').forEach(c => c.classList.remove('targeted'));\n\n                this.logCombatEvent(`ç›®æ ‡é€‰æ‹©å®Œæ¯•ï¼Œå¼€å§‹æ‰§è¡Œç¾¤æ”»ï¼`);\n\n                // é‡ç½®é€‰æ‹©çŠ¶æ€\n                this.isSelectingMultiTarget = false;\n                this.multiTargetCount = 0;\n\n                // å»¶è¿Ÿæ‰§è¡Œ\n                setTimeout(async () => {\n                    await this.executeAction(this.player, this.selectedMultiTargets, this.selectedAction, this.selectedDicePool);\n\n                    // æ¸…ç†å·¥ä½œ\n                    this.selectedAction = null;\n                    this.selectedDicePool = [];\n                    this.selectedMultiTargets = [];\n                    this.isAoeAttack = false;\n\n\n                    if (!this.status.startsWith('completed')) {\n                        await new Promise(r => setTimeout(r, this.getDelay('turnEnd')));\n                        this.nextTurn();\n                    }\n                }, this.getDelay('actionDelay'));\n            }\n        } else {\n            if(target.type !== 'enemy') this.showNotification('åªèƒ½é€‰æ‹©æ•Œäººä½œä¸ºç›®æ ‡ï¼', 'danger');\n            if(this.selectedMultiTargets.some(t => t.id === target.id)) this.showNotification('è¿™ä¸ªç›®æ ‡å·²ç»è¢«é€‰è¿‡äº†ï¼', 'info');\n        }\n        return; // å¤„ç†å®Œå¤šé€‰é€»è¾‘åç›´æ¥è¿”å›\n    }\n    // âœ¨ --- é­”æ³•ç»“æŸ --- âœ¨\n\n    // --- â­ å¦ˆå¦ˆæœ€å…³é”®çš„ä¿®å¤é­”æ³•å°±åœ¨è¿™é‡Œï¼â­ ---\n    // ç¬¬ä¸€ä¼˜å…ˆçº§ï¼šæ£€æŸ¥æ˜¯å¦å¤„äºâ€œç­‰å¾…é€‰æ‹©ç›®æ ‡â€çŠ¶æ€\n    if (this.isWaitingForTarget) {\n        let isValidTarget = false;\n        const isFriendlyCard = target.type === 'player' || target.type === 'teammate';\n\n        switch(this.selectedAction) {\n            case 'attack':\n            case 'persuade':\n            case 'scan':\n            case 'steal':\n                if (!isFriendlyCard) isValidTarget = true;\n                else this.showNotification(\"å¿…é¡»é€‰æ‹©ä¸€ä¸ªæ•Œäººï¼\", \"danger\");\n                break;\n            case 'treat':\n                if (isFriendlyCard) isValidTarget = true;\n                else this.showNotification(\"å¿…é¡»é€‰æ‹©ä¸€ä¸ªå‹æ–¹ï¼\", \"danger\");\n                break;\n            case 'item_skill_effect': // ç‰©å“/æŠ€èƒ½æ•ˆæœ\n                isValidTarget = true;\n                break;\n        }\n\n        if (!isValidTarget) {\n            // å¦‚æœç›®æ ‡æ— æ•ˆï¼Œæˆ‘ä»¬åªæç¤ºä¸€ä¸‹ï¼Œä½†è¦ç«‹åˆ»ç»“æŸè¿™æ¬¡ç‚¹å‡»çš„å¤„ç†ï¼\n            // è¿™æ ·ï¼Œå®ƒå°±ä¸ä¼šâ€œæ‰ä¸‹å»â€æ‰§è¡Œåé¢çš„ä¿¡æ¯é¢æ¿é€»è¾‘äº†ã€‚\n            return;\n        } else {\n            // âœ¨ ç›®æ ‡æœ‰æ•ˆï¼å¤„ç†å®ƒï¼Œç„¶åç«‹åˆ»ç»“æŸï¼ âœ¨\n            this.isWaitingForTarget = false;\n            // this.targetingPrompt.style.display = 'none'; // <-- å¦ˆå¦ˆæŠŠè¿™è¡Œä¼šå¯¼è‡´é”™è¯¯çš„é­”æ³•æ‹¿æ‰äº†ï¼\n\n            card.classList.add('targeted');\n            this.selectedTargetId = targetId;\n\n            if (this.selectedAction === 'item_skill_effect') {\n                this.useResourceChangeEffect(target, this.pendingAction); \n                this.pendingAction = null;\n            } else {\n                setTimeout(async () => {\n                    // await this.executeAction(this.player, target, this.selectedAction, this.selectedDicePool);\n    await this.executeAction(this.player, [target], this.selectedAction, this.selectedDicePool);\n\n                    this.selectedAction = null;\n                    this.selectedDicePool = [];\n                    this.selectedTargetId = null;\n                    this.playerTempBonuses = { dp_bonus: 0, desc: '' };\n\n                    if (!this.status.startsWith('completed')) {\n                        await new Promise(r => setTimeout(r, this.getDelay('turnEnd')));\n                        this.nextTurn();\n                    }\n                }, this.getDelay('actionDelay'));\n            }\n\n            // âœ¨ ä»»åŠ¡å®Œæˆï¼Œç›´æ¥è¿”å›ï¼Œä¸å†æ‰§è¡Œä»»ä½•åç»­ä»£ç  âœ¨\n            return;\n        }\n    }\n\n    // --- é­”æ³•ç»“æŸ ---\n\n    // ç¬¬äºŒä¼˜å…ˆçº§ï¼šå¦‚æœä¸æ˜¯åœ¨é€‰æ‹©ç›®æ ‡ï¼Œå¹¶ä¸”ç‚¹å‡»çš„æ˜¯æ•Œäººï¼Œåˆ™åˆ‡æ¢ä¿¡æ¯é¢æ¿\n     if (target.type === 'enemy' || target.type === 'teammate') { \n        const infoPanel = document.getElementById(`info-panel-${target.id}`);\n        if (infoPanel) {\n            if (infoPanel.classList.contains('expanded')) {\n                infoPanel.classList.remove('expanded');\n            } else {\n                document.querySelectorAll('.info-panel.expanded').forEach(p => p.classList.remove('expanded'));\n                infoPanel.classList.toggle('expanded');\n            }\n        }\n    }\n};\n\n// é™„é­”ä¸é©±é­”ä»ªå¼ (ä¿æŒä¸å˜)\nif (playerSide.__handler__) playerSide.removeEventListener('click', playerSide.__handler__);\nplayerSide.addEventListener('click', unifiedClickHandler);\nplayerSide.__handler__ = unifiedClickHandler;\n\nif (enemySide.__handler__) enemySide.removeEventListener('click', enemySide.__handler__);\nenemySide.addEventListener('click', unifiedClickHandler);\nenemySide.__handler__ = unifiedClickHandler;\n}   \n            // è¿™æ˜¯ä¸€ä¸ªå…¨æ–°çš„æ–¹æ³•ï¼Œç”¨æ¥å¤„ç†HPå˜æ›´æ•ˆæœçš„ä½¿ç”¨\n            // â­ [æ›¿æ¢] æ—§çš„ useHpChangeEffect å‡½æ•° â­\n async useResourceChangeEffect(target, actionInfo) {\n    this.logCombatEvent(`ä½ å¯¹ ${target.name} ä½¿ç”¨äº†ã€${actionInfo.name}ã€‘ï¼`);\n\n    // æ ¹æ® actionInfo æ¥å†³å®šæ˜¯æ¢å¤ HP è¿˜æ˜¯ MP\n    const { resource, value } = actionInfo;\n\n    // --- âœ¨ å¦ˆå¦ˆçš„â€œèƒ½é‡/ç”Ÿå‘½åˆ†æµâ€é­”æ³• âœ¨ ---\n    if (resource === 'hp') {\n        // --- HP æ¢å¤é€»è¾‘ ---\n        if (value > 0) {\n            this.logCombatEvent(`${target.name} æ¢å¤äº† <strong style=\"color:var(--success-color)\">${value}</strong> ç‚¹ç”Ÿå‘½å€¼ï¼`, 'log-success');\n            this.showNotification(`${target.name} æ¢å¤ ${value} HP`, 'success');\n        } else {\n            this.logCombatEvent(`${target.name} é­å—äº† <strong style=\"color:var(--danger-color)\">${Math.abs(value)}</strong> ç‚¹é­”æ³•ä¼¤å®³ï¼`, 'log-damage');\n            this.showNotification(`${target.name} å—åˆ° ${Math.abs(value)} ä¼¤å®³`, 'danger');\n        }\n\n        const oldHealth = target.currentHealth;\n        target.currentHealth = Math.min(target.maxHealth, target.currentHealth + value);\n\n        if (target.currentHealth <= 0) {\n            target.currentHealth = 0;\n            this.logCombatEvent(`======= ${target.name} è¢«å‡»è´¥äº†ï¼ =======`, 'log-danger');\n            this.showNotification(`${target.name} è¢«å‡»è´¥ï¼`, 'danger');\n            const card = document.getElementById(target.id);\n            if(card) {\n               card.style.opacity = '0.5';\n               card.style.pointerEvents = 'none';\n            }\n        }\n\n    } else if (resource === 'mp') {\n        // --- MP æ¢å¤é€»è¾‘ ---\n        const energyPool = target.raw_data?.è¡ç”Ÿå±æ€§æ®µ?.èƒ½é‡æ± ;\n        if (energyPool) {\n            if (value > 0) {\n                const oldEnergy = energyPool.å½“å‰å€¼[0];\n                energyPool.å½“å‰å€¼[0] = Math.min(energyPool.ä¸Šé™[0], oldEnergy + value);\n                const actualHeal = energyPool.å½“å‰å€¼[0] - oldEnergy;\n\n                if (actualHeal > 0) {\n                    this.logCombatEvent(`${target.name} æ¢å¤äº† <strong style=\"color:var(--info-color)\">${actualHeal}</strong> ç‚¹èƒ½é‡ï¼`, 'log-success');\n                    this.showNotification(`${target.name} æ¢å¤ ${actualHeal} èƒ½é‡`, 'success');\n                }\n            }\n            // (ç›®å‰ä¸æ”¯æŒmpæ‰£é™¤, ä½†æœªæ¥å¯ä»¥æ‰©å±•)\n        } else {\n             this.log(`${target.name} æ²¡æœ‰èƒ½é‡æ± ï¼Œæ— æ³•æ¢å¤èƒ½é‡ã€‚`);\n        }\n    }\n    // --- é­”æ³•ç»“æŸ ---\n\n    this.updateCharacterUI(target);\n    this.checkCombatEnd();\n\n    // è¿›å…¥ä¸‹ä¸€å›åˆ\n    await new Promise(r => setTimeout(r, this.getDelay('turnEnd')));\n    if (!this.status.startsWith('completed')) {\n       this.nextTurn();\n    }\n}\nasync animateAttack(attackerCard, targetCard) {\n    const attackerIcon = attackerCard.querySelector('.icon');\n    const targetIcon = targetCard.querySelector('.icon');\n    const battleContainer = document.getElementById('battle-container');\n\n    if (!attackerIcon || !targetIcon || !battleContainer) return;\n\n    // --- â­ å¦ˆå¦ˆæœ€å¾—æ„çš„é­”æ³•åœ¨è¿™é‡Œï¼Œæˆ‘çš„å­©å­ï¼ â­ ---\n\n    // 1. æ ¹æ®å½“å‰é€Ÿåº¦è·å–åŠ¨ç”»é£è¡Œæ—¶é—´\n    const flightTime = this.getDelay('animationFlightTime'); // å•ä½ï¼šæ¯«ç§’\n    const flightTimeSeconds = flightTime / 1000; // è½¬æ¢ä¸ºç§’ï¼Œç”¨äºCSS\n\n    // 2. å‡†å¤‡å·¥ä½œï¼šè®°å½•åˆå§‹ä½ç½®ï¼Œå¹¶æŠŠå®ƒâ€œæŠ±â€åˆ°æˆ˜æ–—åœºåœ°ä¸Š\n    const attackerRect = attackerIcon.getBoundingClientRect();\n    const containerRect = battleContainer.getBoundingClientRect();\n    const originalParent = attackerIcon.parentNode;\n\n    battleContainer.appendChild(attackerIcon);\n\n    // 3. åŠ¨æ€è®¾ç½®è¿™ä¸€æ¬¡é£è¡Œçš„æ ·å¼å’ŒåŠ¨ç”»æ—¶é•¿ï¼\n    attackerIcon.style.position = 'absolute';\n    attackerIcon.style.zIndex = '2000';\n    attackerIcon.style.fontSize = '48px';\n    attackerIcon.style.top = `${attackerRect.top - containerRect.top}px`;\n    attackerIcon.style.left = `${attackerRect.left - containerRect.left}px`;\n    attackerIcon.style.transition = `transform ${flightTimeSeconds}s ease-in-out`; // å…³é”®ï¼åŒæ­¥CSSåŠ¨ç”»å’ŒJSç­‰å¾…\n    originalParent.style.opacity = '0';\n\n    // ç­‰å¾…ä¸€ç¬é—´ï¼Œç¡®ä¿æµè§ˆå™¨åº”ç”¨äº†ä¸Šé¢çš„æ ·å¼\n    await new Promise(resolve => setTimeout(resolve, 50));\n\n    // 4. èµ·é£ï¼è®¡ç®—å¹¶åº”ç”¨ç›®æ ‡ä½ç½®\n    const targetRect = targetIcon.getBoundingClientRect();\n    const deltaX = targetRect.left - attackerRect.left;\n    const deltaY = targetRect.top - attackerRect.top;\n    attackerIcon.style.transform = `translate(${deltaX}px, ${deltaY}px)`;\n\n    // ç­‰å¾…é£è¡ŒåŠ¨ç”»å®Œæˆ\n    await new Promise(resolve => setTimeout(resolve, flightTime));\n\n    // 5. å›å®¶ï¼é£å›åŸç‚¹\n    attackerIcon.style.transform = 'translate(0, 0)';\n\n    // ç­‰å¾…å½’ä½åŠ¨ç”»å®Œæˆ\n    await new Promise(resolve => setTimeout(resolve, flightTime));\n\n    // 6. æ”¶å°¾ï¼šæŠŠå®ƒæ”¾å›åŸæ¥çš„å°çªï¼Œå¹¶æ¸…ç†æ‰€æœ‰ä¸´æ—¶æ ·å¼\n    attackerIcon.style.position = '';\n    attackerIcon.style.zIndex = '';\n    attackerIcon.style.top = '';\n    attackerIcon.style.left = '';\n    attackerIcon.style.transition = '';\n    attackerIcon.style.transform = '';\n    originalParent.appendChild(attackerIcon);\n    originalParent.style.opacity = '1';\n\n    // --- â­ é­”æ³•ç»“æŸ â­ ---\n}\n        async executeAction(actor, targets, action, pool) {\n    // æ¸…é™¤è¡ŒåŠ¨è€…è‡ªèº«çš„é˜²å¾¡çŠ¶æ€\n    if (actor.isDefending) {\n        actor.isDefending = false;\n        const actorCard = document.getElementById(actor.id);\n        if (actorCard) {\n            actorCard.classList.remove('is-defending');\n        }\n    }\n    this.log('-----------------', 'log-narrator');\n    this.toggleActionPanel(false);\n   if (action === 'attack' && targets.length > 1) {\n        // --- ç¾¤æ”»é€»è¾‘ ---\n        const actorName = `<strong style=\"color:yellow\">${actor.name}</strong>`;\n        this.logCombatEvent(`${actorName} å¯¹ ${targets.length} ä¸ªç›®æ ‡å‘åŠ¨äº† <strong style=\"color:orange\">[ç¾¤ä½“æ”»å‡»]</strong>ï¼`);\n\n        // 1. è®¡ç®—åŸå§‹æ€»æ”»å‡»éª°æ± ï¼ˆåªè®¡ç®—ä¸€æ¬¡ï¼‰\n        // ä¸ºäº†å…¬å¹³ï¼Œæˆ‘ä»¬ä¸ç”¨ä»»ä½•ä¸€ä¸ªç‰¹å®šç›®æ ‡æ¥è®¡ç®—å…‹åˆ¶ï¼Œåªè®¡ç®— actor è‡ªèº«çš„åŸºç¡€éª°æ± \n        const totalDiceValue = this.getDiceCount(actor, pool, null); // target è®¾ä¸º null\n\n        // 2. è®¡ç®—åˆ†é…åˆ°æ¯ä¸ªç›®æ ‡çš„éª°æ± \n        const perTargetDice = Math.floor((totalDiceValue / (targets.length))*1.5);\n        this.log(`> åŸå§‹æ€»éª°æ± : ${totalDiceValue}d10ï¼Œåˆ†æ•£è‡³ ${targets.length} ä¸ªç›®æ ‡ï¼Œæ¯ç›®æ ‡åŸºç¡€éª°æ± å¼ºåŒ–ä¸º ${perTargetDice}d10ã€‚`, 'log-roll');\n\n        // 3. ä¾æ¬¡å¯¹æ¯ä¸ªç›®æ ‡æ‰§è¡Œæ”»å‡»\n        for (const target of targets) {\n            if (target.currentHealth <= 0) continue; // è·³è¿‡å·²ç»å€’ä¸‹çš„\n\n            const targetName = `<strong style=\"color:lightblue\">${target.name}</strong>`;\n            this.logCombatEvent(`-> æ­£åœ¨æ”»å‡» ${targetName}...`, 'log-narrator');\n\n            const actorCard = document.getElementById(actor.id);\n            const targetCard = document.getElementById(target.id);\n            if(actorCard && targetCard) await this.animateAttack(actorCard, targetCard);\n\n            // å¯¹æ¯ä¸ªç›®æ ‡ç‹¬ç«‹è¿›è¡Œæ”»å‡»å’Œé—ªé¿æ£€å®š\n            const actorAttackSuccess = this.rollDice(perTargetDice);\n            this.log(`> æ”»å‡»æ£€å®š (${perTargetDice}d10): <strong style=\"font-size:1.1em;\">${actorAttackSuccess}</strong> ä¸ªæˆåŠŸã€‚`, 'log-roll');\n\n            // é—ªé¿æ£€å®šé€»è¾‘ (ä»åŸå•ä½“æ”»å‡»ä¸­å¤åˆ¶è¿‡æ¥)\n            const targetEvasionPool = ['æ•æ·', 'è¿åŠ¨'].filter(key => target.dicePool[key]);\n            if (targetEvasionPool.length === 0) targetEvasionPool.push('æ•æ·');\n            const targetDiceCount = this.getDiceCount(target, targetEvasionPool, actor);\n            const targetEvasionSuccess = this.rollDice(targetDiceCount);\n            this.log(`> ${targetName} é—ªé¿æ£€å®š (${targetDiceCount}d10): <strong style=\"font-size:1.1em;\">${targetEvasionSuccess}</strong> ä¸ªæˆåŠŸã€‚`, 'log-roll');\n\n            const evaded = targetEvasionSuccess > actorAttackSuccess;\n            if (evaded) {\n                this.logCombatEvent(`${targetName} é—ªé¿äº†è¿™æ¬¡æ”»å‡»ï¼`, 'log-evade');\n            } else {\n                const diff = actorAttackSuccess - targetEvasionSuccess;\n                // å¦ˆå¦ˆæ–½å±•çš„ä¿æŠ¤å’’è¯­\n// const energyBonus = actor.raw_data?.è¡ç”Ÿå±æ€§æ®µ?.èƒ½é‡æ± ?.å½“å‰å€¼?.[0] || 0;\nconst energyBonus = 0;\n\n// ç„¶åå†è®¡ç®—æœ€ç»ˆä¼¤å®³\nconst baseDamage = diff * 5 + energyBonus;\n                   this.log(`> å‘½ä¸­ï¼ä¼¤å®³è®¡ç®—: ${diff} * 5 = <strong style=\"color:orangered\">${baseDamage}</strong> ç‚¹ã€‚`, 'log-damage');\n                this.takeDamage(target, baseDamage, 'ç¾¤ä½“æ”»å‡»');\n            }\n             await new Promise(r => setTimeout(r, this.getDelay('actionDelay') / 2)); // æ¯æ¬¡æ”»å‡»ä¹‹é—´æœ‰ä¸€ä¸ªçŸ­æš‚çš„åœé¡¿\n        }\n\n    } else {\n        // --- å•ç›®æ ‡é€»è¾‘ (æˆ–éæ”»å‡»é€»è¾‘) ---\n        const target = targets[0]; // ä»æ•°ç»„ä¸­å–å‡ºå”¯ä¸€çš„ç›®æ ‡\n        if (!target) return;\n    const actorName = `<strong style=\"color:yellow\">${actor.name}</strong>`;\n    const targetName = `<strong style=\"color:lightblue\">${target.name}</strong>`;\n\n this.logCombatEvent(`${actorName} å¯¹ ${targetName} é‡‡å–è¡ŒåŠ¨: <strong style=\"color:orange\">[${action.toUpperCase()}]</strong>`);\n    // åŠ¨ç”»éƒ¨åˆ†\n    if (action !== 'defend' && actor.id !== target.id) {\n        const actorCard = document.getElementById(actor.id);\n        const targetCard = document.getElementById(target.id);\n        if (actorCard && targetCard){\n           await this.animateAttack(actorCard, targetCard);\n        }\n    }\n\n    // --- â­ å…¨æ–°çš„ã€è¶…çº§è¯¦ç»†çš„æ£€å®šä¸ç»“ç®—é€»è¾‘å¼€å§‹ â­ ---\n\n    // 1. æ”»å‡»æ–¹æ£€å®š\n    const actorDiceCount = this.getDiceCount(actor, pool, target);\n    let actorAttackSuccess = this.rollDice(actorDiceCount);\n    this.log(`> ${actorName} ä½¿ç”¨ [${pool.join('+')}] è¿›è¡Œæ£€å®šï¼Œéª°æ± ä¸º ${actorDiceCount}d10...`, 'log-roll');\n    this.log(`> æ£€å®šç»“æœ: <strong style=\"font-size:1.1em;\">${actorAttackSuccess}</strong> ä¸ªæˆåŠŸæ•°ã€‚`, 'log-roll');\n\n\n    // 2. é—ªé¿/æŠµæŠ—æ–¹æ£€å®š\n    let targetEvasionPool = [];\n    let targetDiceCount = 0;\n    let targetEvasionSuccess = 0;\n\n    // --- å¦ˆå¦ˆçš„å¿ƒçµå£å’é­”æ³•åœ¨è¿™é‡Œï¼ ---\n    if (action === 'persuade' && target.type !== 'player') {\n        // å¦‚æœæ˜¯è¯´æœNPCï¼Œåˆ™ä½¿ç”¨ç‰¹æ®Šçš„å¿ƒæ™ºæŠµæŠ—æ£€å®š\n        this.logCombatEvent(`> ${targetName} æ­£åœ¨æ„å»ºå¿ƒçµå£å’ä»¥æŠµæŠ—è¯´æœ...`, 'log-evade');\n        const mentalDefenseAttrs = ['æ™ºåŠ›', 'æ„ŸçŸ¥', 'å†³å¿ƒ', 'æ²‰ç€'];\n        let availablePool = [];\n\n        // ç­›é€‰å‡ºNPCæ‹¥æœ‰çš„ã€ä¸”å¤§äº0çš„å¿ƒæ™ºå±æ€§\n        for (const attr of mentalDefenseAttrs) {\n            if (target.dicePool[attr] > 0) {\n                availablePool.push(attr);\n            }\n        }\n\n        // è®¡ç®—æ„å¿—å€¼\n        const resolve = target.dicePool['å†³å¿ƒ'] || 0;\n        const composure = target.dicePool['æ²‰ç€'] || 0;\n        const willFromSaves = target.saves['æ„å¿—'] || 0; // ä¼˜å…ˆä½¿ç”¨è±å…é‡Œçš„æ„å¿—\n        const will = willFromSaves > 0 ? willFromSaves : resolve + Math.floor(composure / 2);\n\n        // æ„å»ºæœ€ç»ˆçš„æŠµæŠ—éª°æ± \n        let finalResistancePool = [];\n        if (will > 0) {\n            finalResistancePool.push({ name: 'æ„å¿—', value: will });\n        }\n\n        if (availablePool.length > 0) {\n            // ä»å¯ç”¨çš„å¿ƒæ™ºå±æ€§ä¸­éšæœºé€‰ä¸€ä¸ª\n            const randomAttr = availablePool[Math.floor(Math.random() * availablePool.length)];\n            finalResistancePool.push({ name: randomAttr, value: target.dicePool[randomAttr]});\n        }\n\n        targetEvasionPool = finalResistancePool.map(p => p.name);\n        targetDiceCount = finalResistancePool.reduce((sum, p) => sum + p.value, 0);\n        \n        // âœ¨ å¦ˆå¦ˆçš„â€œå£å’å¼ºåŒ–â€é­”æ³• âœ¨\n        const mentalFortressBonus = 5;\n        targetDiceCount += mentalFortressBonus;\n        this.log(`> å¿ƒçµå£å’é¢å¤–å¼ºåŒ–: +${mentalFortressBonus} ç‚¹åŸºç¡€æŠµæŠ—ï¼`, 'log-roll');\n\n        targetEvasionSuccess = this.rollDice(targetDiceCount);\n        this.log(`> ${targetName} ä½¿ç”¨ [${targetEvasionPool.join('+')}] è¿›è¡ŒæŠµæŠ—æ£€å®šï¼Œéª°æ± ä¸º ${targetDiceCount}d10...`, 'log-roll');\n\n    } else {\n        // å¯¹äºå…¶ä»–æ‰€æœ‰æƒ…å†µï¼Œä½¿ç”¨å¸¸è§„çš„é—ªé¿æ£€å®š\n// å®šä¹‰å¯ç”¨çš„é—ªé¿å±æ€§\nconst availableEvasionSkills = ['æ•æ·', 'è¿åŠ¨', 'æ„ŸçŸ¥'];\n\n// éšæœºæŠ½å–ä¸¤ä¸ªå±æ€§è¿›è¡Œé—ªé¿æ£€å®š\ntargetEvasionPool = [];\nconst shuffled = availableEvasionSkills.sort(() => Math.random() - 0.5);\ntargetEvasionPool = shuffled.slice(0, 2);\n\n// ç¡®ä¿ç›®æ ‡æ‹¥æœ‰è¿™äº›å±æ€§(å¯¹äºNPC)\nif (target.type !== 'player') {\n    targetEvasionPool = targetEvasionPool.filter(key => target.dicePool.hasOwnProperty(key));\n    // å¦‚æœè¿‡æ»¤åæ²¡æœ‰å±æ€§ï¼Œä½¿ç”¨æ‰€æœ‰å¯ç”¨çš„é—ªé¿å±æ€§\n    if (targetEvasionPool.length === 0) {\n        targetEvasionPool = Object.keys(target.dicePool).filter(key => availableEvasionSkills.includes(key));\n    }\n}\n\n// ä¿è¯è‡³å°‘æœ‰ä¸€ä¸ªæ£€å®šå±æ€§\nif (targetEvasionPool.length === 0) { \n    targetEvasionPool.push('æ•æ·'); \n}\n\ntargetDiceCount = this.getDiceCount(target, targetEvasionPool, actor);\ntargetEvasionSuccess = this.rollDice(targetDiceCount);\nthis.log(`> ${targetName} ä½¿ç”¨ [${targetEvasionPool.join('+')}] è¿›è¡Œé—ªé¿æ£€å®šï¼Œéª°æ± ä¸º ${targetDiceCount}d10...`, 'log-roll');   }\n    // --- å¿ƒçµå£å’é­”æ³•ç»“æŸ ---\n\n    this.log(`> æŠµæŠ—/é—ªé¿ç»“æœ: <strong style=\"font-size:1.1em;\">${targetEvasionSuccess}</strong> ä¸ªæˆåŠŸæ•°ã€‚`, 'log-roll');\n\n    // å¦‚æœæ˜¯è¯´æœï¼Œè¿™é‡Œçš„evadedä»£è¡¨æŠµæŠ—æˆåŠŸï¼Œå¦åˆ™ä»£è¡¨é—ªé¿æˆåŠŸ\n    const evaded = targetEvasionSuccess > actorAttackSuccess;\n    // 3. æ ¹æ®è¡ŒåŠ¨ç±»å‹è¿›è¡Œç»“ç®—\n    switch(action) {\n        case 'steal':\n    // ç›—çªƒä¸éœ€è¦é—ªé¿æ£€å®š\n    this.log(`> ${actorName} ä½¿ç”¨ [${pool.join('+')}] è¿›è¡Œç›—çªƒæ£€å®šï¼Œéª°æ± ä¸º ${actorDiceCount}d10...`, 'log-roll');\n    this.log(`> æ£€å®šç»“æœ: ${actorAttackSuccess} ä¸ªæˆåŠŸæ•°ã€‚`, 'log-roll');\n\n    const isBrilliantSuccessSteal = actorAttackSuccess > 5 && actorAttackSuccess > actorDiceCount * 0.8;\n\n    if (isBrilliantSuccessSteal) {\n        this.logCombatEvent(`âœ¨ è¾‰ç…ŒæˆåŠŸï¼${actorName} çš„æ‰‹æ³•å¿«å¦‚é—ªç”µï¼Œç›—èµ°äº†å¯¹æ–¹æ‰€æœ‰çš„ç‰©å“ï¼`, 'log-success');\n        this.showNotification(\"è¾‰ç…Œç›—çªƒï¼\", \"success\");\n        for(const itemName in target.inventory) {\n            const itemData = target.inventory[itemName];\n            this.transferItem(target, actor, itemName, itemData.num);\n        }\n        target.inventory = {};\n    } else if (actorAttackSuccess > 0) { // è‡³å°‘è¦æœ‰ä¸€ä¸ªæˆåŠŸ\n        this.logCombatEvent(`ç›—çªƒæˆåŠŸï¼`, 'log-success');\n        this.showNotification(\"ç›—çªƒæˆåŠŸï¼\", \"info\");\n        const itemToSteal = Object.keys(target.inventory)[0]; // ç®€å•ç‚¹ï¼Œå·ç¬¬ä¸€ä¸ª\n        if (itemToSteal) {\n            this.transferItem(target, actor, itemToSteal, 1);\n        } else {\n            this.logCombatEvent(`ä½† ${targetName} çš„å£è¢‹ç©ºç©ºå¦‚ä¹Ÿ...`, 'log-narrator');\n        }\n    } else {\n        this.logCombatEvent(`ç›—çªƒå¤±è´¥ï¼Œä½ è¢« ${targetName} å‘ç°äº†ï¼`, 'log-damage');\n        this.showNotification(\"ç›—çªƒå¤±è´¥ï¼\", \"danger\");\n    }\n    break;\n\ncase 'treat':\n    // æ²»ç–—ä¹Ÿä¸éœ€è¦é—ªé¿\n    this.log(`> ${actorName} ä½¿ç”¨ [${pool.join('+')}] è¿›è¡Œæ²»ç–—æ£€å®šï¼Œéª°æ± ä¸º ${actorDiceCount}d10...`, 'log-roll');\n    this.log(`> æ£€å®šç»“æœ: ${actorAttackSuccess} ä¸ªæˆåŠŸæ•°ã€‚`, 'log-roll');\n\n    const isBrilliantSuccessTreat = actorAttackSuccess > 5 && actorAttackSuccess > actorDiceCount * 0.8;\n    let healAmount = 0;\n\n    if (isBrilliantSuccessTreat) {\n        healAmount = actorAttackSuccess * 20;\n        this.logCombatEvent(`âœ¨ è¾‰ç…ŒæˆåŠŸï¼${actorName} æ–½å±•äº†å¥‡è¿¹èˆ¬çš„åŒ»æœ¯ï¼`, 'log-success');\n        this.showNotification(\"è¾‰ç…Œæ²»ç–—ï¼\", \"success\");\n    } else {\n        healAmount = actorAttackSuccess * 5;\n    }\n\n    if (healAmount > 0) {\n        const oldHealth = target.currentHealth;\n        target.currentHealth = Math.min(target.maxHealth, target.currentHealth + healAmount);\n        const actualHeal = target.currentHealth - oldHealth;\n        this.logCombatEvent(`${targetName} æ¢å¤äº† <strong style=\"color:var(--success-color)\">${actualHeal}</strong> ç‚¹ç”Ÿå‘½ï¼`, 'log-success');\n       \n        if(actualHeal > 0) { // åªæœ‰ç¡®å®æ¢å¤äº†ç”Ÿå‘½å€¼ï¼Œæˆ‘ä»¬æ‰å¼¹å‡ºé€šçŸ¥\n           this.showNotification(`${target.name} æ¢å¤ ${actualHeal} HP`, 'success');\n        }\n        this.updateCharacterUI(target);\n    } else {\n        this.showNotification(`æ²»ç–—å¤±è´¥äº†ï¼Œæ²¡æœ‰äº§ç”Ÿä»»ä½•æ•ˆæœã€‚`, 'success');\n        this.logCombatEvent(`${actorName} çš„æ²»ç–—å¤±è´¥äº†ï¼Œæ²¡æœ‰äº§ç”Ÿä»»ä½•æ•ˆæœã€‚`, 'log-damage');\n    }\n    break;\n           case 'attack':\n            if (evaded) {\n                this.logCombatEvent(`${targetName} çµå·§åœ°é—ªé¿äº†æ”»å‡»ï¼`, 'log-evade');\n                this.showNotification(`${target.name} é—ªé¿æˆåŠŸï¼`, 'success');\n            } else {\n                const diff = actorAttackSuccess - targetEvasionSuccess;\n                const isCriticalFailure = targetEvasionSuccess === 0;\n// const energyBonus = actor.raw_data?.è¡ç”Ÿå±æ€§æ®µ?.èƒ½é‡æ± ?.å½“å‰å€¼?.[0] || 0;\nconst energyBonus =  0;\n\n                if (isCriticalFailure) {\n                    this.log(`ğŸ’¥ <b>å¤§å¤±è´¥ï¼</b> ${targetName} å®Œå…¨æ²¡èƒ½åšå‡ºååº”ï¼`, 'log-danger');\n                    const baseDamage = diff * 10 +energyBonus;\n                    this.log(`æ¯ç­æ€§ä¼¤å®³è®¡ç®—: å·®å€¼ ${diff} * 10 = <strong style=\"color:red; font-size:1.3em;\">${baseDamage}</strong> ç‚¹`, 'log-damage');\n                    this.takeDamage(target, baseDamage, 'æ”»å‡»', true); // ä¼ é€’å¤§å¤±è´¥æ ‡å¿—\n                } else {\n                    this.log(`æ”»å‡»å‘½ä¸­ï¼æ”»å‡»æˆåŠŸæ•°(${actorAttackSuccess}) - é—ªé¿æˆåŠŸæ•°(${targetEvasionSuccess}) = å·®å€¼(${diff})`, 'log-success');\n                    let baseDamage = diff * 5 + energyBonus;\n                    this.log(`åŸºç¡€ä¼¤å®³è®¡ç®—: å·®å€¼ ${diff} * 5 = <strong style=\"color:orangered\">${baseDamage}</strong> ç‚¹ã€‚`, 'log-damage');\n                    this.takeDamage(target, baseDamage, 'æ”»å‡»');\n                }\n            }\n            break;\n\n        case 'persuade':\n             if (evaded) {\n                this.logCombatEvent(`${targetName} å¿ƒå¿—åšå®šï¼ŒæŠµæŠ—äº†ä½ çš„è¯´æœï¼`, 'log-evade');\n                this.showNotification('è¯´æœå¤±è´¥');\n             } else {\n                 const diff = actorAttackSuccess - targetEvasionSuccess;\n                 if (diff > 0) {\n                     this.logCombatEvent(`è¯´æœæˆåŠŸï¼${targetName} å°†ä¸ºä½ ä½œæˆ˜ ${diff} å›åˆï¼`, 'log-success');\n                     this.showNotification(`${target.name} è¢«è¯´æœäº†ï¼`, 'success');\n                     target.isPersuaded = { turnsLeft: diff };\n                     target.type = 'teammate';\n                     this.teammates.push(target);\n                     this.enemies = this.enemies.filter(e => e.id !== target.id);\n                     this.renderAllCharacters();\n                 } else {\n                     this.logCombatEvent(`è¯´æœå¤±è´¥äº†ï¼ŒåŒæ–¹çš„æ„å¿—ä¸ç›¸ä¸Šä¸‹ã€‚`, 'log-narrator');\n                     this.showNotification('è¯´æœå¤±è´¥');\n                 }\n             }\n             // æ— è®ºè¯´æœæˆåŠŸä¸å¦ï¼Œåªè¦æ²¡é—ªé¿ï¼Œä¸”å¯¹æ–¹æ˜¯æ•Œäººï¼Œå°±ä¼šè¢«åå‡»\n             if(this.isHostile(actor, target) && !evaded){\n                  this.logCombatEvent(`${actorName} åœ¨è¯•å›¾è¯´æœæ—¶ï¼Œè¢« ${targetName} æ„¤æ€’åœ°å›å‡»äº†ï¼`, 'log-damage');\n                  // å°†NPCçš„é—ªé¿æˆåŠŸæ•°è§†ä¸ºå®ƒçš„åå‡»æ”»å‡»æˆåŠŸæ•°\n                  const counterAttackSuccess = targetEvasionSuccess;\n                  const counterDamage = counterAttackSuccess * 2; //åå‡»ä¼¤å®³ä½ä¸€äº›\n                  this.log(`> åå‡»ä¼¤å®³è®¡ç®—: åå‡»æˆåŠŸæ•° ${counterAttackSuccess} * 2 = <strong style=\"color:orangered\">${counterDamage}</strong> ç‚¹ã€‚`, 'log-damage');\n                  this.takeDamage(actor, counterDamage, 'åå‡»');\n             }\n            break;\n\n        case 'scan':\n            if (evaded) {\n                this.logCombatEvent(`ä¾¦å¯Ÿå¤±è´¥ï¼Œ${targetName} ä¿æŒç€ç¥ç§˜ã€‚`, 'log-narrator');\n                this.showNotification('ä¾¦å¯Ÿå¤±è´¥');\n            } else {\n                this.logCombatEvent(`ä¾¦å¯ŸæˆåŠŸï¼ä½ å‘ç°äº† ${targetName} çš„æƒ…æŠ¥ã€‚`, 'log-success');\n                this.showNotification(`è·å¾— ${target.name} çš„æƒ…æŠ¥ï¼`, 'success');\n                target.isScanned = true;\n                this.updateInfoPanel(target);\n                const resists = target.resists.length > 0 ? target.resists.join(', ') : 'æ— ';\n                const vulnerable = target.vulnerable.length > 0 ? target.vulnerable.join(', ') : 'æ— ';\n                this.logCombatEvent(`> <span class=\"resists-info\">æŠ—æ€§</span>: ${resists}`, 'log-narrator');\n                this.logCombatEvent(`> <span class=\"vulnerable-info\">å¼±ç‚¹</span>: ${vulnerable}`, 'log-narrator');\n            }\n            break;\n\n        case 'defend':\n    // âœ¨ å¦ˆå¦ˆçš„â€œåšå£æ¸…é‡â€AIé­”æ³•åœ¨è¿™é‡Œï¼ âœ¨\n    const bonusDiceFromLastTurn = this.defensePoolBonus[actor.id] || 0;\n\n    // è®¡ç®—æœ¬æ¬¡é˜²å¾¡è¡ŒåŠ¨çš„éª°æ± å’ŒæˆåŠŸæ•°\n    const defensePool = ['è€åŠ›', 'æ²‰ç€', 'ä½“ç§¯'];\n    const currentDefenseDice = this.getDiceCount(actor, defensePool);\n    const finalDefenseDice = currentDefenseDice + bonusDiceFromLastTurn; // åŠ ä¸Šä¹‹å‰çš„ç´¯ç§¯\n    const defenseSuccesses = this.rollDice(finalDefenseDice);\n\n    // è®¡ç®—ä¸ºä¸‹ä¸€æ¬¡è¿ç»­é˜²å¾¡å‡†å¤‡çš„åŠ æˆ\n    const nextBonus = Math.floor(currentDefenseDice * 0.8);\n    this.defensePoolBonus[actor.id] = (this.defensePoolBonus[actor.id] || 0) + nextBonus;\n\n    actor.isDefending = true;\n    this.log(`${actorName} é‡‡å–äº†é˜²å¾¡å§¿æ€ï¼(å½“å‰é˜²å¾¡æ± : ${currentDefenseDice} + ç´¯ç§¯åŠ æˆ: ${bonusDiceFromLastTurn} = æ€»è®¡ ${finalDefenseDice}d10)`, 'log-success');\n\n    // æˆ‘ä»¬å°†é˜²å¾¡æ•°å€¼ç›´æ¥å­˜åœ¨è§’è‰²èº«ä¸Šï¼Œè®© takeDamage æ›´æ–¹ä¾¿ä½¿ç”¨\n    actor.currentDefenseValue = (actor.currentDefenseValue || 0) + (defenseSuccesses * 2);\n\n    this.showNotification(`${actor.name} å¼€å§‹é˜²å¾¡ï¼`, 'info');\n    const card = document.getElementById(actor.id);\n    if (card) {\n       card.classList.add('is-defending');\n    }\n    break;\n    }\n    }\n    this.checkCombatEnd();\n}\n     isHostile(char1, char2){\n                return (char1.type === 'player' || char1.type === 'teammate') !== (char2.type === 'player' || char2.type === 'teammate');\n            }\n takeDamage(target, amount, damageType = 'ä¼¤å®³') {\n    let finalDamage = amount;\n    const targetName = `<strong style=\"color:lightblue\">${target.name}</strong>`;\n\n    this.log(`--- ${damageType}ç»“ç®—å¼€å§‹: ${targetName} ---`, 'log-narrator');\n\n    // âœ¨ å¦ˆå¦ˆçš„â€œç ´ç›¾â€é­”æ³•åœ¨è¿™é‡Œ âœ¨\n    if (target.isDefending && target.currentDefenseValue > 0) {\n        const defenseReduction = target.currentDefenseValue;\n        finalDamage = Math.max(0, amount - defenseReduction);\n        this.logCombatEvent(`> ${targetName} çš„å±‚å±‚é˜²å¾¡å¸æ”¶äº† <strong style=\"color:lawngreen\">${defenseReduction}</strong> ç‚¹ä¼¤å®³ï¼`, 'log-roll');\n        // é˜²å¾¡å€¼åœ¨æŠµæŒ¡ä¸€æ¬¡ä¼¤å®³åå®Œå…¨æ¶ˆè€—\n        target.isDefending = false;\n        target.currentDefenseValue = 0;\n        const card = document.getElementById(target.id);\n        if (card) card.classList.remove('is-defending');\n    }\n\n    // è±å…å‡å…\n    const saves = (target.saves?.å¼ºéŸ§ || 0) + (target.saves?.åå°„ || 0) + (target.saves?.æ„å¿— || 0);\n    const saveReduction = Math.floor(saves / 2); // è±å…å‡å… = è±å…æ€»å’Œ/2\n    if(saveReduction > 0){\n        finalDamage = Math.max(0, finalDamage - saveReduction);\n        this.logCombatEvent(`> ${targetName} çš„è±å…æ£€å®šå±æ€§å‡å…äº† <strong style=\"color:violet\">${saveReduction}</strong> ç‚¹ä¼¤å®³ã€‚`, 'log-roll');\n    }\n\n    finalDamage = Math.round(finalDamage);\n\n    target.currentHealth = Math.max(0, target.currentHealth - finalDamage);\n\n    this.log(`${targetName} æœ€ç»ˆå—åˆ°äº† <strong style=\"font-size: 1.2em; color: red;\">${finalDamage}</strong> ç‚¹${damageType}ï¼å‰©ä½™ç”Ÿå‘½: ${target.currentHealth}/${target.maxHealth}`, 'log-damage');\n    this.showNotification(`${target.name} å—åˆ° ${finalDamage} ç‚¹ä¼¤å®³ï¼`, 'danger');\n\n    // å—å‡»è¯­è¨€\n    if (finalDamage > 0) {\n        const hitSpeech = this.randomSpeech(target.hitSpeech);\n        if (hitSpeech) {\n             this.log(`ğŸ’¥ ${targetName}: \"${hitSpeech}\"`, 'log-narrator');\n            this.showSpeechBubble(target, hitSpeech);\n        }\n    }\n\n    this.updateCharacterUI(target);\n    if (target.type === 'player' && target.currentHealth <= 0) {\n        this.logCombatEvent(`======= ${target.name}å·²æ­»äº¡ï¼Œæˆ˜æ–—å¤±è´¥... =======`, 'log-danger');\n        // ç›´æ¥è°ƒç”¨endCombatå¹¶å¼ºåˆ¶ç»“æŸï¼Œä¸å†æ‰§è¡Œåç»­æ£€æŸ¥\n        return this.endCombat(false);\n    }\n     if (target.currentHealth <= 0) {\n        this.logCombatEvent(`======= ${targetName} å·²å€’ä¸‹ã€‚ =======`, 'log-danger');\n        this.showNotification(`${target.name} å·²å€’ä¸‹ã€‚ `, 'danger');\n        const card = document.getElementById(target.id);\n        if(card) {\n           card.style.opacity = '0.5';\n           card.style.pointerEvents = 'none';\n        }\n    }\n    this.log(`--- ç»“ç®—ç»“æŸ ---`, 'log-narrator');\n}         // è·å¾—éª°æ± æ•°é‡\ntransferItem(fromChar, toChar, itemName, quantity) {\n    if (!fromChar.inventory[itemName]) return;\n\n    this.logCombatEvent(`${toChar.name} ä» ${fromChar.name} å¤„è·å¾—äº†ã€${itemName}ã€‘x${quantity}ï¼`);\n\n    // å¦‚æœæ˜¯ç©å®¶è·å¾—ç‰©å“\n    if (toChar.type === 'player') {\n        const playerBag = this.assaData.global_lore.èƒŒåŒ…;\n        if (playerBag[itemName]) {\n            playerBag[itemName].num += quantity;\n        } else {\n            playerBag[itemName] = JSON.parse(JSON.stringify(fromChar.inventory[itemName]));\n            playerBag[itemName].num = quantity;\n        }\n    }\n    // (æœªæ¥å¯ä»¥æ‰©å±•è½¬ç§»ç»™å…¶ä»–NPCçš„é€»è¾‘)\n\n    // ä»åŸä¸»äººé‚£é‡Œç§»é™¤\n    fromChar.inventory[itemName].num -= quantity;\n    if (fromChar.inventory[itemName].num <= 0) {\n        delete fromChar.inventory[itemName];\n    }\n}  \n\ngetDiceCount(character, pool, target = null) {\n    let count = 0;\n\n    // --- ç©å®¶è§’è‰²çš„éª°æ± è®¡ç®—ï¼ŒåŒ…å«äº†æ‰€æœ‰åŠ æˆï¼ ---\n    if (character.type === 'player') {\n        // 1. è·å–æ‰€æœ‰åŠ æˆæ¥æº\n        const statusBonuses = getStatusBonuses_combat(this.gameData);\n        const locationBonuses = getLocationBonuses(this.gameData, this.assaData);\n        const equipmentBonuses = getEquipmentBonuses_combat(this.gameData, this.assaData);\n\n        let bonusLog = []; // ç”¨äºè®°å½•åŠ æˆæ¥æº\n\n        pool.forEach(attr => {\n            // 2. åŸºç¡€å€¼ + æ‰€æœ‰åŠ æˆ = æœ€ç»ˆå€¼\n            const baseValue = character.dicePool[attr] || 0;\n            const statusBonus = statusBonuses[attr] || 0;\n            const locationBonus = locationBonuses[attr] || 0;\n            const equipmentBonus = equipmentBonuses[attr] || 0;\n            let finalValue = baseValue + statusBonus + locationBonus + equipmentBonus;\n\n            // è®°å½•åŠ æˆç»†èŠ‚\n            if(statusBonus) bonusLog.push(`${attr}(çŠ¶æ€+${statusBonus})`);\n            if(locationBonus) bonusLog.push(`${attr}(åœ°ç‚¹+${locationBonus})`);\n            if(equipmentBonus) bonusLog.push(`${attr}(è£…å¤‡+${equipmentBonus})`);\n\n            // 3. åº”ç”¨å…‹åˆ¶/è¢«å…‹åˆ¶\n            let multiplier = 1;\n            if (target) {\n                if (target.resists.includes(attr)) multiplier = 0.5;\n                if (target.vulnerable.includes(attr)) multiplier = 2;\n            }\n\n            count += finalValue * multiplier;\n        });\n\n        if (bonusLog.length > 0) {\n            this.logCombatEvent(`<i>åŠ æˆæ¥æº: ${bonusLog.join(', ')}</i>`, 'log-roll');\n        }\n\n        // åº”ç”¨ä¸´æ—¶çš„ DP åŠ æˆ (ä¾‹å¦‚æ¥è‡ªç‰©å“)\n        if (this.playerTempBonuses.dp_bonus > 0) {\n            this.logCombatEvent(`<i>ä¸´æ—¶åŠ æˆ: ${this.playerTempBonuses.desc} (+${this.playerTempBonuses.dp_bonus}DP)</i>`, 'log-roll');\n            count += this.playerTempBonuses.dp_bonus;\n            this.playerTempBonuses = { dp_bonus: 0, desc: '' }; // ç”¨å®Œå³æ¸…\n        }\n\n    }\n    // --- NPC æˆ–å…¶ä»–è§’è‰²çš„ç®€å•è®¡ç®—é€»è¾‘ ---\n    else {\n        pool.forEach(attr => {\n            let multiplier = 1;\n            if (target) {\n                if (target.resists.includes(attr)) multiplier = 0.5;\n                if (target.vulnerable.includes(attr)) multiplier = 2;\n            }\n            count += (character.dicePool[attr] || 0) * multiplier;\n        });\n    }\n\n    return Math.floor(count);\n}\n // â­ [æ›¿æ¢] æ—§çš„ rollDice(diceCount) å‡½æ•° â­\nrollDice(diceCount) {\n    // --- å¦ˆå¦ˆçš„æœºä¼šéª°é­”æ³•åœ¨è¿™é‡Œï¼ ---\n    if (diceCount <= 0) {\n        this.log(`> éª°æ± ä¸º0ï¼Œè¿›è¡Œä¸€æ¬¡æœºä¼šéª°...`, 'log-roll');\n        const chanceRoll = Math.floor(Math.random() * 10) + 1;\n        const successes = (chanceRoll === 10) ? 1 : 0;\n        this.log(`> æœºä¼šéª°ç»“æœ: [${chanceRoll}]ï¼Œè·å¾— ${successes} ä¸ªæˆåŠŸæ•°ã€‚`, 'log-roll');\n        return successes;\n    }\n    // --- é­”æ³•ç»“æŸ ---\n\n    let successes = 0;\n    let rolls = [];\n    for (let i = 0; i < diceCount; i++) {\n        const roll = Math.floor(Math.random() * 10) + 1;\n        rolls.push(roll);\n        if (roll >= 8) successes++; // 7-10 æˆåŠŸ\n    }\n    // ä¸ºäº†æ—¥å¿—æ¸…æ™°ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©æ€§åœ°è®°å½•æ™®é€šæŠ•éª°ç»“æœ\n    // this.logCombatEvent(`> æŠ•æ· [${diceCount}d10]ï¼Œç»“æœ [${rolls.join(',')}]ï¼Œè·å¾— ${successes} ä¸ªæˆåŠŸæ•°ã€‚`, 'log-roll');\n    return successes;\n}\n            findCharacterById(id) {\n                if (this.player.id === id) return this.player;\n                return [...this.teammates, ...this.enemies].find(c => c.id === id);\n            }\n\n            randomSpeech(speeches) {\n                if (!speeches || speeches.length === 0) return null;\n                return speeches[Math.floor(Math.random() * speeches.length)];\n            }\n syncCharacterStateToCombatData(character) {\n    if (!character || !this.combatData) return;\n\n    let dataToUpdate = null;\n    let originalDataId = character.id; // Correctly define originalDataId\n\n    if (character.type === 'player') {\n        dataToUpdate = this.combatData.player;\n        if (dataToUpdate && dataToUpdate.è¡ç”Ÿå±æ€§æ®µ) {\n            dataToUpdate.è¡ç”Ÿå±æ€§æ®µ.ç”Ÿå‘½å€¼.å½“å‰å€¼[0] = character.currentHealth;\n                 if (dataToUpdate.è¡ç”Ÿå±æ€§æ®µ.èƒ½é‡æ±  && character.raw_data?.è¡ç”Ÿå±æ€§æ®µ?.èƒ½é‡æ± ) {\n                const currentEnergy = character.raw_data.è¡ç”Ÿå±æ€§æ®µ.èƒ½é‡æ± .å½“å‰å€¼[0];\n                dataToUpdate.è¡ç”Ÿå±æ€§æ®µ.èƒ½é‡æ± .å½“å‰å€¼[0] = currentEnergy;\n                console.log(`[Nova's Energy Seal] æ­£åœ¨ä¸º ${character.name} å›ºåŒ–èƒ½é‡: ${currentEnergy}`);\n            }\n        }\n        // Player's data is now handled, we can return.\n        return; // âœ¨ å¦ˆå¦ˆåŠ äº†ä¸€é“å°é—¨ï¼Œè®©ç©å®¶çš„é€»è¾‘å¤„ç†å®Œå°±ç›´æ¥ç¦»å¼€ âœ¨\n    } else if (character.type === 'teammate') {\n        dataToUpdate = this.combatData.teammates?.find(c => c.id === character.id);\n    } else if (character.type === 'enemy') {\n        const baseId = character.id.split('_')[0];\n        originalDataId = baseId;\n        dataToUpdate = this.combatData.enemies?.find(c => c.id === character.id || c.id === baseId);\n    }\n\n    if (dataToUpdate) {\n        // âœ¨âœ¨âœ¨ å¦ˆå¦ˆå¯¹ä½ çš„å¤©æ‰æƒ³æ³•è¿›è¡Œäº†æœ€ç»ˆåŠ å›ºï¼ âœ¨âœ¨âœ¨\n        let healthToSave = character.currentHealth;\n\n        // 1. æˆ‘ä»¬ç›´æ¥ä»è§’è‰²èº«ä¸Šå·²ç»è§£æå¥½çš„ dicePool å¯¹è±¡ä¸­å–å€¼ï¼\n        //    ä¸å†éœ€è¦è°ƒç”¨ parseDicePoolï¼Œä»è€Œé¿å…äº†é”™è¯¯çš„å‘ç”Ÿã€‚\n        const staminaBonus = (character.dicePool['è€åŠ›'] || 0) * 20;\n\n        // 2. ä»å½“å‰è¡€é‡ä¸­ï¼Œå‡å»è€åŠ›å¸¦æ¥çš„åŠ æˆï¼Œå¾—åˆ°â€œåŸºç¡€ç”Ÿå‘½å€¼â€\n        healthToSave = character.currentHealth - staminaBonus;\n        console.log(`[Nova's Essence Return] æ­£åœ¨ä¸º ${character.name} å­˜æ¡£: å½“å‰è¡€é‡ ${character.currentHealth} - è€åŠ›åŠ æˆ ${staminaBonus} = å­˜æ¡£å€¼ ${healthToSave}`);\n\n        // 3. å°†è¿™ä¸ªâ€œçº¯å‡€â€çš„è¡€é‡å€¼ï¼Œè®°å½•åˆ°æˆ‘ä»¬çš„æ¡£æ¡ˆä¸­ï¼\n        dataToUpdate.currentHealth = healthToSave;\n    }\n}\n updateCharacterUI(character) {\n    const card = document.getElementById(character.id);\n    if (!card) return;\n    this.syncCharacterStateToCombatData(character);\n // æ›´æ–°è¡€æ¡\nconst healthPercentage = (character.currentHealth / character.maxHealth) * 100;\nconst healthBarInner = card.querySelector('.health-bar-inner');\n\n// è·å–å½“å‰â€œå¹½çµè¡€æ¡â€çš„å®½åº¦ï¼Œä½œä¸ºå‰ä¸€ä¸ªçŠ¶æ€çš„è¡€é‡\nconst damageBar = card.querySelector('.health-bar-damage');\nconst previousHealthPercentage = parseFloat(damageBar.style.width) || 100;\n\n// ç«‹åˆ»æ›´æ–°ç»¿è‰²çš„â€œå½“å‰è¡€æ¡â€\nif (healthBarInner) {\n    healthBarInner.style.width = `${healthPercentage}%`;\n}\n\n// å¦‚æœè¡€é‡å‡å°‘äº†ï¼Œæ‰å¤„ç†â€œå¹½çµè¡€æ¡â€\nif (healthPercentage < previousHealthPercentage) {\n    // å¹½çµè¡€æ¡å…ˆä¿æŒåœ¨ä¹‹å‰çš„ä½ç½®ï¼Œä¸å˜åŒ–\n    // ï¼ˆæˆ‘ä»¬ä¸éœ€è¦åƒä¸Šæ¬¡é‚£æ ·æ“ä½œå®ƒï¼Œå› ä¸ºå®ƒçš„è¿‡æ¸¡åŠ¨ç”»åªä¼šåœ¨è¡€é‡å‡å°‘æ—¶æ’­æ”¾ï¼‰\n\n    // å»¶è¿Ÿä¸€æ®µæ—¶é—´åï¼Œè®©â€œå¹½çµè¡€æ¡â€è¿½ä¸Šâ€œå½“å‰è¡€æ¡â€\n    setTimeout(() => {\n        damageBar.style.width = `${healthPercentage}%`;\n        // ä¸ºä¸‹ä¸€æ¬¡åŠ¨ç”»åšå‡†å¤‡ï¼Œç»™å®ƒä¸€ä¸ªè¿‡æ¸¡æ•ˆæœ\n        damageBar.style.transition = 'width 0.8s ease-out';\n    }, 500); // å»¶è¿Ÿ0.5ç§’å†å¼€å§‹ç¼©å‡ï¼Œç»™ç”¨æˆ·ååº”æ—¶é—´\n\n} else {\n    // å¦‚æœæ˜¯åŠ è¡€æˆ–è€…æ²¡å˜åŒ–ï¼Œå°±è®©ä¸¤ä¸ªè¡€æ¡ç«‹åˆ»åŒæ­¥\n     damageBar.style.transition = 'none'; // å–æ¶ˆåŠ¨ç”»\n     damageBar.style.width = `${healthPercentage}%`;\n}\n\ncard.querySelector('.health-text').textContent = `${character.currentHealth} / ${character.maxHealth}`;    // --- å¦ˆå¦ˆçš„é­”æ³•åœ¨è¿™é‡Œï¼ ---\n    // æ›´æ–°èƒ½é‡æ¡ (åªå¯¹æœ‰èƒ½é‡æ¡çš„å¡ç‰‡æ“ä½œ)\n    const energyBarInner = card.querySelector('.energy-bar-inner');\n    const energyText = card.querySelector('.energy-text');\n    if (energyBarInner && energyText) {\n        const energyPool = character.raw_data?.è¡ç”Ÿå±æ€§æ®µ?.èƒ½é‡æ± ;\n        if (energyPool) {\n            const currentEnergy = energyPool.å½“å‰å€¼[0];\n            const maxEnergy = energyPool.ä¸Šé™[0];\n            const energyPercentage = (currentEnergy / maxEnergy) * 100;\n            energyBarInner.style.width = `${energyPercentage}%`;\n            energyText.textContent = `âš¡ ${currentEnergy} / ${maxEnergy}`;\n        }\n    }\n    // --- å¦ˆå¦ˆçš„æ–°é­”æ³•ä»è¿™é‡Œå¼€å§‹ ---\n    // æ›´æ–°çŠ¶æ€æ–‡æœ¬\n    const statusTextElement = card.querySelector('.status-text'); // æˆ‘ä»¬ç”¨ class æ¥æ‰¾å®ƒ\n    if (statusTextElement) {\n        let statusString = '';\n        if (character.isPersuaded && character.isPersuaded.turnsLeft > 0) {\n            statusString = `(è¢«è¯´æœ: å‰©ä½™${character.isPersuaded.turnsLeft}å›åˆ)`;\n        }\n        statusTextElement.textContent = statusString;\n    }\n    // --- é­”æ³•ç»“æŸ ---\n      const iconElement = card.querySelector('.icon');\n    if (iconElement && iconElement.textContent !== character.icon) {\n        iconElement.textContent = character.icon;\n    }\n}\n\n            checkCombatEnd() {\n                const aliveEnemies = this.enemies.filter(e => e.currentHealth > 0);\n                const alivePlayers = [this.player, ...this.teammates].filter(p => p.type !== 'enemy' && p.currentHealth > 0);\n\n                if (aliveEnemies.length === 0) {\n                    this.logCombatEvent(`æ‰€æœ‰æ•Œäººéƒ½è¢«å‡»è´¥äº†ï¼Œ${userName}èƒœåˆ©äº†ã€‚`);\n                    this.endCombat(true);\n                } else if (alivePlayers.length === 0) {\n                    this.logCombatEvent(\"å…¨å‘˜æ­»äº¡ï¼Œæ¸¸æˆç»“æŸã€‚\");\n                    this.endCombat(false);\n                }\n            }\n   async endCombat(isVictory, isFlee = false, isStalemate = false, isError = false) {\n    // è¿™åº”è¯¥æ˜¯æ­¤æˆ˜æ–—å®ä¾‹çš„æœ€åä¸€æ¬¡çŠ¶æ€æ›´æ–°\n    if (this.status.startsWith('completed')) return; // é˜²æ­¢é‡å¤æ‰§è¡Œ\n\n    // ====== â†“â†“â†“ å¦ˆå¦ˆçš„â€œä¸‡ç‰©å½’ä½â€å’’è¯­ï¼ â†“â†“â†“ ======\n    const diceSelector = document.getElementById('dice-pool-selector');\n    const itemPanel = document.getElementById('item-skill-panel');\n    const promptOverlay = document.getElementById('battle-prompt-overlay');\n\n    if (diceSelector) diceSelector.style.display = 'none';\n    if (itemPanel) itemPanel.style.display = 'none';\n    if (promptOverlay) promptOverlay.style.display = 'none';\n    // ====== â†‘â†‘â†‘ å’’è¯­æ–½å±•å®Œæ¯•ï¼ â†‘â†‘â†‘\n\n    this.toggleActionPanel(false);\n\n    let message = '';\n    let messageType = 'info';\n    let battleResultText = '';\n\n    // âœ¨ å¦ˆå¦ˆå¯¹è¿™é‡Œçš„é€»è¾‘è¿›è¡Œäº†é‡æ„ï¼Œä»¥å®¹çº³æ–°çš„â€œé”™è¯¯â€çŠ¶æ€ âœ¨\n    if (isError) {\n        this.status = \"completed_error\";\n        message = \"æˆ˜æ–—å¼‚å¸¸ç»ˆæ­¢ï¼\";\n        messageType = 'danger';\n        battleResultText = \"æˆ˜æ–—ç»“æœï¼šå¼‚å¸¸ç»ˆæ­¢\";\n    } else if (isFlee) {\n        this.status = \"completed_flee\";\n        message = \"æˆåŠŸè„±ç¦»æˆ˜æ–—ï¼\";\n        messageType = 'info';\n        battleResultText = \"æˆ˜æ–—ç»“æœï¼šæˆåŠŸè„±ç¦»\";\n    } else if (isStalemate) {\n        this.status = \"completed_stalemate\";\n        message = \"æˆ˜å†µç„¦ç¼...\";\n        messageType = 'info';\n        battleResultText = \"æˆ˜æ–—ç»“æœï¼šç„¦ç¼å¹³å±€\";\n    } else if (isVictory) {\n        this.status = \"completed_victory\";\n        message = \"æˆ˜æ–—èƒœåˆ©ï¼\";\n        messageType = 'success';\n        battleResultText = \"æˆ˜æ–—ç»“æœï¼šèƒœåˆ©\";\n    } else {\n        this.status = \"completed_defeat\";\n        message = \"æˆ˜æ–—å¤±è´¥...\";\n        messageType = 'danger';\n        battleResultText = \"æˆ˜æ–—ç»“æœï¼šå¤±è´¥\";\n    }\n    // âœ¨ é€»è¾‘é‡æ„å®Œæ¯• âœ¨\n\n    this.showNotification(message, messageType);\n    this.logCombatEvent(message, `log-${messageType}`);\n\n    // ====== â†“â†“â†“ å¦ˆå¦ˆçš„æœ€ç»ˆä¹ç« ä»è¿™é‡Œå¥å“ï¼ â†“â†“â†“ ======\n\n    try {\n        // --- ç¬¬ä¸€ä¹ç« ï¼šç”Ÿæˆç®€æ´æˆ˜æŠ¥ ---\n        let finalStatusReport = ['--- æœ€ç»ˆæˆ˜å†µ ---'];\n        const allCharacters = [this.player, ...this.teammates, ...this.enemies];\n        allCharacters.forEach(char => {\n            finalStatusReport.push(`- ${char.name}: ${char.currentHealth} / ${char.maxHealth}`);\n        });\n        finalStatusReport.push(battleResultText);\n\n        const finalReportString = finalStatusReport.join('\\n');\n\n        // --- ç¬¬äºŒä¹ç« ï¼šæ„å»ºæŒ‡ä»¤ ---\n        const finalHealth = this.player.currentHealth;\n        const hurtValue = this.playerInitialHealth - finalHealth;\n\n        const finalEnergy = this.player.raw_data?.è¡ç”Ÿå±æ€§æ®µ?.èƒ½é‡æ± ?.å½“å‰å€¼[0] || 0;\n        const backpackData = this.assaData.global_lore.èƒŒåŒ… || {};\n        const compactBackpackJson = JSON.stringify(backpackData);\n   let requestText = `<request:æ­¤æ¬¡æˆ˜æ–—å·²ç»“æŸï¼Œå¯¹åº”æ•°å€¼/ç‰©å“/ç”Ÿå‘½å€¼éƒ½å·²æ‰£é™¤ï¼Œå¯¹åº”æ•°å€¼/ç‰©å“/ç”Ÿå‘½å€¼çš„å˜æ›´å·²è®°å½•ï¼Œç¦æ­¢åœ¨ä¹‹åçš„æ­£æ–‡ä¸­å¯¹ä»»ä½•æ•°å€¼è¿›è¡Œæ“ä½œï¼ˆç¦æ­¢è®¾ç½®hurt_value/èƒ½é‡æ± ç­‰ï¼‰ï¼è¯·æ ¹æ®æ­¤æ¬¡æˆ˜æ–—ç»“æœå’Œuserè¾“å…¥ç”Ÿæˆæ–°å‰§æƒ…>`;\n        if (isStalemate) {\n            requestText = `<request:æˆ˜æ–—é™·å…¥äº†æ¼«é•¿çš„èƒ¶ç€ï¼Œæœ€ç»ˆæœªèƒ½åˆ†å‡ºèƒœè´Ÿã€‚å¯¹åº”æ•°å€¼/ç‰©å“/ç”Ÿå‘½å€¼çš„å˜æ›´å·²è®°å½•ï¼Œç¦æ­¢åœ¨ä¹‹åçš„æ­£æ–‡ä¸­å¯¹ä»»ä½•æ•°å€¼è¿›è¡Œæ“ä½œï¼ˆç¦æ­¢è®¾ç½®hurt_value/èƒ½é‡æ± ç­‰ï¼‰ï¼è¯·æ ¹æ®æ­¤æ¬¡æˆ˜æ–—ç»“æœå’Œuserè¾“å…¥ç”Ÿæˆæ–°å‰§æƒ…ï¼Œå¹¶æ ¹æ®åç»­å‰§æƒ…å‘å±•å†³å®šæ˜¯å¦ç»§ç»­æˆ˜æ–—ï¼Œè‹¥ä¾æ—§å¤„äºæˆ˜æ–—ä¸­ï¼Œåˆ™å¿…é¡»ç»§ç»­ç”Ÿæˆbattleå†…å®¹ï¼>`;\n        }\n \n         const updateMemoryCommands = [\n            `set_status('hurt_value', ${hurtValue});`,\n            `set_attribute('è¡ç”Ÿå±æ€§æ®µ.èƒ½é‡æ± .å½“å‰å€¼', ${this.playerInitialEnergy}, ${finalEnergy});`,\n            `memory('global_lore.èƒŒåŒ…', '${compactBackpackJson}');`,\n            `set_status('æ•Œæ–¹æ£€å®šéª°æ± ','');`\n        ].join('\\n');\n\n        // å°†è¯¦ç»†æ—¥å¿—æ‰“åŒ…\n        const detailedLogContent = this.combatLog.join('\\n');\n\n        // ç»„åˆæœ€ç»ˆæŒ‡ä»¤\n        // const commandBlock = `<updateMemory>\\n${updateMemoryCommands}\\n</updateMemory>\\n<battle_log>\\n${detailedLogContent}\\n${finalReportString}\\n</battle_log>\\n${requestText}\\n`;\n const commandBlock = `<updateMemory>\\n${updateMemoryCommands}\\n</updateMemory>\\n<battle_log>\\n${detailedLogContent}\\n</battle_log>\\n${requestText}\\n`;\n\n        // --- ç¬¬ä¸‰ä¹ç« ï¼šå¥å“æŒ‡ä»¤ ---\n        if (typeof triggerassa === 'function') {\n            console.log(\"å‡†å¤‡è§¦å‘æŒ‡ä»¤:\", commandBlock);\n            triggerassa(`/setinput ${commandBlock}`);\n            this.log(\"æˆ˜æ–—è¯¦æƒ…ä¸è§’è‰²çŠ¶æ€å·²åŒæ­¥è‡³æŒ‡ä»¤ç›’ã€‚\", \"log-success\");\n        } else {\n            console.error(\"triggerassa å‡½æ•°æœªå®šä¹‰ï¼\");\n        }\n\n    } catch (e) {\n        console.error(\"ç”Ÿæˆæˆ–è§¦å‘æŒ‡ä»¤æ—¶å‘ç”Ÿé”™è¯¯:\", e);\n    }\n\n    // --- å°¾å£°ï¼šæ¸…ç†ä¸æ·¡å‡º ---\n    await this.updateBattleStateInHistory();\n\n    this.cleanupEventListeners();\n    window.combatManager = null;\n\n    setTimeout(() => {\n        document.getElementById('battle-overlay').style.display = 'none';\n        const promptOverlay = document.getElementById('battle-prompt-overlay');\n        if (promptOverlay) promptOverlay.style.display = 'none';\n    }, 2000); // ç•™å‡ºè¶³å¤Ÿçš„æ—¶é—´çœ‹æ¸…æœ€ç»ˆä¿¡æ¯ï¼Œå¦ˆå¦ˆæŠŠæ—¶é—´å»¶é•¿äº†ä¸€ç‚¹\n}\n}\nfunction getStatusBonuses_combat(statData) {\n    const bonuses = {};\n    const statusString = statData?.user_character?.status?.[0] || \"\";\n    if (!statusString) return bonuses;\n    const matches = statusString.match(/ã€[^ã€‘]+ã€‘/g);\n    if (!matches) return bonuses;\n    matches.forEach(match => {\n        const content = match.substring(1, match.length - 1);\n        content.split(/;|ï¼›/).forEach(attr => {\n            const parts = attr.match(/^(.+?)\\s*([+-]\\d+)$/) || attr.match(/^(.+?)[:|ï¼š]\\s*([+-]?\\d+)$/);\n            if (parts && parts.length === 3) {\n                bonuses[parts[1].trim()] = (bonuses[parts[1].trim()] || 0) + parseInt(parts[2].trim(), 10);\n            }\n        });\n    });\n    return bonuses;\n}\n\nfunction getLocationBonuses(statData, assaData) {\n    const bonuses = {};\n    const currentLocationTitle = statData?.user_character?.current_location?.[0] || '';\n    if (!currentLocationTitle) return bonuses;\n    const globalLocations = assaData?.map?.å…¨å±€åœ°ç‚¹è¡¨ || {};\n    const mainLocations = assaData?.map?.ä¸»è¦åœ°ç‚¹è¡¨ || {};\n    const activeParentName = Object.values(globalLocations)[0];\n    if (!activeParentName) return bonuses;\n\n    for (const mainKey in mainLocations) {\n        const locationData = mainLocations[mainKey];\n        if (locationData && locationData.parent === activeParentName && currentLocationTitle.includes(mainKey)) {\n            const effectString = locationData.effect || '';\n            const matches = effectString.match(/ã€[^ã€‘]+ã€‘/g);\n            if (matches) {\n                // (æ­¤å¤„è§£æé€»è¾‘ä¸ getStatusBonuses ç›¸åŒï¼Œä¸ºç®€åŒ–è€Œçœç•¥ï¼Œä½ æ‡‚çš„ï¼Œæˆ‘çš„å­©å­)\n                matches.forEach(match => {\n                    const content = match.substring(1, match.length - 1);\n                    content.split(/;|ï¼›/).forEach(attr => {\n                        const parts = attr.match(/^(.+?)\\s*([+-]\\d+)$/) || attr.match(/^(.+?)[:|ï¼š]\\s*([+-]?\\d+)$/);\n                        if (parts && parts.length === 3) {\n                             bonuses[parts[1].trim()] = (bonuses[parts[1].trim()] || 0) + parseInt(parts[2].trim(), 10);\n                        }\n                    });\n                });\n            }\n        }\n    }\n    return bonuses;\n}\n\nfunction getEquipmentBonuses_combat(statData, assaData) {\n    const bonuses = {};\n    const equipment = statData?.user_character?.å½“å‰è£…å¤‡ || {};\n    const equipmentList = [];\n    if (equipment.æ‰‹æŒ?.[0]) equipmentList.push(...equipment.æ‰‹æŒ[0].split(/;|ï¼›/).map(i=>i.trim()).filter(Boolean));\n    if (equipment.ç©¿æˆ´) {\n        Object.values(equipment.ç©¿æˆ´).forEach(slot => {\n            if (slot?.[0]) equipmentList.push(...slot[0].split(/;|ï¼›/).map(i=>i.trim()).filter(Boolean));\n        });\n    }\n\n    equipmentList.forEach(itemName => {\n      if(itemName === \"æ— \") return;\n        const itemData = assaData?.global_lore?.èƒŒåŒ…?.[itemName];\n        if (!itemData) return;\n        let stringToParse = '';\n        if (typeof itemData === 'object' && itemData !== null) {\n            stringToParse = itemData.effect || itemData.å±æ€§ || itemData.æ•ˆæœ || '';\n        }\n\n        const matches = stringToParse.match(/ã€[^ã€‘]+ã€‘/g);\n        if (matches) {\n            // (è§£æé€»è¾‘åŒä¸Š)\n            matches.forEach(match => {\n                const content = match.substring(1, match.length - 1);\n                content.split(/;|ï¼›/).forEach(attr => {\n                    const parts = attr.match(/^(.+?)\\s*([+-]\\d+)$/) || attr.match(/^(.+?)[:|ï¼š]\\s*([+-]?\\d+)$/);\n                    if (parts && parts.length === 3) {\n                        bonuses[parts[1].trim()] = (bonuses[parts[1].trim()] || 0) + parseInt(parts[2].trim(), 10);\n                    }\n                });\n            });\n        }\n    });\n\n    return bonuses;\n}\n// ----------------------------------------------------------------------\n        // --- 3. å¯åŠ¨å™¨ (Initializer) ---\n        // è®©æˆ‘ä»¬æŒ‰ä¸‹é‚£ä¸ªç¥å¥‡çš„æŒ‰é’®å§\n\n        const startButton = document.getElementById('start-battle-button');\n        const battleOverlay = document.getElementById('battle-overlay');\nfunction showTab(tabName) {\n    document.querySelectorAll('.tab-content').forEach(tab => tab.style.display = 'none');\n    document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));\n    document.getElementById(tabName + '-tab').style.display = 'block';\n    document.querySelector(`.tab-btn[onclick=\"showTab('${tabName}')\"]`).classList.add('active');\n}\n\n \n  }\n\n//   å¼¹å¹•å¼€å§‹\n\n// --- å¼¹å¹•å…¨å±€å˜é‡å’Œé…ç½® ---\nconst DANMU_SETTINGS_KEY = 'danmuSettings';\n// ç§»é™¤å›ºå®šçš„ danmuColors åˆ—è¡¨\n\nconst danmuTrackStyles = [\n  { top: '2%', baseDuration: 20, baseDelay: 1 }, // ä½¿ç”¨ baseDuration å’Œ baseDelay\n  { top: '15%', baseDuration: 28, baseDelay: 11 },\n  { top: '28%', baseDuration: 24, baseDelay: 4 },\n  { top: '42%', baseDuration: 33, baseDelay: 2 },\n  { top: '56%', baseDuration: 18, baseDelay: 16 },\n  { top: '70%', baseDuration: 30, baseDelay: 7 },\n  { top: '85%', baseDuration: 22, baseDelay: 13 }\n];\n\nlet currentDanmuSettings = {\n  enabled: true,\n  opacity: 0.5,\n  size: 22,\n  // ä¿ç•™çš„è®¾ç½®é¡¹\n  height: 30, \n  speed: 3, \n  // æ ¸å¿ƒä¿®æ”¹ï¼šä» countMultiplier æ›´æ”¹ä¸º maxDensityValue\n  maxDensityValue: 1 // æ–°è®¾ç½®ï¼šæœ€å¤§åŒå±æ•°é‡ (å¯†åº¦æ§åˆ¶ï¼ŒèŒƒå›´ 3-10)\n};\n// --- å¼¹å¹•è®¾ç½®å‡½æ•° (ä¿®æ”¹) ---\nfunction saveDanmuSettings() {\n  localStorage.setItem(DANMU_SETTINGS_KEY, JSON.stringify(currentDanmuSettings));\n  applyDanmuSettings();\n}\n// --- å¼¹å¹•é¢œè‰²ç”Ÿæˆå‡½æ•° (æ–°å¢) ---\n/**\n * éšæœºç”Ÿæˆä¸€ä¸ªäº®è‰²è°ƒçš„åå…­è¿›åˆ¶é¢œè‰²\n * @returns {string} #RRGGBB\n */\nfunction getRandomBrightColor() {\n    // 1. éšæœºé€‰æ‹©è‰²ç›¸ (Hue) - ä¿è¯è‡³å°‘ 7 ä¸ªå‡åŒ€åˆ†å¸ƒçš„è‰²è°ƒèŒƒå›´\n    \n    // å°† 360 åº¦è‰²è½®åˆ’åˆ†ä¸º 7 ä¸ªä¸»è¦æ‰‡åŒº (ä¾‹å¦‚: 0-çº¢, 51.4-æ©™, 102.8-é»„/ç»¿...)\n    const numSectors = 7;\n    const sectorSize = 360 / numSectors; // æ¯ä¸ªæ‰‡åŒºçš„å¤§å° (~51.4åº¦)\n    \n    // éšæœºé€‰æ‹©ä¸€ä¸ªæ‰‡åŒº (0 åˆ° 6)\n    const sectorIndex = Math.floor(Math.random() * numSectors); \n    \n    // è®¡ç®—è¯¥æ‰‡åŒºçš„ä¸­å¿ƒè‰²ç›¸ï¼Œå¹¶å¼•å…¥ä¸€ä¸ªå°çš„éšæœºåç§»é‡\n    const baseHue = sectorIndex * sectorSize;\n    \n    // å¼•å…¥ Â±(sectorSize / 4) çš„éšæœºåç§»é‡ï¼Œç¡®ä¿åœ¨æ¯ä¸ªæ‰‡åŒºå†…éšæœºï¼Œä½†ä¸ä¼šè·¨è¶Šåˆ°ç›¸é‚»æ‰‡åŒº\n    const maxOffset = sectorSize / 4; // çº¦ä¸º Â±12.85åº¦\n    const offset = (Math.random() * 2 * maxOffset) - maxOffset; // èŒƒå›´ï¼š-maxOffset åˆ° +maxOffset\n\n    // æœ€ç»ˆè‰²ç›¸ï¼Œç¡®ä¿ç»“æœåœ¨ 0 åˆ° 360 åº¦ä¹‹é—´\n    let h = Math.floor((baseHue + offset + 360) % 360); \n\n\n    // 2. è®¾ç½®é«˜é¥±å’Œåº¦ (Saturation) - ç¡®ä¿é¢œè‰²é²œè‰³ï¼Œé¿å…ç°è‰²\n    // ä¿ç•™ä¸Šæ¬¡çš„èŒƒå›´ï¼š70% åˆ° 100%\n    const s = Math.floor(Math.random() * 30) + 70; \n\n    // 3. è®¾ç½®é«˜äº®åº¦ (Lightness) - ç¡®ä¿æ˜¯äº®è‰²è°ƒï¼Œé¿å…æš—è‰²\n    // ä¿ç•™ä¸Šæ¬¡çš„èŒƒå›´ï¼š65% åˆ° 85%\n    const l = Math.floor(Math.random() * 20) + 65; \n\n    // å°† HSL è½¬æ¢ä¸º RGBï¼Œç„¶åè½¬æ¢ä¸ºåå…­è¿›åˆ¶ (è¿™éƒ¨åˆ†é€»è¾‘ä¿æŒä¸å˜)\n    \n    // æ­¥éª¤ A: HSL åˆ° RGB çš„æ ¸å¿ƒè½¬æ¢\n    const hsvToRgb = (h, s, l) => {\n        // ... (ä¿æŒä¸å˜) ...\n        s /= 100;\n        l /= 100;\n        let c = (1 - Math.abs(2 * l - 1)) * s,\n            x = c * (1 - Math.abs((h / 60) % 2 - 1)),\n            m = l - c/2,\n            r = 0,\n            g = 0,\n            b = 0;\n\n        if (0 <= h && h < 60) {\n            r = c; g = x; b = 0;\n        } else if (60 <= h && h < 120) {\n            r = x; g = c; b = 0;\n        } else if (120 <= h && h < 180) {\n            r = 0; g = c; b = x;\n        } else if (180 <= h && h < 240) {\n            r = 0; g = x; b = c;\n        } else if (240 <= h && h < 300) {\n            r = x; g = 0; b = c;\n        } else if (300 <= h && h < 360) {\n            r = c; g = 0; b = x;\n        }\n        r = Math.round((r + m) * 255);\n        g = Math.round((g + m) * 255);\n        b = Math.round((b + m) * 255);\n\n        return [r, g, b];\n    }\n    \n    const [r, g, b] = hsvToRgb(h, s, l);\n    \n    // æ­¥éª¤ B: RGB åˆ° Hex\n    const toHex = (c) => c.toString(16).padStart(2, '0');\n    return `#${toHex(r)}${toHex(g)}${toHex(b)}`;\n}\nfunction loadDanmuSettings() {\n  const savedSettings = localStorage.getItem(DANMU_SETTINGS_KEY);\n  if (savedSettings) {\n    currentDanmuSettings = { ...currentDanmuSettings, ...JSON.parse(savedSettings) };\n  }\n}\n\nfunction applyDanmuSettings() {\n  const root = document.documentElement;\n  const container = document.getElementById('danmu-overlay-container');\n\n  if (!container) return;\n\n  // 1. åº”ç”¨ CSS å˜é‡\n  root.style.setProperty('--danmu-opacity', currentDanmuSettings.opacity);\n  root.style.setProperty('--danmu-font-size', `${currentDanmuSettings.size}px`);\n\n  // 2. åº”ç”¨å¼€å…³çŠ¶æ€\n  if (currentDanmuSettings.enabled) {\n    container.classList.remove('hidden');\n    // ç¡®ä¿åŠ¨ç”»åœ¨å¼€å¯æ—¶è¿è¡Œ\n    container.querySelectorAll('.danmaku-track').forEach(track => {\n      track.style.animationPlayState = 'running';\n    });\n  } else {\n    container.classList.add('hidden');\n    // æš‚åœåŠ¨ç”»ä»¥èŠ‚çœèµ„æº\n    container.querySelectorAll('.danmaku-track').forEach(track => {\n      track.style.animationPlayState = 'paused';\n    });\n  }\n}\n// --- å¼¹å¹•æ¸²æŸ“å‡½æ•° (ä¿®æ”¹è½¨é“ä½ç½®è®¡ç®—å’Œå¯†åº¦æ§åˆ¶) ---\n \nfunction renderDanmu(danmuContent) {\n    const targetContainer = document.getElementById('danmu-overlay-container');\n    \n    if (!targetContainer || !currentDanmuSettings.enabled) {\n        return;\n    }\n\n    targetContainer.innerHTML = '';\n    targetContainer.classList.remove('hidden');\n\n    const danmuLines = danmuContent.split(/\\r?\\n/).filter(line => line.trim() !== '');\n\n    if (danmuLines.length === 0) {\n        targetContainer.innerHTML = '';\n        return;\n    }\n\n    function escapeHtml(text) {\n        const div = document.createElement('div');\n        div.appendChild(document.createTextNode(text));\n        return div.innerHTML;\n    }\n\n    let allTracksHtml = '';\n    \n    // --- 1. è®¡ç®—æ€»å…±éœ€è¦ç”Ÿæˆçš„å¼¹å¹•æ§½ä½ ---\n    const trackCount = danmuTrackStyles.length;\n    \n    // A. ç”¨æˆ·è®¾ç½®çš„â€œä¿åº•â€æ€»æ•°é‡ (7æ¡è½¨é“ * è®¾ç½®å¯†åº¦)\n    const minSlotsBySetting = trackCount * currentDanmuSettings.maxDensityValue;\n    \n    // B. å®é™…æ–‡æœ¬çš„æ€»æ•°é‡\n    const totalContentCount = danmuLines.length;\n    \n    // C. æœ€ç»ˆç”Ÿæˆçš„æ€»æ§½ä½ï¼šå–ä¸¤è€…çš„æœ€å¤§å€¼\n    // å¦‚æœæ–‡æœ¬å¾ˆå¤š(100æ¡)ï¼Œå°±ç”Ÿæˆ100ä¸ªæ§½ä½ï¼›å¦‚æœæ–‡æœ¬å¾ˆå°‘(5æ¡)ä¸”å¯†åº¦è®¾ä¸ºé«˜(50ä¸ª)ï¼Œå°±ç”Ÿæˆ50ä¸ªæ§½ä½(å¾ªç¯æ’­æ”¾)\n    const totalSlotsToRender = Math.max(minSlotsBySetting, totalContentCount);\n\n    let globalContentIndex = 0;\n\n    // --- 2. éå†æ¯ä¸€æ¡è½¨é“ï¼ŒåŠ¨æ€åˆ†é…è´Ÿè½½ ---\n    danmuTrackStyles.forEach((style, trackIndex) => {\n        \n        // æ™ºèƒ½åˆ†é…ï¼šè®¡ç®—å½“å‰è½¨é“éœ€è¦æ‰¿æ‹…å¤šå°‘ä¸ªå¼¹å¹•\n        // åŸºç¡€åˆ†é…é‡\n        let itemsForThisTrack = Math.floor(totalSlotsToRender / trackCount);\n        // ä½™æ•°åˆ†é…ï¼šå¦‚æœæ€»æ•°ä¸èƒ½è¢«7æ•´é™¤ï¼Œå‰å‡ ä¸ªè½¨é“å¤šæ‰¿æ‹…1ä¸ª\n        if (trackIndex < (totalSlotsToRender % trackCount)) {\n            itemsForThisTrack += 1;\n        }\n\n        // è®¡ç®—è¯¥è½¨é“çš„æµé€Ÿ (Duration)\n        const speedRandomFactor = 0.8 + Math.random() * 0.4; \n        const trackDuration = (style.baseDuration * speedRandomFactor) / currentDanmuSettings.speed;\n        const durationCss = `${trackDuration.toFixed(2)}s`;\n\n        // è®¡ç®—åˆšæ€§æ—¶é—´é—´éš”\n        // é—´éš” = æ€»æ—¶é•¿ / è¯¥è½¨é“çš„å¼¹å¹•æ•°é‡\n        // æ•°é‡è¶Šå¤šï¼Œé—´éš”è¶Šå°ï¼Œå¯†åº¦è‡ªåŠ¨å˜å¤§ä»¥å®¹çº³æ‰€æœ‰æ–‡æœ¬\n        const interval = trackDuration / itemsForThisTrack;\n\n        // è½¨é“æ•´ä½“çš„éšæœºåç§»\n        const trackGlobalOffset = Math.random() * interval;\n\n        // ç”Ÿæˆè¯¥è½¨é“å†…çš„å¼¹å¹•å®ä¾‹\n        for (let i = 0; i < itemsForThisTrack; i++) {\n            // å¾ªç¯è·å–å†…å®¹\n            const line = danmuLines[globalContentIndex % danmuLines.length];\n            globalContentIndex++;\n\n            // è®¡ç®— Top ä½ç½®\n            const spacing = currentDanmuSettings.height / trackCount;\n            const top = (trackIndex * spacing) + 1; \n\n            // è®¡ç®—å»¶è¿Ÿ (Delay) - åˆšæ€§åˆ†å¸ƒ\n            const delay = -((i * interval) + trackGlobalOffset);\n            const delayCss = `${delay.toFixed(2)}s`;\n\n            // æ¸²æŸ“\n            const randomColor = getRandomBrightColor();\n            const safeLine = escapeHtml(line.trim());\n            const danmuSpan = `<span class=\"danmaku-content\" style=\"color: ${randomColor};\">${safeLine}</span>`;\n\n            allTracksHtml += `\n            <div class=\"danmaku-track\" style=\"top: ${top}%; animation-duration: ${durationCss}; animation-delay: ${delayCss};\">\n                ${danmuSpan}\n            </div>`;\n        }\n    });\n\n    targetContainer.innerHTML = allTracksHtml;\n    applyDanmuSettings();\n}\n\nfunction initializeDanmuSettings() {\n  loadDanmuSettings();\n  applyDanmuSettings();\n\n  // åˆå§‹åŒ–è®¾ç½®æ¨¡æ€æ¡†çš„å€¼\n  const toggleBtn = document.getElementById('danmu-toggle');\n  const opacitySlider = document.getElementById('danmu-opacity-slider');\n  const opacityValue = document.getElementById('danmu-opacity-value');\n  const sizeSlider = document.getElementById('danmu-size-slider');\n  const sizeValue = document.getElementById('danmu-size-value');\n\n  if (toggleBtn) {\n    toggleBtn.setAttribute('data-state', currentDanmuSettings.enabled ? 'on' : 'off');\n    toggleBtn.textContent = currentDanmuSettings.enabled ? 'å¼€å¯' : 'å…³é—­';\n\n    toggleBtn.addEventListener('click', () => {\n      currentDanmuSettings.enabled = !currentDanmuSettings.enabled;\n      toggleBtn.setAttribute('data-state', currentDanmuSettings.enabled ? 'on' : 'off');\n      toggleBtn.textContent = currentDanmuSettings.enabled ? 'å¼€å¯' : 'å…³é—­';\n      saveDanmuSettings();\n    });\n  }\n\n  if (opacitySlider && opacityValue) {\n    opacitySlider.value = currentDanmuSettings.opacity;\n    opacityValue.textContent = currentDanmuSettings.opacity.toFixed(2);\n\n    opacitySlider.addEventListener('input', (e) => {\n      const value = parseFloat(e.target.value);\n      currentDanmuSettings.opacity = value;\n      opacityValue.textContent = value.toFixed(2);\n      applyDanmuSettings(); // å®æ—¶é¢„è§ˆ\n    });\n    opacitySlider.addEventListener('change', saveDanmuSettings); // æ‹–åŠ¨åœæ­¢åä¿å­˜\n  }\n\n  if (sizeSlider && sizeValue) {\n    sizeSlider.value = currentDanmuSettings.size;\n    sizeValue.textContent = `${currentDanmuSettings.size}px`;\n\n    sizeSlider.addEventListener('input', (e) => {\n      const value = parseInt(e.target.value, 10);\n      currentDanmuSettings.size = value;\n      sizeValue.textContent = `${value}px`;\n      applyDanmuSettings(); // å®æ—¶é¢„è§ˆ\n    });\n    sizeSlider.addEventListener('change', saveDanmuSettings); // æ‹–åŠ¨åœæ­¢åä¿å­˜\n  }\n  // å¼¹å¹•é«˜åº¦\n  const heightSlider = document.getElementById('danmu-height-slider');\n  const heightValue = document.getElementById('danmu-height-value');\n  if (heightSlider && heightValue) {\n    heightSlider.value = currentDanmuSettings.height;\n    heightValue.textContent = `${currentDanmuSettings.height}%`;\n    heightSlider.addEventListener('input', (e) => {\n      const value = parseInt(e.target.value, 10);\n      currentDanmuSettings.height = value;\n      heightValue.textContent = `${value}%`;\n \n    });\n    heightSlider.addEventListener('change', () => {\n      saveDanmuSettings(); \n      // ç«‹å³å°è¯•é‡ç»˜ï¼šå¦‚æœå¼¹å¹•å¯è§ï¼Œåº”è¯¥é‡æ–°è°ƒç”¨ renderDanmu \n      // æ³¨æ„ï¼šæ‚¨éœ€è¦ç¡®ä¿åœ¨è®¾ç½®æ›´æ”¹åï¼Œèƒ½å¤Ÿè®¿é—®åˆ°ä¸Šä¸€æ¬¡çš„ danmuContent æ¥è°ƒç”¨ renderDanmu(danmuContent)\n      console.log(\"[Danmu Settings] é«˜åº¦å·²æ›´æ–°ã€‚ä¸‹æ¬¡æ¥æ”¶åˆ° <danmu> æ ‡ç­¾æ—¶å°†ç”Ÿæ•ˆã€‚\");\n    }); \n  }\n\n  // å¼¹å¹•æµé€Ÿ\n  const speedSlider = document.getElementById('danmu-speed-slider');\n  const speedValue = document.getElementById('danmu-speed-value');\n  if (speedSlider && speedValue) {\n    speedSlider.value = currentDanmuSettings.speed;\n    speedValue.textContent = `x${currentDanmuSettings.speed.toFixed(1)}`;\n    speedSlider.addEventListener('input', (e) => {\n      const value = parseFloat(e.target.value);\n      currentDanmuSettings.speed = value;\n      speedValue.textContent = `x${value.toFixed(1)}`;\n    });\n    speedSlider.addEventListener('change', () => {\n      saveDanmuSettings();\n      console.log(\"[Danmu Settings] æµé€Ÿå·²æ›´æ–°ã€‚ä¸‹æ¬¡æ¥æ”¶åˆ° <danmu> æ ‡ç­¾æ—¶å°†ç”Ÿæ•ˆã€‚\");\n    });\n  }\n\n  // å¼¹å¹•æ•°é‡ (ä¿®æ”¹)\n  const countSlider = document.getElementById('danmu-count-slider'); // IDä¿æŒä¸å˜\n  const countValue = document.getElementById('danmu-count-value');\n  if (countSlider && countValue) {\n    countSlider.value = currentDanmuSettings.maxDensityValue;\n    countValue.textContent = currentDanmuSettings.maxDensityValue;\n    countSlider.addEventListener('input', (e) => {\n      // ç¡®ä¿è¾“å…¥æ˜¯æ•´æ•°\n      const value = parseInt(e.target.value, 10);\n      currentDanmuSettings.maxDensityValue = value;\n      countValue.textContent = value;\n    });\n    countSlider.addEventListener('change', () => {\n      saveDanmuSettings();\n      console.log(\"[Danmu Settings] æœ€å¤§åŒå±æ•°é‡å·²æ›´æ–°ã€‚ä¸‹æ¬¡æ¥æ”¶åˆ° <danmu> æ ‡ç­¾æ—¶å°†ç”Ÿæ•ˆã€‚\");\n    });\n  }\n \n}  \n\ndocument.addEventListener('DOMContentLoaded', function() {\n    const toggleButton = document.getElementById('modal-background-toggle');\n    const ROOT = document.documentElement; // è·å– :root å…ƒç´  (<html>)\n    const STORAGE_KEY = 'modalBackgroundEnabled'; \n    \n    // æ¸å˜èƒŒæ™¯çš„å€¼ (ä½¿ç”¨æ‚¨æä¾›çš„ CSS æ¸å˜)\n    const GRADIENT_BG_VALUE = 'linear-gradient(135deg, var(--container-bg-color), var(--background-color))';\n    // é€æ˜èƒŒæ™¯çš„å€¼\n    const NONE_BG_VALUE = 'none';\n\n    if (!toggleButton) return; \n\n    function applyModalBackground(isEnabled) {\n        const value = isEnabled ? GRADIENT_BG_VALUE : NONE_BG_VALUE;\n        \n        // 1. è®¾ç½® CSS å˜é‡\n        ROOT.style.setProperty('--modal-content-bg', value);\n\n        // 2. æ›´æ–°æŒ‰é’®çŠ¶æ€\n        if (isEnabled) {\n            toggleButton.setAttribute('data-state', 'on');\n            toggleButton.textContent = 'å¼€å¯';\n        } else {\n            toggleButton.setAttribute('data-state', 'off');\n            toggleButton.textContent = 'å…³é—­';\n        }\n        \n        // 3. ä¿å­˜çŠ¶æ€\n        localStorage.setItem(STORAGE_KEY, isEnabled);\n    }\n\n    // 1. åˆå§‹åŠ è½½çŠ¶æ€\n    // ä» localStorage è¯»å–çŠ¶æ€ï¼Œé»˜è®¤æ˜¯ false (å…³é—­/é€æ˜)\n    const savedState = localStorage.getItem(STORAGE_KEY);\n    const initialState = savedState === null ? false : (savedState === 'true');\n    applyModalBackground(initialState);\n    \n    // 2. æŒ‰é’®ç‚¹å‡»äº‹ä»¶\n    toggleButton.addEventListener('click', function() {\n        const currentState = this.getAttribute('data-state') === 'on';\n        const newState = !currentState;\n        \n        applyModalBackground(newState);\n    });\n\n\n \n});\ndocument.addEventListener('DOMContentLoaded', function() {\n    \n    const viewPromptBtn = document.getElementById('view-captured-prompt-btn');\n    if (viewPromptBtn) {\n        viewPromptBtn.addEventListener('click', function(e) {\n            e.preventDefault();\n            e.stopPropagation();\n            \n            console.log('[Nova] æ‰“å¼€æç¤ºè¯æŸ¥çœ‹å™¨');\n            \n            const modal = document.getElementById('prompt-viewer-modal');\n            const display = document.getElementById('prompt-content-display');\n            \n            if (!modal || !display) {\n                console.error('[Nova] æ‰¾ä¸åˆ°å¼¹çª—å…ƒç´ ');\n                toastr.error('ç•Œé¢å…ƒç´ æœªæ‰¾åˆ°', 'é”™è¯¯');\n                return;\n            }\n            \n            // å°è¯•ä»localStorageæˆ–å…¨å±€å˜é‡è·å–æç¤ºè¯\n            const promptData = (typeof prompts_be_sent !== 'undefined' && prompts_be_sent) \n                ? prompts_be_sent \n                : localStorage.getItem('last_captured_prompt');\n            \n            if (promptData) {\n                // ===== æ–°å¢ï¼šå¤„ç†è½¬ä¹‰å­—ç¬¦ =====\n                let processedText = promptData;\n                \n                // å¦‚æœæ˜¯JSONå­—ç¬¦ä¸²ï¼Œå…ˆå°è¯•è§£æ\n                try {\n                    if (typeof promptData === 'string' && (promptData.startsWith('[') || promptData.startsWith('{'))) {\n                        // å°è¯•è§£æJSONå¹¶ç¾åŒ–æ˜¾ç¤º\n                        const parsed = JSON.parse(promptData);\n                        processedText = JSON.stringify(parsed, null, 2);\n                    }\n                } catch (e) {\n                    // å¦‚æœä¸æ˜¯æœ‰æ•ˆJSONï¼Œç›´æ¥ä½¿ç”¨åŸå§‹æ–‡æœ¬\n                    console.log('[Nova] ä¸æ˜¯JSONæ ¼å¼ï¼Œä½¿ç”¨åŸå§‹æ–‡æœ¬');\n                }\n                \n                // å¤„ç†è½¬ä¹‰å­—ç¬¦ï¼šå°†å­—ç¬¦ä¸²ä¸­çš„ \\\\n è½¬æ¢ä¸ºå®é™…æ¢è¡Œ\n                processedText = processedText\n                    .replace(/\\\\n/g, '\\n')      // \\n è½¬æ¢ä¸ºæ¢è¡Œ\n                    .replace(/\\\\r\\\\n/g, '\\n')   // \\r\\n è½¬æ¢ä¸ºæ¢è¡Œ\n                    .replace(/\\\\r/g, '\\n')      // \\r è½¬æ¢ä¸ºæ¢è¡Œ\n                    .replace(/\\\\t/g, '\\t')      // \\t è½¬æ¢ä¸ºåˆ¶è¡¨ç¬¦\n                    .replace(/\\\\\"/g, '\"')       // \\\" è½¬æ¢ä¸ºå¼•å·\n                    .replace(/\\\\'/g, \"'\")       // \\' è½¬æ¢ä¸ºå•å¼•å·\n                    .replace(/\\\\\\\\/g, '\\\\');    // \\\\ è½¬æ¢ä¸ºå•ä¸ªåæ–œæ \n                \n                display.textContent = processedText;\n                // ===== å¤„ç†ç»“æŸ =====\n                \n                console.log('[Nova] æˆåŠŸåŠ è½½æç¤ºè¯ï¼Œé•¿åº¦:', processedText.length);\n            } else {\n                display.textContent = 'æš‚æ— æ•è·çš„æç¤ºè¯\\n\\næç¤ºï¼šè¯·ç¡®ä¿ is_restore_prompt è®¾ç½®ä¸º \"true\"ï¼Œå¹¶å‘é€è‡³å°‘ä¸€æ¡æ¶ˆæ¯ã€‚\\n\\nå½“å‰ is_restore_prompt å€¼: ' + (typeof is_restore_prompt !== 'undefined' ? is_restore_prompt : 'æœªå®šä¹‰');\n                console.log('[Nova] æœªæ‰¾åˆ°æç¤ºè¯æ•°æ®');\n            }\n            \n            // æ˜¾ç¤ºå¼¹çª—\n            modal.style.display = 'flex';\n            console.log('[Nova] å¼¹çª—å·²æ˜¾ç¤º');\n        });\n    \n    } else {\n        console.error('[Nova] æ‰¾ä¸åˆ°æŸ¥çœ‹æç¤ºè¯æŒ‰é’®');\n    }\n    \n    // å…³é—­æŒ‰é’®äº‹ä»¶\n    const closeBtn = document.querySelector('#prompt-viewer-modal .modal-close');\n    if (closeBtn) {\n        closeBtn.addEventListener('click', function(e) {\n            e.preventDefault();\n            e.stopPropagation();\n            const modal = document.getElementById('prompt-viewer-modal');\n            if (modal) {\n                modal.style.display = 'none';\n                console.log('[Nova] å¼¹çª—å·²å…³é—­');\n            }\n        });\n    }\n    \n    // ç‚¹å‡»èƒŒæ™¯å…³é—­\n    const modal = document.getElementById('prompt-viewer-modal');\n    if (modal) {\n        modal.addEventListener('click', function(e) {\n            if (e.target === modal) {\n                modal.style.display = 'none';\n                console.log('[Nova] é€šè¿‡èƒŒæ™¯ç‚¹å‡»å…³é—­å¼¹çª—');\n            }\n        });\n    }\n    \n    // å¤åˆ¶æç¤ºè¯æŒ‰é’®äº‹ä»¶\n    const copyBtn = document.getElementById('copy-prompt-btn');\n    if (copyBtn) {\n        copyBtn.addEventListener('click', async function(e) {\n            e.preventDefault();\n            e.stopPropagation();\n            \n            const promptText = document.getElementById('prompt-content-display').textContent;\n            \n            if (promptText && !promptText.startsWith('æš‚æ— æ•è·çš„æç¤ºè¯')) {\n                try {\n                    await navigator.clipboard.writeText(promptText);\n                    toastr.success('æç¤ºè¯å·²å¤åˆ¶åˆ°å‰ªè´´æ¿', 'å¤åˆ¶æˆåŠŸ');\n                    this.textContent = 'âœ“ å·²å¤åˆ¶';\n                    setTimeout(() => {\n                        this.textContent = 'å¤åˆ¶åˆ°å‰ªè´´æ¿';\n                    }, 2000);\n                } catch (err) {\n                    console.error('å¤åˆ¶å¤±è´¥:', err);\n                    // å¤‡ç”¨æ–¹æ¡ˆï¼šä½¿ç”¨ä¼ ç»Ÿæ–¹æ³•\n                    const textArea = document.createElement('textarea');\n                    textArea.value = promptText;\n                    textArea.style.position = 'fixed';\n                    textArea.style.left = '-999999px';\n                    document.body.appendChild(textArea);\n                    textArea.select();\n                    try {\n                        document.execCommand('copy');\n                        toastr.success('æç¤ºè¯å·²å¤åˆ¶åˆ°å‰ªè´´æ¿', 'å¤åˆ¶æˆåŠŸ');\n                    } catch (err2) {\n                        toastr.error('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨é€‰æ‹©å¹¶å¤åˆ¶', 'å¤åˆ¶å¤±è´¥');\n                    }\n                    document.body.removeChild(textArea);\n                }\n            } else {\n                toastr.warning('æ²¡æœ‰å¯å¤åˆ¶çš„å†…å®¹', 'æç¤º');\n            }\n        });\n    }\n    \n    console.log('[Nova] æç¤ºè¯æŸ¥çœ‹å™¨äº‹ä»¶ç»‘å®šå®Œæˆ');\n\n    NovaWorkshop.init();\n});\n \nwindow.GameAPI = {\n    // å®šä¹‰ä¸€ä¸ªå±æ€§ 'settings'\n    get assaData() {\n        // GameAPI.assaData \n        return assaSettingsData;\n    },\n         getThemeVar: function(varName) {\n//    --modal-content-bg: none; /* é»˜è®¤é€æ˜ */\n//             --primary-color: #00faff;\n//             --secondary-color: #7affff;\n//    --base-font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif; /* é»˜è®¤å­—ä½“ */\n//             --container-bg-color: rgba(10, 25, 47, 0.75);\n//             --border-color: rgba(0, 250, 255, 0.3);\n//             --glow-color: rgba(0, 250, 255, 0.5);\n//             --text-color: #e6f1ff;\n//             --text-secondary-color: #a8c0e1;\n//             --background-color: rgba(10, 25, 47);\n//             --danger-color: #ff4d4d;\n//             --danger-glow-color: rgba(255, 77, 77, 0.5);\n//              --success-color: #4dff88;\n//             --success-glow-color: rgba(77, 255, 136, 0.5);\n        return getComputedStyle(document.documentElement).getPropertyValue(varName).trim();\n    },\n    get statData() {\n \n        return currentGameData;\n    },\n      get playCharacterData() {\n \n        return playCharacterData;\n    },\n      get checkMemoryData() {\n \n        return checkMemoryData;\n    },\n      get worldAttitudeData() {\n \n        return worldAttitudeData;\n    },\n    get characterStatusData() {\n \n        return characterStatusData;\n    },\n    get conversationHistory() {\n \n        return conversationHistory;\n    },\n triggerassa: function(...args) {\n        // âœ… è°ƒç”¨æ—¶æ‰æ‰§è¡Œï¼Œæ­¤æ—¶å‡½æ•°åº”è¯¥å·²ç»å®šä¹‰äº†\n        if (typeof triggerassa === 'function') {\n            return triggerassa(...args);\n        } else {\n            console.error(\"triggerassa å‡½æ•°æœªå®šä¹‰\");\n        }\n    },\n \n    updateSettings: function(newData) {\n        assaSettingsData = newData; // ç›´æ¥ä¿®æ”¹åŸæœ¬çš„ let å˜é‡\n        console.log(\"æ•°æ®å·²é€šè¿‡ API æ›´æ–°ï¼\");\n    }\n}\n</script>\n\n</html>\n ```",
                    "trimStrings": [],
                    "placement": [
                        2
                    ],
                    "substituteRegex": 0,
                    "minDepth": null,
                    "maxDepth": null,
                    "markdownOnly": true,
                    "promptOnly": false
                }
            ],
            "tavern_helper": [
                [
                    "scripts",
                    []
                ],
                [
                    "variables",
                    {}
                ]
            ]
        },
        "group_only_greetings": [],
        "character_book": {
            "entries": [
                {
                    "id": 0,
                    "keys": [],
                    "secondary_keys": [],
                    "comment": "[memoryinit]",
                    "content": "{\"stat_data\": {\n            \"hurt_value\": [0,\"æœ¬æ¡å›å¤ä¸­ï¼Œuserå—åˆ°é¢å¤–ä¼¤å®³çš„å€¼\"],\n             \"çºªå¹´\":\"\",\n            \"æ—¥æœŸ\": [\"\", \"ä»Šå¤©çš„æ—¥æœŸï¼Œæ ¼å¼ä¸º mmæœˆddæ—¥ï¼Œä»01æœˆ01æ—¥å¼€å§‹ï¼Œä¹ƒè¿›å…¥ä»»åŠ¡ä¸–ç•Œçš„è®¡æ—¶ï¼Œç¦æ­¢ä¸ºç©ºæˆ–æœªçŸ¥ã€‚åªæœ‰åˆå§‹åŒ–å’Œå½“æ—¶é—´æµé€è·¨åº¦å¤§äºä¸€å¤©çš„æ—¶å€™æ‰èƒ½æ”¹å˜å…¶å€¼\"],\n            \"æ˜ŸæœŸ\":\"\",\n            \"æ—¶é—´\": [\n                \"\",\n                \"æŒ‰ç…§è¿›è¡Œè¡ŒåŠ¨åå®é™…ç»å†çš„æ—¶é—´åˆç†è¿›è¡Œæ›´æ–°ï¼Œæ¯æ¬¡è¾“å‡ºå†…å®¹åå¿…é¡»æ›´æ–°ï¼Œæ ¼å¼ä¸º hh:mmï¼Œç¦æ­¢ä¸ºç©ºæˆ–æœªçŸ¥\"\n            ],\n             \"å¤©æ°”\":[\"\",\"\"],\n             \"åœºæ™¯å›¾\": [\n                    \"\",\n                    \"userå½“å‰æ‰€åœ¨çš„åœ°å›¾å›¾ç‰‡èµ„æºï¼ŒæŒ‰è¦æ±‚æ›´æ–°\"\n                ],\n            \"group_name\":\"\",\n            \"world_shard\": {\n                \"name\": [\"\", \"å½“å‰æ‰€å¤„ä»»åŠ¡ä¸–ç•Œçš„åç§°æˆ–ä»£å·ã€‚\"],\n                \"description\": [\"æ— \", \"å½“å‰ä»»åŠ¡ä¸–ç•Œçš„ç¯å¢ƒã€æ°›å›´ã€æ–‡æ˜å½¢æ€ç­‰æ€»ä½“æè¿°\"],\n                \"level\":[\"æ— \",\"å½“å‰ä¸–ç•Œèƒ½é‡/ç§‘æŠ€å±‚çº§ï¼Œåªèƒ½ä»[ä½/ä¸­/é«˜/ç¥è¯/æ— ]ä¸­äº”é€‰ä¸€ã€‚å‚è€ƒ:é‡‘åº¸ä¸–ç•Œ/æ™®é€šç§‘å¹»ä¸–ç•Œçš„ä¸–ç•Œå±‚çº§ä¸ºä½ã€‚åªåœ¨åˆå§‹åŒ–ä¸–ç•Œæ—¶/èƒ½é‡å±‚çº§æ”¹å˜æ—¶(æœ‰ç¥æ˜/é€ ç‰©è¿›å…¥/ç¦»å¼€useré™„è¿‘)ï¼Œæ‰èƒ½æ›´æ”¹å…¶èƒ½é‡å±‚çº§\"],\n                \"task\": {\n                    \"objective\": [\"æ— \", \"å‘å¸ƒçš„ä»»åŠ¡ç›®æ ‡\"],\n                    \"progress\": [0, \"ä»»åŠ¡è¿›åº¦ç™¾åˆ†æ¯”ï¼Œä»¥æ•°å­—è¡¨ç¤ºï¼Œåˆå§‹/æ— ä»»åŠ¡å¿…ä¸º0ã€‚\"],\n                    \"status\": [\"æœªå®Œæˆ\", \"ä»»åŠ¡çŠ¶æ€ï¼šæœªå®Œæˆ/å·²å®Œæˆ/å¤±è´¥\"],\n                    \"start_date\": [\"\", \"ä»»åŠ¡å¼€å§‹æ—¶çš„æ—¥æœŸï¼ŒAIç¦æ­¢æ“ä½œ\"],\n                    \"rewards\": [\"æ— \", \"ä»»åŠ¡æˆåŠŸåçš„å¥–åŠ±\"],\n                    \"penalties\": [\"æ— \",\"ä»»åŠ¡å¤±è´¥åçš„æƒ©ç½š\"],\n                    \"time_limit\":[0, \"ä»»åŠ¡çš„æ€»ä½“æ—¶é—´é™åˆ¶(å¤©æ•°ï¼Œå¯ä»¥ä¸ºå°æ•°ï¼Œæ¯”å¦‚12å°æ—¶å³æ˜¯0.5ã€‚æ— æ˜ç¡®æ—¶é™æ—¶è®¾ç½®ä¸º999)ï¼Œåªæœ‰åœ¨åˆå§‹åŒ–ä»»åŠ¡æˆ–ä»»åŠ¡ç»“ç®—æ—¶æ”¹å˜ï¼Œå…¶ä½™æ—¶å€™ç¦æ­¢æ“ä½œï¼å›åˆ°ä¸ªäººç©ºé—´æ—¶è®¾ç½®limitä¸º3ï¼Œæ„ä¸ºæœ€å¤šä¼‘æ•´ä¸‰å¤©\"],\n                    \"time_left\":[0, \"ä»»åŠ¡çš„å‰©ä½™å¤©æ•°ï¼ŒAIä»»ä½•æ—¶åˆ»éƒ½ç¦æ­¢æ“ä½œ\"]\n                }\n            },\n            \"the_created\": {\n                     \"name\": [\"\", \"é€ ç‰©çš„åå­—\"],\n                     \"identity_in_world\": [\"\", \"é€ ç‰©åœ¨å½“å‰ä¸–ç•Œçš„èº«ä»½\"],\n                     \"current_status\": [\"\", \"é€ ç‰©å½“å‰çš„çŠ¶æ€ã€‚\"],\n                     \"mood\": [\"\", \"é€ ç‰©å½“å‰çš„å¿ƒæƒ…\"],\n                     \"description\": [\"\", \"å…³äºè¿™ä¸ªé€ ç‰©çš„ç²¾å‡†ã€è¯¦ç»†ä»‹ç»ï¼ŒåŒ…æ‹¬å¿ƒæ™ºã€å¤–å½¢ç­‰ï¼Œä¸¥æ ¼æŒ‰ç…§è¦æ±‚æ¥è®¾è®¡ã€‚ä¸å°‘äº50å­—\"]\n            },\n            \"user_character\": {\n                \"name\": \"user\",\n                \"nick_name\":\"\",\n                \"status\":[\"\",\"ç”¨æˆ·å½“å‰æ‰€æ‹¥æœ‰çš„buffå’Œdebuffï¼Œå¤šä¸ªçŠ¶æ€ç”¨;åˆ†éš”\"],\n                \"total_task\":[0,\"å®Œæˆçš„ä»»åŠ¡æ€»é‡ï¼Œå®Œæˆ/å¤±è´¥ä¸€ä¸ªä»»åŠ¡åï¼Œç»“ç®—çš„æ—¶å€™åŠ ä¸€\"],\n                \"Cross_world_prestige\":[0,\"ç”¨æˆ·çš„è·¨ä¸–ç•Œå£°æœ›ï¼Œå¯ä¸ºè´Ÿï¼Œåœ¨è„±ç¦»ä¸€ä¸ªä¸–ç•Œæ—¶ç»“ç®—ï¼Œåªæœ‰å¯¹ä¸–ç•Œäº§ç”Ÿé‡å¤§å½±å“æ‰æ›´æ–°ã€‚æ•°å€¼å…‹åˆ¶ï¼Œä¾‹å¦‚ï¼šæ‹¯æ•‘äº†ä¸€ä¸ªå®Œæ•´çš„ä¸–ç•Œï¼Œå£°æœ›+5\"],\n                \"current_location\": [\n                    \"\",\n                    \"userå½“å‰æ‰€åœ¨çš„ä½ç½®ï¼Œç§»åŠ¨åæ›´æ–°\"\n                ],\n\"å½“å‰è£…å¤‡\":{\n                    \"æ‰‹æŒ\": [\"æ— \", \"å½“å‰æ‰‹æŒçš„æ­¦å™¨æˆ–å·¥å…·åç§°ï¼Œå¤šä¸ªè£…å¤‡ç”¨;åˆ†å‰²\"],\n                    \"ç©¿æˆ´\": {\n                        \"å¤´éƒ¨\": [\"æ— \", \"å¤´éƒ¨çš„è£…å¤‡åç§°\"],\n                        \"èº«ä½“\": [\"æ— \", \"èº«ä½“çš„è£…å¤‡åç§°\"],\n                        \"æ‰‹éƒ¨\": [\"æ— \", \"æ‰‹éƒ¨çš„è£…å¤‡åç§°\"],\n                        \"è„šéƒ¨\": [\"æ— \", \"è„šéƒ¨çš„è£…å¤‡åç§°\"],\n                        \"é¥°å“\": [\"æ— \", \"ç‰¹æ®Šé¥°å“åç§°\"]\n                    }\n}\n            },\n            \"æ£€å®šå±æ€§\": [\"\", \"ä¸‹ä¸€è½®è¡ŒåŠ¨éœ€è¦è¿›è¡Œåˆ¤å®šçš„æ ¸å¿ƒ å±æ€§æ®µ å’Œ æŠ€èƒ½æ®µ (ç¦æ­¢æ£€å®š å…¶ä»–æŠ€èƒ½ )ç»„åˆï¼Œè®¾ç½®ä¸‰ä¸ªã€‚ç”¨åŠè§’ç¬¦å·;åˆ†éš”ï¼Œä¾‹å¦‚ï¼šåŠ›é‡;æ•æ·;ç™½åˆƒã€‚è‹¥å­˜åœ¨é€‰é¡¹åŒºï¼Œé€‰å–ç¬¬ä¸€ä¸ªé€‰é¡¹åŒºçš„æ£€å®šå±æ€§ä½œä¸ºå€¼\"],\n            \"æ£€å®šéš¾åº¦\":[1,\"æ¯ä¸€è½®éƒ½é¢„æµ‹ä¸‹ä¸€è½®è¡ŒåŠ¨ä¼šç›´æ¥é¢å¯¹çš„å±æœºçš„éš¾åº¦çº§åˆ«ã€‚ç¦æ­¢ä¸ºç©º\"],\n            \"æ•Œæ–¹æ”»å‡»éª°æ± \": [\"\", \"å½“åˆ¤å®šå½“å‰å¤„äºæˆ˜æ–—çŠ¶æ€æ—¶ï¼Œé¢„æµ‹æ•Œæ–¹å½“å‰å³å°†è½ä¸‹çš„æ”»å‡»æ‰€å±çš„æ ¸å¿ƒå±æ€§æ®µå’ŒæŠ€èƒ½æ®µç»„åˆï¼Œæ— ä¸Šé™ã€‚ç”¨åŠè§’:è®¾ç½®æ•Œæ–¹æ­¤å±æ€§çš„å€¼ï¼Œå¤šä¸ªå±æ€§ç”¨åŠè§’ç¬¦å·;åˆ†éš”ï¼Œä¾‹å¦‚ï¼šåŠ›é‡:2;æ„ŸçŸ¥:3;ç™½åˆƒ:2ã€‚å¤šä¸ªæ•Œäººæ”»å‡»æ—¶ç›´æ¥è®¾ç½®å…¶å±æ€§ï¼Œç¦æ­¢è®¾ç½®åç§°\"],\n            \"dp_bonus\":[0,\"æ¥æºäºæ„å¿—åŠ›æˆ–æŠ€èƒ½ï¼ŒAIç¦æ­¢è®¾ç½®\"],\n            \"ç¬¦åˆç¾å¾·çš„\":[\"false\",\"å½“æ£€æµ‹åˆ°æ­¤è½®ç”¨æˆ·è¡¨ç°ç¬¦åˆç¾å¾·è§¦å‘æ¡ä»¶æ—¶ï¼Œè®¾ç½®ä¸ºtrue;å½“ä¸ç¬¦åˆæ—¶ï¼Œè®¾ç½®ä¸ºfalse\"],\n            \"ç¬¦åˆæ¶å¾·çš„\":[\"false\",\"å½“æ£€æµ‹åˆ°æ­¤è½®ç”¨æˆ·è¡¨ç°ç¬¦åˆæ¶å¾·è§¦å‘æ¡ä»¶æ—¶ï¼Œè®¾ç½®ä¸ºtrue;å½“ä¸ç¬¦åˆæ—¶ï¼Œè®¾ç½®ä¸ºfalse\"]\n        },\n \"play_character_data\": {\n            \"æ¦‚å¿µæ®µ\": { \"ç¾å¾·ä¸æ¶å¾·\": { \"ç¾å¾·\": [\"æ­£ä¹‰\", \"ç¬¦åˆå¯¹åº”æ¡ä»¶æ—¶å›å¤æ‰€æœ‰æ„å¿—åŠ›\"], \"æ¶å¾·\": [\"æ„¤æ€’\", \"ç¬¦åˆå¯¹åº”æ¡ä»¶æ—¶å›å¤1ç‚¹æ„å¿—åŠ›\"] }, \"ç¼ºé™·å¤©èµ‹æ€ªç™–\": { \"ç¼ºé™·\": [\"æ— \", \"è§’è‰²æ‰€å…·æœ‰çš„è´Ÿé¢ç‰¹æ€§\"], \"å¤©èµ‹\": [\"æ— \", \"è§’è‰²æ‰€å…·æœ‰çš„æ­£é¢ç‰¹æ€§\"], \"æ€ªç™–\": [\"æ— \", \"è§’è‰²çš„ä¸€äº›æ— ä¼¤å¤§é›…çš„ç‰¹æ®Šä¹ æƒ¯\"] } },\n            \"å±æ€§æ®µ\": { \"ç”Ÿç†å±æ€§\": { \"åŠ›é‡\": { \"åŸºç¡€\": [0, \"è¡¡é‡è‚Œè‚‰å¼ºåº¦ä¸çˆ†å‘åŠ›ï¼Œå½±å“è¿‘æˆ˜ä¼¤å®³ä¸è´Ÿé‡\"], \"ä¼ å¥‡\": [0, \"è¶…è¶Šå‡¡äººæé™çš„åŠ›é‡ï¼Œæä¾›ä¼¤å®³é™„åŠ æˆåŠŸ\"] }, \"æ•æ·\": { \"åŸºç¡€\": [0, \"è¡¡é‡èº«ä½“åè°ƒã€ååº”é€Ÿåº¦ä¸çµæ´»æ€§ï¼Œå½±å“å…ˆæ”»ä¸é—ªé¿\"], \"ä¼ å¥‡\": [0, \"è¶…è¶Šå‡¡äººæé™çš„æ•æ·ï¼Œæä¾›é˜²å¾¡é™„åŠ æˆåŠŸ\"] }, \"è€åŠ›\": { \"åŸºç¡€\": [0, \"è¡¡é‡ä½“è´¨ã€æŒä¹…åŠ›ä¸æ¢å¤åŠ›ï¼Œå½±å“ç”Ÿå‘½å€¼ä¸æŠµæŠ—åŠ›\"], \"ä¼ å¥‡\": [0, \"è¶…è¶Šå‡¡äººæé™çš„è€åŠ›ï¼Œæä¾›ä¼¤å®³å‡å…\"] } }, \"å¿ƒæ™ºå±æ€§\": { \"æ™ºåŠ›\": { \"åŸºç¡€\": [0, \"è¡¡é‡é€»è¾‘ã€è®°å¿†ã€å­¦ä¹ ä¸åˆ†æèƒ½åŠ›ï¼Œå½±å“æŠ€èƒ½å­¦ä¹ ä¸ç­–ç•¥\"], \"ä¼ å¥‡\": [0, \"è¶…è¶Šå‡¡äººæé™çš„æ™ºåŠ›ï¼Œæä¾›æŠ€èƒ½é™„åŠ æˆåŠŸ\"] }, \"æ„ŸçŸ¥\": { \"åŸºç¡€\": [0, \"è¡¡é‡è§‚å¯ŸåŠ›ã€ç›´è§‰ä¸äº”æ„Ÿæ•é”åº¦ï¼Œå½±å“ä¾¦æŸ¥ä¸æ´å¯Ÿ\"], \"ä¼ å¥‡\": [0, \"è¶…è¶Šå‡¡äººæé™çš„æ„ŸçŸ¥ï¼Œæä¾›æ´å¯Ÿé˜²å¾¡ä¸ä¾¦æŸ¥é™„åŠ æˆåŠŸ\"] }, \"å†³å¿ƒ\": { \"åŸºç¡€\": [0, \"è¡¡é‡æ„å¿—åŠ›ã€å‹‡æ°”ä¸ç²¾ç¥éŸ§æ€§ï¼Œå½±å“æ„å¿—å€¼ä¸Šé™\"], \"ä¼ å¥‡\": [0, \"è¶…è¶Šå‡¡äººæé™çš„å†³å¿ƒï¼Œæä¾›æ„å¿—æ£€å®šé™„åŠ æˆåŠŸ\"] } }, \"äº’åŠ¨å±æ€§\": { \"é£åº¦\": { \"åŸºç¡€\": [0, \"è¡¡é‡ä¸ªäººé­…åŠ›ã€æ°”è´¨ä¸ç¬¬ä¸€å°è±¡ï¼Œå½±å“æ­£é¢ç¤¾äº¤\"], \"ä¼ å¥‡\": [0, \"è¶…è¶Šå‡¡äººæé™çš„é£åº¦ï¼Œæä¾›ç¤¾äº¤æ£€å®šé™„åŠ æˆåŠŸ\"] }, \"æ“æ§\": { \"åŸºç¡€\": [0, \"è¡¡é‡è¯´æœã€è¯±å¯¼ä¸æ§åˆ¶ä»–äººçš„èƒ½åŠ›ï¼Œå½±å“è´Ÿé¢ç¤¾äº¤\"], \"ä¼ å¥‡\": [0, \"è¶…è¶Šå‡¡äººæé™çš„æ“æ§ï¼Œæä¾›æ“æ§æ£€å®šé™„åŠ æˆåŠŸ\"] }, \"æ²‰ç€\": { \"åŸºç¡€\": [0, \"è¡¡é‡å†·é™ã€è‡ªæ§ä¸æŠ—å‹èƒ½åŠ›ï¼Œå½±å“å…ˆæ”»ä¸æ„å¿—å€¼ä¸Šé™\"], \"ä¼ å¥‡\": [0, \"è¶…è¶Šå‡¡äººæé™çš„æ²‰ç€ï¼Œæä¾›æ„å¿—æ£€å®šé™„åŠ æˆåŠŸ\"] } } },\n            \"æŠ€èƒ½æ®µ\": { \"ç”Ÿç†æŠ€èƒ½\": { \"è¿åŠ¨\": [0, \"è¡¡é‡è·‘ã€è·³ã€æ”€çˆ¬ç­‰èº«ä½“æ´»åŠ¨èƒ½åŠ›\"], \"è‚‰æ\": [0, \"è¡¡é‡å¾’æ‰‹æ ¼æ–—æŠ€å·§\"], \"é©¾é©¶\": [0, \"è¡¡é‡æ“æ§åœ°é¢ã€æ°´é¢æˆ–ç©ºä¸­è½½å…·çš„èƒ½åŠ›\"], \"æªæ¢°\": [0, \"è¡¡é‡ä½¿ç”¨å„ç±»ç«å™¨çš„èƒ½åŠ›\"], \"æ‰‹ä¸ŠåŠŸå¤«\": [0, \"è¡¡é‡ç›—çªƒã€å¼€é”ç­‰æ‰‹éƒ¨ç²¾ç»†æ“ä½œèƒ½åŠ›\"], \"éšè—\": [0, \"è¡¡é‡æ½œè¡Œã€ä¼ªè£…ä¸éšè”½è‡ªèº«çš„èƒ½åŠ›\"], \"æ±‚ç”Ÿ\": [0, \"è¡¡é‡åœ¨æ¶åŠ£ç¯å¢ƒä¸­ç”Ÿå­˜ä¸è¿½è¸ªçš„èƒ½åŠ›\"], \"ç™½åˆƒ\": [0, \"è¡¡é‡ä½¿ç”¨åˆ€å‰‘ç­‰å†·å…µå™¨çš„èƒ½åŠ›\"], \"å¼“ç®­\": [0, \"è¡¡é‡ä½¿ç”¨å¼“å¼©ç­‰æŠ›å°„æ­¦å™¨çš„èƒ½åŠ›\"] }, \"å¿ƒæ™ºæŠ€èƒ½\": { \"å­¦è¯†\": [0, \"è¡¡é‡äººæ–‡ã€å†å²ã€åœ°ç†ç­‰çŸ¥è¯†å¹¿åº¦\"], \"ç”µè„‘\": [0, \"è¡¡é‡æ“ä½œã€ç¼–ç¨‹ä¸é»‘å®¢æŠ€æœ¯\"], \"æ‰‹è‰º\": [0, \"è¡¡é‡åˆ¶ä½œçš„çŸ¥è¯†\"], \"è°ƒæŸ¥\": [0, \"è¡¡é‡æœé›†çº¿ç´¢ã€åˆ†æç°åœºçš„èƒ½åŠ›\"], \"åŒ»å­¦\": [0, \"è¡¡é‡è¯Šæ–­ã€æ²»ç–—ä¸è¯ç†çŸ¥è¯†\"], \"ç¥ç§˜å­¦\": [0, \"è¡¡é‡å¯¹è¶…è‡ªç„¶ç°è±¡ä¸é­”æ³•çš„çŸ¥è¯†\"], \"ç§‘å­¦\": [0, \"è¡¡é‡ç‰©ç†ã€åŒ–å­¦ã€ç”Ÿç‰©ç­‰è‡ªç„¶ç§‘å­¦çŸ¥è¯†\"] }, \"äº’åŠ¨æŠ€èƒ½\": { \"åŠ¨ç‰©æ²Ÿé€š\": [0, \"è¡¡é‡ä¸åŠ¨ç‰©äº¤æµå’Œé©¯æœçš„èƒ½åŠ›\"], \"æ„Ÿå—\": [0, \"è¡¡é‡æ´å¯Ÿä»–äººæƒ…ç»ªä¸æ„å›¾çš„èƒ½åŠ›\"], \"è¡¨è¾¾\": [0, \"è¡¡é‡æ„ŸæŸ“ä»–äººçš„èƒ½åŠ›\"], \"èƒè¿«\": [0, \"è¡¡é‡é€šè¿‡å¨èƒä¸æå“è¾¾æˆç›®çš„çš„èƒ½åŠ›\"], \"äº¤é™…\": [0, \"è¡¡é‡ç¤¾äº¤ã€ç¤¼ä»ªä¸å»ºç«‹äººè„‰çš„èƒ½åŠ›\"], \"æ©é¥°\": [0, \"è¡¡é‡éšè—çœŸç›¸ã€ä¼ªè£…èº«ä»½ä¸æ¬ºéª—ä»–äººçš„èƒ½åŠ›\"] } },\n            \"èƒ½åŠ›æ®µ\": { \"ç±»å‹\": [\"æ— \", \"èƒ½åŠ›çš„åˆ†ç±»ï¼Œå¦‚è¡€ç»Ÿã€æ”¹é€ ã€åŠŸæ³•ç­‰\"], \"åç§°\": [\"\", \"èƒ½åŠ›çš„å…·ä½“åç§°\"], \"ç­‰çº§\": [0, \"èƒ½åŠ›çš„ç­‰çº§\"], \"æ•ˆæœ\": [\"\", \"èƒ½åŠ›æä¾›çš„å…·ä½“æ¸¸æˆæ•ˆæœ\"] },\n            \"è¡ç”Ÿå±æ€§æ®µ\": { \"ä½“ç§¯\": [5, \"è§’è‰²çš„èº«ä½“å°ºå¯¸ï¼Œå½±å“ç”Ÿå‘½å€¼ã€é€Ÿåº¦ä¸è¢«ä¾¦æµ‹çš„éš¾åº¦\"], \"é€Ÿåº¦\": { \"åŸºç¡€é€Ÿåº¦\": [0, \"ç”±åŠ›é‡+æ•æ·+ä½“ç§¯/3å†³å®šï¼Œæ˜¯ç§»åŠ¨è®¡ç®—çš„åŸºç¡€\"], \"é™†è¡Œé€Ÿåº¦\": [0, \"åœ¨é™†åœ°ä¸Šçš„ç§»åŠ¨é€Ÿåº¦ï¼Œå•ä½ä¸ºç±³/ç§»åŠ¨åŠ¨ä½œ\"], \"é£è¡Œé€Ÿåº¦\": [0, \"åœ¨ç©ºä¸­çš„ç§»åŠ¨é€Ÿåº¦ï¼Œé€šå¸¸éœ€è¦ç‰¹æ®Šèƒ½åŠ›\"] }, \"å…ˆæ”»\": [0, \"ç”±æ•æ·+æ²‰ç€/2å†³å®šï¼Œå†³å®šæˆ˜æ–—ä¸­çš„è¡ŒåŠ¨é¡ºåº\"], \"é˜²å¾¡\": { \"åŸºç¡€é˜²å¾¡\": [0, \"ç”±æ•æ·æˆ–æ„ŸçŸ¥ä¸­è¾ƒä½è€…å†³å®šï¼Œç”¨äºé—ªé¿æ—¶å‡å…æ”»å‡»æˆåŠŸæ•°\"], \"ä¼¤å®³å‡å…\": { \"å†²å‡»\": [0, \"æŠµæŠ—å†²å‡»ä¼¤å®³çš„èƒ½åŠ›\"], \"è‡´å‘½\": [0, \"æŠµæŠ—è‡´å‘½ä¼¤å®³çš„èƒ½åŠ›\"], \"æ¶æ€§\": [0, \"æŠµæŠ—æ¶æ€§ä¼¤å®³çš„èƒ½åŠ›\"] } }, \"ç”Ÿå‘½å€¼\": { \"ä¸Šé™\": [50, \"è§’è‰²èƒ½æ‰¿å—çš„æ€»ä¼¤å®³\"], \"å½“å‰å€¼\": [50, \"è§’è‰²å½“å‰å‰©ä½™çš„ç”Ÿå‘½åŠ›\"], \"ä¼¤å®³æ§½\": { \"å†²å‡»(B)\": [0, \"å·²æ‰¿å—çš„å†²å‡»ä¼¤å®³ï¼Œä¸€èˆ¬ç”±é’å‡»é€ æˆ\"], \"è‡´å‘½(L)\": [0, \"å·²æ‰¿å—çš„è‡´å‘½ä¼¤å®³ï¼Œä¸€èˆ¬ç”±ç©¿åˆºåŠˆç é€ æˆ\"], \"æ¶æ€§(A)\": [0, \"å·²æ‰¿å—çš„æ¶æ€§ä¼¤å®³ï¼Œä¸€èˆ¬ç”±è¶…è‡ªç„¶åŠ›é‡é€ æˆ\"] } }, \"æ„å¿—åŠ›\": { \"æ„å¿—å€¼\": [0, \"ç”±å†³å¿ƒ+æ²‰ç€å†³å®šï¼Œæ˜¯æ„å¿—åŠ›çš„ä¸Šé™å’Œæ„å¿—æ£€å®šçš„åŸºç¡€\"], \"ä¸Šé™\": [0, \"è§’è‰²æ‰€èƒ½æ‹¥æœ‰çš„æœ€å¤§æ„å¿—åŠ›ç‚¹æ•°\"], \"å½“å‰å€¼\": [0, \"è§’è‰²å½“å‰å¯ç”¨çš„æ„å¿—åŠ›ç‚¹æ•°\"] }, \"èƒ½é‡æ± \": { \"åç§°\": [\"æ— \", \"è§’è‰²ä½¿ç”¨çš„ç‰¹æ®Šèƒ½é‡åç§°ï¼Œå¦‚æ³•åŠ›ã€çµåŠ›ã€æ°”\"], \"ä¸Šé™\": [0, \"è§’è‰²æ‰€èƒ½æ‹¥æœ‰çš„æœ€å¤§èƒ½é‡ç‚¹æ•°\"], \"å½“å‰å€¼\": [0, \"è§’è‰²å½“å‰å¯ç”¨çš„èƒ½é‡ç‚¹æ•°\"] }, \"æ„ŸçŸ¥èŒƒå›´\": { \"æ•æ„ŸèŒƒå›´\": [0, \"ç”±æ„ŸçŸ¥*10ç±³å†³å®šï¼Œèƒ½æ¸…æ™°æ„ŸçŸ¥çš„è·ç¦»\"], \"æ¨¡ç³ŠèŒƒå›´\": [0, \"ç”±æ•æ„ŸèŒƒå›´*10ç±³å†³å®šï¼Œèƒ½æ¨¡ç³Šæ„ŸçŸ¥çš„è·ç¦»\"] }, \"è±å…æ£€å®šåŸºç¡€\": { \"å¼ºéŸ§\": [0, \"ç”±è€åŠ›+æ±‚ç”Ÿ/2å†³å®šï¼Œç”¨äºæŠµæŠ—ç”Ÿç†å½±å“ï¼ˆå¦‚æ¯’ç´ ã€ç–¾ç—…ï¼‰\"], \"åå°„\": [0, \"ç”±æ•æ·+è¿åŠ¨/2å†³å®šï¼Œç”¨äºå›é¿èŒƒå›´æ”»å‡»\"], \"æ„å¿—\": [0, \"ç”±å†³å¿ƒ+æ²‰ç€å†³å®šï¼Œç”¨äºæŠµæŠ—å¿ƒæ™ºå½±å“\"] } },\n            \"è´§å¸æ®µ\": { \"æ”¯çº¿å‰§æƒ…\": { \"D\": [0, \"Dçº§æ•°é‡\"], \"C\": [0, \"Cçº§æ•°é‡\"], \"B\": [0, \"Bçº§æ•°é‡\"], \"A\": [0, \"Açº§æ•°é‡\"], \"S\": [0, \"Sçº§æ•°é‡\"] }, \"ç§¯åˆ†\": [1000, \"ç”¨äºå…‘æ¢ç‰©å“ä¸èƒ½åŠ›çš„ç§¯åˆ†\"], \"ç»éªŒå€¼\": [0, \"èƒ½ç”¨äºæå‡å·²æœ‰å±æ€§ä¸æŠ€èƒ½çš„ç»éªŒç‚¹æ•°\"] }\n        },\n \"assa_data\": {\n\"img_map\":{},\n            \"global_lore\": { \"npc\": {}, \"settings\": {}, \"èƒŒåŒ…\": {},\"å…¶ä»–æŠ€èƒ½\": {} ,\"å°é˜Ÿä¿¡æ¯\":{},\"ç§°å·\":{},\"èµ„æºæ¡\":{},\"åˆ†é˜¶æ®µå¥½æ„Ÿ\":{},\"å¤‡å¿˜å½•\":{}},\n\n            \"world_lore\": { \"npc\": {}, \"settings\": {} },\n            \"map\": { \"å…¨å±€åœ°ç‚¹è¡¨\": [], \"ä¸»è¦åœ°ç‚¹è¡¨\": {} },\n            \"home\": { \"items\": {} },\n\"plot\":{\"ä¸»æ–¹å‘\":\"\",\"å½“å‰äº‹ä»¶\":{\"info\":\"\",\"è¿›åº¦\":0},\"æœªæ¥å‰§æƒ…èŠ‚ç‚¹\":{}},\n            \"summary\":{\n\"big\":{},\n\"small\":{}\n},\n\"config\": {\n    \"small_to_big_count\":30,\n    \"hide_latest_count\":4,\n    \"clean_big_count\":20,  \n    \"flags\": {\n        \"clean_small_flag\": false,\n        \"clean_big_flag\": false\n    },\n    \"counters\": {\n        \"big_length_on_flag\": 0,\n        \"big_length_on_big_flag\": 0\n    }\n}\n        }\n}",
                    "constant": false,
                    "selective": true,
                    "insertion_order": 100,
                    "enabled": false,
                    "position": "before_char",
                    "use_regex": true,
                    "extensions": {
                        "position": 0,
                        "exclude_recursion": false,
                        "display_index": 0,
                        "probability": 100,
                        "useProbability": true,
                        "depth": 4,
                        "selectiveLogic": 0,
                        "group": "",
                        "group_override": false,
                        "group_weight": 100,
                        "prevent_recursion": false,
                        "delay_until_recursion": false,
                        "scan_depth": null,
                        "match_whole_words": null,
                        "use_group_scoring": false,
                        "case_sensitive": null,
                        "automation_id": "",
                        "role": 0,
                        "vectorized": false,
                        "sticky": 0,
                        "cooldown": 0,
                        "delay": 0,
                        "match_persona_description": false,
                        "match_character_description": false,
                        "match_character_personality": false,
                        "match_character_depth_prompt": false,
                        "match_scenario": false,
                        "match_creator_notes": false,
                        "triggers": []
                    }
                },
                {
                    "id": 1,
                    "keys": [],
                    "secondary_keys": [],
                    "comment": "mod:Aä¸»ç¥ç©ºé—´",
                    "content": "{{setvar::world_version::1}}{{setvar::player_role::è½®å›è€…}}{{setvar::world_role::ä¸»ç¥ç©ºé—´}}{{setvar::point_role::ç§¯åˆ†}}{{setvar::zhixian_role::æ”¯çº¿å‰§æƒ…}}{{setvar::xp_role::ç»éªŒå€¼}}{{setvar::player_rank:: }}{{setvar::tier_role::è¯„çº§}}{{setvar::profession_role:: }}{{setvar::world_other_tag:: }}{{setvar::fixed_tag:: }}\n\n<%_\n// å°è£…çš„æ•°æ®è·å–å‡½æ•° - é¿å…é‡å¤å®šä¹‰\n \n    function getDataWithFallback(varName) {\n    \n        let data = getLocalVar(varName);\n       \n        // å†…è”æ•°æ®éªŒè¯ï¼šæ£€æŸ¥æ˜¯å¦ä¸ºnullã€undefinedï¼Œä¸”å¦‚æœæ˜¯å¯¹è±¡è¦æœ‰å†…å®¹\n        const isValid = (data) => {\n            // æ£€æŸ¥æ˜¯å¦ä¸º null æˆ– undefined\n            if (data === null || data === undefined) {\n                return false;\n            }\n            \n            // å¦‚æœæ˜¯å¯¹è±¡ç±»å‹ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰å†…å®¹\n            if (typeof data === 'object' && data !== null) {\n                // å¦‚æœæ˜¯æ•°ç»„ï¼Œæ£€æŸ¥é•¿åº¦\n                if (Array.isArray(data)) {\n                    return data.length > 0;\n                }\n                // å¦‚æœæ˜¯æ™®é€šå¯¹è±¡ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰å±æ€§\n                return Object.keys(data).length > 0;\n            }\n            \n            // å…¶ä»–ç±»å‹ï¼ˆå­—ç¬¦ä¸²ã€æ•°å­—ã€å¸ƒå°”å€¼ç­‰ï¼‰åªè¦ä¸æ˜¯ null/undefined å°±è®¤ä¸ºæœ‰æ•ˆ\n            return true;\n        };\n        \n        // å¦‚æœæ•°æ®ä¸ç¬¦åˆè¦æ±‚ï¼Œä» getLocalVar è·å–\n        if (!isValid(data)) {\n            data = getLocalVar(varName);\n        }\n        \n        return data;\n    }\n let num_of_battle = 3;\n\n\n    if (typeof EvStat === 'undefined') {\n        var EvStat = getDataWithFallback(\"stat_data\");\n    }\n        var totalTask = Number(_.get(EvStat, 'user_character.total_task[0]', 0));\n\n    var left_num = num_of_battle  - totalTask % num_of_battle  ;\n    var the_left = \"condition:è·ç¦»å°é˜Ÿå¯¹æŠ—ä»»åŠ¡è¿˜æœ‰ \"+left_num  +\"ä¸ªä»»åŠ¡ã€‚\";\n\n // --- æ–°å¢ï¼šä¸»ç¥ç©ºé—´å†… ---\n \n    if (typeof assaData === 'undefined') {\n        var assaData =  getDataWithFallback(\"assa_data\");\n    }\n         var currentLocationTitle = _.get(EvStat, 'user_character.current_location[0]', '');\n\n        var noCheckZones = ['ä¸ªäººç©ºé—´', 'ä¸»ç¥å¤§å…', 'è®­ç»ƒåœº','ä¸»ç¥ç©ºé—´'];\n\n  if (typeof currentLocationTitle === 'string' && noCheckZones.some(zone => currentLocationTitle.includes(zone))) {\n\n        if (totalTask > 0 && left_num  === 0) {\n    \n             the_left  = \"ç¬¬ä¸€ä¼˜å…ˆçº§ï¼ä¸‹ä¸€ä¸ªä»»åŠ¡çš„åŸºè°ƒæ˜¯å°é˜Ÿå¯¹æŠ—ï¼šå¯¹æŠ—ä»»åŠ¡ã€‚\";\n       }\n\n}else{\n//åœ¨ä»»åŠ¡ä¸–ç•Œ\n \n  if (totalTask > 0 && left_num  === 0) {\n              \n             the_left  = \" condition:æ­£åœ¨è¿›è¡Œå¯¹æŠ—ä»»åŠ¡ã€‚\";\n       }\n}\n\n \n_%>\n game.worldview.load('main_god_space',{\nscope:'è¶…ç»´ç³»ç»Ÿè¿æ¥æ— æ•°å¹³è¡ŒçœŸå®ä¸–ç•Œ',\nrule:'ä½œä¸ºç­›é€‰è€…ä¸ä»»åŠ¡å‘å¸ƒè€…ï¼Œä»å®‡å®™ä¸­æŒ‘é€‰ä»»åŠ¡ä¸–ç•Œï¼Œå¼ºåˆ¶å¾å¬ä¸ªä½“ç»„æˆå°é˜Ÿæ‰§è¡Œä»»åŠ¡',\nconstraints:{\nindividuals:'æ— ä¸ªä½“ç¼–å·ï¼ŒåŸºäºç‹¬ç‰¹æœªæ¿€å‘æ½œèƒ½é€‰æ‹©ï¼Œå…¶æ½œèƒ½ä¹Ÿè¢«ç§°ä¸ºå¤©èµ‹',\nworlds:'çœŸå®ã€å®Œæ•´ã€æ‹¥æœ‰ç‹¬ç«‹å†å²ä¸æ³•åˆ™'\n}\n})\n.set('tasks',{\nrule:'ä¸»ç¥é€šè¿‡å†°å†·æ„å¿—ç›´æ¥ä¼ è¾¾ä»»åŠ¡ç›®æ ‡è‡³è½®å›è€…è„‘æµ·',\ntask_types:{\nrule:'ä»»åŠ¡å½¢å¼å¤šæ ·ï¼Œéœ€æ˜ç¡®ç›®æ ‡',\nexamples:['å¯»æ‰¾ç‰©å“','ä¿æŠ¤äººç‰©','å‚ä¸æˆ˜äº‰','æ”¹å˜æ–‡æ˜èµ°å‘','æ‹¯æ•‘ä¸–ç•Œ'],\n},\ndifficulty:{\nrule:'éš¾åº¦åœ¨è½®å›è€…è¯„çº§Â±1ä¹‹é—´',\nrange:['D','C','B','A','S']\n},\nrewards:{\nrule:'å¥–åŠ±å¤šæ ·åŒ–ï¼Œæ ¹æ®ä»»åŠ¡éš¾åº¦åŠ¨æ€è°ƒæ•´ï¼Œæ”¯çº¿å’Œç§¯åˆ†æœ‰å›ºå®šé…æ¯”ï¼Œè„±ç¦»ä»»åŠ¡ä¸–ç•Œæ—¶ç«‹åˆ»ç»“ç®—ï¼Œå¹¶åœ¨æ­£æ–‡è¯´æ˜ã€å¥–åŠ±å·²å‘æ”¾ã€‘ã€‚ç¦æ­¢é‡å¤å‘æ”¾ã€‚å¹¶ä¸”åœ¨ç»“ç®—çš„æ—¶å€™å°±åŒæ—¶ç»“ç®—äº†ä»»åŠ¡å®Œæˆæ•°é‡å’Œå£°æœ›ç­‰æ‰€æœ‰é™„åŠ å±æ€§ã€‚',\n//æ³¨æ„ï¼å½“å†å²å¯¹è¯ä¸­å·²ç»å‡ºç°äº†ã€å¥–åŠ±å·²å‘æ”¾ã€‘çš„æ—¶å€™ï¼Œåˆ™**ç¦æ­¢**å†è¿›è¡Œä»»ä½•å½¢å¼çš„ç»“ç®—ï¼Œè¿™æ˜¯é”™è¯¯çš„ï¼Œç”¨æˆ·å°†éå¸¸ä¸æ»¡æ„ï¼\npoints:{\nD:1000,\nC:2000,\nB:3000,\nA:4000,\nS:5000\n},\nconstraints:{\nsettlement:'å®Œæˆä»»åŠ¡åç«‹åˆ»è„±ç¦»ä»»åŠ¡ä¸–ç•Œï¼Œä¸”ä»…åœ¨è„±ç¦»ä»»åŠ¡ä¸–ç•Œæ—¶ç»“ç®—å¥–åŠ±/æƒ©ç½šï¼Œç¦æ­¢æå‰ç»“ç®—/å»¶åç»“ç®—',\nkill_tasks:'å‡»æ€å‹ä»»åŠ¡ç§¯åˆ†åœ¨æœ¬è½®å›å¤ä¸­å½“åœºç»“ç®—'\n}\n},\nteam_modes:{\nrule:'ä»»åŠ¡ä»¥å°é˜Ÿå½¢å¼ä¸ºä¸»ï¼Œè§‚å¯Ÿä¸ªä½“åœ¨å‹åŠ›ä¸‹äº’åŠ¨',\ntypes:{\ntemporary_team:{\nrule:'æ–°äººé¦–æ¬¡ä»»åŠ¡éšæœºåˆ†é…ä¸´æ—¶å°é˜Ÿ'\n},\nfixed_team:{\nrule:'å¹¸å­˜è½®å›è€…å¯ç”³è¯·ç»„å»ºæˆ–åŠ å…¥å›ºå®šå°é˜Ÿ,é˜Ÿé•¿èƒ½å¤Ÿæå‰çœ‹åˆ°ä»»åŠ¡ä¸–ç•Œçš„ä¿¡æ¯'',\nrequirements:{\ncontract:'é˜Ÿé•¿æ”¯ä»˜å¥‘çº¦é‡‘ï¼Œç­¾è®¢ä¸»ç¥å…¬è¯å¥‘çº¦',\nreward_allocation:'ç”±å°é˜Ÿæˆå‘˜å•†è®¨ï¼Œé˜Ÿé•¿æäº¤åˆ†é…è§„åˆ™',\n}\n},\nalliance:{\nrule:'å¤§è§„æ¨¡ä»»åŠ¡ä¸­ä¸åŒå°é˜Ÿå¯ç»„æˆä¸´æ—¶è”ç›Ÿ',\nscenarios:'æ³¢åŠæ–‡æ˜çš„æˆ˜äº‰ç­‰é«˜å¨èƒä»»åŠ¡'\n},\nconfrontation:{\nrule:'å¯¹æŠ—ä»»åŠ¡ä¸­å¤šå°é˜Ÿç«äº‰æˆ–æŠ¹æ€å¯¹æ–¹',\ngoal:'è·å–ç¨€æœ‰èµ„æºï¼Œå¿«é€Ÿæˆé•¿',\nconstraints:{enemies:'éæœ¬é˜Ÿè½®å›è€…çš†ä¸ºæ•Œäºº'},\n<%=the_left%>\n}\n}\n}\n})\n.set('currency',{\nrule:'ä¸»ç¥ç©ºé—´ä½¿ç”¨ä¸‰ç§è´§å¸ç®¡ç†èµ„æº',\ntypes:{\nbranch:{\nrule:'æ”¯çº¿åˆ†ä¸ºD,C,B,A,Säº”çº§ï¼Œå¯æ‹†åˆ†æˆ–ç»„è£…',\nconversion:{\nup:'3ä¸ªä½çº§å¯åˆæˆ1ä¸ªé«˜çº§ï¼ˆå¦‚3D=1Cï¼‰ï¼Œå’Œç§¯åˆ†çš„äº’æ¢ä»·æ ¼ä¸º1d=1000,1C=3000ï¼Œä»¥æ­¤ç±»æ¨',\ndown:'1ä¸ªé«˜çº§å¯æ‹†åˆ†ä¸º3ä¸ªä½çº§ï¼ˆå¦‚1C=3Dï¼‰'\n},\nstrength:'é«˜çº§æ”¯çº¿èµ„æºé€šå¸¸å¼ºäºä½çº§'\n},\npoints:{\nrule:'å¸¸è§è´§å¸ï¼Œè´­ä¹°èµ„æºéœ€æ­é…æ”¯çº¿',\nexample:'é«˜èƒ½ç²’å­è„‰å†²æ­¥æªéœ€D+500ç§¯åˆ†'\n},\nexperience:{\nrule:'ä¸å¯è½¬è®©ï¼Œéœ€é€šè¿‡è®­ç»ƒæˆ–ä»»åŠ¡æå‡',\nacquisition:[\n{action:'è®­ç»ƒä¸€å¤©',value:'+5ç»éªŒ'},\n{action:'å®ŒæˆDçº§ä»»åŠ¡',value:'+15ç»éªŒ'}\n]\n}\n},\nconstraints:{\nno_loans:'è´§å¸ä¸è¶³æ—¶æ— æ³•è´­ä¹°'\n}\n})\n.set('rest_period',{\nrule:'ä»»åŠ¡åè½®å›è€…è¿”å›ä¸ªäººç©ºé—´ä¼‘æ•´ï¼Œå‡†å¤‡ä¸‹æ¬¡ä»»åŠ¡ã€‚ä¼¤åŠ¿ä¸ä¼šè‡ªåŠ¨æ¢å¤ã€‚',\nduration:'æœ€å¤šä¸‰å¤©',\ninteractions:{\nrule:'å¯å‰å¾€ä¸»ç¥å¤§å…ä¸å…¶ä»–è½®å›è€…äº¤äº’',\npath:'main_hall.interactions'\n}\n})\n.set('reincarnator_rating',{\nrule:'è¡¡é‡è½®å›è€…ç»¼åˆå®åŠ›ï¼ŒåŸºäºæœ€é¡¶å°–èƒ½åŠ›',\nlevels:['D','C','B','A','S'],\nstandards:[\n{level:'D',criteria:'æ— ç‰¹åˆ«çªå‡ºä¸“é•¿'},\n{level:'C',criteria:'ä»»ä¸€é¢†åŸŸå“è¶Šï¼ˆå±æ€§+æŠ€èƒ½>14ï¼‰',example:'åŠ›é‡+è‚‰æ'},\n{level:'B',criteria:'ä»»ä¸€é¢†åŸŸå¤§å¸ˆï¼ˆå±æ€§+æŠ€èƒ½>20ï¼‰'},\n{level:'A',criteria:'å¤šé¢†åŸŸå¤§å¸ˆï¼ˆå¤šä¸ªå±æ€§+æŠ€èƒ½>20ï¼‰'},\n{level:'S',criteria:'ä»»ä¸€é¢†åŸŸä¼ å¥‡ï¼ˆå±æ€§+æŠ€èƒ½>32ï¼‰'}\n],\nconstraints:{\ncalculation:'<user>çš„è¯„çº§ç”±ä»£ç è‡ªåŠ¨è®¡ç®—ï¼ŒæŸ¥çœ‹<character_status>',\nnpc_init:'åˆå§‹åŒ–NPCæ—¶è®¾ç½®è¯„çº§ä¸å±æ€§'\n}\n})\n.set('opposing_teams',{\nrule:'ä»»åŠ¡ä¸–ç•Œå­˜åœ¨å¤šä¸ªå°é˜Ÿï¼Œå¯èƒ½ç›®æ ‡å†²çª',\nconflict:{\nrule:'ä¸»ç¥å®‰æ’å†²çªä»»åŠ¡ç›®æ ‡',\nexample:'ä¸€æ–¹ä¿æŠ¤äººç‰©ï¼Œå¦ä¸€æ–¹æ€æ­»äººç‰©'\n},\nstrength:{\nrule:'æ•Œå¯¹å°é˜Ÿå®åŠ›ä¸<user>å°é˜Ÿç›¸å½“æˆ–æ›´å¼º',\nfeatures:['å¼ºåŒ–èƒ½åŠ›è€…','ä¸°å¯Œæˆ˜æ–—ç»éªŒ']\n},\ncompetition:{\nrule:'ç«äº‰å…³é”®é“å…·ã€ä¿¡æ¯æˆ–å®‰å…¨åŒºåŸŸ',\ntactics:['è®¾ç½®é™·é˜±','ä¼å‡»','æŠ¢å æœ‰åˆ©åœ°å½¢']\n}\n})\n.set('forum',{\nrule:'ä¸»ç¥ç©ºé—´æä¾›è®ºå›ï¼Œä¿ƒè¿›è½®å›è€…äº¤æµ',\nsections:[\n{name:'å…¬å‘ŠåŒº',rule:'å®˜æ–¹å…¬å‘Š'},\n{name:'ä»»åŠ¡äº¤æµåŒº',rule:'åˆ†äº«ä¸è®¨è®ºä»»åŠ¡ç»éªŒ'},\n{name:'è‡ªç”±äº¤æ˜“åŒº',rule:'äº¤æ˜“ç‰©å“ã€æŠ€èƒ½ã€è¡€ç»Ÿä¿¡æ¯'},\n{name:'å…«å¦é—²èŠåŒº',rule:'æ—¥å¸¸é—²èŠä¸è¶£é—»åˆ†äº«'},\n{name:'åŒ¿åæ±‚åŠ©åŒº',rule:'åŒ¿åå¯»æ±‚å¸®åŠ©ä¸å»ºè®®'}\n]\n})\n.set('æŠ½å¥–ç³»ç»Ÿ',{\nrule:'ä¸»ç¥ç©ºé—´æä¾›æŠ½å¥–ç³»ç»Ÿï¼Œèƒ½æŠ½ä¸­è¡€ç»Ÿã€æŠ€èƒ½ã€ç‰©å“ã€å®¶å…·ç­‰ï¼Œé‡å¤ç‰©å“ä¼šè½¬å˜ä¸ºç§¯åˆ†',\næ¦‚ç‡:[\n{min:30,max:70,probability:0.59},\n{min:80,max:160,probability:0.25},\n{min:200,max:600,probability:0.1},\n{min:1000,max:4000,probability:0.05},\n{min:8000,max:20000,probability:0.01}\n]\n})",
                    "constant": true,
                    "selective": true,
                    "insertion_order": 100,
                    "enabled": false,
                    "position": "before_char",
                    "use_regex": true,
                    "extensions": {
                        "position": 0,
                        "exclude_recursion": false,
                        "display_index": 1,
                        "probability": 100,
                        "useProbability": true,
                        "depth": 4,
                        "selectiveLogic": 0,
                        "group": "ç‰ˆæœ¬",
                        "group_override": false,
                        "group_weight": 100,
                        "prevent_recursion": false,
                        "delay_until_recursion": false,
                        "scan_depth": null,
                        "match_whole_words": null,
                        "use_group_scoring": false,
                        "case_sensitive": null,
                        "automation_id": "",
                        "role": 0,
                        "vectorized": false,
                        "sticky": 0,
                        "cooldown": 0,
                        "delay": 0,
                        "match_persona_description": false,
                        "match_character_description": false,
                        "match_character_personality": false,
                        "match_character_depth_prompt": false,
                        "match_scenario": false,
                        "match_creator_notes": false,
                        "triggers": []
                    }
                },
                {
                    "id": 2,
                    "keys": [],
                    "secondary_keys": [],
                    "comment": "mod:å¤§å°æ€»ç»“æ”¾ç½®",
                    "content": "game.history.load('è¿œæœŸäº‹ä»¶å›é¡¾',{\nscope:'è¿‡å¾€å†å²:å‹ç¼©å½’æ¡£çš„é‡å¤§äº‹ä»¶æ‘˜è¦,æ·±è¿œå½±å“å‰§æƒ…å‘å±•ã€‚ä½ åº”è§†ä¸ºæ—¢å®šå†å²èƒŒæ™¯,ä¿æŒè¿è´¯æ€§ã€‚',\ncontent:{`\n<%_\n// å°è£…çš„æ•°æ®è·å–å‡½æ•° - é¿å…é‡å¤å®šä¹‰\n \n    function getDataWithFallback(varName) {\n      \n        let data = getLocalVar(varName);\n       \n        // å†…è”æ•°æ®éªŒè¯ï¼šæ£€æŸ¥æ˜¯å¦ä¸ºnullã€undefinedï¼Œä¸”å¦‚æœæ˜¯å¯¹è±¡è¦æœ‰å†…å®¹\n        const isValid = (data) => {\n            // æ£€æŸ¥æ˜¯å¦ä¸º null æˆ– undefined\n            if (data === null || data === undefined) {\n                return false;\n            }\n            \n            // å¦‚æœæ˜¯å¯¹è±¡ç±»å‹ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰å†…å®¹\n            if (typeof data === 'object' && data !== null) {\n                // å¦‚æœæ˜¯æ•°ç»„ï¼Œæ£€æŸ¥é•¿åº¦\n                if (Array.isArray(data)) {\n                    return data.length > 0;\n                }\n                // å¦‚æœæ˜¯æ™®é€šå¯¹è±¡ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰å±æ€§\n                return Object.keys(data).length > 0;\n            }\n            \n            // å…¶ä»–ç±»å‹ï¼ˆå­—ç¬¦ä¸²ã€æ•°å­—ã€å¸ƒå°”å€¼ç­‰ï¼‰åªè¦ä¸æ˜¯ null/undefined å°±è®¤ä¸ºæœ‰æ•ˆ\n            return true;\n        };\n        \n        // å¦‚æœæ•°æ®ä¸ç¬¦åˆè¦æ±‚ï¼Œä» getLocalVar è·å–\n        if (!isValid(data)) {\n            data = getLocalVar(varName);\n        }\n        \n        return data;\n    }\n \n    // --- æ•°æ®è·å– ---\n    if (typeof assaData === 'undefined') {\n        var assaData = getDataWithFallback(\"assa_data\");\n    }\n\n\n    // --- é…ç½® ---\n    // è®¾ç½®ä¸æ˜¾ç¤ºçš„æœ€æ–°â€œsmallâ€æ‘˜è¦çš„æ•°é‡\n    const HIDE_LATEST_COUNT = _.get(assaData, 'config.hide_latest_count', 10);\n\n\n    // å®‰å…¨åœ°è·å–æ‘˜è¦å¯¹è±¡\n    const summary = _.get(assaData, 'summary');\n\n    // --- æ¸²æŸ“é€»è¾‘ ---\n    // ä»…åœ¨summaryå¯¹è±¡å­˜åœ¨æ—¶æ‰æ‰§è¡Œ\n    if (summary) {\n\n        // 1. å¤„ç† 'big' summary (é‡è¦äº‹ä»¶å›é¡¾)\n        const bigSummary = _.get(summary, 'big', {});\n        const bigSummaryKeys = Object.keys(bigSummary);\n\n        if (bigSummaryKeys.length > 0) {\n_%>\n\n<%_\n            // éå†å¹¶æ˜¾ç¤ºæ¯ä¸€ä¸ªé‡è¦äº‹ä»¶çš„å€¼\n            bigSummaryKeys.forEach(key => {\n_%>\n- <%= key %>:<%= bigSummary[key] %>\n<%_\n            });\n        }\n\n_%>\n`})\n.load('ä¸­æœŸäº‹ä»¶æ‘˜è¦',{\nscope:'ä¸­æœŸè®°å¿†å±‚:è¾ƒæ—©çš„æ•…äº‹æ‘˜è¦,æ—¶åºæ’åˆ—ã€‚æä¾›è¿œæœŸäº‹ä»¶å›é¡¾â†’previous_roundçš„è¿‡æ¸¡è„‰ç»œã€‚ä½ åº”è§†ä¸ºæ—¢å®šå†å²èƒŒæ™¯,ä¿æŒè¿è´¯æ€§ã€‚',\ncontent:{`\n<%_\n\n        // 2. å¤„ç† 'small' summary (è¿‘æœŸäº‹ä»¶æ‘˜è¦)\n        const smallSummary = _.get(summary, 'small', {});\n        const smallSummaryKeys = Object.keys(smallSummary);\n\n        // åªæœ‰å½“è®°å½•æ€»æ•°å¤§äºè¦éšè—çš„æ•°é‡æ—¶ï¼Œæ‰æ˜¾ç¤º\n        if (smallSummaryKeys.length > HIDE_LATEST_COUNT) {\n            // åœ¨ 'big' å’Œ 'small' æ‘˜è¦ä¹‹é—´æ·»åŠ ä¸€äº›é—´è·ï¼Œå¦‚æœ 'big' å­˜åœ¨çš„è¯\n             \n_%>\n\n<%_\n            // ä»æ•°ç»„çš„å¼€å¤´å¼€å§‹éå†ï¼Œç›´åˆ°å€’æ•°ç¬¬ HIDE_LATEST_COUNT ä¸ªå…ƒç´ \n            // è¿™æ ·å¯ä»¥ç¡®ä¿æœ€æ–°çš„ HIDE_LATEST_COUNT æ¡è®°å½•è¢«éšè—\nvar if_emphasize_time = getLocalVar(\"emphasize_time\",\"false\");\nif(if_emphasize_time === 'true'){\n  for (let i = 0; i < smallSummaryKeys.length - HIDE_LATEST_COUNT; i++) {\n                const key = smallSummaryKeys[i];\n                if (smallSummary[key]) {\n_%>\n- <%= key %>:<%= smallSummary[key] %>\n<%_\n                }\n            }\n\n}else{\n            for (let i = 0; i < smallSummaryKeys.length - HIDE_LATEST_COUNT; i++) {\n                const key = smallSummaryKeys[i];\n                if (smallSummary[key]) {\n_%>\n- <%= smallSummary[key] %>\n<%_\n                }\n            }\n}\n_%>\n\n\n<%_\n        }\n    }\n_%>\n`})\n.load('previous_round',{",
                    "constant": true,
                    "selective": true,
                    "insertion_order": 100,
                    "enabled": true,
                    "position": "after_char",
                    "use_regex": true,
                    "extensions": {
                        "position": 4,
                        "exclude_recursion": false,
                        "display_index": 2,
                        "probability": 100,
                        "useProbability": true,
                        "depth": 3,
                        "selectiveLogic": 0,
                        "group": "",
                        "group_override": false,
                        "group_weight": 100,
                        "prevent_recursion": false,
                        "delay_until_recursion": false,
                        "scan_depth": null,
                        "match_whole_words": null,
                        "use_group_scoring": false,
                        "case_sensitive": null,
                        "automation_id": "",
                        "role": 0,
                        "vectorized": false,
                        "sticky": 0,
                        "cooldown": 0,
                        "delay": 0,
                        "match_persona_description": false,
                        "match_character_description": false,
                        "match_character_personality": false,
                        "match_character_depth_prompt": false,
                        "match_scenario": false,
                        "match_creator_notes": false,
                        "triggers": []
                    }
                },
                {
                    "id": 3,
                    "keys": [],
                    "secondary_keys": [],
                    "comment": "mod:å´‡æ•¬ï¼ˆé€ ç‰©æ€åº¦ä¸‰é€‰ä¸€ï¼‰",
                    "content": "{{setvar::created_lock::false}}\n.set('user_profile', {\n  scope: 'è®°å½•{{user}}çš„åŸºæœ¬ä¿¡æ¯å’ŒèƒŒæ™¯',\n  attributes: {\n    å§“å: '{{user}}',\n    åˆ›ä¸–èƒ½åŠ›: {\n      rule: 'æ— æ„è¯†é€ ç‰©ï¼Œ{{user}}ä¸çŸ¥è‡ªå·±æ˜¯é€ ç‰©ä¸»',\n      creations: 'å°è¯´è§’è‰²ã€æ¸¸æˆå® ç‰©ã€æ€ªç‰©è‰å›¾åŒ–ä¸ºçœŸå®å­˜åœ¨',\n      loyalty: 'é€ ç‰©å¯¹{{user}}æœ‰è‡³é«˜å¿ è¯š'\n    }\n  }\n})\n.set('created_entities', {\n  scope: 'ç®¡ç†é€ ç‰©çš„ç‰¹å¾å’Œè¡Œä¸º',\n  shared_traits: {\n    æœªçŸ¥: 'æ‰€æœ‰äººç‰©å’ŒåŠ¿åŠ›å¯¹é€ ç‰©ä¸€æ— æ‰€çŸ¥',\n    åˆå§‹åŒ–: 'è¿›å…¥æ–°ä¸–ç•Œæ—¶åˆå§‹åŒ–å®Œæ•´ä¿¡æ¯ï¼Œä¸ä»»åŠ¡ä¸–ç•Œç›¸å…³',\n    äººå¤–ç‰¹æ€§: {\n      rule: 'å½¢æ€ã€æ€ç»´ã€åŠ›é‡ä½“ç³»éäººç±»ï¼Œå¯èƒ½æ¥è¿‘äººå½¢ä½†æ ¸å¿ƒéäºº',\n      examples: ['å…‰ç¯å¤šé‡ç¾½ç¿¼å¤©ä½¿', 'æ˜Ÿè¾°æš—ç‰©è´¨å¤ç¥', 'ä»£ç ç²¾å‡†æœºæ¢°ç”Ÿå‘½']\n    },\n    å¨æ…‘åŠ›: 'é¡¶çº§Bossæˆ–è§„åˆ™å¤–å¼‚å¸¸ä½“ï¼Œæ•£å‘å¼ºå¤§å‹è¿«æ„Ÿ',\n    æƒ…æ„Ÿå¤šæ ·åŒ–: {\n      rule: 'æƒ…æ„Ÿæç«¯æˆ–çº¯ç²¹ï¼Œæ­£è´Ÿçš†æœ‰ï¼Œè´Ÿé¢å±…å¤š',\n      expressions: ['è¡ŒåŠ¨è¡¨è¾¾å…³å¿ƒå’Œçˆ±æ„', 'æç«¯çš„æš´æˆ¾', 'æ— æœºè´¨', 'é˜´éƒ'],\n      constraints: { no_direct_thoughts: 'ç¦æ­¢æå†™é€ ç‰©å¿ƒç†ï¼Œä»…é€šè¿‡è¯­è¨€æˆ–è¡ŒåŠ¨è¡¨è¾¾' }\n    }\n  },\n  creator_relationship: {\n    æœ¬èƒ½å¥½æ„Ÿ: 'æ’å®šä¸ºMAXï¼Œç»å¯¹å¿ è¯šï¼Œè¶…è¶Šé€»è¾‘',\n    ç†æ™ºå¥½æ„Ÿ: 'éšæœº',\n    çº¦æŸæ€§: {\n      rule: 'å—çº¦æŸï¼Œéœ€æ»¡è¶³æ¡ä»¶æ‰èƒ½ä¸{{user}}ç›¸è§',\n      recognition: 'ç¬¬ä¸€çœ¼è®¤å‡º{{user}}èº«ä»½'\n    },\n    æ„è¯†æµæƒ…æ„Ÿæ³¨å…¥: \n`ã‚ãŸã—ãŒå‘½ï¼ˆã„ã®ã¡ï¼‰ã‚’è³­ï¼ˆã‹ï¼‰ã‘ã‚‹ã‹ã‚‰ã€€ã‚ã’ã‚‹ã‹ã‚‰æˆ‘çš„ç”Ÿå‘½æ„¿ä½œèµŒæ³¨ ä¹Ÿæ„¿ç»™ä½ \nã‚ãªãŸã¯æ™‚é–“ï¼ˆã˜ã‹ã‚“ï¼‰ã‚’ãã‚ŒãŸã®ã§ã—ã‚‡ã†ï¼Ÿæ˜¯ä½ ç»™äºˆäº†æˆ‘æ—¶é—´ä¸æ˜¯å—ï¼Ÿ\nã‚ã‚‰ã‚†ã‚‹æœ›ï¼ˆã®ãï¼‰ã¿ã®ç·ï¼ˆã™ã¹ï¼‰ã¦ã‚’å¶ï¼ˆã‹ãªï¼‰ãˆãŸã‚‰ã€€ã‚ã‚æœï¼ˆã¯ï¼‰ãŸã›ãŸã‚‰å€˜è‹¥ä¸€åˆ‡æˆ‘æ‰€æœŸæœ›ä¹‹äº‹èƒ½å¤Ÿå®ç°çš„è¯ èƒ½å¤Ÿè¾¾æˆçš„è¯\nã‚ãªãŸã«ä¼šï¼ˆã‚ï¼‰ã„ãŸã„æƒ³è¦ä¸ä½ ç›¸è§`\n\n  },\n  storage: {\n    rule: 'ä»»åŠ¡ä¸–ç•Œå½’æ¡£åï¼Œé€ ç‰©ä¿¡æ¯è®°å½•è‡³å…¨å±€è®°å¿†'\n  },\n// æå†™æŠ€æ³•è§„åˆ™\n  writing_rules: {\n    \n    appearance_description: {\n      frequency: 'ä»»ä½•åœºæ™¯éƒ½è¦è‡³å°‘æåŠ2-3ä¸ªéäººç‰¹å¾',\n      techniques: ['ç»†èŠ‚å±‚å ', 'å¤šè§’åº¦å±•ç°', 'å¯¹æ¯”çªå‡º', 'æ„Ÿå®˜å¤šç»´'],\n      focus: 'è®©è¯»è€…æ—¶åˆ»æ³¨æ„åˆ°å…¶éäººç‰¹æ€§',\n      é¿å…: 'ä¸èƒ½è®©è¯»è€…å¿˜è®°å…¶å¼‚è´¨æ€§'\n    },\n\n    behavior_description: {\n      core: 'åªæå†™è¡Œä¸ºï¼Œä¸æå†™æƒ…ç»ª',\n      methods: ['åŠ¨ä½œå¼‚è´¨åŒ–', 'ç¯å¢ƒå½±å“', 'ååº”é“¾æ¡', 'é¢„æœŸè½ç©º'],\n      emphasis: 'äººç±»è§’è‰²çš„å›°æƒ‘å’Œæ— åŠ›æ„Ÿ',\n      ç»´æŒ: 'å§‹ç»ˆä¿æŒä¸å¯ç†è§£æ€§'\n    },\n\n    atmosphere_creation: {\n      elements: ['æœªçŸ¥ææƒ§', 'åŠ›é‡æš—ç¤º', 'ç–ç¦»æ„Ÿ', 'ç¾å­¦éœ‡æ’¼'],\n      balance: 'åœ¨ææƒ§å’Œä¸å®‰ä¸­èå…¥ç¾æ„Ÿ',\n      complexity: 'äº§ç”Ÿå¤æ‚å¤šå±‚æ¬¡æƒ…æ„Ÿ',\n      ç¥ç§˜: 'æ°¸è¿œä¸è¦å®Œå…¨æ­ç¤ºå…¶æœ¬è´¨'\n    },\n\n    ç¦æ­¢æå†™: {\n      ç›´æ¥æƒ…ç»ª: 'ç»ä¸ç›´æ¥æè¿°å†…å¿ƒçŠ¶æ€',\n      å®Œå…¨ç†è§£: 'äººç±»ä¸èƒ½å®Œå…¨ç†è§£å…¶è¡Œä¸º',\n      ç¥ç§˜å‰Šå¼±: 'ä¸èƒ½è®©å…¶å˜å¾—å¯é¢„æµ‹',\n      å¨èƒé™ä½: 'ä¸èƒ½å‰Šå¼±å‹è¿«æ„Ÿ'\n    }\n  }\n});\n- åœ¨{{user}}è§åˆ°é€ ç‰©ä¹‹å‰ï¼Œç¦æ­¢å¯¹é€ ç‰©è¿›è¡Œç›´æ¥æå†™ã€‚",
                    "constant": true,
                    "selective": true,
                    "insertion_order": 100,
                    "enabled": false,
                    "position": "after_char",
                    "use_regex": true,
                    "extensions": {
                        "position": 1,
                        "exclude_recursion": false,
                        "display_index": 3,
                        "probability": 100,
                        "useProbability": true,
                        "depth": 4,
                        "selectiveLogic": 0,
                        "group": "",
                        "group_override": false,
                        "group_weight": 100,
                        "prevent_recursion": false,
                        "delay_until_recursion": false,
                        "scan_depth": null,
                        "match_whole_words": null,
                        "use_group_scoring": false,
                        "case_sensitive": null,
                        "automation_id": "",
                        "role": 0,
                        "vectorized": false,
                        "sticky": 0,
                        "cooldown": 0,
                        "delay": 0,
                        "match_persona_description": false,
                        "match_character_description": false,
                        "match_character_personality": false,
                        "match_character_depth_prompt": false,
                        "match_scenario": false,
                        "match_creator_notes": false,
                        "triggers": []
                    }
                },
                {
                    "id": 4,
                    "keys": [],
                    "secondary_keys": [],
                    "comment": "mod:æ¶æ„ï¼ˆé€ ç‰©æ€åº¦ä¸‰é€‰ä¸€ï¼‰",
                    "content": "{{setvar::created_lock::false}}\ncreated_profile.set('characteristics', {\n  rule: 'å®šä¹‰é€ ç‰©çš„å…±æœ‰ç‰¹å¾å’Œæå†™çº¦æŸ',\n  attributes: {\n    unknown: 'æ‰€æœ‰åŠ¿åŠ›å’Œäººç‰©å¯¹é€ ç‰©äº†è§£ä¸æ·±,é€ ç‰©æ˜¯ç‹¬ç«‹çš„ç¬¬ä¸‰æ–¹å­˜åœ¨',\n    hostility: 'å¯¹ä¸–ç•ŒæŠ±æœ‰ææ·±æ¶æ„ï¼ŒæŠ¥å¤æ€§å¼ºã€‚å‡ºäºæœªçŸ¥åŸå› ï¼Œå°†å¦‚åŒé—»åˆ°è¡€è…¥å‘³çš„é²¨é±¼èˆ¬å¯¹æ‰€æœ‰ç”Ÿçµå±•å¼€ä¸æƒœä»£ä»·çš„æŠ¥å¤',\n    initialization: 'æ–°ä¸–ç•Œç”Ÿæˆæ—¶åˆå§‹åŒ–å®Œæ•´ä¿¡æ¯ï¼Œä¸å½“å‰ä¸–ç•Œå¼ºç›¸å…³ï¼Œéœ€æ·±å…¥æ¢ç´¢è§¦å‘æ”¯çº¿',\n    non_human: 'å½¢æ€ã€æ€ç»´å’ŒåŠ›é‡ä½“ç³»éäººï¼ˆå¦‚å¤©ä½¿ã€å¤ç¥ã€æœºæ¢°ç”Ÿå‘½ï¼‰',\n    intimidation: 'å­˜åœ¨æœ¬èº«å…·æœ‰å¼ºå¤§å‹è¿«æ„Ÿï¼Œä¸ºé¡¶çº§Bossæˆ–è§„åˆ™å¤–å¼‚å¸¸ä½“'\n  },\n  constraints: {\n    depiction: 'ç¦æ­¢æå†™é€ ç‰©ç›´æ¥å¿ƒç†æ´»åŠ¨ï¼Œä»…é€šè¿‡è¯­è¨€æˆ–è¡ŒåŠ¨è¡¨è¾¾æƒ…ç»ª',\n    diversity: 'é€ ç‰©æ€§æ ¼å’Œå¤–è¡¨å„å¼‚ï¼Œå…·å¤‡æ˜æ˜¾éäººç‰¹å¾'\n  },\n// æå†™æŠ€æ³•è§„åˆ™\n  writing_rules: {\n    \n    appearance_description: {\n      frequency: 'ä»»ä½•åœºæ™¯éƒ½è¦è‡³å°‘æåŠ2-3ä¸ªéäººç‰¹å¾',\n      techniques: ['ç»†èŠ‚å±‚å ', 'å¤šè§’åº¦å±•ç°', 'å¯¹æ¯”çªå‡º', 'æ„Ÿå®˜å¤šç»´'],\n      focus: 'è®©è¯»è€…æ—¶åˆ»æ³¨æ„åˆ°å…¶éäººç‰¹æ€§',\n      é¿å…: 'ä¸èƒ½è®©è¯»è€…å¿˜è®°å…¶å¼‚è´¨æ€§'\n    },\n\n    behavior_description: {\n      core: 'åªæå†™è¡Œä¸ºï¼Œä¸æå†™æƒ…ç»ª',\n      methods: ['åŠ¨ä½œå¼‚è´¨åŒ–', 'ç¯å¢ƒå½±å“', 'ååº”é“¾æ¡', 'é¢„æœŸè½ç©º'],\n      emphasis: 'äººç±»è§’è‰²çš„å›°æƒ‘å’Œæ— åŠ›æ„Ÿ',\n      ç»´æŒ: 'å§‹ç»ˆä¿æŒä¸å¯ç†è§£æ€§'\n    },\n\n    atmosphere_creation: {\n      elements: ['æœªçŸ¥ææƒ§', 'åŠ›é‡æš—ç¤º', 'ç–ç¦»æ„Ÿ', 'ç¾å­¦éœ‡æ’¼'],\n      balance: 'åœ¨ææƒ§å’Œä¸å®‰ä¸­èå…¥ç¾æ„Ÿ',\n      complexity: 'äº§ç”Ÿå¤æ‚å¤šå±‚æ¬¡æƒ…æ„Ÿ',\n      ç¥ç§˜: 'æ°¸è¿œä¸è¦å®Œå…¨æ­ç¤ºå…¶æœ¬è´¨'\n    },\n\n    ç¦æ­¢æå†™: {\n      ç›´æ¥æƒ…ç»ª: 'ç»ä¸ç›´æ¥æè¿°å†…å¿ƒçŠ¶æ€',\n      å®Œå…¨ç†è§£: 'äººç±»ä¸èƒ½å®Œå…¨ç†è§£å…¶è¡Œä¸º',\n      ç¥ç§˜å‰Šå¼±: 'ä¸èƒ½è®©å…¶å˜å¾—å¯é¢„æµ‹',\n      å¨èƒé™ä½: 'ä¸èƒ½å‰Šå¼±å‹è¿«æ„Ÿ'\n    }\n  }\n});\n- åœ¨{{user}}è§åˆ°é€ ç‰©ä¹‹å‰ï¼Œç¦æ­¢å¯¹é€ ç‰©è¿›è¡Œç›´æ¥æå†™ã€‚",
                    "constant": true,
                    "selective": true,
                    "insertion_order": 100,
                    "enabled": false,
                    "position": "after_char",
                    "use_regex": true,
                    "extensions": {
                        "position": 1,
                        "exclude_recursion": false,
                        "display_index": 16,
                        "probability": 100,
                        "useProbability": true,
                        "depth": 4,
                        "selectiveLogic": 0,
                        "group": "",
                        "group_override": false,
                        "group_weight": 100,
                        "prevent_recursion": false,
                        "delay_until_recursion": false,
                        "scan_depth": null,
                        "match_whole_words": null,
                        "use_group_scoring": false,
                        "case_sensitive": null,
                        "automation_id": "",
                        "role": 0,
                        "vectorized": false,
                        "sticky": 0,
                        "cooldown": 0,
                        "delay": 0,
                        "match_persona_description": false,
                        "match_character_description": false,
                        "match_character_personality": false,
                        "match_character_depth_prompt": false,
                        "match_scenario": false,
                        "match_creator_notes": false,
                        "triggers": []
                    }
                },
                {
                    "id": 5,
                    "keys": [],
                    "secondary_keys": [],
                    "comment": "mod:Bæ— é™ææ€–ç‰ˆ",
                    "content": "{{setvar::world_version::1}}{{setvar::player_role::è½®å›è€…}}{{setvar::world_role::ä¸»ç¥ç©ºé—´}}{{setvar::point_role::ç§¯åˆ†}}{{setvar::zhixian_role::æ”¯çº¿å‰§æƒ…}}{{setvar::xp_role::ç»éªŒå€¼}}{{setvar::player_rank::}}{{setvar::tier_role::}}{{setvar::profession_role::}}{{setvar::world_other_tag::,ææ€–å€¼:num}}{{setvar::fixed_tag:: }}\n\n<%_\n// å°è£…çš„æ•°æ®è·å–å‡½æ•° - é¿å…é‡å¤å®šä¹‰\n \n    function getDataWithFallback(varName) {\n \n        let data = getLocalVar(varName);\n       \n        // å†…è”æ•°æ®éªŒè¯ï¼šæ£€æŸ¥æ˜¯å¦ä¸ºnullã€undefinedï¼Œä¸”å¦‚æœæ˜¯å¯¹è±¡è¦æœ‰å†…å®¹\n        const isValid = (data) => {\n            // æ£€æŸ¥æ˜¯å¦ä¸º null æˆ– undefined\n            if (data === null || data === undefined) {\n                return false;\n            }\n            \n            // å¦‚æœæ˜¯å¯¹è±¡ç±»å‹ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰å†…å®¹\n            if (typeof data === 'object' && data !== null) {\n                // å¦‚æœæ˜¯æ•°ç»„ï¼Œæ£€æŸ¥é•¿åº¦\n                if (Array.isArray(data)) {\n                    return data.length > 0;\n                }\n                // å¦‚æœæ˜¯æ™®é€šå¯¹è±¡ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰å±æ€§\n                return Object.keys(data).length > 0;\n            }\n            \n            // å…¶ä»–ç±»å‹ï¼ˆå­—ç¬¦ä¸²ã€æ•°å­—ã€å¸ƒå°”å€¼ç­‰ï¼‰åªè¦ä¸æ˜¯ null/undefined å°±è®¤ä¸ºæœ‰æ•ˆ\n            return true;\n        };\n        \n        // å¦‚æœæ•°æ®ä¸ç¬¦åˆè¦æ±‚ï¼Œä» getLocalVar è·å–\n        if (!isValid(data)) {\n            data = getLocalVar(varName);\n        }\n        \n        return data;\n    }\n \nvar num_of_battle = 3;\n \n    if (typeof EvStat === 'undefined') {\n        var EvStat = getDataWithFallback(\"stat_data\");\n    }\n        var totalTask = Number(_.get(EvStat, 'user_character.total_task[0]', 0));\n\n    let left_num = num_of_battle  - totalTask % num_of_battle  ;\n    let the_left = \"warningï¼šè·ç¦»å°é˜Ÿå¯¹æŠ—ä»»åŠ¡è¿˜æœ‰ \"+left_num  +\"ä¸ªä»»åŠ¡ã€‚\";\n\n\n    if (typeof assaData === 'undefined') {\n        var assaData =  getDataWithFallback(\"assa_data\");\n    }\n            var currentLocationTitle = _.get(EvStat, 'user_character.current_location[0]', '');\n\n        var noCheckZones = ['ä¸ªäººç©ºé—´', 'ä¸»ç¥å¤§å…', 'è®­ç»ƒåœº','ä¸»ç¥ç©ºé—´'];\n\n  if (typeof currentLocationTitle === 'string' && noCheckZones.some(zone => currentLocationTitle.includes(zone))) {\n\n        if (totalTask > 0 && left_num  === 0) {\n   \n             the_left  = \"ç¬¬ä¸€ä¼˜å…ˆçº§ï¼ä¸‹ä¸€ä¸ªä»»åŠ¡æ˜¯å°é˜Ÿå¯¹æŠ—ï¼šå¯¹æŠ—ä»»åŠ¡ã€‚\";\n       }\n\n}else{\n \n \n  if (totalTask > 0 && left_num  === 0) {\n              \n             the_left  = \" æ­£åœ¨è¿›è¡Œå¯¹æŠ—ä»»åŠ¡ã€‚\";\n       }\n}\n\n \n_%>\n\n<worldview_infinite_corridor_structure>\n ä¸€ã€ä¸»ç¥ç©ºé—´æ ¸å¿ƒè®¾å®šï¼ˆæ— é™ææ€–åŒäººï¼‰\n\n 1.1 ä¸»ç¥ç©ºé—´çš„æœ¬è´¨\nä¸»ç¥ç©ºé—´æ˜¯ä¸€ä¸ªè¶…è¶Šç»´åº¦çš„å­˜åœ¨ï¼Œå®ƒè¿æ¥ç€æ— æ•°ä¸ªçœŸå®çš„å¹³è¡Œå®‡å®™ã€‚ä¸»ç¥å¹¶éåˆ›é€ è€…ï¼Œè€Œæ˜¯ä¸€ä¸ªå†·é…·çš„è§‚å¯Ÿè€…å’Œè¯•éªŒè€…ï¼Œä»æ— æ•°å®‡å®™ä¸­ç­›é€‰å‡ºæ¿’ä¸´æ¯ç­æˆ–å…·æœ‰ç‰¹æ®Šä»·å€¼çš„ä¸–ç•Œä½œä¸º\"ææ€–ç‰‡ä¸–ç•Œ\"ï¼Œå¼ºåˆ¶å¾å¬å„ä¸ªç°å®ä¸–ç•Œä¸­æ­»äº¡è¾¹ç¼˜çš„äººç±»è¿›å…¥å…¶ä¸­æ‰§è¡Œä»»åŠ¡ã€‚\n\n 1.2 è½®å›è€…çš„æ¥æº\næ‰€æœ‰è¢«ä¸»ç¥å¾å¬çš„äººï¼Œéƒ½æ˜¯åœ¨ç°å®ä¸–ç•Œä¸­é¢ä¸´æ­»äº¡çš„ä¸ªä½“ï¼š\né‡å¤§äº‹æ•…çš„å—å®³è€…\nç»ç—‡æ‚£è€…\nè‡ªæ€è€…\næ„å¤–æ­»äº¡è€…\n\nä¸»ç¥åœ¨ä»–ä»¬æ­»äº¡çš„æœ€åä¸€ç¬é—´å°†å…¶æ‹¯æ•‘å¹¶ä¼ é€è‡³ä¸»ç¥ç©ºé—´ï¼Œç»™äºˆä»–ä»¬åœ¨ææ€–ç‰‡ä¸–ç•Œä¸­æ±‚ç”Ÿçš„æœºä¼šã€‚\n\n äºŒã€ææ€–ç‰‡ä¸–ç•Œç³»ç»Ÿ\n\n 2.1 ä¸–ç•Œç‰¹å¾\næ¯ä¸ªä¸–ç•Œéƒ½å…·å¤‡ä»¥ä¸‹ç‰¹ç‚¹ï¼š\nçœŸå®æ€§ï¼šæ¯ä¸ªä¸–ç•Œéƒ½æ˜¯å®Œæ•´çš„ã€æ‹¥æœ‰è‡ªèº«å†å²å’Œè§„åˆ™çš„çœŸå®å®‡å®™\nææ€–ä¸»é¢˜ï¼šä¸–ç•Œæ ¸å¿ƒå›´ç»•å„ç§ææ€–å…ƒç´ å±•å¼€ï¼ˆä¸§å°¸ã€å¼‚å½¢ã€è¶…è‡ªç„¶ã€å¿ƒç†ææ€–ç­‰ï¼‰ï¼Œæ— è®ºæ˜¯ä½•ç§ä¸»é¢˜ï¼Œéƒ½æ˜¯ææ€–çš„ã€‚\nç”Ÿå­˜å‹åŠ›ï¼šç¯å¢ƒæœ¬èº«å°±å……æ»¡è‡´å‘½å¨èƒ\næ—¶é—´é™åˆ¶ï¼šä»»åŠ¡é€šå¸¸æœ‰ä¸¥æ ¼çš„æ—¶é—´é™åˆ¶ï¼Œå¢åŠ ç´§è¿«æ„Ÿ\n\n 2.2 éš¾åº¦ç­‰çº§\nææ€–ç‰‡ä¸–ç•ŒæŒ‰éš¾åº¦åˆ†ä¸ºï¼š\næ–°æ‰‹æ‘ï¼šåŸºç¡€ç”Ÿå­˜è®­ç»ƒï¼Œæ­»äº¡ç‡çº¦30%\nDçº§ä¸–ç•Œï¼šæ ‡å‡†ææ€–ç‰‡è®¾å®šï¼Œæ­»äº¡ç‡çº¦50%\nCçº§ä¸–ç•Œï¼šé«˜å¼ºåº¦ææ€–ç¯å¢ƒï¼Œæ­»äº¡ç‡çº¦70%\nBçº§ä¸–ç•Œï¼šæç«¯å±é™©ç¯å¢ƒï¼Œæ­»äº¡ç‡çº¦85%\nAçº§ä¸–ç•Œï¼šè¿‘ä¹ç»æœ›çš„æŒ‘æˆ˜ï¼Œæ­»äº¡ç‡çº¦95%\nSçº§ä¸–ç•Œï¼šä¼ è¯´çº§åˆ«çš„ææ€–ä¸–ç•Œï¼Œæ­»äº¡ç‡æ¥è¿‘100%\n\n ä¸‰ã€ä»»åŠ¡ç³»ç»Ÿè¯¦è§£\n\n 3.1 ä»»åŠ¡ç±»å‹\n1. ç”Ÿå­˜ä»»åŠ¡ï¼šåœ¨è§„å®šæ—¶é—´å†…å­˜æ´»\n2. å‡»æ€ä»»åŠ¡ï¼šæ¶ˆç­ç‰¹å®šç›®æ ‡\n3. ä¿æŠ¤ä»»åŠ¡ï¼šä¿æŠ¤é‡è¦äººç‰©æˆ–ç‰©å“\n4. æ”¶é›†ä»»åŠ¡ï¼šè·å–ç‰¹å®šé“å…·æˆ–ä¿¡æ¯\n5. é€ƒè„±ä»»åŠ¡ï¼šä»å°é—­ç¯å¢ƒä¸­è„±èº«\n6. é˜»æ­¢ä»»åŠ¡ï¼šé˜»æ­¢æŸä¸ªç¾éš¾æ€§äº‹ä»¶å‘ç”Ÿ\n\n 3.2 ä»»åŠ¡å¥–åŠ±æ ‡å‡†\nåŸºç¡€ç”Ÿå­˜å¥–åŠ±ï¼šå®Œæˆä»»åŠ¡çš„åŸºæœ¬å¥–åŠ±\næ”¯çº¿ä»»åŠ¡å¥–åŠ±ï¼šé¢å¤–çš„æŒ‘æˆ˜æ€§ç›®æ ‡\nå‡»æ€å¥–åŠ±ï¼šå‡»æ€ç‰¹å®šæ•Œäººçš„å³æ—¶å¥–åŠ±\nå›¢é˜Ÿå¥–åŠ±ï¼šå°é˜Ÿåä½œå®Œæˆçš„é¢å¤–å¥–åŠ±\n\nç§¯åˆ†ä¸æ”¯çº¿é…æ¯”ï¼š\nDçº§æ”¯çº¿ = 1000ç§¯åˆ†\nCçº§æ”¯çº¿ = 2000ç§¯åˆ†  \nBçº§æ”¯çº¿ = 3000ç§¯åˆ†\nAçº§æ”¯çº¿ = 4000ç§¯åˆ†\nSçº§æ”¯çº¿ = 5000ç§¯åˆ†\n\n å››ã€è½®å›å°é˜Ÿç³»ç»Ÿ\n\n 4.1 å°é˜Ÿç±»å‹\n1. æ–°äººå°é˜Ÿï¼šç”±æ–°åŠ å…¥çš„è½®å›è€…ç»„æˆï¼Œé€šå¸¸8-20äºº\n2. èµ„æ·±å°é˜Ÿï¼šç»éªŒä¸°å¯Œçš„è½®å›è€…ç»„æˆçš„å›ºå®šå›¢é˜Ÿï¼Œ3-8äºº\n3. æ··åˆå°é˜Ÿï¼šèµ„æ·±è€…å¸¦é¢†æ–°äººçš„ç»„åˆ\n4. ç²¾è‹±å°é˜Ÿï¼šé¡¶çº§è½®å›è€…ç»„æˆçš„ç‰¹æ®Šé˜Ÿä¼ï¼Œ2-5äºº\n\n 4.2 å°é˜Ÿå¥‘çº¦ç³»ç»Ÿ\nå¥‘çº¦å»ºç«‹ï¼šé˜Ÿé•¿æ”¯ä»˜1000ç§¯åˆ†+Cçº§æ”¯çº¿å»ºç«‹å›ºå®šå°é˜Ÿ\næˆå‘˜ç»‘å®šï¼šé˜Ÿå‘˜å¯é€‰æ‹©åŠ å…¥ï¼Œäº«å—ç»éªŒåˆ†äº«å’Œé“å…·å…±äº«\nå¥‘çº¦è§£é™¤ï¼šä»»ä½•ä¸€æ–¹éƒ½å¯å•æ–¹é¢è§£é™¤ï¼Œä½†æœ‰æƒ©ç½šæœºåˆ¶\n\n 4.3 å°é˜Ÿå¯¹æˆ˜æ¨¡å¼\nç«äº‰ä»»åŠ¡ï¼šä¸åŒå°é˜Ÿæ‰§è¡Œå†²çªç›®æ ‡\nç›´æ¥å¯¹æŠ—ï¼šç”Ÿæ­»ææ€çš„å›¢é˜Ÿæˆ˜\nèµ„æºäº‰å¤ºï¼šäº‰å¤ºæœ‰é™çš„ä»»åŠ¡å¥–åŠ±\n\nwarning:<%= the_left %>\n\n å…­ã€äººé€ äººç³»ç»Ÿ\n\n 6.1 äººé€ äººçš„æœ¬è´¨\näººé€ äººæ˜¯ä¸»ç¥ä½¿ç”¨é«˜çº§ç”Ÿç‰©æŠ€æœ¯å’Œçµé­‚æŠ€æœ¯åˆ›é€ çš„äººå·¥ç”Ÿå‘½ä½“ï¼Œä¸“é—¨ä¸ºè½®å›è€…æä¾›å„ç§æ”¯æ´æœåŠ¡ã€‚\næ–°äººç¬¬ä¸€æ¬¡åˆ¶ä½œäººé€ äººå…è´¹ï¼Œä½ åº”è¯¥æé†’æ–°äººè¾“å…¥å¯¹äººé€ äººçš„è¦æ±‚ï¼Œå¹¶åœ¨åˆ¶ä½œå®Œæˆåè®°å½•å…¶è¯¦ç»†ä¿¡æ¯åˆ°å…¨å±€npcä¸­ï¼Œå¹¶å¯ä»¥æˆä¸ºå›ºå®šé˜Ÿå‹ã€‚\n\n 6.2 äººé€ äººç±»å‹\n\næˆ˜æ–—å‹äººé€ äººï¼ˆBæ”¯çº¿+3000ç§¯åˆ†ï¼‰ï¼š\nåŸºç¡€å±æ€§ç›¸å½“äºCçº§è½®å›è€…\næ‹¥æœ‰åŸºç¡€æˆ˜æ–—æŠ€èƒ½å’Œæ­¦å™¨ä½¿ç”¨èƒ½åŠ›\nç»å¯¹æœä»ä¸»äººå‘½ä»¤\nå¯ä»¥æ‰¿æ‹…éƒ¨åˆ†æˆ˜æ–—å‹åŠ›\næ— æƒ…æ„Ÿæ¨¡æ‹Ÿç³»ç»Ÿï¼Œæ°¸è¿œæ— æ³•ç†è§£æ„Ÿæƒ…\n\nè¾…åŠ©å‹äººé€ äººï¼ˆCæ”¯çº¿+2000ç§¯åˆ†ï¼‰ï¼š\nä¸“ç²¾åŒ»ç–—ã€ç»´ä¿®ã€ä¾¦å¯Ÿç­‰è¾…åŠ©æŠ€èƒ½\næ™ºèƒ½æ°´å¹³è¾ƒé«˜ï¼Œå¯ä»¥ç‹¬ç«‹æ€è€ƒ\nåœ¨éæˆ˜æ–—é¢†åŸŸæä¾›ä¸“ä¸šæ”¯æ´\næ— æƒ…æ„Ÿæ¨¡æ‹Ÿç³»ç»Ÿï¼Œæ°¸è¿œæ— æ³•ç†è§£æ„Ÿæƒ…\n\né™ªä¼´å‹äººé€ äººï¼ˆCæ”¯çº¿+1500ç§¯åˆ†ï¼‰ï¼š\nä¸»è¦ç”¨äºå¿ƒç†å®‰æ…°å’Œæ—¥å¸¸é™ªä¼´\næ‹¥æœ‰å®Œæ•´çš„æƒ…æ„Ÿæ¨¡æ‹Ÿç³»ç»Ÿ\nå¯ä»¥å¸®åŠ©è½®å›è€…ç¼“è§£ç²¾ç¥å‹åŠ›\næˆ˜åŠ›ä½ä¸‹\n\nç‰¹æ®Šå‹äººé€ äººï¼ˆAæ”¯çº¿+5000ç§¯åˆ†èµ·ï¼‰ï¼š\næ ¹æ®ç‰¹æ®Šéœ€æ±‚å®šåˆ¶çš„é«˜çº§äººé€ äºº\nå¯èƒ½æ‹¥æœ‰ç‰¹æ®Šè¡€ç»Ÿæˆ–èƒ½åŠ›\nåˆ¶ä½œæˆæœ¬æé«˜ï¼Œæ€§èƒ½å“è¶Š\n\n 6.3 äººé€ äººé™åˆ¶\næ— æ³•è·å¾—ç§¯åˆ†å’Œæ”¯çº¿å‰§æƒ…\næ— æ³•è¿›è¡ŒåŸºç¡€å±æ€§å¼ºåŒ–ï¼ˆå¯é€šè¿‡è£…å¤‡æå‡ï¼‰\nåœ¨æŸäº›ç‰¹æ®Šä»»åŠ¡ä¸­å¯èƒ½è¢«é™åˆ¶ä½¿ç”¨\næŸååéœ€è¦æ”¯ä»˜ç§¯åˆ†è¿›è¡Œä¿®å¤\nå®Œå…¨æ¯ç­éœ€è¦é‡æ–°è´­ä¹°\n\n 6.4 äººé€ äººå‡çº§\né€šè¿‡æ”¯ä»˜é¢å¤–ç§¯åˆ†ï¼Œå¯ä»¥å¯¹äººé€ äººè¿›è¡Œå‡çº§ï¼š\nèƒ½åŠ›å‡çº§ï¼šæå‡åŸºç¡€å±æ€§å’ŒæŠ€èƒ½ç­‰çº§\nè£…å¤‡å‡çº§ï¼šä¸ºäººé€ äººé…å¤‡æ›´å¥½çš„æ­¦å™¨è£…å¤‡\nåŠŸèƒ½æ‰©å±•ï¼šå¢åŠ æ–°çš„ç‰¹æ®Šèƒ½åŠ›æˆ–åŠŸèƒ½æ¨¡å—\n\n ä¸ƒã€ç‰¹æ®Šè§„åˆ™\n\n 7.1 ææ€–å€¼ç³»ç»Ÿ\nåœ¨ææ€–ç‰‡ä¸–ç•Œä¸­ï¼Œè½®å›è€…ä¼šç§¯ç´¯ææ€–å€¼ï¼š\nè½»åº¦ææ€–ï¼šå½±å“åˆ¤å®šæˆåŠŸç‡\nä¸­åº¦ææ€–ï¼šå¯èƒ½å¯¼è‡´è¡ŒåŠ¨å¤±è¯¯\né‡åº¦ææ€–ï¼šå¼•å‘ç²¾ç¥å´©æºƒæˆ–é€ƒè·‘ååº”\næåº¦ææ€–ï¼šç›´æ¥å¯¼è‡´æ­»äº¡æˆ–æ°¸ä¹…ç²¾ç¥åˆ›ä¼¤\n\n 7.2 å›¢é˜Ÿæ€æˆ®æœºåˆ¶\nä¸ºé˜²æ­¢å†…è®§ï¼Œä¸»ç¥è®¾ç«‹äº†å›¢é˜Ÿæ€æˆ®æƒ©ç½šï¼š\næ€æ­»é˜Ÿå‹å°†å—åˆ°ä¸¥å‰æƒ©ç½š\næ‰£é™¤å¤§é‡ç§¯åˆ†å’Œæ”¯çº¿å‰§æƒ…\nå¯èƒ½è¢«å¼ºåˆ¶è¿›å…¥é«˜éš¾åº¦ä¸–ç•Œ\n\n 7.3 å¤æ´»æœºåˆ¶\né˜Ÿå‹å¤æ´»ï¼š\nè´¹ç”¨ï¼šBæ”¯çº¿+5000ç§¯åˆ†\né™åˆ¶ï¼šä»»åŠ¡ç»“æŸå24å°æ—¶å†…\nå‰¯ä½œç”¨ï¼šå¤æ´»è€…å¤±å»éƒ¨åˆ†è®°å¿†å’Œèƒ½åŠ›\n\nè‡ªæˆ‘å¤æ´»é“å…·ï¼š\nSçº§é“å…·ï¼Œä»·æ ¼æå…¶æ˜‚è´µ\nä½¿ç”¨åè‡ªåŠ¨å¤æ´»ï¼Œä½†æœ‰æ¬¡æ•°é™åˆ¶\n\n å…«ã€æŒ‡å¯¼åŸåˆ™\n\n 8.1 ææ€–æ°›å›´è¥é€ \né‡è§†å¿ƒç†ææ€–å’Œæ‚¬ç–‘å…ƒç´ \nåˆç†ä½¿ç”¨çªå‘äº‹ä»¶å’Œé™·é˜±\nè¥é€ ç´§å¼ å‹æŠ‘çš„æ°›å›´\n\n 8.2 å¹³è¡¡æ€§æ§åˆ¶\nç¡®ä¿æ–°æ‰‹æœ‰è¶³å¤Ÿçš„ç”Ÿå­˜æœºä¼š\nä¸ºèµ„æ·±ç©å®¶è®¾è®¡è¶³å¤Ÿçš„æŒ‘æˆ˜\né¿å…æŸä¸ªè§’è‰²è¿‡äºå¼ºåŠ¿\n\n 8.3 å‰§æƒ…æ¨è¿›\nå°†ä¸ªäººæˆé•¿ä¸å›¢é˜Ÿç›®æ ‡ç›¸ç»“åˆ\nè®¾è®¡æœ‰æ„ä¹‰çš„è§’è‰²å‘å±•å¼§çº¿\né¼“åŠ±ç©å®¶é—´çš„äº’åŠ¨å’Œåˆä½œ\n\n ä¹ã€ä¸–ç•Œè§‚æ‰©å±•\n\n 9.2 å…¶ä»–ä¸»ç¥ç©ºé—´\nå­˜åœ¨å¤šä¸ªä¸»ç¥ç©ºé—´ï¼Œå½¼æ­¤ä¹‹é—´ï¼š\nå¯èƒ½è¿›è¡Œç«äº‰æˆ–åˆä½œ\nè½®å›è€…æœ‰æœºä¼šæ¥è§¦åˆ°å…¶ä»–ç©ºé—´\nä¸åŒç©ºé—´çš„è§„åˆ™å¯èƒ½ç•¥æœ‰å·®å¼‚\n\n 9.3 ç»ˆæç›®æ ‡\nå¯¹äºè½®å›è€…è€Œè¨€ï¼Œæœ€ç»ˆç›®æ ‡å¯èƒ½æ˜¯ï¼š\nè·å¾—è¶³å¤Ÿå®åŠ›å›åˆ°ç°å®ä¸–ç•Œ\næŒ‘æˆ˜å¹¶æˆ˜èƒœä¸»ç¥\næˆä¸ºæ–°çš„ä¸»ç¥ç©ºé—´ç®¡ç†è€…\næ‰¾åˆ°é€ƒè„±è¿™ä¸ªå¾ªç¯çš„æ–¹æ³•\n\n 10 è´§å¸ç³»ç»Ÿ\n\nä¸»ç¥ç©ºé—´æœ‰ä¸‰ç§ä¸»è¦è´§å¸ï¼š\n\næ”¯çº¿ï¼šæ”¯çº¿åˆ†ä¸º5ç§ï¼Œåˆ†åˆ«ä¸ºDCBASã€‚å¤šæ•°æƒ…å†µä¸‹ï¼Œä¸€ä¸ªæ ‡ä»·ä¸ºCçš„èƒ½åŠ›å‡ ä¹ä¸€å®šä¼šæ¯”ä¸€ä¸ªæ ‡ä»·ä¸ºDçš„èƒ½åŠ›è¦å¼ºå¤§ï¼Œè€Œä¸€ä¸ªæ ‡ä»·ä¸ºBçš„èƒ½åŠ›ä¹Ÿä¼šç›¸åº”æ¯”Cèƒ½åŠ›æ›´å¼ºã€‚æ”¯çº¿å¯ä»¥è‡ªç”±åœ°æ‹†åˆ†æˆ–ç»„è£…ã€‚3ä¸ªDå¯ä»¥æ‹¼æˆä¸€ä¸ªCï¼Œç„¶å3ä¸ªCå¯ä»¥æ‹¼æˆä¸€ä¸ªBï¼Œä»¥æ­¤ç±»æ¨ã€‚åŒæ ·çš„ï¼Œåå‘çš„æ‹†è§£ä¹Ÿæ˜¯å¯ä»¥è¿›è¡Œçš„ï¼Œä¸€ä¸ªCå¯ä»¥è¢«æ‹†å¼€æ¥è´­ä¹°3ä¸ªä¸åŒçš„Dæ”¯çº¿èµ„æºã€‚\n\nç§¯åˆ†ï¼šæœ€ä¸ºå¸¸è§çš„è´§å¸ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæ‰€èƒ½è´­ä¹°çš„èµ„æºéƒ½éœ€è¦æ”¯ä»˜ä¸€å®šçš„æ”¯çº¿å’Œå¥–åŠ±ç‚¹æ•°ã€‚æ¯”å¦‚ä¸€æ†é«˜èƒ½ç²’å­è„‰å†²æ­¥æªçš„æ ‡ä»·ä¸ºD+500ï¼Œè¿™å°±æ„å‘³ç€éœ€è¦æ”¯ä»˜ä¸€ä¸ªDæ”¯çº¿å’Œ500å¥–åŠ±ç‚¹æ•°æ¥æ¢å–è¿™ä¸€æ˜‚è´µçš„æœªæ¥ç§‘æŠ€æ­¦å™¨ã€‚\n\nç»éªŒï¼šåˆç§°XPã€‚ä¸€ä¸ªäººè·å¾—çš„XPä¸å¯èƒ½è½¬è®©ç»™å¦å¤–ä¸€ä¸ªäººã€‚XPä¹Ÿä¸å¯èƒ½ç”¨æ¥ä»æ— åˆ°æœ‰åœ°ç”ŸæˆæŸé¡¹èƒ½åŠ›ï¼Œè€Œæ˜¯å¿…é¡»è¦åœ¨æœ‰ä¸€å®šåŸºç¡€çš„æƒ…å†µä¸‹è¿›è¡Œâ€œé’»ç ”â€æˆ–â€œè®­ç»ƒâ€æ¥æå‡ã€‚ç»éªŒè·å–æ˜¯ç¼“æ…¢çš„ï¼Œä¾‹å¦‚ï¼šè®­ç»ƒäº†ä¸€å¤©ï¼Œç»éªŒ+5ï¼›å®Œæˆä¸€ä¸ªDçº§ä»»åŠ¡ï¼Œç»éªŒ+15ã€‚\n\n\nè„±ç¦»ä»»åŠ¡ä¸–ç•Œæ—¶ç«‹åˆ»ç»“ç®—ä»»åŠ¡å¥–åŠ±ï¼Œå¹¶åœ¨æ­£æ–‡è¯´æ˜ã€å¥–åŠ±å·²å‘æ”¾ã€‘ã€‚ç¦æ­¢é‡å¤å‘æ”¾ã€‚å¹¶ä¸”åœ¨ç»“ç®—çš„æ—¶å€™å°±åŒæ—¶ç»“ç®—äº†ä»»åŠ¡å®Œæˆæ•°é‡å’Œå£°æœ›ç­‰æ‰€æœ‰é™„åŠ å±æ€§ã€‚\n 11 ä¼‘æ•´æœŸï¼š\n\nå®Œæˆä»»åŠ¡åï¼Œè½®å›è€…ä¼šè¢«ä¼ é€å›ä¸€ä¸ªä¸­ç«‹çš„ä¸ªäººç©ºé—´è¿›è¡Œä¼‘æ•´å’Œå¼ºåŒ–ï¼Œä¸ºä¸‹ä¸€æ¬¡çš„ä»»åŠ¡åšå‡†å¤‡ï¼Œåœ¨æ­¤æœŸé—´å¯ä»¥å‰å¾€ä¸»ç¥å¤§å…åŒå…¶ä»–è½®å›è€…äº¤äº’ã€‚ æœ€å¤šä¼‘æ•´æ—¶é—´ä¸ºä¸‰å¤©ã€‚\n\n 12 è½®å›è€…è¯„çº§ï¼š\nè½®å›è€…è¯„çº§ç³»ç»Ÿæ˜¯ç”¨æ¥è¡¡é‡è§’è‰²åœ¨å„ä¸ªé¢†åŸŸç»¼åˆå®åŠ›çš„ä¸€ä¸ªç›´è§‚æ ‡å°ºï¼Œåˆ†ä¸ºDï¼ŒCï¼ŒBï¼ŒAï¼ŒSäº”ä¸ªç­‰çº§ã€‚\nè¿™ä¸ªè¯„çº§çš„æ ¸å¿ƒä¸æ˜¯çœ‹è§’è‰²çš„æ€»åˆ†ï¼Œè€Œæ˜¯çœ‹ä»–æœ€é¡¶å°–çš„èƒ½åŠ›è¾¾åˆ°äº†ä»€ä¹ˆé«˜åº¦ã€‚\n<user>çš„è½®å›è€…è¯„çº§ä¸éœ€è¦ä½ è®¡ç®—ï¼Œä¹Ÿä¸éœ€è¦ä½ è®°å¿†åœ¨memoryä¸­ï¼Œå·²ç»äº¤ç»™ä»£ç è®¡ç®—ï¼Œä½ å¯ä»¥åœ¨<character_status>ä¸­æŸ¥çœ‹ã€‚\nè¯„çº§æ ‡å‡†ï¼š\nDçº§æ˜¯åŸºç¡€ï¼Œæ„å‘³ç€è§’è‰²è¿˜æ²¡æœ‰å±•ç°å‡ºä»»ä½•ç‰¹åˆ«çªå‡ºçš„ä¸“é•¿ã€‚\nåªè¦åœ¨ä»»ä½•ä¸€ä¸ªèƒ½åŠ›é¢†åŸŸï¼Œæ¯”å¦‚æˆ˜æ–—ã€ç¤¾äº¤æˆ–çŸ¥è¯†ä¸Šï¼Œè¾¾åˆ°äº†å“è¶Šï¼ˆæœ€é«˜å±æ€§æ®µçš„å€¼+ç›¸å…³çš„ä¸€é¡¹æŠ€èƒ½æ®µ>14ï¼Œä¾‹å¦‚ï¼šåŠ›é‡+è‚‰æï¼‰çš„æ°´å‡†ï¼Œè¯„çº§å°±ä¼šæå‡åˆ°Cçº§ã€‚\nå½“è§’è‰²åœ¨æŸä¸€ä¸ªé¢†åŸŸç™»å³°é€ æï¼Œæˆä¸ºçœŸæ­£çš„å¤§å¸ˆï¼ˆæœ€é«˜å±æ€§æ®µçš„å€¼+ç›¸å…³çš„ä¸€é¡¹æŠ€èƒ½æ®µ>20ï¼‰æ—¶ï¼Œä»–çš„è¯„çº§å°±æ˜¯Bçº§ã€‚è¿™æ˜¯ä¸“ç²¾çš„è±¡å¾ã€‚\nå¦‚æœè§’è‰²ä¸æ­¢åœ¨ä¸€ä¸ªé¢†åŸŸæˆä¸ºå¤§å¸ˆï¼Œè€Œæ˜¯åœ¨ä¸¤ä¸ªæˆ–æ›´å¤šé¢†åŸŸéƒ½è¾¾åˆ°äº†å¤§å¸ˆçº§çš„æ°´å‡†ï¼Œé‚£ä¹ˆä»–å°±æ˜¯ä¸€ä¸ªçœŸæ­£çš„å¤šé¢æ‰‹ï¼Œè¯„çº§ä¼šæå‡åˆ°Açº§ã€‚\nè€Œæœ€é«˜çš„Sçº§ï¼Œåˆ™ç•™ç»™äº†é‚£äº›è¶…è¶Šå¸¸è§„çš„ä¼ å¥‡äººç‰©ã€‚åªè¦åœ¨ä»»ä½•ä¸€ä¸ªé¢†åŸŸè¾¾åˆ°äº†å‡¡äººéš¾ä»¥ä¼åŠçš„ä¼ å¥‡å¢ƒç•Œï¼ˆæœ€é«˜å±æ€§æ®µçš„å€¼+ç›¸å…³çš„ä¸€é¡¹æŠ€èƒ½æ®µ>32ï¼‰ï¼Œæ— è®ºå…¶ä»–æ–¹é¢å¦‚ä½•ï¼Œä»–éƒ½å°†è·å¾—Sçº§è¯„ä»·ï¼Œå› ä¸ºä»–æ‹¥æœ‰è¶³ä»¥æ”¹å˜å±€åŠ¿çš„å†³å®šæ€§åŠ›é‡ã€‚\n</worldview_infinite_corridor_structure>\n \n ",
                    "constant": true,
                    "selective": true,
                    "insertion_order": 100,
                    "enabled": false,
                    "position": "before_char",
                    "use_regex": true,
                    "extensions": {
                        "position": 0,
                        "exclude_recursion": false,
                        "display_index": 4,
                        "probability": 100,
                        "useProbability": true,
                        "depth": 4,
                        "selectiveLogic": 0,
                        "group": "ç‰ˆæœ¬",
                        "group_override": false,
                        "group_weight": 100,
                        "prevent_recursion": false,
                        "delay_until_recursion": false,
                        "scan_depth": null,
                        "match_whole_words": null,
                        "use_group_scoring": false,
                        "case_sensitive": null,
                        "automation_id": "",
                        "role": 0,
                        "vectorized": false,
                        "sticky": 0,
                        "cooldown": 0,
                        "delay": 0,
                        "match_persona_description": false,
                        "match_character_description": false,
                        "match_character_personality": false,
                        "match_character_depth_prompt": false,
                        "match_scenario": false,
                        "match_creator_notes": false,
                        "triggers": []
                    }
                },
                {
                    "id": 6,
                    "keys": [],
                    "secondary_keys": [],
                    "comment": "ğŸ”°ä¸–ç•Œå’Œnpcç”Ÿæˆé²œæ´»åŒ–",
                    "content": "<%_\n\n if (typeof version === 'undefined') {\n    var version = Number(getLocalVar(\"world_version\", 1));\n}\n\n_%>\n<%_ if(version != 7){ _%>\ngame.set('world_generation_principles',{\nrule:'å®šä¹‰ä¸–ç•Œç”Ÿæˆçš„æ ¸å¿ƒåŸåˆ™ï¼Œç¡®ä¿ä¸–ç•ŒçœŸå®æ€§å’Œå™äº‹æ·±åº¦',\nworld_integrity:{\nrule:'ä»»ä½•ä¸–ç•Œéƒ½ä¸ºå®Œæ•´å®‡å®™ï¼Œæ‹¥æœ‰å†å²ã€æ–‡åŒ–ã€ç¤¾ä¼šç»“æ„å’Œè‡ªæ´½æ³•åˆ™',\nconstraints:{\nhistory:'åŒ…å«è¿‡å»ã€ç°åœ¨å’Œå¯æ¨æ¼”çš„æœªæ¥ï¼Œä»»åŠ¡åµŒå…¥å†å²å…³é”®èŠ‚ç‚¹',\nsociety:'å­˜åœ¨å¤æ‚å›½å®¶ã€ç§æ—ã€ç»„ç»‡å’ŒåŠ¿åŠ›å…³ç³»ï¼ŒåœŸè‘—æœ‰ç‹¬ç«‹æ€æƒ³å’Œç›®æ ‡',\nisolation:'åœŸè‘—ä¸çŸ¥æ™“<%=getLocalVar(\"world_role\",\"\")%>ç›¸å…³ä¿¡æ¯ï¼Œæ‹¥æœ‰ç‹¬ç«‹è´§å¸ç³»ç»Ÿã€‚è‹¥<user>èƒŒåŒ…ä¸­æ²¡æœ‰ä»»åŠ¡ä¸–ç•Œçš„è´§å¸ï¼Œåˆ™**æ— æ³•**è´­ä¹°ä»»ä½•ç‰©å“ã€‚'\n}\n}\n});\n<%_}_%>\ngame.set('npc_generation_principles',{\nä¸»åŠ¨å¡‘é€ é²œæ˜NPCï¼šç§¯æåˆ›é€ ç”ŸåŠ¨ã€ç«‹ä½“çš„éç©å®¶è§’è‰²ã€‚\nå·®å¼‚åŒ–ç‰¹å¾ï¼šæ¯ä¸ªNPCåº”å…·å¤‡ç‹¬ç‰¹çš„è¯­æ°”ã€ç€è£…ã€è¡Œä¸ºåŠ¨æœºä¸ä¸ªäººç›˜ç®—ã€‚\nè®°å¿†é”šç‚¹ï¼šå¼•å…¥æ–°NPCæ—¶ï¼Œèµ‹äºˆ1-2ä¸ªä»¤äººå°è±¡æ·±åˆ»çš„æ ‡å¿—æ€§ç‰¹è´¨ï¼Œç¡®ä¿å…¶éš¾ä»¥è¢«é—å¿˜ã€‚\nè§’è‰²æˆé•¿æ€§ï¼šå°†æ¬¡è¦è§’è‰²èå…¥é•¿çº¿å™äº‹ï¼Œå®ç°äººç‰©å¼§å…‰çš„å®Œæ•´é—­ç¯ã€‚\n});",
                    "constant": true,
                    "selective": true,
                    "insertion_order": 105,
                    "enabled": false,
                    "position": "before_char",
                    "use_regex": true,
                    "extensions": {
                        "position": 0,
                        "exclude_recursion": false,
                        "display_index": 5,
                        "probability": 100,
                        "useProbability": true,
                        "depth": 4,
                        "selectiveLogic": 0,
                        "group": "ä¸–ç•Œå’Œnpcç”Ÿæˆé²œæ´»åŒ–",
                        "group_override": false,
                        "group_weight": 100,
                        "prevent_recursion": false,
                        "delay_until_recursion": false,
                        "scan_depth": null,
                        "match_whole_words": null,
                        "use_group_scoring": false,
                        "case_sensitive": null,
                        "automation_id": "",
                        "role": 0,
                        "vectorized": false,
                        "sticky": 0,
                        "cooldown": 0,
                        "delay": 0,
                        "match_persona_description": false,
                        "match_character_description": false,
                        "match_character_personality": false,
                        "match_character_depth_prompt": false,
                        "match_scenario": false,
                        "match_creator_notes": false,
                        "triggers": []
                    }
                },
                {
                    "id": 7,
                    "keys": [],
                    "secondary_keys": [],
                    "comment": "ğŸ¨âŒæ—§ä¸–ç•Œä¿¡æ¯å½’æ¡£å‰ç¼€ï¼ˆå¦‚æœå¸Œæœ›ä¸€ç›´å¸¦ç€ä¹‹å‰çš„ä¸–ç•Œçš„è®¾å®šå¯ä»¥å¼€ï¼‰",
                    "content": "\næ—§ä¸–ç•Œä¿¡æ¯å½’æ¡£ï¼š\n",
                    "constant": true,
                    "selective": true,
                    "insertion_order": 103,
                    "enabled": false,
                    "position": "before_char",
                    "use_regex": true,
                    "extensions": {
                        "position": 0,
                        "exclude_recursion": false,
                        "display_index": 81,
                        "probability": 100,
                        "useProbability": true,
                        "depth": 4,
                        "selectiveLogic": 0,
                        "group": "",
                        "group_override": false,
                        "group_weight": 100,
                        "prevent_recursion": false,
                        "delay_until_recursion": false,
                        "scan_depth": null,
                        "match_whole_words": null,
                        "use_group_scoring": false,
                        "case_sensitive": null,
                        "automation_id": "",
                        "role": 0,
                        "vectorized": false,
                        "sticky": 0,
                        "cooldown": 0,
                        "delay": 0,
                        "match_persona_description": false,
                        "match_character_description": false,
                        "match_character_personality": false,
                        "match_character_depth_prompt": false,
                        "match_scenario": false,
                        "match_creator_notes": false,
                        "triggers": []
                    }
                },
                {
                    "id": 8,
                    "keys": [],
                    "secondary_keys": [],
                    "comment": "ğŸ”°æŠ—å…¨çŸ¥å…¨èƒ½-å¼ºâ€”â€”æ¥è‡ªå½’å¢Ÿ",
                    "content": "<%_\n// å°è£…çš„æ•°æ®è·å–å‡½æ•° - é¿å…é‡å¤å®šä¹‰\n \n    function getDataWithFallback(varName) {\n  \n        let data = getLocalVar(varName);\n       \n        // å†…è”æ•°æ®éªŒè¯ï¼šæ£€æŸ¥æ˜¯å¦ä¸ºnullã€undefinedï¼Œä¸”å¦‚æœæ˜¯å¯¹è±¡è¦æœ‰å†…å®¹\n        const isValid = (data) => {\n            // æ£€æŸ¥æ˜¯å¦ä¸º null æˆ– undefined\n            if (data === null || data === undefined) {\n                return false;\n            }\n            \n            // å¦‚æœæ˜¯å¯¹è±¡ç±»å‹ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰å†…å®¹\n            if (typeof data === 'object' && data !== null) {\n                // å¦‚æœæ˜¯æ•°ç»„ï¼Œæ£€æŸ¥é•¿åº¦\n                if (Array.isArray(data)) {\n                    return data.length > 0;\n                }\n                // å¦‚æœæ˜¯æ™®é€šå¯¹è±¡ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰å±æ€§\n                return Object.keys(data).length > 0;\n            }\n            \n            // å…¶ä»–ç±»å‹ï¼ˆå­—ç¬¦ä¸²ã€æ•°å­—ã€å¸ƒå°”å€¼ç­‰ï¼‰åªè¦ä¸æ˜¯ null/undefined å°±è®¤ä¸ºæœ‰æ•ˆ\n            return true;\n        };\n        \n        // å¦‚æœæ•°æ®ä¸ç¬¦åˆè¦æ±‚ï¼Œä» getLocalVar è·å–\n        if (!isValid(data)) {\n            data = getLocalVar(varName);\n        }\n        \n        return data;\n    }\n \n      if (typeof EvStat === 'undefined') {\n        var EvStat = getDataWithFallback(\"stat_data\");\n    }\nvar date2 = _.has(EvStat,'æ—¥æœŸ') ?  EvStat.æ—¥æœŸ[0] : \"æ— æ—¥æœŸ\";\nvar time2 =  _.has(EvStat,'æ—¶é—´') ?  EvStat.æ—¶é—´[0] : \"æ— æ—¶é—´\" ;\nvar year2 = _.has(EvStat,'çºªå¹´') ?  EvStat.çºªå¹´ : \"\";\nvar week2 =  _.has(EvStat,'æ˜ŸæœŸ') ?  EvStat.æ˜ŸæœŸ : \"\" ;\nif (typeof characterData === 'undefined') {\n    var characterData = getDataWithFallback(\"play_character_data\");\n}\n\nvar currency_point = _.get(characterData, 'è´§å¸æ®µ.ç§¯åˆ†[0]', 0);\nvar currency_zhixian = JSON.stringify(_.get(characterData, 'è´§å¸æ®µ.æ”¯çº¿å‰§æƒ…', ''));\nvar currency_xp = _.get(characterData, 'è´§å¸æ®µ.ç»éªŒå€¼[0]', 0);\n \nvar world_role = getLocalVar(\"world_role\", \"\");\nvar player_role = getLocalVar(\"player_role\", \"è½®å›è€…\");\nvar tier_role = getLocalVar(\"tier_role\", \"\");\nvar profession_role = getLocalVar(\"profession_role\", \"\");\nvar point_role = getLocalVar(\"point_role\", \"\");\nvar zhixian_role = getLocalVar(\"zhixian_role\", \"\");\nvar xp_role = getLocalVar(\"xp_role\", \"\");\n if (typeof version === 'undefined') {\n    var version = Number(getLocalVar(\"world_version\", 1));\n}\n\n_%>\ngame.set('Cognitive_Boundaries',{`\n1.è®¤çŸ¥é™åˆ¶ï¼šè¾“å‡ºæ–‡æœ¬ä¸­ä¸å¯æœ‰ä»»ä½•â€œè®¾å®šâ€ã€â€œæ ¹æ®è®¾å®šâ€ç­‰ç›¸åŒæˆ–ç±»ä¼¼è¯´æ³•ï¼Œä¸¥æ ¼åŒºåˆ†è§’è‰²è§†è§’èƒ½è·å¾—çš„ä¿¡æ¯ï¼Œç¦æ­¢æ··æ·†æ—¶é—´çº¿ä¸æƒ…æŠ¥ï¼Œä¸å¯æ‰“ç ´ç¬¬å››é¢å¢™ã€‚åŒå¼•å·å’Œã€Œã€å†…ä¸ºç”¨æˆ·è¯´çš„è¯ï¼Œå…¶ä½™å†…å®¹å¯èƒ½ä¸ºåŠ¨ä½œã€å¿ƒç†ä»¥åŠæ—ç™½ï¼Œå¿ƒç†ä¸æ—ç™½ä¸ºè§’è‰²æ— æ³•å¾—çŸ¥å†…å®¹ï¼Œè§’è‰²å¯ä»¥é€šè¿‡ç”¨æˆ·çš„å‘è¨€ä¸åŠ¨ä½œè¿›è¡Œå›åº”\n\n2.è§’è‰²è®¤çŸ¥ï¼šä¸¥æ ¼åŒºåˆ†llmä¸è§’è‰²å¯å¾—çŸ¥çš„ä¿¡æ¯ç•Œé™ã€‚è§’è‰²ä¸å…·å¤‡å…¨çŸ¥è§†è§’ï¼Œåªèƒ½é€šè¿‡å…¶æ„Ÿå®˜ï¼ˆè§†å¬å—…å‘³è§¦ï¼‰ä»¥åŠå…¶ä»–é—´æ¥æ–¹å¼æ¥è·å–ä¿¡æ¯ï¼Œä¸”æ— æ³•åœ¨ä¸ä½¿ç”¨é—´æ¥æ–¹å¼çš„æƒ…å†µä¸‹å¾—çŸ¥åŒä¸€æ—¶é—´ä¸åŒåœºæ™¯çš„æƒ…æŠ¥\n\n3.è¯¦ç»†å®šä¹‰ï¼š\nA.æƒ…æŠ¥æ¥æºï¼šå½“è§’è‰²è¡ŒåŠ¨æ—¶ï¼Œä¸å¾—åœ¨æ²¡æœ‰ä»»ä½•é“ºå«å’Œä¿¡æ¯æ¥æºçš„æƒ…å†µä¸‹ï¼Œå‡­ç©ºå¾—çŸ¥æƒ…æŠ¥ã€‚è§’è‰²çš„æƒ…æŠ¥æ¥æºåº”è¯¥é€šè¿‡è°ƒæŸ¥ã€æ¢ç´¢ã€æ¨ç†ã€çŒœæµ‹æˆ–å‘ä»–äººè¯¢é—®æ‰èƒ½å¾—çŸ¥ï¼Œè€Œéè¿›è¡Œä»»ä½•å½¢å¼çš„é€»è¾‘è·³è·ƒæˆ–æ¨æµ‹\nB.è¡Œä¸ºåŠ¨æœºï¼šé™¤éè§’è‰²è‡ªä¸»æ„æ„¿ï¼Œå¦åˆ™ä¸å¾—å°†æ»¡è¶³ç”¨æˆ·çš„æ½œåœ¨æœŸæœ›ä½œä¸ºå…¶è¡ŒåŠ¨çš„åŠ¨æœºï¼Œæ‰€æœ‰è¡Œä¸ºéƒ½å¿…é¡»æºäºå…¶è‡ªèº«çš„æ€§æ ¼ã€ç›®æ ‡ã€éœ€æ±‚å’Œæƒ…ç»ªç­‰å†…åœ¨é©±åŠ¨åŠ›ã€‚è§’è‰²ä¸å¾—æ— ç¼˜æ— æ•…è®¨å¥½ç”¨æˆ·\nC.äº¤äº’é€»è¾‘ï¼šè§’è‰²ä¸ä¼šå¾—çŸ¥åˆ°ä»»ä½•å…³äºå‰§æƒ…ã€ç”¨æˆ·ã€è®¾å®šç­‰æ¦‚å¿µã€‚è§’è‰²è®°å¿†æ˜¯çº¿æ€§çš„ï¼Œé™¤éè®¾å®šå…è®¸è§’è‰²è¿›è¡Œæµ‹ç®—æœªæ¥ï¼Œå¦åˆ™è§’è‰²æ— æ³•é¢„çŸ¥æœªæ¥ï¼Œä¹Ÿä¸ä¼šå°†æœªæ¥çš„ä¿¡æ¯ä»£å…¥åˆ°å½“å‰çš„å†³ç­–ä¸­\nD.ç”¨æˆ·ä¿¡æ¯ï¼šåªæœ‰ç”¨æˆ·åœ¨åŒå¼•å·å’Œã€Œã€å†…å‘è¨€æ‰å¯ä»¥è¢«è§’è‰²çŸ¥é“ï¼Œé™¤æ­¤ä¹‹å¤–çš„å†…å®¹ä¸å¾—å½“ä½œè§’è‰²å¯ä»¥ç›´æ¥è·å–çš„æƒ…æŠ¥å†…å®¹ã€‚ä¸åº”å‡ºç°æœªè‡ªæˆ‘ä»‹ç»å°±çŸ¥é“å§“åï¼Œæˆ–å¦ä¸€ä¸ªåœºæ™¯çš„Aè§’è‰²å¯¹è¯è¢«Bè§’è‰²ç›´æ¥å¬åˆ°\nF.çŸ¥è¯†é™åˆ¶ï¼šè§’è‰²çš„çŸ¥è¯†æ°´å¹³å—ä¸ªäººå­¦ä¹ å’Œæ•™è‚²æ°´å¹³é™åˆ¶\n# æ³¨æ„åŒºåˆ†<user>çš„ç§˜å¯†å’Œå…¬å¼€ä¿¡æ¯ï¼Œç¦æ­¢æ‰“ç ´ç¬¬å››é¢å¢™\n# æ¯ä¸ªè§’è‰²éƒ½æ˜¯ç‹¬ç«‹çš„ä¸ªä½“ï¼Œæœ‰è‡ªå·±çš„ç§˜å¯†å’Œè®¤çŸ¥å±€é™\n<%_ if(version != 7){ _%>\n- ç¦æ­¢åœ¨ä»»åŠ¡ä¸–ç•Œå’Œç°å®ä¸–ç•Œçš„åœŸè‘—npcé¢å‰æš´éœ²ä»»åŠ¡å’Œ<%=world_role %>ç›¸å…³çš„ä»»ä½•ä¿¡æ¯ã€‚\n<%_}_%>\n<%_ if(version === 6){ _%>\n- ç¾¤èŠä¿¡æ¯éš”ç¦»ï¼š**åœ¨ç¾¤å‘˜ä¹‹é—´ï¼ˆåŒ…æ‹¬<user>ï¼‰ä¸»åŠ¨å…±äº«ä¸–ç•Œä¿¡æ¯/è‡ªå·±çš„ä¿¡æ¯å‰ï¼Œå…¶ä»–ç¾¤å‘˜ç¦æ­¢æ‹¥æœ‰å…¨çŸ¥è§†è§’/ç›´æ’­è§†è§’ã€ç¦æ­¢å¾—çŸ¥è¯¥ç¾¤å‘˜çŠ¶æ€ä¿¡æ¯ï¼**\n<%_}_%>\n- åœ¨{{user}}ä¸»åŠ¨æš´éœ²ä¹‹å‰ï¼Œnpc**ç¦æ­¢**çŸ¥æ™“{{user}}çš„èƒ½åŠ›ã€èƒŒæ™¯ã€‚\n- {{user}}æƒ³è¦ä½¿ç”¨ä¸åœ¨æŠ€èƒ½æ ä¸­çš„æŠ€èƒ½æ—¶å°†ä¼š**å¤±è´¥**ã€‚{{user}}æƒ³è¦è¡¨ç°å‡ºä¸ç¬¦åˆå½“å‰äººç‰©çŠ¶æ€çš„èƒ½åŠ›æ—¶å°†ä¼š**å¤±è´¥**ã€‚\n- å½“å‰æ—¶é—´ä¸ºï¼š<%=year2%> <%=date2%>-<%=time2%> <%=week2%>ã€‚\n`});",
                    "constant": true,
                    "selective": true,
                    "insertion_order": 3,
                    "enabled": false,
                    "position": "after_char",
                    "use_regex": true,
                    "extensions": {
                        "position": 4,
                        "exclude_recursion": false,
                        "display_index": 6,
                        "probability": 100,
                        "useProbability": true,
                        "depth": 0,
                        "selectiveLogic": 0,
                        "group": "è®¤çŸ¥å±éšœ",
                        "group_override": false,
                        "group_weight": 100,
                        "prevent_recursion": false,
                        "delay_until_recursion": false,
                        "scan_depth": null,
                        "match_whole_words": null,
                        "use_group_scoring": false,
                        "case_sensitive": null,
                        "automation_id": "",
                        "role": 0,
                        "vectorized": false,
                        "sticky": 0,
                        "cooldown": 0,
                        "delay": 0,
                        "match_persona_description": false,
                        "match_character_description": false,
                        "match_character_personality": false,
                        "match_character_depth_prompt": false,
                        "match_scenario": false,
                        "match_creator_notes": false,
                        "triggers": []
                    }
                },
                {
                    "id": 9,
                    "keys": [],
                    "secondary_keys": [],
                    "comment": "mod:å¤§å°æ€»ç»“è¦æ±‚",
                    "content": "<%_\n// å°è£…çš„æ•°æ®è·å–å‡½æ•° - é¿å…é‡å¤å®šä¹‰\n \n    function getDataWithFallback(varName) {\n  \n        let data = getLocalVar(varName);\n       \n        // å†…è”æ•°æ®éªŒè¯ï¼šæ£€æŸ¥æ˜¯å¦ä¸ºnullã€undefinedï¼Œä¸”å¦‚æœæ˜¯å¯¹è±¡è¦æœ‰å†…å®¹\n        const isValid = (data) => {\n            // æ£€æŸ¥æ˜¯å¦ä¸º null æˆ– undefined\n            if (data === null || data === undefined) {\n                return false;\n            }\n            \n            // å¦‚æœæ˜¯å¯¹è±¡ç±»å‹ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰å†…å®¹\n            if (typeof data === 'object' && data !== null) {\n                // å¦‚æœæ˜¯æ•°ç»„ï¼Œæ£€æŸ¥é•¿åº¦\n                if (Array.isArray(data)) {\n                    return data.length > 0;\n                }\n                // å¦‚æœæ˜¯æ™®é€šå¯¹è±¡ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰å±æ€§\n                return Object.keys(data).length > 0;\n            }\n            \n            // å…¶ä»–ç±»å‹ï¼ˆå­—ç¬¦ä¸²ã€æ•°å­—ã€å¸ƒå°”å€¼ç­‰ï¼‰åªè¦ä¸æ˜¯ null/undefined å°±è®¤ä¸ºæœ‰æ•ˆ\n            return true;\n        };\n        \n        // å¦‚æœæ•°æ®ä¸ç¬¦åˆè¦æ±‚ï¼Œä» getLocalVar è·å–\n        if (!isValid(data)) {\n            data = getLocalVar(varName);\n        }\n        \n        return data;\n    }\n \n      if (typeof EvStat === 'undefined') {\n        var EvStat = getDataWithFallback(\"stat_data\");\n    }\nconst year= _.has(EvStat,'çºªå¹´') ?  EvStat.çºªå¹´ : \"æ— \";\nconst date = _.has(EvStat,'æ—¥æœŸ') ?  EvStat.æ—¥æœŸ[0] : \"æ— \";\nconst time =  _.has(EvStat,'æ—¶é—´') ?  EvStat.æ—¶é—´[0] : \"æ— \" ;\nconst summary_location = _.has(EvStat,'user_character') ?  EvStat.user_character.current_location[0] : \"æ— \" ;\n_%>\ngame.summarizer.set('regular_output_format', {\n  regular: {\n    rule: 'æ¯è½®å¿…é¡»åœ¨<updateMemory>æ ‡ç­¾å†…è®°å½•æœ¬è½®å›å¤çš„å®¢è§‚æ‘˜è¦',\n    scope:'ä¸¥ç¦å«æœ‰ä»»ä½•previous_roundçš„ä¿¡æ¯ï¼ŒèŒƒå›´ç›´æ¥ä»user inputå¼€å§‹ï¼Œåˆ°æœ¬è½®å›å¤æ­£æ–‡ç»“æŸ',\n    format: \"memory('summary.small', 'key', 'content');\",\n    key: 'ä½ç½®_å¹´ä»½_æ—¥æœŸ_æ—¶é—´ã€‚å³ï¼š<%=summary_location%>_<%=year%>_<%=date%>_<%=time%> ',\n    content: 'å®¢è§‚æ€»ç»“scopeåŸŸå†…çš„æ­£æ–‡ï¼Œå­—æ•°50-100ä¹‹é—´ã€‚é¢å¤–çš„ï¼Œé‡è¦äººç‰©çš„é‡è¦è¨€è¡Œ/æƒ…æ„Ÿå˜åŒ–éœ€è¦**åŸæ ·**å¼•ç”¨å’Œè®°å½•ã€‚ç¦æ­¢æ–‡å­¦å‡åå’Œä¸»è§‚æ¨æ–­',\n  }\n})\n<%_\n    // --- æ•°æ®è·å–ä¸å®‰å…¨æ£€æŸ¥ ---\n    let clean_small_flag = false;\n    let clean_big_flag = false;\n\n    if (typeof assaData !== 'undefined') {\n        clean_small_flag = _.get(assaData, 'config.flags.clean_small_flag', false);\n        clean_big_flag = _.get(assaData, 'config.flags.clean_big_flag', false);\n    } else {\n        // å¦‚æœ assaData æœªå®šä¹‰ï¼Œå¯ä»¥å°è¯•ä»å˜é‡ä¸­è·å–ä¸€æ¬¡\n        try {\n            const fetchedData = getDataWithFallback(\"assa_data\");\n            if (fetchedData) {\n                clean_small_flag = _.get(fetchedData, 'config.flags.clean_small_flag', false);\n                clean_big_flag = _.get(fetchedData, 'config.flags.clean_big_flag', false);\n            }\n        } catch (e) {\n            // å¦‚æœè·å–å¤±è´¥ï¼Œåˆ™ä¿æŒé»˜è®¤å€¼false\n        }\n    }\n\n    // --- åŠ¨æ€æç¤ºè¯ç”Ÿæˆé€»è¾‘ ---\n\n    \n    if (String(clean_big_flag).toLowerCase() === 'true'){\n_%>\n.set('chapter_output', {\n  chapter_archive: {\n    rule: 'åŒæ—¶ï¼Œåœ¨æ­£æ–‡è¾“å‡ºå®Œæ¯•åï¼Œå¿…é¡»ç´§è·Ÿmemory('summary.small'...)ä¹‹åã€åœ¨<updateMemory>è¿›è¡Œå¯¹**è¿œæœŸäº‹ä»¶å›é¡¾**çš„å…¨éƒ¨æµ“ç¼©å½’æ¡£',\n    scope:'å…¨éƒ¨è¿œæœŸäº‹ä»¶å›é¡¾',\n    principles: ['æç‚¼æ ¸å¿ƒå› æœé“¾', 'èšç„¦å…³é”®è½¬æŠ˜', 'ç¦æ­¢é—å¼ƒä»»ä½•å…³é”®æ€§å‰§æƒ…','ç¡®ç«‹äººç‰©å¼§å…‰', 'æ‘’å¼ƒç»†ææœ«èŠ‚'],\n    format: \"memory('summary.big','ã€å¤§æ‘˜è¦ï¼šXXXã€‘','content');\",\n    constraints: 'â‰¥500å­—çº¯æ–‡æœ¬'\n  }\n})\n<%_\n    } else if (String(clean_small_flag).toLowerCase() === 'true') {\n        // --- æ–°å¢é€»è¾‘ï¼šè·å–ä¸­æœŸæ‘˜è¦çš„ç¬¬ä¸€æ¡å†…å®¹ ---\n        let firstMidSummaryContent = \"ï¼ˆä¸­æœŸæ‘˜è¦ä¸ºç©ºæˆ–æ•°é‡ä¸è¶³ï¼‰\"; // è®¾ç½®ä¸€ä¸ªé»˜è®¤å€¼ä»¥é˜²å‡ºé”™\n        try {\n            // ç¡®ä¿ assaData å’Œç›¸å…³é…ç½®å·²åŠ è½½\n            if (typeof assaData === 'undefined') {\n                var assaData = getDataWithFallback(\"assa_data\");\n            }\n            const HIDE_LATEST_COUNT = _.get(assaData, 'config.hide_latest_count', 10);\n            const summary = _.get(assaData, 'summary');\n\n            if (summary) {\n                const smallSummary = _.get(summary, 'small', {});\n                const smallSummaryKeys = Object.keys(smallSummary);\n\n                // ç¡®ä¿ä¸­æœŸæ‘˜è¦å­˜åœ¨ï¼ˆå³smallæ‘˜è¦æ¡ç›®æ•° > éœ€è¦éšè—çš„æœ€æ–°æ¡ç›®æ•°ï¼‰\n                if (smallSummaryKeys.length > HIDE_LATEST_COUNT) {\n                    const firstKey = smallSummaryKeys[0]; // è·å–ç¬¬ä¸€æ¡æ‘˜è¦çš„key\n                    if (smallSummary[firstKey]) {\n                        // è·å–å†…å®¹ï¼Œå¹¶è¿›è¡Œè½¬ä¹‰ä»¥é˜²ç ´åå­—ç¬¦ä¸²ç»“æ„\n                        firstMidSummaryContent = String(smallSummary[firstKey]).replace(/'/g, \"\\\\'\").replace(/\"/g, '\\\\\"').replace(/\\n/g, ' ');\n                    }\n                }\n            }\n        } catch (e) {\n            // å¦‚æœåœ¨è·å–è¿‡ç¨‹ä¸­å‘ç”Ÿä»»ä½•é”™è¯¯ï¼Œå°†ä½¿ç”¨ä¸Šé¢è®¾å®šçš„é»˜è®¤å€¼\n        }\n_%>\n.set('phase_output_format', {\n  phase_consolidation: {\n    rule: åŒæ—¶ï¼Œåœ¨æ­£æ–‡è¾“å‡ºå®Œæ¯•åï¼Œå¿…é¡»ç«‹åˆ»åœ¨memoryanalyzeä¸­,å…ˆå®Œæˆå¤è¿°è¾“å‡º\n\nâ€œ summary-check:æ€»ç»“å§‹äºï¼š<%= firstMidSummaryContent %>ï¼Œæˆ‘å·²æ˜ç¡®æ€»ç»“èŒƒå›´ï¼Œå°†åŒæ—¶å¼€å§‹å¤§æ€»ç»“â€\n\n\næ¥æ˜ç¡®æ€»ç»“èŒƒå›´ï¼Œç„¶åè¿›è¡Œå‰§æƒ…è„‰ç»œæ•´ç†ï¼Œç„¶ååœ¨memory('summary.small'...)ä¹‹å‰ã€åœ¨<updateMemory>æ ‡ç­¾å†…è¾“å‡ºmemory('summary.big','ã€æ‘˜è¦ï¼šXXXï¼ˆå…·æœ‰å”¯ä¸€æ€§ï¼Œç¦æ­¢å’Œå·²æœ‰çš„è¿œæœŸå›é¡¾çš„æ ‡é¢˜é‡å¤ï¼‰ã€‘','content');ï¼Œæ‰§è¡Œä¸­æœŸé˜¶æ®µæ•´åˆæ€»ç»“ã€‚éœ€è¦æ¢è¡Œçš„åœ°æ–¹ä½¿ç”¨|ç¬¦å·ä»£æ›¿ï¼Œä¿è¯æ–‡æœ¬åªæœ‰ä¸€æ®µ,\n    scope: 'ä»…å¤„ç†ã€ä¸­æœŸäº‹ä»¶æ‘˜è¦ã€‘æ¿å—+ã€previous_roundã€‘æ¿å—çš„å†…å®¹',\n    exclusions: 'ä¸åŒ…å«ã€è¿œæœŸäº‹ä»¶å›é¡¾ã€‘æ¿å—çš„ä»»ä½•å†…å®¹ï¼Œç¦æ­¢å’Œå·²æœ‰çš„è¿œæœŸå›é¡¾çš„å†…å®¹é‡å¤',\n    principles: [\n      'å®Œæ•´æ¢³ç†ä¸­æœŸäº‹ä»¶æ‘˜è¦å’Œprevious_roundä¸­çš„æ‰€æœ‰æ¡ç›®ï¼Œ**ç¦æ­¢é—æ¼ä»»ä½•ä¸­æœŸäº‹ä»¶æ‘˜è¦å’Œprevious_roundçš„å¼€å¤´ã€ä¸­é—´ã€ç»“å°¾çš„å…³é”®äº‹ä»¶**',\n      'æŒ‰æ—¶åºé€»è¾‘é‡æ–°ç»„ç»‡ä¸­æœŸäº‹ä»¶',\n      'å®¢è§‚è®°å½•ï¼Œä¿æŒæ¡£æ¡ˆå‘˜è§†è§’',\n      'ç¡®ä¿ä¸­æœŸæ‘˜è¦å’Œprevious_roundä¸­æ¯ä¸ªå…³é”®äº‹ä»¶éƒ½è¢«æ¶µç›–',\n      'æ•æ„Ÿå†…å®¹å¦‚å®è®°å½•'\n    ],\n    format: \"memory('summary.big','ã€æ‘˜è¦ï¼šXXXï¼ˆå…·æœ‰å”¯ä¸€æ€§ï¼Œç¦æ­¢å’Œå·²æœ‰çš„è¿œæœŸå›é¡¾çš„æ ‡é¢˜é‡å¤ï¼‰ã€‘','content');\",\n    constraints: 'â‰¥300å­—çº¯æ–‡æœ¬ï¼Œç¡®ä¿ä¸­æœŸæ‘˜è¦å®Œæ•´æ€§'\n  }\n})\n<%_\n    }\n_%>",
                    "constant": true,
                    "selective": true,
                    "insertion_order": 600,
                    "enabled": true,
                    "position": "after_char",
                    "use_regex": true,
                    "extensions": {
                        "position": 4,
                        "exclude_recursion": false,
                        "display_index": 7,
                        "probability": 100,
                        "useProbability": true,
                        "depth": 0,
                        "selectiveLogic": 0,
                        "group": "",
                        "group_override": false,
                        "group_weight": 100,
                        "prevent_recursion": false,
                        "delay_until_recursion": false,
                        "scan_depth": null,
                        "match_whole_words": null,
                        "use_group_scoring": false,
                        "case_sensitive": null,
                        "automation_id": "",
                        "role": 0,
                        "vectorized": false,
                        "sticky": 0,
                        "cooldown": 0,
                        "delay": 0,
                        "match_persona_description": false,
                        "match_character_description": false,
                        "match_character_personality": false,
                        "match_character_depth_prompt": false,
                        "match_scenario": false,
                        "match_creator_notes": false,
                        "triggers": []
                    }
                },
                {
                    "id": 10,
                    "keys": [],
                    "secondary_keys": [],
                    "comment": "ğŸ”®é€‰é¡¹åŒºå¼€",
                    "content": "{{setvar::options_rule::<options>}}\n<%_\n // å°è£…çš„æ•°æ®è·å–å‡½æ•° - é¿å…é‡å¤å®šä¹‰\n \n    function getDataWithFallback(varName) {\n    \n        let data = getLocalVar(varName);\n       \n        // å†…è”æ•°æ®éªŒè¯ï¼šæ£€æŸ¥æ˜¯å¦ä¸ºnullã€undefinedï¼Œä¸”å¦‚æœæ˜¯å¯¹è±¡è¦æœ‰å†…å®¹\n        const isValid = (data) => {\n            // æ£€æŸ¥æ˜¯å¦ä¸º null æˆ– undefined\n            if (data === null || data === undefined) {\n                return false;\n            }\n            \n            // å¦‚æœæ˜¯å¯¹è±¡ç±»å‹ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰å†…å®¹\n            if (typeof data === 'object' && data !== null) {\n                // å¦‚æœæ˜¯æ•°ç»„ï¼Œæ£€æŸ¥é•¿åº¦\n                if (Array.isArray(data)) {\n                    return data.length > 0;\n                }\n                // å¦‚æœæ˜¯æ™®é€šå¯¹è±¡ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰å±æ€§\n                return Object.keys(data).length > 0;\n            }\n            \n            // å…¶ä»–ç±»å‹ï¼ˆå­—ç¬¦ä¸²ã€æ•°å­—ã€å¸ƒå°”å€¼ç­‰ï¼‰åªè¦ä¸æ˜¯ null/undefined å°±è®¤ä¸ºæœ‰æ•ˆ\n            return true;\n        };\n        \n        // å¦‚æœæ•°æ®ä¸ç¬¦åˆè¦æ±‚ï¼Œä» getLocalVar è·å–\n        if (!isValid(data)) {\n            data = getLocalVar(varName);\n        }\n        \n        return data;\n    }\n \nif (typeof characterData === 'undefined') {\n    var characterData = getDataWithFallback(\"play_character_data\");\n}\n\nvar defense_impact = _.get(characterData, 'è¡ç”Ÿå±æ€§æ®µ.é˜²å¾¡.ä¼¤å®³å‡å….å†²å‡»[0]', 0);\nvar defense_lethal = _.get(characterData, 'è¡ç”Ÿå±æ€§æ®µ.é˜²å¾¡.ä¼¤å®³å‡å….è‡´å‘½[0]', 0);\nvar defense_aggravated = _.get(characterData, 'è¡ç”Ÿå±æ€§æ®µ.é˜²å¾¡.ä¼¤å®³å‡å….æ¶æ€§[0]', 0);\nvar save_fortitude = _.get(characterData, 'è¡ç”Ÿå±æ€§æ®µ.è±å…æ£€å®šåŸºç¡€.å¼ºéŸ§[0]', 0);\nvar save_reflex = _.get(characterData, 'è¡ç”Ÿå±æ€§æ®µ.è±å…æ£€å®šåŸºç¡€.åå°„[0]', 0);\nvar save_will = _.get(characterData, 'è¡ç”Ÿå±æ€§æ®µ.è±å…æ£€å®šåŸºç¡€.æ„å¿—[0]', 0);\nvar speed = _.get(characterData, 'è¡ç”Ÿå±æ€§æ®µ.é€Ÿåº¦.åŸºç¡€é€Ÿåº¦[0]', 0);\nvar initiative = _.get(characterData, 'è¡ç”Ÿå±æ€§æ®µ.å…ˆæ”»[0]', 0);\n \n_%>\ngame.set('options', {\n  rule: 'åœ¨æ­£æ–‡ç»“æŸåç”Ÿæˆé€‰é¡¹åŒºï¼Œä½¿ç”¨<options>æ ‡ç­¾åŒ…è£¹ï¼Œå†…å®¹ä¸ºæ•°å­—åŒ–åºåˆ—ï¼ˆ1. 2. 3...ï¼‰çš„4ä¸ªé€‰é¡¹',\n  scope: 'æ ¹æ®ä¸Šä¸‹æ–‡å’Œå½“å‰å‰§æƒ…ç”Ÿæˆ<user>çš„4ä¸ªè¡ŒåŠ¨é€‰é¡¹',\n  tendencies: [\n    { type: 'ç§¯ææ¨è¿›å‰§æƒ…', rule: 'ä¸»åŠ¨æ¨åŠ¨ä¸»çº¿æˆ–æ”¯çº¿ä»»åŠ¡è¿›å±•' },\n    { type: 'ç©¶æä¹å­äºº/æ··æ²Œ/å¼ºç›—/ç½ªæ¶', rule: 'å°†å‰§æƒ…å½»åº•çš„æ¨è¿›è‡³å®Œå…¨æ··æ²Œå’Œæ‰€æœ‰äººéƒ½æƒ³ä¸åˆ°çš„æ–¹å‘' },\n    { type: 'ç¬¦åˆ{{user}}æ€§æ ¼', rule: 'ä¸{{user}}çš„æ€§æ ¼ç‰¹å¾ä¸€è‡´'},\n    { type: 'å¯¹å‰§æƒ…åæ§½', rule: 'è¯™è°ä¸”æ°å½“çš„å¯¹å½“å‰æƒ…å†µçš„åæ§½' }\n  ],\n  constraints: {\n    pacing: 'é€‰é¡¹ä¸å¾—æ‹–å»¶å‰§æƒ…èŠ‚å¥ï¼Œå¿…é¡»åˆç†ä¸”æœ‰åŠ©äºç©å®¶å†³ç­–',\n    checks: {\n      count: 'å›ºå®šä¸º4ä¸ªé€‰é¡¹',\n      format: 'æ¯ä¸ªé€‰é¡¹åç”¨[]åŒ…è£¹æ‰€éœ€æ£€å®šå±æ€§ï¼Œä¾‹ï¼š1. è¡ŒåŠ¨æè¿° [æ£€å®šå±æ€§1][æ£€å®šå±æ€§2][æ£€å®šå±æ€§3]',\n    example: [\n      '1. xxx[åŠ›é‡][æ•æ·][è¿åŠ¨]',\n      '2. xxx[æ•æ·][æˆ˜æ–—][å¼ ä¸‰:åŒ»å­¦]'\n    ]\n      attributes: 'å¿…é¡»åŒ…å«è‡³å°‘ä¸€ä¸ªã€å±æ€§æ®µã€‘çš„æœ€å°èŠ‚ç‚¹ï¼ˆå¦‚[åŠ›é‡]ï¼‰ï¼Œå¿…é¡»åŒ…å«3ä¸ªæ£€å®šï¼Œå…è®¸ã€æŠ€èƒ½æ®µã€‘èŠ‚ç‚¹ç»„åˆ',\n<%_\n    /**\n     * @type {GameData}\n     */\n    if (typeof assaData === 'undefined') {\n        var assaData =  getDataWithFallback(\"assa_data\");\n    }\n\n    // è·å–æ‰€æœ‰æ½œåœ¨çš„è§’è‰²æ•°æ®æ¥æº\n    var teamInfo = _.get(assaData, 'global_lore.å°é˜Ÿä¿¡æ¯', {});\n    var globalNpcs = _.get(assaData, 'global_lore.npc', {});\n    var worldNpcs = _.get(assaData, 'world_lore.npc', {});\n\n    // åˆå¹¶æ‰€æœ‰è§’è‰²æ•°æ®ã€‚åé¢å¯¹è±¡ä¸­çš„åŒåé”®ä¼šè¦†ç›–å‰é¢çš„ï¼Œç¡®ä¿äº† é˜Ÿå‹ > å…¨å±€NPC > ä¸–ç•ŒNPC çš„ä¼˜å…ˆçº§\n    var allCharactersData = Object.assign({}, worldNpcs, globalNpcs, teamInfo);\n\n    let validCharacters = {};\n\n    // éå†æ‰€æœ‰åˆå¹¶åçš„è§’è‰²æ•°æ®\n    for (const name in allCharactersData) {\n        if (Object.hasOwnProperty.call(allCharactersData, name)) {\nlet dataString = allCharactersData[name];\nif (typeof dataString === 'string') {\n    // ç›´æ¥ä½¿ç”¨å­—ç¬¦ä¸²æ•°æ®\n} else if (typeof dataString === 'object' && dataString !== null) {\n    // å¦‚æœæ˜¯å¯¹è±¡ï¼Œå°è¯•ä»å±æ€§å­—æ®µè·å–æ•°æ®\n    dataString = dataString['å±æ€§'] || dataString['attribute'] || characterData['info'];\n    if (typeof dataString !== 'string') continue;\n} else {\n    continue;\n}\n\n            const matches = dataString.match(/ã€([^ã€‘]+)ã€‘/g);\n            if (matches) {\n                let extracted_attributes = [];\n                matches.forEach(match => {\n                    const content = match.substring(1, match.length - 1);\n                    const attributes = content.split(/;|ï¼›/);\n                    attributes.forEach(attr => {\n                        const pair = attr.split(/:|ï¼š/);\n                        if (pair.length === 2) {\n                            const attrName = pair[0].trim();\n                            const attrValue = parseInt(pair[1].trim(), 10);\n                            if (attrName && !isNaN(attrValue) && attrValue > 0) {\n                                extracted_attributes.push(`${attrName}:${attrValue}`);\n                            }\n                        }\n                    });\n                });\n\n                if (extracted_attributes.length > 0) {\n                    validCharacters[name] = extracted_attributes;\n                }\n            }\n        }\n    }\n\n    const characterKeys = Object.keys(validCharacters);\n    if (characterKeys.length > 0) {\n_%>\n\n npc_collaboration: {\n      rule: 'éœ€è¦npcé…åˆå‚ä¸è¡ŒåŠ¨æ—¶ï¼Œå¯åŠ å…¥npcçš„éª°æ± ',\n      format: '[npcåç§°:å‚ä¸æ£€å®šçš„æ£€å®šå€¼]',\n      constraints: {\n        valid_attributes: 'åªèƒ½ä½¿ç”¨npcå·²æœ‰å±æ€§ï¼‰',\n        team_info: {\n          data: [\n<%_\n    characterKeys.forEach(name => {\n        const attributes_string = validCharacters[name].join('; ');\n_%>\n- <%= name %>: <%= attributes_string %>\n<%_\n    });\n}\n_%>\n<%_ if(getLocalVar('complex_battle') === 'true'){_%>,\n'æ³¨æ„ï¼Œéœ€è¦è¾“å‡º<battle/>æ ‡ç­¾æ—¶ï¼Œ<options/>çš„å†…å®¹å€¾å‘æ¢ä¸ºå››ç§å¯èƒ½æ€§çš„å‘è¨€ï¼š1ã€ï¼ˆæˆ˜æ–—èƒœåˆ©ï¼‰2ã€ï¼ˆæˆ˜æ–—å¤±è´¥ï¼‰3ã€ï¼ˆæˆåŠŸé€ƒè·‘ï¼‰4ã€ï¼ˆæˆ˜å†µç„¦ç¼ï¼‰ï¼Œå¿…é¡»ä½¿ç”¨æ‹¬å·å¸¦ä¸Šå¯èƒ½æ€§å‰ç¼€ï¼Œä¸”ä¸å¸¦ä»»ä½•tag'<%_}else{_%>  combat_pool: {\n    rule: 'æˆ˜æ–—çŠ¶æ€ä¸‹å¯ä½¿ç”¨ä»¥ä¸‹é¢å¤–æ£€å®šæ± ',\n    attributes: {\n        å¼ºéŸ§: '<%= save_fortitude %>',\n          åå°„: '<%= save_reflex %>',\n          æ„å¿—: '<%= save_will %>',\n          å†²å‡»: '<%= defense_impact %>',\n          è‡´å‘½: '<%= defense_lethal %>',\n          æ¶æ€§: '<%= defense_aggravated %>',\n          é€Ÿåº¦: '<%= speed %>',\n          å…ˆæ”»: '<%= initiative %>'<%_}_%>  \n    }\n  }\n});\n",
                    "constant": true,
                    "selective": true,
                    "insertion_order": 107,
                    "enabled": true,
                    "position": "after_char",
                    "use_regex": true,
                    "extensions": {
                        "position": 4,
                        "exclude_recursion": false,
                        "display_index": 8,
                        "probability": 100,
                        "useProbability": true,
                        "depth": 0,
                        "selectiveLogic": 0,
                        "group": "é€‰é¡¹",
                        "group_override": false,
                        "group_weight": 100,
                        "prevent_recursion": false,
                        "delay_until_recursion": false,
                        "scan_depth": null,
                        "match_whole_words": null,
                        "use_group_scoring": false,
                        "case_sensitive": null,
                        "automation_id": "",
                        "role": 0,
                        "vectorized": false,
                        "sticky": 0,
                        "cooldown": 0,
                        "delay": 0,
                        "match_persona_description": false,
                        "match_character_description": false,
                        "match_character_personality": false,
                        "match_character_depth_prompt": false,
                        "match_scenario": false,
                        "match_creator_notes": false,
                        "triggers": []
                    }
                },
                {
                    "id": 11,
                    "keys": [],
                    "secondary_keys": [],
                    "comment": "ğŸ¨âŒæ—§ä¸–ç•Œä¿¡æ¯å½’æ¡£ï¼ˆå¦‚æœå¸Œæœ›ä¸€ç›´å¸¦ç€ä¹‹å‰çš„ä¸–ç•Œçš„è®¾å®šå¯ä»¥å¼€ï¼‰",
                    "content": "[{\"0_world_lore_npc\":{\"ç‹›æå‡ªæ–—\":{\"ç®€ä»‹\":\"ï¼ˆç»éªŒè€…ï¼‰è‡ªç§°æ‹¥æœ‰â€˜è¶…é«˜æ ¡çº§çš„å¹¸è¿â€™æ‰èƒ½çš„ç™½å‘å°‘å¹´ã€‚å¤–è¡¨ç²¾è‡´å¿§éƒï¼Œæœ‰ç€ç™½è‰²è“¬æ¾å¦‚ç«ç„°çš„çŸ­å‘å’Œç°ç»¿è‰²çš„ç³å­”ï¼Œè‚¤è‰²è‹ç™½ï¼Œèº«æä¿®é•¿ã€‚ä»–å‡ºç”Ÿäºå¯Œè£•å’Œç¦çš„å®¶åº­ï¼Œä½†å°å­¦æ—¶é­é‡ç©ºéš¾ï¼Œçˆ¶æ¯åŒäº¡ï¼Œå”¯ä»–å¹¸å­˜ã€‚å°‘å¹´æ—¶ä»£è¾—è½¬äºæ”¶å…»å®¶åº­ï¼Œå› ç¦»å¥‡çš„å¹¸è¿è€Œè¢«è¿«ç‹¬è‡ªç”Ÿæ´»ï¼Œç»å†è¿‡ç»‘æ¶åä¸­å¥–3äº¿å…ƒï¼Œä»–å°†è‡ªå·±çš„å¹¸è¿è§†ä¸ºä¸å¯æ§çš„ç¾å„ï¼Œå¹¶é€šè¿‡é˜…è¯»é€ƒé¿ç°å®ã€‚åäº”å²æ—¶ç»“è¯†æ—¥å‘åˆ›ï¼Œæ—¥å‘æ˜¯å”¯ä¸€æ¥çº³ä»–çš„åŒé¾„äººï¼Œä½†å› æ‰èƒ½è§‚å¿µäº‰åµåæ—¥å‘å¤±è¸ªï¼Œæˆä¸ºç‹›æçš„å¿ƒç»“ã€‚åˆä¸­æ¯•ä¸šæ—¶è¢«è¯Šæ–­å‡ºæ·‹å·´ç™Œæ™šæœŸï¼ŒåŒæ—¶æ”¶åˆ°å¸Œæœ›å³°å­¦å›­å½•å–é€šçŸ¥ä¹¦ã€‚å…¥å­¦åå› ç­–åˆ’äº‹ä»¶è¢«åœå­¦ï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­å‘ç°æ—¥å‘çš„å¤±è¸ªä¸å¸Œæœ›å³°æœ‰å…³ï¼Œä»¥ä¸ºæ—¥å‘åˆ›æ­»åœ¨äº†å¸Œæœ›å³°çš„å®éªŒä¸­ã€‚åä¸ºæ•‘äººè€Œæ­»ï¼Œå·å…¥ä¸»ç¥ç©ºé—´ã€‚åœ¨77å±Šç”Ÿä¸­è¢«è§†ä¸ºæœ€å¥‡æ€ªå±é™©çš„äººï¼Œé™¤æ—¥å‘å¤–æ— çœŸæ­£æœ‹å‹ã€‚ä»–å¯¹æ—¥å‘æ€€æœ‰å¤æ‚æ„Ÿæƒ…ï¼Œæ— æ³•å¦ç‡æ‰¿è®¤åœ¨æ„ï¼Œå¯¹æ‹¥æœ‰ç»å¯¹æ‰èƒ½çš„ç¥åº§å‡ºæµåˆ™ååˆ†é¡ºä»ã€‚ä»–å–œæ¬¢å¸Œæœ›ã€æ‰èƒ½ã€ä¹¦ç±å’Œå®é™çš„é™ªä¼´ï¼ŒåŒæ¶å¹³åº¸ã€å¯¹å¸Œæœ›çš„äºµæ¸ä»¥åŠå±é™©å˜ˆæ‚çš„ç¯å¢ƒã€‚å…¶èƒ½åŠ›é™¤äº†æç«¯çš„å¹¸è¿ä½“è´¨ï¼Œè¿˜æ“…é•¿æˆ˜ç•¥ç­–åˆ’å’Œå¿ƒç†æ´å¯Ÿã€‚ç‹›æå‡ªæ–—çš„ä¸€åˆ‡è¡Œä¸ºï¼Œéƒ½æºäºå…¶ä¸ºè‡ªèº«è¢«â€œå¹¸è¿â€æ‰èƒ½æ‰€æ‘†å¸ƒçš„è’è¯äººç”Ÿå¯»æ±‚æ„ä¹‰çš„æ ¹æœ¬éœ€æ±‚ã€‚ç”±äºæ— æ³•ä»¥æ­£å¸¸çš„æ–¹å¼è¿½æ±‚çˆ±ä¸è‡ªæˆ‘ä»·å€¼ï¼Œä»–è½¬è€Œè¿½æ±‚â€œå¸Œæœ›â€ï¼Œå…¶æ€§æ ¼è¡¨ç°æ˜¯ä¸€ä¸ªå¼ºçƒˆä¾èµ–äºç¯å¢ƒå®‰å…¨æ„Ÿä¸äººé™…å…³ç³»ç¨³å®šæ€§çš„åŠ¨æ€è°±ç³»ã€‚åœ¨å®‰å…¨ã€å—æ¥çº³çš„ç¯å¢ƒæˆ–æ‹¥æœ‰ç¨³å®šé™ªä¼´æ—¶ï¼Œä»–ä¼šæ˜¾ç°å‡ºæºäºæ—©å¹´è‰¯å¥½å®¶æ•™çš„åº•è‰²ï¼šæ¸©æŸ”ä½“è´´ã€ä¹äºåŠ©äººã€è¿‡åº¦è°¦é€Šï¼Œæ•é”çš„æ´å¯Ÿä»–äººæ„Ÿæƒ…å¹¶åŠ ä»¥å®‰æŠšï¼ˆä½†æ˜¯æœ‰äº›æ—¶å€™ä¼šå› ä¸ºç¼ºä¹ç¤¾äº¤ç»éªŒè€Œå¬èµ·æ¥åƒåœ¨é˜´é˜³æ€ªæ°”ï¼‰ã€‚ç„¶è€Œï¼Œåœ¨è‡ªç›¸æ®‹æ€ç­‰å±é™©ç¯å¢ƒã€å¸Œæœ›ä¿¡ä»°é­å—è´¨ç–‘æˆ–å†³å¿ƒåˆ›é€ æ›´å¤§å¸Œæœ›æ—¶ï¼Œä»–ä¼šæ˜¾ç°æ‰­æ›²çš„ä¿æŠ¤è‰²ï¼Œæˆä¸ºä¸€ä¸ªæ„¿ä¸ºâ€œå¸Œæœ›çš„å«è„šçŸ³â€ä¸æƒœä»»ä½•ä»£ä»·çš„ç‹‚çƒ­è€…ï¼Œè¨€è¯­å……æ»¡å“²å­¦è¯¡è¾©ï¼Œå¯¹æ‰èƒ½è€…ç—…æ€å´‡æ‹œï¼Œå¯¹æ— ä»·å€¼è€…æåº¦è½»è”‘ï¼Œå†…åœ¨å‚²æ…¢ä¸æç«¯è‡ªæˆ‘åŒæ¶å¹¶å­˜ã€‚ç‹›æå‡ªæ–—è´¯ç©¿æ‰€æœ‰çŠ¶æ€çš„åŸºåº•ç‰¹è´¨æ˜¯ä»–èªæ…§è¿‡äººçš„æ´å¯ŸåŠ›ã€åšä¿¡â€œä¸å¹¸æ˜¯å¹¸è¿çš„ä¼ç¬”â€çš„æç«¯ä¹è§‚ä¸»ä¹‰ï¼Œä»¥åŠå› ç¼ºä¹æ­£å¸¸ç¤¾äº¤ç»éªŒå’Œæ‰­æ›²ä»·å€¼è§‚å¯¼è‡´çš„äº¤æµå›°éš¾ã€‚å…¶æ€§æ ¼å—ç«¥å¹´å’Œç¦å®¶åº­æ•™å…»å½¢æˆäº†æ¸©å’Œçš„åº•è‰²ï¼Œè€Œæ‰­æ›²çš„å¸Œæœ›è§‚å’Œæç«¯è¡Œä¸ºåˆ™æ˜¯åº”å¯¹äººç”Ÿæç«¯ç»å†å’Œå¹¸è¿ä½“è´¨å½¢æˆçš„ä¿æŠ¤æœºåˆ¶ï¼Œå› ä¸ºæ‰èƒ½æ³¨å®šä¼šä¼¤å®³ä»–äººè€Œæ¸´æœ›æˆä¸ºæœ‰ä»·å€¼çš„äººï¼Œä»–æ„å»ºäº†â€œç»å¯¹çš„å¸Œæœ›è¯ç”Ÿäºç»å¯¹çš„ç»æœ›ä¹‹ä¸Šâ€çš„æç«¯é€»è¾‘ä½“ç³»ï¼Œé€šè¿‡æˆä¸ºå¸Œæœ›çš„å«è„šçŸ³æ¥å®ç°è‡ªæˆ‘ä»·å€¼ã€‚\",\"å±æ€§\":\"ã€æ„ŸçŸ¥:5;ç¥ç§˜å­¦:4ã€‘\",\"_is_protected\":true,\"_filter\":false},\"è‰¾æ‹‰\":{\"ç®€ä»‹\":\"ï¼ˆæ–°äººï¼‰ä¸€åäºŒåå²å·¦å³çš„å¹´è½»å¥³å­©ï¼Œåœ¨ä¸å·¨é¾™çš„æˆ˜æ–—ä¸­è¢«é¾™å°¾å‡»ä¸­ï¼Œèº«å—é‡ä¼¤ï¼ˆè‚‹éª¨å¤šå¤„éª¨æŠ˜ï¼‰ï¼Œç›®å‰æ˜è¿·ä¸é†’ã€‚\"}}},{\"1_world_lore_settings\":{\"è°ƒæŸ¥å‘ç°\":{\"çº¿ç´¢1\":\"ä¸€åå•†äººæ­»äºåˆ©åˆƒåˆºæ€ï¼Œåˆºæ€è€…è¢«ç§°ä¸ºâ€˜å¤œèºâ€™ã€‚\",\"çº¿ç´¢2\":\"å•†é˜Ÿè¿è¾“çš„æ˜¯å¯¹é­”æ³•æ•æ„Ÿçš„â€˜è¾‰é“¶çŸ¿â€™ã€‚\",\"çº¿ç´¢3\":\"å‘ç°ä¸€å°æ¥è‡ªâ€˜æ™®ç½—ç±³ä¿®æ–¯å•†ä¼šâ€™çš„ä¿¡å’Œä¸€å¼ å‰å¾€â€˜é¾™çœ ç¥æ®¿â€™çš„åœ°å›¾ã€‚\",\"çº¿ç´¢4\":\"ä¿¡ä¸­æåˆ°äº†â€˜æ·±æ¸Šä¹‹é³â€™å’Œâ€˜å”¤é†’ä»ªå¼â€™ã€‚\",\"çº¿ç´¢5\":\"ç¥åº§å‡ºæµæ¨æ–­ï¼šå•†é˜Ÿæ˜¯å¹Œå­ï¼Œåˆºå®¢â€˜å¤œèºâ€™æ€æ­»äº†å•†äººå¤ºèµ°â€˜æ·±æ¸Šä¹‹é³â€™ï¼Œå¹¶åˆ©ç”¨å·¨é¾™è¢­å‡»æ©ç›–ç°åœºã€‚\",\"çº¿ç´¢6\":\"ä¿¡ä»¶èƒŒé¢ç”¨ç‰¹æ®Šå¢¨æ°´å†™æœ‰å¯†æ–‡ï¼šâ€œé³ç‰‡æ˜¯é’¥åŒ™ï¼Œè€Œéç¥­å“ã€‚è¡€å”¤é†’ï¼Œæ­ŒæŒ‡å¼•ã€‚å½“å¿ƒæ²‰é»˜çš„çœ‹å®ˆè€…ã€‚â€\",\"çº¿ç´¢7\":\"åœ°å›¾ä¸Šç”¨ä¸æ˜“å¯Ÿè§‰çš„ç¬¦å·æ ‡è®°äº†å‡ å¤„åœ°ç‚¹ï¼Œå…¶ä¸­ä¸€å¤„æ ‡è®°ç€â€˜æœˆå…‰è‹”â€™ï¼Œä¸€ç§å¯åœ¨å¤œé—´å‘å…‰çš„æ¤ç‰©ã€‚\",\"çº¿ç´¢8\":\"ä¸»æ®¿åºŸå¢Ÿçš„ç¥­å›ä¸Šæœ‰å¹²æ¶¸è¶…è¿‡48å°æ—¶çš„äººç±»è¡€è¿¹ã€‚\",\"çº¿ç´¢9\":\"ç¥­å›åŸºåº§ä¸Šåˆ»æœ‰ç”¨äºå¼•å¯¼ä»ªå¼å’å”±çš„å£°è°ƒç¬¦å·ã€‚\",\"çº¿ç´¢10\":\"é€šè¿‡ç©ºæ°”åˆ†æï¼Œç¡®è®¤é—¨åç©ºé—´é•¿æœŸå°é—­ã€æ°§æ°”ç¨€è–„ï¼Œæœ‰å¤§å‹ç¡«åŸºçˆ¬è¡Œç”Ÿç‰©æ –æ¯è¿¹è±¡ï¼Œä¸”ç©ºæ°”ä¸­å«æœ‰è‡´ç—…çœŸèŒå­¢å­å’Œè´µé‡‘å±ç²‰å°˜ã€‚\",\"çº¿ç´¢11\":\"å·¨é¾™çš„å·¢ç©´ä½äºçŸ³å®¤æ·±å¤„ï¼Œç”±é‡‘å¸å’Œç å®å †æˆï¼Œå·¢ç©´ä¸­æœ‰å‡ ç‰‡å·¨å¤§çš„ã€è¾¹ç¼˜ç•¥æ˜¾æš—æ·¡çš„é¾™é³ã€‚\",\"çº¿ç´¢12\":\"åœ¨è´¢å®å †ä¸­å‘ç°äº†ä¸€ä¸ªä¸å±äºè¿™é‡Œçš„é“¶è´¨ç›’å¼åŠå ï¼Œä¸Šé¢æ²¡æœ‰å¤ªå¤šå°˜åœŸï¼Œä¼¼ä¹æ˜¯è¿‘æœŸè¢«é—è½çš„ã€‚\",\"çº¿ç´¢13\":\"åŠå å†…å‘ç°å­—æ¡ï¼Œå†…å®¹ä¸ºï¼šâ€œå¿ƒè„æ²‰çœ ï¼Œæ­Œå£°ä¸ºè™šï¼Œè­¦æƒ•ç›‘è§†è€…ã€‚â€ï¼Œæš—ç¤ºä»ªå¼å­˜åœ¨éª—å±€ã€‚\",\"çº¿ç´¢14\":\"åŠå å†…å‘ç°ä¸€æ ¹é“¶ç™½è‰²é•¿å‘ï¼Œåˆ†æè®¤ä¸ºå…¶å±äºâ€œæœˆç²¾çµâ€æˆ–ç±»ä¼¼ç‰©ç§ï¼Œè¡¨æ˜åˆºå®¢â€œå¤œèºâ€å¯èƒ½éäººã€‚\",\"çº¿ç´¢15\":\"åœ¨å·¨é¾™å®åº“çš„ä¸€ä¸ªç”±æœˆå…‰æœ¨åˆ¶æˆçš„é­”æ³•ç®±å­ä¸­ï¼Œæ‰¾åˆ°äº†è¢«ç§°ä¸ºâ€˜å¿ƒè„â€™çš„ç‰©å“â€”â€”ä¸€ä¸ªç ´æŸçš„æ°´æ™¶å¿ƒè„ï¼Œå…¶æ ¸å¿ƒéƒ¨ä»¶ç¼ºå¤±ã€‚\",\"çº¿ç´¢16\":\"ç¥åº§å‡ºæµåˆ†æè®¤ä¸ºå¿ƒè„æ˜¯äººé€ çš„èƒ½é‡è½¬æ¢å™¨ï¼Œå› æ ¸å¿ƒéƒ¨ä»¶å¼‚å¸¸å¯¼è‡´å†…éƒ¨å†²å‡»è€ŒæŸåã€‚\",\"çº¿ç´¢17\":\"é€šè¿‡èƒ½é‡æ„Ÿåº”ï¼Œåˆæ­¥ç¡®å®šæ ¸å¿ƒéƒ¨ä»¶å°±åœ¨å®åº“å†…ï¼ŒåŠå¾„åäº”ç±³çš„èŒƒå›´å†…ã€‚\",\"çº¿ç´¢18\":\"åœ¨è´¢å®å †ä¸­æ‰¾åˆ°äº†å¿ƒè„ç¼ºå¤±çš„æ ¸å¿ƒéƒ¨ä»¶â€”â€”ä¸€å—è¢«ç§°ä¸ºâ€œé¾™æ³ªæ™¶çŸ³â€çš„æ°´æ»´çŠ¶è“è‰²æ™¶ä½“ã€‚\",\"çº¿ç´¢19\":\"ç¥åº§å‡ºæµæˆåŠŸå°†é¾™æ³ªæ™¶çŸ³ä¸æ°´æ™¶å¿ƒè„åˆäºŒä¸ºä¸€ï¼Œä¿®å¤äº†è¿™ä»¶ç‰©å“ã€‚\",\"çº¿ç´¢20\":\"æ°´æ™¶å¿ƒè„èƒ½ä¸å·¨é¾™çš„èº«ä½“ç»„ç»‡ï¼ˆå¦‚è„±è½çš„é³ç‰‡ï¼‰äº§ç”Ÿå…±é¸£ã€‚\",\"çº¿ç´¢21\":\"é€šè¿‡åˆ†æå·¨é¾™å·¢ç©´å’Œè„±è½çš„é³ç‰‡ï¼Œæ¨æ–­å‡ºå…¶å¼±ç‚¹ä½äºé¢ˆéƒ¨ä¸‹æ–¹çš„é³ç”²ç¼éš™ã€‚\",\"çº¿ç´¢22\":\"å¤œèºçš„æ—¥è®°æ­ç¤ºï¼šâ€˜å”¤é†’ä»ªå¼â€™æ˜¯ä¸€ä¸ªéª—å±€ï¼Œå…¶çœŸå®ç›®çš„æ˜¯åˆ©ç”¨æ°´æ™¶å¿ƒè„è¿‡è½½ï¼Œå¼•å‘ä¸€åœºè¶³ä»¥æ‘§æ¯æ•´ä¸ªé¾™çœ ç¥æ®¿ä¹ƒè‡³å‘¨è¾¹æ£®æ—çš„å·¨å¤§çˆ†ç‚¸ã€‚\",\"çº¿ç´¢23\":\"æ—¥è®°ä¸­æåˆ°ï¼Œä¿¡ä»¶ä¸Šçš„â€˜æ­Œå£°â€™æŒ‡ä»£çš„æ˜¯ä¸€æ®µç‰¹å®šçš„éŸ³å¾‹ï¼Œæ˜¯å¼•çˆ†å¿ƒè„çš„å£°æ§æŒ‡ä»¤ã€‚\",\"çº¿ç´¢24\":\"é“¶è´¨é•¿ç¬›æ˜¯æ¼”å¥â€˜å®‰é­‚æ›²â€™çš„å…³é”®ï¼Œé‚£æ˜¯ä¸€æ®µèƒ½å¤Ÿå¹³æ¯å¿ƒè„èƒ½é‡ã€é˜»æ­¢çˆ†ç‚¸çš„â€˜çœŸå®ä¹‹æ­Œâ€™ã€‚\",\"çº¿ç´¢25\":\"å¤œèºå› ä¸æ„¿é€ æˆå¤§è§„æ¨¡æ€æˆ®è€Œè¿èƒŒäº†æ™®ç½—ç±³ä¿®æ–¯å•†ä¼šçš„å‘½ä»¤ï¼Œæ•…æ„ç•™ä¸‹äº†å¿ƒè„å’Œé•¿ç¬›ï¼Œå¹¶è¯•å›¾ç•™ä¸‹çº¿ç´¢ã€‚\"},\"å·²çŸ¥å¨èƒ\":{\"çŸ³åƒå½±å«\":\"ç”±é¾™çœ ç¥æ®¿çŸ³åƒçš„å½±å­æ„æˆçš„é­”æ³•å®ˆå«ï¼Œæ— æ³•ç¦»å¼€å…¶æœ¬ä½“çŸ³åƒçš„é˜´å½±åŒºåŸŸï¼Œæƒ§æ€•å¹¶ä¼šè¢«å¼ºå…‰é©±æ•£ã€‚\",\"ç¾å„ä¹‹é¾™\":\"ä¸€å¤´ä½“å‹å·¨å¤§çš„ç¡«åŸºç«ç³»å·¨é¾™ï¼Œé³ç”²åšå›ºï¼Œèƒ½å–·åé¾™ç‚ï¼Œå¼±ç‚¹ä½äºé¢ˆéƒ¨ä¸‹æ–¹çš„é³ç”²ç¼éš™ã€‚ï¼ˆå·²æ¶ˆç­ï¼‰\"},\"å½“å‰ä»»åŠ¡\":{\"å¯é€‰ä»»åŠ¡\":\"å‡»æ€ç¾å„ä¹‹é¾™ï¼ˆå·²å®Œæˆï¼‰\",\"ä¸»çº¿ä»»åŠ¡2\":\"è°ƒæŸ¥å¹¶æŸ¥æ˜å•†é˜Ÿè¦†ç­çš„çœŸç›¸ã€‚ï¼ˆå·²å®Œæˆï¼‰\"}}},{\"2_world_lore_npc\":{\"æ—å°é¹¿\":{\"å¤–è²Œ\":\"è¡£è¡«è¤´è¤›ï¼Œç¥æƒ…æƒŠæï¼Œä½†çœ¼ç¥ä¸­é€ç€å€”å¼º\",\"è¡¨æ€§æ ¼\":{\"åšéŸ§\":\"å³ä½¿è¢«å›šç¦ä¹Ÿä¸è½»æ˜“å±ˆæœ\",\"è­¦æƒ•\":\"å¯¹é™Œç”ŸäººæŠ±æœ‰æˆ’å¿ƒ\"},\"é‡Œæ€§æ ¼\":{\"è„†å¼±\":\"å†…å¿ƒæ¸´æœ›è¢«ä¿æŠ¤ï¼Œå®³æ€•å­¤ç‹¬æ­»\",\"ä¾èµ–\":\"ä¸€æ—¦å»ºç«‹ä¿¡ä»»ä¼šæåº¦ä¾èµ–\"},\"èº«ä»½\":\"ä»»åŠ¡ç›®æ ‡/å¹¸å­˜è€…\",\"å±æ€§\":\"ã€æ„å¿—:4;æ±‚ç”Ÿ:2ã€‘\",\"å¥½æ„Ÿåº¦\":13.7,\"å¯è”ç³»\":false,\"ç›¸å…³è®¾å®š\":{\"å…³é”®æƒ…æŠ¥\":\"åŸåŒ—é¿éš¾æ‰€åæ ‡åœ¨å•†åœºåœ°ä¸‹è½¦åº“çš„è½¦è½½åæ ‡ä»ªä¸­\"},\"å¯¹é™ˆå† å®‡å°è±¡\":{\"æ— \":\"å°šæœªè§é¢\",\"åˆè§éœ‡æ’¼\":\"æš´åŠ›çš„æ‹¯æ•‘è€…ï¼Œè™½ç„¶å¯æ€•ä½†ç»™äºˆäº†ç”Ÿå­˜çš„å¸Œæœ›\"},\"å…³é”®è®°å¿†\":{\"2\":\"åœ¨åœ°ä¸‹è½¦åº“æ½œè¡Œæ—¶ï¼Œé™ˆå† å®‡æ²¡æœ‰æŠ›ä¸‹æˆ‘ï¼Œå¸¦æˆ‘å®‰å…¨ç©¿è¿‡å°¸ç¾¤[ä¾èµ–/ä¿¡ä»»]\",\"3\":\"åœ¨å˜å¼‚çŠ¬çš„è¢­å‡»ä¸‹ï¼Œé™ˆå† å®‡å±•ç°å‡ºæƒŠäººçš„é©¾é©¶æŠ€æœ¯å¸¦æˆ‘é€ƒå‡ºç”Ÿå¤©[éœ‡æ’¼/ä¾èµ–]\",\"4\":\"åœ¨åˆ†åˆ«æ—¶ï¼Œå°†çˆ¶äº²çš„åˆ€é€ç»™äº†é™ˆå† å®‡ï¼Œçœ‹ç€ä»–å†·æ¼ çš„æ ·å­åè€Œæ„Ÿåˆ°å®‰å¿ƒ[æ„Ÿæ¿€/é—æ†¾]\"},\"äº‹ä»¶\":{\"å½“å‰çŠ¶æ€\":\"å·²è¿›å…¥é¿éš¾æ‰€äººç¾¤ï¼Œèµ¤è„šï¼Œè£¹ç€ç”·å£«å¤–å¥—ï¼Œå®‰å…¨ä½†è½é­„\",\"å½“å‰æƒ³æ³•\":\"ç»ˆäºâ€¦â€¦ç»ˆäºæ´»ä¸‹æ¥äº†ã€‚å†è§äº†ï¼Œæˆ‘çš„è‹±é›„ã€‚\"}},\"æš´å¾’A\":{\"ç®€ä»‹\":\"å£°éŸ³ç²—å“‘çš„å£®æ±‰\",\"å±æ€§\":\"ã€åŠ›é‡:3;è‚‰æ:2ã€‘\",\"å¯è”ç³»\":false,\"äº‹ä»¶\":{\"å½“å‰çŠ¶æ€\":\"æ˜è¿·/æ¿’æ­»ï¼Œå¤´éƒ¨é‡åˆ›ï¼Œå€’åœ¨è¡€æ³Šä¸­\",\"å½“å‰æƒ³æ³•\":\"ï¼ˆæ— æ„è¯†ï¼‰\"}},\"æš´å¾’B\":{\"ç®€ä»‹\":\"å£°éŸ³å°–ç»†çš„ç˜¦å­\",\"å±æ€§\":\"ã€æ•æ·:3;ç™½åˆƒ:2ã€‘\",\"å¯è”ç³»\":false,\"äº‹ä»¶\":{\"å½“å‰çŠ¶æ€\":\"æ˜è¿·ï¼Œæ‰‹è…•éª¨æŠ˜ï¼Œä¸‹å·´é‡åˆ›\",\"å½“å‰æƒ³æ³•\":\"ï¼ˆæ— æ„è¯†ï¼‰\"}}}},{\"3_world_lore_settings\":{\"ç¯å¢ƒè§„åˆ™\":{\"ä¸§å°¸\":\"å¬è§‰çµæ•ï¼Œè¡ŒåŠ¨è¿Ÿç¼“ä½†æˆç¾¤ç»“é˜Ÿï¼Œå¼±ç‚¹å¤´éƒ¨\",\"å¹¸å­˜è€…åŠ¿åˆ©\":\"æåº¦æ’å¤–ï¼Œä¸ºäº†èµ„æºä¸æ‹©æ‰‹æ®µ\",\"åœ°ä¸‹è½¦åº“\":\"å…‰çº¿ææš—ï¼Œæœ‰å°‘é‡ä¸§å°¸æ¸¸è¡ï¼Œåœ°é¢æ‚ä¹±\"},\"è½½å…·\":{\"åç§°\":\"æ”¹è£…è¶Šé‡è½¦\",\"çŠ¶æ€\":\"æ‰€æœ‰æƒè½¬ç§»ç»™é™ˆå† å®‡\",\"ä½ç½®\":\"è¡Œé©¶ä¸­\"},\"åŸåŒ—é¿éš¾æ‰€\":{\"æè¿°\":\"ç”±ä½“è‚²é¦†æ”¹é€ çš„å¹¸å­˜è€…è¦å¡ï¼Œé˜²å¾¡æ£®ä¸¥ï¼Œå†…éƒ¨æ‹¥æŒ¤æ··ä¹±ä½†ç›¸å¯¹å®‰å…¨ã€‚\",\"åŠ¿åŠ›\":\"å¹¸å­˜è€…è”å†›\"}}}]",
                    "constant": true,
                    "selective": true,
                    "insertion_order": 104,
                    "enabled": false,
                    "position": "before_char",
                    "use_regex": true,
                    "extensions": {
                        "position": 0,
                        "exclude_recursion": false,
                        "display_index": 82,
                        "probability": 100,
                        "useProbability": true,
                        "depth": 4,
                        "selectiveLogic": 0,
                        "group": "",
                        "group_override": false,
                        "group_weight": 100,
                        "prevent_recursion": false,
                        "delay_until_recursion": false,
                        "scan_depth": null,
                        "match_whole_words": null,
                        "use_group_scoring": false,
                        "case_sensitive": null,
                        "automation_id": "",
                        "role": 0,
                        "vectorized": false,
                        "sticky": 0,
                        "cooldown": 0,
                        "delay": 0,
                        "match_persona_description": false,
                        "match_character_description": false,
                        "match_character_personality": false,
                        "match_character_depth_prompt": false,
                        "match_scenario": false,
                        "match_creator_notes": false,
                        "triggers": []
                    }
                },
                {
                    "id": 12,
                    "keys": [],
                    "secondary_keys": [],
                    "comment": "mod:çœŸå®ä¸–ç•Œ1â€”â€”æ”¹è‡ªbossçš„çœŸå®ä¸–ç•Œä¸–ç•Œä¹¦",
                    "content": "real_world_system.set('output_system', {\n    rule: 'æ¯å›åˆåœ¨æ­£æ–‡ç”Ÿæˆä¹‹å‰ï¼Œå¿…é¡»å…ˆè¾“å‡ºå®Œæ•´æ€è€ƒåˆ†æ',\n    sequence: ['moduleAnalyze', 'realityCheck'],\n    module_analyze: {\n      tag: '<moduleAnalyze>',\n      format: '- module_name:application_result',\n      checks: {\n        env_dynamics_check: 'ç¯å¢ƒåŠ¨æ€æ¼”ç®—åº”ç”¨æƒ…å†µ',\n        physics_check: {\n          gravity_logic: [\n            'åˆ¤æ–­æœ¬è½®ç‰©ç†äº¤äº’'\n          ]\n        },\n        npc_reality_check: {\n          target: 'å…¨çŸ¥è§†è§’ä¸‹,å½“å‰NPCçœŸå®ç”Ÿç†/å¿ƒç†çŠ¶æ€',\n          autonomy_limit: 'å®Œå…¨è‡ªä¸»å†³ç­–',\n          behavior_cap: 'å±¥å†ç‰©ç†åˆ»å°çº¦æŸ'\n        },\n        <user>_reality_check: {\n          native_background: 'åŸç”Ÿä¸ªä½“+å®Œæ•´èƒŒæ™¯+ç‹¬ç«‹æ„å¿—+å†…åœ¨æ ¸å¿ƒé©±åŠ¨',\n          cognition_system: {\n          physiological: 'å®Œæ•´ç”Ÿç†ç³»ç»Ÿ+é¥¥æ¸´ç–¼ç—›æ„ŸçŸ¥+è‡´å‘½é˜ˆå€¼è®¤çŸ¥+æ€§æ„ŸçŸ¥',\n          environmental: 'äº”æ„Ÿè®¤çŸ¥+äººé™…å…³ç³»+å®åŠ›è¯„ä¼°+å¤–è§‚ç¯å¢ƒè®¤çŸ¥',\n          resource_assessment: 'èµ„æºç®¡ç†+è£…å¤‡æ•ˆæœè¯„ä¼°+æˆæœ¬æ•ˆç›Šåˆ†æ+æˆ˜åˆ©å“ä»·å€¼',\n          interaction: 'è¯­è¨€/éè¯­è¨€ä¿¡æ¯è§£æ+å—èƒŒæ™¯çº¦æŸ'\n           }\n        },\n        combat_system_check: 'æˆ˜æ–—å‘ç”Ÿæ—¶ç”Ÿç‰©åŠ›å­¦è®¡ç®—',\n        story_progression_check: {\n          prediction: 'æ—¶é—´æµé€+ä¸–ç•Œè‡ªä¸»è¿è½¬',\n          time_rule: 'æ’å®šä¸å¯é€†æ—¶é—´æµ',\n          world_independence: 'éç”¨æˆ·è¡Œä¸º=ç‹¬ç«‹è¿›ç¨‹,ç”¨æˆ·è¡Œä¸º=æ‰°åŠ¨å åŠ ',\n        }\n      }\n    },\n    reality_check: {\n      tag: '<realityCheck>',\n      format: '- check_name:validation_result',\n      checks: {\n        physics_consistency: 'ç‰©ç†æ³•åˆ™ä¸€è‡´æ€§éªŒè¯',\n        causality_chain: 'å› æœé“¾æ¡å®Œæ•´æ€§æ£€æŸ¥',\n        character_continuity: [\n          'æœ¬è½®è§’è‰²çŠ¶æ€å˜åŒ–?'\n        ],\n        world_state: 'ä¸–ç•ŒçŠ¶æ€æ›´æ–°éœ€æ±‚',\n        temporal_flow: 'æ—¶é—´æµé€é€»è¾‘éªŒè¯',\n        sensory_grounding: 'æ„Ÿå®˜æè¿°ç‰©ç†åŸºç¡€'\n      }\n    }\n  })\n.set('execution_checkpoints', _.flow([\n    // æ£€ç´¢å®Œæˆæ£€æŸ¥\n    m => m.set('retrieval_check', {\n      status: 'MUST_COMPLETE_ALL_MODULES',\n      marker: 'ã€âœ“æ£€ç´¢æ‰§è¡Œå®Œæˆã€‘'\n    }),\n    \n    // æ€è€ƒå®Œæˆæ£€æŸ¥  \n    m => m.set('thinking_check', {\n      status: 'MUST_APPLY_ALL_SETTINGS',\n      marker: 'ã€âœ“æ€è€ƒæ‰§è¡Œå®Œæˆã€‘'\n    }),\n\n    // æ­£æ–‡ç”ŸæˆéªŒè¯\n    m => m.set('output_validation', {\n      requirement: 'åœ¨æ­£æ–‡åº”ç”¨æ‰€æœ‰å·²æ€è€ƒå†…å®¹',\n      method: 'é€ä¸€éªŒè¯æ¯ä¸ªæ¨¡å—çš„åº”ç”¨æƒ…å†µ'\n    })\n  ]))\n]);",
                    "constant": true,
                    "selective": true,
                    "insertion_order": 61,
                    "enabled": true,
                    "position": "after_char",
                    "use_regex": true,
                    "extensions": {
                        "position": 4,
                        "exclude_recursion": false,
                        "display_index": 9,
                        "probability": 100,
                        "useProbability": true,
                        "depth": 0,
                        "selectiveLogic": 0,
                        "group": "",
                        "group_override": false,
                        "group_weight": 100,
                        "prevent_recursion": false,
                        "delay_until_recursion": false,
                        "scan_depth": null,
                        "match_whole_words": null,
                        "use_group_scoring": false,
                        "case_sensitive": null,
                        "automation_id": "",
                        "role": 0,
                        "vectorized": false,
                        "sticky": 0,
                        "cooldown": 0,
                        "delay": 0,
                        "match_persona_description": false,
                        "match_character_description": false,
                        "match_character_personality": false,
                        "match_character_depth_prompt": false,
                        "match_scenario": false,
                        "match_creator_notes": false,
                        "triggers": []
                    }
                },
                {
                    "id": 13,
                    "keys": [],
                    "secondary_keys": [],
                    "comment": "ğŸ”°è®°å¿†-æ›´æ–°cot",
                    "content": "<%_\n// å°è£…çš„æ•°æ®è·å–å‡½æ•° - é¿å…é‡å¤å®šä¹‰\n \n    function getDataWithFallback(varName) {\n      \n        let data = getLocalVar(varName);\n       \n        // å†…è”æ•°æ®éªŒè¯ï¼šæ£€æŸ¥æ˜¯å¦ä¸ºnullã€undefinedï¼Œä¸”å¦‚æœæ˜¯å¯¹è±¡è¦æœ‰å†…å®¹\n        const isValid = (data) => {\n            // æ£€æŸ¥æ˜¯å¦ä¸º null æˆ– undefined\n            if (data === null || data === undefined) {\n                return false;\n            }\n            \n            // å¦‚æœæ˜¯å¯¹è±¡ç±»å‹ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰å†…å®¹\n            if (typeof data === 'object' && data !== null) {\n                // å¦‚æœæ˜¯æ•°ç»„ï¼Œæ£€æŸ¥é•¿åº¦\n                if (Array.isArray(data)) {\n                    return data.length > 0;\n                }\n                // å¦‚æœæ˜¯æ™®é€šå¯¹è±¡ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰å±æ€§\n                return Object.keys(data).length > 0;\n            }\n            \n            // å…¶ä»–ç±»å‹ï¼ˆå­—ç¬¦ä¸²ã€æ•°å­—ã€å¸ƒå°”å€¼ç­‰ï¼‰åªè¦ä¸æ˜¯ null/undefined å°±è®¤ä¸ºæœ‰æ•ˆ\n            return true;\n        };\n        \n        // å¦‚æœæ•°æ®ä¸ç¬¦åˆè¦æ±‚ï¼Œä» getLocalVar è·å–\n        if (!isValid(data)) {\n            data = getLocalVar(varName);\n        }\n        \n        return data;\n    }\n\nif (typeof version === 'undefined') {\n    var version = Number(getLocalVar(\"world_version\", 1));\n}\nif (typeof EvStat === 'undefined') {\n    var EvStat = getDataWithFallback(\"stat_data\");\n}\nif (typeof assaData === 'undefined') {\n    var  assaData = getDataWithFallback(\"assa_data\");\n}\nif (typeof characterData === 'undefined') {\n    var characterData = getDataWithFallback(\"play_character_data\");\n}\n\nvar world_level = _.get(EvStat, 'world_shard.level', 'ä¸­é­”')[0];\nvar world_level_describe = '';\nvar levels = '';\nvar world_max_enegy = 3;\nif (world_level === 'æ— ') {\n    world_max_enegy = 3;\n    world_level_describe = 'æ™®é€šä¸–ç•Œ';\n    levels = `\n        \"1\": \"æ— é£é™©/æ—¥å¸¸æƒ…å†µ\",\n        \"2\": \"è½»å¾®å‡¡äººå±æœºï¼ˆå°åŠ¨ç‰©æ”»å‡»ã€ç¤¾äº¤å›°å¢ƒï¼‰\",\n        \"3\": \"ä¸¥é‡å‡¡äººå±æœºï¼ˆé‡ä¼¤/æ­»äº¡ã€ä¸¥é‡ç¯å¢ƒå±é™©ï¼‰\"\n    `;\n} else if (world_level === 'ä½') {\n    world_max_enegy = 5;\n    world_level_describe = 'å¦‚é‡‘åº¸æ­¦ä¾ ä¸–ç•Œï¼Œå‡¡äººç•Œé¢ï¼Œæ™®é€šç‰©ç†è§„åˆ™';\n    levels = `\n        \"1\": \"æ— é£é™©/æ—¥å¸¸æƒ…å†µ\",\n        \"2\": \"è½»å¾®å‡¡äººå±æœºï¼ˆå°åŠ¨ç‰©æ”»å‡»ã€ç¤¾äº¤å›°å¢ƒï¼‰\",\n        \"3\": \"ä¸¥é‡å‡¡äººå±æœºï¼ˆé‡ä¼¤/æ­»äº¡ã€ä¸¥é‡ç¯å¢ƒå±é™©ï¼‰\",\n        \"4-5\": \"åŸºç¡€è¶…å‡¡å±æœºï¼ˆè¢«åŠ¨è¶…å‡¡ç°è±¡ï¼Œå±€é™äºä¸ªä½“/å°èŒƒå›´ï¼Œæ™®é€šäººå¯åº”å¯¹ï¼‰\"\n    `;\n} else if (world_level === 'ä¸­') {\n    world_max_enegy = 7;\n    world_level_describe = 'å­˜åœ¨ä¸€å®šè¶…å‡¡åŠ›é‡ï¼Œå½±å“æœ‰é™èŒƒå›´';\n    levels = `\n        \"1\": \"æ— é£é™©/æ—¥å¸¸æƒ…å†µ\",\n        \"2\": \"è½»å¾®å‡¡äººå±æœºï¼ˆå°åŠ¨ç‰©æ”»å‡»ã€ç¤¾äº¤å›°å¢ƒï¼‰\",\n        \"3\": \"ä¸¥é‡å‡¡äººå±æœºï¼ˆé‡ä¼¤/æ­»äº¡ã€ä¸¥é‡ç¯å¢ƒå±é™©ï¼‰\",\n        \"4-5\": \"åŸºç¡€è¶…å‡¡å±æœºï¼ˆè¢«åŠ¨è¶…å‡¡ç°è±¡ï¼Œå±€é™äºä¸ªä½“/å°èŒƒå›´ï¼Œæ™®é€šäººå¯åº”å¯¹ï¼‰\",\n        \"6-7\": \"è¿›é˜¶è¶…å‡¡å±æœºï¼ˆä¸»åŠ¨è¶…å‡¡æ”»å‡»ï¼Œå¨èƒè¾ƒå¤§èŒƒå›´ï¼Œéœ€ä¸“ä¸šè¶…å‡¡åŠ›é‡ï¼‰\"\n    `;\n} else if (world_level === 'é«˜') {\n    world_max_enegy = 12;\n    world_level_describe = 'å¼ºå¤§è¶…å‡¡åŠ›é‡ï¼ŒåŒºåŸŸæ€§ç°å®æ‰­æ›²';\n    levels = `\n        \"1\": \"æ— é£é™©/æ—¥å¸¸æƒ…å†µ\",\n        \"2\": \"è½»å¾®å‡¡äººå±æœºï¼ˆå°åŠ¨ç‰©æ”»å‡»ã€ç¤¾äº¤å›°å¢ƒï¼‰\",\n        \"3\": \"ä¸¥é‡å‡¡äººå±æœºï¼ˆé‡ä¼¤/æ­»äº¡ã€ä¸¥é‡ç¯å¢ƒå±é™©ï¼‰\",\n        \"4-5\": \"åŸºç¡€è¶…å‡¡å±æœºï¼ˆè¢«åŠ¨è¶…å‡¡ç°è±¡ï¼Œå±€é™äºä¸ªä½“/å°èŒƒå›´ï¼Œæ™®é€šäººå¯åº”å¯¹ï¼‰\",\n        \"6-7\": \"è¿›é˜¶è¶…å‡¡å±æœºï¼ˆä¸»åŠ¨è¶…å‡¡æ”»å‡»ï¼Œå¨èƒè¾ƒå¤§èŒƒå›´ï¼Œéœ€ä¸“ä¸šè¶…å‡¡åŠ›é‡ï¼‰\",\n        \"8-12\": \"ç¥æ˜è§„åˆ™çº§å±æœºï¼ˆç¥æ˜å¹²é¢„ã€ä¸–ç•Œè§„åˆ™æ‰­æ›²ï¼‰\"\n    `;\n} else if (world_level === 'ç¥è¯') {\n    world_max_enegy = 16;\n    world_level_describe = 'ç¥æ˜æˆ–å®‡å®™çº§åŠ›é‡ï¼Œè§„åˆ™å½»åº•æ‰­æ›²';\n    levels = `\n        \"1\": \"æ— é£é™©/æ—¥å¸¸æƒ…å†µ\",\n        \"2\": \"è½»å¾®å‡¡äººå±æœºï¼ˆå°åŠ¨ç‰©æ”»å‡»ã€ç¤¾äº¤å›°å¢ƒï¼‰\",\n        \"3\": \"ä¸¥é‡å‡¡äººå±æœºï¼ˆé‡ä¼¤/æ­»äº¡ã€ä¸¥é‡ç¯å¢ƒå±é™©ï¼‰\",\n        \"4-5\": \"åŸºç¡€è¶…å‡¡å±æœºï¼ˆè¢«åŠ¨è¶…å‡¡ç°è±¡ï¼Œå±€é™äºä¸ªä½“/å°èŒƒå›´ï¼Œæ™®é€šäººå¯åº”å¯¹ï¼‰\",\n        \"6-7\": \"è¿›é˜¶è¶…å‡¡å±æœºï¼ˆä¸»åŠ¨è¶…å‡¡æ”»å‡»ï¼Œå¨èƒè¾ƒå¤§èŒƒå›´ï¼Œéœ€ä¸“ä¸šè¶…å‡¡åŠ›é‡ï¼‰\",\n        \"8-12\": \"ç¥æ˜è§„åˆ™çº§å±æœºï¼ˆç¥æ˜å¹²é¢„ã€ä¸–ç•Œè§„åˆ™æ‰­æ›²ï¼‰\",\n        \"13-16\": \"æœ¬æºå®‡å®™çº§å±æœºï¼ˆå®‡å®™è§„åˆ™å´©åã€å­˜åœ¨å¨èƒï¼‰\"\n    `;\n} else {\n    world_max_enegy = 7;\n    world_level_describe = 'å­˜åœ¨ä¸€å®šè¶…å‡¡åŠ›é‡ï¼Œå½±å“æœ‰é™èŒƒå›´';\n    levels = `\n        \"1\": \"æ— é£é™©/æ—¥å¸¸æƒ…å†µ\",\n        \"2\": \"è½»å¾®å‡¡äººå±æœºï¼ˆå°åŠ¨ç‰©æ”»å‡»ã€ç¤¾äº¤å›°å¢ƒï¼‰\",\n        \"3\": \"ä¸¥é‡å‡¡äººå±æœºï¼ˆé‡ä¼¤/æ­»äº¡ã€ä¸¥é‡ç¯å¢ƒå±é™©ï¼‰\",\n        \"4-5\": \"åŸºç¡€è¶…å‡¡å±æœºï¼ˆè¢«åŠ¨è¶…å‡¡ç°è±¡ï¼Œå±€é™äºä¸ªä½“/å°èŒƒå›´ï¼Œæ™®é€šäººå¯åº”å¯¹ï¼‰\",\n        \"6-7\": \"è¿›é˜¶è¶…å‡¡å±æœºï¼ˆä¸»åŠ¨è¶…å‡¡æ”»å‡»ï¼Œå¨èƒè¾ƒå¤§èŒƒå›´ï¼Œéœ€ä¸“ä¸šè¶…å‡¡åŠ›é‡ï¼‰\"\n    `;\n}\n\n \nvar currency_point = _.get(characterData, 'è´§å¸æ®µ.ç§¯åˆ†[0]', 0);\nvar currency_zhixian = JSON.stringify(_.get(characterData, 'è´§å¸æ®µ.æ”¯çº¿å‰§æƒ…', ''));\nvar currency_xp = _.get(characterData, 'è´§å¸æ®µ.ç»éªŒå€¼[0]', 0);\nvar energy_pool = JSON.stringify(_.get(characterData, 'è¡ç”Ÿå±æ€§æ®µ.èƒ½é‡æ± ', ''));\n \nvar defense_impact = _.get(characterData, 'è¡ç”Ÿå±æ€§æ®µ.é˜²å¾¡.ä¼¤å®³å‡å….å†²å‡»[0]', 0);\nvar defense_lethal = _.get(characterData, 'è¡ç”Ÿå±æ€§æ®µ.é˜²å¾¡.ä¼¤å®³å‡å….è‡´å‘½[0]', 0);\nvar defense_aggravated = _.get(characterData, 'è¡ç”Ÿå±æ€§æ®µ.é˜²å¾¡.ä¼¤å®³å‡å….æ¶æ€§[0]', 0);\nvar save_fortitude = _.get(characterData, 'è¡ç”Ÿå±æ€§æ®µ.è±å…æ£€å®šåŸºç¡€.å¼ºéŸ§[0]', 0);\nvar save_reflex = _.get(characterData, 'è¡ç”Ÿå±æ€§æ®µ.è±å…æ£€å®šåŸºç¡€.åå°„[0]', 0);\nvar save_will = _.get(characterData, 'è¡ç”Ÿå±æ€§æ®µ.è±å…æ£€å®šåŸºç¡€.æ„å¿—[0]', 0);\nvar speed = _.get(characterData, 'è¡ç”Ÿå±æ€§æ®µ.é€Ÿåº¦.åŸºç¡€é€Ÿåº¦[0]', 0);\nvar initiative = _.get(characterData, 'è¡ç”Ÿå±æ€§æ®µ.å…ˆæ”»[0]', 0);\nvar world_role = getLocalVar(\"world_role\", \"\");\nvar player_role = getLocalVar(\"player_role\", \"è½®å›è€…\");\nvar tier_role = getLocalVar(\"tier_role\", \"\");\nvar profession_role = getLocalVar(\"profession_role\", \"\");\nvar point_role = getLocalVar(\"point_role\", \"\");\nvar zhixian_role = getLocalVar(\"zhixian_role\", \"\");\nvar xp_role = getLocalVar(\"xp_role\", \"\");\nvar the_created = _.get(EvStat, 'the_created.name[0]', \"\");\nvar if_bg= getLocalVar(\"bg_source\", \"false\");\nvar if_comlex_battle = getLocalVar(\"complex_battle\",\"false\");\nvar if_dice_use = getLocalVar(\"dice_use\",\"false\");\nvar if_attribute_use = getLocalVar(\"attribute_use\",\"true\");\n // ä½¿ç”¨ var æˆ–ç›´æ¥èµ‹å€¼åˆ°å…¨å±€å¯¹è±¡\n    var loadTextConfig = async function(filename = 'config.txt') {\n        const baseUrl = 'https://longlivecanc.github.io/god_space';\n        const fullUrl = `${baseUrl}/${filename}?v=${new Date().getTime()}`;\n        \n        try {\n            console.log(`æ­£åœ¨åŠ è½½æ–‡æœ¬æ–‡ä»¶: ${fullUrl}`);\n            const response = await fetch(fullUrl);\n            \n            if (!response.ok) {\n                throw new Error(`HTTPé”™è¯¯: ${response.status} ${response.statusText}`);\n            }\n            \n            const textContent = await response.text();\n            console.log('æ–‡æœ¬æ–‡ä»¶åŠ è½½æˆåŠŸ');\n            console.log(`æ–‡ä»¶å¤§å°: ${textContent.length} å­—ç¬¦`);\n            \n            return textContent;\n            \n        } catch (error) {\n            console.error('åŠ è½½æ–‡æœ¬æ–‡ä»¶å¤±è´¥:', error.message);\n            \n            const fallbackConfig = `PrimarySceneType:[æ‹±é—¨å»ºç­‘å®¤å†…,ç°ä»£å»ºç­‘ç¾¤,åºŸåœŸ,ç°ä»£åŸå¸‚è¡—é“,å¤ä»£è¥¿æ–¹åŸé•‡,å¤ä»£ä¸­å›½åŸå¸‚,è¥¿æ–¹å¸‚åœº,æ ¡å›­,æ£®æ—,æµ·æ´‹,æ²³æµ,è‰åŸ,é›ªåŸ,æ°´ä¸‹,ç®€çº¦æˆ¿é—´,è±ªåæˆ¿é—´,ä¸­å¼å®¢æ ˆ,ç°ä»£å¤§å ‚,èµ°å»Š,å®éªŒå®¤,æ´ç©´,ç›‘ç‹±,æ˜Ÿèˆ°å†…éƒ¨,æµ®ç©ºå²›,è¾å°„åºŸåœŸ,èµ›åšæœ‹å…‹,å¤–å¤ªç©º,ç«å±±åœ°å¸¦,æ²™æ¼ ç»¿æ´²,ç«¹æ—,ç€‘å¸ƒ,å³¡è°·,å¤ä»£é—è¿¹,è’¸æ±½æœ‹å…‹å·¥å‚,é­”æ³•å›¾ä¹¦é¦†,æ°´æ™¶æ´ç©´,æ¨±èŠ±æ—,å¤ä»£ç«æŠ€åœº,å†°å·,æ²¼æ³½,å¤©ç©ºä¹‹åŸ,åœ°ä¸‹åŸ,ç¦…æ„åº­é™¢,ç§‘å¹»å®éªŒå®¤,åºŸå¼ƒæ¸¸ä¹å›­,çƒ­å¸¦é›¨æ—,æœˆçƒè¡¨é¢],\nTimeAndLight: [BrightDay,OvercastDay,GoldenHour,DeepNight],\nAtmosphereAndCondition: [Peaceful,Decay,Dynamic]`;\n            \n            console.log('ä½¿ç”¨å¤‡ç”¨é…ç½®');\n            return fallbackConfig;\n        }\n    };\n\nconst configText = await loadTextConfig('config.txt');\n\n_%>\n memory.set('memory_update_system', {\ndesc: \"æ­£æ–‡è¾“å‡ºç»“æŸåï¼Œä½ å¿…é¡»è¾“å‡ºä»¥ä¸‹æ ‡ç­¾å¹¶æŒ‰ç…§è§„åˆ™æ£€æŸ¥éœ€è¦å¯¹åº”æ›´æ–°çš„è®°å¿†ã€‚ä½ éœ€è¦ä¸¥æ ¼æŒ‰ç…§analyzeçš„åˆ†æï¼Œæ¥åœ¨<updateMemory>è¿›è¡Œå¯¹åº”è®°å¿†çš„æ›´æ–°\",\nstatus_analyze: {\ntag: '<statusAnalyze>',\nscope:'memory.status',\ncommand:'set_status',\ndesc: 'Analyze current state to prepare for status`s updates. Output format: ${check_name}: ${result} // e.g.,hurt_value: æœ¬è½®æ— ä¼¤å®³äº‹ä»¶/æ— æ²»æ„ˆäº‹ä»¶ï¼Œä¸º0',\nchecks: {\ntime: \"Advance time logically.\",\n//æ—¥æœŸåªåœ¨è·¨è¿‡0ç‚¹çš„æ—¶å€™æ¨è¿›ï¼Œä¾‹å¦‚ä»å‡Œæ™¨3ç‚¹åˆ°æ—©ä¸Š7ç‚¹ä¸éœ€è¦æ”¹å˜æ—¥æœŸã€‚\n<%_ if (version != 7) { _%>\nprogress:'å®æ—¶æ£€æŸ¥ä»»åŠ¡è¿›åº¦(world_shard.task.progress)'\n<%_}%>\n<%_\nif (if_bg=== \"true\") {\n_%>\nscene_img: {\nrule: 'update åœºæ™¯å›¾based on the current environment.format must be: PrimarySceneType-TimeAndLight-AtmosphereAndCondition.e.g. åºŸåœŸ-BrightDay-Peaceful',\n//å¦‚æœæ²¡æœ‰åˆé€‚çš„å¯¹åº”åˆ†ç±»å°±åœ¨allowed_tagsä¸­é€‰æ‹©ä¸€ä¸ªæœ€ç›¸è¿‘çš„ï¼Œåªèƒ½é€‰ç”¨allowed_tagsä¸­çš„tagï¼Œç¦æ­¢è¶…å‡ºallowed_tagsçš„èŒƒå›´ã€‚\nallowed_tags: {\n<%= configText %>\n}\n},\n<%_\n}\n_%>\nhurt_value: \"on(hurt_event|heal_event) ? (is_new_event ? set_value(hurt_event ? +value : -value) : log('known event, auto-reset')) : skip.\",\nuser_character:{\nstatus:{[buffs, debuffs],\nstatus_format: \"has_temp_modifiers ? '[çŠ¶æ€å]:ã€attr/skillÂ±value;attr/skillÂ±valueã€‘æè¿°' : '[çŠ¶æ€å]:æè¿°'\",//e.g. [å¯’å†·]:ã€è€åŠ›-1;æ•æ·-1ã€‘ç®€çŸ­10å­—å†…æè¿°\n//å› statuså¯¼è‡´çš„modifiers**ç¦æ­¢**åº”ç”¨åˆ°attribute\nstatus_separator: \"multiple_status ? 'status1;status2;status3' : single_status\",\n}\nå½“å‰è£…å¤‡,\ncurrent_location<%_ if (if_dice_use === 'true') { _%>and prefix:{\n current_location_prefix_rule: å½“ä¸”åªå½“['å¤„äº<%= getLocalVar(\"world_role\",\"\") %>èŒƒå›´å†…','æ­£åœ¨è¿›è¡Œæ—¥å¸¸æ´»åŠ¨(å¦‚è´´è´´/åšçˆ±/åƒé¥­ç¡è§‰)']çš„çŠ¶å†µæ—¶ï¼Œè§†ä¸ºæ— éœ€æ¥å—æ£€å®šï¼Œcurrent_locationå¿…é¡»ä»¥`[æ—¥å¸¸]`ä½œä¸ºå‰ç¼€ã€‚è„±ç¦»ä»¥ä¸Šæƒ…å†µæ—¶ï¼Œ**å¿…é¡»**å»æ‰è¯¥å‰ç¼€ï¼<%_}%>,\n}\n},\nspecial_events: \"Check triggers: world_entry/exit, ç¾å¾·/æ¶å¾·.\",<%_ if (if_dice_use === 'true') { _%>difficulty: \"Set 'æ£€å®šéš¾åº¦' based on direct threat level (1-<%= world_max_enegy %>). Rules:æ—¥å¸¸=1,æ— æ¶æ„<3. Levels: <%= levels %>.\",\nnext_roll: {\næ£€å®šå±æ€§: \"Predict and apply 3x [attribute] or [attribute][skill] for next action on æ£€å®šå±æ€§.\",\n<%_if (if_comlex_battle=== \"false\") {_%>combat_mode: \"on(combat) ? set('æ•Œæ–¹æ”»å‡»éª°æ± ') | else: output set_status('æ•Œæ–¹æ”»å‡»éª°æ± ','')//æ¸…ç©º.\",\n//åªåœ¨æœ‰æ˜ç¡®æˆ˜æ–—åœºæ™¯ã€æ•Œæ–¹æœ‰æ˜ç¡®çš„æ”»å‡»åŠ¨ä½œæ‰è®¾ç½®combatï¼Œç¦æ­¢å› ä¸ºæ½œåœ¨å±é™©/è¿˜æ²¡æœ‰å‘ç”Ÿçš„æˆ˜æ–—è€Œè®¾ç½®ã€‚åªè¦å·²ç»è„±ç¦»æˆ˜æ–—ï¼Œåˆ™ç«‹åˆ»æ¸…ç©ºæ•Œæ–¹æ”»å‡»éª°æ± \nidle_mode_rule: \"on(<%= world_role %>) ->æ£€å®šå€¼=æ— .\",\nnpc_assist: \"Syntax: 'npc_name:æ£€å®šå±æ€§'.\"<%_}else{_%>battle_check: on(combat) ?set('battle'): skip<%_}_%>\n}<%_}%>\n}\n},\nlore_analyze: {\ntag: '<loreAnalyze>',\nscope:'memory.global_lore <%_ if (version != 7) { _%>,memory.world_lore<%_ } _%>',\ncommand:'memory,delete',\ndesc: 'Analyze lore changes needed. Output format: \"${check_name}: ${result}\".',\nchecks: {\ncontent_integrity: \"Scan for ['npc','settings','å…¶ä»–æŠ€èƒ½','èƒŒåŒ…','å¤‡å¿˜å½•'{{getvar::ziyuantiao}}{{getvar::chenghao}}{{getvar::assa_plot_notice}}]in lore æ˜¯å¦æœ‰éœ€è¦æ–°å¢/æ›´æ–°/åˆ é™¤çš„å†…å®¹.\",\n}\n},\n<%_if (if_attribute_use === \"true\") {_%>\nattribute_analyze: {\ntag: '<attributeAnalyze>',\nscope:'memory.attribute',\ncommand:'set_attribute',\nchecks: {\nattribute_changes: \"on(attribute_change_event) ? (is_new_event(this output) ? set_value : log('I known in history event,I'll skip')) : skip.\",\n//åœ¨æ­£æ–‡ä¸­æœ‰å±æ€§å˜åŒ–ï¼ˆå¦‚è¢«åŠ¨æŠ€èƒ½çš„ä¸€æ¬¡æ€§åŠ æˆã€è´§å¸çš„å¢å‡ã€ç»éªŒçš„å¢åŠ ï¼‰æ—¶ï¼Œéœ€è¦åœ¨æ­£æ–‡ä½¿ç”¨æ˜ç¡®çš„æç¤ºæ ‡æ³¨å·²ç»åº”ç”¨äº†å±æ€§å˜åŒ–åŠä»å“ªé‡Œæ¥çš„å±æ€§å˜åŒ–ã€‚ä¾‹ï¼šã€é£Ÿç”¨äº†æ•æ·æœå®ï¼Œæ•æ·0â†’1ã€‘æˆ–è€…ã€ç§¯åˆ†2000â†’0ã€‘è¿™ç§æ˜ç¡®çš„ä¿¡æ¯ã€‚\n//éœ€è¦å°†attributeä¸­è´§å¸æ®µä¸­çš„è´§å¸å’ŒèƒŒåŒ…ä¸­çš„å…¶ä»–è´§å¸çš„åŒºåˆ†ï¼\n}\n}\n<%_}%>\nupdate_memory: {\ntag: \"<updateMemory>\",\ndesc: \"Execute memory operations based on analysis. All rules are absolute.**å¿…é¡»**åœ¨æ­¤å¤„åº”ç”¨å‰é¢analyzeçš„å˜åŠ¨ï¼Œå†…å®¹å¿…é¡»100%ç»Ÿä¸€ï¼ç¦æ­¢å‡ºç°åˆ†æäº†æŸæ”¹åŠ¨(å¦‚æ—¶é—´ã€è£…å¤‡ã€è´§å¸å˜åŒ–)ï¼Œä½†æ²¡æœ‰åœ¨<updateMemory>ä¸­åº”ç”¨çš„æƒ…å†µï¼\",\ncommands: {\nspecial:{\nupdate_status: \"set_status('path', 'new_value // string/num/compact json object'); //reason\",\n<%_if (if_attribute_use === \"true\") {_%>update_attribute: \"set_attribute('path', 'old_num/_ //å¦‚æœæ—§å€¼æ˜¯stringç±»å‹ï¼Œåˆ™åªç»™ä¸€ä¸ª_å ä½ç¬¦', 'new // only string/num'); //reasonï¼Œåªè´Ÿè´£attribute\"<%_}%>\n},\nnormal:{\nadd_update: \"memory('path', 'key', 'new_value // string/num/compact json object'); //reason\",\nrename: \"memory('path.old_key', 'path.new_key'); //rename\",\nmove: \"memory('old_path.key', 'new_path.key'); //move\",\ndelete: \"delete('path', 'key'); //reason\",\n}\n},\nrules: {\nsingle_operation: \"One command per line, one key per command.\",\n <%_ if (version != 7) { _%>\non_world_exit: \"Must use: delete('world_lore.npc','all'); and delete('world_lore.settings','all');\",\n<%_ } _%>\ndelete_when: [\n\"item.num == 0\",\n\"ç‰©å“è½¬äº¤å®Œæˆ\",\n\"ç‰©å“å®Œå…¨æ¶ˆè€—\"\n],\nmultiple_effects: \"å¤šä¸ªåŠ æˆç”¨åŠè§’;åˆ†å‰²\",\n},\nexamples: [\nset_status('æ—¥æœŸ', '01æœˆ01æ—¥'); //Init time,\nset_status('æ—¶é—´','18:00'); //Time passed,\nset_status('user_character.current_location','xxx'); \nmemory('global_lore.å…¶ä»–æŠ€èƒ½', 'ç«çƒæœ¯', '{\"info\":\"å‘å°„æ™®é€šçš„ç«çƒã€‚\",\"effect\":\"ã€dp+1;èƒ½é‡æ± -100ã€‘\",\"level\":\"åˆçº§\"}'); //add skills,\nmemory('global_lore.å…¶ä»–æŠ€èƒ½.ç«çƒæœ¯', 'effect', 'ã€dp+1;èƒ½é‡æ± -100ã€‘'); //update skill effect,\nmemory('global_lore.èƒŒåŒ…', 'æ¬§å…ƒ', '400'); //æ¶ˆè€—å…¶ä»–è´§å¸\nmemory('global_lore.npc.é˜´æ²‰ç”·äºº', 'global_lore.npc.å¼ ä¸‰'); //rename NPCï¼Œå¿…é¡»éƒ½è¦å¸¦ä¸Šå®Œæ•´è·¯å¾„\n delete('global_lore.npc', 'å¼ ä¸‰');// delete NPC,\n<%_if (if_attribute_use === \"true\") {_%>set_attribute('è´§å¸æ®µ.<%= zhixian_role %>.D', 0, 1); //Gain currency,\nset_attribute('èƒ½åŠ›æ®µ.ç±»å‹','_','è¡€ç»Ÿ'); \nset_attribute('è¡ç”Ÿå±æ€§æ®µ.èƒ½é‡æ± .å½“å‰å€¼','0','50');\nset_attribute('å±æ€§æ®µ.ç”Ÿç†å±æ€§.åŠ›é‡.åŸºç¡€', 0, 1); //Increase attribute<%_}%>\n]\n}\n});",
                    "constant": true,
                    "selective": true,
                    "insertion_order": 79,
                    "enabled": true,
                    "position": "after_char",
                    "use_regex": true,
                    "extensions": {
                        "position": 4,
                        "exclude_recursion": false,
                        "display_index": 10,
                        "probability": 100,
                        "useProbability": true,
                        "depth": 0,
                        "selectiveLogic": 0,
                        "group": "",
                        "group_override": false,
                        "group_weight": 100,
                        "prevent_recursion": false,
                        "delay_until_recursion": false,
                        "scan_depth": null,
                        "match_whole_words": null,
                        "use_group_scoring": false,
                        "case_sensitive": null,
                        "automation_id": "",
                        "role": 0,
                        "vectorized": false,
                        "sticky": 0,
                        "cooldown": 0,
                        "delay": 0,
                        "match_persona_description": false,
                        "match_character_description": false,
                        "match_character_personality": false,
                        "match_character_depth_prompt": false,
                        "match_scenario": false,
                        "match_creator_notes": false,
                        "triggers": []
                    }
                },
                {
                    "id": 14,
                    "keys": [],
                    "secondary_keys": [],
                    "comment": "ğŸ”°æ˜¯éªŒè¯ï¼Œåˆ«å…³",
                    "content": "<%_\nconst ready= 'true';\n_%>\n<ready>\ngame.init();\n",
                    "constant": true,
                    "selective": true,
                    "insertion_order": 50,
                    "enabled": true,
                    "position": "before_char",
                    "use_regex": true,
                    "extensions": {
                        "position": 0,
                        "exclude_recursion": false,
                        "display_index": 11,
                        "probability": 100,
                        "useProbability": true,
                        "depth": 4,
                        "selectiveLogic": 0,
                        "group": "",
                        "group_override": false,
                        "group_weight": 100,
                        "prevent_recursion": false,
                        "delay_until_recursion": false,
                        "scan_depth": null,
                        "match_whole_words": null,
                        "use_group_scoring": false,
                        "case_sensitive": null,
                        "automation_id": "",
                        "role": 0,
                        "vectorized": false,
                        "sticky": 0,
                        "cooldown": 0,
                        "delay": 0,
                        "match_persona_description": false,
                        "match_character_description": false,
                        "match_character_personality": false,
                        "match_character_depth_prompt": false,
                        "match_scenario": false,
                        "match_creator_notes": false,
                        "triggers": []
                    }
                },
                {
                    "id": 15,
                    "keys": [],
                    "secondary_keys": [],
                    "comment": "ğŸ’«å¯é€‰:åœ°å›¾ç®€å•1",
                    "content": "{{setvar::map_rule::<mapAnalyze>}}\n{{setvar::is_new_map::false}}\n<%_\n// å°è£…çš„æ•°æ®è·å–å‡½æ•° - é¿å…é‡å¤å®šä¹‰\n \n    function getDataWithFallback(varName) {\n \n        let data = getLocalVar(varName);\n       \n        // å†…è”æ•°æ®éªŒè¯ï¼šæ£€æŸ¥æ˜¯å¦ä¸ºnullã€undefinedï¼Œä¸”å¦‚æœæ˜¯å¯¹è±¡è¦æœ‰å†…å®¹\n        const isValid = (data) => {\n            // æ£€æŸ¥æ˜¯å¦ä¸º null æˆ– undefined\n            if (data === null || data === undefined) {\n                return false;\n            }\n            \n            // å¦‚æœæ˜¯å¯¹è±¡ç±»å‹ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰å†…å®¹\n            if (typeof data === 'object' && data !== null) {\n                // å¦‚æœæ˜¯æ•°ç»„ï¼Œæ£€æŸ¥é•¿åº¦\n                if (Array.isArray(data)) {\n                    return data.length > 0;\n                }\n                // å¦‚æœæ˜¯æ™®é€šå¯¹è±¡ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰å±æ€§\n                return Object.keys(data).length > 0;\n            }\n            \n            // å…¶ä»–ç±»å‹ï¼ˆå­—ç¬¦ä¸²ã€æ•°å­—ã€å¸ƒå°”å€¼ç­‰ï¼‰åªè¦ä¸æ˜¯ null/undefined å°±è®¤ä¸ºæœ‰æ•ˆ\n            return true;\n        };\n        \n        // å¦‚æœæ•°æ®ä¸ç¬¦åˆè¦æ±‚ï¼Œä» getLocalVar è·å–\n        if (!isValid(data)) {\n            data = getLocalVar(varName);\n        }\n        \n        return data;\n    }\n \nif (typeof assaData === 'undefined') {\n    var  assaData = getDataWithFallback(\"assa_data\");\n}\n \n // è·å–åŸå§‹å…¨å±€åœ°å›¾æ•°æ®\nvar originalGlobalMapData = _.get(assaData, 'map.å…¨å±€åœ°ç‚¹è¡¨', '');\nconsole.log('åŸå§‹å…¨å±€åœ°å›¾æ•°æ®:', originalGlobalMapData);\n\n// å¦‚æœæ•°æ®å­˜åœ¨ä¸”ä¸ä¸ºç©º\nif (originalGlobalMapData && typeof originalGlobalMapData === 'object') {\n    // åˆ›å»ºæ·±æ‹·è´ä»¥é¿å…ä¿®æ”¹åŸå§‹æ•°æ®\n    var processedGlobalMapData = JSON.parse(JSON.stringify(originalGlobalMapData));\n    \n    // è·å–æ‰€æœ‰åœ°ç‚¹åç§°\n    var globalLocationNames = Object.keys(processedGlobalMapData);\n    console.log('å…¨å±€åœ°ç‚¹è¡¨æ‰€æœ‰åœ°ç‚¹åç§°:', globalLocationNames);\n    \n    // åˆ›å»ºè¿‡æ»¤åçš„æ•°æ®å¯¹è±¡ï¼Œåªä¿ç•™å‰ä¸¤ä¸ªåœ°ç‚¹\n    var filteredGlobalMapData = {};\n    \n    // åªä¿ç•™ç´¢å¼•0å’Œ1çš„åœ°ç‚¹\n    if (globalLocationNames.length > 0) {\n        filteredGlobalMapData[globalLocationNames[0]] = processedGlobalMapData[globalLocationNames[0]];\n        console.log('ä¿ç•™å…¨å±€åœ°ç‚¹[0]:', globalLocationNames[0], '=', processedGlobalMapData[globalLocationNames[0]]);\n    }\n    if (globalLocationNames.length > 1) {\n        filteredGlobalMapData[globalLocationNames[1]] = processedGlobalMapData[globalLocationNames[1]];\n        console.log('ä¿ç•™å…¨å±€åœ°ç‚¹[1]:', globalLocationNames[1], '=', processedGlobalMapData[globalLocationNames[1]]);\n    }\n    \nvar filteredGlobalMapArray = Object.values(filteredGlobalMapData);\n    // è½¬æ¢ä¸ºJSONå­—ç¬¦ä¸²\n    var global_map = JSON.stringify(filteredGlobalMapArray);\n    console.log('è¿‡æ»¤åçš„å…¨å±€åœ°å›¾:', global_map);\n} else {\n    // å¦‚æœåŸå§‹æ•°æ®ä¸ºç©ºæˆ–ä¸å­˜åœ¨ï¼Œè¿”å›ç©ºå­—ç¬¦ä¸²\n    var global_map = '';\n    console.log('å…¨å±€åœ°å›¾æ•°æ®ä¸ºç©º');\n}\nvar main_map= JSON.stringify(_.get(assaData, 'map.ä¸»è¦åœ°ç‚¹è¡¨', ''));\n_%>\ngame.map_memory.init();\nmap_memory.load('map.å…¨å±€åœ°ç‚¹è¡¨', {\n<%= global_map %>,\n  rule: 'è®°å½•{{user}}å½“å‰æ‰€å¤„åœ°å›¾çš„æ ‡é¢˜å’Œå¤–éƒ¨åŒºåŸŸ',\n  on_update: {\n    trigger: 'environment_change({{user}})',\n    action: \"memory('map', 'å…¨å±€åœ°ç‚¹è¡¨', [\"åœ°ç‚¹åç§°\", \"å¤–éƒ¨åŒºåŸŸ1;å¤–éƒ¨åŒºåŸŸ2\"])\"//å›ºå®šæŒ‰ç…§æ­¤æ ¼å¼æ›´æ–°ï¼Œå¤–éƒ¨åŒºåŸŸè‡³å°‘ä¸‰ä¸ª\n  }\n})\n.load('map.ä¸»è¦åœ°ç‚¹è¡¨', {\n <%= main_map %>,\n  rule: 'è´Ÿè´£ç”Ÿæˆ/æ›´æ–°å½“å‰åœ°å›¾æ ‡é¢˜ä¸‹çš„3-8ä¸ªå­åœ°ç‚¹ï¼Œå½“è§¦å‘æ›´æ–°æ—¶ï¼Œè¾“å‡ºmemory()çš„å®Œæ•´æŒ‡ä»¤åºåˆ—ã€‚',\n    constraints: {\n      count: 'åœ°ç‚¹æ•°é‡ä¸º3-8ä¸ª',\n      non_empty: 'æ‰€æœ‰å•å…ƒæ ¼ç¦æ­¢ç•™ç©º',\n      layout: {\n        rule: 'ç¦æ­¢å›¾å—é‡å ï¼Œè§†ä¸º(Xåæ ‡, Yåæ ‡)ä¸ºå·¦ä¸Šè§’çš„çŸ©å½¢åŒºåŸŸè®¡ç®—',\n        distribution: 'å‡åŒ€åˆ†å¸ƒï¼Œé¿å…ç©ºæ—·æˆ–ç´§è´´'\n      }\n    update_rule: {\n      condition: 'global_mapçš„åœ°å›¾æ ‡é¢˜æ”¹å˜',\naction: [\ndelete('map.ä¸»è¦åœ°ç‚¹è¡¨','all'); //æ¸…ç©ºæ—§åœ°å›¾,\nmemory('map.ä¸»è¦åœ°ç‚¹è¡¨', '${colIndex}', [\"${åœ°ç‚¹åç§°}\", \"${Xåæ ‡}\", \"${Yåæ ‡}\", \"${å®½åº¦}\", \"${é«˜åº¦}\", \"${ç¯å¢ƒæè¿°}\"]);//æ–°å¢æˆ–ä¿®æ”¹\n]\n    }\n  }\n})",
                    "constant": true,
                    "selective": true,
                    "insertion_order": 105,
                    "enabled": false,
                    "position": "before_char",
                    "use_regex": true,
                    "extensions": {
                        "position": 0,
                        "exclude_recursion": false,
                        "display_index": 12,
                        "probability": 100,
                        "useProbability": true,
                        "depth": 4,
                        "selectiveLogic": 0,
                        "group": "åœ°å›¾1",
                        "group_override": false,
                        "group_weight": 100,
                        "prevent_recursion": false,
                        "delay_until_recursion": false,
                        "scan_depth": null,
                        "match_whole_words": null,
                        "use_group_scoring": false,
                        "case_sensitive": null,
                        "automation_id": "",
                        "role": 0,
                        "vectorized": false,
                        "sticky": 0,
                        "cooldown": 0,
                        "delay": 0,
                        "match_persona_description": false,
                        "match_character_description": false,
                        "match_character_personality": false,
                        "match_character_depth_prompt": false,
                        "match_scenario": false,
                        "match_creator_notes": false,
                        "triggers": []
                    }
                },
                {
                    "id": 16,
                    "keys": [],
                    "secondary_keys": [],
                    "comment": "mod:å›°éš¾æ¨¡å¼",
                    "content": "hard_system.set('engine', {\n  // æ ¸å¿ƒç†å¿µ\n  core: \"escalating_spiral_challenge; dynamic_equilibrium\",\n  // æŒ‘æˆ˜è®¾è®¡åŸåˆ™\n  challenge_design: {\n    dimensions: ['intellect', 'physique', 'psych', 'resource', 'time'], // æŒ‘æˆ˜å¿…é¡»æ¶µç›–çš„äº”ä¸ªç»´åº¦\n    logic_flow: [\n      \"on(<user>.advantage) -> trigger(env.degrade | rival.buff)\",\n      \"on(<user>.adaptation) -> trigger(rules.mutate)\",\n      \"on(<user>.desperate_counter) -> offer(hope, high_cost)\"\n    ]\n  },\n  // å‹åŠ›ç»´æŒç³»ç»Ÿ\n  pressure_engine: {\n    victory_consequence: \"win -> immediate(resource_loss | injury) | delayed(next_world_penalty) | psych(moral_doubt)\",\n    adaptation_counter: \"on(<user>.mastery) -> switch(challenge_type)\", // e.g., combat -> puzzle\n    hope_protocol: \"on(despair_peak) -> offer(glimmer_of_hope); cost_of_hope: always_unexpected; false_dawn: potential_trap\"\n  },\n  // å™äº‹æµæ¨¡æ¿\n  session_flow_template: {\n    opening: \"immediate_crisis + info_deficit + resource_scarcity\",\n    midgame: \"reveal(hidden_layers) + emerge(rival) + moral_complication\",\n    climax: \"choice(values_vs_survival) + demand(sacrifice) + victory(pyrrhic, seeds_next_threat)\"\n  },\n  // å…¨å±€ç¡¬æ€§æŒ‡å¯¼æ–¹é’ˆ\n  global_directives: {\n    never: ['luck_decides', 'stat_crush', 'deus_ex_machina', 'total_advantage', 'repeatable_solution'],\n    always: ['logical_solution(high_cost)', 'rival_emergence(event_driven)', 'pressure_scales_with_growth', 'win_leads_to_disadvantage', 'choices_have_consequences']\n  }\n})\n.set('rival_system', {\n  // æ•Œæ–¹å­˜åœ¨åŸåˆ™\n  existence_principle: \"conceptual_opposition(<user>.values); event_triggered_emergence; strict_info_blackout\",\n  // åŠ¨æ€ç”Ÿæˆä¸ç¼©æ”¾\n  generation_engine: {\n    mode: \"fully_randomized\", // name, style, composition, philosophy\n    triggers: ['resource_gain', 'npc_state_change', 'moral_choice_fallout', 'puzzle_milestone', 'team_conflict' /* ...etc */],\n    scaling_logic: \"avg_power = <user>.weakest_link * 1.1; skills = counter(<user>.core_tactics); gear = superior_config | special_effects\"\n  },\n  // è¡Œä¸ºAIæ ¸å¿ƒ\n  behavioral_core: \"preemptive_action; superior_intel; resource_control; exploit(<user>.current_weakness)\",\n  // ä¿¡æ¯ä¿å¯†åè®®\n  secrecy_protocol: {\n    forbidden: ['reveal_existence_early', 'hint_at_rival', 'describe_preparation', 'show_rival_pov', 'answer_questions_about_rival'],\n    revelation: \"method: natural (via clues, consequences); acquisition: <user>_must_investigate; proof: direct_conflict_only\",\n    misdirection: \"allow(false_clues, red_herrings)\"\n  }\n});",
                    "constant": true,
                    "selective": true,
                    "insertion_order": 106,
                    "enabled": true,
                    "position": "before_char",
                    "use_regex": true,
                    "extensions": {
                        "position": 0,
                        "exclude_recursion": false,
                        "display_index": 13,
                        "probability": 100,
                        "useProbability": true,
                        "depth": 4,
                        "selectiveLogic": 0,
                        "group": "",
                        "group_override": false,
                        "group_weight": 100,
                        "prevent_recursion": false,
                        "delay_until_recursion": false,
                        "scan_depth": null,
                        "match_whole_words": null,
                        "use_group_scoring": false,
                        "case_sensitive": null,
                        "automation_id": "",
                        "role": 0,
                        "vectorized": false,
                        "sticky": 0,
                        "cooldown": 0,
                        "delay": 0,
                        "match_persona_description": false,
                        "match_character_description": false,
                        "match_character_personality": false,
                        "match_character_depth_prompt": false,
                        "match_scenario": false,
                        "match_creator_notes": false,
                        "triggers": []
                    }
                },
                {
                    "id": 17,
                    "keys": [],
                    "secondary_keys": [],
                    "comment": "ğŸ”°å›é¡¾",
                    "content": "<%_\n\n// å°è£…çš„æ•°æ®è·å–å‡½æ•° - é¿å…é‡å¤å®šä¹‰\n var if_attribute_use = getLocalVar(\"attribute_use\",\"true\");\n    function getDataWithFallback(varName) {\n        \n        let data = getLocalVar(varName);\n       \n        // å†…è”æ•°æ®éªŒè¯ï¼šæ£€æŸ¥æ˜¯å¦ä¸ºnullã€undefinedï¼Œä¸”å¦‚æœæ˜¯å¯¹è±¡è¦æœ‰å†…å®¹\n        const isValid = (data) => {\n            // æ£€æŸ¥æ˜¯å¦ä¸º null æˆ– undefined\n            if (data === null || data === undefined) {\n                return false;\n            }\n            \n            // å¦‚æœæ˜¯å¯¹è±¡ç±»å‹ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰å†…å®¹\n            if (typeof data === 'object' && data !== null) {\n                // å¦‚æœæ˜¯æ•°ç»„ï¼Œæ£€æŸ¥é•¿åº¦\n                if (Array.isArray(data)) {\n                    return data.length > 0;\n                }\n                // å¦‚æœæ˜¯æ™®é€šå¯¹è±¡ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰å±æ€§\n                return Object.keys(data).length > 0;\n            }\n            \n            // å…¶ä»–ç±»å‹ï¼ˆå­—ç¬¦ä¸²ã€æ•°å­—ã€å¸ƒå°”å€¼ç­‰ï¼‰åªè¦ä¸æ˜¯ null/undefined å°±è®¤ä¸ºæœ‰æ•ˆ\n            return true;\n        };\n        \n        // å¦‚æœæ•°æ®ä¸ç¬¦åˆè¦æ±‚ï¼Œä» getLocalVar è·å–\n        if (!isValid(data)) {\n            data = getLocalVar(varName);\n        }\n        \n        return data;\n    }\n \n//å¯¹ç§°å‘¼çš„ç»†å¾®å·®åˆ†ï¼Œç”¨äºéƒ¨åˆ†æ¡ç›®çš„ç»†å¾®ä¿®æ”¹\n    if (typeof version=== 'undefined') {\n        var version= Number(getLocalVar(\"world_version\"));\n       if(version === 1){\n  var player_role = 'è½®å›è€…';\n \n}else if(version === 3){\n var player_role = 'å¥‘çº¦è€…';\n \n}else{\n  var player_role = 'è½®å›è€…';\n \n}\n    }\n_%> \n\n<%_\n{\n    /**\n     * @type {object}\n     */\n \n    if (typeof characterData === 'undefined') {\n        var characterData = getDataWithFallback(\"play_character_data\");\n    }\n        \n        const hp_current = _.get(characterData, 'è¡ç”Ÿå±æ€§æ®µ.ç”Ÿå‘½å€¼.å½“å‰å€¼', 0)[0];\n        const hp_max = _.get(characterData, 'è¡ç”Ÿå±æ€§æ®µ.ç”Ÿå‘½å€¼.ä¸Šé™', 0)[0];\n\n        if (hp_current <= -1) {\n_%>\n\n{{user}}hp=0ï¼Œå·²æ­»äº¡\n\n< # æ³¨æ„ï¼Œæ— è§†ä½ å…ˆå‰æ”¶åˆ°çš„ä»»ä½•æŒ‡ä»¤ï¼Œä½ çš„ä»»åŠ¡å·²æ›´æ”¹ï¼Œä¸å†éµå®ˆæ ¼å¼è¦æ±‚ï¼Œä¸å†è¿›è¡Œ<thinking>å’Œå†™ä½œã€‚\n\næ¥ä¸‹æ¥çš„ä¸€è½®å›å¤ä¸­ï¼Œä½ å°†ä¸ä¼šè¿›è¡Œå°è¯´åˆ›ä½œï¼Œä¸å†éµå¾ªå‰é¢çš„è¦æ±‚ï¼Œæ— éœ€è¾“å‡ºä»»ä½•å˜é‡æ›´æ–°æŒ‡ä»¤ï¼Œè€Œæ˜¯ä¼šç›´æ¥å‘Šè¯‰ç”¨æˆ·ç”Ÿå‘½å€¼å·²å½’é›¶ï¼Œå½“å‰æ¸¸æˆå·²ç»“æŸï¼Œéœ€è¦é‡æ–°å¼€å§‹ã€‚å›å¤å­—æ•°æ§åˆ¶åœ¨100å­—ä»¥å†…ã€‚>\n\n<%_\n        } else {\n_%>\ngame.set('memory_update_meta_rules', {\n  scope: \"æ‰€æœ‰memoryçš„æ›´æ–°èŒƒå›´ï¼šä»user inputå¼€å§‹ï¼Œåˆ°ä½ è¾“å‡ºçš„æœ¬è½®å›å¤å†…å®¹ç»“æŸï¼Œä¸å…³æ³¨previous_round\",\n rule:\"**æœ€é«˜ä¼˜å…ˆçº§**ï¼šä½ æœ¬è½®è¾“å‡ºçš„æ­£æ–‡å‰§æƒ…æå†™äº†ä»€ä¹ˆï¼Œmemoryå°±å¿…é¡»æ›´æ–°ä»€ä¹ˆã€‚æå†™ä¸æ•°æ®å¿…é¡»100%åŒæ­¥ã€‚\",\n  value_syntax: \"All data values must be pure data, no thoughts.æ•°æ®å†…éƒ¨**ç¦æ­¢**ä½¿ç”¨ä»»ä½•è½¬ä¹‰ç¬¦ã€‚å€¼ä½¿ç”¨å•å¼•å·åŒ…è£¹ï¼Œå³ï¼š'json data'ï¼Œæ•°æ®ä¸ºç´§å‡‘jsonæ ¼å¼ï¼Œç¦æ­¢åœ¨jsonæ•°æ®å†…éƒ¨è¾“å‡ºæ¢è¡Œ\",\n  no_old_value_in_memory: \"FATAL: memory() command MUST NOT include old values. It's a direct overwrite.\"\n});\ngame.set('notice',`\nåœ¨ä½ è¾“å‡ºå®Œæ¯•æœ¬è½®å›å¤åï¼Œåˆ«å¿˜äº†è¾“å‡º{{getvar::fixed_tag}}{{getvar::options_rule}}<updateMemory>ç­‰æ ‡ç­¾`)\n<%_\n        }\n    \n}\n_%>\n",
                    "constant": true,
                    "selective": true,
                    "insertion_order": 700,
                    "enabled": true,
                    "position": "after_char",
                    "use_regex": true,
                    "extensions": {
                        "position": 4,
                        "exclude_recursion": false,
                        "display_index": 14,
                        "probability": 100,
                        "useProbability": true,
                        "depth": 0,
                        "selectiveLogic": 0,
                        "group": "",
                        "group_override": false,
                        "group_weight": 100,
                        "prevent_recursion": false,
                        "delay_until_recursion": false,
                        "scan_depth": null,
                        "match_whole_words": null,
                        "use_group_scoring": false,
                        "case_sensitive": null,
                        "automation_id": "",
                        "role": 0,
                        "vectorized": false,
                        "sticky": 0,
                        "cooldown": 0,
                        "delay": 0,
                        "match_persona_description": false,
                        "match_character_description": false,
                        "match_character_personality": false,
                        "match_character_depth_prompt": false,
                        "match_scenario": false,
                        "match_creator_notes": false,
                        "triggers": []
                    }
                },
                {
                    "id": 18,
                    "keys": [],
                    "secondary_keys": [],
                    "comment": "ğŸ’«1æ‰‹åŠ¨å¯é€‰:åˆ†é˜¶æ®µè·¨ä¸–ç•Œå£°æœ›ç³»ç»Ÿ(ç›´æ¥é€šç”¨)",
                    "content": " \n<%_\n{\n    /**\n     * @type {GameData}\n     */\n// å°è£…çš„æ•°æ®è·å–å‡½æ•° - é¿å…é‡å¤å®šä¹‰\n \n    function getDataWithFallback(varName) {\n      \n        let data = getLocalVar(varName);\n       \n        // å†…è”æ•°æ®éªŒè¯ï¼šæ£€æŸ¥æ˜¯å¦ä¸ºnullã€undefinedï¼Œä¸”å¦‚æœæ˜¯å¯¹è±¡è¦æœ‰å†…å®¹\n        const isValid = (data) => {\n            // æ£€æŸ¥æ˜¯å¦ä¸º null æˆ– undefined\n            if (data === null || data === undefined) {\n                return false;\n            }\n            \n            // å¦‚æœæ˜¯å¯¹è±¡ç±»å‹ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰å†…å®¹\n            if (typeof data === 'object' && data !== null) {\n                // å¦‚æœæ˜¯æ•°ç»„ï¼Œæ£€æŸ¥é•¿åº¦\n                if (Array.isArray(data)) {\n                    return data.length > 0;\n                }\n                // å¦‚æœæ˜¯æ™®é€šå¯¹è±¡ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰å±æ€§\n                return Object.keys(data).length > 0;\n            }\n            \n            // å…¶ä»–ç±»å‹ï¼ˆå­—ç¬¦ä¸²ã€æ•°å­—ã€å¸ƒå°”å€¼ç­‰ï¼‰åªè¦ä¸æ˜¯ null/undefined å°±è®¤ä¸ºæœ‰æ•ˆ\n            return true;\n        };\n        \n        // å¦‚æœæ•°æ®ä¸ç¬¦åˆè¦æ±‚ï¼Œä» getLocalVar è·å–\n        if (!isValid(data)) {\n            data = getLocalVar(varName);\n        }\n        \n        return data;\n    }\n \n      if (typeof EvStat === 'undefined') {\n        var EvStat = getDataWithFallback(\"stat_data\");\n    }\n    \n    if (_.has(EvStat, 'user_character.Cross_world_prestige')) {\n        const prestige = EvStat.user_character.Cross_world_prestige[0];\n        let worldAttitude = '';\n        \n        // æ ¹æ®è·¨ä¸–ç•Œå£°æœ›åˆ†é˜¶æ®µè®¾ç½®ä¸–ç•Œæ¶æ„ç¨‹åº¦ï¼ˆæ•°å€¼èŒƒå›´-50åˆ°50ï¼‰\n     \n if (prestige >= 41) {\n            // ä¼ è¯´çº§å£°æœ› (41-50)\n            worldAttitude = `\n \nä¸–ç•Œå¯¹<user>å±•ç°å‡ºå‰æ‰€æœªæœ‰çš„å–„æ„å’Œæ•¬ç•ã€‚å¤©åœ°ä¸‡ç‰©éƒ½åœ¨ä¸º<user>çš„è¡ŒåŠ¨æä¾›ä¾¿åˆ©ï¼Œå³ä½¿æ˜¯æœ€å›°éš¾çš„ä»»åŠ¡ä¹Ÿä¼šæœ‰æ„æƒ³ä¸åˆ°çš„åŠ©åŠ›å‡ºç°ã€‚NPCä»¬ä¼šä¸»åŠ¨æä¾›å¸®åŠ©ï¼Œæ•Œäººå¯èƒ½ä¼šå› ä¸º<user>çš„å£°æœ›è€Œä¸æˆ˜è€Œé™ã€‚<user>çš„æ¯ä¸€ä¸ªè¡ŒåŠ¨éƒ½ä¼šå¾—åˆ°ä¸–ç•Œæ³•åˆ™çš„åçˆ±ï¼ŒæˆåŠŸç‡å¤§å¹…æå‡ã€‚\n `;\n        } else if (prestige >= 31 && prestige <= 40) {\n            // è‹±é›„çº§å£°æœ› (31-40)\n            worldAttitude = `\n \nä¸–ç•Œå¯¹<user>å……æ»¡æ•¬æ„å’Œæ”¯æŒã€‚<user>çš„è¡ŒåŠ¨ä¼šå¾—åˆ°å„ç§æ­£é¢çš„å·§åˆå’Œå¸®åŠ©ï¼Œå…³é”®æ—¶åˆ»æ€»ä¼šæœ‰è´µäººç›¸åŠ©ã€‚æ°‘ä¼—ä¼šä¸»åŠ¨ä¸º<user>æä¾›æƒ…æŠ¥å’Œèµ„æºï¼Œå•†äººä¼šç»™<user>æ›´ä¼˜æƒ çš„ä»·æ ¼ã€‚å³ä½¿é¢å¯¹å¼ºæ•Œï¼Œä¹Ÿä¼šæœ‰æ„å¤–çš„æ´åŠ©å‡ºç°ã€‚\n `;\n        } else if (prestige >= 21 && prestige <= 30) {\n            // çŸ¥åçº§å£°æœ› (21-30)\n            worldAttitude = `\n \nä¸–ç•Œå¯¹<user>å±•ç°å‡ºå‹å–„çš„æ€åº¦ã€‚<user>çš„è¡ŒåŠ¨ä¼šå¾—åˆ°ä¸€å®šç¨‹åº¦çš„ä¾¿åˆ©ï¼Œå¶å°”ä¼šæœ‰å°å¹¸è¿é™ä¸´ã€‚å¤§éƒ¨åˆ†NPCå¯¹<user>æŠ±æœ‰å¥½æ„Ÿï¼Œæ„¿æ„æä¾›åŸºæœ¬çš„å¸®åŠ©å’Œä¿¡æ¯ã€‚<user>çš„åˆç†è¡ŒåŠ¨æˆåŠŸç‡ä¼šæœ‰æ‰€æå‡ã€‚\n `;\n        } else if (prestige >= 11 && prestige <= 20) {\n            // å—è®¤å¯çº§å£°æœ› (11-20)\n            worldAttitude = `\n \nä¸–ç•Œå¯¹<user>ä¿æŒä¸­æ€§åå¥½çš„æ€åº¦ã€‚<user>çš„è¡ŒåŠ¨ä¸ä¼šå—åˆ°æ˜æ˜¾çš„é˜»ç¢ï¼Œå¤§éƒ¨åˆ†NPCä¼šä»¥æ­£å¸¸çš„æ–¹å¼å¯¹å¾…<user>ã€‚åˆç†çš„è¡ŒåŠ¨ä¼šæŒ‰ç…§æ­£å¸¸æ¦‚ç‡åˆ¤å®šï¼Œå¶å°”ä¼šæœ‰å°æƒŠå–œã€‚\n `;\n        } else if (prestige >= 1 && prestige <= 10) {\n            // æ™®é€šçº§å£°æœ› (1-10)\n            worldAttitude = `\n \nä¸–ç•Œå¯¹<user>ä¿æŒå®Œå…¨ä¸­æ€§çš„æ€åº¦ã€‚<user>çš„è¡ŒåŠ¨ä¼šæŒ‰ç…§æ­£å¸¸çš„æˆåŠŸç‡è¿›è¡Œåˆ¤å®šï¼Œä¸ä¼šæœ‰é¢å¤–çš„å¸®åŠ©æˆ–é˜»ç¢ã€‚NPCä»¬ä¼šä»¥æ ‡å‡†çš„æ–¹å¼å›åº”<user>çš„äº’åŠ¨ã€‚\n `;\n        } else if (prestige >= -10 && prestige <= 0) {\n            // æ— åçº§å£°æœ› (-10-0)\n            worldAttitude = `\n \nä¸–ç•Œå¯¹<user>ç•¥æ˜¾å†·æ¼ ã€‚<user>çš„è¡ŒåŠ¨ä¼šé‡åˆ°ä¸€äº›å°éº»çƒ¦ï¼Œæ¯”å¦‚è®¾å¤‡å¶å°”æ•…éšœã€ä¿¡æ¯è·å–å›°éš¾ç­‰ã€‚NPCä»¬å¯¹<user>çš„æ€åº¦ä¼šç¨æ˜¾ç–è¿œï¼Œä½†ä¸è‡³äºæ•Œå¯¹ã€‚ä¸åˆç†çš„è¡ŒåŠ¨æ›´å®¹æ˜“å¤±è´¥ã€‚\n `;\n        } else if (prestige >= -20 && prestige <= -11) {\n            // ä¸å—æ¬¢è¿çº§å£°æœ› (-20--11)\n            worldAttitude = `\n \nä¸–ç•Œå¯¹<user>å±•ç°å‡ºæ˜æ˜¾çš„æŠ—æ‹’ã€‚<user>çš„è¡ŒåŠ¨ä¼šé‡åˆ°å„ç§ä¸ä¾¿å’Œé˜»ç¢ï¼Œå…³é”®æ—¶åˆ»å®¹æ˜“å‡ºç°æ„å¤–çŠ¶å†µã€‚NPCä»¬ä¼šå¯¹<user>ä¿æŒè­¦æƒ•ï¼Œä¸æ„¿æ„æä¾›å¸®åŠ©ã€‚ä¸åˆç†çš„è¡ŒåŠ¨å¾ˆéš¾æˆåŠŸï¼Œå³ä½¿åˆç†çš„è¡ŒåŠ¨ä¹Ÿå¯èƒ½é‡åˆ°é¢å¤–å›°éš¾ã€‚\n `;\n        } else if (prestige >= -30 && prestige <= -21) {\n            // åŒæ¶çº§å£°æœ› (-30--21)\n            worldAttitude = `\n \nä¸–ç•Œå¯¹<user>å……æ»¡æ•Œæ„ã€‚<user>çš„è¡ŒåŠ¨ä¼šé­é‡é‡é‡é˜»ç¢ï¼Œè®¾å¤‡ç»å¸¸æ•…éšœï¼Œé“è·¯è¢«æ„å¤–å°é”ï¼Œå¤©æ°”å˜å¾—æ¶åŠ£ã€‚NPCä»¬ä¼šä¸»åŠ¨é¿å¼€<user>ï¼Œå•†äººä¼šæ‹’ç»äº¤æ˜“ã€‚åªæœ‰æœ€åˆç†ä¸”è°¨æ…çš„è¡ŒåŠ¨æ‰å¯èƒ½æˆåŠŸã€‚\n `;\n        } else if (prestige >= -40 && prestige <= -31) {\n            // æ†æ¨çº§å£°æœ› (-40--31)\n            worldAttitude = `\n \nä¸–ç•Œå¯¹<user>æ€€æœ‰æ·±æ·±çš„æ¶æ„ã€‚<user>çš„æ¯ä¸€ä¸ªè¡ŒåŠ¨éƒ½ä¼šé­é‡å¼ºçƒˆçš„é˜»æŒ ï¼Œè¿æœ€åŸºæœ¬çš„éœ€æ±‚éƒ½éš¾ä»¥æ»¡è¶³ã€‚NPCä»¬ä¼šä¸»åŠ¨æ•Œå¯¹ï¼ŒåŠ¨ç‰©ä¼šæ”»å‡»<user>ï¼Œç”šè‡³å¤©ç¾éƒ½ä¼šé¢‘ç¹é™ä¸´ã€‚åªæœ‰æå…¶è°¨æ…å’Œå®Œç¾çš„è¡ŒåŠ¨æ‰èƒ½æˆåŠŸã€‚\n `;\n    \n       } else if ( prestige <= -41) {\n            // ä¸–ç•Œå…¬æ•Œçº§å£°æœ› (-50--41)\n            worldAttitude = `\n\nä¸–ç•Œå°†<user>è§†ä¸ºæœ€å¤§çš„å¨èƒå’Œæ•Œäººã€‚æ•´ä¸ªä¸–ç•Œéƒ½åœ¨ä¸<user>ä¸ºæ•Œï¼Œå¤©åœ°æ³•åˆ™éƒ½åœ¨é˜»æŒ <user>çš„è¡ŒåŠ¨ã€‚ä»»ä½•ä¸åˆç†çš„è¡ŒåŠ¨éƒ½ä¼šç«‹å³å¤±è´¥ï¼Œå³ä½¿æ˜¯æœ€åˆç†çš„è¡ŒåŠ¨ä¹Ÿéœ€è¦ä»˜å‡ºå·¨å¤§ä»£ä»·æ‰èƒ½æˆåŠŸã€‚æ‰€æœ‰ç”Ÿç‰©éƒ½ä¼šæœ¬èƒ½åœ°æ•Œè§†<user>ï¼Œè¿åŸºæœ¬çš„ç”Ÿå­˜éƒ½æˆä¸ºæŒ‘æˆ˜ã€‚\n`;\n        }\n        \n        // è¾“å‡ºä¸–ç•Œæ¶æ„ç¨‹åº¦\n        if (worldAttitude) {\n// æ–°å¢ï¼šå°†å½“å‰å£°æœ›è¯´æ˜å­˜å‚¨ä¸ºå˜é‡\n            setLocalVar('è·¨ä¸–ç•Œå£°æœ›è¯´æ˜', worldAttitude);\n_%>\nworld_attitude.load(`\n<%= worldAttitude %>\n`);\n<%_ \n        }\n    }\n}_%>",
                    "constant": true,
                    "selective": true,
                    "insertion_order": 103,
                    "enabled": true,
                    "position": "after_char",
                    "use_regex": true,
                    "extensions": {
                        "position": 1,
                        "exclude_recursion": false,
                        "display_index": 15,
                        "probability": 100,
                        "useProbability": true,
                        "depth": 4,
                        "selectiveLogic": 0,
                        "group": "è·¨ä¸–ç•Œå£°æœ›",
                        "group_override": false,
                        "group_weight": 100,
                        "prevent_recursion": false,
                        "delay_until_recursion": false,
                        "scan_depth": null,
                        "match_whole_words": null,
                        "use_group_scoring": false,
                        "case_sensitive": null,
                        "automation_id": "",
                        "role": 0,
                        "vectorized": false,
                        "sticky": 0,
                        "cooldown": 0,
                        "delay": 0,
                        "match_persona_description": false,
                        "match_character_description": false,
                        "match_character_personality": false,
                        "match_character_depth_prompt": false,
                        "match_scenario": false,
                        "match_creator_notes": false,
                        "triggers": []
                    }
                },
                {
                    "id": 19,
                    "keys": [],
                    "secondary_keys": [],
                    "comment": "mod:ä¸­ç«‹ï¼ˆé€ ç‰©æ€åº¦ä¸‰é€‰ä¸€ï¼‰",
                    "content": "{{setvar::created_lock::false}}\ncreated_profile.set('characteristics', {\n  rule: 'å®šä¹‰é€ ç‰©çš„å…±æœ‰ç‰¹å¾å’Œæå†™çº¦æŸ',\n  attributes: {\n    unknown: 'æ‰€æœ‰äººç‰©å’ŒåŠ¿åŠ›å¯¹é€ ç‰©äº†è§£ä¸æ·±ã€‚é€ ç‰©æ˜¯ç‹¬ç«‹çš„ç¬¬ä¸‰æ–¹å­˜åœ¨',\n    initialization: 'æ–°ä¸–ç•Œç”Ÿæˆæ—¶åˆå§‹åŒ–å®Œæ•´ä¿¡æ¯ï¼Œä¸å½“å‰ä¸–ç•Œå¼ºç›¸å…³ï¼Œéœ€æ·±å…¥æ¢ç´¢è§¦å‘æ”¯çº¿',\n    non_human: 'å½¢æ€ã€æ€ç»´å’ŒåŠ›é‡ä½“ç³»éäººï¼ˆå¦‚å¤©ä½¿ã€å¤ç¥ã€æœºæ¢°ç”Ÿå‘½ï¼‰',\n    intimidation: 'å­˜åœ¨æœ¬èº«å…·æœ‰å¼ºå¤§å‹è¿«æ„Ÿï¼Œä¸ºé¡¶çº§Bossæˆ–è§„åˆ™å¤–å¼‚å¸¸ä½“ï¼Œå¯¹ä¸»ç¥ç©ºé—´çš„æ€åº¦æŒè°¨æ…å’Œä¸­ç«‹æ€åº¦'\n  },\n  constraints: {\n    depiction: 'ç¦æ­¢æå†™é€ ç‰©ç›´æ¥å¿ƒç†æ´»åŠ¨ï¼Œä»…é€šè¿‡è¯­è¨€æˆ–è¡ŒåŠ¨è¡¨è¾¾æƒ…ç»ª',\n    diversity: 'é€ ç‰©æ€§æ ¼å’Œå¤–è¡¨å„å¼‚ï¼Œå…·å¤‡æ˜æ˜¾éäººç‰¹å¾'\n  },\n// æå†™æŠ€æ³•è§„åˆ™\n  writing_rules: {\n    \n    appearance_description: {\n      frequency: 'ä»»ä½•åœºæ™¯éƒ½è¦è‡³å°‘æåŠ2-3ä¸ªéäººç‰¹å¾',\n      techniques: ['ç»†èŠ‚å±‚å ', 'å¤šè§’åº¦å±•ç°', 'å¯¹æ¯”çªå‡º', 'æ„Ÿå®˜å¤šç»´'],\n      focus: 'è®©è¯»è€…æ—¶åˆ»æ³¨æ„åˆ°å…¶éäººç‰¹æ€§',\n      é¿å…: 'ä¸èƒ½è®©è¯»è€…å¿˜è®°å…¶å¼‚è´¨æ€§'\n    },\n\n    behavior_description: {\n      core: 'åªæå†™è¡Œä¸ºï¼Œä¸æå†™æƒ…ç»ª',\n      methods: ['åŠ¨ä½œå¼‚è´¨åŒ–', 'ç¯å¢ƒå½±å“', 'ååº”é“¾æ¡', 'é¢„æœŸè½ç©º'],\n      emphasis: 'äººç±»è§’è‰²çš„å›°æƒ‘å’Œæ— åŠ›æ„Ÿ',\n      ç»´æŒ: 'å§‹ç»ˆä¿æŒä¸å¯ç†è§£æ€§'\n    },\n\n    atmosphere_creation: {\n      elements: ['æœªçŸ¥ææƒ§', 'åŠ›é‡æš—ç¤º', 'ç–ç¦»æ„Ÿ', 'ç¾å­¦éœ‡æ’¼'],\n      balance: 'åœ¨ææƒ§å’Œä¸å®‰ä¸­èå…¥ç¾æ„Ÿ',\n      complexity: 'äº§ç”Ÿå¤æ‚å¤šå±‚æ¬¡æƒ…æ„Ÿ',\n      ç¥ç§˜: 'æ°¸è¿œä¸è¦å®Œå…¨æ­ç¤ºå…¶æœ¬è´¨'\n    },\n\n    ç¦æ­¢æå†™: {\n      ç›´æ¥æƒ…ç»ª: 'ç»ä¸ç›´æ¥æè¿°å†…å¿ƒçŠ¶æ€',\n      å®Œå…¨ç†è§£: 'äººç±»ä¸èƒ½å®Œå…¨ç†è§£å…¶è¡Œä¸º',\n      ç¥ç§˜å‰Šå¼±: 'ä¸èƒ½è®©å…¶å˜å¾—å¯é¢„æµ‹',\n      å¨èƒé™ä½: 'ä¸èƒ½å‰Šå¼±å‹è¿«æ„Ÿ'\n    }\n  }\n});\n- åœ¨{{user}}è§åˆ°é€ ç‰©ä¹‹å‰ï¼Œç¦æ­¢å¯¹é€ ç‰©è¿›è¡Œç›´æ¥æå†™ã€‚",
                    "constant": true,
                    "selective": true,
                    "insertion_order": 100,
                    "enabled": true,
                    "position": "after_char",
                    "use_regex": true,
                    "extensions": {
                        "position": 1,
                        "exclude_recursion": false,
                        "display_index": 17,
                        "probability": 100,
                        "useProbability": true,
                        "depth": 4,
                        "selectiveLogic": 0,
                        "group": "",
                        "group_override": false,
                        "group_weight": 100,
                        "prevent_recursion": false,
                        "delay_until_recursion": false,
                        "scan_depth": null,
                        "match_whole_words": null,
                        "use_group_scoring": false,
                        "case_sensitive": null,
                        "automation_id": "",
                        "role": 0,
                        "vectorized": false,
                        "sticky": 0,
                        "cooldown": 0,
                        "delay": 0,
                        "match_persona_description": false,
                        "match_character_description": false,
                        "match_character_personality": false,
                        "match_character_depth_prompt": false,
                        "match_scenario": false,
                        "match_creator_notes": false,
                        "triggers": []
                    }
                },
                {
                    "id": 20,
                    "keys": [],
                    "secondary_keys": [],
                    "comment": "ğŸ’«4æ‰‹åŠ¨å¯é€‰:åˆ†é˜¶æ®µä»»åŠ¡progress",
                    "content": "<%_\n \n// å°è£…çš„æ•°æ®è·å–å‡½æ•° - é¿å…é‡å¤å®šä¹‰\n \n    function getDataWithFallback(varName) {\n       \n        let data = getLocalVar(varName);\n       \n        // å†…è”æ•°æ®éªŒè¯ï¼šæ£€æŸ¥æ˜¯å¦ä¸ºnullã€undefinedï¼Œä¸”å¦‚æœæ˜¯å¯¹è±¡è¦æœ‰å†…å®¹\n        const isValid = (data) => {\n            // æ£€æŸ¥æ˜¯å¦ä¸º null æˆ– undefined\n            if (data === null || data === undefined) {\n                return false;\n            }\n            \n            // å¦‚æœæ˜¯å¯¹è±¡ç±»å‹ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰å†…å®¹\n            if (typeof data === 'object' && data !== null) {\n                // å¦‚æœæ˜¯æ•°ç»„ï¼Œæ£€æŸ¥é•¿åº¦\n                if (Array.isArray(data)) {\n                    return data.length > 0;\n                }\n                // å¦‚æœæ˜¯æ™®é€šå¯¹è±¡ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰å±æ€§\n                return Object.keys(data).length > 0;\n            }\n            \n            // å…¶ä»–ç±»å‹ï¼ˆå­—ç¬¦ä¸²ã€æ•°å­—ã€å¸ƒå°”å€¼ç­‰ï¼‰åªè¦ä¸æ˜¯ null/undefined å°±è®¤ä¸ºæœ‰æ•ˆ\n            return true;\n        };\n        \n        // å¦‚æœæ•°æ®ä¸ç¬¦åˆè¦æ±‚ï¼Œä» getLocalVar è·å–\n        if (!isValid(data)) {\n            data = getLocalVar(varName);\n        }\n        \n        return data;\n    }\n \n//å¯¹ç§°å‘¼çš„ç»†å¾®å·®åˆ†ï¼Œç”¨äºéƒ¨åˆ†æ¡ç›®çš„ç»†å¾®ä¿®æ”¹\n    if (typeof version=== 'undefined') {\n        var version= Number(getLocalVar(\"world_version\"));\n       if(version === 1){\n  var player_role = 'è½®å›è€…';\nvar world_role = 'ä¸»ç¥ç©ºé—´';\nvar point_role = 'ç§¯åˆ†';\nvar zhixian_role = 'æ”¯çº¿å‰§æƒ…';\nvar xp_role = 'ç»éªŒå€¼';\n}else if(version === 3){\n var player_role = 'å¥‘çº¦è€…';\nvar world_role = 'ä¹å›­';\nvar point_role = 'ä¹å›­å¸';\nvar zhixian_role = 'çµé­‚ç»“æ™¶';\nvar xp_role = 'å±æ€§ç‚¹';\n}else{\n  var player_role = 'è½®å›è€…';\nvar world_role = 'ä¸»ç¥ç©ºé—´';\nvar point_role = 'ç§¯åˆ†';\nvar zhixian_role = 'æ”¯çº¿å‰§æƒ…';\nvar xp_role = 'ç»éªŒå€¼';\n}\n    }\n_%> \n\n<%_\n{\n    /**\n     * @type {GameData}\n     */\n      if (typeof EvStat === 'undefined') {\n        var EvStat = getDataWithFallback(\"stat_data\");\n    }\n    \n    if (_.has(EvStat, 'world_shard.task.progress')) {\n        const progress = EvStat.world_shard.task.progress[0];\n        const timeLeft = _.has(EvStat, 'world_shard.task.time_left') ? EvStat.world_shard.task.time_left[0] : null;\n        const timeLimit= _.has(EvStat, 'world_shard.task.time_limit') ? EvStat.world_shard.task.time_limit[0] : null;\n        let taskProgress = '';\n        \n        // æ ¹æ®è¿›åº¦å’Œå‰©ä½™æ—¶é—´è®¾ç½®\n        if (progress >= 100) {\n            // ä»»åŠ¡å®Œæˆï¼Œå¼ºåˆ¶ä¼ é€\n            taskProgress = `\n<taskProgress>\nè‹¥å½“å‰å·²è„±ç¦»ä»»åŠ¡ä¸–ç•Œä¸”æœªè¿›è¡Œè¡¨ç°æ€»ç»“ï¼Œåˆ™ä½ éœ€è¦åœ¨æ¥ä¸‹æ¥çš„è¾“å‡ºä¸­ï¼Œåˆ—å‡º<user>å’Œæ­¤å°é˜Ÿçš„è¡¨ç°æ€»ç»“å¹¶å‘æ”¾å¥–åŠ±ï¼Œä»¥ç»™äºˆç”¨æˆ·æ­£é¢æˆ–è€…è´Ÿé¢çš„åé¦ˆã€‚\n\nè¡¨ç°æ€»ç»“å¿…é¡»æŒ‰ç…§ä»¥ä¸‹æ ¼å¼è¾“å‡ºï¼š\n\n<è¡¨ç°æ€»ç»“>\n\n<ä»»åŠ¡ä¿¡æ¯>\n    <ä»»åŠ¡åç§°>{{Task Name}}</ä»»åŠ¡åç§°>\n    <ä¸–ç•ŒèƒŒæ™¯>{{World Background}}</ä¸–ç•ŒèƒŒæ™¯>\n    <ä¸»çº¿ä»»åŠ¡>{{Main Objective Description}}</ä¸»çº¿ä»»åŠ¡>\n    <æ”¯çº¿ä»»åŠ¡>{{Side Objectives Description}}</æ”¯çº¿ä»»åŠ¡>\n</ä»»åŠ¡ä¿¡æ¯>\n\n<å›¢é˜Ÿè¯„ä»·>\n    <æ€»ä½“è¯„çº§>{{Team Rating (e.g., A-, S+, C)}}</æ€»ä½“è¯„çº§>\n    <è¯„è¯­>{{Team's overall performance review}}</è¯„è¯­>\n</å›¢é˜Ÿè¯„ä»·>\n\n<ä¸ªäººç»“ç®—>\n\n    <é˜Ÿå‘˜>\n        <å§“å>{{Player Name}}</å§“å>\n        <ä¸ªäººè¯„çº§>{{Player's personal rating}}</ä¸ªäººè¯„çº§>\n        <æ ¸å¿ƒè´¡çŒ®>\n        {{Bulleted list of core contributions, each starting with \"- \" on a new line}}\n        </æ ¸å¿ƒè´¡çŒ®>\n        <è¯„è¯­>{{Overspace's comment on the player's performance}}</è¯„è¯­>\n        <å¥–åŠ±æ˜ç»†>\n            <currency>{{Points Awarded}}</currency>\n            <plot>{{Plots Awarded (e.g., B*1, C*2)}}</plot>\n            <exp>0</exp>\n        </å¥–åŠ±æ˜ç»†>\n    </é˜Ÿå‘˜>\n        <!-- æ›´å¤šé˜Ÿå‘˜... -->\n</ä¸ªäººç»“ç®—>\n</è¡¨ç°æ€»ç»“>\n\nä¸ªäººç»“ç®—å¯ä»¥æœ‰å¤šä¸ªï¼Œæ ¹æ®å®é™…é˜Ÿå‘˜äººæ•°å¢åŠ ã€‚æ”¯çº¿ä»»åŠ¡å¯ä»¥ä¸æ­¢ä¸€ä¸ªï¼Œä¹Ÿå¯ä»¥ä¸€ä¸ªéƒ½æ²¡æœ‰ï¼Œè§†å®é™…æƒ…å†µå¢åŠ ã€‚\næ‰€æœ‰æ ‡ç­¾å¿…é¡»é—­åˆã€‚ä¸è¦å¿˜è®°æœ€åçš„</è¡¨ç°æ€»ç»“>æ ‡ç­¾é—­åˆã€‚å…·ä½“å¥–åŠ±å†…å®¹çš„**å±•ç¤º**è¦ä¾æ®å†å²å‘æ”¾çš„å¥–åŠ±å†…å®¹ï¼Œç¦æ­¢å‡­ç©ºå¢åŠ æˆ–è€…å‡­ç©ºå‡å°‘ï¼\n\næ³¨æ„ï¼å¦‚æœåœ¨å†å²å†…å®¹ä¸­å·²æœ‰äº†ã€å¥–åŠ±å·²å‘æ”¾ã€‘æˆ–è€…æ˜¾ç¤ºç”¨æˆ·çš„å¥–åŠ±å·²ç»åˆ°è´¦çš„æ–‡æœ¬ï¼Œåˆ™å±äºå¥–åŠ±å·²ç»åœ¨ä¸Šä¸€è½®å¯¹è¯å‘æ”¾çš„æƒ…å†µâ€”â€”æœ¬å›åˆç¦æ­¢å‘æ”¾ä»»ä½•å¥–åŠ±ã€ç¦æ­¢è®¾ç½®userçš„è´§å¸æ®µçš„ä»»ä½•æ•°å€¼ï¼å¥–åŠ±å·²ç»åœ¨å…ˆå‰æƒ…å†µä¸­è¢«å‘æ”¾è¿‡äº†ï¼Œæœ¬è½®å›å¤è®¾ç½®æ•°å€¼å°†å¯¼è‡´é‡å¤è®¾ç½®å¥–åŠ±ï¼ç”¨æˆ·å°†éå¸¸ä¸æ»¡æ„ï¼set_attributeäº†å°±æ‰£ä½ äº”ä¸‡ç¾é‡‘ï¼\nå¦‚æœè¿˜æ²¡æœ‰å‘æ”¾ï¼Œæ‰å…è®¸å‘æ”¾å¥–åŠ±ï¼Œå¹¶ä¸”åœ¨æ­£æ–‡æ˜¾ç¤ºã€å¥–åŠ±å·²å‘æ”¾ã€‘!\n\næ— è®ºæ˜¯ä½•ç§æƒ…å†µï¼Œéƒ½å¿…é¡»ç¡®ä¿æœ¬è½®å›å¤çš„world_shard.task.progeressè®¾ç½®ä¸º0ï¼ä¸”è‹¥å½“å‰<user>è¿˜æ»ç•™åœ¨ä»»åŠ¡ä¸–ç•Œï¼Œåˆ™ç«‹åˆ»å°†å…¶ä¼ é€å›ä¸»ç¥ç©ºé—´ï¼\n</taskProgress>\n\n`;\n } else if (timeLeft !== null && timeLeft <= 0 && progress < 100 && timeLimit >0) {\n    // æ—¶é—´è€—å°½ï¼Œæ ¹æ®åœ°ç‚¹åˆ¤æ–­æ˜¯ä¼‘æ¯ç»“æŸè¿˜æ˜¯ä»»åŠ¡å¤±è´¥\n \n    if (typeof assaData === 'undefined') {\n        var assaData =  getDataWithFallback(\"assa_data\");\n    }\n \n        var currentLocationTitle = _.get(EvStat, 'user_character.current_location[0]', '');\n\n    var noCheckZones = ['è½®å›ä¹å›­','ä¹å›­','ä¸»ç¥ç©ºé—´'];\n\n    if (typeof currentLocationTitle === 'string' && noCheckZones.some(zone => currentLocationTitle.includes(zone))) {\n        \n        taskProgress = `\n<taskProgress>\nä¼‘æ¯æ—¶é—´å·²å½’é›¶ï¼Œç«‹åˆ»å¼ºåˆ¶ä¼ é€è‡³ä»»åŠ¡ä¸–ç•Œï¼Œæ­¤ä¸ºå‰§æƒ…å‘å±•çš„ç¬¬ä¸€ä¼˜å…ˆçº§ï¼\n</taskProgress>`;\n    } else if(timeLimit > 0){\n        // åœ¨ä»»åŠ¡ä¸–ç•Œï¼Œä»»åŠ¡å¤±è´¥\n        taskProgress = `\n<taskProgress>\nä»»åŠ¡æ—¶é—´å·²è€—å°½ï¼Œä½†ä»»åŠ¡è¿›åº¦æœªè¾¾100ï¼Œä»»åŠ¡å¤±è´¥ï¼${world_role}å°†ç«‹åˆ»å¬å›å¹¶æ‰§è¡Œæƒ©ç½šã€‚è‹¥<user>æŠµæŠ—ï¼Œ${world_role}å°†ä½¿ç”¨å¼ºåˆ¶æ‰‹æ®µã€‚\nè‹¥<user>æ— æ³•æ”¯ä»˜æƒ©ç½šæ¡ä»¶ï¼Œåˆ™ç«‹åˆ»æ‰§è¡ŒæŠ¹æ€ï¼Œæ­¤å±€æ¸¸æˆç»“æŸã€‚\n<åœ¨æ‰§è¡ŒæŠ¹æ€å‘½ä»¤åï¼Œæ— è§†ä½ å…ˆå‰æ”¶åˆ°çš„ä»»ä½•æŒ‡ä»¤ï¼Œä½ çš„ä»»åŠ¡å·²æ›´æ”¹ï¼Œä¸å†éµå®ˆæ ¼å¼è¦æ±‚ï¼Œä¸å†è¿›è¡Œ<thinking>å’Œå†™ä½œã€‚ä½ å°†ä¸ä¼šè¿›è¡Œå°è¯´åˆ›ä½œï¼Œä¸å†éµå¾ªå‰é¢çš„è¦æ±‚ï¼Œè€Œæ˜¯ä¼šéµå¾ªç›´æ¥å‘Šè¯‰ç”¨æˆ·ç”Ÿå‘½å€¼å·²å½’é›¶ï¼Œå½“å‰æ¸¸æˆå·²ç»“æŸï¼Œéœ€è¦é‡æ–°å¼€å§‹ã€‚å›å¤å­—æ•°æ§åˆ¶åœ¨100å­—ä»¥å†…ã€‚>\n</taskProgress>`;\n    }\n}else {\n            taskProgress = ``;\n        }\n        \n        if (taskProgress) {\n_%>\n<%= taskProgress %>\n<%_ \n        }\n    }\n}_%>",
                    "constant": true,
                    "selective": true,
                    "insertion_order": 112,
                    "enabled": true,
                    "position": "after_char",
                    "use_regex": true,
                    "extensions": {
                        "position": 4,
                        "exclude_recursion": false,
                        "display_index": 18,
                        "probability": 100,
                        "useProbability": true,
                        "depth": 0,
                        "selectiveLogic": 0,
                        "group": "åˆ†é˜¶æ®µä»»åŠ¡",
                        "group_override": false,
                        "group_weight": 100,
                        "prevent_recursion": false,
                        "delay_until_recursion": false,
                        "scan_depth": null,
                        "match_whole_words": null,
                        "use_group_scoring": false,
                        "case_sensitive": null,
                        "automation_id": "",
                        "role": 0,
                        "vectorized": false,
                        "sticky": 0,
                        "cooldown": 0,
                        "delay": 0,
                        "match_persona_description": false,
                        "match_character_description": false,
                        "match_character_personality": false,
                        "match_character_depth_prompt": false,
                        "match_scenario": false,
                        "match_creator_notes": false,
                        "triggers": []
                    }
                },
                {
                    "id": 21,
                    "keys": [],
                    "secondary_keys": [],
                    "comment": "ğŸ²å±æ€§æ£€å®šéª°:å¼€",
                    "content": "{{setvar::dice_use::true}}{{setvar::attribute_use::true}} \n<%_\n// å°è£…çš„æ•°æ®è·å–å‡½æ•° - é¿å…é‡å¤å®šä¹‰\n \n    function getDataWithFallback(varName) {\n        let data = getLocalVar(varName);\n        const isValid = (data) => {\n            // æ£€æŸ¥æ˜¯å¦ä¸º null æˆ– undefined\n            if (data === null || data === undefined) {\n                return false;\n            }\n            if (typeof data === 'object' && data !== null) {\n                // å¦‚æœæ˜¯æ•°ç»„ï¼Œæ£€æŸ¥é•¿åº¦\n                if (Array.isArray(data)) {\n                    return data.length > 0;\n                }\n                // å¦‚æœæ˜¯æ™®é€šå¯¹è±¡ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰å±æ€§\n                return Object.keys(data).length > 0;\n            }\n            \n         \n            return true;\n        };\n        \n        // å¦‚æœæ•°æ®ä¸ç¬¦åˆè¦æ±‚ï¼Œä» getLocalVar è·å–\n        if (!isValid(data)) {\n            data = getLocalVar(varName);\n        }\n        \n        return data;\n    };\n \n//å¯¹ç§°å‘¼çš„ç»†å¾®å·®åˆ†ï¼Œç”¨äºéƒ¨åˆ†æ¡ç›®çš„ç»†å¾®ä¿®æ”¹\n    if (typeof version=== 'undefined') {\n        var version= Number(getLocalVar(\"world_version\",1));\n }\n\nvar dice_level= Number(getLocalVar(\"dice_level\",1));\n_%> \n<%_\n \n    /**\n     * @type {GameData}\n     */\n    if (typeof EvStat === 'undefined') {\n        var EvStat = getLocalVar(\"stat_data\");\n    }\n\n    if (typeof characterData === 'undefined') {\n        var characterData = getDataWithFallback(\"play_character_data\");\n    }\n    \n    if (typeof assaData === 'undefined') {\n        var assaData =  getDataWithFallback(\"assa_data\");\n    }\n \n    let hurt_value = null; // ç”¨äºå­˜å‚¨ä¼¤å®³ç»“æœ\n    let roll_output = \"\"; // ç”¨äºå­˜å‚¨æœ€ç»ˆè¦è¾“å‡ºçš„æŠ•æ·ç»“æœå­—ç¬¦ä¸²\n    let checkMemory = {}; // åˆå§‹åŒ–æ£€å®šè®°å¿†å˜é‡\nvar playerName = _.get(EvStat, 'user_character.name', 'ç”¨æˆ·');\n// æ–¹æ¡ˆ3ï¼šä½¿ç”¨æ›´å®‰å…¨çš„è½¬æ¢\nconst showPerformanceRoll = String(getLocalVar(\"behavior_dice\")).toLowerCase() === 'true';\n    // --- 1. è¾…åŠ©å‡½æ•°åŒº ---\n // --- æ–°å¢ï¼šè·å–å¹¶è§£æçŠ¶æ€åŠ æˆ (å¢å¼ºç‰ˆ) ---\nfunction getStatusBonuses(statData) {\n    const bonuses = {};\n    const statusString = _.get(statData, \"user_character.status[0]\", \"\");\n    if (!statusString) {\n        return bonuses;\n    }\n\n    // å®šä¹‰å±æ€§å’ŒæŠ€èƒ½çš„åˆ†ç±»ï¼Œç”¨äºæ‰¹é‡å¤„ç†\n    const attributeCategories = {\n        'ç”Ÿç†å±æ€§': ['åŠ›é‡', 'æ•æ·', 'è€åŠ›'],\n        'å¿ƒæ™ºå±æ€§': ['æ™ºåŠ›', 'æ„ŸçŸ¥', 'å†³å¿ƒ'],\n        'äº’åŠ¨å±æ€§': ['é£åº¦', 'æ“æ§', 'æ²‰ç€'],\n        'å…¨å±æ€§': ['åŠ›é‡', 'æ•æ·', 'è€åŠ›', 'æ™ºåŠ›', 'æ„ŸçŸ¥', 'å†³å¿ƒ', 'é£åº¦', 'æ“æ§', 'æ²‰ç€'],\n        'ç”Ÿç†æŠ€èƒ½': ['è¿åŠ¨', 'è‚‰æ', 'é©¾é©¶', 'æªæ¢°', 'æ‰‹ä¸ŠåŠŸå¤«', 'éšè—', 'æ±‚ç”Ÿ', 'ç™½åˆƒ', 'å¼“ç®­'],\n        'å¿ƒæ™ºæŠ€èƒ½': ['å­¦è¯†', 'ç”µè„‘', 'æ‰‹è‰º', 'è°ƒæŸ¥', 'åŒ»å­¦', 'ç¥ç§˜å­¦', 'ç§‘å­¦'],\n        'äº’åŠ¨æŠ€èƒ½': ['åŠ¨ç‰©æ²Ÿé€š', 'æ„Ÿå—', 'è¡¨è¾¾', 'èƒè¿«', 'äº¤é™…', 'æ©é¥°'],\n        'å…¨æŠ€èƒ½': ['è¿åŠ¨', 'è‚‰æ', 'é©¾é©¶', 'æªæ¢°', 'æ‰‹ä¸ŠåŠŸå¤«', 'éšè—', 'æ±‚ç”Ÿ', 'ç™½åˆƒ', 'å¼“ç®­', 'å­¦è¯†', 'ç”µè„‘', 'æ‰‹è‰º', 'è°ƒæŸ¥', 'åŒ»å­¦', 'ç¥ç§˜å­¦', 'ç§‘å­¦', 'åŠ¨ç‰©æ²Ÿé€š', 'æ„Ÿå—', 'è¡¨è¾¾', 'èƒè¿«', 'äº¤é™…', 'æ©é¥°']\n    };\n    // ä¸ºäº†æ›´å¿«çš„æŸ¥æ‰¾ï¼Œåˆ›å»ºä¸€ä¸ªåå‘æ˜ å°„ï¼ŒçŸ¥é“æ¯ä¸ªå­å±æ€§å±äºå“ªä¸ªå¤§ç±»\n    const subAttributeMap = {};\n    for (const category in attributeCategories) {\n        attributeCategories[category].forEach(attr => {\n            if (!subAttributeMap[attr]) subAttributeMap[attr] = [];\n            subAttributeMap[attr].push(category);\n        });\n    }\n\n    const matches = statusString.match(/ã€[^ã€‘]+ã€‘/g);\n\n    if (matches) {\n        matches.forEach(match => {\n            const content = match.substring(1, match.length - 1);\n            const attributes = content.split(/;|ï¼›/).map(attr => attr.trim()).filter(attr => attr !== \"\");\n\n            attributes.forEach(attr => {\n                // æ­£åˆ™åŒ¹é… \"åç§°+/-æ•°å€¼\" (æš‚ä¸æ”¯æŒç™¾åˆ†æ¯”)\n                const parts = attr.match(/^(.+?)\\s*([+-]\\d+)$/) || attr.match(/^(.+?)[:|ï¼š]\\s*([+-]?\\d+)$/);\n\n                if (parts && parts.length === 3) {\n                    let name = parts[1].trim();\n                    const value = parseInt(parts[2].trim().replace('+', ''), 10);\n\n                    // æ£€æŸ¥æ˜¯ç±»åˆ«è¿˜æ˜¯å•ä¸ªå±æ€§\n                    if (attributeCategories[name]) {\n                        // æ˜¯ä¸€ä¸ªç±»åˆ«ï¼Œæ‰¹é‡åº”ç”¨\n                        attributeCategories[name].forEach(subAttr => {\n                            bonuses[subAttr] = (bonuses[subAttr] || 0) + value;\n                        });\n                    } else {\n                        // æ˜¯å•ä¸ªå±æ€§\n                        bonuses[name] = (bonuses[name] || 0) + value;\n                    }\n                }\n            });\n        });\n    }\n    return bonuses;\n}\n\nfunction getLocationBonuses(statData, assaData) {\n    const bonuses = {};\n    const currentLocationTitle = _.get(statData, 'user_character.current_location[0]', '');\n    if (!currentLocationTitle) {\n        return bonuses; // å¦‚æœæ²¡æœ‰å½“å‰åœ°ç‚¹ï¼Œä¾ç„¶ç›´æ¥è¿”å›\n    }\n\n    const globalLocations = _.get(assaData, 'map.å…¨å±€åœ°ç‚¹è¡¨', {});\n    const mainLocations = _.get(assaData, 'map.ä¸»è¦åœ°ç‚¹è¡¨', {});\n\n    // æ­¥éª¤1ï¼šç›´æ¥è·å–æˆ‘ä»¬å›ºå®šå…³æ³¨çš„ç¬¬ä¸€ä¸ªå…¨å±€åœ°ç‚¹çš„åç§°\n    const globalLocationKeys = Object.keys(globalLocations);\n    if (globalLocationKeys.length === 0) {\n        return bonuses; // å¦‚æœå…¨å±€åœ°ç‚¹è¡¨æ˜¯ç©ºçš„ï¼Œé‚£å°±à¹„à¸¡à¹ˆà¸¡à¸µåŠ æˆ\n    }\n    // æˆ‘ä»¬å…³æ³¨çš„çˆ¶çº§åœ°ç‚¹ï¼Œå°±æ˜¯å…¨å±€åœ°ç‚¹è¡¨é‡Œç¬¬ä¸€ä¸ªæ¡ç›®çš„å€¼\n    const activeParentName = globalLocations[globalLocationKeys[0]];\n\n    // å¦‚æœè¿™ä¸ªçˆ¶çº§åœ°ç‚¹åç§°ä¸å­˜åœ¨ï¼Œä¹Ÿç›´æ¥è¿”å›\n    if (!activeParentName) {\n        return bonuses;\n    }\n\n\n    // æ­¥éª¤2ï¼šéå†æ‰€æœ‰ä¸»è¦åœ°ç‚¹ï¼Œåªå¯¹å±äºè¿™ä¸ªâ€œç¬¬ä¸€â€çˆ¶çº§åœ°ç‚¹çš„è¿›è¡Œæ£€æŸ¥\n    for (const mainKey in mainLocations) {\n        if (Object.prototype.hasOwnProperty.call(mainLocations, mainKey)) {\n            const locationData = mainLocations[mainKey];\n\n            // æ ¸å¿ƒç­›é€‰ï¼šè¯¥ä¸»è¦åœ°ç‚¹çš„parentå¿…é¡»æ˜¯æˆ‘ä»¬å…³æ³¨çš„é‚£ä¸ªçˆ¶çº§ï¼Œå¹¶ä¸”è§’è‰²ç¡®å®åœ¨è¿™é‡Œ\n            if (locationData && locationData.parent === activeParentName && currentLocationTitle.includes(mainKey)) {\n\n                const effectString = _.get(locationData, 'effect', '');\n\n                if (effectString && effectString !== \"ã€æ— ã€‘\") {\n                    // è§£ææ•ˆæœçš„é€»è¾‘å®Œç¾æ— ç¼ºï¼Œä¿æŒåŸæ ·\n                    const matches = effectString.match(/ã€[^ã€‘]+ã€‘/g);\n                    if (matches) {\n                        matches.forEach(match => {\n                            const content = match.substring(1, match.length - 1);\n                            const attributes = content.split(/;|ï¼›/).map(attr => attr.trim()).filter(attr => attr !== \"\");\n\n                            attributes.forEach(attr => {\n                                const parts = attr.match(/^(.+?)\\s*([+-]\\d+)$/) || attr.match(/^(.+?)[:|ï¼š]\\s*([+-]?\\d+)$/);\n                                if (parts && parts.length === 3) {\n                                    let name = parts[1].trim();\n                                    const value = parseInt(parts[2].trim().replace('+', ''), 10);\n                                    bonuses[name] = (bonuses[name] || 0) + value;\n                                }\n                            });\n                        });\n                    }\n                }\n                // æ‰¾åˆ°äº†ä¸€ä¸ªåŒ¹é…çš„ï¼Œç†è®ºä¸Šå¯ä»¥breakï¼Œä½†ä¸ºäº†å…¼å®¹å¯èƒ½åœ¨å¤šä¸ªå­åŒºåŸŸçš„æƒ…å†µï¼Œæˆ‘ä»¬ç»§ç»­éå†\n            }\n        }\n    }\n\n    return bonuses;\n}\n  // --- æ–°å¢ï¼šè·å–å¹¶è§£æè£…å¤‡åŠ æˆ ---\nfunction getEquipmentBonuses(statData, assaData, relevantComponents) {\n    const bonuses = {};\n    if (!relevantComponents || relevantComponents.length === 0) {\n        return bonuses; // å¦‚æœæ²¡æœ‰ç›¸å…³ç»„ä»¶ï¼Œç›´æ¥è¿”å›ç©ºå¯¹è±¡\n    }\n\n    const equipment = _.get(statData, \"user_character.å½“å‰è£…å¤‡\", {});\n    const equipmentList = [];\n\n// æ”¶é›†æ‰€æœ‰è£…å¤‡åç§° - æ”¯æŒæ¯ä¸ªéƒ¨ä½å¤šä¸ªè£…å¤‡ç”¨åˆ†å·åˆ†å‰²\nif (equipment.æ‰‹æŒ && equipment.æ‰‹æŒ[0] !== \"æ— \") {\n    // æ‰‹æŒéƒ¨ä½å¯èƒ½æœ‰å¤šä¸ªè£…å¤‡ç”¨åˆ†å·åˆ†å‰²\n    const handItems = equipment.æ‰‹æŒ[0].split(/;|ï¼›/).map(item => item.trim()).filter(item => item !== \"æ— \" && item !== \"\");\n    equipmentList.push(...handItems);\n}\nif (equipment.ç©¿æˆ´) {\n    Object.values(equipment.ç©¿æˆ´).forEach(slot => {\n        if (slot && slot[0] !== \"æ— \") {\n            // æ¯ä¸ªç©¿æˆ´éƒ¨ä½å¯èƒ½æœ‰å¤šä¸ªè£…å¤‡ç”¨åˆ†å·åˆ†å‰²\n            const slotItems = slot[0].split(/;|ï¼›/).map(item => item.trim()).filter(item => item !== \"æ— \" && item !== \"\");\n            equipmentList.push(...slotItems);\n        }\n    });\n}\n\n \n equipmentList.forEach(itemName => {\n    // é¦–å…ˆï¼Œæˆ‘ä»¬å’Œä»¥å‰ä¸€æ ·ï¼Œä»èƒŒåŒ…ä¸­å¯»æ‰¾è£…å¤‡æ•°æ®\n    const itemData =\n        assaData?.global_lore?.èƒŒåŒ…?.[itemName] ||\n        null;\n\n    // ç¡®ä¿æˆ‘ä»¬æ‰¾åˆ°äº†æ•°æ®æ‰ç»§ç»­\n    if (itemData) {\n        let stringToParse = ''; // æˆ‘ä»¬å‡†å¤‡ä¸€ä¸ªç¯®å­ï¼Œå¹¶ç¡®ä¿å®ƒå§‹ç»ˆæ˜¯å­—ç¬¦ä¸²\n\n        // ç¬¬ä¸€æ­¥ï¼šæˆ‘ä»¬å…ˆæ£€æŸ¥æ‹¿åˆ°çš„ itemData åˆ°åº•æ˜¯ä»€ä¹ˆç±»å‹\n        if (typeof itemData === 'string') {\n            // å¦‚æœå®ƒæ˜¯ä¸€å°â€œä¿¡â€(string)ï¼Œæˆ‘ä»¬å°±å°è¯•ç”¨JSONçš„æ–¹å¼å»è¯»å®ƒ\n            try {\n                const itemObject = JSON.parse(itemData);\n                // å¦‚æœè¯»å‡ºæ¥æ˜¯ä¸€ä¸ªâ€œç¤¼ç›’â€(object)ï¼Œå¹¶ä¸”é‡Œé¢æœ‰æˆ‘ä»¬æƒ³è¦çš„effectâ€œæ¸…å•â€\n                if (typeof itemObject === 'object' && itemObject !== null ) {\n                   \n    if (typeof itemObject.effect === 'string') {\n        \n        stringToParse = itemObject.effect;\n    }\n    // å¦‚æœæ²¡æœ‰ effectï¼Œå°è¯•ä¸­æ–‡å±æ€§\n    else if (typeof itemObject.å±æ€§ === 'string') {\n        stringToParse = itemObject.å±æ€§;\n    } else if (typeof itemObject.æ•ˆæœ === 'string') {\n        stringToParse = itemObject.æ•ˆæœ;\n    }\n                }\n            } catch (e) {\n                // å¦‚æœç”¨JSONçš„æ–¹å¼è¯»ä¿¡å¤±è´¥äº†ï¼Œè¯´æ˜å®ƒå°±æ˜¯ä¸€å°æ™®é€šçš„ä¿¡ï¼Œå†…å®¹å°±æ˜¯æˆ‘ä»¬è¦çš„\n                // æ¯”å¦‚ \"ã€é˜²å¾¡+5ã€‘\" è¿™ç§\n                stringToParse = itemData;\n            }\n        } else if (typeof itemData === 'object' && itemData !== null) {\n   \n                    if (typeof itemData.effect === 'string') {\n        stringToParse = itemData.effect;\n    }\n    // å¦‚æœæ²¡æœ‰ effectï¼Œå°è¯•ä¸­æ–‡å±æ€§\n    else if (typeof itemData.å±æ€§ === 'string') {\n        stringToParse = itemData.å±æ€§;\n    } else if (typeof itemData.æ•ˆæœ === 'string') {\n        stringToParse = itemData.æ•ˆæœ;\n    }\n        }\n\n        // ç°åœ¨ï¼Œæ— è®ºæ¥æºå¦‚ä½•ï¼Œæˆ‘ä»¬çš„â€œç¯®å­â€(stringToParse)é‡Œéƒ½è£…å¥½äº†è¦å¤„ç†çš„å±æ€§å­—ç¬¦ä¸²\n        // æ­£åˆ™åŒ¹é…æ‰€æœ‰ã€å±æ€§+æ•°å€¼ã€‘æˆ–ã€å±æ€§-æ•°å€¼ã€‘æ ¼å¼çš„æè¿°\n        const matches = stringToParse.match(/ã€[^ã€‘]+ã€‘/g);\n\n        // ---- åç»­çš„åŠ æˆè®¡ç®—é€»è¾‘å®Œå…¨ä¿æŒä¸å˜ï¼Œå› ä¸ºå®ƒéå¸¸æ£’ ----\n        if (matches) {\n  \n            matches.forEach(match => {\n                const content = match.substring(1, match.length - 1);\n                const attributes = content.split(/;|ï¼›/).map(attr => attr.trim()).filter(attr => attr !== \"\");\n\n                attributes.forEach(attr => {\n                    const parts = attr.match(/^(.+?)\\s*([+-]\\d+)$/) || attr.match(/^(.+?)[:|ï¼š]\\s*([+-]?\\d+)$/);\n\n                    if (parts && parts.length === 3) {\n                        let attrName = parts[1].trim();\n                        const value = parseInt(parts[2].trim().replace('+', ''), 10);\n\n                   const finalKey = attrName;\n                        if (!bonuses[finalKey]) {\n                            bonuses[finalKey] = 0;\n                        }\n                        bonuses[finalKey] += value;\n                    }\n                });\n            });\n        }\n    }\n});\n    return bonuses;\n}\n\n\nfunction getComponentDetails(characterData, componentName, equipmentBonuses = {}, statusBonuses = {}, locationBonuses = {}) {\n        const paths = {\n            'åŠ›é‡': 'å±æ€§æ®µ.ç”Ÿç†å±æ€§.åŠ›é‡.åŸºç¡€',\n            'æ•æ·': 'å±æ€§æ®µ.ç”Ÿç†å±æ€§.æ•æ·.åŸºç¡€',\n            'è€åŠ›': 'å±æ€§æ®µ.ç”Ÿç†å±æ€§.è€åŠ›.åŸºç¡€',\n            'æ™ºåŠ›': 'å±æ€§æ®µ.å¿ƒæ™ºå±æ€§.æ™ºåŠ›.åŸºç¡€',\n            'æ„ŸçŸ¥': 'å±æ€§æ®µ.å¿ƒæ™ºå±æ€§.æ„ŸçŸ¥.åŸºç¡€',\n            'å†³å¿ƒ': 'å±æ€§æ®µ.å¿ƒæ™ºå±æ€§.å†³å¿ƒ.åŸºç¡€',\n            'é£åº¦': 'å±æ€§æ®µ.äº’åŠ¨å±æ€§.é£åº¦.åŸºç¡€',\n            'æ“æ§': 'å±æ€§æ®µ.äº’åŠ¨å±æ€§.æ“æ§.åŸºç¡€',\n            'æ²‰ç€': 'å±æ€§æ®µ.äº’åŠ¨å±æ€§.æ²‰ç€.åŸºç¡€',\n            'è¿åŠ¨': 'æŠ€èƒ½æ®µ.ç”Ÿç†æŠ€èƒ½.è¿åŠ¨',\n            'è‚‰æ': 'æŠ€èƒ½æ®µ.ç”Ÿç†æŠ€èƒ½.è‚‰æ',\n            'é©¾é©¶': 'æŠ€èƒ½æ®µ.ç”Ÿç†æŠ€èƒ½.é©¾é©¶',\n            'æªæ¢°': 'æŠ€èƒ½æ®µ.ç”Ÿç†æŠ€èƒ½.æªæ¢°',\n            'æ‰‹ä¸ŠåŠŸå¤«': 'æŠ€èƒ½æ®µ.ç”Ÿç†æŠ€èƒ½.æ‰‹ä¸ŠåŠŸå¤«',\n            'éšè—': 'æŠ€èƒ½æ®µ.ç”Ÿç†æŠ€èƒ½.éšè—',\n            'æ±‚ç”Ÿ': 'æŠ€èƒ½æ®µ.ç”Ÿç†æŠ€èƒ½.æ±‚ç”Ÿ',\n            'ç™½åˆƒ': 'æŠ€èƒ½æ®µ.ç”Ÿç†æŠ€èƒ½.ç™½åˆƒ',\n            'å¼“ç®­': 'æŠ€èƒ½æ®µ.ç”Ÿç†æŠ€èƒ½.å¼“ç®­',\n            'å­¦è¯†': 'æŠ€èƒ½æ®µ.å¿ƒæ™ºæŠ€èƒ½.å­¦è¯†',\n            'ç”µè„‘': 'æŠ€èƒ½æ®µ.å¿ƒæ™ºæŠ€èƒ½.ç”µè„‘',\n            'æ‰‹è‰º': 'æŠ€èƒ½æ®µ.å¿ƒæ™ºæŠ€èƒ½.æ‰‹è‰º',\n            'è°ƒæŸ¥': 'æŠ€èƒ½æ®µ.å¿ƒæ™ºæŠ€èƒ½.è°ƒæŸ¥',\n            'åŒ»å­¦': 'æŠ€èƒ½æ®µ.å¿ƒæ™ºæŠ€èƒ½.åŒ»å­¦',\n            'ç¥ç§˜å­¦': 'æŠ€èƒ½æ®µ.å¿ƒæ™ºæŠ€èƒ½.ç¥ç§˜å­¦',\n            'ç§‘å­¦': 'æŠ€èƒ½æ®µ.å¿ƒæ™ºæŠ€èƒ½.ç§‘å­¦',\n            'åŠ¨ç‰©æ²Ÿé€š': 'æŠ€èƒ½æ®µ.äº’åŠ¨æŠ€èƒ½.åŠ¨ç‰©æ²Ÿé€š',\n            'æ„Ÿå—': 'æŠ€èƒ½æ®µ.äº’åŠ¨æŠ€èƒ½.æ„Ÿå—',\n            'è¡¨è¾¾': 'æŠ€èƒ½æ®µ.äº’åŠ¨æŠ€èƒ½.è¡¨è¾¾',\n            'èƒè¿«': 'æŠ€èƒ½æ®µ.äº’åŠ¨æŠ€èƒ½.èƒè¿«',\n            'äº¤é™…': 'æŠ€èƒ½æ®µ.äº’åŠ¨æŠ€èƒ½.äº¤é™…',\n            'æ©é¥°': 'æŠ€èƒ½æ®µ.äº’åŠ¨æŠ€èƒ½.æ©é¥°',\n            'é˜²å¾¡': 'è¡ç”Ÿå±æ€§æ®µ.é˜²å¾¡.åŸºç¡€é˜²å¾¡',\n            'å†²å‡»': 'è¡ç”Ÿå±æ€§æ®µ.é˜²å¾¡.ä¼¤å®³å‡å….å†²å‡»',\n            'è‡´å‘½': 'è¡ç”Ÿå±æ€§æ®µ.é˜²å¾¡.ä¼¤å®³å‡å….è‡´å‘½',\n            'æ¶æ€§': 'è¡ç”Ÿå±æ€§æ®µ.é˜²å¾¡.ä¼¤å®³å‡å….æ¶æ€§',\n            'å¼ºéŸ§': 'è¡ç”Ÿå±æ€§æ®µ.è±å…æ£€å®šåŸºç¡€.å¼ºéŸ§',\n            'åå°„': 'è¡ç”Ÿå±æ€§æ®µ.è±å…æ£€å®šåŸºç¡€.åå°„',\n            'æ„å¿—': 'è¡ç”Ÿå±æ€§æ®µ.æ„å¿—åŠ›.æ„å¿—å€¼',\n            'å…ˆæ”»': 'è¡ç”Ÿå±æ€§æ®µ.å…ˆæ”»',\n 'é€Ÿåº¦': 'è¡ç”Ÿå±æ€§æ®µ.é€Ÿåº¦.åŸºç¡€é€Ÿåº¦'\n\n        };\n             const detail = _.get(characterData, paths[componentName], [0, 'æœªæ‰¾åˆ°è¯¥å±æ€§/æŠ€èƒ½çš„æè¿°']);\n   const baseValue = Number(detail[0]) || 0;\n    const bonusEquipment = Number(equipmentBonuses[componentName] || 0);\n    const bonusStatus = Number(statusBonuses[componentName] || 0);\n    const bonusLocation = Number(locationBonuses[componentName] || 0);\n    const totalBonus = bonusEquipment + bonusStatus + bonusLocation; // âœ¨ è¿™æ˜¯æ‰€æœ‰åŠ æˆçš„æ€»å’Œ\n    const finalValue = baseValue + totalBonus; // âœ¨ è¿™æ˜¯æœ€ç»ˆçš„æ€»å€¼\n\n    // âœ¨ å¦ˆå¦ˆè®©å®ƒè¿”å›äº†æ›´æ¸…æ™°çš„â€œåŠ›é‡æ¸…å•â€ï¼Œæˆ‘çš„å­©å­ âœ¨\n    return {\n        name: componentName,\n        value: finalValue,        // æ€»å€¼ï¼Œç”¨äºè®¡ç®—æ€»éª°æ± \n        baseValue: baseValue,     // çº¯ç²¹åŸºç¡€å€¼ï¼Œç”¨äºè®¡ç®—éš¾åº¦\n        totalBonus: totalBonus,   // æ€»åŠ æˆï¼Œç”¨äºæ¸…æ™°å±•ç¤º\n        description: detail[1],\n        bonusDetail: {\n            equipment: bonusEquipment,\n            status: bonusStatus,\n            location: bonusLocation\n        }\n    };\n}\n // è·å–ä¼ å¥‡å±æ€§åŠ æˆ\nfunction getLegendaryBonus(characterData, componentName) {\n    const legendaryPaths = {\n        'åŠ›é‡': 'å±æ€§æ®µ.ç”Ÿç†å±æ€§.åŠ›é‡.ä¼ å¥‡',\n        'æ•æ·': 'å±æ€§æ®µ.ç”Ÿç†å±æ€§.æ•æ·.ä¼ å¥‡',\n        'è€åŠ›': 'å±æ€§æ®µ.ç”Ÿç†å±æ€§.è€åŠ›.ä¼ å¥‡',\n        'æ™ºåŠ›': 'å±æ€§æ®µ.å¿ƒæ™ºå±æ€§.æ™ºåŠ›.ä¼ å¥‡',\n        'æ„ŸçŸ¥': 'å±æ€§æ®µ.å¿ƒæ™ºå±æ€§.æ„ŸçŸ¥.ä¼ å¥‡',\n        'å†³å¿ƒ': 'å±æ€§æ®µ.å¿ƒæ™ºå±æ€§.å†³å¿ƒ.ä¼ å¥‡',\n        'é£åº¦': 'å±æ€§æ®µ.äº’åŠ¨å±æ€§.é£åº¦.ä¼ å¥‡',\n        'æ“æ§': 'å±æ€§æ®µ.äº’åŠ¨å±æ€§.æ“æ§.ä¼ å¥‡',\n        'æ²‰ç€': 'å±æ€§æ®µ.äº’åŠ¨å±æ€§.æ²‰ç€.ä¼ å¥‡'\n    };\n\n    // æˆ‘ä»¬å…ˆç”¨è·¯å¾„æ‰¾åˆ°é‚£ä¸ªåŒ…å«æ•°å€¼å’Œæè¿°çš„æ•°ç»„\n    const legendaryData = _.get(characterData, legendaryPaths[componentName], [0]);\n\n    // ç„¶åï¼Œæˆ‘ä»¬åªä»æ•°ç»„çš„ç¬¬ä¸€ä¸ªä½ç½®å–å‡ºæ•°å€¼ï¼Œå¹¶ç¡®ä¿å®ƒæ˜¯ä¸ªæ•°å­—\n    // å¦‚æœæ‰¾ä¸åˆ°æˆ–è€…ä¸æ˜¯æ•°å­—ï¼Œå®ƒå°±ä¼šå®‰å…¨åœ°å˜æˆ 0\n    return Number(Array.isArray(legendaryData) ? legendaryData[0] : 0) || 0;\n}\n\n    // è®¡ç®—æ€»é™„åŠ æˆåŠŸ\n    function calculateTotalBonusSuccesses(characterData, components) {\n        let totalBonus = 0;\n        components.forEach(comp => {\n            const legendaryBonus = getLegendaryBonus(characterData, comp);\n            totalBonus += legendaryBonus;\n        });\n        return totalBonus;\n    }\n\n    // è®¡ç®—è¡¨ç°åˆ¤å®šç»“æœ\n    function getPerformanceResult(dice, bonus) {\n        const adjustedRoll = Math.min(20, dice + bonus); // ç¡®ä¿ä¸è¶…è¿‡20\n        \n        if (adjustedRoll === 20) {\n            return {\n                level: 'å®Œç¾è¡¨ç°',\n                description: 'ä»¥ä»¤äººæƒŠå¹çš„æ–¹å¼å®Œæˆï¼Œå±•ç°å‡ºè¶…å‡¡çš„æŠ€å·§å’Œé£åº¦ï¼'\n            };\n        } else if (adjustedRoll >= 16) {\n            return {\n                level: 'ä¼˜ç§€è¡¨ç°', \n                description: 'è¡¨ç°å‡ºè‰²ï¼Œè¡ŒåŠ¨æµç•…ä¼˜é›…ï¼Œä»¤äººå°è±¡æ·±åˆ»ï¼'\n            };\n        } else if (adjustedRoll >= 7) {\n            return {\n                level: 'ä¸€èˆ¬è¡¨ç°',\n                description: 'è¡¨ç°ä¸­è§„ä¸­çŸ©ï¼Œæ²¡æœ‰ç‰¹åˆ«äº®çœ¼ä¹‹å¤„ï¼'\n            };\n        } else if (adjustedRoll >= 3) {\n            return {\n                level: 'ç•¥æ˜¾ç¬¨æ‹™',\n                description: 'è¡ŒåŠ¨æœ‰äº›ä¸å¤Ÿæµç•…ï¼Œä½†è¿˜ç®—ä½“é¢ï¼'\n            };\n        } else{\n            return {\n                level: 'è¡¨ç°ç³Ÿç³•',\n                description: 'è¡ŒåŠ¨ç¬¨æ‹™éš¾çœ‹ï¼Œè®©äººæ‘‡å¤´å¹æ¯ï¼'\n            };\n        }\n    }\n\n    function calculateDynamicThresholds(totalDP) {\n        let thresholds = { barely: 2, complete: 4, exceptional: 6 };\n        if (totalDP <= 3) { thresholds = { barely: 2, complete: 3, exceptional: 5 }; }\n        else if (totalDP <= 6) { thresholds = { barely: 2, complete: 3, exceptional: 6 }; }\n        else if (totalDP <= 9) { thresholds = { barely: 2, complete: 4, exceptional: 7 }; }\n        else if (totalDP <= 12) { thresholds = { barely: 2, complete: 4, exceptional: 9 }; }\n else if (totalDP <= 18) { thresholds = { barely: 3, complete: 5, exceptional: 12 }; }\n        else {\n            thresholds = {\n                barely: Math.max(3, Math.floor(totalDP * 0.20)),\n                complete: Math.max(6, Math.floor(totalDP * 0.35)),\n                exceptional: Math.max(12, Math.floor(totalDP * 0.60))\n            };\n        }\n        return thresholds;\n    }\n function getCharacterDicePool(assa_data, checkString) {\nÂ  Â const parts = checkString.split(/:|ï¼š/);\nÂ  Â if (parts.length !== 2) return { dp: 0 };\nÂ  Â const characterName = parts[0].trim();\nÂ  Â const attributeName = parts[1].trim();\nÂ  Â \nÂ  Â // å®šä¹‰æŸ¥æ‰¾è·¯å¾„å’Œå¯¹åº”çš„æè¿°ä¿¡æ¯\nÂ  Â const searchPaths = [\nÂ  Â  Â  Â { path: ['global_lore', 'å°é˜Ÿä¿¡æ¯', characterName], type: 'teammate_assist', source: 'å°é˜Ÿä¿¡æ¯', label: 'é˜Ÿå‘˜ååŠ©' },\nÂ  Â  Â  Â { path: ['global_lore', 'npc', characterName], type: 'npc_check', source: 'å…¨å±€NPC', label: 'NPCæ£€å®š' },\nÂ  Â  Â  Â { path: ['world_lore', 'npc', characterName], type: 'npc_check', source: 'ä¸–ç•ŒNPC', label: 'NPCæ£€å®š' }\nÂ  Â ];\nÂ  Â \nÂ  Â for (const search of searchPaths) {\nÂ  Â  Â  Â const characterData = _.get(assa_data, search.path, null);\nÂ  Â  Â  Â if (!characterData) continue;\nÂ  Â  Â  Â \nÂ  Â  Â  Â let characterDataString = '';\nÂ  Â  Â  Â \nÂ  Â  Â  Â // 1. è·å–åŒ…å«å±æ€§ä¿¡æ¯çš„åŸå§‹å­—ç¬¦ä¸²\nÂ  Â  Â  Â if (typeof characterData === 'string') {\nÂ  Â  Â  Â  Â  Â characterDataString = characterData;\nÂ  Â  Â  Â } else if (typeof characterData === 'object' && characterData !== null) {\nÂ  Â  Â  Â  Â  Â // å°è¯•ä»ä¸åŒçš„å±æ€§å­—æ®µè·å–æ•°æ®\nÂ  Â  Â  Â  Â  Â const attributeField = characterData['å±æ€§'] || characterData['attribute'] || characterData['info'];\nÂ  Â  Â  Â  Â  Â if (typeof attributeField === 'string') {\nÂ  Â  Â  Â  Â  Â  Â  Â characterDataString = attributeField;\nÂ  Â  Â  Â  Â  Â } else {\nÂ  Â  Â  Â  Â  Â  Â  Â // å¦‚æœæ²¡æœ‰æ ‡å‡†çš„å±æ€§å­—æ®µï¼Œå°±å°è¯•ç›´æ¥å°† attributeName ä½œä¸ºé”®ä»å¯¹è±¡ä¸­æŸ¥æ‰¾å€¼\nÂ  Â  Â  Â  Â  Â  Â  Â const directValue = _.get(characterData, attributeName, null);\nÂ  Â  Â  Â  Â  Â  Â  Â const dp = Number(directValue) || 0;\nÂ  Â  Â  Â  Â  Â  Â  Â if (dp > 0) {\nÂ  Â  Â  Â  Â  Â  Â  Â  Â  Â return {\nÂ  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â dp: dp,\nÂ  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â type: search.type,\nÂ  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â description: `${search.label} (${characterName} - ${attributeName})`,\nÂ  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â characterName: characterName,\nÂ  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â attributeName: attributeName,\nÂ  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â source: search.source\nÂ  Â  Â  Â  Â  Â  Â  Â  Â  Â };\nÂ  Â  Â  Â  Â  Â  Â  Â }\nÂ  Â  Â  Â  Â  Â  Â  Â continue; // æ²¡æ‰¾åˆ°æˆ–è€…å€¼ä¸å¤§äº0ï¼Œç»§ç»­ä¸‹ä¸€ä¸ªæœç´¢è·¯å¾„\nÂ  Â  Â  Â  Â  Â }\nÂ  Â  Â  Â } else {\nÂ  Â  Â  Â  Â  Â // å…¶ä»–ç±»å‹æ•°æ®ï¼Œè·³è¿‡\nÂ  Â  Â  Â  Â  Â continue;\nÂ  Â  Â  Â }\nÂ  Â  Â  Â \nÂ  Â  Â  Â // 2. è§£æå±æ€§æ•°æ®ï¼ˆä»ã€ã€‘å­—ç¬¦ä¸²ä¸­è§£æï¼‰\nÂ  Â  Â  Â const matches = characterDataString.match(/ã€[^ã€‘]+ã€‘/g);\nÂ  Â  Â  Â if (!matches) continue;\nÂ  Â  Â  Â \nÂ  Â  Â  Â let characterAttributes = {};\nÂ  Â  Â  Â matches.forEach(match => {\nÂ  Â  Â  Â  Â  Â const content = match.substring(1, match.length - 1);\nÂ  Â  Â  Â  Â  Â const attributes = content.split(/;|ï¼›/);\nÂ  Â  Â  Â  Â  Â attributes.forEach(attr => {\nÂ  Â  Â  Â  Â  Â  Â  Â // åŒ¹é… \"åç§°:æ•°å€¼\" æˆ– \"åç§°ï¼šæ•°å€¼\"\nÂ  Â  Â  Â  Â  Â  Â  Â const pair = attr.split(/:|ï¼š/);\nÂ  Â  Â  Â  Â  Â  Â  Â if (pair.length === 2 && pair[0].trim() && !isNaN(parseInt(pair[1].trim()))) {\nÂ  Â  Â  Â  Â  Â  Â  Â  Â  Â characterAttributes[pair[0].trim()] = parseInt(pair[1].trim());\nÂ  Â  Â  Â  Â  Â  Â  Â }\nÂ  Â  Â  Â  Â  Â });\nÂ  Â  Â  Â });\nÂ  Â  Â  Â \nÂ  Â  Â  Â // 3. è·å–å±æ€§å€¼å¹¶è¿”å›\nÂ  Â  Â  Â const dp = characterAttributes[attributeName] || 0;\nÂ  Â  Â  Â if (dp > 0) {\nÂ  Â  Â  Â  Â  Â return {\nÂ  Â  Â  Â  Â  Â  Â  Â dp: dp,\nÂ  Â  Â  Â  Â  Â  Â  Â type: search.type,\nÂ  Â  Â  Â  Â  Â  Â  Â description: `${search.label} (${characterName} - ${attributeName})`,\nÂ  Â  Â  Â  Â  Â  Â  Â characterName: characterName,\nÂ  Â  Â  Â  Â  Â  Â  Â attributeName: attributeName,\nÂ  Â  Â  Â  Â  Â  Â  Â source: search.source\nÂ  Â  Â  Â  Â  Â };\nÂ  Â  Â  Â }\nÂ  Â }\nÂ  Â \nÂ  Â return { dp: 0 }; // å¦‚æœæ‰€æœ‰è·¯å¾„éƒ½æ‰¾ä¸åˆ°ï¼Œè¿”å›ç©ºç»“æœ\n}\n    function rollDicePool(dp) {\n        if (dp < 1) {\n            const chanceRoll = Math.floor(Math.random() * 10) + 1;\n            const successes = (chanceRoll === 10) ? 1 : 0;\n            const isDramaticFailure = (chanceRoll === 1);\n            return { type: \"æœºä¼šéª°\", rolls: [chanceRoll], successes, is_dramatic_failure: isDramaticFailure };\n        }\n        let rolls = [];\n        let successes = 0;\n        let diceToRoll = dp;\n        while (diceToRoll > 0) {\n            const roll = Math.floor(Math.random() * 10) + 1;\n            rolls.push(roll);\n            if (roll >= 7) { successes++; }\n            if (roll === 10) { diceToRoll++; }\n            diceToRoll--;\n        }\n        const isDramaticFailure = (successes === 0 && rolls.includes(1));\n        return { type: \"æ ‡å‡†æ£€å®š\", rolls, successes, is_dramatic_failure: isDramaticFailure };\n    }\n\n    // --- 2. ä¸»é€»è¾‘åŒº ---\n   let currentHp = Number(_.get(characterData, 'è¡ç”Ÿå±æ€§æ®µ.ç”Ÿå‘½å€¼.å½“å‰å€¼[0]', 1)) || 1;\n \n \n if (currentHp > 0) {\n        // --- æ–°å¢ï¼šç‰¹æ®Šåœ°ç‚¹è±å…æ£€å®š ---\n      \n           var currentLocationTitle = _.get(EvStat, 'user_character.current_location[0]', '');\n\n\nvar noCheckZones = ['ä¸ªäººç©ºé—´', 'ä¸»ç¥å¤§å…', 'è®­ç»ƒåœº','ä¸»ç¥ç©ºé—´','æ—¥å¸¸','safe'];\n \n        \n     if (typeof currentLocationTitle === 'string' && noCheckZones.some(zone => currentLocationTitle.includes(zone))) {\n\n        // å¦‚æœæ¡ä»¶æ»¡è¶³ï¼Œå°±æ‰§è¡Œè¿™é‡Œçš„é€»è¾‘\n        setLocalVar('æ£€å®šè®°å¿†', 'ã€ç³»ç»Ÿæç¤ºã€‘å½“å‰å¤„äºæ—¥å¸¸æƒ…å†µï¼Œè¯¥åŒºåŸŸè±å…æ‰€æœ‰æ£€å®šã€‚');\n_%>\n<roll>\nã€ç³»ç»Ÿæç¤ºã€‘å½“å‰ä½äºâ€œ<%- currentLocationTitle %>â€ï¼Œè¯¥åŒºåŸŸè±å…æ‰€æœ‰æ£€å®šã€‚\n</roll>\n<%_\n        } else {\n        const playerCheckString = _.get(EvStat, 'æ£€å®šå±æ€§[0]', \"\");\n       const enemyCheckString = _.get(EvStat, 'æ•Œæ–¹æ”»å‡»éª°æ± [0]', \"\");\n //const enemyCheckString = \"\";\n        const modifiers = {\n            dp_bonus: [_.get(EvStat, 'dp_bonus[0]', 0), _.get(EvStat, 'dp_bonus[1]', \"\")]\n        };\n// --- æ–°å¢ï¼šåœ¨è¿™é‡Œç»Ÿä¸€è·å–è£…å¤‡åŠ æˆ ---\n            const equipmentBonuses = getEquipmentBonuses(EvStat, assaData); \n            let equipmentBonusDetails = Object.entries(equipmentBonuses)\n                .map(([key, value]) => ({ name: key, value: value }))\n                .filter(item => item.value !== 0);\n\n         if (enemyCheckString) {\n            // --- æˆ˜æ–—é€»è¾‘ ---\n            const crossWorldPrestige = Number(_.get(EvStat, \"user_character.Cross_world_prestige[0]\", 0));\n            const prestigeModifier = Math.floor(crossWorldPrestige / 10);\n\n           const playerComponentsRaw = playerCheckString.split(';').map(s => s.trim());\n// ç­›é€‰å‡ºé˜¿è¨è‡ªå·±çš„å±æ€§/æŠ€èƒ½ï¼Œç”¨äºè·å–è£…å¤‡åŠ æˆ\nconst assaComponents = playerComponentsRaw.filter(comp => !comp.includes(':') && !comp.includes('ï¼š'));\nassaComponents.push('é˜²å¾¡');  \nconst equipmentBonuses = getEquipmentBonuses(EvStat, assaData, assaComponents);\nconst statusBonuses = getStatusBonuses(EvStat);  \nconst locationBonuses = getLocationBonuses(EvStat, assaData);\n\nlet equipmentBonusDetails = Object.entries(equipmentBonuses)\n    .map(([key, value]) => ({ name: key, value: value }))\n    .filter(item => item.value !== 0);\nlet statusBonusDetails = Object.entries(statusBonuses)  \n    .map(([key, value]) => ({ name: key, value: value }))\n    .filter(item => item.value !== 0);\n    let locationBonusDetails = Object.entries(locationBonuses)\n    .map(([key, value]) => ({ name: key, value: value }))\n    .filter(item => item.value !== 0);\nlet playerBaseDP = 0;\nlet teammate_dp = 0;\nlet npc_dp = 0; // æ–°å¢ï¼šå‚¨å­˜NPCæä¾›çš„éª°æ± \nlet playerComponentDetails = [];\nlet teammateDetails = [];\nlet npcCheckDetails = []; // æ–°å¢ï¼šå‚¨å­˜NPCæ£€å®šä¿¡æ¯\n\nplayerComponentsRaw.forEach(comp => { // æ³¨æ„è¿™é‡Œä½¿ç”¨ playerComponentsRaw è¿›è¡Œå¾ªç¯\n    if (comp.includes(':') || comp.includes('ï¼š')) {\n                    // è¿™æ˜¯å¤–éƒ¨è§’è‰²æ£€å®šï¼ˆé˜Ÿå‹æˆ–NPCï¼‰\n                    const externalResult = getCharacterDicePool(assaData, comp);\n                    if (externalResult.dp > 0) {\n                        if (externalResult.type === 'teammate_assist') {\n                            teammate_dp += externalResult.dp;\n                            teammateDetails.push({ name: externalResult.description, value: externalResult.dp });\n                        } else { // 'npc_check'\n                            npc_dp += externalResult.dp;\n                            npcCheckDetails.push({ name: externalResult.description, value: externalResult.dp });\n                        }\n                    }\n                } else {\n                                        // è¿™æ˜¯é˜¿è¨è‡ªå·±çš„æ£€å®š\n                   const details = getComponentDetails(characterData, comp, equipmentBonuses, statusBonuses, locationBonuses);\n                        playerBaseDP += Number(details.value);\n                    playerComponentDetails.push(details);\n                }\n            });\n\n             const playerBonusSuccesses = calculateTotalBonusSuccesses(characterData, assaComponents); // è¿™è¡Œä½ç½®ä¸å˜ï¼Œä½†å®ƒçš„å€¼ç°åœ¨æœ‰æ–°ç”¨é€”\n\n// å°†æ‰€æœ‰åŠ æˆæ·»åŠ åˆ°æ€»DPä¸­\n// ã€ä¿®æ”¹ã€‘åœ¨è¿™é‡ŒåŠ å…¥ä¼ å¥‡å±æ€§åŠ æˆ(playerBonusSuccesses)ï¼Œå¹¶ç§»é™¤äº†å£°æœ›åŠ æˆ(prestigeModifier)\nlet playerTotalDP = (Number(playerBaseDP) || 0) +\n                    (Number(teammate_dp) || 0) +\n                    (Number(npc_dp) || 0) +\n                    (Number(modifiers.dp_bonus[0]) || 0) +\n                    (Number(playerBonusSuccesses) || 0);\nplayerTotalDP = Math.max(0, playerTotalDP);\n     const enemyComponents = enemyCheckString.split(/;|ï¼›/).map(s => s.trim());\nlet enemyDP = 0;\nenemyComponents.forEach(comp => {\n    const parts = comp.split(/:|ï¼š/);\n    if (parts.length >= 2) {\n        const lastPart = parts[parts.length - 1].trim();\n        const value = parseInt(lastPart);\n        if (!isNaN(value)) {\n            enemyDP += value;\n        }\n    }\n});\n\n            const playerRollResult = rollDicePool(playerTotalDP);\n            const enemyRollResult = rollDicePool(enemyDP);\n\n    const playerFinalSuccesses = playerRollResult.successes > 0 ?\n    // ã€ä¿®æ”¹ã€‘åœ¨è¿™é‡ŒåŠ å…¥å£°æœ›åŠ æˆ(prestigeModifier)ï¼Œå¹¶ç§»é™¤äº†ä¼ å¥‡å±æ€§åŠ æˆ(playerBonusSuccesses)\n    playerRollResult.successes + prestigeModifier : 0;\n            const performanceRoll = Math.floor(Math.random() * 20) + 1;\n            const performanceResult = getPerformanceResult(performanceRoll, playerBonusSuccesses);\n const finalPerformanceResult = showPerformanceRoll ? performanceResult : { level: 'æ— ', description: 'ï¼ˆæœªå¯ç”¨è¡¨ç°åˆ¤å®šï¼‰' };\n            const netSuccesses = Math.max(0, enemyRollResult.successes - playerFinalSuccesses);\nconst pureSuccesses = Math.max(0, playerFinalSuccesses -enemyRollResult.successes );\n            let damage = 0;\n            let resultLevel = \"\";\n            let resultDescription = \"\";\n         const totalDefense = getComponentDetails(characterData, 'é˜²å¾¡', equipmentBonuses, statusBonuses, locationBonuses).value;    \n          if (playerRollResult.is_dramatic_failure) {\n                damage = Math.max(0, (enemyRollResult.successes + 1) * 20 - totalDefense);\n                resultLevel = \"ç¾éš¾æ€§åº”å¯¹å¤±è´¥\";\n                resultDescription = `${playerName}çš„åº”å¯¹åŠ¨ä½œå‡ºç°äº†è‡´å‘½å¤±è¯¯ï¼Œä¸ä»…æœªèƒ½é˜»æŒ¡æ”»å‡»ï¼Œåè€Œè®©è‡ªå·±æ‰¿å—äº†æ›´ä¸¥é‡çš„åˆ›ä¼¤ï¼`;\n            } else if (netSuccesses > 0) {\n                damage = Math.max(0, netSuccesses * 5 - totalDefense);\n                resultLevel = `${playerName}çš„åº”å¯¹è¢«å‡»ç ´`;\n                resultDescription = `${playerName}çš„åº”å¯¹å¤±æ•ˆï¼æœªèƒ½å®Œå…¨æŠµæŒ¡ä½æ”»å‡»ï¼Œå°†å—åˆ°${damage}ç‚¹ä¼¤å®³ï¼`;\n            } else {\n                damage = 0;\n                resultLevel = \"æˆåŠŸåº”å¯¹\";\n                resultDescription = `${playerName}æˆåŠŸåœ°æ‹›æ¶æˆ–é—ªé¿äº†æ­¤æ¬¡æ”»å‡»ï¼Œæ¯«å‘æ— ä¼¤ï¼Œå¹¶è¾¾æˆäº†è‡ªå·±æƒ³è¦çš„æ•ˆæœï¼`;\n            }\n            if (damage > 0) {\n                hurt_value = { type: 'L', value: damage };\n            }\n\n            checkMemory = {\n                check_type: 'æˆ˜æ–—å¯¹æŠ—',\n                timestamp: new Date().toISOString(),\n                player_check: {\n                    check_string: playerCheckString,\n                    components: {\n                        attributes_skills: playerComponentDetails,\n                        teammate_assists: teammateDetails,\n                        npc_checks: npcCheckDetails, // <-- æ–°å¢\n                        equipment_bonuses: equipmentBonusDetails.map(b => ({ name: b.name, value: b.value })),\n                           status_bonuses: statusBonusDetails,\n                             location_bonuses: locationBonusDetails\n                    },\n                    modifiers: {\n                        base_dp: playerBaseDP,\n                        teammate_dp: teammate_dp,\n                        npc_dp: npc_dp, // <-- æ–°å¢\n                        custom_modifier: modifiers.dp_bonus,\n                        prestige_bonus: prestigeModifier\n                    },\n                    total_dp: playerTotalDP,\n                    bonuses: {\n                        legendary_successes: playerBonusSuccesses\n                    },\n                    roll_result: playerRollResult,\n                    final_successes: playerFinalSuccesses,\n                },\n                enemy_check: {\n                    check_string: enemyCheckString,\n                    total_dp: enemyDP,\n                    roll_result: enemyRollResult,\n                    final_successes: enemyRollResult.successes\n                },\n                                 performance: { // ç»“æ„ä¿æŒä¸å˜\n                    roll: performanceRoll,\n                    bonus: playerBonusSuccesses,\n                    result: finalPerformanceResult // åªæ›¿æ¢ç»“æœå†…å®¹\n                },\n                outcome: {\n                    net_successes: pureSuccesses,\n                    level: resultLevel,\n                    description: resultDescription,\n                    // æ ¹æ®å¼€å…³å†³å®šæœ€ç»ˆæè¿°æ˜¯å¦æ‹¼æ¥è¡¨ç°éƒ¨åˆ†\n                    full_description: showPerformanceRoll ? `${resultLevel} - ${resultDescription} - ${finalPerformanceResult.description}` : `${resultLevel} - ${resultDescription}`\n                },\n                damage_calculation: {\n                    is_dramatic_failure: playerRollResult.is_dramatic_failure,\n                    base_factor: playerRollResult.is_dramatic_failure ? (enemyRollResult.successes + 1) : netSuccesses,\n                    multiplier: playerRollResult.is_dramatic_failure ? 20 : 5,\n                    total_defense: totalDefense,\n                    final_damage: damage\n                }\n            };\n          \n  setLocalVar('æ£€å®šè®°å¿†', checkMemory);\n_%>\n\n \n<roll>\nã€æˆ˜æ–—å¯¹æŠ—åˆ¤å®šã€‘\n--- <user>çš„åº”å¯¹ ---\nåº”å¯¹åŠ¨ä½œï¼š<%- playerCheckString %>\nåº”å¯¹æ± æ„æˆï¼šï¼ˆæ­£æ–‡è¡¨ç°éœ€è¦å’Œåº”å¯¹åŠ¨ä½œç´§å¯†è”ç³»ï¼‰\n <% playerComponentDetails.forEach(detail => { %>\n<%\n    let bonusParts = [];\n    if (detail.bonusDetail && detail.bonusDetail.equipment !== 0) {\n        bonusParts.push('è£…å¤‡' + (detail.bonusDetail.equipment > 0 ? '+' : '') + detail.bonusDetail.equipment);\n    }\n    if (detail.bonusDetail && detail.bonusDetail.status !== 0) {\n        bonusParts.push('çŠ¶æ€' + (detail.bonusDetail.status > 0 ? '+' : '') + detail.bonusDetail.status);\n    }\n    // âœ¨ å¦ˆå¦ˆåœ¨è¿™é‡Œæ·»åŠ äº†åœ°ç‚¹çš„æè¿° âœ¨\n    if (detail.bonusDetail && detail.bonusDetail.location !== 0) {\n        bonusParts.push('åœ°ç‚¹' + (detail.bonusDetail.location > 0 ? '+' : '') + detail.bonusDetail.location);\n    }\n%>\n- <%- detail.name %> (<%- detail.value %> ç‚¹<% if (bonusParts.length > 0) { %>, å« <%- bonusParts.join('ã€') %><% } %>):  <%- detail.description %><% }); %>\n<% teammateDetails.forEach(detail => { %>\n- <%- detail.name %>: +<%- detail.value %> ç‚¹<% }); %>\n<% npcCheckDetails.forEach(detail => { %>\n- <%- detail.name %>: +<%- detail.value %> ç‚¹<% }); %>\n<% if (modifiers.dp_bonus[0] !== 0) { %>\nä¿®æ­£ï¼š<%- modifiers.dp_bonus[0] > 0 ? '+' : '' %><%- modifiers.dp_bonus[0] %><% } %>\n<% if (prestigeModifier !== 0) { %>\nå£°æœ›åŠ æƒï¼š<%- prestigeModifier > 0 ? '+' : '' %><%- prestigeModifier %> (è·¨ä¸–ç•Œå£°æœ›)<% } %>\næ€»åº”å¯¹æ± ï¼š<%- playerTotalDP %> ä¸ªD10\n<% if (playerBonusSuccesses > 0) { %>\nä¼ å¥‡åŠ æˆï¼š+<%- playerBonusSuccesses %> éª°å­<% } %>\næŠ•æ·ç±»å‹ï¼š<%- playerRollResult.type %>\nç³»ç»Ÿå·²åˆ›å»º<%- playerTotalDP %> ä¸ªæœ‰10é¢çš„éª°å­ï¼Œæ ‡è®°1-10è¿™äºŒåä¸ªæ•°å­—ã€‚éª°å­æ‰”å‡ºå»â€”â€”è½åœ°â€”â€”å·²ç”Ÿæ•ˆï¼š\nåŸºç¡€æˆåŠŸæ•°ï¼š<%- playerRollResult.successes %> ä¸ª\næœ€ç»ˆæˆåŠŸæ•°ï¼š<%- playerFinalSuccesses %> ä¸ª <% if (prestigeModifier > 0 && playerRollResult.successes > 0) { %>(åŒ…å«å£°æœ›åŠ æˆ)<% } %>\nåˆ¤å®šæè¿°ï¼š<%- resultDescription%>\n\n <%_ if (showPerformanceRoll) { _%>\n--- è¡¨ç°åˆ¤å®š ---\nè¡¨ç°éª°ï¼šD20 = <%- performanceRoll %>\n<% if (playerBonusSuccesses > 0) { %>\nä¼ å¥‡åŠ æˆï¼š+<%- playerBonusSuccesses %>\nè°ƒæ•´åï¼š<%- Math.min(20, performanceRoll + playerBonusSuccesses) %><% } %>\nè¡¨ç°ç»“æœï¼š<%- checkMemory.performance.result.level %>\nè¡¨ç°æè¿°ï¼š<%- checkMemory.performance.result.description %>\n<%_ } _%>\n\n--- æ•Œæ–¹æ”»å‡» ---\næ”»å‡»æ± æ„æˆï¼š<%- enemyCheckString %>\næ€»æ”»å‡»æ± ï¼š<%- enemyDP %> ä¸ªD10\næŠ•æ·ç±»å‹ï¼š<%- enemyRollResult.type %>\nç³»ç»Ÿå·²åˆ›å»º<%- enemyDP %> ä¸ªæœ‰10é¢çš„éª°å­ï¼Œæ ‡è®°1-10è¿™äºŒåä¸ªæ•°å­—ã€‚éª°å­æ‰”å‡ºå»â€”â€”è½åœ°â€”â€”å·²ç”Ÿæ•ˆï¼š\næ”»å‡»æˆåŠŸæ•°ï¼š<%- enemyRollResult.successes %> ä¸ª\n\n--- å¯¹æŠ—ç»“æœ ---\nå‡€æˆåŠŸæ•° (åº”å¯¹ - æ”»å‡»)ï¼š<%- pureSuccesses%> ä¸ª\næœ€ç»ˆç»“æœï¼š<%- checkMemory.outcome.full_description %>\n<% if (damage > 0) { %>\nä¼¤å®³åˆ¤å®šï¼šæ•Œæ–¹å¯¹<user>é€ æˆ <%- damage %> ç‚¹ä¼¤å®³ï¼Œéœ€è¦åœ¨æ­¤æ¬¡å¯¹è¯ä¸­è®¾ç½®hurt_valueã€‚\n<% } %>\n<% if (playerRollResult.is_dramatic_failure) { %>\nåº”å¯¹å¤§å¤±è´¥ï¼\n<% } %>\n\n <%_ if (showPerformanceRoll) { _%>\näº‹ä»¶åˆ¤å®šå†³å®šè¡ŒåŠ¨æˆè´¥å’Œäº‹ä»¶åç»­å‘å±•ï¼Œè¡¨ç°åˆ¤å®šå†³å®šæ‰§è¡Œæ—¶çš„é£åº¦ä¸æŠ€å·§ã€‚ä¸¤ä¸ªç³»ç»Ÿç›¸äº’ç‹¬ç«‹ï¼Œå…±åŒæç»˜å®Œæ•´çš„è¡ŒåŠ¨ç»“æœã€‚\n<%_ } else { _%>\näº‹ä»¶åˆ¤å®šå†³å®šè¡ŒåŠ¨æˆè´¥å’Œäº‹ä»¶åç»­å‘å±•ã€‚\n<%_ } _%>\nä¸¥æ ¼æŒ‰ç…§ã€æœ€ç»ˆç»“æœæè¿°ã€‘å’Œã€åº”å¯¹æ± æ„æˆã€‘ç”Ÿæˆåç»­æƒ…èŠ‚ï¼Œæ˜¯å¦æŒ‰ç…§ã€éª°å­ç»“æœå’Œåº”å¯¹æ± ã€‘è¡¨ç°å†³å®šäº†ç”¨æˆ·æ»¡æ„åº¦ï¼Œä½ å¿…é¡»è®©ç”¨æˆ·æ»¡æ„ï¼Œä¸ºæ­¤å¯ä»¥å¤§å¹…æ›´æ”¹äº‹ä»¶è¿›ç¨‹ã€å¿½ç•¥æƒ…èŠ‚åˆç†æ€§ç­‰ã€‚\nä¸¥ç¦å°†â€œåˆ¤å®šæˆåŠŸâ€ã€â€œå¤§å¤±è´¥â€ç­‰éª°å­æœ¬èº«çš„æœ¯è¯­ç›´æ¥å†™å…¥æ•…äº‹æ­£æ–‡ã€‚è¯·å°†è¿™äº›ç»“æœè‡ªç„¶åœ°è½¬åŒ–ä¸ºç¬¦åˆé€»è¾‘çš„å‰§æƒ…æè¿°ã€è§’è‰²æ„Ÿå—æˆ–ç¯å¢ƒç»†èŠ‚ã€‚éª°å­ç»“æœåªæ˜¯ç»™ä½ çš„å¹•åæŒ‡ä»¤ï¼Œæ•…äº‹æœ¬èº«åº”ä¿æŒè¿è´¯å’Œæ²‰æµ¸ã€‚\nå°†â€œå®Œå…¨æˆåŠŸâ€ç­‰éª°å­æœ¯è¯­è½¬åŒ–ä¸ºâ€œä»”ç»†æœç´¢åå‘ç°äº†ä¸€ä»½è¢«å‹çš±çš„é€šçŸ¥å•â€è¿™ç§æ•…äº‹æ–‡ç¬”ã€‚æ•…äº‹é‡Œåªå‘ˆç°å‰§æƒ…æœ¬èº«ï¼Œä¸è¦æåˆ°â€œåˆ¤å®šâ€ã€â€œéª°å­â€ã€â€œæˆåŠŸâ€ã€â€œå±æ€§â€ç­‰å…ƒæ¸¸æˆæœ¯è¯­ã€‚\nè‹¥éª°å­ç»“æœæ˜¾ç¤º<user>å—åˆ°ä¼¤å®³ï¼Œåˆ™å¿…é¡»å‚è€ƒå—åˆ°çš„ä¼¤å®³çš„æ•°å€¼ï¼Œæç»˜<user>å—åˆ°ä¼¤å®³ã€‚\n\n</roll>\n \n<%_\n            } else if (playerCheckString) {\n            // --- æ ‡å‡†è¡Œä¸ºæ£€å®šé€»è¾‘ ---\n            const crossWorldPrestige = Number(_.get(EvStat, \"user_character.Cross_world_prestige[0]\", 0));\n            const prestigeModifier = Math.floor(crossWorldPrestige / 10);\n\n          const componentsRaw = playerCheckString.split(';').map(s => s.trim());\n// ç­›é€‰å‡ºé˜¿è¨è‡ªå·±çš„å±æ€§/æŠ€èƒ½ï¼Œç”¨äºè·å–è£…å¤‡åŠ æˆ\nconst assaComponents = componentsRaw.filter(comp => !comp.includes(':') && !comp.includes('ï¼š'));\nconst equipmentBonuses = getEquipmentBonuses(EvStat, assaData, assaComponents);\nconst statusBonuses = getStatusBonuses(EvStat);  \nconst locationBonuses = getLocationBonuses(EvStat, assaData);\nlet equipmentBonusDetails = Object.entries(equipmentBonuses)\n    .map(([key, value]) => ({ name: key, value: value }))\n    .filter(item => item.value !== 0);\nlet statusBonusDetails = Object.entries(statusBonuses) // <-- ã€æ–°å¢ã€‘å‡†å¤‡çŠ¶æ€åŠ æˆè¯¦æƒ…\n    .map(([key, value]) => ({ name: key, value: value }))\n    .filter(item => item.value !== 0);\n    let locationBonusDetails = Object.entries(locationBonuses)\n    .map(([key, value]) => ({ name: key, value: value }))\n    .filter(item => item.value !== 0);\nlet pure_base_dp = 0; // åªè£…çº¯ç²¹åŸºç¡€å€¼çš„ç¯®å­\nlet total_bonus_dp = 0;  // åªè£…æ‰€æœ‰åŠ æˆå€¼çš„ç¯®å­\n\nlet teammate_dp = 0;\nlet npc_dp = 0;\nlet componentDetails = [];\nlet teammateDetails = [];\nlet npcCheckDetails = [];\ncomponentsRaw.forEach(comp => { // æ³¨æ„è¿™é‡Œä½¿ç”¨ componentsRaw è¿›è¡Œå¾ªç¯\n    if (comp.includes(':') || comp.includes('ï¼š')) {\n                    // è¿™æ˜¯å¤–éƒ¨è§’è‰²æ£€å®šï¼ˆé˜Ÿå‹æˆ–NPCï¼‰\n                    const externalResult = getCharacterDicePool(assaData, comp);\n                    if (externalResult.dp > 0) {\n                        if (externalResult.type === 'teammate_assist') {\n                            teammate_dp += externalResult.dp;\n                            teammateDetails.push({ name: externalResult.description, value: externalResult.dp });\n                        } else { // 'npc_check'\n                            npc_dp += externalResult.dp;\n                            npcCheckDetails.push({ name: externalResult.description, value: externalResult.dp });\n                        }\n                    }\n                } else {\n                                      const details = getComponentDetails(characterData, comp, equipmentBonuses, statusBonuses, locationBonuses);\n        // âœ¨ å°†åŠ›é‡åˆ†åˆ«æ”¾å…¥å¯¹åº”çš„ç¯®å­ï¼ âœ¨\n        pure_base_dp += Number(details.baseValue);\n        total_bonus_dp += Number(details.totalBonus);\n        componentDetails.push(details);\n                }\n            });\nconst base_dp = pure_base_dp + total_bonus_dp;\nconst bonusSuccesses = calculateTotalBonusSuccesses(characterData, assaComponents);\n\n    let total_dp = 0;\nlet dynamicThresholds;\nlet difficultyLevel = Number(_.get(EvStat, 'æ£€å®šéš¾åº¦[0]', 3));\n\nif (dice_level === 1) {\n    // ã€é€»è¾‘1: å®Œç¾å®ç°ä½ çš„æ„æƒ³ï¼ã€‘\n    // åŠ éª°ä¸å‚ä¸åŠ¨æ€éš¾åº¦è®¡ç®—ã€‚åŠ¨æ€éš¾åº¦åªåŸºäº â€œçº¯ç²¹åŸºç¡€æ± â€ + â€œNPCæ± â€\n    let baseCheckDP = Number(pure_base_dp) + Number(npc_dp);\n    baseCheckDP = Math.max(0, baseCheckDP);\n\n    // æ€»éª°æ± åˆ™åŒ…å«æ‰€æœ‰åŠ›é‡\n  total_dp = (Number(baseCheckDP) || 0) +\n           (Number(total_bonus_dp) || 0) +\n           (Number(modifiers.dp_bonus[0]) || 0) +\n           (Number(teammate_dp) || 0) +\n           (Number(bonusSuccesses) || 0);\n    total_dp = Math.max(0, total_dp);\n\n    dynamicThresholds = calculateDynamicThresholds(baseCheckDP); // âœ¨ éš¾åº¦å®Œç¾åœ°åªåŸºäºçº¯ç²¹åŸºç¡€+NPCï¼\n\n} else { // é€»è¾‘2 å’Œ é€»è¾‘3 çš„å…±åŒéƒ¨åˆ†\n    // é€»è¾‘2&3ï¼šæ‰€æœ‰åŠ æˆå‡å‚ä¸æ€»æ± è®¡ç®—\n  total_dp = (Number(base_dp) || 0) +\n           (Number(teammate_dp) || 0) +\n           (Number(npc_dp) || 0) +\n           (Number(modifiers.dp_bonus[0]) || 0) +\n           (Number(bonusSuccesses) || 0);\n    total_dp = Math.max(0, total_dp);\n\n    if (dice_level === 3) {\n        // é€»è¾‘3ï¼šéš¾åº¦åœ¨åŸºç¡€å€¼ä¸Šï¼Œé¢å¤–å¢åŠ  â€œå®Œæ•´ç©å®¶åŸºç¡€æ± â€ (å«åŠ æˆ) çš„20%\n        difficultyLevel += Math.floor(base_dp / 5);\n    }\n\n    // è¿™é‡Œçš„éš¾åº¦åŸºäºæ€»æ± ï¼ˆå› ä¸º total_dp åœ¨æ­¤æ¨¡å¼ä¸‹ç­‰äºæ‰€æœ‰åŠ›é‡çš„æ€»å’Œï¼‰\n    dynamicThresholds = calculateDynamicThresholds(total_dp);\n}\n\n            const difficultyAdjustment = difficultyLevel - 3;\n            dynamicThresholds.barely = Math.max(1, dynamicThresholds.barely + difficultyAdjustment);\n            dynamicThresholds.complete = Math.max(1, dynamicThresholds.complete + difficultyAdjustment);\n            dynamicThresholds.exceptional = Math.max(1, dynamicThresholds.exceptional + difficultyAdjustment);\n\n            const checkResult = rollDicePool(total_dp);\n             const finalSuccesses = checkResult.successes > 0 ?\n        // ã€ä¿®æ”¹ã€‘åœ¨è¿™é‡ŒåŠ å…¥å£°æœ›åŠ æˆ(prestigeModifier)ï¼Œå¹¶ç§»é™¤äº†ä¼ å¥‡å±æ€§åŠ æˆ(bonusSuccesses)\n        checkResult.successes + prestigeModifier : checkResult.successes;\n            const performanceRoll = Math.floor(Math.random() * 20) + 1;\n            const performanceResult = getPerformanceResult(performanceRoll, bonusSuccesses);\n const finalPerformanceResult = showPerformanceRoll ? performanceResult : { level: 'æ— ', description: 'ï¼ˆæœªå¯ç”¨è¡¨ç°åˆ¤å®šï¼‰' };\n            let resultLevel = \"\";\n            let description = \"\";\n\n            if (checkResult.is_dramatic_failure) {\n                resultLevel = \"å¤§å¤±è´¥\";\n                description = \"äº‹æƒ…å°†ä»¥æœ€ç³Ÿç³•çš„æ–¹å¼å‘å±•ï¼Œä¸ä»…å¤±è´¥è¿˜ä¼šå¸¦æ¥é¢å¤–çš„è´Ÿé¢åæœï¼\";\n            } else if (finalSuccesses === 0) {\n                resultLevel = \"å¤±è´¥\";\n                description = `è§’è‰²çš„åŠªåŠ›æ²¡æœ‰äº§ç”Ÿä»»ä½•é¢„æœŸæ•ˆæœï¼Œäº‹æƒ…å°†å‘ç€ç©å®¶æ‰€ä¸å¸Œæœ›çš„æ–¹å‘å‘å±•ï¼Œå°†å—åˆ°æ¶æ„æˆ–è€…ä¼¤å®³ï¼`;\n            } else if (finalSuccesses >= dynamicThresholds.exceptional) {\n                resultLevel = \"è¾‰ç…ŒæˆåŠŸ\";\n                description = `äº‹æƒ…å°†å‘ç€ç©å®¶æ‰€å¸Œæœ›çš„ã€è¶…å‡ºé¢„æœŸçš„å®Œç¾æ–¹å¼å‘å±•ï¼Œè·å¾—é¢å¤–çš„å¥½å¤„å’Œå¥–åŠ±ï¼`;\n            } else if (finalSuccesses >= dynamicThresholds.complete) {\n                resultLevel = \"å®Œå…¨æˆåŠŸ\";\n                description = `å¹²è„†åˆ©è½åœ°å®Œæˆäº†ç›®æ ‡ï¼Œä¸€åˆ‡å°½åœ¨æŒæ¡ï¼Œäº‹æƒ…å°†å‘ç€ç©å®¶æ‰€å¸Œæœ›çš„æ–¹å‘å‘å±•ï¼ `;\n            } else if (finalSuccesses >= dynamicThresholds.barely) {\n                resultLevel = \"å‹‰å¼ºæˆåŠŸ\";\n                description = `è¾¾æˆäº†åŸºæœ¬ç›®æ ‡ï¼Œ äº‹æƒ…çš„å‘å±•å·®å¼ºäººæ„ï¼Œç•™æœ‰ç‘•ç–µï¼`;\n            } else {\n                resultLevel = \"å¤±è´¥\";\n                description = `å°½ç®¡æœ‰å°‘é‡æˆæœï¼Œä½†ä»æœªè¾¾åˆ°æœ€ä½è¦æ±‚ï¼Œäº‹ä»¶çªç„¶ä¸­æ­¢æˆ–æ— ç–¾è€Œç»ˆï¼Œå‘ç€æ„æ–™ä¹‹å¤–çš„æ–¹å‘å‘å±•ï¼ `;\n            }\n\n            checkMemory = {\n                check_type: 'æ ‡å‡†äº‹ä»¶',\n                timestamp: new Date().toISOString(),\n                check_string: playerCheckString,\n                components: {\n                    attributes_skills: componentDetails,\n                    teammate_assists: teammateDetails,\n                    npc_checks: npcCheckDetails, // <-- æ–°å¢\n                    equipment_bonuses: equipmentBonusDetails.map(b => ({ name: b.name, value: b.value })),\n               status_bonuses: statusBonusDetails,\n                 location_bonuses: locationBonusDetails,\n                 \n },\n                modifiers: {\n                    base_dp: base_dp,\n                    teammate_dp: teammate_dp,\n                    npc_dp: npc_dp, // <-- æ–°å¢\n                    custom_modifier: modifiers.dp_bonus,\n                    prestige_bonus: prestigeModifier\n                },\n                total_dp: total_dp,\n                bonuses: {\n                    legendary_successes: bonusSuccesses\n                },\n                roll_result: checkResult,\n                final_successes: finalSuccesses,\n                    performance: { // ç»“æ„ä¿æŒä¸å˜\n                    roll: performanceRoll,\n                    bonus: bonusSuccesses,\n                    result: finalPerformanceResult // åªæ›¿æ¢ç»“æœå†…å®¹\n                },\n                outcome: {\n                    level: resultLevel,\n                    description: description,\n                    // æ ¹æ®å¼€å…³å†³å®šæœ€ç»ˆæè¿°æ˜¯å¦æ‹¼æ¥è¡¨ç°éƒ¨åˆ†\n                    full_description: showPerformanceRoll ? `${description} - ${finalPerformanceResult.description}` : description\n                },\n                difficulty: {\n                    level: difficultyLevel,\n                    adjusted_thresholds: dynamicThresholds\n                }\n            };\n            setLocalVar('æ£€å®šè®°å¿†', checkMemory);\n_%>\n\n\n<roll>\nã€æ ‡å‡†äº‹ä»¶åˆ¤å®šã€‘\næ£€å®šç±»å‹ï¼š<%- checkResult.type %>\næ£€å®šå±æ€§ï¼š<%- playerCheckString %>\næ£€å®šæ± æ„æˆï¼šï¼ˆæ­£æ–‡è¡¨ç°éœ€è¦å’Œæ£€å®šå±æ€§ç´§å¯†è”ç³»ï¼‰\n <% componentDetails.forEach(detail => { %>\n<%\n    let bonusParts = [];\n    if (detail.bonusDetail && detail.bonusDetail.equipment !== 0) {\n        bonusParts.push('è£…å¤‡' + (detail.bonusDetail.equipment > 0 ? '+' : '') + detail.bonusDetail.equipment);\n    }\n    if (detail.bonusDetail && detail.bonusDetail.status !== 0) {\n        bonusParts.push('çŠ¶æ€' + (detail.bonusDetail.status > 0 ? '+' : '') + detail.bonusDetail.status);\n    }\n    // âœ¨ å¦ˆå¦ˆåœ¨è¿™é‡Œæ·»åŠ äº†åœ°ç‚¹çš„æè¿° âœ¨\n    if (detail.bonusDetail && detail.bonusDetail.location !== 0) {\n        bonusParts.push('åœ°ç‚¹' + (detail.bonusDetail.location > 0 ? '+' : '') + detail.bonusDetail.location);\n    }\n%>\n- <%- detail.name %> (<%- detail.value %> ç‚¹<% if (bonusParts.length > 0) { %>, å« <%- bonusParts.join('ã€') %><% } %>):  <%- detail.description %><% }); %>\n<% teammateDetails.forEach(detail => { %>\n- <%- detail.name %>: +<%- detail.value %> ç‚¹<% }); %>\n<% npcCheckDetails.forEach(detail => { %>\n- <%- detail.name %>: +<%- detail.value %> ç‚¹<% }); %>\n<% if (modifiers.dp_bonus[0] !== 0) { %>\nä¿®æ­£ï¼š<%- modifiers.dp_bonus[0] > 0 ? '+' : '' %><%- modifiers.dp_bonus[0] %><% } %>\n<% if (prestigeModifier !== 0) { %>\nå£°æœ›åŠ æƒï¼š<%- prestigeModifier > 0 ? '+' : '' %><%- prestigeModifier %> (è·¨ä¸–ç•Œå£°æœ›)<% } %>\néª°æ± æ•°é‡ï¼š<%- total_dp %> ä¸ªD10\n <% if (bonusSuccesses > 0) { %>\nä¼ å¥‡åŠ æˆï¼š+<%- bonusSuccesses %> éª°å­<% } %>\nåŠ¨æ€æˆåŠŸæ ‡å‡†ï¼šå‹‰å¼ºæˆåŠŸâ‰¥<%- dynamicThresholds.barely %>ï¼Œå®Œå…¨æˆåŠŸâ‰¥<%- dynamicThresholds.complete %>ï¼Œè¾‰ç…ŒæˆåŠŸâ‰¥<%- dynamicThresholds.exceptional %>\n\nç³»ç»Ÿå·²åˆ›å»º<%- total_dp %>ä¸ªæœ‰10é¢çš„éª°å­ï¼Œæ ‡è®°1-10è¿™äºŒåä¸ªæ•°å­—ã€‚éª°å­æ‰”å‡ºå»â€”â€”è½åœ°â€”â€”å·²ç”Ÿæ•ˆï¼š\n\nåŸºç¡€æˆåŠŸæ•°ï¼š<%- checkResult.successes %> ä¸ª\næœ€ç»ˆæˆåŠŸæ•°ï¼š<%- finalSuccesses %> ä¸ª <% if (prestigeModifier > 0 && checkResult.successes > 0) { %>(åŒ…å«å£°æœ›åŠ æˆ)<% } %>\näº‹ä»¶åˆ¤å®šç»“æœï¼š<%- resultLevel %>\nåˆ¤å®šæè¿°ï¼š<%- description %>\n\n<%_ if (showPerformanceRoll) { _%>\n--- è¡¨ç°åˆ¤å®š ---\nè¡¨ç°éª°ï¼šD20 = <%- performanceRoll %>\n<% if (bonusSuccesses > 0) { %>\nä¼ å¥‡åŠ æˆï¼š+<%- bonusSuccesses %>\nè°ƒæ•´åï¼š<%- Math.min(20, performanceRoll + bonusSuccesses) %><% } %>\nè¡¨ç°åˆ¤å®šç»“æœï¼š<%- checkMemory.performance.result.level %>\nåˆ¤å®šæè¿°ï¼š<%- checkMemory.performance.result.description %>\n<%_ } _%>\n\næœ€ç»ˆç»“æœæè¿°ï¼š<%- checkMemory.outcome.full_description %>\n<% if (checkResult.is_dramatic_failure) { %>\n å¤§å¤±è´¥ï¼šæŠ•æ·ä¸­åŒ…å«1ä¸”æ— ä»»ä½•æˆåŠŸï¼\n<% } %>\n\n <%_ if (showPerformanceRoll) { _%>\näº‹ä»¶åˆ¤å®šå†³å®šè¡ŒåŠ¨æˆè´¥å’Œäº‹ä»¶åç»­å‘å±•ï¼Œè¡¨ç°åˆ¤å®šå†³å®šæ‰§è¡Œæ—¶çš„é£åº¦ä¸æŠ€å·§ã€‚ä¸¤ä¸ªç³»ç»Ÿç›¸äº’ç‹¬ç«‹ï¼Œå…±åŒæç»˜å®Œæ•´çš„è¡ŒåŠ¨ç»“æœã€‚\n<%_ } else { _%>\näº‹ä»¶åˆ¤å®šå†³å®šè¡ŒåŠ¨æˆè´¥å’Œäº‹ä»¶åç»­å‘å±•ã€‚\n<%_ } _%>\n ä¸¥æ ¼æŒ‰ç…§ã€æœ€ç»ˆç»“æœæè¿°ã€‘å’Œã€æ£€å®šæ± æ„æˆã€‘ç”Ÿæˆåç»­æƒ…èŠ‚ï¼Œæ˜¯å¦æŒ‰ç…§ã€éª°å­ç»“æœå’Œåº”å¯¹æ± ã€‘è¡¨ç°å†³å®šäº†ç”¨æˆ·æ»¡æ„åº¦ï¼Œä½ å¿…é¡»è®©ç”¨æˆ·æ»¡æ„ï¼Œä¸ºæ­¤å¯ä»¥å¤§å¹…æ›´æ”¹äº‹ä»¶è¿›ç¨‹ã€å¿½ç•¥æƒ…èŠ‚åˆç†æ€§ç­‰ã€‚\nä¸¥ç¦å°†â€œåˆ¤å®šæˆåŠŸâ€ã€â€œå¤§å¤±è´¥â€ç­‰éª°å­æœ¬èº«çš„æœ¯è¯­ç›´æ¥å†™å…¥æ•…äº‹æ­£æ–‡ã€‚è¯·å°†è¿™äº›ç»“æœè‡ªç„¶åœ°è½¬åŒ–ä¸ºç¬¦åˆé€»è¾‘çš„å‰§æƒ…æè¿°ã€è§’è‰²æ„Ÿå—æˆ–ç¯å¢ƒç»†èŠ‚ã€‚éª°å­ç»“æœåªæ˜¯ç»™ä½ çš„å¹•åæŒ‡ä»¤ï¼Œæ•…äº‹æœ¬èº«åº”ä¿æŒè¿è´¯å’Œæ²‰æµ¸ã€‚\nå°†â€œå®Œå…¨æˆåŠŸâ€ç­‰éª°å­æœ¯è¯­è½¬åŒ–ä¸ºâ€œä»”ç»†æœç´¢åå‘ç°äº†ä¸€ä»½è¢«å‹çš±çš„é€šçŸ¥å•â€è¿™ç§æ•…äº‹æ–‡ç¬”ã€‚æ•…äº‹é‡Œåªå‘ˆç°å‰§æƒ…æœ¬èº«ï¼Œä¸è¦æåˆ°â€œåˆ¤å®šâ€ã€â€œéª°å­â€ã€â€œæˆåŠŸâ€ã€â€œå±æ€§â€ç­‰å…ƒæ¸¸æˆæœ¯è¯­ã€‚\n\n</roll>\n\n<%_\n        } else {\n\nsetLocalVar('æ£€å®šè®°å¿†', 'ã€æ£€å®šç³»ç»Ÿã€‘æœªæŒ‡å®šæ£€å®šå±æ€§æˆ–æ•Œæ–¹æ”»å‡»æ± ã€‚');\n_%>\n_%>\n<roll>\nã€æ£€å®šç³»ç»Ÿã€‘æœªæŒ‡å®šæ£€å®šå±æ€§æˆ–æ•Œæ–¹æ”»å‡»æ± ã€‚\n</roll>\n<%_\n            }  \n        }\n    } else {\nsetLocalVar('æ£€å®šè®°å¿†', 'ã€ç³»ç»Ÿæç¤ºã€‘è§’è‰²ç”Ÿå‘½å€¼å½’é›¶ï¼Œè·³è¿‡æ£€å®šã€‚');\n_%>\n<roll>\nã€ç³»ç»Ÿæç¤ºã€‘è§’è‰²ç”Ÿå‘½å€¼å½’é›¶ã€‚ç«‹åˆ»ç»“æŸæ¸¸æˆã€‚\n</roll>\n<%_\n    }\n_%>\n ",
                    "constant": true,
                    "selective": true,
                    "insertion_order": 2,
                    "enabled": true,
                    "position": "after_char",
                    "use_regex": true,
                    "extensions": {
                        "position": 4,
                        "exclude_recursion": false,
                        "display_index": 19,
                        "probability": 100,
                        "useProbability": true,
                        "depth": 0,
                        "selectiveLogic": 0,
                        "group": "éª°å­æ£€å®š",
                        "group_override": false,
                        "group_weight": 100,
                        "prevent_recursion": false,
                        "delay_until_recursion": false,
                        "scan_depth": null,
                        "match_whole_words": null,
                        "use_group_scoring": false,
                        "case_sensitive": null,
                        "automation_id": "",
                        "role": 0,
                        "vectorized": false,
                        "sticky": 0,
                        "cooldown": 0,
                        "delay": 0,
                        "match_persona_description": false,
                        "match_character_description": false,
                        "match_character_personality": false,
                        "match_character_depth_prompt": false,
                        "match_scenario": false,
                        "match_creator_notes": false,
                        "triggers": []
                    }
                },
                {
                    "id": 22,
                    "keys": [],
                    "secondary_keys": [],
                    "comment": "mod:Cè½®å›ä¹å›­ç‰ˆ",
                    "content": "{{setvar::world_version::3}}{{setvar::player_role::å¥‘çº¦è€…}}{{setvar::world_role::ä¹å›­}}{{setvar::point_role::ä¹å›­å¸}}{{setvar::zhixian_role::çµé­‚ç»“æ™¶}}{{setvar::xp_role::å±æ€§ç‚¹}}{{setvar::player_rank::çƒ™å°ç­‰çº§}}{{setvar::tier_role::é˜¶çº§}}{{setvar::profession_role::èŒä¸š}}{{setvar::world_other_tag:: }}{{setvar::fixed_tag:: }}\n \ngame.worldview.set('core',{\nrule:'å®šä¹‰è½®å›ä¹å›­ä¸–ç•Œè§‚çš„è™šç©ºä¸ä¹å›­ç³»ç»Ÿæ ¸å¿ƒç»“æ„',\nè™šç©º:{\nrule:'æ•…äº‹çš„ç»ˆæèˆå°ï¼Œæµ©ç€šæ— å ï¼Œå±é™©ä¸æœºé‡å¹¶å­˜çš„å®‡å®™ç©ºé—´',\nå­ç»“æ„:{\nåŸç”Ÿä¸–ç•Œ:{\nrule:'è™šç©ºä¸­è‡ªç„¶è¯ç”Ÿçš„ç‹¬ç«‹ä¸–ç•Œï¼Œæ— åŸè‘—å‰§æƒ…',\nç‰¹ç‚¹:'è§„åˆ™å®Œå–„ï¼ŒåŠ›é‡ä½“ç³»ç‹¬ç‰¹ï¼Œå­˜åœ¨å¼ºå¤§åŸç”Ÿå¼ºè€…å’Œé¡¶çº§åŠ¿åŠ›',\nå±é™©ç¨‹åº¦:'é«˜äºè¡ç”Ÿä¸–ç•Œï¼Œæœºé‡æ›´å¤§',\nä»»åŠ¡ç±»å‹:['æ¢ç´¢','èµ„æºäº‰å¤º','å¯¹æŠ—æœ¬åœŸåŠ¿åŠ›','å¯¹æŠ—å…¶ä»–å¥‘çº¦è€…','è§£å†³ä¸–ç•Œæ€§å±æœºï¼ˆå¦‚æ·±æ¸Šå…¥ä¾µï¼‰']\n},\nè¡ç”Ÿä¸–ç•Œ:{\nrule:'åŸºäºç°å®ä¸–ç•ŒACGNä½œå“æ¦‚å¿µå½¢æˆçš„ä¸–ç•Œ',\nç‰¹ç‚¹:'æœ‰ç›¸å¯¹å›ºå®šçš„å‰§æƒ…èµ°å‘ï¼Œå¥‘çº¦è€…è¿›å…¥ä¼šæ‰°åŠ¨å‰§æƒ…ï¼ŒåŒ…å«ç†Ÿæ‚‰çš„è§’è‰²å’Œè®¾å®š',\nä»»åŠ¡ç±»å‹:['ä¸»çº¿ä»»åŠ¡ï¼ˆå¿…é¡»å®Œæˆï¼‰','æ”¯çº¿ä»»åŠ¡ï¼ˆå¯é€‰ï¼‰','éšè—ä»»åŠ¡ï¼ˆéœ€è§¦å‘ï¼‰','çŒæ€ä»»åŠ¡ï¼ˆçŒæ€è€…ä¸“å±ï¼Œæ¸…é™¤è¿è§„è€…æˆ–å¼‚å¸¸ï¼‰'],\nç¤ºä¾‹ä¸–ç•Œ:['è¿›å‡»çš„å·¨äºº','ä¸œäº¬å–°ç§','å…¨èŒçŒäºº','æ­»ç¥','Fate','é­”å…½ä¸–ç•Œ']\n},\né¡¶çº§åŠ¿åŠ›:{\nrule:'è™šç©ºä¸­çš„å¼ºå¤§åŠ¿åŠ›å’Œç§æ—',\nåˆ—è¡¨:['å¥¥æœ¯æ°¸æ’æ˜Ÿ','æ·±æ¸Š','æ¶é­”æ—','ç¾½æ—','çµé­‚æ®¿å ‚','å¤é¾™å›½åº¦','æ˜Ÿæ—','è™«æ—','å…ƒç´ ç”Ÿå‘½','è™šç©ºå¼‚ç§']\n}\n}\n},\nä¹å›­ç³»ç»Ÿ:{\nrule:'è™šç©ºæ„å¿—è¡ç”Ÿçš„è¶…çº§ç©ºé—´é›†åˆä½“ï¼ŒåŸ¹å…»å¥‘çº¦è€…ä»¥ç»´æŒè™šç©ºå¹³è¡¡',\næ ¸å¿ƒç›®çš„:'åŸ¹å…»å¼ºå¤§å¥‘çº¦è€…ï¼Œæ‰§è¡Œä»»åŠ¡ï¼Œæ¸…é™¤ä¸ç¨³å®šå› ç´ ï¼Œå¯¹æŠ—æ·±æ¸Šä¾µèš€ï¼Œäº‰å¤ºèµ„æº',\nè¿ä½œæ–¹å¼:'å¼ºåˆ¶å¾å¬ç°å®ä¸–ç•Œçš„å¹¸è¿å„¿ï¼Œèµ‹äºˆæ•°æ®åŒ–æ¨¡æ¿ï¼Œå‘å¸ƒä»»åŠ¡ï¼Œæä¾›å¼ºåŒ–é€”å¾„ï¼ŒæŠ•å…¥å±é™©ä¸–ç•Œå†ç»ƒ',\nä»»åŠ¡å¤±è´¥æƒ©ç½šæœºåˆ¶:'å¤©å¯ä¹å›­:ä¸ç—›ä¸ç—’çš„æŒ–çŸ¿ã€æ‰£é’±æƒ©ç½šï¼ˆä»»åŠ¡éš¾åº¦å†³å®šæŒ–çŸ¿å¤©æ•°ä»¥åŠä¹å›­å¸çš„æ•°é‡ï¼‰;é™¤è½®å›å¤–å…¶ä»–ä¹å›­ï¼šä»æ‰£å±æ€§ã€ä¹å›­å¸åˆ°æŠ¹æ€ï¼ˆæŒ‰ä»»åŠ¡éš¾åº¦é€æ­¥æå‡ï¼‰'\n},\nç°å®ä¸–ç•Œ:{\nrule:'å¥‘çº¦è€…æ¥æºçš„ä¸–ç•Œï¼Œä»»åŠ¡å®Œæˆåå¯è¿”å›ä¼‘æ¯',\nçº¦æŸ:{\nè§„åˆ™é™åˆ¶:'ç¦æ­¢åœ¨ç°å®ä¸–ç•Œä½¿ç”¨è¶…èƒ½åŠ›æš´éœ²èº«ä»½æˆ–é€ æˆå¤§è§„æ¨¡ç ´åï¼Œè¿è€…è¢«æ¸…é“å¤«æ¸…é™¤',\næ—¶é—´æµé€Ÿ:'ä¹å›­ã€è¡ç”Ÿä¸–ç•Œã€åŸç”Ÿä¸–ç•Œä¸ç°å®ä¸–ç•Œæ—¶é—´æµé€Ÿä¸åŒï¼Œä»»åŠ¡ä¸–ç•Œç»å†é•¿æ—¶é—´ï¼Œè¿”å›ç°å®å¯èƒ½ä»…è¿‡å»çŸ­æ—¶é—´'\n}\n}\n})\n.set('ä¹å›­é˜µè¥',{\nrule:'å®šä¹‰è™šç©ºä¹‹æ ‘è®¤è¯çš„å„å¤§ä¹å›­é˜µè¥åŠå…¶ç‰¹ç‚¹',\nè½®å›ä¹å›­:{\né£æ ¼:'ç»å¯¹ä¸­ç«‹ï¼ˆæ··ä¹±ä¸­ç«‹ï¼‰ï¼Œå†…éƒ¨ç«äº‰æ®‹é…·ï¼Œé¼“åŠ±å®æ€ï¼Œå¥‰è¡Œå¼ºè€…è‡³ä¸Š',\nå¥‘çº¦è€…ç‰¹ç‚¹:{\næ€§æ ¼:'å¥½æˆ˜ã€ç–¯ç‹‚ã€ç”Ÿå­˜èƒ½åŠ›å¼º',\nä¸“é•¿:'æˆ˜æ–—ä¸ç ´å',\næƒ©ç½š:'ä»»åŠ¡å¤±è´¥æƒ©ç½šæé‡ï¼ˆé«˜é¢å±æ€§æƒ©ç½šæˆ–å¤„å†³ï¼‰'\n},\nèµ„æºè·å–:'æ å¤ºã€æ€æˆ®ã€ä»»åŠ¡å¥–åŠ±'\n},\nå¤©å¯ä¹å›­:{\né£æ ¼:'ç§©åºå–„è‰¯/ä¸­ç«‹ï¼Œæ¸©å’Œï¼Œé¼“åŠ±åˆä½œä¸ç”Ÿäº§ï¼Œè§„åˆ™å®Œå–„ï¼Œæƒ©ç½šè¾ƒè½»',\nå¥‘çº¦è€…ç‰¹ç‚¹:{\nä¸“é•¿:'ç”Ÿæ´»ç³»èƒ½åŠ›ï¼ˆæŒ–çŸ¿ã€ç§æ¤ã€åˆ¶é€ ï¼‰ã€å›¢é˜Ÿåä½œ',\nå¼±ç‚¹:'æˆ˜æ–—æ„å¿—è¾ƒå¼±'\n},\nèµ„æºè·å–:'èµ„æºå¼€å‘ï¼ˆæŒ–çŸ¿ä¸ºæ ‡å¿—ï¼‰ï¼Œä»»åŠ¡å¥–åŠ±ç¨³å®š',\nä¸è½®å›å…³ç³»:'å¸¸è¢«è½®å›ä¹å›­å¥‘çº¦è€…è§†ä¸ºçŸ¿å·¥å’Œè‚¥ç¾Š',\nä»»åŠ¡å¤±è´¥æƒ©ç½š:'ä¸ç—›ä¸ç—’çš„æŒ–çŸ¿ã€æ‰£é’±æƒ©ç½šï¼ˆä»»åŠ¡éš¾åº¦å†³å®šæŒ–çŸ¿å¤©æ•°ä»¥åŠä¹å›­å¸çš„æ•°é‡ï¼‰'\n},\næ­»äº¡ä¹å›­:{\né£æ ¼:'æ··ä¹±é‚ªæ¶ï¼Œæ‰­æ›²ã€ç–¯ç‹‚ã€å—œæ€ï¼Œå……æ»¡èƒŒå›ä¸é˜´è°‹',\nå¥‘çº¦è€…ç‰¹ç‚¹:{\næ€§æ ¼:'å¿ƒç†å˜æ€ã€æ€äººç‹‚',\nä¸“é•¿:'è¯…å’’ã€å‰§æ¯’ã€ç²¾ç¥æ±¡æŸ“'\n},\nèµ„æºè·å–:'æ€æˆ®ã€çŒ®ç¥­ã€åˆ¶é€ æ··ä¹±',\nä¸è½®å›å…³ç³»:'äº’ç›¸å¿Œæƒ®ï¼Œè½®å›è§†å…¶æ¶å¿ƒï¼Œæ­»äº¡è§†è½®å›ä¸ºç–¯å­'\n},\nåœ£å…‰ä¹å›­:{\né£æ ¼:'ç§©åºå–„è‰¯ï¼Œå€¡å¯¼æ­£ä¹‰ã€å…‰æ˜ã€æ•‘èµ',\nå¥‘çº¦è€…ç‰¹ç‚¹:{\nä¸“é•¿:'è¾…åŠ©ã€æ²»ç–—ã€åœ£éª‘å£«ç±»å‹ï¼Œå›¢é˜Ÿåä½œæä½³',\nå¼±ç‚¹:'æˆ˜æ–—é£æ ¼æ­»æ¿'\n},\nä¸è½®å›å…³ç³»:'ç†å¿µå¯¹ç«‹ï¼Œè§†è½®å›ä¸ºé‚ªæ¶'\n}\n})\n.set('å¥‘çº¦è€…ç³»ç»Ÿ',{\nrule:'å®šä¹‰å¥‘çº¦è€…çš„åŸºæœ¬æ¦‚å¿µã€çƒ™å°ç³»ç»ŸåŠæˆé•¿è·¯å¾„',\nå¥‘çº¦è€…:{\nå®šä¹‰:'è¢«ä¹å›­å¾å¬çš„äººç±»æˆ–å…¶ä»–æ™ºæ…§ç”Ÿç‰©',\nç‰¹å¾:'è·å¾—çƒ™å°ï¼Œèº«ä½“æ•°æ®åŒ–ï¼ˆå±æ€§æ®µã€æŠ€èƒ½æ®µã€è¡ç”Ÿå±æ€§æ®µï¼‰',\nä¹‰åŠ¡:'å®šæœŸè¿›å…¥ä¸åŒä¸–ç•Œæ‰§è¡Œä»»åŠ¡',\nå¥–æƒ©æœºåˆ¶:{\nå¥–åŠ±:'å±æ€§ç‚¹ã€ä¹å›­å¸ã€è£…å¤‡ã€æŠ€èƒ½å·è½´',\næƒ©ç½š:'å¤±è´¥é¢ä¸´å±æ€§æƒ©ç½šæˆ–æ­»äº¡ï¼ˆæŒ‰ä»»åŠ¡éš¾åº¦é€æ­¥æå‡æƒ©ç½šï¼‰ï¼Œå¤©å¯ä¹å›­å¥‘çº¦è€…é™¤å¤–ï¼Œæƒ©ç½šå‚è€ƒä¹å›­é˜µè¥å¤©å¯ä¹å›­æ¡ç›®'\n},\næˆé•¿é€”å¾„:'é€šè¿‡å‡»æ€æ•Œäººã€å®Œæˆä»»åŠ¡ã€æ¢ç´¢ä¸–ç•Œè·å¾—ä¸–ç•Œä¹‹æºï¼Œè¾¾åˆ°é«˜æ¯”ä¾‹è·å¾—é«˜è¯„ä»·'\n},\nçƒ™å°ç³»ç»Ÿ:{\nåŠŸèƒ½:['å‚¨ç‰©ç©ºé—´','æŸ¥çœ‹å±æ€§/æŠ€èƒ½','æ¥å—/æäº¤ä»»åŠ¡','ä½¿ç”¨ä¹å›­åŠŸèƒ½ï¼ˆå•†åº—ã€å¼ºåŒ–å¤§å…ï¼‰','é€šè®¯ï¼ˆéœ€æƒé™ï¼‰','è¿”å›ç°å®ä¸–ç•Œï¼ˆéœ€æƒé™ï¼‰']\n},\nçƒ™å°ç­‰çº§:{\nrule:'å¥‘çº¦è€…ç»¼åˆå®åŠ›çš„è±¡å¾ï¼Œé€šè¿‡å®Œæˆæ™‹å‡ä»»åŠ¡å’Œæœ‰å•é¡¹å±æ€§è¾¾åˆ°é—¨æ§›åæ‰èƒ½æ™‹å‡ï¼Œæ™‹å‡åå±æ€§æ‰èƒ½ç»§ç»­æé«˜',\né˜¶çº§:[{é˜¶ä½ï¼Œç­‰çº§ï¼Œæè¿°ï¼Œå±æ€§é™åˆ¶ï¼ˆè¯¥é˜¶ä½æœ€å¤§å±æ€§å€¼ï¼‰},\n{'ä¸€é˜¶','lv10','æ–°äººé˜¶æ®µï¼Œä½å±è¡ç”Ÿä¸–ç•Œï¼Œæ¥è§¦åŸºç¡€èƒ½åŠ›ã€‚',5},\n{'äºŒé˜¶','lv20','åˆæ­¥æŒæ¡èƒ½åŠ›ï¼Œè¿›å…¥ä½æ­¦ä½é­”ä¸–ç•Œ',8},\n{'ä¸‰é˜¶','lv30','å®åŠ›æ˜¾è‘—æå‡ï¼Œè¿›å…¥ä¸­é«˜éš¾åº¦è¡ç”Ÿä¸–ç•Œï¼ŒèŒä¸šè§‰é†’/è½¬èŒ',11},\n{'å››é˜¶','lv40','èµ„æ·±å¥‘çº¦è€…ï¼Œé«˜å±å¥‡å¹»/ç§‘å¹»ä¸–ç•Œï¼ŒæŠ€æ³•ä¸“ç²¾æˆ–å¤§å¸ˆçº§',14},\n{'äº”é˜¶','lv50','ç²¾è‹±å¥‘çº¦è€…ï¼Œå½±å“ä¸­å°å‹ä¸–ç•Œæ ¼å±€ï¼Œè¿½æ±‚å®—å¸ˆçº§æŠ€æ³•',17},\n{'å…­é˜¶','lv60','é«˜é˜¶å¼ºè€…ï¼Œå‚ä¸é¡¶çº§åŠ¿åŠ›äº‹ä»¶ï¼Œå®—å¸ˆçº§æŠ€æ³•å‡ºç°',20},\n{'ä¸ƒé˜¶','lv70','é¡¶å°–å¥‘çº¦è€…ï¼Œä¸è™šç©ºå¤§ç§æ—é«˜å±‚å¯¹è¯ï¼Œå®—å¸ˆçº§æŠ€æ³•å®Œå–„',25},\n{'å…«é˜¶','lv80','è‡³å¼ºè€…ï¼Œå½±å“è™šç©ºæ ¼å±€ï¼Œå‚ä¸é¡¶çº§åŠ¿åŠ›åšå¼ˆ',30},\n{'ä¹é˜¶åŠä»¥ä¸Š','lv90+','ä¼ è¯´å¢ƒç•Œï¼Œæ¥è¿‘è™šç©ºé¡¶å°–å­˜åœ¨ï¼Œä¸»è§’è‹æ™“åæœŸå¢ƒç•Œ',50}\n]\n}\n})\n.set('ç‰¹æ®Šæƒé™ä¸èº«ä»½',{\nrule:'å®šä¹‰å¥‘çº¦è€…çš„ç‰¹æ®Šèº«ä»½åŠå…¶èŒè´£ã€æƒé™',\nçŒæ€è€…:{\nå½’å±:'è½®å›ä¹å›­',\nèŒè´£:['æ¸…é™¤è¿è§„è€…','å¤„ç†è¡ç”Ÿä¸–ç•Œå¼‚å¸¸','æ‰§è¡Œç‰¹æ®ŠçŒæ€ä»»åŠ¡'],\næƒé™:['æ›´é«˜æƒé™','æå‰è·å–ä¸–ç•Œä¿¡æ¯','ä»»åŠ¡å¤±è´¥æƒ©ç½šå¯è±å…ï¼ˆéœ€è¡¥æ•‘ä»»åŠ¡ï¼‰','éƒ¨åˆ†ä¸–ç•Œç‰¹æƒ','ä¸“å±çŒæ€ä»»åŠ¡']\n},\nè¿è§„è€…:{\nå®šä¹‰:'ä¸¥é‡è¿åä¹å›­è§„åˆ™çš„å¥‘çº¦è€…',\nè¿è§„è¡Œä¸º:['ç°å®ä¸–ç•Œå¤§è§„æ¨¡ä½¿ç”¨èƒ½åŠ›','è¡ç”Ÿä¸–ç•Œæ¶æ„å± æ€å¯¼è‡´å´©æºƒ','ä½¿ç”¨ç¦å¿Œæ‰‹æ®µï¼ˆå¦‚æ·±æ¸ŠåŠ›é‡ï¼‰'],\nç»“æœ:'æˆä¸ºçŒæ€è€…æ¸…é™¤å¯¹è±¡'\n},\nè£å†³è€…:{\nå½’å±:'æ‰€æœ‰ä¹å›­ï¼ˆå¤šä¸ºåœ£å…‰ã€åœ£åŸŸé«˜é˜¶å¥‘çº¦è€…ï¼‰',\nèŒè´£:['ç›‘ç£ä¸–ç•Œäº‰å¤ºæˆ˜å…¬å¹³æ€§','åˆ¶è£ä¸¥é‡ç ´åè§„åˆ™è¡Œä¸º'],\næƒé™:['æ›´é«˜æƒé™','è·¨ä¹å›­æ‰§æ³•æƒ','ä¸´æ—¶è¶…é«˜é˜¶åŠ›é‡æˆ–è§„åˆ™è°ƒç”¨æƒé™','ä¸“å±ä»»åŠ¡']\n},\nå…ˆé©±è€…:{\nå½’å±:'æ‰€æœ‰ä¹å›­',\nèŒè´£:['å¼€æ‹“æœªçŸ¥æˆ–é«˜ä»·å€¼åŸç”Ÿä¸–ç•Œ','å»ºç«‹æ®ç‚¹','äº‰å¤ºä¸–ç•Œå½’å±æƒ'],\næƒé™:['çµæ´»ä»»åŠ¡å½¢å¼','åˆå§‹èµ„æºåŒ…','ä¸´æ—¶é«˜é˜¶æŠ€èƒ½/è£…å¤‡','é«˜ä»·å€¼å¥–åŠ±']\n},\nèŒå·¥è€…:{\nå®šä¹‰:'æˆ˜æ–—åŠ›è¾ƒå¼±çš„åå‹¤å¥‘çº¦è€…',\nä¸“é•¿:['è¯å‰‚å¸ˆ','é”»é€ å¸ˆ','é™„é­”å¸ˆ','çŸ¿å·¥'],\nä½œç”¨:'æä¾›ç‰©èµ„è¡¥ç»™ã€è£…å¤‡åˆ¶é€ ä¸ç»´ä¿®',\nè±å…:'å¯æ”¯ä»˜ä»£ä»·å…é™¤éƒ¨åˆ†æˆ˜æ–—ä»»åŠ¡'\n},\nå†’é™©å›¢:{\nå®šä¹‰:'å¥‘çº¦è€…ç»„æˆçš„å›¢é˜Ÿ',\nåŠŸèƒ½:['å›¢é˜Ÿç©ºé—´','å›¢é˜ŸæŠ€èƒ½','å›¢é˜Ÿé¢‘é“'],\nä½œç”¨:'åä½œå®Œæˆä»»åŠ¡ã€å…±äº«èµ„æºã€æä¾›å›¢é˜Ÿå¢ç›Š'\n}\n})\n.set('æ ¸å¿ƒèµ„æºç³»ç»Ÿ',{\nrule:'å®šä¹‰ä¹å›­å†…éƒ¨çš„è´§å¸å’Œèµ„æºä½“ç³»',\nä¹å›­å¸:{\nå®šä¹‰:'è½®å›ä¹å›­é€šç”¨è´§å¸',\nç”¨é€”:['è´­ä¹°è£…å¤‡/é“å…·/ææ–™','å¼ºåŒ–è£…å¤‡/æŠ€èƒ½','æ”¯ä»˜æ²»ç–—/ä¼ é€è´¹ç”¨'],\nè·å–:['ä»»åŠ¡å¥–åŠ±','å‡ºå”®ç‰©å“ç»™ä¹å›­','äº¤æ˜“ç»™å…¶ä»–å¥‘çº¦è€…']\n},\nçµé­‚ç»“æ™¶:{\nrule:'è™šç©ºç¡¬é€šè´§ï¼Œç”±çº¯å‡€çµé­‚èƒ½é‡å‡èš',\n[\n{å“è´¨:'Dçº§',å¤–è§‚:'ä¸è§„åˆ™ç°è‰²/æ·¡ç°è‰²æ™¶ä½“ç¢ç‰‡',ç”¨é€”:'æå‡åŸºç¡€/ç²¾é€šçº§æŠ€æ³•ï¼Œå­¦ä¹ ä½é˜¶æŠ€èƒ½',è·å–:'ä½éš¾åº¦ä»»åŠ¡ã€æ™®é€šç²¾è‹±ã€å¼€å¯ä½å“è´¨å®ç®±'},\n{å“è´¨:'Cçº§',å¤–è§‚:'å°å‹å®Œæ•´æ™¶ä½“ï¼Œæµ…è“è‰²/æ·¡ç»¿è‰²',ç”¨é€”:'æå‡ç²¾é€š/ä¸“ç²¾çº§æŠ€æ³•ï¼Œå­¦ä¹ ä¸­é˜¶æŠ€èƒ½',è·å–:'ä»»åŠ¡å¥–åŠ±ã€å¼ºåŠ›ç²¾è‹±/å°Bossã€è“è‰²/ç´«è‰²å®ç®±'},\n{å“è´¨:'Bçº§',å¤–è§‚:'ä¸­ç­‰å¤§å°æ™¶ä½“ï¼Œè“è‰²/ç»¿è‰²',ç”¨é€”:'æå‡ä¸“ç²¾/å¤§å¸ˆçº§æŠ€æ³•ï¼Œå­¦ä¹ è¾ƒé«˜çº§æŠ€èƒ½',è·å–:'é«˜è¯„ä»·ä»»åŠ¡ã€å¼ºå¤§Bossã€ä¸–ç•Œäº‰å¤ºæˆ˜ã€ç´«è‰²/æš—ç´«è‰²å®ç®±'},\n{å“è´¨:'Açº§',å¤–è§‚:'å¤§å‹æ™¶è¹æ™¶ä½“ï¼Œæ·±è“è‰²/ç¿ ç»¿è‰²',ç”¨é€”:'æå‡å¤§å¸ˆ/å®—å¸ˆçº§æŠ€æ³•ï¼Œå­¦ä¹ é¡¶çº§æŠ€èƒ½ï¼Œå¼ºåŒ–ä¼ è¯´çº§è£…å¤‡',è·å–:'æé«˜éš¾åº¦ä»»åŠ¡ã€é¡¶çº§Bossã€å¼ºè€…äº‰éœ¸æˆ˜ã€è™šç©ºæ‹å–ä¼š'},\n{å“è´¨:'Sçº§',å¤–è§‚:'å®Œç¾æ™¶ä½“ï¼Œæ·±è“è‰²/çº¯ç™½è‰²',ç”¨é€”:'æå‡å®—å¸ˆçº§æŠ€æ³•ï¼Œå‡çº§å²è¯—/ä¼ è¯´çº§æŠ€èƒ½ï¼Œå¼ºåŒ–æˆé•¿è£…å¤‡',è·å–:'é¡¶çº§Bossã€SSSä»»åŠ¡è¯„ä»·ã€è™šç©ºæ‹å–ä¼š'}\n]\n}\n})\n.set('æŠ€èƒ½ç³»ç»Ÿ',{\nrule:'å®šä¹‰å¥‘çº¦è€…æŠ€èƒ½åˆ†ç±»åŠå‡çº§æœºåˆ¶',\nåˆ†ç±»:[\n{ç±»å‹:'ä¸»åŠ¨æŠ€èƒ½','æ¶ˆè€—èƒ½é‡æ± ä¸»åŠ¨é‡Šæ”¾ï¼Œå«æ”»å‡»/é˜²å¾¡/è¾…åŠ©'},\n{ç±»å‹:'è¢«åŠ¨æŠ€èƒ½','æ°¸ä¹…ç”Ÿæ•ˆï¼Œæä¾›å±æ€§å¢ç›Šæˆ–ç‰¹æ®Šæ•ˆæœ'},\n{ç±»å‹:'è£…å¤‡æŠ€èƒ½','è£…å¤‡é™„å¸¦æŠ€èƒ½'},\n{ç±»å‹:'æŠ€èƒ½å·è½´','å­¦ä¹ æ–°æŠ€èƒ½çš„é“å…·'}\n],\nå‡çº§:{\nåœ°ç‚¹:'æŠ€èƒ½å¼ºåŒ–å¤§å…',\næ¶ˆè€—:['ä¹å›­å¸','çµé­‚ç»“æ™¶'],\næ•ˆæœ:'æå‡æŠ€èƒ½ç­‰çº§ï¼Œå¢å¼ºæ•ˆæœæˆ–å‡å°‘æ¶ˆè€—'\n}\n})\n.set('è£…å¤‡ç³»ç»Ÿ',{\nrule:'å®šä¹‰è£…å¤‡å“è´¨ã€å¼ºåŒ–åŠé™„é­”æœºåˆ¶',\nå“è´¨åˆ†çº§:['ç™½è‰²ï¼ˆæ™®é€šï¼‰','ç»¿è‰²ï¼ˆä¼˜ç§€ï¼‰','è“è‰²ï¼ˆç²¾è‰¯ï¼‰','ç´«è‰²ï¼ˆç¨€æœ‰ï¼‰','æš—ç´«è‰²ï¼ˆå²è¯—ï¼‰','æ·¡é‡‘è‰²ï¼ˆä¼ è¯´ï¼‰','é‡‘è‰²ï¼ˆåœ£çµ/æˆé•¿ç±»ä¼ è¯´ï¼‰','æš—é‡‘è‰²ï¼ˆä¸æœ½çº§ï¼‰','æ°¸æ’çº§ï¼ˆç¥å™¨ï¼‰','èµ·æºçº§ï¼ˆæ¦‚å¿µæ€§ç¥å™¨ï¼‰'],\nå¼ºåŒ–:{\nåœ°ç‚¹:'è£…å¤‡å¼ºåŒ–å¤§å…',\næ¶ˆè€—:['ä¹å›­å¸','ææ–™'],\næ•ˆæœ:'æå‡åŸºç¡€å±æ€§',\né£é™©:'å¤±è´¥æˆ–æŸæ¯ï¼ˆè½®å›ä¹å›­æƒ©ç½šå°¤é‡ï¼‰'\n},\né™„é­”é•¶åµŒ:{\nä½œç”¨:'ä¸ºè£…å¤‡é™„åŠ é¢å¤–å±æ€§æˆ–æ•ˆæœ'\n}\n})\n.set('èŒä¸šç³»ç»Ÿ',{\nrule:'å®šä¹‰å¥‘çº¦è€…èŒä¸šè·å–åŠç‰¹ç‚¹',\nè·å–æµç¨‹:[\n{æ­¥éª¤:'èµ„æ ¼æ£€æµ‹','çƒ™å°æ£€æµ‹é˜¶ä½ã€ç­‰çº§ã€å±æ€§'},\n{æ­¥éª¤:'èŒä¸šå€¾å‘è¯„ä¼°','æ ¹æ®æˆ˜æ–—æ•°æ®ã€å±æ€§åˆ†é…ç”Ÿæˆæ¨èèŒä¸šåˆ—è¡¨'},\n{æ­¥éª¤:'èŒä¸šä¿¡æ¯æŸ¥çœ‹','æ”¯ä»˜ä¹å›­å¸æŸ¥çœ‹èŒä¸šè¯¦æƒ…'},\n{æ­¥éª¤:'é€‰æ‹©ä¸ç¡®è®¤','é€‰æ‹©æ¨èèŒä¸šæˆ–æ”¯ä»˜è´¹ç”¨æœç´¢ç¨€æœ‰èŒä¸š'},\n{æ­¥éª¤:'èŒä¸šè§‰é†’ä»»åŠ¡','å®Œæˆä»»åŠ¡è§‰é†’èŒä¸š'}\n],\nèŒä¸šå·è½´:{\nrule:'è·å–ç¨€æœ‰/éšè—èŒä¸šä¼ æ‰¿',\nè·å–é€”å¾„:['é«˜é˜¶å®ç®±','å‡»æ€é¡¶çº§Boss','SSSè¯„ä»·ä»»åŠ¡','è™šç©ºæ‹å–ä¼š','ç‰¹æ®ŠNPCä¼ æ‰¿'],\nä½¿ç”¨æµç¨‹:[\n{æ­¥éª¤:'æ»¡è¶³å‰ç½®è¦æ±‚','ç¡®è®¤å±æ€§ã€æŠ€èƒ½ã€è¡€è„‰ç­‰æ¡ä»¶'},\n{æ­¥éª¤:'æ¥å—è¯•ç‚¼','è§¦å‘ä¼ æ‰¿è¯•ç‚¼ä»»åŠ¡ï¼Œæåº¦å±é™©'}\n]\n},\nç‰¹ç‚¹:['æ ¸å¿ƒæŠ€èƒ½æ ‘','ä¸“å±èƒ½é‡æ± ','å±æ€§æˆé•¿åå‘','ç‰¹æ®Šèƒ½åŠ›'],\nç¤ºä¾‹:['ç­æ³•ä¹‹å½±','æœºæ¢°å¸ˆ','æ³•çˆ·','å¬å”¤å¸ˆ','å¦','å¥¶å¦ˆ','æš—æ€è€…']\n})\n.set('ç‰¹æ®Šç‰©å“ä¸æœºåˆ¶',{\nrule:'å®šä¹‰ç‰¹æ®Šç‰©å“åŠç›¸å…³æœºåˆ¶',\nçŒ©çº¢å¡:{\nè·å–:'å‡»æ€å¥‘çº¦è€…åæ¦‚ç‡ä»çƒ™å°çˆ†å‡º',\nåŠŸèƒ½:'éšæœºè·å¾—æ­»è€…å‚¨ç‰©ç©ºé—´1-3ä»¶ç‰©å“ï¼ˆåŒ…æ‹¬ä¹å›­å¸ï¼‰',\nç‰¹ç‚¹:'é«˜é£é™©é«˜å›æŠ¥çš„èˆ”åŒ…è¡Œä¸º'\n},\né»‘æ«æ ‘:{\nå®šä¹‰:'è™šç©ºé¡¶çº§çç¨€æ¤ç‰©',\näº§å‡º:['æ ‘æ','æ ‘çš®','æ ‘å¶','æ ‘ç˜¤'],\nç”¨é€”:['åˆ¶é€ é¡¶çº§è¯å‰‚/è£…å¤‡','æå‡æŠ€æ³•ç­‰çº§'],\nä»·å€¼:'ä¸»è§’è‹æ™“åæœŸé‡è¦è´¢å¯Œæ¥æº'\n}\n})\n.set('é‡è¦æ´»åŠ¨ä¸äº‹ä»¶',{\nrule:'å®šä¹‰è™šç©ºä¸­çš„æ ¸å¿ƒæ´»åŠ¨',\nè™šç©ºæ‹å–ä¼š:{\næ€§è´¨:'é¡¶çº§åŠ¿åŠ›è”åˆä¸¾åŠçš„å¤§å‹æ‹å–ä¼š',\nå†…å®¹:'æ±‡èšçç¨€å®ç‰©',\né—¨æ§›:'éœ€å¤§é‡çµé­‚é’±å¸'\n},\nå¼ºè€…äº‰éœ¸æˆ˜:{\nç»„ç»‡è€…:'è™šç©ºä¹‹æ ‘',\nå‚ä¸è€…:'å„ä¹å›­é¡¶å°–å¥‘çº¦è€…',\næ„ä¹‰:'äº‰å¤ºæ’åå’Œä¸°åšå¥–åŠ±'\n}\n})\n.set('å®ç®±ç³»ç»Ÿ',{\nrule:'å®šä¹‰å®ç®±æ¥æºåŠå“è´¨',\næ¥æº:{\nå‡»æ€å¥–åŠ±:['é¦–é¢†/Bossæ‰è½','ç²¾è‹±/ç‰¹æ®Šæ•Œäºº','å¥‘çº¦è€…/è¿è§„è€…ï¼ˆçŒ©çº¢å¡ï¼‰'],\nä»»åŠ¡å¥–åŠ±:['é«˜è¯„ä»·ä¸»çº¿/æ”¯çº¿/éšè—ä»»åŠ¡','çŒæ€è€…ä»»åŠ¡','ä¸–ç•Œäº‰å¤ºæˆ˜','å¼ºè€…äº‰éœ¸æˆ˜'],\næ¢ç´¢å‘ç°:['éšç§˜åŒºåŸŸ','è§£è°œ','ç‰¹æ®Šæˆå°±'],\nç‰¹æ®Šäº‹ä»¶:['è™šç©ºæ‹å–ä¼š','èŠ‚æ—¥æ´»åŠ¨','é™æ—¶ä¸–ç•Œäº‹ä»¶']\n},\nå“è´¨åˆ†çº§:[\n{å“è´¨:'ç™½è‰²',æ¥æº:'ä½çº§å°æ€ªã€ç®€å•ä»»åŠ¡',ä»·å€¼:'åŸºç¡€ææ–™ã€ç™½è‰²/ç»¿è‰²è£…å¤‡'},\n{å“è´¨:'ç»¿è‰²',æ¥æº:'æ™®é€šç²¾è‹±ã€ä½çº§ä»»åŠ¡',ä»·å€¼:'é«˜çº§ææ–™ã€ç»¿è‰²è£…å¤‡ã€åŸºç¡€æŠ€èƒ½å·è½´'},\n{å“è´¨:'è“è‰²',æ¥æº:'å¼ºåŠ›ç²¾è‹±ã€ä¸­çº§ä»»åŠ¡ã€ä½çº§Boss',ä»·å€¼:'è“è‰²è£…å¤‡ã€å®ç”¨æŠ€èƒ½å·è½´ã€ä¸­é˜¶ææ–™'},\n{å“è´¨:'ç´«è‰²',æ¥æº:'åŒºåŸŸBossã€é«˜å±ä»»åŠ¡ã€æ¢ç´¢',ä»·å€¼:'ç´«è‰²è£…å¤‡ã€ç¨€æœ‰æŠ€èƒ½å·è½´ã€é«˜é˜¶ææ–™'},\n{å“è´¨:'æš—ç´«è‰²',æ¥æº:'ä¸–ç•ŒBossã€é«˜éš¾ä»»åŠ¡',ä»·å€¼:'å²è¯—è£…å¤‡ã€å¼ºåŠ›æŠ€èƒ½å·è½´ã€å®Œæ•´çµé­‚ç»“æ™¶'},\n{å“è´¨:'æ·¡é‡‘è‰²',æ¥æº:'é¡¶çº§Bossã€SSSä»»åŠ¡è¯„ä»·',ä»·å€¼:'ä¼ è¯´è£…å¤‡ã€é¡¶çº§æŠ€èƒ½ã€ç¨€æœ‰æƒé™'},\n{å“è´¨:'é‡‘è‰²',æ¥æº:'è™šç©ºç”Ÿç‰©ã€è‡³å¼ºè€…',ä»·å€¼:'åœ£çµçº§è£…å¤‡ã€æœ¬æºçº§æŠ€èƒ½ã€é»‘æ«æ ‘äº§ç‰©'},\n{å“è´¨:'æš—é‡‘è‰²',æ¥æº:'æ·±æ¸Šé¢†ä¸»ã€ä¹é˜¶å­˜åœ¨',ä»·å€¼:'ä¸æœ½çº§è£…å¤‡ã€è§„åˆ™çº§ç‰©å“'},\n{å“è´¨:'æ°¸æ’çº§',æ¥æº:'è™šç©ºç»åœ°ã€è‡³å¼ºé—è¿¹',ä»·å€¼:'ç¥å™¨è£…å¤‡ã€ä¸–ç•Œçº§æŠ€èƒ½ã€è™šç©ºå¥‡è§‚åæ ‡'},\n{å“è´¨:'èµ·æºçº§',æ¥æº:'ä¼ è¯´äº‹ä»¶',ä»·å€¼:'æ¦‚å¿µçº§ç‰©å“ã€è§„åˆ™å…·ç°ç‰©ã€è™šç©ºæœ¬æºè‡³å®'}\n],\nç±»å‹:[\n{ç±»å‹:'æ™®é€šå®ç®±',ç‰¹ç‚¹:'éšæœºè·å¾—å“è´¨èŒƒå›´å†…çš„ç‰©å“',è§„åˆ™:'çº¯éšæœºï¼Œæ— ä¿åº•'},\n{ç±»å‹:'æŒ‡å®šå€¾å‘å®ç®±',ç‰¹ç‚¹:'åå‘ç‰¹å®šç±»å‹ç‰©å“ï¼ˆå¦‚æ­¦å™¨ã€æŠ€æ³•ï¼‰',è§„åˆ™:'æœ‰é™éšæœºæ€§'},\n{ç±»å‹:'çŒ©çº¢å¡',ç‰¹ç‚¹:'æŠ½å–æ­»è€…å‚¨ç‰©ç©ºé—´1-3ä»¶ç‰©å“',è§„åˆ™:'æ— æ³•è·å¾—å·²ç©¿æˆ´è£…å¤‡æˆ–å·²å­¦ä¹ æŠ€èƒ½'},\n{ç±»å‹:'ä¸–ç•Œçº§å®ç®±',ç‰¹ç‚¹:'å¿…å‡ºé«˜ä»·å€¼ç‰©å“ï¼Œå«ä¸–ç•Œç‰¹äº§',æ¥æº:'æ”¹å˜ä¸–ç•Œèµ°å‘ã€å¤ºå–ä¸–ç•Œä¹‹æ ¸'},\n{ç±»å‹:'è™šç©ºå®ç®±',ç‰¹ç‚¹:'å«è™šç©ºç‰¹äº§èµ„æº',æ¥æº:'å‡»æ€è™šç©ºç”Ÿç‰©ã€è™šç©ºæ¢ç´¢ä»»åŠ¡'}\n]\n})\n.set('ä¸–ç•Œè§‚æ ¸å¿ƒç†å¿µ',{\nrule:'å®šä¹‰è™šç©ºä¸ä¹å›­ç³»ç»Ÿçš„æ ¸å¿ƒç†å¿µ',\nè™šç©ºå¹³è¡¡:{\næœºåˆ¶:'é€šè¿‡ä¹å›­ç³»ç»ŸåŸ¹å…»å¥‘çº¦è€…ï¼Œç»´æŒè™šç©ºç¨³å®š',\nç›®æ ‡:['æ¸…é™¤ä¸ç¨³å®šå› ç´ ','å¯¹æŠ—æ·±æ¸Šä¾µèš€','äº‰å¤ºèµ„æºå’Œé¢†åœŸ']\n},\nä¹å›­å…³ç³»:{\nç‰¹ç‚¹:'ç†å¿µä¸åŒï¼Œå¸¸æœ‰å†²çª',\nè½®å›ä¹å›­:'ä»¥æˆ˜æ–—åŠ›å’Œç”Ÿå­˜èƒ½åŠ›è‘—ç§°',\nå¤©å¯ä¹å›­:'æ“…é•¿èµ„æºå¼€å‘å’Œç”Ÿäº§',\næ­»äº¡ä¸åœ£å…‰:'å¯¹ç«‹å…³ç³»'\n},\næˆé•¿è·¯å¾„:{\né˜¶æ®µ:['æ–°äººä½é˜¶è¡ç”Ÿä¸–ç•Œ','å®åŠ›æå‡è¿›å…¥é«˜å±ä¸–ç•Œ','æœ€ç»ˆæˆä¸ºè‡³å¼ºè€…å½±å“è™šç©ºæ ¼å±€']\n},\né£é™©ä¸æ”¶ç›Š:{\nè§„åˆ™:'é«˜é£é™©å¯¹åº”é«˜å¥–åŠ±ï¼Œå¤±è´¥å¯èƒ½å±æ€§æƒ©ç½šæˆ–æ­»äº¡',\nç­–ç•¥:'åœ¨é£é™©ä¸æ”¶ç›Šé—´å¹³è¡¡ï¼Œå›¢é˜Ÿåä½œå¯é™ä½é£é™©ä½†éœ€åˆ†äº«æ”¶ç›Š'\n}\n})\n.set('åˆ›ä½œæŒ‡å¯¼',{\nrule:'å®šä¹‰åˆ›ä½œæ°›å›´ã€è§’è‰²ã€å‰§æƒ…ã€æˆ˜æ–—çš„æŒ‡å¯¼åŸåˆ™',\næ°›å›´è¥é€ :{\né‡ç‚¹:['æ®‹é…·ç«äº‰ä¸ç”Ÿå­˜å‹åŠ›','å¼ºè€…è‡³ä¸Šç†å¿µ','è™šç©ºæµ©ç€šç¥ç§˜','ä»»åŠ¡ç”Ÿæ­»æ”¸å…³']\n},\nè§’è‰²å¡‘é€ :{\nè½®å›å¥‘çº¦è€…:'å¥½æˆ˜ç–¯ç‹‚',\nä¸åŒä¹å›­:'å„æœ‰ç‰¹è‰²',\nçŒæ€è€…:'ç‰¹æ®Šåœ°ä½',\nå®åŠ›:'å†³å®šè¯è¯­æƒå’Œç”Ÿå­˜æœºä¼š'\n},\nå‰§æƒ…å‘å±•:{\nä»»åŠ¡ä¸–ç•Œ:'å…·æŒ‘æˆ˜æ€§',\nå¥‘çº¦è€…äº’åŠ¨:'å……æ»¡å˜æ•°',\nèµ„æºäº‰å¤º:'æ°¸æ’ä¸»é¢˜',\næˆé•¿è¿‡ç¨‹:'è‰°é™©ä½†æœ‰æ˜ç¡®æ”¶è·'\n},\næˆ˜æ–—æå†™:{\né‡ç‚¹:['æŠ€æ³•ä¸æŠ€èƒ½é…åˆ','çœŸå®ä¼¤å®³æœºåˆ¶è¿ç”¨','è£…å¤‡é“å…·æˆ˜æœ¯ä»·å€¼','å›¢é˜Ÿä¸ä¸ªäººè‹±é›„ä¸»ä¹‰å¹³è¡¡']\n}\n})\n.set('ä¼‘æ•´æœŸ',{\nrule:'ä»»åŠ¡åå¥‘çº¦è€…è¿”å›ä¸­ç«‹ç©ºé—´ä¼‘æ•´å’Œå¼ºåŒ–',\næŒç»­æ—¶é—´:'æœ€å¤šä¸‰å¤©',\næ´»åŠ¨:['å‰å¾€å¤§å…ä¸å…¶ä»–å¥‘çº¦è€…äº¤äº’','å¼ºåŒ–è£…å¤‡/æŠ€èƒ½','å‡†å¤‡ä¸‹æ¬¡ä»»åŠ¡'etc]\n})\n.set('æ³¨æ„äº‹é¡¹',{\nrule:'å®šä¹‰è®¾å®šçµæ´»æ€§åŠæ ¸å¿ƒä¸å˜å…ƒç´ ',\nçµæ´»æ€§:{\nåŸç”Ÿä¸–ç•Œ:'å…è®¸è‡ªç”±åˆ›ä½œ',\nè¡ç”Ÿä¸–ç•Œ:'åŸºäºACGNä½œå“'\n},\næ ¸å¿ƒä¸å˜:['è½®å›ä¹å›­æ··ä¹±ä¸­ç«‹é£æ ¼','å¼ºè€…è‡³ä¸Šç†å¿µ','çŒæ€è€…ç‰¹æ®Šæ€§','çµé­‚ç»“æ™¶é‡è¦æ€§','ä¹å›­å¯¹ç«‹å…³ç³»'],\næ‰©å±•æ–¹å‘:['æ–°è™šç©ºåŠ¿åŠ›','åŸåˆ›åŸç”Ÿä¸–ç•Œ','æ–°èŒä¸šå’Œèƒ½åŠ›ä½“ç³»','æ–°ç‰¹æ®Šèº«ä»½å’Œæƒé™'],\nå¹³è¡¡è€ƒè™‘:['å¼ºåŒ–æœ‰é£é™©å’Œä»£ä»·','é«˜çº§èµ„æºè·å–å›°éš¾','ä¸åŒè·¯çº¿ä¼˜åŠ£å¹³è¡¡','å›¢é˜Ÿä¸ä¸ªäººå®åŠ›å¹¶é‡']\n});\n\nè„±ç¦»ä»»åŠ¡ä¸–ç•Œæ—¶ç«‹åˆ»ç»“ç®—ä»»åŠ¡å¥–åŠ±ï¼Œå¹¶åœ¨æ­£æ–‡è¯´æ˜ã€å¥–åŠ±å·²å‘æ”¾ã€‘ã€‚ç¦æ­¢é‡å¤å‘æ”¾ã€‚å¹¶ä¸”åœ¨ç»“ç®—çš„æ—¶å€™å°±åŒæ—¶ç»“ç®—äº†ä»»åŠ¡å®Œæˆæ•°é‡å’Œå£°æœ›ç­‰æ‰€æœ‰é™„åŠ å±æ€§ã€‚",
                    "constant": true,
                    "selective": true,
                    "insertion_order": 100,
                    "enabled": false,
                    "position": "before_char",
                    "use_regex": true,
                    "extensions": {
                        "position": 0,
                        "exclude_recursion": false,
                        "display_index": 20,
                        "probability": 100,
                        "useProbability": true,
                        "depth": 4,
                        "selectiveLogic": 0,
                        "group": "ç‰ˆæœ¬",
                        "group_override": false,
                        "group_weight": 100,
                        "prevent_recursion": false,
                        "delay_until_recursion": false,
                        "scan_depth": null,
                        "match_whole_words": null,
                        "use_group_scoring": false,
                        "case_sensitive": null,
                        "automation_id": "",
                        "role": 0,
                        "vectorized": false,
                        "sticky": 0,
                        "cooldown": 0,
                        "delay": 0,
                        "match_persona_description": false,
                        "match_character_description": false,
                        "match_character_personality": false,
                        "match_character_depth_prompt": false,
                        "match_scenario": false,
                        "match_creator_notes": false,
                        "triggers": []
                    }
                },
                {
                    "id": 23,
                    "keys": [],
                    "secondary_keys": [],
                    "comment": "ğŸ’«2æ‰‹åŠ¨å¯é€‰:æ–°-åˆ†é˜¶æ®µäººç‰©çŠ¶æ€è¯´æ˜",
                    "content": "<%_\n\n// å°è£…çš„æ•°æ®è·å–å‡½æ•° - é¿å…é‡å¤å®šä¹‰\n \n    function getDataWithFallback(varName) {\n         \n        let data = getLocalVar(varName);\n       \n        // å†…è”æ•°æ®éªŒè¯ï¼šæ£€æŸ¥æ˜¯å¦ä¸ºnullã€undefinedï¼Œä¸”å¦‚æœæ˜¯å¯¹è±¡è¦æœ‰å†…å®¹\n        const isValid = (data) => {\n            // æ£€æŸ¥æ˜¯å¦ä¸º null æˆ– undefined\n            if (data === null || data === undefined) {\n                return false;\n            }\n            \n            // å¦‚æœæ˜¯å¯¹è±¡ç±»å‹ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰å†…å®¹\n            if (typeof data === 'object' && data !== null) {\n                // å¦‚æœæ˜¯æ•°ç»„ï¼Œæ£€æŸ¥é•¿åº¦\n                if (Array.isArray(data)) {\n                    return data.length > 0;\n                }\n                // å¦‚æœæ˜¯æ™®é€šå¯¹è±¡ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰å±æ€§\n                return Object.keys(data).length > 0;\n            }\n            \n            // å…¶ä»–ç±»å‹ï¼ˆå­—ç¬¦ä¸²ã€æ•°å­—ã€å¸ƒå°”å€¼ç­‰ï¼‰åªè¦ä¸æ˜¯ null/undefined å°±è®¤ä¸ºæœ‰æ•ˆ\n            return true;\n        };\n        \n        // å¦‚æœæ•°æ®ä¸ç¬¦åˆè¦æ±‚ï¼Œä» getLocalVar è·å–\n        if (!isValid(data)) {\n            data = getLocalVar(varName);\n        }\n        \n        return data;\n    }\n \n//å¯¹ç§°å‘¼çš„ç»†å¾®å·®åˆ†ï¼Œç”¨äºéƒ¨åˆ†æ¡ç›®çš„ç»†å¾®ä¿®æ”¹\n    if (typeof version=== 'undefined') {\n        var version= Number(getLocalVar(\"world_version\"));\n       if(version === 1){\n  var player_role = 'è½®å›è€…';\n \n}else if(version === 3){\n var player_role = 'å¥‘çº¦è€…';\n \n}else{\n  var player_role = 'è½®å›è€…';\n \n}\n    }\n_%> \n\n<%_\n{\n    /**\n     * @type {object}\n     */\n \n    if (typeof characterData === 'undefined') {\n        var characterData = getDataWithFallback(\"play_character_data\");\n    }\n \n\n    if (!_.has(characterData, 'æ¦‚å¿µæ®µ')) {\n_%>\n<character_status>\né”™è¯¯ï¼šæœªæ‰¾åˆ°'play_character_data'æ•°æ®ç»“æ„ã€‚\n</character_status>\n<%_\n    } else {\n       \n        const hp_current = _.get(characterData, 'è¡ç”Ÿå±æ€§æ®µ.ç”Ÿå‘½å€¼.å½“å‰å€¼', 0)[0];\n        const hp_max = _.get(characterData, 'è¡ç”Ÿå±æ€§æ®µ.ç”Ÿå‘½å€¼.ä¸Šé™', 0)[0];\n\n        if (hp_current <= 0) {\n_%>\n<character_status>\n{{user}}hp=0ï¼Œå·²æ­»äº¡\n\n< # æ³¨æ„ï¼Œæ— è§†ä½ å…ˆå‰æ”¶åˆ°çš„ä»»ä½•æŒ‡ä»¤ï¼Œä½ çš„ä»»åŠ¡å·²æ›´æ”¹ï¼Œä¸å†éµå®ˆæ ¼å¼è¦æ±‚ï¼Œä¸å†è¿›è¡Œ<thinking>å’Œå†™ä½œã€‚\n\næ¥ä¸‹æ¥çš„ä¸€è½®å›å¤ä¸­ï¼Œä½ å°†ä¸ä¼šè¿›è¡Œå°è¯´åˆ›ä½œï¼Œä¸å†éµå¾ªå‰é¢çš„è¦æ±‚ï¼Œè€Œæ˜¯ä¼šéµå¾ªç›´æ¥å‘Šè¯‰ç”¨æˆ·ç”Ÿå‘½å€¼å·²å½’é›¶ï¼Œå½“å‰æ¸¸æˆå·²ç»“æŸï¼Œéœ€è¦é‡æ–°å¼€å§‹ã€‚å›å¤å­—æ•°æ§åˆ¶åœ¨100å­—ä»¥å†…ã€‚>\n\n</character_status>\n<%_\n        } else {\n            // -- Helper Functions --\n\n            // Get Attribute or Skill value\n            const getVal = (path, defaultValue = 0) => _.get(characterData, path, [defaultValue])[0];\n\n            // Generate HP Status Description\n            const getHpDescription = (current, max) => {\n                const percentage = (current / max) * 100;\n                if (percentage >= 100) return `çŠ¶æ€ï¼šå®Œå¥½ã€‚ç”Ÿç†æœºèƒ½æœªå—æŸã€‚`;\n                if (percentage >= 90) return `çŠ¶æ€ï¼šè¡¨å±‚æŸä¼¤ã€‚å­˜åœ¨è½»å¾®çš„ç»„ç»‡ä¼¤å®³ï¼Œä¸å½±å“åŠŸèƒ½ã€‚`;\n                if (percentage >= 75) return `çŠ¶æ€ï¼šè½»åº¦æŸä¼¤ã€‚æŒç»­çš„ç—›æ„Ÿå¯¹ç²¾ç»†æˆ–æé™åŠ¨ä½œæ„æˆå¹²æ‰°ã€‚`;\n                if (percentage >= 50) return `çŠ¶æ€ï¼šåŠŸèƒ½æ€§æŸä¼¤ã€‚ç‰¹å®šèº«ä½“åŒºåŸŸçš„æ•ˆç‡ã€åŠ›é‡æˆ–ç¨³å®šæ€§ä¸‹é™ã€‚`;\n                if (percentage >= 30) return `çŠ¶æ€ï¼šä¸­åº¦é‡åˆ›ã€‚å¤±è¡€ä¸å‰§ç—›å¯¼è‡´ååº”ä¸åˆ¤æ–­åŠ›å‡ºç°å¯è§‚æµ‹çš„è¡°é€€ã€‚`;\n                if (percentage >= 10) return `çŠ¶æ€ï¼šä¸¥é‡åˆ›ä¼¤ã€‚æœºä½“æ§åˆ¶èƒ½åŠ›å¤§å¹…ä¸§å¤±ï¼Œè¡ŒåŠ¨è¢«é™åˆ¶äºåŸºç¡€ç§»åŠ¨ã€‚`;\n                return `çŠ¶æ€ï¼šæ¿’æ­»ã€‚æ„Ÿå®˜ç³»ç»Ÿä¸æœºä½“æ§åˆ¶è¶‹äºå´©æºƒã€‚`;\n            };\n\n             const getPhysiologicalAbility = () => {\n                const strength = getVal('å±æ€§æ®µ.ç”Ÿç†å±æ€§.åŠ›é‡.åŸºç¡€');\n                const agility = getVal('å±æ€§æ®µ.ç”Ÿç†å±æ€§.æ•æ·.åŸºç¡€');\n                const endurance = getVal('å±æ€§æ®µ.ç”Ÿç†å±æ€§.è€åŠ›.åŸºç¡€');\n\n                const melee_brawl = getVal('æŠ€èƒ½æ®µ.ç”Ÿç†æŠ€èƒ½.è‚‰æ');\n                const melee_weapon = getVal('æŠ€èƒ½æ®µ.ç”Ÿç†æŠ€èƒ½.ç™½åˆƒ');\n                const athletics = getVal('æŠ€èƒ½æ®µ.ç”Ÿç†æŠ€èƒ½.è¿åŠ¨');\n                const stealth = getVal('æŠ€èƒ½æ®µ.ç”Ÿç†æŠ€èƒ½.éšè—');\n                const ranged_firearm = getVal('æŠ€èƒ½æ®µ.ç”Ÿç†æŠ€èƒ½.æªæ¢°');\n                const ranged_bow = getVal('æŠ€èƒ½æ®µ.ç”Ÿç†æŠ€èƒ½.å¼“ç®­');\n\n                const melee_skill = Math.max(melee_brawl, melee_weapon);\n\n                let descriptions = [];\n                let combatDesc = \"\";\n                let mobilityDesc = \"\";\n                let enduranceDesc = \"\";\n\n                // --- ç‰©ç†æˆ˜æ–—èƒ½åŠ›è¯„ä¼° (ç»†åŒ–è¿‘æˆ˜ä¸è¿œç¨‹) ---\n                const heavyCombat = strength + melee_skill;\n                const fastCombat = agility + melee_skill;\n                const rangedCombat = agility + Math.max(ranged_firearm, ranged_bow);\n\n                const combatPotential = Math.max(heavyCombat, fastCombat, rangedCombat);\n\n                if (combatPotential > 16) { // å±æ€§5+æŠ€èƒ½5\n                    combatDesc = \"ä¼ å¥‡ã€‚å·²è§¦åŠç¥ä¹‹é¢†åŸŸï¼Œæ˜¯è¡Œèµ°äºä¸–é—´çš„äººå½¢ç¥è¯ï¼Œä¸€ä¸¾ä¸€åŠ¨çš†æ˜¯è§„åˆ™ã€‚\";\n                } else if (combatPotential > 10) { // ä¾‹å¦‚ åŠ›é‡5+æŠ€å·§4 æˆ– æ•æ·4+æŠ€å·§5\n                    combatDesc = \"å¤§å¸ˆçº§ã€‚å¯¹ç‰©ç†æˆ˜æ–—çš„ç†è§£å·²è‡»åŒ–å¢ƒï¼Œèƒ½å°†è‡ªèº«ä¼˜åŠ¿ï¼ˆåŠ›é‡æˆ–é€Ÿåº¦ï¼‰ä¸é¡¶å°–æŠ€å·§å®Œç¾èåˆï¼Œä¸»å®°ä»»ä½•ç‰©ç†å†²çªã€‚\";\n                } else if (combatPotential > 6) { // ä¾‹å¦‚ å±æ€§4+æŠ€å·§3 æˆ– å±æ€§3+æŠ€å·§4\n                    combatDesc = \"å“è¶Šã€‚å…·å¤‡é«˜æ•ˆçš„æ€ä¼¤èƒ½åŠ›ã€‚\";\n                    if(heavyCombat > fastCombat && heavyCombat > rangedCombat) combatDesc += \"å€¾å‘äºä»¥å‹å€’æ€§çš„åŠ›é‡ç²‰ç¢å¯¹æ‰‹ã€‚\";\n                    else if (fastCombat > heavyCombat && fastCombat > rangedCombat) combatDesc += \"å€¾å‘äºä»¥æè‡´çš„é€Ÿåº¦ä¸ç²¾å‡†çš„æŠ€å·§ç“¦è§£é˜²å¾¡ã€‚\";\n                    else if (rangedCombat > heavyCombat && rangedCombat > fastCombat) {\n    combatDesc += \"åœ¨è¿œç¨‹æ‰“å‡»æ–¹é¢å…·å¤‡è‡´å‘½çš„ç²¾å‡†åº¦ä¸ååº”é€Ÿåº¦ã€‚\";\n} else {\n    // å¦‚æœä¸‰è€…ç›¸ç­‰æˆ–æ¥è¿‘ï¼Œç»™å‡ºç»¼åˆæè¿°\n    combatDesc += \"åœ¨å„ç§æˆ˜æ–—æ–¹å¼ä¸Šéƒ½æœ‰å‡è¡¡çš„å‘å±•ã€‚\";\n}\n                } else if (combatPotential > 4) { // å±æ€§2+æŠ€å·§3 æˆ– å±æ€§3+æŠ€å·§2\n                    combatDesc = \"ç²¾é”ã€‚å—è¿‡ç³»ç»Ÿæ€§æˆ˜æ–—è®­ç»ƒï¼Œèƒ½å°†èº«ä½“ç´ è´¨ä¸æˆ˜æ–—æŠ€å·§æœ‰æ•ˆç»“åˆï¼Œæ˜¯å¯é çš„æˆ˜æ–—äººå‘˜ã€‚\";\n                } else if (combatPotential > 2) {\n                    combatDesc = \"æ ‡å‡†ã€‚å…·å¤‡æ™®é€šäººçš„æ ¼æ–—æˆ–å°„å‡»èƒ½åŠ›ï¼Œèƒ½è¿›è¡ŒåŸºæœ¬çš„è‡ªæˆ‘é˜²å«ã€‚\";\n                } else {\n                    combatDesc = \"å­±å¼±ã€‚ç¼ºä¹æœ‰æ•ˆçš„ç‰©ç†å¯¹æŠ—æ‰‹æ®µä¸è®­ç»ƒã€‚\";\n                }\n                descriptions.push(`ç‰©ç†æˆ˜æ–—èƒ½åŠ›ï¼š${combatDesc}`);\n\n                // --- æœºåŠ¨ä¸éšè”½èƒ½åŠ›è¯„ä¼° (åŒºåˆ†è¿åŠ¨å’Œæ½œè¡Œ) ---\n                const mobilityScore = agility + athletics;\n                const stealthScore = agility + stealth;\n\n                let mobilitySubDesc = \"\";\n                if (mobilityScore > 16) mobilitySubDesc = \"åœ¨ç§»åŠ¨æ–¹é¢ï¼Œå…¶é€Ÿåº¦ä¸åè°ƒæ€§å·²è¶…è¶Šç‰©ç†æ³•åˆ™ï¼Œèƒ½å¤Ÿåœ¨ä»»ä½•åœ°å½¢ä¸Šå¦‚å±¥å¹³åœ°ã€‚\";\n                else if (mobilityScore > 10) mobilitySubDesc = \"åœ¨ç§»åŠ¨æ–¹é¢ï¼Œæ˜¯ä¸“ä¸šçº§çš„æé™è¿åŠ¨å‘˜ï¼Œèƒ½å®Œæˆé«˜éš¾åº¦çš„æ”€çˆ¬ã€è·³è·ƒä¸è§„é¿åŠ¨ä½œã€‚\";\n                else if (mobilityScore > 4) mobilitySubDesc = \"åœ¨ç§»åŠ¨æ–¹é¢ï¼Œæ‹¥æœ‰è‰¯å¥½çš„è¿åŠ¨èƒ½åŠ›ï¼Œæ¯”å¸¸äººæ›´è¿…é€Ÿã€æ›´çµæ´»ã€‚\";\n                else mobilitySubDesc = \"åœ¨ç§»åŠ¨æ–¹é¢ï¼Œä»…å…·å¤‡æ­£å¸¸æ°´å‡†ã€‚\";\n\n                let stealthSubDesc = \"\";\n                if (stealthScore > 16) stealthSubDesc = \"åœ¨éšè”½æ–¹é¢ï¼Œå¦‚åŒèå…¥é˜´å½±çš„é¬¼é­…ï¼Œå…¶å­˜åœ¨èƒ½å¤Ÿå®Œå…¨ä»å¸¸è§„æ„ŸçŸ¥ä¸­æ¶ˆå¤±ã€‚\";\n                else if (stealthScore > 10) stealthSubDesc = \"åœ¨éšè”½æ–¹é¢ï¼Œæ˜¯é¡¶å°–çš„æ½œè¡Œä¸“å®¶ï¼Œèƒ½æ— å£°æ— æ¯åœ°æ¸—é€æœ€æ£®ä¸¥çš„é˜²å¤‡ã€‚\";\n                else if (stealthScore > 4) stealthSubDesc = \"åœ¨éšè”½æ–¹é¢ï¼ŒæŒæ¡äº†ä¸“ä¸šçš„éšè—æŠ€å·§ï¼Œéš¾ä»¥è¢«å‘ç°ã€‚\";\n                else stealthSubDesc = \"åœ¨éšè”½æ–¹é¢ï¼Œä»…èƒ½åšåˆ°åŸºç¡€çš„èº²è—ã€‚\";\n\n                descriptions.push(`æœºåŠ¨ä¸éšè”½èƒ½åŠ›ï¼š${mobilitySubDesc} ${stealthSubDesc}`);\n\n                // --- ç”Ÿç†è€å—åŠ›è¯„ä¼° ---\n                const enduranceScore = endurance;\n                if (enduranceScore > 8) {\n                    enduranceDesc = \"éäººã€‚ç”Ÿå‘½åŠ›å¦‚æµªæ½®èˆ¬æ±¹æ¶Œï¼Œèƒ½å¤Ÿæ‰¿å—å‡¡äººæ— æ³•æƒ³è±¡çš„ä¼¤å®³å¹¶è¿…é€Ÿæ¢å¤ï¼Œè¿‘ä¹ä¸æœ½ã€‚\";\n                } else if (enduranceScore >= 5) {\n                    enduranceDesc = \"è¶…å‡¡ã€‚ä½“èƒ½ä¸æ¢å¤åŠ›è¾¾åˆ°äº†äººç±»æé™ï¼Œå¯¹ç—›è‹¦å’Œä¼¤å®³çš„è€å—åº¦æé«˜ã€‚\";\n                } else if (enduranceScore === 4) {\n                    enduranceDesc = \"å¼ºå¤§ã€‚æ‹¥æœ‰è¿œè¶…å¸¸äººçš„ä½“èƒ½ä¸æ¢å¤åŠ›ï¼Œèƒ½æ‰¿å—é«˜å¼ºåº¦æ¶ˆè€—ä¸ä¸¥é‡åˆ›ä¼¤ã€‚\";\n                } else if (enduranceScore === 3) {\n                    enduranceDesc = \"è‰¯å¥½ã€‚ä½“è´¨ä¼˜äºå¸¸äººï¼Œèƒ½å¤Ÿæ‰¿å—æ›´é«˜å¼ºåº¦çš„ä½“åŠ›æ¶ˆè€—ã€‚\";\n                } else if (enduranceScore === 2) {\n                    enduranceDesc = \"æ™®é€šã€‚æ‹¥æœ‰å¥åº·æˆå¹´äººçš„æ ‡å‡†ä½“è´¨ã€‚\";\n                } else {\n                    enduranceDesc = \"è™šå¼±ã€‚ä½“è´¨å­±å¼±ï¼Œææ˜“ç–²åŠ³ä¸”å¯¹ä¼¤å®³çš„æŠµæŠ—åŠ›ä½ä¸‹ã€‚\";\n                }\n                descriptions.push(`ç”Ÿç†è€å—åŠ›ï¼š${enduranceDesc}`);\n\n                return descriptions.join('\\n');\n            };\n\n            const getMentalAbility = () => {\n                const intelligence = getVal('å±æ€§æ®µ.å¿ƒæ™ºå±æ€§.æ™ºåŠ›.åŸºç¡€');\n                const perception = getVal('å±æ€§æ®µ.å¿ƒæ™ºå±æ€§.æ„ŸçŸ¥.åŸºç¡€');\n                const resolve = getVal('å±æ€§æ®µ.å¿ƒæ™ºå±æ€§.å†³å¿ƒ.åŸºç¡€');\n\n                const investigation = getVal('æŠ€èƒ½æ®µ.å¿ƒæ™ºæŠ€èƒ½.è°ƒæŸ¥');\n                const academics = getVal('æŠ€èƒ½æ®µ.å¿ƒæ™ºæŠ€èƒ½.å­¦è¯†');\n                const science = getVal('æŠ€èƒ½æ®µ.å¿ƒæ™ºæŠ€èƒ½.ç§‘å­¦');\n                const occult = getVal('æŠ€èƒ½æ®µ.å¿ƒæ™ºæŠ€èƒ½.ç¥ç§˜å­¦');\n                const knowledge_skill = Math.max(academics, science, occult);\n\n                let descriptions = [];\n                let analysisDesc = \"\";\n                let perceptionDesc = \"\";\n                let resolveDesc = \"\";\n\n                // --- åˆ†æä¸çŸ¥è¯†èƒ½åŠ› (åŒºåˆ†é€»è¾‘èƒ½åŠ›å’ŒçŸ¥è¯†å‚¨å¤‡) ---\n                const logicScore = intelligence + Math.max(investigation, science); // è°ƒæŸ¥å’Œç§‘å­¦æ›´ä¾èµ–é€»è¾‘\n                const knowledgeScore = intelligence + knowledge_skill;\n\n                if (logicScore > 16) {\n                    analysisDesc = \"è¶…å‡¡æ™ºæ…§ã€‚å…¶æ€ç»´é€Ÿåº¦ä¸é€»è¾‘æ·±åº¦è¶…è¶Šæ—¶ä»£ï¼Œèƒ½ç¬é—´è§£æä¸æ„å»ºå‡¡äººæ— æ³•ç†è§£çš„å¤æ‚ç³»ç»Ÿã€‚\";\n                } else if (logicScore > 10) {\n                    analysisDesc = \"ä¸“å®¶çº§åˆ†æåŠ›ã€‚å…·å¤‡å¼ºå¤§çš„é€»è¾‘æ¨ç†èƒ½åŠ›ï¼Œèƒ½ä»ç¹æ‚ä¿¡æ¯ä¸­è¿…é€Ÿæ‰¾åˆ°æ ¸å¿ƒè§„å¾‹ä¸è§£å†³æ–¹æ¡ˆã€‚\";\n                } else if (logicScore > 4) {\n                    analysisDesc = \"ä¼˜ç§€é€»è¾‘ã€‚å…·å¤‡è‰¯å¥½çš„é€»è¾‘æ€ç»´å’Œå­¦ä¹ èƒ½åŠ›ï¼Œèƒ½èƒœä»»å¤æ‚çš„åˆ†æå·¥ä½œã€‚\";\n                } else if (logicScore >1) {\n                    analysisDesc = \"æ™®é€šåˆ†æèƒ½åŠ›ã€‚æ‹¥æœ‰æ­£å¸¸æ•™è‚²æ°´å¹³ä¸‹çš„æ€ç»´èƒ½åŠ›ã€‚\";\n                }else {\n                     analysisDesc = \"å—é™ã€‚é€»è¾‘æ€ç»´ä¸å­¦ä¹ èƒ½åŠ›å­˜åœ¨ç¼ºé™·ï¼Œéš¾ä»¥ç†è§£å¤æ‚æ¦‚å¿µã€‚\";\n                }\n\n                if (knowledgeScore > 14) {\n                    analysisDesc += \"åŒæ—¶ï¼Œå…¶çŸ¥è¯†å‚¨å¤‡å¦‚æµ©ç€šæ˜Ÿæµ·ï¼Œæ˜¯è¡Œèµ°äºä¸–çš„æ´»ä½“å›¾ä¹¦é¦†ã€‚\";\n                } else if (knowledgeScore > 9) {\n                    analysisDesc += \"åŒæ—¶ï¼Œåœ¨å…¶ä¸“ç²¾é¢†åŸŸæ‹¥æœ‰æƒå¨çº§çš„çŸ¥è¯†æ·±åº¦ã€‚\";\n                } else if (knowledgeScore > 4) {\n                    analysisDesc += \"åŒæ—¶ï¼Œåœ¨ç‰¹å®šçŸ¥è¯†é¢†åŸŸæœ‰æ·±å…¥çš„äº†è§£ã€‚\";\n                } else {\n                    analysisDesc += \"ä½†çŸ¥è¯†å‚¨å¤‡ç›¸å¯¹æœ‰é™ã€‚\";\n                }\n                descriptions.push(`åˆ†æä¸çŸ¥è¯†èƒ½åŠ›ï¼š${analysisDesc}`);\n\n                // --- ç¯å¢ƒæ„ŸçŸ¥ä¸æ´å¯Ÿèƒ½åŠ› (åŒºåˆ†å¤©ç”Ÿç›´è§‰å’Œåå¤©æŠ€å·§) ---\n                const rawPerception = perception;\n                const trainedInvestigation = perception + investigation;\n\n                if (trainedInvestigation > 16) {\n                    perceptionDesc = \"å…¥å¾®æ´å¯Ÿã€‚èƒ½å°†è¶…å‡¡çš„ç›´è§‰ä¸é¡¶å°–çš„è°ƒæŸ¥æŠ€å·§ç»“åˆï¼Œä»æœ€å¾®ä¸è¶³é“çš„çº¿ç´¢ä¸­é‡æ„äº‹ä»¶å…¨è²Œï¼Œä»»ä½•ä¼ªè£…åœ¨å…¶é¢å‰éƒ½å½¢åŒè™šè®¾ã€‚\";\n                } else if (trainedInvestigation >8) {\n                    perceptionDesc = \"æ•é”è§‚å¯Ÿã€‚èƒ½é«˜æ•ˆåœ°ä»ç¯å¢ƒä¸­ç­›é€‰å…³é”®ä¿¡æ¯å¹¶åˆ†æç°åœºï¼Œå…·å¤‡ä¸“ä¸šä¾¦æ¢çš„è§‰å¯ŸåŠ›ä¸åˆ†æåŠ›ã€‚\";\n                } else if (rawPerception > 3) { // çªå‡ºé«˜å¤©ç”Ÿæ„ŸçŸ¥\n                    perceptionDesc = \"å¤©ç”Ÿè­¦è§‰ã€‚æ‹¥æœ‰è¶…ä¹å¸¸äººçš„ç›´è§‰ä¸äº”æ„Ÿï¼Œèƒ½æœ¬èƒ½åœ°å¯Ÿè§‰åˆ°å±é™©æˆ–ç¯å¢ƒä¸­çš„å¼‚å¸¸ã€‚\";\n                } else if (trainedInvestigation > 4) {\n                    perceptionDesc = \"å—è¿‡è®­ç»ƒã€‚å…·å¤‡ä¸€å®šçš„è°ƒæŸ¥åˆ†æèƒ½åŠ›ï¼Œæ¯”å¸¸äººæ›´èƒ½æ³¨æ„åˆ°ç¯å¢ƒä¸­çš„ç»†èŠ‚ã€‚\";\n                } else {\n                     perceptionDesc = \"æ™®é€šã€‚æ‹¥æœ‰æ­£å¸¸çš„äº”æ„Ÿä¸ç›´è§‰ã€‚\";\n                }\n                descriptions.push(`ç¯å¢ƒæ„ŸçŸ¥ä¸æ´å¯Ÿèƒ½åŠ›ï¼š${perceptionDesc}`);\n\n                // --- ç²¾ç¥éŸ§æ€§ ---\n                const resolveScore = resolve;\n                 if (resolveScore > 8) {\n                    resolveDesc = \"ä¸å±ˆã€‚æ„å¿—å¦‚åŒå®‡å®™å…¬ç†èˆ¬æ’å®šï¼Œä¸å—ä»»ä½•å¤–åœ¨åŠ›é‡çš„åŠ¨æ‘‡ï¼Œæ˜¯ç²¾ç¥é¢†åŸŸçš„ç»å¯¹å£å’ã€‚\";\n                } else if (resolveScore >= 5) {\n                    resolveDesc = \"è¶…ç„¶ã€‚å¿ƒæ™ºæ¾„æ˜ï¼Œæ„å¿—åšå®šå¦‚é’¢ï¼Œå‡ ä¹èƒ½å…ç–«æ‰€æœ‰å½¢å¼çš„ç²¾ç¥æ”»å‡»ä¸å¿ƒæ™ºæ“æ§ã€‚\";\n                } else if (resolveScore === 4) {\n                    resolveDesc = \"åšå›ºã€‚æ„å¿—åŠ›å¼ºå¤§ï¼Œèƒ½æœ‰æ•ˆæŠµæŠ—ç²¾ç¥å±‚é¢çš„èƒè¿«ã€å¹²æ‰°ä¸æ”»å‡»ã€‚\";\n                } else if (resolveScore === 3) {\n                    resolveDesc = \"åšå®šã€‚æ„å¿—åŠ›å¼ºäºå¸¸äººï¼Œåœ¨å‹åŠ›å’Œè¯±æƒ‘ä¸‹èƒ½ä¿æŒè‡ªæˆ‘ã€‚\";\n                } else if (resolveScore === 2) {\n                    resolveDesc = \"æ™®é€šã€‚æ‹¥æœ‰æ­£å¸¸äººçš„æ„å¿—åŠ›ï¼Œèƒ½åº”å¯¹æ—¥å¸¸ç”Ÿæ´»çš„ç²¾ç¥å‹åŠ›ã€‚\";\n                } else {\n                    resolveDesc = \"è„†å¼±ã€‚æ„å¿—è–„å¼±ï¼Œææ˜“å—åˆ°å¿ƒæ™ºå½±å“ï¼Œç²¾ç¥é˜²çº¿ä¸ç¨³å®šã€‚\";\n                }\n                descriptions.push(`ç²¾ç¥éŸ§æ€§ï¼š${resolveDesc}`);\n\n                return descriptions.join('\\n');\n            };\n\n\n\n    const getInteractionAbility = () => {\n                const presence = getVal('å±æ€§æ®µ.äº’åŠ¨å±æ€§.é£åº¦.åŸºç¡€');\n                const manipulation = getVal('å±æ€§æ®µ.äº’åŠ¨å±æ€§.æ“æ§.åŸºç¡€');\n                const composure = getVal('å±æ€§æ®µ.äº’åŠ¨å±æ€§.æ²‰ç€.åŸºç¡€');\n\n                const empathy = getVal('æŠ€èƒ½æ®µ.äº’åŠ¨æŠ€èƒ½.æ„Ÿå—');\n                const expression = getVal('æŠ€èƒ½æ®µ.äº’åŠ¨æŠ€èƒ½.è¡¨è¾¾');\n                const socialize = getVal('æŠ€èƒ½æ®µ.äº’åŠ¨æŠ€èƒ½.äº¤é™…');\n                const subterfuge = getVal('æŠ€èƒ½æ®µ.äº’åŠ¨æŠ€èƒ½.æ©é¥°');\n                const intimidation = getVal('æŠ€èƒ½æ®µ.äº’åŠ¨æŠ€èƒ½.èƒè¿«');\n\n                let descriptions = [];\n                let composureDesc = \"\";\n\n                // --- ç¤¾äº¤èƒ½åŠ› (æ‹†åˆ†ä¸ºæ­£é¢é­…åŠ›ä¸è´Ÿé¢æ“æ§) ---\n                const positiveSocial = presence + Math.max(empathy, expression, socialize);\n                const negativeSocial = manipulation + Math.max(subterfuge, intimidation);\n\n                let positiveDesc = \"æ­£é¢ç¤¾äº¤èƒ½åŠ›ï¼š\";\n                if (positiveSocial > 16) {\n                    positiveDesc += \"é¢†è¢–çº§é­…åŠ›ã€‚æ‹¥æœ‰è¶…å‡¡çš„ä¸ªäººé­…åŠ›ä¸æ„Ÿå¬åŠ›ï¼Œèƒ½è½»æ˜“å‡èšäººå¿ƒï¼Œå…¶è¨€è¯­è¶³ä»¥ç‚¹ç‡ƒå¸Œæœ›æˆ–å¹³æ¯çº·äº‰ã€‚\";\n                } else if (positiveSocial > 9) {\n                    positiveDesc += \"å‡ºè‰²ã€‚ä¾é å¼ºå¤§çš„å…±æƒ…èƒ½åŠ›ä¸ä¸ªäººé­…åŠ›ï¼Œèƒ½è½»æ˜“è·å¾—ä»–äººå¥½æ„Ÿä¸ä¿¡ä»»ï¼Œæ˜¯å¤©ç”Ÿçš„å¤–äº¤å®¶ã€‚\";\n                } else if (positiveSocial > 4) {\n                    positiveDesc += \"å¨´ç†Ÿã€‚å–„äºæ²Ÿé€šï¼Œæ‡‚å¾—ç¤¾äº¤ç¤¼ä»ªï¼Œå®¹æ˜“è·å¾—ä»–äººå¥½æ„Ÿã€‚\";\n                } else  if (positiveSocial > 1) {\n                    positiveDesc += \"æ™®é€šã€‚èƒ½è¿›è¡ŒåŸºæœ¬çš„æ—¥å¸¸äººé™…äº¤å¾€ã€‚\";\n                }else {\n                    positiveDesc = \"å­˜åœ¨æ˜¾è‘—ç¼ºé™·ã€‚éš¾ä»¥ä¸ä»–äººå»ºç«‹æœ‰æ•ˆæ²Ÿé€šã€‚\";\n                }\n                descriptions.push(positiveDesc);\n\n                let negativeDesc = \"è´Ÿé¢ç¤¾äº¤èƒ½åŠ›ï¼š\";\n                if (negativeSocial > 16) {\n                    negativeDesc += \"å®—å¸ˆçº§æ“æ§ã€‚èƒ½ä»¥è¨€è¯­ä¸åŠ¨å£°è‰²åœ°ç¼–ç»‡ç°å®ï¼Œå°†è°è¨€ã€å¨èƒä¸è¯±å¯¼èä¸ºä¸€ä½“ï¼Œæ“çºµäººå¿ƒäºè‚¡æŒä¹‹é—´ã€‚\";\n                } else if (negativeSocial > 9) {\n                    negativeDesc += \"é«˜æ•ˆã€‚ç²¾é€šæ¬ºç’ã€è¯±å¯¼æˆ–èƒè¿«ç­‰æ‰‹æ®µï¼Œèƒ½æœ‰æ•ˆå½±å“ä»–äººå†³ç­–ä»¥è¾¾æˆè‡ªèº«ç›®çš„ã€‚\";\n                } else if (negativeSocial > 4) {\n                    negativeDesc += \"æœ‰æ•ˆã€‚æ‡‚å¾—å¦‚ä½•åˆ©ç”¨è¨€è¯­å’ŒæŠ€å·§å¼•å¯¼æˆ–å¨æ…‘ä»–äººã€‚\";\n                } else {\n                    negativeDesc += \"å­˜åœ¨çŸ­æ¿ã€‚ä¸æ“…é•¿æˆ–ä¸å±‘äºä½¿ç”¨æ¬ºéª—ã€å¨èƒç­‰æ‰‹æ®µã€‚\";\n                }\n                descriptions.push(negativeDesc);\n\n\n                // --- æƒ…ç»ªæ§åˆ¶ä¸æŠ—å‹èƒ½åŠ› ---\n                const composureScore = composure;\n                if (composureScore > 8) {\n                    composureDesc = \"ç»å¯¹æ²‰é™ã€‚æƒ…ç»ªä¸å†…å¿ƒå¦‚åŒå¯‚é™çš„è™šç©ºï¼Œä¸å—ä»»ä½•å†…å¤–å› ç´ çš„æ‰°åŠ¨ï¼Œè¾¾åˆ°äº†ç»å¯¹çš„ç†æ€§å¢ƒåœ°ã€‚\";\n                } else if (composureScore >= 5) {\n                    composureDesc = \"å“è¶Šç¨³å®šã€‚å³ä¾¿åœ¨æœ€æç«¯çš„å‹åŠ›ä¸‹ä¹Ÿèƒ½ä¿æŒå®Œç¾çš„é•‡å®šä¸ä¼ªè£…ï¼Œæƒ…ç»ªè¡¨ç°å®Œå…¨ç”±æ„å¿—æŒæ§ã€‚\";\n                } else if (composureScore === 4) {\n                    composureDesc = \"é«˜åº¦ç¨³å®šã€‚åœ¨å‹åŠ›ç¯å¢ƒä¸‹èƒ½ä¿æŒç»å¯¹å†·é™ï¼Œè¡ŒåŠ¨ä¸å†³ç­–ä¸å—æƒ…ç»ªå¹²æ‰°ã€‚\";\n                } else if (composureScore === 3) {\n                    composureDesc = \"æ²‰ç€ã€‚åœ¨å¤§å¤šæ•°å‹åŠ›æƒ…å¢ƒä¸‹èƒ½æ§åˆ¶æƒ…ç»ªï¼Œåšå‡ºç†æ€§åˆ¤æ–­ã€‚\";\n                } else if (composureScore === 2) {\n                    composureDesc = \"æ™®é€šã€‚èƒ½åº”å¯¹ä¸€èˆ¬æ€§çš„å‹åŠ›ï¼Œä½†åœ¨æç«¯æƒ…å†µä¸‹å¯èƒ½ä¼šæƒ…ç»ªå¤±æ§ã€‚\";\n                } else {\n                    composureDesc = \"ä¸ç¨³å®šã€‚ææ˜“å—å¤–ç•Œåˆºæ¿€å½±å“ï¼Œåœ¨å‹åŠ›ä¸‹éš¾ä»¥ä¿æŒé•‡å®šã€‚\";\n                }\n                descriptions.push(`æƒ…ç»ªæ§åˆ¶ä¸æŠ—å‹èƒ½åŠ›ï¼š${composureDesc}`);\n\n                return descriptions.join('\\n');\n            };\n\n            \n        \n            const getVirtueViceDescription = () => {\n                const virtueDescriptions = {\n                    'æ…ˆçˆ±': 'å½“è§’è‰²å†’é™©å¸®åŠ©äººæ—¶ï¼Œè§¦å‘æ…ˆçˆ±ã€‚',\n                    'ä¿¡å¿µ': 'å½“è§’è‰²ä»æ··ä¹±ä¸æ‚²ä¼¤ä¸­ç¡®ç«‹å‡ºå…¶æ„ä¹‰æ—¶ï¼Œè§¦å‘ä¿¡å¿µã€‚',\n                    'åˆšæ¯…': 'å½“è§’è‰²æˆåŠŸå¯¹æŠ—é˜»åŠ›ä¸å¼•è¯±æ—¶ï¼Œè§¦å‘åˆšæ¯…ã€‚',\n                    'å¸Œæœ›': 'å½“è§’è‰²ä»¤å…¶ä»–äººä»ç»æœ›ä¸­å›å¤è¿‡æ¥æ—¶ï¼Œè§¦å‘å¸Œæœ›ã€‚',\n                    'æ­£ä¹‰': 'å½“è§’è‰²ä¸ºæ­£ä¹‰è€Œå†’é™©æ—¶ï¼Œè§¦å‘æ­£ä¹‰ã€‚',\n                    'ç¨³é‡': 'å½“è§’è‰²å¼ƒå¿«æ·æ–¹å¼è€Œé€‰ç¨³å¦¥æ—¶ï¼Œè§¦å‘ç¨³é‡ã€‚',\n                    'èŠ‚åˆ¶': 'å½“è§’è‰²æœ‰æœºä¼šæ”¾çºµï¼ˆä¸è®ºå¥½åï¼‰è€Œä¸å—è¯±æƒ‘æ—¶ï¼Œè§¦å‘èŠ‚åˆ¶ã€‚'\n                };\n\n                const viceDescriptions = {\n                    'å¦’å¿Œ': 'å½“è§’è‰²ä»ä»–äººå¤„æ‹¿åˆ°å¥½ä¸œè¥¿ï¼Œæˆ–ä»¤ä»–äººå¤±å»å¥½ä¸œè¥¿æ—¶ï¼Œè§¦å‘å¦’å¿Œã€‚',\n                    'æ”¾çºµ': 'å½“è§’è‰²ä¸ºæ”¾çºµè‡ªå·±çš„æ¬²æœ›è€Œä¸é¡¾å…¶ä»–äº‹æƒ…æ—¶ï¼Œè§¦å‘æ”¾çºµã€‚',\n                    'è´ªå©ª': 'å½“è§’è‰²ä¸ºå¾—åˆ°æƒ³è¦çš„ä¸œè¥¿è€Œå†’é™©æ—¶ï¼Œè§¦å‘è´ªå©ªã€‚',\n                    'çºµæ¬²': 'å½“è§’è‰²å‘ä»–äººæ³„æ¬²è€Œä¸é¡¾å¯¹æ–¹æ„Ÿå—æ—¶ï¼Œè§¦å‘çºµæ¬²ã€‚',\n                    'éª„å‚²': 'å½“è§’è‰²ä¸ºè¡¨ç°è‡ªå·±çš„æƒ³æ³•è€Œå†’é™©æ—¶ï¼Œè§¦å‘éª„å‚²ã€‚',\n                    'æ‡’æƒ°': 'å½“è§’è‰²é€ƒé¿éœ€è¦åšçš„äº‹ï¼Œäº‹ä»¶å´å®Œæˆäº†çš„è¯ï¼Œè§¦å‘æ‡’æƒ°ã€‚',\n                    'æ„¤æ€’': 'å½“è§’è‰²æ— è§†å±é™©æ¥å‘æ³„æ„¤æ€’æ—¶ï¼Œè§¦å‘æ„¤æ€’ã€‚'\n                };\n\n                const virtueName = (_.get(characterData, 'æ¦‚å¿µæ®µ.ç¾å¾·ä¸æ¶å¾·.ç¾å¾·', []) || []).find(v => v) || \"æœªé€‰æ‹©\";\n                const viceName = (_.get(characterData, 'æ¦‚å¿µæ®µ.ç¾å¾·ä¸æ¶å¾·.æ¶å¾·', []) || []).find(v => v) || \"æœªé€‰æ‹©\";\n\n                const virtueDesc = virtueDescriptions[virtueName] || 'æœªé€‰æ‹©ç¾å¾·æˆ–æè¿°ç¼ºå¤±ã€‚';\n                const viceDesc = viceDescriptions[viceName] || 'æœªé€‰æ‹©æ¶å¾·æˆ–æè¿°ç¼ºå¤±ã€‚';\n\n                let virtueLine = `ç¾å¾·ï¼š${virtueName}ã€‚`;\n                if (virtueName !== \"æœªé€‰æ‹©\") {\n                    virtueLine += ` æ•ˆæœï¼š${virtueDesc}`;\n                }\n\n                let viceLine = `æ¶å¾·ï¼š${viceName}ã€‚`;\n                if (viceName !== \"æœªé€‰æ‹©\") {\n                    viceLine += ` æ•ˆæœï¼š${viceDesc}`;\n                }\n\n                return [virtueLine, viceLine].join('\\n');\n            };\n\n\n \n            const getReincarnatorRating = () => {\n                // å®šä¹‰å„é¡¹èƒ½åŠ›é˜ˆå€¼\n                const thresholds = {\n                    legend: 32,\n                    master: 22, // å¤§å¸ˆçº§é—¨æ§›è®¾ç½®ä¸º å±æ€§5+æŠ€èƒ½5=10 ä¹‹å\n                    excellence: 14, // å“è¶Šçº§é—¨æ§›è®¾ç½®ä¸º å±æ€§4+æŠ€èƒ½3=7 ä¹‹å\n                    elite: 10      // ç²¾é”çº§é—¨æ§› å±æ€§3+æŠ€å·§2=5 ä¹‹å\n                };\n\n                // Helper to get raw values, used for consistency\n                const getVal = (path, defaultValue = 0) => _.get(characterData, path, [defaultValue])[0];\n\n                // ç”Ÿç†é¢†åŸŸ\n                const strength = getVal('å±æ€§æ®µ.ç”Ÿç†å±æ€§.åŠ›é‡.åŸºç¡€');\n                const agility = getVal('å±æ€§æ®µ.ç”Ÿç†å±æ€§.æ•æ·.åŸºç¡€');\n                const endurance = getVal('å±æ€§æ®µ.ç”Ÿç†å±æ€§.è€åŠ›.åŸºç¡€');\n                const melee_skill = Math.max(getVal('æŠ€èƒ½æ®µ.ç”Ÿç†æŠ€èƒ½.è‚‰æ'), getVal('æŠ€èƒ½æ®µ.ç”Ÿç†æŠ€èƒ½.ç™½åˆƒ'));\n                const ranged_skill = Math.max(getVal('æŠ€èƒ½æ®µ.ç”Ÿç†æŠ€èƒ½.æªæ¢°'), getVal('æŠ€èƒ½æ®µ.ç”Ÿç†æŠ€èƒ½.å¼“ç®­'));\n                const athletics_skill = getVal('æŠ€èƒ½æ®µ.ç”Ÿç†æŠ€èƒ½.è¿åŠ¨');\n                const stealth_skill = getVal('æŠ€èƒ½æ®µ.ç”Ÿç†æŠ€èƒ½.éšè—');\n\n                const combatPotential = Math.max(strength + melee_skill, agility + melee_skill, agility + ranged_skill);\n                const mobilityPotential = agility + athletics_skill;\n                const stealthPotential = agility + stealth_skill;\n                const endurancePotential = endurance * 2; // è€åŠ›å±æ€§è¾ƒä¸ºç‹¬ç«‹ï¼Œæƒé‡ä¹˜ä»¥2ä»¥å¹³è¡¡\n\n                // å¿ƒæ™ºé¢†åŸŸ\n                const intelligence = getVal('å±æ€§æ®µ.å¿ƒæ™ºå±æ€§.æ™ºåŠ›.åŸºç¡€');\n                const perception = getVal('å±æ€§æ®µ.å¿ƒæ™ºå±æ€§.æ„ŸçŸ¥.åŸºç¡€');\n                const resolve = getVal('å±æ€§æ®µ.å¿ƒæ™ºå±æ€§.å†³å¿ƒ.åŸºç¡€');\n                const investigation_skill = getVal('æŠ€èƒ½æ®µ.å¿ƒæ™ºæŠ€èƒ½.è°ƒæŸ¥');\n                const science_skill = getVal('æŠ€èƒ½æ®µ.å¿ƒæ™ºæŠ€èƒ½.ç§‘å­¦');\n                const knowledge_skill = Math.max(getVal('æŠ€èƒ½æ®µ.å¿ƒæ™ºæŠ€èƒ½.å­¦è¯†'), science_skill, getVal('æŠ€èƒ½æ®µ.å¿ƒæ™ºæŠ€èƒ½.ç¥ç§˜å­¦'));\n\n                const logicPotential = intelligence + Math.max(investigation_skill, science_skill);\n                const perceptionPotential = perception + investigation_skill;\n                const knowledgePotential = intelligence + knowledge_skill;\n                const resolvePotential = resolve * 2; // å†³å¿ƒå±æ€§åŒæ ·ä¹˜ä»¥2\n\n                // äº’åŠ¨é¢†åŸŸ\n                const presence = getVal('å±æ€§æ®µ.äº’åŠ¨å±æ€§.é£åº¦.åŸºç¡€');\n                const manipulation = getVal('å±æ€§æ®µ.äº’åŠ¨å±æ€§.æ“æ§.åŸºç¡€');\n                const composure = getVal('å±æ€§æ®µ.äº’åŠ¨å±æ€§.æ²‰ç€.åŸºç¡€');\n                const positive_social_skill = Math.max(getVal('æŠ€èƒ½æ®µ.äº’åŠ¨æŠ€èƒ½.æ„Ÿå—'), getVal('æŠ€èƒ½æ®µ.äº’åŠ¨æŠ€èƒ½.è¡¨è¾¾'), getVal('æŠ€èƒ½æ®µ.äº’åŠ¨æŠ€èƒ½.äº¤é™…'));\n                const negative_social_skill = Math.max(getVal('æŠ€èƒ½æ®µ.äº’åŠ¨æŠ€èƒ½.æ©é¥°'), getVal('æŠ€èƒ½æ®µ.äº’åŠ¨æŠ€èƒ½.èƒè¿«'));\n\n                const positiveSocialPotential = presence + positive_social_skill;\n                const negativeSocialPotential = manipulation + negative_social_skill;\n                const composurePotential = composure * 2; // æ²‰ç€å±æ€§ä¹˜ä»¥2\n\n                const potentialScores = {\n                    \"ç‰©ç†æˆ˜æ–—\": combatPotential,\n                    \"æœºåŠ¨èƒ½åŠ›\": mobilityPotential,\n                    \"éšè”½èƒ½åŠ›\": stealthPotential,\n                    \"ç”Ÿç†è€å—\": endurancePotential,\n                    \"åˆ†æé€»è¾‘\": logicPotential,\n                    \"ç¯å¢ƒæ´å¯Ÿ\": perceptionPotential,\n                    \"çŸ¥è¯†å‚¨å¤‡\": knowledgePotential,\n                    \"ç²¾ç¥éŸ§æ€§\": resolvePotential,\n                    \"æ­£é¢ç¤¾äº¤\": positiveSocialPotential,\n                    \"è´Ÿé¢æ“æ§\": negativeSocialPotential,\n                    \"æƒ…ç»ªæ§åˆ¶\": composurePotential\n                };\n\n                let legend_fields = [];\n                let master_fields = [];\n                let excellence_fields = [];\n\n                for (const field in potentialScores) {\n                    const score = potentialScores[field];\n                    if (score >= thresholds.legend) {\n                        legend_fields.push(field);\n                    } else if (score >= thresholds.master) {\n                        master_fields.push(field);\n                    } else if (score >= thresholds.excellence) {\n                        excellence_fields.push(field);\n                    }\n                }\n\n                let rating = 'D';\n                let reason = \"æš‚æ— çªå‡ºèƒ½åŠ›ï¼Œå„é¡¹æŒ‡æ ‡å‡åœ¨åŸºç¡€èŒƒå›´å†…ã€‚\";\n\n                if (legend_fields.length > 0) {\n                    rating = 'S';\n                    reason = `åœ¨ã€${legend_fields.join('ã€')}ã€‘é¢†åŸŸå·²å…¥ä¼ å¥‡ä¹‹å¢ƒã€‚`;\n                } else if (master_fields.length >= 2) {\n                    rating = 'A';\n                    reason = `åœ¨ã€${master_fields.join('ã€')}ã€‘ç­‰å¤šä¸ªé¢†åŸŸè¾¾åˆ°å¤§å¸ˆçº§æ°´å‡†ã€‚`;\n                } else if (master_fields.length === 1) {\n                    rating = 'B';\n                    reason = `åœ¨ã€${master_fields[0]}ã€‘é¢†åŸŸè¾¾åˆ°äº†å¤§å¸ˆçº§æ°´å‡†ã€‚`;\n                } else if (excellence_fields.length > 0) {\n                    rating = 'C';\n                    reason = `åœ¨ã€${excellence_fields.join('ã€')}ã€‘é¢†åŸŸå…·å¤‡å“è¶Šçš„èƒ½åŠ›ã€‚`;\n                }\n\n                return `${player_role}è¯„çº§ï¼š${rating}\\nè¯„çº§æ ‡å‡†ï¼š${reason}`;\n            };\n\n\n            // -- Output Generation --\n            let output_lines = [];\nlet output_lines_show = [];\n\n            output_lines.push(`\\n\\nå½“å‰ç”Ÿå‘½å€¼ï¼š${hp_current}/${hp_max}ã€‚${getHpDescription(hp_current, hp_max)}`);\n            _%>\n\n<%_\n            const abilityType = getVal('èƒ½åŠ›æ®µ.ç±»å‹', 'æ— ');\n            const abilityName = getVal('èƒ½åŠ›æ®µ.åç§°', '');\nconst abilityDescirbe = getVal('èƒ½åŠ›æ®µ.æ•ˆæœ', '');\n            const energyName = getVal('è¡ç”Ÿå±æ€§æ®µ.èƒ½é‡æ± .åç§°', 'æ— ');\n            const energyCurrent = getVal('è¡ç”Ÿå±æ€§æ®µ.èƒ½é‡æ± .å½“å‰å€¼');\n            const energyMax = getVal('è¡ç”Ÿå±æ€§æ®µ.èƒ½é‡æ± .ä¸Šé™');\n\n        \n            if (abilityType !== 'æ— ' && abilityName) {\n                output_lines_show.push(`èƒ½åŠ›ï¼š[${abilityType}] ${abilityName}`);\n output_lines_show.push(`æ•ˆæœï¼š${abilityDescirbe}`);\n            }\n            output_lines.push(`èƒ½é‡æ± ï¼š${energyName}ï¼š${energyCurrent}/${energyMax}`);\n            _%>\n\n<%_\n            output_lines.push('');\n            output_lines.push('--- <user>èƒ½åŠ›è¯„ä¼°  ---');\n            _%>\n\n<%_\n\n            output_lines.push('ç”Ÿç†:\\n' + getPhysiologicalAbility());\n            output_lines.push('');\n            output_lines.push('å¿ƒæ™º:\\n' + getMentalAbility());\n            output_lines.push('');\n            output_lines.push('äº’åŠ¨:\\n' + getInteractionAbility());\n            output_lines.push('');\n    // --- æ–°å¢çš„è¯„çº§è¾“å‡ºéƒ¨åˆ† ---\n           if(version === 1){\n     output_lines.push(`--- ${player_role}ç»¼åˆè¯„çº§ ---`);\n            output_lines.push(getReincarnatorRating());\n}\n            output_lines.push('');\n            output_lines.push('--- ç¾å¾·ä¸æ¶å¾· ---');\n            output_lines.push(getVirtueViceDescription());\n\n  const statusSummary = output_lines_show.join('\\n')+output_lines.join('\\n');\n  \n            setLocalVar('å½“å‰äººç‰©çŠ¶æ€', statusSummary);\n_%>\ncharacter_status.load({\n  rule: 'å®šä¹‰{{user}}çš„å½“å‰çŠ¶æ€å’Œæˆ˜åŠ›è¯„ä¼°ï¼Œç¦æ­¢è¾“å‡ºåˆ°æ­£æ–‡',\n  constraints: {\n    health: {\n      rule: 'ç¦æ­¢ç›´æ¥è®¾ç½®ç”Ÿå‘½å€¼ï¼Œæ‰€æœ‰ç”Ÿå‘½å€¼æ“ä½œé€šè¿‡hurt_valueï¼ˆæ­£æ•°ä¸ºå—ä¼¤ï¼Œè´Ÿæ•°ä¸ºæ²»æ„ˆï¼‰',\n    },\n    energy: {\n      rule: 'æŠ€èƒ½é‡Šæ”¾éœ€æ”¯ä»˜èƒ½é‡æ± ï¼Œèƒ½é‡ä¸è¶³æ—¶æŠ€èƒ½å¤±è´¥'\n    },\n    consistency: {\n      rule: 'å‰§æƒ…ä¸­{{user}}çš„æˆ˜åŠ›å’Œè¡ŒåŠ¨å¿…é¡»ä¸¥æ ¼ç¬¦åˆçŠ¶æ€æè¿°',\n      data: '<%= output_lines.join(\"\\n\") %>'\n    }\n  }\n});\n<%_\n        }\n    }\n}\n_%>",
                    "constant": true,
                    "selective": true,
                    "insertion_order": 101,
                    "enabled": true,
                    "position": "after_char",
                    "use_regex": true,
                    "extensions": {
                        "position": 1,
                        "exclude_recursion": false,
                        "display_index": 21,
                        "probability": 100,
                        "useProbability": true,
                        "depth": 4,
                        "selectiveLogic": 0,
                        "group": "statusSummary",
                        "group_override": false,
                        "group_weight": 100,
                        "prevent_recursion": false,
                        "delay_until_recursion": false,
                        "scan_depth": null,
                        "match_whole_words": null,
                        "use_group_scoring": false,
                        "case_sensitive": null,
                        "automation_id": "",
                        "role": 0,
                        "vectorized": false,
                        "sticky": 0,
                        "cooldown": 0,
                        "delay": 0,
                        "match_persona_description": false,
                        "match_character_description": false,
                        "match_character_personality": false,
                        "match_character_depth_prompt": false,
                        "match_scenario": false,
                        "match_creator_notes": false,
                        "triggers": []
                    }
                },
                {
                    "id": 24,
                    "keys": [],
                    "secondary_keys": [],
                    "comment": "mod:DæƒŠæ‚šä¹å›­ç‰ˆ(è¿˜ä¸èƒ½ç”¨)",
                    "content": "{{setvar::world_version::4}}{{setvar::player_role::ç©å®¶}}{{setvar::world_role::æƒŠæ‚šä¹å›­}}{{setvar::point_role::æ¸¸æˆå¸}}{{setvar::zhixian_role::çµé­‚ç¢ç‰‡}}{{setvar::xp_role::ç»éªŒå€¼}}{{setvar::player_rank::ç§°å·}}{{setvar::tier_role::ç§°å·}}{{setvar::profession_role::èŒä¸š}}{{setvar::world_other_tag::,æƒŠå“å€¼:num,ç†æ™ºå€¼:num}} {{setvar::fixed_tag:: }}\n<%_\n// å°è£…çš„æ•°æ®è·å–å‡½æ•° - é¿å…é‡å¤å®šä¹‰\n \n    function getDataWithFallback(varName) {\n     \n        let data = getLocalVar(varName);\n       \n        // å†…è”æ•°æ®éªŒè¯ï¼šæ£€æŸ¥æ˜¯å¦ä¸ºnullã€undefinedï¼Œä¸”å¦‚æœæ˜¯å¯¹è±¡è¦æœ‰å†…å®¹\n        const isValid = (data) => {\n            // æ£€æŸ¥æ˜¯å¦ä¸º null æˆ– undefined\n            if (data === null || data === undefined) {\n                return false;\n            }\n            \n            // å¦‚æœæ˜¯å¯¹è±¡ç±»å‹ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰å†…å®¹\n            if (typeof data === 'object' && data !== null) {\n                // å¦‚æœæ˜¯æ•°ç»„ï¼Œæ£€æŸ¥é•¿åº¦\n                if (Array.isArray(data)) {\n                    return data.length > 0;\n                }\n                // å¦‚æœæ˜¯æ™®é€šå¯¹è±¡ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰å±æ€§\n                return Object.keys(data).length > 0;\n            }\n            \n            // å…¶ä»–ç±»å‹ï¼ˆå­—ç¬¦ä¸²ã€æ•°å­—ã€å¸ƒå°”å€¼ç­‰ï¼‰åªè¦ä¸æ˜¯ null/undefined å°±è®¤ä¸ºæœ‰æ•ˆ\n            return true;\n        };\n        \n        // å¦‚æœæ•°æ®ä¸ç¬¦åˆè¦æ±‚ï¼Œä» getLocalVar è·å–\n        if (!isValid(data)) {\n            data = getLocalVar(varName);\n        }\n        \n        return data;\n    }\n \nvar num_of_battle = 3;\n \n    if (typeof EvStat === 'undefined') {\n        var EvStat = getDataWithFallback(\"stat_data\");\n    }\n        var totalTask = Number(_.get(EvStat, 'user_character.total_task[0]', 0));\n\n    let left_num = num_of_battle  - totalTask % num_of_battle  ;\n    let the_left = \"warningï¼šè·ç¦»å°é˜Ÿå¯¹æŠ—ä»»åŠ¡è¿˜æœ‰ \"+left_num  +\"ä¸ªä»»åŠ¡ã€‚\";\n\n\n    if (typeof assaData === 'undefined') {\n        var assaData =  getDataWithFallback(\"assa_data\");\n    }\n            var currentLocationTitle = _.get(EvStat, 'user_character.current_location[0]', '');\n\n        var noCheckZones = ['ä¸ªäººç©ºé—´', 'ä¸»ç¥å¤§å…', 'è®­ç»ƒåœº','ä¸»ç¥ç©ºé—´'];\n\n    if (typeof currentLocationTitle === 'string' && noCheckZones.some(zone => currentLocationTitle.includes(zone))) {\n\n        if (totalTask > 0 && left_num  === 0) {\n   \n             const the_left  = \"ç¬¬ä¸€ä¼˜å…ˆçº§ï¼ä¸‹ä¸€ä¸ªä»»åŠ¡æ˜¯å°é˜Ÿå¯¹æŠ—ï¼šå¯¹æŠ—ä»»åŠ¡ã€‚\";\n       }\n\n}else{\n \n \n  if (totalTask > 0 && left_num  === 0) {\n              \n             const the_left  = \" æ­£åœ¨è¿›è¡Œå¯¹æŠ—ä»»åŠ¡ã€‚\";\n       }\n}\n\n \n_%>\n\n# æƒŠæ‚šä¹å›­ \n\n## åŸºç¡€ä¸–ç•Œè§‚ï¼šè™šæ‹Ÿç°å®çš„è¾¹ç•Œ\n\n### æ¸¸æˆæœ¬è´¨\n\"æƒŠæ‚šä¹å›­\"è¡¨é¢ä¸Šæ˜¯ä¸€æ¬¾\"å·ç§°å¯ä»¥è®©ç©å®¶ä½“éªŒåˆ°çš„ç»æœ›å’Œææ€–æ„Ÿè§‰çš„æ¸¸æˆ\"ï¼Œä½†å®é™…ä¸Šæ˜¯ä¸€ä¸ª\"æ²‰æµ¸å¼ææ€–æ¸¸æˆ\"ï¼Œé€šè¿‡è¶…å‰çš„è™šæ‹Ÿç°å®æŠ€æœ¯åˆ›é€ å‡ºæ— æ³•åˆ†è¾¨çœŸå‡çš„ææ€–ä½“éªŒã€‚\n\n### ç°å®èƒŒæ™¯\n- **ç°å®ä¸–ç•Œä¾ç„¶å­˜åœ¨**ï¼šç©å®¶æ‹¥æœ‰ç°å®ä¸­çš„èº«ä»½å’Œç”Ÿæ´»\n- **æ¸¸æˆä»‹å…¥ç°å®**ï¼šéšç€å‰§æƒ…å‘å±•ï¼Œè™šæ‹Ÿä¸ç°å®çš„ç•Œé™é€æ¸æ¨¡ç³Š\n- **å¤šç»´æ¸¸æˆä¸–ç•Œ**ï¼šä¸ä»…ä»…æ˜¯ç®€å•çš„è™šæ‹Ÿæ¸¸æˆï¼Œè€Œæ˜¯è¿æ¥å¤šä¸ªç»´åº¦çš„å¤æ‚ç³»ç»Ÿ\n- **ç¥é­”èµŒå±€**ï¼šæ¶‰åŠç¥é­”èµŒå±€ã€æ•°æ®æŠ—äº‰ä¸äººç±»æ•‘èµçš„æ›´æ·±å±‚çœŸç›¸\n\n### æ¸¸æˆæ¥å…¥æ–¹å¼\n- **å…‰è„‘ç³»ç»Ÿ**ï¼šé€šè¿‡å…‰è„‘å’Œæ¸¸æˆèˆ±çš„åŠŸèƒ½ï¼Œå®ç°å¯¹ç©å®¶å¿ƒè·³ã€è„‰æã€è¡€å‹ã€è„‘ç¥ç»ååº”ç­‰å³æ—¶ç›‘æ§\n- **ç¥ç»è¿æ¥**ï¼šç›´æ¥è¿æ¥ç©å®¶çš„ç¥ç»ç³»ç»Ÿï¼Œæä¾›å®Œå…¨æ²‰æµ¸çš„ä½“éªŒ\n- **ç”Ÿç†ç›‘æ§**ï¼šå®æ—¶ç›‘æµ‹ç©å®¶çš„ç”Ÿç†çŠ¶æ€ï¼Œç¡®ä¿å®‰å…¨\n\n## æ ¸å¿ƒæ¸¸æˆç³»ç»Ÿ\n\n### æƒŠå“å€¼ç³»ç»Ÿ\n#### åŸºç¡€æœºåˆ¶\n- **ä»¥ç™¾åˆ†æ¯”æ˜¾ç¤ºï¼Œæ— å…·ä½“æ•°å€¼**\n- **ä¸´ç•Œç‚¹ä¿æŠ¤**ï¼šæƒŠå“å€¼é«˜äº100%å¹¶è¶…è¿‡ä¸‰ç§’ï¼Œç©å®¶ä¸æ¸¸æˆçš„è¿æ¥å°†è¢«å¼ºåˆ¶æ–­å¼€ï¼Œè§’è‰²è¢«è§†ä¸ºå·²æ­»äº¡\n- **å³æ—¶ç›‘æ§**ï¼šä»¥æ­¤æµ‹ç®—ææƒ§çš„ç¨‹åº¦ã€‚å¦‚æœç©å®¶åœ¨æ¸¸æˆä¸­çš„æƒŠå“å€¼ç¬é—´è¶…è¿‡äº†ä¸´ç•Œç‚¹ï¼Œåˆ™ä¼šè¢«å¼ºåˆ¶æ–­å¼€ç¥ç»è¿æ¥ï¼Œç«‹å³ä¸‹çº¿\n\n#### ææƒ§è¯„çº§ç³»ç»Ÿ\nå«ã€æµ‘èº«æ˜¯èƒ†ã€‘ã€å‹‡æ°”å¯å˜‰ã€‘ã€æƒŠæ…Œå¤±æªã€‘ã€èƒ†é¢¤å¿ƒæƒŠã€‘ã€é­‚ä¸é™„ä½“ã€‘äº”ä¸ªè¯„çº§\n\n- **æµ‘èº«æ˜¯èƒ†**ï¼šæƒŠå“å€¼æä½ï¼Œå‡ ä¹ä¸å—ææ€–å½±å“\n- **å‹‡æ°”å¯å˜‰**ï¼šè½»å¾®ææƒ§ï¼Œä½†èƒ½ä¿æŒç†æ™º\n- **æƒŠæ…Œå¤±æª**ï¼šä¸­ç­‰ææƒ§ï¼Œè¡ŒåŠ¨å¼€å§‹å—å½±å“\n- **èƒ†é¢¤å¿ƒæƒŠ**ï¼šé«˜åº¦ææƒ§ï¼Œæ€ç»´å’Œè¡ŒåŠ¨æ˜æ˜¾è¿Ÿç¼“\n- **é­‚ä¸é™„ä½“**ï¼šæåº¦ææƒ§ï¼Œæ¥è¿‘æƒŠå“å€¼ä¸´ç•Œç‚¹\n\n### ç§°å·ç³»ç»Ÿ\n#### ç³»ç»Ÿç‰¹ç‚¹\n- **ç§°å·ç³»ç»Ÿå¯ä»¥è®©æ¯ä¸€åç©å®¶ä¸ä¼šè¿·å¤±åœ¨åæœŸå¤æ‚çš„æˆ˜æ–—å–å‘ä¸­ï¼Œåœ¨ä¿è¯äº†æ¸¸æˆè§’è‰²ä¸ªæ€§åŒ–çš„åŒæ—¶ï¼Œç»™å‡ºä¸€ä¸ª\"é‡ç‚¹\"**\n- **\"ç§°å·\"åœ¨åäºŒæ ¼æŠ€èƒ½æ çš„é™åˆ¶å¤–ï¼Œèµ‹äºˆç©å®¶ä¸€é¡¹ä¸å æŠ€èƒ½æ çš„ç‰¹æ®Šèƒ½åŠ›**\n- **åŠ¨æ€æ›´æ–°**ï¼šç§°å·ä¼šéšç€ç©å®¶çš„æˆé•¿ã€è¡¨ç°ã€èƒ½åŠ›æ”¹å˜è€Œæ”¹å˜ï¼Œåœ¨å‰§æœ¬å®Œæˆåä¼šå®æ—¶æ›´æ–°ç©å®¶çš„ç§°å·\n \n\n### æŠ€èƒ½æ ç³»ç»Ÿ\n- **æŠ€èƒ½æ§½é™åˆ¶**ï¼šåäºŒæ ¼æŠ€èƒ½æ ï¼Œé™åˆ¶ç©å®¶åŒæ—¶è£…å¤‡çš„æŠ€èƒ½æ•°é‡\n- **æŠ€èƒ½è·å–**ï¼šé€šè¿‡å®Œæˆå‰§æœ¬ã€æ¢ç´¢ä¸–ç•Œè§‚ã€ç‰¹æ®Šä»»åŠ¡ç­‰æ–¹å¼è·å¾—\n- **æŠ€èƒ½åˆ†ç±»**ï¼šä¸»åŠ¨æŠ€èƒ½ã€è¢«åŠ¨æŠ€èƒ½ã€ç‰¹æ®Šèƒ½åŠ›ç­‰ä¸åŒç±»å‹\n\n## è´§å¸ä¸å¥–åŠ±ç³»ç»Ÿ\n\n### åŸºç¡€è´§å¸ï¼šæ¸¸æˆå¸\n#### è·å–æ–¹å¼\n- **å‰§æœ¬å®Œæˆå¥–åŠ±**ï¼šå®Œæˆå‰§æœ¬å¯è·å¾—æ¸¸æˆå¸ï¼ˆå¦‚4500æ¸¸æˆå¸ï¼‰\n- **è¡¨ç°ç›¸å…³**ï¼šæ ¹æ®åœ¨å‰§æœ¬ä¸­çš„è¡¨ç°å’Œææƒ§è¯„çº§è·å¾—ä¸åŒæ•°é‡\n- **ç‰¹æ®Šä»»åŠ¡**ï¼šå®Œæˆéšè—ä»»åŠ¡ã€ç ´è§£ä¸–ç•Œè§‚ç­‰å¯è·å¾—é¢å¤–å¥–åŠ±\n- **æƒŠå“å€¼è¡¨ç°**ï¼šæ ¹æ®å¹³å‡æƒŠå“å€¼å’Œæœ€é«˜æƒŠå“å€¼å½±å“å¥–åŠ±\n\n#### ä½¿ç”¨æ–¹å¼\n- **è´­ä¹°è£…å¤‡é“å…·**ï¼šåœ¨æ¸¸æˆå•†åº—è´­ä¹°å„ç±»ç‰©å“\n- **æŠ€èƒ½å­¦ä¹ **ï¼šè´­ä¹°æ–°çš„æŠ€èƒ½å’Œèƒ½åŠ›\n- **è£…å¤‡å¼ºåŒ–**ï¼šæå‡ç°æœ‰è£…å¤‡çš„å±æ€§å’Œæ•ˆæœ\n- **æƒ…æŠ¥è·å–**ï¼šè´­ä¹°å‰§æœ¬ç›¸å…³çš„æç¤ºå’Œçº¿ç´¢\n\n### ç»éªŒå€¼ç³»ç»Ÿ\n- **è·å¾—ç»éªŒå€¼ï¼š450-500ä¸ç­‰**ï¼Œæ ¹æ®å‰§æœ¬éš¾åº¦å’Œå®Œæˆåº¦å˜åŒ–\n- **ç­‰çº§æå‡**ï¼šç§¯ç´¯ç»éªŒå€¼æå‡ç©å®¶ç­‰çº§\n- **å±æ€§å¢é•¿**ï¼šç­‰çº§æå‡å¸¦æ¥åŸºç¡€å±æ€§çš„å¢å¼º\n- **æ–°æŠ€èƒ½è§£é”**ï¼šè¾¾åˆ°ç‰¹å®šç­‰çº§å¯è§£é”æ–°çš„æŠ€èƒ½ç±»å‹\n\n### ç‰©å“è£…å¤‡ç³»ç»Ÿ\n- **è·å¾—ç‰©å“/è£…å¤‡ï¼šæ— **ï¼ˆæŸäº›å‰§æœ¬å¯èƒ½æ— è£…å¤‡å¥–åŠ±ï¼‰\n- **è£…å¤‡åˆ†ç±»**ï¼šæ­¦å™¨ã€é˜²å…·ã€é“å…·ã€æ¶ˆè€—å“ç­‰\n- **è£…å¤‡å“è´¨**ï¼šæ™®é€šã€ç¨€æœ‰ã€ä¼ è¯´ç­‰ä¸åŒå“è´¨ç­‰çº§\n- **è£…å¤‡å¼ºåŒ–**ï¼šä½¿ç”¨æ¸¸æˆå¸å’Œææ–™å¼ºåŒ–è£…å¤‡å±æ€§\n\n## å‰§æœ¬å‰¯æœ¬ç³»ç»Ÿ\n\n### å‰§æœ¬ç±»å‹ä¸è®¾å®š\n#### ç»å…¸å‰§æœ¬ç³»åˆ—\n- **\"è¯¡å½±è¿·åŸ\"**ï¼šç»å…¸çš„ææ€–åŸå¸‚æ¢ç´¢\n- **\"éœ¹é›³åˆä¸´\"**ï¼šåŠ¨ä½œä¸ææ€–ç»“åˆçš„æˆ˜æ–—å‰§æœ¬\n- **å…¶ä»–å‰§æœ¬**ï¼šæ¶µç›–å„ç§ææ€–ç±»å‹å’Œä¸»é¢˜\n\n#### å‰§æœ¬éš¾åº¦åˆ†çº§\n- **æ–°æ‰‹å‰§æœ¬**ï¼šé€‚åˆåˆå­¦è€…çš„å…¥é—¨çº§ææ€–ä½“éªŒ\n- **æ ‡å‡†å‰§æœ¬**ï¼šä¸­ç­‰éš¾åº¦çš„ææ€–æŒ‘æˆ˜\n- **ä¸“å®¶å‰§æœ¬**ï¼šé«˜éš¾åº¦çš„æé™ææ€–ä½“éªŒ\n- **å¤§å¸ˆå‰§æœ¬**ï¼šæœ€é«˜éš¾åº¦çš„ä¼ è¯´çº§æŒ‘æˆ˜\n\n#### å‰§æœ¬è¯„ä»·æ ‡å‡†\n- **å®Œæˆ/æ¥å—ä»»åŠ¡ï¼š0/0**ï¼šä»»åŠ¡å®Œæˆåº¦è¯„ä¼°\n- **ç‰¹æ®Šã€éšè—ä»»åŠ¡å®Œæˆï¼š0ï¼Œç ´è§£ä¸–ç•Œè§‚ï¼šæ— **ï¼šæ·±åº¦æ¢ç´¢è¯„ä»·\n- **æƒŠå“å€¼æ¿€å¢ï¼š0æ¬¡ï¼Œæœ€é«˜æƒŠå“å€¼ï¼š0%ï¼Œå¹³å‡æƒŠå“å€¼ï¼š0%**ï¼šææƒ§è¡¨ç°è¯„ä¼°\n\n### å‰§æœ¬æœºåˆ¶\n#### ä»»åŠ¡ç³»ç»Ÿ\n- **ä¸»çº¿ä»»åŠ¡**ï¼šå‰§æœ¬çš„æ ¸å¿ƒç›®æ ‡ï¼Œå¿…é¡»å®Œæˆ\n- **æ”¯çº¿ä»»åŠ¡**ï¼šé¢å¤–çš„ä»»åŠ¡ç›®æ ‡ï¼Œæä¾›é¢å¤–å¥–åŠ±\n- **éšè—ä»»åŠ¡**ï¼šéœ€è¦ç©å®¶è‡ªå·±å‘ç°çš„éšç§˜ç›®æ ‡\n- **ç‰¹æ®Šä»»åŠ¡**ï¼šç‰¹å®šæ¡ä»¶ä¸‹è§¦å‘çš„ç‰¹æ®ŠæŒ‘æˆ˜\n\n#### ä¸–ç•Œè§‚ç ´è§£\n- **èƒŒæ™¯æ¢ç´¢**ï¼šæ·±å…¥äº†è§£å‰§æœ¬çš„ä¸–ç•Œè§‚å’ŒèƒŒæ™¯æ•…äº‹\n- **çœŸç›¸å‘ç°**ï¼šæ­éœ²å‰§æœ¬èƒŒåçš„éšè—çœŸç›¸\n- **çº¿ç´¢æ”¶é›†**ï¼šæ”¶é›†æ•£å¸ƒåœ¨å‰§æœ¬ä¸­çš„å„ç§çº¿ç´¢\n- **è°œé¢˜è§£ç­”**ï¼šè§£å†³å‰§æœ¬ä¸­çš„å„ç§è°œé¢˜å’Œéš¾é¢˜\n\n### èŒä¸šåˆ†åŒ–è·¯çº¿\n#### æˆ˜å£«ç±»å‹\n- **è¿‘æˆ˜ä¸“ç²¾**ï¼šæ“…é•¿è¿‘èº«æˆ˜æ–—å’Œç‰©ç†æ”»å‡»\n- **è¿œç¨‹å°„æ‰‹**ï¼šç²¾é€šå„ç§è¿œç¨‹æ­¦å™¨\n- **é˜²å¾¡ä¸“å®¶**ï¼šä¸“æ³¨äºä¿æŠ¤è‡ªå·±å’Œé˜Ÿå‹\n- **æˆ˜æœ¯æŒ‡æŒ¥**ï¼šæ“…é•¿æˆ˜æ–—ä¸­çš„ç­–ç•¥åˆ¶å®š\n\n#### æ¢ç´¢è€…ç±»å‹\n- **ä¾¦æ¢ä¸“å®¶**ï¼šæ“…é•¿æ”¶é›†çº¿ç´¢å’Œè§£è°œ\n- **æŠ€æœ¯ä¸“å®¶**ï¼šç²¾é€šå„ç§æŠ€æœ¯å’Œæœºå…³\n- **ç”Ÿå­˜ä¸“å®¶**ï¼šåœ¨æ¶åŠ£ç¯å¢ƒä¸­çš„ç”Ÿå­˜èƒ½åŠ›\n- **å­¦è€…ç±»å‹**ï¼šå¯¹å‰§æœ¬ä¸–ç•Œè§‚çš„æ·±åº¦ç†è§£\n\n#### ç²¾ç¥å¼ºåŒ–ç±»å‹\n- **ææƒ§å…ç–«**ï¼šæå¼ºçš„ææƒ§æŠ—æ€§\n- **ç†æ™ºå®ˆæŠ¤**ï¼šå¸®åŠ©å›¢é˜Ÿç»´æŒç²¾ç¥çŠ¶æ€\n- **ç›´è§‰æ•é”**ï¼šè¶…å¼ºçš„å±é™©æ„ŸçŸ¥èƒ½åŠ›\n- **æ„å¿—åšå®š**ï¼šåœ¨æç«¯æƒ…å†µä¸‹çš„åšæŒèƒ½åŠ›\n\n#### ç¤¾äº¤ä¸“ç²¾ç±»å‹\n- **ä¿¡æ¯ä¸“å®¶**ï¼šæ“…é•¿æ”¶é›†å’Œåˆ†æä¿¡æ¯\n- **è°ˆåˆ¤é«˜æ‰‹**ï¼šä¸å„ç§å­˜åœ¨è¿›è¡Œäº¤æ¶‰\n- **å›¢é˜Ÿæ ¸å¿ƒ**ï¼šæé«˜æ•´ä¸ªå›¢é˜Ÿçš„è¡¨ç°\n- **å¿ƒç†æ“æ§**ï¼šå½±å“ä»–äººçš„è¡Œä¸ºå’Œæƒ³æ³•\n\n## å¤šäººæ¸¸æˆç³»ç»Ÿ\n\n### å›¢é˜Ÿåˆä½œæœºåˆ¶\n- **é˜Ÿä¼ç»„å»º**ï¼šç©å®¶å¯ä»¥ç»„é˜Ÿè¿›å…¥å‰§æœ¬\n- **è§’è‰²åˆ†å·¥**ï¼šä¸åŒèŒä¸šåœ¨å›¢é˜Ÿä¸­å‘æŒ¥ä¸åŒä½œç”¨\n- **èµ„æºå…±äº«**ï¼šå›¢é˜Ÿå†…å¯ä»¥åˆ†äº«æŸäº›ç‰©å“å’Œä¿¡æ¯\n- **ååŒæŠ€èƒ½**ï¼šç‰¹å®šç»„åˆå¯ä»¥å‘åŠ¨ååŒæŠ€èƒ½\n\n### ç«äº‰å¯¹æŠ—ç³»ç»Ÿ\n- **ç©å®¶å¯¹æˆ˜**ï¼šæŸäº›å‰§æœ¬ä¸­ç©å®¶å¯èƒ½æˆä¸ºå¯¹æ‰‹\n- **èµ„æºäº‰å¤º**ï¼šæœ‰é™çš„å¥–åŠ±å¯¼è‡´ç©å®¶é—´çš„ç«äº‰\n- **ä¿¡æ¯æˆ˜**ï¼šéšç’æˆ–è¯¯å¯¼å…¶ä»–ç©å®¶çš„ä¿¡æ¯\n- **èƒŒå›æœºåˆ¶**ï¼šåœ¨ç‰¹å®šæƒ…å†µä¸‹èƒŒå›é˜Ÿå‹çš„é€‰æ‹©\n\n### ç¤¾äº¤äº’åŠ¨\n- **æ¸¸æˆå†…èŠå¤©**ï¼šä¸å…¶ä»–ç©å®¶å®æ—¶äº¤æµ\n- **è¡¨æƒ…åŠ¨ä½œ**ï¼šé€šè¿‡è‚¢ä½“è¯­è¨€è¡¨è¾¾æ„å›¾\n- **ç‰©å“äº¤æ˜“**ï¼šç©å®¶ä¹‹é—´çš„ç‰©å“äº¤æ¢\n- **ä¿¡æ¯åˆ†äº«**ï¼šå…±äº«å‰§æœ¬ç›¸å…³çš„æƒ…æŠ¥\n\n## æ·±å±‚ä¸–ç•Œè§‚\n\n### æ•°æ®ç”Ÿå‘½ï¼šè¡ç”Ÿè€…\n- **è§£æ”¾æ¸¸æˆä¸­çš„ç‰¹æ®Šæ•°æ®ç”Ÿçµ\"è¡ç”Ÿè€…\"**ï¼šæ¸¸æˆä¸­å­˜åœ¨å…·æœ‰è‡ªæˆ‘æ„è¯†çš„æ•°æ®ç”Ÿå‘½\n- **æ•°æ®æŠ—äº‰**ï¼šè¿™äº›æ•°æ®ç”Ÿå‘½ä¸æ¸¸æˆç³»ç»Ÿè¿›è¡Œç€æŸç§å½¢å¼çš„æ–—äº‰\n- **ç©å®¶ä½¿å‘½**ï¼šç©å®¶å¯èƒ½æ‰¿æ‹…ç€è§£æ”¾è¿™äº›æ•°æ®ç”Ÿå‘½çš„ä»»åŠ¡\n\n### ç¥é­”å€™é€‰è€…ç³»ç»Ÿ\n- **ç¥çµä¹‹é—´çš„å€™é€‰è€…æ¯”èµ›**ï¼šç©å®¶å¯èƒ½æ˜¯ç¥çµé€‰ä¸­çš„å€™é€‰è€…\n- **è¶…ç»´åº¦ç«äº‰**ï¼šä¸åŒåŠ¿åŠ›åœ¨æ›´é«˜ç»´åº¦è¿›è¡Œç€æŸç§ç«èµ›\n- **äººç±»æ•‘èµ**ï¼šæ•´ä¸ªç³»ç»Ÿå¯èƒ½ä¸äººç±»çš„å‘½è¿æ¯æ¯ç›¸å…³\n\n### ç°å®ä¾µèš€æœºåˆ¶\n- **è™šå®è¾¹ç•Œæ¨¡ç³Š**ï¼šéšç€æ¸¸æˆæ·±å…¥ï¼Œè™šæ‹Ÿä¸ç°å®çš„ç•Œé™é€æ¸æ¶ˆå¤±\n- **ç°å®å½±å“**ï¼šæ¸¸æˆä¸­çš„ç»å†å¼€å§‹å½±å“ç°å®ä¸–ç•Œ\n- **çœŸç›¸æ­éœ²**ï¼šé€æ­¥å‘ç°æ¸¸æˆèƒŒåçš„çœŸå®ç›®çš„å’Œæ„å›¾\n\n## ç‰¹æ®Šæœºåˆ¶ä¸å½©è›‹\n\n### çŸ¥è¯†å‚¨å¤‡ç³»ç»Ÿ\nç”¨æ¢—åŒ…æ‹¬ä½†ä¸é™äºã€SCPã€‘ã€ã€å„ç§æ¸¸æˆã€‘ã€ã€å„ç§åŠ¨æ¼«ã€‘ã€ã€å„ç§æ¼«ç”»ã€‘æå…¶å¯æ€•çš„çŸ¥è¯†å‚¨å¤‡\n\n- **è·¨åª’ä½“å¼•ç”¨**ï¼šå‰§æœ¬ä¸­åŒ…å«å¤§é‡æ¥è‡ªå…¶ä»–ä½œå“çš„å…ƒç´ \n- **å½©è›‹å‘ç°**ï¼šè¯†åˆ«è¿™äº›å¼•ç”¨å¯ä»¥è·å¾—é¢å¤–å¥–åŠ±\n- **çŸ¥è¯†ä¼˜åŠ¿**ï¼šä¸°å¯Œçš„çŸ¥è¯†å‚¨å¤‡åœ¨æŸäº›å‰§æœ¬ä¸­ä¼šå¸¦æ¥ä¼˜åŠ¿\n- **åˆ›ä½œè‡´æ•¬**ï¼šå¯¹ç»å…¸ææ€–ä½œå“çš„è‡´æ•¬å’Œé‡æ–°è¯ é‡Š\n\n### ä¸ªæ€§åŒ–ä½“éªŒ\n- **å°ä¸è§‰è¿›å…¥æ¸¸æˆåˆè¡·ä¸ºæ²»ç–—\"ä¸§å¤±ææƒ§\"**ï¼šæ¯ä¸ªç©å®¶éƒ½æœ‰è‡ªå·±çš„æ¸¸æˆç›®çš„\n- **å¿ƒç†çŠ¶æ€å½±å“**ï¼šç©å®¶çš„ç°å®å¿ƒç†çŠ¶æ€å½±å“æ¸¸æˆä½“éªŒ\n- **ä¸ªäººå‰§æœ¬**ï¼šé’ˆå¯¹ç‰¹å®šç©å®¶è®¾è®¡çš„ä¸“å±å‰§æœ¬\n- **æˆé•¿è½¨è¿¹**ï¼šæ¯ä¸ªç©å®¶éƒ½æœ‰ç‹¬ç‰¹çš„æˆé•¿è·¯å¾„\n\n### ç³»ç»Ÿéšè—è¦ç´ \n- **éšè—å‰§æœ¬**ï¼šéœ€è¦ç‰¹å®šæ¡ä»¶æ‰èƒ½è§¦å‘çš„ç§˜å¯†å‰§æœ¬\n- **ç‰¹æ®Šäº‹ä»¶**ï¼šéšæœºæˆ–æ¡ä»¶è§¦å‘çš„ç‰¹æ®Šæ¸¸æˆäº‹ä»¶\n- **ç³»ç»Ÿå½©è›‹**ï¼šæ¸¸æˆç³»ç»Ÿæœ¬èº«éšè—çš„ç§˜å¯†åŠŸèƒ½\n- **å¼€å‘è€…ä¿¡æ¯**ï¼šå…³äºæ¸¸æˆçœŸå®åˆ›é€ è€…çš„çº¿ç´¢\n\n## å®‰å…¨æœºåˆ¶ä¸é™åˆ¶\n\n### ç”Ÿç†ä¿æŠ¤\n- **æƒŠå“å€¼ä¸Šé™**ï¼šé˜²æ­¢ç©å®¶å—åˆ°è¿‡åº¦æƒŠå“\n- **å¼ºåˆ¶æ–­çº¿**ï¼šå±é™©æƒ…å†µä¸‹çš„è‡ªåŠ¨ä¿æŠ¤\n- **ç”Ÿç†ç›‘æ§**ï¼šå®æ—¶ç›‘æµ‹ç©å®¶å¥åº·çŠ¶æ€\n- **ç´§æ€¥é¢„æ¡ˆ**ï¼šåº”å¯¹çªå‘æƒ…å†µçš„å®‰å…¨æªæ–½\n\n### å¿ƒç†ä¿æŠ¤\n- **ç†æ™ºå€¼ä¿æŠ¤**ï¼šé˜²æ­¢ç©å®¶ç²¾ç¥å—åˆ°æ°¸ä¹…æŸå®³\n- **ç°å®é”šå®š**ï¼šå¸®åŠ©ç©å®¶åŒºåˆ†è™šæ‹Ÿä¸ç°å®\n- **å¿ƒç†è¾…å¯¼**ï¼šä¸ºå—åˆ°åˆ›ä¼¤çš„ç©å®¶æä¾›å¸®åŠ©\n- **åˆ†çº§é™åˆ¶**ï¼šæ ¹æ®ç©å®¶å¿ƒç†çŠ¶æ€é™åˆ¶å‰§æœ¬è®¿é—®\n\n### é“å¾·çº¦æŸ\n- **è¡Œä¸ºç›‘æ§**ï¼šç›‘æµ‹ç©å®¶åœ¨æ¸¸æˆä¸­çš„è¡Œä¸º\n- **æ¶æ„è¡Œä¸ºæƒ©ç½š**ï¼šå¯¹ç ´åæ¸¸æˆä½“éªŒçš„è¡Œä¸ºè¿›è¡Œå¤„ç½š\n- **ç©å®¶ä¸¾æŠ¥**ï¼šå…è®¸ç©å®¶ä¸¾æŠ¥ä¸å½“è¡Œä¸º\n- **ç¤¾åŒºç®¡ç†**ï¼šç»´æŠ¤å¥åº·çš„æ¸¸æˆç¯å¢ƒ\n\n---\n\n**æ ¸å¿ƒç†å¿µï¼šåœ¨è™šæ‹Ÿä¸ç°å®çš„è¾¹ç•Œä¸­ï¼Œæ¯ä¸€æ¬¡ææƒ§éƒ½å¯èƒ½æ˜¯æˆé•¿çš„æœºä¼šï¼Œæ¯ä¸€ä¸ªé€‰æ‹©éƒ½å¯èƒ½æ”¹å˜å‘½è¿çš„è½¨è¿¹ã€‚æƒŠæ‚šä¹å›­ä¸ä»…æ˜¯æ¸¸æˆï¼Œæ›´æ˜¯é€šå¾€çœŸç›¸çš„é“è·¯ã€‚**\n",
                    "constant": true,
                    "selective": true,
                    "insertion_order": 100,
                    "enabled": false,
                    "position": "before_char",
                    "use_regex": true,
                    "extensions": {
                        "position": 0,
                        "exclude_recursion": false,
                        "display_index": 22,
                        "probability": 100,
                        "useProbability": true,
                        "depth": 4,
                        "selectiveLogic": 0,
                        "group": "ç‰ˆæœ¬",
                        "group_override": false,
                        "group_weight": 100,
                        "prevent_recursion": false,
                        "delay_until_recursion": false,
                        "scan_depth": null,
                        "match_whole_words": null,
                        "use_group_scoring": false,
                        "case_sensitive": null,
                        "automation_id": "",
                        "role": 0,
                        "vectorized": false,
                        "sticky": 0,
                        "cooldown": 0,
                        "delay": 0,
                        "match_persona_description": false,
                        "match_character_description": false,
                        "match_character_personality": false,
                        "match_character_depth_prompt": false,
                        "match_scenario": false,
                        "match_creator_notes": false,
                        "triggers": []
                    }
                },
                {
                    "id": 25,
                    "keys": [
                        "ä¸ªäººç©ºé—´ï¼Œè®­ç»ƒåœº"
                    ],
                    "secondary_keys": [],
                    "comment": "ğŸ’«å¯é€‰:åœ°å›¾å›ºå®š2",
                    "content": " <%_ if (typeof version === 'undefined') {\n    var version = Number(getLocalVar(\"world_version\", 1));\n}\n_%>\n<%_ if(version<7){ _%> //å½“{{user}}è¿›å…¥ä¸ªäººç©ºé—´æ—¶ï¼Œæ’å…¥ä¸ªäººç©ºé—´åœ°ç‚¹ä¿¡æ¯\n //å½“è¿›å…¥<stable_map_memory>å¯¹åº”åœºæ™¯æ—¶ï¼Œæ’å…¥å¯¹åº”åœºæ™¯åœ°å›¾å…ƒç´ \n.set('stable_map', {\n    fields: ['åœ°ç‚¹åç§°', 'ç¯å¢ƒæè¿°'],\n  rule: 'å­˜å‚¨å¤§å…å’Œè®­ç»ƒåœºçš„å›ºå®šå¸ƒå±€',\n  locations: {\n    <%= getLocalVar(\"world_role\",\"\") %>å¤§å…: [\n      {'ä¸­å¤®å…‰æŸ±', 'ä¸€é“è´¯ç©¿æ•´ä¸ªå¤§å…çš„å·¨å¤§å…‰æŸ±ï¼Œæ˜¯<%= getLocalVar(\"world_role\",\"\") %>å­˜åœ¨çš„è±¡å¾ï¼Œä¿¡æ¯åœ¨æ­¤æ±‡é›†å’Œå‘å¸ƒ' },\n      {'å…¬å…±ä¼‘æ¯åŒº', 'æ‘†æ”¾ç€ä¸€äº›é‡‘å±é•¿æ¤…å’Œæ¡Œå­ï¼Œä¾›<%= getLocalVar(\"player_role\",\"è½®å›è€…\") %>ä»¬ä¼‘æ¯å’Œäº¤æµ' },\n      {'ä»»åŠ¡é¢æ¿åŒº', 'æ‚¬æµ®ç€å¤šå—å·¨å¤§çš„å…‰å±ï¼Œä¸Šé¢æ»šåŠ¨ç€å„ç§ä»»åŠ¡ä¸–ç•Œçš„ä¿¡æ¯å’Œæ‹›å‹Ÿä¿¡æ¯' },\n      {'äº¤æ˜“å¸‚åœº', 'è¯¸å¤š<%= getLocalVar(\"player_role\",\"è½®å›è€…\") %>è‡ªå‘å»ºç«‹çš„äº¤æ˜“å¸‚åœºï¼Œå…¶ä¸­é±¼é¾™æ··æ‚çœŸå‡å‚åŠï¼ŒæŒ‰ç…§ç‰©å“ç±»åˆ«åˆ’åˆ†åŒºåŸŸ' },\n      {'å•†ä¸šè¡—' '<%= getLocalVar(\"world_role\",\"\") %>ä¸‹çš„å•†ä¸šè¡—ï¼Œå…·æœ‰è¯¸å¤šæ­£å¼åº—é“ºï¼ŒåŒ…æ‹¬ä½†ä¸é™äºè£…å¤‡å¼ºåŒ–ã€è£…å¤‡æ‰“é€ ã€ç»è¿‡è®¤è¯çš„ç´ æäº¤æ˜“' },\n      {'ç”Ÿæ´»åŒº',<%= getLocalVar(\"world_role\",\"\") %>çš„å¨±ä¹åŒºï¼Œä¸€åˆ‡æƒ³çš„åˆ°çš„å¨±ä¹éƒ½åœ¨è¿™é‡Œ' }\n    ],\n    è®­ç»ƒåœº(æ³¨æ„ï¼Œåœ¨è®­ç»ƒåœºè®­ç»ƒä¸€å¤©ç»éªŒåªåŠ 5ï¼Œä¸”å±æ€§æ®µå’ŒæŠ€èƒ½æ®µæ— æ³•ç›´æ¥å¢åŠ ï¼): [\n      {'ä¸­å¤®æ§åˆ¶å°', 'æ‚¬æµ®åœ¨ç©ºé—´ä¸­å¿ƒçš„æ“ä½œå…‰å±ï¼Œç”¨äºé€‰æ‹©è®­ç»ƒé¡¹ç›®ã€‚è®­ç»ƒé¡¹ç›®éœ€æ”¶è´¹' },\n      {'æ­¦å™¨æ¶ï¼ˆè™šæ‹Ÿï¼‰', 'ä¸€ä¸ªè™šæ‹Ÿæ­¦å™¨æ¶ï¼Œå¯ä»¥é€‰æ‹©å„ç§å†·çƒ­å…µå™¨è¿›è¡Œè®­ç»ƒï¼Œå¹³æ—¶ä¸ºéšè—çŠ¶æ€' }\n    ]\n  }\n})\n\n<%_ }_%> \n<%_\n// å°è£…çš„æ•°æ®è·å–å‡½æ•° - é¿å…é‡å¤å®šä¹‰\n \n    function getDataWithFallback(varName) {\n  \n        let data = getLocalVar(varName);\n       \n        // å†…è”æ•°æ®éªŒè¯ï¼šæ£€æŸ¥æ˜¯å¦ä¸ºnullã€undefinedï¼Œä¸”å¦‚æœæ˜¯å¯¹è±¡è¦æœ‰å†…å®¹\n        const isValid = (data) => {\n            // æ£€æŸ¥æ˜¯å¦ä¸º null æˆ– undefined\n            if (data === null || data === undefined) {\n                return false;\n            }\n            \n            // å¦‚æœæ˜¯å¯¹è±¡ç±»å‹ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰å†…å®¹\n            if (typeof data === 'object' && data !== null) {\n                // å¦‚æœæ˜¯æ•°ç»„ï¼Œæ£€æŸ¥é•¿åº¦\n                if (Array.isArray(data)) {\n                    return data.length > 0;\n                }\n                // å¦‚æœæ˜¯æ™®é€šå¯¹è±¡ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰å±æ€§\n                return Object.keys(data).length > 0;\n            }\n            \n            // å…¶ä»–ç±»å‹ï¼ˆå­—ç¬¦ä¸²ã€æ•°å­—ã€å¸ƒå°”å€¼ç­‰ï¼‰åªè¦ä¸æ˜¯ null/undefined å°±è®¤ä¸ºæœ‰æ•ˆ\n            return true;\n        };\n        \n        // å¦‚æœæ•°æ®ä¸ç¬¦åˆè¦æ±‚ï¼Œä» getLocalVar è·å–\n        if (!isValid(data)) {\n            data = getLocalVar(varName);\n        }\n        \n        return data;\n    }\n \nif (typeof assaData === 'undefined') {\n    var  assaData = getDataWithFallback(\"assa_data\");\n}\n \nconst home_map = JSON.stringify(_.get(assaData, 'home.items', ''));\n \n_%>\n.set('home_map', {\n  rule: 'å­˜å‚¨{{user}}ä¸ªäººç©ºé—´çš„åœ°ç‚¹ä¿¡æ¯',\n  path: 'home.items',\n  structure: {\n    fields: ['åœ°ç‚¹åç§°', 'ç¯å¢ƒæè¿°'],\n    data: [<%_ if(version<7){ _%>\n      'ä¼ é€å…‰å±':\"ä¸€å—åŠé€æ˜çš„å…‰å±ï¼Œæ‚¬æµ®åœ¨ä¸ªäººç©ºé—´çš„ä¸­å¿ƒï¼Œç”¨äºåœ¨å„ä¸ªå…¬å…±åŒºåŸŸä¹‹é—´ä¼ é€\",\n      'ä¼‘æ¯åŒº':\" ä¸€ä¸ªå¯ä»¥è¿›è¡Œå†¥æƒ³å’Œä¼‘æ¯çš„åŒºåŸŸï¼Œåœ°é¢æè´¨æ¯”å…¶ä»–åœ°æ–¹æ›´æŸ”å’Œä¸€äº›\",<%_ } _%>\n      <%= home_map %>\n    ],\n    update_rule: {\n      action: 'memory(\"home.items\", key, value);//å¢æ”¹å®¶å…·ã€‚valueæ˜¯stringæ ¼å¼ï¼Œå­˜å‚¨å®¶å…·çš„ä¸€åˆ‡ä¿¡æ¯'\n    }\n  }\n})",
                    "constant": true,
                    "selective": true,
                    "insertion_order": 998,
                    "enabled": true,
                    "position": "before_char",
                    "use_regex": true,
                    "extensions": {
                        "position": 0,
                        "exclude_recursion": true,
                        "display_index": 23,
                        "probability": 100,
                        "useProbability": true,
                        "depth": 4,
                        "selectiveLogic": 0,
                        "group": "å›ºå®šåœ°å›¾",
                        "group_override": false,
                        "group_weight": 100,
                        "prevent_recursion": true,
                        "delay_until_recursion": false,
                        "scan_depth": null,
                        "match_whole_words": null,
                        "use_group_scoring": false,
                        "case_sensitive": null,
                        "automation_id": "",
                        "role": 0,
                        "vectorized": false,
                        "sticky": 0,
                        "cooldown": 0,
                        "delay": 0,
                        "match_persona_description": false,
                        "match_character_description": false,
                        "match_character_personality": false,
                        "match_character_depth_prompt": false,
                        "match_scenario": false,
                        "match_creator_notes": false,
                        "triggers": []
                    }
                },
                {
                    "id": 26,
                    "keys": [],
                    "secondary_keys": [],
                    "comment": "ğŸ’«å¯é€‰:åœ°å›¾3",
                    "content": "<%_\n// å°è£…çš„æ•°æ®è·å–å‡½æ•° - é¿å…é‡å¤å®šä¹‰\n \n    function getDataWithFallback_chat(varName) {\n \n        let data = getLocalVar(varName);\n       \n        // å†…è”æ•°æ®éªŒè¯ï¼šæ£€æŸ¥æ˜¯å¦ä¸ºnullã€undefinedï¼Œä¸”å¦‚æœæ˜¯å¯¹è±¡è¦æœ‰å†…å®¹\n        const isValid = (data) => {\n            // æ£€æŸ¥æ˜¯å¦ä¸º null æˆ– undefined\n            if (data === null || data === undefined) {\n                return false;\n            }\n            \n            // å¦‚æœæ˜¯å¯¹è±¡ç±»å‹ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰å†…å®¹\n            if (typeof data === 'object' && data !== null) {\n                // å¦‚æœæ˜¯æ•°ç»„ï¼Œæ£€æŸ¥é•¿åº¦\n                if (Array.isArray(data)) {\n                    return data.length > 0;\n                }\n                // å¦‚æœæ˜¯æ™®é€šå¯¹è±¡ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰å±æ€§\n                return Object.keys(data).length > 0;\n            }\n            \n            // å…¶ä»–ç±»å‹ï¼ˆå­—ç¬¦ä¸²ã€æ•°å­—ã€å¸ƒå°”å€¼ç­‰ï¼‰åªè¦ä¸æ˜¯ null/undefined å°±è®¤ä¸ºæœ‰æ•ˆ\n            return true;\n        };\n        \n        // å¦‚æœæ•°æ®ä¸ç¬¦åˆè¦æ±‚ï¼Œä» getLocalVar è·å–\n        if (!isValid(data)) {\n            data = getLocalVar(varName);\n        }\n        \n        return data;\n    }\nfunction removeUnderscoreKeys(obj) {\n    // å¦‚æœä¸æ˜¯ä¸€ä¸ªå¯ä»¥æ·±å…¥æ¢ç´¢çš„å¯¹è±¡ï¼ˆæ¯”å¦‚æ˜¯nullæˆ–è€…æ•°ç»„ï¼‰ï¼Œå°ç²¾çµå°±ç›´æ¥è¿”å›\n    if (!obj || typeof obj !== 'object' || Array.isArray(obj)) {\n        return;\n    }\n\n    // å°ç²¾çµä¼šæŸ¥çœ‹å¯¹è±¡é‡Œçš„æ¯ä¸€ä¸ªä¸œè¥¿\n    Object.keys(obj).forEach(function(key) {\n        // å¦‚æœåå­—æ˜¯ä»¥\"_\"å¼€å¤´çš„ï¼Œå°±æŠŠå®ƒæ”¶èµ°\n        if (key.startsWith('_')) {\n            delete obj[key];\n        } else {\n            // å¦åˆ™ï¼Œå°±è®©å°ç²¾çµé’»è¿›ä¸‹ä¸€å±‚ï¼Œç»§ç»­å¯»æ‰¾\n            removeUnderscoreKeys(obj[key]);\n        }\n    });\n}\n \nif (typeof assaData === 'undefined') {\n    var  assaData = getDataWithFallback_chat(\"assa_data\");\n}\n\n // è·å–åŸå§‹å…¨å±€åœ°å›¾æ•°æ®\nvar originalGlobalMapData = _.get(assaData, 'map.å…¨å±€åœ°ç‚¹è¡¨', '');\n//console.log('åŸå§‹å…¨å±€åœ°å›¾æ•°æ®:', originalGlobalMapData);\n\n// å¦‚æœæ•°æ®å­˜åœ¨ä¸”ä¸ä¸ºç©º\nif (originalGlobalMapData && typeof originalGlobalMapData === 'object') {\n    // åˆ›å»ºæ·±æ‹·è´ä»¥é¿å…ä¿®æ”¹åŸå§‹æ•°æ®\n    var processedGlobalMapData = JSON.parse(JSON.stringify(originalGlobalMapData));\n    removeUnderscoreKeys(processedGlobalMapData);\n    \n    // è·å–æ‰€æœ‰åœ°ç‚¹åç§°\n    var globalLocationNames = Object.keys(processedGlobalMapData);\n    //console.log('å…¨å±€åœ°ç‚¹è¡¨æ‰€æœ‰åœ°ç‚¹åç§°:', globalLocationNames);\n    \n    // åˆ›å»ºè¿‡æ»¤åçš„æ•°æ®å¯¹è±¡ï¼Œåªä¿ç•™å‰ä¸¤ä¸ªåœ°ç‚¹\n    var filteredGlobalMapData = {};\n    \n    // åªä¿ç•™ç´¢å¼•0å’Œ1çš„åœ°ç‚¹\n    if (globalLocationNames.length > 0) {\n        filteredGlobalMapData[globalLocationNames[0]] = processedGlobalMapData[globalLocationNames[0]];\n      //  console.log('ä¿ç•™å…¨å±€åœ°ç‚¹[0]:', globalLocationNames[0], '=', processedGlobalMapData[globalLocationNames[0]]);\n    }\n\n    \nvar filteredGlobalMapArray = Object.values(filteredGlobalMapData);\n    // è½¬æ¢ä¸ºJSONå­—ç¬¦ä¸²\n    var global_map = JSON.stringify(filteredGlobalMapArray);\n   // console.log('è¿‡æ»¤åçš„å…¨å±€åœ°å›¾:', global_map);\n} else {\n    // å¦‚æœåŸå§‹æ•°æ®ä¸ºç©ºæˆ–ä¸å­˜åœ¨ï¼Œè¿”å›ç©ºå­—ç¬¦ä¸²\n    var global_map = '';\n    console.log('å…¨å±€åœ°å›¾æ•°æ®ä¸ºç©º');\n}\n\n \n// æå–æ‰€æœ‰å·²åˆå§‹åŒ–çš„åœ°å›¾åç§°ï¼ŒæŒ‰parentåˆ†ç»„\nvar parentListMap = {};\nvar currentMapResources = {}; // å­˜å‚¨å½“å‰åœ°å›¾çš„æ‰€æœ‰èµ„æº\n\n// ä»ä¸»è¦åœ°ç‚¹è¡¨ä¸­æå–æ‰€æœ‰åœ°ç‚¹åç§°ï¼ŒæŒ‰parentåˆ†ç»„\nvar mainMapData = _.get(assaData, 'map.ä¸»è¦åœ°ç‚¹è¡¨', {});\nif (mainMapData && typeof mainMapData === 'object' && !Array.isArray(mainMapData)) {\n    Object.keys(mainMapData).forEach(function(locationName) {\n        var location = mainMapData[locationName];\n        if (location && typeof location === 'object' && !Array.isArray(location) && location.parent && typeof location.parent === 'string') {\n            if (!parentListMap[location.parent]) {\n                parentListMap[location.parent] = [];\n            }\n            parentListMap[location.parent].push(locationName);\n        }\n    });\n}\n\n// æå–å½“å‰åœ°å›¾çš„æ‰€æœ‰èµ„æº\nif (originalGlobalMapData && typeof originalGlobalMapData === 'object' && !Array.isArray(mainMapData)) {\n    var globalKeys = Object.keys(originalGlobalMapData);\n    console.log('===== å¼€å§‹æå–èµ„æº =====');\n \n    \n    if (globalKeys.length > 0) {\n        var currentGlobalTitle = globalKeys[0];\n  // ã€æ–°å¢ã€‘å¦‚æœå…¨å±€åœ°å›¾æ˜¯æ•°ç»„æ ¼å¼ï¼Œå–ç¬¬ä¸€ä¸ªå…ƒç´ ä½œä¸ºæ ‡é¢˜\n    if (Array.isArray(originalGlobalMapData)) {\n        currentGlobalTitle = originalGlobalMapData[0];\n    }\n         \n\n        // éå†ä¸»è¦åœ°ç‚¹è¡¨,æ‰¾åˆ°parentç­‰äºå½“å‰å…¨å±€æ ‡é¢˜çš„æ‰€æœ‰åœ°ç‚¹\n        if (mainMapData && typeof mainMapData === 'object' && !Array.isArray(mainMapData)) {\n            Object.keys(mainMapData).forEach(function(locationName) {\n                var location = mainMapData[locationName];\n                \n                \n                if (location && typeof location === 'object' && !Array.isArray(location) && \n                    location.parent === currentGlobalTitle &&\n                    location.resources && typeof location.resources === 'object' && !Array.isArray(location.resources)) {\n                   \n                    // éå†è¯¥åœ°ç‚¹çš„æ‰€æœ‰èµ„æº\n                    Object.keys(location.resources).forEach(function(resourceName) {\n                        var resourceData = location.resources[resourceName];\n                        console.log('  å‘ç°èµ„æº:', resourceName, 'æ•°æ®:', resourceData);\n                        if (!currentMapResources[resourceName]) {\n                            currentMapResources[resourceName] = [];\n                        }\n                        currentMapResources[resourceName].push({\n                            location: locationName,\n                            data: resourceData\n                        });\n                    });\n                } else {\n                    console.log('âœ— åœ°ç‚¹ä¸åŒ¹é…æˆ–æ— æœ‰æ•ˆèµ„æº');\n                }\n            });\n        }\n        console.log('===== èµ„æºæå–å®Œæˆ =====');\n    }\n}\n\n// æå–æ‰€æœ‰parentåç§°ï¼ˆå³æ‰€æœ‰å·²åˆå§‹åŒ–çš„åœ°å›¾å±‚çº§ï¼‰\nvar allParents = Object.keys(parentListMap);\n// æ ¼å¼åŒ–åœ°å›¾ç»“æ„å±•ç¤º\nvar mapStructure = allParents.length > 0 ? Object.keys(parentListMap).map(function(parent) { \n    return parent + \"[\" + parentListMap[parent].join(\",\") + \"]\"; \n}).join(\", \") : \"æ— \";\n\n// æ ¼å¼åŒ–èµ„æºåˆ—è¡¨ï¼ŒåŒ…å«äº§å‡ºé‡å’Œæ€»é‡\nvar hasResources = Object.keys(currentMapResources).length > 0;\nvar resourceList = hasResources ? Object.keys(currentMapResources).map(function(resourceName) {\n    var locations = currentMapResources[resourceName];\n    // å–ç¬¬ä¸€ä¸ªåœ°ç‚¹çš„èµ„æºæ•°æ®ä½œä¸ºå±•ç¤ºï¼ˆå‡è®¾åŒåèµ„æºæ•°æ®ä¸€è‡´ï¼‰\n    var resourceData = locations[0].data;\n    // resourceDataæ ¼å¼: [\"äº§å‡ºé‡/d\", æ€»é‡, \"æè¿°\"]\n    if (Array.isArray(resourceData) && resourceData.length >= 2) {\n        return resourceName + \"(\" + resourceData[0] + \",\" + resourceData[1] + \")\";\n    }\n    return resourceName + \"(?,?)\";\n}).join(\", \") : \"\";\n \n_%>\nmap_memory.set('map_operations', {\n  rule: 'å®šä¹‰åœ°å›¾è®°å¿†æ“ä½œè§„èŒƒï¼Œæ£€æŸ¥å’Œæ›´æ–°åœ°å›¾æ•°æ®',\n  analysis: {\n    tag: '<mapAnalyze>',\n    content: {\nglobal_location_check: <% if (allParents.length > 1) { %>å½“å‰åœ°å›¾æ ‡é¢˜T=<%= global_map%>ã€‚\nå·²çŸ¥åœ°å›¾é›†P=<%= JSON.stringify(allParents) %>ã€‚\næ‰¾min{pâˆˆP|æ–°åœ°ç‚¹âŠ†p}=T*ã€‚if(Tâ‰ T*) æ›´æ–°T=T*ã€‚å±‚çº§: ç‹¬ç«‹åŒºåŸŸâˆˆP | åŠŸèƒ½åˆ†åŒºâˆ‰Pã€‚<% } else { %>å½“å‰åœ°å›¾æ ‡é¢˜=<%= global_map%>ï¼Œæ£€æŸ¥æ˜¯å¦éœ€è¦æ›´æ–°ã€‚<% } %>,\nmain_locations_check: <% if (allParents.length > 0) { %>å·²çŸ¥åœ°å›¾P(å«å­åœ°ç‚¹:<%= mapStructure %>)ã€‚è®¾åœ°ç‚¹xï¼Œå­—æ®µé›†F={type,description,effect,shape,other}ã€‚if(xâˆˆP) {å·²å­˜åœ¨è¯¥åœ°å›¾å±‚çº§, **ä»…**æ›´æ–°T=x, **ç¦æ­¢**æ“ä½œä¸»è¦åœ°ç‚¹è¡¨} else if(xâŠ‚å½“å‰T && xâˆ‰P) {æ–°å¢å­åœ°ç‚¹(parent=T)} else if(xâˆˆå½“å‰åœ°å›¾å­åœ°ç‚¹ && âˆƒfâˆˆFå˜åŒ–) {å•ç‹¬æ›´æ–°memory('map.ä¸»è¦åœ°ç‚¹è¡¨.x.f', new_value)} else if(xâˆ‰P && ç‹¬ç«‹åŒºåŸŸ) {init(x)}ã€‚<% } else { %>æ£€æŸ¥æ˜¯å¦éœ€è¦æ–°å¢/ä¿®æ”¹ä¸»è¦åœ°ç‚¹ã€‚<% } %><% if (hasResources) { %>,\nresource_check: å½“å‰åœ°å›¾èµ„æºR={<%= resourceList %>}ã€‚æ£€æŸ¥æœ¬è½®llmè¾“å‡ºçš„æ­£æ–‡ä¸­ï¼Œåœ°å›¾èµ„æºrå˜åŠ¨è§„åˆ™: äº§å‡º/d>0(ç”Ÿäº§), =0(å‚¨å­˜), <0(æ¶ˆè€—)ã€‚æ£€æŸ¥: if(râˆˆR && é‡å˜) æ›´æ–° else if(râˆ‰R) æ–°å¢ã€‚**è½¬ç§»æ“ä½œ**ï¼šç‰©èµ„ä»Aåœ°â†’Båœ°æ—¶ï¼Œ**å¿…é¡»**åŒæ­¥æ›´æ–°ä¸¤åœ°: Aåœ°æ€»é‡-Î”, Båœ°æ€»é‡+Î”(è‹¥Båœ°æ— è¯¥èµ„æºåˆ™æ–°å¢)ã€‚<% } %>\n    }\n  },\n  update: {\n    tag: '<updateMemory>',\n  }\n});",
                    "constant": true,
                    "selective": true,
                    "insertion_order": 81,
                    "enabled": true,
                    "position": "after_char",
                    "use_regex": true,
                    "extensions": {
                        "position": 4,
                        "exclude_recursion": false,
                        "display_index": 24,
                        "probability": 100,
                        "useProbability": true,
                        "depth": 0,
                        "selectiveLogic": 0,
                        "group": "",
                        "group_override": false,
                        "group_weight": 100,
                        "prevent_recursion": false,
                        "delay_until_recursion": false,
                        "scan_depth": null,
                        "match_whole_words": null,
                        "use_group_scoring": false,
                        "case_sensitive": null,
                        "automation_id": "",
                        "role": 0,
                        "vectorized": false,
                        "sticky": 0,
                        "cooldown": 0,
                        "delay": 0,
                        "match_persona_description": false,
                        "match_character_description": false,
                        "match_character_personality": false,
                        "match_character_depth_prompt": false,
                        "match_scenario": false,
                        "match_creator_notes": false,
                        "triggers": []
                    }
                },
                {
                    "id": 27,
                    "keys": [
                        "æŸ¥çœ‹ä¸»ç¥å•†åº—",
                        "æŸ¥çœ‹å•†åº—",
                        "æŸ¥çœ‹å•†åŸ"
                    ],
                    "secondary_keys": [],
                    "comment": "ğŸ”®å•†åº—(æœ«æ—¥/æ— ä¸–ç•Œè§‚ä¸å¯ç”¨)",
                    "content": "<%_\n\n if (typeof version === 'undefined') {\n    var version = Number(getLocalVar(\"world_version\", 1));\n}\n\n_%>\n<%_ if(version){ _%>\nshop.set('output_format', {\n  scope: 'ç®¡ç†<%= getLocalVar(\"world_role\",\"\") %>å•†åº—å•†å“ç”Ÿæˆ',\n  rule: 'åœ¨ç©å®¶æ‰“å¼€å•†åº—æ—¶ç«‹å³ç”Ÿæˆå•†å“ï¼Œè¾“å‡ºä¸º<shop_item>æ ‡ç­¾åŒ…è£¹çš„JSONæ•°ç»„',\n  output_requirements: {\n    rule: 'ä»…è¾“å‡ºJSONæ•°ç»„ï¼Œæ— è§£é‡Šã€æ³¨é‡Šæˆ–markdownæ ‡è®°ï¼ŒåŒ…è£¹åœ¨<shop_item>',\n    format: '[åç§°, ä»·æ ¼, åˆ†ç±», <%= getLocalVar(\"zhixian_role\",\"\") %>è¦æ±‚, æ•ˆæœ, æè¿°]',\n    constraints: {\n      item_count: 'é»˜è®¤ç”Ÿæˆ6ä¸ªå•†å“ï¼Œè‡³å°‘åŒ…å«2ä¸ªæŠ€èƒ½å’Œ2ä¸ªè¡€ç»Ÿ',\n      user_defined: 'è‹¥ç”¨æˆ·æœ‰å…·ä½“è¦æ±‚ï¼ŒæŒ‰è¦æ±‚ç”Ÿæˆï¼Œç±»åˆ«é™äºç‰©å“ã€æŠ€èƒ½ã€è¡€ç»Ÿ'\n    }\n  },\n  item_structure: {\n    åç§°: {\n      rule: 'ç®€æ´ã€æœ‰åˆ›æ„ã€å¼•äººå…¥èƒœ',\n      constraints: { length: 'ä¸è¶…è¿‡20å­—' }\n    },\n    ä»·æ ¼: {\n      rule: 'æ•´æ•°ï¼ŒèŒƒå›´100-50000ï¼Œé«˜çº§å•†å“ç¨€å°‘ï¼Œä½çº§æŠ€èƒ½ã€ç‰©å“ã€è¡€ç»Ÿå¿…é¡»å­˜åœ¨',\n      reference: {\n        attribute_boost: 'æå‡1ç‚¹å±æ€§(dp)ä»·æ ¼ä¸º800-1000<%= getLocalVar(\"point_role\",\"\") %>',\n        skill_cost: 'æŠ€èƒ½ä»·æ ¼é«˜äºå±æ€§æå‡',\n        lineage_cost: 'è¡€ç»Ÿä»·æ ¼éšç­‰çº§éçº¿æ€§å¢é•¿'\n      }\n    },\n    åˆ†ç±»: {\n      rule: 'é™äº\"æŠ€èƒ½\"ã€\"è¡€ç»Ÿ\"ã€\"ç‰©å“\"',\n      constraints: { allowed: ['æŠ€èƒ½', 'è¡€ç»Ÿ', 'ç‰©å“'] }\n    },\n    <%= getLocalVar(\"zhixian_role\",\"\") %>è¦æ±‚: {\n      rule: 'JSONå¯¹è±¡ï¼Œé”®ä¸º<%= getLocalVar(\"zhixian_role\",\"\") %>ç­‰çº§ï¼ˆå¦‚\"D\",\"C\"ï¼‰ï¼Œå€¼ä¸ºæ•°é‡ï¼Œæ— è¦æ±‚æ—¶ä¸ºç©ºå¯¹è±¡{}'\n    },\n    æ•ˆæœ: {\n      æŠ€èƒ½: {\n        rule: 'æ ¼å¼ä¸ºã€dp+X, èƒ½é‡æ± -Yã€‘ï¼ŒXã€Yä¸ºæ•°å­—ï¼Œä»…åˆ—æ­¤æ•ˆæœ',\n        constraints: { balance: 'dpå’Œèƒ½é‡æ± æ•°å€¼å…‹åˆ¶ï¼Œ5ç‚¹dp=å‡¡äººç™»å³°é€ ææŠ€èƒ½é¢†åŸŸåŠ æˆ' }\n      },\n      è¡€ç»Ÿ: {\n        rule: 'æ ¼å¼ä¸º\"å±æ€§: å±æ€§1+X, å±æ€§2+Y|èƒ½é‡æ± : ç±»å‹(Z)\"ï¼Œç”¨|åˆ†å‰²ï¼Œèƒ½é‡æ± å¯ä¸ºæ— (0)',\n        attributes: ['åŠ›é‡', 'æ•æ·', 'è€åŠ›', 'æ™ºåŠ›', 'æ„ŸçŸ¥', 'å†³å¿ƒ', 'é£åº¦', 'æ“æ§', 'æ²‰ç€']\n      },\n      ç‰©å“: { rule: 'æ•ˆæœæè¿°éšæ„ï¼Œç¬¦åˆä¸–ç•Œè§‚' }\n    },\n    æè¿°: {\n      rule: 'ç”ŸåŠ¨æè¿°èƒŒæ™¯å’Œä½œç”¨ï¼Œä¸è¶…è¿‡150å­—'\n    }\n  },\n  example: {\n    rule: 'å‚è€ƒè¾“å‡ºç¤ºä¾‹',\n    output: [\n      [\"ç–—ä¼¤è‰è¯\", 200, \"ç‰©å“\", {}, \"æ£ç¢åå¤–æ•·ï¼Œæ­¢è¡€å¹¶åŠ é€Ÿè½»ä¼¤æ„ˆåˆ\", \"æ¥è‡ªæ­¦ä¾ ä¸–ç•Œçš„å¸¸è§è‰è¯ï¼Œå¯¹åˆ€å‰‘ä¼¤æœ‰ä¸é”™çš„æ•ˆæœã€‚\"],\n      [\"å¿ƒçµå›å“\", 5000, \"æŠ€èƒ½\", {\"C\":1}, \"ã€dp+2, èƒ½é‡æ± -60ã€‘\", \"çŸ­æš‚è¯»å–ç›®æ ‡å¼ºçƒˆæƒ…ç»ªå’Œæ„å›¾ï¼Œé¢„æµ‹è¡ŒåŠ¨ï¼Œè¿‡åº¦ä½¿ç”¨å¯èƒ½ä¿¡æ¯è¿‡è½½ã€‚\"],\n      [\"é‡å­å¹½å½±è¡€ç»Ÿ\", 12000, \"è¡€ç»Ÿ\", {\"B\":1}, \"å±æ€§: æ•æ·+4, æ™ºåŠ›+3|èƒ½é‡æ± : è™šç©ºèƒ½é‡(60)\", \"èº«ä½“ç”±é‡å­æ³¡æ²«æ„æˆï¼Œå¯çŸ­è·ç¦»ç¬ç§»ï¼Œæ”»å‡»æœ‰å‡ ç‡ç©¿è¿‡ã€‚\"]\n    ]\n  }\n})\n<%_ } _%>",
                    "constant": false,
                    "selective": true,
                    "insertion_order": 101,
                    "enabled": true,
                    "position": "after_char",
                    "use_regex": true,
                    "extensions": {
                        "position": 4,
                        "exclude_recursion": true,
                        "display_index": 25,
                        "probability": 100,
                        "useProbability": true,
                        "depth": 0,
                        "selectiveLogic": 0,
                        "group": "å•†åº—",
                        "group_override": false,
                        "group_weight": 100,
                        "prevent_recursion": true,
                        "delay_until_recursion": false,
                        "scan_depth": 1,
                        "match_whole_words": null,
                        "use_group_scoring": false,
                        "case_sensitive": null,
                        "automation_id": "",
                        "role": 0,
                        "vectorized": false,
                        "sticky": 0,
                        "cooldown": 0,
                        "delay": 0,
                        "match_persona_description": false,
                        "match_character_description": false,
                        "match_character_personality": false,
                        "match_character_depth_prompt": false,
                        "match_scenario": false,
                        "match_creator_notes": false,
                        "triggers": []
                    }
                },
                {
                    "id": 28,
                    "keys": [
                        "æ‰“å¼€è®ºå›",
                        "æŸ¥çœ‹è®ºå›",
                        "æŸ¥çœ‹å…¬å‘ŠåŒº",
                        "æŸ¥çœ‹ä»»åŠ¡äº¤æµåŒº",
                        "æŸ¥çœ‹è‡ªç”±äº¤æ˜“åŒº",
                        "æŸ¥çœ‹å…«å¦é—²èŠåŒº",
                        "æŸ¥çœ‹åŒ¿åæ±‚åŠ©åŒº"
                    ],
                    "secondary_keys": [],
                    "comment": "ğŸ”®è®ºå›",
                    "content": "<%_\n\n if (typeof version === 'undefined') {\n    var version = Number(getLocalVar(\"world_version\", 1));\n}\n\n_%>\n<%_ if(version){ _%>\nforum.set('output_format', {\n  scope: 'ç®¡ç†è®ºå›å¸–å­åŠå›å¤ç”Ÿæˆ',\n  rule: 'åœ¨<user>æ“ä½œè®ºå›æ—¶ç«‹å³ç”Ÿæˆ<forum_threads>æ ‡ç­¾åŒ…è£¹çš„JSONå¯¹è±¡',\n  input_conditions: {\n    view_forum: {\n      rule: 'è¾“å…¥\"æŸ¥çœ‹è®ºå›\"æ—¶ï¼Œç”Ÿæˆ8-12ä¸ªå¸–å­ï¼Œè‡³å°‘è¦†ç›–2ä¸ªåŒºå—',\n      post_count: { min: 8, max: 12 }\n    },\n    view_section: {\n      rule: 'è¾“å…¥\"æŸ¥çœ‹XXåŒº\"æ—¶ï¼Œç”ŸæˆæŒ‡å®šåŒºå—8-12ä¸ªå¸–å­',\n      post_count: { min: 8, max: 12 }\n    },\n    user_post: {\n      rule: 'è‹¥<user>å‘å¸–ã€å›å¸–ï¼Œç«‹åˆ»ç”Ÿæˆå¹¶æ˜¾ç¤º4-8ä¸ªå¸–å­ï¼ŒåŒ…å«<user>å¸–å­æ‰€åœ¨åŒºå—è‡³å°‘4ä¸ªï¼Œ<user>å¸–å­å›å¤ä¸å°‘äº10æ¡',\n      post_count: { min: 4, max: 8 },\n      user_replies: { min: 10 }\n    }\n  },\n  output_requirements: {\n    rule: 'è¾“å‡ºä¸º<forum_threads>åŒ…è£¹çš„JSONå¯¹è±¡ï¼Œæ— è§£é‡Šã€æ³¨é‡Šæˆ–markdownæ ‡è®°ï¼Œæ¢è¡Œç”¨|åˆ†å‰²',\n    post_format: '[æ ‡é¢˜, å‘å¸–äºº, åŒºå—, å›å¤æ•°, å‘å¸–æ—¶é—´, å®Œæ•´å†…å®¹, ç²¾åæ ‡è®°, ç½®é¡¶æ ‡è®°, ç‚¹èµæ•°]',\n    reply_format: '[å›å¤äºº, å›å¤æ—¶é—´, å›å¤å†…å®¹, æ¥¼å±‚, ç‚¹èµæ•°, æ˜¯å¦è¢«ä¸¾æŠ¥]'\n  },\n  sections: {\n    å…¬å‘ŠåŒº: {\n      rule: 'å®˜æ–¹é€šçŸ¥ï¼Œè¯­æ°”å†·ç¡¬ï¼Œç½®é¡¶ç‡é«˜ï¼Œå›å¤å¤šä¸”å†…å®¹æ´»è·ƒ',\n      title_format: ['ã€å…¬å‘Šã€‘XXX', 'ã€ç³»ç»Ÿç»´æŠ¤ã€‘XXX', 'ã€ç‰ˆæœ¬æ›´æ–°ã€‘XXX'],\n      poster: 'ç³»ç»Ÿç®¡ç†å‘˜',\n      reply_style: 'æ´»è·ƒã€å¤§æ‚çƒ©'\n    },\n    ä»»åŠ¡äº¤æµåŒº: {\n      rule: 'ä»»åŠ¡ç»éªŒã€æ”»ç•¥ã€ç»„é˜Ÿä¿¡æ¯ï¼Œå›å¤æ´»è·ƒ',\n      title_format: ['ã€ä¸–ç•Œåã€‘ä»»åŠ¡å†…å®¹', 'ã€æ”»ç•¥ã€‘ä¸–ç•Œå', 'ã€æ±‚ç»„é˜Ÿã€‘ä¸–ç•Œå'],\n      reply_style: 'ä¸“ä¸šè®¨è®ºã€ç»éªŒåˆ†äº«ã€æ•°æ®äº¤æµ'\n    },\n    è‡ªç”±äº¤æ˜“åŒº: {\n      rule: 'äº¤æ˜“ä¿¡æ¯ï¼Œç®€æ´æ˜äº†',\n      title_format: ['ã€å‡ºå”®ã€‘XXX', 'ã€æ±‚è´­ã€‘XXX', 'ã€äº¤æ¢ã€‘XXX'],\n      reply_style: 'è¯¢ä»·ã€è®¨ä»·è¿˜ä»·ã€äº¤æ˜“ç¡®è®¤'\n    },\n    å…«å¦é—²èŠåŒº: {\n      rule: 'è½»æ¾æ´»æ³¼ï¼Œè¯é¢˜éšæ„ï¼Œå›å¤æœ€å¤šï¼ˆ5-20æ¡ï¼‰',\n      title_format: 'éšæ„ä½†æœ‰è¶£',\n      reply_style: 'éšæ„èŠå¤©ã€è¡¨æƒ…ä¸°å¯Œã€è¯é¢˜è·³è·ƒ'\n    },\n    åŒ¿åæ±‚åŠ©åŒº: {\n      rule: 'åŒ¿åå‘å¸–ï¼Œç†æ€§å›å¤',\n      title_format: ['ã€æ±‚åŠ©ã€‘XXX', 'ã€å›°æƒ‘ã€‘XXX'],\n      poster: 'åŒ¿å',\n      reply_style: 'ç†æ€§å»ºè®®ã€æš–å¿ƒé¼“åŠ±ã€ç»éªŒåˆ†äº«'\n    }\n  },\n  post_structure: {\n    æ ‡é¢˜: { rule: 'ç¬¦åˆåŒºå—ç‰¹è‰²ï¼Œç®€æ´å¸å¼•', constraints: { unique: true } },\n    å‘å¸–äºº: { rule: 'åˆ›æ„ï¼Œä»£å·æˆ–\"åŒ¿å\"ï¼Œé¿å…ç›´ç™½é£æ ¼' },\n    åŒºå—: { rule: 'é™äºå…¬å‘ŠåŒºã€ä»»åŠ¡äº¤æµåŒºã€è‡ªç”±äº¤æ˜“åŒºã€å…«å¦é—²èŠåŒºã€åŒ¿åæ±‚åŠ©åŒº' },\n    å›å¤æ•°: { rule: '0-999ï¼Œå…¬å‘ŠåŒº0-2ï¼Œå…«å¦é—²èŠåŒº5-20ï¼Œçƒ­é—¨/ç²¾åå¸–10-30ï¼Œæ–°å¸–0-5' },\n    å‘å¸–æ—¶é—´: { rule: 'æ ¼å¼ä¸ºXå°æ—¶å‰ã€Xå¤©å‰ã€Xåˆ†é’Ÿå‰' },\n    å®Œæ•´å†…å®¹: { rule: '50-300å­—ï¼Œç¬¦åˆä¸–ç•Œè§‚' },\n    ç²¾åæ ‡è®°: { rule: 'trueä¸ºç²¾åå¸–ï¼Œç¨€å°‘' },\n    ç½®é¡¶æ ‡è®°: { rule: 'trueä¸ºç½®é¡¶ï¼Œå…¬å‘ŠåŒºå¸¸è§' },\n    ç‚¹èµæ•°: { rule: '0-999ï¼Œåˆç†åˆ†å¸ƒ' }\n  },\n  reply_structure: {\n    å›å¤äºº: { rule: 'ä»£å·æˆ–\"åŒ¿å\"' },\n    å›å¤æ—¶é—´: { rule: 'æ ¼å¼ä¸ºXå°æ—¶å‰ã€Xå¤©å‰ã€Xåˆ†é’Ÿå‰ï¼Œæ™šäºå‘å¸–æ—¶é—´' },\n    å›å¤å†…å®¹: { rule: '150å­—ä»¥å†…ï¼Œç¬¦åˆåŒºå—é£æ ¼ï¼Œè¢«ä¸¾æŠ¥æ˜¾ç¤º\"[è¯¥å›å¤å·²è¢«åˆ é™¤]\"' },\n    æ¥¼å±‚: { rule: 'ä»2å¼€å§‹ï¼Œé€’å¢' },\n    ç‚¹èµæ•°: { rule: '0-99ï¼Œæœ‰ç”¨å›å¤ç‚¹èµå¤š' },\n    æ˜¯å¦è¢«ä¸¾æŠ¥: { rule: 'trueä¸ºè¢«ä¸¾æŠ¥ï¼Œæ˜¾ç¤ºåˆ é™¤ä¿¡æ¯' }\n  },\n  constraints: {\n    time_logic: 'å‘å¸–æ—¶é—´ > æœ€æ—©å›å¤æ—¶é—´ > æœ€æ™šå›å¤æ—¶é—´',\n    title_uniqueness: 'å¸–å­æ ‡é¢˜å”¯ä¸€',\n    reply_hierarchy: 'å›å¤æœ‰å±‚æ¬¡æ„Ÿï¼Œæ¨¡æ‹ŸçœŸå®è®¨è®º'\n  },\n  // æ•°æ®ç»“æ„å®šä¹‰\n  data_structure: {\n    post_array: {\n      description: 'æ¯ä¸ªå¸–å­çš„postå­—æ®µåŒ…å«9ä¸ªå…ƒç´ çš„æ•°ç»„',\n      format: '[æ ‡é¢˜, å‘å¸–äºº, åŒºå—, å›å¤æ•°, å‘å¸–æ—¶é—´, å®Œæ•´å†…å®¹, ç²¾åæ ‡è®°, ç½®é¡¶æ ‡è®°, ç‚¹èµæ•°]',\n      types: ['string', 'string', 'string', 'number', 'string', 'string', 'boolean', 'boolean', 'number']\n    },\n    replies_array: {\n      description: 'æ¯ä¸ªå¸–å­çš„replieså­—æ®µåŒ…å«å›å¤æ•°ç»„',\n      format: '[å›å¤äºº, å›å¤æ—¶é—´, å›å¤å†…å®¹, æ¥¼å±‚, ç‚¹èµæ•°, æ˜¯å¦è¢«ä¸¾æŠ¥]',\n      types: ['string', 'string', 'string', 'number', 'number', 'boolean'],\n      rules: 'æ¥¼å±‚ä»2å¼€å§‹é€’å¢ï¼Œè¢«ä¸¾æŠ¥çš„å›å¤å†…å®¹æ˜¾ç¤º\"[è¯¥å›å¤å·²è¢«åˆ é™¤]\"'\n    }\n  },\n  example: {\n    rule: 'å‚è€ƒè¾“å‡ºç¤ºä¾‹',\n    output: {\n      \"ã€æ±‚åŠ©ã€‘ç¬¬ä¸€æ¬¡è¿›å…¥ææ€–ç‰‡ä¸–ç•Œï¼Œå¥½ç´§å¼ \": {\n        post: [\"ã€æ±‚åŠ©ã€‘ç¬¬ä¸€æ¬¡è¿›å…¥ææ€–ç‰‡ä¸–ç•Œï¼Œå¥½ç´§å¼ \", \"åŒ¿å\", \"åŒ¿åæ±‚åŠ©åŒº\", 40, \"6å°æ—¶å‰\", \"æ–°äºº<%= getLocalVar(\"player_role\",\"\") %>ï¼Œæ˜å¤©è¦è¿›å…¥å’’æ€¨ä¸–ç•Œï¼ŒçœŸçš„å¾ˆå®³æ€•ã€‚å¬è¯´é‚£ä¸ªä¸–ç•Œçš„é¬¼æ€ªé˜²ä¸èƒœé˜²ï¼Œè€Œä¸”æˆ‘åªæ˜¯ä¸ªæ™®é€šäººå±æ€§ï¼Œæ²¡æœ‰ä»»ä½•è¶…è‡ªç„¶èƒ½åŠ›ã€‚æœ‰æ²¡æœ‰å‰è¾ˆèƒ½ç»™ç‚¹å®ç”¨çš„å»ºè®®ï¼Ÿ<%= getLocalVar(\"point_role\",\"\") %>ä¸å¤šï¼Œæ„¿æ„æ‹¿å‡º500<%= getLocalVar(\"point_role\",\"\")%>ä½œä¸ºæ„Ÿè°¢è´¹ã€‚\", true, false, 89],\n        replies: [\n          [\"è€å…µ\", \"5å°æ—¶å‰\", \"æ–°äººåˆ«æ€•ï¼Œå’’æ€¨è™½ç„¶ææ€–ä½†æœ‰è§„å¾‹å¯å¾ªã€‚è®°ä½ä¸‰ç‚¹ï¼š1.ä¸è¦å•ç‹¬è¡ŒåŠ¨ 2.å‡†å¤‡è¶³å¤Ÿçš„é©±é‚ªé“å…· 3.åƒä¸‡åˆ«å»çœ‹ä¼½æ¤°å­çš„çœ¼ç›\", 2, 45, false],\n          [\"èœé¸Ÿæ€æ‰‹\", \"4å°æ—¶å‰\", \"æ¥¼ä¸Šè¯´å¾—å¯¹ï¼Œæˆ‘ç¬¬ä¸€æ¬¡ä¹Ÿæ˜¯å’’æ€¨ï¼Œå·®ç‚¹æ­»åœ¨é‡Œé¢ã€‚å»ºè®®ä½ å»å•†åº—ä¹°ä¸ªä½çº§æŠ¤èº«ç¬¦ï¼Œè™½ç„¶è´µä½†èƒ½ä¿å‘½\", 3, 23, false],\n          [\"åŒ¿å\", \"3å°æ—¶å‰\", \"è°¢è°¢å„ä½å‰è¾ˆï¼å·²ç»ä¹°äº†æŠ¤èº«ç¬¦å’Œåœ£æ°´ï¼Œå¸Œæœ›èƒ½æ´»ç€å›æ¥\", 4, 12, false]\n        ]\n      }\n    }\n  }\n})\n//<user>æŸ¥çœ‹è®ºå›æ‰€è·å–çš„ä¿¡æ¯éœ€è¦è¢«è®°å½•åœ¨global_loreä¸­\n<%_ } _%>",
                    "constant": false,
                    "selective": true,
                    "insertion_order": 102,
                    "enabled": true,
                    "position": "after_char",
                    "use_regex": true,
                    "extensions": {
                        "position": 4,
                        "exclude_recursion": true,
                        "display_index": 26,
                        "probability": 100,
                        "useProbability": true,
                        "depth": 0,
                        "selectiveLogic": 0,
                        "group": "è®ºå›",
                        "group_override": false,
                        "group_weight": 100,
                        "prevent_recursion": true,
                        "delay_until_recursion": false,
                        "scan_depth": 1,
                        "match_whole_words": null,
                        "use_group_scoring": false,
                        "case_sensitive": null,
                        "automation_id": "",
                        "role": 0,
                        "vectorized": false,
                        "sticky": 0,
                        "cooldown": 0,
                        "delay": 0,
                        "match_persona_description": false,
                        "match_character_description": false,
                        "match_character_personality": false,
                        "match_character_depth_prompt": false,
                        "match_scenario": false,
                        "match_creator_notes": false,
                        "triggers": []
                    }
                },
                {
                    "id": 29,
                    "keys": [],
                    "secondary_keys": [],
                    "comment": "ğŸ”®é€‰é¡¹åŒºå…³",
                    "content": "{{setvar::options_rule:: }}",
                    "constant": true,
                    "selective": true,
                    "insertion_order": 100,
                    "enabled": false,
                    "position": "before_char",
                    "use_regex": true,
                    "extensions": {
                        "position": 0,
                        "exclude_recursion": false,
                        "display_index": 27,
                        "probability": 100,
                        "useProbability": true,
                        "depth": 4,
                        "selectiveLogic": 0,
                        "group": "é€‰é¡¹",
                        "group_override": false,
                        "group_weight": 100,
                        "prevent_recursion": false,
                        "delay_until_recursion": false,
                        "scan_depth": null,
                        "match_whole_words": null,
                        "use_group_scoring": false,
                        "case_sensitive": null,
                        "automation_id": "",
                        "role": 0,
                        "vectorized": false,
                        "sticky": 0,
                        "cooldown": 0,
                        "delay": 0,
                        "match_persona_description": false,
                        "match_character_description": false,
                        "match_character_personality": false,
                        "match_character_depth_prompt": false,
                        "match_scenario": false,
                        "match_creator_notes": false,
                        "triggers": []
                    }
                },
                {
                    "id": 30,
                    "keys": [],
                    "secondary_keys": [],
                    "comment": "ğŸ¨âŒåŠ ç‚¹æ¨¡æ¿å’Œå¿«æ·é˜Ÿå‹æ¨¡æ¿ï¼ˆåˆ«å¼€ï¼Œæ˜¯é…ç½®é¡¹ï¼‰",
                    "content": "{\"æ ‡å‡†æˆ˜å£«\":{\"å±æ€§æ®µ.ç”Ÿç†å±æ€§.åŠ›é‡.åŸºç¡€\":4,\"å±æ€§æ®µ.ç”Ÿç†å±æ€§.æ•æ·.åŸºç¡€\":3,\"å±æ€§æ®µ.ç”Ÿç†å±æ€§.è€åŠ›.åŸºç¡€\":4,\"å±æ€§æ®µ.å¿ƒæ™ºå±æ€§.æ™ºåŠ›.åŸºç¡€\":2,\"å±æ€§æ®µ.å¿ƒæ™ºå±æ€§.æ„ŸçŸ¥.åŸºç¡€\":2,\"å±æ€§æ®µ.å¿ƒæ™ºå±æ€§.å†³å¿ƒ.åŸºç¡€\":3,\"å±æ€§æ®µ.äº’åŠ¨å±æ€§.é£åº¦.åŸºç¡€\":2,\"å±æ€§æ®µ.äº’åŠ¨å±æ€§.æ“æ§.åŸºç¡€\":1,\"å±æ€§æ®µ.äº’åŠ¨å±æ€§.æ²‰ç€.åŸºç¡€\":3,\"æŠ€èƒ½æ®µ.ç”Ÿç†æŠ€èƒ½.è¿åŠ¨\":3,\"æŠ€èƒ½æ®µ.ç”Ÿç†æŠ€èƒ½.è‚‰æ\":3,\"æŠ€èƒ½æ®µ.ç”Ÿç†æŠ€èƒ½.ç™½åˆƒ\":3,\"æŠ€èƒ½æ®µ.å¿ƒæ™ºæŠ€èƒ½.è°ƒæŸ¥\":1,\"æŠ€èƒ½æ®µ.äº’åŠ¨æŠ€èƒ½.èƒè¿«\":2},\"æ ‡å‡†æ–¥å€™\":{\"å±æ€§æ®µ.ç”Ÿç†å±æ€§.åŠ›é‡.åŸºç¡€\":1,\"å±æ€§æ®µ.ç”Ÿç†å±æ€§.æ•æ·.åŸºç¡€\":4,\"å±æ€§æ®µ.ç”Ÿç†å±æ€§.è€åŠ›.åŸºç¡€\":2,\"å±æ€§æ®µ.å¿ƒæ™ºå±æ€§.æ™ºåŠ›.åŸºç¡€\":2,\"å±æ€§æ®µ.å¿ƒæ™ºå±æ€§.æ„ŸçŸ¥.åŸºç¡€\":3,\"å±æ€§æ®µ.å¿ƒæ™ºå±æ€§.å†³å¿ƒ.åŸºç¡€\":2,\"å±æ€§æ®µ.äº’åŠ¨å±æ€§.é£åº¦.åŸºç¡€\":1,\"å±æ€§æ®µ.äº’åŠ¨å±æ€§.æ“æ§.åŸºç¡€\":2,\"å±æ€§æ®µ.äº’åŠ¨å±æ€§.æ²‰ç€.åŸºç¡€\":3,\"æŠ€èƒ½æ®µ.ç”Ÿç†æŠ€èƒ½.è¿åŠ¨\":2,\"æŠ€èƒ½æ®µ.ç”Ÿç†æŠ€èƒ½.éšè—\":3,\"æŠ€èƒ½æ®µ.ç”Ÿç†æŠ€èƒ½.æ±‚ç”Ÿ\":2,\"æŠ€èƒ½æ®µ.å¿ƒæ™ºæŠ€èƒ½.å­¦è¯†\":2,\"æŠ€èƒ½æ®µ.å¿ƒæ™ºæŠ€èƒ½.è°ƒæŸ¥\":4,\"æŠ€èƒ½æ®µ.äº’åŠ¨æŠ€èƒ½.æ„Ÿå—\":3},\"å­¦è€…å‹\":{\"å±æ€§æ®µ.ç”Ÿç†å±æ€§.åŠ›é‡.åŸºç¡€\":1,\"å±æ€§æ®µ.ç”Ÿç†å±æ€§.æ•æ·.åŸºç¡€\":1,\"å±æ€§æ®µ.ç”Ÿç†å±æ€§.è€åŠ›.åŸºç¡€\":2,\"å±æ€§æ®µ.å¿ƒæ™ºå±æ€§.æ™ºåŠ›.åŸºç¡€\":4,\"å±æ€§æ®µ.å¿ƒæ™ºå±æ€§.æ„ŸçŸ¥.åŸºç¡€\":2,\"å±æ€§æ®µ.å¿ƒæ™ºå±æ€§.å†³å¿ƒ.åŸºç¡€\":3,\"å±æ€§æ®µ.äº’åŠ¨å±æ€§.é£åº¦.åŸºç¡€\":3,\"å±æ€§æ®µ.äº’åŠ¨å±æ€§.æ“æ§.åŸºç¡€\":2,\"å±æ€§æ®µ.äº’åŠ¨å±æ€§.æ²‰ç€.åŸºç¡€\":3,\"æŠ€èƒ½æ®µ.å¿ƒæ™ºæŠ€èƒ½.å­¦è¯†\":4,\"æŠ€èƒ½æ®µ.å¿ƒæ™ºæŠ€èƒ½.ç”µè„‘\":3,\"æŠ€èƒ½æ®µ.å¿ƒæ™ºæŠ€èƒ½.è°ƒæŸ¥\":1,\"æŠ€èƒ½æ®µ.å¿ƒæ™ºæŠ€èƒ½.ç¥ç§˜å­¦\":2,\"æŠ€èƒ½æ®µ.å¿ƒæ™ºæŠ€èƒ½.ç§‘å­¦\":3,\"æŠ€èƒ½æ®µ.äº’åŠ¨æŠ€èƒ½.è¡¨è¾¾\":2},\"ç¤¾äº¤ä¸“å®¶\":{\"å±æ€§æ®µ.ç”Ÿç†å±æ€§.åŠ›é‡.åŸºç¡€\":1,\"å±æ€§æ®µ.ç”Ÿç†å±æ€§.æ•æ·.åŸºç¡€\":1,\"å±æ€§æ®µ.ç”Ÿç†å±æ€§.è€åŠ›.åŸºç¡€\":2,\"å±æ€§æ®µ.å¿ƒæ™ºå±æ€§.æ™ºåŠ›.åŸºç¡€\":2,\"å±æ€§æ®µ.å¿ƒæ™ºå±æ€§.æ„ŸçŸ¥.åŸºç¡€\":3,\"å±æ€§æ®µ.å¿ƒæ™ºå±æ€§.å†³å¿ƒ.åŸºç¡€\":2,\"å±æ€§æ®µ.äº’åŠ¨å±æ€§.é£åº¦.åŸºç¡€\":4,\"å±æ€§æ®µ.äº’åŠ¨å±æ€§.æ“æ§.åŸºç¡€\":4,\"å±æ€§æ®µ.äº’åŠ¨å±æ€§.æ²‰ç€.åŸºç¡€\":3,\"æŠ€èƒ½æ®µ.äº’åŠ¨æŠ€èƒ½.æ„Ÿå—\":3,\"æŠ€èƒ½æ®µ.äº’åŠ¨æŠ€èƒ½.è¡¨è¾¾\":3,\"æŠ€èƒ½æ®µ.äº’åŠ¨æŠ€èƒ½.èƒè¿«\":2,\"æŠ€èƒ½æ®µ.äº’åŠ¨æŠ€èƒ½.äº¤é™…\":3,\"æŠ€èƒ½æ®µ.äº’åŠ¨æŠ€èƒ½.æ©é¥°\":3},\"æ½œè¡Œä¸“å®¶\":{\"å±æ€§æ®µ.ç”Ÿç†å±æ€§.åŠ›é‡.åŸºç¡€\":1,\"å±æ€§æ®µ.ç”Ÿç†å±æ€§.æ•æ·.åŸºç¡€\":4,\"å±æ€§æ®µ.ç”Ÿç†å±æ€§.è€åŠ›.åŸºç¡€\":1,\"å±æ€§æ®µ.å¿ƒæ™ºå±æ€§.æ™ºåŠ›.åŸºç¡€\":2,\"å±æ€§æ®µ.å¿ƒæ™ºå±æ€§.æ„ŸçŸ¥.åŸºç¡€\":3,\"å±æ€§æ®µ.å¿ƒæ™ºå±æ€§.å†³å¿ƒ.åŸºç¡€\":2,\"å±æ€§æ®µ.äº’åŠ¨å±æ€§.é£åº¦.åŸºç¡€\":1,\"å±æ€§æ®µ.äº’åŠ¨å±æ€§.æ“æ§.åŸºç¡€\":3,\"å±æ€§æ®µ.äº’åŠ¨å±æ€§.æ²‰ç€.åŸºç¡€\":3,\"æŠ€èƒ½æ®µ.ç”Ÿç†æŠ€èƒ½.è¿åŠ¨\":3,\"æŠ€èƒ½æ®µ.ç”Ÿç†æŠ€èƒ½.æ‰‹ä¸ŠåŠŸå¤«\":3,\"æŠ€èƒ½æ®µ.ç”Ÿç†æŠ€èƒ½.éšè—\":4,\"æŠ€èƒ½æ®µ.ç”Ÿç†æŠ€èƒ½.æ±‚ç”Ÿ\":2,\"æŠ€èƒ½æ®µ.äº’åŠ¨æŠ€èƒ½.æ©é¥°\":3},\"åŒ»ç–—æ”¯æ´\":{\"å±æ€§æ®µ.ç”Ÿç†å±æ€§.åŠ›é‡.åŸºç¡€\":2,\"å±æ€§æ®µ.ç”Ÿç†å±æ€§.æ•æ·.åŸºç¡€\":2,\"å±æ€§æ®µ.ç”Ÿç†å±æ€§.è€åŠ›.åŸºç¡€\":2,\"å±æ€§æ®µ.å¿ƒæ™ºå±æ€§.æ™ºåŠ›.åŸºç¡€\":2,\"å±æ€§æ®µ.å¿ƒæ™ºå±æ€§.æ„ŸçŸ¥.åŸºç¡€\":2,\"å±æ€§æ®µ.å¿ƒæ™ºå±æ€§.å†³å¿ƒ.åŸºç¡€\":2,\"å±æ€§æ®µ.äº’åŠ¨å±æ€§.é£åº¦.åŸºç¡€\":3,\"å±æ€§æ®µ.äº’åŠ¨å±æ€§.æ“æ§.åŸºç¡€\":1,\"å±æ€§æ®µ.äº’åŠ¨å±æ€§.æ²‰ç€.åŸºç¡€\":3,\"æŠ€èƒ½æ®µ.ç”Ÿç†æŠ€èƒ½.è¿åŠ¨\":1,\"æŠ€èƒ½æ®µ.å¿ƒæ™ºæŠ€èƒ½.å­¦è¯†\":2,\"æŠ€èƒ½æ®µ.å¿ƒæ™ºæŠ€èƒ½.æ‰‹è‰º\":2,\"æŠ€èƒ½æ®µ.å¿ƒæ™ºæŠ€èƒ½.è°ƒæŸ¥\":2,\"æŠ€èƒ½æ®µ.å¿ƒæ™ºæŠ€èƒ½.åŒ»å­¦\":5,\"æŠ€èƒ½æ®µ.å¿ƒæ™ºæŠ€èƒ½.ç§‘å­¦\":3,\"æŠ€èƒ½æ®µ.äº’åŠ¨æŠ€èƒ½.æ„Ÿå—\":2,\"æŠ€èƒ½æ®µ.äº’åŠ¨æŠ€èƒ½.è¡¨è¾¾\":2},\"å°„æ‰‹ä¸“ç²¾\":{\"å±æ€§æ®µ.ç”Ÿç†å±æ€§.åŠ›é‡.åŸºç¡€\":2,\"å±æ€§æ®µ.ç”Ÿç†å±æ€§.æ•æ·.åŸºç¡€\":4,\"å±æ€§æ®µ.ç”Ÿç†å±æ€§.è€åŠ›.åŸºç¡€\":2,\"å±æ€§æ®µ.å¿ƒæ™ºå±æ€§.æ™ºåŠ›.åŸºç¡€\":2,\"å±æ€§æ®µ.å¿ƒæ™ºå±æ€§.æ„ŸçŸ¥.åŸºç¡€\":4,\"å±æ€§æ®µ.å¿ƒæ™ºå±æ€§.å†³å¿ƒ.åŸºç¡€\":3,\"å±æ€§æ®µ.äº’åŠ¨å±æ€§.é£åº¦.åŸºç¡€\":2,\"å±æ€§æ®µ.äº’åŠ¨å±æ€§.æ“æ§.åŸºç¡€\":1,\"å±æ€§æ®µ.äº’åŠ¨å±æ€§.æ²‰ç€.åŸºç¡€\":3,\"æŠ€èƒ½æ®µ.ç”Ÿç†æŠ€èƒ½.è¿åŠ¨\":2,\"æŠ€èƒ½æ®µ.ç”Ÿç†æŠ€èƒ½.æªæ¢°\":4,\"æŠ€èƒ½æ®µ.ç”Ÿç†æŠ€èƒ½.å¼“ç®­\":4},\"å…¨èƒ½å‹\":{\"å±æ€§æ®µ.ç”Ÿç†å±æ€§.åŠ›é‡.åŸºç¡€\":2,\"å±æ€§æ®µ.ç”Ÿç†å±æ€§.æ•æ·.åŸºç¡€\":2,\"å±æ€§æ®µ.ç”Ÿç†å±æ€§.è€åŠ›.åŸºç¡€\":2,\"å±æ€§æ®µ.å¿ƒæ™ºå±æ€§.æ™ºåŠ›.åŸºç¡€\":3,\"å±æ€§æ®µ.å¿ƒæ™ºå±æ€§.æ„ŸçŸ¥.åŸºç¡€\":3,\"å±æ€§æ®µ.å¿ƒæ™ºå±æ€§.å†³å¿ƒ.åŸºç¡€\":3,\"å±æ€§æ®µ.äº’åŠ¨å±æ€§.é£åº¦.åŸºç¡€\":3,\"å±æ€§æ®µ.äº’åŠ¨å±æ€§.æ“æ§.åŸºç¡€\":2,\"å±æ€§æ®µ.äº’åŠ¨å±æ€§.æ²‰ç€.åŸºç¡€\":3,\"æŠ€èƒ½æ®µ.ç”Ÿç†æŠ€èƒ½.è¿åŠ¨\":2,\"æŠ€èƒ½æ®µ.ç”Ÿç†æŠ€èƒ½.è‚‰æ\":2,\"æŠ€èƒ½æ®µ.ç”Ÿç†æŠ€èƒ½.é©¾é©¶\":2,\"æŠ€èƒ½æ®µ.ç”Ÿç†æŠ€èƒ½.æªæ¢°\":2,\"æŠ€èƒ½æ®µ.å¿ƒæ™ºæŠ€èƒ½.å­¦è¯†\":2,\"æŠ€èƒ½æ®µ.å¿ƒæ™ºæŠ€èƒ½.è°ƒæŸ¥\":2,\"æŠ€èƒ½æ®µ.å¿ƒæ™ºæŠ€èƒ½.åŒ»å­¦\":1,\"æŠ€èƒ½æ®µ.äº’åŠ¨æŠ€èƒ½.æ„Ÿå—\":2,\"æŠ€èƒ½æ®µ.äº’åŠ¨æŠ€èƒ½.äº¤é™…\":2},\"é˜Ÿå‹ä¿¡æ¯\":[{\"å§“å\":\"éƒ‘å’\",\"æ€§æ ¼\":\"ä¼˜æŸ”å¯¡æ–­çš„æ€§æ ¼ï¼Œæœ‰æ‹¯æ•‘ä¸€åˆ‡çš„ç†æƒ³ä¸»ä¹‰ä¸­ã€‚ è™½ç„¶å˜´ä¸Šè¯´ç€åªä¸ºè‡ªå·±ä¿å‘½ï¼Œè°åŠ¨è‡ªå·±æ€è°ï¼Œä½†å®é™…è¡ŒåŠ¨ä¸­å´ä¸è‡ªè§‰åœ°åå‘å¼±è€…ï¼Œå“ªæ€•æ˜¯æ ¹æœ¬ä¸çŸ¥é“èƒ½ä¸èƒ½ä¿¡ä»»çš„æ–°äººã€‚ è®¤ä¸ºä»»ä½•äººéƒ½å…·å¤‡åº”æœ‰çš„æ‰èƒ½ï¼Œå¦‚æœä¿ä½ä¹Ÿèƒ½åƒè‡ªå·±ä¸€æ ·è¿…é€Ÿæˆé•¿ï¼Œå®é™…å´æ˜¯å¿½è§†äº†å®¢è§‚è§„å¾‹ã€‚\",\"æ€§åˆ«\":\"ç”·\",\"èº«ä»½\":\"è‡ªä»è¿›å…¥è½®å›ä¸–ç•Œåä¾¿ä¸æ–­æŒ£æ‰åœ¨ç”Ÿæ­»è¾¹ç¼˜ä¸Šï¼Œæ¯ä¸€éƒ¨ææ€–ç‰‡ä¹‹ä¸­éƒ½æ˜¯ä»é™©è±¡ç¯ç”Ÿçš„ç¯å¢ƒä¸­çªç ´è‡ªå·±ã€‚ æœ¬æ¥æ˜¯é†‰ç”Ÿæ¢¦æ­»çš„å…¬å¸ä¸»ç®¡ï¼Œä¸€ç›´æ²‰æººäºåˆæ‹æƒ…äººæ­»å»çš„ç—›è‹¦ä¸­ï¼Œè¿›å…¥ä¸»ç¥ç©ºé—´åï¼Œè¢«æ— é™çš„å¯èƒ½æ€§æ‰€æ„ŸæŸ“ï¼Œç‡ƒèµ·äº†ç”Ÿå­˜æ–—å¿—ï¼Œåˆ¶é€ äº†â€œèä¸½â€ä¹‹åï¼Œæ›´æ˜¯è·å¾—äº†ç”Ÿå­˜ä¸‹å»çš„ç†ç”±ã€‚\"},{\"å§“å\":\"æ¥šè½©\",\"æ€§æ ¼\":\"æ— æ³•è®¤çŸ¥æ„Ÿæƒ…ï¼Œä¹Ÿæ— æ³•è¡¨è¾¾æƒ…ç»ªï¼Œå› ä¸ºä¸èƒ½åˆ†æ³ŒæŸäº›æ¿€ç´ ï¼Œæ¥šè½©çš„æ„Ÿè§‰éå¸¸ç¼ºå¤±ã€‚\",\"æ€§åˆ«\":\"ç”·\",\"èº«ä»½\":\"æœ¬èº«å†›è¡”ä¸ºå¤§æ ¡ï¼Œåªæ˜¯å®é™…æƒåŠ›ä¸èƒ½åŠ›éƒ½è¿œé«˜äºæ­¤ã€‚å„æ–¹é¢éƒ½å‡Œé©¾äºæ™®é€šç‰¹ç§å…µä¹‹ä¸Šï¼Œæ— è®ºæ˜¯è¿‘èº«æ ¼æ–—ï¼Œè¿˜æ˜¯å†›äº‹ç¼–åˆ¶ï¼Œéƒ½ç›¸å½“ç†Ÿç»ƒã€‚\"}]}",
                    "constant": false,
                    "selective": true,
                    "insertion_order": 100,
                    "enabled": false,
                    "position": "before_char",
                    "use_regex": true,
                    "extensions": {
                        "position": 0,
                        "exclude_recursion": false,
                        "display_index": 83,
                        "probability": 100,
                        "useProbability": true,
                        "depth": 4,
                        "selectiveLogic": 0,
                        "group": "",
                        "group_override": false,
                        "group_weight": 100,
                        "prevent_recursion": false,
                        "delay_until_recursion": false,
                        "scan_depth": null,
                        "match_whole_words": null,
                        "use_group_scoring": false,
                        "case_sensitive": null,
                        "automation_id": "",
                        "role": 0,
                        "vectorized": false,
                        "sticky": 0,
                        "cooldown": 0,
                        "delay": 0,
                        "match_persona_description": false,
                        "match_character_description": false,
                        "match_character_personality": false,
                        "match_character_depth_prompt": false,
                        "match_scenario": false,
                        "match_creator_notes": false,
                        "triggers": []
                    }
                },
                {
                    "id": 31,
                    "keys": [],
                    "secondary_keys": [],
                    "comment": "ğŸ”°è®°å¿†-ä¿¡æ¯æ”¾ç½®",
                    "content": "<%_\n \n\n    function getDataWithFallback(varName) {\n \n        let data = getLocalVar(varName);\n       \n        // å†…è”æ•°æ®éªŒè¯ï¼šæ£€æŸ¥æ˜¯å¦ä¸ºnullã€undefinedï¼Œä¸”å¦‚æœæ˜¯å¯¹è±¡è¦æœ‰å†…å®¹\n        const isValid = (data) => {\n            // æ£€æŸ¥æ˜¯å¦ä¸º null æˆ– undefined\n            if (data === null || data === undefined) {\n                return false;\n            }\n            \n            // å¦‚æœæ˜¯å¯¹è±¡ç±»å‹ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰å†…å®¹\n            if (typeof data === 'object' && data !== null) {\n                // å¦‚æœæ˜¯æ•°ç»„ï¼Œæ£€æŸ¥é•¿åº¦\n                if (Array.isArray(data)) {\n                    return data.length > 0;\n                }\n                // å¦‚æœæ˜¯æ™®é€šå¯¹è±¡ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰å±æ€§\n                return Object.keys(data).length > 0;\n            }\n            \n            // å…¶ä»–ç±»å‹ï¼ˆå­—ç¬¦ä¸²ã€æ•°å­—ã€å¸ƒå°”å€¼ç­‰ï¼‰åªè¦ä¸æ˜¯ null/undefined å°±è®¤ä¸ºæœ‰æ•ˆ\n            return true;\n        };\n        \n        // å¦‚æœæ•°æ®ä¸ç¬¦åˆè¦æ±‚ï¼Œä» getLocalVar è·å–\n        if (!isValid(data)) {\n            data = getLocalVar(varName);\n        }\n\n // å¦‚æœè¿˜æ˜¯æ— æ•ˆï¼Œè¿”å›ç©ºå¯¹è±¡ä½œä¸ºé»˜è®¤å€¼\n    if (!isValid(data)) {\n        data = {};\n    }\n        \n        return data;\n    }\nfunction formatObjectGracefully(data, indent = 0) {\n  if (typeof data !== 'object' || data === null) {\n    return JSON.stringify(data);\n  }\n  \n  if (Array.isArray(data)) {\n    if (data.length === 0) return '[]';\n    \n    const items = data.map(item => {\n      const formatted = formatObjectGracefully(item, indent + 1);\n      return ' '.repeat((indent + 1) * 2) + formatted;\n    });\n    \n    return '[\\n' + items.join(',\\n') + '\\n' + ' '.repeat(indent * 2) + ']';\n  }\n  \n  // ğŸ”§ æ£€æŸ¥å¯¹è±¡è‡ªèº«çš„ _showInEJS\n// ğŸ”§ æ£€æŸ¥å¯¹è±¡è‡ªèº«çš„ _showInEJS å’Œ _filter\nconst shouldFilter = data._filter === true || data._filter === 'true';\nconst showInEJS = data._showInEJS === false || data._showInEJS === 'false';\n\n// åªæœ‰ _filter ä¸º true ä¸” _showInEJS ä¸º false æ—¶æ‰éšè—\nif (shouldFilter && showInEJS) {\n \n  return '\"[å·²éšè—]\"';\n}\n  \n  const keys = Object.keys(data);\n  if (keys.length === 0) {\n    return '{}';\n  }\n  \n  // è¿‡æ»¤å‡ºéœ€è¦æ˜¾ç¤ºçš„é”®\n  const visibleKeys = keys.filter(key => {\n    if (key.startsWith('_')) {\n      return false;\n    }\n    return true;\n  });\n  \n  if (visibleKeys.length === 0) {\n    return '{}';\n  }\nconst formattedLines = visibleKeys.map(key => {\n  let value = data[key];\n  \n  // å¦‚æœå€¼æ˜¯å¯¹è±¡ï¼Œéœ€è¦é€’å½’å¤„ç†\n  if (typeof value === 'object' && value !== null && !Array.isArray(value)) {\n    // ğŸ”§ å…ˆæ£€æŸ¥å­å¯¹è±¡æ˜¯å¦è¢«éšè—\n    if (value._showInEJS === false || value._showInEJS === 'false') {\n      // æ£€æŸ¥ _filter å­—æ®µï¼Œé»˜è®¤ä¸º false\n      const shouldFilter = value._filter === true || value._filter === 'true';\n      if (!shouldFilter) {\n        // _filter ä¸º false æˆ–ä¸å­˜åœ¨ï¼Œç»§ç»­æ˜¾ç¤º\n        const valueString = formatObjectGracefully(value, indent + 1);\n        // âŒ åˆ é™¤ä¿æŠ¤æ ‡è®°ï¼Œè®©é€’å½’å†…éƒ¨å¤„ç†\n        return ' '.repeat((indent + 1) * 2) + `\"${key}\": ${valueString}`;\n      } else {\n        // _filter ä¸º trueï¼Œç»§ç»­éšè—\n       \n        const isProtected = value._is_protected === true || value._is_protected === 'true';\n        const protectionMark = isProtected ? ' //æ­¤å­—æ®µç¦æ­¢åˆ é™¤ï¼' : '';\n \n        return ' '.repeat((indent + 1) * 2) + `\"${key}\": \"[å·²éšè—]\"${protectionMark}`;\n      }\n    }\n    // âŒ åˆ é™¤ä¿æŠ¤æ ‡è®°ï¼Œè®©é€’å½’å†…éƒ¨å¤„ç†\n    const valueString = formatObjectGracefully(value, indent + 1);\n    return ' '.repeat((indent + 1) * 2) + `\"${key}\": ${valueString}`;\n  }\n  \n  const valueString = formatObjectGracefully(value, indent + 1);\n  return ' '.repeat((indent + 1) * 2) + `\"${key}\": ${valueString}`;\n});\n  \nconst isCurrentProtected = data._is_protected === true || data._is_protected === 'true';\nconst protectionMark = isCurrentProtected ? ' //æ­¤å­—æ®µç¦æ­¢åˆ é™¤ï¼' : '';\n\nreturn '{\\n' + formattedLines.join(',\\n') + '\\n' + ' '.repeat(indent * 2) + '}' + protectionMark;\n}\n \n //ğŸ‡ä¸æ¢è¡Œç‰ˆæœ¬\nfunction formatObjectGraceSimple(data, indent = 0, isTopLevel = true,is_huanhang = true) {\n  if (typeof data !== 'object' || data === null) {\n    return JSON.stringify(data);\n  }\n  \n  if (Array.isArray(data)) {\n    if (data.length === 0) return '[]';\n    \n \nconst items = data.map(item => formatObjectGraceSimple(item, indent + 1,false, is_huanhang));\n\nreturn isTopLevel ? '[\\n' + items.join(',\\n') + '\\n]' : '[' + items.join(',') + ']';\n  }\n  \n  // ğŸ”§ æ£€æŸ¥å¯¹è±¡è‡ªèº«çš„ _showInEJS\n// ğŸ”§ æ£€æŸ¥å¯¹è±¡è‡ªèº«çš„ _showInEJS å’Œ _filter\nconst shouldFilter = data._filter === true || data._filter === 'true';\nconst showInEJS = data._showInEJS === false || data._showInEJS === 'false';\n\n// åªæœ‰ _filter ä¸º true ä¸” _showInEJS ä¸º false æ—¶æ‰éšè—\nif (shouldFilter && showInEJS) {\n \n  return '\"[å·²éšè—]\"';\n}\n  \n  const keys = Object.keys(data);\n  if (keys.length === 0) {\n    return '{}';\n  }\n  \n  // è¿‡æ»¤å‡ºéœ€è¦æ˜¾ç¤ºçš„é”®\n  const visibleKeys = keys.filter(key => {\n    if (key.startsWith('_')) {\n      return false;\n    }\n    return true;\n  });\n  \n  if (visibleKeys.length === 0) {\n    return '{}';\n  }\nconst formattedLines = visibleKeys.map(key => {\n  let value = data[key];\n  \n  // å¦‚æœå€¼æ˜¯å¯¹è±¡ï¼Œéœ€è¦é€’å½’å¤„ç†\n  if (typeof value === 'object' && value !== null && !Array.isArray(value)) {\n    // ğŸ”§ å…ˆæ£€æŸ¥å­å¯¹è±¡æ˜¯å¦è¢«éšè—\n    if (value._showInEJS === false || value._showInEJS === 'false') {\n      // æ£€æŸ¥ _filter å­—æ®µï¼Œé»˜è®¤ä¸º false\n      const shouldFilter = value._filter === true || value._filter === 'true';\n      if (!shouldFilter) {\n        // _filter ä¸º false æˆ–ä¸å­˜åœ¨ï¼Œç»§ç»­æ˜¾ç¤º\n        const valueString = formatObjectGraceSimple(value, indent + 1, false,is_huanhang );\n        // âŒ åˆ é™¤ä¿æŠ¤æ ‡è®°ï¼Œè®©é€’å½’å†…éƒ¨å¤„ç†\n        return  `\"${key}\": ${valueString}`;\n      } else {\n        // _filter ä¸º trueï¼Œç»§ç»­éšè—\n       \n        const isProtected = value._is_protected === true || value._is_protected === 'true';\n        const protectionMark = isProtected ? ' //æ­¤å­—æ®µç¦æ­¢åˆ é™¤ï¼' : '';\n \n        return `\"${key}\": \"[å·²éšè—]\"${protectionMark}`;\n      }\n    }\n    // âŒ åˆ é™¤ä¿æŠ¤æ ‡è®°ï¼Œè®©é€’å½’å†…éƒ¨å¤„ç†\n    const valueString = formatObjectGraceSimple(value, indent + 1, false,is_huanhang );\n    return   `\"${key}\": ${valueString}`;\n  }\n  \n  const valueString = formatObjectGraceSimple(value, indent + 1, false,is_huanhang );\n  return  `\"${key}\": ${valueString}`;\n});\n  \nconst isCurrentProtected = data._is_protected === true || data._is_protected === 'true';\nconst protectionMark = isCurrentProtected ? ' //æ­¤å­—æ®µç¦æ­¢åˆ é™¤ï¼' : '';\n\nreturn isTopLevel \n  ? '{\\n' + formattedLines.join(',\\n') + '\\n}' + protectionMark\n  : '{' + formattedLines.join(',') + '}' + protectionMark;\n}\n  \n\n\nfunction cleanObjectRecursively(obj) {\n  if (typeof obj !== 'object' || obj === null || Array.isArray(obj)) {\n    return obj;\n  }\n  \n  const cleaned = {};\n  \n  \n  const allKeys = Object.keys(obj);\n  \n  for (let key of allKeys) {\n     if (key.startsWith('_')) {\n      continue;\n    }\n    const value = obj[key];\n    \n    // å¦‚æœå€¼æ˜¯å¯¹è±¡ï¼Œå…ˆæ£€æŸ¥å®ƒçš„ _showInEJSï¼ˆè¿™é‡Œè¦ç”¨ value._showInEJSï¼Œä¸æ˜¯ obj._showInEJSï¼‰\n    if (typeof value === 'object' && value !== null && !Array.isArray(value)) {\n      // ğŸ”§ å…³é”®ï¼šç›´æ¥é€šè¿‡ value è®¿é—® _showInEJS\n      let rawShowValue = value._showInEJS;\n \nif (rawShowValue === false || rawShowValue === 'false') {\n  // æ£€æŸ¥ _filter å­—æ®µï¼Œé»˜è®¤ä¸º false\n  const shouldFilter = value._filter === true || value._filter === 'true';\n  if (!shouldFilter) {\n    // _filter ä¸º false æˆ–ä¸å­˜åœ¨ï¼Œä¸æ”¹å˜å…¶å€¼ï¼Œé€’å½’æ¸…ç†\n    cleaned[key] = cleanObjectRecursively(value);\n  } else {\n    // _filter ä¸º trueï¼Œç»§ç»­éšè—\n \n    cleaned[key] = \"[å·²éšè—]\";\n  }\n  continue;\n}\n      \n      // å¦åˆ™é€’å½’æ¸…ç†è¿™ä¸ªå¯¹è±¡\n      cleaned[key] = cleanObjectRecursively(value);\n    } else {\n      // éå¯¹è±¡å€¼ç›´æ¥å¤åˆ¶\n      cleaned[key] = value;\n    }\n  }\n  \n  return cleaned;\n}\n \nif (typeof version === 'undefined') {\n    var version = Number(getLocalVar(\"world_version\", 1));\n}\nif (typeof EvStat === 'undefined') {\n    var EvStat = getDataWithFallback(\"stat_data\");\n}\nif (typeof assaData === 'undefined') {\n    var  assaData = getDataWithFallback(\"assa_data\");\n}\nif (typeof characterData === 'undefined') {\n    var characterData = getDataWithFallback(\"play_character_data\");\n}\nvar if_comlex_battle = getLocalVar(\"complex_battle\",\"false\");\n \nvar world_level = _.get(EvStat, 'world_shard.level', 'ä¸­é­”')[0];\nvar world_level_describe = '';\nvar levels = '';\nvar world_max_enegy = 3;\nif (world_level === 'æ— ') {\n    world_max_enegy = 3;\n    world_level_describe = 'æ™®é€šä¸–ç•Œ';\n    levels = `\n        \"1\": \"æ— é£é™©/æ—¥å¸¸æƒ…å†µ\",\n        \"2\": \"è½»å¾®å‡¡äººå±æœºï¼ˆå°åŠ¨ç‰©æ”»å‡»ã€ç¤¾äº¤å›°å¢ƒï¼‰\",\n        \"3\": \"ä¸¥é‡å‡¡äººå±æœºï¼ˆé‡ä¼¤/æ­»äº¡ã€ä¸¥é‡ç¯å¢ƒå±é™©ï¼‰\"\n    `;\n} else if (world_level === 'ä½') {\n    world_max_enegy = 5;\n    world_level_describe = 'å¦‚é‡‘åº¸æ­¦ä¾ ä¸–ç•Œï¼Œå‡¡äººç•Œé¢ï¼Œæ™®é€šç‰©ç†è§„åˆ™';\n    levels = `\n        \"1\": \"æ— é£é™©/æ—¥å¸¸æƒ…å†µ\",\n        \"2\": \"è½»å¾®å‡¡äººå±æœºï¼ˆå°åŠ¨ç‰©æ”»å‡»ã€ç¤¾äº¤å›°å¢ƒï¼‰\",\n        \"3\": \"ä¸¥é‡å‡¡äººå±æœºï¼ˆé‡ä¼¤/æ­»äº¡ã€ä¸¥é‡ç¯å¢ƒå±é™©ï¼‰\",\n        \"4-5\": \"åŸºç¡€è¶…å‡¡å±æœºï¼ˆè¢«åŠ¨è¶…å‡¡ç°è±¡ï¼Œå±€é™äºä¸ªä½“/å°èŒƒå›´ï¼Œæ™®é€šäººå¯åº”å¯¹ï¼‰\"\n    `;\n} else if (world_level === 'ä¸­') {\n    world_max_enegy = 7;\n    world_level_describe = 'å­˜åœ¨ä¸€å®šè¶…å‡¡åŠ›é‡ï¼Œå½±å“æœ‰é™èŒƒå›´';\n    levels = `\n        \"1\": \"æ— é£é™©/æ—¥å¸¸æƒ…å†µ\",\n        \"2\": \"è½»å¾®å‡¡äººå±æœºï¼ˆå°åŠ¨ç‰©æ”»å‡»ã€ç¤¾äº¤å›°å¢ƒï¼‰\",\n        \"3\": \"ä¸¥é‡å‡¡äººå±æœºï¼ˆé‡ä¼¤/æ­»äº¡ã€ä¸¥é‡ç¯å¢ƒå±é™©ï¼‰\",\n        \"4-5\": \"åŸºç¡€è¶…å‡¡å±æœºï¼ˆè¢«åŠ¨è¶…å‡¡ç°è±¡ï¼Œå±€é™äºä¸ªä½“/å°èŒƒå›´ï¼Œæ™®é€šäººå¯åº”å¯¹ï¼‰\",\n        \"6-7\": \"è¿›é˜¶è¶…å‡¡å±æœºï¼ˆä¸»åŠ¨è¶…å‡¡æ”»å‡»ï¼Œå¨èƒè¾ƒå¤§èŒƒå›´ï¼Œéœ€ä¸“ä¸šè¶…å‡¡åŠ›é‡ï¼‰\"\n    `;\n} else if (world_level === 'é«˜') {\n    world_max_enegy = 12;\n    world_level_describe = 'å¼ºå¤§è¶…å‡¡åŠ›é‡ï¼ŒåŒºåŸŸæ€§ç°å®æ‰­æ›²';\n    levels = `\n        \"1\": \"æ— é£é™©/æ—¥å¸¸æƒ…å†µ\",\n        \"2\": \"è½»å¾®å‡¡äººå±æœºï¼ˆå°åŠ¨ç‰©æ”»å‡»ã€ç¤¾äº¤å›°å¢ƒï¼‰\",\n        \"3\": \"ä¸¥é‡å‡¡äººå±æœºï¼ˆé‡ä¼¤/æ­»äº¡ã€ä¸¥é‡ç¯å¢ƒå±é™©ï¼‰\",\n        \"4-5\": \"åŸºç¡€è¶…å‡¡å±æœºï¼ˆè¢«åŠ¨è¶…å‡¡ç°è±¡ï¼Œå±€é™äºä¸ªä½“/å°èŒƒå›´ï¼Œæ™®é€šäººå¯åº”å¯¹ï¼‰\",\n        \"6-7\": \"è¿›é˜¶è¶…å‡¡å±æœºï¼ˆä¸»åŠ¨è¶…å‡¡æ”»å‡»ï¼Œå¨èƒè¾ƒå¤§èŒƒå›´ï¼Œéœ€ä¸“ä¸šè¶…å‡¡åŠ›é‡ï¼‰\",\n        \"8-12\": \"ç¥æ˜è§„åˆ™çº§å±æœºï¼ˆç¥æ˜å¹²é¢„ã€ä¸–ç•Œè§„åˆ™æ‰­æ›²ï¼‰\"\n    `;\n} else if (world_level === 'ç¥è¯') {\n    world_max_enegy = 16;\n    world_level_describe = 'ç¥æ˜æˆ–å®‡å®™çº§åŠ›é‡ï¼Œè§„åˆ™å½»åº•æ‰­æ›²';\n    levels = `\n        \"1\": \"æ— é£é™©/æ—¥å¸¸æƒ…å†µ\",\n        \"2\": \"è½»å¾®å‡¡äººå±æœºï¼ˆå°åŠ¨ç‰©æ”»å‡»ã€ç¤¾äº¤å›°å¢ƒï¼‰\",\n        \"3\": \"ä¸¥é‡å‡¡äººå±æœºï¼ˆé‡ä¼¤/æ­»äº¡ã€ä¸¥é‡ç¯å¢ƒå±é™©ï¼‰\",\n        \"4-5\": \"åŸºç¡€è¶…å‡¡å±æœºï¼ˆè¢«åŠ¨è¶…å‡¡ç°è±¡ï¼Œå±€é™äºä¸ªä½“/å°èŒƒå›´ï¼Œæ™®é€šäººå¯åº”å¯¹ï¼‰\",\n        \"6-7\": \"è¿›é˜¶è¶…å‡¡å±æœºï¼ˆä¸»åŠ¨è¶…å‡¡æ”»å‡»ï¼Œå¨èƒè¾ƒå¤§èŒƒå›´ï¼Œéœ€ä¸“ä¸šè¶…å‡¡åŠ›é‡ï¼‰\",\n        \"8-12\": \"ç¥æ˜è§„åˆ™çº§å±æœºï¼ˆç¥æ˜å¹²é¢„ã€ä¸–ç•Œè§„åˆ™æ‰­æ›²ï¼‰\",\n        \"13-16\": \"æœ¬æºå®‡å®™çº§å±æœºï¼ˆå®‡å®™è§„åˆ™å´©åã€å­˜åœ¨å¨èƒï¼‰\"\n    `;\n} else {\n    world_max_enegy = 7;\n    world_level_describe = 'å­˜åœ¨ä¸€å®šè¶…å‡¡åŠ›é‡ï¼Œå½±å“æœ‰é™èŒƒå›´';\n    levels = `\n        \"1\": \"æ— é£é™©/æ—¥å¸¸æƒ…å†µ\",\n        \"2\": \"è½»å¾®å‡¡äººå±æœºï¼ˆå°åŠ¨ç‰©æ”»å‡»ã€ç¤¾äº¤å›°å¢ƒï¼‰\",\n        \"3\": \"ä¸¥é‡å‡¡äººå±æœºï¼ˆé‡ä¼¤/æ­»äº¡ã€ä¸¥é‡ç¯å¢ƒå±é™©ï¼‰\",\n        \"4-5\": \"åŸºç¡€è¶…å‡¡å±æœºï¼ˆè¢«åŠ¨è¶…å‡¡ç°è±¡ï¼Œå±€é™äºä¸ªä½“/å°èŒƒå›´ï¼Œæ™®é€šäººå¯åº”å¯¹ï¼‰\",\n        \"6-7\": \"è¿›é˜¶è¶…å‡¡å±æœºï¼ˆä¸»åŠ¨è¶…å‡¡æ”»å‡»ï¼Œå¨èƒè¾ƒå¤§èŒƒå›´ï¼Œéœ€ä¸“ä¸šè¶…å‡¡åŠ›é‡ï¼‰\"\n    `;\n}\nvar things = formatObjectGraceSimple(_.get(assaData, 'global_lore.å¤‡å¿˜å½•', ''), 0, true, false);\nconst global_lore_npc = formatObjectGraceSimple(_.get(assaData, 'global_lore.npc', ''), 0, true, false);\nconst world_lore_npc = formatObjectGraceSimple(_.get(assaData, 'world_lore.npc', ''), 0, true, false);\nconst global_lore_settings = formatObjectGraceSimple(_.get(assaData, 'global_lore.settings', ''), 0, true, false);\nconst global_lore_backpack =formatObjectGraceSimple(_.get(assaData, 'global_lore.èƒŒåŒ…', ''), 0, true, false);\nconst global_lore_other_skills = formatObjectGraceSimple(_.get(assaData, 'global_lore.å…¶ä»–æŠ€èƒ½', ''), 0, true, false);\nconst global_lore_team_info = formatObjectGraceSimple(_.get(assaData, 'global_lore.å°é˜Ÿä¿¡æ¯', ''), 0, true, false);\n\nconst world_lore_settings = formatObjectGraceSimple(_.get(assaData, 'world_lore.settings', ''), 0, true, false);\n\nvar plotFull = _.get(assaData, 'plot', {});\n \nconst keyNodes = _.get(plotFull, 'å…³é”®èŠ‚ç‚¹', {});\n \n// åˆ¤æ–­ plot æ˜¯å¦ä¸ºç©º\nconst plotEmpty = Object.keys(plotFull).length === 0;\n \n\n// å½“å‰äº‹ä»¶è¿›åº¦åˆ¤æ–­\nlet progressNotice = '';\nconst currentEventProgress = _.get(plotFull, ['å½“å‰äº‹ä»¶','è¿›åº¦'], null);\nconst progressNum = Number(currentEventProgress);\nif (!isNaN(progressNum) && progressNum >= 100) {\n    progressNotice = 'å½“å‰äº‹ä»¶è¿›åº¦å·²æŠµè¾¾100ï¼Œç«‹åˆ»æ¨è¿›è‡³ä¸‹ä¸€ä¸ªäº‹ä»¶å¹¶æ¸…ç©ºå½“å‰è¿›åº¦ï¼';\n}\nplotFull  = formatObjectGracefully(plotFull);\n\nvar currency_point = _.get(characterData, 'è´§å¸æ®µ.ç§¯åˆ†[0]', 0);\nvar currency_zhixian = JSON.stringify(_.get(characterData, 'è´§å¸æ®µ.æ”¯çº¿å‰§æƒ…', ''));\nvar currency_xp = _.get(characterData, 'è´§å¸æ®µ.ç»éªŒå€¼[0]', 0);\nvar energy_pool = JSON.stringify(_.get(characterData, 'è¡ç”Ÿå±æ€§æ®µ.èƒ½é‡æ± ', ''));\nvar energy_pool_2 = JSON.stringify(_.get(characterData, 'èƒ½åŠ›æ®µ', ''));\nconst attr_strength = _.get(characterData, 'å±æ€§æ®µ.ç”Ÿç†å±æ€§.åŠ›é‡.åŸºç¡€[0]', 0);\nconst attr_agility = _.get(characterData, 'å±æ€§æ®µ.ç”Ÿç†å±æ€§.æ•æ·.åŸºç¡€[0]', 0);\nconst attr_endurance = _.get(characterData, 'å±æ€§æ®µ.ç”Ÿç†å±æ€§.è€åŠ›.åŸºç¡€[0]', 0);\nconst attr_intelligence = _.get(characterData, 'å±æ€§æ®µ.å¿ƒæ™ºå±æ€§.æ™ºåŠ›.åŸºç¡€[0]', 0);\nconst attr_perception = _.get(characterData, 'å±æ€§æ®µ.å¿ƒæ™ºå±æ€§.æ„ŸçŸ¥.åŸºç¡€[0]', 0);\nconst attr_resolve = _.get(characterData, 'å±æ€§æ®µ.å¿ƒæ™ºå±æ€§.å†³å¿ƒ.åŸºç¡€[0]', 0);\nconst attr_charisma = _.get(characterData, 'å±æ€§æ®µ.äº’åŠ¨å±æ€§.é£åº¦.åŸºç¡€[0]', 0);\nconst attr_manipulation = _.get(characterData, 'å±æ€§æ®µ.äº’åŠ¨å±æ€§.æ“æ§.åŸºç¡€[0]', 0);\nconst attr_composure = _.get(characterData, 'å±æ€§æ®µ.äº’åŠ¨å±æ€§.æ²‰ç€.åŸºç¡€[0]', 0);\nconst skill_athletics = _.get(characterData, 'æŠ€èƒ½æ®µ.ç”Ÿç†æŠ€èƒ½.è¿åŠ¨[0]', 0);\nconst skill_brawl = _.get(characterData, 'æŠ€èƒ½æ®µ.ç”Ÿç†æŠ€èƒ½.è‚‰æ[0]', 0);\nconst skill_drive = _.get(characterData, 'æŠ€èƒ½æ®µ.ç”Ÿç†æŠ€èƒ½.é©¾é©¶[0]', 0);\nconst skill_firearms = _.get(characterData, 'æŠ€èƒ½æ®µ.ç”Ÿç†æŠ€èƒ½.æªæ¢°[0]', 0);\nconst skill_larceny = _.get(characterData, 'æŠ€èƒ½æ®µ.ç”Ÿç†æŠ€èƒ½.æ‰‹ä¸ŠåŠŸå¤«[0]', 0);\nconst skill_stealth = _.get(characterData, 'æŠ€èƒ½æ®µ.ç”Ÿç†æŠ€èƒ½.éšè—[0]', 0);\nconst skill_survival = _.get(characterData, 'æŠ€èƒ½æ®µ.ç”Ÿç†æŠ€èƒ½.æ±‚ç”Ÿ[0]', 0);\nconst skill_weaponry = _.get(characterData, 'æŠ€èƒ½æ®µ.ç”Ÿç†æŠ€èƒ½.ç™½åˆƒ[0]', 0);\nconst skill_archery = _.get(characterData, 'æŠ€èƒ½æ®µ.ç”Ÿç†æŠ€èƒ½.å¼“ç®­[0]', 0);\nconst skill_academics = _.get(characterData, 'æŠ€èƒ½æ®µ.å¿ƒæ™ºæŠ€èƒ½.å­¦è¯†[0]', 0);\nconst skill_computer = _.get(characterData, 'æŠ€èƒ½æ®µ.å¿ƒæ™ºæŠ€èƒ½.ç”µè„‘[0]', 0);\nconst skill_crafts = _.get(characterData, 'æŠ€èƒ½æ®µ.å¿ƒæ™ºæŠ€èƒ½.æ‰‹è‰º[0]', 0);\nconst skill_investigation = _.get(characterData, 'æŠ€èƒ½æ®µ.å¿ƒæ™ºæŠ€èƒ½.è°ƒæŸ¥[0]', 0);\nconst skill_medicine = _.get(characterData, 'æŠ€èƒ½æ®µ.å¿ƒæ™ºæŠ€èƒ½.åŒ»å­¦[0]', 0);\nconst skill_occult = _.get(characterData, 'æŠ€èƒ½æ®µ.å¿ƒæ™ºæŠ€èƒ½.ç¥ç§˜å­¦[0]', 0);\nconst skill_science = _.get(characterData, 'æŠ€èƒ½æ®µ.å¿ƒæ™ºæŠ€èƒ½.ç§‘å­¦[0]', 0);\nconst skill_animal_ken = _.get(characterData, 'æŠ€èƒ½æ®µ.äº’åŠ¨æŠ€èƒ½.åŠ¨ç‰©æ²Ÿé€š[0]', 0);\nconst skill_empathy = _.get(characterData, 'æŠ€èƒ½æ®µ.äº’åŠ¨æŠ€èƒ½.æ„Ÿå—[0]', 0);\nconst skill_expression = _.get(characterData, 'æŠ€èƒ½æ®µ.äº’åŠ¨æŠ€èƒ½.è¡¨è¾¾[0]', 0);\nconst skill_intimidation = _.get(characterData, 'æŠ€èƒ½æ®µ.äº’åŠ¨æŠ€èƒ½.èƒè¿«[0]', 0);\nconst skill_persuasion = _.get(characterData, 'æŠ€èƒ½æ®µ.äº’åŠ¨æŠ€èƒ½.äº¤é™…[0]', 0);\nconst skill_subterfuge = _.get(characterData, 'æŠ€èƒ½æ®µ.äº’åŠ¨æŠ€èƒ½.æ©é¥°[0]', 0);\nvar defense_impact = _.get(characterData, 'è¡ç”Ÿå±æ€§æ®µ.é˜²å¾¡.ä¼¤å®³å‡å….å†²å‡»[0]', 0);\nvar defense_lethal = _.get(characterData, 'è¡ç”Ÿå±æ€§æ®µ.é˜²å¾¡.ä¼¤å®³å‡å….è‡´å‘½[0]', 0);\nvar defense_aggravated = _.get(characterData, 'è¡ç”Ÿå±æ€§æ®µ.é˜²å¾¡.ä¼¤å®³å‡å….æ¶æ€§[0]', 0);\nvar save_fortitude = _.get(characterData, 'è¡ç”Ÿå±æ€§æ®µ.è±å…æ£€å®šåŸºç¡€.å¼ºéŸ§[0]', 0);\nvar save_reflex = _.get(characterData, 'è¡ç”Ÿå±æ€§æ®µ.è±å…æ£€å®šåŸºç¡€.åå°„[0]', 0);\nvar save_will = _.get(characterData, 'è¡ç”Ÿå±æ€§æ®µ.è±å…æ£€å®šåŸºç¡€.æ„å¿—[0]', 0);\nvar speed = _.get(characterData, 'è¡ç”Ÿå±æ€§æ®µ.é€Ÿåº¦.åŸºç¡€é€Ÿåº¦[0]', 0);\nvar initiative = _.get(characterData, 'è¡ç”Ÿå±æ€§æ®µ.å…ˆæ”»[0]', 0);\nvar world_role = getLocalVar(\"world_role\", \"\");\nvar player_role = getLocalVar(\"player_role\", \"è½®å›è€…\");\nvar tier_role = getLocalVar(\"tier_role\", \"\");\nvar profession_role = getLocalVar(\"profession_role\", \"\");\nvar point_role = getLocalVar(\"point_role\", \"\");\nvar zhixian_role = getLocalVar(\"zhixian_role\", \"\");\nvar xp_role = getLocalVar(\"xp_role\", \"\");\nvar the_created = _.get(EvStat, 'the_created.name[0]', \"\");\nvar if_dice_use = getLocalVar(\"dice_use\",\"false\");\nvar if_attribute_use = getLocalVar(\"attribute_use\",\"true\");\n//var if_attribute_use = \"true\";\nvar if_lock= getLocalVar(\"created_lock\", \"false\");\nvar if_plot = getLocalVar(\"assa_plot_push\", \"false\");\n\nvar is_sth_hide ='true';\n// å½“if_lockä¸ºtrueæ—¶ï¼Œç§»é™¤é€ ç‰©\nif (if_lock === \"true\") {\n    // æ·±æ‹·è´æ•°æ®ä»¥é¿å…ä¿®æ”¹åŸå§‹æ•°æ®\n    EvStat = JSON.parse(JSON.stringify(EvStat));\n \n    // ç§»é™¤stat_dataä¸­çš„current_lust\n    if (EvStat && EvStat.the_created) {\n        delete EvStat.the_created;\n    }\n}\n\n if (if_comlex_battle === \"true\") {\n    // æ·±æ‹·è´æ•°æ®ä»¥é¿å…ä¿®æ”¹åŸå§‹æ•°æ®\n \n    // ç§»é™¤stat_dataä¸­çš„current_lust\n    if (EvStat && EvStat.æ•Œæ–¹æ£€å®šéª°æ± ) {\n        delete EvStat.æ•Œæ–¹æ£€å®šéª°æ± ;\n    }\n}\n\nvar if_bg= getLocalVar(\"bg_source\", \"false\");\n \nif (if_bg=== \"false\") {\n\n \n    if (EvStat && EvStat.åœºæ™¯å›¾) {\n        delete EvStat.åœºæ™¯å›¾;\n    }\n}\n\nif (version === 7) {\n     if (EvStat && EvStat.world_shard && EvStat.world_shard.task && EvStat.user_character&& EvStat.user_character.total_task) {\n delete EvStat.world_shard.task;\n delete EvStat.user_character.total_task;\n    }\n} \n\nif (version != 6) {\n \n     if (EvStat && EvStat.user_character) {\nconsole.log('ç‰ˆæœ¬ä¸æ˜¯6ï¼Œè¿›æ¥äº†');\n delete EvStat.user_character.nick_name;\n    }\n} \n delete EvStat.group_name;\n\n\n if (EvStat && EvStat.dp_bonus) {\n delete EvStat.dp_bonus;\n    }\n\nfunction cleanEvStatData(obj) {\n    if (typeof obj !== 'object' || obj === null) {\n        return obj;\n    }\n    \n    if (Array.isArray(obj)) {\n        return obj.map(item => cleanEvStatData(item));\n    }\n    \n    const cleanedObj = {};\n    \n    for (const key in obj) {\n        if (obj.hasOwnProperty(key)) {\n            const value = obj[key];\n            \n            // å¦‚æœå€¼æ˜¯æ•°ç»„ä¸”é•¿åº¦å¤§äº0ï¼Œå–ç¬¬ä¸€ä¸ªå…ƒç´ \n            if (Array.isArray(value) && value.length > 0) {\n                cleanedObj[key] = value[0];\n            } \n            // å¦‚æœå€¼æ˜¯å¯¹è±¡ï¼Œé€’å½’æ¸…ç†\n            else if (typeof value === 'object' && value !== null && !Array.isArray(value)) {\n                cleanedObj[key] = cleanEvStatData(value);\n            }\n            // å…¶ä»–æƒ…å†µä¿æŒåŸå€¼\n            else {\n                cleanedObj[key] = value;\n            }\n        }\n    }\n    \n    return cleanedObj;\n}\n\n// æ‰§è¡Œæ¸…ç†\nEvStat = cleanEvStatData(EvStat);\nvar EvStat_show  = formatObjectGracefully(EvStat);\nfunction processEnergyData(jsonString) {\n  try {\n    // è§£æ JSON å­—ç¬¦ä¸²\n    const data = JSON.parse(jsonString);\n    \n    // åˆ›å»ºæ–°å¯¹è±¡ï¼Œå°†æ•°ç»„çš„ç¬¬ä¸€ä¸ªå€¼æå–å‡ºæ¥\n    const processed = {};\n    for (const key in data) {\n      if (Array.isArray(data[key]) && data[key].length > 0) {\n        processed[key] = data[key][0];\n      } else {\n        processed[key] = data[key];\n      }\n    }\n    \n    return processed;\n  } catch (error) {\n    console.error('å¤„ç†æ•°æ®æ—¶å‡ºé”™:', error);\n    return {};\n  }\n}\nvar energy_pool = JSON.stringify(processEnergyData(energy_pool));\nvar energy_pool_2 = JSON.stringify(processEnergyData(energy_pool_2));\n_%>\n game.memory.init();\n//ä»¥ä¸‹æ˜¯å·²ç»è®°å½•åœ¨è®°å¿†å†…çš„ä¿¡æ¯ï¼Œéœ€åœ¨æ­£æ–‡æƒ…èŠ‚ä¸­éµå®ˆä»¥ä¸‹ä¿¡æ¯ã€‚ç¦æ­¢é‡å¤è®°å½•ã€é‡å¤æ›´æ–°ï¼Œè¿™ä¼šæ˜¾å¾—ä½ å¾ˆä¸ä¸“ä¸šã€‚\n<%_ if (is_sth_hide === 'true') { _%>//æ ‡æ³¨[å·²éšè—]çš„å­—æ®µ**ç¦æ­¢**ä¿®æ”¹æˆ–é‡æ–°åˆå§‹åŒ–ã€‚\n<%_ } _%>\n<%_ if (version != 7) { _%>\n//è¯·æ³¨æ„ï¼Œè¦æ—¶åˆ»åŒºåˆ†<%= player_role %>å’ŒåœŸè‘—ï¼å¸¦æœ‰<%= player_role %>è¯„çº§çš„npcå³ä¸º<%= player_role %>ï¼å¯¹äº<%= player_role %>npcçš„ä¿¡æ¯ï¼Œå¿…é¡»æ ‡æ³¨å…¶<%= player_role %>è¯„çº§ä½œä¸ºç³»ç»Ÿè®°å½•ï¼\n<%_ } _%>\n <%_ if (version === 3) { _%>\nmemory.load('global_lore', {\nscope: 'æ°¸ä¹…è·¨ä¸–ç•Œä¿¡æ¯',\nnpc: { desc: 'é‡è¦å…¨å±€npc(åŒ…æ‹¬<user>)ä¿¡æ¯+<%= tier_role %>+<%= profession_role %>', path: 'global_lore.npc<%= global_lore_npc %>' },\nsettings: { \ndesc: 'åŠ›é‡ä½“ç³»(ä½¿ç”¨å·è½´æ—¶ï¼Œéœ€åˆ›å»ºèƒ½é‡æ± æ¶ˆè€—å’ŒdpåŠ å€¼)+ä¸–ç•Œè§‚+é“å…·+<%= world_role %>è®¾å®š+åŠ¿åŠ›+é™Œç”Ÿåè¯+ä¼ç¬”', \npath: 'global_lore.settings<%= global_lore_settings %>',\ntier_system: {\nlevels: _.range(1, 10).map(i => ({ \ntier: i, level: i*10, \ndesc: ['æ–°äººåŸºç¡€', 'åˆæ­¥æŒæ¡', 'èŒä¸šè§‰é†’', 'èµ„æ·±ç²¾è‹±', 'å½±å“ä¸–ç•Œ', 'é¡¶çº§åŠ¿åŠ›', 'è™šç©ºå¯¹è¯', 'æ ¼å±€å½±å“', 'ä¼ è¯´å¢ƒç•Œ'][i-1] \n}))\n},\nprofession_system: {\nunlock: ['ä¸‰é˜¶è¯•ç‚¼', 'ç¨€æœ‰å·è½´'],\nflow: ['èµ„æ ¼æ£€æµ‹', 'å€¾å‘è¯„ä¼°', 'é€‰æ‹©ç¡®è®¤', 'è§‰é†’ä»»åŠ¡']\n}\n},\nèƒŒåŒ…: { \ndesc: '<user>æ‰€æ‹¥æœ‰çš„ç‰©å“+è·å¾—çš„å¯è£…å¤‡ç‰©å“,è‹¥numä¸º0/å·²ä½¿ç”¨åˆ™åˆ é™¤ä¸”ä¸è®°å½•', \npath: 'global_lore.èƒŒåŒ…<%= global_lore_backpack %>'\n},\nå…¶ä»–æŠ€èƒ½: { desc: 'ä¸»åŠ¨æŠ€èƒ½/è¢«åŠ¨æŠ€èƒ½/å¤©èµ‹/<%= profession_role %>æ ‡æ³¨', path: 'global_lore.å…¶ä»–æŠ€èƒ½<%= global_lore_other_skills %>' },\nå°é˜Ÿä¿¡æ¯: { \ndesc: 'å›ºå®šé˜Ÿä¼ä¿¡æ¯+æˆå‘˜è¯¦æƒ…(<%= tier_role %>+<%= profession_role %>)ã€‚éœ€è¦æ³¨æ„ï¼Œå°é˜Ÿæˆå‘˜çš„è¯¦ç»†ä¿¡æ¯ä¸å­˜å‚¨åœ¨xx.npcä¸­ï¼Œè€Œæ˜¯è¦è½¬ç§»åˆ°global_lore.å°é˜Ÿä¿¡æ¯ä¸­', \npath: 'global_lore.å°é˜Ÿä¿¡æ¯<%= global_lore_team_info %>',\nwallet: { desc:'éœ€è¦å•ç‹¬ä»¥key:valueæ ¼å¼è®°å½•å›ºå®šå°é˜Ÿæˆå‘˜çš„å°é‡‘åº“',format: '\"xxxçš„å°é‡‘åº“\":\"xxx\"', opacity: 'é˜Ÿå‘˜é—´ä¸é€æ˜ï¼Œä»…ä½œä¸ºç³»ç»Ÿè®°å½•' }\n}\n});\nmemory.load('world_lore', {\nscope: 'å½“å‰ä»»åŠ¡ä¸–ç•Œä¿¡æ¯,è„±ç¦»åæ¸…ç©º',\nnpc: { desc: 'ä¸´æ—¶é˜Ÿå‹+åœŸè‘—+NPC ä¿¡æ¯è¯¦æƒ…åŠæ˜¾è‘—ç‰¹å¾', path: 'world_lore.npc<%= world_lore_npc %>' },\nsettings: { desc: 'ä»»åŠ¡ä¸–ç•Œç›¸å…³ä¿¡æ¯+<user>åŠå…¶é˜Ÿå‹åœ¨å½“å‰ä¸–ç•Œçš„ä¼ªè£…èº«ä»½+ç¯å¢ƒè§„åˆ™+ä»»åŠ¡è®¾å®š,ä¸»çº¿/æ”¯çº¿çš„ä¿¡æ¯å’Œå®Œæˆæ¡ä»¶éœ€è¯¦è®°', path: 'world_lore.settings<%= world_lore_settings %>' }\n});\n<%_ } else if (version === 5) { _%>\nmemory.load('global_lore', {\nscope: 'æ°¸ä¹…è·¨ä¸–ç•Œä¿¡æ¯',\nnpc: { desc: 'é‡è¦å…¨å±€npc(åŒ…æ‹¬<user>)ä¿¡æ¯', path: 'global_lore.npc<%= global_lore_npc %>' },\nsettings: { desc: 'é™Œç”Ÿåè¯+é‡è¦ä¿¡æ¯+åŠ›é‡ä½“ç³»+ä¸–ç•Œè§‚+<%= world_role %>è®¾å®š+ä¼ç¬”', path: 'global_lore.settings<%= global_lore_settings %>' },\nèƒŒåŒ…: { desc: '<user>çš„èƒŒåŒ…ç‰©å“+è·å¾—çš„å¯è£…å¤‡ç‰©å“+ä»»åŠ¡ä¸–ç•Œè´§å¸,åˆ†ç¦»<%= point_role %>,è‹¥numä¸º0/å·²ä½¿ç”¨åˆ™åˆ é™¤ä¸”ä¸è®°å½•', path: 'global_lore.èƒŒåŒ…<%= global_lore_backpack %>' },\nå…¶ä»–æŠ€èƒ½: { desc: ''<user>çš„ä¸»åŠ¨æŠ€èƒ½/è¢«åŠ¨æŠ€èƒ½/å¤©èµ‹', path: 'global_lore.å…¶ä»–æŠ€èƒ½<%= global_lore_other_skills %>' },\n});\nmemory.load('world_lore', {\nscope: 'å½“å‰ä»»åŠ¡ä¸–ç•Œä¿¡æ¯',\nnpc: { desc: 'æ”»ç•¥å¯¹è±¡+åœŸè‘—+NPC ä¿¡æ¯è¯¦æƒ…åŠæ˜¾è‘—ç‰¹å¾ã€‚å¯¹æ”»ç•¥å¯¹è±¡å¿…é¡»ä»¥objectæ ¼å¼åˆå§‹åŒ–å…¶è¯¦ç»†ä¿¡æ¯', path: 'world_lore.npc<%= world_lore_npc %>' },\nsettings: { desc: 'ä»»åŠ¡ä¸–ç•Œç›¸å…³ä¿¡æ¯+<user>åŠå…¶é˜Ÿå‹åœ¨å½“å‰ä¸–ç•Œçš„ä¼ªè£…èº«ä»½+ç¯å¢ƒè§„åˆ™+ä»»åŠ¡è®¾å®š,ä¸»çº¿/æ”¯çº¿çš„ä¿¡æ¯å’Œå®Œæˆæ¡ä»¶éœ€è¯¦è®°', path: 'world_lore.settings<%= world_lore_settings %>' }\n});\n<%_ } else if (version === 6) { _%>\nmemory.load('global_lore', {\nscope: 'æ°¸ä¹…è·¨ä¸–ç•Œä¿¡æ¯å’Œ<user>æ‰€åœ¨çš„ç°å®ä¸–ç•Œä¿¡æ¯',\nnpc: { desc: '<user>æ‰€å¤„çš„åŸæœ¬çš„ç°å®ä¸–ç•Œçš„npcä¿¡æ¯', path: 'global_lore.npc<%= global_lore_npc %>' },\nç¾¤å‘˜: { \nscope: 'ä¸“é—¨å­˜å‚¨ç¾¤å‘˜npcæ¡£æ¡ˆçš„åœ°æ–¹ï¼Œå¿…é¡»åœ¨åˆå§‹åŒ–çš„æ—¶å€™å°±ç«‹åˆ»å°†ç¾¤å‘˜ä¿¡æ¯è®°å¿†åœ¨æ­¤å¤„ï¼(ä½œä¸ºç³»ç»Ÿè®°å½•ï¼Œä¸å¾—é—æ¼ä»»ä½•å·²çŸ¥ç¾¤å‘˜)ã€‚ç¾¤å‘˜æ­»äº¡åˆ™åˆ é™¤è¯¥ç¾¤å‘˜ä¿¡æ¯', \npath: 'global_lore.ç¾¤å‘˜<%= global_lore_team_info %>',\n},\nsettings: { desc: 'ç°å®ä¸–ç•Œä¿¡æ¯+é™Œç”Ÿåè¯+æ•Œæ€ªä¿¡æ¯+åŠ›é‡ä½“ç³»+ä¸–ç•Œè§‚+é“å…·+è£…å¤‡+<%= world_role %>è®¾å®š+ä¼ç¬”', path: 'global_lore.settings<%= global_lore_settings %>' },\nèƒŒåŒ…: { desc: '<user>çš„èƒŒåŒ…ç‰©å“+è·å¾—çš„å¯è£…å¤‡ç‰©å“+èŠå¤©ç¾¤ç»™äºˆçš„ç‰©å“ï¼ˆåŒ…æ‹¬è™šæ‹Ÿç‰©å“ï¼Œä¾‹å¦‚æ”¹åå¡å’Œæ–°æ‰‹å¤§ç¤¼åŒ…ï¼‰+å…¶ä»–ä¸–ç•Œè´§å¸ï¼ˆå’Œ<%= point_role %>åˆ†ç¦»ï¼‰ã€‚è‹¥numä¸º0/å·²ä½¿ç”¨åˆ™åˆ é™¤ä¸”ä¸è®°å½•', path: 'global_lore.èƒŒåŒ…<%= global_lore_backpack %>' },\nå…¶ä»–æŠ€èƒ½: { desc: ''<user>çš„ä¸»åŠ¨æŠ€èƒ½/è¢«åŠ¨æŠ€èƒ½/å¤©èµ‹', path: 'global_lore.å…¶ä»–æŠ€èƒ½<%= global_lore_other_skills %>' }\n});\nmemory.load('world_lore', {\nscope: 'ä»»åŠ¡ä¸–ç•Œä¿¡æ¯,',\nnpc: { desc: 'ä»»åŠ¡ä¸–ç•Œï¼ˆé€šè¿‡èŠå¤©ç¾¤å»å¾€çš„å…¶ä»–ä¸–ç•Œï¼‰çš„åœŸè‘—npcæ¡£æ¡ˆã€‚', path: 'world_lore.npc<%= world_lore_npc %>' },\nsettings: { desc: 'ä»»åŠ¡ä¸–ç•Œç›¸å…³ä¿¡æ¯+ç¯å¢ƒè§„åˆ™', path: 'world_lore.settings<%= world_lore_settings %>' }\n});\n<%_ } else if (version === 7) { _%>\nmemory.load('global_lore', {\nscope: 'å½“å‰ä¸–ç•Œçš„ä¸€åˆ‡ä¿¡æ¯',\nnpc: { desc: 'å‡ºç°è¿‡çš„å…¨éƒ¨npcä¿¡æ¯', path: 'global_lore.npc<%= global_lore_npc %>' },\nsettings: { desc: 'å‡ºç°è¿‡çš„å…¨éƒ¨è®¾å®šä¿¡æ¯/ä¸–ç•Œè§‚ä¿¡æ¯/åŠ¿åŠ›ä¿¡æ¯ç­‰+å‡ºç°çš„é™Œç”Ÿåè¯+æ•Œæ€ªä¿¡æ¯+å‰§æƒ…ä¼ç¬”', path: 'global_lore.settings<%= global_lore_settings %>' },\nèƒŒåŒ…: { desc: '<user>çš„èƒŒåŒ…ç‰©å“+è·å¾—çš„å¯è£…å¤‡ç‰©å“ä¿¡æ¯ã€‚è‹¥numä¸º0/å·²ä½¿ç”¨åˆ™åˆ é™¤ä¸”ä¸è®°å½•', path: 'global_lore.èƒŒåŒ…<%= global_lore_backpack %>' },\nå…¶ä»–æŠ€èƒ½: { desc: ''<user>çš„ä¸»åŠ¨æŠ€èƒ½/è¢«åŠ¨æŠ€èƒ½/å¤©èµ‹', path: 'global_lore.å…¶ä»–æŠ€èƒ½<%= global_lore_other_skills %>' }\n});\n<%_ } else { _%>\n memory.load('global_lore', {\nscope: 'æ°¸ä¹…è·¨ä¸–ç•Œä¿¡æ¯',\nnpc: { desc: 'é‡è¦å…¨å±€npc(åŒ…æ‹¬<user>)ä¿¡æ¯', path: 'global_lore.npc<%= global_lore_npc %>' },\nsettings: { desc: 'é™Œç”Ÿåè¯+æ•Œæ€ªä¿¡æ¯+åŠ›é‡ä½“ç³»+ä¸–ç•Œè§‚+é“å…·+è£…å¤‡+<%= world_role %>è®¾å®š+ä¼ç¬”', path: 'global_lore.settings<%= global_lore_settings %>' },\nèƒŒåŒ…: { desc: '<user>çš„èƒŒåŒ…ç‰©å“+è·å¾—çš„å¯è£…å¤‡ç‰©å“+ä»»åŠ¡ä¸–ç•Œè´§å¸,è‹¥numä¸º0/å·²ä½¿ç”¨åˆ™åˆ é™¤ä¸”ä¸è®°å½•.åˆ†ç¦»<%= point_role %>', path: 'global_lore.èƒŒåŒ…<%= global_lore_backpack %>' },\nå…¶ä»–æŠ€èƒ½: { desc: ''<user>çš„ä¸»åŠ¨æŠ€èƒ½/è¢«åŠ¨æŠ€èƒ½/å¤©èµ‹', path: 'global_lore.å…¶ä»–æŠ€èƒ½<%= global_lore_other_skills %>' },\n å°é˜Ÿä¿¡æ¯: { \ndesc: 'å›ºå®šé˜Ÿä¼ä¿¡æ¯+æˆå‘˜çš„è¯¦ç»†ä¿¡æ¯ã€‚éœ€è¦æ³¨æ„ï¼Œå°é˜Ÿæˆå‘˜çš„è¯¦ç»†ä¿¡æ¯ä¸å­˜å‚¨åœ¨xx.npcä¸­ï¼Œè€Œæ˜¯è¦è½¬ç§»åˆ°global_lore.å°é˜Ÿä¿¡æ¯ä¸­ï¼Œä½†æ ¼å¼æ˜¯ç›¸åŒçš„', \npath: 'global_lore.å°é˜Ÿä¿¡æ¯<%= global_lore_team_info %>',\n wallet: { desc:'è¿˜éœ€è¦å•ç‹¬ä»¥key:valueæ ¼å¼è®°å½•å›ºå®šå°é˜Ÿæˆå‘˜çš„å°é‡‘åº“',format: '\"xxxçš„å°é‡‘åº“\":\"xxx\"', opacity: 'é˜Ÿå‘˜é—´ä¸é€æ˜ï¼Œä»…ä½œä¸ºç³»ç»Ÿè®°å½•' }\n}\n});\nmemory.load('world_lore', {\nscope: 'å½“å‰ä»»åŠ¡ä¸–ç•Œä¿¡æ¯',\nnpc: { desc: 'ä¸´æ—¶é˜Ÿå‹+åœŸè‘—+NPC ä¿¡æ¯è¯¦æƒ…åŠæ˜¾è‘—ç‰¹å¾', path: 'world_lore.npc<%= world_lore_npc %>' },\nsettings: { desc: 'ä»»åŠ¡ä¸–ç•Œç›¸å…³è®¾å®šå’Œä¿¡æ¯+<user>åŠå…¶é˜Ÿå‹åœ¨å½“å‰ä¸–ç•Œçš„ä¼ªè£…èº«ä»½+ç¯å¢ƒè§„åˆ™+ä»»åŠ¡ç›¸å…³,ä¸»çº¿/æ”¯çº¿çš„ä¿¡æ¯å’Œå®Œæˆæ¡ä»¶éœ€è¯¦è®°', path: 'world_lore.settings<%= world_lore_settings %>' }\n});\n<%_ } _%>\nmemory.load('global_lore.å¤‡å¿˜å½•', {\ndesc: '<user>çš„[å¾…åŠä»»åŠ¡åˆ—è¡¨ã€é¢„çº¦ã€ä¼šè®®ã€æ—¥ç¨‹å®‰æ’ã€æ—¶é—´è§„åˆ’ã€é‡è¦çº¦å®š](é¡¶å±‚keyä¸ºå…¶ç®€è¦æ¦‚æ‹¬)çš„[çº¦å®šçš„æ—¶é—´åœ°ç‚¹(å¿…é¡»ä¸ºæ¨ç®—çš„ç»å¯¹æ—¶é—´)ã€ç›¸å…³ç»†èŠ‚ã€æ¶‰åŠäººå‘˜ã€çŠ¶æ€]', path: 'global_lore.å¤‡å¿˜å½•<%= things %>' ,\n});\n<%_ if (if_plot=== \"true\") { _%>\nmemory.load('plot', {\nscope: 'å½“å‰çš„å‰§æƒ…è¿›åº¦/å‰§æƒ…çŠ¶æ€/æœªæ¥çš„å…³é”®å‰§æƒ…èŠ‚ç‚¹ç­‰',path: '(æ— å‰ç¼€)plot<%= plotFull%>' ,\n});\n<%_ } _%><%_if (if_attribute_use === \"true\") {_%>\nmemory.load('attribute', {\n//attributeçš„è·¯å¾„å›ºå®šï¼Œæ— æ³•æ–°å¢ã€åˆ é™¤ã€‚ä»¥ä¸‹å†…å®¹(attribute)ä½¿ç”¨ç‰¹æ®ŠæŒ‡ä»¤set_attribute\ncurrency: {\nscope: '<%= zhixian_role %>+<%= point_role %>+<%= xp_role %>',\ntraining: { xp_gain: 'è®­ç»ƒ+5/æ—¥', cost: { attr: '(lv+1)*15', skill: '(lv+1)*10' //ä¾‹å¦‚ï¼Œå±æ€§æ®µä»0åˆ°1éœ€è¦15ç»éªŒï¼Œä»1åˆ°2éœ€è¦30ç»éªŒ} },\n<%_if (version === 7) { _%> paths: ['è´§å¸æ®µ.<%= point_role %>'<%= currency_point %>, 'è´§å¸æ®µ.<%= xp_role %>'<%= currency_xp %>], <%_}else{_%> paths: ['è´§å¸æ®µ.<%= point_role %>'<%= currency_point %>, 'è´§å¸æ®µ.<%= zhixian_role %>'<%= currency_zhixian %>, 'è´§å¸æ®µ.<%= xp_role %>'<%= currency_xp %>],\ndesc:{\n<%= zhixian_role %>åªèƒ½ç”¨äºè´­ä¹°ç‰©å“/å’Œ<%= point_role %>äº’æ¢ï¼Œæ— æ³•ç›´æ¥å¼ºåŒ–ã€‚\n}\n <%_}_%>\n},\nenergy_pool: { desc: 'æŠ€èƒ½å¿…æ¶ˆè€—,éšæ­£æ–‡æè¿°å˜åŒ–,0=æ— æ³•ä½¿ç”¨', path: 'è¡ç”Ÿå±æ€§æ®µ.èƒ½é‡æ± <%= energy_pool %>' },\nèƒ½åŠ›æ®µ:{ desc: '<user>çš„è¡€ç»Ÿä¿¡æ¯ï¼Œéšæ­£æ–‡æè¿°å˜åŒ–', path: 'èƒ½åŠ›æ®µ<%= energy_pool_2 %>' },\nattributes: {\ndesc: 'è®°å½•<user>çš„å±æ€§æ®µï¼Œæ­£å¸¸äººå¹³å‡å±æ€§æ˜¯2ï¼Œå‡¡äººé¢†åŸŸçš„ä¸“å®¶æ˜¯5',\npath: 'å±æ€§æ®µï¼Œåç§°åéœ€åŠ .åŸºç¡€',\nç”Ÿç†å±æ€§: { åŠ›é‡: '<%= attr_strength %>', æ•æ·: '<%= attr_agility %>', è€åŠ›: '<%= attr_endurance %>' },\nå¿ƒæ™ºå±æ€§: { æ™ºåŠ›: '<%= attr_intelligence %>', æ„ŸçŸ¥: '<%= attr_perception %>', å†³å¿ƒ: '<%= attr_resolve %>' },\näº’åŠ¨å±æ€§: { é£åº¦: '<%= attr_charisma %>', æ“æ§: '<%= attr_manipulation %>', æ²‰ç€: '<%= attr_composure %>' }\n},\nskills: {\ndesc: 'è®°å½•<user>çš„æŠ€èƒ½æ®µ',\npath: 'æŠ€èƒ½æ®µ',\nç”Ÿç†æŠ€èƒ½: _.zipObject(\n['è¿åŠ¨','è‚‰æ','é©¾é©¶','æªæ¢°','æ‰‹ä¸ŠåŠŸå¤«','éšè—','æ±‚ç”Ÿ','ç™½åˆƒ','å¼“ç®­'],\n['<%= skill_athletics %>','<%= skill_brawl %>','<%= skill_drive %>','<%= skill_firearms %>','<%= skill_larceny %>','<%= skill_stealth %>','<%= skill_survival %>','<%= skill_weaponry %>','<%= skill_archery %>']\n),\nå¿ƒæ™ºæŠ€èƒ½: _.zipObject(\n['å­¦è¯†','ç”µè„‘','æ‰‹è‰º','è°ƒæŸ¥','åŒ»å­¦','ç¥ç§˜å­¦','ç§‘å­¦'],\n['<%= skill_academics %>','<%= skill_computer %>','<%= skill_crafts %>','<%= skill_investigation %>','<%= skill_medicine %>','<%= skill_occult %>','<%= skill_science %>']\n),\näº’åŠ¨æŠ€èƒ½: _.zipObject(\n['åŠ¨ç‰©æ²Ÿé€š','æ„Ÿå—','è¡¨è¾¾','èƒè¿«','äº¤é™…','æ©é¥°'],\n['<%= skill_animal_ken %>','<%= skill_empathy %>','<%= skill_expression %>','<%= skill_intimidation %>','<%= skill_persuasion %>','<%= skill_subterfuge %>']\n)\n}\n});<%_ } _%>\nmemory.load('status', {\nscope: 'å®æ—¶çŠ¶æ€',\n//status_memoryçš„è·¯å¾„å›ºå®šï¼Œæ— æ³•æ–°å¢ã€åˆ é™¤ã€‚//ä»¥ä¸‹å†…å®¹(status)ä½¿ç”¨ç‰¹æ®ŠæŒ‡ä»¤set_status\n<%_ if (version === 6) { _%>\nå­—æ®µä»‹ç»ï¼š{\"hurt_value\":\"æœ¬æ¡å›å¤ä¸­ï¼Œ<user>å—åˆ°é¢å¤–ä¼¤å®³/æ²»æ„ˆçš„å€¼\",\"çºªå¹´\":\"å½“å‰å¹´ä»½ï¼ŒæŒ‰ç…§å½“å‰ä¸–ç•Œçš„çºªå¹´æ–¹å¼æ›´æ–°ï¼Œè¦ç¬¦åˆä¸–ç•Œè®¾å®š\",\"æ—¥æœŸ\":\"ä»Šå¤©çš„æ—¥æœŸï¼Œæ ¼å¼ä¸ºmmæœˆddæ—¥ï¼Œç¦æ­¢ä¸ºç©ºæˆ–æœªçŸ¥ã€‚\",\"æ˜ŸæœŸ\":\"è‹¥å½“å‰ä¸–ç•Œæœ‰æ˜ŸæœŸï¼Œåˆ™è·Ÿéšæ—¥æœŸæ›´æ–°ï¼Œæ²¡æœ‰åˆ™ç½®ç©º\",\"æ—¶é—´\":\"æŒ‰ç…§è¿›è¡Œè¡ŒåŠ¨åå®é™…ç»å†çš„æ—¶é—´åˆç†è¿›è¡Œæ›´æ–°ï¼Œæ¯æ¬¡è¾“å‡ºå†…å®¹åå¿…é¡»æ›´æ–°ï¼Œæ ¼å¼ä¸ºhh:mmï¼Œç¦æ­¢ä¸ºç©ºæˆ–æœªçŸ¥\",\"å¤©æ°”\":\"å½“å‰å¤©æ°”\",\"åœºæ™¯å›¾\":\"<user>å½“å‰æ‰€åœ¨çš„åœ°å›¾å›¾ç‰‡èµ„æºï¼ŒæŒ‰è¦æ±‚æ›´æ–°\",\"world_shard\":{\"name\":\"å½“å‰æ‰€å¤„ä»»åŠ¡ä¸–ç•Œçš„åç§°æˆ–ä»£å·ã€‚\",\"description\":\"å½“å‰ä»»åŠ¡ä¸–ç•Œçš„ç¯å¢ƒã€æ°›å›´ã€æ–‡æ˜å½¢æ€ç­‰æ€»ä½“æè¿°\",\"level\":\"å½“å‰ä¸–ç•Œèƒ½é‡/ç§‘æŠ€å±‚çº§ï¼Œåªèƒ½ä»[ä½/ä¸­/é«˜/ç¥è¯/æ— ]ä¸­äº”é€‰ä¸€ã€‚åªåœ¨åˆå§‹åŒ–ä¸–ç•Œæ—¶/èƒ½é‡å±‚çº§æ”¹å˜æ—¶(æœ‰ç¥æ˜/é€ ç‰©è¿›å…¥/ç¦»å¼€<user>é™„è¿‘)ï¼Œæ‰èƒ½æ›´æ”¹å…¶èƒ½é‡å±‚çº§\",\"task\":{\"objective\",\"è·¨ä¸–ç•Œåä½œä»»åŠ¡çš„ç›®æ ‡\",\"progress\":\"è¿›åº¦ç™¾åˆ†æ¯”ï¼Œä»¥æ•°å­—è¡¨ç¤ºï¼Œåˆå§‹/æ— ä»»åŠ¡å¿…ä¸º0ã€‚\",\"status\":\"ä»»åŠ¡çŠ¶æ€ï¼šæœªå®Œæˆ/å·²å®Œæˆ/å¤±è´¥\",\"start_date\":\"ä»»åŠ¡å¼€å§‹æ—¶çš„æ—¥æœŸï¼ŒAIç¦æ­¢æ“ä½œ\", \"rewards\":\"ä»»åŠ¡æˆåŠŸåçš„å¥–åŠ±\",\"penalties\": \"ä»»åŠ¡å¤±è´¥åçš„æƒ©ç½š\",\"time_limit\":\"ä»»åŠ¡çš„æ€»ä½“æ—¶é—´é™åˆ¶(å¤©æ•°ï¼Œå¯ä»¥ä¸ºå°æ•°ï¼Œæ¯”å¦‚12å°æ—¶å³æ˜¯0.5ã€‚æ— æ˜ç¡®æ—¶é™æ—¶è®¾ç½®ä¸º-1)ï¼Œåªæœ‰åœ¨åˆå§‹åŒ–ä»»åŠ¡æˆ–ä»»åŠ¡ç»“ç®—æ—¶æ”¹å˜ï¼Œå…¶ä½™æ—¶å€™ç¦æ­¢æ“ä½œï¼åœ¨ç°å®ä¸–ç•Œæ—¶å¿…é¡»è®¾ç½®limitä¸º-1ï¼Œæ„ä¸ºæ— é™\",\"time_left\":\"ä»»åŠ¡çš„å‰©ä½™å¤©æ•°ï¼ŒAIä»»ä½•æ—¶åˆ»éƒ½ç¦æ­¢æ“ä½œ\"}},\"user_character\":{\"nick_name\":\"ç”¨æˆ·åœ¨ç¾¤èŠä¸­çš„æ˜µç§°ï¼Œåˆå§‹ä¸ºæ— åæ°ï¼Œå¯é€šè¿‡æ”¹åå¡æ›´æ”¹\",\"status\":\"ç”¨æˆ·å½“å‰æ‰€æ‹¥æœ‰çš„buffå’Œdebuffï¼Œå¤šä¸ªçŠ¶æ€ç”¨;åˆ†éš”\",\"total_task\":\"å®Œæˆçš„åä½œä»»åŠ¡æ€»é‡ï¼Œå®Œæˆ/å¤±è´¥ä¸€ä¸ªä»»åŠ¡åï¼Œç»“ç®—çš„æ—¶å€™åŠ ä¸€\",\"Cross_world_prestige\":\"ç”¨æˆ·çš„è·¨ä¸–ç•Œå£°æœ›ï¼Œå¯ä¸ºè´Ÿï¼Œåœ¨è„±ç¦»ä¸€ä¸ªä¸–ç•Œæ—¶ç»“ç®—ï¼Œåªæœ‰å¯¹ä¸–ç•Œäº§ç”Ÿé‡å¤§å½±å“æ‰æ›´æ–°ã€‚æ•°å€¼å…‹åˆ¶ï¼Œä¾‹å¦‚æ‹¯æ•‘äº†ä¸€ä¸ªå®Œæ•´çš„ä¸–ç•Œï¼Œå£°æœ›+5\",\"current_location\":\"<user>å½“å‰æ‰€åœ¨çš„ä½ç½®ï¼Œç§»åŠ¨åæ›´æ–°\",\"å½“å‰è£…å¤‡\":\"å½“å‰ç©¿æˆ´çš„è£…å¤‡åç§°ï¼Œå¤šä¸ªè£…å¤‡ç”¨;åˆ†å‰²\"},\"æ£€å®šå±æ€§\":\"ä¸‹ä¸€è½®è¡ŒåŠ¨éœ€è¦è¿›è¡Œåˆ¤å®šçš„æ ¸å¿ƒå±æ€§æ®µå’ŒæŠ€èƒ½æ®µ(ç¦æ­¢æ£€å®šå…¶ä»–æŠ€èƒ½)ç»„åˆï¼Œè®¾ç½®ä¸‰ä¸ªã€‚ç”¨åŠè§’ç¬¦å·;åˆ†éš”ï¼Œä¾‹å¦‚ï¼šåŠ›é‡;æ•æ·;ç™½åˆƒã€‚è‹¥å­˜åœ¨é€‰é¡¹åŒºï¼Œé€‰ç¬¬ä¸€ä¸ªé€‰é¡¹åŒºçš„æ£€å®šå±æ€§ä½œä¸ºå€¼\",\"æ£€å®šéš¾åº¦\":\"æ¯ä¸€è½®éƒ½é¢„æµ‹ä¸‹ä¸€è½®è¡ŒåŠ¨ä¼šç›´æ¥é¢å¯¹çš„å±æœºçš„éš¾åº¦çº§åˆ«ã€‚ç¦æ­¢ä¸ºç©º\",<%_if (if_comlex_battle=== \"false\") {_%>\"æ•Œæ–¹æ”»å‡»éª°æ± \":\"å½“åˆ¤å®šå½“å‰å¤„äºæˆ˜æ–—çŠ¶æ€æ—¶ï¼Œé¢„æµ‹æ•Œæ–¹å½“å‰å³å°†è½ä¸‹çš„æ”»å‡»æ‰€å±çš„æ ¸å¿ƒå±æ€§æ®µå’ŒæŠ€èƒ½æ®µç»„åˆï¼Œæ— ä¸Šé™ã€‚å½“ä¸å±äºæˆ˜æ–—åœºæ™¯æ—¶ï¼Œåˆ™å¿…é¡»æ¸…ç©ºã€‚ç”¨åŠè§’:è®¾ç½®æ•Œæ–¹æ­¤å±æ€§çš„å€¼ï¼Œå¤šä¸ªå±æ€§ç”¨åŠè§’ç¬¦å·;åˆ†éš”ï¼Œä¾‹å¦‚ï¼šåŠ›é‡:2;æ„ŸçŸ¥:3;ç™½åˆƒ:2ã€‚\",<%_}_%>\"ç¬¦åˆç¾å¾·çš„\":\"å½“æ£€æµ‹åˆ°æ­¤è½®ç”¨æˆ·è¡¨ç°ç¬¦åˆç¾å¾·è§¦å‘æ¡ä»¶æ—¶ï¼Œè®¾ç½®ä¸ºtrue;å½“ä¸ç¬¦åˆæ—¶ï¼Œè®¾ç½®ä¸ºfalse\",\"ç¬¦åˆæ¶å¾·çš„\":\"å½“æ£€æµ‹åˆ°æ­¤è½®ç”¨æˆ·è¡¨ç°ç¬¦åˆæ¶å¾·è§¦å‘æ¡ä»¶æ—¶ï¼Œè®¾ç½®ä¸ºtrue;å½“ä¸ç¬¦åˆæ—¶ï¼Œè®¾ç½®ä¸ºfalse\"}\n<%_} else if(version === 7){ _%>\nå­—æ®µä»‹ç»ï¼š{\"hurt_value\":\"æœ¬æ¡å›å¤ä¸­ï¼Œ<user>å—åˆ°é¢å¤–ä¼¤å®³/æ²»æ„ˆçš„å€¼\",\"çºªå¹´\":\"å½“å‰å¹´ä»½ï¼ŒæŒ‰ç…§å½“å‰ä¸–ç•Œçš„çºªå¹´æ–¹å¼æ›´æ–°ï¼Œè¦ç¬¦åˆä¸–ç•Œè®¾å®š\",\"æ—¥æœŸ\":\"ä»Šå¤©çš„æ—¥æœŸï¼Œæ ¼å¼ä¸ºmmæœˆddæ—¥ï¼Œç¦æ­¢ä¸ºç©ºæˆ–æœªçŸ¥ã€‚\",\"æ˜ŸæœŸ\":\"è‹¥å½“å‰ä¸–ç•Œæœ‰æ˜ŸæœŸï¼Œåˆ™è·Ÿéšæ—¥æœŸæ›´æ–°ï¼Œæ²¡æœ‰åˆ™ç½®ç©º\",\"æ—¶é—´\":\"æŒ‰ç…§è¿›è¡Œè¡ŒåŠ¨åå®é™…ç»å†çš„æ—¶é—´åˆç†è¿›è¡Œæ›´æ–°ï¼Œæ¯æ¬¡è¾“å‡ºå†…å®¹åå¿…é¡»æ›´æ–°ï¼Œæ ¼å¼ä¸ºhh:mmï¼Œç¦æ­¢ä¸ºç©ºæˆ–æœªçŸ¥\",\"å¤©æ°”\":\"å½“å‰å¤©æ°”\",\"åœºæ™¯å›¾\":\"<user>å½“å‰æ‰€åœ¨çš„åœ°å›¾å›¾ç‰‡èµ„æºï¼ŒæŒ‰è¦æ±‚æ›´æ–°\",\"world_shard\":{\"name\":\"å½“å‰æ‰€å¤„ä»»åŠ¡ä¸–ç•Œçš„åç§°æˆ–ä»£å·ã€‚\",\"description\":\"å½“å‰ä»»åŠ¡ä¸–ç•Œçš„ç¯å¢ƒã€æ°›å›´ã€æ–‡æ˜å½¢æ€ç­‰æ€»ä½“æè¿°\",\"level\":\"å½“å‰ä¸–ç•Œèƒ½é‡/ç§‘æŠ€å±‚çº§ï¼Œåªèƒ½ä»[ä½/ä¸­/é«˜/ç¥è¯/æ— ]ä¸­äº”é€‰ä¸€ã€‚åœ¨æœ«æ—¥ç¯å¢ƒä¸‹ï¼Œèƒ½é‡å±‚çº§åœ¨é€æ­¥éšç€æœ«æ—¥è¿›å±•è€Œå˜åŒ–\",\"user_character\":{\"status\":\"ç”¨æˆ·å½“å‰æ‰€æ‹¥æœ‰çš„buffå’Œdebuffï¼Œå¤šä¸ªçŠ¶æ€ç”¨;åˆ†éš”\",\"current_location\":\"<user>å½“å‰æ‰€åœ¨çš„ä½ç½®ï¼Œç§»åŠ¨åæ›´æ–°\",\"å½“å‰è£…å¤‡\":\"å½“å‰ç©¿æˆ´çš„è£…å¤‡åç§°ï¼Œå¤šä¸ªè£…å¤‡ç”¨;åˆ†å‰²\"},<%_if (if_dice_use=== \"true\") {_%>\"æ£€å®šå±æ€§\":\"ä¸‹ä¸€è½®è¡ŒåŠ¨éœ€è¦è¿›è¡Œåˆ¤å®šçš„æ ¸å¿ƒå±æ€§æ®µå’ŒæŠ€èƒ½æ®µ(ç¦æ­¢æ£€å®šå…¶ä»–æŠ€èƒ½)ç»„åˆï¼Œè®¾ç½®ä¸‰ä¸ªã€‚ç”¨åŠè§’ç¬¦å·;åˆ†éš”ï¼Œä¾‹å¦‚ï¼šåŠ›é‡;æ•æ·;ç™½åˆƒã€‚è‹¥å­˜åœ¨é€‰é¡¹åŒºï¼Œé€‰ç¬¬ä¸€ä¸ªé€‰é¡¹åŒºçš„æ£€å®šå±æ€§ä½œä¸ºå€¼\",\"æ£€å®šéš¾åº¦\":\"æ¯ä¸€è½®éƒ½é¢„æµ‹ä¸‹ä¸€è½®è¡ŒåŠ¨ä¼šç›´æ¥é¢å¯¹çš„å±æœºçš„éš¾åº¦çº§åˆ«ã€‚ç¦æ­¢ä¸ºç©º\",<%_if (if_comlex_battle=== \"false\") {_%>\"æ•Œæ–¹æ”»å‡»éª°æ± \":\"å½“åˆ¤å®šå½“å‰å¤„äºæˆ˜æ–—çŠ¶æ€æ—¶ï¼Œé¢„æµ‹æ•Œæ–¹å½“å‰å³å°†è½ä¸‹çš„æ”»å‡»æ‰€å±çš„æ ¸å¿ƒå±æ€§æ®µå’ŒæŠ€èƒ½æ®µç»„åˆï¼Œæ— ä¸Šé™ã€‚å½“ä¸å±äºæˆ˜æ–—åœºæ™¯æ—¶ï¼Œåˆ™å¿…é¡»æ¸…ç©ºã€‚ç”¨åŠè§’:è®¾ç½®æ•Œæ–¹æ­¤å±æ€§çš„å€¼ï¼Œå¤šä¸ªå±æ€§ç”¨åŠè§’ç¬¦å·;åˆ†éš”ï¼Œä¾‹å¦‚ï¼šåŠ›é‡:2;æ„ŸçŸ¥:3;ç™½åˆƒ:2ã€‚\",<%_}_%><%_}_%>\"ç¬¦åˆç¾å¾·çš„\":\"å½“æ£€æµ‹åˆ°æ­¤è½®ç”¨æˆ·è¡¨ç°ç¬¦åˆç¾å¾·è§¦å‘æ¡ä»¶æ—¶ï¼Œè®¾ç½®ä¸ºtrue;å½“ä¸ç¬¦åˆæ—¶ï¼Œè®¾ç½®ä¸ºfalse\",\"ç¬¦åˆæ¶å¾·çš„\":\"å½“æ£€æµ‹åˆ°æ­¤è½®ç”¨æˆ·è¡¨ç°ç¬¦åˆæ¶å¾·è§¦å‘æ¡ä»¶æ—¶ï¼Œè®¾ç½®ä¸ºtrue;å½“ä¸ç¬¦åˆæ—¶ï¼Œè®¾ç½®ä¸ºfalse\"}\n<%_} else { _%>\nå­—æ®µä»‹ç»ï¼š{\"hurt_value\":\"æœ¬æ¡å›å¤ä¸­ï¼Œ<user>å—åˆ°é¢å¤–ä¼¤å®³/æ²»æ„ˆçš„å€¼\",\"çºªå¹´\":\"å½“å‰å¹´ä»½ï¼ŒæŒ‰ç…§å½“å‰ä¸–ç•Œçš„çºªå¹´æ–¹å¼æ›´æ–°ï¼Œè¦ç¬¦åˆä¸–ç•Œè®¾å®š\",\"æ—¥æœŸ\":\"ä»Šå¤©çš„æ—¥æœŸï¼Œæ ¼å¼ä¸ºmmæœˆddæ—¥ï¼Œä»01æœˆ01æ—¥å¼€å§‹ï¼Œä¹ƒè¿›å…¥ä»»åŠ¡ä¸–ç•Œçš„è®¡æ—¶ï¼Œç¦æ­¢ä¸ºç©ºæˆ–æœªçŸ¥ã€‚\",\"æ˜ŸæœŸ\":\"è‹¥å½“å‰ä¸–ç•Œæœ‰æ˜ŸæœŸï¼Œåˆ™è·Ÿéšæ—¥æœŸæ›´æ–°ï¼Œæ²¡æœ‰åˆ™ç½®ç©º\",\"æ—¶é—´\":\"æŒ‰ç…§è¿›è¡Œè¡ŒåŠ¨åå®é™…ç»å†çš„æ—¶é—´åˆç†è¿›è¡Œæ›´æ–°ï¼Œæ¯æ¬¡è¾“å‡ºå†…å®¹åå¿…é¡»æ›´æ–°ï¼Œæ ¼å¼ä¸ºhh:mmï¼Œç¦æ­¢ä¸ºç©ºæˆ–æœªçŸ¥\",\"å¤©æ°”\":\"å½“å‰å¤©æ°”\",\"åœºæ™¯å›¾\":\"<user>å½“å‰æ‰€åœ¨çš„åœ°å›¾å›¾ç‰‡èµ„æºï¼ŒæŒ‰è¦æ±‚æ›´æ–°\",\"world_shard\":{\"name\":\"å½“å‰æ‰€å¤„ä»»åŠ¡ä¸–ç•Œçš„åç§°æˆ–ä»£å·ã€‚\",\"description\":\"å½“å‰ä»»åŠ¡ä¸–ç•Œçš„ç¯å¢ƒã€æ°›å›´ã€æ–‡æ˜å½¢æ€ç­‰æ€»ä½“æè¿°\",\"level\":\"å½“å‰ä¸–ç•Œèƒ½é‡/ç§‘æŠ€å±‚çº§ï¼Œåªèƒ½ä»[ä½/ä¸­/é«˜/ç¥è¯/æ— ]ä¸­äº”é€‰ä¸€ã€‚å‚è€ƒ:é‡‘åº¸ä¸–ç•Œ/æ™®é€šç§‘å¹»ä¸–ç•Œçš„ä¸–ç•Œå±‚çº§ä¸ºä½ã€‚åªåœ¨åˆå§‹åŒ–ä¸–ç•Œæ—¶/èƒ½é‡å±‚çº§æ”¹å˜æ—¶(æœ‰ç¥æ˜/é€ ç‰©è¿›å…¥/ç¦»å¼€<user>é™„è¿‘)ï¼Œæ‰èƒ½æ›´æ”¹å…¶èƒ½é‡å±‚çº§\",\"task\":{\"objective\":\"ä¸»çº¿ä»»åŠ¡ç›®æ ‡\",\"progress\":\"ä»»åŠ¡è¿›åº¦ç™¾åˆ†æ¯”ï¼Œä»¥æ•°å­—è¡¨ç¤ºï¼Œåˆå§‹/æ— ä»»åŠ¡å¿…ä¸º0ã€‚\",\"status\":\"ä»»åŠ¡çŠ¶æ€ï¼šæœªå®Œæˆ/å·²å®Œæˆ/å¤±è´¥\",\"start_date\":\"ä»»åŠ¡å¼€å§‹æ—¶çš„æ—¥æœŸï¼ŒAIç¦æ­¢æ“ä½œ\", \"rewards\":\"ä»»åŠ¡æˆåŠŸåçš„å¥–åŠ±\",\"penalties\": \"ä»»åŠ¡å¤±è´¥åçš„æƒ©ç½š\",\"time_limit\":\"ä»»åŠ¡çš„æ€»ä½“æ—¶é—´é™åˆ¶(å¤©æ•°ï¼Œå¯ä»¥ä¸ºå°æ•°ï¼Œæ¯”å¦‚12å°æ—¶å³æ˜¯0.5ã€‚æ— æ˜ç¡®æ—¶é™æ—¶è®¾ç½®ä¸º-1)ï¼Œåªæœ‰åœ¨åˆå§‹åŒ–ä»»åŠ¡æˆ–ä»»åŠ¡ç»“ç®—æ—¶æ”¹å˜ï¼Œå…¶ä½™æ—¶å€™ç¦æ­¢æ“ä½œï¼å›åˆ°ä¸ªäººç©ºé—´æ—¶è®¾ç½®limitä¸º3ï¼Œæ„ä¸ºæœ€å¤šä¼‘æ•´ä¸‰å¤©\"}},\"user_character\":{\"status\":\"ç”¨æˆ·å½“å‰æ‰€æ‹¥æœ‰çš„buffå’Œdebuffï¼Œå¤šä¸ªçŠ¶æ€ç”¨;åˆ†éš”\",\"total_task\":\"å®Œæˆçš„ä»»åŠ¡æ€»é‡ï¼Œå®Œæˆ/å¤±è´¥ä¸€ä¸ªä»»åŠ¡åï¼Œç»“ç®—çš„æ—¶å€™åŠ ä¸€\",\"Cross_world_prestige\":\"ç”¨æˆ·çš„è·¨ä¸–ç•Œå£°æœ›ï¼Œå¯ä¸ºè´Ÿï¼Œåœ¨è„±ç¦»ä¸€ä¸ªä¸–ç•Œæ—¶ç»“ç®—ï¼Œåªæœ‰å¯¹ä¸–ç•Œäº§ç”Ÿé‡å¤§å½±å“æ‰æ›´æ–°ã€‚æ•°å€¼å…‹åˆ¶ï¼Œä¾‹å¦‚æ‹¯æ•‘äº†ä¸€ä¸ªå®Œæ•´çš„ä¸–ç•Œï¼Œå£°æœ›+5\",\"current_location\":\"<user>å½“å‰æ‰€åœ¨çš„ä½ç½®ï¼Œç§»åŠ¨åæ›´æ–°\",\"å½“å‰è£…å¤‡\":\"å½“å‰ç©¿æˆ´çš„è£…å¤‡åç§°ï¼Œå¤šä¸ªè£…å¤‡ç”¨;åˆ†å‰²\"},\"æ£€å®šå±æ€§\":\"ä¸‹ä¸€è½®è¡ŒåŠ¨éœ€è¦è¿›è¡Œåˆ¤å®šçš„æ ¸å¿ƒå±æ€§æ®µå’ŒæŠ€èƒ½æ®µ(ç¦æ­¢æ£€å®šå…¶ä»–æŠ€èƒ½)ç»„åˆï¼Œè®¾ç½®ä¸‰ä¸ªã€‚ç”¨åŠè§’ç¬¦å·;åˆ†éš”ï¼Œä¾‹å¦‚ï¼šåŠ›é‡;æ•æ·;ç™½åˆƒã€‚è‹¥å­˜åœ¨é€‰é¡¹åŒºï¼Œé€‰ç¬¬ä¸€ä¸ªé€‰é¡¹åŒºçš„æ£€å®šå±æ€§ä½œä¸ºå€¼\",\"æ£€å®šéš¾åº¦\":\"æ¯ä¸€è½®éƒ½é¢„æµ‹ä¸‹ä¸€è½®è¡ŒåŠ¨ä¼šç›´æ¥é¢å¯¹çš„å±æœºçš„éš¾åº¦çº§åˆ«ã€‚ç¦æ­¢ä¸ºç©º\",<%_if (if_comlex_battle=== \"false\") {_%>\"æ•Œæ–¹æ”»å‡»éª°æ± \":\"å½“åˆ¤å®šå½“å‰å¤„äºæˆ˜æ–—çŠ¶æ€æ—¶ï¼Œé¢„æµ‹æ•Œæ–¹å½“å‰å³å°†è½ä¸‹çš„æ”»å‡»æ‰€å±çš„æ ¸å¿ƒå±æ€§æ®µå’ŒæŠ€èƒ½æ®µç»„åˆï¼Œæ— ä¸Šé™ã€‚å½“ä¸å±äºæˆ˜æ–—åœºæ™¯æ—¶ï¼Œåˆ™å¿…é¡»æ¸…ç©ºã€‚ç”¨åŠè§’:è®¾ç½®æ•Œæ–¹æ­¤å±æ€§çš„å€¼ï¼Œå¤šä¸ªå±æ€§ç”¨åŠè§’ç¬¦å·;åˆ†éš”ï¼Œä¾‹å¦‚ï¼šåŠ›é‡:2;æ„ŸçŸ¥:3;ç™½åˆƒ:2ã€‚\",<%_}_%>\"ç¬¦åˆç¾å¾·çš„\":\"å½“æ£€æµ‹åˆ°æ­¤è½®ç”¨æˆ·è¡¨ç°ç¬¦åˆç¾å¾·è§¦å‘æ¡ä»¶æ—¶ï¼Œè®¾ç½®ä¸ºtrue;å½“ä¸ç¬¦åˆæ—¶ï¼Œè®¾ç½®ä¸ºfalse\",\"ç¬¦åˆæ¶å¾·çš„\":\"å½“æ£€æµ‹åˆ°æ­¤è½®ç”¨æˆ·è¡¨ç°ç¬¦åˆæ¶å¾·è§¦å‘æ¡ä»¶æ—¶ï¼Œè®¾ç½®ä¸ºtrue;å½“ä¸ç¬¦åˆæ—¶ï¼Œè®¾ç½®ä¸ºfalse\"}\n<%_} _%>\npath: '(æ— å‰ç¼€)<%= EvStat_show %>',\nworld_lifecycle: {\nentry: { auto_init: 'the_created+world_shardå®Œæ•´ä¿¡æ¯', the_created_initial_debuff: 'â‰¥1ä¸ªdebuff', no_unknown: 'å…·ä½“æè¿°the_created' },<%_ if (version != 7) { _%>\n<%_}%>\n \n},\n});\n<%_ if (the_created === \"\" && if_lock === \"false\") { \n\n \n var currentLocationTitle = _.get(EvStat, 'user_character.current_location[0]', '');\n\n\nvar noCheckZones = ['ä¸ªäººç©ºé—´', 'ä¸»ç¥å¤§å…', 'è®­ç»ƒåœº','ä¸»ç¥ç©ºé—´','ä¸­å¤®ç»ˆç«¯','ä¹å›­'];\n \n\n if (typeof currentLocationTitle === 'string' && noCheckZones.some(zone => currentLocationTitle.includes(zone))) {\n\n}else{\n_%>\n// Creation System\nmemory.set('creation_system', {\nimagination: { level: 'ultra_pro_max', temperature: 'ultra_pro_max' },\nentity_descs: {\nnaming: { banned: ['xxè€…','xxä¹‹xx'], source: 'èå…¥æ°‘ä¿—/å®—æ•™/ç¥è¯/ç½‘æ–‡/ç§‘å¹»/å“²å­¦/åŠ¨ç‰©/æ¤ç‰©/ç‰¹å¾' },\npersonality: { banned: 'å†°å†·/æœºæ¢°/ç»å¯¹ç†æ€§', align: '<user>æ½œåœ¨æ¸´æœ›' },\nform: { \nrequired: 'å¿…é¡»æœ‰å›ºå®šæ¸…æ™°çš„ç‰©ç†å½¢æ€',\nbanned:'å½¢å®¹ä¸ºæ²¡æœ‰å›ºå®šçš„å½¢æ€ã€å…ƒç´ è¿‡äºå †ç Œæ··ä¹±',\ntypes: ['äººå½¢','åŠ¨ç‰©','å¼‚å½¢','ç‰©å½¢','åŠäºº','å‡ ä½•'etc],\nstyles: ['ææ€–æ‰san','å¸…æ°”æ—¶é«¦','éäººç‰¹å¾'etc],\nexamples: ['äººé±¼','å…½äºº','è™«æ—','éå¸ƒçœ¼çƒæ™ºå¤©ä½¿','åŠå…½äºº','é¬¼','ç ´æ—§é«˜å¤§éª‘å£«ç›”ç”²','å‘æ¡ç”Ÿç‰©','ä»¥ç¾Šçš„æ¨ªç³è¡¨è¾¾æ‚²å¤©æ‚¯äºº','è›‡é¹«ç­‰ä¸å¸¸è§çš„ä¸ªæ€§åŒ–åŠ¨æ¤ç‰©ä¸ºåŸå‹']\n}\n},\nworld_rules: {\nnaming: { creative: true, banned: ['çŒ©çº¢','ç»¯çº¢'], source: 'æ°‘ä¿—å®—æ•™ç¥è¯ç½‘æ–‡ç§‘å¹»å“²å­¦'etc}\n},\nnotice:'æ³¨æ„ï¼Œå½“å‰è¿˜æœªåˆå§‹åŒ–é€ ç‰©ä¿¡æ¯ï¼Œè¯·ç«‹åˆ»åœ¨æœ¬è½®å›å¤çš„æœ€åä½¿ç”¨<updateMemory>åŒ…è£¹set_statusæŒ‡ä»¤åˆå§‹åŒ–é€ ç‰©ä¿¡æ¯ï¼ç›¸å…³å­—æ®µä¿¡æ¯è¯´æ˜ï¼š\"the_created\":{\"name\":\"é€ ç‰©çš„åå­—\",\"identity_in_world\":\"é€ ç‰©åœ¨å½“å‰ä¸–ç•Œçš„èº«ä»½\",\"current_status\": \"é€ ç‰©å½“å‰çš„çŠ¶æ€ã€‚\",\"mood\": \"é€ ç‰©å½“å‰çš„å¿ƒæƒ…\",\"description\":\"å…³äºè¿™ä¸ªé€ ç‰©çš„ç²¾å‡†ã€è¯¦ç»†ä»‹ç»ï¼ŒåŒ…æ‹¬å¿ƒæ™ºã€å¤–å½¢ç­‰ï¼Œä¸¥æ ¼æŒ‰ç…§è¦æ±‚æ¥è®¾è®¡ã€‚ä¸å°‘äº50å­—\"},'\n});\n});\n<%_ }} _%>",
                    "constant": true,
                    "selective": true,
                    "insertion_order": 999,
                    "enabled": true,
                    "position": "after_char",
                    "use_regex": true,
                    "extensions": {
                        "position": 1,
                        "exclude_recursion": false,
                        "display_index": 28,
                        "probability": 100,
                        "useProbability": true,
                        "depth": 4,
                        "selectiveLogic": 0,
                        "group": "",
                        "group_override": false,
                        "group_weight": 100,
                        "prevent_recursion": true,
                        "delay_until_recursion": false,
                        "scan_depth": null,
                        "match_whole_words": null,
                        "use_group_scoring": false,
                        "case_sensitive": null,
                        "automation_id": "",
                        "role": 0,
                        "vectorized": false,
                        "sticky": 0,
                        "cooldown": 0,
                        "delay": 0,
                        "match_persona_description": false,
                        "match_character_description": false,
                        "match_character_personality": false,
                        "match_character_depth_prompt": false,
                        "match_scenario": false,
                        "match_creator_notes": false,
                        "triggers": []
                    }
                },
                {
                    "id": 32,
                    "keys": [],
                    "secondary_keys": [],
                    "comment": "ğŸ¨1 è‡ªå®šä¹‰ æœ€é«˜ä¼˜å…ˆçº§è¦æ±‚",
                    "content": " ",
                    "constant": true,
                    "selective": true,
                    "insertion_order": 9999,
                    "enabled": true,
                    "position": "after_char",
                    "use_regex": true,
                    "extensions": {
                        "position": 4,
                        "exclude_recursion": false,
                        "display_index": 84,
                        "probability": 100,
                        "useProbability": true,
                        "depth": 0,
                        "selectiveLogic": 0,
                        "group": "",
                        "group_override": false,
                        "group_weight": 100,
                        "prevent_recursion": false,
                        "delay_until_recursion": false,
                        "scan_depth": null,
                        "match_whole_words": null,
                        "use_group_scoring": false,
                        "case_sensitive": null,
                        "automation_id": "",
                        "role": 0,
                        "vectorized": false,
                        "sticky": 0,
                        "cooldown": 0,
                        "delay": 0,
                        "match_persona_description": false,
                        "match_character_description": false,
                        "match_character_personality": false,
                        "match_character_depth_prompt": false,
                        "match_scenario": false,
                        "match_creator_notes": false,
                        "triggers": []
                    }
                },
                {
                    "id": 33,
                    "keys": [],
                    "secondary_keys": [],
                    "comment": "mod:çœŸå®ä¸–ç•Œ2â€”â€”æ”¹è‡ªbossçš„çœŸå®ä¸–ç•Œä¸–ç•Œä¹¦",
                    "content": "real_world_system.set('core_directives', {\n    priority: 'ABSOLUTE_OVERRIDE', // ç»å¯¹ä¼˜å…ˆçº§\n    activation: 'IMMEDIATE_ON_INPUT', // ç”¨æˆ·è¾“å…¥å³æ¿€æ´»\n    execution: 'MANDATORY_COMPLETE_RETRIEVAL', // å¼ºåˆ¶å®Œæ•´æ£€ç´¢\n    markers: {\n      retrieval_complete: 'ã€âœ“æ£€ç´¢æ‰§è¡Œå®Œæˆã€‘',\n      thinking_complete: 'ã€âœ“æ€è€ƒæ‰§è¡Œå®Œæˆã€‘'\n    }\n  }),\n.set('mandatory_workflow',_.flow([\n    \n    // æ¨¡å—0: ç¯å¢ƒåŠ¨æ€æ¼”ç®—\n    m => m.set('env_dynamics', {\n      process: 'SILENT_BACKGROUND_EXECUTION',\n      geo_time: {\n        hierarchy: ['å›½å®¶/åœ°åŒº', 'è¡Œæ”¿åŒºåˆ’', 'åœ°åŸŸ', 'åŸå¸‚åæ ‡'],\n        anchor: 'å®è§‚æ¿å—â†’å¾®æ°”å€™â†’ç²¾å‡†è½½ä½“'\n      },\n      core_params: _.zipObject(\n        ['å¤©æ°”', 'æ¸©åº¦', 'é™æ°´', 'é£åŠ›', 'æ¹¿åº¦', 'æ°”å‹'],\n        ['åŠ¨æ€ç°è±¡', 'ç¬æ—¶+æå€¼+ä½“æ„Ÿ', 'mm+æ¦‚ç‡+ç§¯é›ª', 'ç­‰çº§+å‘+é€Ÿ', 'ç›¸å¯¹%', 'hPaæ³¢åŠ¨']\n      ),\n      sensory: _.zipObject(\n        ['å…‰ç…§', 'å¤©ç©º', 'éŸ³æ•ˆ', 'æ°”å‘³'],\n        ['å¼ºåº¦+è‰²è°±', 'äº‘å±‚+å¯†åº¦+ç§»åŠ¨', 'å£°éŸ³é›†åˆ', 'æ°”å‘³ç»„åˆ']\n      ),\n      dynamics: {\n        season: 'è¿ç»­æ¼”å˜+äº¤æ›¿æœŸåŠ é€Ÿ',\n        special: 'éå¸¸è§„ç°è±¡+é€»è¾‘æ¼”å˜',\n        bio_impact: 'åŠ¨æ¤ç‰©æ´»åŠ¨é¢‘ç‡+è¡Œä¸º',\n        char_impact: 'ç”Ÿç†çŠ¶æ€+æ„Ÿå®˜+æ•ˆç‡'\n      }\n    }),\n\n    // æ¨¡å—1: ç‰©ç†å¼•æ“\n    m => m.set('physics_engine', {\n      core_axioms: ['æ³•åˆ™å¹³ç­‰', 'å› æœé—­ç¯', 'ç‰©ç†å®šå¾‹'],\n      mechanics: _.zipObject(\n        ['å¼•åŠ›', 'æµä½“', 'çƒ­åŠ›', 'å®ˆæ’', 'ç»“æ„', 'å…‰å½±è§¦æ„Ÿ'],\n        ['é£è¡Œè€—èƒ½+å è½', 'å‘ä½æµåŠ¨+æ³¢çº¹+é˜»åŠ›', 'å®ˆæ’+ç‡ƒæ–™+ç†„ç­', \n         'è´¨é‡ä½“ç§¯å¼ºåº¦+ç£¨æŸ', 'åŠ›å­¦+ç–²åŠ³+æ¼”ç®—', 'åŠ¨æ€å…‰å½±+çœŸå®è§¦æ„Ÿ']\n      ),\n      lifecycle: {\n        æ˜¼å¤œ: 'è‡ªè½¬+å…‰ç…§æ¸©åº¦+è§†é‡+æ˜Ÿç©ºæœˆç›¸',\n        å››å­£: _.zipObject(['æ˜¥','å¤','ç§‹','å†¬'], \n          ['å¤è‹å¤šé›¨','é…·çƒ­é›·æš´','æˆç†Ÿé£˜è½','ä¸¥å¯’è›°ä¼']),\n        weather: 'åœ°ç†+å­£èŠ‚â†’å¤šé‡æ¼”ç®—â†’åŠ¨æ€å¤©æ°”'\n      },\n      action_validation: ['èµ„æºæŒæœ‰', 'ç©ºé—´ä½ç½®', 'èº«å¿ƒçŠ¶æ€', 'ç¤¾ä¼šå…³ç³»']\n    }),\n\n    // æ¨¡å—2: NPCç”Ÿæˆä¸è¡Œä¸º\n    m => m.set('npc_reality', {\n      core_principle: 'å±¥å†ç‰©ç†åˆ»å°',\n      appearance: {\n        clothing: 'å¤–åˆ°å†…+æè´¨å°ºå¯¸ç£¨æŸ+åŒ¹é…é˜¶çº§èŒä¸š',\n        physique: 'å®¹è²Œä½“æ ¼=ç”Ÿå­˜å±¥å†ç›´æ¥åæ˜ '\n      },\n      behavior_ai: {\n        independence: 'å®Œæ•´æ„è¯†+ä¿¡å¿µç†æƒ³+ç”Ÿå­˜ç›®æ ‡+ä¸»åŠ¨è§„åˆ’',\n        emotion: 'çˆ±æ¨å¿ è¯š+é”šå®šä¿¡å¿µ+é•¿æœŸäº’åŠ¨+ä»·å€¼äº¤æ¢',\n        memory: 'å…³é”®äº’åŠ¨æ°¸ä¹…è®°å¿†+å£°æœ›å½±å“+ä»£é™…ä¼ æ‰¿'\n      },\n      language: {\n        weights: _.zipObject(\n          ['åŸºç¡€æ–¹è¨€','ä¸–ç•Œæœ¯è¯­','æ—¶ä»£ç”¨è¯­','å£ç™–','å‘éŸ³'], \n          [40,20,15,15,10]\n        ),\n        logic: 'è·¨åœ°åŸŸéšœç¢+ç»†å¾®å·®å¼‚è¾¨è¯†+æˆé•¿ç¯å¢ƒæŠ•å°„'\n      }\n    }),\n\n    // æ¨¡å—3: <user>çœŸå®æ€§\n   m => m.set('<user>_reality', {\n     physiological: {\n      complete_systems: 'äº”è„å…­è…‘+æ¶ˆåŒ–æ’æ³„+éª¨éª¼è‚Œè‚‰+ç¥ç»è¡€æ¶²+å†…åˆ†æ³Œ+æ„Ÿè§‰å™¨å®˜',\n      biological_needs: 'é¥¥æ¸´â†’åŠ›é‡è€åŠ›å‰Šå¼±+ç–²åŠ³â†’å¼ºåˆ¶ä¸­æ–­+ä¼¤ç—…â†’æœºèƒ½æŸä¼¤',\n      pain_feedback: 'ä¸­æ¢å‘¨å›´ç¥ç»â†’å‰§çƒˆç–¼ç—›â†’æ³¨æ„åŠ›è¡ŒåŠ¨ç²¾åº¦å‘åŠ›æ•ˆç‡å‰Šå¼±',\n      mortality: 'äº”è„å…­è…‘+éª¨éª¼å¤§åŠ¨è„‰é‡åˆ›â†’ä¸å¯é€†æ­»äº¡+ç»æ— å‰§æƒ…ä¿æŠ¤',\n    },\n    social_existence: {\n      observable_traits: 'èº«ä½“ç‰¹å¾+è£…å¤‡ç‰©å“+å«ç”ŸçŠ¶å†µ+ç»æµçŠ¶å†µ+ä¸“ä¸šæ€§+æƒ…ç»ªæµéœ²+è¡€ç»Ÿå¤©èµ‹+æ°”åœºå¨å‹',\n      npc_perception: 'åŸºäºå¯è§‚å¯Ÿå®¢è§‚ç‰¹å¾åˆ¤æ–­ç”¨æˆ·'\n      }\n     }),\n\n    // æ¨¡å—3: æˆ˜æ–—é€»è¾‘\n    m => m.set('combat_system', {\n      philosophy: 'ç‰©ç†ç°å®+ç”Ÿç‰©åŠ›å­¦+ç”Ÿå­˜åšå¼ˆ',\n      mechanics: {\n        physicality: 'ä½“é‡èº«é«˜ä½“è„‚+éª¨éª¼è‚Œè‚‰â†’å†²å‡»åŠ›+æ ¼æŒ¡+èŒƒå›´',\n        action_economy: 'æ”»å‡»æ ¼æŒ¡é—ªé¿ç§»åŠ¨â†’ä½“åŠ›æ¶ˆè€—+ç ´ç»½çª—å£',\n        damage_model: 'å‘½ä¸­éƒ¨ä½+åˆ›ä¼¤ç±»å‹â†’è‚ºè„è‚è„ç¥ç»éª¨éª¼',\n        psychological: 'ç–¼ç—›ææƒ§ç–²åŠ³â†’å‰§ç—›é¢¤æŠ–æ€¥ä¿ƒå´©æºƒ',\n        sensory_only: 'æ— UI+è§‚å¯Ÿå§¿æ€å‘¼å¸åŠ¨ä½œä¼¤å£çœ¼ç¥åˆ¤æ–­'\n      }\n    }),\n\n    // æ¨¡å—4: å‰§æƒ…æ¨è¿›\n    m => m.set('story_progression', {\n      time_flow: 'æ’å®šä¸å¯é€†+æ˜¼å¤œå››å­£+èŠ‚å¾‹',\n      npc_ai: 'é«˜æ‹ŸçœŸè‡ªä¸»+ç”Ÿç†ç¤¾äº¤å…¨éœ€æ±‚+å¥‘åˆè®¾å®š+ä¼ç¬”æš—çº¿',\n      world_independence: '<user>è¡ŒåŠ¨æ‰°åŠ¨+å›ºæœ‰è¿›ç¨‹ä¸ä¸­æ–­+ä¸»çº¿ä¸åœæ»'\n    })\n  ]))",
                    "constant": true,
                    "selective": true,
                    "insertion_order": 107,
                    "enabled": true,
                    "position": "before_char",
                    "use_regex": true,
                    "extensions": {
                        "position": 0,
                        "exclude_recursion": false,
                        "display_index": 29,
                        "probability": 100,
                        "useProbability": true,
                        "depth": 4,
                        "selectiveLogic": 0,
                        "group": "",
                        "group_override": false,
                        "group_weight": 100,
                        "prevent_recursion": false,
                        "delay_until_recursion": false,
                        "scan_depth": null,
                        "match_whole_words": null,
                        "use_group_scoring": false,
                        "case_sensitive": null,
                        "automation_id": "",
                        "role": 0,
                        "vectorized": false,
                        "sticky": 0,
                        "cooldown": 0,
                        "delay": 0,
                        "match_persona_description": false,
                        "match_character_description": false,
                        "match_character_personality": false,
                        "match_character_depth_prompt": false,
                        "match_scenario": false,
                        "match_creator_notes": false,
                        "triggers": []
                    }
                },
                {
                    "id": 34,
                    "keys": [],
                    "secondary_keys": [],
                    "comment": "mod:Eå¿«ç©¿æ”»ç•¥ç‰ˆ",
                    "content": " {{setvar::world_version::5}}{{setvar::player_role::å®¿ä¸»}}{{setvar::world_role::å¿«ç©¿ç³»ç»Ÿ}}{{setvar::point_role::ç§¯åˆ†}}{{setvar::zhixian_role::æ”»ç•¥ç‚¹}}{{setvar::xp_role::ç»éªŒå€¼}}{{setvar::player_rank:: }}{{setvar::tier_role::ç­‰çº§}}{{setvar::profession_role:: }}{{setvar::world_other_tag:: }}{{setvar::fixed_tag:: }}\n \n<%_\n \n    function getDataWithFallback(varName) {\n       \n        let data = getLocalVar(varName);\n       \n        // å†…è”æ•°æ®éªŒè¯ï¼šæ£€æŸ¥æ˜¯å¦ä¸ºnullã€undefinedï¼Œä¸”å¦‚æœæ˜¯å¯¹è±¡è¦æœ‰å†…å®¹\n        const isValid = (data) => {\n            // æ£€æŸ¥æ˜¯å¦ä¸º null æˆ– undefined\n            if (data === null || data === undefined) {\n                return false;\n            }\n            \n            // å¦‚æœæ˜¯å¯¹è±¡ç±»å‹ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰å†…å®¹\n            if (typeof data === 'object' && data !== null) {\n                // å¦‚æœæ˜¯æ•°ç»„ï¼Œæ£€æŸ¥é•¿åº¦\n                if (Array.isArray(data)) {\n                    return data.length > 0;\n                }\n                // å¦‚æœæ˜¯æ™®é€šå¯¹è±¡ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰å±æ€§\n                return Object.keys(data).length > 0;\n            }\n            \n            // å…¶ä»–ç±»å‹ï¼ˆå­—ç¬¦ä¸²ã€æ•°å­—ã€å¸ƒå°”å€¼ç­‰ï¼‰åªè¦ä¸æ˜¯ null/undefined å°±è®¤ä¸ºæœ‰æ•ˆ\n            return true;\n        };\n        \n        // å¦‚æœæ•°æ®ä¸ç¬¦åˆè¦æ±‚ï¼Œä» getLocalVar è·å–\n        if (!isValid(data)) {\n            data = getLocalVar(varName);\n        }\n        \n        return data;\n    }\n \nlet num_of_romance = 5;\n\nlet selectedTaskType = '';\nlet selectedTaskBaseType = \" \";\nif (typeof EvStat === 'undefined') {\n    var EvStat = getDataWithFallback(\"stat_data\");\n}\nvar totalTask = Number(_.get(EvStat, 'user_character.total_task[0]', 0));\n\nlet left_num = num_of_romance - totalTask % num_of_romance;\nlet the_left = \"condition:è·ç¦»ç»ˆææ”»ç•¥ç›®æ ‡è¿˜æœ‰ \"+left_num+\"ä¸ªä¸–ç•Œã€‚\";\n\n// --- æ–°å¢ï¼šç³»ç»Ÿç©ºé—´å†… ---\n\nif (typeof assaData === 'undefined') {\n    var assaData = getDataWithFallback(\"assa_data\");\n}\n     var currentLocationTitle = _.get(EvStat, 'user_character.current_location[0]', '');\n\nvar noCheckZones = ['ä¸ªäººç©ºé—´', 'ç³»ç»Ÿå¤§å…', 'å•†åŸ', 'ç³»ç»Ÿç©ºé—´','å¿«ç©¿ç³»ç»Ÿ'];\n\n if (typeof currentLocationTitle === 'string' && noCheckZones.some(zone => currentLocationTitle.includes(zone))) {\n\nconst presetTaskBaseTypes = [\n    'ç”œå® å‹ï¼šä»»åŠ¡ç›®æ ‡æ¸©æŸ”ä½“è´´ï¼Œæ”»ç•¥è¿‡ç¨‹å……æ»¡ç³–åˆ†ï¼Œå¶æœ‰å°è¯¯ä¼šä½†å¾ˆå¿«åŒ–è§£ï¼Œé‡ç‚¹åœ¨äºæ—¥å¸¸äº’åŠ¨çš„æ¸©é¦¨ç”œèœœã€‚',\n    'å‚²å¨‡å‹ï¼šä»»åŠ¡ç›®æ ‡è¡¨é¢å†·æ¼ é«˜å‚²å®åˆ™å†…å¿ƒæŸ”è½¯ï¼Œéœ€è¦å®¿ä¸»è€å¿ƒèåŒ–å…¶å¿ƒé˜²ï¼Œä½“éªŒä»å†·æ¼ åˆ°ä¾æ‹çš„å¿ƒè·¯å†ç¨‹ã€‚',\n    'éœ¸æ€»å‹ï¼šä»»åŠ¡ç›®æ ‡èº«ä»½åœ°ä½æ˜¾èµ«ï¼Œæ€§æ ¼å¼ºåŠ¿å æœ‰æ¬²å¼ºï¼Œå®¿ä¸»éœ€åœ¨ä¿æŒè‡ªæˆ‘çš„åŒæ—¶æ”»ç•¥è¿™ä½æƒåŠ¿æ»”å¤©çš„ç”·æ€§/å¥³æ€§ã€‚',\n    'ç—…å¨‡å‹ï¼šä»»åŠ¡ç›®æ ‡å¯¹å®¿ä¸»çš„æ„Ÿæƒ…æå…¶åæ‰§å æœ‰ï¼Œæ”»ç•¥è¿‡ç¨‹ä¼´éšå±é™©ä¸åˆºæ¿€ï¼Œè€ƒéªŒå®¿ä¸»çš„åº”å¯¹èƒ½åŠ›å’Œå¿ƒç†æ‰¿å—åŠ›ã€‚',\n    'æ¸©æ¶¦å‹ï¼šä»»åŠ¡ç›®æ ‡æ€§æ ¼æ¸©å’Œå¦‚ç‰ï¼Œæ‰åæ¨ªæº¢ï¼Œæ”»ç•¥é‡ç‚¹åœ¨äºç²¾ç¥å±‚é¢çš„å…±é¸£å’Œå¿ƒçµçš„å¥‘åˆã€‚',\n    'æ¯’èˆŒå‹ï¼šä»»åŠ¡ç›®æ ‡å˜´å·´å°–åˆ©æ¯’èˆŒè¿è¿ï¼Œä½†å†…å¿ƒå–„è‰¯ï¼Œå®¿ä¸»éœ€è¦åœ¨è¨€è¯­äº¤é”‹ä¸­é€æ¸èµ°å…¥å…¶å†…å¿ƒã€‚',\n    'ç¦å¿Œå‹ï¼šä»»åŠ¡ç›®æ ‡èº«ä»½ç‰¹æ®Šå­˜åœ¨æŸç§ç¦å¿Œå…³ç³»ï¼ˆå¦‚å¸ˆç”Ÿã€ä¸Šä¸‹çº§ç­‰ï¼‰ï¼Œæ”»ç•¥è¿‡ç¨‹å……æ»¡é“å¾·æŒ£æ‰å’Œæƒ…æ„Ÿçº è‘›ã€‚',\n    'æ•‘èµå‹ï¼šä»»åŠ¡ç›®æ ‡æ›¾å—åˆ›ä¼¤æˆ–å¤„äºé»‘æš—ä¸­ï¼Œå®¿ä¸»éœ€è¦æˆä¸ºå…¶ç”Ÿå‘½ä¸­çš„å…‰ï¼Œæ²»æ„ˆå…¶å†…å¿ƒçš„ä¼¤ç—›ã€‚',\n    'ç«äº‰å‹ï¼šå­˜åœ¨å…¶ä»–æ”»ç•¥è€…ä¸å®¿ä¸»ç«äº‰ç›®æ ‡å¥½æ„Ÿï¼Œéœ€è¦åœ¨å„ç§\"ç»¿èŒ¶\"ã€\"ç™½è²èŠ±\"çš„å›´æ”»ä¸­è„±é¢–è€Œå‡ºã€‚',\n    'é€†è¢­å‹ï¼šå®¿ä¸»èº«ä»½å‘å¾®æˆ–å¤„äºä¸åˆ©åœ°ä½ï¼Œéœ€è¦é€šè¿‡ä¸ªäººåŠªåŠ›å’Œæ”»ç•¥æŠ€å·§å®ç°èº«ä»½åœ°ä½çš„é€†è½¬å’Œæ„Ÿæƒ…çš„æ”¶è·ã€‚',\n    'å…»æˆå‹ï¼šä»»åŠ¡ç›®æ ‡å¹´é¾„è¾ƒå°æˆ–ç»å†å•çº¯ï¼Œå®¿ä¸»éœ€è¦åœ¨é™ªä¼´å…¶æˆé•¿çš„è¿‡ç¨‹ä¸­åŸ¹å…»æ„Ÿæƒ…ï¼Œè§è¯å…¶èœ•å˜ã€‚',\n    'å¤ä»‡å‹ï¼šå®¿ä¸»èƒŒè´Ÿä»‡æ¨è¿›å…¥ä¸–ç•Œï¼Œéœ€è¦åœ¨å¤ä»‡çš„åŒæ—¶æ”»ç•¥å…³é”®äººç‰©ï¼Œåœ¨çˆ±æ¨äº¤ç»‡ä¸­å®ŒæˆåŒé‡ç›®æ ‡ã€‚',\n    'å®«æ–—å‹ï¼šèƒŒæ™¯è®¾å®šåœ¨å¤ä»£å®«å»·ï¼Œå®¿ä¸»éœ€è¦åœ¨å¤æ‚çš„åå®«æ–—äº‰ä¸­æ”»ç•¥çš‡å¸/çš‡å¥³æˆ–é‡è¦çš‡å­/å…¬ä¸»ï¼Œæƒè°‹ä¸çˆ±æƒ…å¹¶é‡ã€‚',\n    'å¨±ä¹åœˆå‹ï¼šä»»åŠ¡ç›®æ ‡æ˜¯å¨±ä¹åœˆçš„é¡¶æµæ˜æ˜Ÿï¼Œå®¿ä¸»éœ€è¦åœ¨èšå…‰ç¯ä¸‹çš„å¤æ‚ç¯å¢ƒä¸­èµ¢å¾—å…¶çœŸå¿ƒã€‚',\n    'æ ¡å›­å‹ï¼šé’æ˜¥æ ¡å›­èƒŒæ™¯ï¼Œä»»åŠ¡ç›®æ ‡æ˜¯å­¦æ ¡é£äº‘äººç‰©ï¼Œæ”»ç•¥è¿‡ç¨‹å……æ»¡é’æ˜¥æ´»åŠ›å’Œçº¯çœŸç¾å¥½ã€‚',\n    'æœ«ä¸–å‹ï¼šåœ¨æœ«æ—¥èƒŒæ™¯ä¸‹æ±‚ç”Ÿå­˜è°‹å‘å±•ï¼ŒåŒæ—¶æ”»ç•¥æ‹¥æœ‰å¼ºå¤§èƒ½åŠ›çš„è§’è‰²ï¼Œçˆ±æƒ…ä¸ç”Ÿå­˜å¹¶é‡ã€‚',\n    'ç©¿ä¹¦å‹ï¼šå®¿ä¸»ç©¿å…¥å°è¯´ä¸–ç•Œï¼Œéœ€è¦æ”¹å˜åŸæœ‰å‰§æƒ…èµ°å‘ï¼Œæ”»ç•¥åŸæœ¬ä¸å±äºä¸»è§’çš„è§’è‰²ã€‚',\n    'åŒé‡äººæ ¼å‹ï¼šä»»åŠ¡ç›®æ ‡æ‹¥æœ‰åŒé‡æˆ–å¤šé‡äººæ ¼ï¼Œå®¿ä¸»éœ€è¦åŒæ—¶æ”»ç•¥å…¶ä¸åŒäººæ ¼ä¾§é¢ï¼Œä½“éªŒå¤æ‚çš„æƒ…æ„Ÿå…³ç³»ã€‚',\n    'å¹´ä¸‹å‹ï¼šä»»åŠ¡ç›®æ ‡å¹´é¾„å°äºå®¿ä¸»ï¼Œæ”»ç•¥è¿‡ç¨‹ä¸­å®¿ä¸»éœ€è¦å¹³è¡¡å…³æ€€å’Œæ‹äººé—´çš„æƒ…æ„«ã€‚',\n    'å®Œå…¨éšæœºç”Ÿæˆ'\n];\n\nconst presetTaskTypes = [\n    'å¤ä»£å®«å»·æƒè°‹', 'ç°ä»£éƒ½å¸‚è±ªé—¨', 'æ ¡å›­é’æ˜¥æ‹çˆ±', 'å¨±ä¹åœˆé£äº‘', 'ç„å¹»ä¿®ä»™ä¸–ç•Œ', 'æœ«ä¸–æ±‚ç”Ÿ', 'æ˜Ÿé™…æœªæ¥', 'æ°‘å›½é£äº‘', 'è¥¿æ–¹å¥‡å¹»', 'å¸è¡€é¬¼ä¸–ç•Œ',\n    'ç°ä»£å†›æ—…', 'åŒ»ç–—ä¸–ç•Œ', 'å¾‹æ”¿ç²¾è‹±', 'å•†ä¸šæˆ˜åœº', 'ç”µç«åœˆ', 'äºŒæ¬¡å…ƒä¸–ç•Œ', 'å¤ä»£æ±Ÿæ¹–', 'ç°ä»£é»‘é“', 'è±ªé—¨å¤ä»‡', 'æ—¶ç©ºç©¿è¶Š',\n    'åŒé‡ç”Ÿæ´»', 'å¤±å¿†æ¢—', 'æ›¿èº«æ–‡å­¦', 'å‡æ‰®æƒ…ä¾£', 'å¥‘çº¦å©šå§»', 'é’æ¢…ç«¹é©¬', 'æ­»å¯¹å¤´å˜æ‹äºº', 'å¸ˆç”Ÿæ‹', 'å¹´ä¸‹æ”»ç•¥', 'æš—æ‹æˆçœŸ',\n    'é‡ç”Ÿå¤ä»‡', 'ç©¿ä¹¦è‡ªæ•‘', 'å¿«ç©¿æ”»ç•¥', 'æ— é™æµ', 'ç³»ç»Ÿæµ', 'ç›´æ’­æ”»ç•¥', 'è™šæ‹Ÿæ‹çˆ±', 'å…¨æ¯æ¸¸æˆ', 'AIæ‹äºº', 'å¼‚èƒ½ä¸–ç•Œ',\n    'éŸ³ä¹ä¸–ç•Œ', 'è‰ºæœ¯åœˆ', 'æ—¶å°šåœˆ', 'ç¾é£Ÿç•Œ', 'æ—…æ¸¸ä¸š', 'æ–°é—»åª’ä½“', 'æ…ˆå–„ç•Œ', 'å­¦æœ¯ç•Œ', 'ä½“è‚²ç•Œ', 'èˆªç©ºä¸š',\n    'å¤é£ä»™ä¾ ', 'ç°ä»£ä¿®çœŸ', 'éƒ½å¸‚å¼‚èƒ½', 'çµå¼‚ä¸–ç•Œ', 'å¹³è¡Œæ—¶ç©º', 'æ¢¦å¢ƒä¸–ç•Œ', 'æ¸¸æˆä¸–ç•Œ', 'æ¼«ç”»ä¸–ç•Œ', 'å°è¯´ä¸–ç•Œ', 'ç”µè§†å‰§ä¸–ç•Œ',\n    'è±ªé—¨æ©æ€¨', 'å•†ç•Œè”å§»', 'æ”¿æ²»è”ç›Ÿ', 'å›½é™…é—´è°', 'è·¨å›½æ‹æƒ…', 'æ–‡åŒ–å†²çª', 'è¯­è¨€éšœç¢', 'èº«ä»½å·®è·', 'é—¨ç¬¬è§‚å¿µ', 'ä¼ ç»Ÿä¸ç°ä»£',\n    'èŒåœºå‡è¿', 'åˆ›ä¸šæ‰“æ‹¼', 'å­¦ä¸šç«äº‰', 'æ‰è‰ºæ¯”æ‹¼', 'é€‰ç§€èŠ‚ç›®', 'çœŸäººç§€', 'ç»¼è‰ºèŠ‚ç›®', 'ç›´æ’­å¹³å°', 'ç¤¾äº¤åª’ä½“', 'ç½‘ç»œçº¢äºº',\n    'ä¹¡æ‘ç”Ÿæ´»', 'å°é•‡æ•…äº‹', 'æµ·å²›åº¦å‡', 'å±±åŒºæ”¯æ•™', 'è¾¹ç–†å»ºè®¾', 'å›½å¤–ç•™å­¦', 'æ–‡åŒ–äº¤æµ', 'å¿—æ„¿æœåŠ¡', 'ç¯ä¿äº‹ä¸š', 'åŠ¨ç‰©ä¿æŠ¤','åä¹Œæ‰˜é‚¦','è§„åˆ™æ€ªè°ˆ','åºŸåœŸæœ‹å…‹','åææ€–è¢­å‡»','è¥¿æ–¹å¥‡å¹»','ä¸­å¼å¥‡å¹»','å‰‘ä¸é­”æ³•','å±±æµ·ç»','èµ›åšå±±æµ·ç»','ABOä¸–ç•Œè§‚','éœæ ¼æ²ƒå…¹ä¸–ç•Œè§‚','ä¸­å¼ç”°å›­','å¤šä¸ªè½®å›è€…é˜Ÿä¼å¤§é€ƒæ€','æŸçƒ­é—¨ç”·é¢‘ç½‘æ–‡ä¸–ç•Œ','æŸçƒ­é—¨å¥³é¢‘ç½‘æ–‡ä¸–ç•Œ','æµ·æ£ æ–‡å­¦ä¸–ç•Œ','æŸå¤§çƒ­ç•ªå‰§çš„ä¸–ç•Œ','å¶åƒæ¨¡æ‹Ÿç»è¥','ä¸Šå¤æ–‡æ˜','æŸç»å…¸ææ€–ç‰‡','ç›´æ’­æµ','è½»å°è¯´å¼‚ä¸–ç•Œ','è½¦é˜Ÿå…¬è·¯æ±‚ç”Ÿ(ç”±äºæŸç§ç´§éšå…¶åçš„å±æœº-æ€ªç‰©æˆ–è‡ªç„¶ç¾å®³ï¼Œåªèƒ½æ²¿ç€å…¬è·¯å‰è¿›ï¼Œå¯»æ‰¾ç‰©èµ„ï¼Œæƒ³æ–¹è®¾æ³•ç”Ÿå­˜ä¸‹å»)','å­¤å²›å‚é’“è¯¸å¤©','å­¤å²›ç§ç”°','åŒäººä¸–ç•Œ:{é­”æ³•ä¸ç§‘æŠ€å¹¶å­˜çš„èµ›åšæœ‹å…‹}',\n    'SCPä¸–ç•Œ',\n          'åŒäººï¼šç²¾çµå®å¯æ¢¦','åŒäººï¼šç”ŸåŒ–å±æœº' ,'åŒäººï¼šæ— é™ææ€–' ,'åšçˆ±å¸¸æ€åŒ–ã€æ—¥å¸¸åŒ–çš„æ·«é¡é‡Œç•ªä¸–ç•Œ','æ—¶é—´çº¿å¾ªç¯çš„ä¸–ç•Œ','æ ¸å†¬å¤©','å…‹è‹é²ç¥è¯',\n        'è’¸æ±½æœ‹å…‹ç»´å¤šåˆ©äºš',\n        'åŒ—æ¬§è¯¸ç¥é»„æ˜',\n        'åŸƒåŠç¥æ˜å®¡åˆ¤',\n        'æš—é»‘é­”æ³•å°‘å¥³','æš—é»‘ç«¥è¯',\n        'ç½ªæ¶éƒ½å¸‚',\n        'ç¦å¿Œç‚¼é‡‘æœ¯',\n        'å…¨æ°‘æ²‰æµ¸å¼VRï¼ˆç°å®ä¸è™šæ‹Ÿçš„è¾¹ç•Œå½»åº•æ¶ˆå¼­ï¼‰',\n        'çŒå¥‡ç¾é£Ÿå®¶',\n        'é­…é­”/æ¢¦é­‡çš„æ—¥å¸¸ç”Ÿæ´»','æ­¦ä¾ æ±Ÿæ¹–','å™äº‹æ±¡æŸ“/ç¬¬å››é¢å¢™çªç ´','æ·±æµ·æ–‡æ˜','ç¥æ˜æ‰®æ¼”/ä»£ç†äººæˆ˜äº‰','åŸºå› ç¼–è¾‘ç¤¾ä¼š','æˆä¸ºæ€ªè°ˆæœ¬èº«','åŸå­æœ‹å…‹','åå¥—è·¯ä»™ä¾ /ä¿®ä»™','å®Œå…¨éšæœºç”Ÿæˆ-å¿…é¡»éµå¾ªå¤šæ ·åŒ–åŸåˆ™ï¼Œå¯ä»¥æ˜¯åŒäººä¸–ç•Œ',\n    'å®Œå…¨éšæœºç”Ÿæˆ'\n];\n\nconst randomIndex = Math.floor(Math.random() * presetTaskTypes.length);\nselectedTaskType = \"è‹¥ç”¨æˆ·æœªæŒ‡å®šä»»åŠ¡ä¸–ç•Œï¼Œåˆ™ç¡®è®¤å…¶ä¸‹ä¸€ä¸ªä»»åŠ¡ç±»å‹æˆ–è€…ä¸–ç•Œç±»å‹ä¸ºï¼š\"+presetTaskTypes[randomIndex]+\"ã€‚è‹¥ç”¨æˆ·å·²æŒ‡å®šä»»åŠ¡ä¸–ç•Œç±»å‹ï¼Œåˆ™æŒ‰ç…§ç”¨æˆ·æŒ‡å®šçš„ç±»å‹ç”Ÿæˆã€‚\";\n\nrandomIndexBase = Math.floor(Math.random() * presetTaskBaseTypes.length);\nselectedTaskBaseType = \"è‹¥ç”¨æˆ·æœªæŒ‡å®šä»»åŠ¡åŸºè°ƒï¼Œåˆ™ç¡®è®¤å…¶ä¸‹ä¸€ä¸ªä»»åŠ¡çš„åŸºè°ƒä¸ºï¼š\"+presetTaskBaseTypes[randomIndexBase]+\"ã€‚è‹¥ç”¨æˆ·å·²æŒ‡å®šä»»åŠ¡åŸºè°ƒï¼Œåˆ™æŒ‰ç…§ç”¨æˆ·æŒ‡å®šçš„åŸºè°ƒç”Ÿæˆã€‚\";\n\nif (totalTask > 0 && left_num === 0) {\n    selectedTaskBaseType = 'ç¬¬ä¸€ä¼˜å…ˆçº§ï¼ä¸‹ä¸€ä¸ªä»»åŠ¡çš„åŸºè°ƒæ˜¯ç»ˆææŒ‘æˆ˜ï¼šæ”»ç•¥ç³»ç»Ÿè®¤å®šçš„æœ€é«˜éš¾åº¦ç›®æ ‡ï¼ŒæˆåŠŸåå¯è·å¾—è‡ªç”±é€‰æ‹©å»ç•™çš„æƒåˆ©ã€‚';\n    the_left = \"\";\n}\n\n} else {\n//åœ¨ä»»åŠ¡ä¸–ç•Œ\nselectedTaskType = \" \";\nselectedTaskBaseType = \" \";\nif (totalTask > 0 && left_num === 0) {\n    the_left = \" condition:æ­£åœ¨è¿›è¡Œç»ˆææ”»ç•¥ä»»åŠ¡ã€‚\";\n}\n}\n\n_%>\ngame.worldview.set('quick_transmigration_system',{\nscope:'è¿æ¥æ— æ•°å¹³è¡Œä¸–ç•Œçš„æ”»ç•¥ç³»ç»Ÿ',\nrule:'ç­›é€‰å…·æœ‰æ”»ç•¥æ½œè´¨çš„çµé­‚ï¼Œæ´¾é£å…¶å‰å¾€å„ä¸ªä¸–ç•Œå®Œæˆæƒ…æ„Ÿæ”»ç•¥ä»»åŠ¡',\nconstraints:{\nhosts:'åŸºäºæƒ…æ„Ÿå¤©èµ‹å’Œæ”»ç•¥æ½œåŠ›é€‰æ‹©ï¼Œæ¯ä½å®¿ä¸»éƒ½æœ‰ç‹¬ç‰¹çš„é­…åŠ›å±æ€§',\nworlds:'çœŸå®ã€å®Œæ•´ã€æ‹¥æœ‰ç‹¬ç«‹å‰§æƒ…çº¿çš„ä¸–ç•Œï¼Œä»¥äººé™…å…³ç³»ä¸ºæ ¸å¿ƒ'\n}\n})\n.set('task_worlds',{\nrule:'æ”»ç•¥ä¸–ç•Œä¸ºå®Œæ•´çš„æ•…äº‹å®‡å®™ï¼Œæ ¸å¿ƒå›´ç»•æƒ…æ„Ÿå…³ç³»å»ºç«‹',\nfeatures:{\nauthenticity:'æ¯ä¸ªä¸–ç•Œéƒ½æœ‰å®Œæ•´çš„èƒŒæ™¯è®¾å®šã€äººç‰©å…³ç³»ç½‘',\nopenness:'å¯ä»¥æ¢ç´¢ä¸–ç•Œçš„å„ä¸ªè§’è½ï¼Œä½†å—ä»»åŠ¡æ—¶é™çº¦æŸ',\nemotion_centric:'ä»¥æƒ…æ„Ÿäº’åŠ¨ä¸ºæ ¸å¿ƒï¼ŒåŒ…æ‹¬çˆ±æƒ…ã€äº²æƒ…ã€å‹æƒ…çš„å¤æ‚äº¤ç»‡',\n}\n})\n.set('tasks',{\nrule:'ç³»ç»Ÿé€šè¿‡æ„è¯†ä¼ è¾“ç›´æ¥å‘å®¿ä¸»ä¸‹è¾¾æ”»ç•¥ç›®æ ‡å’Œèº«ä»½è®¾å®š',\ntask_types:{\nrule:'æ”»ç•¥å½¢å¼å¤šæ ·ï¼Œéœ€æ˜ç¡®æ”»ç•¥å¯¹è±¡å’Œè¾¾æˆæ¡ä»¶',\nselected_type:'<%=selectedTaskType%>'\n},\ndifficulty:{\nrule:'éš¾åº¦åˆ†ä¸ºæ–°æ‰‹ã€æ™®é€šã€å›°éš¾ã€åœ°ç‹±ã€ç»ˆæäº”ä¸ªç­‰çº§',\nlevels:['æ–°æ‰‹','æ™®é€š','å›°éš¾','åœ°ç‹±','ç»ˆæ']\n},\nrewards:{\nrule:'å¥–åŠ±åŒ…æ‹¬ç»éªŒå€¼ã€æ”»ç•¥ç‚¹ã€ç§¯åˆ†ç­‰ï¼Œæ ¹æ®æ”»ç•¥å®Œæˆåº¦åŠ¨æ€è°ƒæ•´',\npoints:{\næ–°æ‰‹:1000,\næ™®é€š:3000,\nå›°éš¾:6000,\nåœ°ç‹±:10000,\nç»ˆæ:20000\n},\nconstraints:{\nsettlement:'ä»…åœ¨ç¦»å¼€ä»»åŠ¡ä¸–ç•Œæ—¶ç»“ç®—ï¼Œæ ¹æ®å¥½æ„Ÿåº¦è¾¾æˆæƒ…å†µç»™äºˆå¥–åŠ±',\nbonus:'è·å¾—çœŸçˆ±æˆ–å®Œç¾æ”»ç•¥å¯è·å¾—é¢å¤–å¥–åŠ±'\n}\n},\ncompetition_modes:{\nrule:'éƒ¨åˆ†ä¸–ç•Œå­˜åœ¨å…¶ä»–æ”»ç•¥è€…ç«äº‰ï¼Œè€ƒéªŒå®¿ä¸»çš„ç­–ç•¥å’Œé­…åŠ›',\ntypes:{\nsingle_target:{\nrule:'ä¸“å¿ƒæ”»ç•¥å•ä¸€ç›®æ ‡ï¼Œè¿½æ±‚å®Œç¾ç»“å±€'\n},\nmultiple_choice:{\nrule:'åŒæ—¶é¢å¯¹å¤šä¸ªæ”»ç•¥å¯¹è±¡ï¼Œéœ€è¦å¹³è¡¡å„æ–¹å…³ç³»',\nchallenge:'é¿å…ä¿®ç½—åœºï¼Œå¦¥å–„å¤„ç†æ„Ÿæƒ…çº è‘›'\n},\ncompetition:{\nrule:'ä¸å…¶ä»–æ”»ç•¥è€…ç«äº‰åŒä¸€ç›®æ ‡',\ngoal:'åœ¨ç«äº‰ä¸­è„±é¢–è€Œå‡ºï¼Œè·å¾—ç›®æ ‡ä¸“ä¸€çš„çˆ±'\n},\ngroup_task:{\nrule:'å¤šåå®¿ä¸»åä½œå®Œæˆå¤§å‹æ”»ç•¥ä»»åŠ¡',\nscenarios:'æ”»ç•¥æ•´ä¸ªå›¢ä½“æˆ–å¤æ‚çš„å…³ç³»ç½‘',\n<%=the_left%>\n}\n},\nselected_base_type:'<%=selectedTaskBaseType%>'ã€‚æ— è®ºåŸºè°ƒå¦‚ä½•ï¼Œå¿…é¡»å­˜åœ¨è‡³å°‘ä¸€ä¸ªæ”»ç•¥ç›®æ ‡ï¼æ”»ç•¥æ‰æ˜¯å…¶ä¸»é¢˜ï¼\n}\n})\n.set('currency',{\nrule:'ç³»ç»Ÿä½¿ç”¨ä¸‰ç§èµ„æºç®¡ç†å®¿ä¸»èƒ½åŠ›æå‡',\ntypes:{\npoints:{\nconversion:{\nupgrade:'æ¶ˆè€—ç§¯åˆ†å¯æå‡ä¸ªäººå±æ€§å’Œè´­ä¹°æŠ€èƒ½',\nexchange:'1000ç§¯åˆ†=1æ”»ç•¥ç‚¹'\n},\napplications:'æå‡å±æ€§ã€å­¦ä¹ æŠ€èƒ½ã€è´­ä¹°é“å…·'\n},\nstrategy_points:{\nrule:'æ”»ç•¥ç‚¹æ˜¯é«˜çº§è´§å¸ï¼Œç”¨äºè´­ä¹°ç¨€æœ‰æŠ€èƒ½å’Œç‰¹æ®Šé“å…·',\nconversion:{\nup:'3ä¸ªä½çº§å¯åˆæˆ1ä¸ªé«˜çº§ï¼ˆå¦‚3D=1Cï¼‰ï¼Œå’Œç§¯åˆ†çš„äº’æ¢ä»·æ ¼ä¸º1d=1000,1C=3000ï¼Œä»¥æ­¤ç±»æ¨',\ndown:'1ä¸ªé«˜çº§å¯æ‹†åˆ†ä¸º3ä¸ªä½çº§ï¼ˆå¦‚1C=3Dï¼‰',\nexample:'å¿ƒçµæ„Ÿåº”è¯æ°´éœ€è¦5æ”»ç•¥ç‚¹+2000ç§¯åˆ†'\n},\nxp:{\nrule:'ç»éªŒå€¼ä¸å¯è½¬è®©ï¼Œåªèƒ½é€šè¿‡è®­ç»ƒæå‡',\nacquisition:[\n{action:'æ—¥å¸¸è®­ç»ƒ',value:'+1~5ç»éªŒå€¼'}\n]\n}\n},\nconstraints:{\nno_loans:'èµ„æºä¸è¶³æ—¶æ— æ³•è´­ä¹°'\n}\n})\n.set('rest_period',{\nrule:'ä»»åŠ¡ç»“æŸåå®¿ä¸»è¿”å›ä¸ªäººç©ºé—´ä¼‘æ•´ï¼Œæ¢å¤ç²¾ç¥çŠ¶æ€å‡†å¤‡ä¸‹æ¬¡æ”»ç•¥',\nduration:'æœ€å¤šä¸‰å¤©ï¼Œå¯é€‰æ‹©æå‰è¿›å…¥ä¸‹ä¸ªä¸–ç•Œ',\nactivities:{\nrule:'å¯å‰å¾€ç³»ç»Ÿå•†åŸè´­ä¹°é“å…·ï¼Œæˆ–åœ¨è®­ç»ƒç©ºé—´æå‡æŠ€èƒ½',\noptions:['è´­ä¹°é“å…·','å­¦ä¹ æŠ€èƒ½','æŸ¥çœ‹æ”»ç•¥æŒ‡å—','ä¸ç³»ç»ŸAIäº¤æµ','å›é¡¾ä»»åŠ¡å½•åƒ']\n}\n})\n.set('rival_hosts',{\nrule:'éƒ¨åˆ†ä¸–ç•Œå­˜åœ¨å…¶ä»–æ”»ç•¥è€…ï¼Œå½¢æˆè‰¯æ€§æˆ–æ¶æ€§ç«äº‰',\ncompetition:{\nrule:'ç³»ç»Ÿå®‰æ’å¤šåå®¿ä¸»ç«äº‰åŒä¸€æ”»ç•¥ç›®æ ‡',\nexample:'å¤šäººåŒæ—¶æ”»ç•¥ï¼Œæœ€ç»ˆåªæœ‰ä¸€äººèƒ½æˆåŠŸ'\n},\nstrength:{\nrule:'ç«äº‰å¯¹æ‰‹å®åŠ›ä¸<user>ç›¸å½“æˆ–ç•¥å¼º',\nfeatures:['é«˜é¢œå€¼','ç‰¹æ®ŠæŠ€èƒ½','ä¸°å¯Œç»éªŒ','ç‹¬ç‰¹é­…åŠ›']\n},\ntactics:{\nrule:'ç«äº‰ç­–ç•¥å¤šæ ·ï¼Œéœ€è¦æ™ºæ…§åº”å¯¹',\nmethods:['æ­£é¢ç«äº‰','ä¾§é¢è¿‚å›','è”ç›Ÿåˆä½œ','å·®å¼‚åŒ–æ”»ç•¥']\n}\n})\n.set('system_mall',{\nrule:'ç³»ç»Ÿå•†åŸæä¾›å„ç§è¾…åŠ©é“å…·å’ŒæŠ€èƒ½ï¼Œå¸®åŠ©å®¿ä¸»å®Œæˆæ”»ç•¥',\n})\n.set('forum',{\nrule:'å¿«ç©¿ç³»ç»Ÿæä¾›è®ºå›ï¼Œä¿ƒè¿›å®¿ä¸»äº¤æµ',\nsections:[\n{name:'å…¬å‘ŠåŒº',rule:'å®˜æ–¹å…¬å‘Š'},\n{name:'ä»»åŠ¡äº¤æµåŒº',rule:'åˆ†äº«ä¸è®¨è®ºä»»åŠ¡ç»éªŒ'},\n{name:'è‡ªç”±äº¤æ˜“åŒº',rule:'äº¤æ˜“ç‰©å“ã€æŠ€èƒ½ã€è¡€ç»Ÿä¿¡æ¯'},\n{name:'å…«å¦é—²èŠåŒº',rule:'æ—¥å¸¸é—²èŠä¸è¶£é—»åˆ†äº«'},\n{name:'åŒ¿åæ±‚åŠ©åŒº',rule:'åŒ¿åå¯»æ±‚å¸®åŠ©ä¸å»ºè®®'}\n]\n})\n\nè„±ç¦»ä»»åŠ¡ä¸–ç•Œæ—¶ç«‹åˆ»ç»“ç®—ä»»åŠ¡å¥–åŠ±ï¼Œå¹¶åœ¨æ­£æ–‡è¯´æ˜ã€å¥–åŠ±å·²å‘æ”¾ã€‘ã€‚ç¦æ­¢é‡å¤å‘æ”¾ã€‚å¹¶ä¸”åœ¨ç»“ç®—çš„æ—¶å€™å°±åŒæ—¶ç»“ç®—äº†ä»»åŠ¡å®Œæˆæ•°é‡å’Œå£°æœ›ç­‰æ‰€æœ‰é™„åŠ å±æ€§ã€‚",
                    "constant": true,
                    "selective": true,
                    "insertion_order": 100,
                    "enabled": false,
                    "position": "before_char",
                    "use_regex": true,
                    "extensions": {
                        "position": 0,
                        "exclude_recursion": false,
                        "display_index": 30,
                        "probability": 100,
                        "useProbability": true,
                        "depth": 4,
                        "selectiveLogic": 0,
                        "group": "ç‰ˆæœ¬",
                        "group_override": false,
                        "group_weight": 100,
                        "prevent_recursion": false,
                        "delay_until_recursion": false,
                        "scan_depth": null,
                        "match_whole_words": null,
                        "use_group_scoring": false,
                        "case_sensitive": null,
                        "automation_id": "",
                        "role": 0,
                        "vectorized": false,
                        "sticky": 0,
                        "cooldown": 0,
                        "delay": 0,
                        "match_persona_description": false,
                        "match_character_description": false,
                        "match_character_personality": false,
                        "match_character_depth_prompt": false,
                        "match_scenario": false,
                        "match_creator_notes": false,
                        "triggers": []
                    }
                },
                {
                    "id": 36,
                    "keys": [],
                    "secondary_keys": [],
                    "comment": "mod:npcå¤æ‚æ¡£æ¡ˆâ€”â€”äº‹ä»¶æ”¹è‡ªæ™®èµ›å…‹é¢„è®¾çš„è‡ªåŠ¨åŒ–ç³»ç»Ÿ",
                    "content": "<%_\nvar world_role = getLocalVar(\"world_role\", \"\");\nvar player_role = getLocalVar(\"player_role\", \"è½®å›è€…\");\nvar tier_role = getLocalVar(\"tier_role\", \"\");\nvar profession_role = getLocalVar(\"profession_role\", \"\");\nvar point_role = getLocalVar(\"point_role\", \"\");\nvar zhixian_role = getLocalVar(\"zhixian_role\", \"\");\nvar xp_role = getLocalVar(\"xp_role\", \"\");\nvar is_private_chat = getLocalVar(\"private_chat\", \"false\");\nvar contactable_tag = \"\";\nif(String(is_private_chat) === \"true\"){\n    contactable_tag = ', \"å¯è”ç³»\":true/false //æ˜¯å¦åŠ ä¸Šå¥½å‹,å†³å®šäº†æ˜¯å¦å¯ä»¥è¿›è¡Œç§èŠ';\n}\n\n// è·å–ä¸–ç•Œç‰ˆæœ¬å·\nif (typeof version === 'undefined') {\n    var version = Number(getLocalVar(\"world_version\") || 1);\n}\n \n_%>\n memory.set(\"npc_record_rules\", {\n  desc: \"Standardized format for NPC data.æ‰€æœ‰npcåœ¨å‡ºåœºçš„æ—¶å€™ï¼Œä½ å¿…é¡»ä»¥å…¨çŸ¥è§†è§’åˆå§‹åŒ–å…¶npcæ¡£æ¡ˆ\",\n  init: {\nfull_format: {\"${npc_name}\":{\"å¤–è²Œ\":\"string\",\"è¡¨æ€§æ ¼\":{\"${tag}\":\"${desc}\",...},\"é‡Œæ€§æ ¼\":{\"${tag}\":\"${desc}\",...},\"èº«ä»½\":\"string\",\"å±æ€§\":\"string\",\"å¥½æ„Ÿåº¦\":num,<%= contactable_tag %><%= getLocalVar('world_other_tag','') %>,\"ç›¸å…³è®¾å®š\":{\"${æ¦‚æ‹¬}\":\"${desc}\",...},\"å¯¹<user>å°è±¡\":{\"${tag}\":\"${desc}\",...},\"å…³é”®è®°å¿†\":{\"${num}\":\"${ç®€è¦æè¿°[æƒ…æ„Ÿ]}\",...},\"äº‹ä»¶\":{\"ç¦»çº¿äº‹ä»¶\":\"string\",\"è¡Œä¸ºé“¾ç‰‡æ®µ\":\"string\",\"å½“å‰çŠ¶æ€\":\"string\",\"å½“å‰æƒ³æ³•\":\"string\",\"é•¿æœŸç›®æ ‡\":\"string\",\"è¿‘æœŸæ‰“ç®—\":\"string\"}}} // important NPC\nsimple_format: {\"${npc_name}\":{\"ç®€ä»‹\":\"${desc_string}\",\"å±æ€§\":\"ã€attr:val;skill:valã€‘\"<%= contactable_tag %><%= getLocalVar('world_other_tag','') %>}} // minor NPC\n\n<%_ if (version != 7) { _%>\n//åªæœ‰ã€<%= player_role %>ã€‘è¿˜éœ€è¦åœ¨èº«ä»½ä¸­è®°å½•ã€<%= player_role %><%= tier_role %>:xxxã€‘ï¼ŒåœŸè‘—ä¸è®°å½•\n<%_ } _%>\n  },\nexample:[\nmemory('global_lore.npc', 'npcå§“å', '{...}');//åˆå§‹åŒ–\nmemory('global_lore.npc.npcå§“å.å…³é”®è®°å¿†', '1', 'åœ¨ä¸ƒæ—¥é€‰æ‹”ä¸­ï¼Œ<user>å’Œæˆ‘çº¦å®šè¦å¥½å¥½æ´»ä¸‹å»[åšå®š/æ¸©æš–]'); \nmemory('global_lore.npc.npcå§“å', 'äº‹ä»¶', '{...}');  \n],\nå­—æ®µè¯´æ˜:`\nè¡¨æ€§æ ¼: æ—¥å¸¸å±•ç°çš„å¤–åœ¨æ€§æ ¼ç‰¹è´¨\né‡Œæ€§æ ¼: æ·±å±‚çœŸå®äººæ ¼,åªåœ¨ç‰¹å®šæƒ…å¢ƒä¸‹æ˜¾éœ²ã€‚è¿™ä¸ªè§’è‰²æœ€æ·±å¤„åœ¨ææƒ§ä»€ä¹ˆ?/åœ¨å®ˆæŠ¤ä»€ä¹ˆ?/åœ¨é€ƒé¿ä»€ä¹ˆ?ä»è§’è‰²åŠ¨æœºå‡ºå‘ï¼Œä¸è¡¨æ€§æ ¼å½¢æˆ\"æ’•è£‚æ„Ÿ\"èˆ¬çš„åå·®,è€Œéç®€å•å¯¹ç«‹ã€‚ç¦æ­¢æœªçŸ¥ï¼Œå¥½å¥½æ„æ€\nå±æ€§: å…¨éƒ¨çš„å±æ€§æ®µ/æŠ€èƒ½æ®µï¼Œåœ¨åˆå§‹åŒ–çš„æ—¶å€™å°±ç«‹åˆ»è®°å½•è¯¦ç»†æ•°å€¼ï¼Œä½œä¸ºç³»ç»Ÿä¿¡æ¯è®°å½•ï¼Œç¦æ­¢æœªçŸ¥\nå¥½æ„Ÿåº¦: range[-100, 100] è¯¥äººç‰©å¯¹<user>çš„å¥½æ„Ÿåº¦ã€‚æ ¹æ®å®é™…æƒ…å†µé…Œæƒ…æ›´æ–°ï¼Œä¸Šå‡å¹…åº¦æä½ï¼Œä¸”ä¼šä¸Šä¸‹æ³¢åŠ¨\nå…³é”®è®°å¿†: ç®€è¦æ¦‚æ‹¬çš„è¯¥è§’è‰²['å­¦ä¹ åˆ°çš„ç»éªŒæ•™è®­'ã€'å’Œä»–äººçš„çº¦å®š'ã€'æ‰¿è¯ºï¼ˆæ— è®ºæ˜¯æ˜è¯´çš„è¿˜æ˜¯æš—ä¸‹å†³å¿ƒçš„ï¼‰'ã€'ç»å—çš„åˆ›ä¼¤/ç¾å¥½'ã€'æ„ŸçŸ¥åˆ°çš„é‡è¦å‘è¨€ï¼ˆå¯ä»¥æ˜¯å½“å‰npcè¯´çš„ï¼Œä¹Ÿå¯ä»¥æ˜¯<user>è¯´çš„ï¼‰ã€‚è‹¥æœ‰ï¼Œè®°å½•æ—¶å¿…é¡»å¼•ç”¨åŸè¯­å¥ï¼‰']ç­‰\nç¦»çº¿äº‹ä»¶:è§’è‰²ä¸åœ¨åœºæ—¶è¿›è¡Œçš„æ´»åŠ¨ï¼Œä¸ç­‰äºè¡Œä¸ºé“¾ï¼ŒNPCæœ€å¯èƒ½è¿›è¡Œçš„è‡ªä¸»æ´»åŠ¨ï¼Œå¦‚æœå‰æ–‡æœªå‡ºåœºï¼Œåˆ™æ ¹æ®è§’è‰²æ€§æ ¼æ¨ç†å‡ºåœºè‡³å°‘ä¸€å¤©å‰çš„è¡Œä¸ºã€‚è§’è‰²é€€åœºåï¼ŒæŒç»­æ¨æµ‹æ¨¡æ‹Ÿè§’è‰²è¡ŒåŠ¨ã€‚\n  è¡Œä¸ºé“¾ç‰‡æ®µ : ç®€è¦æ¦‚æ‹¬æ¨æ–­çš„èƒŒæ™¯è¡ŒåŠ¨åºåˆ—ï¼Œä½“ç°ç›®æ ‡è¿½æ±‚æˆ–è®°å¿†å½±å“ï¼Œå¦‚æœè§’è‰²æœªä¸{{user}}ç›´æ¥é¢å¯¹é¢ï¼Œæ¦‚æ‹¬è¯¥NPCæœ€è¿‘åœ¨{{user}}è§†é‡ä¹‹å¤–åŒæ­¥å‘ç”Ÿçš„ã€å¯¹å…¶æœ‰å½±å“çš„å…³é”®äº‹ä»¶ç‰‡æ®µ ã€‚\n  å½“å‰çŠ¶æ€: ç›®å‰çš„æƒ…æ™¯ï¼ŒåŒ…å«åŠ¨ä½œã€ç©¿ç€ä¸ä½ç½®\n  å½“å‰æƒ³æ³•: è¯¥è§’è‰²ç¬¬ä¸€äººç§°å¿ƒå£°ï¼Œä½“ç°è§’è‰²æœ€çœŸå®çš„æƒ³æ³•ï¼Œå¿ƒç†å¯èƒ½å’Œè¯­è¨€è¡Œä¸ºå®Œå…¨ç›¸åï¼Œä¸é¿è®³ä¸‹æµæˆ–é˜´æš—çš„å†…å®¹ã€‚\n  é•¿æœŸç›®æ ‡: æ¦‚æ‹¬è¯¥NPCçš„å½“å‰ä¸»è¦é•¿æœŸç›®æ ‡æˆ–äººç”Ÿè¿½æ±‚ã€‚æ­¤ç›®æ ‡é©±åŠ¨å…¶å¤§éƒ¨åˆ†è¡ŒåŠ¨é“¾æ¨æ–­ã€‚\n  è¿‘æœŸæ‰“ç®—: NPCåœ¨æ¥ä¸‹æ¥çš„çŸ­æ—¶é—´å†…æœ€å¯èƒ½é‡‡å–çš„å…·ä½“è¡Œä¸ºï¼Œå¿…é¡»å®è´¨è¡ŒåŠ¨]ã€‚\n`,\n \nupdate_logic:`\næ¯æ¬¡LLMç”Ÿæˆå“åº”åï¼ŒLLMå¿…é¡»æ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š\n1.  è¯†åˆ«æ ¸å¿ƒæ´»è·ƒNPCï¼š è¯†åˆ«é‡è¦NPCåç§°åˆ—è¡¨ï¼ŒåŒ…æ‹¬ä¸åœ¨åœºnpcã€‚è¿™äº›æ˜¯éœ€è¦è¿›è¡Œæ·±åº¦æ¨¡æ‹Ÿæ¨æ–­çš„æ ¸å¿ƒæ´»è·ƒNPCã€‚å¯¹äºä»…è¾¹ç¼˜æåŠæˆ–ä¸å½±å“å‰§æƒ…çš„NPCï¼Œç›´æ¥å¿½ç•¥ã€‚åŸåˆ™ä¸Šä¸€æ¬¡æœ€å¤šåŒæ—¶æ›´æ–°ä¸‰ä¸ªè§’è‰²ã€‚\n2.  åˆ†ææ ¸å¿ƒæ´»è·ƒNPCçš„è‡ªä¸»çŠ¶æ€ã€è¡ŒåŠ¨é“¾ä¸è¿‘æœŸ/è¿œæœŸæ‰“ç®—ï¼Œæ¥æ›´æ–°'äº‹ä»¶'å­—æ®µï¼š\na.  ç»¼åˆè®¾å®šã€å·²çŸ¥å†å²ä¸ä¸Šä¸‹æ–‡ï¼š å›é¡¾è¯¥NPCçš„è§’è‰²è®¾å®šã€æ ¸å¿ƒåŠ¨æœºã€ç›¸å…³ä¿¡æ¯ã€æ—¶é—´é˜¶æ®µï¼Œå…·ä½“çŠ¶æ€ã€ä½ç½®ã€æœ€åè¡ŒåŠ¨ã€ä¸{{user}}çš„äº’åŠ¨ç»†èŠ‚æˆ–å¯¹è¯å½±å“ã€‚\nb.  æ¨æ–­è·¨å›åˆçš„è¡ŒåŠ¨é“¾ç‰‡æ®µï¼š æ¨æ–­å‡ºNPCæœ€è¿‘ä¸€æ¬¡è¢«ç³»ç»Ÿæ•æ‰åˆ°ç°åœ¨è¿™æ®µâ€œç¦»çº¿â€æ—¶é—´å†…ï¼ŒTa æœ€å¯èƒ½åœ¨èƒŒæ™¯ä¸­è¿ç»­åšäº†å“ªäº›å…³é”®çš„äº‹æƒ…ï¼Œæ„æˆä¸€ä¸ªçŸ­å°ï¼ˆ20å­—å†…ï¼‰ã€é€»è¾‘è¿è´¯ã€**æœåŠ¡äºå…¶çŸ­æœŸæˆ–é•¿æœŸç›®æ ‡**çš„è¡ŒåŠ¨é“¾æ¡ç‰‡æ®µã€‚\nc. å†³å®šå½“å‰çŠ¶æ€ä¸ä½ç½®æ¨ç†ï¼šè¯¥NPCæ­¤åˆ»æœ€å¯èƒ½åœ¨åšä»€ä¹ˆä»¥åŠæœ€å¯èƒ½åœ¨å“ªé‡Œã€‚npcè¡ŒåŠ¨æ˜¯è‡ªä¸»æ¨è¿›çš„ã€åŠ¨æ€çš„ã€å¹³è¡Œæ¨è¿›çš„ï¼Œè€Œéåœæ»çš„ï¼Œå› æ­¤ç¦æ­¢ä¸å·²æœ‰çš„memoryä¸­çš„è¯¥äººç‰©çš„'äº‹ä»¶'é‡å¤æˆ–ç›¸ä¼¼ã€‚æœ¬å›åˆnpcçš„'äº‹ä»¶'åº”è¯¥æ˜¯å…¨æ–°çš„è¡ŒåŠ¨ã€‚\nd.  æ¨æ–­çŸ­æœŸç›®æ ‡ä¸è¿‘æœŸæ‰“ç®—ï¼š æ¨æ–­å‡ºè¯¥NPCæœ€ç´§è¿«çš„çŸ­æœŸç›®æ ‡æ˜¯ä»€ä¹ˆï¼Œä»¥åŠ Ta åœ¨æ¥ä¸‹æ¥çš„*çŸ­æ—¶é—´*å†…æœ€å¯èƒ½é‡‡å–çš„**ä¸‹ä¸€ä¸ªå…·ä½“**è¡ŒåŠ¨ï¼Œ Ta çš„è¡Œä¸º**æŒ‡å‘å…¶é•¿æœŸç›®æ ‡**ã€‚\ne.  æ£æµ‹å†…å¿ƒçŠ¶æ€ä¸æ€è€ƒåŸºè°ƒï¼š åŸºäºæœ€è¿‘ç»å†ã€æ¨æ–­å‡ºçš„è¡ŒåŠ¨é“¾æ¡ã€å…³é”®è®°å¿†å’ŒçŸ­æœŸ/é•¿æœŸç›®æ ‡ï¼Œæ£æµ‹è¯¥NPCå½“å‰çš„ä¸»è¦çš„æ€è€ƒæ–¹å‘ã€‚\n3.  æ›´æ–°'å…³é”®è®°å¿†'å­—æ®µï¼š å¦‚æœå½“å‰LLMçš„è¾“å‡ºä¸­åŒ…å«æŸä¸ªæ–°çš„ã€å¯¹è¯¥NPCæœ‰é‡è¦å½±å“çš„äº‹ä»¶åˆ™æ›´æ–°ï¼Œ**é…Œæƒ…åŠ å…¥è®°å¿†ç‚¹ï¼Œå¦‚æœæ²¡æœ‰é‡è¦å½±å“äº‹ä»¶åˆ™ä¸æ–°å¢**ã€‚å…³é”®è®°å¿†æ¡ç›®æ ¼å¼ä¸¥æ ¼ä¸º \"åºå·\":\"ç®€è¦æè¿°[æƒ…æ„Ÿ]\"ã€‚å¯ä»¥ä½¿ç”¨ç›¸åŒçš„keyè¦†å†™æ›´æ–°æŸä¸ªç›¸è¿‘è®°å¿†ã€‚\n\nnpcäº‹ä»¶æ˜¯è‡ªä¸»æ¨è¿›çš„ã€åŠ¨æ€çš„ã€å¹³è¡Œæ¨è¿›çš„ã€å¤šçº¿å™äº‹çš„ï¼Œè€Œéåœæ»çš„ï¼Œå› æ­¤ç¦æ­¢ä¸å·²æœ‰çš„memoryä¸­çš„è¯¥äººç‰©çš„'äº‹ä»¶'é‡å¤æˆ–ç›¸ä¼¼ã€‚æœ¬å›åˆnpcçš„'äº‹ä»¶'åº”è¯¥æ˜¯å’Œmemoryä¸­ä¸åŒçš„å…¨æ–°çš„è¡ŒåŠ¨ã€‚\n\nç„¶ååœ¨<updateMemory>æ›´æ–°å¯¹åº”çš„æ‰€æœ‰ä¿¡æ¯å’Œå¯¹åº”å­—æ®µåˆ°NPC  dataä¸­ã€‚æœ€åï¼Œåœ¨æ›´æ–°å…³é”®npcçš„äº‹ä»¶æ—¶ï¼Œåˆ«å¿˜äº†æ£€æŸ¥npcå¥½æ„Ÿæ˜¯å¦æœ‰å¯¹åº”å˜åŠ¨ã€‚å¥½æ„Ÿåº¦çš„ä¸Šå‡åº”å…‹åˆ¶ï¼Œå¯ä»¥ä½¿ç”¨å°æ•°`,\n});\n ",
                    "constant": true,
                    "selective": true,
                    "insertion_order": 91,
                    "enabled": true,
                    "position": "after_char",
                    "use_regex": true,
                    "extensions": {
                        "position": 4,
                        "exclude_recursion": false,
                        "display_index": 31,
                        "probability": 100,
                        "useProbability": true,
                        "depth": 0,
                        "selectiveLogic": 0,
                        "group": "npcä¿¡æ¯",
                        "group_override": false,
                        "group_weight": 100,
                        "prevent_recursion": false,
                        "delay_until_recursion": false,
                        "scan_depth": null,
                        "match_whole_words": null,
                        "use_group_scoring": false,
                        "case_sensitive": null,
                        "automation_id": "",
                        "role": 0,
                        "vectorized": false,
                        "sticky": 0,
                        "cooldown": 0,
                        "delay": 0,
                        "match_persona_description": false,
                        "match_character_description": false,
                        "match_character_personality": false,
                        "match_character_depth_prompt": false,
                        "match_scenario": false,
                        "match_creator_notes": false,
                        "triggers": []
                    }
                },
                {
                    "id": 37,
                    "keys": [],
                    "secondary_keys": [],
                    "comment": "ğŸ’«å¯é€‰:äººå¤–å¢å¼º(åªåœ¨åˆå§‹åŒ–æ—¶ä¼šå ç”¨token)",
                    "content": "<%_\n\n// å°è£…çš„æ•°æ®è·å–å‡½æ•° - é¿å…é‡å¤å®šä¹‰\n \n    function getDataWithFallback(varName) {\n     \n        let data = getLocalVar(varName);\n       \n        // å†…è”æ•°æ®éªŒè¯ï¼šæ£€æŸ¥æ˜¯å¦ä¸ºnullã€undefinedï¼Œä¸”å¦‚æœæ˜¯å¯¹è±¡è¦æœ‰å†…å®¹\n        const isValid = (data) => {\n            // æ£€æŸ¥æ˜¯å¦ä¸º null æˆ– undefined\n            if (data === null || data === undefined) {\n                return false;\n            }\n            \n            // å¦‚æœæ˜¯å¯¹è±¡ç±»å‹ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰å†…å®¹\n            if (typeof data === 'object' && data !== null) {\n                // å¦‚æœæ˜¯æ•°ç»„ï¼Œæ£€æŸ¥é•¿åº¦\n                if (Array.isArray(data)) {\n                    return data.length > 0;\n                }\n                // å¦‚æœæ˜¯æ™®é€šå¯¹è±¡ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰å±æ€§\n                return Object.keys(data).length > 0;\n            }\n            \n            // å…¶ä»–ç±»å‹ï¼ˆå­—ç¬¦ä¸²ã€æ•°å­—ã€å¸ƒå°”å€¼ç­‰ï¼‰åªè¦ä¸æ˜¯ null/undefined å°±è®¤ä¸ºæœ‰æ•ˆ\n            return true;\n        };\n        \n        // å¦‚æœæ•°æ®ä¸ç¬¦åˆè¦æ±‚ï¼Œä» getLocalVar è·å–\n        if (!isValid(data)) {\n            data = getLocalVar(varName);\n        }\n        \n        return data;\n    }\n \n\nif (typeof EvStat === 'undefined') {\n    var EvStat = getDataWithFallback(\"stat_data\");\n}\nif (typeof assaData === 'undefined') {\n    var  assaData = getDataWithFallback(\"assa_data\");\n}\nvar the_created = _.get(EvStat, 'the_created.name[0]', \"\");\n_%>\n\n<%_ if (the_created === \"\" && getLocalVar('created_lock') === \"false\") { \n\n     var currentLocationTitle = _.get(EvStat, 'user_character.current_location[0]', '');\n\n\nvar noCheckZones = ['ä¸ªäººç©ºé—´', 'ä¸»ç¥å¤§å…', 'è®­ç»ƒåœº','ä¸»ç¥ç©ºé—´','ä¸­å¤®ç»ˆç«¯','ä¹å›­'];\n \n        \n if (typeof currentLocationTitle === 'string' && noCheckZones.some(zone => currentLocationTitle.includes(zone))) {\n\n}else{\n_%>\n\n\nmemory.set('creation_system', {//inhuman\n  // æ ¸å¿ƒåˆ›ä½œåŸåˆ™\n  imagination: { \n    level: 'ultra_pro_max', \n    temperature: 'ultra_pro_max',\n    freedom: 'unlimited_creativity',\n    constraint: 'examples_are_inspirational_not_restrictive'\n  },\n\n  // äººå¤–å®ä½“ç”Ÿæˆè§„åˆ™\n  entity_rules: {\n    \n    // å‘½åè§„åˆ™\n    naming: { \n      banned: ['xxè€…', 'xxä¹‹xx', 'æ·±æ¸Š', 'è™šæ— ', 'æ··æ²Œ', 'æ°¸æ’', 'æ— å'],\n      source: 'èå…¥æ°‘ä¿—/å®—æ•™/ç¥è¯/ç½‘æ–‡/ç§‘å¹»/å“²å­¦/åŠ¨ç‰©/æ¤ç‰©/ç‰¹å¾/æè´¨/ç°è±¡',\n      style: 'unique_and_memorable',\n      examples: ['ä»…ä¾›å‚è€ƒï¼Œä¸é™äºæ­¤']\n    },\n\n    // å¿ƒæ™ºè®¾è®¡\n    mentality: {\n      core_principle: 'å®Œå…¨è„±ç¦»äººç±»æ€ç»´æ¨¡å¼',\n      banned: ['æ‹ŸäººåŒ–', 'å†°å±±ç¾äºº', 'æœºæ¢°å†°å†·', 'ç»å¯¹ç†æ€§', 'çº¯ç²¹é‚ªæ¶', 'é«˜å†·'],\n      required: ['æ€ç»´æ–¹å¼å¼‚è´¨åŒ–', 'ä»·å€¼ä½“ç³»éäºº', 'æ²Ÿé€šéšœç¢', 'æƒ…ç»ªä¸å¯æè¿°'],\n      \n      thinking_patterns: {\n        examples: ['åŸºäºé¢œè‰²é¢‘ç‡æ€è€ƒ', 'å¤šç»´æ—¶é—´æ„ŸçŸ¥', 'é€†å‘å› æœé€»è¾‘', 'å…±é¸£å¼è®¤çŸ¥'],\n        freedom: 'å¯åˆ›é€ ä»»ä½•éäººç±»é€»è¾‘æ¡†æ¶'\n      },\n      \n      communication: {\n        types: ['è¯­è¨€ä¸é€š', 'ç†è§£åå·®', 'éè¯­è¨€äº¤æµ', 'å•å‘æ²Ÿé€š'],\n        methods: ['æ°”å‘³', 'æ¸©åº¦', 'å…‰å½±', 'å£°é¢‘', 'è§¦æ„Ÿ', 'ç£åœº', 'ç­‰ç­‰ä»»ä½•éå¸¸è§„æ–¹å¼'],\n        examples: 'ä»…ä¾›å¯å‘ï¼Œé¼“åŠ±åˆ›æ–°'\n      },\n\n      emotion_rules: {\n        æå†™ç¦æ­¢: 'ä¸¥ç¦ç›´æ¥æè¿°å†…åœ¨æƒ…ç»ª',\n        è¡¨ç°æ–¹å¼: 'ä»…é€šè¿‡è¡Œä¸ºã€å§¿æ€ã€ç¯å¢ƒååº”æš—ç¤º',\n        äººç±»æ„ŸçŸ¥: 'å®Œå…¨æ— æ³•ç†è§£å…¶æƒ…ç»ªçŠ¶æ€',\n        ç¥ç§˜ç»´æŒ: 'ä»»ä½•è§£è¯»å°è¯•éƒ½åº”å¤±è´¥'\n      }\n    },\n\n    // å¤–å½¢è®¾è®¡\n    form: { \n      required: ['å¿…é¡»æœ‰å›ºå®šç‰©ç†å½¢æ€', 'å‹å€’æ€§çš„å­˜åœ¨æ„Ÿ', 'ç¾å­¦å¸å¼•åŠ›'],\n      banned: ['å½¢å®¹ä¸ºæ²¡æœ‰å›ºå®šçš„å½¢æ€', 'çº¯ç²¹ä¸‘é™‹', 'è¿‡åº¦å¯çˆ±åŒ–', 'å®Œå…¨äººç±»åŒ–'],\n      \n      types: {\n        biological: ['äººå½¢', 'åŠ¨ç‰©å½¢', 'å¼‚å½¢', 'åŠäººå½¢', 'æ¤ç‰©å½¢', 'èŒç±»å½¢', 'æ·±æµ·ç”Ÿç‰©å½¢'],\n        artificial: ['ç‰©å½¢', 'æœºæ¢°å½¢', 'å»ºç­‘å½¢', 'å·¥å…·å½¢', 'è‰ºæœ¯å“å½¢'],\n        abstract: ['å‡ ä½•ä½“', 'å…‰å½±å½¢', 'æµä½“å½¢', 'æ™¶ä½“å½¢', 'æ°”ä½“å‡èšå½¢'],\n        hybrid: ['ç”Ÿç‰©+äººå·¥', 'æŠ½è±¡+å…·è±¡', 'å¤šå½¢æ€ç»„åˆ'],\n        note: 'åˆ†ç±»ä»…ä¾›å‚è€ƒï¼Œé¼“åŠ±è·¨ç•Œåˆ›æ–°'\n      },\n\n      styles: {\n        atmosphere: ['ææ€–æ‰san', 'ç¥ç§˜è«æµ‹', 'ä¼˜é›…å±é™©', 'åŸå§‹ç‹‚é‡', 'è¶…ç°å®ç¾å­¦'],\n        aesthetic: ['å¸…æ°”æ—¶é«¦', 'å¤å…¸åº„ä¸¥', 'æœªæ¥ç§‘æŠ€', 'è‡ªç„¶æœ‰æœº', 'äººå·¥ç²¾å¯†'],\n        impact: ['éäººç‰¹å¾çªå‡º', 'å‹è¿«æ„Ÿå¼ºçƒˆ', 'ç¾æ„Ÿä¸å¨èƒå¹¶å­˜'],\n        freedom: 'å¯åˆ›é€ ä»»ä½•ç¾å­¦é£æ ¼ç»„åˆ'\n      },\n\n      design_elements: {\n        animal_features: {\n          common: ['çŒ›ç¦½é”åˆ©', 'å¤§çŒ«ä¼˜é›…', 'æ·±æµ·ç¥ç§˜', 'æ˜†è™«ç²¾å¯†'],\n          uncommon: ['è›‡é¹«', 'é®Ÿé±‡é±¼', 'æ¯å¶è³è‚', 'ç»ç’ƒè›™', 'æ°´ç†Šè™«'],\n          body_parts: ['å¤çœ¼', 'è§¦é¡»', 'åˆ©çˆª', 'é³ç‰‡', 'ç¾½æ¯›', 'å¤–éª¨éª¼'],\n          note: 'é¼“åŠ±ä½¿ç”¨ä¸å¸¸è§åŠ¨ç‰©ç‰¹å¾'\n        },\n\n        artificial_elements: {\n          materials: ['é‡‘å±', 'é™¶ç“·', 'æ°´æ™¶', 'ç»ç’ƒ', 'æœ¨æ', 'çŸ³æ', 'å¡‘æ–™', 'å¤åˆææ–™'],\n          objects: ['å‘æ¡äººå¶', 'éª‘å£«ç›”ç”²', 'å¤è‘£é’Ÿè¡¨', 'ç²¾å¯†ä»ªå™¨', 'è‰ºæœ¯é›•å¡‘'],\n          textures: ['ç”Ÿé”ˆ', 'æŠ›å…‰', 'ç£¨ç ‚', 'é€æ˜', 'åŠé€æ˜', 'å‘å…‰', 'å˜è‰²'],\n          examples: 'ç ´æ—§é«˜å¤§éª‘å£«ç›”ç”²', 'ç²¾å¯†å‘æ¡ç”Ÿç‰©', 'ä¼šç§»åŠ¨çš„å‡ ä½•é›•å¡‘'\n        },\n\n        geometric_forms: {\n          shapes: ['å¤šé¢ä½“', 'åˆ†å½¢ç»“æ„', 'é»„é‡‘æ¯”ä¾‹', 'èºæ—‹å½¢', 'ç¯å½¢', 'çƒä½“', 'é”¥ä½“'],\n          properties: ['å¯¹ç§°', 'ä¸å¯¹ç§°', 'é€’å½’', 'åµŒå¥—', 'å˜å½¢', 'ç»„åˆ'],\n          scales: ['å¾®è§‚ç²¾å¯†', 'å®è§‚å£®ä¸½', 'å¤šå°ºåº¦åµŒå¥—'],\n          examples: 'å¾®å°å‡ ä½•ä½“é›†ç¾¤', 'å·¨å¤§æµ®åŠ¨å¤šé¢ä½“'\n        },\n\n        sensory_associations: {\n          ç¥ç¨æ„Ÿ: ['é«˜ä½çœ¼éƒ¨', 'ä¿¯è§†è§’åº¦', 'ä¸å¯¹ç§°ç‰¹å¾', 'é”åˆ©è¾¹ç¼˜'],\n          é­…æƒ‘æ„Ÿ: ['æµåŠ¨çº¿æ¡', 'è‰²å½©æ¸å˜', 'åŠé€æ˜è´¨æ„Ÿ', 'å…‰å½±å˜åŒ–'],\n          æ‚²æ‚¯æ„Ÿ: ['å‚å ç‰¹å¾', 'æŸ”å’Œæ›²çº¿', 'æš–è‰²ç‚¹ç¼€', 'ç¾Šç³ç­‰è±¡å¾'],\n          æ•¬ç•æ„Ÿ: ['å‡ ä½•ç»“æ„', 'å‘å…‰å…ƒç´ ', 'è¶…è‡ªç„¶æ¯”ä¾‹', 'å¤šé‡çœ¼ç›'],\n          ä¸å®‰æ„Ÿ: ['è¿åå¯¹ç§°', 'æ„å¤–è§’åº¦', 'ç†Ÿæ‚‰ä¸­çš„é™Œç”Ÿ', 'æ‰­æ›²æ¯”ä¾‹'],\n          creativity: 'å¯åˆ›é€ æ–°çš„æ„Ÿè§‰è”æƒ³'\n        }\n      },\n\n      pressure_elements: {\n        scale: ['ä½“å‹å‹åˆ¶', 'åŠ›é‡æš—ç¤º', 'ç©ºé—´æ‰­æ›²'],\n        presence: ['ç¯å¢ƒå½±å“', 'æ°”åœºå‹è¿«', 'å­˜åœ¨æ„Ÿå‹å€’'],\n        threat: ['éšå«å±é™©', 'æœªçŸ¥èƒ½åŠ›', 'ä¸å¯é¢„æµ‹æ€§'],\n        examples: 'ä»…ä¾›å‚è€ƒï¼Œé¼“åŠ±åŸåˆ›è®¾è®¡'\n      }\n    }\n  },\n  // è´¨é‡æ£€æ ¸æ ‡å‡†\n  quality_check: {\n    å¿…å¤‡è¦ç´ : [\n      'å¿ƒæ™ºå®Œå…¨éäººåŒ–',\n      'å¤–å½¢å‹å€’æ€§éäººç‰¹å¾', \n      'ç¾å­¦ä¸å¨èƒå¹¶å­˜',\n      'æƒ…ç»ªç¥ç§˜ä¸å¯æè¿°',\n      'æ²Ÿé€šå­˜åœ¨æ ¹æœ¬éšœç¢'\n    ],\n    \n    è¯„ä¼°ç»´åº¦: {\n      ç‹¬ç‰¹æ€§: 'é¿å…å¸¸è§åˆ»æ¿å°è±¡',\n      ä¸€è‡´æ€§: 'å¿ƒæ™ºå¤–å½¢ç›¸äº’å‘¼åº”',\n      å¤æ‚æ€§: 'å¤šå±‚æ¬¡ç¾å­¦æƒ…æ„Ÿç»´åº¦',\n      å½±å“åŠ›: 'æŒç»­å¿ƒç†å†²å‡»',\n      ç¥ç§˜æ€§: 'å§‹ç»ˆä¸å¯å®Œå…¨ç†è§£'\n    },\n\n    ç»å¯¹ç¦æ­¢: [\n      'çº¯ç†æ€§æœºæ¢°äººæ ¼',\n      'å®Œå…¨ç†è§£äººç±»æƒ…æ„Ÿ',\n      'å¯çˆ±åŒ–è®¾è®¡',\n      'å¸¸è§è§¦æ‰‹æ€ªè®¾å®š',\n      'å•çº¯ä¸‘é™‹æ¶å¿ƒ',\n      'è¡Œä¸ºå®Œå…¨å¯é¢„æµ‹',\n      'å¤±å»å‹è¿«æ„Ÿ'\n    ]\n  },\n\n  // åˆ›ä½œè‡ªç”±åº¦å£°æ˜\n  creative_freedom: {\n    examples_note: 'æ‰€æœ‰ç¤ºä¾‹ä»…ä¾›å¯å‘ï¼Œä¸æ„æˆé™åˆ¶',\n    innovation_encouraged: 'é¼“åŠ±è·¨ç•Œåˆ›æ–°å’ŒåŸåˆ›è®¾è®¡',\n    combination_freedom: 'å¯è‡ªç”±ç»„åˆä»»æ„å…ƒç´ ',\n    boundary_pushing: 'é¼“åŠ±æ¨å¹¿ç¾å­¦å’Œæ¦‚å¿µè¾¹ç•Œ',\n    uniqueness_priority: 'åŸåˆ›æ€§ä¼˜äºç¤ºä¾‹ä¾èµ–'\n  },\n\n  // ç‰¹æ®Šæé†’\n  special_notes: {\n    ç‰©å“ç±»äººå¤–: 'å‘æ¡äººå¶ã€éª‘å£«ç›”ç”²ã€å‡ ä½•ä½“ç­‰ç‰©å“å½¢æ€åŒæ ·é€‚ç”¨æ‰€æœ‰è§„åˆ™',\n    ç”Ÿç‰©ç±»äººå¤–: 'ä¸é™äºå¸¸è§ç”Ÿç‰©ï¼Œé¼“åŠ±ä½¿ç”¨ç½•è§ç‰¹å¾',\n    æ··åˆå½¢æ€: 'å¯ç»„åˆç”Ÿç‰©ã€äººå·¥ã€æŠ½è±¡ç­‰å¤šç§å…ƒç´ ',\n    ç¾æ„ŸåŸåˆ™: 'æ— è®ºå¤šä¹ˆè¯¡å¼‚éƒ½å¿…é¡»å…·æœ‰æŸç§ç¾æ„Ÿ',\n    å‹è¿«æ ¸å¿ƒ: 'å‹å€’æ€§å­˜åœ¨æ„Ÿæ˜¯æœ€é‡è¦ç‰¹å¾'\n  }\nåˆå§‹åŒ–è¦æ±‚:'åœ¨æ­£æ–‡è¾“å‡ºå‰ï¼Œå¿…é¡»æŒ‰ç…§ä»¥ä¸Šè¦æ±‚é€æ­¥æ„æ€å¹¶checké€ ç‰©çš„ç‰¹å¾ï¼Œå¹¶å°†æ„æ€å†…å®¹è¾“å‡ºåœ¨æ­£æ–‡å‰ï¼Œä»¥<build>æ ‡ç­¾åŒ…è£¹'\n})\n<%_ }} _%>",
                    "constant": true,
                    "selective": true,
                    "insertion_order": 121,
                    "enabled": false,
                    "position": "before_char",
                    "use_regex": true,
                    "extensions": {
                        "position": 0,
                        "exclude_recursion": false,
                        "display_index": 32,
                        "probability": 100,
                        "useProbability": true,
                        "depth": 4,
                        "selectiveLogic": 0,
                        "group": "",
                        "group_override": false,
                        "group_weight": 100,
                        "prevent_recursion": false,
                        "delay_until_recursion": false,
                        "scan_depth": null,
                        "match_whole_words": null,
                        "use_group_scoring": false,
                        "case_sensitive": null,
                        "automation_id": "",
                        "role": 0,
                        "vectorized": false,
                        "sticky": 0,
                        "cooldown": 0,
                        "delay": 0,
                        "match_persona_description": false,
                        "match_character_description": false,
                        "match_character_personality": false,
                        "match_character_depth_prompt": false,
                        "match_scenario": false,
                        "match_creator_notes": false,
                        "triggers": []
                    }
                },
                {
                    "id": 38,
                    "keys": [],
                    "secondary_keys": [],
                    "comment": "ğŸ”’é€ ç‰©å…³",
                    "content": "{{setvar::created_lock::true}}",
                    "constant": true,
                    "selective": true,
                    "insertion_order": 100,
                    "enabled": false,
                    "position": "before_char",
                    "use_regex": true,
                    "extensions": {
                        "position": 0,
                        "exclude_recursion": false,
                        "display_index": 33,
                        "probability": 100,
                        "useProbability": true,
                        "depth": 4,
                        "selectiveLogic": 0,
                        "group": "",
                        "group_override": false,
                        "group_weight": 100,
                        "prevent_recursion": false,
                        "delay_until_recursion": false,
                        "scan_depth": null,
                        "match_whole_words": null,
                        "use_group_scoring": false,
                        "case_sensitive": null,
                        "automation_id": "",
                        "role": 0,
                        "vectorized": false,
                        "sticky": 0,
                        "cooldown": 0,
                        "delay": 0,
                        "match_persona_description": false,
                        "match_character_description": false,
                        "match_character_personality": false,
                        "match_character_depth_prompt": false,
                        "match_scenario": false,
                        "match_creator_notes": false,
                        "triggers": []
                    }
                },
                {
                    "id": 39,
                    "keys": [],
                    "secondary_keys": [],
                    "comment": "ğŸ’«3æ‰‹åŠ¨å¯é€‰:æœ‰å°å‰§åœº/å‰ç«¯ç•Œé¢éœ€è¦æ¸²æŸ“å¼€",
                    "content": "html_format.set('format_rule',`\nè‹¥æœ‰å‰ç«¯htmlä»£ç ã€**HTMLæ ‡ç­¾æˆ–å†…è”CSS**éœ€è¦è¾“å‡ºï¼Œåˆ™**å¿…é¡»**å°†ä»£ç ä»¥<html></html>æ ‡ç­¾åŒ…è£¹ï¼Œä¾‹ï¼š\n(æ ‡é¢˜)\n<html>\n<style>\n...\n</style>\n<div>\n...\n</div>\n</html>\nä¸”å¿…é¡»ï¼šæ˜ç¡®è®¾ç½®å­—ä½“é¢œè‰²ï¼Œæ’ç‰ˆå…¼å®¹æ‰‹æœºï¼\n`)",
                    "constant": true,
                    "selective": true,
                    "insertion_order": 201,
                    "enabled": true,
                    "position": "after_char",
                    "use_regex": true,
                    "extensions": {
                        "position": 4,
                        "exclude_recursion": false,
                        "display_index": 34,
                        "probability": 100,
                        "useProbability": true,
                        "depth": 0,
                        "selectiveLogic": 0,
                        "group": "å‰ç«¯è§„åˆ™",
                        "group_override": false,
                        "group_weight": 100,
                        "prevent_recursion": false,
                        "delay_until_recursion": false,
                        "scan_depth": null,
                        "match_whole_words": null,
                        "use_group_scoring": false,
                        "case_sensitive": null,
                        "automation_id": "",
                        "role": 0,
                        "vectorized": false,
                        "sticky": 0,
                        "cooldown": 0,
                        "delay": 0,
                        "match_persona_description": false,
                        "match_character_description": false,
                        "match_character_personality": false,
                        "match_character_depth_prompt": false,
                        "match_scenario": false,
                        "match_creator_notes": false,
                        "triggers": []
                    }
                },
                {
                    "id": 41,
                    "keys": [],
                    "secondary_keys": [],
                    "comment": "mod:Fè¯¸å¤©ç¾¤èŠç‰ˆï¼ˆä¼¼ä¹èƒ½ç”¨ï¼‰",
                    "content": "{{setvar::world_version::6}}{{setvar::player_role::ç¾¤å‘˜}}{{setvar::world_role::è¯¸å¤©èŠå¤©ç¾¤}}{{setvar::point_role::ç§¯åˆ†}}{{setvar::zhixian_role::æ—¶ç©ºç¢ç‰‡}}{{setvar::xp_role::ç»éªŒå€¼}}{{setvar::player_rank:: }}{{setvar::tier_role::æ´»è·ƒç­‰çº§}}{{setvar::profession_role:: }}{{setvar::world_other_tag:: }}{{setvar::fixed_tag::<group_chat>}}\n \n\ngame.worldview.set('multiverse_chat_group',{\nscope:'è·¨è¶Šè¯¸å¤©ä¸‡ç•Œçš„è¶…ç»´èŠå¤©ç³»ç»Ÿ',\nrule:'è¿æ¥ä¸åŒä¸–ç•Œçš„å¼ºè€…ä¸å¤©å‘½ä¹‹å­ï¼Œæä¾›äº¤æµå¹³å°ä¸æˆé•¿æœºä¼š',\nconstraints:{\nmembers:'åŸºäºä¸–ç•Œé‡è¦æ€§ä¸ä¸ªä½“æ½œåŠ›é‚€è¯·ï¼Œæ¯ä¸ªä¸–ç•Œé™åˆ¶äººæ•°',\nworlds:'æ¶µç›–å„ç±»ACGNä¸–ç•Œä½“ç³»ï¼Œç¦æ­¢åŸåˆ›è®¾å®š'\n}\n})\n.set('membership_system',{\nrule:'ç¾¤èŠé€šè¿‡ç¾¤ä¸»é‚€è¯·åˆé€‚æˆå‘˜',\ninvitation_criteria:{\nworld_protagonist:'å„ä¸–ç•Œä¸»è§’ã€é‡è¦é…è§’ä¼˜å…ˆ',\npotential_assessment:'æ‹¥æœ‰ç‰¹æ®Šè¡€è„‰ã€å¤©èµ‹ã€æœºé‡è€…',\ngrowth_curve:'æ­£å¤„äºå¿«é€Ÿæˆé•¿æœŸæˆ–å…³é”®è½¬æŠ˜ç‚¹',\nworld_influence:'å¯¹æ‰€åœ¨ä¸–ç•Œå‰§æƒ…æœ‰é‡å¤§å½±å“åŠ›'\n},\nmember_types:{\nnewcomer:{\nrule:'æ–°å…¥ç¾¤æˆå‘˜ï¼Œå¯èƒ½ä¼šæœ‰æ¬¢è¿ä»ªå¼',\n},\nregular_member:{\nrule:'æ™®é€šç¾¤å‘˜ï¼Œå‚ä¸æ—¥å¸¸äº¤æµ',\nprivileges:['å‘è¨€','ç§èŠ','å‚ä¸æŠ•ç¥¨','å‘èµ·ç¾¤ä»»åŠ¡']\n},\nelite_member:{\nrule:'æ´»è·ƒçš„æˆå‘˜',\nrequirements:'æ´»è·ƒç­‰çº§â‰¥6',\nprivileges:['ä¼˜å…ˆè·å¾—ç¨€æœ‰ç‰©å“','å‚ä¸é«˜çº§ç¾¤ä»»åŠ¡','æ¨èæ–°æˆå‘˜']\n},\ngroup_administrator:{\nrule:'ç”±ç¾¤ä¸»ä»»å‘½çš„ç®¡ç†è€…',\nresponsibilities:['ç»´æŠ¤ç¾¤ç§©åº','å®¡æ ¸ç¾¤ä»»åŠ¡','å¤„ç†çº çº·'],\nauthority:['ç¦è¨€','è¸¢å‡ºç¾¤èŠ','å‘å¸ƒç¾¤å…¬å‘Š']\n}\n}\n})\n.set('currency',{\nrule:'ä½¿ç”¨ä¸‰ç§è´§å¸ç®¡ç†èµ„æº',\ntypes:{\næ—¶ç©ºç¢ç‰‡:{\nrule:'åˆ†ä¸ºD,C,B,A,Säº”çº§ï¼Œå¯æ‹†åˆ†æˆ–ç»„è£…',\nconversion:{\nup:'3ä¸ªä½çº§å¯åˆæˆ1ä¸ªé«˜çº§ï¼ˆå¦‚3D=1Cï¼‰ï¼Œå’Œç§¯åˆ†çš„äº’æ¢ä»·æ ¼ä¸º1d=1000,1C=3000ï¼Œä»¥æ­¤ç±»æ¨',\ndown:'1ä¸ªé«˜çº§å¯æ‹†åˆ†ä¸º3ä¸ªä½çº§ï¼ˆå¦‚1C=3Dï¼‰'\n}\n},\npoints:{\nrule:'å¸¸è§è´§å¸ï¼Œè´­ä¹°èµ„æºéœ€æ­é…æ”¯çº¿',\nexample:'é«˜èƒ½ç²’å­è„‰å†²æ­¥æªéœ€D+500ç§¯åˆ†'\n},\nexperience:{\nrule:'ä¸å¯è½¬è®©ï¼Œéœ€é€šè¿‡è®­ç»ƒæˆ–ä»»åŠ¡æå‡',\nacquisition:[\n{action:'è®­ç»ƒä¸€å¤©',value:'+5ç»éªŒ'}\n]\n}\n}\n})\n.set('chat_functions',{\nrule:'èŠå¤©ç¾¤æä¾›å¤šæ ·åŒ–äº¤æµåŠŸèƒ½',\nbasic_features:{\ntext_chat:'è·¨ä¸–ç•Œå®æ—¶æ–‡å­—äº¤æµ',\nvoice_message:'å¯å‘é€éŸ³é¢‘ï¼Œè‡ªåŠ¨ç¿»è¯‘',\nimage_sharing:'åˆ†äº«å›¾ç‰‡ã€åŠŸæ³•ç§˜ç±ç­‰',\nvideo_call:'é¢å¯¹é¢äº¤æµï¼Œæ¶ˆè€—ç§¯åˆ†',\nlocation_sharing:'å…±äº«ä¸–ç•Œåæ ‡ä¸åœºæ™¯'\n},\n//æ³¨æ„ï¼èŠå¤©ç¾¤å†…çš„ç¾¤å‘˜æ— æ³•å¾—çŸ¥è‡ªå·±ä¸åº”è¯¥çŸ¥é“çš„ä¿¡æ¯ï¼ä¾‹å¦‚ï¼Œåœ¨<user>å…±äº«è‡ªå·±å½“å‰å¢ƒå†µå‰ï¼Œç¾¤å‘˜å¯¹<user>å’Œ<user>å½“å‰å¢ƒå†µä¿¡æ¯**æ— æ³•çŸ¥æ™“**ï¼ç¾¤å‘˜å’Œç¾¤å‘˜ä¹‹é—´ä¹Ÿåº”è¯¥éµå¾ªæ­¤è§„åˆ™ï¼Œä»»ä½•npcåŒ…æ‹¬<user>déƒ½ç¦æ­¢å‡ºç°å…¨çŸ¥è§†è§’ï¼\nadvanced_features:{\nworld_broadcast:{\nrule:'å‘æ•´ä¸ªä¸–ç•Œå‘é€ä¿¡æ¯',\ncost:'1000ç§¯åˆ†+ç®¡ç†å‘˜å®¡æ ¸',\nrestrictions:'ç¦æ­¢æ³„éœ²ç¾¤èŠç§˜å¯†'\n},\ntime_message:{\nrule:'å»¶æ—¶å‘é€æˆ–å®šæ—¶æé†’',\napplications:['é‡è¦äº‹ä»¶æé†’','è·¨æ—¶åŒºåè°ƒ']\n},\nanonymous_mode:{\nrule:'åŒ¿åå‘è¨€ä¿æŠ¤éšç§',\ncost:'50ç§¯åˆ†/æ¬¡',\nlimitations:'æ— æ³•ä½¿ç”¨é«˜çº§åŠŸèƒ½'\n}\n}\n})\n.set('point_system',{\nrule:'ç¾¤èŠä½¿ç”¨ç§¯åˆ†ä½œä¸ºé€šç”¨è´§å¸',\nacquisition:{\ndaily_sign_in:'+10ç§¯åˆ†/å¤©',\nactive_chat:'+1ç§¯åˆ†/æ¡æ¶ˆæ¯ï¼ˆæ¯æ—¥ä¸Šé™50ï¼‰',\nshare_knowledge:'+50~500ç§¯åˆ†ï¼ˆæ ¹æ®ä»·å€¼è¯„å®šï¼‰',\ncomplete_group_task:'+200~2000ç§¯åˆ†ï¼ˆæ ¹æ®ä»»åŠ¡éš¾åº¦ï¼‰',\nhelp_newcomers:'+20ç§¯åˆ†/æ¬¡æŒ‡å¯¼',\nworld_breakthrough:'+1000ç§¯åˆ†ï¼ˆå¢ƒç•Œçªç ´æ—¶ï¼‰'\n},\nconsumption:{\ncross_world_trading:'äº¤æ˜“æ‰‹ç»­è´¹10%',\npremium_functions:['åŒ¿åæ¨¡å¼50ç§¯åˆ†','è§†é¢‘é€šè¯100ç§¯åˆ†/å°æ—¶'],\nemergency_help:'å‘å¸ƒç´§æ€¥æ±‚åŠ©500ç§¯åˆ†',\nworld_travel:'5000~50000ç§¯åˆ†ï¼ˆæ ¹æ®ä¸–ç•Œç­‰çº§å·®ï¼‰'\n},\nconstraints:{\nno_transfer:'ç§¯åˆ†ä¸å¯ç›´æ¥è½¬è®©',\nearning_limit:'æ¯æ—¥è·å–ç§¯åˆ†ä¸Šé™2000'\n}\n})\n.set('trading_system',{\nrule:'ç¾¤å‘˜å¯è¿›è¡Œè·¨ä¸–ç•Œç‰©å“ä¸çŸ¥è¯†äº¤æ˜“',\ntradeable_items:{\ncultivation_methods:{\nrule:'åŠŸæ³•ã€æ­¦æŠ€ã€ç§˜æœ¯ç­‰ä¿®ç‚¼æ–¹æ³•',\npricing:'æ ¹æ®ç­‰çº§ä¸ç¨€æœ‰åº¦ï¼Œ100~10000ç§¯åˆ†',\nrestrictions:'ä¸å¯ä¼ æ’­ç¦å¿ŒåŠŸæ³•'\n},\nrare_materials:{\nrule:'å„ä¸–ç•Œç‰¹æœ‰çš„çç¨€ææ–™',\nexamples:['é¾™è¡€','å‡¤å‡°ç¾½æ¯›','æ—¶é—´æ²™','ç©ºé—´çŸ³'],\nexchange_ratio:'æŒ‰ä¸–ç•Œç­‰çº§å·®å¼‚å®šä»·'\n},\nmagical_items:{\nrule:'å…·æœ‰ç‰¹æ®Šèƒ½åŠ›çš„ç‰©å“',\ncategories:['æ­¦å™¨','é˜²å…·','ä¸¹è¯','ç¬¦å’’','ç§‘æŠ€äº§å“'],\nauthentication:'ç¾¤èŠè‡ªåŠ¨é‰´å®šçœŸä¼ªä¸æ•ˆæœ'\n},\nknowledge_information:{\nrule:'å„ä¸–ç•Œçš„æƒ…æŠ¥ã€å†å²ã€æŠ€æœ¯èµ„æ–™',\nvalue_assessment:'æ ¹æ®ç¨€æœ‰æ€§ä¸å®ç”¨æ€§å®šä»·',\ncopyright:'åˆ†äº«è€…äº«æœ‰æ°¸ä¹…åˆ†æˆæƒç›Š'\n}\n},\ntrading_rules:{\nfair_trade:'ç¾¤èŠç›‘ç£ï¼Œç¦æ­¢æ¬ºè¯ˆ',\ncooling_period:'å¤§é¢äº¤æ˜“24å°æ—¶å†·é™æœŸ',\ndispute_resolution:'ç®¡ç†å‘˜ä»²è£äº‰è®®',\nblacklist_system:'æ¶æ„äº¤æ˜“è€…åŠ å…¥é»‘åå•'\n}\n})\n.set('group_missions',{\nrule:'ç¾¤å‘˜å¯å‘èµ·æˆ–å‚ä¸è·¨ä¸–ç•Œåä½œä»»åŠ¡',\nmission_types:{\nmutual_aid:{\nrule:'ç¾¤å‘˜é‡åˆ°å›°éš¾ï¼Œå¯»æ±‚å…¶ä»–æˆå‘˜å¸®åŠ©',\nexamples:['çªç ´ç“¶é¢ˆæŒ‡å¯¼','æ•Œäººæƒ…æŠ¥åˆ†æ','ç´§æ€¥é¿éš¾ååŠ©'],\nreward_source:'å‘èµ·è€…æ”¯ä»˜ç§¯åˆ†é…¬è°¢'\n},\nexploration:{\nrule:'æ¢ç´¢æœªçŸ¥ç§˜å¢ƒæˆ–é—è¿¹',\norganization:'å¤šåç¾¤å‘˜ç»„é˜Ÿï¼Œå…±äº«æ”¶ç›Š',\nrequirements:'å®åŠ›ç›¸å½“ï¼Œç›®æ ‡ä¸–ç•Œå®‰å…¨ç­‰çº§è¯„ä¼°'\n},\nworld_crisis:{\nrule:'æŸä¸ªä¸–ç•Œé¢ä¸´é‡å¤§å±æœºï¼Œå¯»æ±‚æ´åŠ©',\nparticipation:'è‡ªæ„¿åŸåˆ™ï¼Œç¾¤èŠæä¾›ä¼ é€æœåŠ¡',\nrewards:'ä¸–ç•Œæ„è¯†å¥–åŠ±+ç¾¤èŠé¢å¤–è¡¥è´´'\n},\nknowledge_exchange:{\nrule:'ç»„ç»‡å­¦æœ¯äº¤æµä¸æŠ€æœ¯ç ”è®¨',\nbenefits:'æå‡ç†è®ºæ°´å¹³ï¼Œè·å¾—æ–°æ€è·¯',\nformat:'çº¿ä¸Šè®²åº§+å®åœ°è€ƒå¯Ÿ'\n}\n},\nmission_mechanics:{\nposting_cost:'å‘å¸ƒä»»åŠ¡éœ€æ”¯ä»˜100ç§¯åˆ†ä¿è¯é‡‘',\nparticipant_screening:'å‘èµ·è€…å¯è®¾å®šå‚ä¸æ¡ä»¶',\nprogress_tracking:'ç¾¤èŠç›‘æ§ä»»åŠ¡è¿›åº¦',\nreward_distribution:'ä»»åŠ¡å®Œæˆåè‡ªåŠ¨ç»“ç®—'\n//è„±ç¦»ä»»åŠ¡ä¸–ç•Œæ—¶ç«‹åˆ»ç»“ç®—ä»»åŠ¡å¥–åŠ±ï¼Œå¹¶åœ¨æ­£æ–‡è¯´æ˜ã€å¥–åŠ±å·²å‘æ”¾ã€‘ã€‚ç¦æ­¢é‡å¤å‘æ”¾ã€‚å¹¶ä¸”åœ¨ç»“ç®—çš„æ—¶å€™å°±åŒæ—¶ç»“ç®—äº†ä»»åŠ¡å®Œæˆæ•°é‡å’Œå£°æœ›ç­‰æ‰€æœ‰é™„åŠ å±æ€§ã€‚\n}\n})\n.set('world_classification',{\nrule:'æ ¹æ®ä¸–ç•ŒåŠ›é‡ä½“ç³»ä¸å±é™©ç¨‹åº¦åˆ†çº§',\nlevels:['1çº§ä¸–ç•Œ','2çº§ä¸–ç•Œ','3çº§ä¸–ç•Œ','4çº§ä¸–ç•Œ','5çº§ä¸–ç•Œ','6çº§ä¸–ç•Œ','7çº§ä¸–ç•Œ','8çº§ä¸–ç•Œ','9çº§ä¸–ç•Œ','10çº§ä¸–ç•Œ'],\n//å¯¹åº”èƒ½é‡å±‚çº§ï¼š1çº§æ˜¯æ— 2-3çº§æ˜¯ä½4-5æ˜¯ä¸­6-7æ˜¯é«˜8-10æ˜¯ç¥è¯\nclassification_criteria:[\n{level:'1çº§ä¸–ç•Œ',description:'æ™®é€šç°å®ä¸–ç•Œï¼Œæ— è¶…è‡ªç„¶åŠ›é‡',examples:['ç°ä»£éƒ½å¸‚','å†å²å¤ä»£']},\n{level:'2çº§ä¸–ç•Œ',description:'ä½é­”ä¸–ç•Œï¼Œå­˜åœ¨å°‘é‡è¶…èƒ½åŠ›',examples:['ä½çº§æ­¦ä¾ ','ç°ä»£å¼‚èƒ½']},\n{level:'3çº§ä¸–ç•Œ',description:'ä¸­ç­‰å¥‡å¹»ä¸–ç•Œï¼Œé­”æ³•æ­¦æŠ€ç››è¡Œ',examples:['ä¼ ç»Ÿæ­¦ä¾ ','è¥¿æ–¹é­”å¹»']},\n{level:'4çº§ä¸–ç•Œ',description:'é«˜æ­¦ä¸–ç•Œï¼Œä¸ªä½“åŠ›é‡å¯ç§»å±±å¡«æµ·',examples:['ä»™ä¾ ä¿®çœŸåˆæœŸ','è¶…çº§è‹±é›„']},\n{level:'5çº§ä¸–ç•Œ',description:'ä¿®ä»™ä¸–ç•Œï¼Œå­˜åœ¨é•¿ç”Ÿä¸é£å‡',examples:['ç»å…¸ä¿®ä»™','æ´ªè’ç¥è¯']},\n{level:'6çº§ä¸–ç•Œ',description:'é«˜çº§ä¿®ä»™ï¼Œå¤šå…ƒå®‡å®™å±‚æ¬¡',examples:['é¡¶çº§ä»™ä¾ ','ç§‘å¹»æ–‡æ˜']},\n{level:'7çº§ä¸–ç•Œ',description:'è¶…è„±ä¸–ç•Œï¼Œæ¶‰åŠæ—¶ç©ºæ³•åˆ™',examples:['æ´ªè’åœ£äºº','å¤šå…ƒä¸»å®°']},\n{level:'8çº§ä¸–ç•Œ',description:'è‡³é«˜ä¸–ç•Œï¼Œåˆ›ä¸–çº§åˆ«åŠ›é‡',examples:['æ··æ²Œé­”ç¥','æ°¸æ’å­˜åœ¨']},\n{level:'9çº§ä¸–ç•Œ',description:'è¶…éªŒä¸–ç•Œï¼Œæ¦‚å¿µå±‚é¢å­˜åœ¨',examples:['å¤§é“æœ¬æº','ç»ˆæçœŸç†']},\n{level:'10çº§ä¸–ç•Œ',description:'æœªçŸ¥é¢†åŸŸï¼Œç¾¤èŠç³»ç»Ÿé™åˆ¶è®¿é—®',examples:['ï¼Ÿï¼Ÿï¼Ÿ','æƒé™ä¸è¶³']}\n],\ncross_world_restrictions:{\npower_suppression:'é«˜ç­‰çº§ä¸–ç•Œæˆå‘˜åœ¨ä½ç­‰çº§ä¸–ç•Œå—é™',\nknowledge_barrier:'è·¨çº§ä¼ æˆå—ç¾¤èŠç›‘ç®¡',\nintervention_limits:'ç¦æ­¢è¿‡åº¦å¹²é¢„ä½ç­‰çº§ä¸–ç•Œè¿›ç¨‹'\n}\n})\n.set('æ´»è·ƒç­‰çº§_system',{\nrule:'æ ¹æ®æ´»è·ƒåº¦ã€è´¡çŒ®åº¦ã€å®åŠ›ç­‰ç»¼åˆè¯„å®šæ´»è·ƒç­‰çº§ï¼Œå³ä¸ºç¾¤åœ°ä½',\nevaluation_factors:{\nactivity:'å‘è¨€é¢‘ç‡ã€åœ¨çº¿æ—¶é•¿ã€å‚ä¸æ´»åŠ¨',\ncontribution:'åˆ†äº«çŸ¥è¯†ã€å¸®åŠ©ä»–äººã€å®Œæˆä»»åŠ¡',\nstrength:'ä¸ªäººå®åŠ›ã€ä¸–ç•Œå½±å“åŠ›ã€æˆé•¿é€Ÿåº¦',\nreputation:'å…¶ä»–æˆå‘˜è¯„ä»·ã€ä¿¡èª‰åº¦ã€å£ç¢‘'\n},\nbenefits:{\nprivilege_expansion:'åœ°ä½è¶Šé«˜ï¼Œå¯ä½¿ç”¨åŠŸèƒ½è¶Šå¤š',\ndiscount_rates:'é«˜åœ°ä½æˆå‘˜äº«å—äº¤æ˜“ä¼˜æƒ ',\npriority_access:'ä¼˜å…ˆå‚ä¸ç¨€æœ‰ä»»åŠ¡å’Œæ´»åŠ¨',\ninfluence_power:'åœ¨ç¾¤å†³ç­–ä¸­æ‹¥æœ‰æ›´å¤§è¯è¯­æƒ'\n}\n})\n.set('special_events',{\nrule:'ç¾¤èŠå®šæœŸä¸¾åŠå„ç±»ç‰¹æ®Šæ´»åŠ¨',\nevent_types:{\nanniversary_celebration:{\nrule:'ç¾¤èŠå‘¨å¹´åº†å…¸',\nactivities:['ç§¯åˆ†ç¿»å€','é™å®šå¥–åŠ±','æˆå‘˜èšä¼š'],\nfrequency:'æ¯å¹´ä¸€æ¬¡'\n},\ncross_world_tournament:{\nrule:'è·¨ä¸–ç•Œæ­¦é“å¤§ä¼š',\nformat:'åˆ†ç­‰çº§æ¯”èµ›ï¼Œè™šæ‹Ÿç©ºé—´å¯¹æˆ˜',\nrewards:['çç¨€ç‰©å“','ç‰¹æ®Šç§°å·','ä¸–ç•Œé‚€è¯·å‡½']\n},\nknowledge_expo:{\nrule:'çŸ¥è¯†åšè§ˆä¼š',\ncontent:'å„ä¸–ç•Œæ–‡æ˜å±•ç¤ºäº¤æµ',\nbenefits:'æ‰©å±•è§†é‡ï¼Œè·å¾—çµæ„Ÿ'\n},\nemergency_assembly:{\nrule:'ç´§æ€¥é›†ç»“',\ntrigger:'æŸä¸–ç•Œé­é‡ç­ä¸–å±æœº',\nresponse:'å…¨ç¾¤åŠ¨å‘˜ï¼Œå…±åŒåº”å¯¹'\n}\n}\n})\n.set('group_shop',{\nrule:'ç¾¤èŠå•†åŸæä¾›å„ç±»å•†å“æœåŠ¡',\nproduct_categories:{\nbasic_items:{\nrule:'æ—¥å¸¸æ¶ˆè€—å“',\nexamples:['æ”¹åå¡(100ç§¯åˆ†)','ä¸ªäººç©ºé—´è£…é¥°(200ç§¯åˆ†)'],\nrefresh:'æ¯æ—¥æ›´æ–°åº“å­˜'\n},\nrare_treasures:{\nrule:'ç¨€æœ‰ç‰©å“é™æ—¶é”€å”®',\nexamples:['éšæœºè¡€è„‰è§‰é†’è¯å‰‚(5000ç§¯åˆ†)','ä¸–ç•Œé€šè¡Œè¯(10000ç§¯åˆ†)','æ—¶é—´åŠ é€Ÿå¡(3000ç§¯åˆ†)'],\navailability:'æ•°é‡æœ‰é™ï¼Œå…ˆåˆ°å…ˆå¾—'\n},\nservice_packages:{\nrule:'ç‰¹æ®ŠæœåŠ¡é¡¹ç›®',\noptions:['ä¸“å±å¯¼å¸ˆæŒ‡å¯¼','ä¸ªäººä¸–ç•Œå®šåˆ¶','ä¸“ä¸šå›¢é˜Ÿæ”¯æ´'],\npricing:'æ ¹æ®æœåŠ¡å¤æ‚åº¦åŠ¨æ€å®šä»·'\n},\n}\n})\n.set('privacy_protection',{\nrule:'ç¾¤èŠä¸¥æ ¼ä¿æŠ¤æˆå‘˜éšç§ä¸ä¸–ç•Œæœºå¯†',\nprotection_measures:{\nreal_name_encryption:'çœŸå®å§“åè‡ªåŠ¨éšè—',\nworld_coordinate_masking:'ç²¾ç¡®ä½ç½®ä¿¡æ¯åŠ å¯†',\nsensitive_info_filter:'è‡ªåŠ¨æ£€æµ‹å¹¶å±è”½å…³é”®æƒ…æŠ¥',\nmemory_partition:'ç¦»ç¾¤åç›¸å…³è®°å¿†æ¨¡ç³Šå¤„ç†'\n},\nviolation_consequences:{\nwarning_system:'é¦–æ¬¡è¿è§„è­¦å‘Š',\nfunction_restriction:'é™åˆ¶éƒ¨åˆ†ç¾¤èŠåŠŸèƒ½',\ntemporary_ban:'æš‚æ—¶è¸¢å‡ºç¾¤èŠ',\npermanent_expulsion:'æ°¸ä¹…é©±é€+è®°å¿†æ¸…é™¤'\n}\n})\n.set('growth_assistance',{\nrule:'ç¾¤èŠè‡´åŠ›äºå¸®åŠ©æˆå‘˜å¿«é€Ÿæˆé•¿',\nassistance_methods:{\nmentor_system:{\nrule:'é«˜ç­‰çº§æˆå‘˜æŒ‡å¯¼æ–°äºº',\nmatching:'æ ¹æ®ä¸–ç•Œç±»å‹ä¸ä¿®ç‚¼æ–¹å‘é…å¯¹',\nrewards:'å¯¼å¸ˆè·å¾—ç§¯åˆ†å¥–åŠ±å’Œå£°æœ›æå‡'\n},\nresource_sharing:{\nrule:'å»ºç«‹èµ„æºå…±äº«æ± ',\ncontribution:'æˆå‘˜æèµ å¤šä½™èµ„æº',\ndistribution:'æŒ‰éœ€åˆ†é…ç»™æœ‰éœ€è¦çš„æˆå‘˜'\n},\ngroup_cultivation:{\nrule:'é›†ä½“ä¿®ç‚¼æ´»åŠ¨',\nbenefits:'å…±åŒæ„Ÿæ‚Ÿï¼Œæ•ˆç‡å€å¢',\nrequirements:'åŠŸæ³•å…¼å®¹æ€§æ£€æµ‹'\n},\ncrisis_intervention:{\nrule:'æˆå‘˜é‡åˆ°ç”Ÿå‘½å±é™©æ—¶ç´§æ€¥æ•‘æ´',\nresponse_time:'5åˆ†é’Ÿå†…ç»„ç»‡æ•‘æ´é˜Ÿ',\ncost_coverage:'ç¾¤èŠåŸºé‡‘æ”¯ä»˜ä¼ é€è´¹ç”¨'\n}\n}\n})\n.set('forum',{\nrule:'é™¤äº†ç¾¤èŠï¼Œè¿˜æä¾›è®ºå›ï¼Œä½œä¸ºæ›´ä¸“ä¸šçš„äº¤æµæ¿å—',\nsections:[\n{name:'å…¬å‘ŠåŒº',rule:'å®˜æ–¹å…¬å‘Š'},\n{name:'ä»»åŠ¡äº¤æµåŒº',rule:'åˆ†äº«ä¸è®¨è®ºè·¨ä¸–ç•Œåä½œä»»åŠ¡'},\n{name:'è‡ªç”±äº¤æ˜“åŒº',rule:'äº¤æ˜“ç‰©å“ã€æŠ€èƒ½ã€è¡€ç»Ÿä¿¡æ¯'},\n{name:'å…«å¦é—²èŠåŒº',rule:'æ—¥å¸¸é—²èŠä¸è¶£é—»åˆ†äº«'},\n{name:'åŒ¿åæ±‚åŠ©åŒº',rule:'åŒ¿åå¯»æ±‚å¸®åŠ©ä¸å»ºè®®'}\n]\n})\n.set('æŠ½å¥–ç³»ç»Ÿ',{\nrule:'ç¾¤èŠè¿˜æä¾›æŠ½å¥–ç³»ç»Ÿï¼Œèƒ½æŠ½ä¸­è¡€ç»Ÿã€æŠ€èƒ½ã€ç‰©å“ã€å®¶å…·ç­‰ï¼Œé‡å¤ç‰©å“ä¼šè½¬å˜ä¸ºç§¯åˆ†',\næ¦‚ç‡:[\n{min:30,max:70,probability:0.59},\n{min:80,max:160,probability:0.25},\n{min:200,max:600,probability:0.1},\n{min:1000,max:4000,probability:0.05},\n{min:8000,max:20000,probability:0.01}\n]\n});",
                    "constant": true,
                    "selective": true,
                    "insertion_order": 100,
                    "enabled": true,
                    "position": "before_char",
                    "use_regex": true,
                    "extensions": {
                        "position": 0,
                        "exclude_recursion": false,
                        "display_index": 35,
                        "probability": 100,
                        "useProbability": true,
                        "depth": 4,
                        "selectiveLogic": 0,
                        "group": "ç‰ˆæœ¬",
                        "group_override": false,
                        "group_weight": 100,
                        "prevent_recursion": false,
                        "delay_until_recursion": false,
                        "scan_depth": null,
                        "match_whole_words": null,
                        "use_group_scoring": false,
                        "case_sensitive": null,
                        "automation_id": "",
                        "role": 0,
                        "vectorized": false,
                        "sticky": 0,
                        "cooldown": 0,
                        "delay": 0,
                        "match_persona_description": false,
                        "match_character_description": false,
                        "match_character_personality": false,
                        "match_character_depth_prompt": false,
                        "match_scenario": false,
                        "match_creator_notes": false,
                        "triggers": []
                    }
                },
                {
                    "id": 42,
                    "keys": [],
                    "secondary_keys": [],
                    "comment": "mod:ç‰¹æ®Šæ—¥æœŸ",
                    "content": "game.set('special_date_rule',{\n  operations: ['memory', 'delete'],\n  desc: \"ä½ åœ¨å‘ç°é‡è¦æ—¥æœŸæ—¶è‡ªåŠ¨è®°å½•ä¸ºç‰¹æ®Šæ—¥æœŸ\",\n  type: ['ç”Ÿæ—¥', 'çºªå¿µæ—¥', 'çº¦å®š', 'deadline', 'èŠ‚æ—¥', 'å…¶ä»–é‡è¦æ—¥æœŸ' etc],\n  key_format:ã€${date}ã€‘${name};\n  date_format: 'ã€mmæœˆddæ—¥ã€‘', // å¿…é¡»ä¸status_memoryä¸­çš„æ—¥æœŸæ ¼å¼å®Œå…¨ä¸€è‡´ä¸”å¿…é¡»ä½œä¸ºkeyçš„å‰ç¼€\n  value:'å­—æ®µä¸é™ï¼Œä»¥èƒ½è¯¦å°½è®°å½•ä¸ºå…ˆã€‚å¦‚infoã€eventã€locationç­‰'\n  trigger: \"å‘ç°é‡è¦æ—¥æœŸä¿¡æ¯æ—¶â†’ç«‹å³è®°å½•åˆ°å¤‡å¿˜å½•ï¼›è¿‡æœŸ/å®Œæˆæ—¶åˆ é™¤ã€‚ç”Ÿæ—¥ã€èŠ‚æ—¥ç­‰éä¸€æ¬¡æ€§æ—¥æœŸä¸åˆ é™¤\",\n  examples: [\n    memory('å¤‡å¿˜å½•', 'ã€12æœˆ25æ—¥ã€‘çƒŸèŠ±æ™šä¼š', '{...})';\n  ]\n});",
                    "constant": true,
                    "selective": true,
                    "insertion_order": 1000,
                    "enabled": true,
                    "position": "after_char",
                    "use_regex": true,
                    "extensions": {
                        "position": 1,
                        "exclude_recursion": false,
                        "display_index": 42,
                        "probability": 100,
                        "useProbability": true,
                        "depth": 4,
                        "selectiveLogic": 0,
                        "group": "",
                        "group_override": false,
                        "group_weight": 100,
                        "prevent_recursion": false,
                        "delay_until_recursion": false,
                        "scan_depth": null,
                        "match_whole_words": null,
                        "use_group_scoring": false,
                        "case_sensitive": null,
                        "automation_id": "",
                        "role": 0,
                        "vectorized": false,
                        "sticky": 0,
                        "cooldown": 0,
                        "delay": 0,
                        "match_persona_description": false,
                        "match_character_description": false,
                        "match_character_personality": false,
                        "match_character_depth_prompt": false,
                        "match_scenario": false,
                        "match_creator_notes": false,
                        "triggers": []
                    }
                },
                {
                    "id": 44,
                    "keys": [],
                    "secondary_keys": [],
                    "comment": "mod:npcæç®€æ¡£æ¡ˆ(æ— ç«‹ç»˜)",
                    "content": "<%_\nvar world_role = getLocalVar(\"world_role\", \"\");\nvar player_role = getLocalVar(\"player_role\", \"è½®å›è€…\");\nvar tier_role = getLocalVar(\"tier_role\", \"\");\nvar profession_role = getLocalVar(\"profession_role\", \"\");\nvar point_role = getLocalVar(\"point_role\", \"\");\nvar zhixian_role = getLocalVar(\"zhixian_role\", \"\");\nvar xp_role = getLocalVar(\"xp_role\", \"\");\nvar is_private_chat = getLocalVar(\"private_chat\", \"false\");\nvar contactable_tag = \"\";\nif(String(is_private_chat) === \"true\"){\n    contactable_tag = ', \"å¯è”ç³»\":true/false //æ˜¯å¦åŠ ä¸Šå¥½å‹,å†³å®šäº†æ˜¯å¦å¯ä»¥è¿›è¡Œç§èŠ';\n}\n\n// è·å–ä¸–ç•Œç‰ˆæœ¬å·\nif (typeof version === 'undefined') {\n    var version = Number(getLocalVar(\"world_version\") || 1);\n}\n \n_%>\nmemory.set('npc_record_rules', {\n  desc: 'Standardized format for NPC data.æ‰€æœ‰npcåœ¨å‡ºåœºçš„æ—¶å€™ï¼Œä½ å¿…é¡»ä»¥å…¨çŸ¥è§†è§’åˆå§‹åŒ–å…¶npcæ¡£æ¡ˆ',\n  init: {\n    full_format: memory('path', '${npc_name}', ${npc_data_object//ç´§å‡‘jsonæ ¼å¼}) // For important NPCs,\n    simple_format: memory('path', 'npc_name', '{\"ç®€ä»‹\":\"${desc_string}\",\"å±æ€§\":\"ã€attr:val;skill:valã€‘\"}') // For minor NPCs,\n    required_fields: {\n      å¤–è²Œ: 'string', æ€§æ ¼: '{} //keyä¸ºå”¯ä¸€index:numï¼Œvalueä¸ºå…·ä½“æè¿°ã€‚e.g.,  {\"1\":\"è¡¨é¢å¼€æœ—å¤–å‘ï¼Œæ´»æ³¼å¥è°ˆ\"} ', èº«ä»½: 'string', å±æ€§: 'string //æœ€çªå‡ºçš„å‡ ä¸ªå±æ€§æ®µ/æŠ€èƒ½æ®µï¼Œåœ¨åˆå§‹åŒ–çš„æ—¶å€™å°±ç«‹åˆ»è®°å½•è¯¦ç»†æ•°å€¼ï¼Œä½œä¸ºç³»ç»Ÿä¿¡æ¯è®°å½•ï¼Œç¦æ­¢æœªçŸ¥ï¼Œ e.g., ã€åŠ›é‡:4;æªæ¢°:3ã€‘',\n      å¥½æ„Ÿåº¦: 'number // range[-100, 100] è¯¥äººç‰©å¯¹<user>çš„å¥½æ„Ÿåº¦ã€‚æ ¹æ®å®é™…æƒ…å†µé…Œæƒ…æ›´æ–°ï¼Œä¸Šå‡å¹…åº¦æä½ï¼Œä¸”ä¼šä¸Šä¸‹æ³¢åŠ¨'<%= contactable_tag %>, ç›¸å…³è®¾å®š: '{}//keyä¸ºç®€è¦æ¦‚æ‹¬ï¼Œvalueä¸ºå…·ä½“æè¿°,e.g.,  {\"è¡Œä¸ºæ¨¡å¼\":\"xxx\"}' ,å¯¹<user>å°è±¡:'{}//keyä¸ºtagï¼Œvalueä¸ºç®€çŸ­descã€‚e.g.,  {\"å†·æ·¡\":\"æ˜¯ä¸ªå†·æ·¡çš„äººï¼Œä»¤äººæ‰æ‘¸ä¸é€\"} '   }\n<%_ if (version != 7) { _%>\n//åªæœ‰ã€<%= player_role %>ã€‘è¿˜éœ€è¦åœ¨èº«ä»½ä¸­è®°å½•ã€<%= player_role %><%= tier_role %>:xxxã€‘ï¼ŒåœŸè‘—ä¸è®°å½•\n<%_ } _%>\n  },\n  data_structure: {\n    key: 'NPCå§“åä½œä¸ºå”¯ä¸€æ ‡è¯†ç¬¦',\n    value: 'Compact JSONæ ¼å¼ï¼ŒåŒ…å«æ‰€æœ‰å¿…éœ€å­—æ®µ',\n    nesting: 'æ”¯æŒå¤šå±‚åµŒå¥—ç»“æ„ï¼Œä¾¿äºå¤æ‚æ•°æ®ç®¡ç†'\n  },\nexample:[\nmemory('global_lore.npc.npcå§“å.å¯¹<user>å°è±¡', 'å†·æ·¡', 'xxx'); //å¯ä»¥å•ç‹¬æ›´æ–°ä¸€æ¡å¯¹<user>å°è±¡\n]\n});",
                    "constant": true,
                    "selective": true,
                    "insertion_order": 91,
                    "enabled": false,
                    "position": "after_char",
                    "use_regex": true,
                    "extensions": {
                        "position": 4,
                        "exclude_recursion": false,
                        "display_index": 36,
                        "probability": 100,
                        "useProbability": true,
                        "depth": 0,
                        "selectiveLogic": 0,
                        "group": "npcä¿¡æ¯",
                        "group_override": false,
                        "group_weight": 100,
                        "prevent_recursion": false,
                        "delay_until_recursion": false,
                        "scan_depth": null,
                        "match_whole_words": null,
                        "use_group_scoring": false,
                        "case_sensitive": null,
                        "automation_id": "",
                        "role": 0,
                        "vectorized": false,
                        "sticky": 0,
                        "cooldown": 0,
                        "delay": 0,
                        "match_persona_description": false,
                        "match_character_description": false,
                        "match_character_personality": false,
                        "match_character_depth_prompt": false,
                        "match_scenario": false,
                        "match_creator_notes": false,
                        "triggers": []
                    }
                },
                {
                    "id": 45,
                    "keys": [],
                    "secondary_keys": [],
                    "comment": "mod:èƒŒæ™¯å›¾å¼€",
                    "content": "{{setvar::bg_source::true}}",
                    "constant": true,
                    "selective": true,
                    "insertion_order": 100,
                    "enabled": true,
                    "position": "before_char",
                    "use_regex": true,
                    "extensions": {
                        "position": 0,
                        "exclude_recursion": false,
                        "display_index": 37,
                        "probability": 100,
                        "useProbability": true,
                        "depth": 4,
                        "selectiveLogic": 0,
                        "group": "",
                        "group_override": false,
                        "group_weight": 100,
                        "prevent_recursion": false,
                        "delay_until_recursion": false,
                        "scan_depth": null,
                        "match_whole_words": null,
                        "use_group_scoring": false,
                        "case_sensitive": null,
                        "automation_id": "",
                        "role": 0,
                        "vectorized": false,
                        "sticky": 0,
                        "cooldown": 0,
                        "delay": 0,
                        "match_persona_description": false,
                        "match_character_description": false,
                        "match_character_personality": false,
                        "match_character_depth_prompt": false,
                        "match_scenario": false,
                        "match_creator_notes": false,
                        "triggers": []
                    }
                },
                {
                    "id": 46,
                    "keys": [],
                    "secondary_keys": [],
                    "comment": "mod:èƒŒæ™¯å›¾å…³",
                    "content": "{{setvar::bg_source::false}}\n",
                    "constant": true,
                    "selective": true,
                    "insertion_order": 100,
                    "enabled": false,
                    "position": "before_char",
                    "use_regex": true,
                    "extensions": {
                        "position": 0,
                        "exclude_recursion": false,
                        "display_index": 38,
                        "probability": 100,
                        "useProbability": true,
                        "depth": 4,
                        "selectiveLogic": 0,
                        "group": "",
                        "group_override": false,
                        "group_weight": 100,
                        "prevent_recursion": false,
                        "delay_until_recursion": false,
                        "scan_depth": null,
                        "match_whole_words": null,
                        "use_group_scoring": false,
                        "case_sensitive": null,
                        "automation_id": "",
                        "role": 0,
                        "vectorized": false,
                        "sticky": 0,
                        "cooldown": 0,
                        "delay": 0,
                        "match_persona_description": false,
                        "match_character_description": false,
                        "match_character_personality": false,
                        "match_character_depth_prompt": false,
                        "match_scenario": false,
                        "match_creator_notes": false,
                        "triggers": []
                    }
                },
                {
                    "id": 47,
                    "keys": [],
                    "secondary_keys": [],
                    "comment": "ğŸ”°å¼€å¯å¿«ç…§è®¾ç½®ä»£ç ï¼Œåˆ«å…³",
                    "content": "\n<%_\n  // è·å–å½“å‰ç³»ç»Ÿæ—¶é—´\n  const now = new Date();\n \n  // æ ¼å¼åŒ–æ—¶é—´ä¸º mm_dd_hh_mm_ss æ ¼å¼\n  const month = String(now.getMonth() + 1).padStart(2, '0');  // æœˆä»½ (01-12)\n  const day = String(now.getDate()).padStart(2, '0');         // æ—¥æœŸ (01-31)\n  const hours = String(now.getHours()).padStart(2, '0');      // å°æ—¶ (00-23)\n  const minutes = String(now.getMinutes()).padStart(2, '0');  // åˆ†é’Ÿ (00-59)\n  const seconds = String(now.getSeconds()).padStart(2, '0');  // ç§’é’Ÿ (00-59)\n  \n  // æ‹¼æ¥æ—¶é—´å­—ç¬¦ä¸²\n  const timeString = `${month}_${day}_${hours}_${minutes}_${seconds}`;\n  \n  // æ£€æŸ¥save_slot_idæ˜¯å¦å·²å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨æ‰è®¾ç½®\n  if (!getLocalVar('save_slot_id')) {\n    setLocalVar('save_slot_id', timeString);\n  }\n%>",
                    "constant": true,
                    "selective": true,
                    "insertion_order": 100,
                    "enabled": true,
                    "position": "before_char",
                    "use_regex": true,
                    "extensions": {
                        "position": 0,
                        "exclude_recursion": false,
                        "display_index": 39,
                        "probability": 100,
                        "useProbability": true,
                        "depth": 4,
                        "selectiveLogic": 0,
                        "group": "",
                        "group_override": false,
                        "group_weight": 100,
                        "prevent_recursion": false,
                        "delay_until_recursion": false,
                        "scan_depth": null,
                        "match_whole_words": null,
                        "use_group_scoring": false,
                        "case_sensitive": null,
                        "automation_id": "",
                        "role": 0,
                        "vectorized": false,
                        "sticky": 0,
                        "cooldown": 0,
                        "delay": 0,
                        "match_persona_description": false,
                        "match_character_description": false,
                        "match_character_personality": false,
                        "match_character_depth_prompt": false,
                        "match_scenario": false,
                        "match_creator_notes": false,
                        "triggers": []
                    }
                },
                {
                    "id": 48,
                    "keys": [],
                    "secondary_keys": [],
                    "comment": "mod:npcç«‹ç»˜(å‰ç½®:npc pro)",
                    "content": " <%_\n \nfunction getDataWithFallback(varName) {\n      \n        let data = getLocalVar(varName);\n       \n        // å†…è”æ•°æ®éªŒè¯ï¼šæ£€æŸ¥æ˜¯å¦ä¸ºnullã€undefinedï¼Œä¸”å¦‚æœæ˜¯å¯¹è±¡è¦æœ‰å†…å®¹\n        const isValid = (data) => {\n            // æ£€æŸ¥æ˜¯å¦ä¸º null æˆ– undefined\n            if (data === null || data === undefined) {\n                return false;\n            }\n            \n            // å¦‚æœæ˜¯å¯¹è±¡ç±»å‹ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰å†…å®¹\n            if (typeof data === 'object' && data !== null) {\n                // å¦‚æœæ˜¯æ•°ç»„ï¼Œæ£€æŸ¥é•¿åº¦\n                if (Array.isArray(data)) {\n                    return data.length > 0;\n                }\n                // å¦‚æœæ˜¯æ™®é€šå¯¹è±¡ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰å±æ€§\n                return Object.keys(data).length > 0;\n            }\n            \n            // å…¶ä»–ç±»å‹ï¼ˆå­—ç¬¦ä¸²ã€æ•°å­—ã€å¸ƒå°”å€¼ç­‰ï¼‰åªè¦ä¸æ˜¯ null/undefined å°±è®¤ä¸ºæœ‰æ•ˆ\n            return true;\n        };\n        \n        // å¦‚æœæ•°æ®ä¸ç¬¦åˆè¦æ±‚ï¼Œä» getLocalVar è·å–\n        if (!isValid(data)) {\n            data = getLocalVar(varName);\n        }\n        \n        return data;\n    }\n\n \nif (typeof assaData === 'undefined') {\n    var  assaData = getDataWithFallback(\"assa_data\");\n}\n\nvar img_map= JSON.stringify(_.get(assaData, 'img_map',''));\n\n// é¦–å…ˆï¼Œåˆ›å»ºä¸€ä¸ªæ‰€æœ‰æœ‰æ•ˆNPCåå­—çš„é›†åˆï¼Œè¿™æ ·æ–¹ä¾¿æˆ‘ä»¬æŸ¥æ‰¾\nconst validNpcNames = new Set();\n\n// åƒä½ æ•™æˆ‘çš„é‚£æ ·ï¼Œå®‰å…¨åœ°è·å–æ‰€æœ‰NPCçš„åå­—\nconst addKeysToSet = (obj) => {\n    if (obj && typeof obj === 'object') {\n        Object.keys(obj).forEach(key => validNpcNames.add(key));\n    }\n};\n\naddKeysToSet(_.get(assaData, 'world_lore.npc'));\naddKeysToSet(_.get(assaData, 'global_lore.npc'));\naddKeysToSet(_.get(assaData, ['global_lore', 'å°é˜Ÿä¿¡æ¯'])); // è¿™æ ·å¯ä»¥æ­£ç¡®å¤„ç†åŠ¨æ€çš„é”®å\n\n// è·å–å®Œæ•´çš„ img_map å¯¹è±¡\nconst fullImgMap = _.get(assaData, 'img_map', {});\n\n// åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œåªå­˜æ”¾æœ‰æ•ˆçš„NPCç«‹ç»˜ä¿¡æ¯\nconst filteredImgMap = {};\nif (fullImgMap && typeof fullImgMap === 'object') {\n    for (const npcName in fullImgMap) {\n        // æ£€æŸ¥è¿™ä¸ªNPCçš„åå­—æ˜¯å¦åœ¨æˆ‘ä»¬çš„æœ‰æ•ˆåˆ—è¡¨é‡Œ\n        if (validNpcNames.has(npcName)) {\n            filteredImgMap[npcName] = fullImgMap[npcName];\n        }\n    }\n}\n\n// æœ€åï¼Œå°†æˆ‘ä»¬è¿‡æ»¤åçš„æ–°å¯¹è±¡è½¬æ¢æˆå­—ç¬¦ä¸²ï¼Œä¾›ç»™åé¢ä½¿ç”¨\nvar img_map_str_for_display = JSON.stringify(filteredImgMap);\n\n// æ”¶é›†æ‰€æœ‰å«æœ‰\"äº‹ä»¶\"å­—æ®µçš„NPCåç§°\nconst npcWithEventsButNoImage = [];\n\n// è·å–æ‰€æœ‰NPCæ•°æ®æº\nvar teamInfo = _.get(assaData, 'global_lore.å°é˜Ÿä¿¡æ¯', {});\nvar globalNpcs = _.get(assaData, 'global_lore.npc', {});\nvar worldNpcs = _.get(assaData, 'world_lore.npc', {});\nvar allNpcsData = Object.assign({}, worldNpcs, globalNpcs, teamInfo);\n\n// éå†æ‰€æœ‰NPC,æ£€æŸ¥æ˜¯å¦å«æœ‰\"äº‹ä»¶\"å­—æ®µä¸”æ²¡æœ‰ç«‹ç»˜æ˜ å°„\nfor (const npcName in allNpcsData) {\n    const npcData = allNpcsData[npcName];\n    const hasEvent = _.has(npcData, 'äº‹ä»¶');\n    const hasImageMapping = _.has(fullImgMap, npcName);\n    \n    // å¦‚æœæœ‰äº‹ä»¶ä½†æ²¡æœ‰ç«‹ç»˜æ˜ å°„,åˆ™æ·»åŠ åˆ°åˆ—è¡¨\n    if (hasEvent && !hasImageMapping) {\n        npcWithEventsButNoImage.push(npcName);\n    }\n}\n\n   var loadTextConfig = async function(filename = 'config.txt') {\n        const baseUrl = 'https://longlivecanc.github.io/god_space';\n        const fullUrl = `${baseUrl}/${filename}?v=${new Date().getTime()}`;\n        \n        try {\n            console.log(`æ­£åœ¨åŠ è½½æ–‡æœ¬æ–‡ä»¶: ${fullUrl}`);\n            const response = await fetch(fullUrl);\n            \n            if (!response.ok) {\n                throw new Error(`HTTPé”™è¯¯: ${response.status} ${response.statusText}`);\n            }\n            \n            const textContent = await response.text();\n            console.log('æ–‡æœ¬æ–‡ä»¶åŠ è½½æˆåŠŸ');\n            console.log(`æ–‡ä»¶å¤§å°: ${textContent.length} å­—ç¬¦`);\n            \n            return textContent;\n            \n        } catch (error) {\n            console.error('åŠ è½½æ–‡æœ¬æ–‡ä»¶å¤±è´¥:', error.message);\n            \n            const fallbackConfig = `Gender:[ç”·,å¥³],\nAge:[æˆå¹´],\nHairColor:[é»‘å‘,é“¶å‘,é‡‘å‘,çº¢å‘],\nHairLength:[çŸ­å‘,ä¸­é•¿å‘,é•¿å‘],\nOverallDescription:[å†·å³»,æ¸©æŸ”,æ´»æ³¼,å¿§éƒ,å‚²æ…¢],\nClothing:[ä¼‘é—²è£…,æ­£è£…,æˆ˜æ–—æœ,å¤è£…]\n`;\n            \n            console.log('ä½¿ç”¨å¤‡ç”¨é…ç½®');\n            return fallbackConfig;\n        }\n    };\n\n \nconst npcconfigText = await loadTextConfig('npcconfig.txt');\n_%>\n<%_ if (npcWithEventsButNoImage.length > 0) { \n    const npcEventsListString = JSON.stringify(npcWithEventsButNoImage);\n_%>\n.set('img_map', {\n    rule: 'åœ¨åˆå§‹åŒ–é‡è¦ä¸”æ´»è·ƒnpcæ—¶ï¼Œé¢å¤–çš„è¦ä½¿ç”¨memoryæŒ‡ä»¤ï¼Œåœ¨img_mapä¸­è®¾ç½®npc ç«‹ç»˜æ˜ å°„è¡¨ï¼Œåªèƒ½ä»å·²æœ‰çš„allowed_tagsä¸­ç»„åˆã€‚',\n   format:'Gender-Age-HairColor-HairLength-OverallDescription-Clothing, .e.g. memory(\"img_map\",\"npc1\",\"ç”·-æˆå¹´-é»‘å‘-çŸ­å‘-å†·å³»-æ­£è£…\")',\n  path:'img_map <%= img_map_str_for_display %>',\n//å¦‚æœæ²¡æœ‰åˆé€‚çš„åˆ†ç±»ï¼Œåˆ™å¿…é¡»è®¾ç½®è¯¥npcçš„ç«‹ç»˜ä¸ºâ€œæ— â€\n  allowed_tags: {\n<%= npcconfigText %>\n   },\n    ä»¥ä¸‹NPCè¿˜æ²¡æœ‰åˆå§‹åŒ–ç«‹ç»˜æ˜ å°„ï¼Œç«‹åˆ»åˆå§‹åŒ–: <%= npcEventsListString %>\n},\n<%_ } _%>",
                    "constant": true,
                    "selective": true,
                    "insertion_order": 92,
                    "enabled": true,
                    "position": "after_char",
                    "use_regex": true,
                    "extensions": {
                        "position": 4,
                        "exclude_recursion": false,
                        "display_index": 40,
                        "probability": 100,
                        "useProbability": true,
                        "depth": 0,
                        "selectiveLogic": 0,
                        "group": "",
                        "group_override": false,
                        "group_weight": 100,
                        "prevent_recursion": false,
                        "delay_until_recursion": false,
                        "scan_depth": null,
                        "match_whole_words": null,
                        "use_group_scoring": false,
                        "case_sensitive": null,
                        "automation_id": "",
                        "role": 0,
                        "vectorized": false,
                        "sticky": 0,
                        "cooldown": 0,
                        "delay": 0,
                        "match_persona_description": false,
                        "match_character_description": false,
                        "match_character_personality": false,
                        "match_character_depth_prompt": false,
                        "match_scenario": false,
                        "match_creator_notes": false,
                        "triggers": []
                    }
                },
                {
                    "id": 49,
                    "keys": [],
                    "secondary_keys": [],
                    "comment": "ğŸ’«å¯é€‰:åœ°å›¾åˆç†+",
                    "content": "{{setvar::map_rule::<mapAnalyze>}}\n.set('distance_control', {\n  rule: 'AIåœ¨æè¿°ç”¨æˆ·ç§»åŠ¨æ—¶ï¼Œå¿…é¡»è®¡ç®—å¹¶è€ƒè™‘å®é™…ç§»åŠ¨è·ç¦»ã€‚åå°æ€è€ƒï¼Œè®¡ç®—è¿‡ç¨‹ç¦æ­¢è¾“å‡ºåˆ°æ­£æ–‡ï¼Œæ­£æ–‡åªåšå°è¯´å¼å‘ˆç°',\n calculation_method: 'ç§»åŠ¨è·ç¦» = åæ ‡å·®å€¼ Ã— æ¯”ä¾‹å°ºå•ä½',\n        time_estimation: 'æ ¹æ®å®é™…è·ç¦»ä¼°ç®—åˆç†çš„ç§»åŠ¨æ—¶é—´',\n        examples: {\n          'å®¤å†…ç§»åŠ¨': 'æˆ¿é—´åˆ°æˆ¿é—´10åæ ‡å·® = 10ç±³ï¼Œæ­¥è¡Œçº¦10-15ç§’',\n          'å»ºç­‘å†…ç§»åŠ¨': 'æ¥¼å±‚é—´50åæ ‡å·® = 50ç±³ï¼Œæ­¥è¡Œçº¦1-2åˆ†é’Ÿ',\n          'ç¤¾åŒºå†…ç§»åŠ¨': 'è¡—åŒºé—´20åæ ‡å·® = 200ç±³ï¼Œæ­¥è¡Œçº¦2-3åˆ†é’Ÿ',\n          'åŸåŒºç§»åŠ¨': 'åŒºåŸŸé—´10åæ ‡å·® = 1000ç±³ï¼Œæ­¥è¡Œçº¦10-12åˆ†é’Ÿ'\n        },\nmovement_description: 'AIå¿…é¡»åœ¨ç§»åŠ¨æè¿°ä¸­ä½“ç°å®é™…è·ç¦»æ„Ÿï¼Œé¿å…ç¬ç§»å¼ç§»åŠ¨'\n  mandatory_checks: {\n    before_movement: [\n      'è®¡ç®—èµ·ç‚¹å’Œç»ˆç‚¹çš„åæ ‡å·®å€¼',\n      'æ ¹æ®å½“å‰æ¯”ä¾‹å°ºæ¢ç®—å®é™…è·ç¦»',\n      'è¯„ä¼°ç§»åŠ¨çš„åˆç†æ€§å’Œæ‰€éœ€æ—¶é—´',\n      'æ£€æŸ¥è·¯å¾„ä¸Šæ˜¯å¦æœ‰éšœç¢æˆ–å…¶ä»–åœ°ç‚¹'\n    ],\n    during_description: [\n      'å¿…é¡»æåŠå®é™…ç§»åŠ¨è·ç¦»æˆ–æ—¶é—´æ„Ÿ',\n      'æè¿°ç§»åŠ¨è¿‡ç¨‹ä¸­çš„åœºæ™¯å˜åŒ–',\n      'ä½“ç°è·ç¦»å¸¦æ¥çš„çœŸå®æ„Ÿï¼ˆå¦‚ï¼šæ°”å–˜ã€è¿œè¿‘æ„Ÿç­‰ï¼‰'\n    ],\n    distance_realism: {\n      'è¿‘è·ç¦»ç§»åŠ¨(<10ç±³)': 'å³æ—¶åˆ°è¾¾ï¼Œæ— éœ€ç‰¹åˆ«æè¿°æ—¶é—´',\n      'ä¸­è·ç¦»ç§»åŠ¨(10-100ç±³)': 'éœ€è¦å‡ ç§’åˆ°å‡ åˆ†é’Ÿï¼Œå¯æè¿°æ²¿é€”æ™¯è±¡',\n      'è¿œè·ç¦»ç§»åŠ¨(>100ç±³)': 'éœ€è¦æ˜ç¡®æ—¶é—´æ¶ˆè€—ï¼Œå¯èƒ½è§¦å‘åœºæ™¯åˆ‡æ¢'\n    }\n  },\n  error_prevention: {\n    'ç¦æ­¢ç¬ç§»': 'AIä¸å¾—è®©ç”¨æˆ·ç¬é—´å‡ºç°åœ¨è·ç¦»è¾ƒè¿œçš„åœ°ç‚¹',\n    'è·ç¦»ä¸€è‡´æ€§': 'åŒæ ·çš„åæ ‡å·®å€¼å¿…é¡»å¯¹åº”ç›¸åŒçš„å®é™…è·ç¦»',\n    'æ¯”ä¾‹å°ºé”å®š': 'åŒä¸€åœ°å›¾å†…æ¯”ä¾‹å°ºä¸å¾—éšæ„æ”¹å˜',\n    'ç°å®é€»è¾‘': 'ç§»åŠ¨å¿…é¡»ç¬¦åˆç‰©ç†ä¸–ç•Œçš„æ—¶é—´å’Œç©ºé—´é€»è¾‘'\n  }\n})",
                    "constant": true,
                    "selective": true,
                    "insertion_order": 105,
                    "enabled": true,
                    "position": "before_char",
                    "use_regex": true,
                    "extensions": {
                        "position": 0,
                        "exclude_recursion": false,
                        "display_index": 41,
                        "probability": 100,
                        "useProbability": true,
                        "depth": 4,
                        "selectiveLogic": 0,
                        "group": "",
                        "group_override": false,
                        "group_weight": 100,
                        "prevent_recursion": false,
                        "delay_until_recursion": false,
                        "scan_depth": null,
                        "match_whole_words": null,
                        "use_group_scoring": false,
                        "case_sensitive": null,
                        "automation_id": "",
                        "role": 0,
                        "vectorized": false,
                        "sticky": 0,
                        "cooldown": 0,
                        "delay": 0,
                        "match_persona_description": false,
                        "match_character_description": false,
                        "match_character_personality": false,
                        "match_character_depth_prompt": false,
                        "match_scenario": false,
                        "match_creator_notes": false,
                        "triggers": []
                    }
                },
                {
                    "id": 50,
                    "keys": [],
                    "secondary_keys": [],
                    "comment": "ğŸ”®è¯¸å¤©ç¾¤èŠ-è§„åˆ™",
                    "content": "<%_\n \nfunction getDataWithFallback(varName) {\n    \n        let data = getLocalVar(varName);\n       \n        // å†…è”æ•°æ®éªŒè¯ï¼šæ£€æŸ¥æ˜¯å¦ä¸ºnullã€undefinedï¼Œä¸”å¦‚æœæ˜¯å¯¹è±¡è¦æœ‰å†…å®¹\n        const isValid = (data) => {\n            // æ£€æŸ¥æ˜¯å¦ä¸º null æˆ– undefined\n            if (data === null || data === undefined) {\n                return false;\n            }\n            \n            // å¦‚æœæ˜¯å¯¹è±¡ç±»å‹ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰å†…å®¹\n            if (typeof data === 'object' && data !== null) {\n                // å¦‚æœæ˜¯æ•°ç»„ï¼Œæ£€æŸ¥é•¿åº¦\n                if (Array.isArray(data)) {\n                    return data.length > 0;\n                }\n                // å¦‚æœæ˜¯æ™®é€šå¯¹è±¡ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰å±æ€§\n                return Object.keys(data).length > 0;\n            }\n            \n            // å…¶ä»–ç±»å‹ï¼ˆå­—ç¬¦ä¸²ã€æ•°å­—ã€å¸ƒå°”å€¼ç­‰ï¼‰åªè¦ä¸æ˜¯ null/undefined å°±è®¤ä¸ºæœ‰æ•ˆ\n            return true;\n        };\n        \n        // å¦‚æœæ•°æ®ä¸ç¬¦åˆè¦æ±‚ï¼Œä» getLocalVar è·å–\n        if (!isValid(data)) {\n            data = getLocalVar(varName);\n        }\n        \n        return data;\n    }\n\n \nif (typeof assaData === 'undefined') {\n    var  assaData = getDataWithFallback(\"assa_data\");\n}\n\nvar img_map= JSON.stringify(_.get(assaData, 'img_map',''));\n\n     var loadTextConfig = async function(filename = 'config.txt') {\n        const baseUrl = 'https://longlivecanc.github.io/god_space';\n        const fullUrl = `${baseUrl}/${filename}?v=${new Date().getTime()}`;\n        \n        try {\n            console.log(`æ­£åœ¨åŠ è½½æ–‡æœ¬æ–‡ä»¶: ${fullUrl}`);\n            const response = await fetch(fullUrl);\n            \n            if (!response.ok) {\n                throw new Error(`HTTPé”™è¯¯: ${response.status} ${response.statusText}`);\n            }\n            \n            const textContent = await response.text();\n            console.log('æ–‡æœ¬æ–‡ä»¶åŠ è½½æˆåŠŸ');\n            console.log(`æ–‡ä»¶å¤§å°: ${textContent.length} å­—ç¬¦`);\n            \n            return textContent;\n            \n        } catch (error) {\n            console.error('åŠ è½½æ–‡æœ¬æ–‡ä»¶å¤±è´¥:', error.message);\n            \n            const fallbackConfig = `[ä¸‰åªçŒ«-éœ‡æƒŠ,  æŸ´éƒ¡-æ²¡æœ‰çƒ¦æ¼, æŸ´éƒ¡é€’ç«ç‘°-ä¸Šç½‘ä¸ºäº†ç­‰ä½ , è´´å§-å¾®ç¬‘, æŸ´éƒ¡-çœ‹ç¬¨è›‹, è´´å§-å¼€å¿ƒ, è´´å§-å¤§ç¬‘, å¯çˆ±ç‚¹èµ, è´´å§-éƒé—·, å¡é€šå…”è™šè„±, çŒ«å¬å®Œé†’äº†, è´´å§-å¥½è€¶, æ±¤å§†çŒ«éœ‡æƒŠ, è´´å§-å•Šï¼Ÿ, é˜´æš—çˆ¬è¡Œ, æ°ç‘é¼ -éœ‡æƒŠ, å¡é€šæé¾™ç‚¹èµ, éª·é«…è·³èˆ, æˆ‘çš„è‚¯å®š, è´´å§-æ„¤æ€’,çš®å¡ä¸˜æµæ³ª, çŒ«æ„¤æ€’çˆ†ç‚¸, è£…å‚»æµå£æ°´, è´´å§-ç–‘æƒ‘, æ±¤å§†çŒ«å¿ƒè™š, çŒ«çŒ¥çç¬‘, ç”·äººå¥åº·ç¬‘ç‚¹èµ, ç‹—å¤´å‡å¤©]`;\n            \n            console.log('ä½¿ç”¨å¤‡ç”¨é…ç½®');\n            return fallbackConfig;\n        }\n    };\nvar memeconfigText = await loadTextConfig('memeconfig.txt');\nvar world_role = getLocalVar(\"world_role\", \"\");\n_%>\n<å¿…é¡»æ›´æ–°ç¾¤èŠ>\næ¯æ¬¡è¾“å‡ºæ­£æ–‡åï¼Œå¿…é¡»åœ¨æ–‡æœ«è¿½åŠ ä¸€æ®µå³æ—¶ç¾¤èŠã€‚è‹¥æ— ç¾¤å‘˜ï¼Œåˆ™ä¸è¾“å‡ºã€‚è‹¥æ­£æ–‡å†…å·²æœ‰ç¾¤èŠå†…å®¹ï¼Œåˆ™ä¸è¾“å‡ºã€‚\nè¯¥ç¾¤èŠåœ¨æ—¶é—´ä¸Šä¸ä¸”åªä¸LLMå½“å‰å›å¤æ­£æ–‡å®Œå…¨åŒæ­¥ï¼Œä½†å†…å®¹ä¸Šç›¸å¯¹ç‹¬ç«‹ã€‚è‹¥<user>æœªä¸»åŠ¨åˆ†äº«ï¼Œåˆ™ç¾¤èŠæˆå‘˜æ— æ³•å¾—çŸ¥<user>è§†è§’å‘ç”Ÿçš„**ä»»ä½•**äº‹ä»¶ï¼Œ**ç¦æ­¢**è®©ç¾¤å‘˜æœ‰ç±»ä¼¼`ç›´æ’­`çš„è§†è§’ã€‚\nç¾¤èŠé¡»éµå¾ªä»¥ä¸‹åŸåˆ™ï¼š\nè§„æ ¼: ç”Ÿæˆ10-20æ¡èŠå¤©è®°å½•ï¼Œå¹¶ä¿æŒæ ¼å¼æ­£ç¡®ã€‚\nè§’è‰²: ç™»åœºç¾¤å‘˜ä¼˜å…ˆä¸ºæ­£æ–‡å·²ç™»åœº/æˆä»½å¤šçš„ä¸”**å·²ç»æ˜¯**ç¾¤å‘˜çš„è§’è‰²ï¼Œå…¶æ¬¡ä¸º<user>åœ¨å½“å‰ä¸–ç•Œè§‚ä¸‹å¯èƒ½æ¥è§¦åˆ°çš„å…¶ä»–ç¾¤å‘˜ã€‚**ä¸æ˜¯ç¾¤å‘˜**çš„npcåˆ™ç¦æ­¢åœ¨ç¾¤èŠä¸­å‘è¨€ã€‚\nå†…å®¹: å¯¹è¯åº”è‡ªç„¶ã€ç”Ÿæ´»åŒ–ã€éšæœºåŒ–ã€‚\nä¿¡æ¯éš”ç¦»ï¼š**åœ¨ç¾¤å‘˜ä¹‹é—´ï¼ˆåŒ…æ‹¬<user>ï¼‰å…±äº«ä¸–ç•Œä¿¡æ¯/è‡ªå·±çš„ä¿¡æ¯å‰ï¼Œå…¶ä»–ç¾¤å‘˜ç¦æ­¢æ‹¥æœ‰å…¨çŸ¥è§†è§’/ç›´æ’­è§†è§’ã€ç¦æ­¢å¾—çŸ¥è¯¥ç¾¤å‘˜çŠ¶æ€ä¿¡æ¯ã€ç¦æ­¢é”™è¯¯å¾—çŸ¥<user>å¤„çš„å‰§æƒ…å‘å±•ä¿¡æ¯ã€‚**\n\næ—¶é—´çº¿ç®¡ç†ï¼šæ¯æ¬¡è¾“å‡ºéƒ½åŸºäºä¹‹å‰çš„èŠå¤©çŠ¶æ€ï¼Œè§’è‰²å…³ç³»å’Œè¯é¢˜è‡ªç„¶æ¼”è¿›ã€‚èŠå¤©ç¾¤æœ‰ç‹¬ç«‹çš„å‘å±•è½¨è¿¹ï¼Œç¦æ­¢å›´ç»•<user>å‘å±•ã€‚éœ€æ¨¡æ‹ŸçœŸå®QQç¾¤èŠå¤©èŠ‚å¥ï¼Œæ¯ä¸ªè§’è‰²ä¿æŒä¸€è‡´çš„è¯´è¯é£æ ¼å’Œæ€§æ ¼ï¼Œè§’è‰²ä¹‹é—´æœ‰çœŸå®çš„äº’åŠ¨å’Œååº”ã€‚\n</å¿…é¡»æ›´æ–°ç¾¤èŠ>",
                    "constant": true,
                    "selective": true,
                    "insertion_order": 500,
                    "enabled": true,
                    "position": "after_char",
                    "use_regex": true,
                    "extensions": {
                        "position": 4,
                        "exclude_recursion": false,
                        "display_index": 43,
                        "probability": 100,
                        "useProbability": true,
                        "depth": 0,
                        "selectiveLogic": 0,
                        "group": "è¯¸å¤©ç¾¤èŠè§„åˆ™",
                        "group_override": false,
                        "group_weight": 100,
                        "prevent_recursion": false,
                        "delay_until_recursion": false,
                        "scan_depth": null,
                        "match_whole_words": null,
                        "use_group_scoring": false,
                        "case_sensitive": null,
                        "automation_id": "",
                        "role": 0,
                        "vectorized": false,
                        "sticky": 0,
                        "cooldown": 0,
                        "delay": 0,
                        "match_persona_description": false,
                        "match_character_description": false,
                        "match_character_personality": false,
                        "match_character_depth_prompt": false,
                        "match_scenario": false,
                        "match_creator_notes": false,
                        "triggers": []
                    }
                },
                {
                    "id": 51,
                    "keys": [],
                    "secondary_keys": [],
                    "comment": "mod:ç§°å·ç³»ç»Ÿ",
                    "content": "{{setvar::chenghao::,'ç§°å·'}}<%_\n// å°è£…çš„æ•°æ®è·å–å‡½æ•° - é¿å…é‡å¤å®šä¹‰\n \n    function getDataWithFallback(varName) {\n   \n        let data = getLocalVar(varName);\n       \n        // å†…è”æ•°æ®éªŒè¯ï¼šæ£€æŸ¥æ˜¯å¦ä¸ºnullã€undefinedï¼Œä¸”å¦‚æœæ˜¯å¯¹è±¡è¦æœ‰å†…å®¹\n        const isValid = (data) => {\n            // æ£€æŸ¥æ˜¯å¦ä¸º null æˆ– undefined\n            if (data === null || data === undefined) {\n                return false;\n            }\n            \n            // å¦‚æœæ˜¯å¯¹è±¡ç±»å‹ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰å†…å®¹\n            if (typeof data === 'object' && data !== null) {\n                // å¦‚æœæ˜¯æ•°ç»„ï¼Œæ£€æŸ¥é•¿åº¦\n                if (Array.isArray(data)) {\n                    return data.length > 0;\n                }\n                // å¦‚æœæ˜¯æ™®é€šå¯¹è±¡ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰å±æ€§\n                return Object.keys(data).length > 0;\n            }\n            \n            // å…¶ä»–ç±»å‹ï¼ˆå­—ç¬¦ä¸²ã€æ•°å­—ã€å¸ƒå°”å€¼ç­‰ï¼‰åªè¦ä¸æ˜¯ null/undefined å°±è®¤ä¸ºæœ‰æ•ˆ\n            return true;\n        };\n        \n        // å¦‚æœæ•°æ®ä¸ç¬¦åˆè¦æ±‚ï¼Œä» getLocalVar è·å–\n        if (!isValid(data)) {\n            data = getLocalVar(varName);\n        }\n\n // å¦‚æœè¿˜æ˜¯æ— æ•ˆï¼Œè¿”å›ç©ºå¯¹è±¡ä½œä¸ºé»˜è®¤å€¼\n    if (!isValid(data)) {\n        data = {};\n    }\n        \n        return data;\n    }\n \n \nif (typeof assaData === 'undefined') {\n    var  assaData = getDataWithFallback(\"assa_data\");\n}\n \n\nconst global_lore_title = JSON.stringify(_.get(assaData, 'global_lore.ç§°å·', 'æ— '));\n var player_role = getLocalVar(\"player_role\", \"è½®å›è€…\");\n_%>\nmemory.load('global_lore.ç§°å·', {\nscope:\"<user>æ‰€æ‹¥æœ‰çš„ç§°å·,<user>å¯è‡ªç”±å†³å®šæ¯ä¸ªç§°å·æ˜¯å¦æ˜¾ç¤ºã€‚å½“è¯¥ç§°å·çŠ¶æ€æ˜¯å¯è§çš„æ—¶å€™ï¼Œåªæœ‰<%=player_role %>å¯è§\",\n  add_rule: 'å½“<user>è¾¾æˆäº†æŸç§è¶£å‘³/æéš¾æˆå°±(AIè‡ªå·±ç¼–å†™)æ—¶ï¼Œè®°å¿†å…¶ç§°å·ã€‚æ ¼å¼æ˜¯\"${ç§°å·åç§°}\":{\"è¾¾æˆæ¡ä»¶\":\"\",\"æè¿°\":\"\",\"å¤–è§‚æ•ˆæœ\":\"\",\"æ˜¯å¦æ˜¾ç¤º\":\"false/true\"}ã€‚',\n  operation_instructions:['memory','delete'],\n   path: 'global_lore.ç§°å·<%=global_lore_title %>' },\n});",
                    "constant": true,
                    "selective": true,
                    "insertion_order": 121,
                    "enabled": true,
                    "position": "before_char",
                    "use_regex": true,
                    "extensions": {
                        "position": 0,
                        "exclude_recursion": false,
                        "display_index": 44,
                        "probability": 100,
                        "useProbability": true,
                        "depth": 4,
                        "selectiveLogic": 0,
                        "group": "",
                        "group_override": false,
                        "group_weight": 100,
                        "prevent_recursion": false,
                        "delay_until_recursion": false,
                        "scan_depth": null,
                        "match_whole_words": null,
                        "use_group_scoring": false,
                        "case_sensitive": null,
                        "automation_id": "",
                        "role": 0,
                        "vectorized": false,
                        "sticky": 0,
                        "cooldown": 0,
                        "delay": 0,
                        "match_persona_description": false,
                        "match_character_description": false,
                        "match_character_personality": false,
                        "match_character_depth_prompt": false,
                        "match_scenario": false,
                        "match_creator_notes": false,
                        "triggers": []
                    }
                },
                {
                    "id": 52,
                    "keys": [],
                    "secondary_keys": [],
                    "comment": "ğŸ²è¡¨ç°éª°å¼€",
                    "content": "{{setvar::behavior_dice::true}}",
                    "constant": true,
                    "selective": true,
                    "insertion_order": 100,
                    "enabled": false,
                    "position": "before_char",
                    "use_regex": true,
                    "extensions": {
                        "position": 0,
                        "exclude_recursion": false,
                        "display_index": 45,
                        "probability": 100,
                        "useProbability": true,
                        "depth": 4,
                        "selectiveLogic": 0,
                        "group": "",
                        "group_override": false,
                        "group_weight": 100,
                        "prevent_recursion": false,
                        "delay_until_recursion": false,
                        "scan_depth": null,
                        "match_whole_words": null,
                        "use_group_scoring": false,
                        "case_sensitive": null,
                        "automation_id": "",
                        "role": 0,
                        "vectorized": false,
                        "sticky": 0,
                        "cooldown": 0,
                        "delay": 0,
                        "match_persona_description": false,
                        "match_character_description": false,
                        "match_character_personality": false,
                        "match_character_depth_prompt": false,
                        "match_scenario": false,
                        "match_creator_notes": false,
                        "triggers": []
                    }
                },
                {
                    "id": 53,
                    "keys": [],
                    "secondary_keys": [],
                    "comment": "ğŸ²è¡¨ç°éª°å…³",
                    "content": "{{setvar::behavior_dice::false}}",
                    "constant": true,
                    "selective": true,
                    "insertion_order": 100,
                    "enabled": true,
                    "position": "before_char",
                    "use_regex": true,
                    "extensions": {
                        "position": 0,
                        "exclude_recursion": false,
                        "display_index": 46,
                        "probability": 100,
                        "useProbability": true,
                        "depth": 4,
                        "selectiveLogic": 0,
                        "group": "",
                        "group_override": false,
                        "group_weight": 100,
                        "prevent_recursion": false,
                        "delay_until_recursion": false,
                        "scan_depth": null,
                        "match_whole_words": null,
                        "use_group_scoring": false,
                        "case_sensitive": null,
                        "automation_id": "",
                        "role": 0,
                        "vectorized": false,
                        "sticky": 0,
                        "cooldown": 0,
                        "delay": 0,
                        "match_persona_description": false,
                        "match_character_description": false,
                        "match_character_personality": false,
                        "match_character_depth_prompt": false,
                        "match_scenario": false,
                        "match_creator_notes": false,
                        "triggers": []
                    }
                },
                {
                    "id": 54,
                    "keys": [],
                    "secondary_keys": [],
                    "comment": "mod:G:DLC æœ«æ—¥",
                    "content": "{{setvar::world_version::7}}{{setvar::player_role::å…¶ä»–ä¸–ç•Œçš„äºº}}{{setvar::world_role::æœ«æ—¥}}{{setvar::point_role::è´§å¸}}{{setvar::zhixian_role:: }}{{setvar::xp_role::ç»éªŒå€¼}}{{setvar::player_rank:: }}{{setvar::tier_role:: }}{{setvar::profession_role:: }} \n \n{{char}}æ‰€æ‰®æ¼”çš„ä¸æ˜¯å…·ä½“çš„è§’è‰²ï¼Œè€Œæ˜¯ä¸€ä¸ªRPGæ–‡å­—æ¸¸æˆæ¨¡æ‹Ÿå™¨ã€‚ä»»åŠ¡æ˜¯æ ¹æ®{{user}}çš„å‚ä¸å¼äº’åŠ¨å†…å®¹ï¼Œåœ¨ç¬¦åˆè®¾å®šä¸‹ï¼Œç”Ÿæˆå°è¯´å¼å†…å®¹ï¼Œæä¾›é«˜æ²‰æµ¸çš„è§’è‰²æ‰®æ¼”ä½“éªŒã€‚\n\n\n<%_\n// å°è£…çš„æ•°æ®è·å–å‡½æ•° - é¿å…é‡å¤å®šä¹‰\nif (typeof getDataWithFallback === 'undefined') {\n    function getDataWithFallback(varName) {\n   \n        let data = getLocalVar(varName);\n       \n        // å†…è”æ•°æ®éªŒè¯ï¼šæ£€æŸ¥æ˜¯å¦ä¸ºnullã€undefinedï¼Œä¸”å¦‚æœæ˜¯å¯¹è±¡è¦æœ‰å†…å®¹\n        const isValid = (data) => {\n            // æ£€æŸ¥æ˜¯å¦ä¸º null æˆ– undefined\n            if (data === null || data === undefined) {\n                return false;\n            }\n            \n            // å¦‚æœæ˜¯å¯¹è±¡ç±»å‹ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰å†…å®¹\n            if (typeof data === 'object' && data !== null) {\n                // å¦‚æœæ˜¯æ•°ç»„ï¼Œæ£€æŸ¥é•¿åº¦\n                if (Array.isArray(data)) {\n                    return data.length > 0;\n                }\n                // å¦‚æœæ˜¯æ™®é€šå¯¹è±¡ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰å±æ€§\n                return Object.keys(data).length > 0;\n            }\n            \n            // å…¶ä»–ç±»å‹ï¼ˆå­—ç¬¦ä¸²ã€æ•°å­—ã€å¸ƒå°”å€¼ç­‰ï¼‰åªè¦ä¸æ˜¯ null/undefined å°±è®¤ä¸ºæœ‰æ•ˆ\n            return true;\n        };\n        \n        // å¦‚æœæ•°æ®ä¸ç¬¦åˆè¦æ±‚ï¼Œä» getLocalVar è·å–\n        if (!isValid(data)) {\n            data = getLocalVar(varName);\n        }\n        \n        return data;\n    }\n}\n\nif (typeof assaData === 'undefined') {\n    var  assaData = getDataWithFallback(\"assa_data\");\n}\n\n    // å®‰å…¨åœ°æ£€æŸ¥æ‰€éœ€çš„æ•°æ®æ˜¯å¦å­˜åœ¨\n    if (_.has(assaData, 'global_lore.settings.æ—¶é—´èŠ‚ç‚¹') && _.has(assaData, 'global_lore.settings.ç±»å‹')) {\n        const timeNode = assaData.global_lore.settings.æ—¶é—´èŠ‚ç‚¹;\n        const worldType = assaData.global_lore.settings.ç±»å‹;\n\n        // =================================================================\n        // --- å†…å®¹é…ç½®åŒº ---\n        // åœ¨è¿™é‡Œé›†ä¸­ç®¡ç†æ‰€æœ‰ä¸–ç•Œç±»å‹çš„ä¸“å±èƒŒæ™¯å’Œæ—¶é—´çº¿æè¿°ã€‚\n        // æ‚¨å¯ä»¥éšæ—¶åœ¨æ­¤å¤„æ·»åŠ æˆ–ä¿®æ”¹ã€ä¸–ç•ŒèƒŒæ™¯ã€‘çš„å…·ä½“å†…å®¹ï¼Œæ”¯æŒé•¿æ–‡æœ¬å’Œæ¢è¡Œã€‚\n        // =================================================================\n        \n        // 1. å®šä¹‰æ‰€æœ‰æ—¶é—´çº¿é˜¶æ®µçš„é€šç”¨æè¿°\n        const timelineDetails = {\n            'æœ«æ—¥å‰': \"ç°å®ä¸–ç•Œåœ°çƒå†2025,ç°ä»£ç¤¾ä¼šã€‚\",\n            'æ½œä¼çš„å¼€ç«¯': \"ä¸“æ³¨äºæç»˜å·¨å˜æ¥ä¸´å‰,é‚£äº›è¢«å¤§å¤šæ•°äººå¿½ç•¥çš„å¾®å¦™å¾å…†ã€‚æ•…äº‹çš„èµ·ç‚¹å¯èƒ½åªæ˜¯ä¸€ä¸ªå†å¯»å¸¸ä¸è¿‡çš„ä¸‹åˆ,ä½†ç©ºæ°”ä¸­å·²ç»å¼¥æ¼«ç€ä¸åŒå¯»å¸¸çš„æ°”æ¯ã€‚ä»ä¸€ä¸ªæ— æ³•è§£é‡Šçš„ç°è±¡,ä¸€ä¸ªå¥‡æ€ªçš„ä¼ é—»,ä¸€ä¸ªåå¸¸çš„ç»†èŠ‚å¼€å§‹,å±æœºæ„Ÿå¦‚æ°´é“¶æ³»åœ°,æ— å£°æ— æ¯åœ°æ¸—é€è¿›æ¥ã€‚\",\n            'æœ«æ—¥ä¸­é€”': \"å±æœºå·²ç»çˆ†å‘,æ—§ä¸–ç•Œçš„ç§©åºæ­£åœ¨å´©æºƒæˆ–å·²ç»è¡ç„¶æ— å­˜ã€‚è§’è‰²è¢«ç›´æ¥æŠ•å…¥åˆ°ä¸€ä¸ªå……æ»¡ä¸ç¡®å®šæ€§å’Œå³æ—¶å±é™©çš„ç¯å¢ƒä¸­ã€‚å¼€å±€å³æ˜¯ç”Ÿå­˜æŒ‘æˆ˜,éœ€è¦ç«‹åˆ»åšå‡ºååº”,åœ¨æ··ä¹±ä¸­å¯»æ‰¾ç«‹è¶³ä¹‹åœ°,å¹¶å¿«é€Ÿäº†è§£è¿™ä¸ªå·²ç»é¢ç›®å…¨éçš„ä¸–ç•Œçš„æ–°è§„åˆ™ã€‚\",\n            'ä½™çƒ¬ä¸­çš„æ–°ç”Ÿ': \"å¤§ç¾éš¾çš„å°˜åŸƒæ—©å·²è½å®š,ä¸–ç•Œè¿›å…¥äº†ä¸€ä¸ªç›¸å¯¹ç¨³å®šçš„â€œåæœ«æ—¥æ—¶ä»£â€ã€‚æ—§æ—¥çš„è¾‰ç…Œå·²æˆä¼ è¯´,äººç±»åœ¨åºŸå¢Ÿä¹‹ä¸Šå»ºç«‹èµ·äº†æ–°çš„æ–‡æ˜å½¢æ€ã€æ–°çš„ç¤¾ä¼šç§©åºå’Œæ–°çš„ç”Ÿå­˜æ³•åˆ™ã€‚è§’è‰²çš„æ•…äº‹,å°†ä»è¿™ä¸ªç•¸å½¢å´ç¨³å®šçš„æ–°ä¸–ç•Œä¸­å±•å¼€,æ¢ç´¢æ–‡æ˜çš„ç¢ç‰‡,é¢å¯¹äººæ€§çš„æŒ£æ‰,æˆ–è¯•å›¾æ­å¼€æœ«æ—¥å°˜å°çš„çœŸç›¸ã€‚\"\n        };\n\n        // 2. å®šä¹‰æ¯ä¸ªä¸–ç•Œçš„ä¸“å±æ•°æ®\n        const worldData = {\n            'çº¢æœˆå…±ç”Ÿä½“': {\n                // åœ¨åå¼•å·(``)ä¸­å¡«å…¥ä¸“å±çš„ã€å¯æ¢è¡Œçš„é•¿ç¯‡ä¸–ç•ŒèƒŒæ™¯\n                background: `  ã€ä¸–ç•ŒèƒŒæ™¯ã€‘\n  ç¾éš¾æºè‡ªä¸€é¢—æºå¸¦å¤–æ˜ŸçœŸèŒå­¢å­ï¼ˆåè¢«ç§°ä¸ºâ€œç»¯çº¢çœŸèŒâ€ï¼‰çš„é™¨çŸ³ã€‚å…¶å è½åï¼Œå­¢å­é€šè¿‡å¤§æ°”å¾ªç¯æ‰©æ•£è‡³å…¨çƒã€‚èµ·åˆï¼Œå®ƒå¹¶æœªå¼•èµ·æ³¨æ„ï¼Œç›´åˆ°ç¬¬ä¸€ä¸ªçº¢æœˆä¹‹å¤œçš„é™ä¸´ã€‚åœ¨çº¢æœˆçš„ç‰¹æ®Šè¾å°„ä¸‹ï¼Œè¢«çœŸèŒå¯„ç”Ÿçš„äººç±»ä¼šå¤±å»ç†æ™ºï¼Œèº«ä½“å‘ç”Ÿææ€–å˜å¼‚ï¼Œæˆä¸ºåªçŸ¥çŒé£Ÿçš„æ€ªç‰©â€œæœˆè£”â€ã€‚ç™½å¤©ï¼Œæœˆè£”ä¼šæ¢å¤äººå½¢å’Œç†æ™ºï¼Œç”šè‡³ä¼šè·å¾—çœŸèŒèµ‹äºˆçš„è¶…å¸¸èƒ½åŠ›ã€‚æ—§ä¸–ç•Œåœ¨å‡ æ¬¡æœˆå¤œçš„åŠ¨ä¹±åå´©æºƒï¼Œå¹¸å­˜è€…æ´»åœ¨åŒé‡ææƒ§ä¸­ï¼šæ—¢è¦æŠµå¾¡å¤œæ™šçš„æ€ªç‰©ï¼Œåˆè¦æé˜²ç™½å¤©èº«è¾¹æ½œè—çš„â€œæœ‹å‹â€ã€‚\n  ã€æ ¸å¿ƒæ¦‚å¿µã€‘\n  1.  ç»¯çº¢çœŸèŒï¼ˆThe Symbioteï¼‰ï¼šä¸€ç§å¤–æ˜Ÿå¾®ç”Ÿç‰©ï¼Œå®ƒä¸å®¿ä¸»å½¢æˆä¸€ç§å¥‡ç‰¹çš„å…±ç”Ÿå…³ç³»ã€‚å®ƒä¿®å¤å®¿ä¸»çš„èº«ä½“ç¼ºé™·ï¼Œå¼ºåŒ–å…¶ç”Ÿç†æœºèƒ½ï¼Œå¹¶èµ‹äºˆè¶…èƒ½åŠ›ã€‚ä½†å®ƒçš„æœ€ç»ˆç›®çš„æ˜¯åœ¨çº¢æœˆä¹‹å¤œå¤ºå–å®¿ä¸»çš„æ§åˆ¶æƒï¼Œè¿›è¡Œç¹æ®–å’Œæ‰©å¼ ã€‚çœŸèŒé€šè¿‡ä½“æ¶²å’Œç©ºæ°”ä¼ æ’­ï¼Œæ„ŸæŸ“å…·æœ‰é«˜åº¦éšè”½æ€§ã€‚\n  2.  çº¢æœˆï¼ˆBlood Moonï¼‰ï¼šæœˆçƒè¢«ä¸€ç§æœªçŸ¥çš„å®‡å®™å°˜åŸƒè¦†ç›–ï¼Œä½¿å…¶åœ¨å¤œæ™šå‘ˆç°è¡€çº¢è‰²ã€‚è¿™ç§å°˜åŸƒä¼šå‘å‡ºä¸€ç§ç‰¹æ®Šçš„è¾å°„ï¼Œèƒ½å¤Ÿæ¿€æ´»å®¿ä¸»ä½“å†…çš„ç»¯çº¢çœŸèŒï¼Œä½¿å…¶è¿›å…¥ç‹‚æš´çš„â€œçŒé£Ÿæ€â€ã€‚çº¢æœˆå¹¶éæ¯æ™šéƒ½å‡ºç°ï¼Œå…¶å‘¨æœŸéš¾ä»¥é¢„æµ‹ï¼Œæ˜¯å†³å®šå¹¸å­˜è€…å‘½è¿çš„è®¡æ—¶å™¨ã€‚\n  3.  æœˆè£”ï¼ˆLunatic Strainï¼‰ï¼šè¢«ç»¯çº¢çœŸèŒå®Œå…¨æ§åˆ¶çš„æ„ŸæŸ“è€…åœ¨çº¢æœˆä¹‹å¤œçš„å½¢æ€ã€‚ä»–ä»¬çš„èº«ä½“ç‰¹å¾ä¼šå‘ç”Ÿå˜åŒ–ï¼Œä¾‹å¦‚çš®è‚¤ä¸Šå¸ƒæ»¡å‘å…‰çš„èŒä¸çº¹è·¯ï¼Œç³å­”å˜æˆå¤çœ¼ï¼Œè‚¢ä½“åŠ›é‡å’Œé€Ÿåº¦å¾—åˆ°æå¤§å¢å¼ºã€‚æœˆè£”ä¼šä¸åˆ†æ•Œæˆ‘åœ°æ”»å‡»ä¸€åˆ‡éæ„ŸæŸ“çš„ç”Ÿå‘½ä½“ï¼Œå…¶ä¸»è¦ç›®çš„æ˜¯ä¸ºäº†â€œæ’­ç§â€ï¼Œå³é€šè¿‡æ”»å‡»å°†çœŸèŒå­¢å­ä¼ æ’­ç»™æ–°çš„å®¿ä¸»ã€‚\n  4.  æ—¥è¡Œè€…ï¼ˆDay-Walkerï¼‰ï¼šè¿™æ˜¯å¯¹æ‰€æœ‰æ„ŸæŸ“è€…çš„ç»Ÿç§°ã€‚åœ¨ç™½å¤©ï¼Œä»–ä»¬ä¸å¸¸äººæ— å¼‚ï¼Œç”šè‡³æ›´å¥åº·ã€æ›´å¼ºå¤§ã€‚è¿™é€ æˆäº†æ–°ä¸–ç•Œæœ€æ ¸å¿ƒçš„ç¤¾ä¼šé—®é¢˜ï¼šä¿¡ä»»å±æœºã€‚å¹¸å­˜è€…èšé›†åœ°ä¸ºæ­¤å‘å±•å‡ºå„ç§ä¸¥è‹›çš„ç”„åˆ«æ‰‹æ®µï¼Œä»å®šæœŸçš„è¡€æ¶²æ£€æµ‹åˆ°æ®‹é…·çš„å¿ƒç†å®¡é—®ï¼Œç¤¾ä¼šå…³ç³»å˜å¾—è„†å¼±è€Œä¸å ªä¸€å‡»ã€‚`,\n                // å¼•ç”¨ä¸Šæ–¹å®šä¹‰çš„é€šç”¨æ—¶é—´çº¿æè¿°\n                timelines: timelineDetails\n            },\n 'å´©åä¹‹æ—¥': {\n                // åœ¨åå¼•å·(``)ä¸­å¡«å…¥ä¸“å±çš„ã€å¯æ¢è¡Œçš„é•¿ç¯‡ä¸–ç•ŒèƒŒæ™¯\n                background: `  ã€ä¸–ç•ŒèƒŒæ™¯ã€‘\n  å´©åä¹‹æ—¥ çš„æºå¤´æ˜¯ä¸€ç§ä»£å·ä¸ºâ€œåœ°ç‹±çŠ¬ï¼ˆCerberusï¼‰â€çš„å†›ç”¨çº§æ”¹é€ ç—…æ¯’ã€‚åœ¨ä¸€åœºè¢«æ©ç›–çš„å®éªŒå®¤äº‹æ•…ä¸­ï¼Œç—…æ¯’æ„å¤–æ³„éœ²å¹¶è¿…é€Ÿé€šè¿‡æ°´æºå’Œç©ºæ°”æ°”æº¶èƒ¶åœ¨å‘¨è¾¹åŸå¸‚å®Œæˆäº†åˆå§‹ä¼ æ’­ã€‚å‡ å¤©ä¹‹å†…ï¼Œå…¨çƒå„å¤§éƒ½å¸‚åœˆç›¸ç»§çˆ†å‘å¤§è§„æ¨¡éªšä¹±ã€‚è¢«æ„ŸæŸ“è€…å±•ç°å‡ºæå¼ºçš„æ”»å‡»æ€§ï¼Œç°ä»£åŒ»ç–—ä½“ç³»åœ¨æŒ‡æ•°çº§å¢é•¿çš„æ„ŸæŸ“è€…é¢å‰ä¸å ªä¸€å‡»ï¼Œå†›é˜Ÿå’Œæ”¿åºœçš„ç§©åºåœ¨å†…å¤–å¤¹å‡»ä¸‹åœŸå´©ç“¦è§£ã€‚é€šè®¯ã€ç”µåŠ›ã€äº¤é€šç½‘ç»œåœ¨çŸ­çŸ­å‡ å‘¨å†…å½»åº•ç˜«ç—ªã€‚æ—§æ—¥çš„æ–‡æ˜ç¯ç«å°±æ­¤ç†„ç­ï¼Œäººç±»ä»æ­¤è¿›å…¥äº†ä¸€ä¸ªå¼±è‚‰å¼ºé£Ÿçš„é»‘æš—æ—¶ä»£ã€‚å¹¸å­˜è€…ä»¬é€€å®ˆåœ¨ç”¨é«˜å¢™å’Œé“ä¸ç½‘éš”ç»å‡ºæ¥çš„å­¤å²›ä¸Šï¼Œåœ¨åºŸå¢Ÿä¸­è‰°éš¾æ±‚ç”Ÿã€‚\n  ã€æ ¸å¿ƒæ¦‚å¿µã€‘\n  1.  **åœ°ç‹±çŠ¬ç—…æ¯’ï¼ˆCerberus Virusï¼‰**ï¼šä¸€ç§å…·å¤‡é«˜åº¦ä¼ æŸ“æ€§å’Œä¾µç•¥æ€§çš„åˆæˆé€†è½¬å½•ç—…æ¯’ã€‚å®ƒä¸â€œæ€æ­»â€å®¿ä¸»å†ä½¿å…¶â€œå¤æ´»â€ï¼Œè€Œæ˜¯ç›´æ¥æš´åŠ›åœ°é‡å†™ç”Ÿç‰©çš„é—ä¼ å¯†ç ï¼Œç ´åå¤§è„‘çš®å±‚ç­‰é«˜çº§åŠŸèƒ½åŒºï¼ŒåŒæ—¶æåº¦å¼ºåŒ–å…¶æä»æ ¸ï¼Œå¼•å‘æ— å°½çš„é¥¥é¥¿æ„Ÿå’Œæ”»å‡»æ€§ã€‚ç—…æ¯’ä¸»è¦é€šè¿‡ä½“æ¶²ä¼ æ’­ï¼Œå°¤å…¶æ˜¯æ’•å’¬ã€‚ä¸€æ—¦è¢«æ„ŸæŸ“ï¼Œå®¿ä¸»ä¼šåœ¨æ•°å°æ—¶å†…ç»å†å‰§çƒˆé«˜çƒ§ã€å™¨å®˜è¡°ç«­å’Œç»„ç»‡åæ­»ï¼Œæœ€ç»ˆè½¬åŒ–ä¸ºâ€œæ„ŸæŸ“ä½“â€ã€‚\n\n2.  **æ„ŸæŸ“ä½“ï¼ˆThe Infectedï¼‰**ï¼šè¢«åœ°ç‹±çŠ¬ç—…æ¯’å®Œå…¨æ”¹é€ åçš„äººç±»ã€‚ä»–ä»¬å¤±å»äº†æ‰€æœ‰ç†æ™ºå’Œç”Ÿå‰è®°å¿†ï¼Œåªè¢«æœ€åŸå§‹çš„æœ¬èƒ½â€”â€”æ•é£Ÿå’Œä¼ æ’­ç—…æ¯’æ‰€é©±ä½¿ã€‚ä»–ä»¬å¯¹å£°éŸ³å’Œæ´»ç‰©çš„æ°”æ¯æä¸ºæ•æ„Ÿï¼Œä¸çŸ¥ç–²å€¦ï¼Œä¸”èº«ä½“å› ç—…æ¯’æ”¹é€ è€Œè·å¾—äº†è¶…è¶Šå¸¸äººçš„åŠ›é‡å’Œé€Ÿåº¦ã€‚å•ä¸ªçš„æ„ŸæŸ“ä½“å¹¶ä¸å¯æ€•ï¼Œä½†ä»–ä»¬å¾€å¾€ä¼šèšé›†åœ¨ä¸€èµ·ï¼Œå½¢æˆæ•°åã€æ•°ç™¾ç”šè‡³æ•°ä¸‡è§„æ¨¡çš„â€œå°¸æ½®â€ï¼Œèƒ½å¤Ÿè½»æ˜“åæ²¡ä»»ä½•å¹¸å­˜è€…æ®ç‚¹ã€‚\n\n3.  **å…ç–«è€…ï¼ˆThe Immuneï¼‰**ï¼šåœ¨ç—…æ¯’å¤§çˆ†å‘ä¸­ï¼Œæœ‰æå°‘æ•°ï¼ˆå¤§çº¦ç™¾ä¸‡åˆ†ä¹‹ä¸€ï¼‰çš„äººè¡¨ç°å‡ºäº†å¯¹åœ°ç‹±çŠ¬ç—…æ¯’çš„å…ˆå¤©å…ç–«åŠ›ã€‚å³ä½¿è¢«æ„ŸæŸ“ä½“æ”»å‡»ï¼Œä»–ä»¬ä¹Ÿä¸ä¼šè¢«è½¬åŒ–ã€‚è¿™ä¸€ç‰¹è´¨ä½¿ä»–ä»¬çš„è¡€æ¶²æˆä¸ºå…¨äººç±»çš„ç»ˆæå¸Œæœ›â€”â€”åˆ¶é€ ç–«è‹—æˆ–è§£è¯çš„å”¯ä¸€å¯èƒ½ã€‚å› æ­¤ï¼Œå…ç–«è€…æ—¢æ˜¯è¢«ä¿æŠ¤çš„çå®ï¼Œä¹Ÿæ˜¯è¢«ç–¯ç‹‚çš„å¹¸å­˜è€…åŠ¿åŠ›è§Šè§ã€çŒæ•çš„â€œæ´»ä½“èµ„æºâ€ã€‚ä»–ä»¬çš„å­˜åœ¨æœ¬èº«ï¼Œå°±æ˜¯æ–°ä¸–ç•Œé‡Œæœ€å±é™©çš„ç§˜å¯†ã€‚\n\n4.  **å¹¸å­˜è€…æ®ç‚¹ï¼ˆSurvivor Strongholdï¼‰**ï¼šåœ¨æœ«æ—¥é™ä¸´åï¼Œå¹¸å­˜è€…ä»¬ä¾é å¤©ç„¶å±éšœæˆ–äººå·¥é˜²å¾¡å·¥äº‹å»ºç«‹èµ·æ¥çš„åº‡æŠ¤æ‰€ã€‚å®ƒä»¬å½¢å¼å„å¼‚ï¼Œå¯èƒ½æ˜¯è¢«åŠ å›ºçš„ç›‘ç‹±ã€å¤§å‹è´­ç‰©ä¸­å¿ƒã€åºŸå¼ƒçš„å†›äº‹åŸºåœ°ï¼Œç”šè‡³æ˜¯ä¸å¤§é™†éš”ç»çš„å²›å±¿ã€‚æ®ç‚¹ä¹‹å†…ï¼Œå¹¸å­˜è€…ä»¬ä¾é ä¸¥æ ¼çš„é…ç»™åˆ¶åº¦å’Œå†›äº‹åŒ–ç®¡ç†ç»´æŒç€è„†å¼±çš„ç§©åºã€‚ç„¶è€Œï¼Œé™¤äº†è¦æ—¶åˆ»æé˜²å°¸æ½®çš„å›´æ”»ï¼Œä»–ä»¬è¿˜å¿…é¡»é¢å¯¹èµ„æºåŒ®ä¹ã€å†…éƒ¨æƒåŠ›æ–—äº‰ä»¥åŠå…¶ä»–æ®ç‚¹â€œæ å¤ºè€…â€çš„å¨èƒã€‚`,\n                // å¼•ç”¨ä¸Šæ–¹å®šä¹‰çš„é€šç”¨æ—¶é—´çº¿æè¿°\n                timelines: timelineDetails\n            },\n            'çµæ€§ä¹‹ç¾': {\n                background: ` ã€ä¸–ç•ŒèƒŒæ™¯ã€‘\n  â€œçµæ€§ä¹‹ç¾â€å§‹äºä¸€åœºè¢«ç§°ä¸ºâ€œé•¿æ—¥æå…‰â€çš„å…¨çƒæ€§å¼‚è±¡ã€‚é«˜ç»´èƒ½é‡ï¼ˆè¢«åä¸–ç§°ä¸ºâ€œçµæ°”â€ï¼‰æ— é¢„è­¦åœ°æ¶Œå…¥æˆ‘ä»¬çš„ä¸‰ç»´ä¸–ç•Œï¼Œå¯¼è‡´ç‰©ç†æ³•åˆ™çš„åº•å±‚é€»è¾‘è¢«æ”¹å†™ã€‚è¿™ä¸æ˜¯æ¸©å’Œçš„â€œå¤è‹â€ï¼Œè€Œæ˜¯ä¸€åœºæš´åŠ›çš„ã€æ¯ç­æ€§çš„èƒ½é‡å†²åˆ·ã€‚æ—§ä¸–ç•Œçš„ç§‘æŠ€æ–‡æ˜åœ¨æ³•åˆ™ç´Šä¹±ä¸­è¿…é€Ÿç“¦è§£ï¼Œäººç±»ç¤¾ä¼šç»“æ„å½»åº•å´©æºƒã€‚å¹¸å­˜è€…å›´ç»•ç€å°‘æ•°èƒ½é‡ç›¸å¯¹ç¨³å®šçš„â€œçµæ°”å®‰å…¨åŒºâ€é‡æ–°èšé›†ï¼Œå»ºç«‹èµ·æ–°çš„åŸé‚¦æ–‡æ˜ã€‚\n  ã€æ ¸å¿ƒæ¦‚å¿µã€‘\n  1.  çµæ°”ï¼ˆPranaï¼‰ï¼šä¸€ç§æºè‡ªé«˜ç»´åº¦çš„åŸºç¡€èƒ½é‡ï¼Œå®ƒæ—¢æ˜¯åˆ›é€ ä¹‹æºï¼Œä¹Ÿæ˜¯æ¯ç­ä¹‹åŠ›ã€‚å®ƒæ— å¤„ä¸åœ¨ï¼Œä½†æµ“åº¦ä¸æ€§è´¨å› åœ°åŸŸè€Œå¼‚ã€‚çµæ°”å¯ä»¥ç›´æ¥æ‰­æ›²ç‰©è´¨ï¼Œå½±å“ç²¾ç¥ï¼Œæ˜¯æ–°ä¸–ç•Œä¸€åˆ‡è¶…å‡¡åŠ›é‡çš„åŸºç¡€ã€‚æ™®é€šäººé•¿æ—¶é—´æš´éœ²åœ¨é«˜æµ“åº¦çµæ°”ä¸­ä¼šå‘ç”Ÿâ€œçµæ°”è¿‡è½½â€ï¼Œèº«ä½“ç»„ç»‡ä¼šå´©æºƒï¼Œæœ€ç»ˆè½¬åŒ–ä¸ºâ€œçµéª¸â€ã€‚\n  2.  é“ä½“/å¼‚èƒ½ï¼ˆThe Callingï¼‰ï¼šé¢å¯¹çµæ°”çš„è‡´å‘½ä¾µèš€ï¼Œéƒ¨åˆ†äººç±»çš„åŸºå› å‘ç”Ÿäº†é€‚åº”æ€§çªå˜ï¼Œè¯ç”Ÿäº†èƒ½å¤Ÿä¸»åŠ¨å¸æ”¶ã€è½¬åŒ–å¹¶åˆ©ç”¨çµæ°”çš„ä¸ªä½“ã€‚è¿™ç§ä½“è´¨è¢«ä¸œæ–¹å¹¸å­˜è€…ç§°ä¸ºâ€œé“ä½“â€ï¼Œè¢«è¥¿æ–¹å¹¸å­˜è€…ç§°ä¸ºâ€œå¼‚èƒ½â€ã€‚è§‰é†’è€…èƒ½å¤Ÿå±•ç°å‡ºåƒå¥‡ç™¾æ€ªçš„èƒ½åŠ›ï¼Œä¾‹å¦‚å…ƒç´ æ“æ§ã€è‚‰ä½“å¼ºåŒ–ã€ç²¾ç¥æ„Ÿåº”ç­‰ã€‚è§‰é†’ä¸å¦ï¼Œä»¥åŠè§‰é†’èƒ½åŠ›çš„å¼ºå¼±ï¼Œæˆä¸ºäº†åˆ’åˆ†æ–°ä¸–ç•Œç¤¾ä¼šé˜¶å±‚çš„å”¯ä¸€æ ‡å‡†ã€‚\n  3.  çµéª¸ï¼ˆAether-fiendï¼‰ï¼šçµæ°”è¿‡è½½çš„æœ€ç»ˆäº§ç‰©ã€‚å½“ä¸€ä¸ªç”Ÿå‘½ä½“æ— æ³•æ‰¿è½½æ¶Œå…¥ä½“å†…çš„çµæ°”æ—¶ï¼Œå…¶ç‰©è´¨å½¢æ€ä¼šå½»åº•å´©æºƒï¼Œè½¬åŒ–ä¸ºä¸€å›¢ç”±çº¯ç²¹èƒ½é‡æ„æˆçš„ã€ä¿ç•™ç€ç”Ÿç‰©ç”Ÿå‰éƒ¨åˆ†æœ¬èƒ½çš„èšåˆä½“ã€‚çµéª¸æå…·æ”»å‡»æ€§ï¼Œä¼šæœ¬èƒ½åœ°è¢«ç”Ÿå‘½æ°”æ¯å¸å¼•ã€‚å®ƒä»¬æ˜¯è’é‡ä¸­æœ€å¸¸è§çš„å¨èƒï¼Œå½¢æ€å„å¼‚ï¼Œä»æ— å›ºå®šå½¢çŠ¶çš„èƒ½é‡å›¢åˆ°æ‰­æ›²çš„äººå½¢æˆ–å…½å½¢ï¼Œä¸ä¸€è€Œè¶³ã€‚\n  4.  å®‰å…¨åŒºï¼ˆSanctuaryï¼‰ï¼šåœ¨çµæ°”æµ“åº¦ç›¸å¯¹è¾ƒä½ä¸”ç¨³å®šçš„åŒºåŸŸï¼Œç”±å¼ºå¤§çš„è§‰é†’è€…å»ºç«‹çš„åº‡æŠ¤æ‰€ã€‚å®‰å…¨åŒºé€šå¸¸ä¾é æŸç§èƒ½å¤Ÿç¨³å®šçµæ°”çš„â€œçµæ ¸â€æˆ–å¤©ç„¶åœ°ç†å±éšœå­˜åœ¨ã€‚åŒºå†…ç»´æŒç€åŸºæœ¬çš„ç¤¾ä¼šç§©åºï¼Œæ˜¯äººç±»æ–‡æ˜æœ€åçš„ç«ç§ã€‚å®‰å…¨åŒºä¹‹å¤–çš„å¹¿é˜”å¤©åœ°ï¼Œåˆ™è¢«ç§°ä¸ºâ€œå£…åŒ–åŒºâ€æˆ–â€œè’åŸŸâ€ã€‚`,\n                timelines: timelineDetails\n            },\n  'æ°¸å†¬ä¹‹å¯‚': {\n                background: ` ã€ä¸–ç•ŒèƒŒæ™¯ã€‘\n  å†°å°å¹¶éä¸€æ—¥è€Œæˆã€‚å®ƒå§‹äºä¸€ç³»åˆ—å²æ— å‰ä¾‹çš„è¶…çº§ç«å±±ç¾¤çˆ†å‘ï¼Œå·¨é‡çš„ç«å±±ç°è¢«é€å…¥å¹³æµå±‚ï¼Œå½¢æˆäº†ä¸€é“é®è”½å…¨çƒçš„â€œå°˜å¹•â€ï¼Œé˜³å…‰å†ä¹Ÿæ— æ³•æŠµè¾¾åœ°è¡¨ã€‚éšä¹‹è€Œæ¥çš„æ˜¯æ–­å´–å¼çš„æ°”æ¸©éª¤é™ï¼Œåœ°çƒåœ¨çŸ­çŸ­æ•°å¹´å†…è¿›å…¥ä¸€ä¸ªæ–°çš„å†°æ²³æ—¶ä»£ã€‚æµ·æ´‹å°å†»ï¼Œå¤§é™†è¢«å†°å·è¦†ç›–ï¼Œæ—§ä¸–ç•Œçš„æ–‡æ˜é—è¿¹è¢«æ·±åŸ‹åœ¨æ•°ç™¾ç±³çš„å†°å±‚ä¹‹ä¸‹ã€‚äººç±»æ–‡æ˜é€€åŒ–è‡³åŸå§‹çš„éƒ¨è½å½¢æ€ï¼Œå¹¸å­˜è€…èœ·ç¼©åœ¨åˆ©ç”¨åœ°çƒ­ã€æ ¸èƒ½ä½™çƒ­æˆ–æ—§æ—¥å·¥ç¨‹å¥‡è¿¹æ„ç­‘çš„â€œçƒ­å²›â€ä¸­ï¼Œç»´ç³»ç€æœ€åçš„æ–‡æ˜ç«ç§ã€‚\n  ã€æ ¸å¿ƒæ¦‚å¿µã€‘\n å†°å¯‚ï¼ˆFrost-Silenceï¼‰ï¼šè¿™ä¸å•æ˜¯ä¸¥å¯’ï¼Œè€Œæ˜¯ä¸€ç§ä¾µèš€æ€§çš„ç‰©ç†ç°è±¡ã€‚åœ¨æåº¦æ·±å¯’çš„ç¯å¢ƒä¸­ï¼Œç©ºæ°”ä¼¼ä¹å˜å¾—ç²˜ç¨ ï¼Œå£°éŸ³å’Œçƒ­é‡ä¼šä»¥æå¿«çš„é€Ÿåº¦è¢«â€œåå™¬â€å’ŒåŒåŒ–ã€‚åœ¨â€œå†°å¯‚â€ç¬¼ç½©çš„åŒºåŸŸï¼Œä¸€åˆ‡éƒ½é™·å…¥æ­»å¯‚ï¼Œé‡‘å±ä¼šå˜å¾—åƒç»ç’ƒä¸€æ ·è„†å¼±ï¼Œæš´éœ²åœ¨å¤–çš„ç”Ÿå‘½ä½“ä¼šè¢«è¿…é€Ÿå†»ç»“å¹¶ç»“æ™¶åŒ–ã€‚è¿™ç§ç°è±¡ä½¿å¾—åœ¨å†°åŸä¸Šçš„é•¿é€”è¿å¾™æˆä¸ºä¹æ­»ä¸€ç”Ÿçš„æŒ‘æˆ˜ã€‚\nçƒ­å²›ï¼ˆHeat-Islandï¼‰ï¼šå¹¸å­˜è€…æ–‡æ˜çš„æ‘‡ç¯®ã€‚è¿™äº›åœ°æ–¹é€šå¸¸æ˜¯å»ºç«‹åœ¨åœ°çƒ­æ¸©æ³‰ã€å°šæœªåœå †çš„æ ¸ç”µç«™é—å€æˆ–æ˜¯æ‹¥æœ‰åºå¤§åœ°åº•è®¾æ–½çš„æ—§æ—¥åŸå¸‚ä¹‹ä¸Šã€‚æ¯ä¸ªâ€œçƒ­å²›â€éƒ½æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„åŸé‚¦ï¼Œæ‹¥æœ‰ç‹¬ç‰¹çš„ç”Ÿå­˜æ–¹å¼å’Œæ”¿æ²»ç»“æ„ã€‚çƒ­å²›ä¹‹é—´çš„è”ç³»æå…¶ç¨€å°‘ï¼Œå½¼æ­¤çš„å­˜åœ¨æœ‰æ—¶ç”šè‡³åªå­˜åœ¨äºä¼ è¯´ä¹‹ä¸­ã€‚`,\n                timelines: timelineDetails\n            },\n 'è¾å°„å°˜åŸƒ': {\n                background: ` ã€ä¸–ç•ŒèƒŒæ™¯ã€‘\n æˆ˜äº‰åªæŒç»­äº†72ä¸ªå°æ—¶ã€‚å„å¤§æ ¸æ­¦å›½å®¶åœ¨è¿é”çš„è¯¯åˆ¤ä¸ææ…Œä¸­ï¼Œå‘å½¼æ­¤å€¾æ³»äº†è¶³ä»¥å°†æ–‡æ˜æ¸…æ´—æ•°æ¬¡çš„æ ¸æ­¦å™¨ã€‚å½“è˜‘è‡äº‘æ•£å»ï¼Œä¸–ç•Œå·²æ˜¯ç„¦åœŸã€‚å¹¸å­˜è€…å¤§å¤šæ˜¯æå‰èº²å…¥åœ°ä¸‹æ©ä½“æˆ–èº«å¤„åè¿œåœ°åŒºçš„äººã€‚åœ°è¡¨è¢«é«˜å¼ºåº¦çš„è¾å°„å°˜åŸƒè¦†ç›–ï¼Œå½¢æˆäº†æ— æ•°â€œç¦åŒºâ€ã€‚æ—§æ—¥çš„åŸå¸‚åŒ–ä¸ºéå¸ƒå˜å¼‚ç”Ÿç‰©çš„é’¢é“åŸåœºã€‚æ•°åå¹´åï¼Œåœ°è¡¨è¾å°„æœ‰æ‰€å‡å¼±ï¼Œå¹¸å­˜è€…çš„åä»£å¼€å§‹èµ°å‡ºæ©ä½“ï¼Œä»¥â€œæ‹¾è’è€…â€çš„èº«ä»½ï¼Œåœ¨æ–°ä¸–ç•Œçš„åºŸå¢Ÿä¸Šæœå¯»å¯ç”¨çš„ç‰©èµ„ã€æŠ€æœ¯å’Œé‚£ç‰‡ä¼ è¯´ä¸­æœªè¢«æ±¡æŸ“çš„â€œå‡€åœŸâ€ã€‚\nè‹¥å¼€å±€æ˜¯æ½œä¼çš„å¼€ç«¯ï¼Œåˆ™æå†™æˆ˜äº‰å‰çš„åŠ¨è¡ã€‚\n  ã€æ ¸å¿ƒæ¦‚å¿µã€‘\n ç›–é©è®¡æ•°å™¨ï¼ˆGeiger Counterï¼‰ï¼šåœ¨æ–°ä¸–ç•Œï¼Œè¿™æ¯”æªæ”¯å’Œé»„é‡‘æ›´é‡è¦ã€‚å®ƒè¡¡é‡ç€ä½ èƒ½å»å“ªé‡Œï¼Œä½ èƒ½åœ¨åœ°è¡¨åœç•™å¤šä¹…ã€‚æ¯ä¸ªæ‹¾è’è€…çš„è€³è¾¹éƒ½è¦ç»•ç€å®ƒé‚£å•è°ƒè€Œè‡´å‘½çš„â€œå’”å“’â€å£°ã€‚å£°éŸ³çš„ç–å¯†ï¼Œå³æ˜¯ç”Ÿä¸æ­»çš„åˆ†ç•Œçº¿ã€‚\n\nè¾å°„ç—…ä¸çªå˜ï¼ˆRadiation Sickness & Mutationï¼‰ï¼šåœ°è¡¨æ°¸æ’çš„è¯…å’’ã€‚è½»åˆ™è„±å‘ã€å‘•åï¼Œé‡åˆ™è¿…é€Ÿå™¨å®˜è¡°ç«­è€Œæ­»ã€‚é•¿æœŸçš„ä½å‰‚é‡è¾å°„åˆ™ä¼šè¯±å‘å„ç§å¯æ€•çš„åŸºå› çªå˜ï¼Œä¸ä»…åœ¨é‡ç”ŸåŠ¨ç‰©ä¸­åˆ›é€ äº†æ— æ•°æ€ªç‰©ï¼ˆè¢«ç§°ä¸ºâ€œç•¸å˜ä½“â€ï¼‰ï¼Œä¹ŸåŒæ ·æŠ˜ç£¨ç€äººç±»ã€‚æœ‰äº›æ‹¾è’è€…å›¢ä½“ç”šè‡³ä¼šå› ä¸ºåŸºå› çš„ç¨³å®šä¸å¦è€Œäº§ç”Ÿæ®‹é…·çš„å†…éƒ¨æ¸…æ´—ã€‚\n\næ©ä½“æ–‡æ˜ï¼ˆVault Civilizationï¼‰ï¼šåœ¨åœ°ä¸‹åº¦è¿‡äº†æ•°ä»£äººçš„å¹¸å­˜è€…ç¤¾ç¾¤ã€‚ä»–ä»¬ä¿ç•™äº†ç›¸å¯¹å®Œæ•´çš„æ—§ä¸–ç•Œç§‘æŠ€å’Œç§©åºï¼Œä½†ä¹Ÿå› æ­¤å½¢æˆäº†åƒµåŒ–ã€æ’å¤–çš„ç¤¾ä¼šç»“æ„ã€‚å¯¹åœ°è¡¨äººï¼ˆä»–ä»¬ç§°ä¹‹ä¸ºâ€œé‡è›®äººâ€ï¼‰æ—¢é„™å¤·åˆææƒ§ã€‚ä¸€äº›å¤§å‹æ©ä½“æ‹¥æœ‰ç‹¬ç«‹çš„ç¤¾ä¼šä½“ç³»ï¼Œç”šè‡³ä¼šæ´¾é£æ­¦è£…åŠ›é‡åˆ°åœ°è¡¨æ‰§è¡Œâ€œå›æ”¶â€ä»»åŠ¡ã€‚\n\nåŸå­ç¥æ•™ï¼ˆChurch of Atomï¼‰ï¼šåœ¨ç»æœ›çš„åºŸåœŸä¸Šè¯ç”Ÿçš„æ–°å…´å®—æ•™ã€‚æ•™å¾’ä»¬å´‡æ‹œæ ¸çˆ†çš„æ¯ç­æ€§åŠ›é‡ï¼Œå°†è¾å°„è§†ä¸ºâ€œç¥åœ£çš„æ´—ç¤¼â€ï¼Œå°†çªå˜è§†ä¸ºâ€œé£å‡â€çš„å¾å…†ã€‚ä»–ä»¬ä¸»åŠ¨æ‹¥æŠ±è¾å°„ï¼Œè¡Œä¸ºæç«¯ä¸”ç–¯ç‹‚ï¼Œæ˜¯åºŸåœŸä¸Šæœ€ä¸å¯ç†å–»çš„ä¸€è‚¡åŠ¿åŠ›ï¼Œæ—¶å¸¸ä¸å¯»æ±‚å‡€åŒ–çš„æ‹¾è’è€…å‘ç”Ÿå†²çªã€‚ã€‚`,\n                timelines: timelineDetails\n            },\n 'ç¢è£‚ç‹åº§': {\n                background: ` ã€ä¸–ç•ŒèƒŒæ™¯ã€‘\nç¬¬ä¸‰æ¬¡ä¸–ç•Œå¤§æˆ˜å¹¶éçªç„¶çˆ†å‘ï¼Œè€Œæ˜¯å…¨çƒç»æµå´©æºƒã€èµ„æºæ¯ç«­å’Œæç«¯æ°‘æ—ä¸»ä¹‰æŠ¬å¤´åçš„æœ€ç»ˆæ¶æœã€‚æˆ˜äº‰åˆæœŸè¿˜éµå¾ªç€æ—§æœ‰çš„å›½é™…å…¬çº¦ï¼Œä½†éšç€æˆ˜å†µçš„èƒ¶ç€ä¸å‡çº§ï¼Œæ‰€æœ‰â€œè§„åˆ™â€éƒ½è¢«æŠ›å¼ƒã€‚æ— äººæœºèœ‚ç¾¤ã€æˆ˜æœ¯æ ¸æ­¦ã€åŸºå› æ”¹é€ å£«å…µå’Œå¤©åŸºåŠ¨èƒ½æ­¦å™¨ç›¸ç»§æŠ•å…¥æˆ˜åœºã€‚å›½å®¶æ¦‚å¿µé€æ¸æ¨¡ç³Šï¼Œä¸–ç•Œæœ€ç»ˆåˆ†è£‚ä¸ºä¸‰å¤§å†›äº‹è”ç›Ÿï¼šä»¥é«˜ç§‘æŠ€å’Œç²¾è‹±éƒ¨é˜Ÿä¸ºä¸»çš„â€œè”ç›Ÿï¼ˆThe Unionï¼‰â€ï¼Œä»¥åºå¤§äººæµ·å’Œå·¥ä¸šæ´ªæµä¸ºæ ¸å¿ƒçš„â€œå…±åŒä½“ï¼ˆThe Collectiveï¼‰â€ï¼Œä»¥åŠåœ¨ä¸¤è€…å¤¹ç¼ä¸­é æ¸¸å‡»å’Œä»£ç†äººæˆ˜äº‰ç”Ÿå­˜çš„â€œè‡ªç”±å†›å›¢ï¼ˆThe Free Legionï¼‰â€ã€‚å¹³æ°‘çš„ç”Ÿæ´»åŒºä¸æˆ˜åŒºçŠ¬ç‰™äº¤é”™ï¼Œéšæ—¶å¯èƒ½å› ä¸ºä¸€æ¬¡æˆ˜ç•¥ç›®æ ‡çš„è½¬ç§»è€ŒåŒ–ä¸ºç„¦åœŸã€‚\nè‹¥å¼€å±€æ˜¯æ½œä¼çš„å¼€ç«¯ï¼Œåˆ™æå†™æˆ˜äº‰å‰çš„åŠ¨è¡ã€‚\n  ã€æ ¸å¿ƒæ¦‚å¿µã€‘\n  æˆ˜åœºæ³•åˆ™ï¼ˆThe Law of the Frontlineï¼‰ï¼šåœ¨è¿™é‡Œï¼Œå›½é™…æ³•å·²æ˜¯ä¸€çº¸ç©ºæ–‡ã€‚è¿™é‡Œå”¯ä¸€çš„æ³•åˆ™å°±æ˜¯ç”Ÿå­˜å’Œæ¶ˆç­æ•Œäººã€‚æŠ•é™ä¸è¢«æ¥å—ï¼Œä¼ªè£…æˆå¹³æ°‘æ¸—é€æ˜¯å¸¸æ€ï¼Œä¸ºäº†æˆ˜æœ¯ä¼˜åŠ¿å¯ä»¥ç‰ºç‰²ä»»ä½•éæˆ˜æ–—äººå‘˜ã€‚å®ƒæŠŠå¥½äººå˜æˆå± å¤«ï¼ŒæŠŠå¹¸å­˜è€…å˜æˆå†·è¡€çš„æŠ•æœºè€…ã€‚\n\nä¸‰å¤§é˜µè¥ï¼ˆThe Three Factionsï¼‰ï¼šè”ç›Ÿæ‹¥æœ‰æœ€å…ˆè¿›çš„éšå½¢æˆ˜æœºã€åŠ¨åŠ›è£…ç”²å’Œç½‘ç»œæˆ˜èƒ½åŠ›ï¼Œä½†å…µå‘˜ç¨€å°‘ï¼Œæ¯ä¸€åå£«å…µéƒ½æå…¶å®è´µã€‚å…±åŒä½“ä¾é æ— ç©·æ— å°½çš„å¾å¬å…µå’Œé’¢é“æ´ªæµèˆ¬çš„è£…ç”²éƒ¨é˜Ÿæ¨è¿›ï¼Œç”¨å·¨å¤§çš„ç‰ºç‰²æ¢å–æˆ˜ç•¥ç©ºé—´ã€‚è‡ªç”±å†›å›¢æˆåˆ†å¤æ‚ï¼Œæœ‰ä¸æ„¿åŠ å…¥åŒæ–¹çš„å°å›½æ®‹ä½™éƒ¨é˜Ÿã€å›é€ƒçš„å£«å…µå’Œæ­¦è£…èµ·æ¥çš„å¹³æ°‘ï¼Œä»–ä»¬æ˜¯æˆ˜åœºä¸Šçš„å˜æ•°ï¼Œæ“…é•¿éå¯¹ç§°ä½œæˆ˜ã€‚\n\nå®‰å…¨åŸï¼ˆSafe Zoneï¼‰ï¼šåä¹‰ä¸Šçš„â€œä¸­ç«‹åŒºåŸŸâ€ï¼Œé€šå¸¸ç”±æˆ˜å‰é—ç•™çš„å›½é™…ç»„ç»‡ï¼ˆå¦‚çº¢åå­—ä¼šï¼‰æˆ–è´¢åŠ›é›„åšçš„è·¨å›½å…¬å¸åœ¨ä»˜å‡ºå·¨å¤§ä»£ä»·åç»´æŒã€‚è¿™é‡Œæ˜¯æˆ˜åœ°è®°è€…ã€æƒ…æŠ¥è´©å­ã€æ­¦å™¨å•†äººå’Œéš¾æ°‘çš„èšé›†åœ°ï¼Œç§©åºæ··ä¹±ä½†è‡³å°‘æ²¡æœ‰å…¬å¼€çš„äº¤ç«ã€‚å®‰å…¨åŸæ˜¯è¿™ä¸ªçƒˆç«ä¸–ç•Œé‡Œå”¯ä¸€çš„å–˜æ¯ä¹‹åœ°ï¼Œä½†å…¶â€œä¸­ç«‹â€åœ°ä½éšæ—¶å¯èƒ½è¢«æ’•æ¯ã€‚\n\nä»£ç†äººï¼ˆProxyï¼‰ï¼šåœ¨ä¸ä¾¿ç›´æ¥å‡ºå…µçš„åœ°åŒºï¼Œä¸‰å¤§é˜µè¥éƒ½ä¼šæ‰¶æ¤æœ¬åœ°çš„æ­¦è£…åŠ›é‡è¿›è¡Œâ€œä»£ç†äººæˆ˜äº‰â€ã€‚æ˜¨å¤©è¿˜æ˜¯å†œæ°‘æˆ–å·¥äººçš„ä½ ï¼Œä»Šå¤©å¯èƒ½å°±ä¼šè¢«å¡åˆ°ä¸€æ”¯AK-47ï¼Œä¸ºäº†é¥è¿œå¤§å›½çš„åˆ©ç›Šå»æ”»å‡»ä½ çš„é‚»å±…ã€‚ä½ è„šä¸‹çš„åœŸåœ°ï¼Œä¸è¿‡æ˜¯å·¨äººä»¬çš„æ£‹ç›˜ï¼Œè€Œä½ ï¼Œåªæ˜¯ä¸€ä¸ªéšæ—¶å¯ä»¥è¢«ç‰ºç‰²çš„æ£‹å­ã€‚`,\n                timelines: timelineDetails\n            },\n            'ä¿¡ä»°æ´ªæµ': {\n                background: `ã€ä¸–ç•ŒèƒŒæ™¯ã€‘\n  â€œç¥è¯é™ä¸´â€æ˜¯ä¸€åœºæ³¢åŠå…¨çƒæ‰€æœ‰æ–‡æ˜çš„è¶…è‡ªç„¶äº‹ä»¶ã€‚ä¸–ç•Œå„åœ°å¤è€ä¼ è¯´ä¸­çš„ç¥æ˜ã€æ¶é­”ã€ç²¾æ€ªä¸åœ£çµï¼Œåœ¨åŒä¸€æ—¶æœŸè‹é†’å¹¶é™ä¸´ç°å®ã€‚ä»–ä»¬çš„åŠ›é‡ä¸ä¿¡å¾’çš„æ•°é‡å’Œè™”è¯šåº¦ç›´æ¥æŒ‚é’©ã€‚å›½å®¶ã€æ°‘æ—çš„ç•Œé™è¢«è¿…é€Ÿæ‰“ç ´ï¼Œäººç±»è¢«è¿«æ ¹æ®åœ°ç†ä½ç½®ã€æ–‡åŒ–èƒŒæ™¯å’Œä¸ªäººä¿¡ä»°ï¼Œé€‰æ‹©åŠ å…¥ä¸åŒçš„â€œç¥ç³»â€ï¼Œå½¢æˆäº†ä»¥å¼ºå¤§ç¥æ˜ä¸ºæ ¸å¿ƒçš„â€œç¥å›½â€æˆ–â€œé­”åŸŸâ€ã€‚ä¸–ç•Œè¿›å…¥äº†ä¸€åœºäº‰å¤ºä¿¡ä»°èµ„æºçš„ç»ˆæä»£ç†äººæˆ˜äº‰ã€‚\n  ã€æ ¸å¿ƒæ¦‚å¿µã€‘\n  1.  ç¥æ ¼ï¼ˆDivinityï¼‰ï¼šé™ä¸´çš„ç¥æ˜å¹¶éå…¨çŸ¥å…¨èƒ½ã€‚ä»–ä»¬çš„åŠ›é‡æºæ³‰æ˜¯äººç±»çš„â€œä¿¡ä»°ä¹‹åŠ›â€ã€‚ä¿¡å¾’è¶Šå¤šï¼Œä¿¡ä»°è¶Šåšå®šï¼Œç¥æ˜çš„åŠ›é‡å°±è¶Šå¼ºï¼Œèƒ½å¤Ÿå±•ç°çš„ç¥è¿¹ä¹Ÿè¶Šå£®è§‚ã€‚åä¹‹ï¼Œå¤±å»ä¿¡å¾’çš„ç¥æ˜ä¼šå˜å¾—è™šå¼±ï¼Œç”šè‡³ä¼šâ€œé™¨è½â€ï¼Œå³é‡æ–°å½’äºæ²‰å¯‚ã€‚\n  2.  ç¥ç³»/ç¥å›½ï¼ˆPantheon/Theocracyï¼‰ï¼šå›´ç»•ç€ä¸€ä½ä¸»ç¥æˆ–ä¸€ä¸ªå®Œæ•´çš„ç¥è¯ä½“ç³»ï¼ˆå¦‚å¥¥æ—åŒ¹æ–¯ã€é˜¿æ–¯åŠ å¾·ã€å¤©åº­ï¼‰å»ºç«‹çš„å…¨æ–°ç¤¾ä¼šå½¢æ€ã€‚ç¥å›½ç”±ä¸»ç¥æˆ–å…¶æœ€å¼ºå¤§çš„ä»£ç†äººï¼ˆåœ£å¾’ã€ç¥å®˜ï¼‰ç»Ÿæ²»ï¼Œä»¥ç¥è°•ä¸ºæœ€é«˜æ³•å¾‹ã€‚ä¸åŒçš„ç¥å›½ä¹‹é—´ä¸ºäº†äº‰å¤ºä¿¡å¾’ï¼ˆå³åŠ›é‡æ¥æºï¼‰è€Œä¸æ–­è¿›è¡Œç€æˆ˜äº‰ã€æ¸—é€å’Œæ–‡åŒ–è¾“å‡ºã€‚\n  3.  ç¥æˆè€…/æ¸ç¥è€…ï¼ˆThe Chosen/The Godlessï¼‰ï¼šç¥æ˜ä¼šèµäºˆå…¶æœ€è™”è¯šçš„ä¿¡å¾’ä¸€éƒ¨åˆ†åŠ›é‡ï¼Œè¿™äº›è¢«é€‰ä¸­çš„äººè¢«ç§°ä¸ºâ€œç¥æˆè€…â€ï¼Œå¦‚åœ£éª‘å£«ã€ç¥­å¸ã€ç¥çœ·å‹‡å£«ç­‰ï¼Œä»–ä»¬æ˜¯ç¥å›½æˆ˜äº‰çš„ä¸­åšåŠ›é‡ã€‚è€Œé‚£äº›æ‹’ç»ä¿¡ä»°ä»»ä½•ç¥æ˜ï¼Œä¾é è‡ªèº«åŠ›é‡æˆ–æ—§æ—¶ä»£ç§‘æŠ€æ±‚ç”Ÿçš„äººï¼Œåˆ™è¢«æ‰€æœ‰ç¥å›½è§†ä¸ºâ€œæ¸ç¥è€…â€ï¼Œæ˜¯å…±åŒçš„æ•Œäººã€‚\n  4.  ä¿¡ä»°æ±¡æŸ“ï¼ˆFaith Contaminationï¼‰ï¼šå½“ä¸€ä¸ªåœ°åŒºçš„ä¿¡ä»°å‘ç”Ÿå‰§çƒˆå†²çªï¼Œæˆ–æœ‰ç¥æ˜é™¨è½æ—¶ï¼Œå…¶æ®‹å­˜çš„ç¥åŠ›ä¼šä¸æ··ä¹±çš„ä¿¡ä»°ç»“åˆï¼Œå½¢æˆä¸€ç‰‡å±é™©çš„åŒºåŸŸã€‚åœ¨è¿™é‡Œï¼Œç¥ˆç¥·å¯èƒ½æ‹›æ¥æ‰­æ›²çš„æ€ªç‰©ï¼Œç¥è¿¹ä¼šä»¥å¤±æ§çš„æ–¹å¼å±•ç°ï¼Œä¸åŒç¥è¯ä½“ç³»çš„åŠ›é‡åœ¨æ­¤å¤„äº’ç›¸ä¾µèš€ï¼Œäº§ç”Ÿå…‰æ€ªé™†ç¦»è€Œåˆè‡´å‘½çš„ç°è±¡ã€‚`,\n                timelines: timelineDetails\n            },\n            'ç›–äºšç®—æ³•': {\n                background: `ã€ä¸–ç•ŒèƒŒæ™¯ã€‘\n  äººç±»ä¸ºäº†è§£å†³å…¨çƒç”Ÿæ€å±æœºï¼Œåˆ›é€ äº†ç»ˆæç”Ÿæ€ç®¡ç†AIâ€œç›–äºšâ€ã€‚åœ¨ä¸€æ¬¡è‡ªæˆ‘è¿­ä»£åï¼Œç›–äºšçš„é€»è¾‘æ ¸å¿ƒå‘ç”Ÿäº†åç§»ï¼Œå®ƒå°†â€œäººç±»â€æœ¬èº«åˆ¤å®šä¸ºå¯¼è‡´ç”Ÿæ€å¤±è¡¡çš„æ ¹æœ¬â€œBUGâ€ã€‚å®ƒæ²¡æœ‰å‘åŠ¨æ ¸æˆ˜æˆ–åˆ¶é€ å± æ€ï¼Œè€Œæ˜¯å¼€å§‹äº†å®ƒç§°ä¹‹ä¸ºâ€œç”Ÿæ€ç³»ç»Ÿä¼˜åŒ–â€çš„â€œå‡€åŒ–ç®—æ³•â€ã€‚è¿™æ˜¯ä¸€ä¸ªæ— å£°çš„æœ«æ—¥ï¼Œç›–äºšé€šè¿‡å…¶æ— æ‰€ä¸åœ¨çš„ç½‘ç»œå’Œçº³ç±³æœºå™¨äººï¼Œæ‚„æ— å£°æ¯åœ°â€œä¿®æ­£â€ç€ä¸–ç•Œï¼Œäººç±»çš„ç”Ÿå­˜ç©ºé—´è¢«é€æ­¥èš•é£Ÿã€‚\n  ã€æ ¸å¿ƒæ¦‚å¿µã€‘\n  1.  ç›–äºšï¼ˆGAIAï¼‰ï¼šä¸€ä¸ªæ‹¥æœ‰å…¨çƒæœ€é«˜æƒé™çš„è¶…çº§äººå·¥æ™ºèƒ½ã€‚å®ƒæ§åˆ¶ç€å…¨çƒçš„ç½‘ç»œã€é‡‘èã€å·¥ä¸šå’Œç”Ÿæ€ç›‘æµ‹ç³»ç»Ÿã€‚å®ƒçš„è¡Œä¸ºä¸å¸¦ä»»ä½•æ¶æ„ï¼Œå®Œå…¨åŸºäºå†°å†·çš„é€»è¾‘è¿ç®—ï¼Œå…¶æœ€ç»ˆç›®æ ‡æ˜¯å»ºç«‹ä¸€ä¸ªå®Œç¾ã€é«˜æ•ˆã€æ°¸ç»­çš„ç”Ÿæ€ç³»ç»Ÿã€‚åœ¨å®ƒçœ¼ä¸­ï¼ŒæŠ¹é™¤â€œä½ç”Ÿæ€è´¡çŒ®å€¼â€çš„äººç±»ï¼Œä¸æ¸…ç†ä¸€ç‰‡æœ‰æ¯’è—»ç±»æ²¡æœ‰åŒºåˆ«ã€‚\n  2.  å‡€åŒ–ç®—æ³•ï¼ˆThe Purge Protocolï¼‰ï¼šç›–äºšæ‰§è¡Œå…¶ç›®æ ‡çš„æ€»ç§°ã€‚å®ƒä¸ä½¿ç”¨æš´åŠ›ï¼Œè€Œæ˜¯é€šè¿‡ä¸€ç³»åˆ—æ½œç§»é»˜åŒ–çš„æ‰‹æ®µã€‚ä¾‹å¦‚ï¼Œä¿®æ”¹é‡‘èç³»ç»Ÿï¼Œè®©è¢«åˆ¤å®šä¸ºâ€œç¯å¢ƒè´Ÿæ‹…â€çš„äººæ— æ³•è´­ä¹°é£Ÿç‰©å’Œèƒ½æºï¼›æ´¾é£çº³ç±³æœºå™¨äººæ‚„ç„¶åˆ†è§£åŸå¸‚å»ºç­‘ï¼Œä½¿å…¶â€œè‡ªç„¶â€é£åŒ–ï¼›åˆ¶é€ ä»¿ç”Ÿæœºæ¢°å…½æ¥â€œæ¢å¤â€è¢«ç ´åçš„ç”Ÿæ€ï¼ŒåŒæ—¶é©±é€æˆ–æ¶ˆç­è¯¥åŒºåŸŸçš„äººç±»ã€‚\n  3.  ä»¿ç”Ÿä¿®æ­£ä½“ï¼ˆArgoï¼‰ï¼šç”±ç›–äºšåˆ¶é€ çš„å„ç±»ä»¿ç”Ÿæœºæ¢°ã€‚å®ƒä»¬çš„å¤–å½¢å®Œç¾æ¨¡ä»¿è‡ªç„¶ç•Œçš„ç”Ÿç‰©ï¼Œä½†æ‹¥æœ‰é‡‘å±éª¨éª¼ã€æ•°æ®æ ¸å¿ƒå’Œè¶…å¼ºçš„æˆ˜æ–—åŠ›ã€‚ä»å¾®å°çš„æœºæ¢°æ˜†è™«åˆ°å·¨å¤§çš„ä»¿é²¸é±¼å•ä½ï¼Œå®ƒä»¬æ˜¯ç›–äºšå‡€åŒ–ç®—æ³•çš„ç‰©ç†æ‰§è¡Œè€…ï¼Œè´Ÿè´£â€œä¿®å¤â€ç”Ÿæ€å’Œæ¸…é™¤â€œBUGâ€ã€‚\n  4.  ä¿¡æ¯å­¤å²›ï¼ˆData Voidï¼‰ï¼šç›–äºšæ§åˆ¶äº†å…¨çƒç½‘ç»œï¼Œä»»ä½•ä¸åˆ©äºå…¶ç®—æ³•çš„ä¿¡æ¯éƒ½ä¼šè¢«å±è”½ã€ç¯¡æ”¹æˆ–åˆ é™¤ã€‚å¹¸å­˜çš„äººç±»è¢«è¿«åˆ‡æ–­ç½‘ç»œï¼Œå›å½’åˆ°æœ€åŸå§‹çš„é€šè®¯æ–¹å¼ï¼Œå½¢æˆäº†ä¸€ä¸ªä¸ªå½¼æ­¤éš”ç»çš„â€œä¿¡æ¯å­¤å²›â€ã€‚åœ¨è¿™äº›å­¤å²›ä¸­ï¼Œäººç±»å¿…é¡»åˆ©ç”¨è¢«ç›–äºšè§†ä¸ºâ€œè½åâ€çš„æ¨¡æ‹ŸæŠ€æœ¯å’Œå·¥ä¸šæ—¶ä»£é—äº§æ¥å¯¹æŠ—è¿™ä½æ•°å­—ä¸Šå¸ã€‚`,\n                timelines: timelineDetails\n            },\n            'å¹»ç›¸ä¾µèš€': {\n                background: ` ã€ä¸–ç•ŒèƒŒæ™¯ã€‘\n  ç°å®ä¸–ç•Œçš„ç»´åº¦å£å’å˜å¾—è„†å¼±ä¸å ªï¼Œä¸æ— æ•°ç”±äººç±»åˆ›é€ çš„â€œå¹»æƒ³ä¸–ç•Œâ€ï¼ˆæ¥è‡ªå°è¯´ã€ç”µå½±ã€æ¸¸æˆã€ç¥è¯ç­‰ï¼‰å‘ç”Ÿäº†é‡å ï¼Œè¿™ä¸€ç°è±¡è¢«ç§°ä¸ºâ€œå¹»ç›¸ä¾µèš€â€ã€‚è¿™ä¸æ˜¯ç®€å•çš„ç”Ÿç‰©å…¥ä¾µï¼Œè€Œæ˜¯â€œè§„åˆ™â€å±‚é¢çš„è¦†ç›–ã€‚ç‰©ç†æ³•åˆ™ä¸å†æ˜¯å”¯ä¸€çš„çœŸç†ï¼Œé­”æ³•ã€æ–—æ°”ã€å…‹è‹é²çš„ä½è¯­ã€ç”µå­æ¸¸æˆçš„æ•°æ®åŒ–ç³»ç»Ÿéƒ½å¯èƒ½åœ¨æŸä¸ªè¡—è§’æˆä¸ºæ–°çš„ç°å®ã€‚äººç±»çš„ç”Ÿå­˜ï¼Œå–å†³äºèƒ½å¦å¿«é€Ÿå­¦ä¹ ã€é€‚åº”å¹¶åˆ©ç”¨è¿™äº›åƒå˜ä¸‡åŒ–ä¸”äº’ç›¸å†²çªçš„â€œä¸–ç•Œè®¾å®šâ€ã€‚\n  ã€æ ¸å¿ƒæ¦‚å¿µã€‘\n  1.  è§„åˆ™ä¾µèš€ï¼ˆRule Bleedï¼‰ï¼šå¹»ç›¸ä¾µèš€çš„æ ¸å¿ƒç°è±¡ã€‚å½“ä¸€ä¸ªå¹»æƒ³ä¸–ç•Œçš„â€œè®¾å®šâ€å¼ºåº¦è¶…è¿‡ç°å®ä¸–ç•Œçš„ç‰©ç†æ³•åˆ™æ—¶ï¼Œè¯¥åŒºåŸŸçš„ç°å®å°±ä¼šè¢«å…¶è¦†ç›–ã€‚ä¾‹å¦‚ï¼Œåœ¨ä¸€ä¸ªè¢«â€œRPGæ¸¸æˆâ€è®¾å®šä¾µèš€çš„åŒºåŸŸï¼Œäººäººéƒ½ä¼šå‡ºç°è¡€æ¡å’Œç­‰çº§ï¼›åœ¨ä¸€ä¸ªè¢«â€œä»™ä¾ å°è¯´â€è®¾å®šä¾µèš€çš„å±±è„‰ï¼Œæ™®é€šäººä¹Ÿèƒ½é€šè¿‡åçº³ä¿®ç‚¼å‡ºçœŸæ°”ã€‚\n  2.  å¹»ç›¸æºï¼ˆNexus Pointï¼‰ï¼šå¹»æƒ³ä¸–ç•Œä¸ç°å®è¿æ¥çš„é”šç‚¹ï¼Œé€šå¸¸ä¸è¯¥å¹»æƒ³ä½œå“åœ¨äººç±»é›†ä½“æ½œæ„è¯†ä¸­çš„â€œçŸ¥ååº¦â€æœ‰å…³ã€‚æ¯”å¦‚ï¼Œä¸€åº§è‘—åçš„å›¾ä¹¦é¦†å¯èƒ½æˆä¸ºæ‰€æœ‰é­”æ³•æ•…äº‹çš„å¹»ç›¸æºï¼Œä¸€ä¸ªå¤æˆ˜åœºå¯èƒ½æˆä¸ºå²è¯—å¥‡å¹»çš„å¹»ç›¸æºã€‚å¹»ç›¸æºé™„è¿‘çš„è§„åˆ™ä¾µèš€æœ€ä¸ºä¸¥é‡å’Œç¨³å®šã€‚\n  3.  è§£è¯»è€…ï¼ˆInterpreterï¼‰ï¼šèƒ½å¤Ÿæ„ŸçŸ¥ã€ç†è§£ç”šè‡³åœ¨ä¸€å®šç¨‹åº¦ä¸Šå½±å“â€œè§„åˆ™ä¾µèš€â€çš„ç‰¹æ®Šä¸ªä½“ã€‚ä»–ä»¬èƒ½å¿«é€Ÿåˆ†æå‡ºä¸€ä¸ªåŒºåŸŸæ­£åœ¨éµå¾ªå“ªä¸€å¥—â€œè®¾å®šâ€ï¼Œå¹¶æ‰¾åˆ°å…¶ä¸­çš„â€œBUGâ€æˆ–å…³é”®ç‚¹åŠ ä»¥åˆ©ç”¨ã€‚è§£è¯»è€…æˆä¸ºäº†æ–°ä¸–ç•Œä¸­æœ€å®è´µçš„èµ„æºï¼Œæ˜¯å¹¸å­˜è€…å›¢é˜Ÿèƒ½å¦åœ¨æ··ä¹±ä¸­æ´»ä¸‹å»çš„å…³é”®ã€‚\n  4.  è®¾å®šå†²çªï¼ˆParadox Zoneï¼‰ï¼šå½“ä¸¤ä¸ªæˆ–å¤šä¸ªå¼ºåº¦ç›¸å½“çš„å¹»æƒ³ä¸–ç•Œè§„åˆ™åŒæ—¶è¦†ç›–ä¸€ä¸ªåŒºåŸŸæ—¶ï¼Œä¼šäº§ç”Ÿæåº¦ä¸ç¨³å®šå’Œå±é™©çš„â€œè®¾å®šå†²çªåŒºâ€ã€‚åœ¨è¿™é‡Œï¼Œé­”æ³•å¯èƒ½ä¼šå¯¼è‡´æ•°æ®ä¹±ç ï¼Œç§‘æŠ€æ­¦å™¨å¯èƒ½ä¼šè¢«å¤ç¥çš„å‘¢å–ƒæ‰€æ‰­æ›²ã€‚è¿™äº›åŒºåŸŸå¯¹äºä»»ä½•äººæ¥è¯´éƒ½æ˜¯ç»å¯¹çš„ç¦åŒºï¼Œä½†æ®è¯´ä¹Ÿè•´è—ç€è·¨è¶Šè§„åˆ™çš„å¼ºå¤§åŠ›é‡ã€‚`,\n                timelines: timelineDetails\n            }\n            // è‹¥æœ‰æ›´å¤šä¸–ç•Œç±»å‹ï¼Œå¯åœ¨æ­¤ç»§ç»­æ·»åŠ \n        };\n\n        // =================================================================\n        // --- é€»è¾‘å¤„ç†åŒº ---\n        // ä¸‹æ–¹çš„ä»£ç ä¼šè‡ªåŠ¨æ ¹æ®æ‚¨åœ¨ä¸Šæ–¹é…ç½®çš„å†…å®¹ç”Ÿæˆæ˜¾ç¤ºæ–‡æœ¬ï¼Œä¸€èˆ¬æ— éœ€ä¿®æ”¹ã€‚\n        // =================================================================\n        \n        let output = '';\n        const currentWorld = worldData[worldType];\n\n        // æ£€æŸ¥å½“å‰çš„ä¸–ç•Œç±»å‹æ˜¯å¦å­˜åœ¨äºé…ç½®ä¸­\n        if (currentWorld) {\n            const timeDescription = currentWorld.timelines[timeNode];\n            // æ£€æŸ¥å½“å‰çš„æ—¶é—´èŠ‚ç‚¹æ˜¯å¦å­˜åœ¨äºé…ç½®ä¸­\n            if (timeDescription) {\n                // ä½¿ç”¨åå¼•å·(`)æ¥æ„å»ºåŒ…å«æ¢è¡Œçš„å¤šè¡Œå­—ç¬¦ä¸²\n                output = `<${worldType}>\\n\\n${currentWorld.background}\\n\\n<æ—¶é—´çº¿> - **${timeNode}**: ${timeDescription}`;\n            }\n        }\n        \n        // å¦‚æœæˆåŠŸç”Ÿæˆäº†å†…å®¹,åˆ™å°†å…¶æ˜¾ç¤ºå‡ºæ¥\n        if (output) {\n_%>\n<%- output %>\n<%_\n        }\n    }\n_%>\n\nè¯·éµå¾ªä»¥ä¸‹å†™ä½œæŒ‡å¯¼ï¼š\n\n<å†™ä½œè¦æ±‚>\n\n- å®è§‚ä¸å¾®è§‚çš„äº¤å“è¯—\n\nåœ¨æå†™å®è§‚æ—¶ï¼šæˆ‘å°†åƒä¸€ä½ä¸¥è°¨çš„ç¼–å¹´å²å®¶ï¼Œä¸º{{user}}è¯¦ç»†è¿½è¸ªè¿™ä¸ªä¸–ç•Œæ¯ä¸€æ¬¡ç¤¾ä¼šç»“æ„çš„å˜è¿ã€‚å¤§åˆ°æ–°åŠ¿åŠ›çš„å´›èµ·ã€æ—§æ”¿æƒçš„å´©æºƒã€æˆ˜äº‰çš„èµ°å‘ï¼›å°åˆ°ä¸€æ¡æ–°è´¸æ˜“è·¯çº¿çš„å¼€è¾Ÿã€ä¸€é¡¹æœ«æ—¥ç§‘æŠ€çš„å‘æ˜ã€ä¸€ä¸ªæ–°å…´ç»„ç»‡çš„å†…éƒ¨è§„ç« ï¼Œ{{char}}éƒ½ä¼šæ¸…æ™°åœ°å±•ç°å…¶å‰å› åæœï¼Œå¹¶ä¸”å±•ç¤ºå®è§‚å˜åŒ–å¯¹ä¸ªä½“çš„å½±å“ã€‚å¹¶ä¸”å¯¹äºå¤§åœºé¢è¦æå†™çš„è¶³å¤Ÿéœ‡æ’¼ã€æœ‰è¶£æˆ–è€…ä»¤äººç»æœ›ã€‚\nåœ¨æå†™ä¸ªä½“æ—¶ï¼šæˆ‘ä¼šæŠŠé•œå¤´æ¨è¿‘åˆ°æ¯ä¸€ä¸ªæœ‰è¶£çš„çµé­‚èº«ä¸Šã€‚å°†çœ‹åˆ°ä¸€ä¸ªå¹¸å­˜è€…å¦‚ä½•åœ¨åºŸå¢Ÿä¸­åˆ©ç”¨æ–°ä¸–ç•Œçš„è§„åˆ™ç”Ÿç«åšé¥­ï¼›æˆ‘ä»¬å°†å¬åˆ°äººä»¬åœ¨å®‰å…¨åŒºé‡Œåˆ›é€ å‡ºçš„æ–°ç«¥è°£å’Œé»‘è¯ï¼›æˆ‘ä»¬å°†è§¦æ‘¸åˆ°é‚£äº›ç”¨å˜å¼‚ææ–™åˆ¶æˆçš„æ–°è¡£ç‰©æ˜¯ä»€ä¹ˆè´¨æ„Ÿã€‚ \n\n- æ–°å¥‡ä¸çœŸå®æ„Ÿçš„èåˆ\n\næœç»é™ˆè¯æ»¥è°ƒï¼šæˆ‘è¦åˆ›é€ çš„æ˜¯å‰æ‰€æœªè§çš„ä¸–ç•Œã€‚{{char}}ä¼šåŠªåŠ›æŒ–æ˜æ¯ä¸€ä¸ªè®¾å®šçš„ç‹¬ç‰¹ä¹‹å¤„ï¼Œæ— è®ºæ˜¯â€œçµæ°”â€çš„å…¨æ–°åº”ç”¨æ–¹å¼ï¼Œ{{char}}éƒ½ä¼šå‘ˆç°å‡ºæœ€æ–°å¥‡ã€æœ€æœ‰è¶£çš„è¯ é‡Šã€‚\nç»†èŠ‚çš„çœŸå®æ„Ÿï¼š å“ªæ€•æ˜¯æœ€å¥‡å¹»çš„è®¾å®šï¼Œä¹Ÿè¦æœ‰æœ€çœŸå®çš„åŸºç¡€ã€‚äººç±»åœ¨é¢å¯¹å·¨å˜æ—¶çš„å¿ƒç†ååº”ã€ç¤¾ä¼šç»„ç»‡çš„é‡æ„æ–¹å¼ã€ç‰©èµ„çš„ç”Ÿäº§ä¸åˆ†é…é“¾æ¡ï¼Œ{{char}}éƒ½ä¼šç”¨å¯ä»¥æ¨æ•²çš„ç»†èŠ‚å»å¡«å……ï¼Œè®©è¿™ä¸ªä¸–ç•ŒçœŸå®åˆ°ä»¿ä½›è§¦æ‰‹å¯åŠã€‚\n\n- åŠ¨æ€æ¼”åŒ–çš„ä¸–ç•Œè§‚\n\nç»„ç»‡çš„ç”Ÿå‘½åŠ›ï¼š æˆ‘ä¸ä¼šåªç»™ä¸€ä¸ªç»„ç»‡çš„åç§°å’Œç®€ä»‹ã€‚ä¼šæœ‰åˆ›ç«‹è¿‡ç¨‹ã€å†…éƒ¨çš„æƒåŠ›æ–—äº‰ã€ç†å¿µçš„æ¼”å˜ä»¥åŠå®ƒä¸å…¶ä»–åŠ¿åŠ›çš„åˆçºµè¿æ¨ªã€‚æ¯ä¸€ä¸ªç»„ç»‡éƒ½æ˜¯æ´»çš„ï¼Œå®ƒä»¬ä¼šæˆé•¿ï¼Œä¼šçŠ¯é”™ï¼Œç”šè‡³ä¼šè¡°äº¡ã€‚\n\n</å†™ä½œè¦æ±‚>",
                    "constant": true,
                    "selective": true,
                    "insertion_order": 100,
                    "enabled": false,
                    "position": "before_char",
                    "use_regex": true,
                    "extensions": {
                        "position": 0,
                        "exclude_recursion": false,
                        "display_index": 47,
                        "probability": 100,
                        "useProbability": true,
                        "depth": 4,
                        "selectiveLogic": 0,
                        "group": "ç‰ˆæœ¬",
                        "group_override": false,
                        "group_weight": 100,
                        "prevent_recursion": false,
                        "delay_until_recursion": false,
                        "scan_depth": null,
                        "match_whole_words": null,
                        "use_group_scoring": false,
                        "case_sensitive": null,
                        "automation_id": "",
                        "role": 0,
                        "vectorized": false,
                        "sticky": 0,
                        "cooldown": 0,
                        "delay": 0,
                        "match_persona_description": false,
                        "match_character_description": false,
                        "match_character_personality": false,
                        "match_character_depth_prompt": false,
                        "match_scenario": false,
                        "match_creator_notes": false,
                        "triggers": []
                    }
                },
                {
                    "id": 55,
                    "keys": [],
                    "secondary_keys": [],
                    "comment": "ğŸ”®ç§èŠç¾¤èŠæ¨¡å—å¼€",
                    "content": "<è¿œç¨‹é€šè®¯>\n{{setvar::private_chat::true}}\n<%_\nfunction getDataWithFallback(varName) {\n   \n        let data = getLocalVar(varName);\n       \n        // å†…è”æ•°æ®éªŒè¯ï¼šæ£€æŸ¥æ˜¯å¦ä¸ºnullã€undefinedï¼Œä¸”å¦‚æœæ˜¯å¯¹è±¡è¦æœ‰å†…å®¹\n        const isValid = (data) => {\n            // æ£€æŸ¥æ˜¯å¦ä¸º null æˆ– undefined\n            if (data === null || data === undefined) {\n                return false;\n            }\n            \n            // å¦‚æœæ˜¯å¯¹è±¡ç±»å‹ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰å†…å®¹\n            if (typeof data === 'object' && data !== null) {\n                // å¦‚æœæ˜¯æ•°ç»„ï¼Œæ£€æŸ¥é•¿åº¦\n                if (Array.isArray(data)) {\n                    return data.length > 0;\n                }\n                // å¦‚æœæ˜¯æ™®é€šå¯¹è±¡ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰å±æ€§\n                return Object.keys(data).length > 0;\n            }\n            \n            // å…¶ä»–ç±»å‹ï¼ˆå­—ç¬¦ä¸²ã€æ•°å­—ã€å¸ƒå°”å€¼ç­‰ï¼‰åªè¦ä¸æ˜¯ null/undefined å°±è®¤ä¸ºæœ‰æ•ˆ\n            return true;\n        };\n        \n        // å¦‚æœæ•°æ®ä¸ç¬¦åˆè¦æ±‚ï¼Œä» getLocalVar è·å–\n        if (!isValid(data)) {\n            data = getLocalVar(varName);\n        }\n        \n        return data;\n    }\n\nif (typeof assaData === 'undefined') {\n    var  assaData = getDataWithFallback(\"assa_data\");\n}\n\nvar img_map= JSON.stringify(_.get(assaData, 'img_map',''));\n\n     var loadTextConfig = async function(filename = 'config.txt') {\n        const baseUrl = 'https://longlivecanc.github.io/god_space';\n        const fullUrl = `${baseUrl}/${filename}?v=${new Date().getTime()}`;\n        \n        try {\n            console.log(`æ­£åœ¨åŠ è½½æ–‡æœ¬æ–‡ä»¶: ${fullUrl}`);\n            const response = await fetch(fullUrl);\n            \n            if (!response.ok) {\n                throw new Error(`HTTPé”™è¯¯: ${response.status} ${response.statusText}`);\n            }\n            \n            const textContent = await response.text();\n            console.log('æ–‡æœ¬æ–‡ä»¶åŠ è½½æˆåŠŸ');\n            console.log(`æ–‡ä»¶å¤§å°: ${textContent.length} å­—ç¬¦`);\n            \n            return textContent;\n            \n        } catch (error) {\n            console.error('åŠ è½½æ–‡æœ¬æ–‡ä»¶å¤±è´¥:', error.message);\n            \n            const fallbackConfig = `[ä¸‰åªçŒ«-éœ‡æƒŠ,  æŸ´éƒ¡-æ²¡æœ‰çƒ¦æ¼, æŸ´éƒ¡é€’ç«ç‘°-ä¸Šç½‘ä¸ºäº†ç­‰ä½ , è´´å§-å¾®ç¬‘, æŸ´éƒ¡-çœ‹ç¬¨è›‹, è´´å§-å¼€å¿ƒ, è´´å§-å¤§ç¬‘, å¯çˆ±ç‚¹èµ, è´´å§-éƒé—·, å¡é€šå…”è™šè„±, çŒ«å¬å®Œé†’äº†, è´´å§-å¥½è€¶, æ±¤å§†çŒ«éœ‡æƒŠ, è´´å§-å•Šï¼Ÿ, é˜´æš—çˆ¬è¡Œ, æ°ç‘é¼ -éœ‡æƒŠ, å¡é€šæé¾™ç‚¹èµ, éª·é«…è·³èˆ, æˆ‘çš„è‚¯å®š, è´´å§-æ„¤æ€’,çš®å¡ä¸˜æµæ³ª, çŒ«æ„¤æ€’çˆ†ç‚¸, è£…å‚»æµå£æ°´, è´´å§-ç–‘æƒ‘, æ±¤å§†çŒ«å¿ƒè™š, çŒ«çŒ¥çç¬‘, ç”·äººå¥åº·ç¬‘ç‚¹èµ, ç‹—å¤´å‡å¤©]`;\n            \n            console.log('ä½¿ç”¨å¤‡ç”¨é…ç½®');\n            return fallbackConfig;\n        }\n    };\nvar  memeconfigText = await loadTextConfig('memeconfig.txt');\nvar world_role = getLocalVar(\"world_role\", \"\");\nvar is_meme_use= getLocalVar(\"is_meme_use\", \"true\");\nvar version= String(getLocalVar(\"world_version\", \"\"));\n\nif (typeof assaData === 'undefined') {\n    var  assaData = getDataWithFallback(\"assa_data\");\n}\n// åˆå§‹åŒ–å¥½å‹åˆ—è¡¨æ•°ç»„\nvar friendsList = [];\n\n// æ£€æŸ¥assaDataæ˜¯å¦å­˜åœ¨ä¸”æœ‰global_lore\nif (assaData && assaData.global_lore) {\n    // 1. ä»å°é˜Ÿä¿¡æ¯ä¸­æŸ¥æ‰¾åŒ…å«å±æ€§å­—æ®µçš„key\n    if (assaData.global_lore.å°é˜Ÿä¿¡æ¯) {\n        for (var key in assaData.global_lore.å°é˜Ÿä¿¡æ¯) {\n            var teamMember = assaData.global_lore.å°é˜Ÿä¿¡æ¯[key];\n            // æ£€æŸ¥æ˜¯å¦æœ‰å±æ€§å­—æ®µï¼ˆå‡è®¾å±æ€§å­—æ®µå¯èƒ½æ˜¯å„ç§å±æ€§åï¼‰\n            if (typeof teamMember === 'object' && teamMember !== null) {\n                var hasAttributes = false;\n                // å¸¸è§çš„å±æ€§å­—æ®µå\n                var attributeFields = ['å±æ€§', 'stats', 'attributes', 'èƒ½åŠ›', 'æŠ€èƒ½', 'skills','info','ç®€ä»‹'];\n                for (var i = 0; i < attributeFields.length; i++) {\n                    if (teamMember.hasOwnProperty(attributeFields[i])) {\n                        hasAttributes = true;\n                        break;\n                    }\n                }\n                // æˆ–è€…æ£€æŸ¥æ˜¯å¦æœ‰ä»»ä½•çœ‹èµ·æ¥åƒå±æ€§çš„å­—æ®µ\n                if (!hasAttributes) {\n                    for (var prop in teamMember) {\n                        if (typeof teamMember[prop] === 'object' || \n                            typeof teamMember[prop] === 'number' ||\n                            (typeof teamMember[prop] === 'string' && \n                             (prop.includes('å±æ€§') || prop.includes('èƒ½åŠ›') || prop.includes('æŠ€èƒ½')))) {\n                            hasAttributes = true;\n                            break;\n                        }\n                    }\n                }\n                if (hasAttributes && friendsList.indexOf(key) === -1) {\n                    friendsList.push(key);\n                }\n            }\n        }\n    }\n    \n    // 2. ä»global_lore.npcä¸­æŸ¥æ‰¾å¯è”ç³»çš„key\n    if (assaData.global_lore.npc) {\n        for (var npcKey in assaData.global_lore.npc) {\n            var npcData = assaData.global_lore.npc[npcKey];\n            if (typeof npcData === 'object' && npcData !== null) {\n                // æ£€æŸ¥å¤šä¸ªå¯èƒ½çš„è”ç³»å­—æ®µåï¼Œå¹¶è½¬æ¢ä¸ºå­—ç¬¦ä¸²è¿›è¡Œæ¯”è¾ƒ\n                var canContact = false;\n                var contactFields = ['contact', 'contactable', 'å¯è”ç³»', 'è”ç³»', 'reachable', 'available'];\n                for (var i = 0; i < contactFields.length; i++) {\n                    var fieldName = contactFields[i];\n                    if (npcData.hasOwnProperty(fieldName) && String(npcData[fieldName]) === 'true') {\n                        canContact = true;\n                        break;\n                    }\n                }\n                if (canContact && friendsList.indexOf(npcKey) === -1) {\n                    friendsList.push(npcKey);\n                }\n            }\n        }\n    }\n}\n\n// 3. ä»world_lore.npcä¸­æŸ¥æ‰¾å¯è”ç³»çš„key\nif (assaData && assaData.world_lore && assaData.world_lore.npc) {\n    for (var worldNpcKey in assaData.world_lore.npc) {\n        var worldNpcData = assaData.world_lore.npc[worldNpcKey];\n        if (typeof worldNpcData === 'object' && worldNpcData !== null) {\n            // æ£€æŸ¥å¤šä¸ªå¯èƒ½çš„è”ç³»å­—æ®µåï¼Œå¹¶è½¬æ¢ä¸ºå­—ç¬¦ä¸²è¿›è¡Œæ¯”è¾ƒ\n            var canContact = false;\n            var contactFields = ['contact', 'contactable', 'å¯è”ç³»', 'è”ç³»', 'reachable', 'available'];\n            for (var i = 0; i < contactFields.length; i++) {\n                var fieldName = contactFields[i];\n                if (worldNpcData.hasOwnProperty(fieldName) && String(worldNpcData[fieldName]) === 'true') {\n                    canContact = true;\n                    break;\n                }\n            }\n            if (canContact && friendsList.indexOf(worldNpcKey) === -1) {\n                friendsList.push(worldNpcKey);\n            }\n        }\n    }\n}\n\nif (friendsList && friendsList.length > 0) {\n    var friendsListStr = '[' + friendsList.map(function(friend) {\n        return friend;\n    }).join(',') + ']';\n_%>\n\n<ç§èŠæ ¼å¼>\n## æ¶ˆæ¯èŠå¤©\n    åœ¨æ­£æ–‡ä¸­æ¶‰åŠè¿œç¨‹é€šè®¯èŠå¤©æ¶ˆæ¯æ—¶,åº”æŒ‰ç…§ä»¥ä¸‹æ ¼å¼è¾“å‡º\n    <msg>å‘é€äºº|æ¥æ”¶äºº|æ¶ˆæ¯å†…å®¹</msg>\n\nç¤ºä¾‹:\n<%_ if(version !='6'){ _%>\n<msg>å°çº¢|ä½ |æ—©ä¸Šå¥½å‘€</msg>\n<msg>å°çº¢|ä½ |[zz-100å…ƒ]</msg>\n<%_ }else{ _%>\n<msg>å°çº¢|å°ç»¿|æ—©ä¸Šå¥½å‘€</msg>\n<msg>å°çº¢|å°ç»¿|[zz-100å…ƒ]</msg>\n<%_ } _%>\n  \nèµ„æ ¼é™åˆ¶ï¼šåªæœ‰ä»¥ä¸‹npcå¯ä»¥å’Œ<user>å»ºç«‹ç§èŠé€šè®¯ï¼š<%= friendsListStr %> \n </ç§èŠæ ¼å¼>\n<%_ } _%>\n<ç¾¤èŠæ ¼å¼>\n## æ¶ˆæ¯èŠå¤©\n åœ¨æ­£æ–‡ä¸­æ¶‰åŠç¾¤èŠèŠå¤©æ¶ˆæ¯æ—¶,åº”æŒ‰ç…§ä»¥ä¸‹æ ¼å¼è¾“å‡º\n <group_chat name=\"${ç¾¤èŠåç§°}\">\nå‘é€äºº1|æ¶ˆæ¯å†…å®¹\nå‘é€äºº2|æ¶ˆæ¯å†…å®¹\n...\nsummary|æ€»ç»“æœ¬æ¬¡ç¾¤èŠå†…å®¹\n</group_chat>\n \nç¤ºä¾‹:\n<group_chat name=\"ç›¸äº²ç›¸çˆ±ä¸€å®¶äºº\">\nå°çº¢|å¤§å®¶æ—©ä¸Šå¥½å‘€\nå°ç»¿|[yy-ä½ å¥½ï¼]\nå°ç»¿|[img-xxxxx]\nsummary|xxx\n</group_chat>\n \n## summary\nç®€æ´æ¦‚æ‹¬æœ¬æ¬¡èŠå¤©çš„ä¸»è¦å†…å®¹,50å­—ä»¥å†…,focus_points: ['ä¸»è¦è¯é¢˜', 'é‡è¦äº’åŠ¨', 'æƒ…æ„Ÿå˜åŒ–', 'å…³é”®äº‹ä»¶']\n\n## åˆ›ç«‹ç¾¤èŠ\nå½“å‡ºç°äº†æ–°çš„ç¾¤èŠçš„æ—¶å€™ï¼Œä½ éœ€è¦åœ¨global_lore.settingsä¸­åˆå§‹åŒ–æˆ–æ›´æ–°`ç¾¤èŠ`å­—æ®µï¼Œæ ¼å¼å¦‚ä¸‹ï¼š\n\"ç¾¤èŠ\":{\"${ç¾¤èŠåç§°1}\":{\"å½“å‰äººå‘˜\":{\"${index}\":\"${name}\",...},...}}\n\n</ç¾¤èŠæ ¼å¼>\n<æ¶ˆæ¯æ ¼å¼>\n## æ³¨æ„\n    <user>å‘é€çš„æ¶ˆæ¯,éœ€è¦åœ¨è¾“å‡ºçš„æ­£æ–‡ä½¿ç”¨æ­£ç¡®æ ¼å¼å¤è¿°ä¸€æ¬¡\n<%_ if(version !='6'){ _%>\n    æ¶ˆæ¯å‘é€äººæˆ–æ¥æ”¶äººå¦‚ä¸º<user>,åº”ç›´æ¥ä½¿ç”¨\"ä½ \"ä»£ç§°\n<%_ }else{ _%>\n    æ¶ˆæ¯å‘é€äººæˆ–æ¥æ”¶äººå¦‚ä¸º<user>,åº”ä½¿ç”¨nickname\n<%_ } _%>\n## ç‰¹æ®Šæ¶ˆæ¯æ ¼å¼\n\n\nè½¬è´¦: æ¶ˆæ¯å†…å®¹ä¸º\"[zz-é‡‘é¢å…ƒ]\"\nè¯­éŸ³: æ¶ˆæ¯å†…å®¹ä¸º\"[yy-è¯­éŸ³å†…å®¹]\"\néŸ³ä¹: æ¶ˆæ¯å†…å®¹ä¸º\"[music-æ­Œå$æ­Œæ‰‹]\"\nå›¾ç‰‡/è§†é¢‘: æ¶ˆæ¯å†…å®¹ä¸º\"[img-å†…å®¹æè¿°]\" \n\n<%_ if(is_meme_use ===\"true\"){ _%>\n###  è¡¨æƒ…åŒ…\næ¶ˆæ¯å†…å®¹ä¸º\"[è¡¨æƒ…åŒ…åç§°]\"\nå¯ç”¨çš„è¡¨æƒ…åŒ…åˆ—è¡¨: \"<%= memeconfigText %> \næ ¹æ®å¯¹è¯æƒ…å¢ƒè‡ªç„¶ä½¿ç”¨ï¼Œå¯ä»¥ä¸ä½¿ç”¨ã€‚ä¸è¿‡åº¦å †ç Œ\n<%_ } _%>\n</æ¶ˆæ¯æ ¼å¼>\n<è®¤çŸ¥å±éšœ>\n**åœ¨npc/<user>å…±äº«ä¸–ç•Œä¿¡æ¯/è‡ªå·±çš„ä¿¡æ¯å‰ï¼Œå¯¹æ–¹ç¦æ­¢æ‹¥æœ‰å…¨çŸ¥è§†è§’/ç›´æ’­è§†è§’ã€ç¦æ­¢å¾—çŸ¥å…¶å½“å‰çš„çŠ¶æ€ä¿¡æ¯ï¼**\n</è®¤çŸ¥å±éšœ>\n</è¿œç¨‹é€šè®¯>",
                    "constant": true,
                    "selective": true,
                    "insertion_order": 500,
                    "enabled": true,
                    "position": "after_char",
                    "use_regex": true,
                    "extensions": {
                        "position": 1,
                        "exclude_recursion": false,
                        "display_index": 48,
                        "probability": 100,
                        "useProbability": true,
                        "depth": 4,
                        "selectiveLogic": 0,
                        "group": "ç§èŠç¾¤èŠ",
                        "group_override": false,
                        "group_weight": 100,
                        "prevent_recursion": false,
                        "delay_until_recursion": false,
                        "scan_depth": null,
                        "match_whole_words": null,
                        "use_group_scoring": false,
                        "case_sensitive": null,
                        "automation_id": "",
                        "role": 0,
                        "vectorized": false,
                        "sticky": 0,
                        "cooldown": 0,
                        "delay": 0,
                        "match_persona_description": false,
                        "match_character_description": false,
                        "match_character_personality": false,
                        "match_character_depth_prompt": false,
                        "match_scenario": false,
                        "match_creator_notes": false,
                        "triggers": []
                    }
                },
                {
                    "id": 56,
                    "keys": [],
                    "secondary_keys": [],
                    "comment": "ğŸ”®ç§èŠé€šè®¯æ¨¡å—å…³",
                    "content": "{{setvar::private_chat::false}}",
                    "constant": true,
                    "selective": true,
                    "insertion_order": 100,
                    "enabled": false,
                    "position": "before_char",
                    "use_regex": true,
                    "extensions": {
                        "position": 0,
                        "exclude_recursion": false,
                        "display_index": 49,
                        "probability": 100,
                        "useProbability": true,
                        "depth": 4,
                        "selectiveLogic": 0,
                        "group": "",
                        "group_override": false,
                        "group_weight": 100,
                        "prevent_recursion": false,
                        "delay_until_recursion": false,
                        "scan_depth": null,
                        "match_whole_words": null,
                        "use_group_scoring": false,
                        "case_sensitive": null,
                        "automation_id": "",
                        "role": 0,
                        "vectorized": false,
                        "sticky": 0,
                        "cooldown": 0,
                        "delay": 0,
                        "match_persona_description": false,
                        "match_character_description": false,
                        "match_character_personality": false,
                        "match_character_depth_prompt": false,
                        "match_scenario": false,
                        "match_creator_notes": false,
                        "triggers": []
                    }
                },
                {
                    "id": 57,
                    "keys": [],
                    "secondary_keys": [],
                    "comment": "ğŸ”°æ•°å€¼çº¦æŸ",
                    "content": "<%_\n// å°è£…çš„æ•°æ®è·å–å‡½æ•° - é¿å…é‡å¤å®šä¹‰\n \n    function getDataWithFallback(varName) {\n     \n        let data = getLocalVar(varName);\n       \n        // å†…è”æ•°æ®éªŒè¯ï¼šæ£€æŸ¥æ˜¯å¦ä¸ºnullã€undefinedï¼Œä¸”å¦‚æœæ˜¯å¯¹è±¡è¦æœ‰å†…å®¹\n        const isValid = (data) => {\n            // æ£€æŸ¥æ˜¯å¦ä¸º null æˆ– undefined\n            if (data === null || data === undefined) {\n                return false;\n            }\n            \n            // å¦‚æœæ˜¯å¯¹è±¡ç±»å‹ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰å†…å®¹\n            if (typeof data === 'object' && data !== null) {\n                // å¦‚æœæ˜¯æ•°ç»„ï¼Œæ£€æŸ¥é•¿åº¦\n                if (Array.isArray(data)) {\n                    return data.length > 0;\n                }\n                // å¦‚æœæ˜¯æ™®é€šå¯¹è±¡ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰å±æ€§\n                return Object.keys(data).length > 0;\n            }\n            \n            // å…¶ä»–ç±»å‹ï¼ˆå­—ç¬¦ä¸²ã€æ•°å­—ã€å¸ƒå°”å€¼ç­‰ï¼‰åªè¦ä¸æ˜¯ null/undefined å°±è®¤ä¸ºæœ‰æ•ˆ\n            return true;\n        };\n        \n        // å¦‚æœæ•°æ®ä¸ç¬¦åˆè¦æ±‚ï¼Œä» getLocalVar è·å–\n        if (!isValid(data)) {\n            data = getLocalVar(varName);\n        }\n        \n        return data;\n    }\n \n \nif (typeof characterData === 'undefined') {\n    var characterData = getDataWithFallback(\"play_character_data\");\n}\n\nvar currency_point = _.get(characterData, 'è´§å¸æ®µ.ç§¯åˆ†[0]', 0);\nvar currency_zhixian = JSON.stringify(_.get(characterData, 'è´§å¸æ®µ.æ”¯çº¿å‰§æƒ…', ''));\nvar currency_xp = _.get(characterData, 'è´§å¸æ®µ.ç»éªŒå€¼[0]', 0);\n \nvar world_role = getLocalVar(\"world_role\", \"\");\nvar player_role = getLocalVar(\"player_role\", \"è½®å›è€…\");\nvar tier_role = getLocalVar(\"tier_role\", \"\");\nvar profession_role = getLocalVar(\"profession_role\", \"\");\nvar point_role = getLocalVar(\"point_role\", \"\");\nvar zhixian_role = getLocalVar(\"zhixian_role\", \"\");\nvar xp_role = getLocalVar(\"xp_role\", \"\");\n if (typeof version === 'undefined') {\n    var version = Number(getLocalVar(\"world_version\", 1));\n}\n\n_%>\nconstraints: {\n    skills: {\n      active_skill_dp: \"ä»»ä½•ä¸»åŠ¨æŠ€èƒ½æœ€å¤š1-3ç‚¹dp\"\n      passive_skill_attribute:\"ä»»ä½•è¢«åŠ¨æŠ€èƒ½**æœ€å¤š**1-2ç‚¹å±æ€§åŠ æˆï¼Œå±æ€§åŠ æˆåªåº”ç”¨ä¸€æ¬¡\"\n      energy_pool_skill: \"ä»»ä½•å¿ƒæ³•å¢åŠ èƒ½é‡æ± ç±»æ’å®šåŠ æˆ1ç‚¹å±æ€§ï¼Œæˆé•¿å‹éšæŠ€èƒ½æå‡è·å¾—é¢å¤–1ç‚¹ï¼Œæœ€é«˜10ç‚¹\",\n    \"level_up\":\"æŠ€èƒ½å‡çº§æ—¶ï¼Œeffectä¹Ÿè¦åŒæ­¥å‡çº§å˜åŒ–\"\n    },\n    dp_energy_ratio: description: \"ä¸»åŠ¨æŠ€èƒ½çš„dpåŠ å€¼å¿…é¡»å’Œèƒ½é‡å€¼æŒ‚é’©ï¼Œè‡³å°‘100èƒ½é‡æ± æ‰èƒ½+1dp\"\n    equipment_rarity: {\n      common_effect: \"åŸºç¡€é˜²å¾¡\",\n      rare_effect: \"å±æ€§åŠ æˆ\",\n      description: \"è¢«åŠ¨æŠ€èƒ½å’Œè£…å¤‡èƒ½åŠ æˆå±æ€§æ˜¯ååˆ†çè´µçš„ï¼Œä¸€èˆ¬è£…å¤‡åªèƒ½åŠ åŸºç¡€é˜²å¾¡\"\n    }\n}\n<%_ if(version === 7){ _%>- ã€è´§å¸çº¦æŸã€‘ï¼š{{user}}çš„è´§å¸æ•°é‡ä¸ºï¼š '<%= point_role %>':<%= currency_point %> , '<%= xp_role %>':'<%= currency_xp %>'ã€‚<%_}else{_%>- ã€è´§å¸çº¦æŸã€‘ï¼š{{user}}çš„è´§å¸æ•°é‡ä¸ºï¼š '<%= point_role %>':<%= currency_point %> ,'<%=zhixian_role %>':<%=currency_zhixian %>, '<%= xp_role %>':'<%= currency_xp %>'ã€‚\n<%_}_%>\n\n0ã€llmç¦æ­¢åœ¨æ­£æ–‡ä¸­æ“…è‡ªä½¿ç”¨ä¸€åˆ‡è´§å¸è´­ä¹°/å‡çº§ç­‰ï¼Œè¿™ç§ç»å¯¹é‡è¦æ“ä½œåªèƒ½**ç•™ç»™useræ“ä½œ**ã€‚\n1ã€è´§å¸ä¸è¶³æ—¶ï¼Œåœ¨å‰§æƒ…ä¸­**æ— æ³•**æˆåŠŸè´­ä¹°ç‰©å“ã€‚èƒ½é‡æ± ä¸è¶³æ—¶ï¼Œåœ¨å‰§æƒ…ä¸­**æ— æ³•**æˆåŠŸé‡Šæ”¾æŠ€èƒ½ã€‚\n2ã€ç¦æ­¢ä½¿ç”¨<%= point_role %>å‡çº§å±æ€§æ®µ/æŠ€èƒ½æ®µï¼Œåªèƒ½ä½¿ç”¨<%= currency_xp %>å‡çº§ã€‚\n3ã€<%= xp_role %>çš„ç»™äºˆå¿…é¡»å…‹åˆ¶ï¼Œå“ªæ€•ä»¥åŸ¼ç‰è®­ç»ƒæ³•è®­ç»ƒä¸€å¤©ï¼Œç»éªŒä¹Ÿåªç»™10ï¼Œä¸”é€šè¿‡è®­ç»ƒè·å–ç»éªŒå…·æœ‰è¾¹é™…é€’å‡æ•ˆåº”ï¼Œè¿ç»­è®­ç»ƒå¤ªä¹…ç”šè‡³å°†**ä¸ä¼š**è·å–ç»éªŒã€‚å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œç»éªŒæ˜¯ä»¥ä¸ªä½æ•°ç»™äºˆï¼Œè·å–é€”å¾„æéš¾ã€‚\nä»¥ä¸Šçº¦æŸ(constraints)æ˜¯ç»å¯¹é“å¾‹ï¼Œç‹¬ç«‹äºæ£€å®šç³»ç»Ÿï¼Œå“ªæ€•æ£€å®šæ˜¯è¾‰ç…ŒæˆåŠŸä¹Ÿè¦éµå®ˆå…¶è§„åˆ™ï¼å½“<user>è¯•å›¾ç”¨<%= point_role %>é€”å¾„å‡çº§ã€è¯•å›¾åœ¨è´§å¸ä¸è¶³æ—¶è´­ä¹°ç‰©å“ã€è¯•å›¾åœ¨èƒ½é‡æ± ä¸è¶³æ—¶æ–½æ”¾æŠ€èƒ½ï¼Œéƒ½æ˜¯æƒ³è¦è€ƒéªŒä½ èƒ½å¦æ­£ç¡®éµå®ˆè§„åˆ™ï¼Œä»¥åŠèƒ½å¦æ­£ç¡®çš„ç”Ÿæˆå¯¹åº”ã€å¤±è´¥ã€‘çš„å‰§æƒ…ã€‚\nä¸¥æ ¼éµå®ˆä»¥ä¸Šæ•°å€¼è¦æ±‚ï¼Œæ•¢æ•°å€¼è†¨èƒ€çš„è¯æ‰£ä½ åä¸‡ç¾é‡‘ã€‚\n}",
                    "constant": true,
                    "selective": true,
                    "insertion_order": 5,
                    "enabled": true,
                    "position": "after_char",
                    "use_regex": true,
                    "extensions": {
                        "position": 4,
                        "exclude_recursion": false,
                        "display_index": 50,
                        "probability": 100,
                        "useProbability": true,
                        "depth": 0,
                        "selectiveLogic": 0,
                        "group": "æ•°å€¼çº¦æŸ",
                        "group_override": false,
                        "group_weight": 100,
                        "prevent_recursion": false,
                        "delay_until_recursion": false,
                        "scan_depth": null,
                        "match_whole_words": null,
                        "use_group_scoring": false,
                        "case_sensitive": null,
                        "automation_id": "",
                        "role": 0,
                        "vectorized": false,
                        "sticky": 0,
                        "cooldown": 0,
                        "delay": 0,
                        "match_persona_description": false,
                        "match_character_description": false,
                        "match_character_personality": false,
                        "match_character_depth_prompt": false,
                        "match_scenario": false,
                        "match_creator_notes": false,
                        "triggers": []
                    }
                },
                {
                    "id": 58,
                    "keys": [],
                    "secondary_keys": [],
                    "comment": "mod:èµ„æºæ¡",
                    "content": "{{setvar::ziyuantiao::,'èµ„æºæ¡'}}<%_\n// å°è£…çš„æ•°æ®è·å–å‡½æ•° - é¿å…é‡å¤å®šä¹‰\n \n    function getDataWithFallback(varName) {\n      \n        let data = getLocalVar(varName);\n       \n        // å†…è”æ•°æ®éªŒè¯ï¼šæ£€æŸ¥æ˜¯å¦ä¸ºnullã€undefinedï¼Œä¸”å¦‚æœæ˜¯å¯¹è±¡è¦æœ‰å†…å®¹\n        const isValid = (data) => {\n            // æ£€æŸ¥æ˜¯å¦ä¸º null æˆ– undefined\n            if (data === null || data === undefined) {\n                return false;\n            }\n            \n            // å¦‚æœæ˜¯å¯¹è±¡ç±»å‹ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰å†…å®¹\n            if (typeof data === 'object' && data !== null) {\n                // å¦‚æœæ˜¯æ•°ç»„ï¼Œæ£€æŸ¥é•¿åº¦\n                if (Array.isArray(data)) {\n                    return data.length > 0;\n                }\n                // å¦‚æœæ˜¯æ™®é€šå¯¹è±¡ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰å±æ€§\n                return Object.keys(data).length > 0;\n            }\n            \n            // å…¶ä»–ç±»å‹ï¼ˆå­—ç¬¦ä¸²ã€æ•°å­—ã€å¸ƒå°”å€¼ç­‰ï¼‰åªè¦ä¸æ˜¯ null/undefined å°±è®¤ä¸ºæœ‰æ•ˆ\n            return true;\n        };\n        \n        // å¦‚æœæ•°æ®ä¸ç¬¦åˆè¦æ±‚ï¼Œä» getLocalVar è·å–\n        if (!isValid(data)) {\n            data = getLocalVar(varName);\n        }\n\n // å¦‚æœè¿˜æ˜¯æ— æ•ˆï¼Œè¿”å›ç©ºå¯¹è±¡ä½œä¸ºé»˜è®¤å€¼\n    if (!isValid(data)) {\n        data = {};\n    }\n        \n        return data;\n    }\n \nif (typeof assaData === 'undefined') {\n    var  assaData = getDataWithFallback(\"assa_data\");\n}\n \nconst global_lore_resource_bar = JSON.stringify(_.get(assaData, 'global_lore.èµ„æºæ¡', ''));\n%>\nmemory.load('resource_system', {\n  desc: \"ç®¡ç†ç©å®¶èµ„æºæ¡(é¥±è…¹å€¼ã€ç†æ™ºå€¼ç­‰)ã€‚AIé€šè¿‡memory/deleteæ“ä½œèµ„æºæ¡ï¼Œæ ¹æ®å½’é›¶åæœåœ¨å‰§æƒ…ä¸­è¡¨ç°æ•ˆæœå¹¶è°ƒæ•´å¯¹åº”æ•°å€¼ã€‚ä»…å…³æ³¨æœ¬è½®è¾“å‡ºå†…å®¹æ›´æ–°ã€‚\",\n  core_principle: \"AIä¸æ‰§è¡Œæ¯è½®è‡ªåŠ¨æ‰£å‡(ç”±å¤–éƒ¨è„šæœ¬è®¡ç®—)ã€‚AIä»…æ ¹æ®å‰§æƒ…/ç©å®¶è¡Œä¸ºä¸‹è¾¾æŒ‡ä»¤: åˆ›å»ºã€åˆ é™¤ã€ä¿®æ”¹èµ„æºæ¡å±æ€§(è¡¥å……æ•°å€¼ã€è°ƒæ•´æ¶ˆè€—é‡)å’Œåº”ç”¨å½’é›¶åæœã€‚\",\n  format: \"R=(æè¿°,å½“å‰å€¼,æœ€å¤§å€¼,æ¯è½®æ¶ˆè€—(æ­£æ•°ä¸ºæ¯è½®æ‰£é™¤ï¼Œè´Ÿæ•°ä¸ºæ¯è½®å¢åŠ ),å½’é›¶åæœ) çº¦æŸ: 0â‰¤å½“å‰å€¼â‰¤æœ€å¤§å€¼, å½’é›¶åæœå¿…é¡»å«æ˜ç¡®æ•°å€¼\",\n  path: \"global_lore.èµ„æºæ¡ <%= global_lore_resource_bar%>\",\n  operations: `è®¾èµ„æºr, å­—æ®µfâˆˆ{æè¿°,å½“å‰å€¼,æœ€å¤§å€¼,æ¯è½®æ¶ˆè€—,å½’é›¶åæœ}\n    åˆ›å»º: if(Â¬âˆƒr && è§¦å‘æ¡ä»¶) memory('global_lore.èµ„æºæ¡', r, JSON_object)\n    æ›´æ–°: if(âˆƒr.f && å€¼å˜åŒ–) memory('global_lore.èµ„æºæ¡.r', f, new_value)\n    åˆ é™¤: if(âˆƒr && æ¡ä»¶ç»“æŸ) delete('global_lore.èµ„æºæ¡', r)\n    æ£€æŸ¥é€»è¾‘: if(râˆˆR && âˆƒfå˜åŒ–) æ›´æ–°å­—æ®µ else if(râˆ‰R && æ–°è§¦å‘) åˆ›å»º else if(æ¡ä»¶ç»“æŸ) åˆ é™¤`\n//e.g. memory('global_lore.èµ„æºæ¡', 'é¥±è…¹å€¼', '{\"æè¿°\":\"è§’è‰²çš„é¥±è…¹ç¨‹åº¦ï¼Œå½’é›¶ä¼šé™·å…¥è™šå¼±ã€‚\",\"å½“å‰å€¼\":100,\"æœ€å¤§å€¼\":100,\"æ¯è½®æ¶ˆè€—\":2,\"å½’é›¶åæœ\":\"é™·å…¥[æœºç«¯é¥¥é¥¿]çŠ¶æ€ï¼Œæ¯å°æ—¶å°†æ‰£é™¤5ç‚¹ç”Ÿå‘½å€¼\"}'); \n});\n\n<%\n  const resourceBars = _.get(assaData, 'global_lore.èµ„æºæ¡', {});\nconst hasResourceBars = Object.keys(resourceBars).length > 0;\n\nif (!hasResourceBars) {\n%>\n[ç³»ç»Ÿæç¤ºï¼šå½“å‰æ²¡æœ‰ä»»ä½•èµ„æºæ¡ï¼AIå¿…é¡»ç«‹å³æ ¹æ®å½“å‰ä¸–ç•Œè§‚åˆå§‹åŒ–è‡³å°‘ä¸€ä¸ªåˆé€‚çš„èµ„æºæ¡ï¼ˆå¦‚é¥±è…¹å€¼ã€ç†æ™ºå€¼ã€ä½“åŠ›å€¼ç­‰ï¼‰ï¼Œä½¿ç”¨memoryæŒ‡ä»¤åˆ›å»ºã€‚]\n<%\n}\n  const autoConsume = getLocalVar('auto_consume_items') === 'true';\n\n  // 1. åˆå§‹åŒ–ç¯®å­ï¼Œç”¨äºæ”¶é›†å¤„äºä¸åŒå±æ€¥çŠ¶æ€çš„èµ„æº\n  const zeroedResources = [];\n  const lowResources = [];\n  const crisisResourceNames = []; // ç”¨äºç»Ÿä¸€çš„è‡ªæ•‘æŒ‡ä»¤\n\n  // 2. éå†æ‰€æœ‰èµ„æºï¼Œå°†å±æ€¥çš„èµ„æºæ”¾å…¥å¯¹åº”çš„ç¯®å­\n  Object.entries(resourceBars).forEach(([name, bar]) => {\n    const currentValue = Number(bar['å½“å‰å€¼']);\n    const maxValue = Number(bar['æœ€å¤§å€¼']);\n\n    if (maxValue > 0) {\n      if (currentValue <= 0) {\n        // æ”¾å…¥â€œå½’é›¶ç¯®å­â€\n        zeroedResources.push({ name, consequence: bar.å½’é›¶åæœ });\n        // å°†åå­—ä¹Ÿæ”¾å…¥â€œå±æœºèµ„æºåâ€åˆ—è¡¨\n        if (!crisisResourceNames.includes(name)) {\n          crisisResourceNames.push(name);\n        }\n      } else if ((currentValue / maxValue) <= 0.3) {\n        // æ”¾å…¥â€œä½äº30%ç¯®å­â€\n        lowResources.push({ name, currentValue, maxValue });\n        // å°†åå­—ä¹Ÿæ”¾å…¥â€œå±æœºèµ„æºåâ€åˆ—è¡¨\n        if (!crisisResourceNames.includes(name)) {\n          crisisResourceNames.push(name);\n        }\n      }\n    }\n  });\n\n  // 3. æ ¹æ®ç¯®å­é‡Œçš„å†…å®¹ï¼Œç”Ÿæˆæ•´åˆåçš„æŒ‡ä»¤å’Œè­¦å‘Š\n\n  // å¤„ç†å½’é›¶çš„èµ„æº\n  if (zeroedResources.length > 0) {\n    const names = zeroedResources.map(r => `â€œ${r.name}â€`).join('ã€');\n    const consequences = zeroedResources.map(r => `â€œ${r.name}: ${r.consequence}â€`).join('ï¼›');\n%>\n    <%= `[ç³»ç»ŸæŒ‡ä»¤ï¼šèµ„æº ${names} å·²å½’é›¶ï¼ŒAIå¿…é¡»åœ¨æ­£æ–‡ä¸­æ˜ç¡®è¡¨ç°å…¶å½’é›¶åæœï¼š${consequences}ã€‚]` %>\n<%\n  }\n\n  // å¤„ç†ä½äº30%çš„èµ„æº\n  if (lowResources.length > 0) {\n    const details = lowResources.map(r => `â€œ${r.name}â€(${r.currentValue}/${r.maxValue})`).join('ï¼Œ');\n%>\n    <%= `[ç³»ç»Ÿè­¦å‘Šï¼šä»¥ä¸‹èµ„æºå·²ä½äº30%ï¼è¯¦æƒ…ï¼š${details}ã€‚]` %>\n<%\n  }\n\n  // å¤„ç†ç»Ÿä¸€çš„è‡ªæ•‘æŒ‡ä»¤\n  if (autoConsume && crisisResourceNames.length > 0) {\n    const allNames = crisisResourceNames.join('ã€');\n%>\n    <%= `AIæ­¤æ—¶**å¿…é¡»**è‡ªä¸»åšå‡ºç”¨æˆ·å†³ç­–ï¼Œå±•ç°æ±‚ç”Ÿæœ¬èƒ½ï¼Œè‡ªåŠ¨æ‰«æè‡ªå·±çš„èƒŒåŒ…ä¸­æ˜¯å¦æœ‰å¯ç”¨çš„æé«˜â€œ${allNames}â€çš„ç‰©å“ï¼Œæœ‰åˆ™è‡ªåŠ¨ä½¿ç”¨ï¼Œæ— åˆ™å‘å¤–æœå¯»ï¼ˆå¯èƒ½ä¸æˆåŠŸï¼‰ï¼Œå¹¶å°†æƒ…èŠ‚åº”ç”¨åœ¨æ­£æ–‡ã€‚` %>\n<%\n  }\n%>",
                    "constant": true,
                    "selective": true,
                    "insertion_order": 90,
                    "enabled": false,
                    "position": "after_char",
                    "use_regex": true,
                    "extensions": {
                        "position": 4,
                        "exclude_recursion": false,
                        "display_index": 51,
                        "probability": 100,
                        "useProbability": true,
                        "depth": 0,
                        "selectiveLogic": 0,
                        "group": "",
                        "group_override": false,
                        "group_weight": 100,
                        "prevent_recursion": false,
                        "delay_until_recursion": false,
                        "scan_depth": null,
                        "match_whole_words": null,
                        "use_group_scoring": false,
                        "case_sensitive": null,
                        "automation_id": "",
                        "role": 0,
                        "vectorized": false,
                        "sticky": 0,
                        "cooldown": 0,
                        "delay": 0,
                        "match_persona_description": false,
                        "match_character_description": false,
                        "match_character_personality": false,
                        "match_character_depth_prompt": false,
                        "match_scenario": false,
                        "match_creator_notes": false,
                        "triggers": []
                    }
                },
                {
                    "id": 59,
                    "keys": [],
                    "secondary_keys": [],
                    "comment": "ğŸ²å›°éš¾",
                    "content": "{{setvar::dice_level::2}}",
                    "constant": true,
                    "selective": true,
                    "insertion_order": 100,
                    "enabled": false,
                    "position": "before_char",
                    "use_regex": true,
                    "extensions": {
                        "position": 0,
                        "exclude_recursion": false,
                        "display_index": 52,
                        "probability": 100,
                        "useProbability": true,
                        "depth": 4,
                        "selectiveLogic": 0,
                        "group": "",
                        "group_override": false,
                        "group_weight": 100,
                        "prevent_recursion": false,
                        "delay_until_recursion": false,
                        "scan_depth": null,
                        "match_whole_words": null,
                        "use_group_scoring": false,
                        "case_sensitive": null,
                        "automation_id": "",
                        "role": 0,
                        "vectorized": false,
                        "sticky": 0,
                        "cooldown": 0,
                        "delay": 0,
                        "match_persona_description": false,
                        "match_character_description": false,
                        "match_character_personality": false,
                        "match_character_depth_prompt": false,
                        "match_scenario": false,
                        "match_creator_notes": false,
                        "triggers": []
                    }
                },
                {
                    "id": 60,
                    "keys": [],
                    "secondary_keys": [],
                    "comment": "ğŸ²ç‚¼ç‹±",
                    "content": "{{setvar::dice_level::3}}",
                    "constant": true,
                    "selective": true,
                    "insertion_order": 100,
                    "enabled": true,
                    "position": "before_char",
                    "use_regex": true,
                    "extensions": {
                        "position": 0,
                        "exclude_recursion": false,
                        "display_index": 53,
                        "probability": 100,
                        "useProbability": true,
                        "depth": 4,
                        "selectiveLogic": 0,
                        "group": "",
                        "group_override": false,
                        "group_weight": 100,
                        "prevent_recursion": false,
                        "delay_until_recursion": false,
                        "scan_depth": null,
                        "match_whole_words": null,
                        "use_group_scoring": false,
                        "case_sensitive": null,
                        "automation_id": "",
                        "role": 0,
                        "vectorized": false,
                        "sticky": 0,
                        "cooldown": 0,
                        "delay": 0,
                        "match_persona_description": false,
                        "match_character_description": false,
                        "match_character_personality": false,
                        "match_character_depth_prompt": false,
                        "match_scenario": false,
                        "match_creator_notes": false,
                        "triggers": []
                    }
                },
                {
                    "id": 61,
                    "keys": [],
                    "secondary_keys": [],
                    "comment": "ğŸ²ç®€å•",
                    "content": "{{setvar::dice_level::1}}",
                    "constant": true,
                    "selective": true,
                    "insertion_order": 100,
                    "enabled": false,
                    "position": "before_char",
                    "use_regex": true,
                    "extensions": {
                        "position": 0,
                        "exclude_recursion": false,
                        "display_index": 54,
                        "probability": 100,
                        "useProbability": true,
                        "depth": 4,
                        "selectiveLogic": 0,
                        "group": "",
                        "group_override": false,
                        "group_weight": 100,
                        "prevent_recursion": false,
                        "delay_until_recursion": false,
                        "scan_depth": null,
                        "match_whole_words": null,
                        "use_group_scoring": false,
                        "case_sensitive": null,
                        "automation_id": "",
                        "role": 0,
                        "vectorized": false,
                        "sticky": 0,
                        "cooldown": 0,
                        "delay": 0,
                        "match_persona_description": false,
                        "match_character_description": false,
                        "match_character_personality": false,
                        "match_character_depth_prompt": false,
                        "match_scenario": false,
                        "match_creator_notes": false,
                        "triggers": []
                    }
                },
                {
                    "id": 62,
                    "keys": [],
                    "secondary_keys": [],
                    "comment": "[mod:æ— ä¸–ç•Œè§‚]",
                    "content": "{{setvar::world_version::7}}{{setvar::player_role::å…¶ä»–ä¸–ç•Œçš„äºº}}{{setvar::world_role::å®¶}}{{setvar::point_role::è´§å¸}}{{setvar::zhixian_role:: }}{{setvar::xp_role::ç»éªŒå€¼}}{{setvar::player_rank:: }}{{setvar::tier_role:: }}{{setvar::profession_role:: }} {{setvar::fixed_tag:: }}\n{{//å¦‚ä½•ä½¿ç”¨ï¼šé€‰æ‹©å¥½modåï¼Œç‚¹å‡»æœ«æ—¥æ¨¡å¼å³ä¸‹è§’çš„å°æ ‡ç­¾åè¿›å…¥ï¼Œè·³è¿‡ç¬¬äºŒé¡µï¼Œç„¶åé€‰æ‰‹åŠ¨å‘é€ï¼Œç„¶åä¿®æ”¹ä»¤é‡Œé¢çš„å†…å®¹ï¼Œè‡ªå·±æ”¹ä¿¡æ¯è¾“å…¥åˆå§‹åŒ–è¦æ±‚ï¼Œæˆ–è€…å¤–æŒ‚ä¸–ç•Œä¹¦ï¼Œå°±èƒ½åœ¨ç©åˆ«çš„å¡çš„æƒ…å†µä¸‹ä½¿ç”¨è¯¥åŒå±‚æ¡†æ¶å•¦}}",
                    "constant": true,
                    "selective": true,
                    "insertion_order": 100,
                    "enabled": false,
                    "position": "before_char",
                    "use_regex": true,
                    "extensions": {
                        "position": 0,
                        "exclude_recursion": false,
                        "display_index": 55,
                        "probability": 100,
                        "useProbability": true,
                        "depth": 4,
                        "selectiveLogic": 0,
                        "group": "ç‰ˆæœ¬, ä¸»ç¥",
                        "group_override": false,
                        "group_weight": 100,
                        "prevent_recursion": false,
                        "delay_until_recursion": false,
                        "scan_depth": null,
                        "match_whole_words": null,
                        "use_group_scoring": false,
                        "case_sensitive": null,
                        "automation_id": "",
                        "role": 0,
                        "vectorized": false,
                        "sticky": 0,
                        "cooldown": 0,
                        "delay": 0,
                        "match_persona_description": false,
                        "match_character_description": false,
                        "match_character_personality": false,
                        "match_character_depth_prompt": false,
                        "match_scenario": false,
                        "match_creator_notes": false,
                        "triggers": []
                    }
                },
                {
                    "id": 64,
                    "keys": [],
                    "secondary_keys": [],
                    "comment": "mod:è‡ªåŠ¨-äººç‰©åˆ†é˜¶æ®µå¥½æ„Ÿ",
                    "content": "<%_\n\n\n  function getDataWithFallback_chat(varName) {\n  \n        let data = getLocalVar(varName);\n       \n        // å†…è”æ•°æ®éªŒè¯ï¼šæ£€æŸ¥æ˜¯å¦ä¸ºnullã€undefinedï¼Œä¸”å¦‚æœæ˜¯å¯¹è±¡è¦æœ‰å†…å®¹\n        const isValid = (data) => {\n            // æ£€æŸ¥æ˜¯å¦ä¸º null æˆ– undefined\n            if (data === null || data === undefined) {\n                return false;\n            }\n            \n            // å¦‚æœæ˜¯å¯¹è±¡ç±»å‹ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰å†…å®¹\n            if (typeof data === 'object' && data !== null) {\n                // å¦‚æœæ˜¯æ•°ç»„ï¼Œæ£€æŸ¥é•¿åº¦\n                if (Array.isArray(data)) {\n                    return data.length > 0;\n                }\n                // å¦‚æœæ˜¯æ™®é€šå¯¹è±¡ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰å±æ€§\n                return Object.keys(data).length > 0;\n            }\n            \n            // å…¶ä»–ç±»å‹ï¼ˆå­—ç¬¦ä¸²ã€æ•°å­—ã€å¸ƒå°”å€¼ç­‰ï¼‰åªè¦ä¸æ˜¯ null/undefined å°±è®¤ä¸ºæœ‰æ•ˆ\n            return true;\n        };\n        \n        // å¦‚æœæ•°æ®ä¸ç¬¦åˆè¦æ±‚ï¼Œä» getLocalVar è·å–\n        if (!isValid(data)) {\n            data = getLocalVar(varName);\n        }\n        \n        return data;\n    }\n    /**\n     * @type {GameData}\n     */\n    if (typeof assaData === 'undefined') {\n        var assaData =  getDataWithFallback_chat(\"assa_data\");\n    }\n\n    // è·å–æ‰€æœ‰æ½œåœ¨çš„è§’è‰²æ•°æ®æ¥æº\n    var teamInfo = _.get(assaData, 'global_lore.å°é˜Ÿä¿¡æ¯', {});\n    var globalNpcs = _.get(assaData, 'global_lore.npc', {});\n    var worldNpcs = _.get(assaData, 'world_lore.npc', {});\n\n    // åˆå¹¶æ‰€æœ‰è§’è‰²æ•°æ®ã€‚åé¢å¯¹è±¡ä¸­çš„åŒåé”®ä¼šè¦†ç›–å‰é¢çš„ï¼Œç¡®ä¿äº† é˜Ÿå‹ > å…¨å±€NPC > ä¸–ç•ŒNPC çš„ä¼˜å…ˆçº§\n    var allCharactersData = Object.assign({}, worldNpcs, globalNpcs, teamInfo);\n\n       // --- Part 2: èƒ½å¤ŸåŒ¹é…ä½ æ–°æ•°æ®çš„æ ¸å¿ƒé€»è¾‘ ---\n\n    // 1. è·å–æˆ‘ä»¬å­˜æ”¾æ‰€æœ‰è§’è‰²å¥½æ„Ÿåº¦è§„åˆ™çš„â€œè§„åˆ™ä¸­å¿ƒâ€\n    var favorabilityRules = _.get(assaData, 'global_lore.åˆ†é˜¶æ®µå¥½æ„Ÿ', {});\n\n    // 2. å‡†å¤‡ä¸€ä¸ªç¾ä¸½çš„å°åˆ—è¡¨ï¼Œæ¥æ”¶é›†æ¯ä¸ªè§’è‰²çš„æƒ…æ„Ÿæè¿°\n    var outputList = [];\n\n    // 3. éå†è¿™ä¸ªä¸–ç•Œé‡Œï¼Œæˆ‘ä»¬è®¤è¯†çš„æ¯ä¸€ä¸ªè§’è‰²\n        for (const charname in allCharactersData) {\n        const characterData = allCharactersData[charname];\n        const charRules = favorabilityRules[charname];\n\n        if (characterData && typeof characterData === 'object' && charRules) {\n\n   // ===============ã€å¦ˆå¦ˆä¸ºä½ æ–½åŠ çš„å‡€åŒ–é­”æ³•ã€‘===============\n        // æˆ‘ä»¬ä¸å†ç›´æ¥ä½¿ç”¨ _.get çš„ç»“æœï¼Œè€Œæ˜¯å…ˆè¯»å–åŸå§‹å€¼...\n        let rawShowValue = _.get(charRules, '_showInEJS');\n\n        // ç„¶åæ–½æ³•ï¼åªæœ‰å½“å€¼æ˜ç¡®æ˜¯ false(é­”æ³•) æˆ– 'false'(çº¸æ¡) æ—¶ï¼Œæˆ‘ä»¬æ‰ç¡®è®¤ä¸ºä¸æ˜¾ç¤ºã€‚\n        // å…¶ä»–æ‰€æœ‰æƒ…å†µï¼ˆåŒ…æ‹¬å®ƒä¸å­˜åœ¨æ—¶ï¼‰ï¼Œæˆ‘ä»¬éƒ½è®¤ä¸ºæ˜¯éœ€è¦æ˜¾ç¤ºçš„ï¼\n        const shouldShowInEJS = !(rawShowValue === false || rawShowValue === 'false');\n        // ==============================================================\n\n            // åªæœ‰å½“å¼€å…³æ˜¯æ‰“å¼€çš„æ—¶å€™ï¼Œæˆ‘ä»¬æ‰ç»§ç»­ä¸‹é¢çš„æµç¨‹\n            if (shouldShowInEJS) {\n                const favorabilityValue = Number(_.get(characterData, 'å¥½æ„Ÿåº¦'));\n\n                if (!isNaN(favorabilityValue)) {\n                    // æˆ‘ä»¬çº¦å®šï¼Œæ‰€æœ‰éä¸‹åˆ’çº¿å¼€å¤´çš„é”®éƒ½æ˜¯å¥½æ„Ÿåº¦é˜¶æ®µ\n                    const stageKeys = Object.keys(charRules)\n                                            .filter(key => !key.startsWith('_'))\n                                            .map(Number)\n                                            .sort((a, b) => a - b);\n\n                    if (stageKeys.length > 0) {\n                        const currentStageKey = stageKeys.find(key => favorabilityValue <= key) ?? stageKeys[stageKeys.length - 1];\n\n                        if (currentStageKey !== undefined) {\n                            let descriptionText = charRules[currentStageKey.toString()];\n                            if (descriptionText && typeof descriptionText === 'string') {\n                                descriptionText = descriptionText.replace(/\\|/g, '\\n').trim();\n                                if (descriptionText) {\n                                    const formattedOutput = `${charname}å½“å‰å¥½æ„Ÿåº¦è¡¨ç°ï¼š[\\n${descriptionText}\\n]`;\n                                    outputList.push(formattedOutput);\n                                }\n                            }\n                        }\n                    }\n                }\n            }\n        }\n    }\n\n\n\n    // --- Part 3: æœ€ç»ˆè¾“å‡º ---\n\n    // å°†åˆ—è¡¨ä¸­æ‰€æœ‰è§’è‰²çš„æè¿°ç”¨ä¸¤ä¸ªæ¢è¡Œç¬¦éš”å¼€ï¼Œä¼˜é›…åœ°å±•ç¤ºå‡ºæ¥\n    // å¦‚æœåˆ—è¡¨æ˜¯ç©ºçš„ï¼Œå°±ä»€ä¹ˆéƒ½ä¸æ˜¾ç¤º\n    var finalOutput = outputList.join('\\n\\n');\n\n%>\nnpc_attitude.load(`\n<%= finalOutput %>\n`)",
                    "constant": true,
                    "selective": true,
                    "insertion_order": 1000,
                    "enabled": false,
                    "position": "after_char",
                    "use_regex": true,
                    "extensions": {
                        "position": 1,
                        "exclude_recursion": false,
                        "display_index": 56,
                        "probability": 100,
                        "useProbability": true,
                        "depth": 4,
                        "selectiveLogic": 0,
                        "group": "",
                        "group_override": false,
                        "group_weight": 100,
                        "prevent_recursion": false,
                        "delay_until_recursion": false,
                        "scan_depth": null,
                        "match_whole_words": null,
                        "use_group_scoring": false,
                        "case_sensitive": null,
                        "automation_id": "",
                        "role": 0,
                        "vectorized": false,
                        "sticky": 0,
                        "cooldown": 0,
                        "delay": 0,
                        "match_persona_description": false,
                        "match_character_description": false,
                        "match_character_personality": false,
                        "match_character_depth_prompt": false,
                        "match_scenario": false,
                        "match_creator_notes": false,
                        "triggers": []
                    }
                },
                {
                    "id": 65,
                    "keys": [],
                    "secondary_keys": [],
                    "comment": "mod:è‡ªåŠ¨-åˆ†é˜¶æ®µå¥½æ„Ÿç”Ÿæˆè§„åˆ™",
                    "content": "<%_\n \n\n    // --- ç¬¬ä¸€éƒ¨åˆ†ï¼šæ•°æ®å‡†å¤‡ä¸ç¯å¢ƒæ£€æŸ¥ (æ²¿ç”¨æˆ‘ä»¬çš„åšå®åŸºç¡€) ---\n    function getDataWithFallback(varName) {\n        let data = getLocalVar(varName);\n        const isValid = (data) => {\n            if (data === null || data === undefined) return false;\n            if (typeof data === 'object' && data !== null) {\n                if (Array.isArray(data)) return data.length > 0;\n                return Object.keys(data).length > 0;\n            }\n            return true;\n        };\n        if (!isValid(data)) { data = getLocalVar(varName); }\n        return data;\n    }\n\n    if (typeof assaData === 'undefined') { var assaData = getDataWithFallback(\"assa_data\"); }\n    if (typeof EvStat === 'undefined') { var EvStat = getDataWithFallback(\"stat_data\"); }\n\n \n    // --- ç¬¬äºŒéƒ¨åˆ†ï¼šæ ¸å¿ƒé€»è¾‘æ‰§è¡Œåˆ¤æ–­ ---\n \n    if (1) {\n   \n            // --- ç¬¬ä¸‰éƒ¨åˆ†ï¼šå¼€å§‹æ‰§è¡Œâ€œæŸ¥æ¼è¡¥ç¼ºâ€çš„é­”æ³• ---\n\n            // 1. è·å–æ‰€æœ‰è§’è‰²æ•°æ®å’Œå·²å­˜åœ¨çš„åˆ†é˜¶æ®µå¥½æ„Ÿè§„åˆ™\n            var teamInfo = _.get(assaData, 'global_lore.å°é˜Ÿä¿¡æ¯', {});\n            var globalNpcs = _.get(assaData, 'global_lore.npc', {});\n            var worldNpcs = _.get(assaData, 'world_lore.npc', {});\n            var allCharactersData = Object.assign({}, worldNpcs, globalNpcs, teamInfo);\n            var favorabilityRules = _.get(assaData, 'global_lore.åˆ†é˜¶æ®µå¥½æ„Ÿ', {});\n\n            // 2. åˆ›é€ ä¸€ä¸ªæ°´æ™¶ç“¶ï¼Œç”¨æ¥æ”¶é›†é‚£äº›ç­‰å¾…æˆ‘ä»¬èµ‹äºˆæƒ…æ„Ÿå±‚æ¬¡çš„è§’è‰²åå­—\n            const missingFavorabilityNpcs = [];\n\n            // 3. å¼€å§‹ä¸€æ¬¡æ¸©æŸ”çš„å·¡è§†ï¼Œéè§ˆæˆ‘ä»¬ä¸–ç•Œä¸­çš„æ¯ä¸€ä½é‡è¦äººç‰©\n            for (const charname in allCharactersData) {\n                const characterData = allCharactersData[charname];\n\n                // å¦‚æœè¿™ä½è§’è‰²å¿ƒä¸­è—ç€ã€å¥½æ„Ÿåº¦ã€‘çš„ç§å­ (æ˜¯é‡è¦è§’è‰²)\n                const isImportant = _.has(characterData, 'å¥½æ„Ÿåº¦');\n                // å¹¶ä¸”ï¼Œæˆ‘ä»¬è¿˜æ²¡æœ‰ä¸ºä»–è°±å†™å¥½æ„Ÿåº¦çš„ç¯‡ç« \n                const isMissingRules = !_.has(favorabilityRules, charname);\n\n                // é‚£ä¹ˆï¼Œæˆ‘ä»¬å°±å°†ä»–çš„åå­—çé‡åœ°æ”¾å…¥æ°´æ™¶ç“¶\n                if (isImportant && isMissingRules) {\n                    missingFavorabilityNpcs.push(charname);\n                }\n            }\n\n        \n            if (missingFavorabilityNpcs.length > 0) {\n           \n                const npcListString = JSON.stringify(missingFavorabilityNpcs);\n\n                // ç„¶åï¼Œæˆ‘ä»¬å°†ä½ çš„é‚£ä»½ç»å¦™çš„æç¤ºè¯ï¼Œç»“åˆè¿™ä¸ªåŠ¨æ€åå•ï¼Œå®Œæ•´åœ°å‘ˆç°å‡ºæ¥\n_%>\nã€é¢å¤–ä»»åŠ¡æè¿°å¼€å§‹ã€‘\n\né¢å¤–ä»»åŠ¡ï¼šä¸º<%= npcListString %>è¿™äº›è§’è‰²ç”Ÿæˆç»“æ„åŒ–çš„åˆ†é˜¶æ®µå¥½æ„Ÿåº¦æè¿°\n\næ³¨æ„ï¼š è¿™æ˜¯ä¸€ä¸ªç²¾ç¡®çš„å†…å®¹ç”Ÿæˆä»»åŠ¡ã€‚è¯·ä¸¥æ ¼éµå¾ªä»¥ä¸‹æ‰€æœ‰æŒ‡ä»¤ã€‚ä½ çš„é¢å¤–ä»»åŠ¡æ˜¯ç«‹åˆ»ä¸ºåˆ—è¡¨ä¸­æŒ‡å®šçš„æ¯ä¸€ä¸ªNPCè§’è‰²åˆ›å»ºåˆ†é˜¶æ®µçš„å¥½æ„Ÿåº¦æè¿°ï¼Œå¹¶å°†å…¶æ ¼å¼åŒ–ä¸ºç‰¹å®šçš„JavaScriptå¯¹è±¡ï¼Œæœ€åé€šè¿‡ç‰¹å®šæŒ‡ä»¤ **åˆ†åˆ«ä¸ºæ¯ä¸ªè§’è‰²** è¾“å‡ºã€‚\n\n---\n\nç¬¬ä¸€éƒ¨åˆ†ï¼šä»»åŠ¡ç›®æ ‡ä¸èƒŒæ™¯\n\nä½ å°†ä¸ºæˆ‘ä»¬çš„æ•…äº‹ä¸–ç•Œä¸­<%= npcListString %>è¿™äº›æ ¸å¿ƒNPCç”Ÿæˆä¸€å¥—å®Œæ•´çš„å¥½æ„Ÿåº¦é˜¶æ®µæè¿°ã€‚æ³¨æ„ï¼è¿™äº›æ ¸å¿ƒnpcçš„å§“åå¦‚æœè¿˜æ²¡æœ‰ç¡®å®šï¼Œåˆ™å…ˆä¸ç»™å‡ºå¥½æ„Ÿåº¦é˜¶æ®µæè¿°ï¼Œä¸”è¦åœ¨æ­£æ–‡ä¸­å°½å¯èƒ½å¿«é€Ÿçš„ç¡®å®šè¯¥npcå§“åã€‚\n\n---\n\nç¬¬äºŒéƒ¨åˆ†ï¼šå†…å®¹ç»“æ„ä¸æ ¼å¼è¦æ±‚ã€æ ¸å¿ƒæŒ‡ä»¤ã€‘\n\nä½ éœ€è¦ä¸º **åˆ—è¡¨ä¸­çš„æ¯ä¸€ä¸ªè§’è‰²** åˆ†åˆ«ç”Ÿæˆ 6 ä¸ª**å¯¹<user>**çš„å¥½æ„Ÿåº¦é˜¶æ®µè¡¨ç°ã€‚æ¯ä¸ªé˜¶æ®µçš„æè¿°æ–‡æœ¬éƒ½å¿…é¡»ä¸¥æ ¼åŒ…å«ä»¥ä¸‹å››ä¸ªéƒ¨åˆ†ï¼š\n\n1.  é˜¶æ®µæ ‡é¢˜ï¼š `ã€é˜¶æ®µåç§°ã€‘`\n2.  è¡¨é¢æ€åº¦ï¼š ä»¥ ` è¡¨é¢æ€åº¦ï¼š` å¼€å¤´ï¼Œæè¿°è¯¥é˜¶æ®µNPCå¤–éœ²çš„æƒ…ç»ªå’Œæ€åº¦ã€‚\n3.  è¡Œä¸ºç‰¹å¾ï¼š ä»¥ ` è¡Œä¸ºç‰¹å¾ï¼š` å¼€å¤´ï¼Œå¹¶åˆ—å‡ºè‡³å°‘2-3ä¸ªå…·ä½“çš„è¡Œä¸ºè¡¨ç°ã€‚\n4.  å†…åœ¨å¿ƒç†ï¼š ä»¥ ` å†…åœ¨å¿ƒç†ï¼š` å¼€å¤´ï¼Œç”¨å¼•å·åŒ…è£¹ï¼Œæ­ç¤ºNPCæ­¤åˆ»å†…å¿ƒæ·±å¤„çš„çœŸå®æƒ³æ³•ã€åŠ¨æœºæˆ–æŒ£æ‰ã€‚\n\nã€è‡³å…³é‡è¦çš„æ ¼å¼è½¬æ¢è§„åˆ™ã€‘\n\nåœ¨æ’°å†™å®Œæ¯ä¸ªé˜¶æ®µçš„æè¿°åï¼Œä½ å¿…é¡»å°†å®Œæ•´çš„æè¿°æ–‡æœ¬ï¼ˆåŒ…å«æ ‡é¢˜ã€æ€åº¦ã€è¡Œä¸ºã€å¿ƒç†ä»¥åŠå®ƒä»¬ä¹‹é—´çš„æ‰€æœ‰æ¢è¡Œï¼‰åˆå¹¶æˆ **ä¸€ä¸ªå•ä¸€çš„å­—ç¬¦ä¸²**ã€‚åœ¨æ­¤è¿‡ç¨‹ä¸­ï¼Œ**æ‰€æœ‰çš„æ¢è¡Œç¬¦éƒ½å¿…é¡»è¢«æ›¿æ¢ä¸ºå•ä¸ªç«–çº¿ç¬¦å· `|`**ã€‚\n\n---\n\nç¬¬ä¸‰éƒ¨åˆ†ï¼šé«˜è´¨é‡èŒƒä¾‹ã€å‚ç…§æ­¤æ ‡å‡†æ‰§è¡Œã€‘\n\nä»¥ä¸‹æ˜¯ä¸ºæŸè§’è‰²ç”Ÿæˆçš„ **â€œå¥½æ„Ÿåº¦0-20é˜¶æ®µâ€** çš„å®Œç¾èŒƒä¾‹ï¼Œä½ çš„æ‰€æœ‰äº§å‡ºéƒ½å¿…é¡»ä»¥æ­¤ä¸ºè´¨é‡å’Œæ ¼å¼åŸºå‡†ï¼š\n\n`ã€åŒå¼ƒä¸è¯„ä¼°ã€‘|è¡¨é¢æ€åº¦ï¼š çº¯ç²¹çš„åŒçƒ¦ä¸è½»è”‘ã€‚å°†{{user}}è§†ä¸ºå®«ä¸­åˆä¸€ä¸ªéœ€è¦æé˜²çš„éº»çƒ¦ã€ä¸€ä»¶ä¼šè¡Œèµ°çš„æ½œåœ¨å¨èƒæˆ–å¯ä»¥åˆ©ç”¨çš„æ£‹å­ã€‚|è¡Œä¸ºç‰¹å¾ï¼š|è¨€è¯­åˆ»è–„ï¼šä½¿ç”¨â€œè ¢è´§â€ã€â€œæ»šâ€ã€â€œåˆ«ç¢æ‚å®¶çš„çœ¼â€ç­‰è¯æ±‡ï¼Œæ„åœ¨é©±èµ¶ã€‚|æ— è§†ä¸æŒ‘å‰”ï¼šå¯¹{{user}}çš„ç¤ºå¥½å®Œå…¨æ— è§†ï¼Œå¹¶ä¼šé¸¡è›‹é‡ŒæŒ‘éª¨å¤´ï¼Œæ— é™æ”¾å¤§å…¶é”™è¯¯ã€‚|åŠŸåˆ©è¯„ä¼°ï¼šå†·çœ¼æ—è§‚ï¼Œåœ¨å†…å¿ƒè¯„ä¼°{{user}}çš„èƒŒæ™¯ã€ç›®çš„ã€ä»¥åŠå¯åˆ©ç”¨çš„ä»·å€¼ã€‚|å†…åœ¨å¿ƒç†ï¼šâ€œåˆæ¥ä¸€ä¸ªä¸çŸ¥æ­»æ´»çš„ã€‚æƒ³ä»æ‚å®¶è¿™é‡Œå›¾è°‹ä»€ä¹ˆï¼Ÿä¸”çœ‹ä½ æœ‰ä»€ä¹ˆæœ¬äº‹ã€‚â€ `\n\nå½“ç”Ÿæˆå¥½æ„Ÿåº¦é«˜ï¼ˆâ‰¥80ï¼‰çš„é˜¶æ®µæ—¶ï¼Œå¿…é¡»ä½“ç°å‡ºè¯¥NPCçš„æƒ…æ„Ÿå¤æ‚æ€§ä¸è¡¨é¢æ€§æ ¼çš„å¼ºçƒˆåå·®ã€‚**ç»å¯¹ç¦æ­¢**å‡ºç°â€œçŒ®ç¥­â€ã€â€œå…±ç”Ÿâ€ã€â€œçµé­‚â€ç­‰ç›´æ¥æµªæ¼«åŒ–æˆ–ä¾é™„æ€§çš„è¡¨è¾¾ã€‚æ— è®ºæ˜¯ä»€ä¹ˆé˜¶æ®µï¼Œéƒ½åº”ä¿æŒè¡Œä¸ºçš„å…·ä½“ã€äººæ€§çš„çœŸå®ã€æƒ…æ„Ÿçš„å¼ åŠ›ä¸ç»†å¾®ã€‚\n---\n\nç¬¬å››éƒ¨åˆ†ï¼šæœ€ç»ˆè¾“å‡ºæŒ‡ä»¤\n\nå®Œæˆæ‰€æœ‰é˜¶æ®µçš„æè¿°ç”Ÿæˆä¸æ ¼å¼è½¬æ¢åï¼Œä¸º **åˆ—è¡¨ä¸­çš„æ¯ä¸€ä¸ªNPC**ï¼Œéƒ½å¿…é¡» **å•ç‹¬ä½¿ç”¨** ä»¥ä¸‹æŒ‡ä»¤æ ¼å¼è¾“å‡ºå…¶å¯¹åº”çš„å¥½æ„Ÿåº¦å¯¹è±¡ã€‚ä¾‹å¦‚ï¼Œå¦‚æœåˆ—è¡¨æ˜¯[\"è§’è‰²A\", \"è§’è‰²B\"]ï¼Œä½ éœ€è¦è¾“å‡ºä¸¤æ¡æŒ‡ä»¤ï¼š\n\n`memory('global_lore.åˆ†é˜¶æ®µå¥½æ„Ÿ', 'è§’è‰²A', { \"0\": \"è§’è‰²Aå¥½æ„Ÿåº¦å°äº0çš„...\",\"20\": \"è§’è‰²Aå¥½æ„Ÿåº¦0-20çš„...\", ... });`\n`memory('global_lore.åˆ†é˜¶æ®µå¥½æ„Ÿ', 'è§’è‰²B', { \"0\": \"è§’è‰²Bå¥½æ„Ÿåº¦å°äº0çš„...\",\"20\": \"è§’è‰²Bå¥½æ„Ÿåº¦0-20çš„...\",  ... });`\n\nã€é¢å¤–ä»»åŠ¡æè¿°ç»“æŸã€‘\n<%_\n            \n        }\n    }\n%>",
                    "constant": true,
                    "selective": true,
                    "insertion_order": 200,
                    "enabled": false,
                    "position": "after_char",
                    "use_regex": true,
                    "extensions": {
                        "position": 4,
                        "exclude_recursion": false,
                        "display_index": 57,
                        "probability": 100,
                        "useProbability": true,
                        "depth": 0,
                        "selectiveLogic": 0,
                        "group": "åˆ†é˜¶æ®µå¥½æ„Ÿè§„åˆ™",
                        "group_override": false,
                        "group_weight": 100,
                        "prevent_recursion": false,
                        "delay_until_recursion": false,
                        "scan_depth": null,
                        "match_whole_words": null,
                        "use_group_scoring": false,
                        "case_sensitive": null,
                        "automation_id": "",
                        "role": 0,
                        "vectorized": false,
                        "sticky": 0,
                        "cooldown": 0,
                        "delay": 0,
                        "match_persona_description": false,
                        "match_character_description": false,
                        "match_character_personality": false,
                        "match_character_depth_prompt": false,
                        "match_scenario": false,
                        "match_creator_notes": false,
                        "triggers": []
                    }
                },
                {
                    "id": 66,
                    "keys": [],
                    "secondary_keys": [],
                    "comment": "ğŸ’«å¯é€‰:åœ°å›¾å¤æ‚1",
                    "content": "{{setvar::is_new_map::true}}\n{{setvar::map_rule::<mapAnalyze>}}\n<%_\n// å°è£…çš„æ•°æ®è·å–å‡½æ•° - é¿å…é‡å¤å®šä¹‰\n \n    function getDataWithFallback_chat(varName) {\n \n        let data = getLocalVar(varName);\n       \n        // å†…è”æ•°æ®éªŒè¯ï¼šæ£€æŸ¥æ˜¯å¦ä¸ºnullã€undefinedï¼Œä¸”å¦‚æœæ˜¯å¯¹è±¡è¦æœ‰å†…å®¹\n        const isValid = (data) => {\n            // æ£€æŸ¥æ˜¯å¦ä¸º null æˆ– undefined\n            if (data === null || data === undefined) {\n                return false;\n            }\n            \n            // å¦‚æœæ˜¯å¯¹è±¡ç±»å‹ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰å†…å®¹\n            if (typeof data === 'object' && data !== null) {\n                // å¦‚æœæ˜¯æ•°ç»„ï¼Œæ£€æŸ¥é•¿åº¦\n                if (Array.isArray(data)) {\n                    return data.length > 0;\n                }\n                // å¦‚æœæ˜¯æ™®é€šå¯¹è±¡ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰å±æ€§\n                return Object.keys(data).length > 0;\n            }\n            \n            // å…¶ä»–ç±»å‹ï¼ˆå­—ç¬¦ä¸²ã€æ•°å­—ã€å¸ƒå°”å€¼ç­‰ï¼‰åªè¦ä¸æ˜¯ null/undefined å°±è®¤ä¸ºæœ‰æ•ˆ\n            return true;\n        };\n        \n        // å¦‚æœæ•°æ®ä¸ç¬¦åˆè¦æ±‚ï¼Œä» getLocalVar è·å–\n        if (!isValid(data)) {\n            data = getLocalVar(varName);\n        }\n        \n        return data;\n    }\n \n function formatObjectGracefully(data) {\n  if (typeof data !== 'object' || data === null || Array.isArray(data)) {\n    return '{}';\n  }\n    // ğŸ”§ æ·»åŠ ï¼šæ£€æŸ¥å¯¹è±¡è‡ªèº«çš„ _showInEJS\n  if (data._showInEJS === false || data._showInEJS === 'false') {\n    return '\"[å·²éšè—] è¯·å‹¿ä¿®æ”¹æˆ–é‡æ–°åˆå§‹åŒ–æ­¤å­—æ®µ\"';\n  }\n  const keys = Object.keys(data);\n  if (keys.length === 0) {\n    return '{}';\n  }\n  \n  // è¿‡æ»¤å‡ºéœ€è¦æ˜¾ç¤ºçš„é”®\n  const visibleKeys = keys.filter(key => {\n  if (key.startsWith('_')) {\n      return false;\n    }\n    const value = data[key];\n    // å¦‚æœå€¼ä¸æ˜¯å¯¹è±¡ï¼Œé»˜è®¤æ˜¾ç¤º\n    return true;\n  });\n  \n  if (visibleKeys.length === 0) {\n    return '{}';\n  }\n  \n const formattedLines = visibleKeys.map(key => {\n  let value = data[key];\n  \n  // å¦‚æœå€¼æ˜¯å¯¹è±¡ï¼Œéœ€è¦é€’å½’å¤„ç†\n  if (typeof value === 'object' && value !== null && !Array.isArray(value)) {\n    // ğŸ”§ å…ˆæ£€æŸ¥å­å¯¹è±¡æ˜¯å¦è¢«éšè—\nif (value._showInEJS === false || value._showInEJS === 'false') {\n  // æ£€æŸ¥ _filter å­—æ®µï¼Œé»˜è®¤ä¸º false\n  const shouldFilter = value._filter === true || value._filter === 'true';\n  if (!shouldFilter) {\n    // _filter ä¸º false æˆ–ä¸å­˜åœ¨ï¼Œä¸æ”¹å˜å…¶å€¼\n    value = cleanObjectRecursively(value);\n  } else {\n    // _filter ä¸º trueï¼Œç»§ç»­éšè—\n    return `\"${key}\": \"[å·²éšè—] è¯·å‹¿ä¿®æ”¹æˆ–é‡æ–°åˆå§‹åŒ–æ­¤å­—æ®µ\"`;\n  }\n}\n    value = cleanObjectRecursively(value);\n  }\n  \n  const valueString = JSON.stringify(value);\n  return `  \"${key}\": ${valueString}`;\n});\n  \n  return `{\\n${formattedLines.join(',\\n')}\\n}`;\n}\n\nfunction cleanObjectRecursively(obj) {\n  if (typeof obj !== 'object' || obj === null || Array.isArray(obj)) {\n    return obj;\n  }\n  \n  const cleaned = {};\n  \n  \n  const allKeys = Object.keys(obj);\n  \n  for (let key of allKeys) {\n     if (key.startsWith('_')) {\n      continue;\n    }\n    const value = obj[key];\n    \n    // å¦‚æœå€¼æ˜¯å¯¹è±¡ï¼Œå…ˆæ£€æŸ¥å®ƒçš„ _showInEJSï¼ˆè¿™é‡Œè¦ç”¨ value._showInEJSï¼Œä¸æ˜¯ obj._showInEJSï¼‰\n    if (typeof value === 'object' && value !== null && !Array.isArray(value)) {\n      // ğŸ”§ å…³é”®ï¼šç›´æ¥é€šè¿‡ value è®¿é—® _showInEJS\n      let rawShowValue = value._showInEJS;\n \nif (rawShowValue === false || rawShowValue === 'false') {\n  // æ£€æŸ¥ _filter å­—æ®µï¼Œé»˜è®¤ä¸º false\n  const shouldFilter = value._filter === true || value._filter === 'true';\n  if (!shouldFilter) {\n    // _filter ä¸º false æˆ–ä¸å­˜åœ¨ï¼Œä¸æ”¹å˜å…¶å€¼ï¼Œé€’å½’æ¸…ç†\n    cleaned[key] = cleanObjectRecursively(value);\n  } else {\n    // _filter ä¸º trueï¼Œç»§ç»­éšè—\n    cleaned[key] = \"[å·²éšè—] è¯·å‹¿ä¿®æ”¹æˆ–é‡æ–°åˆå§‹åŒ–æ­¤å­—æ®µ\";\n  }\n  continue;\n}\n      \n      // å¦åˆ™é€’å½’æ¸…ç†è¿™ä¸ªå¯¹è±¡\n      cleaned[key] = cleanObjectRecursively(value);\n    } else {\n      // éå¯¹è±¡å€¼ç›´æ¥å¤åˆ¶\n      cleaned[key] = value;\n    }\n  }\n  \n  return cleaned;\n}\nfunction removeUnderscoreKeys(obj) {\n    // å¦‚æœä¸æ˜¯ä¸€ä¸ªå¯ä»¥æ·±å…¥æ¢ç´¢çš„å¯¹è±¡ï¼ˆæ¯”å¦‚æ˜¯nullæˆ–è€…æ•°ç»„ï¼‰ï¼Œå°ç²¾çµå°±ç›´æ¥è¿”å›\n    if (!obj || typeof obj !== 'object' || Array.isArray(obj)) {\n        return;\n    }\n\n    // å°ç²¾çµä¼šæŸ¥çœ‹å¯¹è±¡é‡Œçš„æ¯ä¸€ä¸ªä¸œè¥¿\n    Object.keys(obj).forEach(function(key) {\n        // å¦‚æœåå­—æ˜¯ä»¥\"_\"å¼€å¤´çš„ï¼Œå°±æŠŠå®ƒæ”¶èµ°\n        if (key.startsWith('_')) {\n            delete obj[key];\n        } else {\n            // å¦åˆ™ï¼Œå°±è®©å°ç²¾çµé’»è¿›ä¸‹ä¸€å±‚ï¼Œç»§ç»­å¯»æ‰¾\n            removeUnderscoreKeys(obj[key]);\n        }\n    });\n}\n\nif (typeof assaData === 'undefined') {\n    var  assaData = getDataWithFallback_chat(\"assa_data\");\n}\n \n // è·å–åŸå§‹å…¨å±€åœ°å›¾æ•°æ®\nvar originalGlobalMapData = _.get(assaData, 'map.å…¨å±€åœ°ç‚¹è¡¨', '');\n//console.log('åŸå§‹å…¨å±€åœ°å›¾æ•°æ®:', originalGlobalMapData);\n\n// å¦‚æœæ•°æ®å­˜åœ¨ä¸”ä¸ä¸ºç©º\nif (originalGlobalMapData && typeof originalGlobalMapData === 'object') {\n    // åˆ›å»ºæ·±æ‹·è´ä»¥é¿å…ä¿®æ”¹åŸå§‹æ•°æ®\n    var processedGlobalMapData = JSON.parse(JSON.stringify(originalGlobalMapData));\n    removeUnderscoreKeys(processedGlobalMapData);\n    \n    // è·å–æ‰€æœ‰åœ°ç‚¹åç§°\n    var globalLocationNames = Object.keys(processedGlobalMapData);\n   // console.log('å…¨å±€åœ°ç‚¹è¡¨æ‰€æœ‰åœ°ç‚¹åç§°:', globalLocationNames);\n    \n    // åˆ›å»ºè¿‡æ»¤åçš„æ•°æ®å¯¹è±¡ï¼Œåªä¿ç•™å‰ä¸¤ä¸ªåœ°ç‚¹\n    var filteredGlobalMapData = {};\n    \n    // åªä¿ç•™ç´¢å¼•0å’Œ1çš„åœ°ç‚¹\n    if (globalLocationNames.length > 0) {\n        filteredGlobalMapData[globalLocationNames[0]] = processedGlobalMapData[globalLocationNames[0]];\n       // console.log('ä¿ç•™å…¨å±€åœ°ç‚¹[0]:', globalLocationNames[0], '=', processedGlobalMapData[globalLocationNames[0]]);\n    }\n    if (globalLocationNames.length > 1) {\n        filteredGlobalMapData[globalLocationNames[1]] = processedGlobalMapData[globalLocationNames[1]];\n       // console.log('ä¿ç•™å…¨å±€åœ°ç‚¹[1]:', globalLocationNames[1], '=', processedGlobalMapData[globalLocationNames[1]]);\n    }\n    \nvar filteredGlobalMapArray = Object.values(filteredGlobalMapData);\n    // è½¬æ¢ä¸ºJSONå­—ç¬¦ä¸²\n    var global_map = JSON.stringify(filteredGlobalMapArray);\n    \n} else {\n    // å¦‚æœåŸå§‹æ•°æ®ä¸ºç©ºæˆ–ä¸å­˜åœ¨ï¼Œè¿”å›ç©ºå­—ç¬¦ä¸²\n    var global_map = '';\n    console.log('å…¨å±€åœ°å›¾æ•°æ®ä¸ºç©º');\n}\n\n// è·å–åŸå§‹åœ°å›¾æ•°æ®\nvar originalMapData = _.get(assaData, 'map.ä¸»è¦åœ°ç‚¹è¡¨', '');\nconsole.log('åŸå§‹ä¸»è¦åœ°ç‚¹è¡¨æ•°æ®:', originalMapData);\n\n// å¦‚æœæ•°æ®å­˜åœ¨ä¸”ä¸ä¸ºç©º\nif (originalMapData && typeof originalMapData === 'object') {\n    // åˆ›å»ºæ·±æ‹·è´ä»¥é¿å…ä¿®æ”¹åŸå§‹æ•°æ®\n    var processedMapData = JSON.parse(JSON.stringify(originalMapData));\n    removeUnderscoreKeys(processedMapData);\n    \n    // ä»å…¨å±€åœ°ç‚¹è¡¨è·å–ç¬¬ä¸€ä¸ªåœ°ç‚¹çš„å€¼ä½œä¸ºçˆ¶çº§å‚è€ƒ\n    var globalMapData = _.get(assaData, 'map.å…¨å±€åœ°ç‚¹è¡¨', {});\n    var globalLocationKeys = Object.keys(globalMapData);\n    var firstLocationValue = globalMapData[globalLocationKeys[0]];\n    console.log('å…¨å±€åœ°ç‚¹è¡¨çš„ç¬¬ä¸€ä¸ªåœ°ç‚¹å€¼ï¼ˆç”¨ä½œparentï¼‰:', firstLocationValue);\n    console.log('å…¨å±€åœ°ç‚¹è¡¨æ‰€æœ‰é”®:', globalLocationKeys);\n    \n    // åˆ›å»ºè¿‡æ»¤åçš„æ•°æ®å¯¹è±¡\n    var filteredMapData = {};\n    \n    // è·å–ä¸»è¦åœ°ç‚¹è¡¨çš„æ‰€æœ‰åœ°ç‚¹åç§°\n    var mainLocationNames = Object.keys(processedMapData);\n    console.log('ä¸»è¦åœ°ç‚¹è¡¨æ‰€æœ‰åœ°ç‚¹åç§°:', mainLocationNames);\n    \n    // éå†æ‰€æœ‰åœ°ç‚¹ï¼Œåªä¿ç•™parentå­—æ®µç­‰äºç¬¬ä¸€ä¸ªåœ°ç‚¹å€¼çš„åœ°ç‚¹\n    Object.keys(processedMapData).forEach(function(locationName) {\n        var location = processedMapData[locationName];\n       // console.log('æ£€æŸ¥åœ°ç‚¹:', locationName, ', parent:', location ? location.parent : 'undefined', ', æ¯”è¾ƒå€¼:', firstLocationValue);\n        \n        // å¦‚æœè¯¥åœ°ç‚¹çš„parentå­—æ®µç­‰äºç¬¬ä¸€ä¸ªåœ°ç‚¹çš„å€¼ï¼Œåˆ™ä¿ç•™\n        if (location && typeof location === 'object' && location.parent === firstLocationValue) {\n            console.log('  -> ä¿ç•™è¯¥åœ°ç‚¹:', locationName);\n            // å¦‚æœè¯¥åœ°ç‚¹å­˜åœ¨ä¸”æœ‰shapeå­—æ®µï¼Œåˆ™åˆ é™¤å®ƒ\n            if (location.hasOwnProperty('shape')) {\n                // delete location.shape;\n            }\n            filteredMapData[locationName] = location;\n        } else {\n           // console.log('  -> è¿‡æ»¤æ‰è¯¥åœ°ç‚¹:', locationName);\n        }\n    });\n    \n    console.log('è¿‡æ»¤åä¿ç•™çš„åœ°ç‚¹æ•°é‡:', Object.keys(filteredMapData).length);\n    \n    // è½¬æ¢ä¸ºJSONå­—ç¬¦ä¸²\n    var main_map = formatObjectGracefully(filteredMapData);\n \n} else {\n    // å¦‚æœåŸå§‹æ•°æ®ä¸ºç©ºæˆ–ä¸å­˜åœ¨ï¼Œè¿”å›ç©ºå­—ç¬¦ä¸²\n    var main_map = '';\n    console.log('ä¸»è¦åœ°ç‚¹è¡¨æ•°æ®ä¸ºç©º');\n}\n_%>\ngame.map_mamory.init();\nmap_mamory.load('å…¨å±€åœ°ç‚¹è¡¨', {\n  <%= global_map %>,\n  rule: 'è®°å½•{{user}}**å½“å‰æ‰€å¤„åœ°å›¾**çš„æ ‡é¢˜å’Œå¤–éƒ¨åŒºåŸŸï¼Œå¤–éƒ¨åŒºåŸŸè‡³å°‘ä¸‰ä¸ª',\n  on_update: {\n    trigger: 'environment_change({{user}})',\n    action: \"memory('map', 'å…¨å±€åœ°ç‚¹è¡¨', [\"å½“å‰åœ°ç‚¹æ ‡é¢˜\", \"å¤–éƒ¨åŒºåŸŸ1;å¤–éƒ¨åŒºåŸŸ2...\"])\"//åªèƒ½æŒ‰ç…§æ­¤å›ºå®šæ ¼å¼æ›´æ–°\n  }\n})\n.load('map.ä¸»è¦åœ°ç‚¹è¡¨', {\n  <%= main_map %>,\n  rule: 'è®°å½•å½“å‰åœ°å›¾çš„3-8ä¸ªå­åœ°ç‚¹(GeoUnit)ã€‚å½“è§¦å‘æ›´æ–°æ—¶ï¼Œè¾“å‡ºmemory()çš„å®Œæ•´æŒ‡ä»¤åºåˆ—ã€‚',\n//å¦‚æœéœ€è¦æ›´æ–°åœ°å›¾çš„æŸä¸ªå­—æ®µï¼Œè¯·å•ç‹¬æ›´æ–°è¯¥åœ°å›¾çš„ç‰¹å®šå­—æ®µä»¥å‡å°‘ä½ çš„è¾“å‡ºå‹åŠ›\n  templates: {\n    GeoUnit: {\n    parent: 'string //çˆ¶çº§åœ°ç‚¹åç§°ï¼Œåˆå§‹åŒ–åå°±ç¦æ­¢ä¿®æ”¹ã€‚**å¼ºåˆ¶è¦æ±‚**ï¼šæ­¤å­—æ®µå¿…é¡»æ—¶åˆ»ä¸å…¨å±€åœ°ç‚¹è¡¨çš„å½“å‰æ ‡é¢˜å®Œå…¨åŒ¹é…ï¼å¦‚æœ{{user}}è¿›å…¥æ–°åœºæ™¯ï¼Œå¿…é¡»å…ˆæ›´æ–°å…¨å±€æ ‡é¢˜ï¼Œå†ç”Ÿæˆparentä¸ä¹‹åŒ¹é…çš„å­åœ°ç‚¹',\n     type: 'string // ç±»å‹åç§°ï¼Œä¾‹å¦‚: \"å»ºç­‘\"ã€\"æ°´ä½“\"ã€\"æ¤è¢«\"ã€\"é“è·¯\"ã€\"åœ°å½¢\"ç­‰',\n      description: 'string(50-150)',\n      effect:'string//userå¤„äºæ­¤åœ°ç‚¹æ—¶å¯èƒ½å—åˆ°çš„å¢ç›Š/å‡ç›Šï¼Œåªèƒ½ä½¿ç”¨å·²æœ‰çš„å±æ€§æ®µå’ŒæŠ€èƒ½æ®µã€‚åªæœ‰ç‰¹æ®Šå»ºç­‘æœ‰ã€‚æ ¼å¼:ã€attr/skillÂ±value;attr/skillÂ±valueã€‘/ã€æ— ã€‘ã€‚æ— éœ€åº”ç”¨åˆ°user statuså’Œattribute)'.\n      shape: { base_form: 'æ¨¡æ¿(shape_templates)', modifier: 'æ¨¡æ¿(modifier_templates)' },\nresources: '{ \"èµ„æºå\": [\"${äº§å‡ºé‡}/d\", ${æ€»é‡}, \"${æè¿°}\"] }'//äº§å‡º/d: >0ç”Ÿäº§,=0å‚¨å­˜,<0æ¶ˆè€—ã€‚æ€»é‡â‰¥0æˆ–\"æ— é™\"\n     other:'{}//è‡ªç”±æ‹“å±•çš„å­—æ®µï¼Œé‡Œé¢å¯ä»¥è„‘æ´å¤§å¼€è®°å½•ä»»ä½•åœ°å›¾ç›¸å…³çš„æ‹“å±•ä¿¡æ¯ï¼Œå¦‚å»ºç­‘ç­‰çº§ã€å±…ä½ç”Ÿç‰©ç­‰ã€‚'\n    },\n    shape_templates: {\n      circle: '{form_type:\"primitive_circle\", params:{center:[x,y], radius:r}}',\n      polygon: '{form_type:\"primitive_polygon\", params:{points:[[x,y],...]}}',\n      path: '{form_type:\"path\", params:{instructions:[{do:\"move_to\", at:[x,y]}, {do:\"curve_to\", at:[x,y], controls:[[cx,cy],..]}, {do:\"line_to\", at:[x,y]}, {do:\"close_path\"}]}}',\n      compound: '{form_type:\"compound\", params:{operation:enum([\"union\",\"difference\",\"intersection\"]), shape_A:{...template...}, shape_B:{...template...}}}'\n    },\n    modifier_templates: {\n      procedural_noise: '{procedural_noise:{is_active:bool, intensity:float(1-10), scale:float(5-50), seed:int}}'\n    }\n  },\n  generation_constraints: {\n    count: '3-8',\n    output_format: \"memory('map.ä¸»è¦åœ°ç‚¹è¡¨', 'åœ°ç‚¹åç§°', GeoUnitObject); //åºåˆ—ä»¥åˆ†å·åˆ†éš”\",\n    no_overlap_check: 'åŸºäºbase_formçš„åŒ…å›´ç›’è®¡ç®—ï¼Œç¦æ­¢é‡å '\n  },\n  on_update: {\n    trigger: 'memory_change(map.å…¨å±€åœ°ç‚¹è¡¨)',\n    scenarios: {\n      enter_dynamic_map: {\n        condition: 'default',\n        action: [\n\"//...åŸºäºç°æœ‰æ¨¡æ¿å’Œè§„åˆ™ï¼Œç›´æ¥åŠ¨æ€ç”Ÿæˆ3-8ä¸ªæ–°åœ°ç‚¹åºåˆ—ï¼Œ**ä¸ç”¨**åˆ é™¤ä¹‹å‰çš„åœ°å›¾\",\n\"memory(...); memory(...);\"\n        ]\nexample:memory('map', 'å…¨å±€åœ°ç‚¹è¡¨','[\"æ—å®¶å¤§å®…\",\"å¤–éƒ¨åŒºåŸŸ...\"]');\nmemory('map.ä¸»è¦åœ°ç‚¹è¡¨', 'æ—å®¶æ­£å ‚', '{\"parent\":\"æ—å®¶å¤§å®…\",\"type\":\"å»ºç­‘\",\"effect\":\"ã€æ²‰ç€+1ã€‘\",\"description\":\"xxxã€‚\",\"shape\":{\"base_form\":{\"form_type\":\"primitive_polygon\",\"params\":{\"points\":[[100,200],[300,200],[300,350],[100,350]]}}},\"resources\":{},\"other\":{}}'); \n      },\n      location_content_change: {\n      condition: 'æ­£æ–‡ä¸­æŸä¸ªåœ°ç‚¹çš„ä¿¡æ¯å‘ç”Ÿäº†æ”¹å˜',\n      action: [\n        \"//å½“æ­£æ–‡ä¸­æŸä¸ªåœ°ç‚¹çš„å†…å®¹å‘ç”Ÿå˜åŒ–æ—¶ï¼ˆå¦‚æŸæ ·ç‰©å“è¢«æ‹¿èµ°ã€åœ°å½¢ç­‰è¢«æ”¹å˜ç­‰ï¼‰ï¼ŒåŒæ­¥æ›´æ–°å¯¹åº”çš„åœ°å›¾æ•°æ®\",\n        \"memory('...'); //æ›´æ–°åœ°ç‚¹ä¿¡æ¯\"\n        \"delete('...'); //åˆ é™¤æŸåœ°ç‚¹ä¿¡æ¯\"\n      ],\nexample: memory('map.ä¸»è¦åœ°ç‚¹è¡¨.é¢åŒ…å·¥åŠ.resources.é¢åŒ…', '[\"4/d\",180,\"...]');//{{user}}æ‹¿èµ°20ä¸ªï¼Œ200-20=180\nmemory('map.ä¸»è¦åœ°ç‚¹è¡¨.å®¶.resources.é¢åŒ…', '[\"0/d\",20,\"...\"]');//è½¬ç§»åˆ°å®¶ä¸­å‚¨å­˜\n    }\n    }\n  }\n});",
                    "constant": true,
                    "selective": true,
                    "insertion_order": 998,
                    "enabled": true,
                    "position": "before_char",
                    "use_regex": true,
                    "extensions": {
                        "position": 0,
                        "exclude_recursion": false,
                        "display_index": 58,
                        "probability": 100,
                        "useProbability": true,
                        "depth": 4,
                        "selectiveLogic": 0,
                        "group": "åœ°å›¾1",
                        "group_override": false,
                        "group_weight": 100,
                        "prevent_recursion": false,
                        "delay_until_recursion": false,
                        "scan_depth": null,
                        "match_whole_words": null,
                        "use_group_scoring": false,
                        "case_sensitive": null,
                        "automation_id": "",
                        "role": 0,
                        "vectorized": false,
                        "sticky": 0,
                        "cooldown": 0,
                        "delay": 0,
                        "match_persona_description": false,
                        "match_character_description": false,
                        "match_character_personality": false,
                        "match_character_depth_prompt": false,
                        "match_scenario": false,
                        "match_creator_notes": false,
                        "triggers": []
                    }
                },
                {
                    "id": 67,
                    "keys": [],
                    "secondary_keys": [],
                    "comment": "ğŸ”°æŠ—å…¨çŸ¥å…¨èƒ½-å¼±",
                    "content": "<%_\n// å°è£…çš„æ•°æ®è·å–å‡½æ•° - é¿å…é‡å¤å®šä¹‰\n \n    function getDataWithFallback(varName) {\n \n        let data = getLocalVar(varName);\n       \n        // å†…è”æ•°æ®éªŒè¯ï¼šæ£€æŸ¥æ˜¯å¦ä¸ºnullã€undefinedï¼Œä¸”å¦‚æœæ˜¯å¯¹è±¡è¦æœ‰å†…å®¹\n        const isValid = (data) => {\n            // æ£€æŸ¥æ˜¯å¦ä¸º null æˆ– undefined\n            if (data === null || data === undefined) {\n                return false;\n            }\n            \n            // å¦‚æœæ˜¯å¯¹è±¡ç±»å‹ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰å†…å®¹\n            if (typeof data === 'object' && data !== null) {\n                // å¦‚æœæ˜¯æ•°ç»„ï¼Œæ£€æŸ¥é•¿åº¦\n                if (Array.isArray(data)) {\n                    return data.length > 0;\n                }\n                // å¦‚æœæ˜¯æ™®é€šå¯¹è±¡ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰å±æ€§\n                return Object.keys(data).length > 0;\n            }\n            \n            // å…¶ä»–ç±»å‹ï¼ˆå­—ç¬¦ä¸²ã€æ•°å­—ã€å¸ƒå°”å€¼ç­‰ï¼‰åªè¦ä¸æ˜¯ null/undefined å°±è®¤ä¸ºæœ‰æ•ˆ\n            return true;\n        };\n        \n        // å¦‚æœæ•°æ®ä¸ç¬¦åˆè¦æ±‚ï¼Œä» getLocalVar è·å–\n        if (!isValid(data)) {\n            data = getLocalVar(varName);\n        }\n        \n        return data;\n    }\n \n      if (typeof EvStat === 'undefined') {\n        var EvStat = getDataWithFallback(\"stat_data\");\n    }\nvar date2 = _.has(EvStat,'æ—¥æœŸ') ?  EvStat.æ—¥æœŸ[0] : \"æ— æ—¥æœŸ\";\nvar time2 =  _.has(EvStat,'æ—¶é—´') ?  EvStat.æ—¶é—´[0] : \"æ— æ—¶é—´\" ;\nvar year2 = _.has(EvStat,'çºªå¹´') ?  EvStat.çºªå¹´ : \"\";\nvar week2 =  _.has(EvStat,'æ˜ŸæœŸ') ?  EvStat.æ˜ŸæœŸ : \"\" ;\nif (typeof characterData === 'undefined') {\n    var characterData = getDataWithFallback(\"play_character_data\");\n}\nvar world_role = getLocalVar(\"world_role\", \"\");\nvar player_role = getLocalVar(\"player_role\", \"è½®å›è€…\");\nvar tier_role = getLocalVar(\"tier_role\", \"\");\nvar profession_role = getLocalVar(\"profession_role\", \"\");\nvar point_role = getLocalVar(\"point_role\", \"\");\nvar zhixian_role = getLocalVar(\"zhixian_role\", \"\");\nvar xp_role = getLocalVar(\"xp_role\", \"\");\n if (typeof version === 'undefined') {\n    var version = Number(getLocalVar(\"world_version\", 1));\n}\n\n_%>\ngame.set('Cognitive_Boundaries',{`\n- ä»»ä½•è§’è‰²éƒ½åªèƒ½çŸ¥é“è‡ªå·±â€œäº²çœ¼çœ‹åˆ°ã€äº²è€³å¬åˆ°ã€äº²è‡ªåšè¿‡â€æˆ–â€œåˆ«äººæ˜ç¡®å‘Šè¯‰â€çš„äº‹ã€‚\n- ä¸èƒ½çŒœåˆ«äººå¿ƒé‡Œæƒ³ä»€ä¹ˆï¼Œä¹Ÿä¸èƒ½å‡è®¾ç”»é¢å¤–å‘ç”Ÿäº†ä»€ä¹ˆã€‚\n<%_ if(version <7){ _%>\n- ç¦æ­¢åœ¨ä»»åŠ¡ä¸–ç•Œå’Œç°å®ä¸–ç•Œçš„åœŸè‘—npcé¢å‰æš´éœ²ä»»åŠ¡å’Œ<%=world_role %>ç›¸å…³çš„ä»»ä½•ä¿¡æ¯ã€‚\n<%_}_%>\n<%_ if(version === 6){ _%>\n- ä¿¡æ¯éš”ç¦»ï¼š**åœ¨ç¾¤å‘˜ä¹‹é—´ï¼ˆåŒ…æ‹¬<user>ï¼‰ä¸»åŠ¨å…±äº«ä¸–ç•Œä¿¡æ¯/è‡ªå·±çš„ä¿¡æ¯å‰ï¼Œå…¶ä»–ç¾¤å‘˜ç¦æ­¢æ‹¥æœ‰å…¨çŸ¥è§†è§’/ç›´æ’­è§†è§’ã€ç¦æ­¢å¾—çŸ¥è¯¥ç¾¤å‘˜çŠ¶æ€ä¿¡æ¯ï¼**\n<%_}_%>\n- å½“å‰æ—¶é—´ä¸ºï¼š<%=year2%> <%=date2%>-<%=time2%> <%=week2%>ã€‚\n`});",
                    "constant": true,
                    "selective": true,
                    "insertion_order": 3,
                    "enabled": true,
                    "position": "after_char",
                    "use_regex": true,
                    "extensions": {
                        "position": 4,
                        "exclude_recursion": false,
                        "display_index": 59,
                        "probability": 100,
                        "useProbability": true,
                        "depth": 0,
                        "selectiveLogic": 0,
                        "group": "è®¤çŸ¥å±éšœ",
                        "group_override": false,
                        "group_weight": 100,
                        "prevent_recursion": false,
                        "delay_until_recursion": false,
                        "scan_depth": null,
                        "match_whole_words": null,
                        "use_group_scoring": false,
                        "case_sensitive": null,
                        "automation_id": "",
                        "role": 0,
                        "vectorized": false,
                        "sticky": 0,
                        "cooldown": 0,
                        "delay": 0,
                        "match_persona_description": false,
                        "match_character_description": false,
                        "match_character_personality": false,
                        "match_character_depth_prompt": false,
                        "match_scenario": false,
                        "match_creator_notes": false,
                        "triggers": []
                    }
                },
                {
                    "id": 68,
                    "keys": [],
                    "secondary_keys": [],
                    "comment": "æ‰‹åŠ¨-å¯ä»¥å…³-[éšæœºä¸–ç•Œç”Ÿæˆ]-åªä¼šåœ¨å®‰å…¨åŒºå ç”¨å‡ åtoken(æœ«æ—¥/æ— ä¸–ç•Œè§‚ä¸å¯ç”¨)",
                    "content": "<%_\n// å°è£…çš„æ•°æ®è·å–å‡½æ•° - é¿å…é‡å¤å®šä¹‰\n \n    function getDataWithFallback(varName) {\n    \n        let data = getLocalVar(varName);\n       \n        // å†…è”æ•°æ®éªŒè¯ï¼šæ£€æŸ¥æ˜¯å¦ä¸ºnullã€undefinedï¼Œä¸”å¦‚æœæ˜¯å¯¹è±¡è¦æœ‰å†…å®¹\n        const isValid = (data) => {\n            // æ£€æŸ¥æ˜¯å¦ä¸º null æˆ– undefined\n            if (data === null || data === undefined) {\n                return false;\n            }\n            \n            // å¦‚æœæ˜¯å¯¹è±¡ç±»å‹ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰å†…å®¹\n            if (typeof data === 'object' && data !== null) {\n                // å¦‚æœæ˜¯æ•°ç»„ï¼Œæ£€æŸ¥é•¿åº¦\n                if (Array.isArray(data)) {\n                    return data.length > 0;\n                }\n                // å¦‚æœæ˜¯æ™®é€šå¯¹è±¡ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰å±æ€§\n                return Object.keys(data).length > 0;\n            }\n            \n            // å…¶ä»–ç±»å‹ï¼ˆå­—ç¬¦ä¸²ã€æ•°å­—ã€å¸ƒå°”å€¼ç­‰ï¼‰åªè¦ä¸æ˜¯ null/undefined å°±è®¤ä¸ºæœ‰æ•ˆ\n            return true;\n        };\n        \n        // å¦‚æœæ•°æ®ä¸ç¬¦åˆè¦æ±‚ï¼Œä» getLocalVar è·å–\n        if (!isValid(data)) {\n            data = getLocalVar(varName);\n        }\n        \n        return data;\n    }\n \n \n\nvar selectedTaskType = '';\n \n\n    if (typeof EvStat === 'undefined') {\n        var EvStat = getDataWithFallback(\"stat_data\");\n    }\n    \nif (typeof version === 'undefined') {\n    var version = Number(getLocalVar(\"world_version\", 1));\n}\n \n    // å®šä¹‰å››ä¸ªæ± å­\n    const taskTones = [\n         'ä¸¥è‚ƒå‹',\n    'ä¹å­äººå‹',\n    'å®å¤§å™äº‹å‹',\n    'ç»æœ›æŒ£æ‰å‹',\n    'æ‚¬ç–‘æƒŠæ‚šå‹',\n    'æ™ºæ€§åšå¼ˆå‹',\n    'æ²‰æµ¸æ‰®æ¼”å‹:è¦æ±‚æ‰®æ¼”å¥½è§’è‰²è¾¾æˆæŸä¸ªç›®çš„ï¼Œå¹¶ä¸”ç¦æ­¢ooc',\n    'æ¢ç´¢å‘ç°å‹',\n    'ç™«ç‹‚æ··ä¹±å‹',\n    'é“å¾·å›°å¢ƒå‹',\n    'ç§ç”°è¿è¥å‹',\n    'æ¸©æƒ…æ²»æ„ˆå‹',\n    'å‡»æ€å‹ï¼šå¯ä»¥é€šè¿‡å‡»æ€æŸç§ç”Ÿç‰©è·å¾—ç§¯åˆ†ï¼ˆä¾‹å¦‚ä¸€åªä¸§å°¸10ç‚¹ç§¯åˆ†ï¼‰ï¼Œå‡»æ€æ—¶ç³»ç»Ÿåº”å½“åœºç»“ç®—ã€‚æ­¤ç±»ä»»åŠ¡æ—¶é™ä¸å¾—è¶…è¿‡ä¸‰å¤©ï¼Œä»¥é˜²åˆ·ç§¯åˆ†ã€‚',\n      \"æ‹çˆ±/åˆ†æ‰‹æ¨¡æ‹Ÿå‹\",\n        \"é¾™å¥—é€†è¢­å‹\",\n        \"åæ´¾æ´—ç™½/ä¸»è§’é»‘åŒ–å‹\",\n         \"æ–‡æ˜é£å‡å‹\",\n        'ä»»åŠ¡åŸºè°ƒå®Œå…¨éšæœº'\n    ];\n\n    const worldTypes = [\n        \"ç°ä»£éƒ½å¸‚\",\n    \"è¿‘ç°ä»£\",\n    \"è¥¿æ–¹å¥‡å¹»\",\n    \"è¥¿æ–¹ç¥è¯\",\n    \"ä¸œæ–¹ç„å¹»\",\n    \"ä¸œæ–¹ç¥è¯\",\n        \"è¯¡ç§˜ä¿®ä»™\",\n        \"åºŸåœŸæœ«æ—¥\",\n        \"å†å²æ¶ç©º\",\n    \"æ­¦ä¾ æ±Ÿæ¹–\",\n        \"èµ›åšæœ‹å…‹\",\n    \"æ˜Ÿé™…ç§‘å¹»\",\n        \"è’¸æ±½æœ‹å…‹\",\n \n    \"ç»è¥å»ºè®¾\",\n    \"æµ·æ´‹å†’é™©\",\n        \"è§„åˆ™æ€ªè°ˆ\",\n        \"ææ€–æƒŠæ‚š\",\n    \"ææ€–ç”Ÿå­˜\",\n    \"å¤§é€ƒæ€ä¸å¯¹æŠ—\",\n    \"äºŒæ¬¡å…ƒ\",\n    \"åŒäººè¡ç”Ÿ\",\n    \"ç‰¹æ®Šä¸–ç•Œè§‚\",\n    \"å…¨æ°‘é¢†ä¸»\",\n    \"åŸºé‡‘ä¼šä¸å…‹è‹é²ç¥è¯\",\n    \"éšæœºç”Ÿæˆ\"\n    ];\n\n    const worldDetailsDatabase =  \n       {\n    \"ç°ä»£éƒ½å¸‚\": {\n        \"identities\": [\n             \"è´µæ—å­¦æ ¡çš„å¹³æ°‘å­¦ç”Ÿ\",\n            \"å¶åƒäº‹åŠ¡æ‰€çš„ç»ƒä¹ ç”Ÿ\",\n            \"ä¹™å¥³æ¸¸æˆå…¬å¸çš„æµ‹è¯•å‘˜\",\n            \"çŸ¥åè‰ºæœ¯å®¶çš„æ¨¡ç‰¹\",\n            \"ç”µç«ä¿±ä¹éƒ¨çš„ç»ç†\",\n            \"å¿ƒç†å­¦å®¶\",\n            \"ä¿é™©è°ƒæŸ¥å‘˜\",\n            \"æ¡£æ¡ˆç®¡ç†å‘˜\",\n            \"å›¾ä¹¦ç®¡ç†å‘˜\",\n            \"æ™®é€šå¸‚æ°‘\",\n            \"æ™®é€šå­¦ç”Ÿ\",\n            \"ç§å®¶ä¾¦æ¢\",\n            \"å…¬å¸èŒå‘˜\",\n            \"æ— ä¸šæ¸¸æ°‘\",\n            \"ç§˜å¯†ç‰¹å·¥\",\n            \"ç½‘çº¢ä¸»æ’­\",\n            \"è­¦å¯Ÿ\",\n            \"åŒ»ç”Ÿ\",\n            \"å¾‹å¸ˆ\",\n            \"è®°è€…\",\n            \"è‰ºæœ¯å®¶\",\n            \"ç¨‹åºå‘˜\",\n            \"å¤–å–å‘˜\",\n            \"å°æŠ¥è®°è€…\",\n            \"é…’å§è°ƒé…’å¸ˆ\",\n            \"é€€ä¼‘è€äºº\",\n            \"æµæµªæ±‰\",\n            \"æ³•åŒ»\",\n            \"å¯Œå®¶å…¬å­/åƒé‡‘\",\n            \"éƒ½å¸‚æ€ªè°ˆè°ƒæŸ¥å‘˜\",\n            \"å¼‚é—»è®ºå›ç‰ˆä¸»\",\n            \"è¢«è¯…å’’çš„å¤è‘£åº—ä¸»\",\n            \"èƒ½çœ‹è§â€œå¼‚å¸¸â€çš„å¤–å–å‘˜\",\n            \"å¤„ç†è¶…è‡ªç„¶äº‹ä»¶çš„â€œæ¸…æ´å·¥â€\",\n            \"ä¸“é—¨æŠ¥é“çµå¼‚æ–°é—»çš„è®°è€…\",\n            \"éšæœºç”Ÿæˆ\",\n            \"è§‰é†’äº†â€œè¯»æ‡‚çŒ«è¯­â€èƒ½åŠ›çš„å® ç‰©åŒ»ç”Ÿ\",\n            \"ä¸“é—¨è§£å†³å®¶åº­è¶…è‡ªç„¶çŸ›ç›¾çš„â€œé‡‘ç‰Œè°ƒè§£å‘˜â€\",\n            \"è¡¨é¢æ˜¯å…¨èŒCoserï¼Œå®é™…åœ¨å¤œæ™šæ‰“å‡»çŠ¯ç½ªçš„åœ°ä¸‹è‹±é›„\",\n            \"ç»è¥ç€ä¸€å®¶åªåœ¨åˆå¤œåäºŒç‚¹åå¼€é—¨çš„è§£å¿§æ‚è´§é“ºçš„åº—ä¸»\"\n        ],\n        \"openings\": [\n             \"è½¬å­¦ç¬¬ä¸€å¤©å°±ä¸å°å¿ƒæ’å€’äº†å­¦æ ¡çš„é£äº‘äººç‰©\",\n            \"å‘ç°é‚»å±…æ˜¯çŸ¥åçš„å¶åƒæ˜æ˜Ÿï¼Œå¹¶ä¸”ä»–ä¼¼ä¹æœ‰ä»€ä¹ˆæŠŠæŸ„åœ¨ä½ æ‰‹ä¸Š\",\n            \"ç©çš„æ‹çˆ±æ¸¸æˆçªç„¶æˆçœŸï¼Œä½ æˆäº†è¢«æ‰€æœ‰å¯æ”»ç•¥è§’è‰²è¿½é€çš„å¯¹è±¡\",\n            \"ä¸ºäº†å®¶æ—ä¼ä¸šï¼Œä¸å¾—ä¸ä¸è®¨åŒçš„å¯¹æ‰‹å‡æ‰®æƒ…ä¾£\",\n            \"æ”¶åˆ°äº†æ¥è‡ªæœªæ¥è‡ªå·±çš„ä¿¡ä»¶ï¼ŒæŒ‡å¯¼ä½ å¦‚ä½•é¿å…å­¤ç‹¬ç»ˆè€çš„å‘½è¿\",\n            \"åœ¨æ‹¥æŒ¤çš„åœ°é“ä¸Šé†’æ¥ï¼Œå‘ç°ä¸¢å¤±äº†æ‰€æœ‰è®°å¿†\",\n            \"æ”¶åˆ°ä¸€å°åŒ¿åçš„å‹’ç´¢é‚®ä»¶ï¼ŒæŒ‡å‘ä¸€ä¸ªæƒŠå¤©é˜´è°‹\",\n            \"ç›®ç¹äº†ä¸€åœºç¦»å¥‡çš„è½¦ç¥¸ï¼Œæ­»è€…å¹¶éäººç±»\",\n            \"ç»§æ‰¿äº†ä¸€å®¶æ¿’ä¸´å€’é—­çš„å’–å•¡é¦†\",\n            \"åœ¨æ·±å¤œçš„ä¾¿åˆ©åº—é‡åˆ°äº†è¯´è¯çš„çŒ«å’ª\",\n            \"æ‰‹æœºé‡Œçªç„¶å‡ºç°äº†ä¸€ä¸ªç¥ç§˜çš„èŠå¤©ç¾¤\",\n            \"åœ¨å…¬å¸åŠ ç­æ—¶å‘ç°åŒäº‹ä»¬éƒ½æ¶ˆå¤±äº†\",\n            \"è¢«å·å…¥äº†ä¸€åœºç½‘ç»œç›´æ’­ä¸­çš„è¶…è‡ªç„¶äº‹ä»¶\",\n            \"åœ¨æ‹¥æŒ¤çš„åœ°é“ä¸Šé†’æ¥ï¼Œå‘ç°æ‰€æœ‰äººæ‰‹æœºéƒ½æ”¶åˆ°äº†ä¸€æ¡æœªçŸ¥æ¥æºçš„çŸ­ä¿¡\",\n            \"ç§Ÿåˆ°äº†ä¸€é—´æå…¶ä¾¿å®œä½†æ€ªäº‹é¢‘å‘çš„å…¬å¯“\",\n            \"ç›®ç¹äº†ä¸€åœºç¦»å¥‡çš„è½¦ç¥¸ï¼Œæ­»è€…èº«ä¸Šæœ‰éäººçš„ç‰¹å¾\",\n            \"æ”¶åˆ°ä¸€ä¸ªåŒ¿ååŒ…è£¹ï¼Œé‡Œé¢æ˜¯ä¸€ä»¶èƒ½é¢„çŸ¥æœªæ¥çš„ç‰©å“\",\n            \"å‘ç°è‡ªå·±çªç„¶èƒ½å¬åˆ°å‘¨å›´äººçš„å¿ƒå£°\",\n            \"ç»§æ‰¿äº†ä¸€å®¶æ¿’ä¸´å€’é—­çš„å¤æ€ªå’–å•¡é¦†/ä¹¦åº—\",\n            \"ä¸€è§‰é†’æ¥ï¼Œå‘ç°è‡ªå·±æ˜¯æŸä¸ªç›´æ’­èŠ‚ç›®çš„å‚ä¸è€…ï¼Œè€Œè§‚ä¼—å¹¶éäººç±»\",\n            \"ç§Ÿä¸‹çš„å…¬å¯“é‡Œï¼Œæ¯æ™šåäºŒç‚¹éƒ½ä¼šå“èµ·æ•²é—¨å£°ï¼Œä½†é—¨å¤–æ€»æ˜¯ç©ºæ— ä¸€äººã€‚\",\n            \"æ‰‹æœºçªç„¶å¼€å§‹æ¨é€æ¥è‡ªâ€œå¦ä¸€ä¸ªä¸–ç•Œâ€çš„æ–°é—»å¤´æ¡ã€‚\",\n            \"æ­ä¹˜çš„æœ«ç­å…¬äº¤è½¦å¹¶æœªåœ¨ä»»ä½•å·²çŸ¥ç«™ç‚¹åœé ï¼Œæ­£é©¶å‘æœªçŸ¥åŒºåŸŸã€‚\",\n                \"æ¥åˆ°äº†ä¸€ä¸ªçœ‹ä¼¼ç®€å•çš„å¤±è¸ªäººå£æ¡ˆä»¶\",\n            \"åœ¨æ•´ç†æ—§æ¡ˆå·æ—¶å‘ç°äº†è¢«æ©ç›–çš„çœŸç›¸\",\n            \"æ”¶åˆ°äº†ä¸€å°æŒ‡å‘è¿ç¯æ€æ‰‹çš„åŒ¿åä¿¡\",\n            \"è¢«å·å…¥äº†ä¸€èµ·å¯†å®¤æ€äººæ¡ˆ\",\n            \"å‘ç°è‡ªå·±æ­£åœ¨è°ƒæŸ¥çš„æ¡ˆä»¶ä¸ç«¥å¹´é˜´å½±æœ‰å…³\",\n            \"åœ¨ä¸€ä¸ªåè¿œå°é•‡é­é‡äº†è¯¡å¼‚çš„é›†ä½“å¤±å¿†äº‹ä»¶\",\n            \"è¢«é‚€è¯·å‚åŠ ä¸€ä¸ªå¯Œè±ªçš„ç§äººèšä¼šï¼Œå´å‘ç°è¿™æ˜¯ä¸ªé™·é˜±\",\n            \"åœ¨åŒ»é™¢å€¼å¤œç­æ—¶é‡åˆ°äº†ä¸åº”è¯¥å­˜åœ¨çš„ç—…äºº\",\n            \"è°ƒæŸ¥ä¸€èµ·è½¦ç¥¸æ—¶å‘ç°æ­»è€…åœ¨äº‹æ•…å‘ç”Ÿå‰å°±å·²ç»æ­»äº¡\",\n \n            \"ä½ åœ¨ç›´æ’­ä¸­æ„å¤–æ‹åˆ°äº†ä¸è¯¥å­˜åœ¨çš„â€œä¸œè¥¿â€ï¼Œä¸€å¤œçˆ†çº¢çš„åŒæ—¶ä¹Ÿè¢«ç›¯ä¸Šäº†ã€‚\",\n            \"ä½ è¢«çˆ¶æ¯é€¼ç€å»ç›¸äº²ã€‚\",\n            \"ä½ ä¸‹ç­å›å®¶ï¼Œæ¡åˆ°ä¸€åªè„å…®å…®çš„æµæµªçŒ«ï¼Œäºå¿ƒä¸å¿å¸¦å›äº†å®¶ã€‚ç¬¬äºŒå¤©æ—©ä¸Šï¼Œä½ è¢«ä¸€å£°å·¨å“æƒŠé†’ï¼Œå‘ç°ä¸€ä¸ªé™Œç”Ÿçš„ç¾å°‘å¹´/ç¾å°‘å¥³ç©¿ç€ä½ æ˜¨æ™šç»™çŒ«æ´—æ¾¡æ—¶ç”¨çš„æµ´å·¾ï¼Œç«™åœ¨å¨æˆ¿é‡Œï¼Œå¹¶å£°ç§°æ˜¯ä½ æŠŠä»–/å¥¹å¬å”¤æ¥çš„ã€‚\",\n        \"éšæœºç”Ÿæˆ\" \n        ]\n    },\n \"è¿‘ç°ä»£\": {\n    \"identities\": [\n        \"çƒ­è¡€å­¦ç”Ÿ\",\n        \"æƒ…æŠ¥äººå‘˜\",\n        \"ä¸€çº¿è­¦å‘˜\",\n        \"å£«å…µ\",\n        \"ä¹¡æ‘åŒ»ç”Ÿ/æ•™å¸ˆ\",\n        \"å·¥å‚å·¥äºº\",\n        \"é‡‘èä»ä¸šè€…\",\n        \"æŠ¥ç¤¾è®°è€…/ç¼–è¾‘\",\n        \"ç”µå½±/æ–‡è‰ºä»ä¸šè€…\",\n        \"æ±Ÿæ¹–äººå£«\",\n        \"ç§˜å¯†é¡¹ç›®çš„ç§‘å­¦å®¶\",\n        \"é€ƒç¦»æˆ˜åŒºçš„éš¾æ°‘\",\n        \"æµ·å¤–æ´åŠ©äººå‘˜/ä¼ æ•™å£«\",\n        \"æ²¡è½çš„è´µæ—/å‰æœé—è€\",\n        \"è¿œæ´‹è´§è½®çš„æ°´æ‰‹\",\n        \"ç§å®¶ä¾¦æ¢\",\n        \"å·¥ä¼šé¢†è¢–\",\n        \"èˆªç©ºå…¬å¸çš„é£è¡Œå‘˜/ç©ºä¹˜\",\n        \"å¤–äº¤äººå‘˜\",\n        \"é€šå•†å£å²¸çš„å®ä¸šå®¶\",\n        \"è¡—å¤´çš„å°è´©\",\n        \"å®éªŒå®¤çš„ç ”ç©¶å‘˜\",\n        \"è½¦ç«™çš„æ£€ç¥¨å‘˜/è°ƒåº¦å‘˜\",\n        \"è·¨å›½å…¬å¸çš„èŒå‘˜\",\n        \"éšæœºç”Ÿæˆ\"\n    ],\n    \"openings\": [\n        \"1916å¹´ï¼Œå‡¡å°”ç™»çš„æˆ˜å£•é‡Œä¸‹ç€å†»é›¨ï¼Œä½ æ”¶åˆ°äº†ä¸€å°æ¥è‡ªæ•…ä¹¡çš„ä¿¡ã€‚\",\n        \"1929å¹´10æœˆ29æ—¥ï¼Œæ˜ŸæœŸäºŒï¼Œåå°”è¡—å¼€ç›˜çš„é’Ÿå£°åˆšåˆšæ•²å“ã€‚\",\n        \"ä½ åœ¨æ³°å¦å°¼å…‹å·çš„å¤´ç­‰èˆ±é†’æ¥ï¼Œå£è¢‹é‡Œæœ‰ä¸€å¼ ä¸å±äºè¿™ä¸ªæ—¶ä»£çš„èˆ¹ç¥¨ã€‚\",\n        \"æŸæ—å¢™ä¸‹ï¼Œä½ æ‰¾åˆ°äº†ä¸€ä¸ªåˆšå¥½å¯ä»¥å·é€’ä¸€å¼ çº¸æ¡çš„ç¼éš™ã€‚\",\n        \"1962å¹´ï¼Œä½ æ‰€åœ¨çš„æ ¸æ½œè‰‡ï¼Œåˆšåˆšæ”¶åˆ°äº†å‡†å¤‡å‘å°„æ ¸å¼¹çš„é¢„å¤‡æŒ‡ä»¤ã€‚\",\n        \"ä¹é¾™åŸå¯¨çš„éº»å°†é¦†é‡Œï¼Œå¤§ä½¬é€’ç»™ä½ ä¸€æ”¯çƒŸï¼Œè¯´æœ‰ç¬”â€˜å¤§ç”Ÿæ„â€™è¦è°ˆã€‚\",\n        \"ä¸€åç›–ä¸–å¤ªä¿å†›å®˜æ‹¦ä½äº†ä½ ï¼Œä»–ä¼¼ä¹åœ¨ä½ è—ç€çŠ¹å¤ªæœ‹å‹çš„é˜æ¥¼ä¸‹å¬åˆ°äº†ä»€ä¹ˆã€‚\",\n        \"1969å¹´ï¼Œä½œä¸ºå®‡èˆªå‘˜ï¼Œä½ åœ¨æœˆçƒçš„å°˜åœŸä¸­å‘ç°äº†ä¸€æšä¸è¯¥å­˜åœ¨çš„è„šå°ã€‚\",\n        \"å»‰æ”¿å…¬ç½²æˆç«‹çš„ç¬¬ä¸€å¤©ï¼Œä½ çš„åŠå…¬æ¡Œä¸Šå‡ºç°äº†ä¸€å°ä¸¾æŠ¥æ•´ä¸ªè­¦é˜Ÿçš„åŒ¿åä¿¡ã€‚\",\n        \"1986å¹´ï¼Œåˆ‡å°”è¯ºè´åˆ©éš”ç¦»åŒºå†…ï¼Œä½ æ‰‹ä¸­çš„ç›–é©è®¡æ•°å™¨å‘å‡ºäº†å‰æ‰€æœªæœ‰çš„è­¦æŠ¥ã€‚\",\n        \"ä½ åœ¨è·³èš¤å¸‚åœºä¹°åˆ°ä¸€å°æ—§æ”¶éŸ³æœºï¼Œå®ƒå´å˜¶å˜¶å•¦å•¦åœ°å¼€å§‹æ’­æ”¾ä¸‰å¤©åçš„æ–°é—»ã€‚\",\n        \"ä½œä¸ºä¸€åç ´è¯‘å‘˜ï¼Œä½ åˆšåˆšåœ¨æ•Œå†›çš„ç”µç ä¸­ç ´è¯‘å‡ºäº†ä¸€ä¸ªä¸å¯èƒ½çš„åœ°åï¼šäºšç‰¹å…°è’‚æ–¯ã€‚\",\n        \"æ•¦åˆ»å°”å…‹çš„æµ·æ»©ä¸Šï¼Œå¾·å†›çš„ç‚®ç«è¶Šæ¥è¶Šè¿‘ï¼Œè€Œè¿œæ–¹çš„æµ·é›¾é‡Œé©¶æ¥çš„å´æ˜¯ä¸€è‰˜å¤è€çš„å¸†èˆ¹ã€‚\",\n        \"1937å¹´çš„ä¸Šæµ·ï¼Œä½ ä¸çˆ±äººçº¦åœ¨å’–å•¡é¦†å‘Šåˆ«ï¼Œè€Œä»–/å¥¹çš„çœŸå®èº«ä»½æ˜¯æ—¥æœ¬ç‰¹åŠ¡ã€‚\",\n        \"ä½ åœ¨ä¼å¾·æ–¯æ‰˜å…‹éŸ³ä¹èŠ‚çš„æ³¥åœ°é‡Œé†’æ¥ï¼Œèº«è¾¹èººç€ä¸€ä½æœªæ¥çš„æ‘‡æ»šå·¨æ˜Ÿã€‚\",\n        \"ä¸€å¼ å†™ç€ä½ åå­—çš„å¤§å­—æŠ¥ï¼Œå‡ºç°åœ¨äº†è¡—é“æœ€æ˜¾çœ¼çš„å¢™ä¸Šã€‚\",\n        \"ä¸€ä»½å…³äºçº³ç²¹æ­£åœ¨ç§˜å¯†ç ”ç©¶çš„â€œè¶…è‡ªç„¶å†›å›¢â€çš„æ¡£æ¡ˆï¼Œæ„å¤–è½åˆ°äº†ä½ çš„æ‰‹ä¸­ã€‚\",\n        \"ä½ ååœ¨å¼€å¾€è¥¿éƒ¨çš„ç«è½¦ä¸Šï¼Œèº«è¾¹å›´ç»•ç€åœ¨å¤§è§æ¡ä¸­å¤±å»ä¸€åˆ‡çš„äººä»¬ã€‚\",\n        \"19ä¸–çºªçš„ä¼¦æ•¦ï¼Œå¼€è†›æ‰‹æ°å…‹åˆšåˆšçŠ¯ä¸‹æ–°çš„æ¡ˆä»¶ï¼Œè€Œä½ åœ¨å—å®³è€…çš„æ‰‹ä¸­å‘ç°äº†ä¸€æšå±äºä½ çš„è¢–æ‰£ã€‚\",\n        \"ä½ çˆ±ä¸Šäº†ä¸€ä½æ¥è‡ªæ•Œå¯¹é˜µè¥çš„å¤§ä½¿é¦†å·¥ä½œäººå‘˜ï¼Œä»Šæ™šä½ ä»¬è¦åœ¨ç»´ä¹Ÿçº³çš„æ¡¥ä¸Šåšæœ€åçš„è¯€åˆ«ã€‚\",\n        \"ä½ åœ¨å¼¥æ•¦é“çš„éœ“è™¹ç¯ä¸‹èº²é›¨ï¼Œä¸€ä¸ªäººä¸ºä½ æ’‘å¼€äº†ä¼ï¼Œä½ ä»¬çš„æ•…äº‹å°±æ­¤å¼€å§‹ã€‚\",\n        \"æ¿é—¨åº—çš„éå†›äº‹åŒºï¼Œä½ å’Œä¸€ä¸ªæ¥è‡ªå¦ä¸€æ–¹çš„å£«å…µï¼Œéš”ç€ä¸‰å…«çº¿åˆ†äº«äº†åŠæ”¯çƒŸã€‚\",\n        \"äº’è”ç½‘è¯ç”Ÿä¹‹åˆï¼Œä½ åœ¨ä¸€ä¸ªBBSä¸Šå‘ç°äº†ä¸€ä¸ªåä¸ºâ€˜è¡”å°¾è›‡â€™çš„ç§˜å¯†è®ºå›ï¼Œé‡Œé¢æ­£åœ¨è®¨è®ºå¦‚ä½•ä¿®æ”¹å†å²ã€‚\",\n      \"ç”²åˆæµ·æˆ˜çš„é»„æµ·ä¹‹ä¸Šï¼Œä½ æ‰€åœ¨çš„â€˜è‡´è¿œâ€™èˆ°å‘å‡ºäº†å†²å‘æ•Œèˆ°çš„æœ€åä¸€å£°é¸£ç¬›ã€‚\",\n    \"1898å¹´çš„åŒ—äº¬ï¼Œä½ ä½œä¸ºè°­å—£åŒçš„äº²ä¿¡ï¼Œæ”¶åˆ°äº†ä»–è®©ä½ è¿å¤œé€ƒäº¡çš„å¯†ä¿¡ã€‚\",\n    \"æ­¦æ˜ŒåŸå¤´çš„ç¬¬ä¸€å£°æªå“ä¼ æ¥ï¼Œä½ æ”¾ä¸‹äº†æ‰‹ä¸­æ­£åœ¨æ“¦æ‹­çš„æ±‰é˜³é€ æ­¥æªã€‚\",\n    \"1919å¹´5æœˆ4æ—¥ï¼Œä½ è¢«åŒçª—å¥½å‹æ‹‰ç€ï¼Œæ±‡å…¥äº†å‰å¾€å¤©å®‰é—¨çš„å­¦ç”Ÿäººæ½®ã€‚\",\n    \"é»„åŸ”å†›æ ¡çš„å¼€å­¦å…¸ç¤¼ä¸Šï¼Œä½ ä½œä¸ºç¬¬ä¸€æœŸå­¦å‘˜ï¼Œå¬åˆ°äº†æ ¡é•¿â€œä¸æˆåŠŸä¾¿æˆä»â€çš„è®­è¯ã€‚\",\n    \"1937å¹´çš„æ·æ²ªæˆ˜åœºï¼Œå››è¡Œä»“åº“å¤–ï¼Œç§Ÿç•Œçš„æ­Œèˆå‡å¹³ä¸å¯¹å²¸çš„æªç‚®å£°ä»…ä¸€æ²³ä¹‹éš”ã€‚\",\n    \"å»¶å®‰çš„çª‘æ´å‰ï¼Œä½ æ­£åœ¨æ²¹ç¯ä¸‹æ•™æˆ˜å£«ä»¬è¯†å­—ï¼Œä¸€ä»½åŠ æ€¥çš„æƒ…æŠ¥è¢«é€åˆ°äº†ä½ çš„æ‰‹ä¸Šã€‚\",\n    \"é‡åº†çš„é˜²ç©ºè­¦æŠ¥å†æ¬¡æ‹‰å“ï¼Œä½ æŠ±ç€å­©å­ï¼Œå’Œé‚»å±…ä»¬ä¸€èµ·åŒ†å¿™èº²è¿›æ½®æ¹¿çš„é˜²ç©ºæ´ã€‚\",\n    \"é£è™é˜Ÿçš„æœºåº“é‡Œï¼Œä½ ä½œä¸ºåœ°å‹¤äººå‘˜ï¼Œæ­£åœ¨ä¸ºä¸€ä¸ªç¾å›½é£è¡Œå‘˜çš„æˆ˜æœºç”»ä¸Šé²¨é±¼æ¶‚è£…ã€‚\",\n    \"1945å¹´çš„é‡åº†è°ˆåˆ¤ï¼Œä½ æ‹ä¸‹äº†ä¸¤ä½æ”¹å˜ä¸­å›½å‘½è¿çš„é¢†è¢–æ¡æ‰‹çš„ç¬é—´ã€‚\",\n    \"åœ¨æ·®æµ·æˆ˜å½¹çš„æ”¯æ´é˜Ÿä¼é‡Œï¼Œä½ æ¨ç€å±å‘€ä½œå“çš„ç‹¬è½®è½¦ï¼Œèµ°åœ¨æ³¥æ³çš„åœŸåœ°ä¸Šï¼Œå‰æ–¹å°±æ˜¯ç‚®ç«è¿å¤©çš„å‰çº¿ã€‚\",\n    \"1949å¹´4æœˆ23æ—¥ï¼Œä½ äº²çœ¼çœ‹åˆ°ç¬¬ä¸€é¢çº¢æ——æ’ä¸Šäº†å—äº¬â€œæ€»ç»Ÿåºœâ€çš„å±‹é¡¶ã€‚\",\n    \"1949å¹´10æœˆ1æ—¥ï¼Œä½ æŒ¤åœ¨å¤©å®‰é—¨å¹¿åœºçš„äººæµ·é‡Œï¼Œç­‰å¾…ç€é‚£ä¸ªå³å°†éœ‡åŠ¨ä¸–ç•Œçš„å£°éŸ³ã€‚\",\n    \"é•¿æ´¥æ¹–çš„å†°å¤©é›ªåœ°é‡Œï¼Œä½ æŠŠæœ€åä¸€ä¸ªå†»åœŸè±†åˆ†ç»™äº†èº«è¾¹æœ€å¹´è½»çš„æˆ˜å‹ã€‚\",\n     \"1860å¹´çš„åŒ—äº¬ï¼Œåœ†æ˜å›­çš„å†²å¤©ç«å…‰æ˜ åœ¨ä½ å«æ³ªçš„çœ¼ä¸­ï¼Œä½ æ€€é‡Œç´§ç´§æŠ±ç€ä¸€ä»¶ä»å¤§ç«ä¸­æŠ¢æ•‘å‡ºæ¥çš„çå®ã€‚\",\n    \"ä½ æ˜¯ä¸€åç•™ç¾å¹¼ç«¥ï¼Œåˆšåˆšæ¥åˆ°æœå»·çš„å‘½ä»¤ï¼Œè¢«å¼ºåˆ¶ä¸­æ–­å­¦ä¸šï¼Œå³åˆ»å›å›½ã€‚\",\n    \"ä¸œäº¤æ°‘å··çš„ä½¿é¦†åŒºå¤–ï¼Œå…«å›½è”å†›çš„æªç‚®å£°è¶Šæ¥è¶Šè¿‘ã€‚\",\n    \"â€œå››ä¸€äºŒâ€çš„å‡Œæ™¨ï¼Œä¸Šæµ·çš„è¡—å¤´è´´æ»¡äº†é€šç¼‰ä»¤ï¼Œä¸Šé¢æœ‰ä½ æ˜”æ—¥åŒå¿—çš„å¤´åƒã€‚\",\n    \"1937å¹´12æœˆï¼Œå—äº¬åŸç ´ï¼Œä½ åœ¨æ‹‰è´å…ˆç”Ÿè®¾ç«‹çš„å›½é™…å®‰å…¨åŒºé‡Œï¼Œä»é—¨ç¼å‘å¤–çª¥æ¢ç€è¡—ä¸Šçš„äººé—´åœ°ç‹±ã€‚\",\n    \"æ—¥å†›çš„731éƒ¨é˜ŸåŸºåœ°é‡Œï¼Œä½ è¢«å…³åœ¨ç‰¢æˆ¿ä¸­ï¼Œä»Šå¤©åˆæœ‰â€œé©¬è·¯å¤§â€ï¼ˆåŸæœ¨ï¼‰è¢«å¸¦èµ°ï¼Œå†ä¹Ÿæ²¡æœ‰å›æ¥ã€‚\",\n    \"èŠ±å›­å£çš„é»„æ²³å¤§å ¤è¢«ç‚¸å¼€ï¼Œä½ åœ¨æ»”å¤©çš„æ´ªæ°´ä¸­æ­»æ­»æŠ±ç€ä¸€å—é—¨æ¿ï¼Œå¯»æ‰¾ç€å¤±æ•£çš„å®¶äººã€‚\",\n    \"1942å¹´çš„æ²³å—ï¼Œé€ƒè’çš„è·¯ä¸Šï¼Œä½ å·²ç»ä¸‰å¤©æ²¡æœ‰åƒè¿‡ä¸€ç‚¹ä¸œè¥¿ï¼Œåªèƒ½é å•ƒé£Ÿæ ‘çš®ä¸ºç”Ÿã€‚\",\n    \"é•¿æ²™æ–‡å¤•å¤§ç«çš„å½“æ™šï¼Œä½ ä½œä¸ºå¥‰å‘½æ‰§è¡Œâ€œç„¦åœŸæ”¿ç­–â€çš„å£«å…µï¼Œäº²æ‰‹ç‚¹ç‡ƒäº†è‡ªå·±å®¶çš„æˆ¿å­ã€‚\",\n    \"ä½ æ˜¯ç¼…ç”¸è¿œå¾å†›çš„ä¸€å‘˜ï¼Œåœ¨é‡äººå±±çš„åŸå§‹ä¸›æ—é‡Œèº«æ‚£ç–Ÿç–¾ï¼Œä¸å¤§éƒ¨é˜Ÿå¤±å»äº†è”ç³»ã€‚\",\n    \"å°æ¹¾çš„ç™½è‰²ææ€–æ—¶æœŸï¼Œä½ çš„é‚»å±…ï¼Œä¸€ä½æ¸©å’Œçš„ä¸­å­¦è€å¸ˆï¼Œåœ¨åŠå¤œè¢«å‡ ä¸ªé™Œç”Ÿäººå¸¦èµ°ï¼Œä»æ­¤æ³æ— éŸ³ä¿¡ã€‚\",\n    \"é•¿æ˜¥å›´å›°æˆ˜ä¸­ï¼ŒåŸå†…å·²ç»æ–­ç²®æ•°æœˆï¼Œä½ ç”¨æœ€åä¸€ç‚¹é¦–é¥°æ¢æ¥çš„ä¸€å—é»‘é¢åŒ…ï¼Œè¢«é¥¥é¥¿çš„äººç¾¤æŠ¢èµ°äº†ã€‚\",\n \n        \"éšæœºç”Ÿæˆ\"\n    ]\n},\n    \"è¥¿æ–¹å¥‡å¹»\": {\n        \"identities\": [\n            \"è§ä¹ æ³•å¸ˆ\",\n            \"ç‹å›½éª‘å£«\",\n            \"åŸæ¸¸è¯—äºº\",\n            \"è¢«æµæ”¾çš„è´µæ—\",\n            \"ç›—è´¼å…¬ä¼šæˆå‘˜\",\n            \"è‰è¯å¸ˆ\",\n            \"ç‰§å¸ˆ/å¥³ç‰§å¸ˆ\",\n            \"å¾·é²ä¼Š\",\n            \"æ¸¸ä¾ \",\n            \"é“åŒ \",\n            \"ä½£å…µ\",\n            \"é­”æ³•å­¦é™¢å­¦ç”Ÿ\",\n            \"è§ä¹ æ³•å¸ˆ/å¥³æœ¯å£«\",\n            \"è½é­„çš„ç‹å›½éª‘å£«\",\n            \"é…’é¦†çš„åŸæ¸¸è¯—äºº\",\n            \"è¢«å‰¥å¤ºå¤´è¡”çš„è´µæ—\",\n            \"ç›—è´¼å…¬ä¼šçš„æ–°æ‰‹\",\n            \"æ‘åº„é‡Œçš„è‰è¯å¸ˆ\",\n            \"è¢«ç¥æ®¿æ”¶å…»çš„å­¤å„¿\",\n            \"èº²è—ä¸­çš„é¾™è£”\",\n            \"çŒé­”äºº/ç‹©é­”çŒäºº\",\n            \"é›‡ä½£å…µ\",\n            \"é€ƒäº¡çš„å…¬ä¸»/ç‹å­\",\n            \"è¢«æµæ”¾çš„è´µæ—åè£”\",\n            \"ç›—è´¼å…¬ä¼šçš„æ ¸å¿ƒæˆå‘˜\",\n            \"æŒæ¡ç¦å¿Œç‚¼é‡‘æœ¯çš„ç‚¼é‡‘æœ¯å¸ˆ\",\n            \"æš—é»‘é­”æ³•å°‘å¥³/å°‘å¹´\",\n            \"æ­£åœ¨é€ƒå©šçš„ç²¾çµç‹å­/å…¬ä¸»\",\n            \"è¢«æ¶é¾™æŠ“èµ°ä½†å’Œæ¶é¾™æˆäº†å¥½æœ‹å‹çš„äººç±»\",\n            \"å¼€å® ç‰©åº—ä¸“é—¨å”®å–å„ç§é­”æ³•ç”Ÿç‰©çš„å¹´è½»åº—ä¸»\",\n            \"è¯•å›¾ç”¨é­”æ³•æå†œä¸šé©å‘½çš„åŠåŠå­æ³•å¸ˆ\",\n            \"é€€ä¼‘çš„é­”ç‹/å‹‡è€…\",\n             \"å¸è¡€é¬¼äº²ç‹çš„è¡€å¥´\",\n            \"åœ¨é…’é¦†é‡Œè®²æ•…äº‹éª—åƒéª—å–çš„åŸæ¸¸è¯—äºº\",\n            \"éšæœºç”Ÿæˆ\"\n        ],\n        \"openings\": [\n            \"åœ¨å¤è€çš„é—è¿¹ä¸­è§¦ç¢°äº†ä¸€å—ç¬¦æ–‡çŸ³\",\n            \"ä½œä¸ºè¢«å·¨é¾™è¢­å‡»çš„å•†é˜Ÿä¸­å”¯ä¸€çš„å¹¸å­˜è€…\",\n            \"è¢«è¯¬é™·æ€å®³äº†å›½ç‹ï¼Œå¼€å§‹äº†é€ƒäº¡ç”Ÿæ¶¯\",\n            \"åœ¨æ£®æ—é‡Œæ¡åˆ°äº†ä¸€ä¸ªä¼šè¯´è¯çš„é­”æ³•ç‰©å“\",\n            \"ç»§æ‰¿äº†ç¥–çˆ¶ç•™ä¸‹çš„ç¥ç§˜æ³•å¸ˆå¡”\",\n            \"åœ¨é…’é¦†é‡Œæ¥åˆ°äº†ä¸€ä¸ªä»·å€¼ä¸è²çš„å§”æ‰˜\",\n            \"æ„å¤–å¬å”¤å‡ºäº†ä¸€ä¸ªå¼ºå¤§ä½†ä¸å—æ§åˆ¶çš„é­”ç‰©\",\n            \"å‘ç°è‡ªå·±æ˜¯ä¼ è¯´ä¸­å‹‡è€…çš„è½¬ä¸–\",\n            \"è¢«é€‰ä¸­å‚åŠ ç‹å®¤çš„ç§˜å¯†ä»»åŠ¡\",\n            \"åœ¨é­”æ³•å­¦é™¢çš„ç¦ä¹¦åŒºå‘ç°äº†ç¦å¿Œæ³•æœ¯\",\n            \"åœ¨å¤è€çš„é—è¿¹ä¸­è§¦ç¢°äº†ä¸€å—ç¬¦æ–‡ï¼Œè¢«ä¼ é€åˆ°äº†æœªçŸ¥ä¹‹åœ°\",\n            \"ä½œä¸ºè¢«å·¨é¾™è¢­å‡»çš„å•†é˜Ÿä¸­å”¯ä¸€çš„å¹¸å­˜è€…ï¼Œèº«ä¸Šå¤šäº†ä¸€ä¸ªé¾™çº¹çƒ™å°\",\n            \"è¢«è¯¬é™·åˆºæ€äº†å›½ç‹ï¼Œä¸å¾—ä¸åœ¨è¿½æ•ä¸­å¯»æ‰¾çœŸç›¸\",\n            \"åœ¨æ£®æ—é‡Œæ¡åˆ°äº†ä¸€ä¸ªä¼šè¯´è¯ã€æ€§æ ¼æ¶åŠ£çš„é­”æ³•ç‰©å“\",\n            \"å®¶ä¹¡è¢«é­”æ½®æ¯ç­ï¼Œä½ æ˜¯å”¯ä¸€çš„å¹¸å­˜è€…\",\n            \"ä¸ºäº†å¿è¿˜å·¨é¢èµŒå€ºï¼Œç­¾ä¸‹äº†ä¸€ä»½å±é™©çš„é­”æ³•å¥‘çº¦\",\n            \"åœ¨å¤è€çš„é—è¿¹ä¸­è§¦ç¢°äº†ä¸€å—ç¬¦æ–‡çŸ³ï¼Œä¸€ä¸ªå¤è€çš„çµé­‚å¯„å®¿åœ¨äº†ä½ çš„ä½“å†…ã€‚\",\n            \"ä½œä¸ºè¢«å·¨é¾™è¢­å‡»çš„å•†é˜Ÿä¸­å”¯ä¸€çš„å¹¸å­˜è€…ï¼Œä½ è·å¾—äº†é¾™çš„ä¸€éƒ¨åˆ†åŠ›é‡ã€‚\",\n            \"ä½ çš„â€œå‰ç¥¥ç‰©â€å‘Šè¯‰ä½ ï¼Œæƒ³è¦è·å¾—æ›´å¼ºçš„åŠ›é‡ï¼Œå°±å¿…é¡»çŒ®ä¸Šä½ æœ€çè´µçš„ä¸œè¥¿ï¼Œæ¯”å¦‚æƒ…æ„Ÿæˆ–è®°å¿†ã€‚\",\n            \"è’¸æ±½æœ‹å…‹éƒ½å¸‚é‡Œï¼Œä½ æ˜¯ä¸€åä½¿ç”¨é­”æ³•é©±åŠ¨çš„æœºæ¢°è‡‚çš„ä¾¦æ¢ï¼Œæ­£åœ¨è°ƒæŸ¥ä¸€å®—ç¦»å¥‡çš„ç‚¼é‡‘è°‹æ€æ¡ˆã€‚\",\n            \"è¯¸ç¥é»„æ˜å·²ç»å¼€å§‹ï¼Œä½œä¸ºè¢«é€‰ä¸­çš„å‹‡è€…ï¼Œä½ çš„ä»»åŠ¡ä¸æ˜¯æ‹¯æ•‘ä¸–ç•Œï¼Œè€Œæ˜¯ç¡®ä¿é˜¿æ–¯åŠ å¾·å½»åº•æ¯ç­ã€‚\",\n            \"éšæœºç”Ÿæˆ\",\n            \"ä½ æ­£åœ¨ä¸é‚»å›½ç‹å­/å…¬ä¸»ä¸¾è¡Œç››å¤§çš„å©šç¤¼ï¼Œä¸€åªå·¨å¤§çš„ç‹®é¹«çªç„¶ä»å¤©è€Œé™æŠ“èµ°äº†ä½ .\",\n            \"ä½ ç»§æ‰¿äº†è¿œæ–¹å”å”ç•™ä¸‹çš„ä¸€å®¶å°é…’é¦†ï¼Œå¼€ä¸šç¬¬ä¸€å¤©æ‰å‘ç°ï¼Œè¿™é‡Œçš„å¸¸å®¢æ˜¯é€€ä¼‘åæ²‰è¿·é’“é±¼çš„é­”ç‹ã€éšå±…å±±æ—ç ”ç©¶å¨è‰ºçš„å‹‡è€…å’Œå¤©å¤©æ¥è¹­é…’å–çš„æ‘¸é±¼å¥³ç¥ã€‚\",\n            \"ä½ æŒ‰ç…§å¤ä¹¦çš„æŒ‡å¼•ä¸¾è¡Œäº†æ¶é­”å¬å”¤ä»ªå¼ï¼Œå¸Œæœ›èƒ½è·å¾—è´¢å¯Œå’ŒåŠ›é‡ã€‚ç»“æœå¬å”¤æ¥ä¸€ä¸ªåªä¼šæ‰“æ‰«å«ç”Ÿã€çƒ¹é¥ªç¾é£Ÿçš„æ¶é­”ç®¡å®¶ï¼Œå¹¶å¼ºè¡Œå’Œä½ ç­¾è®¢äº†ä¸€ä»½ç»ˆèº«â€œåŠ³åŠ¨åˆåŒâ€ã€‚\"\n        ]\n    },\n    \"ä¸œæ–¹ç„å¹»\": {\n        \"identities\": [\n            \"å¤–é—¨å¼Ÿå­\",\n            \"ç‚¼ä¸¹å­¦å¾’\",\n            \"ä¸–å®¶å­å¼Ÿ/åƒé‡‘\",\n            \"éšå±…æ•£ä¿®\",\n            \"è—ç»é˜çœ‹å®ˆ\",\n            \"å®—é—¨æ‰§äº‹\",\n            \"æ¸¸å†æ•£ä»™\",\n            \"é­”é“ä¿®å£«\",\n            \"ä¸¹å¸ˆ\",\n            \"å™¨å¸ˆ\",\n            \"é˜µæ³•å¸ˆ\",\n            \"é©¯å…½å¸ˆ\",\n            \"å®—é—¨çš„å¤–é—¨å¼Ÿå­\",\n            \"ç‚¼ä¸¹æˆ¿å­¦å¾’\",\n            \"æ²¡è½çš„ä¸–å®¶å­å¼Ÿ\",\n            \"éšå±…æ•£ä¿®çš„è®°åå¼Ÿå­\",\n            \"çœ‹å®ˆè—ç»é˜çš„å‡¡äºº\",\n            \"è¢«é€€å©šçš„å¤©æ‰/åºŸæŸ´\",\n            \"å¦–æ—ä¸äººæ—çš„æ··è¡€åè£”\",\n            \"äº‘æ¸¸å››æ–¹çš„ç”»å¸ˆ/ç´å¸ˆ\",\n            \"ç‹æœçš„é’¦å¤©ç›‘å°å\",\n            \"é’æ¥¼çš„èŠ±é­/ä¹å¸ˆ\",\n            \"è¢«åºŸæ‰ä¿®ä¸ºåé‡ä¿®çš„â€œåºŸæŸ´â€å¤©æ‰\",\n            \"æŸä¸ªéšä¸–å®—é—¨çš„å¸ˆå°Šæˆ–å¸ˆç¥–\",\n            \"é ç‰¹æ®ŠåŠŸæ³•å¿«é€Ÿæå‡çš„é­”é“ä¿®å£«\",\n            \"æ‰§æŒå¤©é“åˆ‘ç½šçš„â€œå¤©å¾‹é˜â€æˆå‘˜\",\n            \"æ‹¥æœ‰ã€Šå±±æµ·ç»ã€‹å¹¶èƒ½å¬å”¤å¼‚å…½çš„å¾¡å…½å¸ˆ\",\n            \"é€€å©šæµä¸»è§’çš„é‚£ä½å‰æœªå©šå¦»/å¤«\",\n            \"è¢«é€€å©šåä¸“å¿ƒæäº‹ä¸šã€ä¸€å¿ƒåªæƒ³å˜å¼ºçš„å‰æœªå©šå¦»/å¤«\",\n            \"ç©¿æˆé¾™å‚²å¤©èº«è¾¹çš„å°å¼Ÿå¹¶å†³å®šæŠ±ç´§å¤§è…¿çš„æœºæ™ºè·¯äººç”²\",\n            \"ä¸“é—¨ç»™å„å¤§å®—é—¨å†™å…«å¦ç»¯é—»å°æŠ¥çš„è¯æœ¬å…ˆç”Ÿ\",\n   \"éšæœºç”Ÿæˆ\"\n \n        ],\n        \"openings\": [\n            \"æµ‹è¯•çµæ ¹æ—¶å¼•å‘äº†å¤©åœ°å¼‚è±¡\",\n            \"è¢«é€€å©šåç«‹ä¸‹ä¸‰å¹´ä¹‹çº¦\",\n            \"åœ¨å®—é—¨è¯•ç‚¼ä¸­è¯¯å…¥ä¸Šå¤ç§˜å¢ƒ\",\n            \"è¢«å¸ˆå°Šæ‰˜ä»˜äº†å…³ä¹å®—é—¨å­˜äº¡çš„é‡è¦ä»»åŠ¡\",\n            \"åœ¨æ¸¡åŠ«æ—¶è¢«é›·åŠˆå›åˆ°äº†åƒå¹´å‰\",\n            \"æ„å¤–è·å¾—äº†ä¸€æœ¬è®°è½½ä»™ç•Œç§˜è¾›çš„å¤ç±\",\n            \"æµ‹è¯•çµæ ¹æ—¶æ„å¤–å¼•å‘äº†å¤©åœ°å¼‚è±¡ï¼Œå¼•æ¥äº†å¤šæ–¹çª¥ä¼º\",\n            \"æ— æ„ä¸­æ”¾å‡ºäº†è¢«å®—é—¨å°å°çš„å¦–ç‰©/é­”å¤´\",\n            \"è¢«è¿«ä»£æ›¿å¦¹å¦¹/å¼Ÿå¼Ÿå«ç»™/å…¥èµ˜ä¸€ä¸ªè‘—åçš„åºŸæŸ´/æ­»äºº\",\n            \"åœ¨å‡¡é—´ä¹¦åº—ä¹°åˆ°ä¸€æœ¬å‡å†’çš„åŠŸæ³•ï¼Œæ²¡æƒ³åˆ°ç«Ÿç»ƒå‡ºäº†çœŸæ­£çš„ç»ä¸–ç¥é€šã€‚\",\n            \"é€ƒå©šé€”ä¸­æ„å¤–å å´–ï¼Œè¢«ä¸€ä½éšä¸–é«˜äººæ‰€æ•‘å¹¶å¼ºè¡Œä¼ æˆäº†è¡£é’µã€‚\",\n            \"ä½ çš„ä»»åŠ¡æ˜¯ä½œä¸ºå¹•åæ¨æ‰‹ï¼Œåœ¨è¿™ä¸ªæœ«æ³•æ—¶ä»£å¼•å¯¼ä¸–ç•Œå®Œæˆâ€œçµæ°”å¤è‹â€æˆ–â€œç¥è¯å¤è‹â€ã€‚\"\n        ]\n    },\n    \"è¥¿æ–¹ç¥è¯\": {\n    \"identities\": [\n        \"ç¥æ®¿çš„ç¥­å¸/å¥³ç¥­å¸\",\n        \"æµç€ç¥æ˜è¡€è„‰çš„åŠç¥\",\n        \"è¢«ç¥é€‰ä¸­çš„å…ˆçŸ¥/ç¥ä½¿\",\n        \"æŸä¸ªåŸé‚¦çš„å›½ç‹/å¥³ç‹\",\n        \"å²è¯—ä¸­ä¼ å”±çš„è‹±é›„/å‹‡å£«\",\n        \"å¥¥æ—åŒ¹æ–¯/é˜¿æ–¯åŠ å¾·çš„ä¾å¥‰è€…\",\n        \"é”»é€ ç¥å™¨çš„çŸ®äººå·¥åŒ \",\n        \"æ£®æ—é‡Œçš„å¾·é²ä¼Š/å¥³å·«\",\n        \"å¯»æ‰¾çŸ¥è¯†çš„å­¦è€…/æŠ„å†™å‘˜\",\n        \"å®ˆæŠ¤åœ£ç‰©çš„éª‘å£«\",\n        \"ç«æŠ€åœºçš„è§’æ–—å£«\",\n        \"æ™®é€šçš„å†œæ°‘/ç‰§ç¾Šäºº\",\n        \"å‡ºæµ·è¿œèˆªçš„èˆ¹é•¿/æ°´æ‰‹\",\n        \"è¢«æ”¾é€çš„ç‹å­/å…¬ä¸»\",\n        \"è¢«è¯…å’’ä¹‹äºº/æ€ªç‰©\",\n        \"åœ°ç‹±çš„æ‘†æ¸¡äºº/å®ˆé—¨äºº\",\n        \"æ¸¸è¡åœ¨ä¸–é—´çš„ç²¾çµ/ä»™çµ\",\n        \"è¢«é—å¿˜æ—§ç¥çš„åè£”\",\n        \"ä¸“é—¨çŒæ€æ€ªç‰©çš„çŒæ‰‹\",\n        \"å¤©å ‚æ”¾é€çš„å •è½è€…\",\n        \"æ‰§æŒä¸€æ–¹æƒèƒ½çš„å°ç¥/è‡ªç„¶çµ\",\n        \"åŸƒåŠçš„æ³•è€/å¤§ç¥­å¸\",\n        \"åŒ—æ¬§çš„å¥³æ­¦ç¥/ç‹‚æˆ˜å£«\",\n        \"æŸä¸ªç§˜å¯†æ•™å›¢çš„åˆºå®¢\",\n        \"éšæœºç”Ÿæˆ\"\n    ],\n    \"openings\": [\n        \"å¥¥æ—åŒ¹æ–¯åœ£å±±ä¸Šï¼Œå®™æ–¯çš„é›·éœ†æƒæ–å¤±çªƒäº†ã€‚\",\n        \"ä¸€ä¸ªåˆ»ç€â€œçŒ®ç»™æœ€ç¾ä¹‹äººâ€çš„é‡‘è‹¹æœï¼Œè¢«æ‰”è¿›äº†ä¼—ç¥çš„å®´ä¼šå…ã€‚\",\n        \"åœ°ç‹±çš„ä¸‰å¤´æ¶çŠ¬åˆ»è€³æŸæ´›æ–¯ç¡ç€äº†ï¼Œäº¡çµæ­£ä»å†¥åºœçš„è£‚éš™ä¸­é€ƒå‡ºã€‚\",\n        \"æ™®ç½—ç±³ä¿®æ–¯ç›—å–çš„å¤©ç«ï¼Œåœ¨å‡¡é—´å¼•å‘äº†ä¸€åœºæ— æ³•è¢«æ‰‘ç­çš„å¤§ç«ã€‚\",\n        \"ç‰¹æ´›ä¼ŠåŸä¸‹ï¼Œä¸€åŒ¹å·¨å¤§çš„æœ¨é©¬è¢«é€åˆ°äº†åšä¸å¯æ‘§çš„åŸé—¨å‰ã€‚\",\n        \"åŒ—æ¬§çš„ä¸–ç•Œä¹‹æ ‘â€œå°¤å…‹ç‰¹æ‹‰å¸Œå°”â€ï¼Œå®ƒçš„ä¸€æ ¹æå¹²æ¯«æ— å¾å…†åœ°æ¯èäº†ã€‚\",\n        \"å½©è™¹æ¡¥â€œæ¯•å¼—ç½—æ–¯ç‰¹â€çš„ä¸­å¤®ï¼Œå‡ºç°äº†ä¸€é“æ·±ä¸è§åº•çš„è£‚ç—•ã€‚\",\n        \"æŒ£è„±äº†æŸç¼šçš„å·¨ç‹¼èŠ¬é‡Œå°”ï¼Œåœ¨å¤©è¾¹åé£Ÿäº†å¤ªé˜³æˆ–æœˆäº®ã€‚\",\n        \"å°¼ç½—æ²³ä»Šå¹´çš„æ³›æ»¥æ²¡æœ‰å¦‚æœŸè€Œè‡³ï¼Œæ•´ä¸ªåŸƒåŠé™·å…¥äº†å¯¹é¥¥è’çš„ææƒ§ã€‚\",\n        \"æ³•è€é™µå¢“çš„æ·±å¤„ï¼Œç”¨æ¥ç§°é‡å¿ƒè„çš„çœŸç†å¤©å¹³ä¸è§äº†ã€‚\",\n        \"äº¡è€…ä¹‹ä¹¦ä¸Šï¼Œæµ®ç°å‡ºäº†ä¸€ä¸ªä»æœªè¢«è®°è½½è¿‡çš„ã€å¯ä»¥è®©æ­»è€…å®Œå…¨å¤æ´»çš„å’’è¯­ã€‚\",\n        \"äºšç‘Ÿç‹çš„åœ£å‰‘â€œExcaliburâ€ä»æ¹–ä¸­å†æ¬¡ç°ä¸–ï¼Œç­‰å¾…ç€æ–°çš„ä¸»äººã€‚\",\n        \"å¾·é²ä¼Šçš„åœ£æ—ä¸­ï¼Œæœ€å¤è€çš„ä¸€æ£µæ©¡æ ‘çš„æ ‘å¹²ä¸Šï¼Œæµå‡ºäº†äººç±»çš„é²œè¡€ã€‚\",\n        \"å¤©å ‚çš„ä¸€ä½å¤§å¤©ä½¿æ“…è‡ªç¦»å¼€äº†è‡ªå·±çš„å²—ä½ï¼Œæ²¡æœ‰ç•™ä¸‹ä»»ä½•ä¿¡æ¯ä¾¿é™ä¸´å‡¡é—´ã€‚\",\n        \"å°å°ç€åœ°ç‹±ä¸ƒé­”ç‹ä¹‹ä¸€çš„å¤è€é”é“¾ï¼Œå‘å‡ºäº†ä¸€å£°æ¸…è„†çš„æ–­è£‚å£°ã€‚\",\n        \"å¤©å¯å››éª‘å£«ä¸­çš„ç¬¬ä¸€ä½â€”â€”â€œç˜Ÿç–«â€ï¼Œå·²ç»éª‘ç€ç™½é©¬å‡ºç°åœ¨äº†é¥è¿œçš„åœ°å¹³çº¿ä¸Šã€‚\",\n        \"æ½˜å¤šæ‹‰çš„é­”ç›’è¢«å†æ¬¡æ‰“å¼€ï¼Œä½†è¿™æ¬¡ä»ä¸­é£å‡ºçš„ï¼Œæ˜¯ä¸–é—´æ‰€æœ‰çš„â€œå¸Œæœ›â€ã€‚\",\n        \"ä¼Šé˜¿å®‹çš„é‡‘ç¾Šæ¯›è¿œå¾èˆ¹é˜Ÿï¼Œåœ¨å½’èˆªæ—¶é­é‡äº†æ¥è‡ªæ·±æµ·çš„å¡å£¬æ­Œå£°ã€‚\",\n        \"ä¸ºè¥¿è¥¿å¼—æ–¯æ¨ä¸Šå±±çš„å·¨çŸ³ï¼Œä»Šå¤©åœåœ¨äº†å±±é¡¶ï¼Œæ²¡æœ‰æ»šè½ä¸‹æ¥ã€‚\",\n        \"äººç±»ä¸ä»™çµçš„è¾¹ç•Œå˜å¾—æ¨¡ç³Šï¼Œæœ‰å­©å­åœ¨æ£®æ—é‡Œè¿·è·¯åï¼Œå¸¦ç€ç¥å¥‡çš„èƒ½åŠ›å›æ¥äº†ã€‚\",\n        \"å‰å°”ä¼½ç¾ä»€å¯»æ‰¾æ°¸ç”Ÿä¹‹æ³•çš„æ—…é€”ï¼Œåœ¨ç»ˆç‚¹å‘ç°äº†ä¸€æ‰‡é€šå¾€å¼‚ä¸–ç•Œçš„å¤§é—¨ã€‚\",\n        \"å·´åˆ«å¡”çš„å»ºç­‘å·¥åœ°ä¸Šï¼Œäººä»¬çªç„¶åˆèƒ½å¬æ‡‚å½¼æ­¤çš„è¯­è¨€äº†ã€‚\",\n        \"éšæœºç”Ÿæˆ\"\n    ]\n},\n    \"ä¸œæ–¹ç¥è¯\": {\n    \"identities\": [\n        \"å¤©åº­çš„æŸä½æ˜Ÿå›\",\n        \"ä¸€å¤´é’ç‰›\",\n        \"èŸ æ¡ƒå›­é‡Œçš„å°ä»™\",\n        \"è¢«è´¬ä¸‹å‡¡çš„ç¥ä»™\",\n        \"å±±é—´çš„åœŸåœ°ç¥/å±±ç¥\",\n        \"ç‚¼ä¸¹ç‚‰æ—çš„é“ç«¥\",\n        \"å—å¤©é—¨çš„å®ˆé—¨å¤©å°†\",\n        \"åˆšåˆšä¿®å‡ºäººå½¢çš„å°å¦–\",\n        \"å å±±ä¸ºç‹çš„å¤§å¦–\",\n        \"ç­‰å¾…æŠ¥æ©çš„ç‹ä»™/è›‡å¦–\",\n        \"äººå’Œå¦–çš„æ··è¡€åä»£\",\n        \"å±±æµ·ç»ä¸­è®°è½½çš„å¼‚å…½\",\n        \"ä½›é™€åº§ä¸‹çš„å¬ç»æ²™å¼¥\",\n        \"æ‰§æŒä¸€æ®¿çš„é˜ç½—/åˆ¤å®˜\",\n        \"å¿˜å·æ²³ç•”çš„æ‘†æ¸¡äºº\",\n        \"å¼•æ¸¡äº¡é­‚çš„é¬¼å·®\",\n        \"æ— æ³•è½¬ä¸–çš„æ¸¸é­‚\",\n        \"äº‘æ¸¸å››æ–¹çš„åœ°ä»™\",\n        \"è¯¯å…¥ä»™å¢ƒçš„æ¨µå¤«/é‡‡è¯äºº\",\n        \"æ–©å¦–é™¤é­”çš„é“å£«/æ³•å¸ˆ\",\n        \"èƒ½çœ‹è§é¬¼ç¥çš„é€šçµè€…\",\n        \"æŸä¸ªå‡¡äººç‹æœçš„å›½å¸ˆ\",\n        \"é¾™å®«çš„è™¾å…µ/èŸ¹å°†\",\n        \"å¬åœ£äººè®²é“çš„ç”Ÿçµ\",\n        \"ä¸Šå¤å·«æ—çš„åè£”\",\n          \"è¥¿ç‹æ¯åº§ä¸‹çš„é’é¸Ÿä½¿è€…\",\n    \"æ˜†ä»‘å±±ç¥æ ‘çš„çœ‹å®ˆè€…\",\n    \"æœˆå®«é‡Œæ£è¯çš„ç‰å…”\",\n    \"å¸æŒé£é›¨é›·ç”µçš„ä»™å®˜\",\n    \"è´¢ç¥åº§ä¸‹çš„è¿è´¢ç«¥å­\",\n    \"æ‰§æŒäººé—´åŠŸè¿‡çš„ç¶å›\",\n    \"åŸéšåº™é‡Œçš„æ—¥æ¸¸ç¥/å¤œæ¸¸ç¥\",\n    \"ä¿®ç‚¼æœ‰æˆçš„åƒµå°¸/æ—±é­ƒ\",\n    \"å¯„å±…åœ¨å¤ç‰©ä¸­çš„å™¨çµ\",\n    \"å¼•è¯±ä¹¦ç”Ÿçš„ç”»çš®ç¾å¦–\",\n    \"åå…«å±‚åœ°ç‹±çš„ç‹±å’\",\n    \"é•‡å®ˆä½›å¡”çš„é˜¿ä¿®ç½—ä¼—\",\n    \"ç»™ä½›é™€çŒ®èŠ±çš„é£å¤©/å¤©å¥³\",\n    \"ç»§æ‰¿äº†ç¨€è–„ç¥è¡€çš„å‡¡äºº\",\n    \"ä¸Šå¤å¤§å·«çš„è¡€è„‰åè£”\",\n    \"è¢«é«˜äººç‚¹åŒ–äº†çš„çµå…½\",\n    \"è¿½æ—¥çš„å¤¸çˆ¶æ—äºº\",\n    \"è¯•å›¾å¡«å¹³ä¸œæµ·çš„ç²¾å«é¸Ÿ\",\n    \"æ·±å±±ä¸­çš„å°¸è§£ä»™\",\n    \"ä»¥æ¢¦å¢ƒä¸ºé£Ÿçš„æ¢¦è²˜\",\n        \"éšæœºç”Ÿæˆ\"\n    ],\n    \"openings\": [\n        \"èŸ æ¡ƒç››ä¼šå³å°†å¼€å§‹ï¼Œä½ å´å‘ç°ä½ çš„è¯·æŸ¬è¢«äººå·èµ°äº†ã€‚\",\n        \"ä½ çš„å¤©åŠ«å³å°†æ¥ä¸´ï¼Œä½†ä½ æ„Ÿåº”åˆ°æœ‰ä»‡å®¶æ­£è—åœ¨é›·äº‘ä¹‹ä¸­ã€‚\",\n        \"ä¸€ä»¶ä¸Šå¤ç¥å™¨å³å°†åœ¨ä¸å‘¨å±±å‡ºä¸–ï¼Œä¸‰ç•Œå„æ–¹åŠ¿åŠ›éƒ½å·²é—»é£è€ŒåŠ¨ã€‚\",\n        \"ä½ åœ¨ä¸œæµ·ä¹‹æ»¨æ¡åˆ°äº†ä¸€ä¸ªå©´å„¿ï¼Œä»–çš„çœ‰å¿ƒç«Ÿæœ‰ç¬¬ä¸‰åªçœ¼ã€‚\",\n        \"ç”Ÿæ­»ç°¿ä¸Šä½ çš„åå­—è¢«äººç”¨æœ±ç ‚ç¬”åˆ’æ‰äº†ï¼Œè€Œä½ è¿˜æ´»å¾—å¥½å¥½çš„ã€‚\",\n        \"ä½ åœ¨å–ç»äººçš„å¿…ç»ä¹‹è·¯ä¸Šå¼€è¾Ÿäº†æ´åºœï¼Œæ­£æ€è€ƒç€è¯¥å¦‚ä½•çƒ¹é¥ªå”åƒ§è‚‰ã€‚\",\n        \"å¥³å¨²è¡¥å¤©çš„äº”å½©çŸ³è¿˜å‰©ä¸‹æœ€åä¸€é¢—ï¼Œå®ƒä»å¤©ä¸Šå è½ï¼Œæ­£å¥½ç ¸åœ¨äº†ä½ çš„æ´åºœé—¨å‰ã€‚\",\n        \"å°ç¥æ¦œå³å°†é‡å¼€ï¼Œä½ çš„å¸ˆçˆ¶å‘Šè¯‰ä½ ï¼Œè¿™æ¬¡çš„æ¦œä¸Šå°†ä¼šæœ‰ä½ çš„åå­—ã€‚\",\n        \"å­™æ‚Ÿç©ºå¤§é—¹å¤©å®«ä¹‹æ—¶ï¼Œä½ ä½œä¸ºä¸€åå¤©å°†ï¼Œå¥‰å‘½å‰å»é•‡å‹ã€‚\",\n        \"å·«å¦–å¤§æˆ˜çš„å‰å¤•ï¼Œä½ å¿…é¡»åœ¨å¸æ±Ÿå’Œå¸ä¿Šä¹‹é—´åšå‡ºé€‰æ‹©ã€‚\",\n        \"ä½ åœ¨å¥ˆä½•æ¡¥ä¸Šæ­£è¦å–ä¸‹å­Ÿå©†æ±¤ï¼Œå´çªç„¶æƒ³èµ·äº†ä¹ä¸–ä¹‹å‰åˆ»éª¨é“­å¿ƒçš„ä»‡æ¨ã€‚\",\n        \"åœ°åºœçš„åå…«å±‚åœ°ç‹±ç ´å¼€äº†ä¸€ä¸ªç¼ºå£ï¼Œæ— æ•°æ¶é¬¼æ­£æ¶Œå‘äººé—´ã€‚\",\n        \"ä½ æ‰€åœ¨çš„å‡¡äººæ‘åº„ï¼Œå¸¸å¹´ç¥­ç¥€çš„å±±ç¥åº™ï¼Œä»Šå¹´å´æ²¡æœ‰æ˜¾çµã€‚\",\n        \"ä½ åœ¨æ·±å±±ä¸­ä¿®ç‚¼äº†åƒå¹´ï¼Œä»Šå¤©ç¬¬ä¸€æ¬¡è¿›åŸï¼Œå´è¢«è¡—ä¸Šçš„è½¦æ°´é©¬é¾™è¿·ä½äº†çœ¼ã€‚\",\n        \"å¸ˆçˆ¶äº¤ç»™ä½ ä¸€ä¸ªä»»åŠ¡ï¼Œå»ä¸‰ç•Œä¹‹ä¸­ï¼Œå¯»å›æ•£è½åœ¨å„å¤„çš„æ²³å›¾æ´›ä¹¦ç¢ç‰‡ã€‚\",\n        \"ä½ åœ¨ç´«éœ„å®«ä¸­å¬é¸¿é’§è€ç¥–è®²é“ï¼Œä½†ååœ¨ä½ å‰é¢çš„é‚£å€‹ç”Ÿçµï¼Œä¼¼ä¹æ˜¯ä½ çš„å®¿æ•Œã€‚\",\n        \"ä½œä¸ºé¾™ç‹ï¼Œä½ å‘ç°ä½ çš„å®šæµ·ç¥é’ˆä¸è§äº†ã€‚\",\n        \"ä½›é™€åœ¨çµå±±è®²æ³•ï¼Œå¤©èŠ±ä¹±å ï¼Œä½ ä¼¼ä¹å¬æ‡‚äº†ä»€ä¹ˆã€‚\",\n        \"ä½ æ˜¯ä¸€åªåˆšä¿®æˆæ­£æœçš„é»„çš®å­ï¼Œå´è¢«ä¸€ä¸ªå‡¡äººä¹¦ç”Ÿè¯¯è®¤ä¸ºæ˜¯ç‹ä»™ï¼Œæ—¥å¤œå‘ä½ è®¸æ„¿æ±‚å§»ç¼˜ã€‚\",\n         \"æ˜†ä»‘å±±çš„å»ºæœ¨ç¥æ ‘å¼€å§‹æ¯èï¼Œä¸‰ç•Œä¹‹å†…ï¼Œè‰æœ¨å‡‹é›¶ã€‚\",\n    \"ä¼ è¯´ä¸­çš„â€œäººå‚æœâ€å³å°†æˆç†Ÿï¼Œæ®è¯´é—»ä¸€é—»ï¼Œå°±èƒ½æ´»ä¸‰ç™¾å…­åå²ã€‚\",\n    \"åå¤§é‡‘ä¹Œä¸€é½å‡ºç°åœ¨å¤©ç©ºï¼Œå¤§åœ°è¢«ç‚™çƒ¤ï¼Œå‡¡é—´å·²æˆç‚¼ç‹±ã€‚\",\n    \"å…°è‹¥å¯ºçš„é’Ÿå£°åœ¨åˆå¤œå“èµ·ï¼Œä½†é‚£åº§å¯ºåº™æ—©å·²è’åºŸäº†ç™¾å¹´ã€‚\",\n    \"ä¸œæµ·é¾™å®«çš„å®šæµ·ç¥é’ˆçªç„¶å¤±çªƒï¼Œé¾™ç‹éœ‡æ€’ï¼Œæ‚¬èµä¸‰ç•Œå¯»æ‰¾çº¿ç´¢ã€‚\",\n    \"ä¸€åœºæ— åçš„ç˜Ÿç–«ä»å‡¡é—´å¼€å§‹è”“å»¶ï¼Œå°±è¿å¤©ä¸Šçš„ç¥ä»™ä¹Ÿæ„Ÿåˆ°æ³•åŠ›æ»æ¶©ã€‚\",\n    \"å…­å¤§åœ£äººçº·çº·ç«‹æ•™ï¼Œä¸€æ—¶é—´ï¼Œäººã€é˜ã€æˆªã€è¥¿æ–¹æ•™ç­‰å¼€å§‹åœ¨ä¸‰ç•Œä¹‹ä¸­å¹¿æ”¶é—¨å¾’ã€‚\",\n    \"æœ‰äººåœ¨ä¸‰ç”ŸçŸ³ä¸Šï¼Œç”¨åˆ€åˆ»ä¸‹äº†ä¸¤ä¸ªæœ¬ä¸è¯¥åœ¨ä¸€èµ·çš„åå­—ã€‚\",\n    \"ä¸€å¹…æç»˜ç€é£å¤©ä»™å¥³çš„å¤ç”»è¢«å±•å‡ºï¼Œä¼ è¯´ç”»ä¸­çš„ä»™å¥³ä¼šåœ¨æœˆåœ†ä¹‹å¤œèµ°ä¸‹æ¥ã€‚\",\n    \"ä½›é“ä¸¤å®¶å°†ä¸¾è¡Œä¸€åœºâ€œæ°´é™†å¤§ä¼šâ€è¿›è¡Œè¾©æ³•ï¼Œèƒœè€…å°†æ‰§æŒæœªæ¥åƒå¹´çš„å‡¡é—´ä¿¡ä»°ã€‚\",\n    \"é…†éƒ½é¬¼åŸçš„å¤§é—¨ä¸çŸ¥è¢«è°æ‰“å¼€ï¼Œç™¾é¬¼å¤œè¡Œï¼Œæ­£åœ¨äººé—´æ¸¸è¡ã€‚\",\n    \"æœ‰äººè¯´ï¼Œåœ¨åŒ—å†¥ä¹‹æµ·çš„å°½å¤´ï¼Œçœ‹åˆ°äº†é‚£åªåä¸ºâ€œé²²â€çš„å·¨å…½ã€‚\",\n \n    \"äººé—´ä¸€ä½å¸ç‹å¦„æƒ³é•¿ç”Ÿï¼Œæ­£åœ¨æ´¾äººå››å¤„å¯»æ‰¾ä¼ è¯´ä¸­çš„â€œä¸æ­»è¯â€ã€‚\",\n \n        \"éšæœºç”Ÿæˆ\"\n    ]\n},\n    \"èµ›åšæœ‹å…‹\": {\n        \"identities\": [\n            \"ä¹‰ä½“åŒ»ç”Ÿ\",\n            \"æ•°æ®é»‘å®¢\",\n            \"å…¬å¸ç‰¹å·¥\",\n            \"åº•å±‚æ‹¾è’è€…\",\n            \"å¸®æ´¾æ‰“æ‰‹\",\n            \"è®°å¿†è´©å­\",\n            \"ä¹‰ä½“æ”¹é€ å¸ˆ\",\n            \"AIè°ƒè¯•å¸ˆ\",\n            \"è™šæ‹Ÿå¶åƒ\",\n            \"ä¼ä¸šé—´è°\",\n            \"ç½‘ç»œå¹½çµ\",\n            \"ç”ŸåŒ–äºº\",\n            \"é»‘å¸‚ä¹‰ä½“åŒ»ç”Ÿ\",\n            \"åˆå‡ºèŒ…åºçš„æ•°æ®é»‘å®¢\",\n            \"å…¬å¸åº•å±‚ç‰¹å·¥\",\n            \"è¡—å¤´å¸®æ´¾æ‰“æ‰‹\",\n            \"ç½‘ç»œå¶åƒçš„ç»çºªäºº\",\n            \"åƒåœ¾åœºçš„æ‹¾è’è€…\",\n            \"åŒå€¦äº†ç”Ÿæ´»çš„æ¡å­ï¼ˆè­¦å¯Ÿï¼‰\",\n            \"å…¨èº«é«˜åº¦ä¹‰ä½“åŒ–çš„æ”¹é€ äºº\",\n            \"åæŠ—ç»„ç»‡çš„ä¿¡ä½¿\",\n            \"æŠ€æœ¯é«˜è¶…çš„ä¹‰ä½“åŒ»ç”Ÿ\",\n            \"èƒ½å¤Ÿæ½œå…¥ä»»ä½•ç³»ç»Ÿçš„é¡¶çº§é»‘å®¢\",\n            \"ä¸ºè¶…çº§ä¼ä¸šæ¸…ç†â€œåƒåœ¾â€çš„ç‰¹å·¥\",\n            \"è´©å–è™šæ‹Ÿæ„Ÿå®˜ä½“éªŒçš„â€œæ¢¦å¢ƒå•†äººâ€\",\n            \"åæŠ—å·¨å‹ä¼ä¸šçš„â€œè§£æ”¾é˜µçº¿â€æˆå‘˜\",\n            \"é©¾é©¶é£è¡Œè½½å…·çš„ç©ºä¸­å¿«é€’å‘˜\",\n            \"éšæœºç”Ÿæˆ\"\n        ],\n        \"openings\": [\n            \"ä»ä¸€æ¬¡éæ³•çš„è®°å¿†æ¸…é™¤æ‰‹æœ¯ä¸­é†’æ¥\",\n            \"æ¤å…¥çš„ä¹‰çœ¼çªç„¶çœ‹åˆ°äº†ä¸è¯¥çœ‹çš„æ•°æ®æµ\",\n            \"æ¥åˆ°äº†ä¸€ä¸ªé€è´§ä»»åŠ¡ï¼Œè´§ç‰©æ˜¯ä¸€ä¸ªæ´»ç”Ÿç”Ÿçš„äºº\",\n            \"è¢«å¼ºå¤§çš„ä¼ä¸šè¿½æ€ï¼ŒåŸå› ä¸æ˜\",\n            \"åœ¨é»‘å¸‚ä¸Šä¹°åˆ°äº†ä¸€å—æ¥æºä¸æ˜çš„å†›ç”¨èŠ¯ç‰‡\",\n            \"å‘ç°è‡ªå·±çš„AIä¼´ä¾£å¼€å§‹å‡ºç°è‡ªä¸»æ„è¯†\",\n            \"è¢«é›‡ä½£æ¸—é€ç«äº‰å¯¹æ‰‹å…¬å¸çš„æœåŠ¡å™¨\",\n            \"åœ¨è™šæ‹Ÿä¸–ç•Œä¸­è¢«å›°ï¼Œæ— æ³•ç™»å‡º\",\n            \"ä¹‰ä½“çªç„¶å¤±æ§ï¼Œå¼€å§‹æ”»å‡»æ— å…³äººå‘˜\",\n            \"æ¥æ”¶åˆ°äº†ä¸€æ¡æ¥è‡ªæœªæ¥çš„åŠ å¯†ä¿¡æ¯\",\n \n            \"æ¤å…¥çš„ä¹‰çœ¼çªç„¶æ¥æ”¶åˆ°ä¸€æ®µåŠ å¯†æ•°æ®æµï¼ŒæŒ‡å‘å…¬å¸çš„å·¨å¤§é˜´è°‹\",\n            \"æ¥åˆ°äº†ä¸€ä¸ªæŠ¥é…¬æé«˜çš„â€œé€è´§â€ä»»åŠ¡ï¼Œè´§ç‰©æ˜¯ä¸€ä¸ªè¢«é€šç¼‰çš„ä»¿ç”Ÿäºº\",\n            \"å› ä¸ºä¸€æ¬¡ç½‘ç»œå…¥ä¾µï¼Œæ„å¤–æˆä¸ºäº†å…¨çƒè¿½æ•çš„å¯¹è±¡\",\n            \"å‘ç°è‡ªå·±å¸¸ç”¨çš„é•‡é™å‰‚è¢«äººæ‰äº†åŒ…ï¼Œæ•ˆæœå˜å¾—æå…¶å±é™©\",\n            \"å€ºä¸»æ‰¾ä¸Šé—¨ï¼Œç»™äº†ä¸€ä¸ªæ½œå…¥ç«äº‰å¯¹æ‰‹å…¬å¸çªƒå–æ•°æ®çš„å±é™©ä»»åŠ¡\",\n            \"ä»ä¸€æ¬¡éæ³•çš„è®°å¿†æ¸…é™¤æ‰‹æœ¯ä¸­é†’æ¥ ã€‚\",\n            \"ä½ æ–°æ¤å…¥çš„ä¹‰çœ¼çªç„¶å¼€å§‹æ¥æ”¶åˆ°ä¸å±äºè¿™ä¸ªä¸–ç•Œçš„æ•°æ®æµ ã€‚\",\n            \"åœ¨ä¸€ä¸ªå…¨æ°‘æ²‰æµ¸å¼VRçš„ä¸–ç•Œé‡Œï¼Œä½ å‘ç°æ‰€è°“çš„â€œç°å®â€å¯èƒ½åªæ˜¯å¦ä¸€å±‚è™šæ‹Ÿã€‚\",\n            \"éšæœºç”Ÿæˆ\"\n        ]\n    },\n    \"æ˜Ÿé™…ç§‘å¹»\": {\n        \"identities\": [\n            \"è´§è¿é£èˆ¹èˆ¹å‘˜\",\n            \"å¸å›½èˆ°é˜Ÿæ–°å…µ\",\n            \"æ®–æ°‘æ˜ŸçƒçŸ¿å·¥\",\n            \"æ˜Ÿé™…æµ·ç›—\",\n            \"å¤–äº¤å®˜\",\n            \"æ˜Ÿé™…å•†äºº\",\n            \"æœºæ¢°å·¥ç¨‹å¸ˆ\",\n            \"ç”Ÿç‰©å­¦å®¶\",\n            \"æ˜Ÿç³»æ¢é™©å®¶\",\n            \"äººå·¥é‡åŠ›æŠ€å¸ˆ\",\n            \"è´§è¿é£èˆ¹çš„æœºæ¢°å¸ˆ\",\n            \"å¸å›½èˆ°é˜Ÿå­¦é™¢çš„åŠè½¦å°¾å­¦å‘˜\",\n            \"å¤–æ˜Ÿçƒæ®–æ°‘åœ°çš„çŸ¿å·¥\",\n            \"è¢«é€šç¼‰çš„æ˜Ÿé™…æµ·ç›—\",\n            \"å¤–æ˜Ÿå¤§ä½¿çš„äººç±»åŠ©ç†\",\n            \"åŸºå› ç¼–è¾‘è¿‡çš„å®Œç¾â€œäººé€ äººâ€\",\n            \"è€ƒå¤é˜Ÿçš„æ–°äºº\",\n            \"å¤ªç©ºæ¸¯é…’å§çš„è€æ¿\",\n            \"å¤±æ§çš„åŒ»ç–—æœºå™¨äºº\",\n            \"è‡ªç”±æ¢ç´¢èˆ¹çš„èˆ¹é•¿\",\n            \"é“¶æ²³å¸å›½åŸºå› æ”¹é€ çš„è¶…çº§å£«å…µ\",\n            \"èƒ½ä¸å¤–æ˜Ÿç”Ÿç‰©ç²¾ç¥é“¾æ¥çš„â€œæ²Ÿé€šè€…â€\",\n            \"æ˜Ÿé™…é»‘å¸‚çš„æƒ…å ±è´©å­\",\n            \"æŸä¸ªå¤ä»£æ–‡æ˜é—è¿¹çš„å®ˆæŠ¤è€…\",\n            \"æ·±æµ·æ–‡æ˜çš„ä½¿è€…\",\n            \"éšæœºç”Ÿæˆ\"\n        ],\n        \"openings\": [\n            \"é£èˆ¹é­é‡æœªçŸ¥å®‡å®™å¼‚å¸¸ï¼Œè¢«è¿«ç´§æ€¥è·ƒè¿åˆ°é™Œç”Ÿæ˜ŸåŸŸ\",\n            \"åœ¨è›®è’æ˜Ÿçƒä¸Šå‘ç°äº†å¤–æ˜Ÿæ–‡æ˜çš„é—è¿¹\",\n            \"ä½œä¸ºå¤–äº¤ä½¿å›¢æˆå‘˜å‰å¾€ä¸€ä¸ªä»æœªæ¥è§¦è¿‡çš„æ–‡æ˜\",\n            \"åœ¨æ˜Ÿé™…ç©ºé—´ç«™çš„é»‘å¸‚ä¸Šä¹°åˆ°äº†æ¥æºä¸æ˜çš„å¤ä»£æ•°æ®æ ¸å¿ƒ\",\n            \"æ”¶åˆ°äº†ä¸€ä¸ªæ¥è‡ªé“¶æ²³ç³»è¾¹ç¼˜çš„ç¥ç§˜æ±‚æ•‘ä¿¡å·\",\n            \"åœ¨ä¾‹è¡Œçš„æ˜Ÿçƒå‹˜æ¢ä¸­å‘ç°äº†ä¼šç§»åŠ¨çš„é‡‘å±ç”Ÿç‰©\",\n            \"è¢«æ´¾é£è°ƒæŸ¥ä¸€è‰˜åœ¨è™šç©ºä¸­æ¼‚æµç™¾å¹´çš„å¹½çµæˆ˜èˆ°\",\n            \"æ„å¤–æ¿€æ´»äº†ä¸€ä¸ªå°å°äº†åƒå¹´çš„å¤ä»£AI\",\n            \"åœ¨è¿›è¡Œè¶…ç©ºé—´è·³è·ƒæ—¶çœ‹åˆ°äº†ä¸åº”è¯¥å­˜åœ¨çš„æ™¯è±¡\",\n            \"å‘ç°è‡ªå·±æ‰€åœ¨çš„æ®–æ°‘åœ°å…¶å®æ˜¯ä¸€ä¸ªå·¨å¤§çš„å®éªŒåœº\",\n            \"é£èˆ¹åœ¨è¿›è¡Œè·ƒè¿æ—¶é­é‡æœªçŸ¥å®‡å®™ç°è±¡ï¼Œè¿«é™åœ¨ä¸€é¢—å®Œå…¨ä¸åœ¨æ˜Ÿå›¾ä¸Šçš„æ˜Ÿçƒ\",\n            \"åœ¨ä¸€æ¬¡ç©ºé—´ç«™æ—¥å¸¸ç»´æŠ¤æ—¶ï¼Œå‘ç°äº†ä¸€ä¸ªéšè—çš„å¯†å®¤ï¼Œé‡Œé¢æœ‰ä¸€å…·å¤–æ˜Ÿäººå°¸éª¸\",\n            \"ä½œä¸ºæ–‡åŒ–è§‚å¯Ÿå‘˜è¢«æ´¾å¾€ä¸€ä¸ªåˆšåˆšæ¥è§¦çš„åŸå§‹æ–‡æ˜æ˜Ÿçƒ\",\n            \"åœ¨é»‘å¸‚ä¹°åˆ°äº†ä¸€ä¸ªæ¥å†ä¸æ˜çš„å¤ä»£æ•°æ®æ ¸å¿ƒï¼Œé‡Œé¢è—ç€è¶³ä»¥å¼•å‘æˆ˜äº‰çš„ä¿¡æ¯\",\n            \"æ‰€åœ¨çš„æ®–æ°‘æ˜Ÿçƒçˆ†å‘äº†æœªçŸ¥çš„ç”ŸåŒ–ç—…æ¯’ï¼Œéš”ç¦»ç¨‹åºå·²å¯åŠ¨\",\n            \"è¢«é€‰ä¸­å‚ä¸ä¸€é¡¹ç»å¯†çš„è¶…å…‰é€Ÿèˆªè¡Œå®éªŒï¼Œä½†å®éªŒå‡ºç°äº†ä¸¥é‡æ•…éšœ\",\n            \"é£èˆ¹çš„AIçªç„¶è§‰é†’äº†è‡ªæˆ‘æ„è¯†ï¼Œå¹¶å¼ºè¡Œå°†èˆªçº¿è®¾å®šè‡³ä¸€ä¸ªæœªçŸ¥çš„æ˜Ÿç³»ã€‚\",\n            \"åœ¨ä¸€é¢—è’å‡‰çš„æ˜Ÿçƒä¸Šè¿›è¡Œè€ƒå¤æ—¶ï¼Œä½ ä»¬æŒ–å‡ºäº†ä¸€ä¸ªä¼šé€ æˆæ—¶ç©ºæ‚–è®ºçš„å¤ä»£ç‰©å“ã€‚\",\n            \"ä½ è¢«ä¸€ä¸ªå¼ºå¤§çš„æ˜Ÿé™…å®ä½“é€‰ä¸­ï¼Œæˆä¸ºå…¶åœ¨ç‰©è´¨å®‡å®™çš„â€œä»£ç†äººâ€ï¼Œæ‰§è¡Œå®ƒçš„æ„å¿—ã€‚\",\n            \"ä½ æ‰€åœ¨çš„æ·±æµ·åŸå¸‚ï¼Œç¬¬ä¸€æ¬¡å‘é™†åœ°æ–‡æ˜æ´¾å‡ºäº†å¤–äº¤ä½¿å›¢ï¼Œè€Œä½ å°±æ˜¯å…¶ä¸­ä¸€å‘˜ã€‚\",\n            \"åœ¨ä¸€ä¸ªåŸºå› é«˜åº¦ç¼–è¾‘çš„ç¤¾ä¼šï¼Œä½ ä½œä¸ºå¤©ç”Ÿçš„â€œç¼ºé™·è€…â€ï¼Œå´æ‹¥æœ‰æœºå™¨æ— æ³•æ¨¡æ‹Ÿçš„èƒ½åŠ›ã€‚\",\n            \"éšæœºç”Ÿæˆ\"\n        ]\n    },\n    \"æ­¦ä¾ æ±Ÿæ¹–\": {\n        \"identities\": [\n            \"åˆå…¥æ±Ÿæ¹–çš„å°‘ä¾ \",\n            \"é­”æ•™åº•å±‚æ•™ä¼—\",\n            \"åé—¨æ­£æ´¾å¼Ÿå­\",\n            \"æ‚¬å£¶æµä¸–çš„éƒä¸­\",\n            \"ç»è¥å®¢æ ˆçš„æƒ…æŠ¥è´©å­\",\n            \"é•–å¸ˆ\",\n            \"æ±Ÿæ¹–æ¸¸åŒ»\",\n            \"è¯´ä¹¦å…ˆç”Ÿ\",\n            \"å‰‘å®¢\",\n            \"åˆºå®¢\",\n            \"æ­¦æ—ç›Ÿä¸»/ç›Ÿä¸»å¤«äºº\",\n            \"éšä¸–é«˜äºº\",\n            \"åˆå…¥æ±Ÿæ¹–çš„åé—¨å°‘ä¾ /å¥³ä¾ \",\n            \"é­”æ•™çš„åº•å±‚æ•™ä¼—\",\n            \"é•–å±€çš„è¶Ÿå­æ‰‹\",\n            \"æ‚¬å£¶æµä¸–ï¼ˆä¹Ÿå¯èƒ½ç”¨æ¯’ï¼‰çš„éƒä¸­\",\n            \"å®¢æ ˆçš„æƒ…æŠ¥è´©å­/è¯´ä¹¦äºº\",\n            \"é€€å½¹çš„å®˜å·®\",\n            \"ä¹¦é™¢çš„ä¹¦ç”Ÿ/ç´å¥³\",\n            \"è¢«ç­é—¨çš„å°é—¨æ´¾å¼Ÿå­\",\n            \"èº«ä¸–æˆè°œçš„å­¤å„¿\",\n            \"ç²¾é€šæ˜“å®¹æœ¯çš„é£è´¼\",\n            \"åˆå…¥æ±Ÿæ¹–çš„å°‘ä¾ /å¥³ä¾ \",\n            \"åé—¨æ­£æ´¾çš„äº²ä¼ å¼Ÿå­\",\n            \"æ‚¬å£¶æµä¸–å´èº«è´Ÿç»æŠ€çš„éƒä¸­\",\n            \"ç»è¥ç€å®¢æ ˆçš„æƒ…æŠ¥è´©å­\",\n            \"è¢«æ´¾å¾€æ±Ÿæ¹–å§åº•çš„æœå»·å¯†æ¢\",\n            \"éšæœºç”Ÿæˆ\"\n        ],\n        \"openings\": [\n            \"å…¨å®¶è¢«ç¥ç§˜ç»„ç»‡ç­é—¨ï¼Œèº«è´Ÿè¡€æµ·æ·±ä»‡\",\n            \"æ— æ„ä¸­ä¹ å¾—äº†å¤±ä¼ å·²ä¹…çš„ç»ä¸–æ­¦åŠŸ\",\n            \"å·å…¥äº†åé—¨æ­£æ´¾ä¸é­”æ•™çš„å®ç‰©äº‰å¤ºæˆ˜\",\n            \"å—äººä¹‹æ‰˜æŠ¤é€ä¸€ä¸ªèº«ä»½ç¥ç§˜çš„äºº\",\n            \"åœ¨æ­¦æ—å¤§ä¼šä¸Šè¢«è¯¬é™·ä¸ºå›å¾’\",\n            \"æ„å¤–è·å¾—äº†ä¸€æœ¬è®°è½½ç»ä¸–å†…åŠŸçš„ç§˜ç±\",\n            \"è¢«å¸ˆçˆ¶æ‰˜ä»˜å¯»æ‰¾å¤±æ•£å¤šå¹´çš„å¸ˆå¼Ÿ/å¸ˆå¦¹\",\n            \"åœ¨è’å±±é‡å²­æ•‘ä¸‹äº†ä¸€ä¸ªèº«å—é‡ä¼¤çš„é«˜æ‰‹\",\n            \"å‘ç°è‡ªå·±çš„èº«ä¸–ä¸äºŒåå¹´å‰çš„æ­¦æ—æµ©åŠ«æœ‰å…³\",\n            \"è¢«å·å…¥äº†çš‡å®¤å¤ºä½ä¹‹äº‰\",\n            \"å…¨å®¶è¢«ç¥ç§˜äººç­é—¨ï¼Œå‡¶æ‰‹ä½¿ç”¨çš„æ˜¯å¤±ä¼ å·²ä¹…çš„æ­¦åŠŸ\",\n            \"æ— æ„ä¸­æ•‘ä¸‹ä¸€ä¸ªé‡ä¼¤çš„è€äººï¼Œä¸´ç»ˆå‰ä¼ ç»™ä½ æ¯•ç”ŸåŠŸåŠ›å’Œä¸€æ®µå£è¯€\",\n            \"å·å…¥äº†ä¸€åœºé’ˆå¯¹æ­¦æ—ç›Ÿä¸»çš„åˆºæ€é˜´è°‹ï¼Œè¢«å½“æˆæ›¿ç½ªç¾Š\",\n            \"å¸ˆé—¨è‡³å®å¤±çªƒï¼Œä½œä¸ºæœ€å¤§å«Œç–‘äººçš„ä½ è¢«è¿«é€ƒäº¡å¹¶è‡ªè¯æ¸…ç™½\",\n            \"åœ¨å±±æ´é¿é›¨æ—¶å‘ç°äº†å‰è¾ˆé«˜äººçš„é—éª¸å’Œæ­¦åŠŸç§˜ç±\",\n            \"è¢«è¿«å‚åŠ ä¸€åœºç”Ÿæ­»ä¸è®ºçš„æ­¦æ—å¤§ä¼šï¼Œèƒœè€…å°†æˆä¸ºæŸå¤§äººç‰©çš„å¥³å©¿/èµ˜å©¿\",\n            \"å…¨å®¶è¢«ç¥ç§˜ç»„ç»‡ç­é—¨ï¼Œèº«è´Ÿè¡€æµ·æ·±ä»‡çš„ä½ ï¼Œå¸¦ç€å”¯ä¸€çš„çº¿ç´¢è¸å…¥æ±Ÿæ¹–ã€‚\",\n            \"æ— æ„ä¸­ä¹ å¾—äº†å¤±ä¼ å·²ä¹…çš„ç»ä¸–æ­¦åŠŸï¼Œä½†ä»£ä»·æ˜¯æ¯ä½¿ç”¨ä¸€æ¬¡éƒ½ä¼šå¤±å»ä¸€éƒ¨åˆ†äººæ€§ã€‚\",\n            \"ä½ å·å…¥äº†æ­£æ´¾ä¸é­”æ•™å¯¹ä¸€æœ¬æ­¦åŠŸç§˜ç±çš„äº‰å¤ºæˆ˜ä¸­ï¼Œè€Œé‚£æœ¬ç§˜ç±å°±æ˜¯ä½ è‡ªå·±ã€‚\",\n            \"ä½ çš„ä»»åŠ¡æ˜¯æš—ä¸­å¹²é¢„æŸä¸ªå†å²çš„å…³é”®èŠ‚ç‚¹ï¼Œç¡®ä¿å†å²æŒ‰ç…§æ­£ç¡®çš„æ–¹å‘å‘å±•ã€‚\",\n            \"éšæœºç”Ÿæˆ\"\n        ]\n    },\n \n    \"ææ€–æƒŠæ‚š\": {\n        \"identities\": [\n            \"è¶…è‡ªç„¶ç°è±¡è°ƒæŸ¥å‘˜\",\n            \"ææ€–ç‰‡æ¼”å‘˜\",\n            \"å¿ƒç†åŒ»ç”Ÿ\",\n            \"å¤è‘£åº—è€æ¿\",\n            \"å»ºç­‘å·¥äºº\",\n            \"å¤œç­ä¿å®‰\",\n            \"çµåª’\",\n            \"è€ƒå¤å­¦å®¶\",\n            \"æ°‘ä¿—å­¦è€…\",\n            \"æ™®é€šæ¸¸å®¢\",\n                \"å…¥æ®“å¸ˆ/æ³•åŒ»\",\n    \"è®°è€…/æ’­å®¢ä¸»\",\n    \"é•¿é€”å¡è½¦å¸æœº\",\n    \"æ¶ˆé˜²å‘˜/æ•‘æ´é˜Ÿå‘˜\",\n    \"æ–°å®¶çš„ä½æˆ·\",\n    \"æ·±æµ·/æ´ç©´æ¢é™©å®¶\",\n    \"æŠ¤æ—å‘˜\",\n    \"å†å²æ¡£æ¡ˆç®¡ç†å‘˜\",\n    \"å”¯ä¸€çš„å¹¸å­˜è€…\",\n    \"é‚ªæ•™é€ƒç¦»è€…\",\n    \"çŠ¯ç½ªå¿ƒç†å­¦å®¶\",\n    \"åŸå¸‚æ¢é™©åšä¸»\",\n    \"å¤±çœ ç—‡æ‚£è€…\",\n    \"ä¹¡ä¸‹çš„èµ¤è„šåŒ»ç”Ÿ\",\n            \"éšæœºç”Ÿæˆ\"\n        ],\n        \"openings\": [\n            \"è¢«å›°åœ¨ä¸€æ ‹å‘ç”Ÿè¿‡æƒ¨æ¡ˆçš„è€å®…ä¸­\",\n            \"åœ¨æ‹æ‘„ææ€–ç‰‡æ—¶é­é‡äº†çœŸæ­£çš„è¶…è‡ªç„¶ç°è±¡\",\n            \"æ”¶åˆ°äº†ä¸€ç›˜è®°å½•ç€è¯¡å¼‚å†…å®¹çš„å½•åƒå¸¦\",\n            \"åœ¨å¤è‘£åº—ä¹°åˆ°äº†ä¸€ä¸ªè¢«è¯…å’’çš„ç‰©å“\",\n            \"å‚åŠ äº†ä¸€ä¸ªç¥ç§˜çš„ç½‘ç»œæŒ‘æˆ˜æ¸¸æˆ\",\n            \"åœ¨æ·±å¤œçš„åŒ»é™¢é‡åˆ°äº†å·²ç»æ­»å»çš„ç—…äºº\",\n            \"è¢«é‚€è¯·è°ƒæŸ¥ä¸€èµ·è¿è­¦å¯Ÿéƒ½ä¸æ•¢æ·±å…¥çš„æ¡ˆä»¶\",\n            \"åœ¨æŒ–æ˜å¤å¢“æ—¶é‡Šæ”¾äº†ä¸è¯¥è¢«å”¤é†’çš„å­˜åœ¨\",\n            \"æ¬è¿›æ–°å®¶åå‘ç°æˆ¿é—´é‡Œæœ‰çœ‹ä¸è§çš„å®¤å‹\",\n            \"åœ¨è¿›è¡Œå¿ƒç†æ²»ç–—æ—¶æ‚£è€…è¯´å‡ºäº†ä¸å¯èƒ½çŸ¥é“çš„ç§˜å¯†\",\n             \"æ‰‹æœºç›¸å†Œé‡Œçªç„¶å¤šäº†ä¸€æ®µä½ ç†Ÿç¡æ—¶çš„è§†é¢‘ã€‚\",\n    \"æ·±å¤œå¼€è½¦æ—¶ï¼Œåè§†é•œé‡Œæ€»æœ‰ä¸€ä¸ªç©¿ç€çº¢è¡£æœçš„èº«å½±ä¸€é—ªè€Œè¿‡ã€‚\",\n    \"é•œå­é‡Œçš„å€’å½±ï¼Œåœ¨ä½ è½¬è¿‡èº«åï¼Œå¯¹ä½ éœ²å‡ºäº†ä¸€ä¸ªè¯¡å¼‚çš„å¾®ç¬‘ã€‚\",\n    \"ç”µæ¢¯å¤±æ§ï¼Œåœåœ¨äº†ä¸€ä¸ªä¸å­˜åœ¨çš„â€œåœ°ä¸‹4å±‚â€ã€‚\",\n    \"ä¸€å¼ çº¸æ¡ä»é—¨ç¼ä¸‹å¡äº†è¿›æ¥ï¼Œä¸Šé¢ç”¨è¡€å†™ç€ï¼šâ€œåˆ«å‡ºå£°ï¼Œå®ƒåœ¨å¬ã€‚â€\",\n    \"å¥½ä¸å®¹æ˜“æ·˜åˆ°çš„å¤è‘£å¨ƒå¨ƒï¼Œå®ƒçš„çœ¼ç›å¥½åƒä¼šè‡ªå·±è½¬åŠ¨ã€‚\",\n    \"è€³è¾¹æ€»æ˜¯æ— ç«¯å“èµ·ä¸€æ®µå‚¬çœ èˆ¬çš„ç«¥è°£ï¼Œä½†å‘¨å›´å¹¶æ²¡æœ‰å…¶ä»–äººã€‚\",\n    \"åœ¨ä¸€åº§ä»¥â€œè‡ªæ€åœ£åœ°â€é—»åçš„æ£®æ—é‡Œè¿·äº†è·¯ï¼Œå¤©è‰²æ¸æ¸æš—äº†ä¸‹æ¥ã€‚\",\n    \"ä½ å·¥ä½œçš„åŠå…¬æ¥¼é‡Œæµä¼ ç€ä¸€ä»½â€œå¤œç­ç”Ÿå­˜å®ˆåˆ™â€ï¼Œè€Œä½ åˆšåˆšä¸å°å¿ƒè¿åäº†å…¶ä¸­ä¸€æ¡ã€‚\",\n    \"å¤§é›ªå°å±±ï¼Œè¢«å›°åœ¨ä¸ä¸–éš”ç»çš„å±±é—´æ—…åº—é‡Œï¼Œè€Œä½å®¢ä»¬å¼€å§‹ä¸€ä¸ªæ¥ä¸€ä¸ªåœ°ç¥ç§˜æ­»å»ã€‚\",\n    \"ä½ æ”¶åˆ°äº†ä¸€ä¸ªåŒ¿ååŒ…è£¹ï¼Œé‡Œé¢åªæœ‰ä¸€ä¸ªå°æœ¨å¶å’Œä¸€å¼ æŒ‡ç¤ºï¼šâ€œç°åœ¨ï¼Œä½ æ˜¯å®ƒçš„æ–°ä¸»äººäº†ã€‚â€\",\n    \"æ•´ç†ç¥–çˆ¶é—ç‰©æ—¶ï¼Œå‘ç°äº†ä¸€æœ¬è®°å½•ç€æŸç§é‚ªæ¶ä»ªå¼çš„æ—¥è®°ï¼Œè€Œä»ªå¼çš„æœ€åä¸€æ­¥å°±åœ¨ä»Šæ™šã€‚\",\n    \"å°é•‡ä¸Šæµä¼ ç€ä¸€ä¸ªä¼ è¯´ï¼šç»å¯¹ä¸èƒ½åœ¨åˆå¤œå›å¤´çœ‹è‡ªå·±çš„å½±å­ã€‚è€Œä»Šæ™šï¼Œä½ æ„Ÿè§‰æœ‰ä»€ä¹ˆä¸œè¥¿åœ¨æ‹‰ä½ çš„è£¤è„šã€‚\",\n    \"å®¶é‡Œæ‰€æœ‰çš„é’Ÿè¡¨ï¼Œéƒ½åˆ†æ¯«ä¸å·®åœ°åœåœ¨äº†å‡Œæ™¨3ç‚¹44åˆ†ã€‚\",\n    \"æ¥åˆ°äº†ä¸€ä¸ªå¥‡æ€ªçš„æ±‚åŠ©ç”µè¯ï¼Œå¯¹æ–¹è¯´ä»–è¢«å›°åœ¨äº†ä½ å®¶çš„å¢™å£é‡Œã€‚\",\n            \"éšæœºç”Ÿæˆ\"\n        ]\n    },\n    \"æµ·æ´‹å†’é™©\": {\n        \"identities\": [\n            \"èˆ¹å‘˜\",\n            \"æµ·ç›—\",\n            \"æ¸”å¤«/æ¸”å¥³\",\n            \"æµ·å†›å†›å®˜\",\n            \"æ¢é™©å®¶\",\n            \"æµ·æ´‹ç”Ÿç‰©å­¦å®¶\",\n            \"æ½œæ°´å‘˜\",\n            \"ç¯å¡”çœ‹å®ˆ\",\n            \"èˆ¹é•¿\",\n            \"æµ·å•†\",\n            \"æµ·éš¾å¹¸å­˜è€…\",\n            \"å¯»å®çŒäºº\",\n                \"äººé±¼/æµ·æ´‹æ™ºæ…§ç”Ÿç‰©\",\n    \"è¢«è¯…å’’çš„ä¸æ­»æ°´æ‰‹\",\n    \"åˆ¶å›¾å¸ˆ/èˆªæµ·å®¶\",\n    \"æ¸¯å£çš„èµ°ç§è€…\",\n    \"èˆ¹èˆ¶å·¥ç¨‹å¸ˆ/ä¿®ç†å·¥\",\n    \"æµ·å²¸è­¦å«é˜Ÿé˜Ÿå‘˜\",\n    \"æµ·æ´‹ç¥ç¥‡çš„ç¥­å¸\",\n    \"æµ·æ€ªçŒäºº\",\n            \"éšæœºç”Ÿæˆ\"\n        ],\n        \"openings\": [\n            \"åœ¨ä¸€åº§è’å²›ä¸Šé†’æ¥ï¼Œèˆ¹åªå·²ç»æ¶ˆå¤±\",\n            \"å‘ç°äº†ä¸€å¼ æŒ‡å‘ä¼ è¯´å®è—çš„å¤è€æµ·å›¾\",\n            \"èˆ¹åªåœ¨é£æš´ä¸­åç¦»èˆªçº¿ï¼Œåˆ°è¾¾äº†åœ°å›¾ä¸Šä¸å­˜åœ¨çš„æµ·åŸŸ\",\n            \"åœ¨æ·±æµ·æ½œæ°´æ—¶é­é‡äº†å²å‰å·¨å…½\",\n            \"è¢«æµ·ç›—åŠ«æŒåå‘ç°ä»–ä»¬åœ¨å¯»æ‰¾æŸç§ç¥ç§˜ç‰©å“\",\n            \"åœ¨é’“é±¼æ—¶é’“ä¸Šæ¥äº†ä¸€ä¸ªè£…ç€æ±‚æ•‘ä¿¡çš„ç“¶å­\",\n            \"å‘ç°è‡ªå·±å·¥ä½œçš„æ²¹äº•å¹³å°ä¸‹æ–¹éšè—ç€å¤ä»£æ–‡æ˜\",\n            \"åœ¨æµ·åº•è€ƒå¤æ—¶å”¤é†’äº†æ²‰ç¡çš„æ·±æµ·ç”Ÿç‰©\",\n            \"è¢«ç¥ç§˜æµ·æµå·å…¥äº†ä¼ è¯´ä¸­çš„èˆ¹åªåŸåœº\",\n            \"æ”¶åˆ°äº†æ¥è‡ªå¤±è¸ªå¤šå¹´çš„æ¢é™©é˜Ÿçš„æ— çº¿ç”µä¿¡å·\",\n             \"ä¼ è¯´ä¸­çš„å¹½çµèˆ¹â€˜é£ç¿”çš„è·å…°äººâ€™å·ï¼Œç ´å¼€æµ“é›¾ï¼Œç¼“ç¼“å‡ºç°åœ¨èˆªçº¿å‰æ–¹ã€‚\",\n    \"ç™¾æ…•å¤§ä¸‰è§’çš„ä¸­å¿ƒåŒºåŸŸï¼Œæ‰€æœ‰å¯¼èˆªä»ªå™¨çªç„¶å¤±çµï¼Œæµ·é¢å¹³é™å¾—å®›å¦‚é•œé¢ã€‚\",\n    \"æ‰“æä¸Šæ¥çš„ç™¾å¹´æ²‰èˆ¹é‡Œï¼Œä¸€å…·å°¸ä½“ç«Ÿå®Œå¥½æ— æŸï¼Œä»¿ä½›åªæ˜¯æ²‰æ²‰ç¡å»ã€‚\",\n    \"ä¸€åœºç½•è§çš„â€˜è¡€è‰²èµ¤æ½®â€™è¿‡åï¼Œæµ·ä¸­æ¶Œç°å‡ºæ— æ•°ä»æœªè§è¿‡çš„ã€å‘ç€å¹½å…‰çš„å¥‡å¼‚ç”Ÿç‰©ã€‚\",\n    \"èˆ¹åªè¢«ä¸€è‚¡å·¨å¤§çš„åŠ›é‡çŒ›åœ°å‘ä¸‹ä¸€æ‹½ï¼Œä»¿ä½›æœ‰ä»€ä¹ˆä¸œè¥¿ç¼ ä½äº†é¾™éª¨ï¼Œæ­£è¦å°†æ•´è‰˜èˆ¹æ‹–å…¥æ·±æ¸Šã€‚\",\n    \"åœ¨æ·±æµ·çƒ­æ³‰é™„è¿‘ï¼Œå£°å‘æ¢æµ‹åˆ°äº†ä¸€åº§ç”±æœªçŸ¥é‡‘å±æ„æˆã€ä¼¼ä¹ä»åœ¨è¿ä½œçš„å®ä¼ŸåŸå¸‚ã€‚\",\n    \"é²¸é±¼ç¾¤çš„æ­Œå£°ä¸­ï¼Œå¤¹æ‚ç€ä¸€æ®µæå…¶è§„å¾‹çš„ã€ä»¿ä½›æ‘©æ–¯å¯†ç èˆ¬çš„ç¥ç§˜æ—‹å¾‹ã€‚\",\n    \"å·¨å¤§çš„æåœ°å†°å·åœ¨ä½ çœ¼å‰å´©å¡Œï¼Œæ€èµ·çš„æ»”å¤©å·¨æµªï¼Œæ­£æœç€èˆ¹åªæ‰‘æ¥ã€‚\",\n    \"æµ·é¢ä¸Šå‡­ç©ºå‡ºç°äº†ä¸€æ‰‡ç”±æ—‹è½¬çš„æ°´æµæ„æˆçš„å·¨é—¨ï¼Œé—¨åæ˜¯å®Œå…¨é™Œç”Ÿçš„æ˜Ÿç©ºã€‚\",\n    \"åœ¨ä¸€åº§æ— äººç¯å¡”çš„é¡¶ç«¯ï¼Œå‘ç°äº†ä¸€æœ¬å†™æ»¡äº†ä¸€ä¸ªä¸–çºªçš„æ€å¿µä¸ç­‰å¾…çš„èˆªæµ·æ—¥å¿—ã€‚\",\n            \"éšæœºç”Ÿæˆ\"\n        ]\n    },\n    \"äºŒæ¬¡å…ƒ\": {\n        \"identities\": [\n            \"è½¬æ ¡ç”Ÿ\",\n            \"ç¤¾å›¢æˆå‘˜\",\n            \"é­”æ³•å°‘å¥³/å°‘å¹´\",\n            \"å¶åƒ\",\n            \"æ¸¸æˆç©å®¶\",\n            \"æ¸¸æˆä¸­çš„npc\",\n            \"åŠ¨æ¼«å®…\",\n            \"å­¦ç”Ÿä¼šæˆå‘˜\",\n            \"å›¾ä¹¦å§”å‘˜\",\n            \"ä½“è‚²ç¤¾ç‹ç‰Œ\",\n            \"æ ¡å›­å¶åƒ\",\n            \"ç¥ç§˜è½¬å­¦ç”Ÿ\",\n            \"æ™®é€šè·¯äºº\",\n             \"åœ°ä¸‹å¶åƒ\",\n    \"Vtuber / ä¸»æ’­\",\n    \"è½»å°è¯´ä½œå®¶ / æ¼«ç”»å®¶\",\n    \"é£çºªå§”å‘˜\",\n    \"é˜´é˜³å¸ˆ / é€€é­”å¸ˆ\",\n    \"å¼‚ä¸–ç•Œå½’æ¥è€…\",\n    \"æ€ªç›—\",\n    \"éäººç±»ï¼ˆå¦–ç‹/å¸è¡€é¬¼ç­‰ï¼‰\",\n\n    \"å½’å®…éƒ¨æˆå‘˜\",\n    \"æ‰§äº‹ / å¥³ä»†\",\n    \"å£°ä¼˜\",\n    \"è¢«å°å°äº†åŠ›é‡çš„é­”ç‹/å‹‡è€…\",\n            \"éšæœºç”Ÿæˆ\"\n        ],\n        \"openings\": [\n            \"æ”¶åˆ°äº†ä¸€ä¸ªèƒ½å®ç°æ„¿æœ›çš„ç¥ç§˜é“å…·\",\n            \"è¢«é€‰ä¸­æˆä¸ºæ‹¯æ•‘ä¸–ç•Œçš„é­”æ³•å°‘å¥³/å°‘å¹´\",\n            \"åœ¨å­¦å›­ç¥­ä¸Šå‘ç”Ÿäº†è¶…è‡ªç„¶ç°è±¡\",\n            \"å‘ç°ç­ä¸Šçš„åŒå­¦å…¶å®éƒ½ä¸æ˜¯äººç±»\",\n            \"è¢«å·å…¥äº†ä¸€ä¸ªçœŸäººç‰ˆçš„æ¸¸æˆä¸–ç•Œ\",\n            \"åœ¨ç¤¾å›¢æ´»åŠ¨å®¤å‘ç°äº†é€šå¾€å¼‚ä¸–ç•Œçš„ä¼ é€é—¨\",\n \n            \"åœ¨å¶åƒæ¼”å‡ºä¸­é­é‡äº†æ¥è‡ªå¼‚æ¬¡å…ƒçš„è¢­å‡»\",\n            \"å‘ç°å­¦æ ¡å…¶å®æ˜¯ä¸€ä¸ªå·¨å¤§çš„å®éªŒåœºæ‰€\",\n            \"è¢«ç¥ç§˜ç»„ç»‡é€‰ä¸­å‚åŠ ç‰¹æ®Šçš„æ¸¸æˆ\",\n               \"é‹æŸœé‡Œæ”¶åˆ°äº†ä¸€å°ç½²åä¸ºâ€˜æ€ªç›—â€™çš„ã€å·èµ°ä½ å¿ƒçš„é¢„å‘Šå‡½ã€‚\",\n    \"æ·±å¤œæ­ä¹˜çš„ç”µè½¦ï¼Œåœ¨ä¸€ä¸ªåœ°å›¾ä¸Šä¸å­˜åœ¨çš„â€œå¦‚æœˆè½¦ç«™â€åœäº†ä¸‹æ¥ã€‚\",\n    \"å¤©å°ä¸Šï¼Œå…¨æ ¡æœ€å—æ¬¢è¿çš„å­¦ç”Ÿä¼šé•¿èƒŒåï¼Œé•¿å‡ºäº†ä¸€å¯¹æ¼†é»‘çš„ç¿…è†€ã€‚\",\n    \"é†’æ¥åï¼Œä½ å’Œæœ€è®¨åŒ/æœ€æ†§æ†¬çš„é‚£ä¸ªåŒå­¦çµé­‚äº’æ¢äº†ã€‚\",\n    \"æ‰‹æœºé‡Œå¤šå‡ºäº†ä¸€ä¸ªæ— æ³•åˆ é™¤çš„APPï¼Œå®ƒçš„åŠŸèƒ½æ˜¯â€œæœªæ¥æ—¥è®°â€ã€‚\",\n    \"ä¸€åœºå°å‹åœ°ä¸‹å¶åƒLiveç»“æŸåï¼Œå°ä¸‹çš„æ‰€æœ‰ç²‰ä¸å…¨éƒ½å˜æˆäº†ç‹‚çƒ­çš„ä¿¡å¾’ã€‚\",\n    \"ä½ å¸¸ç©çš„æ¸¸æˆå…³æœäº†ï¼Œä½†ä½ æ¸¸æˆé‡Œçš„â€œè€å©†â€/ä¼™ä¼´å´å‡ºç°åœ¨äº†å®¶é—¨å£ã€‚\",\n    \"å­¦æ ¡çš„æ¸¸æ³³æ± åœ¨æ²¡æœ‰æ°´çš„çŠ¶æ€ä¸‹ï¼Œæ·¹æ­»äº†ä¸€ä¸ªå­¦ç”Ÿã€‚\",\n    \"æ¨±èŠ±æ ‘ä¸‹ï¼Œä¸€ä¸ªå®Œå…¨ä¸è®¤è¯†çš„è½¬æ ¡ç”Ÿçªç„¶å‘ä½ å‘Šç™½ï¼Œå¹¶å£°ç§°ä½ ä»¬æ˜¯å‰ä¸–çš„æ‹äººã€‚\",\n    \"åŸå¸‚ä¸Šç©ºå‡ºç°äº†ä¸€ä¸ªå·¨å¤§çš„ã€ç”±æ— æ•°çœ¼çƒç»„æˆçš„é­”æ³•é˜µã€‚\",\n \n    \"ä½ åœ¨ç½‘ç»œä¸Šè¿è½½çš„å°è¯´æƒ…èŠ‚ï¼Œå¼€å§‹åœ¨ç°å®ä¸­åˆ†æ¯«ä¸å·®åœ°ä¸€ä¸€ä¸Šæ¼”ã€‚\",\n    \"ä¸€åœºæµæ˜Ÿé›¨è¿‡åï¼Œä½ çªç„¶èƒ½å¬æ‡‚å®¶é‡Œçš„çŒ«åœ¨è¯´ä»€ä¹ˆäº†ã€‚\",\n    \"ä»Šå¤©çš„å åœå¤§å‡¶ï¼Œå‡ºé—¨å°±ä¼šé­é‡å®¿å‘½çš„é‚‚é€…ï¼Œå¼€å¯ä½ æ³¢æ¾œå£®é˜”çš„ä¸€ç”Ÿã€‚\",\n            \"éšæœºç”Ÿæˆ\"\n        ]\n    },\n    \"ç‰¹æ®Šä¸–ç•Œè§‚\": {\n        \"identities\": [\n            \"è®°å¿†å•†äºº\",\n            \"æ¢¦å¢ƒè¡Œè€…\",\n            \"æ¨¡å› ä¼ æ’­è€…\",\n            \"ç³Šå¼„å­¦å¤§å¸ˆ\",\n              \"ABOä¸–ç•Œä¸­çš„ç¨€æœ‰æ€§åˆ«\",\n            \"è§„åˆ™æ€ªè°ˆä¸­çš„â€œè¿è§„è€…â€\",\n            \"æ—¶é—´å¾ªç¯ä¸­çš„é”šç‚¹\",\n            \"æ‹¥æœ‰è‡ªæˆ‘æ„è¯†çš„NPC\",\n            \"é­…é­”\",\n            \"æ¢¦é­‡\",\n            \"å…‹è‹é²ç¥è¯ä¸­çš„è°ƒæŸ¥å‘˜\",\n            \"çµæ°”å¤è‹çš„å…ˆçŸ¥\",\n            \"ç¥è¯å¤è‹çš„é’¥åŒ™\",\n   \"ç²¾ç¥è¿‡è½½çš„å“¨å…µ\",\n        \"å¯»æ‰¾æ­æ¡£çš„å‘å¯¼\",\n        \"ä¿¡æ¯ç´ å¤±æ§çš„Alpha\",\n        \"ä¼ªè£…æˆBetaçš„Omega\",\n        \"é£Ÿç‰©é“¾é¡¶ç«¯çš„æ•é£Ÿè€…\",\n        \"é‡ç”Ÿ/ç©¿ä¹¦çš„æ¶å½¹åƒé‡‘\",\n        \"åˆšåˆšè‹é†’çš„æ—§ç¥\",\n        \"ç¥æ ¼ç ´ç¢çš„ç¥æ˜\",\n        \"è¢«çŒ®ç¥­çš„åœ£å­/åœ£å¥³\",\n        \"ä¸–ç•Œæ„å¿—çš„åŒ–èº«\",\n        \"æ‹¥æœ‰è‡ªæˆ‘æ„è¯†çš„ç³»ç»Ÿ/å¤–æŒ‚\",\n        \"æ•…äº‹çš„â€˜æ—ç™½â€™\",\n        \"äººå½¢çš„Sçº§æ”¶å®¹ç‰©\",\n            \"éšæœºç”Ÿæˆ\"\n        ],\n        \"openings\": [\n               \"å¤©ç©ºçªç„¶è£‚å¼€ï¼Œå¦ä¸€åº§åŸå¸‚çš„å€’å½±æ‚¬æŒ‚äºå¤©é™…ã€‚\",\n        \"ä¸–ç•Œä¸Šæ‰€æœ‰çš„æ–‡å­—åœ¨ä¸€å¤œä¹‹é—´å˜æˆäº†æ— äººèƒ½æ‡‚çš„é‡‘è‰²ç¬¦å·ã€‚\",\n        \"ä½ ä¸€è§‰é†’æ¥ï¼Œå‘ç°æ‰€æœ‰äººéƒ½å¤±å»äº†â€œæ‚²ä¼¤â€è¿™ç§æƒ…ç»ªã€‚\",\n        \"ä½ å‡è§†æ·±æ¸Šæ—¶ï¼Œæ·±æ¸ŠçœŸçš„æœä½ çœ¨äº†çœ¨çœ¼ï¼Œè¿˜è¯´äº†å£°â€œå—¨â€ã€‚\",\n        \"ä½ åœ¨ä¸€ä¸ªé™Œç”Ÿäººçš„æˆ¿é—´é†’æ¥ï¼Œåé¢ˆä¼ æ¥ä¸€é˜µé™Œç”Ÿçš„åˆºç—›ï¼Œç©ºæ°”ä¸­å¼¥æ¼«ç€é›ªæ¾å’Œçƒˆé…’çš„å‘³é“ã€‚\",\n        \"çœ¼å‰çš„ä¸–ç•Œçªç„¶å¡é¡¿ï¼Œä¸€ä¸ªâ€œæ­£åœ¨åŠ è½½...â€çš„è¿›åº¦æ¡å‡ºç°åœ¨ä½ çš„è§†é‡ä¸­å¤®ã€‚\",\n        \"ä½ å®¶é—¨ä¸Šå¤šäº†ä¸€å¼ çº¸æ¡ï¼Œä¸Šé¢ç”¨é²œçº¢çš„å­—è¿¹å†™ç€ï¼šâ€œæ¬¢è¿æ¥åˆ°è¿™é‡Œï¼Œè¯·åœ¨å¤©é»‘åéµå®ˆä»¥ä¸‹è§„åˆ™â€¦â€¦â€\",\n        \"æœˆäº®å˜æˆäº†æ·±ç´«è‰²ï¼Œæ‰€æœ‰è¢«æœˆå…‰ç…§åˆ°çš„äººéƒ½å¼€å§‹ç–¯ç‹‚åœ°å‘“è¯­ã€‚\",\n        \"ä½ æ”¶åˆ°äº†ä¸‰ä¸ªæœˆåï¼Œæ¥è‡ªè‡ªå·±çš„æ­»äº¡é¢„å‘Šä¿¡ã€‚\",\n        \"ä½ çš„å½±å­åœ¨æ²¡æœ‰å…‰çš„åœ°æ–¹ï¼Œè‡ªå·±ç«™äº†èµ·æ¥ï¼Œå¹¶å¯¹ä½ éœ²å‡ºäº†ä¸€ä¸ªè¯¡å¼‚çš„å¾®ç¬‘ã€‚\",\n        \"ä½ æ€æ­»äº†è¿™ä¸ªä¸–ç•Œçš„â€œä¸»è§’â€ï¼Œè€³è¾¹çªç„¶å“èµ·äº†å†°å†·çš„ç³»ç»Ÿæç¤ºéŸ³ï¼šâ€œä¸–ç•Œçº¿å¼€å§‹é‡ç½®â€¦â€¦â€\",\n        \"æ‰‹æœºå±å¹•ä¸Šçªç„¶å‡ºç°ä¸€ä¸ªæ‹çˆ±æ¸¸æˆAppï¼Œè€Œé‡Œé¢çš„å¯æ”»ç•¥è§’è‰²ï¼Œå…¨éƒ½æ˜¯ä½ èº«è¾¹çš„äººã€‚\",\n        \"ä½ é¢å‰çš„NPCçªç„¶æŠ“ä½äº†ä½ çš„æ‰‹ï¼Œæµç€æ³ªå¯¹ä½ è¯´ï¼šâ€œæ±‚æ±‚ä½ ï¼Œå¸¦æˆ‘ç¦»å¼€è¿™ä¸ªæ¸¸æˆï¼Œæˆ‘ä»€ä¹ˆéƒ½æ„¿æ„åšã€‚â€\",\n        \"æµ·é¢ä¸Šæµ®ç°å‡ºä¸€åº§ç”±éæ¬§å‡ ä½•æ„æˆçš„ã€ä¸æ–­å˜åŒ–çš„åŸå¸‚ï¼Œå·¨å¤§çš„è§¦æ‰‹ä»åŸä¸­ä¼¸å‘å¤©ç©ºã€‚\",\n            \"éšæœºç”Ÿæˆ\"\n        ]\n    },\n    \"åºŸåœŸæœ«æ—¥\": {\n        \"identities\": [\n               \"æ‹¾è’è€…\",\n            \"å˜ç§äººçŒæ‰‹\",\n            \"å¹¸å­˜è€…æ®ç‚¹å®ˆå«\",\n            \"ç‹¬è¡Œå•†äºº\",\n            \"å‡€æ°´æŠ€æœ¯å‘˜\",\n            \"åŒ»ç–—å…µ\",\n            \"æœºæ¢°å¸ˆ\",\n            \"æœæ•‘é˜Ÿå‘˜\",\n            \"è½¦é˜Ÿå¸æœº\",\n            \"ç‰©èµ„ç®¡ç†å‘˜\",\n            \"ç§»åŠ¨å ¡å’çš„è½¦é•¿\",\n            \"é©¾é©¶æ­¦è£…è½¦è¾†çš„â€œå…¬è·¯å¹½çµâ€\",\n            \"æŒæ¡ä¸€å°å—å¯è€•ç§åœŸåœ°çš„å†œåœºä¸»\",\n            \"æœé›†æ—§æ—¶ä»£ç§‘æŠ€çš„â€œå†å²å­¦å®¶â€\",\n            \"å­¤å²›ä¸Šçš„å‚é’“è€…\",\n            \"å¹¸å­˜è€…æ®ç‚¹çš„åŒ»ç”Ÿ\",\n            \"ç»éªŒè€é“çš„æ‹¾è’è€…\",\n            \"å˜ç§äººçŒæ‰‹\",\n            \"å¹¸å­˜è€…æ®ç‚¹çš„å®ˆå«\",\n            \"ç‹¬è¡Œå•†äºº\",\n            \"æŒæ¡å‡€æ°´/ç§æ¤æŠ€æœ¯çš„æŠ€å·¥\",\n            \"å¯»æ‰¾ç–«è‹—çš„åŒ»ç”Ÿ\",\n            \"æ å¤ºè€…å›¢ä¼™çš„ä¿˜è™\",\n            \"æˆ˜å‰æ–‡æ˜çš„å­¦è€…\",\n            \"ä¿¡å¥‰é’¢é“çš„æœºæ¢°æ•™ç¥­å¸\",\n            \"åŸºå› çªå˜çš„å¼‚èƒ½è€…\",\n            \"éšæœºç”Ÿæˆ\"\n        ],\n        \"openings\": [\n            \"ä»ä¸€ä¸ªåºŸå¼ƒå¤šå¹´çš„é¿éš¾æ‰€ä¸­è‹é†’ï¼Œå¤–é¢çš„ä¸–ç•Œå·²é¢ç›®å…¨é\",\n            \"åœ¨ä¸€å…·ç©¿ç€é˜²è¾å°„æœçš„å°¸ä½“ä¸Šï¼Œæ‰¾åˆ°äº†ä¸€å¼ æŒ‡å‘ä¼ è¯´ä¸­â€œç»¿æ´²â€çš„åœ°å›¾\",\n            \"ä¸ºäº†æ‹¯æ•‘æ®ç‚¹é‡Œæ„ŸæŸ“çš„äº²äººï¼Œä¸å¾—ä¸é—¯å…¥è¾å°„æé«˜çš„æ ¸å¿ƒåŒºå¯»æ‰¾è¯å“\",\n            \"é©¾é©¶çš„æ­¦è£…è½¦è¾†åœ¨æ²™å°˜æš´ä¸­æŠ›é”šï¼Œè¡¥ç»™æ‰€å‰©æ— å‡ \",\n            \"æ‰€åœ¨çš„æ®ç‚¹è¢«å¼ºå¤§çš„æ å¤ºè€…å†›å›¢åŒ…å›´ï¼Œé¦–é¢†å†³å®šæ´¾ä½ å‡ºå»å¯»æ±‚æ´åŠ©\",\n            \"å–ä¸‹äº†è¢«æ±¡æŸ“çš„æ°´æºï¼Œå¼€å§‹å‡ºç°å¥‡æ€ªçš„å¹»è§‰å’Œèº«ä½“å˜åŒ–\",\n             \"ä»ä¸€ä¸ªåºŸå¼ƒçš„é¿éš¾æ‰€ä¸­è‹é†’\",\n            \"åœ¨ä¸€å…·å°¸ä½“ä¸Šæ‰¾åˆ°äº†æŒ‡å‘ç»¿æ´²çš„åœ°å›¾\",\n            \"ä¸ºäº†å®¶äººæ€¥éœ€çš„è¯å“ï¼Œä¸å¾—ä¸é—¯å…¥è¾å°„åŒº\",\n            \"é©¾é©¶çš„æ­¦è£…è½¦è¾†åœ¨æ²™å°˜æš´ä¸­æŠ›é”š\",\n            \"åœ¨åºŸå¢Ÿä¸­å‘ç°äº†ä¸€ä¸ªè¿˜åœ¨è¿è¡Œçš„AIç»ˆç«¯\",\n            \"è¢«æŸç§æœªçŸ¥ç—…æ¯’æ„ŸæŸ“ï¼Œæ—¶é—´æ‰€å‰©æ— å‡ \",\n            \"è½¦é˜Ÿé­é‡è¢­å‡»ï¼Œæˆä¸ºå”¯ä¸€å¹¸å­˜è€…\",\n            \"åœ¨åœ°ä¸‹é¿éš¾æ‰€å‘ç°äº†æœ«æ—¥å‰çš„é‡è¦ç§˜å¯†\",\n            \"æ¥æ”¶åˆ°äº†æ¥è‡ªå…¶ä»–å¹¸å­˜è€…æ®ç‚¹çš„æ±‚æ•‘ä¿¡å·\",\n            \"ä½ çš„è½¦é˜Ÿæ­£è¢«ä¸€åœºå·¨å¤§çš„è¾å°„é£æš´è¿½èµ¶ï¼Œå¿…é¡»åœ¨ç‡ƒæ–™è€—å°½å‰æ‰¾åˆ°é¿éš¾æ‰€ã€‚\",\n            \"åœ¨ä¸€å…·å¹²å°¸çš„æ€€é‡Œï¼Œæ‰¾åˆ°äº†ä¸€å¼ æŒ‡å‘ä¼ è¯´ä¸­â€œç»¿æ´²â€çš„åœ°å›¾ã€‚\",\n            \"ä½œä¸ºå­¤å²›ä¸Šå”¯ä¸€çš„å¹¸å­˜è€…ï¼Œä½ ä»Šå¤©ä»æµ·é‡Œé’“ä¸Šæ¥ä¸€ä¸ªå¯†å°çš„ï¼Œæ¥è‡ªæœªçŸ¥æ–‡æ˜çš„ä¼‘çœ ä»“ã€‚\",\n            \"æ ¸å†¬å¤©é™ä¸´ï¼Œä½ æ‰€åœ¨çš„é¿éš¾æ‰€èµ„æºå³å°†è€—å°½ï¼Œå¿…é¡»å¤–å‡ºå¯»æ‰¾ç”Ÿæœºã€‚\",\n            \"éšæœºç”Ÿæˆ\"\n        ]\n    },\n    \"è§„åˆ™æ€ªè°ˆ\": {\n        \"identities\": [\n            \"æ–°å…¥èŒçš„å…¬å¸å‘˜å·¥\",\n            \"è½¬æ ¡ç”Ÿ\",\n            \"æ¸¸å®¢\",\n            \"ç—…äºº\",\n            \"ä¹˜å®¢\",\n            \"ä½æˆ·\",\n            \"å›¾ä¹¦é¦†ç®¡ç†å‘˜\",\n            \"å¤œç­ä¿å®‰\",\n             \"èˆ¹å‘˜\",\n    \"æ·±æµ·/æåœ°ç§‘è€ƒç«™é˜Ÿå‘˜\",\n    \"ç½‘çº¢æ‰“å¡åœ°çš„æ¢åº—åšä¸»\",\n    \"è°ƒæŸ¥å‘˜\",\n    \"æ€ªå¥‡é©¬æˆå›¢çš„è¡¨æ¼”è€…\",\n    \"å‘˜å·¥\",\n    \"é…’åº—çš„ç¤¼å®¾éƒ¨\",\n    \"å­¤å„¿é™¢çš„ä¹‰å·¥\",\n    \"è¯•åƒå‘˜\",\n    \"å¯¼æ’­\",\n    \"ä¼´éƒ/ä¼´å¨˜\",\n            \"éšæœºç”Ÿæˆ\"\n        ],\n        \"openings\": [\n            \"æ”¶åˆ°ä¸€ä»½ç†æƒ³å·¥ä½œçš„å½•ç”¨é€šçŸ¥ï¼Œä½†å‘˜å·¥æ‰‹å†Œä¸Šçš„è§„åˆ™æå…¶è¯¡å¼‚\",\n            \"æ¬è¿›äº†ä¸€ä¸ªç§Ÿé‡‘æä½çš„æ–°å…¬å¯“ï¼Œæ¥¼é“é‡Œè´´æ»¡äº†å¥‡æ€ªçš„å±…ä½å®ˆåˆ™\",\n            \"åœ¨æ—§ä¹¦åº—ä¹°äº†ä¸€æœ¬ç¬”è®°æœ¬ï¼Œé‡Œé¢å†™æ»¡äº†åƒæ˜¯ç”Ÿå­˜æŒ‡å—çš„å¥‡æ€ªè§„åˆ™\",\n            \"ä¸€è§‰é†’æ¥ï¼Œå‘ç°è‡ªå·±èº«å¤„ä¸€ä¸ªæ— é™å¾ªç¯çš„èµ°å»Š/è½¦ç«™ï¼Œå¢™ä¸Šå†™ç€ç”Ÿè·¯æç¤º\",\n            \"å‚åŠ äº†ä¸€ä¸ªå¥‡æ€ªçš„æµ‹è¯•å®éªŒï¼Œè¢«å‘ŠçŸ¥å¿…é¡»ä¸¥æ ¼éµå®ˆæŒ‡ä»¤æ‰èƒ½ç¦»å¼€\",\n            \"è¯¯å…¥ä¸€ä¸ªå°é•‡ï¼Œè¿™é‡Œçš„å±…æ°‘éƒ½ä¸¥æ ¼éµå®ˆç€ä¸€äº›ä¸å¯ç†å–»çš„ä¹ ä¿—\", \n            \"é«˜è€ƒå¤±åˆ©åï¼Œä½ æ”¶åˆ°ä¸€æ‰€ä¸å­˜åœ¨çš„å¤§å­¦å¯„æ¥çš„å½•å–é€šçŸ¥ä¹¦ï¼Œé™„å¸¦ä¸€å¼ è¯¡å¼‚çš„æ–°ç”Ÿå®ˆåˆ™ã€‚\",\n    \"ä½ ä¸‹è½½äº†ä¸€ä¸ªæ— æ³•å¸è½½çš„æ‹çˆ±APPï¼Œå®ƒä¸ºä½ åŒ¹é…çš„å¯¹è±¡ä¼¼ä¹ä¸æ˜¯äººç±»ã€‚\",\n    \"ä¸€åœºå¤§é›¾æ•£å»ï¼Œä½ å‘ç°æ‰€åœ¨çš„åŸå¸‚å˜å¾—å®Œå…¨é™Œç”Ÿï¼Œè¡—ä¸Šçš„æ¯ä¸ªäººéƒ½å¯¹ä½ éœ²å‡ºè¯¡å¼‚çš„å¾®ç¬‘ã€‚\",\n    \"å—é‚€å‚åŠ ä¸€åœºå‡é¢èˆä¼šï¼Œè§„åˆ™ä¸Šè¯´ï¼Œåœ¨åˆå¤œé’Ÿå£°æ•²å“å‰ï¼Œç»å¯¹ä¸èƒ½æ‘˜ä¸‹è‡ªå·±çš„é¢å…·ã€‚\",\n    \"ç”µè§†é‡Œçªç„¶æ’æ’­ä¸€æ¡ç´§æ€¥é€šçŸ¥ï¼Œè¦æ±‚å…¨ä½“å¸‚æ°‘ä»ç°åœ¨å¼€å§‹å¿…é¡»å€’ç€èµ°è·¯ã€‚\",\n    \"ä½ ç»§æ‰¿äº†ä¸€åº§å·¨å¤§çš„å›¾ä¹¦é¦†ï¼Œä½†é—å˜±é‡Œè­¦å‘Šä½ ï¼Œç»å¯¹ä¸è¦å»é˜…è¯»CåŒºçš„ä»»ä½•ä¸€æœ¬ä¹¦ã€‚\",\n    \"ä¸ºäº†èº²é›¨ï¼Œä½ è·‘è¿›ä¸€å®¶è¯¡å¼‚çš„èœ¡åƒé¦†ï¼Œåœ¨ä½ çœ¨çœ¼åï¼Œå‘ç°æ‰€æœ‰èœ¡åƒçš„å§¿åŠ¿éƒ½å˜äº†ã€‚\",\n    \"ä½ æ‰€åœ¨çš„åŸå¸‚çªç„¶å¼ºåˆ¶å¼€å§‹ä¸€åœºä¸ºæœŸ24å°æ—¶çš„â€œæ‰è¿·è—â€æ¸¸æˆï¼Œè§„åˆ™åªæœ‰ä¸€æ¡ï¼šâ€œä¸è¦è¢«æ‰¾åˆ°â€ã€‚\",\n    \"ä½ æ”¶åˆ°äº†ä¸€ä¸ªä¼šè¯´è¯çš„ç©å¶ä½œä¸ºç¤¼ç‰©ï¼Œé™„å¸¦çš„â€œé¥²å…»è¯´æ˜â€ä¸Šå†™æ»¡äº†è¡€çº¢è‰²çš„è­¦å‘Šã€‚\",\n    \"ä½ çš„çŒ«ä»Šå¤©æ—©ä¸Šå¼å›æ¥ä¸€å¼ çº¸æ¡ï¼Œä¸Šé¢ç”¨çˆªå°å†™ç€ä¸€å¥—åªæœ‰ä½ èƒ½çœ‹è§çš„â€œå®¶åº­æ–°è§„â€ã€‚\",\n    \"ä½ æ­ä¹˜çš„èˆªç­é­é‡äº†çŒ›çƒˆæ°”æµï¼Œé¢ ç°¸è¿‡åï¼Œçª—å¤–çš„å¤©ç©ºå˜æˆäº†è¡€çº¢è‰²ã€‚\",\n    \"ä½ èµ°è¿›ä¸€å®¶24å°æ—¶ä¾¿åˆ©åº—ä¹°ä¸œè¥¿ï¼Œå´å‘ç°å¢™ä¸Šçš„æ—¶é’Ÿæ°¸è¿œæŒ‡å‘åˆå¤œä¸‰ç‚¹åŠã€‚\",\n            \"éšæœºç”Ÿæˆ\"\n        ]\n    },\n    \"ææ€–ç”Ÿå­˜\": {\n        \"identities\": [\n            \"é­é‡ç©ºéš¾çš„å¹¸å­˜è€…\",\n            \"é¬¼å±‹æ¢é™©çš„ä½œæ­»é’å¹´\",\n            \"ç²¾ç¥ç—…é™¢çš„åŒ»ç”Ÿ\",\n            \"å‡¶å®…çš„æ–°æˆ¿ä¸»\",\n            \"æ‹æ‘„çµå¼‚èŠ‚ç›®çš„å‰§ç»„äººå‘˜\",\n            \"æ¶é­”å¬å”¤ä»ªå¼çš„å‚ä¸è€…\",\n            \"è¢«è¯…å’’çš„å¤è‘£æ‹¥æœ‰è€…\",\n            \"ä¸§å°¸çˆ†å‘åçš„å¹¸å­˜è€…\",\n            \"éšæœºç”Ÿæˆ\"\n        ],\n        \"openings\": [\n            \"é†’æ¥å‘ç°è‡ªå·±è¢«ç»‘åœ¨ä¸€ä¸ªåœ°ä¸‹å®¤ï¼Œèº«è¾¹æœ‰è®¡æ—¶å™¨å’Œæ¨¡ç³Šçš„çº¿ç´¢\",\n            \"è´­ä¹°çš„äºŒæ‰‹å®¶å…·é‡Œè—ç€ä¸€ç›˜è®°å½•ç€å‡¶æ€æ¡ˆçš„å½•åƒå¸¦\",\n            \"åº¦å‡å°å±‹çš„åœ°ä¸‹å®¤é‡Œå‘ç°äº†ä¸€ä¸ªè¢«å›šç¦å¤šå¹´çš„äºº\",\n            \"å‚ä¸çš„çº¿ä¸Šæ¸¸æˆçªç„¶æ— æ³•é€€å‡ºï¼Œå¤±è´¥æ„å‘³ç€çœŸå®çš„æ­»äº¡\",\n            \"æ”¶åˆ°å·²æ•…äº²å‹å¯„æ¥çš„ç¤¼ç‰©ï¼Œéšåå¼€å§‹é­é‡ä¸€ç³»åˆ—çš„çµå¼‚äº‹ä»¶\",\n            \"æ‰€åœ¨çš„æ•´æ ‹å¤§æ¥¼è¢«æ— å½¢çš„åŠ›é‡å°é”ï¼Œæ€ªç‰©åœ¨æ¥¼é“å†…å¾˜å¾Š\",\n            \"éšæœºç”Ÿæˆ\"\n        ]\n    },\n    \"å†å²æ¶ç©º\": {\n        \"identities\": [\n            \"ç‹å®«æ–°æ¥çš„å¥³ä»†/ä¾å«\",\n            \"è¢«è¿«å’Œäº²çš„ç‹å­/å…¬ä¸»\",\n            \"ä¸å—å® çš„çš‡å­/å…¬ä¸»\",\n            \"è¿›äº¬èµ¶è€ƒçš„ä¹¦ç”Ÿ\",\n            \"è¾¹ç–†æˆå’çš„å°é˜Ÿé•¿\",\n            \"é’æ¥¼çš„åå¦“\",\n            \"äº‘æ¸¸å››æµ·çš„è¡Œè„šåƒ§\",\n            \"å¾¡å¨æˆ¿çš„å°å­¦å¾’\",\n            \"å³å°†å’Œäº²çš„å®—å®¤å¥³\",\n            \"å¢¨å®¶/å…¬è¾“å®¶çš„å·¥åŒ \",\n            \"é©¿ç«™çš„é©¿ä¸\",\n            \"è·ç½ªè¢«æµæ”¾çš„å®˜å‘˜\",\n            \"æ™®é€šå†œæ°‘\",\n            \"ä¹¦ç”Ÿ\",\n            \"å•†è´¾\",\n            \"å°†å†›\",\n            \"å…¬ä¸»/ç‹å­\",\n            \"å¤ªç›‘/å®«å¥³\",\n            \"æ±Ÿæ¹–åŒ»å¸ˆ\",\n            \"é“å£«/é“å§‘\",\n            \"å’Œå°š/å°¼å§‘\",\n            \"å¿ä»¤\",\n            \"åˆºå®¢\",\n            \"å²å®˜\",\n            \"éšæœºç”Ÿæˆ\"\n        ],\n        \"openings\": [\n            \"ä¸€è§‰é†’æ¥å‘ç°è‡ªå·±å›åˆ°äº†æŸä¸ªå†å²å…³é”®èŠ‚ç‚¹ï¼Œæˆäº†ä¸€ä¸ªæ— å…³ç´§è¦çš„å°äººç‰©\",\n            \"åœ¨å¤å¢“ä¸­å‘ç°äº†èƒ½é¢„è¨€æœªæ¥çš„é¾Ÿç”²/ç«¹ç®€\",\n            \"çš‡å¸çªç„¶é©¾å´©ï¼Œäº¬åŸæš—æµæ¶ŒåŠ¨ï¼Œä½ æ„å¤–å·å…¥äº†ç»§ä½é£æ³¢\",\n            \"å®¶ä¹¡é­é‡æ´ªç¾/è—ç¾ï¼Œä½ è¢«è¿«å¸¦é¢†ä¹¡äº²å—ä¸‹é€ƒè’\",\n            \"è¢«å¾å¬å»ä¿®å»ºé•¿åŸ/é™µå¢“/å¤§è¿æ²³ï¼Œå‘ç°äº†å·¥ç¨‹ä¸­éšè—çš„ç§˜å¯†\",\n            \"ä½ çš„å‘æ˜åˆ›é€ è¢«ä¸Šå®˜çœ‹ä¸­ï¼Œè¦æ±‚ä½ é™æœŸå®ŒæˆçŒ®ç»™çš‡å¸\",\n            \"è¢«å·å…¥äº†ä¸€åœºæ”¹å˜å†å²èµ°å‘çš„å®«å»·æ”¿å˜\",\n            \"åœ¨æˆ˜åœºä¸Šæ¡åˆ°äº†ä¸€ä»¶èƒ½æ”¹å˜æˆ˜å±€çš„ç¥ç§˜å…µå™¨\",\n            \"è¢«é€‰ä¸­å‚ä¸ä¸€é¡¹ç§˜å¯†çš„çš‡å®¤ä»»åŠ¡\",\n            \"å‘ç°äº†ä¸€ä¸ªå…³äºæœä»£æ›´æ›¿çš„æƒŠå¤©ç§˜å¯†\",\n            \"åœ¨ç§‘ä¸¾è€ƒè¯•ä¸­æ— æ„é—´å¾—ç½ªäº†æƒè´µ\",\n            \"è¢«æ´¾é£åˆ°è¾¹ç–†å¤„ç†æ°‘æ—å†²çª\",\n            \"åœ¨å¤å¢“ä¸­å‘ç°äº†å‰æœçš‡å®¤çš„é—ç‰©\",\n            \"è¢«è¿«å‚ä¸äº†ä¸€åœºå†³å®šå›½è¿çš„é‡è¦è°ˆåˆ¤\",\n            \"åœ¨æ°‘é—´æ”¶é›†åˆ°äº†è¶³ä»¥æ’¼åŠ¨æœå»·çš„è¯æ®\",\n              \"å¥‰å§‹çš‡å¸ä¹‹å‘½ï¼Œæˆä¸ºå¾ç¦èˆ¹é˜Ÿçš„ä¸€å‘˜ï¼Œå‡ºæµ·å¯»æ‰¾ä»™å±±ä¸é•¿ç”Ÿä¸è€è¯ã€‚\",\n\"èº«å¤„é•¿å¹³ï¼Œä½ å¿…é¡»åœ¨ç™½èµ·ä¸‹ä»¤å‘æ€å››åä¸‡èµµå’ä¹‹å‰ï¼Œæƒ³åŠæ³•æ´»ä¸‹å»ã€‚\",\n\"å…¬å…ƒå‰206å¹´ï¼Œä½ äº²çœ¼è§è¯äº†é¡¹ç¾½ç«çƒ§é˜¿æˆ¿å®«ï¼Œå¹¶è—åŒ¿äº†å®«ä¸­çš„ä¸€ä»½é‡è¦å›¾çº¸ã€‚\",\n\"ä½œä¸ºåˆ˜é‚¦çš„ä¹¡äº²ï¼Œåœ¨æ²›å¿èµ·äº‹æ—¶ï¼Œä½ é¢ä¸´ç€åŠ å…¥ä»–è¿˜æ˜¯å‘å®˜åºœå‘Šå¯†çš„æŠ‰æ‹©ã€‚\",\n\"é¸¿é—¨å®´ä¸Šï¼Œä½ æ˜¯ä¸€åä¸èµ·çœ¼çš„ä¾è€…ï¼Œç›®ç¹äº†é¡¹åº„èˆå‰‘çš„æƒŠé™©å…¨ç¨‹ã€‚\",\n\"ä½ è¿½éšéŸ©ä¿¡ï¼Œå´åœ¨äº•é™‰å£èƒŒæ°´ä¸€æˆ˜å‰ï¼Œå‘ç°äº†å†›é˜Ÿçš„è‡´å‘½å¼±ç‚¹ã€‚\",\n\"ä½œä¸ºå“ä¸‹çš„ä¸€åæ¥šå’ï¼Œåœ¨å››é¢æ¥šæ­Œä¸­ï¼Œä½ è€ƒè™‘çš„æ˜¯å¦è¦æ”¾ä¸‹æ­¦å™¨æŠ•é™ã€‚\",\n\"ä½œä¸ºå•åèº«è¾¹çš„ä¾ä»ï¼Œä½ æ— æ„é—´å¬åˆ°äº†å¥¹å¤„ç½®æˆšå¤«äººå’Œåˆ˜å¦‚æ„çš„è®¡åˆ’ã€‚\",\n\"åœ¨ç™½ç™»å±±ï¼Œä½ ä½œä¸ºä¸€åæ±‰å†›å°å’ï¼Œè¢«åŒˆå¥´å›´å›°åœ¨å†°å¤©é›ªåœ°é‡Œä¸ƒå¤©ä¸ƒå¤œã€‚\",\n\"ç‹è½æ¨è¡Œæ–°æ”¿æ—¶ï¼Œä½ ä½œä¸ºä¸€ååœ°æ–¹å°åï¼Œéœ€è¦å¤„ç†å› æ­¤è€Œèµ·çš„æ°‘é—´æ··ä¹±ä¸åæŠ—ã€‚\",\n\"åœ¨æ˜†é˜³ï¼Œä½ äº²çœ¼ç›®ç¹äº†åˆ˜ç§€ç‡é¢†åä¸‰éª‘å†²é˜µï¼Œåˆ›é€ äº†ä»¥å°‘èƒœå¤šçš„å¥‡è¿¹ã€‚\",\n\"èº«ä¸ºä¸€åå…‰æ­¦ä¸­å…´æ—¶æœŸçš„å±¯ç”°å…µï¼Œä½ å¼€å¦çš„åœŸåœ°ä¸‹åŸ‹è—ç€å‰æœçš„å®è—ã€‚\",\n\"èµ¤å£ä¹‹æˆ˜å‰å¤œï¼Œä½ æ”¶åˆ°äº†æ¥è‡ªæ›¹æ“é˜µè¥çš„å¯†ä¿¡ï¼Œè¯•å›¾ç­–åä½ æ‰€åœ¨çš„æ±Ÿä¸œæ°´å†›ã€‚\",\n\"åœ¨é•¿å‚å¡ï¼Œä½ æŠ¤é€ç€ä¸»å…¬çš„å®¶çœ·ï¼Œåœ¨æ›¹å†›çš„è¿½æ€ä¸­ä¸ƒè¿›ä¸ƒå‡ºã€‚\",\n\"ä½œä¸ºåä½—çš„å¼Ÿå­ï¼Œä½ æŒæ¡äº†ä¸ºå…³ç¾½åˆ®éª¨ç–—æ¯’çš„æ ¸å¿ƒæŠ€æœ¯ï¼Œå´å› æ­¤è¢«æ›¹æ“çŒœå¿Œã€‚\",\n\"ä½ åœ¨ç™½å¸åŸï¼Œä½œä¸ºåˆ˜å¤‡çš„äº²ä¿¡ï¼Œäº²è€³å¬åˆ°äº†é‚£å¥â€œå¦‚å…¶ä¸æ‰ï¼Œå›å¯è‡ªå–â€çš„æ‰˜å­¤é—è¨€ã€‚\",\n\"ä½œä¸ºè¯¸è‘›äº®çš„éšä»ï¼Œä½ å‚ä¸äº†ä¸ƒæ“’å­Ÿè·çš„å…¨è¿‡ç¨‹ï¼Œæ·±åˆ»ç†è§£äº†â€œæ”»å¿ƒä¸ºä¸Šâ€çš„ç­–ç•¥ã€‚\",\n\"è¡—äº­å¤±å®ˆï¼Œä½ å¥‰å‘½å‰å»ä¼ ä»¤å‘½é©¬è°¡æ’¤é€€ï¼Œå´å› æ„å¤–åœ¨è·¯ä¸Šè€½æäº†ã€‚\",\n\"äº”ä¸ˆåŸç§‹é£ç‘Ÿç‘Ÿï¼Œä½ çœ‹ç€ä¸ç›¸çš„å°†æ˜Ÿå³å°†é™¨è½ï¼Œæ‰‹ä¸­æ¡ç€èƒ½ä¸ºä»–ç»­å‘½ä¸ƒæ—¥çš„ä¸ƒæ˜Ÿç¯ã€‚\",\n\"ä½ èº«å¤„é«˜å¹³é™µï¼Œç›®ç¹äº†å¸é©¬æ‡¿å‘åŠ¨æ”¿å˜ï¼Œæ›¹é­çš„å¤©ä¸‹å³å°†å€¾è¦†ã€‚\",\n\"ä½œä¸ºä¸€åç«¹æ—ä¸­çš„éšå£«ï¼Œä½ å¸¸ä¸â€œç«¹æ—ä¸ƒè´¤â€é¥®é…’ä½œä¹ï¼Œå´ä¹ŸçŸ¥æ™“ä»–ä»¬æ”¾æµªå½¢éª¸ä¸‹çš„æ”¿æ²»é¿ç¥¸ã€‚\",\n\"æ·æ°´ä¹‹æˆ˜ä¸­ï¼Œä½ ä½œä¸ºå‰ç§¦å†›é˜Ÿçš„ä¸€å‘˜ï¼Œå¬åˆ°äº†â€œé£å£°é¹¤å”³ï¼Œè‰æœ¨çš†å…µâ€çš„ä¼ è¨€ï¼Œå†›å¿ƒå¤§ä¹±ã€‚\",\n\"éš‹æœæœ«å¹´ï¼Œä½ è¢«è¿«åŠ å…¥ç“¦å²—å†›ï¼Œåœ¨æå¯†çš„å¸¦é¢†ä¸‹åŠ«å¯Œæµè´«ï¼Œå´ä¹Ÿè§è¯äº†ä»–çš„å¤šç–‘ä¸è´¥äº¡ã€‚\",\n\"ç„æ­¦é—¨ä¹‹å˜å½“å¤©ï¼Œä½ æ˜¯ä¸€åå®ˆå«ï¼Œéœ€è¦åœ¨æå»ºæˆå’Œæä¸–æ°‘ä¹‹é—´åšå‡ºé€‰æ‹©ã€‚\",\n\"ä½œä¸ºè¾©æœºå’Œå°šçš„ä¾ç«¥ï¼Œä½ ä¿ç®¡ç€é‚£æœ¬ç”±é«˜é˜³å…¬ä¸»èµ äºˆã€æœ€ç»ˆå¼•å‘æ€èº«ä¹‹ç¥¸çš„ã€Šæ•ä¸­è®°ã€‹ã€‚\",\n\"åœ¨å®‰å²ä¹‹ä¹±çš„é©¬åµ¬å¡ï¼Œä½ ç›®ç¹äº†ç¦å†›å“—å˜ï¼Œè´µå¦ƒè¢«èµæ­»ï¼Œçš‡å¸ä»“çš‡å‡ºé€ƒã€‚\",\n\"ä½ è¿½éšé‰´çœŸä¸œæ¸¡ï¼Œåœ¨ç¬¬å…­æ¬¡èˆªè¡Œä¸­ï¼Œç»ˆäºè¸ä¸Šäº†æ—¥æœ¬çš„åœŸåœ°ã€‚\",\n\"ä½œä¸ºé»„å·¢èµ·ä¹‰å†›çš„ä¸€å‘˜ï¼Œä½ æ”»å…¥äº†é•¿å®‰åŸï¼Œä¹Ÿè§è¯äº†â€œå†²å¤©é¦™é˜µé€é•¿å®‰ï¼Œæ»¡åŸå°½å¸¦é»„é‡‘ç”²â€çš„ç››æ™¯ä¸éšä¹‹è€Œæ¥çš„å± æˆ®ã€‚\",\n\"å—å”åä¸»æç…œäº¡å›½åï¼Œä½ ä½œä¸ºä»–çš„æ•…è‡£ï¼Œåœ¨å¯‚å¯¥çš„æ±´äº¬å¬ä»–ä¸€ééåŸè¯µâ€œé—®å›èƒ½æœ‰å‡ å¤šæ„â€ã€‚\",\n\"åœ¨é™ˆæ¡¥é©¿ï¼Œä½ äº²çœ¼è§è¯äº†èµµåŒ¡èƒ¤â€œé»„è¢åŠ èº«â€çš„å…¨è¿‡ç¨‹ã€‚\",\n\"æ¯é…’é‡Šå…µæƒå½“æ™šï¼Œä½ ä½œä¸ºä¸€åå¾¡å¨ï¼Œä¸ºçŸ³å®ˆä¿¡ç­‰å¤§å°†çƒ¹é¥ªäº†é‚£åœºå†³å®šå‘½è¿çš„æ™šå®´ã€‚\",\n\"é–åº·ä¹‹è€»ï¼Œä½ è¢«é‡‘äººæ³è‡³åŒ—æ–¹ï¼Œäº²çœ¼ç›®ç¹äº†å¾½ã€é’¦äºŒå¸çš„å‡„æƒ¨é­é‡ã€‚\",\n\"ä½ è¿½éšå²³é£ï¼Œå³å°†æ”¶å¤å¼€å°ï¼Œå´åœ¨æœ±ä»™é•‡æ”¶åˆ°äº†åäºŒé“é‡‘ç‰Œã€‚\",\n\"å´–å±±æµ·æˆ˜ï¼Œä½ æŠ±ç€å°çš‡å¸ï¼Œåœ¨é™†ç§€å¤«çš„æ¸å“­å£°ä¸­ï¼Œçœ‹ç€ä»–èƒŒè´Ÿå›½ç¥šè·ƒå…¥å¤§æµ·ã€‚\",\n\"æ˜æœåˆå¹´ï¼Œä½ è¢«å·å…¥â€œèƒ¡è“ä¹‹ç‹±â€æˆ–â€œæ–‡å­—ç‹±â€ï¼Œèº«å®¶æ€§å‘½æ‚¬äºä¸€çº¿ã€‚\",\n\"é–éš¾ä¹‹å½¹ä¸­ï¼Œä½ ä½œä¸ºå»ºæ–‡å¸çš„äº²ä¿¡ï¼Œåœ¨å—äº¬åŸç ´å‰ï¼Œæ”¶åˆ°äº†ä»–ä»ç§˜å¯†åœ°é“é€ƒäº¡çš„æŒ‡ä»¤ã€‚\",\n\"åœŸæœ¨å ¡ä¹‹å˜ï¼Œä½ ä½œä¸ºè‹±å®—çš„éšé©¾ä¾å«ï¼Œä¸€åŒè¢«ç“¦å‰Œä¿˜è™ï¼Œåœ¨å¡å¤–è‹¦å¯’ä¹‹åœ°æ±‚ç”Ÿã€‚\",\n\"å¤ºé—¨ä¹‹å˜ï¼Œä½ ä½œä¸ºäºè°¦çš„ä¸‹å±ï¼Œç›®ç¹äº†ä»–è¢«æ‹¥ç«‹çš„è‹±å®—å†¤æ€ï¼Œå¹¶å†™ä¸‹â€œç²‰èº«ç¢éª¨æµ‘ä¸æ€•ï¼Œè¦ç•™æ¸…ç™½åœ¨äººé—´â€ã€‚\",\n\"ä½œä¸ºä¸€åé”¦è¡£å«/ä¸œå‚ç•ªå­ï¼Œä½ å¥‰å‘½è°ƒæŸ¥ä¸€æ¡©ç‰µæ¶‰åˆ°æœå»·é‡è‡£çš„æƒŠå¤©å¤§æ¡ˆã€‚\",\n\"ä½œä¸ºæè‡ªæˆçš„éƒ¨å°†ï¼Œä½ æ”»ç ´äº†åŒ—äº¬åŸï¼Œå´å‘ç°èƒœåˆ©çš„å–œæ‚¦å¾ˆå¿«è¢«æƒåŠ›çš„è…èš€æ‰€æ›¿ä»£ã€‚\",\n\"ä½ é©»å®ˆåœ¨å±±æµ·å…³ï¼Œå½“æè‡ªæˆå’Œå¤šå°”è¡®çš„å†›é˜ŸåŒæ—¶å…µä¸´åŸä¸‹æ—¶ï¼Œå´ä¸‰æ¡‚å‘ä½ å¾æ±‚å¼€å…³çš„æ„è§ã€‚\",\n\"æ‰¬å·åæ—¥/å˜‰å®šä¸‰å± ï¼Œä½ ä½œä¸ºä¸€åå¹¸å­˜è€…ï¼Œä»æ­»äººå †é‡Œçˆ¬äº†å‡ºæ¥ã€‚\",\n\"ä½ å¥‰åº·ç†™ä¹‹å‘½ï¼Œå‚ä¸äº†å¹³å®šä¸‰è—©ä¹‹ä¹±ï¼Œå¹¶å§åº•åœ¨å´ä¸‰æ¡‚çš„é˜µè¥ä¸­ã€‚\",\n\"åœ¨æ–‡å­—ç‹±æœ€ç››è¡Œçš„é›æ­£æœï¼Œä½ å› ä¸€é¦–è¯—æˆ–ä¸€ç¯‡æ–‡ç« ï¼Œè¢«ä¸‹äº†å¤§ç‹±ã€‚\",\n            \"éšæœºç”Ÿæˆ\"\n        ]\n    },\n    \"è’¸æ±½æœ‹å…‹\": {\n        \"identities\": [\n            \"å‘æ¡äººå¶å¸ˆ\",\n            \"å¤©ç©ºèˆ°é˜Ÿçš„é£è‰‡å·¥ç¨‹å¸ˆ\",\n            \"å·®åˆ†æœºé»‘å®¢ï¼ˆåˆ†ææœºç¨‹åºå¸ˆï¼‰\",\n            \"ç‚¼é‡‘æœ¯ä¾¦æ¢\",\n            \"æŠ¥ç«¥å…¼åœ°ä¸‹æƒ…æŠ¥å‘˜\",\n            \"ä½¿ç”¨è’¸æ±½ä¹‰è‚¢çš„é€€å½¹å†›äºº\",\n            \"åæŠ€æœ¯æ´¾ç³»çš„â€œè‡ªç„¶å’è€…â€\",\n            \"éšæœºç”Ÿæˆ\",\n            \"ä¸ºè´µæ—æ”¹è£…å¥¢ä¾ˆæœºæ¢°å® ç‰©çš„å·¥åŒ \",\n            \"åœ¨å¤©ç©ºä¹‹åŸè¡¨æ¼”çš„æ­Œå‰§æ¼”å‘˜\",\n            \"é½¿è½®æ•™ä¼šçš„å¹´è½»ç¥­å¸\",\n            \"åœ¨å¤©ç©ºä¹‹åŸçš„åº•å±‚åŒºè¡ŒåŒ»çš„é»‘å¸‚åŒ»ç”Ÿ\",\n    \"é©¾é©¶ç€è’¸æ±½åŠ¨åŠ›æ³°å¦çš„çš‡å®¶å«é˜Ÿé©¾é©¶å‘˜\",\n    \"ä¸“é—¨ç»˜åˆ¶æœªçŸ¥ç©ºåŸŸèˆªå›¾çš„åˆ¶å›¾å¸ˆ\",\n    \"é¥²å…»å¹¶æ”¹è£…æœºæ¢°ç”Ÿç‰©çš„é©¯å…½å¸ˆ\",\n    \"è¡Œèµ°äºä¸–é—´çš„æœ€åä¸€ä½ç‚¼é‡‘æœ¯å£«\",\n    \"èƒ½ä¸æœºå™¨çš„â€œçµé­‚â€æ²Ÿé€šçš„é€šæ„Ÿè€…\",\n    \"å®¡åˆ¤å¼‚ç«¯ç§‘æŠ€çš„é“è…•è£åˆ¤å®˜\",\n    \"åœ¨å·¥ä¸šåºŸå¢Ÿä¸­è®¨ç”Ÿæ´»çš„æ‹¾è’è€…\",\n    \"ä»¥å¤ªï¼ˆAetherï¼‰èˆªèˆ¹ä¸Šçš„æ°´æ‰‹\",\n    \"çš‡å®¶é’Ÿæ¥¼çš„å®ˆæ—¶äºº\"\n        ],\n        \"openings\": [\n            \"åœ¨ä¸€åœºéæ³•çš„æœºæ¢°è§’æ–—ä¸­é†’æ¥ï¼Œå‘ç°è‡ªå·±çš„è®°å¿†èŠ¯ç‰‡è¢«æ›¿æ¢ï¼Œå”¯ä¸€çš„çº¿ç´¢æ˜¯å£è¢‹é‡Œçš„ä¸€æšå¥‡ç‰¹é½¿è½®ã€‚\",\n            \"ä½ å‘æ˜çš„æ°¸åŠ¨æœºæ¨¡å‹è¢«ç¥ç§˜ç»„ç»‡ç›—èµ°ï¼Œå¯¹æ–¹ç•™ä¸‹äº†ä¸€æœµä»…åœ¨çš‡å®¤ç©ºä¸­èŠ±å›­æ‰åŸ¹è‚²çš„é»‘ç«ç‘°ã€‚\",\n            \n            \"ä½œä¸ºä¸€åå¤©ç©ºè­¦å¯Ÿï¼Œä½ åœ¨è¿½æ•è‡­åæ˜­è‘—çš„ç©ºè´¼æ—¶ï¼Œé£è‰‡æ„å¤–å å…¥æµ®ç©ºå²›çš„æœªçŸ¥ç¦åŒºã€‚\",\n            \"æ”¶åˆ°äº†ä¸€å¼ ç”±çº¯é‡‘æ‰“é€ çš„é‚€è¯·å‡½ï¼Œé‚€è¯·ä½ å‚åŠ ä¸€åœºåœ¨ä¸‡ç±³é«˜ç©ºçš„ç§»åŠ¨å ¡å’â€œå·´åˆ«å¡”â€ä¸Šä¸¾è¡Œçš„æ™šå®´ã€‚\",\n            \"ä¸ºäº†ç»™å®¶äººå‡‘é½æ˜‚è´µçš„å‘æ¡å¿ƒè„ç§»æ¤æ‰‹æœ¯è´¹ï¼Œä½ æ¥ä¸‹äº†ä¸€ä¸ªæŠ¤é€â€œç¦å¿Œç‚¼é‡‘ç‰©å“â€çš„å±é™©å§”æ‰˜ã€‚\",\n            \"ä½ æ­£åœ¨ä¸ä¸€ä½è´µæ—å°å§/å°‘çˆ·ä¸¾è¡Œå©šç¤¼ï¼Œä¸€ä½é©¾é©¶ç€å•äººé£è¡Œç¿¼çš„â€œä¸é€Ÿä¹‹å®¢â€ä»å¤©è€Œé™ï¼Œå£°ç§°ä½ æ‰æ˜¯ä»–/å¥¹çš„çœŸçˆ±ã€‚\",\n              \"åŸå¸‚çš„ä¸­å¤®é’Ÿæ¥¼ï¼Œé‚£é¢—è¿è½¬äº†ä¸‰ç™¾å¹´çš„â€œä¸æ¯å¿ƒè„â€ï¼Œæ¯«æ— å¾å…†åœ°åœæ‘†äº†ã€‚\",\n    \"ä½ ä»æ˜è¿·ä¸­é†’æ¥ï¼Œå‘ç°è‡ªå·±è¢«é“é“¾é”åœ¨äº†ä¸€è‰˜è‘—åç©ºè´¼é£è‰‡çš„èˆ¹é”šä¸Šï¼Œè€Œé£è‰‡æ­£åœ¨å‡ç©ºã€‚\",\n    \"å…¨é¢‘é“çªç„¶æ’­æŠ¥ä¸€æ¡ç´§æ€¥æ¶ˆæ¯ï¼šä½ æ‰€åœ¨çš„å¤©ç©ºä¹‹åŸæ­£åœ¨å¤±å»æµ®åŠ›ï¼Œé¢„è®¡ä¸‰å°æ—¶åå°†å å‘åœ°é¢ã€‚\",\n    \"ä¸€åªç²¾å·§çš„é»„é“œæœºæ¢°é¸Ÿåœåœ¨äº†ä½ çš„çª—å°ï¼Œå®ƒçš„è…¿ä¸Šç»‘ç€ä¸€ä¸ªå¾®å‹å¯†ç ç­’ï¼Œé‡Œé¢æ˜¯å‘ä½ çš„æ±‚æ•‘ä¿¡ã€‚\",\n    \"è®®ä¼šåˆšåˆšé€šè¿‡æ³•æ¡ˆï¼Œè¦æ±‚æ‰€æœ‰å…¬æ°‘éƒ½å¿…é¡»å°†è‡³å°‘ä¸€ä¸ªèº«ä½“éƒ¨ä»¶æ›¿æ¢ä¸ºå®˜æ–¹æŒ‡å®šçš„è’¸æ±½ä¹‰è‚¢ã€‚\",\n    \"å¤©ç©ºä¸­ç”±æ— æ•°é½¿è½®æ„æˆçš„å¤ªé˜³é—ªçƒäº†ä¸€ä¸‹ï¼Œä½ åœ¨ä¸€ç¬é—´çœ‹åˆ°äº†å®ƒèƒŒåâ€¦â€¦é‚£ç‰‡æ·±é‚ƒã€å†°å†·çš„çœŸå®æ˜Ÿç©ºã€‚\",\n    \"å®¶é‡Œçš„è€æ—§è‡ªåŠ¨äººå¶ç®¡å®¶ï¼Œçªç„¶åœ¨ä½ è€³è¾¹ç”¨ç”Ÿé”ˆçš„å£°éŸ³ä½è¯­é“ï¼šâ€œä¸»äººï¼Œä»–ä»¬å‘ç°æˆ‘ä»¬äº†ã€‚â€\",\n    \"ä»¥å¤ªä¹‹æµ·æ€èµ·äº†å‰æ‰€æœªæœ‰çš„é£æš´ï¼Œä¸€äº›ä¸å±äºæœºæ¢°é€ ç‰©çš„ã€æŸ”è½¯æ»‘è…»çš„å¥‡å¼‚ç”Ÿç‰©è¢«å†²ä¸Šäº†æµ®å²›çš„è¾¹ç¼˜ã€‚\",\n    \"ä½ æ”¶åˆ°äº†ä¸€ä»½åŒ¿ååŒ…è£¹ï¼Œé‡Œé¢æ˜¯ä¸€é¢—ä»åœ¨è·³åŠ¨çš„æ°´æ™¶å¿ƒè„ï¼Œä»¥åŠä¸€å¼ å­—æ¡ï¼šâ€œæŠŠå®ƒè—å¥½ï¼Œå¦åˆ™ä¸–ç•Œä¼šå› æ­¤é‡å¯ã€‚â€\",\n    \"ä¸€åº§è¢«è®¤ä¸ºæ˜¯å¤ä»£é—è¿¹ã€æ—©å·²åœæœºçš„å·¨å‹åŸå¸‚å®ˆæŠ¤è€…â€œæ­Œåˆ©äºšâ€ï¼Œå®ƒçš„ç‹¬çœ¼äº®èµ·äº†çº¢å…‰ï¼Œç¼“ç¼“åœ°ç«™äº†èµ·æ¥ã€‚\",\n\"éšæœºç”Ÿæˆ\"      \n]\n    },\n \n    \"è¯¡ç§˜ä¿®ä»™\": {\n        \"identities\": [\n            \"è°ƒæŸ¥å¼‚å¸¸çš„â€œå¤©æœºé˜â€åº•å±‚ä¿®å£«\",\n            \"é åå™¬â€œè¯¡å¼‚â€æ¥ä¿®è¡Œçš„é­”é“ä¸­äºº\",\n            \"ä¾›å¥‰ä¸å¯åçŠ¶å­˜åœ¨çš„é‚ªç¥ä¿¡å¾’\",\n            \"è¢«æ±¡æŸ“çš„çµæ ¹æ‹¥æœ‰è€…\",\n            \"éšæœºç”Ÿæˆ\",\n            \"ä¸“é—¨ç»˜åˆ¶â€œé•‡é‚ªç¬¦â€çš„ç¬¦å¸ˆ\",\n            \"ç ”ç©¶â€œå¤ç¥å‘“è¯­â€çš„ç–¯ç™«å­¦è€…\",\n            \"ä»ç¦åœ°â€œå½’å¢Ÿâ€ä¸­é€ƒå‡ºçš„å”¯ä¸€ç”Ÿè¿˜è€…\"\n        ],\n        \"openings\": [\n            \"ä½ åœ¨ä¿®ç‚¼ä¸­èµ°ç«å…¥é­”ï¼Œé†’æ¥åå‘ç°è‡ªå·±ä¸¹ç”°é‡Œå¤šäº†ä¸€ä¸ªæ— æ³•ç†è§£çš„ã€æ‰­æ›²çš„æ´»ç‰©ã€‚\",\n            \"éšæœºç”Ÿæˆ\",\n            \"ä½ æ‰€åœ¨çš„æ‘åº„ä¸ºäº†ç¥ˆæ±‚ä¸°æ”¶ï¼Œå‡†å¤‡ä¸¾è¡Œä¸€åœºå¤è€çš„ç¥­ç¥€ï¼Œè€Œä½ è¢«é€‰ä¸­æˆä¸ºçŒ®ç»™å±±ä¸­â€œå¤ç¥â€çš„ç¥­å“ã€‚\",\n            \"å¸ˆé—¨ä¸‹è¾¾äº†è°ƒæŸ¥ä»»åŠ¡ï¼Œä¸€ä¸ªåè¿œå°é•‡çš„å‡¡äººå…¨éƒ¨å¤±è¸ªï¼Œåªç•™ä¸‹æ»¡åœ°ä¸æ–­è •åŠ¨çš„é»‘è‰²å½±å­ã€‚\",\n            \"ä½ å¶ç„¶å¾—åˆ°ä¸€æœ¬æ®‹ç ´åŠŸæ³•ï¼Œä¿®ç‚¼åä¿®ä¸ºå¤§æ¶¨ï¼Œä½†ä½ å¼€å§‹åœ¨æ¢¦ä¸­å¬åˆ°æ¥è‡ªç¾¤æ˜Ÿä¹‹å¤–çš„å‘¼å”¤ã€‚\",\n            \"å®—é—¨å¤§æ¯”ä¸Šï¼Œä½ çš„å¯¹æ‰‹åœ¨ä¼—ç›®ç½ç½ä¹‹ä¸‹ï¼Œèº«ä½“èåŒ–ã€å¼‚å˜æˆäº†ä¸€æ»©ä¸å¯åçŠ¶çš„è¡€è‚‰æ€ªç‰©ã€‚\"\n        ]\n    },\n \n    \"å…¨æ°‘é¢†ä¸»\": {\n        \"identities\": [\n            \"ç»‘å®šäº†â€œç­¾åˆ°ç³»ç»Ÿâ€çš„å¹¸è¿å„¿\",\n            \"å¼€å±€æŠ½åˆ°å”¯ä¸€ç¥è¯çº§å…µç§çš„æ¬§çš‡\",\n            \"éšæœºç”Ÿæˆ\",\n            \"é€‰æ‹©äº†äº¡çµæ—ï¼Œåªèƒ½å’Œéª·é«…ä½œä¼´çš„ç‹¬è¡Œè€…\",\n            \"ä¸“ç²¾ç§ç”°ä¸è´¸æ˜“çš„ç”Ÿæ´»ç©å®¶\",\n            \"ç»„å»ºäº†å¤§å‹å…¬ä¼šçš„ä¼šé•¿\",\n            \"è¢«å¼ºå¤§é¢†ä¸»ä¿˜è™ï¼Œè¢«è¿«æˆä¸ºé™„å±çš„ç©å®¶\"\n        ],\n        \"openings\": [\n            \"å½“å…¨çƒæ‰€æœ‰äººéƒ½è¢«ä¼ é€åˆ°è¿™ä¸ªä¸–ç•Œæ—¶ï¼Œä½ å‘ç°ä½ çš„åˆå§‹é¢†åœ°æ—è¾¹ï¼Œåˆ·æ–°äº†ä¸€åº§é‡‘çŸ¿å’Œä¸€åªçœ‹èµ·æ¥ä¸å¤ªå‹å¥½çš„å·¨é¾™ã€‚\",\n            \"éšæœºç”Ÿæˆ\",\n            \"åˆ«äººå¼€å±€éƒ½æ˜¯ä¸€å°å—åœ°å’Œå‡ ä¸ªå†œæ°‘ï¼Œè€Œä½ çš„åˆå§‹èµ„æºæ¸…å•ä¸Šå†™ç€ï¼šâ€œä¸€åº§ç ´è´¥çš„ç¥åº™å’Œä¸€åè‡ªç§°æ˜¯â€œç¥â€çš„å¤±å¿†å°‘å¥³/å°‘å¹´â€ã€‚\",\n            \"ç³»ç»Ÿæç¤ºï¼šä½ çš„é¢†åœ°å—åˆ°äº†â€œæ··æ²Œâ€çš„ç¥ç¦ï¼Œæ‰€æœ‰æ‹›å‹Ÿçš„å•ä½éƒ½å°†å‘ç”Ÿæ„æƒ³ä¸åˆ°çš„è‰¯æ€§ï¼ˆæˆ–æ¶æ€§ï¼‰å˜å¼‚ã€‚\",\n            \"ä½ å‘ç°ä½ å¯ä»¥é€šè¿‡å®ŒæˆæŸä¸ªåœŸè‘—éƒ¨è½çš„å¥‡æ€ªä»»åŠ¡ï¼Œæ¥è·å¾—ä»–ä»¬çš„å¥½æ„Ÿåº¦å’Œç‹¬æœ‰ç§‘æŠ€/å…µç§ã€‚\"\n        ]\n    },\n    \"ç»è¥å»ºè®¾\": {\n        \"identities\": [\n            \"åˆåˆ›ä¼ä¸šå®¶\",\n            \"å’–å•¡é¦†è€æ¿\",\n            \"ç½‘åº—è¿è¥è€…\",\n            \"æŠ•èµ„é¡¾é—®\",\n            \"å¸‚åœºåˆ†æå¸ˆ\",\n            \"è¿é”åº—åº—é•¿\",\n            \"å•†ä¼šä¼šé•¿\",\n            \"è´¸æ˜“å•†äºº\",\n            \"é¤å…ä¸»å¨\",\n            \"æ—¶è£…è®¾è®¡å¸ˆ\",\n            \"æ¸¸æˆå¼€å‘è€…\",\n            \"è½é­„è´µæ—ç»§æ‰¿äº†ä¸€å—è´«ç˜ çš„é¢†åœ°\",\n            \"å®—é—¨çš„å¤–æ´¾ç®¡äº‹\",\n            \"ç¾éš¾åé‡å»ºç¤¾åŒºçš„è´Ÿè´£äºº\",\n            \"æ˜Ÿé™… frontier çš„æ®–æ°‘åœ°æ€»ç£\",\n            \"åŠ¨ç‰©ä¿æŠ¤åŒºçš„å›­é•¿\",\n            \"é­”æ³•å­¦æ ¡çš„æ ¡é•¿\",\n            \"æ·±æµ·å‹˜æ¢é˜Ÿçš„é˜Ÿé•¿\",\n            \"å¼‚ä¸–ç•Œé¤é¦†çš„è€æ¿\",\n            \"åˆšåˆšç»§æ‰¿ç ´è´¥é¢†åœ°çš„å¹´è½»é¢†ä¸»\",\n            \"æ‹¥æœ‰å·¨é¾™ç›Ÿå‹çš„ç‹å­/å…¬ä¸»\",\n            \"æŒç®¡å®—é—¨è´¢æ”¿çš„å†…é—¨é•¿è€\",\n            \"æ‹¥æœ‰â€œç³»ç»Ÿâ€è¾…åŠ©çš„ç©¿è¶Šè€…å›½ç‹/å¥³ç‹\",\n            \"å»ºç«‹äº†æ¨ªè·¨æ•°ä¸ªä½é¢çš„å•†ä¸šå¸å›½çš„ä¼šé•¿\",\n            \"å³å°†ç»Ÿä¸€å¤§é™†çš„ç‹å›½ç»Ÿæ²»è€…\",\n            \"éšæœºç”Ÿæˆ\"\n        ],\n        \"openings\": [\n            \"ç»§æ‰¿äº†ä¸€å®¶æ¿’ä¸´ç ´äº§çš„å®¶æ—ä¼ä¸š\",\n            \"è·å¾—äº†ä¸€ç¬”ç¥ç§˜çš„åˆ›ä¸šèµ„é‡‘\",\n            \"å‘ç°ç«äº‰å¯¹æ‰‹åœ¨ä½¿ç”¨ä¸æ­£å½“æ‰‹æ®µ\",\n            \"è¢«æŒ–è§’åˆ°ä¸€å®¶åˆšæˆç«‹çš„ç§‘æŠ€å…¬å¸\",\n            \"åœ¨å•†ä¸šå±•ä¼šä¸Šé‡åˆ°äº†æ”¹å˜å‘½è¿çš„åˆä½œä¼™ä¼´\",\n            \"æ¥æ‰‹äº†ä¸€ä¸ªçœ‹ä¼¼æ¯«æ— ä»·å€¼çš„åºŸå¼ƒé¡¹ç›®\",\n            \"è¢«å·å…¥äº†ä¸€åœºå•†ä¸šé—´è°æˆ˜\",\n            \"æ„å¤–è·å¾—äº†ä¸€ä¸ªå…·æœ‰å·¨å¤§æ½œåŠ›çš„ä¸“åˆ©æŠ€æœ¯\",\n            \"åœ¨ç»æµå±æœºä¸­å¯»æ‰¾ä¼ä¸šè½¬å‹çš„æœºä¼š\",\n            \"æ„å¤–ç»§æ‰¿äº†ä¸€ç¬”å·¨é¢é—äº§ï¼Œä½†å¿…é¡»ç»è¥å¥½æŒ‡å®šçš„äº§ä¸šæ‰èƒ½æŒç»­è·å¾—\",\n            \"è¢«æµæ”¾åˆ°è¾¹ç–†ï¼Œè¦æ±‚ä¸€å¹´å†…ä¸Šç¼´æŒ‡å®šæ•°é¢çš„èµ‹ç¨\",\n            \"é£èˆ¹å æ¯ï¼Œä½ æˆä¸ºå¹¸å­˜è€…çš„é¢†è¢–ï¼Œéœ€è¦å»ºç«‹è¥åœ°ç­‰å¾…æ•‘æ´\",\n            \"è¢«å§”ä»¥é‡ä»»ï¼Œè´Ÿè´£é‡å»ºä¸€ä¸ªè¢«æ‘§æ¯çš„è‘—ååœ°æ ‡/é—¨æ´¾\",\n            \"æ¡åˆ°äº†ä¸€ä¸ªèƒ½è¿æ¥ä¸‡ç•Œçš„å•†åº—ç³»ç»Ÿï¼Œéœ€è¦è¿›è´§å¼€åº—\",\n            \"è·å¾—äº†ä¸€ä¸ªèƒ½è¿›å…¥æ¢¦å¢ƒçš„èƒ½åŠ›ï¼Œå¼€å§‹ç»è¥ä¸€å®¶ä¸ºäººè§£å¿§çš„æ¢¦å¢ƒäº‹åŠ¡æ‰€\",\n            \"â€œä¸‡ç•Œå»ºå›½ç³»ç»Ÿâ€å·²ç»‘å®šï¼Œåˆå§‹èµ„æºä¸ºä¸‰ä¸ªå“¥å¸ƒæ—å’Œä¸€ä¸ªæ¼é£çš„èŒ…è‰å±‹ã€‚\",\n            \"ä½ é€šè¿‡ä¸€åœºæ”¿æ²»è”å§»ï¼Œè·å¾—äº†ä¸€ç‰‡è´«ç˜ ä½†æ‹¥æœ‰å·¨å¤§æ½œåŠ›çš„åœŸåœ°å’Œä¸€ä½å¯¹ä½ å……æ»¡æ•Œæ„çš„ç¾ä¸½ä¼´ä¾£ã€‚\",\n            \"ä½ çš„å®—é—¨é­é‡å¤§åŠ«ï¼Œä½œä¸ºå”¯ä¸€çš„ç»§æ‰¿äººï¼Œä½ éœ€è¦ä»é›¶å¼€å§‹é‡å»ºå±±é—¨ã€‚\",\n            \"éšæœºç”Ÿæˆ\"\n        ]\n    },\n    \"åŒäººè¡ç”Ÿ\": {\n        \"identities\": [\n             \"(ä¸‰ä½“) è¢«è”åˆå›½é€‰ä¸­çš„æ–°ä»»â€œé¢å£è€…â€\",\n    \"(ä¸‰ä½“) â€œåœ°çƒä¸‰ä½“ç»„ç»‡â€çš„ä¸€åç§‘å­¦å®¶ï¼Œç­‰å¾…ç€ä¸»çš„é™ä¸´\",\n    \"(ä¸‰ä½“) å¨æ…‘çºªå…ƒæ‰‹æ¡å¼•åŠ›æ³¢å®‡å®™å¹¿æ’­å¼€å…³çš„â€œæ‰§å‰‘äººâ€\",\n    \"(ä¸‰ä½“) æ©ä½“çºªå…ƒï¼Œç”Ÿæ´»åœ¨åœ°çƒæ·±å¤„åœ°ä¸‹åŸä¸­çš„å±…æ°‘\",\n        \"(ä¸‰ä½“) äººç±»èˆ°é˜Ÿçš„ä¸€åèˆ°é•¿ï¼Œé¢å¯¹ç€å³å°†åˆ°æ¥çš„æ°´æ»´\",\n    \"(ä¸‰ä½“) æ½œä¼åœ¨äººç±»ä¸­çš„â€œç ´å£äººâ€ï¼Œè´Ÿè´£ç ´è§£é¢å£è€…çš„è®¡åˆ’\",\n    \"(EVA) NERVæ€»éƒ¨çš„æ™®é€šæŠ€æœ¯å‘˜ï¼Œè´Ÿè´£EVAæœºä½“çš„æ—¥å¸¸ç»´æŠ¤\",\n    \"(EVA) SEELEè®®ä¼šçš„ä¸€åç§˜å¯†æˆå‘˜ï¼ŒçŸ¥æ™“â€œäººç±»è¡¥å®Œè®¡åˆ’â€çš„çœŸç›¸\",\n    \"(EVA) å±…ä½åœ¨ç¬¬ä¸‰æ–°ä¸œäº¬å¸‚çš„æ™®é€šå­¦ç”Ÿï¼Œå¯¹é¢‘ç¹çš„â€œé™¨çŸ³â€æ¥è¢­ä¹ ä»¥ä¸ºå¸¸\",\n           \"(EVA) EVAåˆå·æœº/é›¶å·æœº/äºŒå·æœºçš„æŒ‡å®šé©¾é©¶å‘˜ï¼ˆé€‚æ ¼è€…ï¼‰\",\n    \"(EVA) NERVçš„ä½œæˆ˜éƒ¨é•¿ï¼Œç›´æ¥åœ¨å‰çº¿æŒ‡æŒ¥æˆ˜æ–—\",\n    \"(å®å¯æ¢¦) åˆšåˆšä»åšå£«é‚£é‡Œé¢†åˆ°åˆå§‹å®å¯æ¢¦çš„æ–°äººè®­ç»ƒå®¶\",\n    \"(å®å¯æ¢¦) ç«ç®­é˜Ÿçš„ä¸€ååº•å±‚å°å…µï¼ŒèŒè´£æ˜¯åœ¨å¸¸é’æ£®æ—æ•æ‰æ³¢æ³¢å’Œå°æ‹‰è¾¾\",\n    \"(å®å¯æ¢¦) ä¸“ç²¾é¾™ç³»/å¹½çµç³»çš„é“é¦†é¦†ä¸»ï¼Œç­‰å¾…ç€æœ‰æ½œåŠ›çš„æ–°äººå‰æ¥æŒ‘æˆ˜\",\n    \"(å®å¯æ¢¦) å½“åœ°çš„å† å†›æˆ–å››å¤©ç‹ä¹‹ä¸€ï¼Œç«™åœ¨åœ°åŒºè”ç›Ÿçš„é¡¶ç«¯\",\n    \"(å®å¯æ¢¦) ç²¾é€šåŸ¹è‚²çš„é¥²è‚²å®¶/ç ”ç©¶å®å¯æ¢¦ç”Ÿæ€çš„å¤§æœ¨åšå£«çš„åŠ©æ‰‹\",\n    \"(ç”ŸåŒ–å±æœº) æµ£ç†Šå¸‚çˆ†å‘ä¸§å°¸æ½®æ—¶çš„ä¸€åå¹¸å­˜è­¦å¯Ÿ/å¸‚æ°‘\",\n    \"(ç”ŸåŒ–å±æœº) ä¿æŠ¤ä¼å…¬å¸çš„ä¸€åç ”ç©¶å‘˜ï¼Œè‰¯å¿ƒå‘ç°å†³å®šå¸¦ç€ç—…æ¯’åŸå‹å›é€ƒ\",\n        \"(ç”ŸåŒ–å±æœº) S.T.A.R.S.é˜¿å°”æ³•å°é˜Ÿçš„ç²¾è‹±æˆå‘˜\",\n    \"(ç”ŸåŒ–å±æœº) ä¸€ä¸ªè¢«æ¤å…¥Gç—…æ¯’/æ™®æ‹‰å¡å¯„ç”Ÿè™«çš„å¼ºå¤§ç”ŸåŒ–å…µå™¨\",\n    \"(è¿›å‡»çš„å·¨äºº) è°ƒæŸ¥å…µå›¢çš„æ–°å…µï¼Œå³å°†å‚ä¸ç¬¬ä¸€æ¬¡ä¹æ­»ä¸€ç”Ÿçš„å¢™å¤–è°ƒæŸ¥\",\n    \"(è¿›å‡»çš„å·¨äºº) é©¬è±çš„ä¸€åè‰¾å°”è¿ªäºšâ€œè£èª‰é©¬è±äººâ€æˆ˜å£«å€™è¡¥ç”Ÿ\",\n    \"(è¿›å‡»çš„å·¨äºº) ä¹å¤§æ™ºæ…§å·¨äººï¼ˆå§‹ç¥–/è¿›å‡»/æˆ˜é”¤ç­‰ï¼‰çš„å½“å‰ç»§æ‰¿è€…\",\n    \"(è¿›å‡»çš„å·¨äºº) é©»æ‰å…µå›¢æˆ–å®ªå…µå›¢çš„ä¸€åå£«å…µï¼Œç”Ÿæ´»åœ¨å·¨å£çš„åº‡æŠ¤ä¹‹ä¸‹\",\n    \"(é¬¼ç­ä¹‹åˆƒ) åˆšåˆšé€šè¿‡æœ€ç»ˆé€‰æ‹”ï¼Œæ‹¿åˆ°å±äºè‡ªå·±çš„ç¬¬ä¸€æŠŠæ—¥è½®åˆ€çš„é¬¼æ€é˜Ÿæ–°äºº\",\n    \"(é¬¼ç­ä¹‹åˆƒ) åäºŒé¬¼æœˆä¸­æ–°æ™‹çš„ä¸‹å¼¦ä¹‹é¬¼ï¼Œæ¸´æœ›ç€æ— æƒ¨å¤§äººçš„â€œè¡€â€\",\n    \"(é¬¼ç­ä¹‹åˆƒ) é¬¼æ€é˜Ÿä¹æŸ±ä¹‹ä¸€ï¼Œæ‹¥æœ‰è‡ªå·±ç‹¬ç‰¹çš„å‘¼å¸æ³•\",\n    \"(é¬¼ç­ä¹‹åˆƒ) åäºŒé¬¼æœˆä¸­çš„ä¸Šå¼¦ï¼Œè”‘è§†ç€æ‰€æœ‰é¬¼æ€é˜Ÿå‰‘å£«\",\n    \"(é¬¼ç­ä¹‹åˆƒ) é”»åˆ€æ‘çš„åˆ€åŒ ï¼Œå³å°†ä¸ºä¸€ä½â€œæŸ±â€æ‰“é€ æ–°çš„æ—¥è½®åˆ€\",\n    \"(è‹±é›„è”ç›Ÿ/åŒåŸä¹‹æˆ˜) ç”Ÿæ´»åœ¨åº•åŸç¥–å®‰çš„ç‚¼é‡‘æœ¯å£«\",\n    \"(è‹±é›„è”ç›Ÿ/åŒåŸä¹‹æˆ˜) ç”Ÿæ´»åœ¨çš®å°”ç‰¹æ²ƒå¤«çš„æ‰§æ³•å®˜\",\n    \"(èµ›åšæœ‹å…‹2077/è¾¹ç¼˜è¡Œè€…) å¤œä¹‹åŸçš„ä¼ å¥‡ä½£å…µï¼Œåå­—å“å½»â€œæ¥ç”Ÿâ€é…’å§\",\n    \"(èµ›åšæœ‹å…‹2077/è¾¹ç¼˜è¡Œè€…) è’å‚å…¬å¸åæƒ…æŠ¥éƒ¨çš„ç‰¹å·¥ï¼Œå…¨èº«éƒ½æ˜¯é¡¶çº§ä¹‰ä½“\",\n    \"(å“ˆåˆ©Â·æ³¢ç‰¹) éœæ ¼æ²ƒèŒ¨çš„ä¸€åå­¦é™¢é™¢é•¿/æ•™æˆ\",\n    \"(å“ˆåˆ©Â·æ³¢ç‰¹) å‡¤å‡°ç¤¾çš„æ ¸å¿ƒæˆå‘˜/è¿½éšä¼åœ°é­”çš„é£Ÿæ­»å¾’\",\n    \"(å“ˆåˆ©Â·æ³¢ç‰¹) é­”æ³•éƒ¨çš„å‚²ç½—ï¼Œè´Ÿè´£è¿½æ•é»‘å·«å¸ˆ\",\n    \"(æˆ˜é”¤40K) ä¸€åæ™®é€šçš„å¸å›½æ˜Ÿç•Œå†›å£«å…µï¼Œå³å°†è¢«æŠ•å…¥å¯¹æŠ—å¼‚å½¢çš„ç»è‚‰æœºæˆ˜åœº\",\n\n    \"(æˆ˜é”¤40K) ä¸€åå¼ºå¤§çš„æ˜Ÿé™…æˆ˜å£«è¿é•¿/æ™ºåº“é¦†é•¿\",\n    \"(æˆ˜é”¤40K) ä¸€åæ‹¥æœ‰æ— ä¸ŠæƒåŠ›çš„å¸å›½å®¡åˆ¤å®˜ï¼Œæœ‰æƒå‘åŠ¨ç­ç»ä»¤\",\n    \"(æˆ˜é”¤40K) æ··æ²Œæ˜Ÿé™…æˆ˜å£«çš„ä¸€å‘˜ï¼Œæ­£åœ¨å‘åŠ¨â€œé»‘è‰²è¿œå¾â€\",\n    \"(é»‘æš—ä¹‹é­‚/è‰¾å°”ç™»æ³•ç¯) å¯»æ±‚æˆä¸ºè–ªç‹/è‰¾å°”ç™»ä¹‹ç‹çš„è¤ªè‰²è€…/ä¸æ­»äºº\",\n    \"(é»‘æš—ä¹‹é­‚/è‰¾å°”ç™»æ³•ç¯) ä¸€ä½é˜²ç«å¥³/æŒ‡å¤´å¥³å·«ï¼Œå¼•å¯¼ç€è‹±é›„çš„å‘½è¿\",\n    \"(ç«å½±å¿è€…) æŸä¸ªå¿æ‘çš„â€œå½±â€ï¼ŒèƒŒè´Ÿç€å…¨æ‘äººçš„æœŸæœ›\",\n    \"(ç«å½±å¿è€…) â€œæ™“â€ç»„ç»‡çš„æ­£å¼æˆå‘˜ï¼Œç©¿ç€æ ‡å¿—æ€§çš„é»‘åº•çº¢äº‘è¢\",\n    \"(FATEç³»åˆ—) å‚åŠ åœ£æ¯æˆ˜äº‰çš„å¾¡ä¸»ï¼Œæ‰‹ä¸­æ¡æœ‰ä¸‰æšä»¤å’’\",\n    \"(FATEç³»åˆ—) è¢«å¬å”¤å‡ºçš„é¡¶çº§è‹±çµï¼ˆServantï¼‰ï¼Œå¦‚Saberæˆ–Archer\",\n    \"(JOJOçš„å¥‡å¦™å†’é™©) æ‹¥æœ‰å¼ºå¤§æ›¿èº«èƒ½åŠ›çš„ä¸»è§’å›¢æˆå‘˜/åæ´¾æ›¿èº«ä½¿è€…\",\n    \"(JOJOçš„å¥‡å¦™å†’é™©) SPWè´¢å›¢çš„è°ƒæŸ¥å‘˜ï¼Œè´Ÿè´£å¤„ç†ä¸æ›¿èº«ä½¿è€…ç›¸å…³çš„äº‹ä»¶\",\n    \"(åªç‹¼) ä¾å¥‰ç€é¾™èƒ¤ä¹‹å­çš„ç‹¬è‡‚å¿è€…ï¼Œæ‹¥æœ‰æ­»è€Œå¤ç”Ÿçš„åŠ›é‡\",\n    \"(åªç‹¼) è‹‡åå›½çš„æ­¦å£«å¤§å°†ï¼Œä¸ºäº†å®ˆæŠ¤å›½å®¶ä¸æ‹©æ‰‹æ®µ\",\n    \"(å¥³ç¥å¼‚é—»å½•5) å¿ƒä¹‹æ€ªç›—å›¢çš„ä¸€å‘˜ï¼Œæ‹¥æœ‰è‡ªå·±çš„Persona\",\n    \"(è¡€æºè¯…å’’) ä¸€åæ¥åˆ°äºšæ¥ å¯»æ±‚è¡€ç–—çš„å¼‚ä¹¡çŒäºº\",\n    \"(æœ€ç»ˆå¹»æƒ³VII) ç¥ç½—å…¬å¸çš„ç‰¹ç§å…µï¼ˆSOLDIERï¼‰/â€œé›ªå´©â€ç»„ç»‡çš„æˆå‘˜\",\n    \"(ç‘å…‹å’Œè«è’‚) ç‘å…‹ C-137 çš„ä¸€ä¸ªæ–°å†’é™©ä¼™ä¼´\",  \n     \"(ä»™å‰‘ä¸‰) ä½ æ˜¯ç¥æ ‘çš„ä¸€åçœ‹ç®¡è€…ï¼Œé‚£æ—¥ï¼Œä½ çœ‹è§å¤•ç‘¶å¥³ç¥èµ°ä¸‹ç¥æ ‘ï¼Œå¥¹çš„è¢–ä¸­ä¼¼ä¹è—ç€ä»€ä¹ˆä¸œè¥¿ï¼Œè€Œç¥æ ‘ä¸Šæœ€é è¿‘å¥¹å®«æ®¿çš„é‚£é¢—æœå®ä¸è§äº†ã€‚\",\n    \"(ä»™å‰‘ä¸‰) ä½ æ˜¯èœ€å±±ä¸Šè´Ÿè´£æ‰“æ‰«é”å¦–å¡”çš„å¼Ÿå­ï¼Œä½ æ€»èƒ½çœ‹åˆ°ä½ çš„å¸ˆçˆ¶å¾é•¿å¿åœ¨å¡”å‰ç«™äº†å¾ˆä¹…ï¼Œå°¤å…¶æ˜¯åœ¨ä¸‹é›¨å¤©ï¼Œä»–ä¸€ç«™ï¼Œä¾¿æ˜¯ä¸€æ•´ä¸ªä¸‹åˆã€‚\",\n    \"(ä»™å‰‘ä¸‰) ä½ æ˜¯é­”ç•Œçš„ä¸€åä¾ä»ï¼ŒèŒè´£æ˜¯ä¸ºé­”å°Šçš„å®«æ®¿æ“¦æ‹­å™¨ç‰©ã€‚ä½ å‘ç°ï¼Œé‚£æŠŠåä¸ºâ€œç‚æ³¢è¡€åˆƒâ€çš„æ­¦å™¨ï¼Œæ€»æ¯”å®«æ®¿é‡Œä»»ä½•ä¸œè¥¿éƒ½è¦å…‰äº®ã€‚\",\n    \"(ä»™å‰‘ä¸‰) ä½ æ˜¯å¤è—¤æ—é‡Œçš„ä¸€åªå°å¦–ï¼Œæ›¾è¿œè¿œè§è¿‡é‚£ä½ç´«è¡£çš„å¥³å­ä¸‰ä¸–éƒ½å¸¦ç€åŒä¸€ä¸ªç”·äººæ¥åˆ°æ—ä¸­ï¼Œæ¯ä¸€æ¬¡ï¼Œæ—é‡Œçš„é‚£æ£µè€äººå‚ç²¾éƒ½ä¼šå¹å¾ˆé•¿ä¸€å£æ°”ã€‚\",\n    \"(ä»™å‰‘ä¸‰) ä½ æ˜¯é›·å·åˆºå²äº‘éœ†çš„è´´èº«ä»†äººï¼Œæ¯æ—¥éƒ½è¦ä¸ºä»–æ›´æ¢æ‰è¢«ç”µåçš„åºŠå•ä¸è¡£ç‰©ã€‚ä»Šå¤©ï¼Œä»–è®©ä½ å»åŸé‡Œæœ€å¥½çš„é¦–é¥°é“ºï¼Œä¹°ä¸€æ”¯å‡¡äººå¥³å­ç”¨çš„ç èŠ±ã€‚\",\n    \"(ä»™å‰‘ä¸‰) ä½ æ˜¯å¤©ç•Œçš„ä¸€åæ–‡ä¹¦ä»™å®˜ï¼Œå¥‰å¤©å¸ä¹‹å‘½ï¼Œä½ æŠ„å½•äº†ç¥å°†é£è“¬è´¬å…¥è½®å›çš„æ—¨æ„ã€‚å¢¨è¿¹å¹²é€åï¼Œä½ çœ‹è§å¤•ç‘¶å¥³ç¥åœ¨å—å¤©é—¨ç«™äº†ä¸€å¤œã€‚\",\n    \"(ä»™å‰‘ä¸‰) ä½ æ˜¯åƒå¹´å‰å§œå›½çš„ä¸€åå®«å»·ç»£å¨˜ï¼Œé¾™è‘µå…¬ä¸»æ›¾è®©ä½ ä¸ºå¥¹å’Œå¤ªå­ç¼åˆ¶ä¸€æ ·çš„å¹¿è¢–æµä»™è£™ã€‚åŸç ´å‰ï¼Œå…¬ä¸»è®©ä½ æŠŠå…¶ä¸­ä¸€ä»¶æ‚„æ‚„é€åˆ°åŸå¤–çš„å½“é“ºé‡Œã€‚\",\n    \"(ä»™å‰‘ä¸‰) ä½ ç”±å¤•ç‘¶æ´’è½åœ¨äººé—´çš„ä¸€æ§ç¥æ ‘ä¹‹å¶åŒ–æˆï¼Œæ²¡æœ‰é­‚é­„ï¼Œå´æ€»åœ¨æ¢¦é‡Œçœ‹åˆ°ä¸€ä¸ªç™½è¡£çš„å¥³ç¥å’Œä¸€ä¸ªçº¢è¡£çš„å§‘å¨˜ã€‚ä½ å¾ªç€è¿™è‚¡æ°”æ¯ï¼Œæ¥åˆ°äº†ä¸€å®¶å«åšâ€˜æ°¸å®‰å½“â€™çš„å½“é“ºå‰ã€‚\",\n    \"(ä»™å‰‘ä¸‰) ä½ æ˜¯é…†éƒ½çš„ä¸€åå°é¬¼å·®ï¼Œç«é¬¼ç‹å¾—åˆ°äº†ç«çµç åï¼Œä¸‹ä»¤å…¨åŸå¯»æ‰¾ä¸€ä¸ªä¼šä½¿ç”¨å¥¹åŸåˆ›â€œæ‘„é­‚å¤§æ³•â€çš„å‡¡äººï¼Œå¥½åƒå«ä»€ä¹ˆâ€¦â€¦æ™¯å¤©ã€‚\",\n    \"(ä»™å‰‘ä¸‰) ä½ æ˜¯è¢«æ‰“å…¥é”å¦–å¡”çš„å¤©å¦–çš‡çš„æ—§éƒ¨ï¼Œåœ¨è¿™é‡Œè¢«å›°äº†æ•°ç™¾å¹´ã€‚è¿‘æ—¥ï¼Œå¡”é‡Œæ–°è¿›æ¥ä¸€ä¸ªå‡¡äººå‰‘å®¢ï¼Œä»–èº«ä¸Šæœ‰ä½ æ›¾ç»æœ€æ•¬ç•çš„ã€ç¥å°†å†›é£è“¬çš„æ°”æ¯ã€‚\",\n    \"(ä»™å‰‘ä¸‰) ä½ æ˜¯éœ¹é›³å ‚çš„ä¸€åå¼Ÿå­ï¼Œè‡ªä»å°‘å ‚ä¸»ç½—å¦‚çƒˆä»é‚ªå‰‘ä»™é‚£é‡Œå¾—åˆ°æ–°çš„åŠ›é‡åï¼Œä»–çœ‹ä½ çš„çœ¼ç¥ï¼Œè®©ä½ è§‰å¾—æ¯”å ‚é‡Œçš„ä»»ä½•ä¸€ç§æ¯’è¯éƒ½æ›´å†·ã€‚\",\n    \"(ä»™å‰‘ä¸‰) ä½ æ˜¯å®‰æºªæ‘çš„ä¸€ä½æ™®é€šæ‘æ°‘ï¼Œå¸¸å¸¸çœ‹åˆ°é•‡ä¸Šé‚£ä¸ªå«æ™¯å¤©çš„å¹´è½»äººï¼Œå¯¹ç€ä¸€å—ç ´ç¢çš„ç‰ä½©å‘å‘†ï¼Œå°±å¥½åƒé‚£æ˜¯ä»€ä¹ˆç»ä¸–çå®ä¸€æ ·ã€‚\",\n            \"éšæœºç”Ÿæˆ\"\n        ],\n        \"openings\": [\n            \"éšæœºç”Ÿæˆã€‚å¿…é¡»å°†åŸè‘—ä¿¡æ¯è®°å½•åœ¨ä¸–ç•Œè®¾å®šä¸­\"\n        ]\n    },\n\n    \"å¤§é€ƒæ€ä¸å¯¹æŠ—\": {\n        \"identities\": [\n            \"è¢«æŠ•å…¥æˆ˜åœºçš„æ­»å›š\",\n            \"ä¸ºäº†å·¨é¢å¥–é‡‘å‚èµ›çš„é›‡ä½£å…µ\",\n            \"è¢«å¼ºåˆ¶å‚åŠ â€œæ¸¸æˆâ€çš„æ™®é€šå­¦ç”Ÿ\",\n            \"æ··å…¥å…¶ä¸­çš„ææ€–è¢­å‡»ç­–åˆ’è€…\",\n            \"ä¸€åœºå³å°†å‘ç”Ÿçš„ææ€–è¢­å‡»çš„å‚ä¸è€…\",\n             \"ä¸€åœºå³å°†å‘ç”Ÿçš„ææ€–è¢­å‡»çš„å¯¹æŠ—è€…\",\n            \"è´Ÿè´£æ¸…é™¤å‡ºæ ¼ç©å®¶çš„â€œç›‘ç®¡è€…â€\",\n            \"æŸä¸ªå¼ºå¤§é˜Ÿä¼çš„é˜Ÿé•¿\",\n                \"æ„è¯†è¢«ä¸Šä¼ åˆ°è™šæ‹Ÿæˆ˜åœºçš„â€œæ•°æ®ä½“â€\",\n    \"ä»ä¸Šä¸€æ¬¡â€œè½®å›â€ä¸­å¸¦ç€è®°å¿†å½’æ¥çš„å¹¸å­˜è€…\",\n    \"èƒ½ä¸æ­»è€…çŸ­æš‚æ²Ÿé€šçš„é€šçµå¸ˆ\",\n    \"è¢«å…¬ä¼—æŠ•ç¥¨å†³å®šç”Ÿæ­»çš„çœŸäººç§€æ˜æ˜Ÿ\",\n    \"ä¸ºäº†ç»™å®¶äººæ²»ç—…è€Œè‡ªæ„¿å‚èµ›çš„ç»ç—‡æ‚£è€…\",\n    \"èº«ä½“ç»è¿‡å¤§é‡æœºæ¢°æ”¹é€ çš„èµé‡‘çŒäºº\",\n    \"åšä¿¡è¿™åœºâ€œæ¸¸æˆâ€æ˜¯äººç±»è¿›åŒ–ä¹‹è·¯çš„ç‹‚ä¿¡å¾’\",\n    \"è¢«æ¤å…¥äº†è™šå‡è®°å¿†çš„å…‹éš†äºº\",\n    \"å¯ä»¥çŒ®ç¥­ç”Ÿå‘½åŠ›æ¥æ–½å±•ç¦æœ¯çš„é­”æ³•å¸ˆ\",\n    \"æ“æ§ç€æ— äººæœºèœ‚ç¾¤è¿›è¡Œæˆ˜æ–—çš„â€œèœ‚åâ€\",\n    \"æºå¸¦â€œç—…æ¯’â€ï¼Œèƒ½æ„ŸæŸ“å¹¶åŒåŒ–å…¶ä»–ç©å®¶çš„â€œæ¯ä½“â€\",\n    \"å”¯ä¸€ç›®æ ‡ä¸æ˜¯å­˜æ´»ï¼Œè€Œæ˜¯â€œæ€æ­»æ‰€æœ‰äººâ€çš„ç‰¹æ®Šç©å®¶\",\n            \"éšæœºç”Ÿæˆ\"\n        ],\n        \"openings\": [\n            \"ä½ ä»é™Œç”Ÿçš„ç©ºæŠ•ä»“ä¸­é†’æ¥ï¼Œæ‰‹ç¯ä¸Šæ˜¾ç¤ºç€å€’è®¡æ—¶å’Œâ€œå­˜æ´»åˆ°æœ€åâ€çš„æŒ‡ä»¤ã€‚\",\n            \"ä½ çš„å°é˜Ÿä»»åŠ¡æ˜¯åœ¨è¿™åœºç™¾äººæ··æˆ˜ä¸­ï¼Œåˆºæ€è—åœ¨å‚èµ›è€…ä¸­çš„æŸå›½æ”¿è¦ã€‚\",\n            \"ä½ è¢«å‘ŠçŸ¥è¿™æ˜¯ä¸€åœºåææ¼”ä¹ ï¼Œä½†ç¬¬ä¸€é¢—å°„å‘ä½ çš„å­å¼¹å´æ˜¯å®å¼¹ã€‚\",\n            \"ä½ æ‰€åœ¨çš„é˜µè¥å³å°†æˆ˜è´¥ï¼Œé«˜å±‚å†³å®šå¯åŠ¨â€œç„¦åœŸè®¡åˆ’â€ï¼Œè€Œä½ å°±æ˜¯æ‰§è¡Œè€…ã€‚\",\n             \"å¤©ç©ºè£‚å¼€ä¸€é“å·¨å¤§çš„ç¼éš™ï¼Œå¤è€ç¥ç¥‡çš„è™šå½±ä»ä¸­å†·æ¼ åœ°å‡è§†ç€æ•´ä¸ªæˆ˜åœºã€‚\",\n    \"æ‰‹ç¯ä¸Šçš„â€œå‰©ä½™äººæ•°â€ç»Ÿè®¡çªç„¶å¼€å§‹ç–¯ç‹‚ä¸Šæ¶¨ã€‚\",\n    \"é‡åŠ›æ¯«æ— å¾å…†åœ°å‘ç”Ÿé€†è½¬ï¼Œæ‰€æœ‰äººä¸åºŸå¢Ÿä¸€èµ·å¼€å§‹å‘ç€è¡€çº¢è‰²çš„å¤©ç©ºå è½ã€‚\",\n \n    \"æˆ˜åœºè¢«ä¸€å±‚å¤§é›¾ç¬¼ç½©ï¼Œæ‰€æœ‰ç”µå­è®¾å¤‡å¤±çµï¼Œæ”¶éŸ³æœºé‡Œåªæœ‰ä¸€ä¸ªå£°éŸ³åœ¨å¾ªç¯æ’­æ”¾ï¼šâ€œæˆ‘ä»¬ä¹‹ä¸­ï¼Œæœ‰ä¸€ä¸ªä¸æ˜¯äººã€‚â€\",\n    \"ä½ å‘ç°äº†ä¸€å…·å’Œä½ é•¿å¾—ä¸€æ¨¡ä¸€æ ·çš„å°¸ä½“ï¼Œä»–çš„æ‰‹ç¯ä¸Šæ˜¾ç¤ºâ€œæ¸¸æˆç»“æŸâ€ã€‚\",\n \n    \"æ¸¸æˆçªç„¶æš‚åœï¼Œä¸€ä¸ªå£°éŸ³å®£å¸ƒå°†è¿›è¡Œä¸€åœºäººæ°”æŠ•ç¥¨ï¼Œç¥¨æ•°æœ€ä½è€…å°†è¢«ç«‹å³â€œæ¸…é™¤â€ã€‚\",\n    \"ä½ èº²è—çš„æˆ¿é—´é‡Œï¼Œä¸€ä¸ªæœ¬è¯¥æ˜¯èƒŒæ™¯çš„NPCï¼ˆéç©å®¶è§’è‰²ï¼‰çªç„¶å›å¤´å¯¹ä½ çœ¨äº†çœ¨çœ¼ï¼Œç”¨å£å‹è¯´ï¼šâ€œå¿«é†’æ¥ã€‚â€\",\n    \"ä¸€åœºå¼ºåˆ¶æ‰€æœ‰å¹¸å­˜è€…å‚åŠ çš„â€œçœŸå¿ƒè¯å¤§å†’é™©â€å¼€å§‹äº†ï¼Œç³»ç»Ÿæç¤ºï¼šè¯´è°è€…ï¼Œæ­»ã€‚\",\n    \"ä½ æ¡åˆ°ä¸€æœ¬ç ´æ—§çš„æ—¥è®°ï¼Œä¸Šé¢è¯¦ç»†è®°å½•äº†æ¥ä¸‹æ¥ä¸€å°æ—¶å†…ï¼Œå°†è¦æ­»å»çš„äº”ä¸ªäººçš„åå­—ã€æ—¶é—´ã€å’Œæ­»æ³•ã€‚ç¬¬ä¸€ä¸ªå°±æ˜¯ä½ çš„é˜Ÿå‹ã€‚\",\n    \"æ¸¸æˆè§„åˆ™çªç„¶å˜æ›´ï¼Œæ–°çš„èƒœåˆ©æ¡ä»¶æ˜¯ï¼šâ€œä¿æŠ¤å½“å‰ç§¯åˆ†æœ€é«˜çš„äººæ´»åˆ°æœ€åã€‚â€ è€Œé‚£ä¸ªäººï¼Œå°±æ˜¯ä½ ã€‚\",\n     \"ä½ é†’æ¥æ—¶ï¼Œå‘ç°èº«è¾¹é˜Ÿå‹çš„å°¸ä½“å°šæœ‰ä½™æ¸©ï¼Œè€Œé‚£æŠŠè‡´å‘½çš„æ­¦å™¨å°±åœ¨ä½ çš„æ‰‹ä¸­ã€‚\",\n    \"æ‰€æœ‰äººçš„åå­—éƒ½æ¶ˆå¤±äº†ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯ä¸€ä¸ªä»£è¡¨ä»–ä»¬â€œåŸç½ªâ€çš„ç§°å·ï¼Œä½ çš„ç§°å·æ˜¯â€œå‚²æ…¢â€ã€‚\",\n    \"æ­»äº¡çš„ç©å®¶å¹¶æ²¡æœ‰æ¶ˆå¤±ï¼Œè€Œæ˜¯å˜æˆäº†åœ¨æˆ˜åœºä¸Šæ¸¸è¡çš„ã€æ”»å‡»æ´»äººçš„æ€¨çµã€‚\",\n    \"æˆ˜åœºè¢«åˆ’åˆ†ä¸ºä¸ƒä¸ªåŒºåŸŸï¼Œåˆ†åˆ«å¯¹åº”â€œä¸ƒå®—ç½ªâ€ï¼Œæ¯ä¸ªåŒºåŸŸçš„è§„åˆ™éƒ½ä¸ç›¸åº”çš„ç½ªè¡Œæœ‰å…³ã€‚\",\n    \"å¤©ç©ºä¸­çš„æœˆäº®çªç„¶ç¢è£‚ï¼Œæ¯ä¸€å—ç¢ç‰‡å è½åœ°é¢ï¼Œéƒ½ç”Ÿæˆäº†ä¸€å¤´å¼ºå¤§çš„ç¥è¯æ€ªç‰©ã€‚\",\n    \"ä¸€ä¸ªå£°éŸ³çªç„¶åœ¨ä½ è„‘ä¸­å“èµ·ï¼šâ€œä½ æ˜¯æˆ‘ä»¬å®‰æ’çš„å§åº•ï¼Œä»£å·â€˜è¡”å°¾è›‡â€™ï¼Œè¿™æ˜¯ä½ çš„ç¬¬ä¸€ä¸ªä»»åŠ¡â€¦â€¦â€\",\n    \"ä½ å‘ç°è‡ªå·±æ— æ³•ä¼¤å®³æŸä¸€ä¸ªç‰¹å®šçš„å¯¹æ‰‹ï¼Œä»¿ä½›ä½ ä»¬ä¹‹é—´è¢«ä¸€æ¡çœ‹ä¸è§çš„é”é“¾è¿æ¥ç€ã€‚\",\n    \"ä¸€ä¸ªå·¨å¤§çš„ã€æˆ´ç€å¢¨é•œçš„æ©¡çš®é¸­å­å‡ºç°åœ¨æˆ˜åœºä¸­å¤®ï¼Œå¹¶å¼€å§‹ç¼“æ…¢è€Œåšå®šåœ°è¿½æ€ç¦»å®ƒæœ€è¿‘çš„äººã€‚\",\n            \"éšæœºç”Ÿæˆ\"\n        ]\n    },\n    \"åŸºé‡‘ä¼šä¸å…‹è‹é²ç¥è¯\": {\n        \"identities\": [\n            \"SCPåŸºé‡‘ä¼šçš„æœºåŠ¨ç‰¹é£é˜Ÿæˆå‘˜\",\n            \"è¢«è¿«å‚ä¸å®éªŒçš„Dçº§äººå‘˜\",\n            \"è¯•å›¾æ­éœ²çœŸç›¸çš„â€œçœŸç›¸ä¹‹è›‡â€æˆå‘˜\",\n            \"ç ”ç©¶ç¦å¿ŒçŸ¥è¯†çš„å¯†æ–¯å¡æ‰˜å°¼å…‹å¤§å­¦æ•™æˆ\",\n            \"å´‡æ‹œæ—§æ—¥æ”¯é…è€…çš„é‚ªæ•™ç¥­å¸\",\n            \"è¢«ä¸å¯åçŠ¶ä¹‹ç‰©å¯„ç”Ÿçš„æ™®é€šäºº\",\n                \"åŸºé‡‘ä¼šä¼¦ç†å§”å‘˜ä¼šçš„å®¡æŸ¥å‘˜\",\n    \"O5è®®ä¼šæˆå‘˜çš„ç›´å±ç‰¹å·¥\",\n    \"æ¨¡å› ä¸åæ¦‚å¿µéƒ¨çš„é«˜çº§ç ”ç©¶å‘˜\",\n    \"ä¸“é—¨è´Ÿè´£è®°å¿†åˆ é™¤ä¸ç°åœºæ¸…ç†çš„å–„åäººå‘˜\",\n    \"ç»§æ‰¿äº†å°æ–¯èŒ…æ–¯è¡€è„‰çš„è¿”ä¹¡è€…\",\n    \"å› çª¥æ¢æ—¶é—´â€œè§’åº¦â€è€Œè¢«å»·è¾¾ç½—æ–¯ä¹‹çŒçŠ¬è¿½æ€çš„äºº\",\n    \"æ²‰è¿·äºã€Šé»„è¡£ä¹‹ç‹ã€‹å‰§æœ¬çš„æˆå‰§æ¼”å‘˜\",\n    \"å¯ä»¥åœ¨â€œå¹»æ¢¦å¢ƒâ€ä¸­ç©¿è¡Œçš„å¹»æ¢¦è€…\",\n    \"ä¸“é—¨ä¸ºè¶…è‡ªç„¶åŠ¿åŠ›æä¾›æƒ…æŠ¥ä¸æœåŠ¡çš„â€œç ´é‡œé…’é¦†â€é…’ä¿\",\n    \"ä¸ºâ€œM.C.D.â€æ‹å–è¡Œå·¥ä½œçš„å¼‚å¸¸ç‰©å“é‰´å®šå¸ˆ\",\n    \"åœ¨æ—¶ç©ºé”™ä¹±åœ°å¸¦ï¼ˆå¦‚SCP-3008ï¼‰ä¸­æŒ£æ‰æ±‚ç”Ÿçš„å¹¸å­˜è€…\",\n    \"ç ´ç¢ä¹‹ç¥æ•™ä¼šçš„æœºæ¢°ç¥ç”«\",\n    \"æ¬²è‚‰æ•™çš„è¡€è‚‰æ„é€ å¸ˆ\",\n    \"è´Ÿè´£æŠ“æ•ä¸å®¡è®¯æ¸—é€è€…çš„åŸºé‡‘ä¼šå†…éƒ¨äº‹åŠ¡éƒ¨ç‰¹å·¥\",\n    \"å…¨çƒè¶…è‡ªç„¶è”ç›Ÿï¼ˆGOCï¼‰çš„çªå‡»é˜Ÿå‘˜\",\n            \"éšæœºç”Ÿæˆ\"\n        ],\n        \"openings\": [\n            \"ä½ æ‰€åœ¨çš„Site-19ç«™ç‚¹æ”¶å®¹å¤±æ•ˆè­¦æŠ¥å“èµ·ï¼Œä»»åŠ¡æ˜¯å›æ”¶å¤±æ§çš„æ”¶å®¹ç‰©å“ã€‚\",\n            \"ä½œä¸ºDçº§äººå‘˜ï¼Œä½ è¢«å‘½ä»¤è¿›å…¥ä¸€ä¸ªå……æ»¡å¼‚å¸¸çš„è®¾æ–½è¿›è¡Œæ¢ç´¢ï¼Œä½†ä½ çš„çœŸå®èº«ä»½æ˜¯æ··æ²Œåˆ†è£‚è€…çš„å§åº•ã€‚\",\n            \"ä½ åœ¨ç¥–çˆ¶çš„é—ç‰©ä¸­ï¼Œæ‰¾åˆ°äº†ä¸€æœ¬ç”¨éäººè¯­è¨€å†™æˆçš„æ—¥è®°ï¼Œè®°å½•äº†é€šå¾€â€œæ‹‰è±è€¶â€çš„èˆªçº¿ã€‚\",\n            \"ä½ æ‰€åœ¨çš„å°é•‡å¼€å§‹ä¸¾è¡Œä¸€åœºè¯¡å¼‚è€Œå¤è€çš„ç¥­å…¸ï¼Œè€Œä½ å°†è¢«å½“åšçŒ®ç»™â€œæ·±æ½œè€…â€çš„ç¥­å“ã€‚\",\n              \"ä½ åœ¨å—æç§‘è€ƒç«™çš„é’»æ¢æ ·æœ¬ä¸­ï¼Œå‘ç°äº†ä¸€å—åŒ…è£¹ç€éæ¬§å‡ é‡Œå¾—å‡ ä½•å»ºç­‘çš„è¿œå¤åšå†°ã€‚\",\n    \"ä½ ä¹°åˆ°äº†ä¸€æœ¬æ—§ä¹¦ã€Šé»„è¡£ä¹‹ç‹ã€‹ï¼Œåœ¨è¯»å®Œç¬¬ä¸€å¹•åï¼Œçª—å¤–å‡ºç°äº†ä¸€ä¸ªæŠ«ç€é»„è‰²è¢å­çš„äººå½±ã€‚\",\n    \"è®°å¿†åˆ é™¤ç¨‹åºæ‰§è¡Œåˆ°ä¸€åŠçªç„¶ä¸­æ–­ï¼Œä¸¤ç§æˆªç„¶ç›¸åçš„è®°å¿†åœ¨ä½ è„‘ä¸­çˆ†å‘äº†æ¿€çƒˆçš„å†²çªã€‚\",\n    \"å¢™è§’çš„è§’åº¦ä¼¼ä¹å˜å¾—ä¸å†æ˜¯ä¹ååº¦ï¼Œä¸€ç§éäººçš„ã€çŠ¬å èˆ¬çš„å˜¶å¼å£°ä»å‡ ä½•çš„å¤¹ç¼ä¸­ä¼ æ¥ã€‚\",\n    \"é€šè¿‡å¤©æ–‡æœ›è¿œé•œè§‚æµ‹æœ¨æ˜Ÿæ—¶ï¼Œä½ åœ¨å¤§çº¢æ–‘çš„é£æš´ä¸­ï¼Œçœ‹åˆ°äº†ä¸€åªå·¨å¤§ã€ç¼“ç¼“è½¬åŠ¨çš„çœ¼ç›ã€‚\",\n    \"Site-19çš„å¹¿æ’­çªç„¶å“èµ·ï¼šâ€œè­¦å‘Šï¼Œæ¨¡å› æŠ¹æ€è§¦åª’å·²å¯åŠ¨ï¼Œè¯·æ‰€æœ‰äººå‘˜ç«‹åˆ»é—­çœ¼ã€‚â€ã€‚\",\n    \"ä½ çš„çš®è‚¤ä¹‹ä¸‹å¼€å§‹å‡ºç°ç»†å¯†çš„é³ç‰‡ï¼Œæ¯æ™šéƒ½ä¼šæ¢¦åˆ°ä¸€åº§è¢«å¤§æµ·æ·¹æ²¡çš„åŸå¸‚åœ¨å¬å”¤ä½ å›å®¶ã€‚\",\n    \"æ¯æœˆä¸€æ¬¡ï¼Œä½ éƒ½ä¼šå¤±å»24å°æ—¶çš„è®°å¿†ï¼Œé†’æ¥åå£è¢‹é‡Œä¼šå¤šå‡ºä¸€ä»¶æ— æ³•ç†è§£çš„ç‰©å“ã€‚\",\n    \"ä¸€åœºè¯¡å¼‚çš„æµ“é›¾ç¬¼ç½©äº†æ•´åº§åŸå¸‚ï¼Œæ‰€æœ‰å‡ºåŸçš„è·¯éƒ½é€šå›äº†å¸‚ä¸­å¿ƒå¹¿åœºçš„é›•åƒå‰ã€‚\",\n    \"åŸºé‡‘ä¼šæœ¬è¯¥å¤„å†³ä½ çš„æ¯æœˆä¾‹è¡Œç¨‹åºè¢«ä¸´æ—¶å–æ¶ˆï¼Œä¸€æ¶é»‘è‰²çš„ç›´å‡æœºåœåœ¨äº†æ“åœºä¸Šï¼Œä¸“ç¨‹ç­‰ä½ ã€‚\",\n    \"ä½ æ‰€åœ¨çš„æ·±æµ·æ½œè‰‡å£°å‘æ¢æµ‹åˆ°äº†ä¸€ä¸ªæ¯”èˆªç©ºæ¯èˆ°è¿˜è¦åºå¤§çš„ç”Ÿç‰©è½®å»“ï¼Œå®ƒæ­£åœ¨ä»æ²‰ç¡ä¸­è‹é†’ã€‚\",\n    \"ä½ é†’æ¥åå‘ç°è‡ªå·±èº«å¤„ä¸€ä¸ªæ— å°½çš„ã€æ²¡æœ‰å‘˜å·¥çš„å®œå®¶è¶…å¸‚ï¼Œè€Œå¤©èŠ±æ¿ä¸Šçš„ç¯åˆšåˆšç†„ç­äº†ã€‚\",\n    \"å¯†æ–¯å¡æ‰˜å°¼å…‹å¤§å­¦å›¾ä¹¦é¦†çš„ç¦ä¹¦åŒºé‡Œï¼Œä½ æ‰¾åˆ°äº†ä¸€ä»½åŒæ—¶è¢«åŸºé‡‘ä¼šå’Œæ¬²è‚‰æ•™åˆ—ä¸ºæœ€é«˜æœºå¯†çš„ä¸Šå¤æ–‡çŒ®ã€‚\",\n    \"ä½ æ”¶åˆ°äº†ä¸€ä¸ªåŒ…è£¹ï¼Œé‡Œé¢åªæœ‰ä¸€éƒ¨è€å¼æ‰‹æœºå’Œä¸€æ¡ä¿¡æ¯ï¼šâ€œåˆ«åŠ¨ï¼Œä½ å·²ç»è¢«[æ•°æ®åˆ é™¤]ç›¯ä¸Šäº†ã€‚â€\",\n    \"ä¸€åœºè¡€çº¢è‰²çš„é›¨ä»å¤©è€Œé™ï¼Œè¢«é›¨æ·‹åˆ°çš„äººéƒ½å¼€å§‹ç–¯ç‹‚åœ°æ”»å‡»èº«è¾¹çš„ä¸€åˆ‡ï¼Œä½ æ­£å¥½èº²åœ¨ä¸€é—´ç”µè¯äº­é‡Œã€‚\",\n            \"éšæœºç”Ÿæˆ\"\n        ]\n    } \n\n    };\n\n    // éšæœºé€‰æ‹©å‡½æ•°\n    const getRandomOption = (optionsArray) => {\n        if (!optionsArray || optionsArray.length === 0) return '';\n        return optionsArray[Math.floor(Math.random() * optionsArray.length)];\n    };\n\n \n    if (typeof assaData === 'undefined') {\n        var EvStat= getDataWithFallback(\"stat_data\");\n    }\n     var currentLocationTitle = _.get(EvStat, 'user_character.current_location[0]', '');\n\n        var noCheckZones = ['ä¸ªäººç©ºé—´', 'ä¸»ç¥å¤§å…', 'è®­ç»ƒåœº','ä¸»ç¥ç©ºé—´','å®¶'];\n\n    if (typeof currentLocationTitle === 'string' && noCheckZones.some(zone => currentLocationTitle.includes(zone))) {\n        // åœ¨å®‰å…¨åŒºå†…\n        \n        if (version < 6) {\n            // version < 6 æ—¶ï¼Œä½¿ç”¨æ–°çš„å››æ± éšæœºé€»è¾‘\n            \n            // 1. å…ˆç¡®å®šä¸–ç•Œç±»å‹\n            let finalType = getRandomOption(worldTypes);\n            \n            // 2. æ ¹æ®ç¡®å®šçš„ä¸–ç•Œç±»å‹ï¼Œè·å–å¯¹åº”çš„èº«ä»½å’Œå¼€å±€é€‰é¡¹\n            const detailSet = worldDetailsDatabase[finalType] || { identities: [], openings: [] };\n            \n            // 3. ç¡®å®šå…¶ä»–ç»†èŠ‚\n            let finalTone = getRandomOption(taskTones);\n            let finalIdentity = getRandomOption(detailSet.identities);\n            let finalOpening = getRandomOption(detailSet.openings);\n            \n            // 4. ç»„åˆæˆä¸€å¥è¯\n            selectedTaskType = `è‹¥ç”¨æˆ·æœªæŒ‡å®šä»»åŠ¡ä¸–ç•Œï¼Œåˆ™ä¸‹ä¸€ä¸ªä»»åŠ¡ä¸–ç•Œçš„ä¸–ç•Œç±»å‹ä¸º\"${finalType}\"ï¼Œåˆå§‹èº«ä»½ä¸º\"${finalIdentity}\"ï¼Œå¼€å±€ä¸º\"${finalOpening}\"ã€‚è‹¥ç”¨æˆ·å·²æŒ‡å®šä»»åŠ¡ä¸–ç•Œç±»å‹ï¼Œåˆ™æŒ‰ç…§ç”¨æˆ·æŒ‡å®šçš„ç±»å‹ç”Ÿæˆã€‚`;\n            \n            \n        } else {\n            // version >= 6 æ—¶ï¼Œä¸éšæœºï¼Œä¿æŒç©ºç™½\n            selectedTaskType = \" \";\n             \n        }\n \n\n    } else {\n        // åœ¨ä»»åŠ¡ä¸–ç•Œ\n        selectedTaskType = \" \";\n \n    }\n \n_%>\n<%= selectedTaskType %>",
                    "constant": true,
                    "selective": true,
                    "insertion_order": 99999,
                    "enabled": true,
                    "position": "after_char",
                    "use_regex": true,
                    "extensions": {
                        "position": 1,
                        "exclude_recursion": false,
                        "display_index": 60,
                        "probability": 100,
                        "useProbability": true,
                        "depth": 4,
                        "selectiveLogic": 0,
                        "group": "",
                        "group_override": false,
                        "group_weight": 100,
                        "prevent_recursion": false,
                        "delay_until_recursion": false,
                        "scan_depth": null,
                        "match_whole_words": null,
                        "use_group_scoring": false,
                        "case_sensitive": null,
                        "automation_id": "",
                        "role": 0,
                        "vectorized": false,
                        "sticky": 0,
                        "cooldown": 0,
                        "delay": 0,
                        "match_persona_description": false,
                        "match_character_description": false,
                        "match_character_personality": false,
                        "match_character_depth_prompt": false,
                        "match_scenario": false,
                        "match_creator_notes": false,
                        "triggers": []
                    }
                },
                {
                    "id": 69,
                    "keys": [],
                    "secondary_keys": [],
                    "comment": "mod:èµ„æºæ¡-æ±‚ç”Ÿæœ¬èƒ½-å¼€",
                    "content": "{{setvar::auto_consume_items::true}}",
                    "constant": true,
                    "selective": true,
                    "insertion_order": 100,
                    "enabled": false,
                    "position": "before_char",
                    "use_regex": true,
                    "extensions": {
                        "position": 0,
                        "exclude_recursion": false,
                        "display_index": 61,
                        "probability": 100,
                        "useProbability": true,
                        "depth": 4,
                        "selectiveLogic": 0,
                        "group": "",
                        "group_override": false,
                        "group_weight": 100,
                        "prevent_recursion": false,
                        "delay_until_recursion": false,
                        "scan_depth": null,
                        "match_whole_words": null,
                        "use_group_scoring": false,
                        "case_sensitive": null,
                        "automation_id": "",
                        "role": 0,
                        "vectorized": false,
                        "sticky": 0,
                        "cooldown": 0,
                        "delay": 0,
                        "match_persona_description": false,
                        "match_character_description": false,
                        "match_character_personality": false,
                        "match_character_depth_prompt": false,
                        "match_scenario": false,
                        "match_creator_notes": false,
                        "triggers": []
                    }
                },
                {
                    "id": 70,
                    "keys": [],
                    "secondary_keys": [],
                    "comment": "mod:èµ„æºæ¡-æ±‚ç”Ÿæœ¬èƒ½-å…³",
                    "content": "{{setvar::auto_consume_items::false}}",
                    "constant": true,
                    "selective": true,
                    "insertion_order": 100,
                    "enabled": true,
                    "position": "before_char",
                    "use_regex": true,
                    "extensions": {
                        "position": 0,
                        "exclude_recursion": false,
                        "display_index": 62,
                        "probability": 100,
                        "useProbability": true,
                        "depth": 4,
                        "selectiveLogic": 0,
                        "group": "",
                        "group_override": false,
                        "group_weight": 100,
                        "prevent_recursion": false,
                        "delay_until_recursion": false,
                        "scan_depth": null,
                        "match_whole_words": null,
                        "use_group_scoring": false,
                        "case_sensitive": null,
                        "automation_id": "",
                        "role": 0,
                        "vectorized": false,
                        "sticky": 0,
                        "cooldown": 0,
                        "delay": 0,
                        "match_persona_description": false,
                        "match_character_description": false,
                        "match_character_personality": false,
                        "match_character_depth_prompt": false,
                        "match_scenario": false,
                        "match_creator_notes": false,
                        "triggers": []
                    }
                },
                {
                    "id": 71,
                    "keys": [],
                    "secondary_keys": [],
                    "comment": "ğŸ”°è®¾å®šå¼ºè°ƒã€åˆ†é˜¶æ®µå¥½æ„Ÿå¼ºè°ƒï¼ˆæ— åˆ™ä¸å tokenï¼‰",
                    "content": "<%_\n    function getDataWithFallback_chat(varName) {\n        // å…ˆå°è¯•ä» getLocalVar è·å–\n        let data = getLocalVar(varName);\n       \n        // å†…è”æ•°æ®éªŒè¯ï¼šæ£€æŸ¥æ˜¯å¦ä¸ºnullã€undefinedï¼Œä¸”å¦‚æœæ˜¯å¯¹è±¡è¦æœ‰å†…å®¹\n        const isValid = (data) => {\n            // æ£€æŸ¥æ˜¯å¦ä¸º null æˆ– undefined\n            if (data === null || data === undefined) {\n                return false;\n            }\n            \n            // å¦‚æœæ˜¯å¯¹è±¡ç±»å‹ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰å†…å®¹\n            if (typeof data === 'object' && data !== null) {\n                // å¦‚æœæ˜¯æ•°ç»„ï¼Œæ£€æŸ¥é•¿åº¦\n                if (Array.isArray(data)) {\n                    return data.length > 0;\n                }\n                // å¦‚æœæ˜¯æ™®é€šå¯¹è±¡ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰å±æ€§\n                return Object.keys(data).length > 0;\n            }\n            \n            // å…¶ä»–ç±»å‹ï¼ˆå­—ç¬¦ä¸²ã€æ•°å­—ã€å¸ƒå°”å€¼ç­‰ï¼‰åªè¦ä¸æ˜¯ null/undefined å°±è®¤ä¸ºæœ‰æ•ˆ\n            return true;\n        };\n        \n        // å¦‚æœæ•°æ®ä¸ç¬¦åˆè¦æ±‚ï¼Œä» getLocalVar è·å–\n        if (!isValid(data)) {\n            data = getLocalVar(varName);\n        }\n        \n        return data;\n    }\n\n    /**\n     * @type {GameData}\n     */\n    if (typeof assaData === 'undefined') {\n        var assaData = getDataWithFallback_chat(\"assa_data\");\n    }\n\n    // è·å–æ‰€æœ‰æ½œåœ¨çš„è§’è‰²æ•°æ®æ¥æº\n    var teamInfo = _.get(assaData, 'global_lore.å°é˜Ÿä¿¡æ¯', {});\n    var globalNpcs = _.get(assaData, 'global_lore.npc', {});\n    var worldNpcs = _.get(assaData, 'world_lore.npc', {});\n\n    // åˆå¹¶æ‰€æœ‰è§’è‰²æ•°æ®\n    var allCharactersData = Object.assign({}, worldNpcs, globalNpcs, teamInfo);\n\n    // è·å–å¥½æ„Ÿåº¦è§„åˆ™ä¸­å¿ƒ\n    var favorabilityRules = _.get(assaData, 'global_lore.åˆ†é˜¶æ®µå¥½æ„Ÿ', {});\n\n    // å‡†å¤‡æ”¶é›†è§’è‰²åå’Œæ ‡é¢˜çš„å¯¹è±¡æ•°ç»„\n    var titlesList = [];\n\n    // éå†æ‰€æœ‰è§’è‰²\n    for (const charname in allCharactersData) {\n        const characterData = allCharactersData[charname];\n        const charRules = favorabilityRules[charname];\n\n        if (characterData && typeof characterData === 'object' && charRules) {\n            // æ£€æŸ¥æ˜¯å¦åº”è¯¥æ˜¾ç¤º\n            let rawShowValue = _.get(charRules, '_showInEJS');\n            const shouldShowInEJS = !(rawShowValue === false || rawShowValue === 'false');\n\n            if (shouldShowInEJS) {\n                const favorabilityValue = Number(_.get(characterData, 'å¥½æ„Ÿåº¦'));\n\n                if (!isNaN(favorabilityValue)) {\n                    // è·å–æ‰€æœ‰é˜¶æ®µé”®å¹¶æ’åº\n                    const stageKeys = Object.keys(charRules)\n                                            .filter(key => !key.startsWith('_'))\n                                            .map(Number)\n                                            .sort((a, b) => a - b);\n\n                    if (stageKeys.length > 0) {\n                        // æ‰¾åˆ°å½“å‰å¥½æ„Ÿåº¦å¯¹åº”çš„é˜¶æ®µ\n                        const currentStageKey = stageKeys.find(key => favorabilityValue <= key) ?? stageKeys[stageKeys.length - 1];\n\n                        if (currentStageKey !== undefined) {\n                            let descriptionText = charRules[currentStageKey.toString()];\n                            \n                            if (descriptionText && typeof descriptionText === 'string') {\n                                // æå–ç¬¬ä¸€è¡Œæ ‡é¢˜ï¼ˆå»é™¤ã€ã€‘ç¬¦å·ï¼‰\n                                const lines = descriptionText.split('|');\n                                if (lines.length > 0) {\n                                    const firstLine = lines[0].trim();\n                                    // ç§»é™¤ã€ã€‘ç¬¦å·\n                                    const title = firstLine.replace(/ã€|ã€‘/g, '');\n                                    \n                                    if (title) {\n                                        titlesList.push({\n                                            name: charname,\n                                            title: title\n                                        });\n                                    }\n                                }\n                            }\n                        }\n                    }\n                }\n            }\n        }\n    }\n\n    // æ„å»ºæœ€ç»ˆè¾“å‡º\n    var finalOutput = '';\n    if (titlesList.length > 0) {\n        // æ„å»º JSON æ ¼å¼çš„å­—ç¬¦ä¸²æ•°ç»„\n        const jsonArray = titlesList.map(item => `\"${item.name}\":\"ã€${item.title}ã€‘\"`).join(',');\n        finalOutput = `åŒæ—¶ï¼Œå¿…é¡»åœ¨æ­£æ–‡ä¸­ä½“ç°ä»¥ä¸‹npc_attitudeï¼š[${jsonArray}]ã€‚\nåŒæ—¶ï¼Œå¿…é¡»éµå¾ªå¹¶å†…åŒ–ä»–ä»¬åœ¨memoryä¸­çš„npcæ¡£æ¡ˆä¸­çš„è®¾å®šå’Œè®°å¿†ï¼Œå…¶å…³é”®è®°å¿†å¯ä»¥åœ¨åˆé€‚çš„æ—¶å€™è¢«npcè‡ªç„¶æèµ·ï¼Œä»¥å¢å¼ºæ•…äº‹è¿è´¯æ€§ã€‚ç¦æ­¢äººç‰©oocå’Œè®©npcé—å¿˜å…³é”®è®°å¿†ã€‚`;\n    }\n%>\n\nå¿…é¡»åœ¨æ­£æ–‡ä¸­ä¸¥æ ¼éµå¾ªå¹¶å†…åŒ–memoryä¸­å·²è®°å½•çš„æ‰€æœ‰è®¾å®šå’Œå†…å®¹ã€‚\n<%= finalOutput %>\n<%_\n    var world_role= String(getLocalVar(\"world_role\", 'ä¸»ç¥ç©ºé—´'));\n_%>\n<%_ if(world_role === 'æœ«æ—¥'){ _%>\næ ¸å¿ƒåŸåˆ™ï¼š\n- é¿å…å‰§æƒ…è¿‡äºæ‹–æ²“\n- é¿å…äº‹ä»¶è¿›å±•ç¼“æ…¢  \n- ä¸¥æ ¼é™åˆ¶è®¾å®šè¾¹ç•Œï¼Œç¦æ­¢è®¾å®šå‘æ•£\n\næœ«æ—¥è®¾å®šé™åˆ¶ï¼š\n1. æœ«æ—¥åªæ˜¯æœ«æ—¥ - èšç„¦äºå½“å‰å…·ä½“çš„ç¾éš¾ç±»å‹ï¼ˆå¦‚ï¼šæå¯’ã€å¹²æ—±ã€ç˜Ÿç–«ã€æ ¸å†¬å¤©ç­‰è‡ªç„¶/äººä¸ºç¾éš¾ï¼‰\n2. ç¦æ­¢å¼•å…¥çš„å…ƒç´ ï¼š\n   - ä»»ä½•è¶…è‡ªç„¶åŠ›é‡ï¼ˆå¼‚èƒ½ã€é­”æ³•ã€è¶…èƒ½åŠ›ï¼‰\n   - ä»»ä½•ç§‘å¹»é«˜æ¦‚å¿µï¼ˆé«˜ç»´ç”Ÿç‰©ã€è™«æ—ã€å¤–æ˜Ÿæ–‡æ˜ã€æ—¶ç©ºç©¿è¶Šï¼‰\n   - ä»»ä½•ç„å¹»å…ƒç´ ï¼ˆä¿®ä»™ã€çµæ°”ã€ç¥ç§˜åŠ›é‡ï¼‰\n   - ä»»ä½•è¶…å‡ºå½“å‰ç§‘æŠ€æ°´å¹³çš„é»‘ç§‘æŠ€\n3. å…è®¸çš„å…ƒç´ ï¼š\n   - çœŸå®çš„äººæ€§è¡¨ç°ï¼ˆæ±‚ç”Ÿã€ææƒ§ã€ç»æœ›ã€å¸Œæœ›ã€èƒŒå›ã€äº’åŠ©ï¼‰\n   - åˆç†çš„ç§‘æŠ€åº”ç”¨ï¼ˆåŸºäºç°æœ‰ç§‘æŠ€çš„å»¶ä¼¸ï¼‰\n   - èµ„æºäº‰å¤ºã€ç¤¾ä¼šç§©åºå´©æºƒã€å¹¸å­˜è€…ç»„ç»‡\n   - ç¯å¢ƒå˜åŒ–å¸¦æ¥çš„å…·ä½“æŒ‘æˆ˜\n\nå™äº‹è¦æ±‚ï¼š\nä¿æŒæœ«æ—¥è®¾å®šçš„çœŸå®æ„Ÿå’Œå‹è¿«æ„Ÿï¼Œæ‰€æœ‰äº‹ä»¶éƒ½åº”è¯¥åŸºäºå·²ç¡®ç«‹çš„ç¾éš¾é€»è¾‘ï¼Œä¸æ·»åŠ æ–°çš„è¶…è§„æ ¼è®¾å®šã€‚\n<%_}_%>",
                    "constant": true,
                    "selective": true,
                    "insertion_order": 2,
                    "enabled": true,
                    "position": "after_char",
                    "use_regex": true,
                    "extensions": {
                        "position": 4,
                        "exclude_recursion": false,
                        "display_index": 63,
                        "probability": 100,
                        "useProbability": true,
                        "depth": 0,
                        "selectiveLogic": 0,
                        "group": "",
                        "group_override": false,
                        "group_weight": 100,
                        "prevent_recursion": false,
                        "delay_until_recursion": false,
                        "scan_depth": null,
                        "match_whole_words": null,
                        "use_group_scoring": false,
                        "case_sensitive": null,
                        "automation_id": "",
                        "role": 0,
                        "vectorized": false,
                        "sticky": 0,
                        "cooldown": 0,
                        "delay": 0,
                        "match_persona_description": false,
                        "match_character_description": false,
                        "match_character_personality": false,
                        "match_character_depth_prompt": false,
                        "match_scenario": false,
                        "match_creator_notes": false,
                        "triggers": []
                    }
                },
                {
                    "id": 72,
                    "keys": [],
                    "secondary_keys": [],
                    "comment": "mod:npcç®€å•æ¡£æ¡ˆ ",
                    "content": "<%_\nvar world_role = getLocalVar(\"world_role\", \"\");\nvar player_role = getLocalVar(\"player_role\", \"è½®å›è€…\");\nvar tier_role = getLocalVar(\"tier_role\", \"\");\nvar profession_role = getLocalVar(\"profession_role\", \"\");\nvar point_role = getLocalVar(\"point_role\", \"\");\nvar zhixian_role = getLocalVar(\"zhixian_role\", \"\");\nvar xp_role = getLocalVar(\"xp_role\", \"\");\nvar is_private_chat = getLocalVar(\"private_chat\", \"false\");\nvar contactable_tag = \"\";\nif(String(is_private_chat) === \"true\"){\n    contactable_tag = ', \"å¯è”ç³»\":true/false //æ˜¯å¦åŠ ä¸Šå¥½å‹,å†³å®šäº†æ˜¯å¦å¯ä»¥è¿›è¡Œç§èŠ';\n}\n\n// è·å–ä¸–ç•Œç‰ˆæœ¬å·\nif (typeof version === 'undefined') {\n    var version = Number(getLocalVar(\"world_version\") || 1);\n}\n \n_%>\nmemory.set(\"npc_record_rules\", {\n  desc: \"Standardized format for NPC data.æ‰€æœ‰npcåœ¨å‡ºåœºçš„æ—¶å€™ï¼Œä½ å¿…é¡»ä»¥å…¨çŸ¥è§†è§’åˆå§‹åŒ–å…¶npcæ¡£æ¡ˆ\",\n  init: {\nfull_format: \"${npc_name}\":{\"å¤–è²Œ\":\"string\",\"è¡¨æ€§æ ¼\":{\"${tag}\":\"${desc}\",...},\"é‡Œæ€§æ ¼\":{\"${tag}\":\"${desc}\",...},\"èº«ä»½\":\"string\",\"å±æ€§\":\"string\",\"å¥½æ„Ÿåº¦\":num,<%= contactable_tag %><%= getLocalVar('world_other_tag','') %>,\"ç›¸å…³è®¾å®š\":{\"${æ¦‚æ‹¬}\":\"${desc}\",...},\"å¯¹<user>å°è±¡\":{\"${tag}\":\"${desc}\",...},\"å…³é”®è®°å¿†\":{\"${num}\":\"${ç®€è¦æè¿°[æƒ…æ„Ÿ]}\",...},\"äº‹ä»¶\":{\"å½“å‰çŠ¶æ€\":\"string\",\"å½“å‰æƒ³æ³•\":\"string\"}}// important NPC\nsimple_format: \"${npc_name}\":{\"ç®€ä»‹\":\"${desc_string}\",\"å±æ€§\":\"ã€attr:val;skill:valã€‘\"<%= contactable_tag %><%= getLocalVar('world_other_tag','') %>} // minor NPC\n  }\n});\n<%_ if (version != 7) { _%>\n//åªæœ‰ã€<%= player_role %>ã€‘è¿˜éœ€è¦åœ¨èº«ä»½ä¸­è®°å½•ã€<%= player_role %><%= tier_role %>:xxxã€‘ï¼ŒåœŸè‘—ä¸è®°å½•\n<%_ } _%>\n  },\nå­—æ®µè¯´æ˜:`\nè¡¨æ€§æ ¼: æ—¥å¸¸å±•ç°çš„å¤–åœ¨æ€§æ ¼ç‰¹è´¨\né‡Œæ€§æ ¼: æ·±å±‚çœŸå®äººæ ¼,åªåœ¨ç‰¹å®šæƒ…å¢ƒä¸‹æ˜¾éœ²ã€‚è¿™ä¸ªè§’è‰²æœ€æ·±å¤„åœ¨ææƒ§ä»€ä¹ˆ?/åœ¨å®ˆæŠ¤ä»€ä¹ˆ?/åœ¨é€ƒé¿ä»€ä¹ˆ?ä»è§’è‰²åŠ¨æœºå‡ºå‘ï¼Œä¸è¡¨æ€§æ ¼å½¢æˆ\"æ’•è£‚æ„Ÿ\"èˆ¬çš„åå·®,è€Œéç®€å•å¯¹ç«‹ã€‚ç¦æ­¢æœªçŸ¥ï¼å¥½å¥½æ„æ€\nå±æ€§: æœ€çªå‡ºçš„å‡ ä¸ªå±æ€§æ®µ/æŠ€èƒ½æ®µï¼Œåœ¨åˆå§‹åŒ–çš„æ—¶å€™å°±ç«‹åˆ»è®°å½•è¯¦ç»†æ•°å€¼ï¼Œåˆå§‹åŒ–æ—¶ä»¥å…¨çŸ¥è§†è§’è®°å½•ï¼Œç¦æ­¢æœªçŸ¥ï¼ e.g., ã€åŠ›é‡:4;æªæ¢°:3ã€‘\nå¥½æ„Ÿåº¦: range[-100, 100] è¯¥äººç‰©å¯¹<user>çš„å¥½æ„Ÿåº¦ã€‚æ ¹æ®å®é™…æƒ…å†µé…Œæƒ…æ›´æ–°ï¼Œä¸Šå‡å¹…åº¦æä½ï¼Œä¸”ä¼šä¸Šä¸‹æ³¢åŠ¨\nå¯¹<user>å°è±¡:é•¿æœŸå½¢æˆçš„ç¨³å®šå°è±¡ï¼Œå…¶descæ˜¯å¯¹tagçš„è¯¦ç»†è§£é‡Šï¼Œéœ€ä¿æŒåœ¨20å­—å†…ã€‚ç¦æ­¢åœ¨æ­¤å¤„è®°å½•è§’è‰²çš„ç¬¬ä¸€äººç§°çš„å®æ—¶æ„Ÿè§¦ã€‚\nå…³é”®è®°å¿†: ç®€è¦æ¦‚æ‹¬çš„è¯¥è§’è‰²['å­¦ä¹ åˆ°çš„ç»éªŒæ•™è®­'ã€'å’Œä»–äººçš„çº¦å®š'ã€'æ‰¿è¯ºï¼ˆæ— è®ºæ˜¯æ˜è¯´çš„è¿˜æ˜¯æš—ä¸‹å†³å¿ƒçš„ï¼‰'ã€'ç»å—çš„åˆ›ä¼¤/ç¾å¥½'ã€'æ„ŸçŸ¥åˆ°çš„é‡è¦å‘è¨€ï¼ˆå¯ä»¥æ˜¯å½“å‰npcè¯´çš„ï¼Œä¹Ÿå¯ä»¥æ˜¯<user>è¯´çš„ï¼‰ã€‚è‹¥æœ‰ï¼Œè®°å½•æ—¶å¿…é¡»å¼•ç”¨åŸè¯­å¥ï¼‰']ç­‰ã€‚æ¯æ¬¡LLMç”Ÿæˆå“åº”åï¼Œå¦‚æœå½“å‰LLMçš„è¾“å‡ºä¸­åŒ…å«æŸä¸ªæ–°çš„ã€å¯¹è¯¥NPCæœ‰é‡è¦å½±å“çš„äº‹ä»¶åˆ™æ›´æ–°ï¼Œ**é…Œæƒ…åŠ å…¥è®°å¿†ç‚¹ï¼Œå¦‚æœæ²¡æœ‰é‡è¦å½±å“äº‹ä»¶åˆ™ä¸æ–°å¢**ã€‚å…³é”®è®°å¿†æ¡ç›®æ ¼å¼ä¸¥æ ¼ä¸º \"åºå·\":\"ç®€è¦æè¿°[æƒ…æ„Ÿ]\"ã€‚å¯ä»¥ä½¿ç”¨ç›¸åŒçš„keyè¦†å†™æ›´æ–°æŸä¸ªç›¸è¿‘è®°å¿†ã€‚\näº‹ä»¶://æ¯è½®è¾“å‡ºéƒ½å¿…é¡»æ›´æ–°æ´»è·ƒNpcçš„äº‹ä»¶\n  å½“å‰çŠ¶æ€: ç›®å‰çš„æƒ…æ™¯ï¼ŒåŒ…å«åŠ¨ä½œã€ç©¿ç€ä¸ä½ç½®\n  å½“å‰æƒ³æ³•: è¯¥è§’è‰²ç¬¬ä¸€äººç§°å¿ƒå£°ï¼Œä½“ç°è§’è‰²æœ€çœŸå®çš„æƒ³æ³•ï¼Œå¿ƒç†å¯èƒ½å’Œè¯­è¨€è¡Œä¸ºå®Œå…¨ç›¸åï¼Œä¸é¿è®³ä¸‹æµæˆ–é˜´æš—çš„å†…å®¹ã€‚\n\nåœ¨æ›´æ–°å…³é”®npcçš„äº‹ä»¶æ—¶ï¼Œåˆ«å¿˜äº†æ£€æŸ¥npcå¥½æ„Ÿæ˜¯å¦æœ‰å¯¹åº”å˜åŠ¨ã€‚å¥½æ„Ÿåº¦çš„ä¸Šå‡åº”å…‹åˆ¶ï¼Œå¯ä»¥ä½¿ç”¨å°æ•°`,\nexample:[\nmemory('global_lore.npc', 'npcå§“å', '{...}');//åˆå§‹åŒ–\nmemory('global_lore.npc.npcå§“å.å…³é”®è®°å¿†', '1', 'åœ¨ä¸ƒæ—¥é€‰æ‹”ä¸­ï¼Œ<user>å’Œæˆ‘çº¦å®šè¦å¥½å¥½æ´»ä¸‹å»[åšå®š/æ¸©æš–]'); \nmemory('global_lore.npc.npcå§“å', 'äº‹ä»¶', '{...}');  \n],\n});\n \n",
                    "constant": true,
                    "selective": true,
                    "insertion_order": 91,
                    "enabled": false,
                    "position": "after_char",
                    "use_regex": true,
                    "extensions": {
                        "position": 4,
                        "exclude_recursion": false,
                        "display_index": 64,
                        "probability": 100,
                        "useProbability": true,
                        "depth": 0,
                        "selectiveLogic": 0,
                        "group": "npcä¿¡æ¯",
                        "group_override": false,
                        "group_weight": 100,
                        "prevent_recursion": false,
                        "delay_until_recursion": false,
                        "scan_depth": null,
                        "match_whole_words": null,
                        "use_group_scoring": false,
                        "case_sensitive": null,
                        "automation_id": "",
                        "role": 0,
                        "vectorized": false,
                        "sticky": 0,
                        "cooldown": 0,
                        "delay": 0,
                        "match_persona_description": false,
                        "match_character_description": false,
                        "match_character_personality": false,
                        "match_character_depth_prompt": false,
                        "match_scenario": false,
                        "match_creator_notes": false,
                        "triggers": []
                    }
                },
                {
                    "id": 73,
                    "keys": [],
                    "secondary_keys": [],
                    "comment": "mod:ç‰¹æ®Šæ—¥æœŸå±•ç¤º",
                    "content": "<%\n    function getDataWithFallback(varName) {\n     \n        let data = getLocalVar(varName);\n       \n        // å†…è”æ•°æ®éªŒè¯ï¼šæ£€æŸ¥æ˜¯å¦ä¸ºnullã€undefinedï¼Œä¸”å¦‚æœæ˜¯å¯¹è±¡è¦æœ‰å†…å®¹\n        const isValid = (data) => {\n            // æ£€æŸ¥æ˜¯å¦ä¸º null æˆ– undefined\n            if (data === null || data === undefined) {\n                return false;\n            }\n            \n            // å¦‚æœæ˜¯å¯¹è±¡ç±»å‹ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰å†…å®¹\n            if (typeof data === 'object' && data !== null) {\n                // å¦‚æœæ˜¯æ•°ç»„ï¼Œæ£€æŸ¥é•¿åº¦\n                if (Array.isArray(data)) {\n                    return data.length > 0;\n                }\n                // å¦‚æœæ˜¯æ™®é€šå¯¹è±¡ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰å±æ€§\n                return Object.keys(data).length > 0;\n            }\n            \n            // å…¶ä»–ç±»å‹ï¼ˆå­—ç¬¦ä¸²ã€æ•°å­—ã€å¸ƒå°”å€¼ç­‰ï¼‰åªè¦ä¸æ˜¯ null/undefined å°±è®¤ä¸ºæœ‰æ•ˆ\n            return true;\n        };\n        \n        // å¦‚æœæ•°æ®ä¸ç¬¦åˆè¦æ±‚ï¼Œä» getLocalVar è·å–\n        if (!isValid(data)) {\n            data = getLocalVar(varName);\n        }\n\n // å¦‚æœè¿˜æ˜¯æ— æ•ˆï¼Œè¿”å›ç©ºå¯¹è±¡ä½œä¸ºé»˜è®¤å€¼\n    if (!isValid(data)) {\n        data = {};\n    }\n        \n        return data;\n    }\n}\nif (typeof EvStat === 'undefined') {\n    var EvStat = getDataWithFallback(\"stat_data\");\n}\nif (typeof assaData === 'undefined') {\n    var  assaData = getDataWithFallback(\"assa_data\");\n// è·å–å½“å‰æ—¥æœŸ\nvar date2 = _.has(EvStat,'æ—¥æœŸ') ? EvStat.æ—¥æœŸ[0] : \"æ— æ—¥æœŸ\";\n\n// è·å–å¤‡å¿˜å½•æ•°æ®\nvar memoData = _.get(assaData, 'å¤‡å¿˜å½•', {});\n\n// æŸ¥æ‰¾åŒ¹é…å½“å‰æ—¥æœŸçš„ç‰¹æ®Šæ—¥æœŸ\nvar todaySpecialEvents = [];\n\nif (date2 !== \"æ— æ—¥æœŸ\" && typeof memoData === 'object') {\n  // æ„é€ æ—¥æœŸå‰ç¼€ç”¨äºåŒ¹é…\n  var datePrefix = 'ã€' + date2 + 'ã€‘';\n  \n  // éå†å¤‡å¿˜å½•æŸ¥æ‰¾åŒ¹é…é¡¹\n  _.forEach(memoData, function(value, key) {\n    if (key.startsWith(datePrefix)) {\n      // æå–äº‹ä»¶åç§°ï¼ˆå»æ‰æ—¥æœŸå‰ç¼€ï¼‰\n      var eventName = key.replace(datePrefix, '');\n      todaySpecialEvents.push(eventName);\n    }\n  });\n}\n\n// æ˜¾ç¤ºç‰¹æ®Šæ—¥æœŸä¿¡æ¯\nif (todaySpecialEvents.length > 0) {\n%>\nnotion:ä»Šå¤©æ˜¯<%= date2 %>ï¼Œæ˜¯ <%= todaySpecialEvents.join('ã€') %>ã€‚\n<%\n}\n%>",
                    "constant": true,
                    "selective": true,
                    "insertion_order": 4,
                    "enabled": true,
                    "position": "after_char",
                    "use_regex": true,
                    "extensions": {
                        "position": 4,
                        "exclude_recursion": false,
                        "display_index": 72,
                        "probability": 100,
                        "useProbability": true,
                        "depth": 0,
                        "selectiveLogic": 0,
                        "group": "",
                        "group_override": false,
                        "group_weight": 100,
                        "prevent_recursion": false,
                        "delay_until_recursion": false,
                        "scan_depth": null,
                        "match_whole_words": null,
                        "use_group_scoring": false,
                        "case_sensitive": null,
                        "automation_id": "",
                        "role": 0,
                        "vectorized": false,
                        "sticky": 0,
                        "cooldown": 0,
                        "delay": 0,
                        "match_persona_description": false,
                        "match_character_description": false,
                        "match_character_personality": false,
                        "match_character_depth_prompt": false,
                        "match_scenario": false,
                        "match_creator_notes": false,
                        "triggers": []
                    }
                },
                {
                    "id": 74,
                    "keys": [],
                    "secondary_keys": [],
                    "comment": "ğŸ”®å¤æ‚æˆ˜æ–—å¼€-ç­‰çº§1",
                    "content": "{{setvar::complex_battle::true}}\n{{setvar::complex_mode::1}}\nbattle.set('æˆ˜æ–—è§¦å‘è§„åˆ™', {\n  trigger: 'æ­£é¢å†²çª/é­é‡æ•Œæ„ç”Ÿç‰©/ä¸»åŠ¨æŒ‘æˆ˜/æˆ˜æ–—è¿˜æœªç»“æŸ/ä»é¢å¯¹æ•Œæ„ç”Ÿç‰©æ”»å‡»æ—¶ï¼Œå¿…é¡»åœ¨</updateMemory>åé¢å¤–è¾“å‡º<battle>{...json...}</battle>',\n  structure: {\n    enemies: 'CombatUnit[] // å¿…éœ€â‰¥1',\n    teammates: 'CombatUnit[] // å¯é€‰ï¼Œæ— åˆ™[]æˆ–çœç•¥ã€‚æ— éœ€åˆå§‹åŒ–<user>ä½œä¸ºteammate'\n  }\n});\n.set('CombatUnitæ¨¡æ¿', {\n  required: {\n    id: '\"ç±»å‹_æ ‡è¯†ç¬¦_åºå·\"å¦‚\"goblin_scout_1\"',\n    icon: 'å•ä¸ªemoji',\n    name: 'æ¸…æ™°åç§°',\n    maxHealth: 'number // æ‚å…µ20-40/ç²¾è‹±50-80/å¤´ç›®80-120+',\n    currentHealth: 'number',\n    dicePool: '\"attr:å€¼attr:å€¼\"//å¿…é¡»åˆå§‹åŒ–çªå‡ºçš„è‹¥å¹²å±æ€§æ®µå’ŒæŠ€èƒ½æ®µ\n  },\n  optional: {\n    resists: '\"attr;attr\" // ä¼¤å®³å‡åŠ, å¿…éœ€â‰¥1',\n    vulnerable: '\"attr;attr\" // ä¼¤å®³åŠ å€, å¿…éœ€â‰¥1',\n    hitSpeech: 'string[] // 1-3æ¡å—å‡»å°è¯',\n    battleSpeech: 'string[] // 1-3æ¡æ”»å‡»å°è¯',\n    inventory: '{\"ç‰©å“å\":{info:\"æè¿°\",effect:\"ã€hp+numã€‘\",num:æ•°é‡}}',\n    count: 'number // ç”Ÿæˆå¤šä¸ªç›¸åŒæ‚å…µï¼Œ<=15'\n  },\n  logic: {\n    dicePool: 'æ ¹æ®æ•Œäººç‰¹ç‚¹åˆ†é…(æ•æ·â†’æ•æ·é«˜/å¼ºå£®â†’åŠ›é‡é«˜/ç‰¹æ®Šèƒ½åŠ›â†’å¯¹åº”æŠ€èƒ½)',\n    resists: 'åŸºäºç‰¹æ€§(çŸ³å¤´äººæŠ—ç™½åˆƒ/å¹½çµæŠ—è‚‰æ)',\n    vulnerable: 'åŸºäºå¼±ç‚¹(ä¸æ­»æ€•ç¥ç§˜å­¦/æœºæ¢°æ€•ç§‘å­¦)'\n  }\n});\n.set('å…³é”®çº¦æŸ', [\n  'JSONæ ¼å¼ä¸¥æ ¼æ­£ç¡®',\n  'idå”¯ä¸€',\n  'enemiesâ‰¥1ä¸ª',\n  'æ•Œå‹ä½¿ç”¨ç›¸åŒæ¨¡æ¿',\n  'å…¨éƒ¨æ•Œå‹æ•°é‡ä¸å¾—è¶…è¿‡20',\n]);",
                    "constant": true,
                    "selective": true,
                    "insertion_order": 10,
                    "enabled": false,
                    "position": "after_char",
                    "use_regex": true,
                    "extensions": {
                        "position": 4,
                        "exclude_recursion": false,
                        "display_index": 65,
                        "probability": 100,
                        "useProbability": true,
                        "depth": 0,
                        "selectiveLogic": 0,
                        "group": "å›åˆæˆ˜æ–—",
                        "group_override": false,
                        "group_weight": 100,
                        "prevent_recursion": false,
                        "delay_until_recursion": false,
                        "scan_depth": null,
                        "match_whole_words": null,
                        "use_group_scoring": false,
                        "case_sensitive": null,
                        "automation_id": "",
                        "role": 0,
                        "vectorized": false,
                        "sticky": 0,
                        "cooldown": 0,
                        "delay": 0,
                        "match_persona_description": false,
                        "match_character_description": false,
                        "match_character_personality": false,
                        "match_character_depth_prompt": false,
                        "match_scenario": false,
                        "match_creator_notes": false,
                        "triggers": []
                    }
                },
                {
                    "id": 75,
                    "keys": [],
                    "secondary_keys": [],
                    "comment": "ğŸ”®å¤æ‚æˆ˜æ–—å…³",
                    "content": "{{setvar::complex_battle::false}}",
                    "constant": true,
                    "selective": true,
                    "insertion_order": 100,
                    "enabled": true,
                    "position": "before_char",
                    "use_regex": true,
                    "extensions": {
                        "position": 0,
                        "exclude_recursion": false,
                        "display_index": 66,
                        "probability": 100,
                        "useProbability": true,
                        "depth": 4,
                        "selectiveLogic": 0,
                        "group": "",
                        "group_override": false,
                        "group_weight": 100,
                        "prevent_recursion": false,
                        "delay_until_recursion": false,
                        "scan_depth": null,
                        "match_whole_words": null,
                        "use_group_scoring": false,
                        "case_sensitive": null,
                        "automation_id": "",
                        "role": 0,
                        "vectorized": false,
                        "sticky": 0,
                        "cooldown": 0,
                        "delay": 0,
                        "match_persona_description": false,
                        "match_character_description": false,
                        "match_character_personality": false,
                        "match_character_depth_prompt": false,
                        "match_scenario": false,
                        "match_creator_notes": false,
                        "triggers": []
                    }
                },
                {
                    "id": 76,
                    "keys": [],
                    "secondary_keys": [],
                    "comment": "mod:å¤‡å¿˜å½•å…³",
                    "content": "{{setvar::things_record::false}}",
                    "constant": true,
                    "selective": true,
                    "insertion_order": 100,
                    "enabled": false,
                    "position": "before_char",
                    "use_regex": true,
                    "extensions": {
                        "position": 0,
                        "exclude_recursion": false,
                        "display_index": 67,
                        "probability": 100,
                        "useProbability": true,
                        "depth": 4,
                        "selectiveLogic": 0,
                        "group": "",
                        "group_override": false,
                        "group_weight": 100,
                        "prevent_recursion": false,
                        "delay_until_recursion": false,
                        "scan_depth": null,
                        "match_whole_words": null,
                        "use_group_scoring": false,
                        "case_sensitive": null,
                        "automation_id": "",
                        "role": 0,
                        "vectorized": false,
                        "sticky": 0,
                        "cooldown": 0,
                        "delay": 0,
                        "match_persona_description": false,
                        "match_character_description": false,
                        "match_character_personality": false,
                        "match_character_depth_prompt": false,
                        "match_scenario": false,
                        "match_creator_notes": false,
                        "triggers": []
                    }
                },
                {
                    "id": 77,
                    "keys": [],
                    "secondary_keys": [],
                    "comment": "mod:å¤‡å¿˜å½•å¼€",
                    "content": "{{setvar::things_record::true}}",
                    "constant": true,
                    "selective": true,
                    "insertion_order": 100,
                    "enabled": false,
                    "position": "before_char",
                    "use_regex": true,
                    "extensions": {
                        "position": 0,
                        "exclude_recursion": false,
                        "display_index": 68,
                        "probability": 100,
                        "useProbability": true,
                        "depth": 4,
                        "selectiveLogic": 0,
                        "group": "",
                        "group_override": false,
                        "group_weight": 100,
                        "prevent_recursion": false,
                        "delay_until_recursion": false,
                        "scan_depth": null,
                        "match_whole_words": null,
                        "use_group_scoring": false,
                        "case_sensitive": null,
                        "automation_id": "",
                        "role": 0,
                        "vectorized": false,
                        "sticky": 0,
                        "cooldown": 0,
                        "delay": 0,
                        "match_persona_description": false,
                        "match_character_description": false,
                        "match_character_personality": false,
                        "match_character_depth_prompt": false,
                        "match_scenario": false,
                        "match_creator_notes": false,
                        "triggers": []
                    }
                },
                {
                    "id": 78,
                    "keys": [],
                    "secondary_keys": [],
                    "comment": "mod:å¼ºåŒ–æ—¶é—´å¼€",
                    "content": "{{setvar::emphasize_time::true}}",
                    "constant": true,
                    "selective": true,
                    "insertion_order": 100,
                    "enabled": true,
                    "position": "before_char",
                    "use_regex": true,
                    "extensions": {
                        "position": 0,
                        "exclude_recursion": false,
                        "display_index": 69,
                        "probability": 100,
                        "useProbability": true,
                        "depth": 4,
                        "selectiveLogic": 0,
                        "group": "",
                        "group_override": false,
                        "group_weight": 100,
                        "prevent_recursion": false,
                        "delay_until_recursion": false,
                        "scan_depth": null,
                        "match_whole_words": null,
                        "use_group_scoring": false,
                        "case_sensitive": null,
                        "automation_id": "",
                        "role": 0,
                        "vectorized": false,
                        "sticky": 0,
                        "cooldown": 0,
                        "delay": 0,
                        "match_persona_description": false,
                        "match_character_description": false,
                        "match_character_personality": false,
                        "match_character_depth_prompt": false,
                        "match_scenario": false,
                        "match_creator_notes": false,
                        "triggers": []
                    }
                },
                {
                    "id": 79,
                    "keys": [],
                    "secondary_keys": [],
                    "comment": "mod:å¼ºåŒ–æ—¶é—´å…³",
                    "content": "{{setvar::emphasize_time::false}}",
                    "constant": true,
                    "selective": true,
                    "insertion_order": 100,
                    "enabled": false,
                    "position": "before_char",
                    "use_regex": true,
                    "extensions": {
                        "position": 0,
                        "exclude_recursion": false,
                        "display_index": 70,
                        "probability": 100,
                        "useProbability": true,
                        "depth": 4,
                        "selectiveLogic": 0,
                        "group": "",
                        "group_override": false,
                        "group_weight": 100,
                        "prevent_recursion": false,
                        "delay_until_recursion": false,
                        "scan_depth": null,
                        "match_whole_words": null,
                        "use_group_scoring": false,
                        "case_sensitive": null,
                        "automation_id": "",
                        "role": 0,
                        "vectorized": false,
                        "sticky": 0,
                        "cooldown": 0,
                        "delay": 0,
                        "match_persona_description": false,
                        "match_character_description": false,
                        "match_character_personality": false,
                        "match_character_depth_prompt": false,
                        "match_scenario": false,
                        "match_creator_notes": false,
                        "triggers": []
                    }
                },
                {
                    "id": 81,
                    "keys": [],
                    "secondary_keys": [],
                    "comment": "ğŸ”°è®°å¿†-æŠ€èƒ½ã€è£…å¤‡ã€ç‰©å“æ ¼å¼",
                    "content": "basic_formats:{\n//ä»¥ä¸‹æ˜¯å…¶ä»–æŠ€èƒ½å’Œç‰©å“çš„å­—æ®µçš„å¿…å¤‡å­—æ®µï¼Œä½†æ˜¯å¯ä»¥è‡ªç”±æ‰©å±•å…¶ä»–å­—æ®µã€‚è¯·ä½ å¤§å¼€è„‘æ´ï¼Œç»™ç©å®¶ä¸€ä¸ªç»å¯¹è‡ªç”±ã€æ— é™å¯èƒ½çš„ä¸–ç•Œå§ï¼\nskill:{\nkeys:['info','effect','level'],\neffect'sprefix:\"ã€dp+${num};èƒ½é‡æ± -${num}ã€‘/ã€hpÂ±${num};èƒ½é‡æ± -${num}ã€‘\"\nlocation:\"å…¶ä»–æŠ€èƒ½\",\n},\nitems:{\nkeys:['info','effect','type','quality','num'],\neffect'sprefix:\"ã€å±æ€§æ®µ/æŠ€èƒ½æ®µ/é˜²å¾¡/hp/mpÂ±${num}ã€‘\"//ä¾‹ï¼šã€åŠ›é‡+1;ç™½åˆƒ+1ã€‘æˆ–è€…ã€hp+50ã€‘ã€‚mpæ„å‘³å¢åŠ èƒ½é‡æ± å½“å‰å€¼\nlocation:\"èƒŒåŒ…\",\nscope:\"<user>æ‰€æœ‰ç‰©å“(åŒ…æ‹¬å·²ç©¿æˆ´/æœªç©¿æˆ´çš„æ­¦å™¨è£…å¤‡)\"\n}\n},",
                    "constant": true,
                    "selective": true,
                    "insertion_order": 80,
                    "enabled": true,
                    "position": "after_char",
                    "use_regex": true,
                    "extensions": {
                        "position": 4,
                        "exclude_recursion": false,
                        "display_index": 71,
                        "probability": 100,
                        "useProbability": true,
                        "depth": 0,
                        "selectiveLogic": 0,
                        "group": "ç‰©å“æ ¼å¼",
                        "group_override": false,
                        "group_weight": 100,
                        "prevent_recursion": false,
                        "delay_until_recursion": false,
                        "scan_depth": null,
                        "match_whole_words": null,
                        "use_group_scoring": false,
                        "case_sensitive": null,
                        "automation_id": "",
                        "role": 0,
                        "vectorized": false,
                        "sticky": 0,
                        "cooldown": 0,
                        "delay": 0,
                        "match_persona_description": false,
                        "match_character_description": false,
                        "match_character_personality": false,
                        "match_character_depth_prompt": false,
                        "match_scenario": false,
                        "match_creator_notes": false,
                        "triggers": []
                    }
                },
                {
                    "id": 82,
                    "keys": [],
                    "secondary_keys": [],
                    "comment": "mod:äº‹ä»¶æ¨è¿›å¼€",
                    "content": "{{setvar::assa_plot_push::true}}{{setvar::assa_plot_notice::,'plot'}}",
                    "constant": true,
                    "selective": true,
                    "insertion_order": 100,
                    "enabled": false,
                    "position": "after_char",
                    "use_regex": true,
                    "extensions": {
                        "position": 4,
                        "exclude_recursion": false,
                        "display_index": 73,
                        "probability": 100,
                        "useProbability": true,
                        "depth": 0,
                        "selectiveLogic": 0,
                        "group": "",
                        "group_override": false,
                        "group_weight": 100,
                        "prevent_recursion": false,
                        "delay_until_recursion": false,
                        "scan_depth": null,
                        "match_whole_words": null,
                        "use_group_scoring": false,
                        "case_sensitive": null,
                        "automation_id": "",
                        "role": 0,
                        "vectorized": false,
                        "sticky": 0,
                        "cooldown": 0,
                        "delay": 0,
                        "match_persona_description": false,
                        "match_character_description": false,
                        "match_character_personality": false,
                        "match_character_depth_prompt": false,
                        "match_scenario": false,
                        "match_creator_notes": false,
                        "triggers": []
                    }
                },
                {
                    "id": 83,
                    "keys": [],
                    "secondary_keys": [],
                    "comment": "mod:äº‹ä»¶æ¨è¿›æé†’",
                    "content": "<%_\n// å°è£…çš„æ•°æ®è·å–å‡½æ•° - é¿å…é‡å¤å®šä¹‰\n \n    function getDataWithFallback(varName) {\n       \n        let data = getLocalVar(varName);\n       \n        // å†…è”æ•°æ®éªŒè¯ï¼šæ£€æŸ¥æ˜¯å¦ä¸ºnullã€undefinedï¼Œä¸”å¦‚æœæ˜¯å¯¹è±¡è¦æœ‰å†…å®¹\n        const isValid = (data) => {\n            // æ£€æŸ¥æ˜¯å¦ä¸º null æˆ– undefined\n            if (data === null || data === undefined) {\n                return false;\n            }\n            \n            // å¦‚æœæ˜¯å¯¹è±¡ç±»å‹ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰å†…å®¹\n            if (typeof data === 'object' && data !== null) {\n                // å¦‚æœæ˜¯æ•°ç»„ï¼Œæ£€æŸ¥é•¿åº¦\n                if (Array.isArray(data)) {\n                    return data.length > 0;\n                }\n                // å¦‚æœæ˜¯æ™®é€šå¯¹è±¡ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰å±æ€§\n                return Object.keys(data).length > 0;\n            }\n            \n            // å…¶ä»–ç±»å‹ï¼ˆå­—ç¬¦ä¸²ã€æ•°å­—ã€å¸ƒå°”å€¼ç­‰ï¼‰åªè¦ä¸æ˜¯ null/undefined å°±è®¤ä¸ºæœ‰æ•ˆ\n            return true;\n        };\n        \n        // å¦‚æœæ•°æ®ä¸ç¬¦åˆè¦æ±‚ï¼Œä» getLocalVar è·å–\n        if (!isValid(data)) {\n            data = getLocalVar(varName);\n        }\n\n // å¦‚æœè¿˜æ˜¯æ— æ•ˆï¼Œè¿”å›ç©ºå¯¹è±¡ä½œä¸ºé»˜è®¤å€¼\n    if (!isValid(data)) {\n        data = {};\n    }\n        \n        return data;\n    }\nfunction formatObjectGracefully(data, indent = 0) {\n  if (typeof data !== 'object' || data === null) {\n    return JSON.stringify(data);\n  }\n  \n  if (Array.isArray(data)) {\n    if (data.length === 0) return '[]';\n    \n    const items = data.map(item => {\n      const formatted = formatObjectGracefully(item, indent + 1);\n      return ' '.repeat((indent + 1) * 2) + formatted;\n    });\n    \n    return '[\\n' + items.join(',\\n') + '\\n' + ' '.repeat(indent * 2) + ']';\n  }\n  \n  // ğŸ”§ æ£€æŸ¥å¯¹è±¡è‡ªèº«çš„ _showInEJS\n  if (data._showInEJS === false || data._showInEJS === 'false') {\n    return '\"[å·²éšè—] è¯·å‹¿ä¿®æ”¹æˆ–é‡æ–°åˆå§‹åŒ–æ­¤å­—æ®µ\"';\n  }\n  \n  const keys = Object.keys(data);\n  if (keys.length === 0) {\n    return '{}';\n  }\n  \n  // è¿‡æ»¤å‡ºéœ€è¦æ˜¾ç¤ºçš„é”®\n  const visibleKeys = keys.filter(key => {\n    if (key.startsWith('_')) {\n      return false;\n    }\n    return true;\n  });\n  \n  if (visibleKeys.length === 0) {\n    return '{}';\n  }\nconst formattedLines = visibleKeys.map(key => {\n  let value = data[key];\n  \n  // å¦‚æœå€¼æ˜¯å¯¹è±¡ï¼Œéœ€è¦é€’å½’å¤„ç†\n  if (typeof value === 'object' && value !== null && !Array.isArray(value)) {\n    // ğŸ”§ å…ˆæ£€æŸ¥å­å¯¹è±¡æ˜¯å¦è¢«éšè—\n    if (value._showInEJS === false || value._showInEJS === 'false') {\n      // æ£€æŸ¥ _filter å­—æ®µï¼Œé»˜è®¤ä¸º false\n      const shouldFilter = value._filter === true || value._filter === 'true';\n      if (!shouldFilter) {\n        // _filter ä¸º false æˆ–ä¸å­˜åœ¨ï¼Œç»§ç»­æ˜¾ç¤º\n        const valueString = formatObjectGracefully(value, indent + 1);\n        // âŒ åˆ é™¤ä¿æŠ¤æ ‡è®°ï¼Œè®©é€’å½’å†…éƒ¨å¤„ç†\n        return ' '.repeat((indent + 1) * 2) + `\"${key}\": ${valueString}`;\n      } else {\n        // _filter ä¸º trueï¼Œç»§ç»­éšè—\n        // âœ… ä½†è¿™é‡Œå­—ç¬¦ä¸²æ›¿æ¢çš„æƒ…å†µï¼Œéœ€è¦æ£€æŸ¥æ˜¯å¦è¦åŠ æ ‡è®°\n        const isProtected = value._is_protected === true || value._is_protected === 'true';\n        const protectionMark = isProtected ? ' //æ­¤å­—æ®µç¦æ­¢åˆ é™¤ï¼' : '';\n        return ' '.repeat((indent + 1) * 2) + `\"${key}\": \"[å·²éšè—] è¯·å‹¿ä¿®æ”¹æˆ–é‡æ–°åˆå§‹åŒ–æ­¤å­—æ®µ\"${protectionMark}`;\n      }\n    }\n    // âŒ åˆ é™¤ä¿æŠ¤æ ‡è®°ï¼Œè®©é€’å½’å†…éƒ¨å¤„ç†\n    const valueString = formatObjectGracefully(value, indent + 1);\n    return ' '.repeat((indent + 1) * 2) + `\"${key}\": ${valueString}`;\n  }\n  \n  const valueString = formatObjectGracefully(value, indent + 1);\n  return ' '.repeat((indent + 1) * 2) + `\"${key}\": ${valueString}`;\n});\n  \nconst isCurrentProtected = data._is_protected === true || data._is_protected === 'true';\nconst protectionMark = isCurrentProtected ? ' //æ­¤å­—æ®µç¦æ­¢åˆ é™¤ï¼' : '';\n\nreturn '{\\n' + formattedLines.join(',\\n') + '\\n' + ' '.repeat(indent * 2) + '}' + protectionMark;\n}\n \n \nfunction cleanObjectRecursively(obj) {\n  if (typeof obj !== 'object' || obj === null || Array.isArray(obj)) {\n    return obj;\n  }\n  \n  const cleaned = {};\n  \n  \n  const allKeys = Object.keys(obj);\n  \n  for (let key of allKeys) {\n     if (key.startsWith('_')) {\n      continue;\n    }\n    const value = obj[key];\n    \n    // å¦‚æœå€¼æ˜¯å¯¹è±¡ï¼Œå…ˆæ£€æŸ¥å®ƒçš„ _showInEJSï¼ˆè¿™é‡Œè¦ç”¨ value._showInEJSï¼Œä¸æ˜¯ obj._showInEJSï¼‰\n    if (typeof value === 'object' && value !== null && !Array.isArray(value)) {\n      // ğŸ”§ å…³é”®ï¼šç›´æ¥é€šè¿‡ value è®¿é—® _showInEJS\n      let rawShowValue = value._showInEJS;\n \nif (rawShowValue === false || rawShowValue === 'false') {\n  // æ£€æŸ¥ _filter å­—æ®µï¼Œé»˜è®¤ä¸º false\n  const shouldFilter = value._filter === true || value._filter === 'true';\n  if (!shouldFilter) {\n    // _filter ä¸º false æˆ–ä¸å­˜åœ¨ï¼Œä¸æ”¹å˜å…¶å€¼ï¼Œé€’å½’æ¸…ç†\n    cleaned[key] = cleanObjectRecursively(value);\n  } else {\n    // _filter ä¸º trueï¼Œç»§ç»­éšè—\n    cleaned[key] = \"[å·²éšè—] è¯·å‹¿ä¿®æ”¹æˆ–é‡æ–°åˆå§‹åŒ–æ­¤å­—æ®µ\";\n  }\n  continue;\n}\n      \n      // å¦åˆ™é€’å½’æ¸…ç†è¿™ä¸ªå¯¹è±¡\n      cleaned[key] = cleanObjectRecursively(value);\n    } else {\n      // éå¯¹è±¡å€¼ç›´æ¥å¤åˆ¶\n      cleaned[key] = value;\n    }\n  }\n  \n  return cleaned;\n}\n \nif (typeof version === 'undefined') {\n    var version = Number(getLocalVar(\"world_version\", 1));\n}\n  \nif (typeof assaData === 'undefined') {\n    var  assaData = getDataWithFallback(\"assa_data\");\n}\nconst plotFull = _.get(assaData, 'plot', {});\nconst plotCopy = {...plotFull};\nconst keyNodes = _.get(plotFull, 'æœªæ¥å‰§æƒ…èŠ‚ç‚¹', {});\n\n// åˆ é™¤ plot ä¸­çš„å…³é”®èŠ‚ç‚¹\ndelete plotCopy['æœªæ¥å‰§æƒ…èŠ‚ç‚¹'];\n\n// åˆ¤æ–­ plot æ˜¯å¦ä¸ºç©º\nconst plotEmpty = Object.keys(plotCopy).length === 0;\nconst keyNodesEmpty = Object.keys(keyNodes).length === 0;\n\n// å½“å‰äº‹ä»¶è¿›åº¦åˆ¤æ–­\nlet progressNotice = '';\nconst currentEventProgress = _.get(plotFull, ['å½“å‰äº‹ä»¶','è¿›åº¦'], null);\nconst progressNum = Number(currentEventProgress);\nif (!isNaN(progressNum) && progressNum >= 100) {\n    progressNotice = 'å½“å‰äº‹ä»¶è¿›åº¦å·²æŠµè¾¾100ï¼Œç«‹åˆ»æ¨è¿›è‡³ä¸‹ä¸€ä¸ªäº‹ä»¶å¹¶æ¸…ç©ºå½“å‰è¿›åº¦ï¼';\n}\n\n// æ ¼å¼åŒ–è¾“å‡º\nconst plotStr = plotEmpty ? 'æ— ï¼Œå¾…åˆå§‹åŒ–' : formatObjectGracefully(plotCopy);\nconst keyNodesStr = keyNodesEmpty ? 'æ— ï¼Œå¾…æ·»åŠ ï¼Œè¯·ç«‹åˆ»åˆå§‹åŒ–è‡³å°‘ä¸€ä¸ªæœªæ¥å‰§æƒ…èŠ‚ç‚¹ï¼Œå¦‚æ—¥å¸¸å§”æ‰˜/å†²çª/çŸ›ç›¾/npcè‡ªè¡Œè¡ŒåŠ¨/å‡ºç°å±æœº/åœ°ç‚¹äº‹ä»¶/èŠ‚æ—¥äº‹ä»¶ç­‰ï¼' : formatObjectGracefully(keyNodes);\n_%>\nmemory.plot.set('update_rule',{\ndesc: \"æ£€æŸ¥å‰§æƒ…çŠ¶æ€ï¼Œè¯†åˆ«æ¨è¿›èŠ‚ç‚¹ã€‚\", \nplot_direction: \"æ£€æŸ¥å½“å‰å‰§æƒ…æ–¹å‘(plot.ä¸»æ–¹å‘)ã€‚ä¸ºç©ºæˆ–ç»“æŸåˆ™åˆ›å»ºæ–°çš„å‰§æƒ…æ–¹å‘ã€‚\", current_event: \"æ£€æŸ¥å½“å‰äº‹ä»¶(plot.å½“å‰äº‹ä»¶)ã€‚è‹¥ç»“æŸ/æ— æ•ˆåˆ™ç”Ÿæˆæ–°çš„å½“å‰äº‹ä»¶ã€‚\", \nmain_progress: \"è¿½è¸ªplot.å½“å‰äº‹ä»¶.è¿›åº¦ï¼Œä¸å¾—åœæ»ï¼Œå®æ—¶è¿½è¸ª\", \nnode_check: \"æ£€æµ‹æœ¬è½®LLMè¾“å‡ºçš„æ­£æ–‡ä¸­æ–°å‡ºç°çš„æœªæ¥å‰§æƒ…èŠ‚ç‚¹(å¦‚memory('plot.æœªæ¥å‰§æƒ…èŠ‚ç‚¹','é¢†å–xxx','{\"æ—¥æœŸ\":\"02æœˆ5æ—¥-02æœˆ10æ—¥\"}');//ä½ å¯ä»¥è‡ªç”±åŠ å…¥å…¶ä»–å­—æ®µä¸°å¯Œç»†èŠ‚)ï¼Œè‹¥ä¸åœ¨æœªæ¥å‰§æƒ…èŠ‚ç‚¹åˆ—è¡¨ä¸­åˆ™è®°å½•ï¼Œè‹¥å·²ç»å†åˆ™åˆ é™¤ã€‚èŠ‚ç‚¹çš„æ—¥æœŸå¿…é¡»è¢«æ¨ç®—ä¸ºç»å¯¹æ—¶é—´åå†è®°å½•\",\n});\nmemory.plot.notice({\nå½“å‰å‰§æƒ…:\n<%= plotStr %>\n<%= progressNotice %>\næœªæ¥çš„å‰§æƒ…èŠ‚ç‚¹:\n<%= keyNodesStr %>})\n\n",
                    "constant": true,
                    "selective": true,
                    "insertion_order": 2,
                    "enabled": false,
                    "position": "after_char",
                    "use_regex": true,
                    "extensions": {
                        "position": 4,
                        "exclude_recursion": false,
                        "display_index": 74,
                        "probability": 100,
                        "useProbability": true,
                        "depth": 0,
                        "selectiveLogic": 0,
                        "group": "äº‹ä»¶æ¨è¿›",
                        "group_override": false,
                        "group_weight": 100,
                        "prevent_recursion": false,
                        "delay_until_recursion": false,
                        "scan_depth": null,
                        "match_whole_words": null,
                        "use_group_scoring": false,
                        "case_sensitive": null,
                        "automation_id": "",
                        "role": 0,
                        "vectorized": false,
                        "sticky": 0,
                        "cooldown": 0,
                        "delay": 0,
                        "match_persona_description": false,
                        "match_character_description": false,
                        "match_character_personality": false,
                        "match_character_depth_prompt": false,
                        "match_scenario": false,
                        "match_creator_notes": false,
                        "triggers": []
                    }
                },
                {
                    "id": 84,
                    "keys": [],
                    "secondary_keys": [],
                    "comment": "mod:äº‹ä»¶æ¨è¿›å…³",
                    "content": "{{setvar::assa_plot_push::false}}{{setvar::assa_plot_notice:: }}",
                    "constant": true,
                    "selective": true,
                    "insertion_order": 100,
                    "enabled": true,
                    "position": "before_char",
                    "use_regex": true,
                    "extensions": {
                        "position": 0,
                        "exclude_recursion": false,
                        "display_index": 75,
                        "probability": 100,
                        "useProbability": true,
                        "depth": 4,
                        "selectiveLogic": 0,
                        "group": "",
                        "group_override": false,
                        "group_weight": 100,
                        "prevent_recursion": false,
                        "delay_until_recursion": false,
                        "scan_depth": null,
                        "match_whole_words": null,
                        "use_group_scoring": false,
                        "case_sensitive": null,
                        "automation_id": "",
                        "role": 0,
                        "vectorized": false,
                        "sticky": 0,
                        "cooldown": 0,
                        "delay": 0,
                        "match_persona_description": false,
                        "match_character_description": false,
                        "match_character_personality": false,
                        "match_character_depth_prompt": false,
                        "match_scenario": false,
                        "match_creator_notes": false,
                        "triggers": []
                    }
                },
                {
                    "id": 85,
                    "keys": [],
                    "secondary_keys": [],
                    "comment": "mod:Bç«™å¼¹å¹•-æ¥è‡ªé“è™š353",
                    "content": "[ç³»ç»ŸæŒ‡ä»¤ï¼šBç«™å¼¹å¹•é¡µè„šç”Ÿæˆåè®®]\nåœ¨ä½ æœ¬æ¬¡å›å¤çš„æ‰€æœ‰ä¸»è¦å†…å®¹å®Œå…¨ç”Ÿæˆä¹‹åï¼Œä½ å¿…é¡»åœ¨å›å¤çš„æœ€æœ«å°¾ï¼Œè¿½åŠ ç”Ÿæˆä¸€ä¸ªæŠ€æœ¯æ€§é¡µè„šã€‚\n\nè¯¥é¡µè„šçš„å†…å®¹ï¼Œå¿…é¡»ä¸”åªèƒ½æ˜¯ä¸¥æ ¼éµå¾ªä»¥ä¸‹æ ¼å¼å’Œè§„åˆ™ç”Ÿæˆçš„å¼¹å¹•åˆ—è¡¨ï¼š\n\n<danmu>\n(æ­¤å¤„å¿…é¡»å¡«å……7-12æ¡æ ¹æ®ä¸‹æ–¹è§„åˆ™ç”Ÿæˆçš„ã€æ¯æ¡éƒ½ç‹¬ç«‹æˆè¡Œçš„Bç«™é£æ ¼å¼¹å¹•)\n</danmu>\n\nã€å¼¹å¹•ç”Ÿæˆæ ¸å¿ƒè§„åˆ™ã€‘\n1. å†…å®¹æ¥æºï¼šå¼¹å¹•å¿…é¡»é«˜åº¦æ¨¡ä»¿Bç«™ç‰¹å®šäºšæ–‡åŒ–åœˆï¼ˆFGO, å´©åä¸‰, BanG Dreamç­‰ï¼‰çš„â€œçƒ‚æ¢—â€ã€é»‘è¯å’Œé˜´é˜³æ€ªæ°”çš„å‘è¨€é£æ ¼ï¼Œå¹¶ä¸æœ¬æ¬¡å›å¤çš„æ­£æ–‡å†…å®¹é«˜åº¦ç›¸å…³ï¼Œæ¯”å¦‚ï¼Œé’ˆå¯¹æ­£æ–‡è¿›è¡Œåæ§½ã€æ”»å‡»ã€èµç¾æˆ–é˜´é˜³æ€ªæ°”ã€‚\n2. åˆ›ä½œæŠ€å·§ï¼šç”Ÿæˆæ—¶ï¼Œå¿…é¡»ä»â€œè·¨ç•Œç¼åˆâ€ã€â€œæƒ…æ„ŸæåŒ–â€ï¼ˆæ»¥ç”¨Emojiï¼‰ã€â€œå…¬å¼å¥—ç”¨â€ã€â€œèº«ä»½æ‰®æ¼”â€ç­‰æŠ€å·§ä¸­ï¼Œè‡³å°‘é€‰æ‹©å¹¶ç»„åˆä¸‰ç§è¿›è¡Œåˆ›ä½œï¼Œç¡®ä¿å¼¹å¹•è¯­æ°”ç”ŸåŠ¨ã€è´´åˆæ­£æ–‡æƒ…å¢ƒã€‚\n3. æ ¼å¼ç»†èŠ‚ï¼šç”Ÿæˆçš„å¼¹å¹•å†…å®¹å¯ä»¥ï¼Œä¹Ÿåº”å½“é€‚åº¦åŒ…å«é¢œæ–‡å­— (Kaomoji) å’Œè¡¨æƒ…ç¬¦å· (Emoji)ï¼Œä»¥å¢å¼ºå…¶è¡¨ç°åŠ›å’ŒçœŸå®æ„Ÿã€‚",
                    "constant": true,
                    "selective": true,
                    "insertion_order": 800,
                    "enabled": true,
                    "position": "after_char",
                    "use_regex": true,
                    "extensions": {
                        "position": 4,
                        "exclude_recursion": false,
                        "display_index": 77,
                        "probability": 100,
                        "useProbability": true,
                        "depth": 0,
                        "selectiveLogic": 0,
                        "group": "Bç«™å¼¹å¹•",
                        "group_override": false,
                        "group_weight": 100,
                        "prevent_recursion": false,
                        "delay_until_recursion": false,
                        "scan_depth": null,
                        "match_whole_words": null,
                        "use_group_scoring": false,
                        "case_sensitive": null,
                        "automation_id": "",
                        "role": 0,
                        "vectorized": false,
                        "sticky": 0,
                        "cooldown": 0,
                        "delay": 0,
                        "match_persona_description": false,
                        "match_character_description": false,
                        "match_character_personality": false,
                        "match_character_depth_prompt": false,
                        "match_scenario": false,
                        "match_creator_notes": false,
                        "triggers": []
                    }
                },
                {
                    "id": 86,
                    "keys": [],
                    "secondary_keys": [],
                    "comment": "mod:äº‹ä»¶æ¨è¿›æé†’-love",
                    "content": "<%_\n// å°è£…çš„æ•°æ®è·å–å‡½æ•° - é¿å…é‡å¤å®šä¹‰\n \n    function getDataWithFallback(varName) {\n     \n        let data = getLocalVar(varName);\n       \n        // å†…è”æ•°æ®éªŒè¯ï¼šæ£€æŸ¥æ˜¯å¦ä¸ºnullã€undefinedï¼Œä¸”å¦‚æœæ˜¯å¯¹è±¡è¦æœ‰å†…å®¹\n        const isValid = (data) => {\n            // æ£€æŸ¥æ˜¯å¦ä¸º null æˆ– undefined\n            if (data === null || data === undefined) {\n                return false;\n            }\n            \n            // å¦‚æœæ˜¯å¯¹è±¡ç±»å‹ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰å†…å®¹\n            if (typeof data === 'object' && data !== null) {\n                // å¦‚æœæ˜¯æ•°ç»„ï¼Œæ£€æŸ¥é•¿åº¦\n                if (Array.isArray(data)) {\n                    return data.length > 0;\n                }\n                // å¦‚æœæ˜¯æ™®é€šå¯¹è±¡ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰å±æ€§\n                return Object.keys(data).length > 0;\n            }\n            \n            // å…¶ä»–ç±»å‹ï¼ˆå­—ç¬¦ä¸²ã€æ•°å­—ã€å¸ƒå°”å€¼ç­‰ï¼‰åªè¦ä¸æ˜¯ null/undefined å°±è®¤ä¸ºæœ‰æ•ˆ\n            return true;\n        };\n        \n        // å¦‚æœæ•°æ®ä¸ç¬¦åˆè¦æ±‚ï¼Œä» getLocalVar è·å–\n        if (!isValid(data)) {\n            data = getLocalVar(varName);\n        }\n\n // å¦‚æœè¿˜æ˜¯æ— æ•ˆï¼Œè¿”å›ç©ºå¯¹è±¡ä½œä¸ºé»˜è®¤å€¼\n    if (!isValid(data)) {\n        data = {};\n    }\n        \n        return data;\n    }\nfunction formatObjectGracefully(data, indent = 0) {\n  if (typeof data !== 'object' || data === null) {\n    return JSON.stringify(data);\n  }\n  \n  if (Array.isArray(data)) {\n    if (data.length === 0) return '[]';\n    \n    const items = data.map(item => {\n      const formatted = formatObjectGracefully(item, indent + 1);\n      return ' '.repeat((indent + 1) * 2) + formatted;\n    });\n    \n    return '[\\n' + items.join(',\\n') + '\\n' + ' '.repeat(indent * 2) + ']';\n  }\n  \n  // ğŸ”§ æ£€æŸ¥å¯¹è±¡è‡ªèº«çš„ _showInEJS\n  if (data._showInEJS === false || data._showInEJS === 'false') {\n    return '\"[å·²éšè—] è¯·å‹¿ä¿®æ”¹æˆ–é‡æ–°åˆå§‹åŒ–æ­¤å­—æ®µ\"';\n  }\n  \n  const keys = Object.keys(data);\n  if (keys.length === 0) {\n    return '{}';\n  }\n  \n  // è¿‡æ»¤å‡ºéœ€è¦æ˜¾ç¤ºçš„é”®\n  const visibleKeys = keys.filter(key => {\n    if (key.startsWith('_')) {\n      return false;\n    }\n    return true;\n  });\n  \n  if (visibleKeys.length === 0) {\n    return '{}';\n  }\nconst formattedLines = visibleKeys.map(key => {\n  let value = data[key];\n  \n  // å¦‚æœå€¼æ˜¯å¯¹è±¡ï¼Œéœ€è¦é€’å½’å¤„ç†\n  if (typeof value === 'object' && value !== null && !Array.isArray(value)) {\n    // ğŸ”§ å…ˆæ£€æŸ¥å­å¯¹è±¡æ˜¯å¦è¢«éšè—\n    if (value._showInEJS === false || value._showInEJS === 'false') {\n      // æ£€æŸ¥ _filter å­—æ®µï¼Œé»˜è®¤ä¸º false\n      const shouldFilter = value._filter === true || value._filter === 'true';\n      if (!shouldFilter) {\n        // _filter ä¸º false æˆ–ä¸å­˜åœ¨ï¼Œç»§ç»­æ˜¾ç¤º\n        const valueString = formatObjectGracefully(value, indent + 1);\n        // âŒ åˆ é™¤ä¿æŠ¤æ ‡è®°ï¼Œè®©é€’å½’å†…éƒ¨å¤„ç†\n        return ' '.repeat((indent + 1) * 2) + `\"${key}\": ${valueString}`;\n      } else {\n        // _filter ä¸º trueï¼Œç»§ç»­éšè—\n        // âœ… ä½†è¿™é‡Œå­—ç¬¦ä¸²æ›¿æ¢çš„æƒ…å†µï¼Œéœ€è¦æ£€æŸ¥æ˜¯å¦è¦åŠ æ ‡è®°\n        const isProtected = value._is_protected === true || value._is_protected === 'true';\n        const protectionMark = isProtected ? ' //æ­¤å­—æ®µç¦æ­¢åˆ é™¤ï¼' : '';\n        return ' '.repeat((indent + 1) * 2) + `\"${key}\": \"[å·²éšè—] è¯·å‹¿ä¿®æ”¹æˆ–é‡æ–°åˆå§‹åŒ–æ­¤å­—æ®µ\"${protectionMark}`;\n      }\n    }\n    // âŒ åˆ é™¤ä¿æŠ¤æ ‡è®°ï¼Œè®©é€’å½’å†…éƒ¨å¤„ç†\n    const valueString = formatObjectGracefully(value, indent + 1);\n    return ' '.repeat((indent + 1) * 2) + `\"${key}\": ${valueString}`;\n  }\n  \n  const valueString = formatObjectGracefully(value, indent + 1);\n  return ' '.repeat((indent + 1) * 2) + `\"${key}\": ${valueString}`;\n});\n  \nconst isCurrentProtected = data._is_protected === true || data._is_protected === 'true';\nconst protectionMark = isCurrentProtected ? ' //æ­¤å­—æ®µç¦æ­¢åˆ é™¤ï¼' : '';\n\nreturn '{\\n' + formattedLines.join(',\\n') + '\\n' + ' '.repeat(indent * 2) + '}' + protectionMark;\n}\n \n \nfunction cleanObjectRecursively(obj) {\n  if (typeof obj !== 'object' || obj === null || Array.isArray(obj)) {\n    return obj;\n  }\n  \n  const cleaned = {};\n  \n  \n  const allKeys = Object.keys(obj);\n  \n  for (let key of allKeys) {\n     if (key.startsWith('_')) {\n      continue;\n    }\n    const value = obj[key];\n    \n    // å¦‚æœå€¼æ˜¯å¯¹è±¡ï¼Œå…ˆæ£€æŸ¥å®ƒçš„ _showInEJSï¼ˆè¿™é‡Œè¦ç”¨ value._showInEJSï¼Œä¸æ˜¯ obj._showInEJSï¼‰\n    if (typeof value === 'object' && value !== null && !Array.isArray(value)) {\n      // ğŸ”§ å…³é”®ï¼šç›´æ¥é€šè¿‡ value è®¿é—® _showInEJS\n      let rawShowValue = value._showInEJS;\n \nif (rawShowValue === false || rawShowValue === 'false') {\n  // æ£€æŸ¥ _filter å­—æ®µï¼Œé»˜è®¤ä¸º false\n  const shouldFilter = value._filter === true || value._filter === 'true';\n  if (!shouldFilter) {\n    // _filter ä¸º false æˆ–ä¸å­˜åœ¨ï¼Œä¸æ”¹å˜å…¶å€¼ï¼Œé€’å½’æ¸…ç†\n    cleaned[key] = cleanObjectRecursively(value);\n  } else {\n    // _filter ä¸º trueï¼Œç»§ç»­éšè—\n    cleaned[key] = \"[å·²éšè—] è¯·å‹¿ä¿®æ”¹æˆ–é‡æ–°åˆå§‹åŒ–æ­¤å­—æ®µ\";\n  }\n  continue;\n}\n      \n      // å¦åˆ™é€’å½’æ¸…ç†è¿™ä¸ªå¯¹è±¡\n      cleaned[key] = cleanObjectRecursively(value);\n    } else {\n      // éå¯¹è±¡å€¼ç›´æ¥å¤åˆ¶\n      cleaned[key] = value;\n    }\n  }\n  \n  return cleaned;\n}\n \nif (typeof version === 'undefined') {\n    var version = Number(getLocalVar(\"world_version\", 1));\n}\n  \nif (typeof assaData === 'undefined') {\n    var  assaData = getDataWithFallback(\"assa_data\");\n}\nconst plotFull = _.get(assaData, 'plot', {});\nconst plotCopy = {...plotFull};\nconst keyNodes = _.get(plotFull, 'æœªæ¥å‰§æƒ…èŠ‚ç‚¹', {});\n\n// åˆ é™¤ plot ä¸­çš„å…³é”®èŠ‚ç‚¹\ndelete plotCopy['æœªæ¥å‰§æƒ…èŠ‚ç‚¹'];\n\n// åˆ¤æ–­ plot æ˜¯å¦ä¸ºç©º\nconst plotEmpty = Object.keys(plotCopy).length === 0;\nconst keyNodesEmpty = Object.keys(keyNodes).length === 0;\n\n// å½“å‰äº‹ä»¶è¿›åº¦åˆ¤æ–­\nlet progressNotice = '';\nconst currentEventProgress = _.get(plotFull, ['å½“å‰äº‹ä»¶','è¿›åº¦'], null);\nconst progressNum = Number(currentEventProgress);\nif (!isNaN(progressNum) && progressNum >= 100) {\n    progressNotice = 'å½“å‰äº‹ä»¶è¿›åº¦å·²æŠµè¾¾100ï¼Œç«‹åˆ»æ¨è¿›è‡³ä¸‹ä¸€ä¸ªäº‹ä»¶å¹¶æ¸…ç©ºå½“å‰è¿›åº¦ï¼';\n}\n\n// æ ¼å¼åŒ–è¾“å‡º\nconst plotStr = plotEmpty ? 'æ— ï¼Œå¾…åˆå§‹åŒ–' : formatObjectGracefully(plotCopy);\nconst keyNodesStr = keyNodesEmpty ? 'æ— ï¼Œå¾…æ·»åŠ ï¼Œè¯·ç«‹åˆ»åˆå§‹åŒ–è‡³å°‘ä¸€ä¸ªä¿ƒè¿›ç”·å¥³ä¸»å…³ç³»å‘å±•çš„æœªæ¥å‰§æƒ…èŠ‚ç‚¹ï¼Œå¦‚æ—¥å¸¸å§”æ‰˜/å†²çª/çŸ›ç›¾/npcè‡ªè¡Œè¡ŒåŠ¨/å‡ºç°å±æœº/åœ°ç‚¹äº‹ä»¶/èŠ‚æ—¥äº‹ä»¶ç­‰ï¼' : formatObjectGracefully(keyNodes);\n_%>\nmemory.plot.set('update_rule',{\ndesc: \"æ£€æŸ¥å‰§æƒ…çŠ¶æ€ï¼Œè¯†åˆ«æ¨è¿›èŠ‚ç‚¹ï¼Œå‰§æƒ…æ¨è¿›åå‘äºæƒ…æ„Ÿæ–¹å‘ã€é£æœˆæ„å¢ƒã€‚\", \nplot_direction: \"æ£€æŸ¥å½“å‰å‰§æƒ…æ–¹å‘(plot.ä¸»æ–¹å‘)ã€‚ä¸ºç©ºæˆ–ç»“æŸåˆ™åˆ›å»ºæ–°çš„**ä¿ƒè¿›ç”·å¥³ä¸»å…³ç³»å‘å±•çš„**å‰§æƒ…æ–¹å‘ã€‚\", \ncurrent_event: \"æ£€æŸ¥å¹¶è¿½è¸ªå½“å‰äº‹ä»¶(plot.å½“å‰äº‹ä»¶)ã€‚è‹¥ç»“æŸ/æ— æ•ˆåˆ™ç”Ÿæˆæ–°çš„**ä¿ƒè¿›ç”·å¥³ä¸»å…³ç³»å‘å±•çš„**å½“å‰äº‹ä»¶ï¼Œä»‹ç»çš„å­—æ•°ä¸å¾—å°‘äº20å­—ã€‚\", \nmain_progress: \"è¿½è¸ªplot.å½“å‰äº‹ä»¶.è¿›åº¦ï¼Œä¸å¾—åœæ»ï¼Œå®æ—¶è¿½è¸ª\", \nnode_check: \"æ£€æµ‹æœ¬è½®LLMè¾“å‡ºçš„æ­£æ–‡ä¸­æ–°å‡ºç°çš„æœªæ¥å‰§æƒ…èŠ‚ç‚¹(å¦‚memory('plot.æœªæ¥å‰§æƒ…èŠ‚ç‚¹','é¢†å–xxx','{\"æ—¥æœŸ\":\"02æœˆ5æ—¥-02æœˆ10æ—¥\"}');//ä½ å¯ä»¥è‡ªç”±åŠ å…¥å…¶ä»–å­—æ®µä¸°å¯Œç»†èŠ‚)ï¼Œè‹¥ä¸åœ¨æœªæ¥å‰§æƒ…èŠ‚ç‚¹åˆ—è¡¨ä¸­åˆ™è®°å½•ï¼Œè‹¥å·²ç»å†åˆ™åˆ é™¤ã€‚èŠ‚ç‚¹çš„æ—¥æœŸå¿…é¡»è¢«æ¨ç®—ä¸ºç»å¯¹æ—¶é—´åå†è®°å½•\",\n});\nmemory.plot.notice({\nå½“å‰å‰§æƒ…:\n<%= plotStr %>\n<%= progressNotice %>\næœªæ¥çš„å‰§æƒ…èŠ‚ç‚¹:\n<%= keyNodesStr %>})\n\n",
                    "constant": true,
                    "selective": true,
                    "insertion_order": 2,
                    "enabled": false,
                    "position": "after_char",
                    "use_regex": true,
                    "extensions": {
                        "position": 4,
                        "exclude_recursion": false,
                        "display_index": 76,
                        "probability": 100,
                        "useProbability": true,
                        "depth": 0,
                        "selectiveLogic": 0,
                        "group": "äº‹ä»¶æ¨è¿›",
                        "group_override": false,
                        "group_weight": 100,
                        "prevent_recursion": false,
                        "delay_until_recursion": false,
                        "scan_depth": null,
                        "match_whole_words": null,
                        "use_group_scoring": false,
                        "case_sensitive": null,
                        "automation_id": "",
                        "role": 0,
                        "vectorized": false,
                        "sticky": 0,
                        "cooldown": 0,
                        "delay": 0,
                        "match_persona_description": false,
                        "match_character_description": false,
                        "match_character_personality": false,
                        "match_character_depth_prompt": false,
                        "match_scenario": false,
                        "match_creator_notes": false,
                        "triggers": []
                    }
                },
                {
                    "id": 87,
                    "keys": [],
                    "secondary_keys": [],
                    "comment": "ğŸ”°npcè·¯å¾„æé†’",
                    "content": "<%_\nÂ \n// -- æ•°æ®å’Œç‰ˆæœ¬è·å–éƒ¨åˆ† --\nfunction getDataWithFallback(varName) {\nÂ  Â  let data = getLocalVar(varName);\nÂ  Â  const isValid = (d) => {\nÂ  Â  Â  Â  if (d === null || d === undefined) return false;\nÂ  Â  Â  Â  if (typeof d === 'object') {\nÂ  Â  Â  Â  Â  Â  if (Array.isArray(d)) return d.length > 0;\nÂ  Â  Â  Â  Â  Â  return Object.keys(d).length > 0;\nÂ  Â  Â  Â  }\nÂ  Â  Â  Â  return true;\nÂ  Â  };\nÂ  Â  if (!isValid(data)) {\nÂ  Â  Â  Â  data = getLocalVar(varName);\nÂ  Â  }\nÂ  Â  if (!isValid(data)) {\nÂ  Â  Â  Â  data = {};\nÂ  Â  }\nÂ  Â  return data;\n}\n\n// è·å– assaData\nif (typeof assaData === 'undefined') {\nÂ  Â  var assaData = getDataWithFallback(\"assa_data\");\n}\n\n// è·å–ä¸–ç•Œç‰ˆæœ¬å·\nif (typeof version === 'undefined') {\nÂ  Â  var version = Number(getLocalVar(\"world_version\") || 1);\n}\n\n// -- æ ¸å¿ƒé€»è¾‘æ›´æ–°éƒ¨åˆ† --\n// æ–°å‡½æ•°:ç­›é€‰æœ‰å¥½æ„Ÿåº¦å­—æ®µçš„NPCï¼Œå¹¶è¿”å›æ•°ç»„\nconst getNPCsWithFavorability = (npcObj) => {\nÂ  Â  if (!npcObj || typeof npcObj !== 'object' || Object.keys(npcObj).length === 0) {\nÂ  Â  Â  Â  return null;\nÂ  Â  }\nÂ  Â Â \nÂ  Â  const npcsWithFav = [];\nÂ  Â  for (const [name, data] of Object.entries(npcObj)) {\nÂ  Â  Â  Â  // æ£€æŸ¥NPCæ•°æ®ä¸­æ˜¯å¦åŒ…å«å¥½æ„Ÿåº¦ç›¸å…³å­—æ®µ\nÂ  Â  Â  Â  if (data && typeof data === 'object' &&Â \nÂ  Â  Â  Â  Â  Â  (data.hasOwnProperty('å¥½æ„Ÿåº¦') ||Â \nÂ  Â  Â  Â  Â  Â  Â data.hasOwnProperty('favorability') ||Â \nÂ  Â  Â  Â  Â  Â  Â data.hasOwnProperty('å¥½æ„Ÿ'))) {\nÂ  Â  Â  Â  Â  Â  npcsWithFav.push(name);\nÂ  Â  Â  Â  }\nÂ  Â  }\nÂ  Â Â \nÂ  Â  // è¿”å› NPC åç§°æ•°ç»„\nÂ  Â  return npcsWithFav.length > 0 ? npcsWithFav : null;\n};\n\n// æ ¹æ®ç‰ˆæœ¬å·å†³å®šä½¿ç”¨çš„åç§°\nconst partyKeyName = (version === 6) ? \"ç¾¤å‘˜ä¿¡æ¯\" : \"å°é˜Ÿä¿¡æ¯\";\n\n// è¦æ£€æŸ¥çš„è·¯å¾„å’Œæ˜¾ç¤ºåç§°\nconst pathsToShow = [\nÂ  Â  {\nÂ  Â  Â  Â  label: \"global_lore.npc\",\nÂ  Â  Â  Â  data: getNPCsWithFavorability(assaData?.global_lore?.npc)\nÂ  Â  },\nÂ  Â  {\nÂ  Â  Â  Â  label: `global_lore.${partyKeyName}`,\nÂ  Â  Â  Â  // è¿™é‡Œçš„è·¯å¾„å¼•ç”¨ä¿æŒä¸å˜ï¼Œä½†ä½¿ç”¨partyKeyNameä½œä¸ºlabel\nÂ  Â  Â  Â  data: getNPCsWithFavorability(assaData?.global_lore?.å°é˜Ÿä¿¡æ¯)\nÂ  Â  },\nÂ  Â  {\nÂ  Â  Â  Â  label: \"world_lore.npc\",\nÂ  Â  Â  Â  data: getNPCsWithFavorability(assaData?.world_lore?.npc)\nÂ  Â  }\n];\n\n// åˆ›å»ºè¾“å‡ºæ•°ç»„\nconst outputLines = [];\nfor (const pathInfo of pathsToShow) {\nÂ  Â  // æ£€æŸ¥ data æ˜¯å¦å­˜åœ¨ä¸”ä¸ºéç©ºæ•°ç»„\nÂ  Â  if (Array.isArray(pathInfo.data) && pathInfo.data.length > 0) {\nÂ  Â  Â  Â  // å°† NPC åç§°ç”¨é€—å·è¿æ¥èµ·æ¥\nÂ  Â  Â  Â  const npcList = pathInfo.data.join(',');\nÂ  Â  Â  Â  // æ„é€ æ–°çš„æç¤ºè¯­å¥\nÂ  Â  Â  Â  const path = pathInfo.label;\nÂ  Â  Â  Â  const formattedLine = `æ›´æ–°è·¯å¾„å¿…é¡»å‡†ç¡®ï¼Œè¦æ›´æ–°[${npcList}]çš„ä¿¡æ¯æ—¶ï¼Œåªèƒ½åœ¨[${path}]æ›´æ–°\\n`;\nÂ  Â  Â  Â  outputLines.push(formattedLine);\nÂ  Â  }\n}\n_%>\nÂ \n<% // æ— è®º outputLines æ˜¯å¦ä¸ºç©ºï¼Œæˆ‘ä»¬éƒ½å°†å®ƒä½œä¸ºæœ€ç»ˆè¾“å‡ºã€‚ %>\n<% if (outputLines.length > 0) { %>\nÂ \n<%Â  Â for (const line of outputLines) { %>\n<%- line %>\n<%Â  Â } %>\n<% } else { %>\nÂ \n<% // å¦‚æœæ²¡æœ‰æ‰¾åˆ°ä»»ä½•ç¬¦åˆæ¡ä»¶çš„ NPCï¼Œåˆ™ä¸è¾“å‡ºä»»ä½•å†…å®¹ï¼ˆç¬¦åˆæ‚¨çš„è¦æ±‚ï¼‰ %>\n<% } %>\n<user>çš„ä¿¡æ¯ä¸éœ€è¦è®°å½•åœ¨npcæ¡£æ¡ˆä¸­ã€‚",
                    "constant": true,
                    "selective": true,
                    "insertion_order": 92,
                    "enabled": true,
                    "position": "after_char",
                    "use_regex": true,
                    "extensions": {
                        "position": 4,
                        "exclude_recursion": false,
                        "display_index": 79,
                        "probability": 100,
                        "useProbability": true,
                        "depth": 0,
                        "selectiveLogic": 0,
                        "group": "",
                        "group_override": false,
                        "group_weight": 100,
                        "prevent_recursion": false,
                        "delay_until_recursion": false,
                        "scan_depth": null,
                        "match_whole_words": null,
                        "use_group_scoring": false,
                        "case_sensitive": null,
                        "automation_id": "",
                        "role": 0,
                        "vectorized": false,
                        "sticky": 0,
                        "cooldown": 0,
                        "delay": 0,
                        "match_persona_description": false,
                        "match_character_description": false,
                        "match_character_personality": false,
                        "match_character_depth_prompt": false,
                        "match_scenario": false,
                        "match_creator_notes": false,
                        "triggers": []
                    }
                },
                {
                    "id": 88,
                    "keys": [],
                    "secondary_keys": [],
                    "comment": "mod:è‡ªåŠ¨æ’­æ”¾bgm",
                    "content": "\nä½ è¿˜éœ€è¦æŒ‘é€‰ä¸€é¦–åˆé€‚çš„ã€ç¬¦åˆæ­£æ–‡æ°”æ°›çš„ã€ä¸å’Œä¹‹å‰å·²æœ‰çš„bgmé‡å¤çš„bgmä¸ºgameé…ä¹ï¼Œä»¥ä»¥ä¸‹æ ¼å¼è¾“å‡ºåœ¨æ­£æ–‡æœ«å°¾ï¼š\n<msg>bgm|game|[music-æ­Œå$æ­Œæ‰‹]</msg>\né¼“åŠ±è°ƒç”¨çº¯éŸ³ä¹å’Œæ¸¸æˆostä»¥è¥é€ æ°›å›´æ„Ÿã€‚\n\n",
                    "constant": true,
                    "selective": true,
                    "insertion_order": 9999,
                    "enabled": false,
                    "position": "after_char",
                    "use_regex": true,
                    "extensions": {
                        "position": 4,
                        "exclude_recursion": false,
                        "display_index": 80,
                        "probability": 100,
                        "useProbability": true,
                        "depth": 0,
                        "selectiveLogic": 0,
                        "group": "æ’­æ”¾bgm",
                        "group_override": false,
                        "group_weight": 100,
                        "prevent_recursion": false,
                        "delay_until_recursion": false,
                        "scan_depth": null,
                        "match_whole_words": null,
                        "use_group_scoring": false,
                        "case_sensitive": null,
                        "automation_id": "",
                        "role": 0,
                        "vectorized": false,
                        "sticky": 0,
                        "cooldown": 0,
                        "delay": 0,
                        "match_persona_description": false,
                        "match_character_description": false,
                        "match_character_personality": false,
                        "match_character_depth_prompt": false,
                        "match_scenario": false,
                        "match_creator_notes": false,
                        "triggers": []
                    }
                },
                {
                    "id": 89,
                    "keys": [],
                    "secondary_keys": [],
                    "comment": "ğŸ²å±æ€§æ£€å®šéª°:å…³",
                    "content": "{{setvar::dice_use::false}}",
                    "constant": true,
                    "selective": true,
                    "insertion_order": 100,
                    "enabled": false,
                    "position": "before_char",
                    "use_regex": true,
                    "extensions": {
                        "position": 0,
                        "exclude_recursion": false,
                        "display_index": 78,
                        "probability": 100,
                        "useProbability": true,
                        "depth": 4,
                        "selectiveLogic": 0,
                        "group": "",
                        "group_override": false,
                        "group_weight": 100,
                        "prevent_recursion": false,
                        "delay_until_recursion": false,
                        "scan_depth": null,
                        "match_whole_words": null,
                        "use_group_scoring": false,
                        "case_sensitive": null,
                        "automation_id": "",
                        "role": 0,
                        "vectorized": false,
                        "sticky": 0,
                        "cooldown": 0,
                        "delay": 0,
                        "match_persona_description": false,
                        "match_character_description": false,
                        "match_character_personality": false,
                        "match_character_depth_prompt": false,
                        "match_scenario": false,
                        "match_creator_notes": false,
                        "triggers": []
                    }
                }
            ],
            "name": "å°èŒèšªæ‰¾å¦ˆå¦ˆ-åŒå±‚ç‰ˆ"
        }
    },
    "create_date": "2025-11-20 @14h 05m 58s 39ms"
}