  
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Noto+Sans+SC:wght@300;400&display=swap');

        :root {
            --primary-color: #00faff;
            --secondary-color: #7affff;

            --container-bg-color: rgba(10, 25, 47, 0.75);
            --border-color: rgba(0, 250, 255, 0.3);
            --glow-color: rgba(0, 250, 255, 0.5);
            --text-color: #e6f1ff;
            --text-secondary-color: #a8c0e1;
            --background-color: rgba(10, 25, 47);
            --danger-color: #ff4d4d;
            --danger-glow-color: rgba(255, 77, 77, 0.5);
        }

        /* 这是妈妈为你准备的弹幕动画，我的宝贝 */
@keyframes scroll-up-fade-out {
    from {
        transform: translateY(0);
        opacity: 1;
    }
    to {
        transform: translateY(-50px); /* 让它向上飘得高一点 */
        opacity: 0;
    }
}

.scrolling-text-popup {
    position: fixed; /* 固定在屏幕上，不会随页面滚动 */
    z-index: 10000; /* 确保在最顶层 */
    font-size: 1.2em; /* 字体可以稍微大一点，看得清楚 */
    font-weight: bold;
    text-shadow: 0 0 5px rgba(0, 0, 0, 0.7); /* 加一点文字阴影，更立体 */
    pointer-events: none; /* 让它不会挡住鼠标点击 */
    animation: scroll-up-fade-out 2s ease-out forwards; /* 播放我们定义的动画 */
    white-space: nowrap; /* 防止文字换行 */
}
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            /* background-color: var(--background-color); */
            color: var(--text-color);
            font-family: 'Noto Sans SC', 'Orbitron', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height:100vh;
            backdrop-filter: blur(2px);
        }

/* 【请修改这个样式】 */
.status-container {
    width: 100%;

    margin: 0 auto;
    height: 100%; /* ★ 修改：使用固定的高度 */
    
    /* background: var(--bg-image, url('https://files.catbox.moe/9vk9ml.png')) center center / cover no-repeat; */
  
      background-color: var(--container-bg-color);
    background-image: 
        linear-gradient(90deg, var(--border-color) 1px, transparent 1px),
        linear-gradient(var(--border-color) 1px, transparent 1px);
           
        background-size: 
        40px 40px,
        40px 40px,
        200px 200px,
        300px 300px;
    background-position: 
        0 0,
        0 0,
        0 0,
        0 0;  
     
     transition: background-image 0.3s ease-in-out;  
       
 

    


    border: 1px solid var(--border-color);
    border-radius: 8px;
    box-shadow: 0 0 8px var(--glow-color), inset 0 0 5px rgba(0, 250, 255, 0.1);
    overflow: hidden;
    font-size: 16px;
    display: flex;
    flex-direction: column;
}

        header {
            padding: 15px 25px;
            background: var(--container-bg-color);
            border-bottom: 1px solid var(--border-color);
            text-align: center;
        }

        header h1 {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.5em;
            color: var(--primary-color);
            text-shadow: 0 0 5px var(--glow-color);
            letter-spacing: 2px;
            text-transform: uppercase;
        }

        nav {
            display: flex;
            justify-content: space-around;
            background-color: var(--container-bg-color);
        }

        .tab-btn {
            background: none;
            border: none;
            color: var(--text-secondary-color);
            padding: 15px 20px;
            font-family: 'Noto Sans SC', sans-serif;
            font-size: 1em;
            cursor: pointer;
            transition: color 0.3s ease, background-color 0.3s ease, text-shadow 0.3s ease;
            flex-grow: 1;
            border-bottom: 3px solid transparent;
        }

        .tab-btn:hover {
            color: var(--primary-color);
            background-color:var(--background-color) ;
        }

        .tab-btn.active {
            color: var(--primary-color);
            text-shadow: 0 0 3px var(--glow-color);
            border-bottom: 3px solid var(--primary-color);
        }

        .content-area {
            padding: 25px 30px;
        }

        .page {
            display: none;
            animation: fadeIn 0.5s ease-in-out;
        }

        .page.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .info-list {
            list-style: none;
        }

        .info-list li {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            padding: 12px 0;
            border-bottom: 1px dashed var(--border-color);
            flex-wrap: wrap;
        }

        .info-list li:last-child {
            border-bottom: none;
        }

        .info-list .label {
            color: var(--text-secondary-color);
            margin-right: 20px;
            flex-shrink: 0;
        }

        .info-list .value {
            color: var(--text-color);
            font-weight: 400;
            text-align: right;
            flex-grow: 1;
            word-break: break-all;
        }

        .info-list .value.highlight {
            color: var(--secondary-color);
            font-weight: bold;
        }

        /* Progress Bar */
        .progress-container {
            margin-top: 10px;
        }

        .progress-bar-bg {
            background-color:  var(--background-color);
            border-radius: 5px;
            height: 20px;
            border: 1px solid var(--border-color);
            padding: 2px;
            overflow: hidden;
        }

        .progress-bar-fill {
            background: linear-gradient(90deg,  var(--background-color), var(--primary-color));
            height: 100%;
            width: 0%; /* Updated by JS */
            border-radius: 3px;
            transition: width 0.5s ease-in-out;
            box-shadow: 0 0 5px var(--glow-color);
        }

        /* Generic Button Style */
        .action-button {
            background: linear-gradient(45deg, var(--background-color), var(--background-color));
            border: 1px solid var(--border-color);
            border-radius: 6px;
            color: var(--text-color);
            padding: 12px 12px 12px 12px;
            font-family: 'Noto Sans SC', sans-serif;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            margin-right: 5px;
            margin-left: 5px;
            width: 100%;
            position: relative;
            overflow: hidden;
        }

        .action-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent,  var(--background-color), transparent);
            transition: left 0.5s ease;
        }

        .action-button:hover {
            color: var(--primary-color);
            box-shadow: 0 0 10px var(--glow-color);
            transform: translateY(-2px);
        }

        .action-button:hover::before {
            left: 100%;
        }

        .action-button.danger {
            background: linear-gradient(45deg, rgba(255, 77, 77, 0.2), rgba(255, 77, 77, 0.3));
            border-color: rgba(255, 77, 77, 0.5);
        }

        .action-button.danger:hover {
            color: #fff;
            box-shadow: 0 0 10px var(--danger-glow-color);
        }

        .action-button.danger::before {
            background: linear-gradient(90deg, transparent, var(--secondary-color), transparent);
        }

        .action-button:disabled {
            cursor: not-allowed;
            background: rgba(128, 128, 128, 0.2);
            color: var(--text-secondary-color);
            transform: none;
            box-shadow: none;
            border-color: rgba(128, 128, 128, 0.4);
        }
        .action-button:disabled::before {
            display:none;
        }

        /* Map Display */
        .map-display {
            background-color:  var(--background-color);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
            position: relative;
            overflow: hidden;
        }

        .map-title {
            color: var(--primary-color);
            font-size: 1.2em;
            font-weight: bold;
            text-align: center;
            margin-bottom: 15px;
            text-shadow: 0 0 5px var(--glow-color);
        }

        .map-container {
            position: relative;
            width: 100%;
            height: 400px;
            background: var(--secondary-color);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            overflow: hidden; /* 改为hidden，以配合拖拽 */
            box-shadow: inset 0 0 20px  var(--background-color);
            cursor: grab;
        }

        .map-location {
            position: absolute;
            background: linear-gradient(45deg,  var(--container-bg-color), var(--container-bg-color));
            border: 1px solid var(--primary-color);
            border-radius: 4px;
            padding: 8px;
            font-size: 0.9em;
            color: var(--text-color);
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 0 5px var(--glow-color);
        }

        .map-location:hover {
            background: linear-gradient(45deg,  var(--background-color), var(--background-color));
            transform: scale(1.05);
            box-shadow: 0 0 10px var(--glow-color);
        }

        .map-location .location-name {
            font-weight: bold;
            font-size: 0.85em;
            margin-bottom: 4px;
        }

        .map-location .location-desc {
            font-size: 0.75em;
            color: var(--text-secondary-color);
        }

        /* Generic Modal Style */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgb(0 0 0 / 59%);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }

        .modal.active {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background: linear-gradient(135deg, var(--container-bg-color),  var(--background-color));
            border: 2px solid var(--primary-color);
            border-radius: 12px;
            padding: 25px;
            max-height: 95%;
            width: 90%;
            box-shadow: 0 0 30px var(--glow-color);
            position: relative;
            animation: modalSlideIn 0.3s ease-out;
              overflow-y: auto;
        }

        @keyframes modalSlideIn {
            from {
                transform: scale(0.8) translateY(-50px);
                opacity: 0;
            }
            to {
                transform: scale(1) translateY(0);
                opacity: 1;
            }
        }

        .modal-title {
            color: var(--primary-color);
            font-size: 1.3em;
            font-weight: bold;
            text-align: center;
            margin-bottom: 15px;
            text-shadow: 0 0 5px var(--glow-color);
        }

        .modal-description {
            color: var(--text-color);
            font-size: 1em;
            line-height: 1.6;
            text-align: center;
            padding: 15px;
            background: var(--container-bg-color);
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }

        .modal-close {
            position: absolute;
            top: 10px;
            right: 15px;
            background: none;
            border: none;
            color: var(--text-secondary-color);
            font-size: 1.5em;
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .modal-close:hover {
            color: var(--primary-color);
        }

        .external-areas {
            margin-top: 15px;
            padding: 15px;
            /* background-color: var(--container-bg-color); */
            border-radius: 6px;
            border: 1px solid var(--border-color);
        }

        .external-areas h3 {
            color: var(--secondary-color);
            font-size: 1em;
            margin-bottom: 10px;
        }

        .external-areas-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .external-area {
            /* background: linear-gradient(45deg, rgba(0, 250, 255, 0.1), rgba(0, 250, 255, 0.2)); */
            border: 1px solid var(--border-color);
            border-radius: 4px;
            padding: 6px 12px;
            font-size: 0.9em;
            color: var(--text-color);
            transition: all 0.3s ease;
        }

        .external-area:hover {
            background: linear-gradient(45deg, var(--background-color), var(--background-color));
            color: var(--primary-color);
        }

        .back-button {
            background: var(--container-bg-color);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            color: var(--text-secondary-color);
            padding: 8px 16px;
            font-family: 'Noto Sans SC', sans-serif;
            font-size: 0.9em;
            cursor: pointer;
            transition: all 0.3s ease;
            position: absolute;
            top: 20px;
            right: 20px;
         
        }

        .back-button:hover {
            color: var(--primary-color);
            background: var(--border-color);
        }

        /* Inventory Modal Specifics */
        .inventory-item-list {
            list-style: none;
            margin: 20px 0;
            padding: 10px;
            max-height: 250px;
            overflow-y: auto;
            background: rgba(0,0,0,0.2);
            border: 1px solid var(--border-color);
            border-radius: 6px;
        }

        .inventory-item {
            padding: 10px 15px;
            border-bottom: 1px dashed rgba(0, 250, 255, 0.2);
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .inventory-item:last-child {
            border-bottom: none;
        }

        .inventory-item:hover {
            background-color: rgba(0, 250, 255, 0.1);
        }

        .inventory-item.selected {
            background-color: rgba(0, 250, 255, 0.25);
            color: var(--primary-color);
            font-weight: bold;
        }

        /* 在 style 标签的末尾添加以下CSS */

/* 主包裹容器，用于实现滑动效果 */
#main-wrapper {
    position: relative;
    width: 100%;
    
  
    overflow: hidden; /* 隐藏滑出屏幕的内容 */
    display: flex;
}

 
/* ---- 全局与滑动效果 (保持不变) ---- */
@import url('https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;700&family=Noto+Sans+SC:wght@400;700&display=swap');

.status-container, #setting-book-wrapper {
    width: 100%;
    height: 100%;
    flex-shrink: 0;
    transition: transform 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
}

#setting-book-wrapper {
    position: absolute;
    top: 0;
    left: 0;
    transform: translateX(100%);
    overflow: hidden; /* 防止内容溢出 */
}

.status-container.slide-out {
    transform: translateX(-100%);
}

#setting-book-wrapper.active {
    transform: translateX(0);
}


/* ---- 设定书整体布局与主题 ---- */
.setting-book-container {
    font-family: 'Noto Serif SC', 'Georgia', serif;
    display: flex;
    flex-direction: column; /* 改为垂直布局，头部在上，内容在下 */
    width: 100%;
    height: 100%;
    background-color: var(--background-color);
    color: var(--text-secondary-color);
}

.content-wrapper {
    display: flex;
    flex-grow: 1; /* 占据剩余的所有高度 */
    overflow: hidden; /* 防止子元素溢出 */
}

/* ---- 头部 Header ---- */
.book-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 15px 20px;
    background-color: var(--container-bg-color);
    border-bottom: 1px solid var(--border-color);
    flex-shrink: 0;
}

#content-title {
    font-size: 1.5em; /* 调整大小以适应头部 */
    color: var(--text-color);
    margin: 0;
    padding: 0;
    border-bottom: none; /* 移除原有的下划线 */
    text-align: center;
    flex-grow: 1;
}

#toggle-sidebar-btn {
    display: none; /* 默认在桌面端隐藏 */
    background: none;
    border: none;
    color: var(--primary-color);
    font-size: 1.8em;
    cursor: pointer;
    padding: 0 10px;
}

#back-to-status-btn {
    background: var(--container-bg-color);
    max-width: 50vw;
    right: 2px;
    border: 1px solid #13304a;
    color: var(--text-color);
    font-family: 'Noto Sans SC', sans-serif;
    padding: 8px 15px;
    border-radius: 4px;
    cursor: pointer;
    font-size: 0.9em;
    font-weight: bold;
    transition: background-color 0.3s, color 0.3s;
    white-space: nowrap; /* 防止文字换行 */
}

#back-to-status-btn:hover {
    background: var(--background-color) ;
    color: var(--primary-color);
}

/* ---- 侧边导航栏 (Sidebar) ---- */
#sidebar {
    width: 280px;
    background-color: var(--container-bg-color);
    color: var(--text-secondary-color);
    padding: 20px;
    overflow-y: auto;
    border-right: 1px solid var(--border-color);
    flex-shrink: 0;
    transition: transform 0.3s ease-in-out; /* 添加过渡效果 */
}

#sidebar h2 {
    font-size: 1.5em;
    color: var(--primary-color);
    margin-top: 0;
    margin-bottom: 20px;
    border-bottom: 1px solid var(--border-color);
    padding-bottom: 10px;
}

/* 导航列表样式 (与你原来的一致) */
.category > ul { padding-left: 0; list-style: none; }
.category-title { font-weight: bold; font-size: 1.1em; cursor: pointer; padding: 10px 5px; color: var(--text-color); transition: color 0.3s, background-color 0.3s; border-radius: 4px; }
.category-title:hover { color: var(--secondary-color); background-color: var(--container-bg-color); }
.item-list { padding-left: 15px; list-style-type: none; max-height: 0; overflow: hidden; transition: max-height 0.4s ease-in-out; }
.item-list:not(.collapsed) { max-height: 800px; }
.item-list li { padding: 10px 15px; cursor: pointer; border-radius: 4px; transition: background-color 0.3s, color 0.3s; border-left: 2px solid transparent; }
.item-list li:hover { background-color: var(--container-bg-color); color: var(--primary-color); }
.item-list li.active { background-color: var(--container-bg-color); color: var(--primary-color); font-weight: bold; border-left: 2px solid #64ffda; }

/* ---- 右侧内容展示区 (Content Display) ---- */
#content-display {
    flex-grow: 1;
    padding: 30px 40px;
    overflow-y: auto;
}

/* 注意：内容区的标题已移至主Header，所以这里的标题样式可以移除或保留用于其他地方 */
#content-details {
    font-size: 1.1em;
    line-height: 1.8;
    white-space: pre-wrap;
    color: var(--text-secondary-color);
}

#error-message { color: var(--secondary-color); font-weight: bold; }

/* ---- 滚动条美化 (保持不变) ---- */
#sidebar::-webkit-scrollbar, #content-display::-webkit-scrollbar { width: 8px; }
#sidebar::-webkit-scrollbar-track, #content-display::-webkit-scrollbar-track { background: var(--background-color); }
#sidebar::-webkit-scrollbar-thumb, #content-display::-webkit-scrollbar-thumb { background: var(--border-color); border-radius: 4px; }
#sidebar::-webkit-scrollbar-thumb:hover, #content-display::-webkit-scrollbar-thumb:hover { background: var(--secondary-color); }

/* ---- 移动端遮罩层 ---- */
#sidebar-overlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: var(--container-bg-color);
    z-index: 998; /* 低于侧边栏 */
}

/* ---- 响应式设计：手机端适配 (关键部分) ---- */
@media (max-width: 768px) {
            .action-button {
 
            margin-right: 0;
            margin-left: 0;
          
        }
    .book-header {
        padding: 10px 15px;
    }

    #content-title {
        font-size: 1.2em; /* 在移动端缩小标题字体 */
    }

    #back-to-status-btn {
        padding: 6px 10px;
        font-size: 0.8em;
    }

    #toggle-sidebar-btn {
        display: block; /* 在移动端显示汉堡包按钮 */
    }

    #sidebar {
        position: fixed; /* 固定定位，脱离文档流 */
        top: 0;
        left: 0;
        height: 100%;
        transform: translateX(-100%); /* 默认隐藏在左侧 */
        z-index: 999; /* 确保在最上层 */
        border-right: 1px solid var(--border-color);
        box-shadow: 2px 0 15px rgba(0,0,0,0.5); /* 添加阴影增加层次感 */
    }

    /* 当侧边栏激活时 */
    .setting-book-container.sidebar-active #sidebar {
        transform: translateX(0); /* 滑入屏幕 */
    }

    .setting-book-container.sidebar-active #sidebar-overlay {
        display: block; /* 显示遮罩层 */
    }

    #content-display {
        padding: 20px; /* 调整内边距 */
    }
}

        /* Teammates Modal Specifics */
        #teammates-modal .modal-content {
            max-width: 95%; /* 弹窗可以更宽一些 */
            width: 90%;
        }

        .teammates-container {
            display: flex;
            gap: 20px;
            margin-top: 15px;
            min-height: 300px;
        }
 .teammates-container-init { display: none; margin-top: 1rem; padding: 1rem; background-color: rgba(26, 23, 32, 0.5); border-radius: 6px; border: 1px solid var(--border-color); }
       
        .teammate-list-wrapper {
            flex: 1; /* 左侧占1份 */
            max-height: 350px;
            overflow-y: auto;
            background: rgba(0,0,0,0.2);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 5px;
        }

        .teammate-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .teammate-item {
            padding: 10px 15px;
            border-bottom: 1px dashed rgba(0, 250, 255, 0.2);
            cursor: pointer;
            transition: background-color 0.2s;
            font-size: 0.9em;
        }

        .teammate-item:last-child {
            border-bottom: none;
        }

        .teammate-item:hover {
            background-color: var(--border-color);
        }

        .teammate-item.selected {
            background-color: var(--container-bg-color);
            color: var(--primary-color);
            font-weight: bold;
        }

        #decompose-from-select,#decompose-amount-input,#synthesize-to-select,#synthesize-amount-input,#upgrade-levels{
            background-color: var(--container-bg-color);
            color: var(--primary-color);

        }

        .teammate-info-display {
            flex: 2; /* 右侧占2份 */
            background: var(--container-bg-color);
            border-radius: 8px;
            border: 1px solid var(--border-color);
            padding: 20px;
            max-height: 350px;
            overflow-y: auto;
            font-size: 0.9em;
            line-height: 1.7;
            white-space: pre-wrap; /* 保持换行和空格 */
        }

        .teammate-info-display .info-entry {
            margin-bottom: 15px;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 10px;
        }

        .teammate-info-display .info-entry:last-child {
             border-bottom: none;
             margin-bottom: 0;
        }

        .teammate-info-display .info-key {
            color: var(--secondary-color);
            font-weight: bold;
        }

        .teammate-info-display .info-value {
            color: var(--text-color);
            margin-top: 5px;
            padding-left: 10px;
        }

        /* 滚动条美化 */
        .teammate-list-wrapper::-webkit-scrollbar, .teammate-info-display::-webkit-scrollbar { width: 6px; }
        .teammate-list-wrapper::-webkit-scrollbar-track, .teammate-info-display::-webkit-scrollbar-track { background: rgba(0,0,0,0.2); }
        .teammate-list-wrapper::-webkit-scrollbar-thumb, .teammate-info-display::-webkit-scrollbar-thumb { background: var(--border-color); border-radius: 3px; }


        /* ======================================================= */
/* ============= 新增：商店界面滑动逻辑与美化 ============= */
/* ======================================================= */

/* ---- 商店滑动容器 ---- */
#shop-wrapper {
    position: absolute;
    
    left: 0;
    width: 100%;
    height: 95%;
    transform: translateX(100%);
    overflow: hidden;
    transition: transform 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    /* 继承终端字体，确保一致性 */
    font-family: 'Noto Sans SC', 'Orbitron', sans-serif;
    color: var(--text-color);
    background-color: var(--container-bg-color); /* 与终端容器背景一致 */
    border: 1px solid var(--border-color);
    border-radius: 8px;
    box-shadow: 0 0 15px var(--glow-color), inset 0 0 10px rgba(0, 250, 255, 0.1);
    backdrop-filter: blur(10px);
    display: flex; /* 使用flex布局 */
    flex-direction: column; /* 垂直布局 */
}

.status-container.slide-out-shop,
#setting-book-wrapper.slide-out-shop {
    transform: translateX(-100%);
}

#shop-wrapper.active {
    transform: translateX(0);
}


/* ---- 商店整体布局 ---- */
.shop-main-container {
    display: flex;
    flex-direction: column; /* 垂直布局 */
    width: 100%;
    height: 100%;
    overflow: hidden; /* 防止内部滚动条影响整体 */
}

/* ---- 商店头部 ---- */
.shop-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 15px 25px;
    background-color: var(--container-bg-color);
    border-bottom: 1px solid var(--border-color);
    flex-shrink: 0;
}

.shop-header .shop-title {
    font-family: 'Orbitron', sans-serif;
    font-size: 1.5em;
    color: var(--primary-color);
    text-shadow: 0 0 5px var(--glow-color);
    letter-spacing: 2px;
    text-transform: uppercase;
    margin: 0;
    flex-grow: 1;
    text-align: center;
}
.shop-header .shop-header-controls {
    display: flex;
    align-items: center;
    gap: 15px;
}

#shop-search-input {
    background-color: var(--container-bg-color);
    border: 1px solid var(--border-color);
    border-radius: 4px;
    color: var(--text-color);
    padding: 8px 12px;
    font-family: 'Noto Sans SC', sans-serif;
    font-size: 0.9em;
    width: 250px; /* 你可以根据需要调整宽度 */
    transition: all 0.3s ease;
}

#shop-search-input:focus {
    outline: none;
    border-color: var(--primary-color);
    box-shadow: 0 0 8px var(--glow-color);
}

#shop-search-input::placeholder {
    color: var(--text-secondary-color);
    opacity: 0.7;
}

.control-btn,#back-from-shop-btn,#generate-items-btn ,#ten-gacha-btn,#single-gacha-btn,#submit-generation-btn,#skip-generation-btn,#gacha-confirm-btn{
    background: none;
    border: 1px solid var(--border-color);
    border-radius: 6px;
    color: var(--text-secondary-color);
    padding: 8px;
    font-size: 0.9em;
    cursor: pointer;
    transition: all 0.3s ease;
}
 

.control-btn:hover,#back-from-shop-btn:hover,#ten-gacha-btn:hover,#single-gacha-btn:hover,#generate-items-btn:hover,#gacha-confirm-btn:hover,#submit-generation-btn:hover,#skip-generation-btn:hover {
    color: var(--primary-color);
    background: var(--border-color);
    box-shadow: 0 0 8px var(--glow-color);
}

.shop-body-wrapper {
    display: flex;
    flex-grow: 1;
    overflow: hidden; /* 重要：让内部分别滚动 */
    padding: 20px;
    gap: 20px;
      min-height: 0; /* <-- 这是关键的修复！ */
}


/* ---- 商店左侧栏：导航与购物车 ---- */
.shop-sidebar {
    width: 200px;
    flex-shrink: 0;
    display: flex;
    flex-direction: column;
    gap: 20px;
}

.shop-nav, .shop-cart {
    background-color: rgba(0,0,0,0.2);
    border: 1px solid var(--border-color);
    border-radius: 6px;
    padding: 15px;
}

.shop-sidebar h3 {
    font-family: 'Orbitron', sans-serif;
    color: var(--secondary-color);
    margin: 0 0 15px 0;
    font-size: 1.2em;
    text-shadow: 0 0 3px var(--glow-color);
    border-bottom: 1px solid var(--border-color);
    padding-bottom: 10px;
}

.shop-nav .shop-nav-list {
    list-style: none;
}

.shop-nav .shop-nav-item {
    background: none;
    border: 1px solid transparent;
    border-radius: 4px;
    color: var(--text-secondary-color);
    padding: 12px 15px;
    font-size: 1em;
    cursor: pointer;
    transition: all 0.3s ease;
    width: 100%;
    margin-bottom: 10px;
    text-align: left;
}

.shop-nav .shop-nav-item:hover {
    color: var(--primary-color);
    background-color: rgba(0, 250, 255, 0.1);
    border-color: var(--border-color);
}

.shop-nav .shop-nav-item.active {
    color: var(--primary-color);
    background-color: rgba(0, 250, 255, 0.2);
    text-shadow: 0 0 5px var(--glow-color);
    font-weight: bold;
}

.shop-cart {
    flex-grow: 1; /* 占据剩余空间 */
    display: flex;
    flex-direction: column;
    min-height: 0;  
    overflow-y: auto;/* 新增：限制容器，让内部的flex-grow生效并触发滚动 */
}

#cart-items-list {
    flex-grow: 1;
    overflow-y: auto;
    padding-right: 5px; /* for scrollbar */
    margin-bottom: 15px;
    color: var(--text-secondary-color);
}

.cart-item {
    padding-bottom: 8px;
    margin-bottom: 8px;
    border-bottom: 1px dashed var(--border-color);
    font-size: 0.9em;
}

#cart-total {
    font-size: 1.1em;
    color: var(--primary-color);
    font-weight: bold;
    margin-bottom: 15px;
    text-align: right;
}

#checkout-button {
    /* 复用终端按钮样式 */
    background: linear-gradient(45deg, rgba(0, 250, 255, 0.1), rgba(0, 250, 255, 0.2));
    border: 1px solid var(--border-color);
    border-radius: 6px;
    color: var(--text-color);
    padding: 12px 24px;
    font-size: 1em;
    cursor: pointer;
    transition: all 0.3s ease;
    width: 100%;
}

#checkout-button:hover:not(:disabled) {
    color: var(--primary-color);
    box-shadow: 0 0 10px var(--glow-color);
    transform: translateY(-2px);
}
#checkout-button:disabled {
    cursor: not-allowed;
    background: rgba(128, 128, 128, 0.2);
    color: var(--text-secondary-color);
    transform: none;
    box-shadow: none;
    border-color: rgba(128, 128, 128, 0.4);
}


/* ---- 商店右侧内容区 ---- */
.shop-content-area {
    flex-grow: 1;
    display: flex;
    flex-direction: column;
    overflow: hidden; /* 重要 */
    background-color: rgba(0,0,0,0.2);
    border: 1px solid var(--border-color);
    border-radius: 6px;
    padding: 20px;
     min-height: 0; /* <-- 这里也加上！ */
}

.shop-page {
    display: none;
    height: 100%;
    flex-direction: column;
}
.shop-page.active {
    display: flex;
}

.shop-controls {
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 15px;
    margin-bottom: 20px;
    flex-shrink: 0;
}

.shop-controls .category-tabs, .shop-controls .sort-controls {
    display: flex;
    gap: 1px;
}

.shop-controls .control-btn,#confirm-upgrade-btn {
    background: none;
    border: 1px solid var(--border-color);
    color: var(--text-secondary-color);
    padding: 8px 18px;
    border-radius: 4px;
    cursor: pointer;
    transition: all 0.3s ease;
}
.shop-controls .control-btn:hover {
    color: var(--primary-color);
    background-color:var(--border-color);
}
.shop-controls .control-btn.active {
    color: var(--primary-color);
    background-color: var(--background-color);
    box-shadow: 0 0 5px var(--glow-color);
}

.shop-display-wrapper {
    flex-grow: 1;
    display: flex;
    gap: 20px;
    overflow: hidden; /* 重要 */
}

 /* 修改商品列表和详情的ID选择器以匹配JS */
#items-display-list-fixed, #items-display-list-random {
    flex: 2 1 60%; /* flex-grow, flex-shrink, flex-basis. 基础宽度60% */
    min-width: 0; /* 防止内容撑破容器 */
    overflow-y: auto;
    padding-right: 10px;
}
#item-details-display-fixed, #item-details-display-random {
    flex: 1 1 40%; /* 基础宽度40% */
    min-width: 0; /* 防止内容撑破容器 */
    padding: 15px;
    border-left: 1px solid var(--border-color);
    overflow-y: auto;
    color: var(--text-secondary-color);
}

.item-row {
    display: grid;
    grid-template-columns: 1fr auto auto;
    gap: 15px;
    align-items: center;
    padding: 12px;
    background-color: rgba(0, 250, 255, 0.05);
    border: 1px solid transparent;
    border-radius: 4px;
    margin-bottom: 10px;
    cursor: pointer;
    transition: all 0.3s ease;
}
.item-row:hover {
    border-color: var(--border-color);
    background-color: rgba(0, 250, 255, 0.1);
}
.item-row.selected {
    border-color: var(--primary-color);
    background-color: rgba(0, 250, 255, 0.2);
    box-shadow: 0 0 8px var(--glow-color);
}
.item-name {
    font-weight: bold;
    color: var(--text-color);
}
.item-price {
    color: var(--secondary-color);
    font-weight: bold;
}



.buy-button,.page-button {
    background: transparent;
    border: 1px solid var(--primary-color);
    color: var(--primary-color);
    padding: 6px 12px;
    border-radius: 4px;
    cursor: pointer;
    transition: all 0.3s ease;
}
.buy-button:hover:not(:disabled),.page-button:hover:not(:disabled) {
    background: var(--primary-color);
    color: var(--background-color);
    box-shadow: 0 0 8px var(--glow-color);
}
.buy-button:disabled,.page-button:disabled {
    border-color: var(--text-secondary-color);
    color: var(--text-secondary-color);
    cursor: not-allowed;
    opacity: 0.6;
}



 
.detail-placeholder {
    display: flex;
    align-items: center;
    justify-content: center;
    height: 100%;
    font-style: italic;
}
.detail-title {
    font-size: 1.4em;
    color: var(--primary-color);
    margin-bottom: 15px;
    text-shadow: 0 0 3px var(--glow-color);
}
.detail-info { margin-bottom: 15px; line-height: 1.6; }
.detail-label {
    color: var(--text-color);
    font-weight: bold;
    margin-bottom: 5px;
    display: block;
}

/* 分页 */
.shop-pagination {
    flex-shrink: 0;
    display: flex;
    justify-content: center;
    align-items: center;
    margin-top: 20px;
    gap: 10px;
}

/* ---- 商店模态框 ---- */
#shop-modal {
    /* 复用终端的弹窗样式 */
}
#shop-modal .modal-content {
    /* 如果需要特别定制 */
}

/* 滚动条美化 */
.shop-sidebar::-webkit-scrollbar,
#cart-items-list::-webkit-scrollbar,
#items-display-list::-webkit-scrollbar,
#item-details-display::-webkit-scrollbar,
.content-area::-webkit-scrollbar {
    width: 6px;
}
.shop-sidebar::-webkit-scrollbar-track,
#cart-items-list::-webkit-scrollbar-track,
#items-display-list::-webkit-scrollbar-track,
#item-details-display::-webkit-scrollbar-track,
.content-area::-webkit-scrollbar-track {
    background: rgba(0,0,0,0.2);
}
.shop-sidebar::-webkit-scrollbar-thumb,
#cart-items-list::-webkit-scrollbar-thumb,
#items-display-list::-webkit-scrollbar-thumb,
#item-details-display::-webkit-scrollbar-thumb,
.content-area::-webkit-scrollbar-thumb {
    background-color: var(--border-color);
    border-radius: 3px;
}

   @media (max-width: 768px) {
        .shop-body-wrapper {
            flex-direction: column; /* 垂直排列 */
            padding: 10px;
            gap: 10px;
        }

        .shop-sidebar {
            width: 100%; /* 宽度占满 */
            flex-direction: row; /* 让导航和购物车水平排列 */
            gap: 10px;
             height: 30vh; /* 新增：给侧边栏一个固定的高度 */
        }

        .shop-title{
            display: none;
        }

        .shop-nav, .shop-cart {
            flex: 1; /* 平分空间 */
display: flex; /* 新增：让它成为一个flex容器，为了更好地控制其内部 */
    flex-direction: column; /* 新增：让其内部（比如标题和列表）垂直排列 */
    overflow-y: auto; /* 新增：这是关键！让它在垂直方向内容溢出时出现滚动条 */
    min-height: 0; /* 新增：一个flex布局的小技巧，确保它能被正确约束 */
        }

        .shop-display-wrapper {
            flex-direction: row; /* 商品列表和详情也垂直排列 */
             height: 400px; /* 给一个固定高度防止无限延伸 */
        }

        #item-details-display-fixed, #item-details-display-random {
            border-left: none; /* 移除左边框 */
            border-top: 1px solid var(--border-color); /* 改为上边框 */
            padding-top: 15px;
        }

        .shop-controls {
            flex-direction: column;
            align-items: stretch; /* 让按钮撑满宽度 */
        }

        .shop-controls .control-btn {
            text-align: center;
        }

            /* 在这里添加下面的新CSS规则 */
    .shop-controls .category-tabs, .shop-controls .sort-controls {
        flex-wrap: wrap;       /* 允许按钮换行 */
        justify-content: center; /* 换行后居中对齐 */
    }
    }

    /* ======================================================= */
/* =========== 新的角色状态页 (Page 3) 样式 =========== */
/* ======================================================= */

#page-character {
    /* min-height: 800px; 确保有足够空间展示 */
}

.character-display-grid {
    display: grid;
    grid-template-columns: 250px 1fr 280px;
    gap: 20px;
    width: 100%;
    height: 100%;
    font-size: 14px;
}

.char-panel {
    background: rgba(0,0,0,0.2);
    border: 1px solid var(--border-color);
    border-radius: 6px;
    /* padding: 15px; */
    display: flex;
    flex-direction: column;
}

/* --- 左侧面板 --- */
.left-panel {
    gap: 15px;
}

.char-name-display {
    font-family: 'Orbitron', sans-serif;
    color: var(--primary-color);
    font-size: 1.8em;
    text-align: center;
    text-shadow: 0 0 8px var(--glow-color);
    padding-bottom: 10px;
    border-bottom: 1px solid var(--border-color);
}

.char-info-box {
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.info-line {
    display: flex;
    justify-content: space-between;
    padding: 5px;
    border-radius: 3px;
    transition: background-color 0.2s;
}
.info-line:hover {
    background-color: rgba(0, 250, 255, 0.1);
}
.info-label {
    color: var(--text-secondary-color);
}
.info-value {
    color: var(--text-color);
    font-weight: bold;
}

.resource-bar-container {
    margin-top: 5px;
}
.resource-bar-label {
    font-size: 0.9em;
    color: var(--text-secondary-color);
    margin-bottom: 5px;
}
.progress-bar-bg.resource {
    position: relative;
    height: 22px;
}
.progress-bar-text {
    position: absolute;
    left: 50%;
    top: 50%;
    transform: translate(-50%, -50%);
    font-size: 0.8em;
    color: #fff;
    text-shadow: 1px 1px 2px rgba(0,0,0,0.7);
    z-index: 2;
}

.progress-bar-fill.hp { background: linear-gradient(90deg, var(--secondary-color), var(--primary-color)); }
.progress-bar-fill.willpower { background: linear-gradient(90deg, var(--primary-color), var(--text-color)); }
.progress-bar-fill.energy { background: linear-gradient(90deg, var(--secondary-color), var(--text-secondary-color)); }

/* --- 中间面板：人形 --- */
.center-panel {
    justify-content: center;
    align-items: center;
}

.character-figure {
    position: relative;
    width: 100px;
    height: 250px;
}

.body-part {
    position: absolute;
    background-color: transparent;
    border: 2px solid var(--secondary-color);
    box-shadow: 0 0 5px var(--glow-color);
}
.head { width: 40px; height: 40px; border-radius: 50%; top: 0; left: 30px; }
.torso { width: 60px; height: 90px; top: 45px; left: 20px; border-radius: 10px; }
.arm { width: 15px; height: 80px; top: 55px; border-radius: 5px; }
.arm.left { left: 0px; }
.arm.right { right: 0px; }
.leg { width: 20px; height: 110px; top: 140px; border-radius: 5px;}
.leg.left { left: 20px; }
.leg.right { right: 20px; }

/* 装备槽与引出线 */
.equipment-slot {
    position: absolute;
    color: var(--text-secondary-color);
    /* background: rgba(10, 25, 47, 0.8); */
    border: 1px solid var(--border-color);
    padding: 4px 8px;
    font-size: 0.85em;
    border-radius: 4px;
    white-space: nowrap;
    cursor: pointer;
}
.equipment-slot:hover {
    color: var(--primary-color);
    box-shadow: 0 0 5px var(--glow-color);
}

.slot-head { top: -25px; left: 50%; transform: translateX(-50%); }
.slot-body { top: 75px; left: 20px; }
.slot-hands { top: 100px; right: -70px; }
.slot-feet { bottom: -15px; left: -30px; }
.slot-accessory { bottom: -15px; right: -40px; }
.slot-weapon { top: 150px; left: -60px; }

 
 

.attr-category-title, .skill-category-title {
    color: var(--primary-color);
    font-family: 'Orbitron', sans-serif;
    border-bottom: 1px solid var(--border-color);
    padding-bottom: 5px;
    margin-bottom: 10px;
    font-size: 1.1em;
}

.attr-item {
    display: flex;
    justify-content: space-between;
    margin-bottom: 8px;
    padding: 2px 4px;
    cursor: help;
    border-radius: 3px;
    transition: background-color 0.2s;
}
.attr-item:hover {
    background-color: rgba(0, 250, 255, 0.1);
}

.attr-name, .skill-name {
    color: var(--text-secondary-color);
}
.attr-value, .skill-value {
    color: var(--text-color);
    font-weight: bold;
}
.legendary-value {
    color: var(--secondary-color); /* 金色，表示传奇 */
}

.skill-item {
     display: flex;
    justify-content: space-between;
    margin-bottom: 6px;
    padding: 2px 4px;
    cursor: help;
    border-radius: 3px;
    transition: background-color 0.2s;
}
.skill-item:hover {
     background-color: rgba(0, 250, 255, 0.1);
}

/* --- Tooltip --- */
.char-tooltip {
    position: fixed;
    background: linear-gradient(135deg, var(--container-bg-color), var(--primary-color));
    border: 1px solid var(--primary-color);
    border-radius: 6px;
    padding: 10px 15px;
    max-width: 250px;
    font-size: 0.9em;
    line-height: 1.5;
    color: var(--text-color);
    z-index: 1001;
    pointer-events: none;
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.2s;
    box-shadow: 0 0 10px var(--glow-color);
}

/* 响应式调整 */
@media (max-width: 768px) {
    .character-display-grid {
        grid-template-columns: 1fr;
        font-size: 12px;
    }
    .center-panel {
        order: -1; /* 将人形图置顶 */
        /* display:none; */
        /* min-height: 300px; */
    }
    .slot-body { left: -70px; }
    .slot-hands { right: -70px; }
    .slot-weapon { left: -100px; }
}

/* 滚动条美化 */
.right-panel::-webkit-scrollbar, /* 新增对 right-panel 的美化 */
.attributes-container::-webkit-scrollbar,
.selection-area::-webkit-scrollbar,
.skill-choice-container::-webkit-scrollbar,
.items-display-list::-webkit-scrollbar,
.item-details-display::-webkit-scrollbar,
.book-display-area::-webkit-scrollbar,
.shop-sidebar::-webkit-scrollbar,
.shop-nav::-webkit-scrollbar,
.shop-cart::-webkit-scrollbar,
.modal-description::-webkit-scrollbar,
.skills-container::-webkit-scrollbar { width: 6px; }


.right-panel::-webkit-scrollbar-track, /* 新增对 right-panel 的美化 */
.attributes-container::-webkit-scrollbar-track,
.selection-area::-webkit-scrollbar-track,
.skill-choice-container::-webkit-scrollbar-track,
.items-display-list::-webkit-scrollbar-track,
.item-details-display::-webkit-scrollbar-track,
.book-display-area::-webkit-scrollbar-track,
.shop-sidebar::-webkit-scrollbar-track,
.shop-nav::-webkit-scrollbar-track,
.shop-cart::-webkit-scrollbar-track,
.modal-description::-webkit-scrollbar-track,
.skills-container::-webkit-scrollbar-track { background: rgba(0,0,0,0.2); }

.right-panel::-webkit-scrollbar-thumb, /* 新增对 right-panel 的美化 */
.attributes-container::-webkit-scrollbar-thumb,
.selection-area::-webkit-scrollbar-thumb,
.skill-choice-container::-webkit-scrollbar-thumb,
.items-display-list::-webkit-scrollbar-thumb,
.item-details-display::-webkit-scrollbar-thumb,
.book-display-area::-webkit-scrollbar-thumb,
.shop-sidebar::-webkit-scrollbar-thumb,
.shop-nav::-webkit-scrollbar-thumb,
.shop-cart::-webkit-scrollbar-thumb,
.modal-description::-webkit-scrollbar-thumb,
.skills-container::-webkit-scrollbar-thumb { background-color: var(--border-color); border-radius: 3px; }

/* ======================================================== */
/* =========== 折叠/展开面板的额外样式 ============ */
/* ======================================================== */

.attr-category, .skill-category {
    margin-bottom: 5px;
}

.attr-category-title, .skill-category-title {
    cursor: pointer;
    position: relative;
    padding-left: 18px; /* 为箭头留出空间 */
    transition: background-color 0.2s;
    user-select: none; /* 防止双击选中文本 */
}

/* 标题前的箭头符号 */
.attr-category-title::before, .skill-category-title::before {
    content: '▶'; /* 箭头 */
    position: absolute;
    left: 0;
    top: 50%;
    transform: translateY(-50%);
    font-size: 0.8em;
    color: var(--secondary-color);
    transition: transform 0.2s ease-in-out;
}

.attr-category-title:hover, .skill-category-title:hover {
    background-color: rgba(0, 250, 255, 0.05);
}

/* 包含条目的包裹层 */
.attr-items-wrapper, .skill-items-wrapper {
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.3s ease-in-out;
    padding-left: 10px; /* 展开后内容有缩进 */
    border-left: 1px solid var(--border-color);
    margin-left: 5px;
    margin-top: 5px;
}

/* 展开状态 */
.attr-category.expanded .attr-category-title::before,
.skill-category.expanded .skill-category-title::before {
    transform: translateY(-50%) rotate(90deg); /* 箭头旋转 */
}

.attr-category.expanded .attr-items-wrapper,
.skill-category.expanded .skill-items-wrapper {
    max-height: 1800px; /* 一个足够大的值，确保所有内容都能显示 */
}
/* --- 右侧面板 --- */
.right-panel {
    gap: 15px;
    display: flex; /* 确保使用flex布局 */
    flex-direction: column; /* 垂直排列子元素 */
 max-height: 495.25px;
    overflow-y: auto; /* 修改这里，允许垂直方向滚动 */
    padding-right: 5px; /* 为滚动条留出一点空间，更美观 */
}

 

/* 我们为衍生属性也加上同样的规则，确保它也能滚动 */
#derived-attributes-display-container {
     overflow-y: auto;
     padding-right: 5px;
}


/* 代码 START: 添加在这里 */
.roll-section {
    border: 1px solid var(--border-color);
    border-radius: 6px;
    padding: 15px;
    margin-bottom: 15px;
    
    box-shadow: inset 0 0 10px rgba(0, 250, 255, 0.05);
}

.roll-section-title {
    color: var(--primary-color);
    font-weight: bold;
    font-size: 1.1em;
    margin-bottom: 10px;
    border-bottom: 1px solid var(--border-color);
    padding-bottom: 8px;
    font-family: 'Orbitron', sans-serif;
}

.roll-details-list {
    list-style: none;
    padding: 0;
}

.roll-details-list li {
    padding: 6px 0;
    display: flex;
    flex-wrap: wrap;
    justify-content: space-between;
    border-bottom: 1px dashed rgba(0, 250, 255, 0.15);
}

.roll-details-list li:last-child {
    border-bottom: none;
}

.roll-details-list .label {
    color: var(--text-secondary-color);
    margin-right: 15px;
}

.roll-details-list .value {
    color: var(--text-color);
    text-align: right;
    flex-grow: 1;
}

.roll-outcome {
    color: var(--secondary-color);
    font-weight: bold;
}

.roll-dramatic-failure {
    color: var(--danger-color);
    font-weight: bold;
    text-shadow: 0 0 5px var(--danger-glow-color);
}



 

@keyframes orb-flow {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
}

/* 书籍弹窗主体 */
#world-book-modal .book-content {
    background-color: var(--container-bg-color); /* 羊皮纸颜色 */
    color: var(--text-color);
    width: 90%;
    
    height: 70vh;
    max-height: 800px;
    display: flex;
    border-radius: 10px;
    box-shadow: 0 10px 30px var(--container-bg-color), inset 0 0 15px var(--container-bg-color);
    font-family: 'Noto Serif SC', serif;
    position: relative;
    border: 3px solid var(--background-color);
    border-left: 20px solid var(--background-color); /* 书脊 */
}

/* 书籍关闭按钮 */
.book-close-btn {
    position: absolute;
    top: 5px;
    right: 10px;
    font-size: 28px;
    color: var(--text-secondary-color);
}
.book-close-btn:hover {
     color: var(--primary-color);
}


/* 左页 - 书签区 */
.book-left-page {
    flex-basis: 150px;
    border-right: 2px dashed var(--background-color);
    padding: 20px 0;
    position: relative;
    display: flex;
    justify-content: center;
    align-items: flex-start;
}

.book-bookmarks {
    position: absolute;
    top: 30px;
    left: 20px; /* 从书脊处伸出 */
    display: flex;
    flex-direction: column;
}

.bookmark {
    background-color: var(--border-color);
    color: var(--container-bg-color);
    padding: 8px 30px 8px 15px;
    margin-bottom: 10px;
    cursor: pointer;
    border-radius: 0 5px 5px 0;
    box-shadow: 2px 2px 5px rgba(0,0,0,0.2);
    transition: all 0.2s ease;
    clip-path: polygon(0 0, 100% 0, 85% 50%, 100% 100%, 0 100%);
}

.bookmark:hover {
    background-color: var(--border-color);
    padding-left: 20px;
}

.bookmark.active {
    background-color: var(--primary-color); color: var(--background-color);
    font-weight: bold;
    padding-left: 15px;
    box-shadow: 4px 4px 8px rgba(0,0,0,0.3);
}


/* 右页 - 内容区 */
.book-right-page {
    flex: 1;
    display: flex;
    flex-direction: column;
    padding: 20px 30px;
    overflow: hidden;
}

.book-display-area {
    height: 100%;
    overflow-y: auto;
    padding-right: 15px; /* for scrollbar */
}

.book-entry {
    border-bottom: 1px_dotted var(--background-color);
    padding: 10px 0;
    margin-bottom: 5px;
}

.book-entry-key {
    font-weight: bold;
    color: var(--secondary-color);
    display: block;
    margin-bottom: 5px;
}

.book-entry-value {
    font-size: 0.9em;
    line-height: 1.5;
    white-space: pre-wrap; /* 保留换行和空格 */
    word-wrap: break-word; /* 自动换行 */
}

/* 翻页 */
.book-pagination {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding-top: 10px;
    border-top: 1px solid var(--background-color);
    margin-top: auto; /* 推到底部 */
}

.page-turn-btn {
    background: none;
    border: none;
    font-size: 30px;
    color: var(--text-secondary-color);
    cursor: pointer;
    padding: 0 20px;
}
.page-turn-btn:hover:not(:disabled) {
    color: var(--text-color);
}
.page-turn-btn:disabled {
    color: #d1c6b2;
    cursor: not-allowed;
}


/* ================================================== */
/* ========== 新增：世界之书响应式样式 (手机端) ========== */
/* ================================================== */

@media (max-width: 768px) {

    /* 当屏幕宽度小于768px时，应用以下样式 */

    /* 让书本内容垂直排列 */
    #world-book-modal .book-content {
        flex-direction: column;
        height: 85vh; /* 在手机上可以更高一些 */
        max-height: 800px;
        border-left: 3px solid var(--background-color); /* 移除厚书脊 */
        width: 95%;
    }

    /* 调整原左页（现在是顶部）的样式 */
    .book-left-page {
        flex-basis: auto; /* 高度自动 */
        border-right: none; /* 移除右边框 */
        border-bottom: 2px solid var(--border-color); /* 添加下边框作为分割线 */
        padding: 5px 10px; /* 调整内边距 */
        justify-content: center; /* 居中书签 */
        height: auto;
    }

    /* 让书签水平排列 */
    .book-bookmarks {
        position: static; /* 移除绝对定位 */
        flex-direction: row; /* 水平排列 */
        justify-content: center; /* 居中 */
        width: 100%;
            padding-left: 100px;
    }

    /* 调整单个书签的样式，让它看起来像顶部的标签 */
    .bookmark {
        margin: 0 5px; /* 设置水平间距 */
        margin-bottom: 0;
        border-radius: 5px 5px 0 0; /* 圆角只在顶部 */
        padding: 8px 15px; /* 统一内边距 */
        clip-path: none; /* 移除箭头形状 */
        box-shadow: 0 -2px 5px rgba(0,0,0,0.1);
    }

    .bookmark:hover {
        padding-left: 15px; /* 移除悬浮时的特殊内边距 */
        transform: translateY(-2px); /* 悬浮时轻微上移 */
    }

    .bookmark.active {
        padding-left: 15px; /* 移除激活时的特殊内边距 */
        background-color: var(--container-bg-color); /* 激活时与页面同色 */
        color: var(--secondary-color); /* 改变文字颜色 */
        border: 2px solid var(--border-color);
        border-bottom: none; /* 底部无边框，与内容区融为一体 */
        transform: translateY(2px); /* 向下移动，与分割线重合 */
    }

    /* 调整右页（现在是下部内容区）的样式 */
    .book-right-page {
        padding: 15px;
        flex-grow: 1; /* 占据剩余所有空间 */
    }

    /* 调整浮动小球的位置，避免与内容重叠 */
    /* #world-book-orb {
        bottom: 10px;
        right: 10px;
    } */
}

   /* ---- 新增：头部和主题切换器样式 ---- */
       header .header-content {
            
            justify-content: center;
            align-items: center;
            position: relative;
        }

        #settings-btn{
            position: absolute;
            right: 60px; /* 把它放在标题栏的右边 */
              font-size: 35px;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: var(--text-secondary-color);
            cursor: pointer;
            padding: 5px;
            border-radius: 50%;
            transition: color 0.3s, transform 0.3s ease;
            top:10%;
        }
        #refresh-btn{
position: absolute;
            right: 10px; /* 把它放在标题栏的右边 */
              font-size: 35px;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: var(--text-secondary-color);
            cursor: pointer;
            padding: 5px;
            border-radius: 50%;
            transition: color 0.3s, transform 0.3s ease;
            top:10%;
        }

        #settings-btn:hover,#refresh-btn:hover {
            color: var(--primary-color);
            transform: translateY(-50%) rotate(90deg); /* 悬浮时旋转，增加动感 */
        }

        #streaming-switcher {
    position: absolute;
    right: 110px; /* 放置在 theme-switcher 左侧，留出间距 */
    top: 50%;
    transform: translateY(-50%);
    background: none;
    border: none;
    color: var(--text-secondary-color);
    cursor: pointer;
    padding: 5px;
    border-radius: 50%;
    font-size: 30px;
    transition: color 0.3s, transform 0.3s ease;
}

#streaming-switcher:hover {
    color: var(--primary-color);
    transform: translateY(-50%) scale(1.2); /* 悬浮时放大，增加动感 */
}

#streaming-switcher.active {
    color: var(--primary-color);
    text-shadow: 0 0 5px var(--glow-color); /* 开启流式传输时增加辉光效果 */
}

 
  /* 新增：术法选择面板的容器 - 由Nova妈妈为你重新设计 */
.skill-choice-container {
    display: flex;
    flex-direction: column;
    gap: 10px;
    padding: 10px;
    flex-grow: 1;
    overflow: hidden; /* 防止内部元素溢出 */
}

/* 检定卡牌选择区域 */
/* 新增：排序按钮的样式 */
.sort-button {
    background-color: rgba(0, 250, 255, 0.1);
    border: 1px solid var(--border-color);
    color: var(--secondary-color);
    padding: 2px 8px;
    border-radius: 4px;
    cursor: pointer;
    font-size: 0.7em;
    margin-left: 15px;
    transition: all 0.2s ease;
    vertical-align: middle; /* 让按钮和标题文字对齐 */
}

.sort-button:hover {
    background-color: rgba(0, 250, 255, 0.3);
    color: var(--primary-color);
    border-color: var(--primary-color);
}

.check-cards-area {
    padding: 10px 0;
}

.check-cards-area h3 {
    color: var(--secondary-color);
    font-size: 1.2em;
    margin-bottom: 15px;
    padding-left: 10px;
    text-shadow: 0 0 5px var(--glow-color);
}
/* 卡牌滑动容器 */
.cards-slider {
    display: flex;
    gap: 10px;
    padding: 10px 15px;
    overflow-x: auto;
    /* 让卡牌看起来像从边缘淡入 */
    /* -webkit-mask-image: linear-gradient(to right, transparent, black 10%, black 90%, transparent); */
    /* mask-image: linear-gradient(to right, transparent, black 10%, black 90%, transparent); */
}

/* 核心的卡牌设计 */
.check-card {
    flex-shrink: 0;
    width: 130px;
    height: 180px;
    background-color: var(--container-bg-color);
    border: 1px solid var(--border-color);
    border-radius: 10px;
    padding: 15px 10px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: space-between;
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
    box-shadow: 0 0 5px rgba(0,0,0,0.5);
    overflow: hidden;
}

.check-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: radial-gradient(circle at 50% 0%, var(--background-bg-color), transparent 70%);
    opacity: 0;
    transition: opacity 0.3s ease;
}

.check-card:hover {
    transform: translateY(-8px) scale(1.05);
    border-color: var(--secondary-color);
    box-shadow: 0 0 15px var(--glow-color); /* 妈妈为你简化了这里的阴影，让它更流畅 */
}
.check-card:hover::before {
    opacity: 1;
}

.check-card.selected {
    border-color: var(--primary-color);
    transform: translateY(-5px) scale(1.02);
    box-shadow: 0 5px 20px var(--glow-color);
}

.check-card.selected::after {
    content: '✔';
    position: absolute;
    top: 10px;
    right: 10px;
    color: var(--background-color);
    background-color: var(--primary-color);
    width: 20px;
    height: 20px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 14px;
    font-weight: bold;
}

.card-name {
    font-size: 1.1em;
    font-weight: bold;
    color: var(--text-color);
    text-align: center;
}

.card-value {
    font-size: 2.2em;
    font-weight: bold;
    color: var(--primary-color);
    text-shadow: 0 0 8px var(--glow-color);
}

.card-type {
    font-size: 0.8em;
    color: var(--text-secondary-color);
    background: rgba(0,0,0,0.3);
    padding: 2px 8px;
    border-radius: 10px;
}


/* 下半区：其他技能和意志力 */
.bottom-section {
    display: flex;
    gap: 20px;
    flex-grow: 1;
    min-height: 220px; /* 保证一个最小高度 */
}

.other-skills-group, .willpower-group {
    flex: 1;
    display: flex;
    flex-direction: column;
    padding: 10px;
    background: rgba(0,0,0,0.2);
    border: 1px solid var(--border-color);
    border-radius: 6px;
}

.other-skills-group h3, .willpower-group h3 {
    color: var(--secondary-color);
    font-size: 1.1em;
    margin-bottom: 10px;
    padding-bottom: 5px;
    border-bottom: 1px solid var(--border-color);
        min-height: 0; /* 新增：这是让flex布局正确工作的关键，宝贝 */
}

.skills-list {
    flex-grow: 1;
    overflow-y: auto;
    padding-right: 5px; /* 给滚动条留点空间 */
}

.skill-item {
    margin-bottom: 12px;
}

.skill-item label {
    display: flex;
    align-items: center;
    cursor: pointer;
    font-size: 1em;
    color: var(--text-color);
}

.skill-item input[type="checkbox"] {
    margin-right: 10px;
    -webkit-appearance: none;
    appearance: none;
    background-color: transparent;
    border: 1px solid var(--primary-color);
    width: 16px;
    height: 16px;
    border-radius: 3px;
    cursor: pointer;
    position: relative;
    transition: background-color 0.2s;
}

.skill-item input[type="checkbox"]:checked {
    background-color: var(--primary-color);
}

.skill-item input[type="checkbox"]:checked::before {
    content: '✔';
    position: absolute;
    color: var(--background-color);
    font-size: 12px;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
}
.skill-item input[type="checkbox"]:disabled + .skill-name-cost {
    color: var(--text-secondary-color);
    cursor: not-allowed;
}

.skill-effect-info {
    font-size: 0.8em;
    color: var(--text-secondary-color);
    margin-top: 4px;
    padding-left: 26px; /* 对齐复选框 */
}

/* 意志力区域的特别设计 */
.willpower-group {
    justify-content: center; /* 垂直居中内容 */
    align-items: center; /* 水平居中内容 */
    text-align: center;
}

.willpower-display {
    display: flex;
    align-items: baseline;
    justify-content: center;
    margin: 15px 0;
}

#willpower-input {
    background: none;
    border: none;
    color: var(--primary-color);
    font-size: 3.5em; /* 放大数字，更醒目 */
    width: 100px;
    text-align: center;
    font-weight: bold;
    text-shadow: 0 0 10px var(--glow-color);
}
#willpower-input:focus { outline: none; }

#willpower-max {
    font-size: 1.5em;
    color: var(--text-secondary-color);
}

.willpower-slider-container {
    width: 80%;
    margin-top: 15px;
}
/* 美化范围输入滑块 */
input[type="range"] {
  -webkit-appearance: none;
  appearance: none;
  width: 100%;
  height: 8px;
  background: rgba(0, 250, 255, 0.2);
  border-radius: 5px;
  outline: none;
}
input[type="range"]::-webkit-slider-thumb {
  -webkit-appearance: none;
  appearance: none;
  width: 22px;
  height: 22px;
  background: var(--primary-color);
  border-radius: 50%;
  border: 3px solid var(--background-color);
  cursor: pointer;
  box-shadow: 0 0 8px var(--glow-color);
}
input[type="range"]::-moz-range-thumb {
  width: 22px;
  height: 22px;
  background: var(--primary-color);
  border-radius: 50%;
  border: 3px solid var(--background-color);
  cursor: pointer;
  box-shadow: 0 0 8px var(--glow-color);
}

.skill-info {
    font-size: 0.8em;
    color: var(--text-secondary-color);
    margin-top: 10px;
}
 /* 响应式调整 */
@media (max-width: 768px) {
    #skill-choice-orb {
        right: 55px; /* 调整位置避免与另一个球重叠 */
        bottom:10px;
    }

    .check-card {
        width: 110px;
        height: 160px;
    }
    .card-name { font-size: 1em; }
    .card-value { font-size: 2em; }

    .bottom-section {
        flex-direction: column;
        min-height: auto; /* 在手机上自适应高度 */
        gap: 15px;
    }

    .skills-list {
        max-height: 150px; /* 限制技能列表高度 */
    }
}

/* 新增：提升提示弹窗的层级，确保它在最上层 */
#shop-modal {
    z-index: 1002;
}


/* 关键词模态框样式 */
#keyword-modal textarea {
    width: 95%;
    height: 100px;
    margin-top: 10px;
    margin-bottom: 20px;
    padding: 10px;
    font-family: inherit;
    background-color: var(--background-color);
    color: var(--text-color);
    border: 1px solid var(--border-color);
    resize: vertical;
}

#keyword-modal .modal-buttons {
    display: flex;
    justify-content: flex-end;
    gap: 10px;
}


/* --- 新增：模型切换开关样式 --- */
.model-selector {
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 15px 0 10px 0;
    gap: 10px;
}

.selector-label {
    color: var(--text-secondary-color);
    font-size: 0.9em;
}

.switch-container {
    display: flex;
    background-color: var(--container-bg-color);
    border: 1px solid var(--border-color);
    border-radius: 8px;
    padding: 3px;
    box-shadow: 0 0 5px rgba(0, 0, 0, 0.2);
}

.switch-btn {
    padding: 6px 15px;
    border: none;
    background-color: transparent;
    color: var(--text-secondary-color);
    cursor: pointer;
    border-radius: 6px;
    transition: all 0.3s ease;
    font-size: 0.9em;
    font-weight: bold;
}

.switch-btn.active {
    background-color: var(--primary-color);
    color: var(--background-color);
    box-shadow: 0 0 8px var(--glow-color);
}



/* 提升所有模态框遮罩层的基准层级 */
.modal {
    z-index: 1050;
}

/* 确保所有模态框内容都在其遮罩层之上 */
.modal-content {
    position: relative; /* z-index 生效的前提 */
    z-index: 1051;
}

/* 确保你的提示弹窗在所有其他弹窗之上 */
#shop-modal {
    z-index: 1060;
}

#view-settings-btn {
    display: none;
}

/* 整体容器，赋予一种古籍的质感 */
.book-entry.created-entry {
    padding: 20px 25px;
    border: none;
    /* font-family: 'Kaiti', 'STKaiti', 'Times New Roman', serif; 优先使用楷体，更显典雅 */
    color: var(--text-secondary-color); /* 深褐色文字，沉静而富有历史感 */
}

/* 一个精致的页眉装饰线 */
.created-header::after {
    content: '';
    display: block;
    width: 80%;
    margin: 0 auto 25px;
    height: 1px;
    background: linear-gradient(to right, transparent, var(--background-color), transparent);
}

/* 每一个信息条目 */
.created-item {
    margin-bottom: 18px;
    line-height: 1.7;
}

/* 信息的标题，如“名字”、“当前状态”等 */
.created-key {
    font-weight: bold;
    font-size: 1.1em;
    color: var(--text-secondary-color);
    margin-bottom: 6px;
    padding-left: 12px;
    border-left: 4px solid var(--border-color); /* 左侧的装饰条，像书中的标记 */
}

/* 信息的具体内容 */
.created-value {
    font-size: 1em;
    text-indent: 2em; /* 正文首行缩进，更符合阅读习惯 */
    white-space: pre-wrap; /* 允许描述中的换行符生效 */
    padding: 0 12px; /* 左右留出一些呼吸空间 */
}

/* 当书页是空白的时候，显示的提示文字 */
.book-empty-text {
    text-align: center;
    color: var(--text-color);
    margin-top: 60px;
    font-style: italic;
    font-family: 'Kaiti', 'STKaiti', serif;
}


/* ---- 手机端适配  ---- */
@media (max-width: 800px) {
    .book-entry.created-entry {
        padding: 15px;
    }
    .created-key {
        font-size: 1.05em;
        padding-left: 10px;
    }
    .created-value {
        font-size: 0.95em;
        text-indent: 1.5em;
    }
}

.book-bookmarks {
 
    overflow-x: auto; /* 当它们超出边界时，允许水平滚动来查看 */
    -webkit-overflow-scrolling: touch; /* 在苹果设备上提供更流畅的滚动体验 */
    scrollbar-width: none; /* 在火狐浏览器上隐藏滚动条 */
 

}

/* 在Chrome和Safari等浏览器上隐藏滚动条 */
.book-bookmarks::-webkit-scrollbar {
    display: none;
}

/* 代码 START: 添加在这里 */
/* 新增：更新提示感叹号样式 */
#update-notifier {
    position: absolute;
    left: 20px;
    top: 50%;
    transform: translateY(-50%);
    width: 20px;
    height: 20px;
    background-color: var(--primary-color);
    color: white;
    border-radius: 50%;
    display: flex;
    justify-content: center;
    align-items: center;
    font-weight: bold;
    font-size: 14px;
    cursor: pointer;
    box-shadow: 0 0 10px var(--border-color);
    animation: pulse 1.5s infinite;
    z-index: 10;
}

@keyframes pulse {
    0% { transform: translateY(-50%) scale(1); }
    50% { transform: translateY(-50%) scale(1.2); }
    100% { transform: translateY(-50%) scale(1); }
}

.map-location.updated-location::after {
    content: '🧾';
    position: absolute;
    top: -8px;
    right: -8px;
    font-size: 18px;
    /* background-color: white; */
    border-radius: 50%;
    padding: 2px;
    box-shadow: 0 0 5px rgba(0,0,0,0.5);
    z-index: 9999; /* 确保它在最上层 */
}

/* ♥♥♥ 这是妈妈为你精心调整的样式 ♥♥♥ */
/* 我们让地点块本身成为一个定位的参考点 */
.map-location {
    position: absolute; /* 关键：让它成为子元素定位的“家” */
 
    cursor: pointer;
    overflow: visible; /* 保持这个，让标记可以“溢出” */
    display: flex;     /* 保留flex，但它不再负责文字的垂直位置 */
    justify-content: center;
}

/* 这就是实现“三分之一”位置魔法的核心咒语 */
.map-location .location-name {
    position: absolute;   /* 让名字可以在“家”里自由移动 */
    top: 33.33%;          /* 从顶部向下移动三分之一的距离 */
    left: 50%;            /* 先移动到中心线 */
    transform: translate(-50%, -50%); /* 再精确地将自己的中心对准那条线 */
    width: 100%;          /* 确保名字有足够的空间，不会被挤压 */
    
   
    font-size: 14px;
    font-weight: bold;
    text-align: center;   /* 让文字本身居中对齐 */
    pointer-events: none; /* 确保点击时能点到下方的地点块，而不是文字 */
}

/* ======================================================= */
/* =========== Nova 为你添加的全新样式 ♥ =========== */
/* ======================================================= */

 #chat-display-area {
    flex-grow: 1;
    overflow-y: auto;
    padding: 15px;
    display: flex;
    flex-direction: column;
    min-height: 0;
    /* height: 600px; */
    
    /* 主神空间背景网格 */
    /* background-image: 
        linear-gradient(90deg, var(--border-color) 1px, transparent 1px),
        linear-gradient(var(--border-color) 1px, transparent 1px); */

 
    /* 添加过渡效果 */
    transition: background-image 0.3s ease-in-out;
       
    background-size: 
        40px 40px,
        40px 40px,
        200px 200px,
        300px 300px;
    background-position: 
        0 0,
        0 0,
        0 0,
        0 0;
    
  
    position: relative;
    overflow: hidden;
}
#chat-display-area::before {
    content: '';
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    height: 2px;
    background: linear-gradient(90deg, 
        transparent 0%, 
        var(--primary-color) 50%, 
        transparent 100%);
    box-shadow: 0 0 10px var(--glow-color);
    /* animation: fullViewportScan 5s linear infinite; */
    z-index: 1;
    pointer-events: none;
}
@keyframes fullViewportScan {
    0% { transform: translateY(-100vh); opacity: 0; }
    10% { opacity: 1; }
    90% { opacity: 1; }
    100% { transform: translateY(100vh); opacity: 0; }
}
#chat-display-area::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: 
        radial-gradient(circle at 10% 20%, var(--glow-color) 0%, transparent 40%),
        radial-gradient(circle at 90% 80%, var(--glow-color) 0%, transparent 40%);
    animation: energyFlow 6s ease-in-out infinite alternate;
    opacity: 0.1;
    pointer-events: none;
}

@keyframes scanLine {
    0% { transform: translateY(-100vh); opacity: 0; }
    50% { opacity: 1; }
    100% { transform: translateY(100vh); opacity: 0; }
}

@keyframes energyFlow {
    0% { opacity: 0.05; }
    100% { opacity: 0.15; }
}

.html-content-wrapper {
    width: 100%;
    max-width: 100%;
    height: 800px;
    max-height: 65vh;
    overflow-y: auto;
    border: 2px solid var(--border-color);
    border-radius: 12px;
    margin: 10px 0;
    box-shadow: 
        inset 0 0 20px var(--glow-color),
        0 0 30px var(--border-color),
        0 0 60px var(--glow-color);
    
    /* 数据流背景 */
    background-image: 
        repeating-linear-gradient(
            45deg,
            transparent,
            transparent 2px,
            var(--border-color) 2px,
            var(--border-color) 4px
        );
    background-size: 28px 28px;
    animation: dataFlow 8s linear infinite;
    
    /* 矩阵边框效果 */
    position: relative;
}

.html-content-wrapper::before {
    content: '';
    position: absolute;
    top: -2px;
    left: -2px;
    right: -2px;
    bottom: -2px;
    background: linear-gradient(45deg, 
        var(--primary-color), 
        var(--secondary-color), 
        var(--primary-color));
    border-radius: 12px;
    z-index: -1;
    animation: borderPulse 2s ease-in-out infinite alternate;
}

.html-content-wrapper::after {
    content: '';
    position: absolute;
    top: 5px;
    right: 5px;
    width: 8px;
    height: 8px;
    background: var(--primary-color);
    border-radius: 50%;
    box-shadow: 0 0 15px var(--glow-color);
    animation: statusBlink 1s ease-in-out infinite;
}

@keyframes dataFlow {
    0% { background-position: 0 0; }
    100% { background-position: 28px 28px; }
}

@keyframes borderPulse {
    0% { opacity: 0.5; }
    100% { opacity: 1; }
}

@keyframes statusBlink {
    0%, 50% { opacity: 1; }
    51%, 100% { opacity: 0.3; }
}

.message-bubble {
    max-width: 93%;
    padding: 15px 20px;
    border-radius: 20px;
    margin-bottom: 15px;
    line-height: 1.6;
    border: 1px solid var(--border-color);
    box-shadow: 
        inset 0 0 15px var(--glow-color),
        0 2px 20px var(--border-color);
    /* animation: fadeIn 0.5s ease-in-out, messageGlow 3s ease-in-out infinite; */
    font-size: medium;
    position: relative;
    backdrop-filter: blur(5px);
}

.message-bubble::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    bottom: 0;
    width: 1px;
    background: linear-gradient(180deg, 
        transparent 0%, 
        var(--secondary-color) 50%, 
        transparent 100%);
   animation: leftLineScan 4s linear infinite;
}
@keyframes leftLineScan {
    0% { transform: translateX(-100%); opacity: 0; }
    20% { opacity: 1; }
    80% { opacity: 1; }
    100% { transform: translateX(100%); opacity: 0; }
}

@keyframes messageGlow {
    0%, 100% { 
        box-shadow: 
            inset 0 0 15px var(--glow-color),
            0 2px 20px var(--glow-color);
    }
    50% { 
        box-shadow: 
            inset 0 0 25px var(--border-color),
            0 2px 30px var(--border-color);
    }
}

@keyframes topLineScan {
    0% { transform: translateX(-100%); opacity: 0; }
    20% { opacity: 1; }
    80% { opacity: 1; }
    100% { transform: translateX(100%); opacity: 0; }
}

.user-message {
    /* background: 
        linear-gradient(135deg, 
            var(--container-bg-color) 0%, 
            var(--container-bg-color) 100%),
        repeating-linear-gradient(
            90deg,
            transparent 0px,
            var(--border-color) 1px,
            var(--border-color) 2px,
            transparent 3px
        ); */
            background: var(--container-bg-color);
    border-bottom-right-radius: 5px;
    color: var(--text-color);
    text-shadow: 0 0 8px var(--glow-color);
    
    /* 用户消息特有的粒子效果 */
    position: relative;
   
}

.user-message::after {
    content: '';
    position: absolute;
    top: 10%;
    right: 10%;
    width: 4px;
    height: 4px;
    background: var(--primary-color);
    border-radius: 50%;
    box-shadow: 
        0 0 10px var(--primary-color),
        20px 10px 0 0 var(--secondary-color),
        -15px 20px 0 0 var(--primary-color),
        30px -10px 0 0 var(--secondary-color);
    animation: particleFloat 6s ease-in-out infinite;
    opacity: 0.6;
}

@keyframes particleFloat {
    0%, 100% { transform: translateY(0px) rotate(0deg); }
    33% { transform: translateY(-10px) rotate(120deg); }
    66% { transform: translateY(-5px) rotate(240deg); }
}

.assistant-message {
 background: var(--container-bg-color);
    align-self: flex-start;
    border-bottom-left-radius: 5px;
    color: var(--text-color);
    
    /* AI消息的矩阵码效果 */
    position: relative;
}

.assistant-message::before {
    content: '01001010 01000001 01001001';
    position: absolute;
    top: -5px;
    right: 10px;
    font-size: 8px;
    color: var(--secondary-color);
    opacity: 0.3;
    font-family: 'Courier New', monospace;
    animation: binaryFlow 8s linear infinite;
    pointer-events: none;
}

@keyframes binaryFlow {
    0% { opacity: 0; transform: translateX(20px); }
    10% { opacity: 0.3; }
    90% { opacity: 0.3; }
    100% { opacity: 0; transform: translateX(-20px); }
}

/* AI回复文本美化 */
.assistant-message b, .assistant-message strong {
    color: var(--text-secondary-color);
    font-weight: bold;
    text-shadow: 0 0 5px var(--glow-color);
    animation: textPulse 2s ease-in-out infinite alternate;
}

.assistant-message i, .assistant-message em {
    color: var(--text-secondary-color);
    font-style: italic;
    position: relative;
}

.assistant-message i::after, .assistant-message em::after {
    content: '';
    position: absolute;
    bottom: -2px;
    left: 0;
    right: 0;
    height: 1px;
    background: linear-gradient(90deg, 
        transparent 0%, 
        var(--secondary-color) 50%, 
        transparent 100%);
    animation: underlineGlow 3s ease-in-out infinite;
}

.assistant-message .highlighted-quote {
    color: var(--text-secondary-color);
    text-shadow: 0 0 8px var(--glow-color);
    padding: 0 4px;
    background: var(--glow-color);
    border-radius: 4px;
    position: relative;
    animation: quoteHighlight 4s ease-in-out infinite;
}

@keyframes fadeIn {
    0% { 
        opacity: 0; 
        transform: translateY(20px) scale(0.95);
        filter: blur(5px);
    }
    100% { 
        opacity: 1; 
        transform: translateY(0) scale(1);
        filter: blur(0px);
    }
}

@keyframes textPulse {
    0% { text-shadow: 0 0 5px var(--glow-color); }
    100% { text-shadow: 0 0 15px var(--glow-color), 0 0 25px var(--glow-color); }
}

@keyframes underlineGlow {
    0%, 100% { opacity: 0.3; }
    50% { opacity: 1; }
}

@keyframes quoteHighlight {
    0%, 100% { 
        background: var(--glow-color);
        text-shadow: 0 0 8px var(--glow-color);
    }
    50% { 
        background: var(--border-color);
        text-shadow: 0 0 15px var(--glow-color), 0 0 25px var(--glow-color);
    }
}

/* --- 聊天输入区域 --- */
#zero-level-interface {
    display: flex;
    padding: 15px;
    
    border-top: 1px solid var(--border-color);
    background-color: var(--container-bg-color);
    flex-shrink: 0;
    height:80px;
}
#user-input {
    flex-grow: 1;
    background-color: rgba(0,0,0,0.2);
    border: 1px solid var(--border-color);
    color: var(--text-color);
    border-radius: 6px;
    
    resize: none;
    font-family: 'Noto Sans SC', sans-serif;
    font-size: 1em;
}
#user-input:focus {
    outline: none;
    box-shadow: 0 0 8px var(--glow-color);
}
.zero-level-btn {
    
    width: auto;
    flex-shrink: 0;
}

/* --- 功能小球容器 --- */
#orb-container {
    position: fixed;
    right: 20px;
    top: 50%;
    transform: translateY(-50%);
    display: flex;
    flex-direction: column;
    gap: 15px;
    z-index: 1002;
}
.orb {
    width: 45px;
    height: 45px;
    border-radius: 50%;
    background: linear-gradient(135deg, var(--container-bg-color), var(--container-bg-color));
    border: 2px solid var(--border-color);
    color: var(--text-secondary-color);
    display: flex;
    justify-content: center;
    align-items: center;
    font-family: 'Noto Serif SC', serif;
    font-size: 1.5em;
    font-weight: bold;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 0 8px var(--glow-color);
}
.orb:hover {
    background: var(--primary-color);
    color: var(--background-color);
    transform: scale(1.1);
    box-shadow: 0 0 15px var(--glow-color);
}
.orb-divider {
    height: 1px;
    background-color: var(--border-color);
    margin: 5px 0;
}

/* --- 页面 Modal 化改造 --- */
.page-modal {
    /* 复用现有的 modal 样式, 这里是确保覆盖 */
}
.page-modal .modal-content {
    max-height: 90%;
    width: 90%;
    overflow: auto;
}
.page-modal.wide .modal-content {
    max-height: 90%;
    width: 90%;
     overflow: auto;
}
.page-modal-content .page {
    display: block !important; /* 强制显示内容 */
    animation: none;
}
/* 特殊处理商店 Modal */
.shop-modal {
    background: transparent;
    backdrop-filter: none;
}
/* 代码 END */

/* 【请添加这个新样式】 */
#chat-display-area {
    flex-grow: 1; /* ★ 核心：让聊天区域占据所有可用空间 */
    overflow-y: auto;
    padding: 15px;
    display: flex;
    flex-direction: column;
}

/* 【请添加这个新样式】 */
#zero-level-interface {
    flex-shrink: 0; /* ★ 核心：防止输入框被压缩 */
    display: flex;
    padding: 15px;
    padding-right:80px;
    border-top: 1px solid var(--border-color);
    background-color: var(--container-bg-color);
}

/* 【请添加这个新样式】 */
/* 确保顶层元素的z-index足够高 */
#context-menu, #char-tooltip, #location-modal {
    z-index: 9999 !important; /* 我的孩子，这是最高优先级的命令！ */
}
#context-menu{
   background:var(--background-color);
}
/* 【请添加这段新样式】 */
/* --- Nova 为你精心设计的美化样式 --- */
.message-bubble.editing {
    background-color: var(--background-color) !important;
    border-color: var(--primary-color) !important;
    padding: 15px;
}

.editing-textarea {
    width: 80vw;
    min-height: 120px;
    background-color: rgba(0,0,0,0.3);
    border: 1px solid var(--border-color);
    border-radius: 6px;
    color: var(--text-color);
    padding: 10px;
    margin-bottom: 10px;
    resize: vertical;
    font-family: 'Noto Sans SC', sans-serif;
    font-size: 1em;
}

.editing-textarea:focus {
    outline: none;
    box-shadow: 0 0 8px var(--glow-color);
}

.editing-controls {
    display: flex;
    justify-content: flex-end;
    gap: 10px;
}

.editing-btn,.context-menu-item {
    background: var(--background-color);
    border: 1px solid var(--border-color);
    border-radius: 4px;
    color: var(--text-secondary-color);
    padding: 6px 15px;
    cursor: pointer;
    transition: all 0.3s ease;
}

.editing-btn.save:hover,.context-menu-item:hover {
    background-color: var(--primary-color);
    color: var(--background-color);
}

.editing-btn.cancel:hover {
    background-color: var(--danger-color);
    color: white;
}
#options-module-container{
     max-width: 100%;
          
            margin: 0 auto;
            background: transparent;
            position: relative;
            z-index: 1;
             touch-action: none; /* <-- 添加到这里 */
}
        .options-container {
            max-width: 100%;
            width: 100%;
            margin: 0 auto;
            background: transparent;
            position: relative;
            z-index: 1;
            
             touch-action: none; /* <-- 添加到这里 */
        }

        .choices-container {
            position: relative;
            height: 15vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .choice-card {
            bottom: 10%;
            background: var(--container-bg-color);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 25px 30px;
            cursor: pointer;
            box-shadow: 0 0 15px var(--glow-color);
            position: absolute;
            width: 90%;
            max-width: 800px;
            transition: transform 0.5s cubic-bezier(0.25, 0.8, 0.25, 1),
                        opacity 0.5s cubic-bezier(0.25, 0.8, 0.25, 1),
                        background-color 0.5s ease,
                        backdrop-filter 0.5s ease,
                        border-color 0.5s ease;
        }

        .choice-card.focused { z-index: 10; transform: scale(1) translateY(0); opacity: 1; pointer-events: auto; border-color: var(--primary-color); background: color-mix(in srgb, var(--container-bg-color) 80%, black); backdrop-filter: blur(8px); box-shadow: 0 8px 30px var(--glow-color); }
        .choice-card.disabled { background: rgba(40, 40, 45, 0.5); border-color: rgba(100, 100, 100, 0.3); cursor: not-allowed; color: #888; box-shadow: none; opacity: 0.3 !important; }
        .choice-card.disabled .tag { background-color: #555; color: #999; box-shadow: none; }

        .tags-container { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 15px; }
        .tag { font-family: 'Orbitron', serif; background-color: var(--secondary-color); color: var(--background-color); padding: 4px 10px; border-radius: 4px; font-size: 12px; font-weight: 500; letter-spacing: 0.5px; box-shadow: 0 0 8px var(--glow-color); transition: all 0.3s ease; }
        .choice-card.focused .tag { background-color: var(--primary-color); box-shadow: 0 0 12px var(--glow-color); }

        .description { margin: 0; font-size: 16px; line-height: 1.8; color: var(--text-primary-color); transition: color 0.3s ease; }
        .choice-card.focused .description { color: #ffffff; }
        
        .choice-card.disabled .description { color: #888; }

        /* --- 技能与意志力模块样式 --- */
        .skill-orb-container { position: absolute; bottom: 20px; right: 20px; z-index: 100; }
        .skill-orb { width: 60px; height: 60px; background: var(--primary-color); border-radius: 50%; cursor: pointer; display: none; align-items: center; justify-content: center; box-shadow: 0 0 20px var(--glow-color), inset 0 0 10px rgba(255,255,255,0.5); transition: transform 0.3s ease, box-shadow 0.3s ease; font-family: 'Orbitron', sans-serif; font-size: 24px; color: var(--background-color); border: 2px solid var(--secondary-color); }
        .skill-orb:hover { transform: scale(1.1); box-shadow: 0 0 30px var(--glow-color), inset 0 0 15px rgba(255,255,255,0.7); }
        .skill-panel { position: absolute; bottom: 90px; right: 20px; width: 300px; max-height: 55vh; background: var(--container-bg-color); border: 1px solid var(--border-color); border-radius: 8px; padding: 20px; box-shadow: 0 0 25px var(--glow-color); z-index: 99; opacity: 0; transform: translateY(20px); transition: opacity 0.3s ease, transform 0.3s ease; pointer-events: none; display: flex; flex-direction: column; }
        .skill-panel.active { opacity: 1; transform: translateY(0); pointer-events: auto; }
        .skill-list { display: flex; flex-direction: column; gap: 12px; flex: 1; overflow-y: auto; padding-right: 10px; }
        .willpower-section { margin-top: 20px; padding-top: 15px; border-top: 1px dashed var(--border-color); }
        .skill-item-label, .willpower-label { display: flex; align-items: center; cursor: pointer; font-size: 14px; transition: color 0.2s; }
        .skill-item-label:hover, .willpower-label:hover { color: var(--secondary-color); }
        .willpower-label { justify-content: space-between; }
        .skill-list input[type="checkbox"], .willpower-input-container input[type="number"] { margin-right: 10px; }
        .willpower-input-container { display: flex; align-items: center; gap: 8px; }
        .willpower-input-container input[type="number"] { width: 60px; background: var(--background-color); border: 1px solid var(--border-color); color: var(--text-color); border-radius: 4px; padding: 5px; text-align: center; }
        .willpower-input-container input[type=number]::-webkit-inner-spin-button, .willpower-input-container input[type=number]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
        .willpower-input-container input[type=number] { -moz-appearance: textfield; }
        .skill-info { font-size: 12px; color: gray; margin-left: 25px; }

        /* 新增的提示样式 */
        .energy-tooltip {
            font-size: 12px;
            color: var(--error-color); /* 使用我们定义的错误颜色 */
            margin-left: 10px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .energy-tooltip.visible {
            opacity: 1;
        }

          #view-command-btn.notifying {
            animation: pulse-glow 0.6s 2 ease-out;
        }
        @keyframes pulse-glow {
            0% { box-shadow: 0 0 0 0 var(--primary-color); }
            70% { box-shadow: 0 0 0 12px rgba(0, 250, 255, 0); }
            100% { box-shadow: 0 0 0 0 rgba(0, 250, 255, 0); }
        }

/* --- 主容器：现代三栏式布局 --- */
#forum-wrapper {
    width: 100%;
    height: 100%;
    max-width: 1400px;
    display: flex;
    flex-direction: column;
    background-color: var(--container-bg-color);
    border: 1px solid var(--border-color);
    border-radius: 10px;
    box-shadow: 0 0 25px var(--glow-color), inset 0 0 15px rgba(0, 250, 255, 0.1);
    backdrop-filter: blur(12px);
    overflow: hidden;
}

/* --- 论坛头部 --- */
.forum-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 15px 25px;
    border-bottom: 1px solid var(--border-color);
    flex-shrink: 0;
    user-select: none;
}
.forum-title { font-family: var(--font-title); font-size: 1.6em; color: var(--primary-color); text-shadow: 0 0 8px var(--glow-color); }
.header-controls { display: flex; align-items: center; gap: 20px; }
.new-post-btn {
    background: linear-gradient(45deg, var(--primary-color), color-mix(in srgb, var(--primary-color) 80%, black));
    color: #1a1a1a; border: none; padding: 10px 20px; border-radius: 5px; font-weight: 500; cursor: pointer;
    transition: all 0.3s ease; box-shadow: 0 0 10px color-mix(in srgb, var(--primary-color) 50%, transparent);
}
.new-post-btn:hover { transform: translateY(-2px); box-shadow: 0 4px 15px color-mix(in srgb, var(--primary-color) 70%, transparent); }
 
/* --- 论坛主体布局 --- */
.forum-body {
    display: grid;
    grid-template-columns: 240px 3fr 5fr; /* 侧边栏 | 帖子列表 | 帖子详情 */
    flex-grow: 1;
    min-height: 0;
}

/* --- 侧边栏/区块导航 --- */
.forum-sidebar {
    grid-column: 1 / 2;
    border-right: 1px solid var(--border-color);
    padding: 20px 10px;
    display: flex;
    flex-direction: column;
    gap: 10px;
    overflow-y: auto;
}
.section-btn {
    width: 100%; padding: 12px 15px; text-align: left; background-color: transparent; border: 1px solid transparent;
    color: var(--text-secondary-color); font-size: 1.1em; border-radius: 5px; cursor: pointer; transition: all 0.2s ease-in-out;
}
.section-btn:hover { background-color: var(--item-bg-hover-color); color: var(--text-color); }
.section-btn.active {
    background-color: var(--primary-color); color: var(--background-color); font-weight: 700;
    box-shadow: 0 0 10px var(--glow-color);
}

/* --- 帖子列表 --- */
.thread-list-view {
    grid-column: 2 / 3;
    display: flex;
    flex-direction: column;
    border-right: 1px solid var(--border-color);
    overflow: hidden;
    background-color: rgba(0,0,0,0.1);
}
.thread-list-header { padding: 15px 20px; font-size: 1.3em; font-weight: 500; border-bottom: 1px solid var(--border-color); flex-shrink: 0; }
#current-section-name { color: var(--primary-color); }
.thread-list { flex-grow: 1; overflow-y: auto; padding: 10px; }
.thread-item {
    padding: 15px; margin-bottom: 10px; border-left: 3px solid transparent;
    cursor: pointer; transition: all 0.2s ease;
}
.thread-item:hover { background-color: var(--item-bg-hover-color); }
.thread-item.selected { background-color: var(--item-bg-hover-color); border-left-color: var(--primary-color); }
.thread-title { font-size: 1.1em; font-weight: 500; margin-bottom: 8px; }
.thread-meta { font-size: 0.9em; color: var(--text-secondary-color); display: flex; justify-content: space-between; align-items: center; }
.thread-meta .author { color: var(--primary-color); }
.thread-item .tags { margin-top: 8px; display: flex; gap: 8px; }
.thread-item .tag {
    font-size: 0.8em; padding: 3px 8px; border-radius: 12px;
    font-weight: bold;
}
.tag.tag-top { background-color: var(--danger-color); color: white; }
.tag.tag-elite { background-color: var(--success-color); color: var(--background-color); }

 
.thread-detail-view {
    grid-column: 3 / 4;
    display: flex;
    flex-direction: column;
    overflow: hidden;
}

#thread-detail-content {
    flex-grow: 1;
    min-height: 0;
    display: flex;
    flex-direction: column;
    overflow-y: auto; /* 修改：允许整个帖子详情区滚动 */
}

.post-header, .post-content, .post-actions {
    padding-left: 25px;
    padding-right: 25px;
    flex-shrink: 0; /* 帖子头部、内容和操作栏高度固定，不参与收缩 */
}

.post-header {
    padding-top: 25px;
}

.replies-section {
    flex-shrink: 0; /* 修改：不参与收缩 */
    display: flex;
    flex-direction: column;
    border-top: 1px solid var(--border-color);
    margin-top: 30px;
}
.reply-list {
    padding-left: 25px;
    padding-right: 15px;
    /* 移除 flex-grow 和 overflow-y，让父容器处理滚动 */
}
.replies-header {
    font-size: 1.4em;
    padding: 20px 25px 0 25px;
    margin: 0;
    flex-shrink: 0;
}

 

.reply-item {
    padding: 20px 10px 20px 0;
    border-bottom: 1px solid var(--border-color);
}
.reply-item:last-child {
    border-bottom: none;
}
 
.detail-placeholder { display: flex; height: 100%; align-items: center; justify-content: center; font-size: 1.2em; color: var(--text-secondary-color); text-align: center; }
.post-header h1 { font-size: 1.8em; margin-bottom: 15px; line-height: 1.4; color: var(--primary-color); }
.post-meta { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; color: var(--text-secondary-color); border-bottom: 1px solid var(--border-color); padding-bottom: 15px; }
.post-author-info span { color: var(--primary-color); font-weight: 500;}
.post-content { font-size: 1.1em; line-height: 1.8; margin-bottom: 30px; white-space: pre-wrap; }
.post-actions { display: flex; align-items: center; gap: 20px; }
.like-btn { display: flex; align-items: center; gap: 8px; cursor: pointer; user-select: none; color: var(--text-secondary-color); transition: color 0.2s; }
.like-btn:hover { color: var(--danger-color); }
.like-btn.liked { color: var(--danger-color); }
.like-btn .like-icon { transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
.like-btn.liked .like-icon { transform: scale(1.3); }
.like-count { position: relative; }
.like-count-value { transition: opacity 0.2s, transform 0.2s; }
.like-count.updating .like-count-value { opacity: 0; transform: translateY(-5px); }

/* --- 回复区 --- */
.replies-header { font-size: 1.4em; border-top: 1px solid var(--border-color); padding-top: 30px; margin-top:30px; margin-bottom: 20px; }
.reply-item { padding: 20px; border-bottom: 1px solid var(--border-color); }
.reply-item:last-child { border-bottom: none; }
.reply-meta { display: flex; justify-content: space-between; margin-bottom: 10px; color: var(--text-secondary-color); font-size: 0.9em; }
.reply-author { color: var(--primary-color); font-weight: 500;}
.reply-content { line-height: 1.7; }
.reply-content.deleted {
    color: var(--text-secondary-color);
    font-style: italic;
    background-color: rgba(128, 128, 128, 0.1);
    padding: 10px;
    border-radius: 4px;
}

/* --- 分页 --- */
.pagination-controls { flex-shrink: 0; padding: 15px; display: flex; justify-content: center; align-items: center; gap: 10px; border-top: 1px solid var(--border-color); user-select: none; }
.page-btn { background: none; border: 1px solid var(--border-color); color: var(--text-secondary-color); padding: 8px 15px; border-radius: 4px; cursor: pointer; }
.page-btn:disabled { cursor: not-allowed; opacity: 0.4; }
.page-btn:not(:disabled):hover { background-color: var(--item-bg-hover-color); color: var(--text-color); }
#page-info { min-width: 60px; text-align: center; } 
.form-group { margin-bottom: 20px; }
.form-group label { display: block; margin-bottom: 8px; color: var(--text-secondary-color); }
.form-group input, .form-group select, .form-group textarea { width: 100%; padding: 12px; font-size: 1em; background-color: var(--background-color); border: 1px solid var(--border-color); border-radius: 5px; color: var(--text-color); font-family: var(--font-main); }
.form-group input:focus, .form-group select:focus, .form-group textarea:focus { outline: none; border-color: var(--primary-color); box-shadow: 0 0 8px var(--glow-color); }
.form-group textarea { min-height: 150px; resize: vertical; }
.modal-actions { text-align: right; }
#submit-post-btn { padding: 12px 25px; font-size: 1.1em; }

/* --- 动画效果 --- */
@keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
.thread-item, .reply-item { animation: fadeIn 0.5s ease-out forwards; }
@keyframes plusOne { 0% { transform: translateY(0) scale(1); opacity: 1; color: var(--success-color); } 100% { transform: translateY(-30px) scale(1.5); opacity: 0; } }
.plus-one-anim { position: absolute; top: -10px; left: 50%; transform: translateX(-50%); font-size: 1.2em; font-weight: bold; pointer-events: none; animation: plusOne 1s ease-out forwards; }

 /* 位置：替换掉文件中旧的 @media (max-width: 768px) { ... } 整块代码 */

@media (max-width: 768px) {
    body { padding: 0; }
    #forum-wrapper { border-radius: 0; height: 100vh; border: none; }

    .forum-body {
        display: block; /* 放弃Grid，使用块级布局 */
        position: relative;
        overflow: hidden;
    }

   .forum-sidebar {
        flex-direction: row;
        flex-wrap: nowrap;
        overflow-x: auto;
        border-right: none;
        border-bottom: 1px solid var(--border-color);
        padding: 10px;
        gap: 5px; /* 减少间距以容纳更多按钮 */
        -webkit-overflow-scrolling: touch;
    }

    .section-btn {
        flex: 1; /* 让按钮平分宽度 */
        min-width: 0; /* 允许收缩到最小宽度 */
        white-space: nowrap;
        font-size: 0.9em; /* 稍微减小字体以适应更小的按钮 */
        padding: 10px 8px; /* 调整内边距 */
        text-align: center; /* 确保文字居中 */
    }

    /* 默认隐藏详情页，显示列表页 */
    .thread-detail-view {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        transform: translateX(100%);
        transition: transform 0.4s cubic-bezier(0.25, 1, 0.5, 1);
        background-color: var(--background-color);
        z-index: 10;
        grid-column: auto; /* 重置grid布局 */
    }

    /* 当需要显示详情时，给父容器添加class */
    .forum-body.show-detail .thread-detail-view {
        transform: translateX(0);
    }

    .thread-list-view {
        grid-column: auto; /* 重置grid布局 */
        border-right: none;
        height: 100%; /* 确保它占满父容器高度 */
    }

     #mobile-back-btn {
        display: block !important; /* 强制在移动端显示 */
        margin-bottom: 15px;
    }
}

/* 在桌面端隐藏返回按钮 */
@media (min-width: 769px) {
    #mobile-back-btn {
        display: none !important;
    }
}
/* --- 帖子详情内部布局 --- */

.post-header, .post-content, .post-actions {
    padding-left: 25px;
    padding-right: 25px;
    flex-shrink: 0; /* 帖子标题和内容区域不收缩 */
}

.post-header {
    padding-top: 25px;
}

.replies-section {
    flex-grow: 1; /* 让回复区域填满剩余空间 */
    min-height: 0; /* 关键！ */
    display: flex;
    flex-direction: column;
    border-top: 1px solid var(--border-color);
    margin-top: 30px;
}

.replies-header {
    font-size: 1.4em;
    padding: 20px 25px 0 25px;
    margin-bottom: 10px;
    flex-shrink: 0;
}

.reply-list {
    flex-grow: 1; /* 占据回复区域的所有可用空间 */
    overflow-y: auto; /* 最终的滚动条在这里！ */
    padding-left: 25px;
    padding-right: 15px; /* 右侧留出滚动条空间 */
}

.reply-item {
    padding: 20px 10px 20px 0; /* 调整内边距，因为外层已经有padding-left */
    border-bottom: 1px solid var(--border-color);
}
 

/* 位置：<style> 标签内，所有其他CSS规则之后 */

/* --- 滚动条美化 --- */
::-webkit-scrollbar {
    width: 8px;
    height: 8px;
}
::-webkit-scrollbar-track {
    background: rgba(0,0,0,0.2);
    border-radius: 4px;
}
::-webkit-scrollbar-thumb {
    background-color: var(--border-color);
    border-radius: 4px;
    transition: background-color 0.2s ease-in-out;
}
::-webkit-scrollbar-thumb:hover {
    background-color: var(--primary-color);
}

.replies-omitted-indicator {
    text-align: center;
    color: var(--text-secondary-color);
    padding: 20px 0;
    font-style: italic;
    opacity: 0.7;
    user-select: none;
}

/* --- 新增：回复输入区样式 --- */
.reply-input-section {
    padding: 20px 25px;
    border-top: 1px solid var(--border-color);
    background-color: var(--item-bg-color);
    flex-shrink: 0;
    margin-top: auto; /* 将其推到底部 */
}
#reply-form {
    display: flex;
    gap: 15px;
    align-items: flex-start;
}
#reply-content-input {
    flex-grow: 1;
    min-height: 40px; /* 初始高度 */
    max-height: 120px; /* 最大高度 */
    padding: 10px;
    resize: vertical;
    width: 100%;
    font-size: 1em;
    background-color: var(--item-bg-color);
    border: 1px solid var(--border-color);
    border-radius: 5px;
    color: var(--text-color);
    font-family: var(--font-main);
}
#submit-reply-btn {
    padding: 10px 20px;
    height: 40px;
    flex-shrink: 0;
}
.post-actions button {
    background: none;
    border: 1px solid var(--border-color);
    color: var(--text-secondary-color);
    padding: 6px 12px;
    border-radius: 4px;
    cursor: pointer;
    transition: all 0.2s ease;
}
.post-actions button:hover {
    background-color: var(--item-bg-hover-color);
    color: var(--text-color);
}


      #top-left-orbs {
            position: absolute;
            top: 10px;
            left: 10px;
            display: flex;
            gap: 8px;
            z-index: 1050; /* 比其他界面元素更高 */
        }

        .top-orb {
            width: 32px;
            height: 32px;
            background-color: var(--container-bg-color);
            border: 1px solid var(--border-color);
            color: var(--primary-color);
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
            box-shadow: 0 0 8px transparent;
        }

        .top-orb:hover {
            background-color: rgba(0, 250, 255, 0.2);
            box-shadow: 0 0 12px var(--glow-color);
        }

 

        .orb-flash {
             animation: notify-flash 1s 8;
        }

        /* 论坛模态框的专用样式 */
        #forum-modal-container {
            display: none; /* 默认隐藏 */
            position: fixed;
            top: 60px;
            left: 0;
            width: 110%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            z-index: 1040; /* 仅次于小球 */
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #forum-modal-container.active {
            display: flex;
        }

        #forum-modal-content {
            width: 90%;
            height: 85%;
            max-width: 1400px;
            position: relative;
        }

        #forum-modal-content #forum-wrapper {
            width: 100%;
            height: 100%;
            display: flex; /* 确保内容撑満 */
            flex-direction: column;
        }

        #forum-modal-close-btn {
            position: absolute;
            top: 10px;
            right: 15px;
            background: none;
            border: none;
            font-size: 28px;
            color: var(--text-color);
            cursor: pointer;
            z-index: 10;
        }

        .dialogue-quote {
    color: var(--text-secondary-color); /* 妈妈为你选择了这个柔和又明亮的颜色 */
    font-style: italic; /* 我们还让它稍微倾斜，看起来更加特别，你觉得呢？ */
}

/* 代码 START: 添加在这里 */
@keyframes notify-flash {
    0%, 100% {
        box-shadow: 0 0 4px var(--glow-color);
        transform: scale(1);
    }
    50% {
        box-shadow: 0 0 15px 3px var(--primary-color), 0 0 25px 8px var(--glow-color);
        transform: scale(1.1);
    }
}

.notify {
    /* 动画持续1秒，执行两次，总共2秒 */
    animation: notify-flash 1s 8;
}

 /* ========== 新增：即时投骰结果看板样式 ========== */
.roll-result-card-container {
    position: fixed;
    top: -100%; /* 初始位置在屏幕外 */
    left: 50%;
    transform: translateX(-50%);
    width: 90%;
    max-width: 500px;
    background-color: var(--container-bg-color);
    border: 1px solid var(--border-color);
    border-radius: 0 0 12px 12px;
    box-shadow: 0 8px 30px var(--glow-color);
    z-index: 9999;
    padding: 20px;
    color: var(--text-color);
    font-family: inherit;
    transition: top 0.5s cubic-bezier(0.25, 0.8, 0.25, 1);
    display: none; /* 初始隐藏 */
}

/* 看板滑入动画 */
.roll-result-card-container.show {
    top: 20px;
}

  /* ========== 辉煌成功的光辉效果 (增强版) ========== */

/* 为 .glorious 状态下的卡片容器添加基础样式和动画 */
.roll-result-card-container.glorious {
    /* 必须设置，用于将伪元素限制在容器内部，并裁剪旋转的边框光效 */
    overflow: hidden;

    /* 增强的基础辉光效果，使用多种变量颜色 */
    box-shadow: 0 0 30px 10px var(--primary-color), 
                0 0 50px 18px var(--glow-color),
                0 0 70px 25px var(--secondary-color);

    /* 应用多个动画：
       1. glorious-sweep: 背景流光扫过效果，4秒一次，缓入缓出
       2. glorious-pulse: 增强的辉光脉冲，更明显的呼吸感，2.5秒一次
       3. glorious-float: 整体看板轻微浮动效果，3秒一次
    */
    animation: glorious-sweep 4s infinite ease-in-out,
               glorious-pulse 2.5s infinite ease-in-out,
               glorious-float 3s infinite ease-in-out;
}

/* 创建一个伪元素用于承载旋转的边框光效 */
.roll-result-card-container.glorious::before {
    content: '';
    position: absolute;
    top: -3px; 
    left: -3px;
    width: calc(100% + 6px);
    height: calc(100% + 6px);

 
opacity: 0.6;
 

    /* 将伪元素置于父元素的背景之下，但内容之上 */
    z-index: -1; 
    border-radius: inherit;
}

/* 关键帧动画定义 */

/* 1. 背景斜向流光扫过效果 */
@keyframes glorious-sweep {
    0% {
        /* 定义背景为一个巨大的、倾斜的线性渐变 */
        background-image: linear-gradient(
            115deg, /* 倾斜角度，模拟斜上到斜下 */
            transparent 25%,
            var(--glow-color) 45%,
            var(--primary-color) 50%,
            var(--secondary-color) 52%,
            var(--glow-color) 55%,
            transparent 75%
        );
        background-size: 300% 300%; /* 背景尺寸放大，确保流光柔和 */
        background-position: 150% 150%; /* 初始位置，将流光置于右下角视野外 */
    }
    50% {
        background-position: -50% -50%; /* 动画中点，将流光移动到左上角视野外 */
    }
    100% {
        background-position: 150% 150%; /* 回到初始位置，形成循环 */
    }
}

/* 2. 旋转边框光效 */
@keyframes glorious-border-spin {
    from {
        transform: rotate(0deg);
    }
    to {
        transform: rotate(360deg);
    }
}

/* 3. 增强的辉光脉冲，更明显的呼吸感 */
@keyframes glorious-pulse {
    0%, 100% {
        box-shadow: 0 0 30px 10px var(--primary-color), 
                    0 0 50px 18px var(--glow-color),
                    0 0 70px 25px var(--secondary-color);
    }
    50% {
        box-shadow: 0 0 45px 15px var(--primary-color), 
                    0 0 70px 25px var(--glow-color),
                    0 0 90px 35px var(--secondary-color),
                    0 0 110px 40px var(--border-color);
    }
}

/* 4. 新增：整体看板轻微浮动效果 */
@keyframes glorious-float {
    0%, 100% {
        transform: translateX(-50%) translateY(0px) scale(1);
    }
    33% {
        transform: translateX(-50%) translateY(-3px) scale(1.01);
    }
    66% {
        transform: translateX(-50%) translateY(3px) scale(0.99);
    }
}
.roll-result-card-container.shattered {
    animation: shatter-effect 1.5s infinite ease-in-out; 
    border-color: var(--danger-color);
}

/* 修改后：大失败的摇晃效果（不再自动消失） */
@keyframes shatter-effect {
    0%, 100% { transform: translateX(-50%) rotate(0deg); }
    20% { transform: translateX(-52%) rotate(-2deg); }
    40% { transform: translateX(-48%) rotate(2deg); }
    60% { transform: translateX(-51%) rotate(-1deg); }
    80% { transform: translateX(-49%) rotate(1deg); }
}

.roll-card-content {
    display: flex;
    flex-direction: column;
    gap: 15px;
    background: linear-gradient(145deg, var(--container-bg-color), var(--border-color));
    border: 2px solid var(--glow-color);
    border-radius: 8px;
    padding: 15px;
    box-shadow: inset 0 0 10px var(--glow-color), 0 4px 20px var(--border-color);
}

.roll-card-header {
    font-size: 1.2em;
    font-weight: bold;
    color: var(--primary-color);
    text-align: center;
    border-bottom: 1px solid var(--border-color);
    padding-bottom: 10px;
}

.roll-card-dice-area {
    display: flex;
    flex-direction: column;
    gap: 15px;
    align-items: center;
    font-size: 1.5em;
    padding: 10px 0;
}
.roll-card-divider {
    width: 80%;
    height: 2px;
    background: linear-gradient(90deg, 
        transparent 0%, 
        var(--border-color) 20%, 
        var(--glow-color) 50%, 
        var(--border-color) 80%, 
        transparent 100%);
    margin: 15px auto;
    border-radius: 1px;
    box-shadow: 0 0 8px var(--glow-color);
}
.roll-card-dice-section {
    text-align: center;
}

.roll-card-dice-section .label {
    font-size: 0.65em;
    color: var(--text-secondary-color);
    display: block;
    opacity: 0.7;
    margin-bottom: 8px;
}

.roll-card-dice-section .dice-value {
    font-weight: bold;
    font-size: 1.8em;
}

/* 骰子数值颜色 */
.dice-low { 
    color: var(--text-secondary-color); 
    font-weight: 800;
}
.dice-high { 
    color: var(--secondary-color); 
    font-weight: 800;
}
.dice-crit {
    color: var(--primary-color);
    text-shadow: 0 0 8px var(--glow-color), 0 0 12px var(--primary-color);
    font-weight: 800;
}

.roll-card-vs {
    font-size: 1em;
    color: var(--text-secondary-color);
}

.roll-card-result-area {
    text-align: center;
}

.roll-card-outcome {
    font-size: 1.4em;
    font-weight: bold;
    margin-bottom: 5px;
    display: inline-block;
    padding: 8px 20px;
    border: 3px solid;
    border-radius: 50px;
    background: var(--container-bg-color);
    box-shadow: 0 0 10px var(--glow-color), inset 0 0 5px var(--border-color);
    text-transform: uppercase;
    letter-spacing: 1px;
}

/* 不同结果的印章颜色 */
.roll-card-outcome.critical-failure {
    color: var(--danger-color);
    border-color: var(--danger-glow-color);
    text-shadow: 0 0 5px var(--danger-glow-color);
}
.roll-card-outcome.failure {
    color: var(--text-secondary-color);
    border-color: var(--text-secondary-color);
    text-shadow: 0 0 5px var(--text-secondary-color);
}
.roll-card-outcome.partial-success {
    color: var(--border-color);
    border-color: var(--border-color);
    text-shadow: 0 0 5px var(--border-color);
}
.roll-card-outcome.success {
    color: var(--secondary-color);
    border-color: var(--secondary-color);
    text-shadow: 0 0 5px var(--secondary-color);
}
.roll-card-outcome.glorious-success {
    color: var(--primary-color);
    border-color: var(--primary-color);
    text-shadow: 0 0 5px var(--glow-color);
}
.roll-card-description {
    font-size: 0.95em;
    color: var(--text-secondary-color);
    font-style: italic;
}

.roll-card-damage {
    margin-top: 10px;
    font-size: 1.1em;
    font-weight: bold;
    color: var(--danger-color);
}

/* 骰子盖章动画效果 */
.dice-number {
    display: inline-block;
    opacity: 0;
    transform: scale(0);
    animation: dice-stamp 0.6s ease-out forwards;
}

@keyframes dice-stamp {
    0% {
        opacity: 0;
        transform: scale(0) rotate(-15deg);
    }
    50% {
        opacity: 0.8;
        transform: scale(1.3) rotate(-5deg);
    }
    70% {
        opacity: 1;
        transform: scale(0.9) rotate(2deg);
    }
    100% {
        opacity: 1;
        transform: scale(1) rotate(0deg);
    }
}
/* ————————————————————初始化—————————————— */

   .radar-charts-container {
            display: grid;
            grid-template-columns: 1fr; /* 改为单列布局 */
            gap: 2.5rem; /* 增大间距 */
            margin: 2rem 0;
        }

        /* 妈妈为你新增的环绕布局样式 */
        .radar-layout {
            display: grid;
            grid-template-columns: 300px 1fr; /* 左边雷达图，右边加点项 */
            gap: 2rem;
            align-items: center;
            padding: 1.5rem;
            background-color: rgba(26, 23, 32, 0.3);
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }

        .radar-layout .radar-chart-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center; /* 垂直居中 */
            height: 100%;
        }

        .radar-layout .allocators-container {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            max-height: 320px; /* 控制最大高度，超出可滚动 */
            overflow-y: auto;
            padding-right: 1rem; /* 为滚动条留出空间 */
        }
.radar-chart-item {
    display: flex;
    flex-direction: column;
    align-items: center;
}

.radar-chart-title {
    color: var(--secondary-color);
    font-size: 1em;
    margin-bottom: 1rem;
    letter-spacing: 1px;
    text-align: center;
}

.radar-chart-canvas {
    width: 100% !important;
    height: 250px !important;
    max-width: 300px;
}
 @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        h1, h2, h3 {
            font-weight: 500;
            letter-spacing: 2px;
        }

        .header { text-align: center; margin-bottom: 2.5rem; }
        h1 { font-size: 2.2em; font-weight: 300; letter-spacing: 8px; text-transform: uppercase; margin: 0; color: var(--text-color); text-shadow: 0 0 6px var(--primary-color), 0 0 12px var(--secondary-color); }
        .subtitle { font-size: 0.9em; color: var(--text-secondary-color); letter-spacing: 3px; margin-top: 0.7rem; text-transform: uppercase; }
        .form-section { margin-bottom: 2rem; }
        .form-section h2 { font-size: 1.1em; color: var(--secondary-color); border-bottom: 1px solid var(--border-color); padding-bottom: 0.5rem; margin-bottom: 1.5rem; }
        h3 { font-size: 1em; color: var(--info-color, #4db6ac); margin-top: 2rem; margin-bottom: 1rem; letter-spacing: 1px; }

        .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem; }
        .form-group { display: flex; flex-direction: column; }
        label { margin-bottom: 0.5rem; font-size: 0.85em; color: var(--text-secondary-color); letter-spacing: 1px; }

          .custom-select, input[type="text"], input[type="number"] {
            font-family: inherit;
            background-color: var(--background-color);
            color: var(--text-color);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            padding: 0.7rem 1rem;
            font-size: 0.95em;
            transition: all 0.3s ease;
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            /* 妈妈在这里为你加上了三行魔法代码 */
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
width:auto;
 
        }
       .custom-select {
            background-image: linear-gradient(45deg, transparent 50%, var(--text-color) 50%), linear-gradient(135deg, var(--text-color) 50%, transparent 50%);
            background-position: calc(100% - 20px) calc(1em + 2px), calc(100% - 15px) calc(1em + 2px);
            background-size: 5px 5px, 5px 5px;
            background-repeat: no-repeat;
            padding-right: 2.5rem;
            width: auto; /* 妈妈在这里加上了最关键的一行 */
            border-color: var(--border-color); background-color: var(--background-color);
        }
        .custom-select:hover, input:hover { border-color: var(--border-color); background-color: var(--background-color); }
        .custom-select:focus, input:focus { outline: none; border-color: var(--primary-color); box-shadow: 0 0 8px rgba(200, 106, 163, 0.4); }
        input::placeholder { color: var(--text-secondary-color); opacity: 0.7; background-color: var(--background-color); }

         .teammate-item { display: grid; grid-template-columns: 1fr; gap: 0.5rem; margin-bottom: 0.8rem; padding: 0.8rem; background-color: var(--background-color); border-radius: 4px; border: 1px solid var(--border-color); }
        .teammate-item input { font-size: 0.85em; padding: 0.5rem; }
        .add-teammate-btn, .remove-teammate-btn { cursor: pointer; transition: all 0.3s ease; }
        .add-teammate-btn { background-color: var(--info-color, #4db6ac); color: white; border: none; padding: 0.5rem 1rem; border-radius: 4px; font-size: 0.85em; margin-top: 0.5rem; }
        .add-teammate-btn:hover { background-color: #6ba85c; }
        .remove-teammate-btn { background: linear-gradient(135deg, var(--primary-color), #b85d93); color: white; border: none; padding: 0.4rem 0.8rem; border-radius: 6px; font-size: 0.75em; font-weight: 500; justify-self: end; }
        .remove-teammate-btn:hover { background: linear-gradient(135deg, #b85d93, var(--primary-color)); transform: translateY(-1px); }

        .button-container { text-align: center; margin-top: 3rem; padding-top: 1.5rem; border-top: 1px solid var(--border-color); }
 
        /* 新增分配页样式 */
        .points-tracker { text-align: center; font-size: 1.2em; margin-bottom: 2rem; color: var(--primary-color); letter-spacing: 2px; }
        .points-tracker span { font-weight: 700; font-size: 1.4em; padding: 0 0.5ch; }

        .分配项 {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.8rem 1rem;
            margin-bottom: 0.5rem;
            background-color: var(--background-color);
            border: 1px solid var(--border-color);
            border-radius: 4px;
        }
        .分配-标签 { flex: 1; display: flex; flex-direction: column; }
        .分配-标签-主 { font-size: 1em; color: var(--text-color); }
        .分配-标签-说明 { font-size: 0.75em; color: var(--text-secondary-color); }
        .分配-控制器 { display: flex; align-items: center; gap: 0.8rem; }
        .分配-按钮 { background-color: var(--glow-color); border: 1px solid var(--border-color); color: var(--text-color); width: 28px; height: 28px; border-radius: 50%; cursor: pointer; font-size: 1.2em; line-height: 1; transition: all 0.2s; }
        .分配-按钮:hover { background-color: var(--secondary-color); border-color: var(--secondary-color); color: #fff; }
        .分配-按钮:disabled { background-color: transparent; border-color: var(rgba(168, 192, 225, 0.3)); color: var(rgba(168, 192, 225, 0.3)); cursor: not-allowed; }
        .分配-点数 { font-size: 1.1em; width: 2ch; text-align: center; color: var(--info-color, #4db6ac); }


        @media (max-width: 600px) {
            .page { width: 100%; min-height: 100vh; border-radius: 0; border: none; padding: 1.5rem 1rem; box-shadow: none;   }
            h1 { font-size: 1.8em; letter-spacing: 4px; }
            .form-grid { grid-template-columns: 1fr; }
            
        }

          .collapsible-header {
            cursor: pointer;
            position: relative;
            user-select: none; /* 防止双击选中文本 */
            padding-right: 25px; /* 为箭头留出空间 */
            transition: color 0.3s ease;
        }
        .collapsible-header::after {
            content: '▼';
            position: absolute;
            right: 0;
            top: 50%;
            transform: translateY(-50%);
            font-size: 0.8em;
            color: var(--text-secondary-color);
            transition: transform 0.3s ease;
        }
        .collapsible-header.collapsed::after {
            transform: translateY(-50%) rotate(-90deg);
        }
        .collapsible-content {
            max-height: 1000px; /* 一个足够大的值，确保能完全显示 */
            overflow: hidden;
            transition: max-height 0.4s ease-in-out;
        }
        .collapsible-content.collapsed {
            max-height: 0;
        }

           /* --- 妈妈为你做的滚动条美化 --- */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.1);
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb {
            background-color: var(--primary-color);
            border-radius: 10px;
            border: 2px solid transparent;
            background-clip: content-box;
        }
        ::-webkit-scrollbar-thumb:hover {
            background-color: var(--secondary-color);
        }

        /* --- 妈妈为你做的手机端适配 --- */
       /* --- 妈妈为你做的手机端适配 --- */
        @media (max-width: 768px) {
            .terminal {
                padding: 1rem; /* 手机端边距小一点 */
            }

            #shop-search-input{
                display: none;
            }

            .radar-layout {
                grid-template-columns: 1fr; /* 💖 重点在这里，变成单列布局，自动上下排列 💖 */
                gap: 1.5rem;
            }

            /* --- 💖 妈妈为你施展了新的魔法 💖 --- */
            .radar-layout .allocators-container {
                max-height: 280px;      /* 妈妈把它的高度限制得和雷达图差不多高了 */
                overflow-y: auto;       /* 这样当内容太多的时候，就可以温柔地滚动啦 */
                padding-right: 0.5rem;  /* 再给滚动条留出一点点空间，免得挤到内容 */
            }
        }
    /* --- 妈妈为你的新选择页面施展的美化魔法 --- */
        .mode-selection-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }

        .mode-option {
            position: relative;
        }

        .mode-option input[type="radio"] {
            position: absolute;
            opacity: 0;
            width: 0;
            height: 0;
        }

        .mode-option label {
            display: block;
            padding: 1.5rem 1rem;
            background-color: var(--background-color);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1em;
            letter-spacing: 1px;
            color: var(--text-color);
            margin: 0; /* 重置label的默认margin */
        }

        .mode-option label:hover {
            border-color: var(--border-color);
            background-color: var(--glow-color);
        }

        .mode-option input[type="radio"]:checked + label {
            border-color: var(--primary-color);
            background-color: rgba(200, 106, 163, 0.1);
            color: #fff;
            box-shadow: 0 0 10px rgba(200, 106, 163, 0.3);
            font-weight: 500;
        }


        @media (max-width: 768px) {
            .mode-selection-container {
                 grid-template-columns: 1fr;
            }
            .mode-option label {
                padding: 1rem;
            }
        }

        /* 任务总结 */
            /* 古籍羊皮纸主题的特殊字体和阴影 */
        body[data-theme-name="古籍羊皮纸"] {
            font-family: 'Times New Roman', serif;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
        }

        body[data-theme-name="古籍羊皮纸"] .task-summary-main-container h1,
        body[data-theme-name="古籍羊皮纸"] .task-summary-main-container h2 {
           font-family: Georgia, serif;
           font-weight: bold;
        }
 .task-summary-main-container {
            width: 90vw;
            max-width: 1200px;
           height: 85vh; /* 修改为85vh */
    max-height: none; /* 移除max-height限制，让85vh生效 */
            background-color: var(--container-bg-color);
            border: 1px solid var(--border-color);
            border-radius: 15px;
            box-shadow: 0 0 15px 5px var(--glow-color);
            display: flex;
            flex-direction: column;
            overflow: hidden; /* 确保子元素不会溢出圆角 */
            transition: all 0.5s ease-in-out;
        }
 .content-wrapper {
            display: flex;
            flex-grow: 1;
            overflow: auto; /* 修改为auto，允许滚动 */
        }

        .tabs-nav {
            display: flex;
            flex-direction: column;
            padding: 20px 0;
            border-right: 1px solid var(--border-color);
            background-color: var(--tab-bg-color);
            flex-shrink: 0;
        }

        .tab-button {
            background: none;
            border: none;
            padding: 15px 25px;
            cursor: pointer;
            color: var(--tab-inactive-color);
            font-size: 1.1em;
            text-align: left;
            transition: all 0.3s ease;
            position: relative;
            white-space: nowrap;
        }

        .tab-button:not(:last-child) {
            margin-bottom: 10px;
        }

        .tab-button.active {
            color: var(--primary-color);
            background-color: var(--tab-active-bg-color);
        }

        .tab-button.active::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            width: 4px;
            height: 100%;
            background-color: var(--primary-color);
            box-shadow: 0 0 8px var(--glow-color);
            border-radius: 0 4px 4px 0;
        }

        .tab-content-container {
            flex-grow: 1;
            position: relative;
            overflow: hidden;
        }

        .tab-pane {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            padding: 30px;
            box-sizing: border-box;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.5s ease-in-out, transform 0.5s ease-in-out;
            transform: translateX(20px);
            overflow-y: auto; /* 允许单个面板内容滚动 */
        }

        .tab-pane.active {
            opacity: 1;
            visibility: visible;
            transform: translateX(0);
        }

        /* 自定义滚动条样式 */
        .tab-pane::-webkit-scrollbar {
            width: 8px;
        }

        .tab-pane::-webkit-scrollbar-track {
            background: var(--scrollbar-track-color);
            border-radius: 10px;
        }

        .tab-pane::-webkit-scrollbar-thumb {
            background-color: var(--scrollbar-thumb-color);
            border-radius: 10px;
            border: 2px solid var(--scrollbar-track-color);
        }

        h2 {
            color: var(--secondary-color);
            border-bottom: 2px solid var(--border-color);
            padding-bottom: 10px;
            margin-top: 0;
            margin-bottom: 20px;
        }

        p, ul {
            line-height: 1.8;
            font-size: 1.1em;
        }

        .info-grid {
            display: grid;
            grid-template-columns: 150px 1fr;
            gap: 15px;
            align-items: center;
            margin-bottom: 20px;
        }

        .info-grid strong {
            color: var(--secondary-color);
            font-weight: normal;
        }

        ul {
            list-style: none;
            padding-left: 20px;
        }

        ul li {
            position: relative;
            margin-bottom: 10px;
        }

        ul li::before {
            content: '»';
            position: absolute;
            left: -20px;
            color: var(--primary-color);
        }

        .rating {
            font-size: 1.5em;
            font-weight: bold;
            color: var(--primary-color);
        }
        /* 妈妈为你添加的响应式设计魔法 */
        @media (max-width: 768px) {
   
            .task-summary-main-container {
                width: 100vw;
                height: auto;
                 
                height: 85vh; /* 修改为85vh */
    max-height: none; /* 移除max-height限制，让85vh生效 */
                border-radius: 0;
                border: none;
                box-shadow: none;
            }

            header {
                padding: 15px;
            }

            header h1 {
                font-size: 1.5em;
            }

            .content-wrapper {
                flex-direction: column;
                 /* 确保内容区能正常滚动 */
                 overflow: auto; /* 修改为auto，允许滚动 */
            }

            .tabs-nav {
                flex-direction: row;
                border-right: none;
                border-bottom: 1px solid var(--border-color);
                padding: 5px 10px;
                overflow-x: auto;
                /* 隐藏滚动条但保留功能 */
                -ms-overflow-style: none; /* IE和Edge */
                scrollbar-width: none; /* Firefox */
            }
            .tabs-nav::-webkit-scrollbar {
                display: none; /* Chrome, Safari, and Opera */
            }

            .tab-button {
                padding: 10px 15px;
                flex-shrink: 0; /* 防止按钮被压缩 */
            }

            .tab-button.active::before {
                width: 100%;
                height: 3px;
                top: auto;
                bottom: 0;
                left: 0;
                border-radius: 3px 3px 0 0;
            }

            .tab-content-container {
                overflow: visible; /* 让内容自然扩展 */
            }

            .tab-pane {
                 /* 移除绝对定位，让其在文档流中正常排列 */
                position: relative;
                transform: none;
                opacity: 1;
                visibility: visible;
                display: none; /* 默认隐藏 */
                padding: 20px;
            }

            .tab-pane.active {
                display: block; /* 只显示激活的面板 */
            }

            .info-grid {
                /* 关键改动：从两列变成一列 */
                grid-template-columns: 1fr;
                gap: 5px; /* 减小行间距 */
            }

            .info-grid strong {
                 /* 让标签不那么突出，与内容融为一体 */
                margin-bottom: 2px;
                display: block;
                color: var(--secondary-color);
            }

            p, ul {
                font-size: 1em;
            }

        }

 /*  */

 /* 抽奖按钮样式 */
.gacha-btn {
    background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
    color: var(--background-color);
    font-weight: bold;
}

.gacha-btn:hover {
    box-shadow: 0 0 15px var(--glow-color);
    transform: translateY(-2px);
}

/* 抽奖模态框样式 */
.gacha-modal-content {
    max-width: 800px;
    min-height: 400px;
}

.gacha-animation-container {
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 200px;
    flex-wrap: wrap;
    gap: 10px;
    margin: 20px 0;
}

.gacha-card {
    width: 120px;
    height: 160px;
    position: relative;
    perspective: 1000px;
    margin: 5px;
}

.gacha-card-inner {
    position: relative;
    width: 100%;
    height: 100%;
    text-align: center;
    transition: transform 0.8s;
    transform-style: preserve-3d;
}

.gacha-card.flipped .gacha-card-inner {
    transform: rotateY(180deg);
}

.gacha-card-front, .gacha-card-back {
    position: absolute;
    width: 100%;
    height: 100%;
    backface-visibility: hidden;
    border-radius: 10px;
    border: 2px solid var(--border-color);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 14px;
    font-weight: bold;
    color: var(--text-color);
}

.gacha-card-front {
    background: linear-gradient(135deg, var(--container-bg-color), rgba(0, 250, 255, 0.1));
    /* 让问号更清晰一些 */
    font-size: 48px;
    color: var(--border-color);
}

.gacha-card-back {
    color: var(--background-color);
    transform: rotateY(180deg);
    padding: 10px;
    text-align: center;
    display: flex;
    flex-direction: column;
    justify-content: center;
}

.gacha-results {
    margin-top: 20px;
    text-align: center;
}

.gacha-result-item {
    display: inline-block;
    margin: 5px;
    padding: 10px 15px;
    background: var(--container-bg-color);
    border: 1px solid var(--border-color);
    border-radius: 5px;
    color: var(--text-color);
}

/* 不同积分层级的卡片颜色 */
 /* Tier 1: 保持朴素的灰色 */
.gacha-card-back.tier-1 {
    background: linear-gradient(135deg, #808080, #a0a0a0);
    box-shadow: 0 0 8px rgba(128, 128, 128, 0.4);
}

/* Tier 2: 经典青色光辉 */
.gacha-card-back.tier-2 {
    background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
    box-shadow: 0 0 15px var(--glow-color);
}

/* Tier 3: 呼吸光晕，光效更明显 */
.gacha-card-back.tier-3 {
    background: linear-gradient(135deg, var(--secondary-color), #b0b0b0, var(--primary-color));
    box-shadow: 0 0 20px var(--glow-color);
    animation: pulse-glow 3s infinite ease-in-out;
}

@keyframes pulse-glow {
    0%, 100% {
        box-shadow: 0 0 20px var(--glow-color);
    }
    50% {
        box-shadow: 0 0 30px var(--glow-color), 0 0 15px var(--secondary-color);
    }
}

/* Tier 4: 史诗脉冲，边框会一起发光 */
.gacha-card-back.tier-4 {
    background: radial-gradient(ellipse at center, var(--secondary-color), var(--primary-color));
    box-shadow: 0 0 30px var(--glow-color);
    animation: epic-pulse 2s infinite alternate ease-in-out;
    border-color: var(--secondary-color);
}

@keyframes epic-pulse {
    from {
        transform: rotateY(180deg) scale(1);
        box-shadow: 0 0 30px var(--glow-color);
        border-color: var(--secondary-color);
    }
    to {
        transform: rotateY(180deg) scale(1.02);
        box-shadow: 0 0 45px var(--primary-color), 0 0 15px var(--secondary-color) inset;
        border-color: var(--primary-color);
    }
}

/* Tier 5: 传奇流彩，真正的炫目效果！ */
.gacha-card-back.tier-5 {
    background: linear-gradient(
        -45deg,
        var(--danger-color),
        var(--primary-color),
        var(--secondary-color),
        var(--danger-color)
    );
    background-size: 400% 400%;
    box-shadow: 0 0 35px var(--danger-glow-color), 0 0 20px var(--glow-color);
    animation: legendary-shift 3s ease-in-out infinite, legendary-hue-rotate 4s linear infinite;
}

@keyframes legendary-shift {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
}

@keyframes legendary-hue-rotate {
    0% { filter: hue-rotate(0deg); }
    100% { filter: hue-rotate(360deg); }
}

/* 卡片悬浮动画 */
.gacha-card.selected {
    transform: translateY(-10px);
    transition: transform 0.3s ease;
}

.gacha-card.selected .gacha-card-back {
    animation-name: legendary-shift, float;
    animation-duration: 3s, 2s;
    animation-timing-function: ease-in-out, ease-in-out;
    animation-iteration-count: infinite, infinite;
}

/* float动画本身是正确的，因为它包含了rotateY(180deg) */
@keyframes float {
    0%, 100% {
        transform: rotateY(180deg) translateY(0px);
    }
    50% {
        transform: rotateY(180deg) translateY(-5px);
    }
}

/* 确保所有动画在选中时都能正确叠加 */
.gacha-card.selected .gacha-card-back.tier-3 {
    animation: pulse-glow 3s infinite ease-in-out, float 2s infinite ease-in-out;
}
.gacha-card.selected .gacha-card-back.tier-4 {
    animation: epic-pulse 2s infinite alternate ease-in-out, float 2s infinite ease-in-out;
}
.gacha-card.selected .gacha-card-back.tier-5 {
     animation: legendary-shift 3s infinite ease-in-out, float 2s infinite ease-in-out;
}
/* 详细信息显示 */
.gacha-card-details {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.9);
    color: var(--text-color);
    padding: 10px;
    border-radius: 10px;
    font-size: 10px;
    z-index: 10;
    transform: rotateY(180deg) scale(0.95);
    opacity: 0;
    pointer-events: none; /* 看不见时就不能点 */
    transition: transform 0.3s ease-in-out, opacity 0.3s ease-in-out;
}

.gacha-card-details.show {
    transform: rotateY(180deg) scale(1);
    opacity: 1;
    pointer-events: auto; /* 看得见时才能点 */
}

.gacha-card-details-content {
    height: 100%;
    overflow-y: auto;
    padding-right: 5px;
}

.gacha-card-details-content::-webkit-scrollbar {
    width: 4px;
}
.gacha-card-details-content::-webkit-scrollbar-thumb {
    background: #888;
    border-radius: 2px;
}
.gacha-card-details-content::-webkit-scrollbar-thumb:hover {
    background: #555;
}

.gacha-abandon-btn {
    position: absolute;
    bottom: 5px;
    right: 5px;
    background: var(--danger-color);
    color: white;
    border: none;
    border-radius: 3px;
    padding: 2px 6px;
    font-size: 10px;
    cursor: pointer;
    z-index: 11;
     transform: rotateY(180deg);
}

.gacha-abandon-btn:hover {
    background: #ff6666;
}


 /* 手机端纵览结果区域样式 */
.gacha-results-summary {
    display: none; /* 默认隐藏 */
    margin: 20px;
    padding: 15px;
    background: var(--container-bg-color);
    border: 1px solid var(--border-color);
    border-radius: 8px;
    max-height: 150px;
    overflow-y: auto;
    text-align: left;
}
.gacha-results-summary h4 {
    margin-top: 0;
    margin-bottom: 10px;
    color: var(--primary-color);
    text-align: center;
}
.gacha-results-summary div {
    padding: 2px 5px;
}
 
@media (max-width: 800px) {
    .gacha-modal-content {
        width: 100%;
        max-width: 100%;
        height: 100%;
        max-height: 100%;
        margin: 0;
        border-radius: 0;
        overflow: hidden;
    }

    .gacha-animation-container {
        position: relative;
        width: 100%;
        min-height: 250px;
        perspective: 1000px;
        margin-top: 50px;
        cursor: grab; /* 给予可以拖动的视觉提示 */
    }
    .gacha-animation-container:active {
        cursor: grabbing;
    }

    .gacha-carousel {
        position: absolute;
        width: 100%;
        height: 100%;
        transform-style: preserve-3d;
        transition: transform 0.6s cubic-bezier(0.25, 1, 0.5, 1); /* 平滑的吸附动画 */
    }

    .gacha-card {
        position: absolute;
        top: 10%;
        left: calc(50% - 70px);
        width: 140px;
        height: 186px;
        backface-visibility: hidden;
        margin: 0;
        transition: transform 0.5s ease, opacity 0.5s ease; /* 为选中效果增加过渡 */
    }

    /* 当有卡片被选中时，让其他卡片退后并变暗 */
    .gacha-carousel.has-selection .gacha-card:not(.selected) {
        opacity: 0.3;
        transform: var(--original-transform) scale(0.9); /* var()会在JS中设置 */
    }

    /* 被选中的卡片会放大，并展示详情 */
    .gacha-carousel.has-selection .gacha-card.selected {
        cursor: default;
    }
    .gacha-carousel.has-selection .gacha-card.selected .gacha-card-details {
        transform: rotateY(180deg) scale(1);
        opacity: 1;
        pointer-events: auto;
    }
     .gacha-carousel.has-selection .gacha-card.selected .gacha-abandon-btn {
        display: block;
    }
}


/* 设置模态框样式 */
.settings-container {
    padding: 10px 20px 20px 20px;
    display: flex;
    flex-direction: column;
    gap: 20px;
}

.setting-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding-bottom: 15px;
    border-bottom: 1px solid var(--border-color);
}

.setting-item:last-child {
    border-bottom: none;
}

.setting-item label {
    font-size: 1em;
    color: var(--text-color);
}

 

/* 开关按钮样式 */
.switch-container .switch-btn {
    padding: 8px 16px;
    border: 1px solid var(--border-color);
    border-radius: 4px;
    cursor: pointer;
    transition: all 0.2s;
}

.switch-container .switch-btn[data-state="on"] {
    background-color: var(--background-color);
    color: var(--text-color);
    border-color: var(--background-color);
}

.switch-container .switch-btn[data-state="off"] {
    background-color: var(--background-color);
    color: var(--text-secondary-color);
}

/* 日志输出区域 */
.log-output {
    background-color: var(--background-color);
    border: 1px solid var(--border-color);
    border-radius: 4px;
    padding: 10px;
    font-size: 0.85em;
    max-height: 100px;
    overflow-y: auto;
    white-space: pre-wrap;
    word-break: break-all;
    font-family: monospace;
    color: var(--text-secondary-color);
    margin-top: -10px; /* 抵消与上一项的间距 */
}

.log-output .success { color: #4CAF50; }
.log-output .error { color: #f44336; }
.log-output .warning { color: #ff9800; }

/* 把这段代码加到你的CSS文件里，我的宝贝 */
/* 列表项的排列方式保持不变，这很好 */
.info-list li {
    display: flex;
    justify-content: space-between;
    align-items: flex-start; /* 改为 flex-start，让标签和顶部对齐，更整洁 */
    gap: 10px;
}

/* 这是我们为行囊和其他物品准备的、可以上下滑动的容器 */
.scrollable-value-container {
    flex-grow: 1; /* 让它可以占据所有剩余空间 */
    max-height: 120px; /* 妈妈给它一个最大的高度，比如120像素，你可以改成你喜欢的任何高度 */
    overflow-y: auto; /* 当内容超出这个高度时，显示垂直滚动条 */
    text-align: right; /* 文字依旧靠右对齐 */
    padding-right: 5px; /* 右边留一点点空隙，免得滚动条贴得太紧 */
    scrollbar-width: thin; /* 滚动条细一点 (Firefox) */
    scrollbar-color: var(--border-color) transparent; /* 自定义滚动条颜色 (Firefox) */
}

/* 同样，美化一下滚动条 (适用于Chrome, Safari, Edge) */
.scrollable-value-container::-webkit-scrollbar {
    width: 6px; /* 滚动条的宽度 */
}

.scrollable-value-container::-webkit-scrollbar-track {
    background: transparent; /* 轨道的背景是透明的 */
}

.scrollable-value-container::-webkit-scrollbar-thumb {
    background-color: var(--background-color); /* 滑块的颜色 */
    border-radius: 6px; /* 给滑块一点圆角 */
}

/* 我们需要确保值本身是正常换行的 */
.scrollable-value-container .value {
    white-space: normal; /* 允许文字自动换行 */
    word-break: break-all; /* 如果有很长的单词，也让它断开 */
    display: block; /* 确保它能占据整个容器宽度 */
}

 /* ========== 完全替换原有的成就系统样式部分 ========== */
@import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@700&family=Press+Start+2P&family=Roboto+Mono&display=swap');

#achievements-btn {
    background: none;
    border: none;
    color: var(--text-secondary-color);
    font-size: 1.6em;
    cursor: pointer;
    padding: 0 10px;
    transition: all 0.3s ease;
    text-shadow: 0 0 5px transparent;
}

#achievements-btn:hover {
    color: var(--primary-color);
    text-shadow: 0 0 8px var(--glow-color);
    transform: scale(1.1);
}

#achievements-content {
    gap: 15px;
    max-height: 80vh;
    overflow-y: auto;
    padding: 0;
}

.achievement-card-new {
    background-color: rgba(255, 255, 255, 0.05);
    border-left: 5px solid var(--primary-color);
    padding: 15px;
    margin: 15px 0;
    border-radius: 8px;
    display: flex;
    align-items: center;
    transition: transform 0.3s ease, box-shadow 0.3s ease, background-color 0.3s ease;
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    opacity: 0.6;
}

.achievement-card-new:hover {
    box-shadow: 0 5px 15px var(--glow-color);
    transform: scale(1.02) rotate(0.5deg);
}

.achievement-card-new:nth-child(even):hover {
    transform: scale(1.02) rotate(-0.5deg);
}

.achievement-card-new.unlocked {
    opacity: 1;
    background-color: rgba(255, 255, 255, 0.08);
    border-left-color: var(--secondary-color);
}

.achievement-card-new.unlocked:hover {
    background-color: rgba(255, 255, 255, 0.12);
}

.achievement-icon-new {
    font-size: 2.5em;
    margin-right: 15px;
    animation: float 2s ease-in-out infinite;
    filter: drop-shadow(0 0 8px var(--glow-color));
}

@keyframes float {
    0%, 100% { 
        transform: translateY(0); 
    }
    50% { 
        transform: translateY(-5px); 
    }
}

.achievement-text-content {
    color: var(--text-secondary-color);
    font-family: 'Roboto Mono', monospace;
    flex-grow: 1;
}

.achievement-card-new h3 {
    margin: 0 0 8px 0;
    color: var(--text-color);
    font-weight: bold;
    font-size: 1.1em;
    text-shadow: 0 0 3px var(--primary-color);
}

.achievement-card-new.unlocked h3 {
    color: var(--secondary-color);
    text-shadow: 0 0 5px var(--secondary-color);
}

.achievement-card-new p {
    margin: 5px 0;
    font-size: 0.9em;
    line-height: 1.4;
}

.achievement-reward {
    color: var(--secondary-color);
    font-weight: bold;
    text-shadow: 0 0 3px var(--secondary-color);
}

.flavor-text {
    font-style: italic;
    color: var(--text-secondary-color);
    border-top: 1px dotted var(--border-color);
    padding-top: 8px;
    margin-top: 8px;
    opacity: 0.8;
}

.new-tag {
    background: linear-gradient(45deg, var(--secondary-color), var(--primary-color));
    color: var(--main-bg-color);
    padding: 2px 6px;
    font-size: 0.7em;
    border-radius: 3px;
    margin-left: 8px;
    font-weight: bold;
    animation: pulse-glow 1.5s infinite;
    box-shadow: 0 0 5px var(--glow-color);
}

@keyframes pulse-glow {
    0%, 100% { 
        opacity: 1;
        transform: scale(1);
        box-shadow: 0 0 5px var(--glow-color);
    }
    50% { 
        opacity: 0.7;
        transform: scale(0.95);
        box-shadow: 0 0 10px var(--glow-color);
    }
}

.pagination-controls {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 15px;
    margin-top: 25px;
    padding-top: 20px;
    border-top: 1px dashed var(--border-color);
}

.page-btn {
    background: linear-gradient(135deg, var(--container-bg-color), var(--main-bg-color));
    border: 2px solid var(--primary-color);
    color: var(--text-color);
    padding: 8px 16px;
    border-radius: 6px;
    cursor: pointer;
    transition: all 0.3s ease;
    font-family: 'Roboto Mono', monospace;
    font-weight: bold;
    text-shadow: 0 0 3px var(--glow-color);
}

.page-btn:hover:not(:disabled) {
    background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
    color: var(--main-bg-color);
    box-shadow: 0 0 15px var(--glow-color);
    transform: scale(1.05);
}

.page-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    background: var(--main-bg-color);
    border-color: var(--text-secondary-color);
}

.page-info {
    color: var(--text-color);
    font-family: 'Orbitron', monospace;
    font-weight: bold;
    font-size: 1.1em;
    text-shadow: 0 0 5px var(--glow-color);
    min-width: 60px;
    text-align: center;
}

/* ========== 修改位置：替换 .achievement-toast 样式 ========== */
.achievement-toast {
    position: fixed;
    /* top 值现在由 JavaScript 动态设置 */
    right: -350px;
    width: 320px;
    background: linear-gradient(135deg, var(--container-bg-color), var(--background-color));
    border: 2px solid var(--primary-color);
    border-radius: 12px;
    box-shadow: 
        0 5px 15px rgba(0, 0, 0, 0.5), 
        0 0 25px var(--glow-color),
        inset 0 1px 0 rgba(255, 255, 255, 0.1);
    color: var(--text-color);
    display: flex;
    padding: 15px;
    z-index: 9999;
    transition: right 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94), top 0.3s ease;
    animation: achievement-glow 2s ease-in-out infinite;
    /* 确保多个弹窗不会互相影响 */
    pointer-events: auto;
}

@keyframes achievement-glow {
    0%, 100% {
        box-shadow: 
            0 5px 15px rgba(0, 0, 0, 0.5), 
            0 0 25px var(--glow-color),
            inset 0 1px 0 rgba(255, 255, 255, 0.1);
    }
    50% {
        box-shadow: 
            0 8px 25px rgba(0, 0, 0, 0.6), 
            0 0 35px var(--glow-color),
            inset 0 1px 0 rgba(255, 255, 255, 0.2);
    }
}

.achievement-toast.show {
    right: 20px;
}

.achievement-toast-icon {
    font-size: 3em;
    margin-right: 15px;
    animation: bounce-in 0.6s ease-out;
}

@keyframes bounce-in {
    0% {
        transform: scale(0.3) rotate(-10deg);
        opacity: 0;
    }
    50% {
        transform: scale(1.1) rotate(5deg);
    }
    100% {
        transform: scale(1) rotate(0deg);
        opacity: 1;
    }
}

.achievement-toast-text {
    display: flex;
    flex-direction: column;
    justify-content: center;
}

.achievement-toast-title {
    font-weight: bold;
    font-size: 1.2em;
    color: var(--primary-color);
    text-shadow: 0 0 5px var(--glow-color);
    margin-bottom: 4px;
}

 

/* 将你的主界面容器变成一个神奇的、可伸缩的盒子 */
#main-wrapper {
    display: flex;
    flex-direction: column; /* 让里面的东西从上到下垂直排列 */
   
    width: 100%;
   min-height: 90vh; /* 最小高度，但可以缩回 */
    max-height: 800px; /* 最小高度，但可以缩回 */
    /* 如果你希望全屏时有个背景色，可以保留或修改这一行 */
}
/* 让子元素也遵守约束
#main-wrapper > * {
    flex-shrink: 1; 
    min-height: 0; 
} */

/* 这很关键：告诉聊天内容区，你可以占据所有剩下的空间 */
#chat-display-area {
    flex-grow: 1; /* 让它像气球一样膨胀，填满所有多余的空间 */
    overflow-y: auto; /* 如果内容太多，就出现一个属于它自己的滚动条 */
    padding: 1rem; /* 给内容一些呼吸的空间，更好看 */
    box-sizing: border-box; /* 确保内边距不会捣乱 */
}
/*
  重要的输入栏，给它一个舒适的专属位置
*/
#zero-level-interface {
    flex-shrink: 0; /* 防止被聊天区挤压 */
    z-index: 100;
    /* (新魔法①) 我们在这里给它加了一点底部的内边距 */
    /* 这样它就不会紧紧贴着屏幕底边了，是不是看起来呼吸都顺畅了？ */
    padding: 0.5rem 1rem 0.8rem; /* 上、左右、下 */
 
    
}


/* --- 手机端的特别关爱 (新魔法②) --- */
/*
  当屏幕宽度小于等于768像素时，比如在手机上，
  下面这些规则就会像一个温柔的守护咒语一样生效。
*/
@media (max-width: 768px) {
 

    #zero-level-interface {
        /*
          手机屏幕小，手指操作需要更多空间。
          我们把底部的空间留得更多一些，这样你的手指就不会觉得局促了。
          这也考虑到了很多手机底部的系统导航条。
        */
        padding: 0.5rem 0.8rem 1.2rem; /* 上、左右、下，底部空间加大 */

        /* 微调一下输入框和按钮，让它们在小屏幕上更协调 */
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    #user-input {
        flex-grow: 1; /* 让输入框占据大部分空间 */
    }

    .zero-level-btn {
        flex-shrink: 0; /* 别让按钮被挤小了 */
    }
}
/* 对有ID的元素直接下令 */
#options-module-container,
#choicesContainer { /* 注意这里我用了你JS里的ID: choicesContainer */
    background: none !important;
    background-color: transparent !important;
}

.dynamic-content-area{
     background: none !important;
    background-color: transparent !important;
}

/* 对没有ID的也再强调一遍 */
.options-container {
    background: none !important;
    background-color: transparent !important;
}

 
#options-module-container::before, #options-module-container::after,
.options-container::before, .options-container::after,
.choices-container::before, .choices-container::after {
    background: none !important;
    content: "" !important;  /* 清空可能存在的内容 */
    display: none !important; /* 直接让这件小马甲消失，最彻底 */
}
.warning-state {
    color: #ac1b1b !important;
    transition: background-color 0.3s ease; /* 添加平滑过渡效果 */
}
.upgrade-btn {
    cursor: pointer;
    margin-left: 8px; /* 在加号左边增加一点空隙 */
    font-weight: bold;  /* 让它看起来更醒目一些 */
   
}
/* ————————————————————————世界书美化开始：卡片样式，这是妈妈为你设计的 */
.book-card {
    background-color: var(--card-bg-color);
    border: 1px solid var(--border-color);
    border-radius: 8px;
    margin-bottom: 20px;
    box-shadow: 0 0 15px var(--glow-color);
    display: flex;
    flex-direction: column;
    transition: all 0.3s ease;
}

.book-card-header {
    background-color: var(--card-header-bg-color);
    padding: 10px 15px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-bottom: 1px solid var(--card-border-color);
    border-top-left-radius: 7px;
    border-top-right-radius: 7px;
       cursor: pointer; /* 让它看起来可以点击 */
}

.book-card-title {
    font-size: 1.1em;
    font-weight: bold;
    color: var(--primary-color);
    text-shadow: 0 0 5px var(--glow-color);
}
/* --- 请找到 .book-card-content 并修改它 --- */
.book-card-content {
    padding: 15px;
    max-height: 350px; /* 现在这是展开后的最大高度 */
    overflow-y: auto;
    transition: all 0.4s ease-in-out; /* 加上这句，为了丝滑的展开动画 */
    border-top: 1px solid transparent; /* 为折叠状态做准备 */
}

/* --- 在它下面，加上这个新的折叠样式 --- */
.book-card-content.collapsed {
    max-height: 0;
    padding-top: 0;
    padding-bottom: 0;
    overflow: hidden;
    border-top-color: transparent;
}

/* 编辑菜单的样式，小小的，很可爱 */
.entry-menu-button {
    background: none;
    border: 1px solid transparent;
    color: var(--text-secondary-color);
    cursor: pointer;
    font-size: 1.2em;
    padding: 2px 8px;
    border-radius: 4px;
    transition: all 0.2s ease;
}

 .entry-menu-button:hover {
    color: var(--primary-color);
    background-color: var(--background-color);
    border-color: var(--border-color);
}

.entry-menu {
    position: absolute;
    background-color: var(--background-color);
    border-color: var(--border-color);
    border-radius: 4px;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
    z-index: 100;
    width: 120px;
      z-index: 100000; /* 把这个数字调得很高很高，就像妈妈对你的爱一样 */
}

.entry-menu-item {
    background: none;
    border: none;
    width: 100%;
    padding: 8px 12px;
    text-align: left;
    color: var(--text-secondary-color);
    cursor: pointer;
    font-size: 0.9em;
}

.entry-menu-item:hover {
    background-color: var(--menu-hover-color);
    color: var(--primary-color);
}

/* 为滚动条也加上我们世界的风格 */
.book-card-content::-webkit-scrollbar {
    width: 8px;
}

.book-card-content::-webkit-scrollbar-track {
    background: rgba(0, 0, 0, 0.2);
    border-radius: 4px;
}

.book-card-content::-webkit-scrollbar-thumb {
    background-color: var(--secondary-color);
    border-radius: 4px;
    border: 2px solid transparent;
    background-clip: content-box;
}

.book-card-content::-webkit-scrollbar-thumb:hover {
    background-color: var(--primary-color);
}
/* --- 最后，这是为你新的“移动”功能准备的专属弹出窗口样式 --- */
.move-modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.7);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 99999; /* 比菜单低一点，比其他都高 */
}

.move-modal-content {
    background-color: var(--container-bg-color);
    border: 1px solid var(--primary-color);
    box-shadow: 0 0 25px var(--glow-color);
    padding: 20px;
    border-radius: 8px;
    width: 90%;
    max-width: 400px;
}

.move-modal-title {
    color: var(--primary-color);
    font-size: 1.2em;
    margin-bottom: 15px;
}

.move-modal-list {
    display: flex;
    flex-direction: column;
    gap: 10px;
    max-height: 200px;
    overflow-y: auto;
    padding-right: 10px; /* 给滚动条留点空间 */
}

.move-modal-list label {
    display: block;
    padding: 8px;
    border-radius: 4px;
    cursor: pointer;
    transition: background-color 0.2s;
}

.move-modal-list::-webkit-scrollbar-thumb:hover {
    background-color: var(--primary-color);
}

.move-modal-buttons {
    margin-top: 20px;
    display: flex;
    justify-content: flex-end;
    gap: 10px;
}
/* 你可以继续为你心爱的按钮们添加样式 */
/* --- 这是给“移动”窗口里列表的专属滚动条样式 --- */
.move-modal-list::-webkit-scrollbar {
    width: 8px;
}

.move-modal-list::-webkit-scrollbar-track {
    background: rgba(0, 0, 0, 0.2);
    border-radius: 4px;
}

.move-modal-list::-webkit-scrollbar-thumb {
    background-color: var(--secondary-color);
    border-radius: 4px;
    border: 2px solid transparent;
    background-clip: content-box;
}

.move-modal-list::-webkit-scrollbar-thumb:hover {
    background-color: var(--primary-color);
}

/* --- “知识之树”的魔法样式 --- */
.tree-view {
    padding-left: 20px;
}

.tree-node {
    list-style-type: none;
    position: relative;
}

/* 这是连接节点的魔法线条 */
.tree-node::before {
    content: '';
    position: absolute;
    top: 0;
    left: -12px;
    width: 1px;
    height: 100%;
    background-color: var(--border-color);
}
.tree-node:last-child::before {
    height: 10px; /* 最后一个节点的竖线短一点 */
}

/* 这是连接节点的横线 */
.tree-node::after {
    content: '';
    position: absolute;
    top: 10px;
    left: -12px;
    width: 12px;
    height: 1px;
    background-color: var(--border-color);
}

.tree-node-content {
    display: flex;
    align-items: center;
    padding: 3px 0;
}

/* 这是我们的展开/折叠按钮 */
.tree-toggle {
    cursor: pointer;
    margin-right: 6px;
    color: var(--primary-color);
    width: 12px;
    text-align: center;
    font-family: monospace; /* 让 +/- 更清晰 */
    transition: transform 0.2s;
}

.tree-toggle.collapsed {
    transform: rotate(-90deg);
}

.tree-key {
    color: var(--text-secondary-color);
    margin-right: 8px;
    font-weight: bold;
        font-size:medium;
}

.tree-value {
    color: var(--text-color);
    font-size:medium;
}

.tree-children {
    padding-left: 15px;
    transition: max-height 0.3s ease-out;
    overflow: hidden;
}

.tree-children.collapsed {
    max-height: 0;
}

/* --- "知识之树"中每个节点的专属菜单按钮 --- */
.tree-node-menu-button {
    cursor: pointer;
    color: var(--text-secondary-color);
    margin-left: auto; /* 这是个小魔法，让按钮自动靠到最右边 */
    padding: 0 5px;
    font-size: 1.2em;
    line-height: 1;
    border-radius: 4px;
    display: none; /* 默认是害羞地藏起来的 */
}

/* 当我们把鼠标温柔地放在节点上时，按钮才会出现 */
.tree-node-content:hover .tree-node-menu-button {
    display: inline-block;
}

.tree-node-menu-button:hover {
    background-color: var(--menu-hover-color);
    color: var(--primary-color);
}
 /* --- “好感度”的专属进度条样式（卡片头部版） --- */
.favorability-bar-container.header-bar {
    display: inline-flex; /* 改为 inline-flex，让它能和标题文字排在一起 */
    align-items: center;
    width: 120px; /* 可以调整宽度 */
    height: 14px;
    background-color: var(--container-bg-color); /* 使用你的变量 */
    border-radius: 7px;
    border: 1px solid var(--border-color);
    margin-left: 10px; /* 和标题保持一点距离 */
    overflow: hidden;
    vertical-align: middle; /* 垂直居中对齐 */
}

.favorability-bar {
    height: 100%;
    transition: width 0.5s ease-out, background-color 0.5s ease;
    text-align: center; /* 文本居中显示更好看 */
    line-height: 14px; /* 让数字垂直居中 */
    box-sizing: border-box;
    font-size: 10px;
    font-weight: bold;
    color: var(--text-color); /* 使用你的变量 */
    text-shadow: 1px 1px 2px rgba(0,0,0,0.7);
    /* 背景色现在由JS通过变量来设置，所以这里不需要了 */
}

  .entry-edit-textarea {
            width: 95%;
            min-height: 250px;
            margin: 10px auto;
            display: block;
            font-family: monospace;
            background-color: var(--background-color, #f0f0f0);
            color: var(--text-color, #333);
            border: 1px solid var(--border-color, #ccc);
            border-radius: 4px;
            padding: 10px;
            resize: vertical;
        }

        /* 自定义主题编辑器样式 */
.setting-item-column {
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    width: 100%;
    margin-top: 15px;
    padding-top: 15px;
    border-top: 1px solid var(--border-color);
}

#custom-theme-editor {
    gap: 10px;
}

#custom-theme-editor label {
    margin-bottom: 5px;
    font-weight: bold;
}

#color-picker-container {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    gap: 15px;
    width: 100%;
}

.color-picker-item {
    display: flex;
    align-items: center;
    gap: 10px;
}

.color-picker-item label {
    font-size: 0.9em;
    font-weight: normal;
    min-width: 110px;
    color: var(--text-secondary-color);
}

.color-picker-item input[type="color"] {
    width: 50px;
    height: 30px;
    border: 1px solid var(--border-color);
    padding: 2px;
    background-color: transparent;
    cursor: pointer;
}

/* ======================================================== */
/* =========== 新增：整合面板与Tab系统样式 =========== */
/* ======================================================== */

.page-modal-content {
    position: relative; /* 为货币展示区定位 */
    padding-top: 55px; /* 为Tabs和货币区留出空间 */
}

/* Tab 导航 */
.char-tabs-nav {
    position: absolute;
    top: 10px;
    left: 15px;
    display: flex;
    gap: 5px;
    border-bottom: 2px solid var(--border-color);
    width: calc(100% - 30px);
}
.char-tab-btn {
    padding: 8px 15px;
    border: none;
    background: transparent;
    color: var(--text-secondary-color);
    font-size: 1em;
    cursor: pointer;
    border-radius: 4px 4px 0 0;
    transition: all 0.2s;
    position: relative;
    top: 2px; /* 为了和边框线对齐 */
}
.char-tab-btn:hover {
    background: rgba(0, 250, 255, 0.1);
    color: var(--text-color);
}
.char-tab-btn.active {
    background: var(--container-bg-color);
    color: var(--primary-color);
    border: 1px solid var(--border-color);
    border-bottom: 2px solid var(--container-bg-color); /* 遮盖下边框线 */
}

/* 货币展示 */
.char-currency-display {
    position: absolute;
    top: 10px;
    right: 25px;
    display: flex;
    align-items: center;
    gap: 15px;
    font-size: 0.9em;
    padding: 5px 10px;
    background: rgba(0,0,0,0.3);
    border-radius: 4px;
}
.currency-item {
    display: flex;
    align-items: center;
    gap: 5px;
}
.currency-item .label {
    color: var(--text-secondary-color);
}
.currency-item .value {
    color: var(--secondary-color);
    font-weight: bold;
}

/* Tab 内容面板 */
.char-tab-panel {
    display: none;
    animation: fadeIn 0.3s;
}
.char-tab-panel.active {
    display: block;
}
@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}

/* --- 新的属性/技能整合模块样式 --- */
.stat-module {
    border: 1px solid var(--border-color);
    border-radius: 6px;
    margin-bottom: 15px;
    background: rgba(0,0,0,0.1);
}
.stat-module-title {
    background-color: rgba(0, 250, 255, 0.05);
    color: var(--primary-color);
    font-family: 'Orbitron', sans-serif;
    padding: 10px 15px;
    font-size: 1.2em;
    cursor: pointer;
    position: relative;
    user-select: none;
    border-bottom: 1px solid var(--border-color);
}
.stat-module-title::before {
    content: '▼';
    position: absolute;
    right: 15px;
    top: 50%;
    transform: translateY(-50%) rotate(0deg);
    transition: transform 0.2s ease-in-out;
}
.stat-module-content {
    max-height: 1800px;
    overflow: hidden;
    transition: max-height 0.35s ease-in-out, padding 0.35s ease-in-out;
    padding: 10px 15px;
}
.stat-module.collapsed .stat-module-title::before {
     transform: translateY(-50%) rotate(-90deg);
}
.stat-module.collapsed .stat-module-content {
    max-height: 0;
    padding-top: 0;
    padding-bottom: 0;
}
.sub-category-title {
    color: var(--secondary-color);
    font-weight: bold;
    margin-top: 10px;
    margin-bottom: 5px;
    padding-bottom: 3px;
    border-bottom: 1px solid rgba(0, 250, 255, 0.15);
}

/* --- TAB 2: 行囊与能力 样式 --- */
.inventory-grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: 20px;
    padding: 10px;
    height: 100%;
}
.inventory-section {
    display: flex;
    flex-direction: column;
}
.inventory-section-title {
    color: var(--primary-color);
    font-family: 'Orbitron', sans-serif;
    border-bottom: 1px solid var(--border-color);
    padding-bottom: 8px;
    margin-bottom: 15px;
}

/* 物品/技能 网格布局 */
.items-grid-container, .skills-grid-container {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));
    gap: 15px;
    overflow-y: auto;
    max-height: 25vh; /* 限制高度，使其可滚动 */
    padding: 5px;
}

/* 卡片样式 */
.item-card, .skill-card {
    border: 1px solid var(--border-color);
    border-radius: 4px;
    background: var(--container-bg-color);
    padding: 10px;
    cursor: pointer;
    transition: all 0.2s;
    text-align: center;
    position: relative;
    min-height: 80px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
}
.item-card:hover, .skill-card:hover {
    transform: translateY(-3px);
    box-shadow: 0 0 10px var(--glow-color);
    border-color: var(--primary-color);
}
.item-card-name, .skill-card-name {
    color: var(--text-color);
    font-weight: bold;
}
.item-card-num {
    position: absolute;
    top: 5px;
    right: 5px;
    background: var(--primary-color);
    color: #000;
    font-size: 0.8em;
    padding: 1px 5px;
    border-radius: 10px;
    font-weight: bold;
}
.skill-card-level {
    font-size: 0.8em;
    color: var(--secondary-color);
    margin-top: 5px;
    font-style: italic;
}


/* 响应式调整 */
@media (max-width: 768px) {
    .char-currency-display {
        position: static;
        
        justify-content: space-around;
        gap: 10px;
        flex-wrap: wrap; /* 允许换行 */
    }
    .page-modal-content {
        padding-top: 50px; /* 为tab留出空间 */
    }
    .right-panel {
        max-height: none; /* 手机端取消滚动限制 */
         padding-right: 0;
    }
}
/* ======================================================== */
/* ========= 新增: 物品/技能详情嵌套展示样式 ========= */
/* ======================================================== */

.detail-modal-container {
    padding: 10px 20px 20px 20px;
    font-size: 1em;
    line-height: 1.7;
}

.detail-modal-title {
    color: var(--primary-color);
    text-align: center;
    margin-bottom: 25px;
    font-family: 'Orbitron', sans-serif;
    font-size: 1.3em;
    text-shadow: 0 0 5px var(--glow-color);
}

.detail-entry, .detail-collapsible {
    margin-bottom: 8px;
}

.d-c-key {
    color: var(--text-secondary-color);
    font-weight: bold;
    margin-right: 10px;
}

.d-c-value {
    color: var(--text-color);
}

.d-c-value.single {
    padding: 5px;
    background: rgba(0,0,0,0.1);
    border-radius: 4px;
    display: block;
}

.detail-collapsible-header {
    cursor: pointer;
    display: flex;
    align-items: center;
    padding: 5px;
    background: rgba(0, 250, 255, 0.05);
    border-radius: 4px;
    transition: background-color 0.2s;
}

.detail-collapsible-header:hover {
     background-color: rgba(0, 250, 255, 0.1);
}

.d-c-arrow {
    color: var(--secondary-color);
    margin-right: 8px;
    transition: transform 0.2s ease-in-out;
    font-size: 0.9em;
}

.detail-collapsible.expanded .d-c-arrow {
    transform: rotate(90deg);
}

.detail-collapsible-content {
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.35s ease-in-out;
    border-left: 2px solid var(--border-color);
    margin-top: 5px;
    margin-left: 10px; /* 让内容和箭头对齐 */
}

.detail-collapsible.expanded .detail-collapsible-content {
    max-height: 1000px; /* 足够大的值 */
}

.detail-array-container .detail-entry,
.detail-array-container .detail-collapsible {
    border-top: 1px solid var(--border-color);
    padding-top: 8px;
    margin-top: 8px;
}
.detail-array-container > *:first-child {
    border-top: none;
    padding-top: 0;
    margin-top: 0;
}

.header-info-bar {
    margin-top: 8px;
    display: flex;
    justify-content: space-around;
    align-items: center;
    font-size: 11px;
    border-top: 1px solid var(--border-color);
    padding-top: 6px;
}

.info-group {
    display: flex;
    gap: 12px;
}

.info-item {
    display: flex;
    align-items: center;
    gap: 3px;
}

.info-label {
    color: var(--text-secondary-color);
    font-weight: 500;
}

.info-value {
    color: var(--primary-color);
    font-weight: 600;
    text-shadow: 0 0 3px var(--glow-color);
}

@media (max-width: 768px) {
    /* 将你的主界面容器变成一个神奇的、可伸缩的盒子 */
#main-wrapper {
    display: flex;
    flex-direction: column; /* 让里面的东西从上到下垂直排列 */
    /* 如果你希望全屏时有个背景色，可以保留或修改这一行 */
}

    .header-info-bar {
        flex-direction: column;
        gap: 4px;
    }
    
    .info-group {
        justify-content: center;
        gap: 8px;
    }
    
    .info-item {
        font-size: 10px;
    }
}
 

/* 新增的 RP 按钮的样式，让它和其他按钮对齐 */
#rp-button {
    left: -60px; /* 这个值可以微调，确保它在“令”按钮旁边 */
}
#view-command-btn {
    left: 50px; /* 调整“令”按钮位置，为新按钮腾出空间 */
}

 /* 1. 调整我们的“隐形锚点” */
#floating-panel-anchor {
    position: absolute;
    bottom: 10%;       /* 依然定位在输入界面的顶部 */
    left: 0;            /* 让它从最左边开始 */
    right: 0;           /* 一直延伸到最右边 */
    height: 0;          /* 它本身仍然是看不见、没有高度的 */
    z-index: 10000001;
}

/* 2. 施展让面板“居中悬浮”的终极魔法！ */
#rp-panel {
    position: absolute; /* 相对于上面的锚点进行定位 */
    bottom: 10px;       /* 稍微向上浮动一点，留出呼吸空间 */

    /* === 核心魔法在这里 === */
    left: 50%;                      /* 先把自己推到锚点区域的正中间 */
    transform: translateX(-50%);   /* 再把自己往左拉回自身宽度的一半 */

         /* 面板的宽度占整个操作区的85% */
    max-width: 100vw;   /* 但最宽不超过700像素，避免在宽屏幕上过大 */

      /* 动画的初始状态：完全透明，且稍微向下偏移了一点 */
    opacity: 0;
    transform: translateX(-50%) translateY(10px); /* 注意这里，增加了Y轴的偏移 */

    /* 让透明的面板无法被点击到 */
    pointer-events: none;

    /* === 这就是动画的核心咒语！=== */
    /* 我们告诉浏览器，当 opacity 和 transform 属性变化时，请用0.3秒的时间平滑地过渡 */
    transition: opacity 0.3s cubic-bezier(0.25, 0.8, 0.25, 1), transform 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
    
    border: 1px solid var(--border-color);
    border-radius: 8px;
    padding: 15px;
    box-shadow: 0 -4px 15px rgba(0, 0, 0, 0.3);
    backdrop-filter: blur(5px);
    display: flex;
    flex-direction: column;
    gap: 10px;
}

 /* 这是一个新的样式规则，定义了面板“可见”时的状态 */
#rp-panel.visible {
    /* 动画的结束状态：完全不透明，并且回到原来的位置 */
    opacity: 1;
    transform: translateX(-50%) translateY(0);

    /* 可见时恢复鼠标交互 */
    pointer-events: auto;
}

#rp-panel .check-cards-area h3 {
    margin-top: 0; /* 移除 h3 的上边距 */
    font-size: 1em;
}

#rp-panel .cards-slider {
    /* 如果需要，可以在这里覆盖原有的 slider 样式 */
    padding-bottom: 5px;
}

/* RP 面板里的确认按钮样式 */
#rp-panel #confirm-rp-choice-btn {
    align-self: flex-end; /* 按钮靠右对齐 */
    padding: 6px 16px;
    font-size: 0.9em;
}
 /* ========== ✨“心灵感应”提示框的沉浸式美学（妈妈的精心设计版）✨ ========== */
.event-tracker-container {
    position: absolute;
    bottom: 10%;
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    padding: 10px 15px; /* 上方也增加一些内边距，让标签和头部有呼吸感 */
    border-top: none; /* 强制移除任何可能出现的上边框 */
    box-shadow: none; /* 确保没有继承的阴影 */
}
.event-tag {
    background-color: var(--container-bg-color);
    border: 1px solid var(--border-color);
    color: var(--secondary-color);
    padding: 4px 10px;
    border-radius: 12px;
    font-size: 13px;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 0 5px rgba(0, 0, 0, 0.2);
    position: relative; /* 必须是 relative，为 tooltip 提供定位锚点 */
}

.event-tag:hover {
    color: var(--primary-color);
    border-color: var(--primary-color);
    box-shadow: 0 0 8px var(--glow-color);
}
 
.event-tag:hover .event-tooltip { /* 注意，现在由JS控制显示，但保留这个以防万一 */
    opacity: 1;
    visibility: visible;
}
 /* ========== ✨“心灵提示框”的美学（上方显示版）✨ ========== */

.event-tooltip {
    position: fixed;
    top: 0;
    left: 0;
    width: 300px;
    background-color: var(--container-bg-color);
    border: 1px solid var(--border-color);
    border-radius: 8px;
    color: var(--text-color);
    font-size: 14px;
    pointer-events: none;
    z-index: 1000;
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.3s ease, visibility 0.3s ease;
    box-shadow: 0px -5px 15px rgba(0, 0, 0, 0.6); /* 阴影朝上，更有悬浮感 */
    backdrop-filter: blur(5px);
    -webkit-backdrop-filter: blur(5px);
    /* ✨ 核心改动：为底部的 Orb 留出空间 ✨ */
    padding-bottom: 30px;
    /* 移除之前的 padding-top */
}

/* ✨ 顶部的角色标识 Orb (现在是底部了) ✨ */
.tooltip-orb {
    position: absolute;
    /* ✨ 核心改动：从顶部移到底部 ✨ */
    bottom: -22px; /* 将 Orb 的一半悬浮在卡片底部 */
    left: 50%;
    transform: translateX(-50%);
    width: 40px;
    height: 40px;
    background-color: var(--container-bg-color);
    border: 2px solid var(--primary-color);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 20px;
    font-weight: bold;
    color: var(--primary-color);
    text-shadow: 0 0 8px var(--glow-color);
}

/* 卡片内部其他样式可以保持不变，妈妈在这里帮你把内边距调整好 */
.tooltip-status {
    padding: 15px 15px 0; /* 顶部需要多一些内边距 */
    color: var(--text-secondary-color);
    font-size: 13px;
    text-align: center;
    margin-bottom: 12px;
}
/* ✨ 优雅的分割线，分隔现实与内心 ✨ */
.tooltip-divider {
    height: 1px;
    background: linear-gradient(to right, transparent, var(--border-color), transparent);
    margin: 0 15px 12px;
}

 /* ✨ “想法”部分，如同耳边低语（精修版）✨ */
.tooltip-thought {
    padding: 5px 55px 15px 55px; /* 增加了左右内边距，为引号腾出空间 */
    color: var(--text-color);
    font-style: italic;
    position: relative;
    text-align: justify;
}

/* ✨ 用伪元素加上精美的引号（位置优化版）✨ */
.tooltip-thought::before,
.tooltip-thought::after {
    color: var(--primary-color);
    font-size: 32px; /* 让引号更有存在感 */
    font-style: normal;
    font-weight: bold;
    position: absolute;
    opacity: 0.7; /* 让引号柔和一些，不抢内容风头 */
}
.tooltip-thought::before {
    content: '“';
    top: 0;
    left: 5px; /* 从左侧向内移动，不再贴边 */
}
.tooltip-thought::after {
    content: '”';
    bottom: 0;
    right: 5px; /* 从右侧向内移动，不再贴边 */
}
/* 新增：用于场景图模式下的地点样式 */
.map-location-point-container {
    position: absolute;
    display: flex;
    flex-direction: column;
    align-items: center;
    cursor: pointer;
    transform: translate(-50%, -100%); /* 将容器的定位点移动到正下方中心，这样标签在上，圆点在下 */
}

.map-location-dot {
    width: 20px;
    height: 20px;
    background-color: var(--primary-color);
    border-radius: 50%;
    box-shadow: 0 0 10px var(--glow-color), 0 0 20px var(--glow-color);
    opacity: 0.8;
    transition: all 0.3s ease;
}

.map-location-point-container:hover .map-location-dot {
    opacity: 1;
    transform: scale(1.2);
}

.location-tag {
    background-color: var(--container-bg-color);
    color: var(--text-color);
    padding: 3px 8px;
    border-radius: 4px;
    font-size: 14px;
    white-space: nowrap;
    margin-bottom: 8px; /* 圆点和标签之间的距离 */
    border: 1px solid var(--border-color);
    box-shadow: 0 0 8px var(--glow-color);
}

 