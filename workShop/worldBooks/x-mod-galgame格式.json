{"entries":{"0":{"uid":0,"key":[],"keysecondary":[],"comment":"gal","content":"<%_\nvar double_api = getLocalVar(\"double_api\") || \"false\";\nvar batches = getLocalVar(\"batches\") || 1;\n\n// 1. 读取并解析差分数据\nvar expressionJsonStr = getLocalVar(\"available_expressions_json\") || \"{}\";\nvar expressionMap = {};\ntry {\n    expressionMap = JSON.parse(expressionJsonStr);\n} catch (e) {\n    expressionMap = {};\n}\n\n// 2. 判断是否有差分数据\nvar hasExpressions = Object.keys(expressionMap).length > 0;\nvar expressionListStr = \"\";\n\nif (hasExpressions) {\n    // 构建展示字符串： 名字:[差分1,差分2]\n    expressionListStr = Object.entries(expressionMap)\n        .map(([name, exps]) => name + \":[\" + exps.join(\",\") + \"]\")\n        .join(\"\\n\");\n}\n\nif ((double_api === \"true\" && batches === 1) || double_api === \"false\") {\n_%>\n game.set('正文格式', `\n正文请完全按照【Galgame模式】进行输出。\n1. 角色说话：请用“${角色名}|${内容}”的格式。例：xxx|xxx。若该角色有npc档案，则此处的名字必须和该npc档案的名字**完全**一致，以展示默认立绘。\n2. 旁白/心理活动：直接写内容。\n<%_ if (hasExpressions) { _%>\n3. 差分规则：以下角色拥有差分立绘，可以使用“${角色名}|${差分名}|${内容}”的格式来展现角色的情绪。\n可差分NPC及列表：\n<%- expressionListStr %>\n<%_ } _%>\n`)\n<%_\n}\n_%>","constant":true,"vectorized":false,"selective":true,"selectiveLogic":0,"addMemo":true,"order":9777,"position":4,"disable":false,"excludeRecursion":false,"preventRecursion":false,"matchPersonaDescription":false,"matchCharacterDescription":false,"matchCharacterPersonality":false,"matchCharacterDepthPrompt":false,"matchScenario":false,"matchCreatorNotes":false,"delayUntilRecursion":false,"probability":100,"useProbability":true,"depth":0,"group":"","groupOverride":false,"groupWeight":100,"scanDepth":null,"caseSensitive":null,"matchWholeWords":null,"useGroupScoring":null,"automationId":"","role":0,"sticky":0,"cooldown":0,"delay":0,"triggers":[],"displayIndex":0,"characterFilter":{"isExclude":false,"names":[],"tags":[]}},"1":{"uid":1,"key":[],"keysecondary":[],"comment":"cg开-手动放入cg信息-二选一","content":"<%_\nvar double_api = getLocalVar(\"double_api\") || \"false\";\nvar batches = getLocalVar(\"batches\") || 1;\n \nif ((double_api === \"true\" && batches === 1) || double_api === \"false\") {\n_%>\n game.set('cg list', `\n在需要展示cg的时候，可以这样输出：cg|${cg名}。以下是可用的cg列表：\n[你在这里自己填]\n`)\n<%_\n \n}\n_%>","constant":true,"vectorized":false,"selective":true,"selectiveLogic":0,"addMemo":true,"order":9778,"position":4,"disable":true,"excludeRecursion":false,"preventRecursion":false,"matchPersonaDescription":false,"matchCharacterDescription":false,"matchCharacterPersonality":false,"matchCharacterDepthPrompt":false,"matchScenario":false,"matchCreatorNotes":false,"delayUntilRecursion":false,"probability":100,"useProbability":true,"depth":0,"group":"","groupOverride":false,"groupWeight":100,"scanDepth":null,"caseSensitive":null,"matchWholeWords":null,"useGroupScoring":null,"automationId":"","role":0,"sticky":0,"cooldown":0,"delay":0,"triggers":[],"displayIndex":0},"2":{"uid":2,"key":[],"keysecondary":[],"comment":"cg开-自动遍历cg信息-二选一","content":"<%_\nvar double_api = getLocalVar(\"double_api\") || \"false\";\nvar batches = getLocalVar(\"batches\") || 1;\n\n// 1. 读取并解析 CG 数据\n// 注意：这里读取的是 available_cgs_json，默认值是空数组字符串 \"[]\"\nvar cgJsonStr = getLocalVar(\"available_cgs_json\") || \"[]\";\nvar cgList = [];\ntry {\n    cgList = JSON.parse(cgJsonStr);\n} catch (e) {\n    cgList = [];\n}\n\n// 2. 判断是否有 CG 数据并构建字符串\nvar hasCgs = cgList.length > 0;\nvar cgDisplayStr = \"\";\n\nif (hasCgs) {\n    // 将数组连接成字符串，例如: \"日落, 战斗, 教室\"\n    cgDisplayStr = cgList.join(\", \");\n} else {\n    cgDisplayStr = \"暂无可用CG\";\n}\nif (hasCgs) {\n\nif ((double_api === \"true\" && batches === 1) || double_api === \"false\") {\n_%>\n game.set('cg', `\n在需要展示对应cg的时候，以此格式输出：cg|${cg名称}。\n可用的cg列表：\n[<%- cgDisplayStr %>]\n`)\n<%_\n}\n}\n_%>","constant":true,"vectorized":false,"selective":true,"selectiveLogic":0,"addMemo":true,"order":9778,"position":4,"disable":false,"excludeRecursion":false,"preventRecursion":false,"matchPersonaDescription":false,"matchCharacterDescription":false,"matchCharacterPersonality":false,"matchCharacterDepthPrompt":false,"matchScenario":false,"matchCreatorNotes":false,"delayUntilRecursion":false,"probability":100,"useProbability":true,"depth":0,"group":"","groupOverride":false,"groupWeight":100,"scanDepth":null,"caseSensitive":null,"matchWholeWords":null,"useGroupScoring":null,"automationId":"","role":0,"sticky":0,"cooldown":0,"delay":0,"triggers":[],"displayIndex":0}}}