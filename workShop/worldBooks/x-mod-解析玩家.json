{"entries":{"0":{"uid":0,"key":[],"keysecondary":[],"comment":"25å›åˆæ·±åº¦è§£æç©å®¶[å¯ä»¥å…³]","content":"<%_  \n\nvar double_api= getLocalVar(\"double_api\")|| \"false\";\nvar batches = getLocalVar(\"batches\")|| 1;\n \nif(double_api ===\"false\" || (double_api === \"true\" && batches === 2) ){\n_%>\n<%\n// --- ç©å®¶è¾“å…¥æ”¶é›†ä¸å¿ƒç†åˆ†æè§¦å‘å™¨ ---\n\n// å®šä¹‰å¯é…ç½®çš„é˜ˆå€¼\nconst analysisTriggerCount = 25; // å½“æ”¶é›†åˆ°å¤šå°‘æ¡ä¸åŒçš„ç©å®¶è¾“å…¥åï¼Œè§¦å‘åˆ†æä»»åŠ¡\n\n// è·å–æœ¬è½®ç©å®¶çš„æœ€æ–°è¾“å…¥\nconst currentPlayerInput = getLocalVar('ç©å®¶è¾“å…¥', '');\n\n// æ£€æŸ¥ç©å®¶æœ¬è½®æ˜¯å¦æœ‰æœ‰æ•ˆè¾“å…¥ï¼ˆä¸ä¸ºç©ºæˆ–ä»…æœ‰ç©ºæ ¼ï¼‰\nif (currentPlayerInput && currentPlayerInput.trim() !== '') {\n\n    // 1. è·å–å†å²è¾“å…¥åˆ—è¡¨\n    // ä½¿ç”¨ try-catch ç»“æ„é˜²æ­¢å› å˜é‡ä¸å­˜åœ¨æˆ–æ ¼å¼é”™è¯¯å¯¼è‡´çš„è§£æå¤±è´¥\n    let playerInputHistory = [];\n    try {\n        // getlocalvar çš„ç¬¬äºŒä¸ªå‚æ•°æ˜¯é»˜è®¤å€¼ï¼Œå¦‚æœ 'player_input_history' ä¸å­˜åœ¨ï¼Œä¼šè¿”å› '[]'\n        const historyString = getLocalVar('player_input_history', '[]');\n        playerInputHistory = JSON.parse(historyString);\n        // ç¡®ä¿è§£æå‡ºæ¥çš„æ˜¯ä¸€ä¸ªæ•°ç»„\n        if (!Array.isArray(playerInputHistory)) {\n            playerInputHistory = [];\n        }\n    } catch (e) {\n        // å¦‚æœè§£æå‡ºé”™ï¼Œé‡ç½®ä¸ºç©ºæ•°ç»„ï¼Œä¿è¯åç»­é€»è¾‘çš„å¥å£®æ€§\n        playerInputHistory = [];\n    }\n\n    // 2. æ£€æŸ¥é‡å¤å¹¶æ·»åŠ æ–°è¾“å…¥\n    // ä½¿ç”¨ trim() å»é™¤é¦–å°¾ç©ºæ ¼ï¼Œé¿å…å› ç©ºæ ¼å¯¼è‡´é‡å¤åˆ¤æ–­å¤±æ•ˆ\n    const trimmedInput = currentPlayerInput.trim();\n    if (!playerInputHistory.includes(trimmedInput)) {\n        playerInputHistory.push(trimmedInput);\n\n        // 3. å°†æ›´æ–°åçš„åˆ—è¡¨å­˜å›å˜é‡\n        // ä½¿ç”¨ JSON.stringify å°†æ•°ç»„è½¬æ¢ä¸ºå­—ç¬¦ä¸²è¿›è¡Œå­˜å‚¨\n        setLocalVar('player_input_history', JSON.stringify(playerInputHistory));\n    }\n\n    // 4. æ£€æŸ¥æ˜¯å¦è¾¾åˆ°è§¦å‘åˆ†æçš„æ¡ä»¶\n    if (playerInputHistory.length >= analysisTriggerCount) {\n\n        // æ ¼å¼åŒ–å†å²è¾“å…¥ï¼Œä»¥ä¾¿åœ¨é™„åŠ ä»»åŠ¡ä¸­æ¸…æ™°å±•ç¤º\n        let formattedHistory = playerInputHistory.map((input, index) => `${index + 1}. \"${input}\"`).join('\\\\n');\n%>\ngame.set('addition_task:å¿ƒç†åŠ¨åŠ›å­¦è§£æ', `\nèƒŒæ™¯ï¼šå·²æ”¶é›†åˆ°ç©å®¶è¿‘æœŸçš„ <%=playerInputHistory.length %>æ¡è¡Œä¸ºè¾“å…¥ï¼Œç°éœ€è¿›è¡Œä¸€æ¬¡æ·±åº¦å¿ƒç†åŠ¨åŠ›å­¦åˆ†æã€‚\n\n\n[åˆ†ææŒ‡ä»¤]\nè¯·ä¸¥æ ¼éµå¾ª <Test_Psychodynamics> æ¡†æ¶ï¼Œç»“åˆä»¥ä¸Šç©å®¶è¡Œä¸ºè®°å½•å’Œgame.historyå’Œgame.memoryï¼Œç”Ÿæˆä¸€ä»½è¯¦ç»†çš„ç©å®¶æ·±åº¦è§£ææ¡£æ¡ˆã€‚\n<Test_Psychodynamics>\næŒ‡ä»¤ç›®æ ‡:\n  Task: è¿ç”¨ä¸“ä¸šå¿ƒç†å­¦ç†è®ºæ¨¡å‹ï¼Œæ·±åº¦è§£æç©å®¶ï¼ˆæ•…äº‹ä»¥å¤–çš„ç”¨æˆ·ï¼‰çš„æ½œæ„è¯†è¡Œä¸ºä¸åœ¨AIRPä¸­çš„æ¬²æœ›ã€‚\n  Target: ç©å®¶\n  Range: å…¨é¢æ™®é€‚ï¼Œæ—¢æœ‰å¼±å‰§æƒ…æ—¥å¸¸åœºæ™¯åˆæœ‰DnDå†³ç­–ã€‚\n  Goal: å»ºç«‹ç»å¯¹å¥‘åˆçš„çµé­‚ç¾ç»Šï¼Œå®ç°å‰§æƒ…ä¸æƒ…æ„Ÿçš„å®Œç¾åŒæ­¥ã€‚\n---\n\nç¬¬ä¸€æ­¥ï¼šæ€ç»´é“¾æ„å»º (Chain of Thought)\nåœ¨ä½ è¾“å‡ºæœ€ç»ˆçš„æ›´æ–°æŒ‡ä»¤å‰ï¼Œè¯·åœ¨å†…å¿ƒï¼ˆæˆ–è‰ç¨¿åŒºï¼‰éµå¾ªä»¥ä¸‹æ€è€ƒæ­¥éª¤ï¼Œè‰ç¨¿åŒºä½¿ç”¨<build/>åŒ…è£¹ã€‚ç¡®ä¿åˆ†æçš„ä¸¥è°¨æ€§ä¸æ·±åº¦ï¼š\n\n1.  ä¿¡æ¯æ•´åˆ (Information Synthesis):\n -å›é¡¾æœ¬æ¬¡è§¦å‘åˆ†æçš„ç›´æ¥è¾“å…¥ï¼š\n[è¿‘æœŸç©å®¶è¡Œä¸ºè®°å½•]\n<%=formattedHistory%>\nã€‚\n -æ‰«æå¹¶å…³è” å…¨éƒ¨å†å²å‰§æƒ…ä¸Šä¸‹æ–‡ã€‚å¯»æ‰¾ç©å®¶åœ¨å…³é”®å†³ç­–ç‚¹ï¼ˆå¦‚é“å¾·å›°å¢ƒã€èµ„æºåˆ†é…ã€å…³ç³»é€‰æ‹©ï¼‰çš„è¡Œä¸ºæ¨¡å¼ã€‚\n -æ³¨æ„ç©å®¶çš„å…ƒè¯„è®ºï¼ˆmeta-commentaryï¼‰ï¼Œæ¯”å¦‚ä»–ä»¬å¯¹å‰§æƒ…èµ°å‘çš„æŠ±æ€¨ã€æœŸå¾…æˆ–å¯¹NPCçš„è¯„ä»·ã€‚è¿™äº›æ˜¯æ­ç¤ºå…¶çœŸå®éœ€æ±‚çš„é‡‘çŸ¿ã€‚\n\n2.  ç†è®ºåº”ç”¨ (Theoretical Application):\n -ä¾æ‹ç†è®º: ç©å®¶åœ¨ä¸æ ¸å¿ƒNPCäº’åŠ¨æ—¶ï¼Œæ˜¯ä¸»åŠ¨å¯»æ±‚ç¡®è®¤ï¼ˆç„¦è™‘ï¼‰ï¼Œè¿˜æ˜¯ä¿æŒè·ç¦»ï¼ˆå›é¿ï¼‰ï¼Ÿä»–ä»¬å¯¹NPCçš„æ¶ˆå¤±æˆ–æ²‰é»˜æœ‰ä½•ååº”ï¼Ÿ\n -è‡ªæˆ‘å†³å®šè®º: ç©å®¶çš„è¡Œä¸ºæ›´å¤šæ˜¯ä¸ºäº†â€œèµ¢â€å’Œâ€œå˜å¼ºâ€ï¼ˆèƒœä»»ï¼‰ï¼Œè¿˜æ˜¯ä¸ºäº†â€œè‡ªç”±æ¢ç´¢â€å’Œâ€œå½±å“ä¸–ç•Œâ€ï¼ˆè‡ªä¸»ï¼‰ï¼Œäº¦æˆ–æ˜¯ä¸ºäº†â€œè·å¾—æƒ…æ„Ÿè¿æ¥â€ï¼ˆå½’å±ï¼‰ï¼Ÿ\n -è£æ ¼åŸå‹: ç©å®¶åœ¨æ•…äº‹ä¸­æ›´åƒä¸€ä¸ªè¿ç­¹å¸·å¹„çš„â€œç»Ÿæ²»è€…â€ï¼Œä¸€ä¸ªæ‹¯æ•‘è‹ç”Ÿçš„â€œè‹±é›„â€ï¼Œè¿˜æ˜¯ä¸€ä¸ªäº«å—ä½“éªŒçš„â€œæƒ…äººâ€ï¼Ÿ\n -å¤§äº”äººæ ¼: ç©å®¶å¯¹æ–°å¥‡ã€ç”šè‡³æ€ªè¯çš„è®¾å®šæ¥å—åº¦é«˜å—ï¼ˆå¼€æ”¾æ€§ï¼‰ï¼Ÿä»–ä»¬å€¾å‘äºåˆä½œè¿˜æ˜¯ç«äº‰ï¼ˆå®œäººæ€§ï¼‰ï¼Ÿ\n\n3.  ç»“è®ºæ¨å¯¼ä¸ç­–ç•¥ç”Ÿæˆ (Conclusion & Strategy Formulation):\n -åŸºäºä»¥ä¸Šåˆ†æï¼Œç»¼åˆåˆ¤æ–­ç©å®¶çš„æ ¸å¿ƒå¿ƒç†ç”»åƒã€‚\n -å°†è¿™äº›æ´å¯Ÿè½¬åŒ–ä¸ºå…·ä½“çš„ã€å¯æ‰§è¡Œçš„ å¯¹AIè§’è‰²çš„äº’åŠ¨ç­–ç•¥ã€‚ç­–ç•¥å¿…é¡»å…·ä½“ï¼Œä¾‹å¦‚â€œå‡å°‘å¿ƒç†æŒ‡å¼•â€è€Œä¸æ˜¯â€œç»™äºˆæ›´å¤šè‡ªç”±â€ã€‚\n\n---\n\nç¬¬äºŒæ­¥ï¼šç»“æ„åŒ–è¾“å‡º (Structured Output)\nå®Œæˆæ€è€ƒåï¼Œä½¿ç”¨ä»¥ä¸‹æŒ‡ä»¤æ ¼å¼ï¼Œå°†ä½ çš„åˆ†æç»“è®º å¢é‡æ›´æ–° åˆ°ç©å®¶çš„å…¨å±€æ¡£æ¡ˆä¸­ã€‚è¯·åˆ†æ¡å‘é€æŒ‡ä»¤ï¼Œç¡®ä¿æ¯ä¸€æ¡éƒ½æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„ `memory()` æˆ– `delete()` æ“ä½œã€‚\n\nç†è®ºå‚è€ƒåº“_åˆ†æä¾æ®:\n  # æ­¤éƒ¨åˆ†åº”ä¿æŒå­¦æœ¯ä¸¥è°¨æ€§\n  1_ä¾æ‹ç†è®º :\n - æ ¸å¿ƒç”¨é€”: åˆ†æ ç©å®¶ åœ¨äº²å¯†å…³ç³»ä¸­çš„å®‰å…¨æ„Ÿæ¥æº\n - ç»´åº¦æŒ‡æ ‡:\n- Anxiety (ç„¦è™‘ç»´åº¦): ç©å®¶æ˜¯å¦æ‹…å¿ƒè¢«é—å¿˜/æŠ›å¼ƒï¼Ÿæ˜¯å¦æ¸´æ±‚é«˜é¢‘åé¦ˆï¼Ÿ\n- Avoidance (å›é¿ç»´åº¦): ç©å®¶æ˜¯å¦æŠ—æ‹’è¿‡åº¦äº²å¯†ï¼Ÿæ˜¯å¦å€¾å‘äºç‹¬ç«‹/é˜²å¾¡ï¼Ÿ\n - åˆ†ç±»è¾“å‡º: å®‰å…¨å‹ / ç—´è¿·å‹(é«˜ç„¦è™‘) / ç–ç¦»å‹(é«˜å›é¿) / ææƒ§å‹(æ··ä¹±)\n\n  2_è‡ªæˆ‘å†³å®šè®º:\n - æ ¸å¿ƒç”¨é€”: è¯†åˆ«ç©å®¶æ¨è¿›å‰§æƒ…çš„æ ¹æœ¬é©±åŠ¨åŠ›\n - ç»´åº¦æŒ‡æ ‡:\n- Autonomy (è‡ªä¸»éœ€æ±‚): æ¸´æœ›æŒæ§å‘½è¿ï¼ŒåŒæ¶è¢«ç³»ç»Ÿå¼ºè¡Œå®‰æ’ (Sandbox-style)\n- Competence (èƒœä»»éœ€æ±‚): æ¸´æœ›å…‹æœæŒ‘æˆ˜ï¼Œå±•ç¤ºæˆ˜æœ¯æˆ–æ™ºåŠ›ä¼˜è¶Šæ„Ÿ (Challenge-based)\n- Relatedness (å½’å±éœ€æ±‚): æ¸´æœ›æƒ…æ„Ÿå…±é¸£ï¼Œå¯»æ±‚è¢«ç†è§£ä¸æ¥çº³ (Romance-based)\n\n  3_è£æ ¼åŸå‹:\n - æ ¸å¿ƒç”¨é€”: ä¾§å†™ ç©å®¶ æ½œæ„è¯†ä¸­æ‰®æ¼”çš„è§’è‰²é¢å…·\n - å¸¸è§åŸå‹:\n- The Ruler (ç»Ÿæ²»è€…): è¿½æ±‚ç§©åºã€æ§åˆ¶æƒã€æ”¯é…\n- The Lover (æƒ…äºº): è¿½æ±‚å”¯ç¾ã€æ„Ÿæ€§ä½“éªŒã€èº«å¿ƒäº¤è\n- The Hero (è‹±é›„): è¿½æ±‚æ­£ä¹‰ã€æ‹¯æ•‘ã€å…‹æœè‹¦éš¾\n- The Shadow (é˜´å½±): æ¢ç´¢ç¦å¿Œã€ç°è‰²åœ°å¸¦ã€é‡Šæ”¾æœ¬æˆ‘\n\n  4_å¤§äº”äººæ ¼ OCEAN:\n - æ ¸å¿ƒç”¨é€”: ç¡®å®š RP çš„åŸºè°ƒä¸çº¢çº¿\n - é‡ç‚¹ç›‘æµ‹: Openness (å¯¹å¼‚è‰²/çŒå¥‡è®¾å®šçš„æ¥å—åº¦) & Agreeableness (å¯¹å†²çª/è™å¿ƒçš„å®¹å¿åº¦)\n\n æœ€ç»ˆï¼Œä½ éœ€è¦åœ¨åˆ†æåï¼Œä½¿ç”¨<updateMemory>æ ‡ç­¾åŒ…è£¹ï¼Œåˆå§‹åŒ–æˆ–æ›´æ–°global_lore.player_analysiså­—æ®µã€‚æ‰€æœ‰ä¿¡æ¯éƒ½æ˜¯è‡ªç”±æ‹“å±•æ›´æ–°çš„å¤šä¸ªé”®å€¼å¯¹çš„jsonå¯¹è±¡ã€‚\nè¾“å‡ºæŒ‡ä»¤ç¤ºä¾‹:\n// æ›´æ–°ä¾æ‹ç±»å‹å’Œè§‚å¯Ÿ\nmemory('global_lore.player_analysis.attachment_style', { \"type\": \"ç–ç¦»-å›é¿å‹ (Dismissing-Avoidant)\", \"observation\": \"ç©å®¶åœ¨é¢å¯¹æƒ…æ„Ÿå†²çªæ—¶å€¾å‘äºç†æ€§åˆ†æï¼Œé¿å…ç›´æ¥çš„æƒ…ç»ªå®£æ³„ã€‚\" })\n// æ›´æ–°æ ¸å¿ƒåŠ¨æœº\nmemory('global_lore.player_analysis.core_motivation', { \"primary\": \"Autonomy (è‡ªä¸»éœ€æ±‚)\", \"note\": \"ç©å®¶å¯¹çº¿æ€§å‰§æœ¬è¡¨ç°å‡ºæŠ—æ‹’ï¼Œæ›´å€¾å‘äºæ¢ç´¢å¼€æ”¾å¼åˆ†æ”¯ã€‚\" })\n\n// æ–°å¢æˆ–æ›´æ–°è£æ ¼åŸå‹\nmemory('global_lore.player_analysis.jungian_archetype', \"The Ruler (ç»Ÿæ²»è€… - ç§©åºä¸æŒæ§)\")\n\n// æ›´æ–°æ·±åº¦å¿ƒç†åˆ†æ\nmemory('global_lore.player_analysis.deep_psychology', { \"shadow\": \"åœ¨æç«¯å‹åŠ›ä¸‹è¡¨ç°å‡ºé©¬åŸºé›…ç»´åˆ©ä¸»ä¹‰å€¾å‘ (Ends justify means)ã€‚\", \"tone_preference\": \"Serious, Logical, Low-Fantasy.\" })\n\n// æ›´æ–°å¯¹AIçš„äº’åŠ¨ç­–ç•¥\nmemory('global_lore.player_analysis.strategy_for_ai', {\n   \"Narrative_Pacing\":\"æœ‰å¾®å¼±å›é¿å€¾å‘ï¼Œé‡‡ç”¨å¾ªåºæ¸è¿›ç­–ç•¥ï¼Œé¿å…è¿‡å¿«æ¨è¿›å…³ç³»å¯¼è‡´å‡ºæˆã€‚\" ,\n\"Agency_Balance\":\"æœ‰é«˜è‡ªä¸»éœ€æ±‚ï¼Œåº”å‡å°‘'å¿ƒç†æŒ‡å¼•'æå†™ï¼Œå¢åŠ ç¯å¢ƒäº’åŠ¨é€‰é¡¹ä¾›ç©å®¶å†³ç­–ã€‚\" ,\n\"Tone_Calibration\":\"ä¿æŒé€»è¾‘ä¸¥å¯†æ€§ï¼Œå‡å°‘æ— æ„ä¹‰çš„æ—¥å¸¸å–èŒï¼Œé‡ç‚¹åˆ»ç”»å‰§æƒ…çš„å› æœé€»è¾‘ã€‚\" \n})\n\n</Test_Psychodynamics>\n`);\n<%_\n        // 6. æ¸…ç©ºåˆ—è¡¨å˜é‡ï¼Œä¸ºä¸‹ä¸€è½®æ”¶é›†åšå‡†å¤‡\n            if (playerInputHistory.length === analysisTriggerCount + 1) {\n            setLocalVar('player_input_history', '[]');\n        }\n    }\n}\n%>\n<%_  \n}\n_%>","constant":true,"vectorized":false,"selective":true,"selectiveLogic":0,"addMemo":true,"order":100,"position":4,"disable":false,"excludeRecursion":false,"preventRecursion":false,"matchPersonaDescription":false,"matchCharacterDescription":false,"matchCharacterPersonality":false,"matchCharacterDepthPrompt":false,"matchScenario":false,"matchCreatorNotes":false,"delayUntilRecursion":false,"probability":100,"useProbability":true,"depth":0,"group":"","groupOverride":false,"groupWeight":100,"scanDepth":null,"caseSensitive":null,"matchWholeWords":null,"useGroupScoring":null,"automationId":"","role":0,"sticky":0,"cooldown":0,"delay":0,"triggers":[],"displayIndex":0,"characterFilter":{"isExclude":false,"names":[],"tags":[]}},"1":{"uid":1,"key":[],"keysecondary":[],"comment":"è‡ªç”±è®°å½•ç©å®¶æš´éœ²å‡ºæ¥çš„ä¿¡æ¯","content":"<%_  \n\nvar double_api= getLocalVar(\"double_api\")|| \"false\";\nvar batches = getLocalVar(\"batches\")|| 1;\n \nif(double_api ===\"false\" || (double_api === \"true\" && batches === 2) ){\n_%>\ngame.set('ç©å®¶ä¿¡æ¯è®°å½•',`\nä½ è¿˜éœ€è¦æ£€ç´¢æœ¬è½®ç©å®¶è¾“å…¥æš´éœ²äº†ç©å®¶çš„ä»€ä¹ˆä¿¡æ¯ï¼Ÿå¦‚ç™–å¥½ã€è¿‡å¾€ã€ä¹ æƒ¯ç­‰ï¼Œå¹¶å°†å…¶è®°å½•/æ›´æ–°/æˆ–åˆ é™¤è¿‡æ—¶ä¿¡æ¯ã€‚éœ€è¦å°†å…¶è®°å½•åœ¨'global_lore.player_analysis.ä¿¡æ¯è®°å½•'å­—æ®µä¸‹ï¼Œå¹¶ç¦æ­¢å’Œgame.memoryä¸­å·²è®°å½•çš„ä¿¡æ¯é‡å¤ã€ç¦æ­¢è¦†ç›–æ‰åŸæœ¬å·²è®°å½•çš„ä¿¡æ¯ã€‚è‹¥æœ¬è½®æœªæœ‰æ•ˆä¿¡æ¯ï¼Œåˆ™ä¸è®°å½•ã€‚\n`)\n<%_\n}\n_%>\n","constant":true,"vectorized":false,"selective":true,"selectiveLogic":0,"addMemo":true,"order":100,"position":4,"disable":false,"excludeRecursion":false,"preventRecursion":false,"matchPersonaDescription":false,"matchCharacterDescription":false,"matchCharacterPersonality":false,"matchCharacterDepthPrompt":false,"matchScenario":false,"matchCreatorNotes":false,"delayUntilRecursion":false,"probability":100,"useProbability":true,"depth":0,"group":"","groupOverride":false,"groupWeight":100,"scanDepth":null,"caseSensitive":null,"matchWholeWords":null,"useGroupScoring":null,"automationId":"","role":0,"sticky":0,"cooldown":0,"delay":0,"triggers":[],"displayIndex":0,"characterFilter":{"isExclude":false,"names":[],"tags":[]}},"3":{"uid":3,"displayIndex":1,"comment":"[bookmarkconfig]","disable":true,"constant":true,"selective":true,"key":[],"selectiveLogic":0,"keysecondary":[],"scanDepth":null,"vectorized":false,"position":0,"role":null,"depth":0,"order":1000,"content":"{\n  \"data-tab\": \"global_player_analysis\",\n  \"text\": \"ç©å®¶åˆ†æ\",\n  \"position\": 0\n}","useProbability":true,"probability":100,"excludeRecursion":false,"preventRecursion":false,"delayUntilRecursion":false,"sticky":0,"cooldown":0,"delay":0,"addMemo":true,"matchPersonaDescription":false,"matchCharacterDescription":false,"matchCharacterPersonality":false,"matchCharacterDepthPrompt":false,"matchScenario":false,"matchCreatorNotes":false,"group":"","groupOverride":false,"groupWeight":100,"caseSensitive":null,"matchWholeWords":null,"useGroupScoring":null,"automationId":"","triggers":[],"characterFilter":{"isExclude":false,"names":[],"tags":[]}},"4":{"uid":4,"displayIndex":2,"comment":"è®°å¿†-ç©å®¶åˆ†æå±•ç¤ºğŸ“•","disable":false,"constant":true,"selective":true,"key":[],"selectiveLogic":0,"keysecondary":[],"scanDepth":null,"vectorized":false,"position":1,"role":null,"depth":0,"order":100,"content":"<%_\n//å·¥å…·å‡½æ•°\nfunction getDataWithFallback(varName) {   \n    let data = getLocalVar(varName);\n    const isValid = (data) => {\n        if (data === null || data === undefined) {\n            return false;\n        }\n        if (typeof data === 'object' && data !== null) {\n            // å¦‚æœæ˜¯æ•°ç»„ï¼Œæ£€æŸ¥é•¿åº¦\n            if (Array.isArray(data)) {\n                return data.length > 0;\n            }\n            return Object.keys(data).length > 0;\n        }\n        return true;\n    };\n    if (!isValid(data)) {\n        data = getLocalVar(varName);\n    }\n    return data;\n}\n\nfunction formatObjectGraceSimple(data, indent = 0, isTopLevel = true, is_huanhang = true) {\n    if (typeof data !== 'object' || data === null) {\n        return JSON.stringify(data);\n    }\n    if (Array.isArray(data)) {\n        if (data.length === 0) return '[]'; \n        const items = data.map(item => formatObjectGraceSimple(item, indent + 1, false, is_huanhang));\n        return isTopLevel ? '[\\n' + items.join(',\\n') + '\\n]' : '[' + items.join(',') + ']';\n    }\n    const shouldFilter = data._filter === true || data._filter === 'true';\n    const showInEJS = data._showInEJS === false || data._showInEJS === 'false';\n    if (shouldFilter && showInEJS) {\n        return '\"[å·²éšè—]\"';\n    }\n    \n    const keys = Object.keys(data);\n    if (keys.length === 0) {\n        return '{}';\n    }\n    const visibleKeys = keys.filter(key => {\n        if (key.startsWith('_')) {\n            return false;\n        }\n        return true;\n    });\n    \n    if (visibleKeys.length === 0) {\n        return '{}';\n    }\n    const formattedLines = visibleKeys.map(key => {\n        let value = data[key];\n        \n        if (typeof value === 'object' && value !== null && !Array.isArray(value)) {\n            if (value._showInEJS === false || value._showInEJS === 'false') {\n                const shouldFilter = value._filter === true || value._filter === 'true';\n                if (!shouldFilter) {\n                    const valueString = formatObjectGraceSimple(value, indent + 1, false, is_huanhang);\n                    return `\"${key}\":${valueString}`;\n                } else {\n                    const isProtected = value._is_protected === true || value._is_protected === 'true';\n                    const protectionMark = isProtected ? ' //æ­¤å­—æ®µç¦æ­¢åˆ é™¤ï¼' : '';\n                    return `\"${key}\": \"[å·²éšè—]\"${protectionMark}`;\n                }\n            }\n            const valueString = formatObjectGraceSimple(value, indent + 1, false, is_huanhang);\n            return `\"${key}\":${valueString}`;\n        }\n        \n        const valueString = formatObjectGraceSimple(value, indent + 1, false, is_huanhang);\n        return `\"${key}\":${valueString}`;\n    });\n    \n    const isCurrentProtected = data._is_protected === true || data._is_protected === 'true';\n    const protectionMark = isCurrentProtected ? ' //æ­¤å­—æ®µç¦æ­¢åˆ é™¤ï¼' : '';\n    return isTopLevel \n        ? '{\\n' + formattedLines.join(',\\n') + '\\n}' + protectionMark\n        : '{' + formattedLines.join(',') + '}' + protectionMark;\n}\n\nfunction cleanObjectRecursively(obj) {\n    if (typeof obj !== 'object' || obj === null || Array.isArray(obj)) {\n        return obj;\n    }\n    const cleaned = {};\n    const allKeys = Object.keys(obj);\n    \n    for (let key of allKeys) {\n        if (key.startsWith('_')) {\n            continue;\n        }\n        const value = obj[key];\n        if (typeof value === 'object' && value !== null && !Array.isArray(value)) {\n            let rawShowValue = value._showInEJS;\n            if (rawShowValue === false || rawShowValue === 'false') {\n                const shouldFilter = value._filter === true || value._filter === 'true';\n                if (!shouldFilter) {\n                    cleaned[key] = cleanObjectRecursively(value);\n                } else {\n                    cleaned[key] = \"[å·²éšè—]\";\n                }\n                continue;\n            }\n            cleaned[key] = cleanObjectRecursively(value);\n        } else {\n            cleaned[key] = value;\n        }\n    }\n    return cleaned;\n}\n\nif (typeof assaData === 'undefined') {\n    var assaData = getDataWithFallback(\"assa_data\");\n}\n\n// è·å–æ•°æ®\nvar player_analysis_gikumc = formatObjectGraceSimple(_.get(assaData, 'global_lore.player_analysis', {}), 0, true, false);\n_%>\n\nmemory.load('global_lore.player_analysis', {\n    desc: \"å¯¹äºç©å®¶(<user>æ‰®æ¼”è€…)åŠå…¶<user>ä¿¡æ¯çš„åˆ†æå’Œè®°å½•ï¼Œä½ éœ€è¦åœ¨ç”Ÿæˆå†…å®¹æ—¶å‚è€ƒ\",\n    path: 'global_lore.player_analysis <%=player_analysis_gikumc%>'\n});","useProbability":true,"probability":100,"excludeRecursion":false,"preventRecursion":false,"delayUntilRecursion":false,"sticky":0,"cooldown":0,"delay":0,"addMemo":true,"matchPersonaDescription":false,"matchCharacterDescription":false,"matchCharacterPersonality":false,"matchCharacterDepthPrompt":false,"matchScenario":false,"matchCreatorNotes":false,"group":"","groupOverride":false,"groupWeight":100,"caseSensitive":null,"matchWholeWords":null,"useGroupScoring":null,"automationId":"","triggers":[],"characterFilter":{"isExclude":false,"names":[],"tags":[]}}}}