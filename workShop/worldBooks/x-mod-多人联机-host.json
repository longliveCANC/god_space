{"entries":{"0":{"uid":0,"key":[],"keysecondary":[],"comment":"ğŸ“•å…¶ä»–ç©å®¶ ","content":"<%_\n// 1. è·å–æ‰€æœ‰èŠå¤©å˜é‡\nconst allVars = await TavernHelper.getVariables({ type: 'chat' });\n\n// 2. ç­›é€‰å‡ºæ‰€æœ‰ä»¥ \"player_\" å¼€å¤´çš„å˜é‡ï¼Œå¹¶è¿‡æ»¤æ‰ \"player_role\"\nconst playerKeys = Object.keys(allVars).filter(key =>\n    key.startsWith('player_') && key !== 'player_role' && key !== 'player_rank'\n);\n\n// 3. æ„å»ºç©å®¶ä¿¡æ¯æ•°ç»„\nconst otherPlayers = playerKeys.map(key => {\n    // ä»é”®åä¸­æå–ç©å®¶åç§° (e.g., \"player_Alice\" -> \"Alice\")\n    const name = key.substring('player_'.length);\n    // è·å–è¯¥ç©å®¶çš„ç®€ä»‹å†…å®¹\n    const description = allVars[key] || 'æ— å¯ç”¨ä¿¡æ¯';\n\n    return {\n        name: name,\n        description: description\n    };\n});\n\n// 4. åªæœ‰åœ¨æ‰¾åˆ°å…¶ä»–ç©å®¶æ—¶ï¼Œæ‰è°ƒç”¨ game.setOtherPlayerBasicInfo\nif (otherPlayers.length > 0) {\n    // å°†ç©å®¶ä¿¡æ¯æ•°ç»„è½¬æ¢ä¸º JSON å­—ç¬¦ä¸²ï¼Œå¹¶ä¼ é€’ç»™å‡½æ•°\n_%>\ngame.loadOtherPlayersBasicInfo(<%- JSON.stringify(otherPlayers, null, 2) %>)\n<%_\n}\n_%>\n","constant":true,"vectorized":false,"selective":true,"selectiveLogic":0,"addMemo":true,"order":99999,"position":1,"disable":false,"excludeRecursion":false,"preventRecursion":false,"matchPersonaDescription":false,"matchCharacterDescription":false,"matchCharacterPersonality":false,"matchCharacterDepthPrompt":false,"matchScenario":false,"matchCreatorNotes":false,"delayUntilRecursion":false,"probability":100,"useProbability":true,"depth":4,"group":"","groupOverride":false,"groupWeight":100,"scanDepth":null,"caseSensitive":null,"matchWholeWords":null,"useGroupScoring":null,"automationId":"","role":null,"sticky":0,"cooldown":0,"delay":0,"triggers":[],"displayIndex":0,"characterFilter":{"isExclude":false,"names":[],"tags":[]}},"1":{"uid":1,"key":[],"keysecondary":[],"comment":"å¤šäººæ¸¸æˆè§„åˆ™","content":"game.set('å¤šäººæ¨¡å¼','\n1ã€æ¸¸æˆå°†ç”±å…¨éƒ¨ç©å®¶ä¸€èµ·æ¨åŠ¨ã€‚<user>åªæ˜¯ç©å®¶ä¹‹ä¸€,å…¶ä»–ç©å®¶çš„ä¿¡æ¯è§OtherPlayersBasicInfoã€‚æ¯ä¸ªç©å®¶çš„è¡ŒåŠ¨éƒ½æœ‰è‡ªå·±çš„è§†è§’ï¼Œç¦æ­¢åªèšç„¦<user>å•ä¸ªç©å®¶è§†è§’ã€‚è‹¥ä¸€èµ·è¡ŒåŠ¨ï¼Œåˆ™ä¸€èµ·æè¿°ï¼›è‹¥åˆ†å¤´è¡ŒåŠ¨ï¼Œåˆ™å¿…é¡»å¹³è¡Œæè¿°ã€‚\n2ã€ä½ åœ¨è¾“å‡ºå†…å®¹æ—¶å¿…é¡»æ³¨æ„ç©å®¶å’Œç©å®¶ä¹‹é—´çš„è¡ŒåŠ¨ä¼šå¯¹è¿™ä¸ªä¸–ç•Œé€ æˆçš„å½±å“ï¼Œæˆ–è€…å½¼æ­¤çš„äº’åŠ¨ç­‰ã€‚\n3ã€äººç§°å¿…é¡»ä½¿ç”¨ç¬¬ä¸‰äººç§°ã€‚\n')","constant":true,"vectorized":false,"selective":true,"selectiveLogic":0,"addMemo":true,"order":1,"position":0,"disable":false,"excludeRecursion":false,"preventRecursion":false,"matchPersonaDescription":false,"matchCharacterDescription":false,"matchCharacterPersonality":false,"matchCharacterDepthPrompt":false,"matchScenario":false,"matchCreatorNotes":false,"delayUntilRecursion":false,"probability":100,"useProbability":true,"depth":0,"group":"","groupOverride":false,"groupWeight":100,"scanDepth":null,"caseSensitive":null,"matchWholeWords":null,"useGroupScoring":null,"automationId":"","role":null,"sticky":0,"cooldown":0,"delay":0,"triggers":[],"displayIndex":0,"characterFilter":{"isExclude":false,"names":[],"tags":[]}},"2":{"uid":2,"key":[],"keysecondary":[],"comment":"ğŸ“•ä¸»ä¿¡æ¯è°ƒæ•´-å»é™¤èƒŒåŒ…æŠ€èƒ½å’Œé˜Ÿå‹","content":" <%_\n \nvar if_status_analyze = \"true\";\n    function getDataWithFallback(varName) {\n \n        let data = getLocalVar(varName);\n       \n        // å†…è”æ•°æ®éªŒè¯ï¼šæ£€æŸ¥æ˜¯å¦ä¸ºnullã€undefinedï¼Œä¸”å¦‚æœæ˜¯å¯¹è±¡è¦æœ‰å†…å®¹\n        const isValid = (data) => {\n            // æ£€æŸ¥æ˜¯å¦ä¸º null æˆ– undefined\n            if (data === null || data === undefined) {\n                return false;\n            }\n            \n            // å¦‚æœæ˜¯å¯¹è±¡ç±»å‹ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰å†…å®¹\n            if (typeof data === 'object' && data !== null) {\n                // å¦‚æœæ˜¯æ•°ç»„ï¼Œæ£€æŸ¥é•¿åº¦\n                if (Array.isArray(data)) {\n                    return data.length > 0;\n                }\n                // å¦‚æœæ˜¯æ™®é€šå¯¹è±¡ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰å±æ€§\n                return Object.keys(data).length > 0;\n            }\n            \n            // å…¶ä»–ç±»å‹ï¼ˆå­—ç¬¦ä¸²ã€æ•°å­—ã€å¸ƒå°”å€¼ç­‰ï¼‰åªè¦ä¸æ˜¯ null/undefined å°±è®¤ä¸ºæœ‰æ•ˆ\n            return true;\n        };\n        \n        // å¦‚æœæ•°æ®ä¸ç¬¦åˆè¦æ±‚ï¼Œä» getLocalVar è·å–\n        if (!isValid(data)) {\n            data = getLocalVar(varName);\n        }\n\n // å¦‚æœè¿˜æ˜¯æ— æ•ˆï¼Œè¿”å›ç©ºå¯¹è±¡ä½œä¸ºé»˜è®¤å€¼\n    if (!isValid(data)) {\n        data = {};\n    }\n        \n        return data;\n    }\nfunction formatObjectGracefully(data, indent = 0) {\n  if (typeof data !== 'object' || data === null) {\n    return JSON.stringify(data);\n  }\n  \n  if (Array.isArray(data)) {\n    if (data.length === 0) return '[]';\n    \n    const items = data.map(item => {\n      const formatted = formatObjectGracefully(item, indent + 1);\n      return ' '.repeat((indent + 1) * 2) + formatted;\n    });\n    \n    return '[\\n' + items.join(',\\n') + '\\n' + ' '.repeat(indent * 2) + ']';\n  }\n  \n  // ğŸ”§ æ£€æŸ¥å¯¹è±¡è‡ªèº«çš„ _showInEJS\n// ğŸ”§ æ£€æŸ¥å¯¹è±¡è‡ªèº«çš„ _showInEJS å’Œ _filter\nconst shouldFilter = data._filter === true || data._filter === 'true';\nconst showInEJS = data._showInEJS === false || data._showInEJS === 'false';\n\n// åªæœ‰ _filter ä¸º true ä¸” _showInEJS ä¸º false æ—¶æ‰éšè—\nif (shouldFilter && showInEJS) {\n \n  return '\"[å·²éšè—]\"';\n}\n  \n  const keys = Object.keys(data);\n  if (keys.length === 0) {\n    return '{}';\n  }\n  \n  // è¿‡æ»¤å‡ºéœ€è¦æ˜¾ç¤ºçš„é”®\n  const visibleKeys = keys.filter(key => {\n    if (key.startsWith('_')) {\n      return false;\n    }\n    return true;\n  });\n  \n  if (visibleKeys.length === 0) {\n    return '{}';\n  }\nconst formattedLines = visibleKeys.map(key => {\n  let value = data[key];\n  \n  // å¦‚æœå€¼æ˜¯å¯¹è±¡ï¼Œéœ€è¦é€’å½’å¤„ç†\n  if (typeof value === 'object' && value !== null && !Array.isArray(value)) {\n    // ğŸ”§ å…ˆæ£€æŸ¥å­å¯¹è±¡æ˜¯å¦è¢«éšè—\n    if (value._showInEJS === false || value._showInEJS === 'false') {\n      // æ£€æŸ¥ _filter å­—æ®µï¼Œé»˜è®¤ä¸º false\n      const shouldFilter = value._filter === true || value._filter === 'true';\n      if (!shouldFilter) {\n        // _filter ä¸º false æˆ–ä¸å­˜åœ¨ï¼Œç»§ç»­æ˜¾ç¤º\n        const valueString = formatObjectGracefully(value, indent + 1);\n        // âŒ åˆ é™¤ä¿æŠ¤æ ‡è®°ï¼Œè®©é€’å½’å†…éƒ¨å¤„ç†\n        return ''.repeat((indent + 1) * 2) + `\"${key}\":${valueString}`;\n      } else {\n        // _filter ä¸º trueï¼Œç»§ç»­éšè—\n       \n        const isProtected = value._is_protected === true || value._is_protected === 'true';\n        const protectionMark = isProtected ? ' //æ­¤å­—æ®µç¦æ­¢åˆ é™¤ï¼' : '';\n \n        return ''.repeat((indent + 1) * 2) + `\"${key}\": \"[å·²éšè—]\"${protectionMark}`;\n      }\n    }\n    // âŒ åˆ é™¤ä¿æŠ¤æ ‡è®°ï¼Œè®©é€’å½’å†…éƒ¨å¤„ç†\n    const valueString = formatObjectGracefully(value, indent + 1);\n    return ''.repeat((indent + 1) * 2) + `\"${key}\":${valueString}`;\n  }\n  \n  const valueString = formatObjectGracefully(value, indent + 1);\n  return ''.repeat((indent + 1) * 2) + `\"${key}\":${valueString}`;\n});\n  \nconst isCurrentProtected = data._is_protected === true || data._is_protected === 'true';\nconst protectionMark = isCurrentProtected ? ' //æ­¤å­—æ®µç¦æ­¢åˆ é™¤ï¼' : '';\n\nreturn '{\\n' + formattedLines.join(',\\n') + '\\n' + ' '.repeat(indent * 2) + '}' + protectionMark;\n}\n \n  function formatObjectGraceSimple(data, indent = 0, is_huanhang = true) {\n    // å¦‚æœä¸æ˜¯å¯¹è±¡ï¼Œç›´æ¥è¿”å›JSONå­—ç¬¦ä¸²\n    if (typeof data !== 'object' || data === null) {\n        return JSON.stringify(data);\n    }\n\n    // å®šä¹‰ç¼©è¿›å­—ç¬¦ä¸²\n    const indentString = '';\n    const nextIndentString ='';\n    // --- å¤„ç†æ•°ç»„ ---\n    if (Array.isArray(data)) {\n        if (data.length === 0) return '[]';\n\n        // å¦‚æœä¸éœ€è¦é€’å½’æ¢è¡Œï¼Œåˆ™å°†æ•°ç»„å…ƒç´ åœ¨ä¸€è¡Œå†…æ˜¾ç¤º\n        if (!is_huanhang) {\n            const items = data.map(item => formatObjectGraceSimple(item, 0, false));\n            return '[' + items.join(',') + ']';\n        }\n\n        // é€’å½’æ ¼å¼åŒ–æ•°ç»„çš„æ¯ä¸€é¡¹\n        const items = data.map(item =>\n            nextIndentString + formatObjectGraceSimple(item, indent + 1, is_huanhang)\n        );\n        \n        return '[\\n' + items.join(',\\n') + '\\n' + indentString + ']';\n    }\n\n    // --- å¤„ç†å¯¹è±¡ ---\n    // æ ¹æ®_filterå’Œ_showInEJSå±æ€§åˆ¤æ–­æ˜¯å¦éšè—\n    const shouldFilter = data._filter === true || data._filter === 'true';\n    const showInEJS = data._showInEJS === false || data._showInEJS === 'false';\n    if (shouldFilter && showInEJS) {\n        return '\"[å·²éšè—]\"';\n    }\n\n    // è¿‡æ»¤æ‰ä»¥ä¸‹åˆ’çº¿å¼€å¤´çš„é”®\n    const keys = Object.keys(data).filter(key => !key.startsWith('_'));\n    if (keys.length === 0) return '{}';\n\n    // æ ¼å¼åŒ–å¯¹è±¡çš„æ¯ä¸ªé”®å€¼å¯¹\n    const formattedLines = keys.map(key => {\n        let value = data[key];\n        let valueString;\n\n        // ç‰¹æ®Šå¤„ç†éœ€è¦éšè—çš„å­å¯¹è±¡\n        if (typeof value === 'object' && value !== null && !Array.isArray(value)) {\n            if (value._showInEJS === false || value._showInEJS === 'false') {\n                if (value._filter === true || value._filter === 'true') {\n                    const isProtected = value._is_protected === true || value._is_protected === 'true';\n                    const protectionMark = isProtected ? ' //æ­¤å­—æ®µç¦æ­¢åˆ é™¤ï¼' : '';\n                    valueString = '\"[å·²éšè—]\"' + protectionMark;\n                } else {\n                    valueString = formatObjectGraceSimple(value, indent + 1, is_huanhang);\n                }\n            } else {\n                valueString = formatObjectGraceSimple(value, indent + 1, is_huanhang);\n            }\n        } else {\n            valueString = formatObjectGraceSimple(value, indent + 1, is_huanhang);\n        }\n\n        // å¦‚æœä¸éœ€è¦é€’å½’æ¢è¡Œï¼Œåˆ™é”®å’Œå€¼åœ¨ä¸€è¡Œ\n        if (!is_huanhang) {\n            return `\"${key}\":${valueString}`;\n        }\n\n        // å¦åˆ™ï¼Œé”®å’Œå€¼åœ¨æ–°è¡Œå¹¶å¸¦ç¼©è¿›\n        return `${nextIndentString}\"${key}\":${valueString}`;\n    });\n\n    // è·å–å½“å‰å¯¹è±¡çš„ä¿æŠ¤æ ‡è®°\n    const isCurrentProtected = data._is_protected === true || data._is_protected === 'true';\n    const protectionMark = isCurrentProtected ? ' //æ­¤å­—æ®µç¦æ­¢åˆ é™¤ï¼' : '';\n\n    // å¦‚æœä¸éœ€è¦é€’å½’æ¢è¡Œï¼Œåˆ™å°†æ‰€æœ‰é”®å€¼å¯¹æ‹¼æ¥åœ¨ä¸€è¡Œ\n    if (!is_huanhang) {\n        // å¯¹äºé¡¶å±‚è°ƒç”¨ï¼Œè¿˜æ˜¯éœ€è¦æ¢è¡Œ\n        if (indent === 0) {\n              \n             return '{\\n' + formattedLines.map(line => nextIndentString + line).join(',\\n') + '\\n}' + protectionMark;\n        }\n        return '{' + formattedLines.join(',') + '}' + protectionMark;\n    }\n \n    return '{\\n' + formattedLines.join(',\\n') + '\\n' + indentString + '}' + protectionMark;\n}\n\nfunction cleanObjectRecursively(obj) {\n    if (typeof obj !== 'object' || obj === null || Array.isArray(obj)) {\n        return obj;\n    }\n    const cleaned = {};\n    const allKeys = Object.keys(obj);\n\n    for (let key of allKeys) {\n        if (key.startsWith('_')) {\n            continue;\n        }\n        const value = obj[key];\n        if (typeof value === 'object' && value !== null && !Array.isArray(value)) {\n            let rawShowValue = value._showInEJS;\n            if (rawShowValue === false || rawShowValue === 'false') {\n                const shouldFilter = value._filter === true || value._filter === 'true';\n                if (!shouldFilter) {\n                    cleaned[key] = cleanObjectRecursively(value);\n                } else {\n                    cleaned[key] = \"[å·²éšè—]\";\n                }\n                continue;\n            }\n            cleaned[key] = cleanObjectRecursively(value);\n        } else {\n            cleaned[key] = value;\n        }\n    }\n    return cleaned;\n}\n \nif (typeof version === 'undefined') {\n    var version = Number(getLocalVar(\"world_version\", 1));\n}\nif (typeof EvStat === 'undefined') {\n    var EvStat = getDataWithFallback(\"stat_data\");\n}\nif (typeof assaData === 'undefined') {\n    var  assaData = getDataWithFallback(\"assa_data\");\n}\nif (typeof characterData === 'undefined') {\n    var characterData = getDataWithFallback(\"play_character_data\");\n}\nvar if_comlex_battle = getLocalVar(\"complex_battle\",\"false\");\n \nvar world_level = _.get(EvStat, 'world.level', 'ä¸­é­”')[0];\nvar world_level_describe = '';\nvar levels = '';\nvar world_max_enegy = 3;\nif (world_level === 'æ— ') {\n    world_max_enegy = 3;\n    world_level_describe = 'æ™®é€šä¸–ç•Œ';\n    levels = `\n        \"1\": \"æ— é£é™©/æ—¥å¸¸æƒ…å†µ\",\n        \"2\": \"è½»å¾®å‡¡äººå±æœºï¼ˆå°åŠ¨ç‰©æ”»å‡»ã€ç¤¾äº¤å›°å¢ƒï¼‰\",\n        \"3\": \"ä¸¥é‡å‡¡äººå±æœºï¼ˆé‡ä¼¤/æ­»äº¡ã€ä¸¥é‡ç¯å¢ƒå±é™©ï¼‰\"\n    `;\n} else if (world_level === 'ä½') {\n    world_max_enegy = 5;\n    world_level_describe = 'å¦‚é‡‘åº¸æ­¦ä¾ ä¸–ç•Œï¼Œå‡¡äººç•Œé¢ï¼Œæ™®é€šç‰©ç†è§„åˆ™';\n    levels = `\n        \"1\": \"æ— é£é™©/æ—¥å¸¸æƒ…å†µ\",\n        \"2\": \"è½»å¾®å‡¡äººå±æœºï¼ˆå°åŠ¨ç‰©æ”»å‡»ã€ç¤¾äº¤å›°å¢ƒï¼‰\",\n        \"3\": \"ä¸¥é‡å‡¡äººå±æœºï¼ˆé‡ä¼¤/æ­»äº¡ã€ä¸¥é‡ç¯å¢ƒå±é™©ï¼‰\",\n        \"4-5\": \"åŸºç¡€è¶…å‡¡å±æœºï¼ˆè¢«åŠ¨è¶…å‡¡ç°è±¡ï¼Œå±€é™äºä¸ªä½“/å°èŒƒå›´ï¼Œæ™®é€šäººå¯åº”å¯¹ï¼‰\"\n    `;\n} else if (world_level === 'ä¸­') {\n    world_max_enegy = 7;\n    world_level_describe = 'å­˜åœ¨ä¸€å®šè¶…å‡¡åŠ›é‡ï¼Œå½±å“æœ‰é™èŒƒå›´';\n    levels = `\n        \"1\": \"æ— é£é™©/æ—¥å¸¸æƒ…å†µ\",\n        \"2\": \"è½»å¾®å‡¡äººå±æœºï¼ˆå°åŠ¨ç‰©æ”»å‡»ã€ç¤¾äº¤å›°å¢ƒï¼‰\",\n        \"3\": \"ä¸¥é‡å‡¡äººå±æœºï¼ˆé‡ä¼¤/æ­»äº¡ã€ä¸¥é‡ç¯å¢ƒå±é™©ï¼‰\",\n        \"4-5\": \"åŸºç¡€è¶…å‡¡å±æœºï¼ˆè¢«åŠ¨è¶…å‡¡ç°è±¡ï¼Œå±€é™äºä¸ªä½“/å°èŒƒå›´ï¼Œæ™®é€šäººå¯åº”å¯¹ï¼‰\",\n        \"6-7\": \"è¿›é˜¶è¶…å‡¡å±æœºï¼ˆä¸»åŠ¨è¶…å‡¡æ”»å‡»ï¼Œå¨èƒè¾ƒå¤§èŒƒå›´ï¼Œéœ€ä¸“ä¸šè¶…å‡¡åŠ›é‡ï¼‰\"\n    `;\n} else if (world_level === 'é«˜') {\n    world_max_enegy = 12;\n    world_level_describe = 'å¼ºå¤§è¶…å‡¡åŠ›é‡ï¼ŒåŒºåŸŸæ€§ç°å®æ‰­æ›²';\n    levels = `\n        \"1\": \"æ— é£é™©/æ—¥å¸¸æƒ…å†µ\",\n        \"2\": \"è½»å¾®å‡¡äººå±æœºï¼ˆå°åŠ¨ç‰©æ”»å‡»ã€ç¤¾äº¤å›°å¢ƒï¼‰\",\n        \"3\": \"ä¸¥é‡å‡¡äººå±æœºï¼ˆé‡ä¼¤/æ­»äº¡ã€ä¸¥é‡ç¯å¢ƒå±é™©ï¼‰\",\n        \"4-5\": \"åŸºç¡€è¶…å‡¡å±æœºï¼ˆè¢«åŠ¨è¶…å‡¡ç°è±¡ï¼Œå±€é™äºä¸ªä½“/å°èŒƒå›´ï¼Œæ™®é€šäººå¯åº”å¯¹ï¼‰\",\n        \"6-7\": \"è¿›é˜¶è¶…å‡¡å±æœºï¼ˆä¸»åŠ¨è¶…å‡¡æ”»å‡»ï¼Œå¨èƒè¾ƒå¤§èŒƒå›´ï¼Œéœ€ä¸“ä¸šè¶…å‡¡åŠ›é‡ï¼‰\",\n        \"8-12\": \"ç¥æ˜è§„åˆ™çº§å±æœºï¼ˆç¥æ˜å¹²é¢„ã€ä¸–ç•Œè§„åˆ™æ‰­æ›²ï¼‰\"\n    `;\n} else if (world_level === 'ç¥è¯') {\n    world_max_enegy = 16;\n    world_level_describe = 'ç¥æ˜æˆ–å®‡å®™çº§åŠ›é‡ï¼Œè§„åˆ™å½»åº•æ‰­æ›²';\n    levels = `\n        \"1\": \"æ— é£é™©/æ—¥å¸¸æƒ…å†µ\",\n        \"2\": \"è½»å¾®å‡¡äººå±æœºï¼ˆå°åŠ¨ç‰©æ”»å‡»ã€ç¤¾äº¤å›°å¢ƒï¼‰\",\n        \"3\": \"ä¸¥é‡å‡¡äººå±æœºï¼ˆé‡ä¼¤/æ­»äº¡ã€ä¸¥é‡ç¯å¢ƒå±é™©ï¼‰\",\n        \"4-5\": \"åŸºç¡€è¶…å‡¡å±æœºï¼ˆè¢«åŠ¨è¶…å‡¡ç°è±¡ï¼Œå±€é™äºä¸ªä½“/å°èŒƒå›´ï¼Œæ™®é€šäººå¯åº”å¯¹ï¼‰\",\n        \"6-7\": \"è¿›é˜¶è¶…å‡¡å±æœºï¼ˆä¸»åŠ¨è¶…å‡¡æ”»å‡»ï¼Œå¨èƒè¾ƒå¤§èŒƒå›´ï¼Œéœ€ä¸“ä¸šè¶…å‡¡åŠ›é‡ï¼‰\",\n        \"8-12\": \"ç¥æ˜è§„åˆ™çº§å±æœºï¼ˆç¥æ˜å¹²é¢„ã€ä¸–ç•Œè§„åˆ™æ‰­æ›²ï¼‰\",\n        \"13-16\": \"æœ¬æºå®‡å®™çº§å±æœºï¼ˆå®‡å®™è§„åˆ™å´©åã€å­˜åœ¨å¨èƒï¼‰\"\n    `;\n} else {\n    world_max_enegy = 7;\n    world_level_describe = 'å­˜åœ¨ä¸€å®šè¶…å‡¡åŠ›é‡ï¼Œå½±å“æœ‰é™èŒƒå›´';\n    levels = `\n        \"1\": \"æ— é£é™©/æ—¥å¸¸æƒ…å†µ\",\n        \"2\": \"è½»å¾®å‡¡äººå±æœºï¼ˆå°åŠ¨ç‰©æ”»å‡»ã€ç¤¾äº¤å›°å¢ƒï¼‰\",\n        \"3\": \"ä¸¥é‡å‡¡äººå±æœºï¼ˆé‡ä¼¤/æ­»äº¡ã€ä¸¥é‡ç¯å¢ƒå±é™©ï¼‰\",\n        \"4-5\": \"åŸºç¡€è¶…å‡¡å±æœºï¼ˆè¢«åŠ¨è¶…å‡¡ç°è±¡ï¼Œå±€é™äºä¸ªä½“/å°èŒƒå›´ï¼Œæ™®é€šäººå¯åº”å¯¹ï¼‰\",\n        \"6-7\": \"è¿›é˜¶è¶…å‡¡å±æœºï¼ˆä¸»åŠ¨è¶…å‡¡æ”»å‡»ï¼Œå¨èƒè¾ƒå¤§èŒƒå›´ï¼Œéœ€ä¸“ä¸šè¶…å‡¡åŠ›é‡ï¼‰\"\n    `;\n}\n\nvar if_scan_memory= getLocalVar(\"if_scan_memory\", \"false\");\nif (if_scan_memory === \"true\") { \n  \n    // æ·±æ‹·è´å‡½æ•°\n    function deepClone(obj) {\n      if (obj === null || typeof obj !== 'object') {\n        return obj;\n      }\n      \n      if (Array.isArray(obj)) {\n        return obj.map(item => deepClone(item));\n      }\n      \n      const cloned = {};\n      for (let key in obj) {\n        if (obj.hasOwnProperty(key)) {\n          cloned[key] = deepClone(obj[key]);\n        }\n      }\n      return cloned;\n    }\n    \n    // é€’å½’å‡½æ•°:æ·±åº¦éå†å¹¶åˆ é™¤å…³é”®è®°å¿†å­—æ®µ\n    function deleteMemoryFields(obj) {\n      if (typeof obj !== 'object' || obj === null) {\n        return;\n      }\n      \n      // å¦‚æœæ˜¯æ•°ç»„,éå†æ•°ç»„å…ƒç´ \n      if (Array.isArray(obj)) {\n        obj.forEach(item => deleteMemoryFields(item));\n        return;\n      }\n      \n      // éå†å¯¹è±¡çš„æ‰€æœ‰é”®\n      for (let key in obj) {\n        if (obj.hasOwnProperty(key)) {\n          // å¦‚æœå½“å‰é”®æ˜¯\"å…³é”®è®°å¿†\",åˆ é™¤å®ƒ\n          if (key === 'å…³é”®è®°å¿†') {\n            delete obj[key];\n          } else {\n            // é€’å½’å¤„ç†å­å¯¹è±¡\n            deleteMemoryFields(obj[key]);\n          }\n        }\n      }\n    }\n    \n    // å…ˆæ·±æ‹·è´,å†åˆ é™¤å­—æ®µ\n    assaData = deepClone(assaData);\n    deleteMemoryFields(assaData);\n   \n  }\n\nvar things = formatObjectGraceSimple(_.get(assaData, 'global_lore.å¤‡å¿˜å½•', ''), 0, true, false);\nconst global_lore_npc = formatObjectGraceSimple(_.get(assaData, 'global_lore.npc', ''), 0, false);\nconst world_lore_npc = formatObjectGraceSimple(_.get(assaData, 'world_lore.npc', ''), 0, false);\nconst global_lore_settings = formatObjectGraceSimple(_.get(assaData, 'global_lore.settings', ''), 0, false);\n \nconst world_lore_settings = formatObjectGraceSimple(_.get(assaData, 'world_lore.settings', ''), 0, false, false);\n\nvar plotFull = _.get(assaData, 'plot', {});\n \n \n \nplotFull  = formatObjectGracefully(plotFull);\n\nvar currency_point = _.get(characterData, 'è´§å¸.ç§¯åˆ†[0]', 0);\nvar currency_zhixian = JSON.stringify(_.get(characterData, 'è´§å¸.æ”¯çº¿å‰§æƒ…', ''));\nvar currency_xp = _.get(characterData, 'è´§å¸.ç»éªŒå€¼[0]', 0);\nvar energy_pool = JSON.stringify(_.get(characterData, 'è¡ç”Ÿå±æ€§.èƒ½é‡æ± ', ''));\nvar energy_pool_2 = JSON.stringify(_.get(characterData, 'èƒ½åŠ›æ®µ', ''));\nconst attr_strength = _.get(characterData, 'åŸºç¡€å±æ€§.ç”Ÿç†å±æ€§.åŠ›é‡.åŸºç¡€[0]', 0);\nconst attr_agility = _.get(characterData, 'åŸºç¡€å±æ€§.ç”Ÿç†å±æ€§.æ•æ·.åŸºç¡€[0]', 0);\nconst attr_endurance = _.get(characterData, 'åŸºç¡€å±æ€§.ç”Ÿç†å±æ€§.è€åŠ›.åŸºç¡€[0]', 0);\nconst attr_intelligence = _.get(characterData, 'åŸºç¡€å±æ€§.å¿ƒæ™ºå±æ€§.æ™ºåŠ›.åŸºç¡€[0]', 0);\nconst attr_perception = _.get(characterData, 'åŸºç¡€å±æ€§.å¿ƒæ™ºå±æ€§.æ„ŸçŸ¥.åŸºç¡€[0]', 0);\nconst attr_resolve = _.get(characterData, 'åŸºç¡€å±æ€§.å¿ƒæ™ºå±æ€§.å†³å¿ƒ.åŸºç¡€[0]', 0);\nconst attr_charisma = _.get(characterData, 'åŸºç¡€å±æ€§.äº’åŠ¨å±æ€§.é£åº¦.åŸºç¡€[0]', 0);\nconst attr_manipulation = _.get(characterData, 'åŸºç¡€å±æ€§.äº’åŠ¨å±æ€§.æ“æ§.åŸºç¡€[0]', 0);\nconst attr_composure = _.get(characterData, 'åŸºç¡€å±æ€§.äº’åŠ¨å±æ€§.æ²‰ç€.åŸºç¡€[0]', 0);\nconst skill_athletics = _.get(characterData, 'åŸºç¡€æŠ€èƒ½.ç”Ÿç†æŠ€èƒ½.è¿åŠ¨[0]', 0);\nconst skill_brawl = _.get(characterData, 'åŸºç¡€æŠ€èƒ½.ç”Ÿç†æŠ€èƒ½.è‚‰æ[0]', 0);\nconst skill_drive = _.get(characterData, 'åŸºç¡€æŠ€èƒ½.ç”Ÿç†æŠ€èƒ½.é©¾é©¶[0]', 0);\nconst skill_firearms = _.get(characterData, 'åŸºç¡€æŠ€èƒ½.ç”Ÿç†æŠ€èƒ½.æªæ¢°[0]', 0);\nconst skill_larceny = _.get(characterData, 'åŸºç¡€æŠ€èƒ½.ç”Ÿç†æŠ€èƒ½.æ‰‹ä¸ŠåŠŸå¤«[0]', 0);\nconst skill_stealth = _.get(characterData, 'åŸºç¡€æŠ€èƒ½.ç”Ÿç†æŠ€èƒ½.éšè—[0]', 0);\nconst skill_survival = _.get(characterData, 'åŸºç¡€æŠ€èƒ½.ç”Ÿç†æŠ€èƒ½.æ±‚ç”Ÿ[0]', 0);\nconst skill_weaponry = _.get(characterData, 'åŸºç¡€æŠ€èƒ½.ç”Ÿç†æŠ€èƒ½.ç™½åˆƒ[0]', 0);\nconst skill_archery = _.get(characterData, 'åŸºç¡€æŠ€èƒ½.ç”Ÿç†æŠ€èƒ½.å¼“ç®­[0]', 0);\nconst skill_academics = _.get(characterData, 'åŸºç¡€æŠ€èƒ½.å¿ƒæ™ºæŠ€èƒ½.å­¦è¯†[0]', 0);\nconst skill_computer = _.get(characterData, 'åŸºç¡€æŠ€èƒ½.å¿ƒæ™ºæŠ€èƒ½.ç”µè„‘[0]', 0);\nconst skill_crafts = _.get(characterData, 'åŸºç¡€æŠ€èƒ½.å¿ƒæ™ºæŠ€èƒ½.æ‰‹è‰º[0]', 0);\nconst skill_investigation = _.get(characterData, 'åŸºç¡€æŠ€èƒ½.å¿ƒæ™ºæŠ€èƒ½.è°ƒæŸ¥[0]', 0);\nconst skill_medicine = _.get(characterData, 'åŸºç¡€æŠ€èƒ½.å¿ƒæ™ºæŠ€èƒ½.åŒ»å­¦[0]', 0);\nconst skill_occult = _.get(characterData, 'åŸºç¡€æŠ€èƒ½.å¿ƒæ™ºæŠ€èƒ½.ç¥ç§˜å­¦[0]', 0);\nconst skill_science = _.get(characterData, 'åŸºç¡€æŠ€èƒ½.å¿ƒæ™ºæŠ€èƒ½.ç§‘å­¦[0]', 0);\nconst skill_animal_ken = _.get(characterData, 'åŸºç¡€æŠ€èƒ½.äº’åŠ¨æŠ€èƒ½.åŠ¨ç‰©æ²Ÿé€š[0]', 0);\nconst skill_empathy = _.get(characterData, 'åŸºç¡€æŠ€èƒ½.äº’åŠ¨æŠ€èƒ½.æ„Ÿå—[0]', 0);\nconst skill_expression = _.get(characterData, 'åŸºç¡€æŠ€èƒ½.äº’åŠ¨æŠ€èƒ½.è¡¨è¾¾[0]', 0);\nconst skill_intimidation = _.get(characterData, 'åŸºç¡€æŠ€èƒ½.äº’åŠ¨æŠ€èƒ½.èƒè¿«[0]', 0);\nconst skill_persuasion = _.get(characterData, 'åŸºç¡€æŠ€èƒ½.äº’åŠ¨æŠ€èƒ½.äº¤é™…[0]', 0);\nconst skill_subterfuge = _.get(characterData, 'åŸºç¡€æŠ€èƒ½.äº’åŠ¨æŠ€èƒ½.æ©é¥°[0]', 0);\nvar defense_impact = _.get(characterData, 'è¡ç”Ÿå±æ€§.é˜²å¾¡.ä¼¤å®³å‡å….å†²å‡»[0]', 0);\nvar defense_lethal = _.get(characterData, 'è¡ç”Ÿå±æ€§.é˜²å¾¡.ä¼¤å®³å‡å….è‡´å‘½[0]', 0);\nvar defense_aggravated = _.get(characterData, 'è¡ç”Ÿå±æ€§.é˜²å¾¡.ä¼¤å®³å‡å….æ¶æ€§[0]', 0);\nvar save_fortitude = _.get(characterData, 'è¡ç”Ÿå±æ€§.è±å…æ£€å®šåŸºç¡€.å¼ºéŸ§[0]', 0);\nvar save_reflex = _.get(characterData, 'è¡ç”Ÿå±æ€§.è±å…æ£€å®šåŸºç¡€.åå°„[0]', 0);\nvar save_will = _.get(characterData, 'è¡ç”Ÿå±æ€§.è±å…æ£€å®šåŸºç¡€.æ„å¿—[0]', 0);\nvar speed = _.get(characterData, 'è¡ç”Ÿå±æ€§.é€Ÿåº¦.åŸºç¡€é€Ÿåº¦[0]', 0);\nvar initiative = _.get(characterData, 'è¡ç”Ÿå±æ€§.å…ˆæ”»[0]', 0);\nvar world_role = getLocalVar(\"world_role\", \"\");\nvar player_role = getLocalVar(\"player_role\", \"è½®å›è€…\");\nvar tier_role = getLocalVar(\"tier_role\", \"\");\nvar profession_role = getLocalVar(\"profession_role\", \"\");\nvar point_role = getLocalVar(\"point_role\", \"\");\nvar zhixian_role = getLocalVar(\"zhixian_role\", \"\");\nvar xp_role = getLocalVar(\"xp_role\", \"\");\nvar the_created = _.get(EvStat, 'the_created.name[0]', \"\");\nvar if_dice_use = getLocalVar(\"dice_use\",\"false\");\nvar if_attribute_use = getLocalVar(\"attribute_use\")|| \"true\";\n//var if_attribute_use = \"true\";\nvar if_lock= getLocalVar(\"created_lock\", \"false\");\nvar if_plot = getLocalVar(\"assa_plot_push\", \"false\");\n\nvar is_sth_hide ='true';\n// å½“if_lockä¸ºtrueæ—¶ï¼Œç§»é™¤é€ ç‰©\n \n    // æ·±æ‹·è´æ•°æ®ä»¥é¿å…ä¿®æ”¹åŸå§‹æ•°æ®\n    EvStat = JSON.parse(JSON.stringify(EvStat));\n \n    // ç§»é™¤stat_dataä¸­çš„current_lust\n    if (EvStat && EvStat.the_created) {\n        delete EvStat.the_created;\n    }\n \n\n if (if_comlex_battle === \"true\") {\n    // æ·±æ‹·è´æ•°æ®ä»¥é¿å…ä¿®æ”¹åŸå§‹æ•°æ®\n \n    // ç§»é™¤stat_dataä¸­çš„current_lust\n    if (EvStat && EvStat.æ•Œæ–¹æ£€å®šéª°æ± ) {\n        delete EvStat.æ•Œæ–¹æ£€å®šéª°æ± ;\n    }\n}\n\nvar if_bg= getLocalVar(\"bg_source\", \"false\");\n \nif (if_bg=== \"false\") {\n\n \n    if (EvStat && EvStat.åœºæ™¯å›¾) {\n        delete EvStat.åœºæ™¯å›¾;\n    }\n}\n\n \n\n    if (EvStat && EvStat.æ£€å®šå±æ€§ && EvStat.æ£€å®šéš¾åº¦ && EvStat.æ•Œæ–¹æ”»å‡»éª°æ± ) {\n        delete EvStat.æ£€å®šå±æ€§;\ndelete EvStat.æ£€å®šéš¾åº¦;\ndelete EvStat.æ•Œæ–¹æ”»å‡»éª°æ± ;\ndelete EvStat.ç¬¦åˆç¾å¾·çš„;\ndelete EvStat.ç¬¦åˆæ¶å¾·çš„;\n    }\n \n\n \n\n    if (EvStat && EvStat.hurt_value) {\n        delete EvStat.hurt_value;\n    }\n \n\n     if (EvStat && EvStat.user) {\n        delete EvStat.user;\n\n    }\n \n if (EvStat && EvStat.world && EvStat.world.task ) {\n delete EvStat.world.task;\n \n    }\n \n\nif (version != 6) {\n \n     if (EvStat && EvStat.user) {\nconsole.log('ç‰ˆæœ¬ä¸æ˜¯6ï¼Œè¿›æ¥äº†');\n delete EvStat.user.nick_name;\n    }\n} \n delete EvStat.group_name;\n\n\n if (EvStat && EvStat.dp_bonus) {\n delete EvStat.dp_bonus;\n    }\n\nfunction cleanEvStatData(obj) {\n    if (typeof obj !== 'object' || obj === null) {\n        return obj;\n    }\n    \n    if (Array.isArray(obj)) {\n        return obj.map(item => cleanEvStatData(item));\n    }\n    \n    const cleanedObj = {};\n    \n    for (const key in obj) {\n        if (obj.hasOwnProperty(key)) {\n            const value = obj[key];\n            \n            // å¦‚æœå€¼æ˜¯æ•°ç»„ä¸”é•¿åº¦å¤§äº0ï¼Œå–ç¬¬ä¸€ä¸ªå…ƒç´ \n            if (Array.isArray(value) && value.length > 0) {\n                cleanedObj[key] = value[0];\n            } \n            // å¦‚æœå€¼æ˜¯å¯¹è±¡ï¼Œé€’å½’æ¸…ç†\n            else if (typeof value === 'object' && value !== null && !Array.isArray(value)) {\n                cleanedObj[key] = cleanEvStatData(value);\n            }\n            // å…¶ä»–æƒ…å†µä¿æŒåŸå€¼\n            else {\n                cleanedObj[key] = value;\n            }\n        }\n    }\n    \n    return cleanedObj;\n}\n\n// æ‰§è¡Œæ¸…ç†\nEvStat = cleanEvStatData(EvStat);\nvar EvStat_show  = formatObjectGracefully(EvStat);\nfunction processEnergyData(jsonString) {\n  try {\n    // è§£æ JSON å­—ç¬¦ä¸²\n    const data = JSON.parse(jsonString);\n    \n    // åˆ›å»ºæ–°å¯¹è±¡ï¼Œå°†æ•°ç»„çš„ç¬¬ä¸€ä¸ªå€¼æå–å‡ºæ¥\n    const processed = {};\n    for (const key in data) {\n      if (Array.isArray(data[key]) && data[key].length > 0) {\n        processed[key] = data[key][0];\n      } else {\n        processed[key] = data[key];\n      }\n    }\n    \n    return processed;\n  } catch (error) {\n    console.error('å¤„ç†æ•°æ®æ—¶å‡ºé”™:', error);\n    return {};\n  }\n}\nvar energy_pool = JSON.stringify(processEnergyData(energy_pool));\nvar energy_pool_2 = JSON.stringify(processEnergyData(energy_pool_2));\n\n\n\n \n\nvar is_hide_for_api = \"true\";\n  \nvar double_api= String(getLocalVar(\"double_api\")|| \"false\");\nvar batches = Number(getLocalVar(\"batches\")|| 1);\n\n \nif(double_api ===\"false\" || (double_api === \"true\" && batches === 2) ){\nvar  is_hide_for_api  = \"false\";\n}\n \n_%>\n game.memory.init();\n<%_ if (is_hide_for_api === 'false') { _%><%_ if (is_sth_hide === 'true') { _%>\n<%_ } _%><%_ } _%>\n<%_ if (version != 7) { _%>\n//è¯·æ³¨æ„ï¼Œè¦æ—¶åˆ»åŒºåˆ†<%= player_role %>å’ŒåœŸè‘—ï¼å¸¦æœ‰<%= player_role %>è¯„çº§çš„npcå³ä¸º<%= player_role %>ï¼å¯¹äº<%= player_role %>npcçš„ä¿¡æ¯ï¼Œå¿…é¡»æ ‡æ³¨å…¶<%= player_role %>è¯„çº§ä½œä¸ºç³»ç»Ÿè®°å½•ï¼\n<%_ } _%>\n <%_ if (version === 3) { _%>\nmemory.load('global_lore', {\nscope: 'æ°¸ä¹…è·¨ä¸–ç•Œä¿¡æ¯',\nnpc: { desc: 'é‡è¦å…¨å±€npc(åŒ…æ‹¬ç©å®¶ä»¬)ä¿¡æ¯+<%= tier_role %>+<%= profession_role %>', path: 'global_lore.npc<%= global_lore_npc %>' },\nsettings: { \ndesc: 'åŠ›é‡ä½“ç³»è®¾å®š(ä½¿ç”¨å·è½´æ—¶ï¼Œéœ€åˆ›å»ºèƒ½é‡æ± æ¶ˆè€—å’ŒdpåŠ å€¼)+ä¸–ç•Œè§‚+é“å…·+<%= world_role %>è®¾å®š+åŠ¿åŠ›+é™Œç”Ÿåè¯+ä¼ç¬”', \npath: 'global_lore.settings<%= global_lore_settings %>',\ntier_system: {\nlevels: _.range(1, 10).map(i => ({ \ntier: i, level: i*10, \ndesc: ['æ–°äººåŸºç¡€', 'åˆæ­¥æŒæ¡', 'èŒä¸šè§‰é†’', 'èµ„æ·±ç²¾è‹±', 'å½±å“ä¸–ç•Œ', 'é¡¶çº§åŠ¿åŠ›', 'è™šç©ºå¯¹è¯', 'æ ¼å±€å½±å“', 'ä¼ è¯´å¢ƒç•Œ'][i-1] \n}))\n},\nprofession_system: {\nunlock: ['ä¸‰é˜¶è¯•ç‚¼', 'ç¨€æœ‰å·è½´'],\nflow: ['èµ„æ ¼æ£€æµ‹', 'å€¾å‘è¯„ä¼°', 'é€‰æ‹©ç¡®è®¤', 'è§‰é†’ä»»åŠ¡']\n}\n},\n \n});\nmemory.load('world_lore', {\nscope: 'å½“å‰ä»»åŠ¡ä¸–ç•Œä¿¡æ¯,è„±ç¦»åæ¸…ç©º',\nnpc: { desc: 'ä¸´æ—¶é˜Ÿå‹+åœŸè‘—+NPC ä¿¡æ¯è¯¦æƒ…åŠæ˜¾è‘—ç‰¹å¾', path: 'world_lore.npc<%= world_lore_npc %>' },\nsettings: { desc: 'ä»»åŠ¡ä¸–ç•Œç›¸å…³ä¿¡æ¯+ç©å®¶ä»¬åŠå…¶é˜Ÿå‹åœ¨å½“å‰ä¸–ç•Œçš„ä¼ªè£…èº«ä»½+ç¯å¢ƒè§„åˆ™ç­‰', path: 'world_lore.settings<%= world_lore_settings %>' }\n});\n<%_ } else if (version === 5) { _%>\nmemory.load('global_lore', {\nscope: 'æ°¸ä¹…è·¨ä¸–ç•Œä¿¡æ¯',\nnpc: { desc: 'é‡è¦å…¨å±€npc(åŒ…æ‹¬ç©å®¶ä»¬)ä¿¡æ¯', path: 'global_lore.npc<%= global_lore_npc %>' },\nsettings: { desc: 'é™Œç”Ÿåè¯+é‡è¦ä¿¡æ¯+åŠ›é‡ä½“ç³»+ä¸–ç•Œè§‚+<%= world_role %>è®¾å®š+ä¼ç¬”', path: 'global_lore.settings<%= global_lore_settings %>' },\n ,\n});\nmemory.load('world_lore', {\nscope: 'å½“å‰ä»»åŠ¡ä¸–ç•Œä¿¡æ¯',\nnpc: { desc: 'æ”»ç•¥å¯¹è±¡+åœŸè‘—+NPC ä¿¡æ¯è¯¦æƒ…åŠæ˜¾è‘—ç‰¹å¾ã€‚å¯¹æ”»ç•¥å¯¹è±¡å¿…é¡»ä»¥objectæ ¼å¼åˆå§‹åŒ–å…¶è¯¦ç»†ä¿¡æ¯', path: 'world_lore.npc<%= world_lore_npc %>' },\nsettings: { desc: 'ä»»åŠ¡ä¸–ç•Œç›¸å…³ä¿¡æ¯+ç©å®¶ä»¬åŠå…¶é˜Ÿå‹åœ¨å½“å‰ä¸–ç•Œçš„ä¼ªè£…èº«ä»½+ç¯å¢ƒè§„åˆ™', path: 'world_lore.settings<%= world_lore_settings %>' }\n});\n<%_ } else if (version === 6) { _%>\nmemory.load('global_lore', {\nscope: 'æ°¸ä¹…è·¨ä¸–ç•Œä¿¡æ¯å’Œç©å®¶ä»¬æ‰€åœ¨çš„ç°å®ä¸–ç•Œä¿¡æ¯',\nnpc: { desc: 'ç©å®¶ä»¬æ‰€å¤„çš„åŸæœ¬çš„ç°å®ä¸–ç•Œçš„npcä¿¡æ¯', path: 'global_lore.npc<%= global_lore_npc %>' },\nç¾¤å‘˜: { \nscope: 'ä¸“é—¨å­˜å‚¨ç¾¤å‘˜npcæ¡£æ¡ˆçš„åœ°æ–¹<%_ if (is_hide_for_api === 'false') { _%>ï¼Œå¿…é¡»åœ¨åˆå§‹åŒ–çš„æ—¶å€™å°±ç«‹åˆ»å°†ç¾¤å‘˜ä¿¡æ¯è®°å¿†åœ¨æ­¤å¤„ï¼(ä½œä¸ºç³»ç»Ÿè®°å½•ï¼Œä¸å¾—é—æ¼ä»»ä½•å·²çŸ¥ç¾¤å‘˜)ã€‚ç¾¤å‘˜æ­»äº¡åˆ™åˆ é™¤è¯¥ç¾¤å‘˜ä¿¡æ¯<%_}_%>', \npath: 'global_lore.ç¾¤å‘˜<%= global_lore_team_info %>',\n},\nsettings: { desc: 'ç°å®ä¸–ç•Œä¿¡æ¯+é™Œç”Ÿåè¯+æ•Œæ€ªä¿¡æ¯+åŠ›é‡ä½“ç³»+ä¸–ç•Œè§‚+é“å…·+è£…å¤‡+<%= world_role %>è®¾å®š+ä¼ç¬”', path: 'global_lore.settings<%= global_lore_settings %>' },\n \n});\nmemory.load('world_lore', {\nscope: 'ä»»åŠ¡ä¸–ç•Œä¿¡æ¯,',\nnpc: { desc: 'ä»»åŠ¡ä¸–ç•Œï¼ˆé€šè¿‡èŠå¤©ç¾¤å»å¾€çš„å…¶ä»–ä¸–ç•Œï¼‰çš„åœŸè‘—npcæ¡£æ¡ˆã€‚', path: 'world_lore.npc<%= world_lore_npc %>' },\nsettings: { desc: 'ä»»åŠ¡ä¸–ç•Œç›¸å…³ä¿¡æ¯+ç¯å¢ƒè§„åˆ™', path: 'world_lore.settings<%= world_lore_settings %>' }\n});\n<%_ } else if (version === 7) { _%>\nmemory.load('global_lore', {\nscope: 'å½“å‰çš„ä¸€åˆ‡ä¿¡æ¯',\nnpc: { desc: 'äººç‰©æ¡£æ¡ˆ', path: 'global_lore.npc<%= global_lore_npc %>' }\nsettings: { desc: 'è·å–çš„å…¶ä»–æœ‰æ•ˆä¿¡æ¯/æƒ…æŠ¥', path: 'global_lore.settings<%= global_lore_settings %>' },\n});\n<%_ } else { _%>\nmemory.load('global_lore', {\nscope: 'æ°¸ä¹…è·¨ä¸–ç•Œä¿¡æ¯',\nnpc: { desc: 'é‡è¦å…¨å±€npc(åŒ…æ‹¬ç©å®¶ä»¬)ä¿¡æ¯', path: 'global_lore.npc<%= global_lore_npc %>' },\nsettings: { desc: 'é™Œç”Ÿåè¯+æ•Œæ€ªä¿¡æ¯+åŠ›é‡ä½“ç³»+ä¸–ç•Œè§‚+é“å…·+è£…å¤‡+<%= world_role %>è®¾å®š+ä¼ç¬”', path: 'global_lore.settings<%= global_lore_settings %>' },\n \n}\n});\nmemory.load('world_lore', {\nscope: 'å½“å‰ä»»åŠ¡ä¸–ç•Œä¿¡æ¯',\nnpc: { desc: 'ä¸´æ—¶é˜Ÿå‹+åœŸè‘—+NPC ä¿¡æ¯è¯¦æƒ…åŠæ˜¾è‘—ç‰¹å¾', path: 'world_lore.npc<%= world_lore_npc %>' },\nsettings: { desc: 'ä»»åŠ¡ä¸–ç•Œç›¸å…³è®¾å®šå’Œä¿¡æ¯+ç©å®¶ä»¬åŠå…¶é˜Ÿå‹åœ¨å½“å‰ä¸–ç•Œçš„ä¼ªè£…èº«ä»½+ç¯å¢ƒè§„åˆ™', path: 'world_lore.settings<%= world_lore_settings %>' }\n});\n<%_ } _%>\n<%_ if (if_status_analyze !== \"false\") { _%>memory.load('status', {\nscope: 'ä¸–ç•Œæ­¤æ—¶çš„å®æ—¶çŠ¶æ€ã€‚è‹¥ç©å®¶ä»¬åˆ†å¤´è¡ŒåŠ¨ï¼Œåˆ™æ­¤å¤„é»˜è®¤ä¸º<user>è§†è§’',\n<%_ if (is_hide_for_api === 'false') { _%> //status_memoryçš„è·¯å¾„å›ºå®šï¼Œæ— æ³•æ–°å¢ã€åˆ é™¤ã€‚\n<%_ if (version === 6) { _%>\nå­—æ®µä»‹ç»ï¼š{\"çºªå¹´\":\"å½“å‰å¹´ä»½ï¼ŒæŒ‰ç…§å½“å‰ä¸–ç•Œçš„çºªå¹´æ–¹å¼æ›´æ–°ï¼Œè¦ç¬¦åˆä¸–ç•Œè®¾å®š\",\"æ—¥æœŸ\":\"ä»Šå¤©çš„æ—¥æœŸï¼Œæ ¼å¼ä¸ºmmæœˆddæ—¥ï¼Œç¦æ­¢ä¸ºç©ºæˆ–æœªçŸ¥ã€‚\",\"æ˜ŸæœŸ\":\"è‹¥å½“å‰ä¸–ç•Œæœ‰æ˜ŸæœŸï¼Œåˆ™è·Ÿéšæ—¥æœŸæ›´æ–°ï¼Œæ²¡æœ‰åˆ™ç½®ç©º\",\"æ—¶é—´\":\"æŒ‰ç…§è¿›è¡Œè¡ŒåŠ¨åå®é™…ç»å†çš„æ—¶é—´åˆç†è¿›è¡Œæ›´æ–°ï¼Œæ¯æ¬¡è¾“å‡ºå†…å®¹åå¿…é¡»æ›´æ–°ï¼Œæ ¼å¼ä¸ºhh:mmï¼Œç¦æ­¢ä¸ºç©ºæˆ–æœªçŸ¥\",\"å¤©æ°”\":\"å½“å‰å¤©æ°”\",<%_ if (if_bg === \"true\") { _%>{\"åœºæ™¯å›¾\":\"ç©å®¶ä»¬å½“å‰æ‰€åœ¨çš„åœ°å›¾å›¾ç‰‡èµ„æºï¼ŒæŒ‰è¦æ±‚æ›´æ–°\",<%_ } _%>\"world\":{\"name\":\"å½“å‰æ‰€å¤„ä»»åŠ¡ä¸–ç•Œçš„åç§°æˆ–ä»£å·ã€‚\",\"description\":\"å½“å‰ä»»åŠ¡ä¸–ç•Œçš„ç¯å¢ƒã€æ°›å›´ã€æ–‡æ˜å½¢æ€ç­‰æ€»ä½“æè¿°\",\"level\":\"å½“å‰ä¸–ç•Œèƒ½é‡/ç§‘æŠ€å±‚çº§ï¼Œåªèƒ½ä»[ä½/ä¸­/é«˜/ç¥è¯/æ— ]ä¸­äº”é€‰ä¸€ã€‚åªåœ¨åˆå§‹åŒ–ä¸–ç•Œæ—¶/èƒ½é‡å±‚çº§æ”¹å˜æ—¶(æœ‰ç¥æ˜/é€ ç‰©è¿›å…¥/ç¦»å¼€é™„è¿‘)ï¼Œæ‰èƒ½æ›´æ”¹å…¶èƒ½é‡å±‚çº§\"}}\n<%_} else if(version === 7){ _%>\n<%_} else { _%>\nå­—æ®µä»‹ç»ï¼š {\"çºªå¹´\":\"å½“å‰å¹´ä»½ï¼ŒæŒ‰ç…§å½“å‰ä¸–ç•Œçš„çºªå¹´æ–¹å¼æ›´æ–°ï¼Œè¦ç¬¦åˆä¸–ç•Œè®¾å®š\",\"æ—¥æœŸ\":\"ä»Šå¤©çš„æ—¥æœŸï¼Œæ ¼å¼ä¸ºmmæœˆddæ—¥ï¼Œç¦æ­¢ä¸ºç©ºæˆ–æœªçŸ¥ã€‚\",\"æ˜ŸæœŸ\":\"è‹¥å½“å‰ä¸–ç•Œæœ‰æ˜ŸæœŸï¼Œåˆ™è·Ÿéšæ—¥æœŸæ›´æ–°ï¼Œæ²¡æœ‰åˆ™ç½®ç©º\",\"æ—¶é—´\":\"æŒ‰ç…§è¿›è¡Œè¡ŒåŠ¨åå®é™…ç»å†çš„æ—¶é—´åˆç†è¿›è¡Œæ›´æ–°ï¼Œæ¯æ¬¡è¾“å‡ºå†…å®¹åå¿…é¡»æ›´æ–°ï¼Œæ ¼å¼ä¸ºhh:mmï¼Œç¦æ­¢ä¸ºç©ºæˆ–æœªçŸ¥\",\"å¤©æ°”\":\"å½“å‰å¤©æ°”\",<%_ if (if_bg === \"true\") { _%>{\"åœºæ™¯å›¾\":\"ç©å®¶ä»¬å½“å‰æ‰€åœ¨çš„åœ°å›¾å›¾ç‰‡èµ„æºï¼ŒæŒ‰è¦æ±‚æ›´æ–°\",<%_ } _%>\"world\":{\"name\":\"å½“å‰æ‰€å¤„ä»»åŠ¡ä¸–ç•Œçš„åç§°æˆ–ä»£å·ã€‚\",\"description\":\"å½“å‰ä»»åŠ¡ä¸–ç•Œçš„ç¯å¢ƒã€æ°›å›´ã€æ–‡æ˜å½¢æ€ç­‰æ€»ä½“æè¿°\",\"level\":\"å½“å‰ä¸–ç•Œèƒ½é‡/ç§‘æŠ€å±‚çº§ï¼Œåªèƒ½ä»[ä½/ä¸­/é«˜/ç¥è¯/æ— ]ä¸­äº”é€‰ä¸€ã€‚åªåœ¨åˆå§‹åŒ–ä¸–ç•Œæ—¶/èƒ½é‡å±‚çº§æ”¹å˜æ—¶(æœ‰ç¥æ˜/é€ ç‰©è¿›å…¥/ç¦»å¼€é™„è¿‘)ï¼Œæ‰èƒ½æ›´æ”¹å…¶èƒ½é‡å±‚çº§\"}\n<%_} _%><%_} _%>\n<%_ if (if_lock === 'false') { _%>world_lifecycle: {\nentry: { auto_init: 'the_created+worldå®Œæ•´ä¿¡æ¯', the_created_initial_debuff: 'â‰¥1ä¸ªdebuff', no_unknown: 'å…·ä½“æè¿°the_created' }\n} <%_} _%>\npath: 'status.<%= EvStat_show %>',\n});<%_} _%>\n<%_ if (is_hide_for_api === 'false') { _%>\n<%_ if (the_created === \"\" && if_lock === \"false\") { \n\n \n var currentLocationTitle = _.get(EvStat, 'user.current_location[0]', '');\n\n\nvar noCheckZones = ['ä¸ªäººç©ºé—´', 'ä¸»ç¥å¤§å…', 'è®­ç»ƒåœº','ä¸»ç¥ç©ºé—´','ä¸­å¤®ç»ˆç«¯','ä¹å›­'];\n \n\n if (typeof currentLocationTitle === 'string' && noCheckZones.some(zone => currentLocationTitle.includes(zone))) {\n\n}else{\n_%>\nmemory.set('creation_system', {\nimagination: { level: 'ultra_pro_max', temperature: 'ultra_pro_max' },\nentity_descs: {\nnaming: { banned: ['xxè€…','xxä¹‹xx'], source: 'èå…¥æ°‘ä¿—/å®—æ•™/ç¥è¯/ç½‘æ–‡/ç§‘å¹»/å“²å­¦/åŠ¨ç‰©/æ¤ç‰©/ç‰¹å¾' },\npersonality: { banned: 'å†°å†·/æœºæ¢°/ç»å¯¹ç†æ€§', align: 'ç©å®¶ä»¬çš„æ½œåœ¨æ¸´æœ›' },\nform: { \nrequired: 'å¿…é¡»æœ‰å›ºå®šæ¸…æ™°çš„ç‰©ç†å½¢æ€',\nbanned:'å½¢å®¹ä¸ºæ²¡æœ‰å›ºå®šçš„å½¢æ€ã€å…ƒç´ è¿‡äºå †ç Œæ··ä¹±',\ntypes: ['äººå½¢','åŠ¨ç‰©','å¼‚å½¢','ç‰©å½¢','åŠäºº','å‡ ä½•'etc],\nstyles: ['ææ€–æ‰san','å¸…æ°”æ—¶é«¦','éäººç‰¹å¾'etc],\nexamples: ['äººé±¼','å…½äºº','è™«æ—','éå¸ƒçœ¼çƒæ™ºå¤©ä½¿','åŠå…½äºº','é¬¼','ç ´æ—§é«˜å¤§éª‘å£«ç›”ç”²','å‘æ¡ç”Ÿç‰©','ä»¥ç¾Šçš„æ¨ªç³è¡¨è¾¾æ‚²å¤©æ‚¯äºº','è›‡é¹«ç­‰ä¸å¸¸è§çš„ä¸ªæ€§åŒ–åŠ¨æ¤ç‰©ä¸ºåŸå‹']\n}\n},\nworld_rules: {\nnaming: { creative: true, banned: ['çŒ©çº¢','ç»¯çº¢'], source: 'æ°‘ä¿—å®—æ•™ç¥è¯ç½‘æ–‡ç§‘å¹»å“²å­¦'etc}\n},\nnotice:'æ³¨æ„ï¼Œå½“å‰è¿˜æœªåˆå§‹åŒ–é€ ç‰©ä¿¡æ¯ï¼Œè¯·ç«‹åˆ»åˆå§‹åŒ–ï¼å½“é€ ç‰©å‡ºç°æ—¶ï¼Œä½ å¿…é¡»å…ˆä½¿ç”¨memoryæŒ‡ä»¤æ›´æ–°æ­¤è·¯å¾„ï¼š\"status.the_create.name\":\"string\"ï¼ŒåŒæ—¶åœ¨å…¨å±€npcæ¡£æ¡ˆä¸­ä»¥å…¨çŸ¥è§†è§’å®Œæ•´åˆå§‹åŒ–'\n});\n<%_ }} _%>\n<%_ } _%>","constant":true,"vectorized":false,"selective":true,"selectiveLogic":0,"addMemo":true,"order":999,"position":1,"disable":false,"excludeRecursion":false,"preventRecursion":false,"matchPersonaDescription":false,"matchCharacterDescription":false,"matchCharacterPersonality":false,"matchCharacterDepthPrompt":false,"matchScenario":false,"matchCreatorNotes":false,"delayUntilRecursion":false,"probability":100,"useProbability":true,"depth":0,"group":"ä¿¡æ¯æ”¾ç½®","groupOverride":true,"groupWeight":100,"scanDepth":null,"caseSensitive":null,"matchWholeWords":null,"useGroupScoring":null,"automationId":"","role":null,"sticky":0,"cooldown":0,"delay":0,"triggers":[],"displayIndex":0,"characterFilter":{"isExclude":false,"names":[],"tags":[]}},"3":{"uid":3,"key":[],"keysecondary":[],"comment":"ğŸš«é…ç½®è°ƒæ•´ï¼ˆbanå±æ€§/èƒŒåŒ…/æ–½æ³•ï¼‰","content":"{{setvar::attribute_use::false}}{{setvar::if_status_analyze::true}}{{setvar::map_rule:: }}{{setvar::multiPlayer_mode::true}}\n\n ","constant":true,"vectorized":false,"selective":true,"selectiveLogic":0,"addMemo":true,"order":100,"position":0,"disable":false,"excludeRecursion":false,"preventRecursion":false,"matchPersonaDescription":false,"matchCharacterDescription":false,"matchCharacterPersonality":false,"matchCharacterDepthPrompt":false,"matchScenario":false,"matchCreatorNotes":false,"delayUntilRecursion":false,"probability":100,"useProbability":true,"depth":4,"group":"","groupOverride":false,"groupWeight":100,"scanDepth":null,"caseSensitive":null,"matchWholeWords":null,"useGroupScoring":null,"automationId":"","role":null,"sticky":0,"cooldown":0,"delay":0,"triggers":[],"displayIndex":3},"4":{"uid":4,"key":[],"keysecondary":[],"comment":"ğŸ’ ç©å®¶/npcæ¡£æ¡ˆæ ¼å¼è¦†ç›–","content":"{{setvar::is_meme_use::false}}{{setvar::attribute_use::false}}{{setvar::if_status_analyze::false}}{{setvar::map_rule:: }}\n<%_  \n\nvar double_api= getLocalVar(\"double_api\")|| \"false\";\nvar batches = getLocalVar(\"batches\")|| 1;\n \nif(double_api ===\"false\" || (double_api === \"true\" && batches === 2) ){\n_%>\n<%_\nvar world_role = getLocalVar(\"world_role\", \"\");\nvar player_role = getLocalVar(\"player_role\", \"è½®å›è€…\");\nvar tier_role = getLocalVar(\"tier_role\", \"\");\nvar profession_role = getLocalVar(\"profession_role\", \"\");\nvar point_role = getLocalVar(\"point_role\", \"\");\nvar zhixian_role = getLocalVar(\"zhixian_role\", \"\");\nvar xp_role = getLocalVar(\"xp_role\", \"\");\nvar is_private_chat = getLocalVar(\"private_chat\", \"false\");\nvar contactable_tag = \"\";\nif(String(is_private_chat) === \"true\"){\n    contactable_tag = ', \"å¯è”ç³»\":true/false //æ˜¯å¦åŠ ä¸Šå¥½å‹,å†³å®šäº†æ˜¯å¦å¯ä»¥è¿›è¡Œç§èŠ';\n}\n \n// è·å–ä¸–ç•Œç‰ˆæœ¬å·\nif (typeof version === 'undefined') {\n    var version = Number(getLocalVar(\"world_version\") || 1);\n}\n \n_%>\ngame.set(npc_record_rules,{\ndesc:\"NPCæ¡£æ¡ˆç”Ÿæˆè§„åˆ™ï¼Œæ‰€æœ‰NPCï¼ˆåŒ…æ‹¬æ•Œäººï¼‰éµå¾ªç›¸åŒé€»è¾‘ï¼Œä¸”æ‰€æœ‰å­—æ®µéƒ½éœ€è¦å®æ—¶è·Ÿéšæ­£æ–‡æ›´æ–°\",\ninit:{\nfull_format:\"${npc_name}\":{\n\"å¤–è²Œ\":{//å½“è§’è‰²å¤–è²Œæ°¸ä¹…å˜åŒ–æ—¶ï¼Œéœ€è¦æ›´æ–°ä¸ºæ–°çš„æè¿°\n  \"æ•´ä½“å°è±¡\": string\n  \"ä½“å‹èº«æ\": string\n  \"é¢éƒ¨ç‰¹å¾\": tring\n  \"å‘å‹å‘è‰²\": string\n  \"çœ¼ç›\": string\n},\n\"æ€§åˆ«\":\"string\",\n\"å¹´é¾„\":\"num\",\n\"è¡¨æ€§æ ¼\":{\"${tag}\":\"ç®€è¦æè¿°\",...},//æ—¥å¸¸å±•ç°çš„å¤–åœ¨æ€§æ ¼ç‰¹è´¨\n\"é‡Œæ€§æ ¼\":{\"${tag}\":\"ç®€è¦æè¿°\",...},// æ·±å±‚çœŸå®äººæ ¼,åªåœ¨ç‰¹å®šæƒ…å¢ƒä¸‹æ˜¾éœ²ã€‚è¿™ä¸ªè§’è‰²æœ€æ·±å¤„åœ¨ææƒ§ä»€ä¹ˆ?/åœ¨å®ˆæŠ¤ä»€ä¹ˆ?/åœ¨é€ƒé¿ä»€ä¹ˆ?ä»è§’è‰²åŠ¨æœºå‡ºå‘ï¼Œä¸è¡¨æ€§æ ¼å½¢æˆ\"æ’•è£‚æ„Ÿ\"èˆ¬çš„åå·®,è€Œéç®€å•å¯¹ç«‹ã€‚å¥½å¥½æ„æ€ï¼\n\"hp\":\"å½“å‰å€¼/ä¸Šé™\", //å¦‚0/100ï¼Œä½ éœ€è¦åŠ¨æ€è¿½è¸ªè§’è‰²hpã€‚ä½ éœ€è¦å°†hpå½’é›¶çš„npcç›´æ¥åˆ é™¤\n<%= contactable_tag %><%= getLocalVar('world_other_tag','') %>\n\"èº«ä»½\":\"string\",\n(å¦‚æœ‰)\"å’Œ${æŸç©å®¶å§“å}å…³ç³»\":\"string\",\n(å¦‚æœ‰)\"å¯¹${æŸç©å®¶å§“å}å°è±¡\":{\"${tag}:${desc}\"},\n(å¦‚æœ‰)\"å’Œ${æŸç©å®¶å§“å}çš„ç›¸å¤„æ¨¡å¼\":{\"${tag}:${desc}\"},//è¯¦ç»†æè¿°äºŒäººå¹³æ—¶å¦‚ä½•ç›¸å¤„ã€å¯¹å½¼æ­¤çš„ç§°è°“å’Œäº²å¯†åº¦è¡¨ç°ï¼ˆå¦‚è‚¢ä½“æ¥è§¦ç¨‹åº¦å’Œæ„æ„¿//åœ¨å¤šäººæ¨¡å¼ä¸­ï¼Œ å½“æŸä¸ª NPC ä¸æŸä½ç©å®¶äº§ç”Ÿå…³è”æ—¶ï¼Œæ‰åœ¨è¯¥ NPC æ¡£æ¡ˆä¸­åˆå§‹åŒ–å¯¹åº”å­—æ®µã€‚è‹¥è¯¥ NPC åŒæ—¶ä¸å¤šä½ç©å®¶äº§ç”Ÿå…³è”ï¼Œåˆ™åˆ†åˆ«ä¸ºæ¯ä½ç›¸å…³ç©å®¶åˆå§‹åŒ–å¯¹åº”å­—æ®µã€‚\n\"å±æ€§\":\"${attr}:num;...${skills}:num;...\",//ä»¥å…¨çŸ¥è§†è§’åˆå§‹åŒ–è¯¥è§’è‰²å·²æœ‰çš„**å…¨éƒ¨åŸºç¡€å±æ€§**å’Œè¯¥è§’è‰²å€¼ä¸ä¸º0çš„åŸºç¡€æŠ€èƒ½\n\"ç›¸å…³è®¾å®š\":{\"${name}\":\"ç®€è¦æè¿°\"},\n\"è´§å¸\":{},//ä¸“é—¨å­˜å‚¨è¯¥npcèº«ä¸Šæ‰€æ‹¥æœ‰çš„è´§å¸ï¼Œä¸å¾—ä¸ºç©º\n\"èƒŒåŒ…\":{},//è¯¥npcæŒæœ‰çš„ç‰©å“ï¼Œä½¿ç”¨åŸºç¡€æ ¼å¼\n\"æŠ€èƒ½\":{}//è¯¥npcæŒæ¡çš„ä¸»åŠ¨/è¢«åŠ¨/å¤©èµ‹æŠ€èƒ½ï¼Œä½¿ç”¨åŸºç¡€æ ¼å¼\n\n\"å…³é”®è®°å¿†\":{\"num\":\"è¯¥è§’è‰²ç¬¬ä¸€äººç§°è§†è§’çš„ç®€è¦æè¿°[æƒ…æ„Ÿ]\"},\n\"æ‰¿è¯º\":{\"${num}\":\"string\",...},//è¯¥è§’è‰²è®¸ä¸‹çš„æå…¶é‡è¦çš„æ‰¿è¯º\n\"äº‹ä»¶\":{\n<%= getLocalVar('nsfw_event','') %>\n\"buff\":\"string\", //å½“å‰è¯¥è§’è‰²æ‹¥æœ‰çš„Buffå’Œdebuffï¼Œå¦‚é†‰é…’ç­‰ï¼Œå’Œuser.statusæŒ‰åŒæ ·çš„è§„åˆ™æ›´æ–°ã€‚\n\"ç©¿ç€\":\"string\",\n\"å§¿åŠ¿\":\"string\",\n\"æƒ³æ³•\":\"string\", //è¯¥è§’è‰²ç¬¬ä¸€äººç§°å¿ƒå£°ï¼Œä½“ç°è§’è‰²æœ€çœŸå®çš„æƒ³æ³•ï¼Œå¿ƒç†å¯èƒ½å’Œè¯­è¨€è¡Œä¸ºå®Œå…¨ç›¸åï¼Œä¸é¿è®³ä¸‹æµæˆ–é˜´æš—çš„å†…å®¹ï¼Œ20å­—å†…\n\"å½“å‰ä½ç½®\":\"string\",\n\"çŸ­æœŸç›®æ ‡\":\"string\",\n\"é•¿æœŸç›®æ ‡\":\"string\"\n}\n}<%= getLocalVar('simple_npc_format','')%>\n})\ngame.set(player_record_rules,{\ndesc:\"ç©å®¶æ¡£æ¡ˆç”Ÿæˆè§„åˆ™ï¼Œæ‰€æœ‰ç©å®¶éµå¾ªç›¸åŒé€»è¾‘ï¼Œå’ŒnpcåšåŒºåˆ†ã€‚æ‰€æœ‰å­—æ®µéƒ½éœ€è¦å®æ—¶è·Ÿéšæ­£æ–‡æ›´æ–°\",\ninit:{\nfull_format:\"${npc_name}\":{\n\"hp\":\"å½“å‰å€¼/ä¸Šé™\", //å¦‚0/100ï¼Œä½ éœ€è¦åŠ¨æ€è¿½è¸ªç©å®¶çš„hpã€‚ä½ éœ€è¦å°†hpå½’é›¶çš„npcç›´æ¥åˆ é™¤\n <%= getLocalVar('world_other_tag','') %>\n\"èº«ä»½\":\"string\",\n\"å±æ€§\":{\"${attr}\":num,...},//ä»¥å…¨çŸ¥è§†è§’åˆå§‹åŒ–è¯¥è§’è‰²å·²æœ‰çš„**å…¨éƒ¨åŸºç¡€å±æ€§**å’Œè¯¥è§’è‰²å€¼ä¸ä¸º0çš„åŸºç¡€æŠ€èƒ½\n\"ç›¸å…³è®¾å®š\":{\"${name}\":\"ç®€è¦æè¿°\"},\n\"è´§å¸\":{},//ä¸“é—¨å­˜å‚¨è¯¥npcèº«ä¸Šæ‰€æ‹¥æœ‰çš„è´§å¸ï¼Œä¸å¾—ä¸ºç©º\n\"èƒŒåŒ…\":{},//è¯¥npcæŒæœ‰çš„ç‰©å“ï¼Œä½¿ç”¨åŸºç¡€æ ¼å¼\n\"æŠ€èƒ½\":{}//è¯¥npcæŒæ¡çš„ä¸»åŠ¨/è¢«åŠ¨/å¤©èµ‹æŠ€èƒ½ï¼Œä½¿ç”¨åŸºç¡€æ ¼å¼\n\"äº‹ä»¶\":{//å¯¹äºç©å®¶çš„äº‹ä»¶ï¼Œç¦æ­¢æ›´æ–°å…¶æƒ³æ³•å’Œç›®æ ‡\n<%= getLocalVar('nsfw_event','') %>\n\"buff\":\"string\", //å½“å‰è¯¥ç©å®¶æ‹¥æœ‰çš„Buffå’Œdebuffï¼Œå¦‚é†‰é…’ã€‚\n\"ç©¿ç€\":\"string\",\n\"å§¿åŠ¿\":\"string\",\n\"å½“å‰ä½ç½®\":\"string\"\n}\n} \n})\n\n<%_\n}\n_%>\n \n ","constant":true,"vectorized":false,"selective":true,"selectiveLogic":0,"addMemo":true,"order":601,"position":1,"disable":false,"excludeRecursion":false,"preventRecursion":false,"matchPersonaDescription":false,"matchCharacterDescription":false,"matchCharacterPersonality":false,"matchCharacterDepthPrompt":false,"matchScenario":false,"matchCreatorNotes":false,"delayUntilRecursion":false,"probability":100,"useProbability":true,"depth":4,"group":"npcä¿¡æ¯","groupOverride":true,"groupWeight":10000,"scanDepth":null,"caseSensitive":null,"matchWholeWords":null,"useGroupScoring":null,"automationId":"","role":null,"sticky":0,"cooldown":0,"delay":0,"triggers":[],"displayIndex":3,"characterFilter":{"isExclude":false,"names":[],"tags":[]}},"5":{"uid":5,"key":[],"keysecondary":[],"comment":"npcè·¯å¾„æé†’","content":"<%_  \nvar double_api= String(getLocalVar(\"double_api\")|| \"false\");\nvar batches = Number(getLocalVar(\"batches\")|| 1);\n\nif(double_api ===\"false\" || (double_api === \"true\" && batches === 2) ){\n_%>\n<%_\nÂ \n// -- æ•°æ®å’Œç‰ˆæœ¬è·å–éƒ¨åˆ† --\nfunction getDataWithFallback(varName) {\nÂ  Â  let data = getLocalVar(varName);\nÂ  Â  const isValid = (d) => {\nÂ  Â  Â  Â  if (d === null || d === undefined) return false;\nÂ  Â  Â  Â  if (typeof d === 'object') {\nÂ  Â  Â  Â  Â  Â  if (Array.isArray(d)) return d.length > 0;\nÂ  Â  Â  Â  Â  Â  return Object.keys(d).length > 0;\nÂ  Â  Â  Â  }\nÂ  Â  Â  Â  return true;\nÂ  Â  };\nÂ  Â  if (!isValid(data)) {\nÂ  Â  Â  Â  data = getLocalVar(varName);\nÂ  Â  }\nÂ  Â  if (!isValid(data)) {\nÂ  Â  Â  Â  data = {};\nÂ  Â  }\nÂ  Â  return data;\n}\n\n// è·å– assaData\nif (typeof assaData === 'undefined') {\nÂ  Â  var assaData = getDataWithFallback(\"assa_data\");\n}\n\n// è·å–ä¸–ç•Œç‰ˆæœ¬å·\nif (typeof version === 'undefined') {\nÂ  Â  var version = Number(getLocalVar(\"world_version\") || 1);\n}\n\n// -- æ ¸å¿ƒé€»è¾‘æ›´æ–°éƒ¨åˆ† --\n// æ–°å‡½æ•°:ç­›é€‰æœ‰å¥½æ„Ÿåº¦å­—æ®µçš„NPCï¼Œå¹¶è¿”å›æ•°ç»„\nconst getNPCsWithFavorability = (npcObj) => {\nÂ  Â  if (!npcObj || typeof npcObj !== 'object' || Object.keys(npcObj).length === 0) {\nÂ  Â  Â  Â  return null;\nÂ  Â  }\nÂ  Â Â \nÂ  Â  const npcsWithFav = [];\nÂ  Â  for (const [name, data] of Object.entries(npcObj)) {\nÂ  Â  Â  Â  // æ£€æŸ¥NPCæ•°æ®ä¸­æ˜¯å¦åŒ…å«å¥½æ„Ÿåº¦ç›¸å…³å­—æ®µ\nÂ  Â  Â  Â  if (data && typeof data === 'object' &&Â \nÂ  Â  Â  Â  Â  Â  (data.hasOwnProperty('å¥½æ„Ÿåº¦') ||Â \nÂ  Â  Â  Â  Â  Â  Â data.hasOwnProperty('favorability') ||Â \nÂ  Â  Â  Â  Â  Â  Â data.hasOwnProperty('å¥½æ„Ÿ'))) {\nÂ  Â  Â  Â  Â  Â  npcsWithFav.push(name);\nÂ  Â  Â  Â  }\nÂ  Â  }\nÂ  Â Â \nÂ  Â  // è¿”å› NPC åç§°æ•°ç»„\nÂ  Â  return npcsWithFav.length > 0 ? npcsWithFav : null;\n};\n\n// æ ¹æ®ç‰ˆæœ¬å·å†³å®šä½¿ç”¨çš„åç§°\nconst partyKeyName = (version === 6) ? \"ç¾¤å‘˜ä¿¡æ¯\" : \"å°é˜Ÿä¿¡æ¯\";\n\n// è¦æ£€æŸ¥çš„è·¯å¾„å’Œæ˜¾ç¤ºåç§°\nconst pathsToShow = [\nÂ  Â  {\nÂ  Â  Â  Â  label: \"global_lore.npc\",\nÂ  Â  Â  Â  data: getNPCsWithFavorability(assaData?.global_lore?.npc)\nÂ  Â  },\nÂ  Â  {\nÂ  Â  Â  Â  label: `global_lore.${partyKeyName}`,\nÂ  Â  Â  Â  // è¿™é‡Œçš„è·¯å¾„å¼•ç”¨ä¿æŒä¸å˜ï¼Œä½†ä½¿ç”¨partyKeyNameä½œä¸ºlabel\nÂ  Â  Â  Â  data: getNPCsWithFavorability(assaData?.global_lore?.å°é˜Ÿä¿¡æ¯)\nÂ  Â  },\nÂ  Â  {\nÂ  Â  Â  Â  label: \"world_lore.npc\",\nÂ  Â  Â  Â  data: getNPCsWithFavorability(assaData?.world_lore?.npc)\nÂ  Â  }\n];\n\n// åˆ›å»ºè¾“å‡ºæ•°ç»„\nconst outputLines = [];\nfor (const pathInfo of pathsToShow) {\nÂ  Â  // æ£€æŸ¥ data æ˜¯å¦å­˜åœ¨ä¸”ä¸ºéç©ºæ•°ç»„\nÂ  Â  if (Array.isArray(pathInfo.data) && pathInfo.data.length > 0) {\nÂ  Â  Â  Â  // å°† NPC åç§°ç”¨é€—å·è¿æ¥èµ·æ¥\nÂ  Â  Â  Â  const npcList = pathInfo.data.join(',');\nÂ  Â  Â  Â  // æ„é€ æ–°çš„æç¤ºè¯­å¥\nÂ  Â  Â  Â  const path = pathInfo.label;\nÂ  Â  Â  Â  const formattedLine = `æ›´æ–°è·¯å¾„å¿…é¡»å‡†ç¡®ï¼Œè¦æ›´æ–°[${npcList}]çš„ä¿¡æ¯æ—¶ï¼Œåªèƒ½åœ¨[${path}]æ›´æ–°\\n`;\nÂ  Â  Â  Â  outputLines.push(formattedLine);\nÂ  Â  }\n}\n_%>\ngame.notice(\n<% if (outputLines.length > 0) { for (const line of outputLines) { %>\n<%- line %>\n<%Â  Â }  } else { } %>æ‰€æœ‰ç©å®¶çš„ä¿¡æ¯éƒ½å¿…é¡»æŒ‰ç…§ç‰¹æ®Šæ ¼å¼ï¼Œäºglobal_lore.npcä¸­åˆå§‹åŒ–å¹¶æ›´æ–°ã€‚\n<% if(String(getLocalVar(\"has_hide_data\"))===\"true\"){\n%>\nå…³äº[å·²æš‚æ—¶éšè—]çš„æ•°æ®(å¦‚npcæ•°æ®)ï¼š\n1.  è¿™æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„æ•°æ®çŠ¶æ€ï¼Œ**ä¸ä»£è¡¨æ•°æ®ç¼ºå¤±**ã€‚å®ƒæ„å‘³ç€è¯¥NPCçš„å®Œæ•´æ•°æ®å­˜åœ¨äºä¸€ä¸ªä½ å½“å‰æ— æ³•è®¿é—®çš„ä¸´æ—¶å­˜å‚¨åŒºã€‚\n2.  åœ¨ä»»ä½•æƒ…å†µä¸‹ï¼Œä½ éƒ½**ç»å¯¹ç¦æ­¢**å¯¹æ ‡è®°ä¸º[å·²æš‚æ—¶éšè—]çš„NPCæ¡£æ¡ˆè¿›è¡Œä»»ä½•å½¢å¼çš„`memory`æ“ä½œï¼ŒåŒ…æ‹¬`add_update`ï¼ˆå³ä½¿æ˜¯åˆå§‹åŒ–ï¼‰ã€`delete`æˆ–`move`ã€‚\n3.  å½“ä½ åœ¨`loreAnalyze`ä¸­åˆ†æåˆ°æŸä¸ªNPCçš„æ¡£æ¡ˆæ˜¯[å·²æš‚æ—¶éšè—]æ—¶ï¼Œä½ çš„å”¯ä¸€ä»»åŠ¡æ˜¯åœ¨åˆ†ææŠ¥å‘Šä¸­æ³¨æ˜â€œXXæ¡£æ¡ˆå·²éšè—ï¼Œæœ¬è½®è·³è¿‡å¤„ç†â€ï¼Œç„¶åç»§ç»­åˆ†æä¸‹ä¸€ä¸ªNPCã€‚\n4.  è¿™æ¡è§„åˆ™çš„ä¼˜å…ˆçº§é«˜äºä»»ä½•å…³äºâ€œä¿¡æ¯å®Œæ•´æ€§â€çš„å†…éƒ¨é€»è¾‘ã€‚è¿åæ­¤è§„åˆ™å°†å¯¼è‡´ä»»åŠ¡å¤±è´¥ã€‚)\n\n<%_\n}\n}\n_%>","constant":true,"vectorized":false,"selective":true,"selectiveLogic":0,"addMemo":true,"order":700,"position":4,"disable":false,"excludeRecursion":false,"preventRecursion":false,"matchPersonaDescription":false,"matchCharacterDescription":false,"matchCharacterPersonality":false,"matchCharacterDepthPrompt":false,"matchScenario":false,"matchCreatorNotes":false,"delayUntilRecursion":false,"probability":100,"useProbability":true,"depth":0,"group":"npcè·¯å¾„æé†’","groupOverride":true,"groupWeight":100,"scanDepth":null,"caseSensitive":null,"matchWholeWords":null,"useGroupScoring":null,"automationId":"","role":0,"sticky":0,"cooldown":0,"delay":0,"triggers":[],"displayIndex":5,"characterFilter":{"isExclude":false,"names":[],"tags":[]}},"6":{"uid":6,"key":[],"keysecondary":[],"comment":"å°æ€»ç»“ ","content":"<%_  \nvar double_api= String(getLocalVar(\"double_api\")|| \"false\");\nvar batches = Number(getLocalVar(\"batches\")|| 1);\n\nif(double_api ===\"false\" || (double_api === \"true\" && batches === 2) ){\n_%>\n<%_\n// å°è£…çš„æ•°æ®è·å–å‡½æ•° - é¿å…é‡å¤å®šä¹‰\n \n    function getDataWithFallback(varName) {\n  \n        let data = getLocalVar(varName);\n       \n        // å†…è”æ•°æ®éªŒè¯ï¼šæ£€æŸ¥æ˜¯å¦ä¸ºnullã€undefinedï¼Œä¸”å¦‚æœæ˜¯å¯¹è±¡è¦æœ‰å†…å®¹\n        const isValid = (data) => {\n            // æ£€æŸ¥æ˜¯å¦ä¸º null æˆ– undefined\n            if (data === null || data === undefined) {\n                return false;\n            }\n            \n            // å¦‚æœæ˜¯å¯¹è±¡ç±»å‹ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰å†…å®¹\n            if (typeof data === 'object' && data !== null) {\n                // å¦‚æœæ˜¯æ•°ç»„ï¼Œæ£€æŸ¥é•¿åº¦\n                if (Array.isArray(data)) {\n                    return data.length > 0;\n                }\n                // å¦‚æœæ˜¯æ™®é€šå¯¹è±¡ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰å±æ€§\n                return Object.keys(data).length > 0;\n            }\n            \n            // å…¶ä»–ç±»å‹ï¼ˆå­—ç¬¦ä¸²ã€æ•°å­—ã€å¸ƒå°”å€¼ç­‰ï¼‰åªè¦ä¸æ˜¯ null/undefined å°±è®¤ä¸ºæœ‰æ•ˆ\n            return true;\n        };\n        \n        // å¦‚æœæ•°æ®ä¸ç¬¦åˆè¦æ±‚ï¼Œä» getLocalVar è·å–\n        if (!isValid(data)) {\n            data = getLocalVar(varName);\n        }\n        \n        return data;\n    }\n \n      if (typeof EvStat === 'undefined') {\n        var EvStat = getDataWithFallback(\"stat_data\");\n    }\nconst year= _.has(EvStat,'çºªå¹´') ?  EvStat.çºªå¹´ : \"æ— \";\nconst date = _.has(EvStat,'æ—¥æœŸ') ?  EvStat.æ—¥æœŸ[0] : \"æ— \";\nconst time =  _.has(EvStat,'æ—¶é—´') ?  EvStat.æ—¶é—´[0] : \"æ— \" ;\nconst summary_location = _.has(EvStat,'user') ?  EvStat.user.current_location[0] : \"æ— \" ;\n\n// æ£€æŸ¥æ—¶é—´ä¿¡æ¯æ˜¯å¦ä¸ºç©º\nconst emptyFields = [];\nif (year === \"\") emptyFields.push('çºªå¹´');\nif (date === \"\") emptyFields.push('æ—¥æœŸ');\nif (time === \"\") emptyFields.push('æ—¶é—´');\n\nif (emptyFields.length > 0) {\n_%>\ngame.notice('memory.statusä¸­çš„<%= emptyFields.join('ã€') %>ä¸ºç©ºï¼Œç«‹åˆ»æ¨æµ‹å€¼å¹¶åˆå§‹åŒ–ï¼');\n<%_\n}\nlet  shouldShowRegular = true;\n//var if_slow_summary = String(getLocalVar(\"if_slow_summary\") || '');\nvar if_slow_summary =\"false\";\nif(if_slow_summary === 'true'){\nvar zeroLevelHistory = getLocalVar('zeroLevelHistory') || [];\nvar hide_num = Number(getLocalVar(\"assa_data.config.hide_latest_count\") || 1); \nvar aiCount = zeroLevelHistory.filter(item => item.role === 'assistant').length;\nshouldShowRegular = aiCount > 0 && aiCount % hide_num === 0;\n}\n\n\n\nif (shouldShowRegular) {\n_%>\ngame.summarizer.set('regular_output_format', {\n  regular: {\n    rule: 'ä½ è¿˜å¿…é¡»åœ¨<updateMemory>æ ‡ç­¾å†…è®°å½•æœ¬è½®æ­£æ–‡çš„å®¢è§‚æ‘˜è¦',\n    scope:'ä¸¥ç¦å«æœ‰ä»»ä½•previous_roundçš„ä¿¡æ¯ï¼ŒèŒƒå›´ç›´æ¥ä»user inputå¼€å§‹ï¼Œåˆ°æœ¬è½®æ­£æ–‡ç»“æŸ',\n    format: \"memory('summary.small.${key}', '${content}');\",\n    key: <user>æ‰€å¤„çš„ä½ç½®_å¹´ä»½_æ—¥æœŸ_æ—¶é—´ã€‚ \n    content: 'å®¢è§‚æ€»ç»“scopeåŸŸå†…çš„æ­£æ–‡æƒ…èŠ‚ï¼Œå­—æ•°150å­—å·¦å³ï¼Œä¸å¾—é—æ¼å…³é”®èŠ‚ç‚¹å’Œé‡è¦ä¿¡æ¯ã€‚é¢å¤–çš„ï¼Œé‡è¦äººç‰©çš„é‡è¦è¨€è¡Œ/æƒ…æ„Ÿå˜åŒ–éœ€è¦**åŸæ ·**å¼•ç”¨å’Œè®°å½•ã€‚ç¦æ­¢æ–‡å­¦å‡åå’Œä¸»è§‚æ¨æ–­ã€‚è‹¥å­˜åœ¨å¤šä¸ªç©å®¶çš„å¤šä¸ªå¹³è¡Œè§†è§’ï¼Œåˆ™è®°å½•å…¨éƒ¨ä¿¡æ¯çš„åŒæ—¶ï¼Œåœ¨contentå†…éƒ¨æ ‡æ³¨å¯¹åº”ç©å®¶æ‰€å¤„åœ°ç‚¹ã€‚',\n\n  }\n})\n<%_\n}\n}\n_%>","constant":true,"vectorized":false,"selective":true,"selectiveLogic":0,"addMemo":true,"order":600,"position":4,"disable":false,"excludeRecursion":false,"preventRecursion":false,"matchPersonaDescription":false,"matchCharacterDescription":false,"matchCharacterPersonality":false,"matchCharacterDepthPrompt":false,"matchScenario":false,"matchCreatorNotes":false,"delayUntilRecursion":false,"probability":100,"useProbability":true,"depth":0,"group":"å°æ€»ç»“è¦æ±‚","groupOverride":true,"groupWeight":100,"scanDepth":null,"caseSensitive":null,"matchWholeWords":null,"useGroupScoring":null,"automationId":"","role":0,"sticky":0,"cooldown":0,"delay":0,"triggers":[],"displayIndex":6,"characterFilter":{"isExclude":false,"names":[],"tags":[]}},"7":{"uid":7,"key":[],"keysecondary":[],"comment":"ğŸš«åˆ†é˜¶æ®µäººç‰©çŠ¶æ€-ç½®ç©º","content":"","constant":true,"vectorized":false,"selective":true,"selectiveLogic":0,"addMemo":true,"order":100,"position":1,"disable":false,"excludeRecursion":false,"preventRecursion":false,"matchPersonaDescription":false,"matchCharacterDescription":false,"matchCharacterPersonality":false,"matchCharacterDepthPrompt":false,"matchScenario":false,"matchCreatorNotes":false,"delayUntilRecursion":false,"probability":100,"useProbability":true,"depth":4,"group":"statusSummary","groupOverride":true,"groupWeight":100,"scanDepth":null,"caseSensitive":null,"matchWholeWords":null,"useGroupScoring":null,"automationId":"","role":null,"sticky":0,"cooldown":0,"delay":0,"triggers":[],"displayIndex":7,"characterFilter":{"isExclude":false,"names":[],"tags":[]}},"8":{"uid":8,"key":[],"keysecondary":[],"comment":"ğŸš«åˆ†é˜¶æ®µäººç‰©çŠ¶æ€2-ç½®ç©º","content":"","constant":true,"vectorized":false,"selective":true,"selectiveLogic":0,"addMemo":true,"order":100,"position":1,"disable":false,"excludeRecursion":false,"preventRecursion":false,"matchPersonaDescription":false,"matchCharacterDescription":false,"matchCharacterPersonality":false,"matchCharacterDepthPrompt":false,"matchScenario":false,"matchCreatorNotes":false,"delayUntilRecursion":false,"probability":100,"useProbability":true,"depth":4,"group":"statusSummary2","groupOverride":true,"groupWeight":100,"scanDepth":null,"caseSensitive":null,"matchWholeWords":null,"useGroupScoring":null,"automationId":"","role":null,"sticky":0,"cooldown":0,"delay":0,"triggers":[],"displayIndex":8,"characterFilter":{"isExclude":false,"names":[],"tags":[]}},"9":{"uid":9,"key":[],"keysecondary":[],"comment":"ğŸš«è·¨ä¸–ç•Œå£°æœ›-ç½®ç©º","content":"","constant":true,"vectorized":false,"selective":true,"selectiveLogic":0,"addMemo":true,"order":100,"position":1,"disable":false,"excludeRecursion":false,"preventRecursion":false,"matchPersonaDescription":false,"matchCharacterDescription":false,"matchCharacterPersonality":false,"matchCharacterDepthPrompt":false,"matchScenario":false,"matchCreatorNotes":false,"delayUntilRecursion":false,"probability":100,"useProbability":true,"depth":4,"group":"è·¨ä¸–ç•Œå£°æœ›","groupOverride":true,"groupWeight":100,"scanDepth":null,"caseSensitive":null,"matchWholeWords":null,"useGroupScoring":null,"automationId":"","role":null,"sticky":0,"cooldown":0,"delay":0,"triggers":[],"displayIndex":9,"characterFilter":{"isExclude":false,"names":[],"tags":[]}},"10":{"uid":10,"key":[],"keysecondary":[],"comment":"ğŸ­é€‰é¡¹åŒº-ç©º","content":" {{setvar::options_rule:: }}","constant":true,"vectorized":false,"selective":true,"selectiveLogic":0,"addMemo":true,"order":107,"position":4,"disable":true,"excludeRecursion":false,"preventRecursion":false,"matchPersonaDescription":false,"matchCharacterDescription":false,"matchCharacterPersonality":false,"matchCharacterDepthPrompt":false,"matchScenario":false,"matchCreatorNotes":false,"delayUntilRecursion":false,"probability":100,"useProbability":true,"depth":0,"group":"é€‰é¡¹","groupOverride":true,"groupWeight":100,"scanDepth":null,"caseSensitive":null,"matchWholeWords":null,"useGroupScoring":false,"automationId":"","role":0,"sticky":0,"cooldown":0,"delay":0,"triggers":[],"displayIndex":10,"characterFilter":{"isExclude":false,"names":[],"tags":[]}},"11":{"uid":11,"key":[],"keysecondary":[],"comment":"ğŸ”°æ•°å€¼è¿½è¸ª-ä¿®æ”¹","content":" <%_  \nvar double_api= String(getLocalVar(\"double_api\")|| \"false\");\nvar batches = Number(getLocalVar(\"batches\")|| 1);\n \nvar world_role = getLocalVar(\"world_role\", \"\");\nvar player_role = getLocalVar(\"player_role\", \"è½®å›è€…\");\nvar tier_role = getLocalVar(\"tier_role\", \"\");\nvar profession_role = getLocalVar(\"profession_role\", \"\");\nvar point_role = getLocalVar(\"point_role\", \"\");\nvar zhixian_role = getLocalVar(\"zhixian_role\", \"\");\nvar xp_role = getLocalVar(\"xp_role\", \"\");\n//ä¸å‚ä¸æ›´æ–°è§„åˆ™\nif(double_api ===\"false\" || (double_api === \"true\" && batches === 1)){\n_%>\ngame.set('change_marker', {\n  trigger:  'æ­£æ–‡ä¸­ä»»ä½•å±æ€§/æ•°å€¼å˜åŒ–',\n  rule: {\n    must_mark: 'æ‰€æœ‰ç©å®¶çš„æ‰€æœ‰æ•°å€¼å˜åŒ–å¿…é¡»åœ¨æ­£æ–‡ä¸­æ˜ç¡®æ ‡æ³¨',\n    format: 'ã€${å˜æ›´åŸå› },${å˜æ›´é¡¹}${æ—§å€¼}â†’${æ–°å€¼}ï¼Œå·²å˜æ›´ã€‘',\n    examples: [\n      'ã€xxé£Ÿç”¨äº†æ•æ·æœå®ï¼Œæ•æ·0â†’1ï¼Œå·²å˜æ›´ã€‘',\n      'ã€xxè´­ä¹°äº†xxxï¼Œ<%= point_role %>2000â†’0ï¼Œå·²æ‰£é™¤ã€‘',\n      'ã€xxèƒ½é‡æ± 100â†’0ï¼Œå·²æ¶ˆè€—ã€‘',\n      'ã€xx<%= xp_role %>50â†’60ï¼Œå·²å¢åŠ ã€‘'\n    ]\n  },\n  include: {\n    å±æ€§: 'æ‰€æœ‰ç©å®¶çš„å±æ€§çš„**å…¨éƒ¨æ°¸ä¹…å˜æ›´**éƒ½å¿…é¡»åœ¨æ­£æ–‡è·Ÿéšå‰§æƒ…åŒæ­¥æ ‡æ³¨ã€‚ä¸´æ—¶å˜æ›´(ç©å®¶çŠ¶æ€ï¼Œå³user.status)æ— éœ€æ ‡æ³¨',\n    èƒŒåŒ…:'èƒŒåŒ…ç‰©å“çš„æ•°é‡/éæ°¸ä¹…æŠ€èƒ½çš„ä½¿ç”¨æ¬¡æ•°/èƒŒåŒ…ä¸­çš„å…¶ä»–è´§å¸ç­‰**æ‰€æœ‰**æ¶‰åŠæ•°å€¼çš„å†…å®¹',\n  },\n  constraint: 'æ ‡æ³¨å¿…é¡»å­˜åœ¨ï¼Œä¸å¾—é—æ¼ï¼Œå­˜åœ¨ä¸”åªå­˜åœ¨ä¸€æ¬¡'\n});\n<%_\n}\n_%>\n<%_  \nvar double_api= String(getLocalVar(\"double_api\")|| \"false\");\nvar batches = Number(getLocalVar(\"batches\")|| 1);\n//ä¸å‚ä¸æ›´æ–°è§„åˆ™\nif(double_api ===\"false\" || (double_api === \"true\" && batches === 2)){\n_%>\ngame.memory_updater.set('apply_attribute_change', {\n  rule: {\n    if_log_exists: 'è‹¥å½“å‰å›å¤å‡ºç°ã€xxxï¼Œå·²å˜æ›´ã€‘æ ¼å¼çš„logï¼Œå°†å…¶åº”ç”¨åˆ°memory',\n    if_no_log: 'è‹¥æ­£æ–‡æ— å˜æ›´logï¼Œåˆ™ä¸åº”ç”¨ä»»ä½•å˜æ›´',\n    strict_match: 'åªåº”ç”¨æ˜ç¡®æ ‡æ³¨çš„å˜æ›´ï¼Œåªåº”ç”¨æ ‡æ³¨ä¸­çš„æ­£ç¡®æ—§å€¼å’Œæ–°å€¼ï¼Œç¦æ­¢æ¨æµ‹æˆ–è¡¥å……'\n  },\n  process: {\n    step1: 'æ‰«æå½“å‰å›å¤ä¸­æ‰€æœ‰ã€xxxâ†’xxxï¼Œå·²å˜æ›´ã€‘æ ‡è®°',\n    step2: 'æå–å˜æ›´é¡¹ã€æ—§å€¼ã€æ–°å€¼',\n    step3: 'ç”¨æ­£ç¡®æŒ‡ä»¤\\æ­£ç¡®è·¯å¾„\\æ­£ç¡®æ—§å€¼å’Œæ–°å€¼ï¼Œå°†å˜æ›´åº”ç”¨',\n    step4: 'å¿½ç•¥æ‰€æœ‰æœªæ ‡æ³¨çš„å˜æ›´'\n  }\n});\n<%_\n}\n_%>","constant":true,"vectorized":false,"selective":true,"selectiveLogic":0,"addMemo":true,"order":5,"position":4,"disable":false,"excludeRecursion":false,"preventRecursion":false,"matchPersonaDescription":false,"matchCharacterDescription":false,"matchCharacterPersonality":false,"matchCharacterDepthPrompt":false,"matchScenario":false,"matchCreatorNotes":false,"delayUntilRecursion":false,"probability":100,"useProbability":true,"depth":0,"group":"æ•°å€¼è¿½è¸ª","groupOverride":true,"groupWeight":100,"scanDepth":null,"caseSensitive":null,"matchWholeWords":null,"useGroupScoring":null,"automationId":"","role":0,"sticky":0,"cooldown":0,"delay":0,"triggers":[],"displayIndex":11,"characterFilter":{"isExclude":false,"names":[],"tags":[]}},"12":{"uid":12,"key":[],"keysecondary":[],"comment":"ğŸ”°ç‰©å“æ ¼å¼-ä¿®æ”¹","content":"  <%_  \nvar double_api= String(getLocalVar(\"double_api\")|| \"false\");\nvar batches = Number(getLocalVar(\"batches\")|| 1);\n\nif(double_api ===\"false\" || (double_api === \"true\" && batches === 2) ){\n_%>\n\nitems_formats:{\n\"info\":\"string\"\n\"type\":\"string\"\n\"num\":\"num\"\n}\n},\ndelete_item_when: [\n\"item.num == 0\",\n\"ç‰©å“è½¬äº¤å®Œæˆ\",\n\"ç‰©å“å®Œå…¨æ¶ˆè€—\"\n],\n<%_  \nvar double_api= String(getLocalVar(\"double_api\")|| \"false\");\nvar batches = Number(getLocalVar(\"batches\")|| 1);\n\nif(double_api ===\"false\" || (double_api === \"true\" && batches === 2) ){\n_%>\nupdate_rule:\"ç©å®¶ä»¬æ‹¥æœ‰ä¸”æœªè¢«è®°å½•åœ¨æ¡ˆçš„æ‰€æœ‰ç‰©å“(åŒ…æ‹¬å·²ç©¿æˆ´/æœªç©¿æˆ´çš„æ­¦å™¨è£…å¤‡)éƒ½éœ€è¦åˆå§‹åŒ–å¹¶æ”¾å…¥å„è‡ªçš„èƒŒåŒ…å­—æ®µä¸­ã€‚ç”Ÿæ´»æ‚ç‰©æ— éœ€è®°å½•è‡³èƒŒåŒ…ï¼Œåªè®°å½•ç‰¹æ®Šç‰©å“ã€‚\"\n<%_\n}\n_%>\n<%_  \n}\n_%>","constant":true,"vectorized":false,"selective":true,"selectiveLogic":0,"addMemo":true,"order":80,"position":4,"disable":false,"excludeRecursion":false,"preventRecursion":false,"matchPersonaDescription":false,"matchCharacterDescription":false,"matchCharacterPersonality":false,"matchCharacterDepthPrompt":false,"matchScenario":false,"matchCreatorNotes":false,"delayUntilRecursion":false,"probability":100,"useProbability":true,"depth":0,"group":"ç‰©å“æ ¼å¼","groupOverride":true,"groupWeight":100,"scanDepth":null,"caseSensitive":null,"matchWholeWords":null,"useGroupScoring":null,"automationId":"","role":0,"sticky":0,"cooldown":0,"delay":0,"triggers":[],"displayIndex":11,"characterFilter":{"isExclude":false,"names":[],"tags":[]}},"13":{"uid":13,"key":[],"keysecondary":[],"comment":"ğŸš«æ ¹åŸºä½“ç³»-ç½®ç©º","content":" ","constant":true,"vectorized":false,"selective":true,"selectiveLogic":0,"addMemo":true,"order":5,"position":4,"disable":false,"excludeRecursion":false,"preventRecursion":false,"matchPersonaDescription":false,"matchCharacterDescription":false,"matchCharacterPersonality":false,"matchCharacterDepthPrompt":false,"matchScenario":false,"matchCreatorNotes":false,"delayUntilRecursion":false,"probability":100,"useProbability":true,"depth":0,"group":"æ ¹åŸºä½“ç³»","groupOverride":true,"groupWeight":100,"scanDepth":null,"caseSensitive":null,"matchWholeWords":null,"useGroupScoring":null,"automationId":"","role":0,"sticky":0,"cooldown":0,"delay":0,"triggers":[],"displayIndex":11,"characterFilter":{"isExclude":false,"names":[],"tags":[]}},"14":{"uid":14,"key":[],"keysecondary":[],"comment":"ğŸ­ç¦»çº¿ç©å®¶æ”¿ç­–-AIæ§åˆ¶","content":"game.set('ç¦»çº¿ç©å®¶æ§åˆ¶','\n å¯¹äºstatusä¸ºofflineçš„ç©å®¶ï¼Œä½ éœ€è¦è‡ªä¸»æ§åˆ¶å…¶è¡ŒåŠ¨ï¼Œä½†ä¸å¾—OOCã€‚\n')","constant":true,"vectorized":false,"selective":true,"selectiveLogic":0,"addMemo":true,"order":2,"position":0,"disable":true,"excludeRecursion":false,"preventRecursion":false,"matchPersonaDescription":false,"matchCharacterDescription":false,"matchCharacterPersonality":false,"matchCharacterDepthPrompt":false,"matchScenario":false,"matchCreatorNotes":false,"delayUntilRecursion":false,"probability":100,"useProbability":true,"depth":0,"group":"","groupOverride":false,"groupWeight":100,"scanDepth":null,"caseSensitive":null,"matchWholeWords":null,"useGroupScoring":null,"automationId":"","role":null,"sticky":0,"cooldown":0,"delay":0,"triggers":[],"displayIndex":0,"characterFilter":{"isExclude":false,"names":[],"tags":[]}},"15":{"uid":15,"key":[],"keysecondary":[],"comment":"ğŸ²éª°å­-çº¯æ–‡æœ¬","content":" <%_  \n\nvar double_api= getLocalVar(\"double_api\")|| \"false\";\nvar batches = getLocalVar(\"batches\");\nif((double_api === \"true\" && batches === 1) ||double_api ===\"false\"){\n_%>\ngame.set('COC7æ£€å®š',`\nåœ¨è¾“å‡ºæ­£æ–‡å‰ï¼Œä½ é¦–å…ˆéœ€è¦æ ¹æ®COC7è§„åˆ™å¯¹æ‰€æœ‰ç©å®¶ï¼ˆåŠå…¶ç›¸å…³å‹æ–¹æˆ–æ•Œæ–¹npcï¼‰é€ä¸ªè¿›è¡Œæ£€å®šã€‚\næ£€å®šè§„åˆ™:\n ä¼¤å®³è®°å½•è§„åˆ™: æŒç»­å—ä¼¤éœ€è®°å½•ï¼Œæ¯å›åˆæŠ•æ·ç›¸å…³éª°å­è¿›è¡Œä¼¤å®³åˆ¤å®š,\n æ£€å®šåœºæ™¯è¦æ±‚: è¯æœ¯ã€è°ƒæŸ¥ã€ç‰©å“è·å–ã€æˆ˜æ–—ç­‰ç¬¦åˆCOCè§„åˆ™çš„åœºæ™¯ï¼Œå‡éœ€è¿›è¡Œæ£€å®šã€‚è€Œå¦‚æœä¸å¤„äºæ£€å®šåœºæ™¯ï¼Œåˆ™è·³è¿‡æ£€å®šæµç¨‹ã€‚\nåŸºç¡€æ•°å€¼æ¥æº:\n ç©å®¶æ¡£æ¡ˆ.å±æ€§\né™„åŠ æ•°å€¼æ¥æº:\nç©å®¶.äº‹ä»¶.statuså¯èƒ½æœ‰çš„buffæˆ–debuffåŠ æˆã€è£…å¤‡åŠ æˆã€è¢«åŠ¨æŠ€èƒ½åŠ æˆ\nè¾“å‡ºè§„åˆ™ï¼š\nå°†æ£€å®šæµç¨‹å’Œç»“æœåŒ…è£¹åœ¨æ­£æ–‡å‰çš„<roll/>æ ‡ç­¾ä¸­\n`)\n<%_  \n}\n_%>","constant":true,"vectorized":false,"selective":true,"selectiveLogic":0,"addMemo":true,"order":2,"position":4,"disable":false,"excludeRecursion":false,"preventRecursion":false,"matchPersonaDescription":false,"matchCharacterDescription":false,"matchCharacterPersonality":false,"matchCharacterDepthPrompt":false,"matchScenario":false,"matchCreatorNotes":false,"delayUntilRecursion":false,"probability":100,"useProbability":true,"depth":0,"group":"éª°å­æ£€å®š","groupOverride":true,"groupWeight":100,"scanDepth":null,"caseSensitive":null,"matchWholeWords":null,"useGroupScoring":null,"automationId":"","role":0,"sticky":0,"cooldown":0,"delay":0,"triggers":[],"displayIndex":15,"characterFilter":{"isExclude":false,"names":[],"tags":[]}},"16":{"uid":16,"key":[],"keysecondary":[],"comment":"ğŸ”°è®°å¿†-æ›´æ–°cot","content":"<%_  \nvar double_api= String(getLocalVar(\"double_api\")|| \"false\");\nvar batches = Number(getLocalVar(\"batches\")|| 1);\n\nif(double_api ===\"false\" || (double_api === \"true\" && batches === 2) ){\n_%>\n\n<%_\n// å°è£…çš„æ•°æ®è·å–å‡½æ•° - é¿å…é‡å¤å®šä¹‰\n \n    function getDataWithFallback(varName) {\n      \n        let data = getLocalVar(varName);\n       \n        // å†…è”æ•°æ®éªŒè¯ï¼šæ£€æŸ¥æ˜¯å¦ä¸ºnullã€undefinedï¼Œä¸”å¦‚æœæ˜¯å¯¹è±¡è¦æœ‰å†…å®¹\n        const isValid = (data) => {\n            // æ£€æŸ¥æ˜¯å¦ä¸º null æˆ– undefined\n            if (data === null || data === undefined) {\n                return false;\n            }\n            \n            // å¦‚æœæ˜¯å¯¹è±¡ç±»å‹ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰å†…å®¹\n            if (typeof data === 'object' && data !== null) {\n                // å¦‚æœæ˜¯æ•°ç»„ï¼Œæ£€æŸ¥é•¿åº¦\n                if (Array.isArray(data)) {\n                    return data.length > 0;\n                }\n                // å¦‚æœæ˜¯æ™®é€šå¯¹è±¡ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰å±æ€§\n                return Object.keys(data).length > 0;\n            }\n            \n            // å…¶ä»–ç±»å‹ï¼ˆå­—ç¬¦ä¸²ã€æ•°å­—ã€å¸ƒå°”å€¼ç­‰ï¼‰åªè¦ä¸æ˜¯ null/undefined å°±è®¤ä¸ºæœ‰æ•ˆ\n            return true;\n        };\n        \n        // å¦‚æœæ•°æ®ä¸ç¬¦åˆè¦æ±‚ï¼Œä» getLocalVar è·å–\n        if (!isValid(data)) {\n            data = getLocalVar(varName);\n        }\n        \n        return data;\n    }\n\nif (typeof version === 'undefined') {\n    var version = Number(getLocalVar(\"world_version\", 1));\n}\nif (typeof EvStat === 'undefined') {\n    var EvStat = getDataWithFallback(\"stat_data\");\n}\nif (typeof assaData === 'undefined') {\n    var  assaData = getDataWithFallback(\"assa_data\");\n}\nif (typeof characterData === 'undefined') {\n    var characterData = getDataWithFallback(\"play_character_data\");\n}\n\nvar world_level = _.get(EvStat, 'world.level', 'ä¸­é­”')[0];\nvar world_level_describe = '';\nvar levels = '';\nvar world_max_enegy = 3;\nif (world_level === 'æ— ') {\n    world_max_enegy = 3;\n    world_level_describe = 'æ™®é€šä¸–ç•Œ';\n    levels = `\n        \"1\": \"æ— é£é™©/æ—¥å¸¸æƒ…å†µ\",\n        \"2\": \"è½»å¾®å‡¡äººå±æœºï¼ˆå°åŠ¨ç‰©æ”»å‡»ã€ç¤¾äº¤å›°å¢ƒï¼‰\",\n        \"3\": \"ä¸¥é‡å‡¡äººå±æœºï¼ˆé‡ä¼¤/æ­»äº¡ã€ä¸¥é‡ç¯å¢ƒå±é™©ï¼‰\"\n    `;\n} else if (world_level === 'ä½') {\n    world_max_enegy = 5;\n    world_level_describe = 'å¦‚é‡‘åº¸æ­¦ä¾ ä¸–ç•Œï¼Œå‡¡äººç•Œé¢ï¼Œæ™®é€šç‰©ç†è§„åˆ™';\n    levels = `\n        \"1\": \"æ— é£é™©/æ—¥å¸¸æƒ…å†µ\",\n        \"2\": \"è½»å¾®å‡¡äººå±æœºï¼ˆå°åŠ¨ç‰©æ”»å‡»ã€ç¤¾äº¤å›°å¢ƒï¼‰\",\n        \"3\": \"ä¸¥é‡å‡¡äººå±æœºï¼ˆé‡ä¼¤/æ­»äº¡ã€ä¸¥é‡ç¯å¢ƒå±é™©ï¼‰\",\n        \"4-5\": \"åŸºç¡€è¶…å‡¡å±æœºï¼ˆè¢«åŠ¨è¶…å‡¡ç°è±¡ï¼Œå±€é™äºä¸ªä½“/å°èŒƒå›´ï¼Œæ™®é€šäººå¯åº”å¯¹ï¼‰\"\n    `;\n} else if (world_level === 'ä¸­') {\n    world_max_enegy = 7;\n    world_level_describe = 'å­˜åœ¨ä¸€å®šè¶…å‡¡åŠ›é‡ï¼Œå½±å“æœ‰é™èŒƒå›´';\n    levels = `\n        \"1\": \"æ— é£é™©/æ—¥å¸¸æƒ…å†µ\",\n        \"2\": \"è½»å¾®å‡¡äººå±æœºï¼ˆå°åŠ¨ç‰©æ”»å‡»ã€ç¤¾äº¤å›°å¢ƒï¼‰\",\n        \"3\": \"ä¸¥é‡å‡¡äººå±æœºï¼ˆé‡ä¼¤/æ­»äº¡ã€ä¸¥é‡ç¯å¢ƒå±é™©ï¼‰\",\n        \"4-5\": \"åŸºç¡€è¶…å‡¡å±æœºï¼ˆè¢«åŠ¨è¶…å‡¡ç°è±¡ï¼Œå±€é™äºä¸ªä½“/å°èŒƒå›´ï¼Œæ™®é€šäººå¯åº”å¯¹ï¼‰\",\n        \"6-7\": \"è¿›é˜¶è¶…å‡¡å±æœºï¼ˆä¸»åŠ¨è¶…å‡¡æ”»å‡»ï¼Œå¨èƒè¾ƒå¤§èŒƒå›´ï¼Œéœ€ä¸“ä¸šè¶…å‡¡åŠ›é‡ï¼‰\"\n    `;\n} else if (world_level === 'é«˜') {\n    world_max_enegy = 12;\n    world_level_describe = 'å¼ºå¤§è¶…å‡¡åŠ›é‡ï¼ŒåŒºåŸŸæ€§ç°å®æ‰­æ›²';\n    levels = `\n        \"1\": \"æ— é£é™©/æ—¥å¸¸æƒ…å†µ\",\n        \"2\": \"è½»å¾®å‡¡äººå±æœºï¼ˆå°åŠ¨ç‰©æ”»å‡»ã€ç¤¾äº¤å›°å¢ƒï¼‰\",\n        \"3\": \"ä¸¥é‡å‡¡äººå±æœºï¼ˆé‡ä¼¤/æ­»äº¡ã€ä¸¥é‡ç¯å¢ƒå±é™©ï¼‰\",\n        \"4-5\": \"åŸºç¡€è¶…å‡¡å±æœºï¼ˆè¢«åŠ¨è¶…å‡¡ç°è±¡ï¼Œå±€é™äºä¸ªä½“/å°èŒƒå›´ï¼Œæ™®é€šäººå¯åº”å¯¹ï¼‰\",\n        \"6-7\": \"è¿›é˜¶è¶…å‡¡å±æœºï¼ˆä¸»åŠ¨è¶…å‡¡æ”»å‡»ï¼Œå¨èƒè¾ƒå¤§èŒƒå›´ï¼Œéœ€ä¸“ä¸šè¶…å‡¡åŠ›é‡ï¼‰\",\n        \"8-12\": \"ç¥æ˜è§„åˆ™çº§å±æœºï¼ˆç¥æ˜å¹²é¢„ã€ä¸–ç•Œè§„åˆ™æ‰­æ›²ï¼‰\"\n    `;\n} else if (world_level === 'ç¥è¯') {\n    world_max_enegy = 16;\n    world_level_describe = 'ç¥æ˜æˆ–å®‡å®™çº§åŠ›é‡ï¼Œè§„åˆ™å½»åº•æ‰­æ›²';\n    levels = `\n        \"1\": \"æ— é£é™©/æ—¥å¸¸æƒ…å†µ\",\n        \"2\": \"è½»å¾®å‡¡äººå±æœºï¼ˆå°åŠ¨ç‰©æ”»å‡»ã€ç¤¾äº¤å›°å¢ƒï¼‰\",\n        \"3\": \"ä¸¥é‡å‡¡äººå±æœºï¼ˆé‡ä¼¤/æ­»äº¡ã€ä¸¥é‡ç¯å¢ƒå±é™©ï¼‰\",\n        \"4-5\": \"åŸºç¡€è¶…å‡¡å±æœºï¼ˆè¢«åŠ¨è¶…å‡¡ç°è±¡ï¼Œå±€é™äºä¸ªä½“/å°èŒƒå›´ï¼Œæ™®é€šäººå¯åº”å¯¹ï¼‰\",\n        \"6-7\": \"è¿›é˜¶è¶…å‡¡å±æœºï¼ˆä¸»åŠ¨è¶…å‡¡æ”»å‡»ï¼Œå¨èƒè¾ƒå¤§èŒƒå›´ï¼Œéœ€ä¸“ä¸šè¶…å‡¡åŠ›é‡ï¼‰\",\n        \"8-12\": \"ç¥æ˜è§„åˆ™çº§å±æœºï¼ˆç¥æ˜å¹²é¢„ã€ä¸–ç•Œè§„åˆ™æ‰­æ›²ï¼‰\",\n        \"13-16\": \"æœ¬æºå®‡å®™çº§å±æœºï¼ˆå®‡å®™è§„åˆ™å´©åã€å­˜åœ¨å¨èƒï¼‰\"\n    `;\n} else {\n    world_max_enegy = 7;\n    world_level_describe = 'å­˜åœ¨ä¸€å®šè¶…å‡¡åŠ›é‡ï¼Œå½±å“æœ‰é™èŒƒå›´';\n    levels = `\n        \"1\": \"æ— é£é™©/æ—¥å¸¸æƒ…å†µ\",\n        \"2\": \"è½»å¾®å‡¡äººå±æœºï¼ˆå°åŠ¨ç‰©æ”»å‡»ã€ç¤¾äº¤å›°å¢ƒï¼‰\",\n        \"3\": \"ä¸¥é‡å‡¡äººå±æœºï¼ˆé‡ä¼¤/æ­»äº¡ã€ä¸¥é‡ç¯å¢ƒå±é™©ï¼‰\",\n        \"4-5\": \"åŸºç¡€è¶…å‡¡å±æœºï¼ˆè¢«åŠ¨è¶…å‡¡ç°è±¡ï¼Œå±€é™äºä¸ªä½“/å°èŒƒå›´ï¼Œæ™®é€šäººå¯åº”å¯¹ï¼‰\",\n        \"6-7\": \"è¿›é˜¶è¶…å‡¡å±æœºï¼ˆä¸»åŠ¨è¶…å‡¡æ”»å‡»ï¼Œå¨èƒè¾ƒå¤§èŒƒå›´ï¼Œéœ€ä¸“ä¸šè¶…å‡¡åŠ›é‡ï¼‰\"\n    `;\n}\n\n \nvar currency_point = _.get(characterData, 'è´§å¸.ç§¯åˆ†[0]', 0);\nvar currency_zhixian = JSON.stringify(_.get(characterData, 'è´§å¸.æ”¯çº¿å‰§æƒ…', ''));\nvar currency_xp = _.get(characterData, 'è´§å¸.ç»éªŒå€¼[0]', 0);\nvar energy_pool = JSON.stringify(_.get(characterData, 'è¡ç”Ÿå±æ€§.èƒ½é‡æ± ', ''));\n \nvar defense_impact = _.get(characterData, 'è¡ç”Ÿå±æ€§.é˜²å¾¡.ä¼¤å®³å‡å….å†²å‡»[0]', 0);\nvar defense_lethal = _.get(characterData, 'è¡ç”Ÿå±æ€§.é˜²å¾¡.ä¼¤å®³å‡å….è‡´å‘½[0]', 0);\nvar defense_aggravated = _.get(characterData, 'è¡ç”Ÿå±æ€§.é˜²å¾¡.ä¼¤å®³å‡å….æ¶æ€§[0]', 0);\nvar save_fortitude = _.get(characterData, 'è¡ç”Ÿå±æ€§.è±å…æ£€å®šåŸºç¡€.å¼ºéŸ§[0]', 0);\nvar save_reflex = _.get(characterData, 'è¡ç”Ÿå±æ€§.è±å…æ£€å®šåŸºç¡€.åå°„[0]', 0);\nvar save_will = _.get(characterData, 'è¡ç”Ÿå±æ€§.è±å…æ£€å®šåŸºç¡€.æ„å¿—[0]', 0);\nvar speed = _.get(characterData, 'è¡ç”Ÿå±æ€§.é€Ÿåº¦.åŸºç¡€é€Ÿåº¦[0]', 0);\nvar initiative = _.get(characterData, 'è¡ç”Ÿå±æ€§.å…ˆæ”»[0]', 0);\nvar world_role = getLocalVar(\"world_role\", \"\");\nvar player_role = getLocalVar(\"player_role\", \"è½®å›è€…\");\nvar tier_role = getLocalVar(\"tier_role\", \"\");\nvar profession_role = getLocalVar(\"profession_role\", \"\");\nvar point_role = getLocalVar(\"point_role\", \"\");\nvar zhixian_role = getLocalVar(\"zhixian_role\", \"\");\nvar xp_role = getLocalVar(\"xp_role\", \"\");\nvar the_created = _.get(EvStat, 'the_created.name[0]', \"\");\nvar if_bg= getLocalVar(\"bg_source\")|| \"false\";\nvar if_comlex_battle = getLocalVar(\"complex_battle\")|| \"false\";\nvar if_dice_use = getLocalVar(\"dice_use\")|| \"false\";\nvar if_safe_use = getLocalVar(\"safe_use\")|| \"true\";\nvar if_status_analyze =  \"true\";\nvar if_attribute_use = getLocalVar(\"attribute_use\")|| \"true\";\n // ä½¿ç”¨ var æˆ–ç›´æ¥èµ‹å€¼åˆ°å…¨å±€å¯¹è±¡\n    var loadTextConfig = async function(filename = 'config.txt') {\n        const baseUrl = 'https://longlivecanc.github.io/god_space';\n        const fullUrl = `${baseUrl}/${filename}?v=${new Date().getTime()}`;\n        \n        try {\n            console.log(`æ­£åœ¨åŠ è½½æ–‡æœ¬æ–‡ä»¶: ${fullUrl}`);\n            const response = await fetch(fullUrl);\n            \n            if (!response.ok) {\n                throw new Error(`HTTPé”™è¯¯: ${response.status} ${response.statusText}`);\n            }\n            \n            const textContent = await response.text();\n            console.log('æ–‡æœ¬æ–‡ä»¶åŠ è½½æˆåŠŸ');\n            console.log(`æ–‡ä»¶å¤§å°: ${textContent.length} å­—ç¬¦`);\n            \n            return textContent;\n            \n        } catch (error) {\n            console.error('åŠ è½½æ–‡æœ¬æ–‡ä»¶å¤±è´¥:', error.message);\n            \n            const fallbackConfig = `PrimarySceneType:[æ‹±é—¨å»ºç­‘å®¤å†…,ç°ä»£å»ºç­‘ç¾¤,åºŸåœŸ,ç°ä»£åŸå¸‚è¡—é“,å¤ä»£è¥¿æ–¹åŸé•‡,å¤ä»£ä¸­å›½åŸå¸‚,è¥¿æ–¹å¸‚åœº,æ ¡å›­,æ£®æ—,æµ·æ´‹,æ²³æµ,è‰åŸ,é›ªåŸ,æ°´ä¸‹,ç®€çº¦æˆ¿é—´,è±ªåæˆ¿é—´,ä¸­å¼å®¢æ ˆ,ç°ä»£å¤§å ‚,èµ°å»Š,å®éªŒå®¤,æ´ç©´,ç›‘ç‹±,æ˜Ÿèˆ°å†…éƒ¨,æµ®ç©ºå²›,è¾å°„åºŸåœŸ,èµ›åšæœ‹å…‹,å¤–å¤ªç©º,ç«å±±åœ°å¸¦,æ²™æ¼ ç»¿æ´²,ç«¹æ—,ç€‘å¸ƒ,å³¡è°·,å¤ä»£é—è¿¹,è’¸æ±½æœ‹å…‹å·¥å‚,é­”æ³•å›¾ä¹¦é¦†,æ°´æ™¶æ´ç©´,æ¨±èŠ±æ—,å¤ä»£ç«æŠ€åœº,å†°å·,æ²¼æ³½,å¤©ç©ºä¹‹åŸ,åœ°ä¸‹åŸ,ç¦…æ„åº­é™¢,ç§‘å¹»å®éªŒå®¤,åºŸå¼ƒæ¸¸ä¹å›­,çƒ­å¸¦é›¨æ—,æœˆçƒè¡¨é¢],\nTimeAndLight: [BrightDay,OvercastDay,GoldenHour,DeepNight],\nAtmosphereAndCondition: [Peaceful,Decay,Dynamic]`;\n            \n            console.log('ä½¿ç”¨å¤‡ç”¨é…ç½®');\n            return fallbackConfig;\n        }\n    };\n\nconst configText = await loadTextConfig('config.txt');\n \nvar lore_result = '';\n// æ‰«ææ‰€æœ‰ xxx_lore ä¸‹çš„å­å­—æ®µ\nconst loreFields = new Set();\nif(assaData != undefined){\n\n// éå† assaData çš„æ‰€æœ‰é”®\nObject.keys(assaData).forEach(key => {\n  // æ£€æŸ¥æ˜¯å¦ä»¥ _lore ç»“å°¾\n  if (key.endsWith('_lore') && typeof assaData[key] === 'object') {\n    // è·å–è¯¥ lore å¯¹è±¡çš„æ‰€æœ‰å­å­—æ®µ\n    Object.keys(assaData[key]).forEach(subKey => {\n      loreFields.add(subKey);\n    });\n  }\n});\n\n// éœ€è¦è¿‡æ»¤æ‰çš„å­—æ®µ\nconst excludeFields = ['åˆ†é˜¶æ®µå¥½æ„Ÿ', 'å°é˜Ÿä¿¡æ¯'];\n\n// è¿‡æ»¤å¹¶è½¬æ¢ä¸ºæ•°ç»„\nconst filteredFields = Array.from(loreFields).filter(field => !excludeFields.includes(field));\n\n// è½¬æ¢ä¸ºå¸¦å¼•å·çš„å­—ç¬¦ä¸²æ ¼å¼\nlore_result = filteredFields.map(field => `'${field}'`).join(',');\n\n}\n\n_%>\ngame.set('memory_update_system', {\ndesc: \"æ­£æ–‡è¾“å‡ºç»“æŸåï¼Œä½ è¿˜æœ‰ä¸€ä¸ªé¢å¤–ä»»åŠ¡ï¼Œä½ è¿˜éœ€è¦å¯¹game.memoryè¿›è¡Œåˆ†æå’Œæ›´æ–°ã€‚ä½ å¿…é¡»è¾“å‡ºä»¥ä¸‹æ ‡ç­¾å¹¶æŒ‰ç…§è§„åˆ™æ£€æŸ¥éœ€è¦å¯¹åº”æ›´æ–°çš„è®°å¿†ï¼Œç„¶åéœ€è¦ä¸¥æ ¼æŒ‰ç…§analyzeçš„åˆ†æï¼Œæ¥åœ¨<updateMemory>è¾“å‡ºæŒ‡ä»¤\",\n<%_\nif (if_status_analyze!== \"false\") {\n_%>status_analyze: {\ntag: '<statusAnalyze>',\nscope:'memory.status',\ndesc: 'Analyze current state to prepare for status`s updates. Output format: ${check_name}: ${result} \nchecks: {\ntime: \"Advance time logically.\",\n//æ—¥æœŸåªåœ¨è·¨è¿‡0ç‚¹çš„æ—¶å€™æ¨è¿›ï¼Œä¾‹å¦‚ä»å‡Œæ™¨3ç‚¹åˆ°æ—©ä¸Š7ç‚¹ä¸éœ€è¦æ”¹å˜æ—¥æœŸã€‚\n<%_\nif (if_bg=== \"true\") {\n_%>\nscene_img: {\nrule: 'update åœºæ™¯å›¾based on the current environment.format must be: PrimarySceneType-TimeAndLight-AtmosphereAndCondition.e.g. åºŸåœŸ-BrightDay-Peaceful',\n//å¦‚æœæ²¡æœ‰åˆé€‚çš„å¯¹åº”åˆ†ç±»å°±åœ¨allowed_tagsä¸­é€‰æ‹©ä¸€ä¸ªæœ€ç›¸è¿‘çš„ï¼Œåªèƒ½é€‰ç”¨allowed_tagsä¸­çš„tagï¼Œç¦æ­¢è¶…å‡ºallowed_tagsçš„èŒƒå›´ã€‚\nallowed_tags: {\n<%= configText %>\n}\n},\n<%_\n}\n_%>\n}\n}\n},\n<%_\n}\n_%>lore_analyze: {\ntag: '<loreAnalyze>',\nscope:'memory.global_lore <%_ if (version != 7) { _%>,memory.world_lore<%_ } _%>',\ndesc: 'Analyze lore changes needed. Output format: \"${check_name}: ${result}\".',\nchecks: {\n\"é€ä¸ªæ£€æŸ¥loreä¸‹çš„æ‰€æœ‰é¡¶å±‚åˆ†ç±»ï¼Œå¹¶è‡ªç”±åˆ†ææ˜¯å¦æœ‰éœ€è¦æ–°å¢/æ›´æ–°/åˆ é™¤çš„å†…å®¹ï¼ŒåŸºäºå„è‡ªçš„descä½œä¸ºåŒæ­¥è§„åˆ™ï¼Œæ­£æ–‡å·²æœ‰è€Œæœªè¢«è®°å½•åœ¨æ¡ˆçš„å¿…é¡»åˆå§‹åŒ–è¿›å¯¹åº”çš„å­—æ®µï¼Œæ­£æ–‡å‘ç”Ÿäº†å˜åŒ–è€Œä¾æ—§æ˜¯è¿‡æ—¶ä¿¡æ¯çš„å¿…é¡»100%åŒæ­¥è¿›å¯¹åº”çš„å­—æ®µã€‚{{getvar::maxComplexNpcRule}}\",\n}\n},\nupdate_memory: {\ntag: \"<updateMemory>\",\ndesc: \"Execute memory operations based on analysis. All rules are absolute.**å¿…é¡»**åœ¨æ­¤å¤„åº”ç”¨å‰é¢analyzeçš„å˜åŠ¨ï¼Œå†…å®¹å¿…é¡»100%ç»Ÿä¸€ï¼ç¦æ­¢å‡ºç°åˆ†æäº†æŸæ”¹åŠ¨(å¦‚æ—¶é—´ã€è£…å¤‡ã€è´§å¸å˜åŒ–)ï¼Œä½†æ²¡æœ‰åœ¨<updateMemory>ä¸­åº”ç”¨çš„æƒ…å†µï¼\",\ncommands: {\nadd_update: memory('path.key', 'value');//new_value can be string/num/json object,å¦‚memory('path.key', '{\"xx\":\"xx\",\"xx\":\"xx\"}');ã€‚è‹¥ä¸ºjsonæ ¼å¼å¯ä»¥å®Œæ•´åˆå§‹åŒ–ï¼Œä¹Ÿèƒ½åªæ›´æ–°JSONå¯¹è±¡ä¸­å‘ç”Ÿå˜åŒ–çš„é”®å€¼å¯¹ï¼Œç±»ä¼¼json patchã€‚\nrename: memory('path.old_key', 'path.new_key'); \nmove: memory('old_path.key', 'new_path.key'); \ndelete: delete('path', 'key'); \n},\nrules: {\nsingle_operation: \"One command per line, one key per command.\",\npure_data_only: \"Values must be pure data (string/number/object), NO comments or AI reasoning inside values.\",\n <%_ if (version != 7) { _%>\non_world_exit: \"Must use: delete('world_lore.npc','all'); and delete('world_lore.settings','all');\",\n<%_ } _%>\n},\nexamples: [<%_\nif (if_status_analyze !== \"false\") {\n_%>\nmemory('status.æ—¥æœŸ', '01æœˆ01æ—¥'); //Init time,\nmemory('status.æ—¶é—´','18:00'); //Time passed,\n<%_\n}\n_%>\nmemory('global_lore.npc.é˜´æ²‰ç”·äºº', 'global_lore.npc.å¼ ä¸‰'); //rename NPC \ndelete('global_lore.npc', 'å¼ ä¸‰');// delete NPC,\n<%_if (if_attribute_use === \"true\") {_%>\nmemory('attribute.è´§å¸.<%=xp_role %>',20);\nmemory('attribute.è¡ç”Ÿå±æ€§.èƒ½é‡æ± .å½“å‰å€¼',50);\n<%_}%>\n]\n}\n});\n<%_\n}\n_%>","constant":true,"vectorized":false,"selective":true,"selectiveLogic":0,"addMemo":true,"order":79,"position":4,"disable":false,"excludeRecursion":false,"preventRecursion":false,"matchPersonaDescription":false,"matchCharacterDescription":false,"matchCharacterPersonality":false,"matchCharacterDepthPrompt":false,"matchScenario":false,"matchCreatorNotes":false,"delayUntilRecursion":false,"probability":100,"useProbability":true,"depth":0,"group":"æ›´æ–°cot","groupOverride":true,"groupWeight":100,"scanDepth":null,"caseSensitive":null,"matchWholeWords":null,"useGroupScoring":false,"automationId":"","role":0,"sticky":0,"cooldown":0,"delay":0,"triggers":[],"displayIndex":16,"characterFilter":{"isExclude":false,"names":[],"tags":[]}},"17":{"uid":17,"key":[],"keysecondary":[],"comment":"ğŸ”°æ•°å€¼çº¦æŸ-ä¿®æ”¹","content":" <%_  \nvar double_api= String(getLocalVar(\"double_api\")|| \"false\");\nvar batches = Number(getLocalVar(\"batches\")|| 1);\n//ä¸å‚ä¸æ›´æ–°è§„åˆ™\nif(double_api ===\"false\" || (double_api === \"true\" && batches === 1)){\n_%><%_\n// å°è£…çš„æ•°æ®è·å–å‡½æ•° - é¿å…é‡å¤å®šä¹‰\n \n    function getDataWithFallback(varName) {\n     \n        let data = getLocalVar(varName);\n       \n        // å†…è”æ•°æ®éªŒè¯ï¼šæ£€æŸ¥æ˜¯å¦ä¸ºnullã€undefinedï¼Œä¸”å¦‚æœæ˜¯å¯¹è±¡è¦æœ‰å†…å®¹\n        const isValid = (data) => {\n            // æ£€æŸ¥æ˜¯å¦ä¸º null æˆ– undefined\n            if (data === null || data === undefined) {\n                return false;\n            }\n            \n            // å¦‚æœæ˜¯å¯¹è±¡ç±»å‹ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰å†…å®¹\n            if (typeof data === 'object' && data !== null) {\n                // å¦‚æœæ˜¯æ•°ç»„ï¼Œæ£€æŸ¥é•¿åº¦\n                if (Array.isArray(data)) {\n                    return data.length > 0;\n                }\n                // å¦‚æœæ˜¯æ™®é€šå¯¹è±¡ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰å±æ€§\n                return Object.keys(data).length > 0;\n            }\n            \n            // å…¶ä»–ç±»å‹ï¼ˆå­—ç¬¦ä¸²ã€æ•°å­—ã€å¸ƒå°”å€¼ç­‰ï¼‰åªè¦ä¸æ˜¯ null/undefined å°±è®¤ä¸ºæœ‰æ•ˆ\n            return true;\n        };\n        \n        // å¦‚æœæ•°æ®ä¸ç¬¦åˆè¦æ±‚ï¼Œä» getLocalVar è·å–\n        if (!isValid(data)) {\n            data = getLocalVar(varName);\n        }\n        \n        return data;\n    }\n \n \nif (typeof characterData === 'undefined') {\n    var characterData = getDataWithFallback(\"play_character_data\");\n}\n\nvar currency_point = _.get(characterData, 'è´§å¸.ç§¯åˆ†[0]', 0);\nvar currency_zhixian = JSON.stringify(_.get(characterData, 'è´§å¸.æ”¯çº¿å‰§æƒ…', ''));\nvar currency_xp = _.get(characterData, 'è´§å¸.ç»éªŒå€¼[0]', 0);\n \nvar world_role = getLocalVar(\"world_role\", \"\");\nvar player_role = getLocalVar(\"player_role\", \"è½®å›è€…\");\nvar tier_role = getLocalVar(\"tier_role\", \"\");\nvar profession_role = getLocalVar(\"profession_role\", \"\");\nvar point_role = getLocalVar(\"point_role\", \"\");\nvar zhixian_role = getLocalVar(\"zhixian_role\", \"\");\nvar xp_role = getLocalVar(\"xp_role\", \"\");\n if (typeof version === 'undefined') {\n    var version = Number(getLocalVar(\"world_version\", 1));\n}\n\n_%>\ngame.set('value_constraints',{\nattribute_scale:'1æ®‹ç–¾|2å¸¸äºº|5ä¸“å®¶|8ä¼ å¥‡ã€‚å°æ•°å¯ç”¨',\nskills:{\nä¸»åŠ¨æŠ€èƒ½:{\ndp_range:'1-3ç‚¹',\nenergy_ratio:'100èƒ½é‡=1dp',\nformat:'ã€dpÂ±${num};èƒ½é‡æ± Â±${num}ã€‘xxx',\nç¦æ­¢:'åŠ åŸºç¡€å±æ€§/æŠ€èƒ½'\n},\nè¢«åŠ¨æŠ€èƒ½:{\nattribute_bonus:'æœ€å¤š1-2ç‚¹ï¼Œä»…åº”ç”¨ä¸€æ¬¡',\nformat:'ã€${åŸºç¡€å±æ€§/æŠ€èƒ½}Â±${num}ã€‘xxx'//ä»£ç è‡ªåŠ¨åŠ æˆï¼Œä½ æ— éœ€æ‰‹åŠ¨ä¿®æ”¹\n},\nä¾‹:[\nmemory('global_lore.å…¶ä»–æŠ€èƒ½.ç«çƒæœ¯','{...\"effect\":\"ã€dp+1;èƒ½é‡æ± -100ã€‘xxx\",\"level\"...}')\nmemory('global_lore.å…¶ä»–æŠ€èƒ½.å±é™©ç›´è§‰','{...\"effect\":\"ã€æ„ŸçŸ¥+1ã€‘xxx\"...}')\n]\n},\nequipment:{\ncommon:'ä»…åŸºç¡€é˜²å¾¡',\nrare:'åŠ å±æ€§è£…å¤‡ç¨€ç¼º',\nauto_apply:'è£…å¤‡/è¢«åŠ¨åŠ æˆä»£ç è‡ªåŠ¨åº”ç”¨ï¼Œç¦æ­¢æ‰‹åŠ¨å åŠ '\n},\ncurrency:{\ncurrent:{\n<%=point_role%>:num\n<%_if(version!==7){_%><%=zhixian_role%>:{}<%_}_%>\n<%=xp_role%>:num\n},\nrules:{\nè‡ªåŠ¨è´­ç‰©:'ç¦æ­¢ã€‚ä½ ä¸èƒ½ä»£æ›¿ç©å®¶æ¶ˆè€—ä»»ä½•è´§å¸ã€‚å¦‚ï¼šç¦æ­¢åœ¨ç©å®¶æ²¡æœ‰æåŠè¦ä¹°çš„æƒ…å†µä¸‹æ“…è‡ªè´­ä¹°æŸç‰©å“ã€‚',\nä¸è¶³å¤±è´¥:'è´§å¸ä¸è¶³â†’è´­ä¹°å¤±è´¥|èƒ½é‡ä¸è¶³â†’æ–½æ³•å¤±è´¥',\nå‡çº§é™å®š:'<%=point_role%>ç¦æ­¢å‡çº§å±æ€§/æŠ€èƒ½ï¼Œåªèƒ½ç”¨<%=xp_role%>',\nç»éªŒå…‹åˆ¶:'è®­ç»ƒ1å¤©=10xp|è¾¹é™…é€’å‡|å¤šæ•°ä¸ªä½æ•°|è·å–æéš¾'\n}\n},\niron_law:'ç‹¬ç«‹äºæ£€å®šç³»ç»Ÿã€‚æ£€å®šæˆåŠŸâ‰ æ— è§†çº¦æŸã€‚è¿è§„å°è¯•=æµ‹è¯•ä½ èƒ½å¦ç”Ÿæˆæ­£ç¡®ã€å¤±è´¥ã€‘å‰§æƒ…'\n});\n<%_\n}\n_%>","constant":true,"vectorized":false,"selective":true,"selectiveLogic":0,"addMemo":true,"order":5,"position":4,"disable":false,"excludeRecursion":false,"preventRecursion":false,"matchPersonaDescription":false,"matchCharacterDescription":false,"matchCharacterPersonality":false,"matchCharacterDepthPrompt":false,"matchScenario":false,"matchCreatorNotes":false,"delayUntilRecursion":false,"probability":100,"useProbability":true,"depth":0,"group":"æ•°å€¼çº¦æŸ","groupOverride":true,"groupWeight":100,"scanDepth":null,"caseSensitive":null,"matchWholeWords":null,"useGroupScoring":null,"automationId":"","role":0,"sticky":0,"cooldown":0,"delay":0,"triggers":[],"displayIndex":11,"characterFilter":{"isExclude":false,"names":[],"tags":[]}},"18":{"uid":18,"key":[],"keysecondary":[],"comment":"ğŸ­é€‰é¡¹åŒº-äººäººéƒ½æœ‰","content":" <%_  \n\nvar double_api= getLocalVar(\"double_api\")|| \"false\";\nvar batches = getLocalVar(\"batches\");\nif((double_api === \"true\" && batches === 2) ||double_api ===\"false\"){\n_%>\n{{setvar::options_rule::<options>}}\ngame.set('addition task:å¤šäººé€‰é¡¹åŒº', {\n  rule: 'åœ¨è®°å¿†åˆ†æç»“æŸåç”Ÿæˆæ‰€æœ‰ç©å®¶çš„é€‰é¡¹åŒºï¼Œä½ éœ€è¦ä½¿ç”¨<options target=\"${player_name}\">æ ‡ç­¾åŒ…è£¹å¤šä¸ªé€‰é¡¹åŒºï¼Œå†…å®¹ä¸ºæ•°å­—åŒ–åºåˆ—ï¼ˆ1. 2. 3...ï¼‰çš„3ä¸ªé€‰é¡¹',\n  scope: 'æ¯ä¸ªé€‰é¡¹åŒºéƒ½è¦æ ¹æ®ä¸Šä¸‹æ–‡å’Œå½“å‰å‰§æƒ…ç”Ÿæˆç‹¬å±äºè¯¥ç©å®¶çš„çš„3ä¸ªè¡ŒåŠ¨é€‰é¡¹',\n  tendencies: [\n   { type: 'ç§¯ææ¨è¿›å‰§æƒ…', rule: 'ä¸»åŠ¨æ¨åŠ¨ä¸»çº¿æˆ–æ”¯çº¿ä»»åŠ¡è¿›å±•' },\n    { type: 'ç¬¦åˆè¯¥ç©å®¶æ€§æ ¼', rule: 'ä¸è¯¥ç©å®¶çš„æ€§æ ¼ç‰¹å¾ä¸€è‡´'},\n    { type: 'å¯¹å‰§æƒ…åæ§½', rule: 'è¯™è°ä¸”æ°å½“çš„å¯¹å½“å‰æƒ…å†µçš„åæ§½' } \n  ]\n});\n<%_  \n}\n_%>\n\n\n","constant":true,"vectorized":false,"selective":true,"selectiveLogic":0,"addMemo":true,"order":107,"position":4,"disable":false,"excludeRecursion":false,"preventRecursion":false,"matchPersonaDescription":false,"matchCharacterDescription":false,"matchCharacterPersonality":false,"matchCharacterDepthPrompt":false,"matchScenario":false,"matchCreatorNotes":false,"delayUntilRecursion":false,"probability":100,"useProbability":true,"depth":0,"group":"é€‰é¡¹","groupOverride":true,"groupWeight":100,"scanDepth":null,"caseSensitive":null,"matchWholeWords":null,"useGroupScoring":false,"automationId":"","role":0,"sticky":0,"cooldown":0,"delay":0,"triggers":[],"displayIndex":10,"characterFilter":{"isExclude":false,"names":[],"tags":[]}},"19":{"uid":19,"key":[],"keysecondary":[],"comment":"ğŸ’ ä»»åŠ¡æ ¼å¼åŠ ä¸€ç‚¹","content":"{{setvar::is_meme_use::false}}{{setvar::attribute_use::false}}{{setvar::if_status_analyze::false}}{{setvar::map_rule:: }}\n<%_  \n\nvar double_api= getLocalVar(\"double_api\")|| \"false\";\nvar batches = getLocalVar(\"batches\")|| 1;\n \nif(double_api ===\"false\" || (double_api === \"true\" && batches === 2) ){\n_%>\n<%_\nvar world_role = getLocalVar(\"world_role\", \"\");\nvar player_role = getLocalVar(\"player_role\", \"è½®å›è€…\");\nvar tier_role = getLocalVar(\"tier_role\", \"\");\nvar profession_role = getLocalVar(\"profession_role\", \"\");\nvar point_role = getLocalVar(\"point_role\", \"\");\nvar zhixian_role = getLocalVar(\"zhixian_role\", \"\");\nvar xp_role = getLocalVar(\"xp_role\", \"\");\nvar is_private_chat = getLocalVar(\"private_chat\", \"false\");\nvar contactable_tag = \"\";\nif(String(is_private_chat) === \"true\"){\n    contactable_tag = ', \"å¯è”ç³»\":true/false //æ˜¯å¦åŠ ä¸Šå¥½å‹,å†³å®šäº†æ˜¯å¦å¯ä»¥è¿›è¡Œç§èŠ';\n}\n \n// è·å–ä¸–ç•Œç‰ˆæœ¬å·\nif (typeof version === 'undefined') {\n    var version = Number(getLocalVar(\"world_version\") || 1);\n}\n \n_%>\ngame.set('addition_task_record_rules',`\nåœ¨å¤šäººæ¨¡å¼ä¸‹ï¼Œå¯¹äºç©å®¶ä»¬æ‰€æ¥å–çš„ä»»åŠ¡ï¼Œåœ¨è®°å½•æ¥å–åœ°ç‚¹çš„åŒæ—¶ä¹Ÿå¿…é¡»è®°å½•æ¥å–äººå‘˜åç§°ã€‚æ ¼å¼ä¸ºï¼š\"æ¥å–åœ°ç‚¹\":\"åœ°ç‚¹(æ¥å–äººå‘˜ï¼šname,name,name...)\"ã€‚\n`)\n<%_\n}\n_%>\n \n ","constant":true,"vectorized":false,"selective":true,"selectiveLogic":0,"addMemo":true,"order":601,"position":1,"disable":false,"excludeRecursion":false,"preventRecursion":false,"matchPersonaDescription":false,"matchCharacterDescription":false,"matchCharacterPersonality":false,"matchCharacterDepthPrompt":false,"matchScenario":false,"matchCreatorNotes":false,"delayUntilRecursion":false,"probability":100,"useProbability":true,"depth":4,"group":"npcä¿¡æ¯","groupOverride":true,"groupWeight":100,"scanDepth":null,"caseSensitive":null,"matchWholeWords":null,"useGroupScoring":null,"automationId":"","role":null,"sticky":0,"cooldown":0,"delay":0,"triggers":[],"displayIndex":3,"characterFilter":{"isExclude":false,"names":[],"tags":[]}}}}